# JS Port Plan (keep 5–15 items; one line per task)
0. [x] Template (type: template) — copy this format: goal/acceptance criteria; tests: npm test && npm run lint; notes: add details as needed. (Template retained for future tasks.)
1. [x] Freeze baseline outputs (type: chore) — run current Python flow on a small deterministic video list, store golden JSON/zip and CLI invocation logs for parity checks; tests: make lint && python batch_fetch.py && python export_combined_json.py; notes: fixtures captured under tests/fixtures/python_baseline (selected DevOops_conf/HighLoadChannel samples + exports).
2. [x] Inventory & surface map (type: planning) — document Python entrypoints, configs, env vars, and external dependencies to shape the JS structure; tests: make lint; notes: captured in docs/js-port.md (Python entrypoints, envs, behavior, schema).
3. [x] Node project scaffolding (type: feat) — init package.json, lint/format config, env loader, and npm scripts mirroring Makefile targets; tests: npm run lint; notes: chose TypeScript (NodeNext), added tsx + dotenv/undici, tsc --noEmit as lint.
4. [x] Shared config & logging module (type: feat) — centralize env parsing (API_KEYS, USER_AGENTS, LANG, delays) and structured logs matching Python defaults; tests: npm test && npm run lint; notes: config includes rate-limit/backoff + LOG_LEVEL, logger wraps timestamped levels.
5. [x] HTTP/YouTube client (type: feat) — implement youtubei/v1/player with retry/backoff, random UA/API key rotation, and error mapping to align with Python responses; tests: npm test youtubeClient.test && npm run lint; notes: mockable http client + fixtures (`tests/youtube.test.ts`).
6. [x] Port single-video fetch (type: feat) — JS module equivalent of fetch_subs: same inputs, edge cases, and JSON schema; tests: npm test fetchSubs.test && npm run lint; notes: CLI `npm run fetch -- <id> [lang] [channel]` via `src/cli/fetchSubs.ts`, shared flow in `src/flows/fetchSingle.ts`, captions fixtures/tests added.
7. [x] Port batching/job runner (type: feat) — JS batch flow reading video_db.json, honoring concurrency/delay caps, producing per-video status; tests: npm run lint && npm test; notes: `npm run batch` (`src/cli/batchFetch.ts`) mirrors Python delays/error streak cooldowns, writes back to video_db.json.
8. [x] Port export pipeline (type: feat) — combine per-video outputs into channel JSON/zip with identical naming/layout; tests: npm run lint && npm test; notes: `npm run export [channels...]` combines `video_data/<channel>/*.json` to root `<channel>.json`.
9. [x] CLI parity (type: feat) — wire npm scripts/CLI commands mirroring python usage (`node fetchSubs.js VIDEO_ID lang channel` etc.); tests: npm test cli.test && npm run lint; notes: help/usage flags added, CLI parsers tested, entrypoints guarded to avoid running on import.
10. [x] End-to-end regression (type: test) — run JS flow on fixture list and assert outputs/logs match Python baseline (allow timestamp tolerances); tests: npm test e2e.test && npm run lint; notes: e2e uses baseline fixture `-kq832Othh4` to validate fetch flow with stubbed network and output diff.
11. [x] Docs & cleanup (type: chore) — update README/Makefile, archive Python path, and document migration steps/parity status; tests: npm run lint && npm test; notes: README/.env.example updated for TS, Makefile points to TS commands; Python marked as legacy.
