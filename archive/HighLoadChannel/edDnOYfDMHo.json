{
  "video_id": "edDnOYfDMHo",
  "channel": "HighLoadChannel",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "привет С вами Андрей Смирнов и п+ 2024 и с нами Вячеслав Артамонов разработчик CR систем Газпром банк тех Слава привет Привет Расскажи пожалуйста немного о том Чем ты занимаешься в газпромбанке и о твоём текущем Проекте в газпромбанке Я занимаюсь разработкой аналитических РМ систем в частности это стемы которые анализируют данные с клиентов и могут таргетированной информацию которая нужна для банка в частности если рассказать чуть-чуть про архитектуру то это Java микросервисы ль база данных и реляционные базы данных выбрали Мы в качестве кэша используем ris ris очень хорошая система с неплохой отказоустойчивость но у него есть свои проблемы а что за проблемы в редисе и вы их как-то решали или будете решать та проблема с которой мы столкнулись она называется проблема больших ключей А мы решали её несколькими способами но для начала я расскажу тогда про проблему в газпромбанке проходит множество тренингов обучения персонала и Наши сотрудники проходят по определённому пути так скажем и проходят по одному алгоритму действий который вызывает у нас некие сбои в системе в частности они проходят по одному и тому же алгоритмическом пути связывая э клиентов друг с другом условно клиент один зашёл клиенту д эта пара связалась в редисе появляется запись 1 О Когда Этих клиентов очень много эта связь начинает очень сильно расти и мы получаем неконтролируемый рост нагрузки на нашу кэш систему в частности которую мы используем Дис как мы пытались решить эту проблему первая идея которая у нас была это создать тестовый стенд но мы быстро от него отказались потому очень трудозатратно и финансово невыгодно и наверное не очень честно к людям которые пользуются этим потому что хотелось бы их учить на реальною информацию в дальнейшем идеи были без архитектурных изменений Возможно или увеличить редис Но это проблема проблему не решила Потому что просто больше информации копила можно было создать решить её путём очистки редиса средствами редиса у него есть поиск больших ключей но это очень долго дорого для системы и невыгодно можно было анализировать растущие ключи с помощью реляционных баз данных как я сказал они тоже присутствуют Но это также не очень выгодно и очень дорого так как там многие миллионы записей а при этом Можно ли было решить например как-то на стороне вот этих самых тренингов То есть можно ли было их просто попытаться проводить не на такое большое количество людей а просто как-то их их структурировать кластеризованный рост нагрузки независимо от того какой кейс работает и нам нужно было найти решение которое станет достаточно отказоустойчивый и финансово выгодным для нашего банка А вы вот Каким образом считали вот у всех тех решений от которых вы отказались Вот эту вот финансовую невыгодно То есть вы их каким-то образом действительно прямо попробовали как-то там на тестировании на кого-то насколько вы их внедряли Или вы просто посчитали как-то там на уровне архитектурной схемы поняли что экономически это неэффективно и пошли просто дальше искать есть такое понятие как нагрузочное тестирование чтобы это некий этап когда мы не выводя в прот можем нагрузить нашу систему отличающейся от текущей системы соответственно Да мы пробовали как я говорил уже и тестовый стенд и попробовали очистку через дис попробовали очистку через базу данных это всё очень бьёт по перформанс и к какому В итоге решению вы пришли что вы придумали мы попробовали реализовать и реализовали систему которая называется кэш и Сай это некий двухуровневый кэш То есть у нас есть кэш на стороне редиса кокш на стороне монго когда клиент обращается в нашу систему запись проходит сразу же и в редис и в Мон db в редисе данные хранятся условно там день-два как нам удобно в монго же хранятся до 9 дней как это было раньше в дальнейшем запись идёт в кафку в базу данных и условно удаляет если условно произойдёт какой-то сбой удалятся данные из редиса из монго мы данные всегда сможем получить ничего не потеряем Какие преимущества мы с этого получили это в частности если коммуникация идёт достаточно быстро условно в течение там дня то мы не потеряли по перформанс потому что запись то есть запрос приходит в редис возвращается из редиса и скорость та же самая осталась А если же идёт какой-то рост нагрузки как тот кейс о котором я рассказывал либо уже прошло достаточно времени и данные из редиса удалились то запрос идёт в монго и из монго уже выходит да это по перформанс чуть-чуть помедленнее около там 15% но мы достаточно скажем так выгодно для себя решили эту проблему и финансово тоже положительно для нас сказалось А можно ли как-то например полностью уйти в монго полностью отказавшись от редиса или редис всё равно продолжает выполнять какую-то ключевую задачу ну каждая технология она выполняет определённые задачи дис он чем хорош он очень быстры угу он достаточно дорогой потому что он хранит данные в кэше но очень быстрый и если мы от него полностью откажемся то опять же всё будет работать чуть-чуть медленнее а так как системы все связаны мы чуть-чуть медленнее следующая система чуть-чуть медленнее и в итоге Для клиента это очень сильный спад будет Поэтому полностью отказываться от Диса мы считаем что не очень выгодно и вот эту прослойку между монго и клиентом Лучше бы оставить То есть это получается Несмотря на то что это две системы это всё равно быстрее чем если просто оставить одну монго Да Да А при этом Вот это какой-то идеальный вариант на ваш взгляд или при этом вы понимаете что это сейчас работает но вы всё ещё ищете например какую-то серебряную пулю Ну мне кажется идеальных вариантов не бывает то что сейчас работает оно работает достаточно стабильно и нас полностью устраивает Ну если в дальнейшем появится какой-то ещё кейс который мы не возможно не предусмотрели то уже будем развиваться может быть в какую-то другую технологию но на данном этапе все проблемы полностью решили Если вы будете дальше расти то как-то оно горизонтально масштабируется Может ли возникнуть в какой-то момент проблема что даже монго уже с нагрузкой и с какими-то тренинга на десятки тысяч человек уже не справляется чисто теоретически да Это возможно но нужно понимать что расширять монго гораздо дешевле чем расширять дис дис хранит информацию в кэше в оперативной памяти монго же хранит на диске и расширять дисками гораздо проще и также когда мы будем понимать что условно какая-то конференция условно сильно забила на Шмон мы удалить эти данные полностью и обратиться уже в базу данных реляционную то есть да это будет Помедленней но отказоустойчивость система полностью будет сохранена на будущее какой вообще оптимальный путь взаимодействия вот кэше с нереляционные базами данных ты видишь То есть например вот придёшь ты на какой-то там новый проект или вот нас зрители посмотрят и как им предвосхитить вообще такие проблемы какую систему но я думаю что для начала нужно полностью продумать кейс работы с вашей системой То есть как условный Клиент будет взаимодействовать с вашей системой и Какую нагрузку На каком этапе будет создавать в данном этапе мы не просчитали этот момент но будем говорить Он очень такой узконаправленный возможно имеет смысл ещё на этапе архитектуры продумать вот этап обучения возможно но сам по себе и монго в качестве кша очень хорошее решение то есть вполне можно использовать скажем но можно ли при этом всё заранее просчитать или на твой взгляд Я думаю заранее просчитать всё невозможно Каким образом тогда подойти или просто подходить как-то а потом всё-таки реакционны методами придумывать что-то в моменте Ну реакционные методы это ВС же мне кажется критические случаи которые желательно избежать нужно всегда как я сказал уже подходить Сначала мы продумаем архитектуру потом уже делаем скажем так технологию Да внедряем нужную нам а и также учитывать финансовую стабильность условно насколько мы можем как я сказал что дис он достаточно дорогой и расширять его дорого Возможно стоит вообще отказаться от кша если он вам не нужен и использовать реляционную базу данных она в принципе тоже достаточно быстрая Слав Спасибо большое за рассказ как вообще работать с с редисом и вот это вот всё с вами был Вячеслав Артамонов Я ведущий Андрей Смирнов пока-пока"
}