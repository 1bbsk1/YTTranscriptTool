{
  "video_id": "-6iWRYkeF14",
  "channel": "HighLoadChannel",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "мы продолжаем И следующий докладчик Александр Попов из ВК Cloud расскажет себе расскажет про сам себе вендер про внедрение епн ВК Cloud он сейчас объяснит что имеется в виду и встречаем Александра аплодисментами Всем привет Сегодня будем говорить об облаках о сетях в них ине в целом тема такая до хардкорная но я попробую рассказать популярно простыми словами Да чтобы Даже те кто с этим не знаком поняли и начнём Пожалуй да Ну сначала начнём с того А в каком облаке вообще дело всё происходило мы ВК Cloud да одной из облаков на рынке соответственно большой Спектр там и а услуг па услуг maret куча всего наши рекламщики вот очень старались этот слайд рисовали но ящик биноклей приложили Поэтому если вдруг кто-то нас не знает и не смог ничего тут разглядеть Приходите на наш стенд мы обязательно про нас расскажем вот я в ВК Cloud Ну Достаточно давно почти с самого начало вот всю эту историю которая происходила про которую я буду рассказывать я застал целиком Да я начинал там с позиции админа Да отдела эксплуатации потом Меня перевели в разработку в инфраструктур и степенно я дорос до тех Лида команды разработки сети инфраструктурной сети Да я не сетевой инженер я сразу говорю что будет рассказ с позиции команды разработки но мы постоянно с ними консультируем и вот находимся на стыке Да я со стороны разработки соответственно сетевые инженеры их архитекторы Со стороны нока к для тех кто не знает это NW Operation C эй это То от чего Ну уже никто не может отказаться если несколько лет назад ещё Все думали идти в облака не идти в облака то сейчас идут все как бы выбора-то особого нету все вот экономическая ситуация такова Ну а для тех кто облака создаёт это означает одно это означает что ты постоянно растёшь Если ты не растёшь растут конкуренты выдавливают тебя с рынка а соответственно растём это мы увеличиваем свою инфраструктуру то есть говоря простыми словами мы ставим новые сервера на которых крутятся виртуальные машины клиента и тянем к ним сети Вот про сети мы и поговорим а как В целом устроены сети в ВК Ну точнее Да в его проектах А вот ВК Cloud как один из проектов внутри ВК снизу стоят обычные сервера на которых крутится нагрузка сверху набор коммутаторов который подключён к ядру сети и дальше там выходы в интернет не один выход как здесь нарисован понятное дело много вот коммутаторы объединены в топологию которая называется сеть Лоза Да вот у меня здесь двухуровневая нарисовано но там в зависимости от количества подключённых серверов в общем и целом это достаточно современная Такая сеть Ну наверное она достаточно популярна сейчас у многих такая есть но у нас есть одна особенность Да и наша особенность заключается в том что у нас сервера на которых крутится нагрузка клиента включаются не к одному коммутатору а к двум для чего это сделано Да Несмотря на то что многие говорят про CL native подход и что типа виртуалок может умирать ваше приложение должна работать но клиенты которые приезжают в облако они смотрят на Виртуальные сервера точно также как на реальные и соответственно если умирает там или теряет связанность виртуальный сервер нам пишут техподдержку ВМ дуют а Понятное дело что железо в том числе коммутаторы но оно выходит из строя да и с этим ничего не поделаешь там нужно софт обновлять ещё что-то и вот чтобы это всё не аффектив в самом начале создания облака была принята такая схема Но вообще в начале всё было на очень маленьких таких этапах Как скажем так сказать словами известными у нас было одна стойка с серверами два коммутатора Cisco Nexus и Open версии аката последний на тот момент это был 2017 год не то чтобы всё это нужно было Для того чтобы строить отказоустойчивый прод Но если уж ты решил строить облака то иди в своём увлечении до конца Единственное что меня беспокоило это ок поставить Ок на такую современную сеть но вот те кто с ним сталкивался наверное поймут о чём я говорю да там двойное подключение к том L 3 на то вот эти все вещи с оком очень сложно совместимы поэтому у нас были проблемы у нас в начале был у облако один админ один разработчик соответственно силы ресурсов для того чтобы совместить ту сеть которая есть у нас соответственно не было да чтобы переделать как-то ок то есть в чём основная проблема Да основная проблема в том что у нас подключение к двум разным коммутатора вот можно объединить в так называемый Это технология известная наверно уже больше 30 лет она просто вот позволяет сделать виртуальный интерфейс такой общий из двух физических разных Но для того чтобы её включить должна быть поддержка со стороны оборудования и с другой стороны должно быть одно оборудование Да один коммутатор А у нас два Вот такая проблема мы можем включить и соответственно Open заставить работать с двумя соединениями Мы тоже не можем мы пошли в отдел нока и к сказал ну то есть сетевым инженерам да Ну у вас же тут два коммутатора Nexus давайте мы на них включим всем известную технологию которая называется cco vpc viral Channel Что делает это технология если вот совсем на пальцах Она позволяет объединить два разных физически коммутатора один логический Ну а раз у нас один коммутатор то всё просто Да мы собираем тот самый Link aggregation Со стороны линуса это технология почему-то называется Bing не Link AG Вот Но она известна там тоже очень-очень давно с ядра а версии 2.0 Ну и после этого фактически схема с двумя коммутаторами Да превращается в схему с подключением к одному такому виртуальному коммутатору и вот эта проблема ушла Да И вот надо ещё поговорить об одной важной вещи в Облаке Да есть как бы сервера есть фабрика из коммутаторов и есть sdn sdn - это вот неотъемлемая часть облако Что такое вообще sdn расшифровывается как Soft Def Network и если на пальцах то это набор софта который обеспечивает собственно говоря виртуальную сеть для вот виртуальных машин Да это у амазона это Например vpc называется ну там У Много у кого по-разному Ну в общем и целом вот эта технология можно сказать Что обеспечивает она строит между серверами туннель и именно через эти туннель связываются между собой виртуальные машины Да это если вот упрощенно совсем рассказать то есть виртуальные машины подключаются к СД А сдн уже дальше строит тучи между серверами и они ходят через фабрику из коммутаторов хочется сделать такую небольшой вот пояснение Да мы сейчас будем Я дальше буду много говорить слова L2 L3 или второй и третий уровень И вот я говорю про второй и третий уровень сетевой модели да то есть всем известная наверное сетевая моде я буду говорить про второй и третий уровень я нам для тех к не помнит Да что такое второй уровень это уровень где у нас уровень Где работает протокол znet адресация идёт по ма адресам соответственно есть всегда только один путь движения трафика если есть кольцо то это всё это конец для сети там будет широковещательный трафик бега бесконечно уровень L3 - это уровень Где используется IP адресация и там как раз Возможно несколько путей к одной точке они там может быть равноценные неравноценный но возможно несколько путей и именно вот поверх IP как раз работает весь интернет То есть L2 и L3 - это уровни Да но Давайте возвращаемся к облаку и хочется сказать что почти с самого начала у нас были такие крупные клиенты да А как крупные клиенты заезжают в облако у них есть уже какая-то своя инфраструктура они берут часть её выделяют и говорят А мы вот эту часть запустим на облаке Но между понятно дело что Нельзя просто так взять и отделить часть инфраструктуры Да надо связать то что мы отделили то есть надо связать с облака с существующей инфраструктурой Да и строить там какие-то пины через интернет никто не хочет крупные клиенты хотят прям бросить непосредственно вот свой провод да То есть как это происходит Вот есть у нас наша сетевая фабрика да там сервера СН работает на них виртуальные Маши есть какая-то инфраструктура клиента договор ставит своё оборудование там коммутатор маршрутизатор не столь важно да в дата-центр Где находится наша точка присутствия где вот протянута наша фабрика да Или это может быть не оборудование клиента А например оно арендованного из операторов связи и потом через сетевую фабрику до нас этот трафик доставляется уже до СД и там дальше он попадает в виртуальные машины исторически так сложилось что в большинстве случаев наши стыки выполнены на уровне L2 то есть на втором уровне Да там даётся какой-то воланчик обычно и мы соответственно его уже добавляем на сервера Вот примерно в такой ситуации Вот в такой схеме сети мы развивались развивались развивались Достаточно долго пока в один прекрасный момент да В марте двадцать второго года все не увидели Вот такие новости что компания циско больше с нами не работает а что это для нас значит да Ну понятно дело что у нас всё построено на циско и их по притарней технологии vpc Но те коммутаторы которые у нас есть Ну они как работали так и работают никуда не делись Но мы же постоянно растём а новых коммутаторов для того чтобы расшириться по такой же схеме То есть у нас есть какая-то vpc пара она подключается к серверу и дальше там включается AG Да и через уже этот шнурок всё выводится наружу Но к этому моменту у нас уже была и команда разработки которая там и SN могла попат и ещё много всего сделать И для нас Те проблемы которые 2017 и мы решили что без vpc в принципе мы тоже можем жить да А как А очень просто вот у нас Разбираем vpc пару соответственно бондинг у нас со стороны линуса тоже разбирается потому что он не работает с двумя коммутаторами дальше мы назначаем так называемые lal адреса Да разные на каждый из этих интерфейсов таких независимых подключения со своей собственной адресацией а дамы в ции прописываем два дефолтных маршрута и ядро линуса оно само распределит каждое там соединение в соответствии с кэширования роун в свой интерфейс То есть у нас tcp соединение разложится Примерно там равномерно между этими интерфейсами но Понятное дело что с двумя интерфейсами и с дще адресами работать неудобно тоже жду нами и коммутатором и для того чтобы все остальные могли к этому серверу как-то удобно обратиться Да мы заводим единый IP адрес вешаем его такой на дамми интерфейс и дальше этот адрес анонсирует через протокол динамической маршрутизации вот здесь нарисован bgp но там есть ещё другие варианты чаще всего bgp используется Да соответственно если один из а интерфейсов откажет да Или один из коммутаторов откажет то всё продолжит работать через второй а соответственно сетевое оборудование очень быстро узнает о проблеме потому что один из анонсов Соответственно по bgp он погаснет но вся схема про которую мы рассказали она не подходит к ситуации со стыками Почему Потому что схема эта работает через L3 А вот стыки у нас сделаны через L2 ич это ВС один провод как бы со стороны сетевой фабрики он замыкается на там через клиента со стороны с он замыкается через Open и у нас получается кольцо да то есть и с этим кольцом непонятно что сделать потому что как бы L2 и3 они живут вра есть свои собственные инструменты но в лучшем случае эти инструменты позволят нам отключить просто один Интерфейс Да вот мы один отключаем и как бы смотрим туда-сюда но отключение одного интерфейса - это значит ну потерять половину пропускной способности что в общем не очень хочется вот мы после этого всего как бы всех этих историй задумались А как вообще нам трафик доставляют ноки потому что в схеме лоза избыточность - это нормальная и то есть вот коммутаторы они соединены с избыточностью АК есть дополнительные какие-то пути а ноки к нам как-то трафик нормально доставляют клиентский Да по L2 и у них Такой проблемы нету Мы пошли к ним и спросили А как вы это делаете они сказали а мы делаем это очень просто у нас там внутри evpn Ага есть некоторое количество А теперь А кто знает что такое просто VPN Да в наши Непростые времена наверное очень такая популярная история Да А давайте вот а давайте вот от VP и пойдём да то есть что такое VPN это какой-то сервер VPN у которого там со своей стороны есть какая-то сеть Да и клиент VPN они обычно соединены все через интернет и собственно говоря Вот сама технология VPN - это туннель через интернет Да через который идёт трафик между вот этими сетями туннель Может быть шифрованный там не шифрованный Не суть важно суть суть в том что это туннель да А давайте теперь пойдём немножко дальше И вот попробуем её мысленно так сказать расширить эту схему Да вот такая схема возможна Ну наверное Возможно да в принципе Она одна из стандартных как бы один VPN сервер к нему подключается несколько клиентов в данном случае два всё штатно работает А если я хочу вот такую схему сделать Ну если я наверное заморочка понастроили и сервера то в принципе я могу заставить трафик ходить вот в этой схеме если поза морава А как вы думаете Вот такая схема возможна Да вот что я изменил я сделал из каж из точек подключений она стала не клиентом и не сервером а всем вместе да м то есть точкой входа в некую такую VPN сеть вот ну наверное мы тут много есть да разработчиков абстрактное мышление развито наверное можно представить что мы в принципе из одной схемы к другой перейдём А теперь давайте ещё даль пом чу чтобы эти эндпоинты сами между собой обменялись информацией о том а где кто Находится какая там клиентская сеть Где находится Да пусть они друг другу это расскажут И у меня всё будет просто работать я подключился к этой сети и сразу могу всех остальных понго Вот и собственно говоря вот эта технология и есть evpn Почему Потому что трафик заворачивается вя из называ вот обмениваются информацией Они между собой через bgp о том где кто Находится Да ну и на самом деле у него есть вот этого есть несколько важных свойств прежде всего он основан на открытых стандартах Я здесь привёл вот два основных да первый рассказывает про то как в Информ ка ли как трафик ВН засунуть но стандартов на самом деле больше и там очень много всего этот зверь умеет вот работает это всё поверх любой L3 сети то есть прямо можно сказать поверх интернета будет работать Нола трафик он без шифрования надо это понимать он как бы просто заворачивает в туннель и самое главное свойство что все примерно протокол реализует одинаково То есть можно взять оборудование там циска оборудование джунипера соединить между собой через evn и оно будет работать там Конечно есть У каждого какие-то свои особенности но в общем и целом оно будет всё нормально работать да и я тут много упоминал такие слова как bgp Да но не знаю насколько все знают на всякий случай уточню Да что такое bgp вообще Вокруг этого протокола очень много прям такой мистики некоторые этот Там многие говорят что это протокол на котором построен интернет ещё что-то Но если посмотреть на эту технологию с позиции разработчика то это просто протокол по котором передают данные вот э нам нужно передать какие-то данные например сетевую информацию Мы там берём засовываю в этот протокол Он передаёт на другую сторону Да у него есть некоторые особенности в частности мы следим за соединением и если оно порвалось соответственно то данным перестаём доверять Ну в общем и целом это просто один из протоколов передачи данных давайте отступление как бы закончили да и вернёмся к нашей ситуации вот у нас есть evpn vl то есть такая сеть она растянута как раз по сетевой фабрики к нам она спускается но наличие этой технологии оно нам никак не помогает потому что дальше с коммутаторов у нас собственно говоря идт тот самый иуе потому что идт петля дальше Вот и после разговора с номи Ну нам стало очевидно Да вот я думаю большинство уже догадалась что нужно сделать для того чтобы убрать эту петлю надо просто притащить на сервера но сервера - это обычные Linux сервера не сетевое железо где этот ВП реализован вендем Да ам для того чтобы это работало поверх линуса нам нужно сам и программный да то есть не железный какой-то не аппаратный вот программный Ну Звучит достаточно амбициозного сделать две вещи нам нужно принять и просто рассказать о нужных нужную информацию через bgp и в принципе пос Мы давно облако Рава инструментов Open хорошо умеет работать сном он у нас постоянно работал и до этой истории сном gop такой вот известный орны bgp сервер Он отлично как бы с ним можно отлично договориться через и по анонсировать всё что нужно там через bgp вот три таких компонента Собственно сам саму программу которая которая рассказывает нужную информацию Мы не стали заморачиваться назвали её просто конектор да она настраивает и Open Switch и gop ставится вся эта Троица Да на обычные сервера и со стороны соответственно сетевой фабрики она подключается там вот к новский втм Да а с другой стороны со стороны серверов она подключается к сд sdn как раз к нему подключает все виртуалки он о них знает самое самое главное Да и он может evpn коннекто рассказать о том где Какие виртуалки располагаются Ну и трафик этих виртуалок тоже может доставить мы тут не сильно заморачиваюсь по одному на каждого клиента А в этом файли описаны все собственно параметры этого клиента Да evpn конектор их потребляет а то есть сам evpn конектор внутри себя работает благодаря такому паттерну Вот который называется recell loop да то есть сейчас Я примерно приведу пример как бы Как это работает то есть первым шагом мы считываем все конфиги клиентов которые для нас нагели да вторым шагом мы из этих конфигов подготавливаем актуальные анонсы Да которые мы по bgp расскажем дальше мы эти анонсы синхронизирует все существующие анонсы Да которые у него есть потом сравниваем с нашим списком и смотрим типа лишние есть в Go GP если есть лишние которых в нашем списке нет мы их удаляем Да есть какие-то не вающие нею Вот и после этого мы получаем список уже актуальных анонсов да и из этого актуально из этого списка актуальных анонсов мы Гене так называемый ф - это правило обработки трафика внутри овы сча для тех Вот кто с о счм не знаком у него можно внутрь помещать такие правила по которым будут обрабатываться трафик Ну и см собственно говоря также правила обработки трафика с Open Ну а дальше мы снова выходим на первый цикл И вот так вот в бесконечном цикле Мы крутимся ещё раз повторюсь что этот вот принцип Да архитектура так сказать построения система называется recc loop Если вы хотите побольше про Rec узнать вообще про что это такое мой это Да в бангалоре Приходите послушайте но это не про evpn конек а именно про принцип проектирование приложений Ну давайте пойдём чуть-чуть в детали да о том как мы всё анонсы в bgp засовывая на самом деле задача не очень сложная как оказалось она такая чисто Инженерная читаем документацию видим что мы должны сгенерить два вида анонсов Да tye 2 так называемый это когда мы рассказываем как Где находится Мак клиента За каким адресом какого сервера и Type 3 это мы просто рассказываем IP адрес сервера и говорим что весь широковещательный трафик этой виртуальной сети отправляй вот сюда в эту в эту точку Да потом мы и мы соответственно все конфиги Превращаем в Type 2 и Type 3 анонсы да то есть каждый конфиг превращается вот в о Type 2 и о Type 3 ну поскольку у нас в пределах одного гипервизора то есть одного вычислительного узла может быть несколько клиентов находящихся в одной и той же виртуальной сети то у них Type 3 анонсы будут одинаковые вот абсолютно одинаковые мы их соответственно просто лишние схлопывается Да в отличие от генерации Flow для Open свича вот эта задача была простая Вот но чтобы понять А в чём сложность генерации Фло надо посмотреть А как вообще внутри evpn сети должен ходить трафик вот с точки зрения отношений как раз между несколькими вми Да вот тут вот три впа нарисовано один локальный для нас да на котором evn конектор работает и два удалённых на которых тоже работает вот с каным трафиком то есть трафиком который идт конкретному клиенту тут всё просто поскольку мы знаем все Мак адреса и где кто Находится мы просто трафик нужную точку отправляем юникаст трафик - это одна сторона медали А есть весь остальной трафик кроме юного Да вот или мы не знаем мадрес назначения это так называемый unown unicast Или это у нас мадрес назначение широковещательный там или мультикаст ещ какой-то адрес Вот это весь устный трафик Он уже работает немножко по-другому Да мы его должны отправить всем клиентам потому что внутри EV работает такая технология которая называется ination соответственно мы должны сребро то есть умножить пакетик который мы отправляем вот столько раз сколько у нас есть клиентов Да ну тут кстати есть вот сложность Я не знаю если Никто особо счм не работал то я могу сказать что он ну не даёт так просто умножить эти пакетики вляется и ставит там палки в колса Но вот в случае когда мы отправляем с локального тут всё выглядит просто да А вот когда мы к нам приходит удалённый трафик то тут уже в этой схеме репликация происходит в двух точках сначала удалённый сервер размножить пакетики по всем втм Да а потом уже к нам когда Этот пакетик придёт мы должны его размножить по всем локальным получателям то есть здесь она жда в двух разных и нам Пришлось написать целый алгоритм для работы в оново свиче Да чтобы это всё так сказать привести к одному виду алгоритм вот звучит так первым шагом Ну мы смотрим на весь ходящий трафик Да и э его маркирует первый признак - это принадлежность к конкретной виртуальной сети а второй признак - это локальность к нам он пришёл с с сети то есть с какого-то удалённого порта или от нашего собственного локального порта Ну с юным трафиком ВС просто знаем где мадрес получение отправляем туда там либо локально либо удалённо навешивается всем своим локальным клиентам то есть бум - это как раз вот тот самый не устный трафик UN Илька А если этот трафик пришёл с нашего локального получателя то мы его отправим всем локальным получателям кроме того с которого пришёл Понятное дело и всем удалённым получателям тоже Ну я не буду подробно опускаться в детали того как это работает внутри потому что там дальше начинается такая Техно Как там регистры всякие Фло обработки трафика респонс между таблицами куча всего кому интересна Техно Приходите ко мне в кулуарах поговорим там спустимся до самых низов в целом работает оно как-то так Вот давайте резюмируем что у нас получилось Ну поскольку мы большинство своего софта пишем на питоне Да и как бы весь на питоне написан вот у нас много очень экспертизы в написании на питоне много там всяких готовых библиотек мы соответственно эту штуку тоже написали на питоне потому что пакетики клиента она непосредственно не перекладывает только управляет Да теми кто перекладывает соответственно производительности питона хватило Ну а поскольку это питон то там всего 1500 строк кода получилось вот достаточно быстро Мы это как-то с именно на венных решениях каких-то вместе это запустили с C с с Huawei в принципе нормально всё работало не было каких-то особых проблем Ну благодаря тому что открытый стандарт как раз потащили это в прот и все новые клиенты вот новые внешние стыки мы уже делаем нане но старые стараемся перетаскивать Единственное что это как бы слож немножко бюрократический процесс Да он идт не Быстро давайте уже резюмируем да что в итоге можно сказать про всю эту историю Ну если вы строите какую-то сеть да то Старайтесь использовать открытые стандарты честно будет не так больно да и опять же берите сетевое оборудование разных вендоров сразу это сразу отрежет как раз использование всяких там проприетарный А их пря очень хочется использовать дано это Если вдруг чего-то не хватает Ну не так страшно написать это своими руками конечно для того чтобы написать это своими руками но стоит познакомиться хотя бы с инструментами которые есть в орсе там это и какие-то например и Open и там прочи прочие таки готовые инструменты Ну тебе нужно написать просто небольшой кусочек логики да то есть это сделать достаточно быстро вот мы за 3 месяца справились в принципе и это не какой-то там Rocket Science на этом У меня всё спасибо за внимание жду ваши вопросы Ну и голосуйте за доклад так мне тут доложили то что тут будет Два подарка за лучший вопрос один от нас один от вас Поэтому ты сейчас будешь слушать вопросы отвеча на них записываю себя в голове информацию о том Какой вопрос тебе понравился больше точнее два вопро Да и Постарайся чтобы это не было два последних вопроса потому что это будет выглядеть подозрительно хорош Скажите пожалуйста для чего использовался vxl в вашей схеме была ли у вас потребность обеспечить L2 связанность для ваших клиентов которые могли быть подключены к разным точкам Когда вы показали целевую схему кажется что на первый взгляд кажется что там избы и эту схему можно реализовать при помощи любого туннельного протокола и и любого протокола динамической маршрутизации того же ну смотрите нужна не протокол не протокол точка точка а протокол точка много точка Потому что L2 сеть она точка точку Ну самый популярный - это vxlan вот если прямо вот глубже копнуть в эти оверлей сети да то наверное кроме влана Там ну есть ещё mpls и VPN и прочее Но это всё больше сетевое оборудование такое pls - Это не совсем VPN А в данном случае l2tp например мог реализовать Кажется Точка ноготочками одна точка связывается С с многими точками понимаете свам L 2tp п Rad War Ну вот э с этим не работали То есть у нас просто vxlan и до этого использовался постоянно внутри облако между виртуалка собственно говоря оно в vxl не используется evpn опять же это стандарт вместе с кланом Да мы просто не меняли эту вещь Понятно спасибо Дмитрий утех а очень интересный кейс но такой вопрос вот насколько мне известно любой цдо коммутатор который Ну применим в цоде он вполне умеет популярную технологию мультилак лак которую циска и назвала vpc Почему собственно нельзя было пойти путём эксплуатации имеющегося решения Ну просто уйдя на другой вондера притом Они могли существовать ведь одновременно так как Ну часть осталась бы на vpc часть на mlock вот Хороший вопрос Я задам вам сразу Вопрос такой не убирайте микрофон А вы пробовали совместить ML например джунипер и например Huawei между собой потому что нам нужна связанность между этими сегментами или vpc с лагом между собой а и vpc в mlag в данном случае существует между паре коммутаторов к которым сервак подключается у вы всё так просто не всё так просто к сожалению оно не в паре оно дальше там ВС целиком в Один vpc объединено потому что это связано с тем как они там дальше выдают Ну это немножко ноко вя кухня Да я заползаю но суть такая что ноки всё это вместе в Единый vpc объединили и строить соседнюю как бы вещь из лагов Да и соединять их между собой не было возможно на сетевом оборудовании мы это первую очередь рассмотрели конечно жете пере что вы шутите аргумент ног не согласился принят Спасибо Спасибо большое Очень классно когда мы Решаем покинувших проблему покинувших часик производителей самостоятельно это вообще всегда прекрасно два вопроса будет первый вот не увидел ничего облаке и есть всякие истории когда некоторые пакеты должны быть равнее других и второй вопрос как Что делаете с потенциальным флу дом Маков через BP когда просто будет какая-то проблема у клиента и эти маки начнут ползти в анонса и тоже кон вос никакой явной поддержки коса в этом месте нету в принципе на самом деле вот В текущей ситуации пропускной способности интерфейсов Там две двадцать пятки нам хватает у клиентов просто ну банально Не хватает процессора чтобы загрузить две двадцать пятки вот поэтому всё нормально и тут кос пока вот не заморачиваешься что мы стараемся ставить Анде на границах вот этой evpn сети и не пускать лишний лишний Ну Ар который мы уже знаем да а Отвечать на него сразу вот спов буквально то есть вот такая вот схема и плюс там есть ещё поддержка каких-то технологий ну эти же стыки они стыки между нами и оборудованием да и у оборудования есть поддержка каких-то технологий на эту тему чего-то там такое тоже происходит но я уже не помню эти детали Спасибо пожалуйста Спасибо за доклад Меня зовут Александр у меня такой вопрос Вы заменили А вы не планируете заменять пока его производительности хватает Ну и к тому же там все остальные вот сети некое они тоже поверх и построе Просто он строится от сна к сдн там не нужно поддержку открытого стандарта чтобы его соединять с оборудованием и не смотрели ли какие-нибудь же варианты на замену нет Ну пока Нам производительности сотового оного свеча хватает в принципе мы не рассматриваю тут Да спасибо за доклад Влад Одинцов кро Cloud ты говорил про проблемы с Open Switch С обработкой трафика что он плохо нот пакеты можешь чуть поподробнее рассказать Что за проблемы это первый вопрос и второй вопрос чуть-чуть про другое вот демон который делает Rec раз он управляет лоуми и ещё фуми на Хосте у вас управляет СН контролер не было ли у вас каких-то проблем с тем что Два повара на одной кухне Да давай я расскажу значит начну со второго вопроса да про то как мы это разруливает овы свича разделяются то есть там внутри Open свича есть так называемые виртуальные свитки Да бриджи их можно создать много и в каждом из них будут свои фу и мы для вот работы evpn коннектора делаем один бриджи а sdn создаёт себе другой бриджи и поскольку это разные бриджи то фу никак не пересекаются и тут нету Ну им нечего делить между собой да А теперь про проблемы с овы свич на самом деле Здесь проблема такая она немножко глубже проблема называется такая сетевое оборудование в целом не любит умножать пакетики Почему Потому что это дорого это не операция там оза единицу Да в идеале к нам пакетик пришёл мы его ну мы его просто тут же отправили как бы там чуть-чуть поменяли а множить его это соответственно операция о от N и нам нужно прямо начинать копировать память в сотовых сетях это соответственно всё ещё дороже Да мы начинаем копировать память и вот у нас соответственно Open Switch работает таком самом простом варианте Да на операционной системе то есть пакетики у нас перекладывают ядерный модуль о Свеча и вот оказалось прям при тестировании что этот ядерный модуль не умеет множить пакетики больше чем на 1.000 вот 1.000 клиентов Всё э как бы он дальше не множится Дальше он это передаёт users Space уже демону а овса овсова Switch D и Этот демон Тоже имеет ограничение он медленно-медленно поскольку у нас там связь между ядром и юзер Спей множить эти пакетики до 4.000 а всё остальное он бросает на пол Вот ты ему там сказал у меня 10.000 клиентов которым надо умножить Этот пакетик он размножить первым четырём и чтобы решить эти проблемы пришлось вводить прямо ограничение на размер вот этого сегмента на количество клиентов Да который может быть в пределах вот этой сети как раз чтобы не упираться ни в ядерные ограничения ни Здравствуйте на потребление ресурсов при использовании капсуляции vxlan Ну сравнивали с чем э с вариантом без vxlan А у нас нету вариантов без Лана Вот это основная история понимаете смотрите через vpc трафик ходит тоже в Лане потому что как раз sdn между собой между серверами пересылает пакетики тоже завёрнутые в туннель и этот туннель как раз такой же в xlan просто vl можно строить по своим каким-то правилам а можно по описанным открытым стандартам и вот по умолчанию Open Да точнее его sdn Нейтрон он строит по каким-то своим собственным правилам и к этому Лану нельзя подключить сетевое оборудование А мы сделали де монок который строит их по правилам открытых стандартов Но это тот же самый vxlan у нас как был vxl между виртуалка он так и остался нам не не с чем сравнивать производительности overhead Спасибо я уточню предыдущий вопрос тогда некое непонимание появилось в в варианте с vpc вы на хост приземляется вопрос производительность влана против влана использовать ливы аппаратную разгрузку Я так понимаю вот про это был во конечно там T и прочее мы используем во всех ключах Но между ном иланом мы наверное не мерили потому что количество трафика через vxlan ну на просто намного кратно там больше через VLAN да то есть мы не можем на Лан ную схему откатиться Спасибо за доклад хотел бы поинтересоваться сть истори То есть вы говорили то что это всё тестировали на версии 2017 года Ока аката А сейчас у вас Какая версия Ока если это не секрет и Какая версия Нейтрона с этим связана Это первый вопрос из двух значит давайте скажу Так мы это не то что тестировали мы запускались на Оке версии аката но потом в процессе жизни мы на самом деле там Я не стал в тему с снами удаляться потому что она пря доклад бы не влез Но на самом деле мы Open С тех пор много попали и у нас уже не ака А что-то своё Да какая-то вот там какие-то патчи из астма какие-то мы там баги встретили сами починили потому что в астме до них не добрались или отказались чинить например да там куча вот историй и у нас можно уже Сказать свой собственный форк оека есть но если говорить вообще об сдх то мы написали свой собственный СН котом сечас Нейтрон заменяем я об этом ажно в девятнадцатом году рассказывал мы постепенно Да идём в замену на свой собственный sdn Ну и в Open sour он планирует появиться А да смотрите значит кроме вот СД Да который есть целиком есть ещё такая вот вещь про которую я как раз рассказывал про одного демоном называется evpn конектор его нужно с сном соединять Но вот сам evpn конектор мы начали осор Сить в августе чтобы к докладам успеть но не успели к сожалению большой бюрократический процесс сейчас оно висит где-то на юристах и мы его доведём до осор Ну а расскажем либо в следующий раз либо на хабре выложим статью и соответственно всё это покажем Вот сам конектор наш собственный Ну пока нету как бы никаких планов его за ясно Я так понимаю второй вопрос я уже не успеваю Да а он короткий и корот Да сейчас Ну прямо только очень короткий да очень короткий у вас э вот этот демоновика который доносит изменение конфигов он их доносит целиком или Ну как бы я как понял он доносит сразу собирает целиком то есть инкрементальные позицией он как бы синхронизирует целиком первый шаг от последующих шагов не отличается Ну то есть на оборудование на сервера там в ВВС он приносит это всё он да дополнительную нагрузку на процессор Если вы про это Говорите Да приносит дополнительную нагрузку на процессор но этот кейс Вот как раз Георгий рассмотрит Приходите завтра на доклад мы поговорим про про reconciliation loop и почему он такой тебе надо сценарий для сериалов писать ты такие классные клиф хенгеры делаешь то что вот не успели за опенсорс в следующий раз расскажу когда за опенсорс Приходите вот на доклад другому человеку стараемся ты молодец да да да типа вот скоро вот типа затра шку кинул и в следующий раз расскажу на другом докладе Окей так Мы закончили смотри два вопроса надо выбрать лучших постараться чтобы были не последние про эмлак и про проблема вот Андрей который ла я к сожалению забыл имя Вот вот сидит да лак Да хорошо А И вот про ИС крока да про проблемы в усе хорошо так Ага вижу пакет для тебя сейчас подожди я быстро вернусь Спасибо тебе большое за твои эти клиф хенгеры то что народ придёт ещё теперь в следующий раз на следующую конфу чтобы послушать всё-таки про то рли спасибо за доклад И сейчас мы уходим на перерыв А вы можете"
}