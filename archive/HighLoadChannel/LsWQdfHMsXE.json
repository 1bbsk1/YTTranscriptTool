{
  "video_id": "LsWQdfHMsXE",
  "channel": "HighLoadChannel",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Добрый день дорогие друзья Скажите Хорошо ли меня слышно Крутяк Итак да меня зовут Антон И сегодня я хочу вам рассказать о том как л помогает не потерять вашу пиццу Когда вы её заказываете В любимом приложении еды Ну в моём случае любимое приложение для заказа еды - это ум tore Итак немножечко обо мне а сейчас Я работаю На позиции Кэн разработчика опыта в бэнде у меня уже более 5 лет а провожу собеседование в go в систем дизайне А друзья Давайте немножко познакомимся Кто из вас проводит собеседование в систем дизайне Ну проводит проходит поднимите руку Вот супер То есть даже если вы в принципе не особо программирует Наго данный доклад вам пригодится просто чтобы знать ещё один инструмент для прохождения систем дизай собеседования Ну или просто проектирования О'кей немножечко у компании да ум tore - Это буквально единорог в сфере доставки еды это самый крутой сервис в Узбекистане который запустился год назад а в прошлом году мой руководитель Евгений конечный рассказывал о том как к этому пришли а сегодня мне хотелось бы вам рассказать о том как это выглядит глазами backend разработчика то есть вот у вас есть инструмент он стоит а что с ним делать как с ним взаимодействовать Итак начнём мы немножечко с архитектуры Дело в том что я люблю сложные системы погружаться в них узнавать как они работают Это позволяет проектировать новые системы в своей повседневной работе и строить их опираясь на то что уже есть далее мы с вами посмотрим как выглядит код всё-таки это го конф и хочется посмотреть немножко на код Мы это сделаем у есть фишечка Как происходит выполнение кода Это посмотрим сохранение состояния Да доклад всё-таки о том что мы не хотим терять пиццу и почему мы её не теряем тут же рядом стоит отказоустойчивость И версионирование бизнес-процесса сегодня я буду говорить слово workflow это означает бизнес-процесс А бизнес-процесс - это какой-то набор инструкций Как вы обрабатывается свои входящие заявки Ну то есть я понимаю что производства могут быть абсолютно разные вот в нашем Это доставка еды и в моём случае да там бизнес-процесс - это оформление заказа А моя входящая заявка - это сам заказ Итак мы хотим описать какой-то вот бизнес процесс в Мы в строим тех сервис и один из сценариев - это банально заказ еды пользователям вот я собрал корзину положил туда пиццу Нажимаю кнопочку оформить заказ и запрос поступает на зелёненький сервис зака заказы на самом де на самом деле это oms Order Management System которая как раз-таки является сердцем обработки заказов А что мы хотим сделать О'кей У нас есть заказ конечно же мы хотим заработать поэтому мы ходим какое-то количество денег а у пользователя а также мы хотим Отправить ему пиццу поэтому мы взаимодействуем с поставщиками Да это Например какое-то кафе они собирают заказ передают курьерам и курьеры доставляют конечному пользователю Окей одна из фишек у tore - это быстрая доставка еды на слайде о компании было написано что более 98% заказов доставляются в течение 30 минут чтобы это выполнялось наши бизнес процессы взаимодействия их хорошо бы как-то лимитировать по времени Ну вот сегодня мы рассмотрим такие тайминги на оформление заказа Мы выделим 10 минут на взаимодействие с каким-то платёжным шлюзом 20 секунд Ну понятное дело что платёжный шлюз это может быть например узм банк узум на сия рассрочка вот или какая-то другая платёжная система Итак для приготовления заказа у поставщика 20 минут и на доставку курьером 10 минут Ну тут понятно секрет в том что точки да где готовятся заказы Они недалеко от пользователя О'кей А у нас есть бизнес-процесс а мы хотим его а соответственно каким-то образом сделать а вот в нашей компании мы используем для описание бизнес-процесса иструмент temporal а по сути это оркестратор А что здесь примечательно это открытый Исходный код лицензия mit То есть вы буквально уже сегодня Можете зайти на github скачать репозиторий запустить dor compose и поиграться с примерами уже сегодня а temporal - это не разработка с нуля А свою историю он начинает 8 лет назад и родоначальник по сути Это cadence от компании uber насколько я помню в программе лода даже есть доклад про cadence вот О'кей А вот мы энд разработчики вот у нас есть какое-то техническое задание от нашего заказчика там от продукт менеджер Например нужно описать бизнес-процесс А бизнес-процесс мы будем описывать в коде то есть workflow S cod это концепт тела а и чтобы а Ну поскольку Да а мы описываем его в коде взаимодействуем с sdk тела а СДК под капотом взаимодействует с самим temporal сервером а temporal сервер может быть представлен как облачным решением Также вы можете его развернуть у себя Потому что опять же повторюсь это открытый Исходный код У нас например в у Зуме мы используем Self H отрешение Окей теперь поговорим про архитектуру Темпо чтобы у нас было дальнейшее понимание А как происходит вообще взаимодействие немножко окн сначала в инструмент то есть в temporal Север О'кей А базово можно выделить четыре основных компонента во-первых это frontend Service matching сес какие-то внутренние воркеры и history Service А поскольку Да я сказал что мы в ум tore используем sof H это решение примерную разбивку по подам Вы можете видеть на слайде на четыре вот эти сервиса мы выделяем по три пода А кроме сервиса history потому что history на самом деле это самый такой высоконагруженные сервис А который взаимодействует как раз-таки с базой данных тела и Весь вот этот стейт туда сохраняет О'кей пойдём по порядку а frontend Service это stateless Gateway То есть когда sdk хочет взаимодействовать с сервером А все запросы идут как раз-таки вот на этот гетвей То есть он отвечает за роутинг авторизацию и так далее а дальше идёт history Service это база вот history сес обрабатывает входящие команды команды могут быть как от приложения например Это запуск workflow так и от самих воркеров То есть у нас уже есть какое-то понимание что есть вот приложение а есть воркеры окей да как я сказал history Service хранит состояние бизнес-процесса таймеры и так далее ставить задачи в Чинг сервис это пока Может быть непонятно Но дальше разберёмся Что значит ставить задачи в Чинг сервис и отвечает за архивацию поскольку те предназначен для большого потока ваших входящих заявок да то есть в моём случае это заказы есть такой подход как хо код хранилища то есть мы хотим иметь какое-то горячее хранилища куда мы будем делать запросы селекти сохранять обновлять и так далее А есть ко хранилища куда уже отработанная заявка вот собственно his за это и отвечает да поскольку я сказал что у нас есть какие-то воркеры которые выполняют код спойлер серс как раз таки отвечает за постановку задач для этих воркеров Да есть внутренние воркеры это просто вот Ну да такой компонент действительно есть он отвечает за репликацию архивирование и прочие внутренние штуки То есть Вам нужно писать какие-то свои воркеры вот для ла там они есть из коробки Окей мы значит энд разработчики и в зоне нашей ответственности есть два компонента во-первых это Application под алике я буду понимать какую-то опиш на которую приходит запрос от приложения с там с моделью чека то есть с моделью заказа а также у нас есть temporal worker это те самые воркеры которые будут выполнять код нашего workflow У нас есть два Вот таких компонента в нашей ответственности далее мы разберём каждый компонент По отдельности что он из себя представляет И как мы будем с ним работать а а с другой стороны у нас есть temporal Север который как раз-таки состоит из тех самых четырёх компонент о которых я рассказал ранее Ну да четыре компонента и плюс ещё там есть база данных а у нас в Зуме мы сейчас используем например постгрес Также вы можете развернуть у себя например кассандру Окей как происходит Мы значит собрали пиццу у нас есть заказ и мы хотим запустить workflow или же наш вокер выполняет код workflow и тоже что-то происходит внутри в этом случае через frontend отправляются grpc команды на history Service и он принимает соответственно решения А какие решения он принимает он из команд генерирует события вот которые сохраняются в базу данных а также history Серви отвечает за постановку задач в очередь А зачем ставить задачи в очередь ну чтобы соответственно вокер вот этот рокер мог получить задачу и начать выполнение кода также факт того что воркер получил задачу это фиксируется в базе данных Окей А вот получается да мы сидим у нас два компонента пока не очень понятно как это с чего начать программировать это всё в нашем случае мы используем морей У нас есть часть которая буквально отвечает за опиш Да за запуск ошки А и есть часть которая отвечает за запуск воркеров Ну в данном случае это вот например у нас workflow процен Activity Processing это как раз те самые воркеры Вот м Окей как происходит запуск Ну банально проброс переменное окружение и буквально запуск всё в принципе просто и удобно А почему мы используем моно репозитории Вот как раз таки для воркеров и для пишки а будет ясно чуть дальше потому что Ну а кто уже знаком с темповом может быть кто-то проходил курсы какие-то Вот супер когда я знакомился с телом А я заметил что они как-то разделяют вот типа говорят у тебя есть воркер У тебя есть приложение там ещё у тебя есть воркфлоу И на самом деле получается что приложения и воркеры они шарят код workflow то есть код бизнес-процесса который Вы пишете и поэтому удобно использовать моно репозиторий и вот дорогие друзья Мы с вами уже приближаемся к коду а Надеюсь кто-то соскучился а нет не сразу О'кей значит чтобы перейти к коду нужно знать о некоторых сущностях Вот например активити Это базовая сущность в неё мы будем класть всё что связано например с какими-то внешними и интеграция где у нас есть не детерминированная логика где может что-то пойти не так к примеру это запросы в базу данных это запросы к внешним сервисам там http запросы и так далее а активити сами по себе мы понимаем что может что-то пойти не так и на активити из коробки налагается политика трав то есть они будут травиться и поэтому нам нужно понимать Ну вот у нас был платёжный шлюз Да мы конечно же обернётся раться и тут надо надо понимать что нам нужна идемпотентность потому что если её не будет у нас может произойти такая штука Как двойные списания то есть пользователь два раза а оплатит Да за свой заказ А как описывать активити Да банально делаем функцию описываем аргумент что мы хотим на выходе Ну и Да в нашем случае это просто Запрос к платёжному шлюзу если что-то пошло не так мы гиру ошибку и возвращаем окей да как я сказал у Activity из коробки есть Ош То есть Вам Вам как бы н разработчикам не надо писать какие-то обёртки для Трайв и прочие тамми там вы можете использовать оп Соответственно по бизнес требованием у нас был лимит 20 секунд Да вот на это взаимодействие мы ровно так и выставляем в наших опшен а также дополнительно мы понимаем что вот эти запросы они могут падать по каким-либо причинам и к примеру мы выставляем Вот пять попыток на ретрай А небольшой синтаксический сахар чтобы было удобно пробрасывается это всё опши нами О'кей Окей мы описали сущность которая ходит в платёжный шлюз теперь нам нужно научиться обращаться к этой функции для этого мы пишем новую функцию значит Create payment execute внутри мы будем запускать нашу активити что поскольку здесь есть нюансы того что это всё запускается на воркера А вот нам нужно использовать специальный метод sdk то есть мы не можем там напрямую вызвать Create payment мы должны вызывать её через обёртку то есть и через метод execute Activity туда мы пробрасывается синхронно Если вы хотите О синхронности вы можете вызвать несколько execute Activity они вернут фуру и потом в конце вы соберёте всё через опять же metet Окей ти Да мы поняли что это нужно для недетерминированный логики а что касается workflow А здесь мы уже будем описывать а сам бизнес-процесс А это происходит также с помощью СДК А из коробки предоставляется гарантия долговременного выполнения workflow Ну то есть понятно что там оформление заказа у нас 10 минут О'кей Но если Вы к примеру проектируется что-то вроде страхование жизни там машины и какие-то м штуки Когда у вас заявка может обрабатываться долго вот как раз-таки есть такая гарантия О'кей как мы посмотрели temporal поднимает поды поды можно гибко масштабировать это круто а и пользовательский код Он выполняет в он выполняется в среде пользователя то есть temporal не несёт ответственность за именно выполнение вашего кода Вот но он несёт ответственность за сохранение состояния Именно поэтому происходит взаимодействие из СДК на сервер Окей давайте опишем наш бизнес-процесс описывается он опять же функции пробрасывается Ну множество каких-то шагов Ну вот в нашем случае например Мы хотим Ну про взаимодействовать с платёжным шлюзом если что-то пошло не так мы хотим проставить статус отмены на заказ Если всё прошло успешно тогда мы регистрируем ашку платежа на workflow Мы также хотим накладывать некоторые оны по бизнес требованиям которые были в начале мы хотим сделать лимит по времени в 10 минут Окей так и пишем 10 минут а также мы пробрасывается смотреть воркеры чтобы выполнять О'кей описали мы с вами описали Activity теперь описали workflow нужно научиться запускать а запуск workflow а происходит с помощью метода execute workflow туда прокиды опш опять же функцию которую мы описали и собираем результат Аналогично методом toget то есть вот что важно понять вте Вы не можете там написать функцию и просто её вызвать вам надо именно вызывать её как бы вот в этой обёртке там execute Activity если это а и execute workflow если это ваш бизнес процесс Окей немножко подили Давайте теперь я расскажу как это всё выполняется выполняется это всё на воркера воркеры вам тоже не нужно писать самим воркеры уже реализованы на стороне СДК воркеры полят чтобы получить задачи для выполнения А что за задачи Ну это Например Activity workflow и ещё некоторые тоже могут быть О'кей воркеры по по мере выполнения кода отправляют команды в history Service чтобы зафиксировать грубо говоря тот стейт на котором они остановились А хорошо мы описали Activity м мы описали workflow То есть у нас есть бизнес-процесс там одна инструкция - это вызов платёжного шлюза Теперь мы это всё хотим запустить а воркеры реализованы на стороне СДК Поэтому нам чтобы их запустить надо просто инициализировать берём СДК значит инициализирует код workflow и код Activity То есть прокиды туда вот эти сигнатуры функций запускаем metod тоста и всё круто мы запустили воркеры то есть что значит что мы запустили воркеры теперь когда мы сделаем execute workflow наш workflow реально начнёт выполняться керами если мы не запустим воркеры Да execute workflow произойдёт Ну как бы код то выполнять некому ничего не произойдёт О'кей А мы посмотрели архитектуру посмотрели как с этим взаимодействовать Если вы энд разработчик А давайте теперь поговорим о том а что же с пиццей то есть вообще я в теме доклада обещал что мы её не потеряем Окей Сейчас мы остановились на том что у нас есть воркеры мы запустили приложение что происходит внутри Application наша ошка значит получила запрос взяла аргумент чета и сдела workation пробро в his как раз комак такна называется hist сохранил событие в базу данных о том что произошёл вызов workflow и нужно запланировать задачу чтобы вокер мог выполнять вот этот workflow Окей воке в свою очередь опрашивает очередь там есть задача воркер получает эту задачу и факт того что он получил задачу также фиксируется в базе данных потому что нам нужно соблюдать тайминги Если воркер как бы не успеет заснёт уснёт то мы будем считать что как бы это фейл Окей worker выполняет код workflow там код и мы доходим до вызова как раз-таки Activity похода в платёжный шлюз в этом случае нам нужно приостановить выполнение workflow и запланировать выполнение активити То есть со стороны воркера отправляется команда о том что нужно Ну я вижу активити Да её нужно запланировать её выполнение а супер history Service снова принимает эту команду создаётся событие о том что workflow приостанавливается и зада на выполнение а ой у нас снова есть Задача В этот раз нужно выполнить атике опрашивает очередь там для него конечно же есть задача факт того что он получает активити на выполнение также сохраняется в базу данных и начинает выполнять Ну Запрос к платёжному шлюзу допустим он там супер прошёл с первого раза успешно отправляется с воркера запрос о том что задача а завершена опять же всё сохраняем в базу данных и планируем задачу на продолжение выполнения нашего Work Окей опрашивает получает и ну в нашем случае там был один шаг с а окей мы допустим закончили да в нашем случае в этом и отправляется соответственно команда Complete workflow execution всё Это сохраняется в базу данных что завер теперь нам нужно планировать задачи на архивацию и а супер Я надеюсь никто не утомился смотря на эти стрелочки квадратики Да потому что я повторял много раз одно и то же Но на самом деле когда я начал вот разрабатывать steal я там из коробки идёт админка и то есть каждая Ваша заявка Да она видна в админке Вы можете на неё нажать и когда вы нажмёте вы как раз увидите вот такую портенко команд это как раз и есть те самые команды которые history Service сохраняет в базу Вы можете даже провалиться внутрь команды вы увидите слепок того что там происходило Окей как я уже сказал вот history Service - это сердце ла это штука то есть мы постоянно туда пишем кучу информации и по сути это такой получается а как с этим борется Temp Потому что если мы в систему постоянно бесконтрольно пишем это может привести к деградации уро есть ограничени ограничение на А 2 МБ ограничение на Work - это 50 Мб Ну или же 50 сся строк записей для workflow хорошо но если мы будем ограничивать входящие данные Это уже как бы лучше чем если бы мы не ограничивали но проблема времени всё равно остаётся Ну вот к примеру наша система уже существует 10 лет Да и мы туда постоянно пишем кажется что можем лопнуть Но на самом деле нет у как я уже сказал есть архивации вот по дефолту через 30 дней завершённая заявка которая завершила Да вот этот бизнес-процесс она будет перемещена в ББ Stage в виде Джейсона если никто не придумал вопрос Подумайте можно придумать интересный вопрос тут вот Окей отказ устойчивость А мы можем сохранять нашу пиццу в базу данных а что делать вот у нас же всё-таки есть что-то в зоне отно То есть это да и алике А что если у нас в дата-центре где это всё лежит вдруг выключился свет что нам делать Ну банально У нас есть чекаут там есть множество шагов и вот где-то здесь Work шёл шёл и оборвался то есть Просто выключился по какой-то причине у Temp поскольку Да мы работаем с СДК там уже есть реализация воркеров а также там есть реализация механизма То есть те ивенты которые сохранены в базу данных воркер их может получить и восстановиться до того состояния на котором он остановился Но если вдруг по какой-то причине события Да ну то есть команды события они не будут совпадать вы получите ошибку детерминизма что с этим делать на самом деле детерминизм - это Ключевое понятие именно для workflow Потому что при каждый запуск должен давать один и тот же результат при одних и тех же входных То есть если у вас был заказ он где-то там остановился и вы он как бы воркер снова воскрес и и накатывает события он должен получать ровно те же результаты что были и до этого вот чтобы проверять локально что у вас всё хорошо То есть вы пишете новый код Да добавляете в workflow что-то модифицируется и вы хотите понимать что детерминизм Да вот у вас локально сохраняется для этого есть утилита Темпо workflow чек То есть вы можете локально это проверять Вот а если же это у Вас случайно на проде Ну вы как бы увидите в админке что у вас workflow бьются с этой ошибкой вот их Ну там в админке есть команда Вы можете с этим пометьте получаться ошибка детерминизма - это добавление новых фичей Ну вот допустим сегодня мы обрабатываем заказ с помощью пяти инструкций да каких-то а завтра например Мы хотим добавить ещ две новые инструкции и вот этот Кер который ВС выполняет он получит очевидно конфликт конфликт команд которые он будет сопоставлять для этого новый код Да если вы добавляете новые фичи Вы можете использовать Get это по сути версионирование то есть по дефолту это ноль то есть вор который выполняет старый workflow он проскит ну потому что у него ноль а новый он там будет соответственно едини а также есть версионирование с помощью воркеров то есть ну старые воркеры обрабатывают старые там заказы новые воркеры будут обрабатывать новые заказы а также очень удобная утилита для тестирования поскольку я сказал что в админке хранятся события Если вы провались там будет J и вы можете на самом деле полностью по отработанному заказу выгрузить весь G вот с помощью тестирования Вы можете поддерживать как раз-таки отсутствие ошибок детерминизма Так Окей ключевой концепт вообще Temp он включает в себя несколько концепций несколько механизмов и самая главная основная Концепция - это durable execution вот всё что мы сегодня с вами обсудили надёжное сохранение состояния детерминизм обработка сбоев это как раз таки есть составляющие вот этого концепта а также у тела есть концепции инверсия выполнения Ну инверсия выполнения потому что код выполняется не на temporal Да а на ваших воркера так А в принципе могу сказать небольшой собственный опыт да то есть возникает вопрос А нужен ли вам temporal в принципе вот когда я работал в другой компании на другом проекте Я как раз-таки думаю что выбрать комун которая доста Ну в каком-то смысле это тоже оркестратор вот выбрать комун или temporal А в случае комун да вы описываете там свой бизнес-процесс в bpmn схемах это могут делать например продукт менеджера А в случае temporal вы описываете свой бизнес-процесс именно S код То есть вы пишете в коде и это достаточно удобно так на этом У меня всё Буду рад ответить на ваши вопросы Да и ребята обязательно Поделитесь обратной связью Я выступаю первый раз мне очень важно что вы думаете вот для своего развития Спасибо большое за доклад Есть ли вопрос в пожалуйста тяните вверх руку чтобы мы вас видели мы к вам подойдём с микрофоном задавайте свой вопрос чётко в микрофон микрофон держите урта это важный момент Ну а теперь давайте вопрос Меня зовут Анатолий РТТ Вопрос такой есть ли какие-то встроенные механизмы для компенсации выполненных действий при откате ели там слома посередине грубо говоря да супер спасибо за вопрос Вот как раз-таки я в прошлом году рассказывал про Саги Да как бы Саги легли в тел Ну банально вы делаете фр и пишете Что делать если что-то пошло не так ну потому что бизнес процес это функция Да если Ну вы словили панику всё равно как бы вот ну вы можете е Ну ладно паника плохой пример Да но да Через работаете Спасибо посмотрим на вопрос с левой стороны зала Привет Олег KFC такой вопрос Как вы делите ответственность между командами То есть у вас есть workflow который задействует несколько компонентов из разных доменов например разные команды вот какая команда его делает в рамках какой команды или какого сервиса он находится то есть отдельные какие-то фасады либо отдельный сервис то инициирует запрос и как активити лится то есть у вас вот акти например который дублирует ашку она находится локально в этом компоненте да то есть или активити который вызывает какую-то функцию в приложении да то есть пили команда которая пилит workflow И ещё один вопрос Какой у вас REN polic и ещё один вопрос У вас workflow умирает уже после того как заказ исполнен То есть как вы работаете с Фанда и с жалобами после того как оплата прошла чтобы было ограничение 10 минут соответственно То есть если он за 10 минут не выполнился он умирает правильно Да Большое спасибо за вопрос Хорошие вопросы а у нас temporal - это сервер он у нас есть вот у него есть поды и конечно же у нас есть несколько направлений У нас есть направление кастомер в котором я работаю также у нас есть направление partners это как раз таки те самые поставщики да действия с ними У нас есть направление операционки это как раз-таки курьеры всё что связано с логистикой вот А насколько я знаю о соседних командах например в логистике тоже используют описание бизнес-процесса как workflow и у нас у кастомер есть соответственно свои workflow Да несколько Как происходит взаимодействие а логистика просто ну посылает сигнал в наш workflow и мы его обрабатываем да так сори я рассказал не все фишки temporal Конечно у меня были бизнес-процессы там четыре штучки и и было пунктирное взаимодействие А в случае Темпо Вы можете взаимодействовать с помощью сигналов а то есть это по сути асинхронная штука Если вы хотите взаимодействовать синхронно то есть соответственный механизм апдейт вот а что касается зоны ответственности команд то Ну вот у нас у кастомер банально есть репозиторий ос там есть те бизнес-процессы которые к нам относятся А если Ну то есть вы сделали Work который выполняется выполнять определённые активити Да в в сервисах допустим другой команды но они например изменили логику работы да То есть вы это вы отслеживайте или она или команда до вас доки изменения Каким образом происходит синхронизация есть ощущение что это тема для дискуссии вам хочется прям поболтать и построить диалог сессия вопросов и ответов создана не для этого Поэтому я попрошу вас просто пройти сразу же после доклада в дискуссионную зону она находится слева от выхода докладчик туда обязательно придёт как только мы снимем с него микрофон и можно будет просто напрямую по взаимодействовать пообщаться и поразить эту тему потому что явно у вас не один вопрос и хочется обсудить это комплексно и собственно если кому-то ещ этого хочется это самая нужная Зона для того чтобы это делать сейчас давайте перейдём к следующему вопросу поднимите пожалуйста руку У кого есть вопрос поднимите её высоко я вижу на первом ряду есть вопрос Привет Антон С почином классный доклад вопрос Вот у меня предположим простой сервис который должен раз в секунду что-то делать или раз миллисекунду или там чаще или реже на какой вообще производительность могу рассчитывать и когда таска признаётся потерянной если нода не отвечает вот когда мы у нас оркестратор будет пробовать следующую ноду и будет ли он вообще это делать а сейчас сорри я плохо расслышал на самом деле то есть О'кей У нас есть какой-то сервис Да там он отвечает за секунду за миллисекунду и соответственно у нас есть но отвечает Я хочу в своём workflow сделать активити Которая повторяется раз в секунду или раз в миллисекунду Вот что я могу сделать я могу раз в миллисекунду сделать активити Которая повторяется А что ну типа это какой-то Пинг поход в другую систему Да у так Ну в принципе да но вы же какое-то конечное количество раз хотите или бесконечно Ну бесконечно я чек могу сделать То есть получается вот эта ваша заявка Она никогда не закончится То есть это бесконечный бизнес-процесс Да мне кажется мы опять в диалоге в дискуссии Да ну интересный вопрос Наверно сходу я не отвечу но готов ответить в дискуссионной зоне там ещё был отдельно под вопрос про то когда таска будет потеряна и когда на нода перезапустят это вопрос Я полагаю менее диалоговый и У тебя наверняка есть ответ сейчас нода перезапустите таска потеряется В какой момент Ил будет считать что таска потерялась И в какой момент и он перезапустить на другой ноде например задачу Да я понял там есть это короче грубо говоря пульсация да то есть мы постоянно проверяем на живучесть Да и если соответственно воркер не отвечает да Ну мы считаем что он потерялся это ответила на ваш вопрос Если нет то дискуссионная зона она поможет обязательно разъяснить дальше вопрос Ну сори вот если забегать Ну смотрите Да там в теории Да там Work бесконечная штука ну то есть он постоянно пишет команды ки Да вот у нас даже ограничение. и 50м скорее всего там на каком-то моменте нужно делать дочерний который перехватит вот это вот и да Так что наверно для че-то бесконечного Скорее всего нет Хорошо спасибо Есть ли ещё вопросы Из зала Давайте дадим возможность задать левой половине зала вопрос СБО то есть ме информацию о тах хранится Вот получается на сервере А вот App и значит вы делали ещ дополнительное хранилище да для него или как-то делали вот той db которая использует серве СБО большое за вопрос дополнительного возможно я не очень Понял Вопрос Короче говоря хранилище тела - это хранилище тела мы его как бы никак не делаем а оно идёт из коробки все таблицы что там есть они тоже из коробки вот если Какое у нас хранилище есть Ну вот к примеру заказы Да я сказал что они там архивируемых смотреть историю заказов человека за год а может и за два то есть ну нам это нужно делать поэтому можно иметь Да конечно же какой-то сервис Да какое-то хранилище Ну грубо говоря Order History вот куда мы будем сохранять вот эти заказы Надеюсь ответив на вопрос супер спасибо Есть ли ещё вопросы в зале Давайте дадим микрофон Здравствуйте Владимир Заец Фарина дата у меня пяток тем для обсуждения Я обязательно подойду Но вопрос именно по докладу такой вы говорили про идемпотентность активити Вот она со стороны собственно говоря воркера реализуется как-нибудь стандартно Ну не знаю там какой-нибудь локальный локальное хранилище ответа локальное хранилище ключа идемпотентность или это сам руками пишешь спасибо А да спасибо за вопрос за имость должны вы отвечать потому что ну идемпотентность ну окей это платежи да то есть Ну скорее всего это какой-то АШК Но если у вас там другой процесс другая бизнес логика то наверное идемпотентность Может это какой-то композитный ключ у вас будет то есть ну это ваша ответственность как вот именно вы сами её сделаете а что касается хранилища Да Кажется я забыл рассказать но результат активити Да вот она успешно выполнила результат активити кладётся в базу данных тела То есть когда мы потом ну воркер придёт он посмотрит что да был вызов и результат он вот такой вот отлично Спасибо у нас есть ещё один вопрос из зала давайте тоже возможность Спасибо за доклад А вопрос такой В каких случаях внедрение фреймворка temporal будет мешать разработке наверное в каких это неоправданно становится спасибо да спасибо за вопрос а ну я бы наверное не сказал что вте это фреймворк да это больше чем фреймворк на мой взгляд Вот Но когда внедрение не совсем оправдано м ну например когда у у вас уже есть какая-то система которая как-то работает и если вы хотите temporal то вы столкнётся с тем А как вообще мигрировать то что у вас есть на temporal ну к примеру у вас есть камунда к примеру У вас есть эти bpmn схемы и теперь же придётся их каким-то образом кодить Ну это ресурс разработки Вот и вопрос или же у вас есть система и у вас нет комун ды У вас самописный оркестратор что возможно хуже и вы нигде не документите А как работает ваш бизнес-процесс то тут как бы ну с одной стороны будет хорошо Да там вы проведёте какой-нибудь условно ивент рмин там Груминг обсуждение и поймёте наконец как оно работает с одной стороны хорошо а с другой стороны это опять же потеря времени Спасибо большое Есть ли ещё вопросы в правой половине зала есть вопрос Давайте здравствуйте Спасибо за доклад такой вопрос для сохранения детерминированного поведения workflow вы сказали что используется версионирование то есть по факту из бизнес логики пропускается часть кода который появился в новой версии workflow для того чтобы не сломать выполнение старых в процессе активной разработки таких условий появляется очень много то есть посреди нашей бизнес логики есть обработка версии а версии workflow Как вы сохраняете читабельность кода когда такого становится уже много Спасибо за воде невс коректно для сохранениями мы используем обёртки из Тити То есть к примеру вам нужно рандомное число Да там вы используете для этого Сай эффект я про это не говорил но вот да там есть для вызова внешней системы вы используете активити Ну то есть для Вот вот таких штук не детерминированных вы используете штуки из sdk вот а что касается версионирование это ну да она тоже участвует в детерминизм как это синтаксический сахар Ну мы Ну на данном этапе и мы просто прямо в workflow пишем вот этот If Да Get version А вот Ну со временем просто надо понимать что у вас же система развивается да то есть когда когда-то вы перейдёте полностью на новую версию и вот это старое можно выпилить то есть Ну да в моменте это попадает на техдок Но если это контролировать и через админку смотреть А есть ли ещё заказы которые на старой версии вы можете просто ну э ну выпилить это недолго На мой взгляд Вот спасибо У нас есть ещё вопрос из чата насколько temporal дружит с автотесто например функциональными интеграционными Ой мне Ну да я соответственно го бнд разработчик писать тесты Вот время от времени пишу конечно но не сказать что люблю вот Temp в данном случае мне очень понравился за счёт того что тесты можно писать легко Вы можете взять из админки Джейсон Можно несколько днок и буквально автоматически наливается на те правки которые вы внесли в бизнес-процесс это очень легко Вот ну это именно локальные тесты также Ну это можно сделать как тесты если говорить про интеграционные тесты Ну интеграционные тесты тут надо подумать но скорее всего тоже что-то можно сделать Сколько было пиц Уте за ВМ иния было утеряно за время использования тел А да не сколько ноль Ну типа пицца теряется если произошёл какой-то серьёзный косяк но сказать что в этом виновен Темпора Вот но возможно мой руководитель Евгений конечный знает какие-то секреты и что мы действительно теряли тонны пиццы Вот но навряд ли стояли часа Евгений говорит что они стояли 4 часа Ну но пиццато не терял Ну не потерялась же Да действительно есть ли ещё вопросы в зале поднимите пожалуйста руку мы подойдём к вам с микрофоном Давайте подойдём в правую сторону зала да Антон Спасибо за доклад всё-таки про Команду да то есть ты говоришь Ну понятно в те ты описываешь как Код Да workflow и так далее в кому в bpmn но для меня лично наверно наоборот отделение воркфлоу от кода - это преимущество То есть ты е описываешь в мле хранишь как код и ты можешь поверх этого исм строго типизированного потом что-то какую-то автоматизацию наворачиваются Вот делать схемы наворачиваются автоматизацию Она идёт из коробки и в случае да если это Enterprise Да как ну какие-то решения то bpmn схемы Возможно даже и хорошо потому что это со временем сохраняется вы это видите это прозрачно да А если это стартап который запускается супер Быстро растёт супер быстро тоже вот то на мой взгляд Это прекрасное решение Ну это даёт скорость при наличии отказа устойчивости и сохранении состояния ну плюс много плюшек из коробки уже быстрее кодить Спасибо Тут ещё есть вопрос Я полагаю что это будет последний вопрос у нас к сожалению подбиваются тайминги Максим компания альтенар у меня такой вопрос Вот вы взаимо действуете допустим с платёж кой с каким-то сервисом э там проводите платёж или проверяете его и допустим тж устала и надо бы как-то может подождать там минуту две и запросить через 5 минут Может там через 10 вот такую логику Можно ли как-то описать разрулить такую ситуацию Чтобы всё это не копилов общем вот Да спасибо супер вопрос А я показывал ретрай а там можно указывать соответственно эти параметры у меня было указано кажется максимальное количество рутин для активити TAS а нет у меня было указано максимальное количество ретра максимальное количество ра там было пять из коробки там уже идт Беков коэффициент и как раз таки Он решает вот эту проблему Да супер Спасибо Это был последний вопрос сессии вопросов и ответов я Напоминаю что есть дискуссионная зона в которой будет докладчик которой можно будет продолжать задавать вопросы и обсуждать темы давай выберем вопрос который тебе понравился да блин Это наверно сложнее чем сказать на самом деле блин Ну капец Ну какой вопрос тебе понравился мне вот например больше всего понравился вопрос про тесты мне на самом Нет проблема в том что мне вообще все вопросы понравились та Я хм всё хо-хо так ну нормально Я попал получается это сложно Да сложно много вопросов Но это же кайф Да А мне понравился первый вопрос а мы его выбираем про да про са Да а и и второе мне ещё понравилось а ты по очереди да да давай сначала с первым разберёмся а дарим матрёшку от онтика Напоминаю что вы можете собрать целую коллекцию не обязательно выходить ко мне просто поднимите руку и мы вас найдём И принесём вам подарок А теперь давай выберем второй вопрос который тебе понравился и подарим подарок от твоей компании да И второй вопрос вот молодому человеку да интересный вопрос в дискуссионную зону Да хорошо Тоже поднимите пожалуйста руку никуда не уходите правильно ты имеешь виду с первого ряда Да отлично с первого ряда молодой человек с двумя вопросами который один отправился в дискуссионную зону а другой озвучила Я через микрофон всё же правильно Да всё всё правильно всё правильно нормально Спасибо большое вас Мы тоже Хотим поблагодарить Это было очень круто для первого Спасибо большое я второй раз слушаю прол узнаю опять новое полезно было даже для меня А спасибо вам большое что пришли приходи"
}