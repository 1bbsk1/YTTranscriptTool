{
  "video_id": "jvAScSxtFr4",
  "channel": "HighLoadChannel",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "на сцене спикер из Яндекса который знает всё про Алису и что у неё внутри Давай сделаем Павел капля Давай сделаем вид что вы это сказали а я это услышал лст Всем привет Меня зовут Павел капля и сегодня мы поговорим про АСУ буквально в октяб испо ле называется наш доклад и мы попробуем Я попробую рассказать о том как ВС устроено И как мы туда дошли Давайте немножко о себе Я вообще-то физик не думал что когда-нибудь буду разработчиком хотя и действительно работал писал какой-то код пока учился физик занимался физикой плазмы и даже защитил кандидатскую диссертацию по этой теме схожей В общем по физике и в 2018 году я увидел Яндек станцию и честно говоря Это совершенно неизгладимое впечатление на меня произвело я Поня чтом заниматься голосовыми ассистентами увидел в этом будущее невероятно загорелся и пошёл готовиться к секциям прошёл собеседование пришёл в Яндекс разработчиком писал на Джаве в Алисе это была редкость и сегодня дорос до руководителя продуктовой разработки нашего Ассистента А чём будет мой доклад это будет э архитектурный доклад мы будем говорить в целом о систем дизайне мы не будем сегодня говорить об мле а и я постараюсь рассказать как Алиса устроена под капотом сегодня для того чтобы это понять почему так как мы к этому пришли мы начнём с того как это было в самом начале Каким был этот переход Какие проблемы мы решали и как это позволило нам двигаться дальше и создавать новых ассистентов на новых языках погнали с чего всё начиналось Когда вы хотите создать голосового ассистента вам нужно решить Примерно вот эти вот задачи Если вы можете их решить Вы можете сделать ассистент ничего сложного вопрос как их решить что это такое для голосового ассистента нужно сделать spe есть образовывать голос в текст нужно решить задачу NL Natural Language understanding нужно научиться понимать Что содержится в тем в том тексте который вы распознали из голоса конечно же вам нужна какая-то бизнес логика в результате которой ваш ассистент работает умеет на что-то отвечать и те тексты которые он генерирует вам нужно научиться синтезировать то есть решить задачу ТТС Text to Speech а сегодня вот на этих вот двух кубиках мы сосредоточимся когда Алиса только начиналась она была устроена очень просто это было буквально два Монолита один назывался Vince Voice Interface Service а другой назывался бас энд ассистента Ну и разработчики были басисты много всяких там групп по раздаче ролей которые обыгрывал это слово всякое такое в винсе была сосредоточена вся логика по Работай по работе с текстом это понимание смыслов Это задача классификации и генерации текста конечного ответа А в басе была бизнес логика которая ничего не имел Ну условно говоря там Практически не было русского языка Да там всё было написано в машиночитаемых терминах и там были вот эти модули которые отвечали за разные ответы которые Алиса умела давать про погоду про музыку про поиск и так далее ещё раз как распределялась зона ответственности в винсе решается задача нлу то есть понимание смысла который содержится в тексте соответствующей голосовому запросу задача классификации - это выбора того как мы будем отвечать нашему пользователю Что за интент вот такое слово я буду употреблять втечение этой презентации интент - это машиночитаемый эквивалент намерение пользователя когда он говорит Поставь будильник на 8 часов Это интент установки будильника у где там аргумент в 8 часов Да это то с чем работает настоящая бизнес логика она не работает с естественным текстом Вот и ЛГ - это то как составить и сопоставить друг с другом тежи правильно составить В общем фразу на человеческом языке с использованием данных например Окей поставила будильник на 8:00 утра да э ну вот вставив туда эти самые 8:00 утра облича их в текст и сделать так так чтобы ухо не реза вот а в басе соответственно ответственность была только про бизнес-курс скрывается И как мы будем его как мы будем на него отвечать а это был такой Каскад классификаторов где первым конечно это всякая просто логика на ифх которая жёстко детерминированные ответы э даёт пользователю знаете мне кажется что ребятам на первом ряду довольно сильно слепит красным если мы можем что-то поделать Я уверен что они будут счастливы Вот в общем их прям слепит Посмотрите пожалуйста в это давайте двигаемся дальше значит первый первый уровень классификации - это Ифа такие Да когда жёстко детерминированы ответы всё супер понятно Но так конечно многообразие ассистента не сделать поэтому есть льный классификатор самый главный который хитро определяет на основании запроса и некоторого контекста как же мы будем отвечать Нон всегда справляется или хорошего ответа там нету И поэтому есть ещё какой-то слой некоторых эвристики которые до уточняют э как же мы всё-таки будем отвечать например выбирает между болтал кой и поиском это такой очень ну Пограничный срез э какая-то сложная система одна большая сложная система из мля и факов которая должна всё выбрать но на практике оказывается что даже её становится недостаточно Давайте какой-нибудь характерный пример рассмотрим когда мы говорим Включи синий трактор вообще говоря непонятно что нужно включать видео А может быть это умный дом да и у нас есть какое-то устройство или сценарий который называется синий трактор Что с этим нужно делать оказывается что это как характерный пример Но на самом деле таких много и на разных срезах не только музыкальных оказывается что нельзя вот априорно глядя только на контекст запроса и сам запрос понять Как именно мы будем его обрабатывать А на этом строилась архитектура это этой с и поэтому был сделан такой хитрый ход Костыль в неком смыс Костыль э в басе который назывался такой смена сценария когда вот Ну вот мы выбрали что мы Я не знаю Будем включать музыку пытаемся её включить и в какой-то момент такие а с музыкой Короче не получается Давай попробуем видео раз сабе в себя запрос но только уже как будто бы видео Делаем Вот и таким образом схема становится вот такой на практике что в басе как содержатся вот эти вот сценарии модули про разные ответы так и вот э хитрая доклассическую такой была архитектура Какие Давайте как-то сумарин там были это были монолитные сервисы мы все понимаем что монолитные сервисы это удобно в начале Но точно не удобно ни в эксплуатации ни развитии потом и они были сильно связаны даже между собой сценарии зависели от по бизнес логике друг от друга потому что для того чтобы сделать вот этот хоп Да в музыке нужно было написать условно говоря код который А теперь попробуем в видео Итак музыка знает про видео А в видео написать ещё хоп там какой-нибудь и вот этих смен становилось довольно много Мы упёрлись в качество классификации по запросу и поэтому появился этот самый несущий Костыль который вообще говоря невозможно было разобрать ответственность про классификацию расползается по двум компонентам системы по всем для системы из двух компонент а единая модель классификации вот та Насколько хорошо он даёт ответ на поставленный запрос это качество - это интегральная Метрика мы можем только взять какой-то пул запросов прокачать его через всего ассистента посмотреть на ответы и понять Хорошо ли мы отвечаем только интегрально мы можем понять насколько он у нас качествен и когда мы делаем любой изменения в классификации это сразу влияет на весь интеграл да то есть любое изменение требует полной приёмке качества всей системы это Чем более развитый ассистент тем более длинная процедура и в какой-то момент мы реально дошли до состояния что разработки вставали в очередь и говорили Сегодня я занимаюсь классификатором больше никто вот он там учил м переобул или факи какие-то писал переснимать Это серьёзная проблема с точки зрения производства Да мы не можем так дальше ассистента развивать это стал крайней точкой И началась большая революция вторая часть моего доклада про то как устроена сейчас и то куда эта революция привела Давайте попробуем разобраться на вот такой схеме первое что мы сделали мы вынесли луш ную часть в отдельный компонент который называется бегемот Ну это честно говоря не просто перестановка кода из одного сервиса в другой в нём случилось фундаментальное изменение да Сначала мы говорили о том что мы занимаемся классификацией прямо сразу Глядя на запрос а теперь А мы говорим что в у нас был кнн классификатор можно его так назвать Да Нам нужно было выбрать среди множества самый лучший интент который дальше передать в обработку теперь не так теперь бегемот - это компонент который содержит десятки сотни наверное тысячи я честно говоря не знаю Но короче очень много интен тов и каждый интент бинарное то есть для каждого интен мы даём ответ на вопрос подходит вот под этот запрос или не подходит Ну соответственно Под каждый интент может подходить множество разных Под каждый запрос может подходить множество разных интен тов в результате такой бинарной классификации важная штука мы перестали решать задачу кнн Мы перешли к множественной бинарной классификации Значит у нас есть много интен тов раньше всегда был один а теперь много интов соответст запросов и дальше Гамай вступает вступает в игру megamind - это штука в которой решается задача классификации то есть выбора того как мы будем отвечать все сценарии разбились на отдельные совершенно независимые модули и постепенно вот из вот наверху написано погода видео Да И вот видео написано в виде сценария это конечно же не ну не едино момент ная трансформация Да постепенно из басовые схемы мы переносили эти сценарии и делали их вот в нашей новой архитектуре до сих пор этим занимаемся честно слово какой-то хвост вечно там тем не менее появляются отдельные сценарии они независимы они не могут делать вот этот вот хоп между сценариями и ЛГ как то как мы как мы генерируем итоговый текст который мы будем отвечать пользователю стала неотъемлемой частью этих сценариев супе доб Потому что им на самом деле занимаются те же разработчики которые пишут логику каждую Ну написали логику нового типа ответа добавили новый текст который такой ответ генерирует вот ин в этой архитектуре стал просто ещё одним сценарием он такой не приоритетный он скорее лбк если ничего лучше в новой схеме не нашлось тогда мы отдаём его ему запрос но он всё ещё остался от него никуда не деться и там есть какой-то поток запросов так вот и теперь главная штука да у нас множество бинарных классификаторов которые говорят что в этом запросе есть интент включения музыки видео умного дома Возможно как интент дальше что мы делаем Мы обходим те сценарии которые могут ответить на такой интент те которые не могут Мы даже Их хом Но те которые могут мы передаём им этот запрос и говорим Ну посмотри на него что ты нам можешь дать и сценарий говорит у меня есть ответ Или у меня его нету И это даёт очень сильный сигнал первый То есть у нас есть много интен тов какое-то количество сценариев которые мы обходим в поисках ответа какое-то количество из этих сценариев вообще говоря имеют ответы а остальные нет и дальше нам нужно лишь решить задачу ранжирование так как мы это делаем в поиске когда задам запрос видим множество сайтов нам нужно выбрать из них самы лучший че ответов каждый из которых Мы готовы отдать пользователю Так мы и делаем и именно эту часть забирает снова на себя Мега такой посто обработкой это этап логи и текстами ответами генерацией наших ответов ещ раз вот это прям несколько раз я проговорил и ещё раз проговорил потому что это самое большое изменение которое мы сделали в ассистенте которое на самом деле важно тогда когда вы на Большом объёме для множества диалоговых систем это преобразование не нужно потому что достаточно просто какой-то классификации по интент по запрос Когда становится очень большим ты начинаешь в опираться я уверен что все кто в этой индустрии дела пропуск ассистентов знают про эту проблематику может быть по-разному к ней подходят но у нас было решение такое Мы перешли от задачи классификации запрос най к задаче ранжирования ответов так как мы это делаем поиском ЛГ стал неотъемлемой частью нашей бизнес логики сценарии стали аддитивное их можно было разнести на микросервисы и дополнительное важное изменение которое в системе случилось - Это мы смогли вынести сайд эффекты сайд эффекты - это когда система делает что-то во внешнем мире сохраняет данные шлёт пуш Я не знаю заказывает такси что-то что происходит во внешнем мире какой-то какой-то эффект возникает нам удалось спроектировать систему так что все эти сайд эффекты вынесены в отдельные специальные места как бы пайла на обработке запроса и поэтому их можно отключить не может быть сайд эффекта в произвольном месте как результат так как нам нужно всегда мерить интегральные качество Нам очень легко взять и прокачать всю Алису с кучей кучей разных вопросов включая не знаю Умно домовые запросы такси но лампочки не включить и такси никуда не приедет Да она становится за счёт такого подхода или мы можем её сконфигурировать в любое произвольное состояние произвольный контекст прокачать её и понять как мы работаем в этой связи важнейшее свойство которое позволило двигаться дальше недостаток того что мы сделали это то что раздробили кучу сетевого взаимодействия и гораздо больше чем может показаться на первый взгляд сейчас мы про это поговорим как только мы делаем много сетевых походов у системы резко возрастает уменьшается отказоустойчивость Да риск отказа растёт Ну Потому что везде может что-то сломаться и на больших объёмах это реально становится проблемой Давайте посмотрим какой-то самый простой пример вот у нас ну есть какой-то Запрос который прилетает в наш сервис и в сервис а он идёт в сервис б который идёт в сервис C чтобы его обработать на самом деле Мир сложнее да Перед сервисами стоят балансе где указаны домены и какая-то какая-то балансировка между хостами то есть на самом деле запрос приходит в балансер сервиса ар идт в балансер сервиса и так далее Вот такая штука Но обычно когда happ Pass вс хорошо нормально всё работает Однако если начинается какой-то отказ например сервис отказывает лёг под умер что-то такое да то его начинает трать сервис Б Сервис б начинает ретра своим балансе балансер сервиса б начинает ретра сервисом А и В общем этот полный отказ превращается в лавину Да у нас лавина из-под которой сервис наш маленький сервис который один раз буквально не ответил его просто заваливает запросами и он уже не может подняться когда у тебя э ассистент типа уровня Алисы Да у тебя постоянный продакшн постоянный H но ты не можешь себе позволить такого рода отказа системы фундаментальные отказа системы и с этим нужно было что-то делать и поэтому э частью этой реорганизации был переезд на Up Host Up Host - это такая внутренняя внутренняя технология которая лежит в поиске лежит ещё в ряде сервисов и Теперь лежит в Алисе которая отвечает за сетевое взаимодействие самое главное что идеологически приносит эта технология - Это следующее сервисы перестают делать сетевые походы Всё мы не ходим сервисом в другие сервисы там в баз данных можно но в общем это небольшая часть А в сервисы другие мы не ходим все сетевые походы делает апст А сервисы становятся акторами если кто-нибудь читал про такую архитектурную такой архитектурный подход взаимодействие между сервисами Они же вытащили из них оно начинает описываться специальным графом в декларативного виде конфигом этого самого Хоста где задаётся Кто куда В какой последовательности должен ходить а и этот Граф управляет не только последовательностью вызовов но и управляет потоками данных Какие данные Куда нужно переслать в обычном мире да Если у вас есть какие-то данные на входе Я не знаю экспериментальные флаги Да и в какой-то самый дальний сервис вам нужно их передать Ну вот вы по всей цепочки вызовов их передаёте и Если что-то ещё нужно будет Вот так сначала в конец передать то нужно будет доработать все сервисы АХО позволяет так не делать А пробросить данные как бы в обход промежуточного слоя очень интересное преимущество Давайте попробуем посмотреть как выглядит жизнь под хостом рассмотрим опять какой-то умозрительный пример Да у нас есть сервис А который принимает пользовательский запрос ходит в B и C параллельно получает от них ответы как-то их обрабатывает идёт в сервис D получает ответ от сервиса D и возвращает его пользователю в обычном ре мы бы написали так в мире Аста мы делаем вот так на входе У нас есть хост который принимает запрос и он идёт в сервис а но сервис а никуда не ходит он отвечает хосту Вот тебе данные для похода в сервис B и в сервис C Моя работа на этом закончена об Host делает походы в сервис B в сервис C получает их результаты снова приходит в сервис а И говорит вот B ответил Вот это C ответил вот это что дальше мы говорим О'кей обрабатываем их Вот тебе данные для похода в сервис D в сервис D опять возвращаемся в сервис а говорим результаты сервиса D такие и сервис а даёт пользователю ответ что мы получаем мы получаем три похода в сервиса вместо одного безусловно Да но это результат той архитектуры кото в которой мы теперь строим наш сервис А я сказал что графы описываются в декларативного виде Ну и вообще в виде графа всё ество взаимодействие описываю вот какой-то простой пример э какой-то Граф у него есть несколько разных вот э данных которые приходят ему на вход у него есть нода setup это ручка нашего сервиса она чего-то такое сепи потом мы идём вот какой-то filmography Proxy в какой-то куда-то идём обрабатываем и отдам в виде ресн ошибки отдам либо результаты нашей работы супер простая штука просто для наглядности Да вот с таким на самом деле работают разработчики но Граф становится гораздо сложнее Вот это Например Граф сценария погоды смотрите его важное свойство что он читаемый в целом глазами Да даже без вот в таком виде когда ничего не написано в целом понятно что есть какая-то последовательность штук мы сейчас тут найдём глазами знакомые вещи и какие-то вещи работают параллельно вот сча хо ре Wizard какие-то сервисы чего-то обрабатываем потом вот снова Мы СПМ какие-то данные готовятся у нас для похода в сам сервис погоды обрабатываем сервис похо погоды рендере ответ вот так выглядит следующий как бы шажок да мы дальше дальше поднимаемся это тоже реальный графы оба этих графа в Алисе вот слева справа от вас справа от меня слева это Граф обхода сценариев ещё один это тоже Граф обхода сценариев там без сайд эффектов но не суть в общем они становятся довольно большими и это все на самом деле органические почти все из них органические сетевые взаимодействия которые надо было бы делать где сервисы взаимодействуют с сервисом представляете Какая сложность есть вертикальные вот такие графы есть довольно сложные горизонтальные графы когда Ну много чего нужно сделать последовательно и всё что мы сейчас с вами посмотрели все вот эти участвуют в обработке каждого запроса Алисы это ну невыдуманная штука представляете какой сложность сетевое взаимодействие и если бы мы его делали внутри умерли бы наверное чего дало нам такое изменения во-первых Мы перешли к декларативного описанию архитектуры всей нашей системы Да мы мы понимаем как множество всех сервисов взаимодействует друг с другом у нас появилась внешняя конфигурация сетевых походов у нас появились внешние тайм-ауты внешние политики трав они в каждом сервисе каждой командой написано по отдельности Да политики H Когда мы можем делать дополнительные запросы в некоторой квоте для того чтобы если сервис Долго отвечает Может быть пораньше ответ получить от всяких герх штук за счёт этого мы на самом деле сильно повысили Надёжность нашего Ассистента в результате этого внедрения это прямо было видно на графиках как мы просто надёжнее стали отвечать у нас с одной стороны появилась одна точка отказа в в лице Хоста с точки зрения сетевого взаимодействия а с другой стороны множество команд Да перестали быть ответственным за то чтобы и иметь возможность совершить ошибку а там когда делают сетевой поход септ какой-нибудь свой клиент и так далее мы отказались от балансера потому что балансер в этой схеме не нужны и код балансера в Яндекса на самом деле интегрирован прямо в АХО вы умели гибкое управление пересе данными нам довольно легко масштабироваться здесь чем больше запросов тем больше можно этих исов просто разворачивать и всё И ещё одно очень крутое следствие то что сервисы становятся пу B так как они никуда не ходят у нас нету ИО раз нету ИО значит не нужны корутины Не нужно людям думать про сложную многопоточность и так далее ВС становится сильно проще А где сильно проще большой обм наж ошибок в разработке в производстве становится меньше конечно это вс не далось нам бесплатно нам пришлось научиться с этим жить да Это совершенно другой подход к тому Как строятся сервисы команде поддержки ран тайма дежурным нужно было осознать нам нужно было осознать Как это работает уметь диагностировать проблемы нам нужно было научиться рассказывать вновь пришедшим сотрудникам как бы в некотором смысле погружать Их вербовать в то что это хоро нам при переть мето трет переписывания норные ве коне трет и Пришлось создать различные фво абстракции для того чтобы с этим можно было комфортно работать сейчас вообще не вызывает Ника проблемы в общем для разработчиков уже прикладного кода Это буквально как ручки писать Супер всё удобно и понятно Вот И теперь мы переходим к третьему блоку моего рассказа если пре пришла команда об Хоста прошу их вот сюда вот подойти они могут на всякие каверзные вопросы тоже поотрываю твоего Ассистента в другой э степени Свободы если до этого мы учили его всё большему большему отвечать Всё лучше и лучше то теперь нам нужно фактически масштабировать ассистентов Да Нам нужна такая технология которая позволяет сделать ещё одного ассистента ещё одного ассистента и их жизнь должна быть достаточно независимой А сегодня на базе технологий Алисы есть работает конечно же сама Алиса а буквально месяц может быть два назад вместе с компанией Янга Э мы запустили Ясмина это отдельный ассистент на арабском языке и английском языке это билингвальный ассистент а и мне кажется 2 недели назад э Алиса запустилась на казахском и это отдельный казахский ассистент а Что такое сделать ассистента на плюс одном языке вот возвращаемся к нашей схеме Ну на самом деле нужно сделать всё кроме логики это то если у тебя всё хорошо написано нужно сделать всё кроме логики но на практике действительно логика практически там на 90 95% не меняется между языками между языками Да но нужно сделать отдельную модель распознавания текста потому что язык новый отдельно научиться понимать смыслы потому что тексты новые отдельно научиться генерировать ответы правильно ста предложение Да потому что на каждом языке вс по-своему и конечно же нужен синтез также продолжаем фокусироваться не на льной части А на более инф провой части и посмотрим как нам это удалось начнём с НЛО выбор ассистента - это штука которая не делается в ран тайме Ну по крайней мере у нас сейчас и наверное так ещё долго будет то есть пользователь выбирает себе он будет с арабским ассистентом жить с казахским ассистентом с российским ассистентом и не нужно по запросу пытаться угадать язык совсем да между русским и арабским для ассистента нужно между арабским и английским уметь на уровне запроса выбирать потому что спросили на английском ответим на английском спросили на арабском ответим на арабском и технологии наши это позволяли сделать соответственно раз мы знаем какой Какое семейство языков мы отдаём в эту модельку ара и в соответствующие как бы модельки или соответствующие сервисы по распознаванию смысла как я сказал когда мы построили бе мы сделали что итен они работат на бих Ласи за виси Они просто не знает их много много много много много и получили на самом деле очень крутое свойство эти интент аддитивные Что значит Ну мы можем взять и научить Алису новому добавив плюс один интент дальше пиши логику которая его обрабатывает но понимать мы уже научились просто не выигрываю в пост классификации потому что ответ плохой а это значит что у нас нет ну никакого никакого специального места где всё нужно перечислить что ли Да поэтому когда мы делаем новый язык нам просто нужно научиться понимать те же самые интен на новом языке и здесь нам приходит на помощь такое свойство когда мы учимся новому интен мы собираем специальные инструкции для того чтобы локеры размещали которые гово которые позволяют понять вот этот запрос он к нему соответствует или нет Ну для того чтобы классификаторы обучать и так далее эти инструкции описывают смысловую часть интен и эта смысловая часть от языка не зависит и мы можем брать и переводить эти инструкции и получать сразу готовые задания Ну с какой-то небольшой корректировкой но в целом достаточно хорошо которые позволяют запускать на локера соответствующего языка написания разметки и подготовки рнов данных для того чтобы это работало А интент как я сказал можно включать он Мы готовы поддержать какие-то интент на соответствующем языке мы просто включаем их у нас есть для них ну размеченный данные мы умеем их э матчи включаем и система начинает работать довольно классное свойство И если мы не включаем какой-нибудь Я не знаю видео интент вот сейчас в ясмине нету видео сценария и там просто не работают матчинг этих самых видео интен тов и всё довольно простым способом ты можешь конфигурировать себе ассистента а вторая часть - это ЛГ вообще сформулировать или ну написать хороший слаженный текст ответа - Это довольно непростая задача особенно когда туда нужно внедрять какие-то машиночитаемые штуки даты числа числительные соответствующие формы приводить числительный и так далее довольно непростая задача и супер языка специфичная как же мы её решаем вообще ответов в Алисе несколько типов вот их можно так примерно разделить Первое - это генеративные ответы и на самом деле это такой кор языка без которого точно ничего нельзя запустить это болталка болталка - это языковая модель и для запуска на новом языке нужно обучить языковую модель с персонажной будет уметь болтать на этом языке есть редакторские ответы и они очень специфичны Да потому что шутки там про программиста Алексея которые хорошо понятны в России супер непонятны некультурно никак в арабских странах да Или в Казахстане то есть набор того что такое вот эти редакторские вещи не зависимый для каждой страны что-то можно переиспользовать но в целом Нет ну и самое большое число ответов - это конечно сценарные ответы которыми отдаю которыми отвечает наши сценарии которыми отвечает наш ассистент погоды таймеры будильники заглушки и всв их очень много и вот их тоже всех нужно перевести как мы это делаем ответы в Алис описываются вот таким вот способом хитро это прямо реальный код он такой Джин подобный да Значит это код в котором разработчик пишет Ну в данном примере на английском но на самом деле неважно На каком языке важно чтобы ему разработчику было понятно как бы смысл фразы на самом деле это такой ключ перевода в итоге становится это некоторая фраза Глядя на которую понятно что мы тут по смыслу будем отвечать и куда будут вставлены различные части этого ответа построенные на данных типа Дат чисел врем и так далее которые будут приведены в соответствии с целевым языком так чтобы фраза была устроена корректно разработчик пишет вот такую штуку А дальше генерируются Вот такие вот словари в которые внедрены прямо вот эти вот макросы словари переводов и эти словари определяют то как данный языке причём получить это мы можем на самом деле даже машинным способом просто отдав переводчик мы получим какой-то ответ Он в целом будет уже на нужном языке Но отдавать его в продакшн конечно же будет нельзя и поэтому мы построили вот такой процесс значит э разработчик пишет На вот этом псевдо языке различные формы ответов по одной на каждой на самом деле больше не нужно дальше формируется вот этот джисон переводов он выгружается в систему переводов где переводчики описывают они умеют вот использова всех этих внедрений значит сохраняя их писать новые красивые фразы они описывают новые красивые ответы множество ответов для каждого ключа Да потому что Алиса многообразна Асистент должен отвечать по-разному на одни и те же ответы Ну на самом деле даже структурно одни и те же ответы иначе он будет очень назойливый будет очень плохо в использовании Вот они пишут всё это многообразие импортируют обратно и релизом всё это дело катится наверное пару слов ещё здесь у этого есть очень прикольное свойство что такой подход позволяет разделить работу разработчиков от работы редакторов сделать её асинхронной разработчик пишет фразу редактор условно говоря может одну какую-то фразу написать в качестве финального ответ на данном языке и и всё работа разработчика закончилась А дальше редакторский состав может всё улучшать и улучшать добавлять многообразие как-то тюнить те формулировки которые используются в конечном продакшене И тем самым Ну мы развязывая работу разработчика от работы над улучшением ЛГ Ну вот как-то так рано за 6 лет э архитектура Алисы начиналась довольно просто с Монолита надеюсь что мы сегодня достаточно подробно про это поговорили и Мы перешли к совершенно новой более сложной архитектуре где есть Гамай бегемот сложные классные слова которые мы очень любим использовать в Яндексе для названия сервисов Мы полностью переписали сетевой стек и все эти шаги удачно позволили нам научиться масштабировать наших ассистентов на новые языки и новые страны и вот тут у меня всё спасибо спасибо Паш Давайте вопросы зададим так друзья вот прямо в центре Ага давай тогда сначала справа от вас слева а потом в центр побежим Спасибо большое за доклад А вопрос прост А кто ты и чем ты занимаешься Привет я из звука занимаюсь машино обучением инженер машино обучения отлично Я просто король на творка поэтому я должен да понимаю так вот вопрос прост было сказано что Да он пришёл на замену последо палай то есть решили проблему ой вопрос насколько вопросов несколько на самом деле насколько в попугаях повысилась Надёжность упало число отказов Что всё-таки происходит если обст отказывает как он там восстанавливает состояние Ну вот такого рода спасибо Ну во-первых ты первы человек которому про всё понятно с первого ра это круто т насколько увеличилась отказоустойчивость Да вот это была первая часть а вторая была э Что делать если сам хост отказывает э Слушай сейчас довольно сложно сказать потому что там нету ступени там есть тренд в рамка в процессе внедрения который был там примерно в течение наверное полутора-двух лет Когда мы переходили Да но ну существенно прям для нас существенно Алиса живёт в терминах четырёх девяток Вот и без этого мы не могли там быть вот а что делать если а Host отказывает это действительно Ну типа это сервис в котором весь стейт запроса Если вдруг ну машинка выпадет Значит его за ретрай вот так но в течение всего запроса он живёт внутри одной машинки да то есть м э нет Мне кажется й не восстанавливается но ещё раз это один запрос как будто бы ну целиком за ретрай Вот и сайд эффекты же вынесены там вот если сайд эффектная часть трается больше проблем но без сайд эффектная довольно легко Спасибо сть добры Паша Спасибо большое Меня зовут Костя Тиньков техлит В команде А у меня два вопроса может быть глупые про АСТ Не совсем понятно Правильно я понимаю что это ну паттерн оркестрация что-то типа bpm системы типа конды когда мы всю логику пишем в виде вот этого дерева куда чего ходить и да и ну в общем безусловно это близко Вот но могу ли я сказать что это камунда Давай мы вот здесь парней поймаем и прямо вот этот вопрос им зададим посмотрим как они позиционируют но ме аналог Да вот такой типа система оркестра которая говорит что как как взаимодействовать между сервисами Окей второй вопрос про не совсем понял вот про билингва систему у вас Три разных Алисы русский язык арабский слеш английский и казахский раз вы сделали автоматическое распознавание Арабского и английского языков Почему нельзя было Ну вот это автоматическое определение сразу русского казахского Арабского и английского сделать в одной алиси английские песни например которые могут вывести Ну с твоего Ассистента в странное состояние да э это могут быть казахские песни это может быть какие-то казахские запросы то э На каком языке говорит твой ассистент на самом деле определяется Ну примерно домом в котором он стоит Да какие языки там знают при этом Эти люди могут в своём запросе или на самом деле частично в ответе использовать Ну какие-то фразы или что-то из других языков Ну ещё раз включение э в Российской Алисе английской песни не должны приводить к английскому ответу Да и и и Собственно сам запрос может состоять только из этой английской фразы В общем начинается мес который с точки зрения пользовательского опыта будет только хуже очень понятное детерминированное поведение ты выбрал себе своего ассистента и с ним понятно живёшь билингвальной - это необходимая часть для арабских стран потому что там очень много экспатов В общем там это Это важная штука для них нормально говорить вот в таком билингвальной режиме А можем ли ожидать что для русских и казахской Алисы появится ещё английская как бы можно будет задавать на английском языке запрос я буду как всегда консервативне мы не комментируем своих планов Короче не могу Спасибо Привет я компания систем архитектор хотел спросить про Есть ли в Алисе контекстуального и Если да то как то есть это какой-то контекст переменный контекст или чтото ещё Короче ты понял да у тебя сейчас интервью по продукту а не по кишка легчайшее Я же продуктовой разработкой занимаюсь половина профессии в этом очень простой ответ да характерный пример Какая погода сегодня а завтра супер ясное что всё работает Это это работает за счёт того что кстати говоря возвращаясь к выносу сайд эффектов работа с контекстом она вынесена как бы из системы и она подаётся на вход на каждом последующем запросе за счёт этого Алиса знает какие запросы были предыдущие о чём мы вообще говорили с этим пользователем раньше какую музыку там он музыку любит не ладно как он сценарий умного дома себе назвал и всякие такие штуки которые может использовать в процессе обработки запроса То есть это какая-то Мапа переменных или в каком виде это выглядит источников которые так или иначе влияют на контекст довольно много в самом вот в самом бизнес логике То есть это как выглядит вот из источника мы забрали и Мы же должны как-то у себя Это сохранить чтобы это использовать в нашем коде супер простое такое история хранится в виде текста Ну там есть ещё кое-что но понятно запрос ответного текста который видит и моделька и всё что работает ну в процессе обработки запроса оно может обратиться к этой самой истории точнее подписаться возвращаемся к термину Хоста подписаться получить себе эту историю и как-то интерпретировать использовать процесе то через ахос делается в том числе Ну вот мы мы сейчас разли только историю да Умный дом - это отдельный источник данных который тоже может быть передан кому каким-то частям системы который нужно учитывать её в контексте Там и так далее вот есть болталка которая совсем так как она языковая модель она получая историю Ну разным способом может оперировать контекстом и так далее И эти технологии их много много много разных Ну я понял А ещё один вопрос Вот ты говорил что вы получаете ну можете получить несколько ответов и какой-то из них выбираете лучший А как вообще скори какой лучший вот допустим я запросил песню соответственно Мне нашли песню и нашли видео с этой песней И как вы определяете в итоге видео или пес там коне классификация и то если мы нашли песню то у неё будет идентификатор песни а у видео наверное будет какой-нибудь органический видос у которого в названии будет не то же само Не ну имеется в виду что человек Допустим хотел песню Но он не сказал клип но он хотел клип вот э это очень интересный вопрос Кстати на него ответ Наш текущий что вообще говоря нельзя Это Определить если Повер сможет тебе сделать и то и то например Это я не знаю ТВ станция в которой Ну телевизор наш недавно запущенный И когда ты там говоришь э что-нибудь то примерно одинаковое количество пере запросов Как одну как другую сторону на вот этих спорных историях и это нельзя определить без до уточнения И на самом деле в половине случаев так как определить нельзя то ты угадываешь вот Но это супер сложный кейс Да когда прямо равноправном всё-таки не равноправное Нера не равноправном занимаемся поиском мы компания которая делает поиск когда вбиваешь тот же самый запрос у нас по схожим технологиям вытаскивается в поиск конкретный трек там я не знаю на Яндекс музыке а не просто органическое видео или конкретный фильм неважно на любом из кинотеатров а не какой-нибудь там ютубный обзор и так далее есть способы как это на основании различных фичей и результатов поиска который тоже работает под капотом на множестве множестве запросов Алисы понять что из этого более релевантно сценарий сам в том числе является источником таких фичей и говорит я Ну прямо точно сейчас вот трек буду включать Вот он дишни я уверен то есть сам сценарий может проско себя Нет он отдаёт фичи для скоринга Да часть ответа сценария безусловно Это фичи для скоринга самое главное фича из них это у меня есть ответ да про который мы говорили Ну это понятно Спасибо будьте добры вот цен пожалуйста дадада Ага а добрый день Вадим тех тимлид собственно вопрос может быть странный будет но я его постарался к теме плюс-минус прикрутить у меня дома три Алисы и вчера я смотрел собственно фильм И когда я остановил потом сказать продолжить у меня на кухне заиграла музыка и на телевизоре продолжится сло фильм так вот вопрос в том как в данной системе работают две одновременно Алисы То есть я один говорю И это идёт в два потока либо как они будут понимать что надо фильм продолжить а не музыку запустить на кухне Это значит что первое раз у тебя включилось обо устройства это значит что у тебя выключена настройка в умном доме отвечать одним устройством у нас есть такая технология которая позволяет так делать и понял кто виноват да вот но но но это Это значит что мы не доработали не донесли до тебя владельца многих устройств это почему-то должным образом технология у нас такая есть и работает довольно круто если у тебя есть несколько устройств и они слышат одновременно тебя в каком-то коротком окне то у нас есть специальная точка синхронизации и внутри неё ещё один такой же постклассической который говорит ответ какого устройства на самом деле тебе нужно дать и есть самая простейшая штука - это я не знаю громкость да Если всё молчит и Ты просто спрашиваешь что услышать должно то устройство которое лучше тебя услышала Потому что ты ближе к нему стоишь но есть и более сложные штуки типа я не знаю в спальне играет будильник и ты говоришь Стоп да у тебя вот тут вот колонка но на ней ничего не играет А вон там в спальне колонка и на ней играет будильник и его нужно остановить Вот и все вот эти части Они уносится как раз Вот в такой мы его называем контракти оню а вот это вот ээ и получается мы не можем на троих управлять с одного устройства если у нас разные аккаунты А можете нужно можете нужно все устройства тебе забрать себе нужно все устройства забрать те себе А их познакомить и тогда не будут из-под своих учётных записи со своими рекомендациями всем всем всем Алиса это Алиса ИТ это Алиса Алиса ты Сиреневая Алиса ты жёлтая да да пожалуйста финальный и потом подводим Ты должен подарить подарки спасибо спасибо сколько чтобы я уже успевал сейчас я выясню давай Андрей Романов из архитектор па во-первых спасибо за доклад супер попробую вернуться чучуть к теме конференции с вопросом смотри очень мне понравился ваш подход с описанием через графы Да взаимодействия и насколько я мог понять Вы когда внедрили вот это архитектурное решение да у вас увеличилось количество взаимодействий происходящих в рамках там одного сценария То есть просто стн шест со скоростью ответа в этом случае там все запросы внутри одного ДЦ это суб миллисекунд взаимодействие и на уровне всех остальных вещей там ли которые работает может десятки где-то может быть сотни совокупные вот эти вот потери на сеть они действительно есть но они пренебрежимо орут вго центра Да да спасибо друзья Спасибо большое за вопросы Я понимаю что мы не можем ответить на все Простите у кого рука затекла держать а значит мы можем подарить один подарок от конференции и два от Яндекса давай выберем кому А я думаю что от конференции мы подарим Вот вот юноши нька да про про хитренький вопрос про который я не справился и пришлось прибегнуть к помощи коллег ещ два вот за последний вопрос махни рукой все кто задавал вопросы пожалуйста и мне кажется вот в самом начале я его отметил вот самый самый первый вопрос кто кто был а это вот вы кому игрушку А кому станцию Давай сес определим Ну у кого нет у кого есть станция из вас у тебя есть станция нет Спасибо большое Вот смотри Да спасибо Ура Спасибо большое за доклад"
}