{
  "video_id": "XYD1UfsIHRg",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "у а всем привет но мне кажется с каждым из вас я поздоровался уже раза два три за эту конференцию ну привет еще раз многие из вас приехали на debug для того чтобы послушать сочные технические доклады ну я думаю что это у вас получилось вот смотрите сами здесь есть кафка в коберна это си есть кафка без кубер нету со есть cabernet из без кафки есть операторы есть даже дженкинс в общем у меня точно получилось послушать много хороших технических докладов и я знаю что инженеры любят читать и слушать про сложные штуки этим летом я неделю вел коллективный twitter в конце creed читал кто-нибудь человек кто-нибудь бы концы creed много народу да и там принято вот каждый ведет неделю свою и принято спрашивать у читателей о чем бы они хотели поговорить о чем интересно было бы рассказать на этой неделе и вот за мою неделю самым популярным твитам был вот этот про elastic на петабайт он сочный он технический я думаю из него получился бы хороший доклад давайте попробуем где экспериментов как поднять ластик для логов размеров петабайт все хотят узнать покупаете сервер но внимательный зритель поймет что в такой сервер петабайт не влезет видно да поэтому покупаете 12 на эти сервера вы поставите elastic бытует мнение что elastic это просто люсин вокруг которого обмазана немножко очень плохого сетевого кода так и есть но этот сетевой код стал получше в свежих версиях поэтому если вы возьмете 68 или старший или семерку то у вас все будет хорошо дальше вам нужно будет воспользоваться тем какие вы храните данные это логе логе пишутся в конец из из из старых местом только читают это редко поэтому вам хорошо подойдет архитектура которая называется ход форум вы сможете прочитать принял вот в этой статье 1 и мы взяли такие жирные железки на каждую мы поставим несколько нот и на те дату через которые показывал рекомендую поставить по 1 ход ноги на каждый ssd-диск ход но да это вот этой статьи по 1 вар вроде на каждые три четыре жестких дисках и т.д. хотя щихся и мастернода где-нибудь отдельно разместить естественно раз вам нужно старые данные перекладывать сход not навар моды потом старый еще более старые данные удалять вам понадобится автоматизацию вокруг этого написать ну вы можете взять intel индекс lifecycle management или что-нибудь написать еще вот это такая почитаете об этом в этой статье все ничего страшного все сделаете да вы не можете дать просто так людям писать логе в вашей ластик иначе он у вас умрет очень быстро не его убьют поэтому поставьте перед ним какой-нибудь брокер сообщений например кафку или rabbit ну все так делают я вот случайную какую-то статью в гугле 1 по запросу как писать логика вк увидеть в на ластик вот тут кафка есть вот ну и последний совет это слушайте других людей которые уже проходили этот путь вот например отличный доклад со свежей стачки жене дегтярева он в 2гис я делал вот то же самое он прямо расскажет со старта какие грабли будут лежать на ваши дороги ну все нормально доклад получился узнали что-нибудь новое видео кто-то должен сфотографировал полезная информация ничего не уходите разве это не то зачем вы пришли на конференцию разве в разве не вот не за этим вот вы приехали на defuse я честно говоря думаю что вы не должны быть довольны я честно говоря думаю что инженеры настолько заняты мыслью о том зачем как под поднять elastic на петабайт что совсем забывают подумать о том зачем мы это делаем а вообще-то сложные задачи у нас совсем не такие мне кажется что вот вот эту вещь сделать как раз совсем несложно знаете я за пять минут вам рассказал как это сделать а сегодня я хочу поговорить о том какие задачи по-настоящему сложные давайте попробуем еще раз всем привет меня зовут лёша и я расскажу вам про подлете инфраструктурной команды спасибо я работаю в контуре и чтоб понять где я нахожусь вам нужно немножко знать по конту где вот где мы сейчас на этой дороге в контуре работают примерно 700 инженеров в 80 командах а инфраструктуре в ком-то занимается примерно 80 человек я имею ввиду здесь низкоуровневая инфраструктуру то есть дата центре сервера сеть хастингса и тенге tslab вот это вот все конкретно в моей команде работают примерно 10 человек и в моей команде мы в основном занимаются телеметрии ну как вы поняли мы поддерживаем кластер ластика на петабайт на самом деле уже на полтора кроме того у нас есть графит в котором примерно 40 миллионов уникальных метрик прямо сейчас идут кроме этого мы пишем свою собственную систему а лифтинга мойра но не все сходу понимать что такое система лифтинга и поэтому я словами одного из пользователей вам быстро объясню что это такое это как alert manager только нормальный вот если вы хотите больше узнать про моего вы можете может быть вы были на моем докладе в прошлом году но если не были посмотрите у меня вот здесь на слайдах внизу такие вот ссылочки есть вы потом презентацию сможете скачать и посмотреть кликнуть по ней посмотреть мой доклад ну и кроме того мы еще делаем систему шину доставки телеметрии геркулес через которую проходит около миллиона событий в секунду а поддержку лесу можете тоже посылочки посмотреть доклад гриша кошелева вот а вживую геркулес можно было потрогать у нас на стенде вот это вот штука кто кто был у нас на стенде и дергал за проводочки или хотя бы через плечо смотрел ага ну я надеюсь вы сможете еще это сделать он прямо сейчас вы не сможете это сделать ваш член ноутбук забрал но потом вернемся вместе с ноутбуком и и поделаем и вот сейчас я стою перед вами узнаете у меня хорошая работа большая зарплата интересные задачи так зачем я к вам сюда пришел о чем я собираюсь вам рассказать дело в том что я на самом деле несчастный человека и я был несчастен все время пока делал эти системы все пять лет вы наверное не очень видите наверное вы думаете что я кокетничаю перед вами стою но на самом деле инфраструктурная команда одно из которых работаю я в жизни сталкивается с огромным количеством очень несправедливых обидных и сложных совсем не технических проблем нет таких для которых нужно поднимать огромные ластики или знать как там команды в linux работают сложность совсем не в этом и вот об этих сложных проблемах не технических я и хочу сегодня рассказать первая из них точнее даже 2 это ощущение контроля иллюзию простоты пять лет назад когда мы только начинали делать инфраструктуру команды в контуре делали все сами и самой большой проблемой нашей было убедить команду в том что она хочет перестать делать инфраструктурные штуки сама и отдать это нам почему это сложно дело в том что команда которая разрабатывает продукт она очень любит контроль над своим продуктом дело в том что команда это отличие отвечает за свой продукт перед пользователями отвечает деньгами отвечают недовольством этих пользователей да эта команда может быть не умеет отменить кассандру может быть они скачивают лифчик с кассандре на свои windows сервера распаковывает папку с flash кассандра в notepad + + редактируют конфиги и потом через толпу лера только санду запускает вот это скриншот это скриншот куда xeno я сделал в этом году он очень странно смотрится на сцене конференции противо в 2019 странно смотрится до ночи pad + + удобнее чем обычную тип от в два раза но как бы это странно не звучало у такого подхода есть плюсы дело в том что полный контроль менеджер команды знает кому позвонить ночью чтобы эту кассандру починить потому что есть инженер который прямо внутри команды и настраивал отказаться от этого очень сложно психологически потому что позвонить в вашу инфраструктурную команду может оказаться невозможным кто отвечает за вашу инфраструктуру вместе с этой проблемой приходят проблемой иллюзии простоты поставить себе свою собственную гафа ну или свою собственную кассандру и свое собственное все что угодно очень просто смотрите вы пишете в консоли докер ран минус d минус p3000 : 3000 графа нас лишь гав она все у вас есть своя кофан а зачем вам инфраструктура зачем инфраструктурные команды вы можете сами все делать в продукте и сайт вот с этими двумя проблемами в комплекса справиться довольно сложно но мне кажется что способ победить их это прозрачность на каждую из каждый инструментов пока жди сервисов которые мы делаем у себя в команде мы рассказываем зачем он нужен и как им пользоваться ну например у нас есть свой собственный http и бегает в который называется сингуляр и когда который мы используем для балансирования нагрузки между миков сервисами и про него мы рассказываем командам на вики страницы зачем он нужен потому что любой нормальный инженер спросят зачем вы написали свою штуку почему нельзя было взять что-нибудь из интернета готовая вы должны уметь от и быть готовыми это объяснять или например мы рассказываем про свои планы каждый год в осенью или зимой мы собираемся вместе всей команды из этих 80 человек и обсуждаем что мы будем делать в прошлом году и в следующем видео следующем году извинить и эти планы они становятся достоянием общественности все команды которые являются нашими пользователями знают что мы сделаем а чего мы делать не будем и это помогает им понять по пути им с нашими инструментами или не по пути ну и наконец мы ничем не хуже граф анны или кассандры у нас тоже есть документация сколько стартом и вот эту самую иллюзию простоты мы используем в том числе в своих целях вот например кусок документации на нашу библиотеку логирования который нам на 1 на один экран влезает полностью код который нужно для того чтобы эту библиотеку у себя подключите запустить оно написано выше я просто прострелил еще от еще одна вещь это гарантии да вот туда самое то самое нежелание расставаться с контролем от него помогает казаться как если вы знаете какие гарантии вам предоставляют инфраструктурную команда ганча отказоустойчивости гарантий сохранности данных при наших про нашу инфраструктуру мы пишем довольно много внутренних статей о том как это устроено и какие практики у нас используются и это работает против иллюзии простоты потому что когда вы объясняете как устроена между цинковая аппликация как устроена отказоустойчивость что мы делаем для того чтобы сохранить все ваши данные которые вы на вы нам доверили люди понимают что на самом деле самому это сделать довольно таки непросто кроме того обязательно нужно говорить как с нами взаимодействовать мы вот например используем для этого канала флаке у нас есть один новостной канал в которой мы пишем и которые на которые подписан и все наши пользователи мы пишем туда объявление о предстоящих работах а крупных релизах или о том что что то сломалось а ещё у нас есть канал поддержки в которой можно прийти и за вменяемые время получить ответ и вот время ответа в этом чате это один из ключевых показателей которые мы в мониторе мы к уменьшению которого мы стремимся ну и наконец моя любимая тема в прозрачности и the past марта мы здесь опять есть ссылка на доклад который отдел этой весной мне кажется это очень важно и паспортом и это то что вопреки наверное какой-то интуиции публикация информации о том как вы обделались она очень помогает установить доверие между вами и вашими пользователями мы ведем большой архив паспорта на в которой полностью открыт внутри компании там больше чем больше чем 1200 данный момент создания этой презентации отчетов и любой из этих отчетов можно по может прочитать любой инженер и на самом деле они они понимают правильно фотографировать а потом туда инсайдерскую информацию любой инженер может посмотреть как мы справлялись с проблемой и скорее всего осознать что сам бон с такой проблемой может быть и не справился или справился бы не так быстро когда мы получили прозрачность и победили вот это вот нежелание расставаться с контролем у нас появляются первые пользователи и они приходят они начинают даже что-то внедрять ну да конечно время от времени они говорят сейчас пока не когда вот мы сейчас дэвид доделаем важный без задач бизнес-задачи да и потом начнем вашу инфраструктуру в тоска час пока не когда если честно признаться такое мы на самом деле в своими слышал и это следующая проблема всего лишь следующая проблема с которой мы сталкиваемся ну когда мы провели небольшое исследование к проникновение наших сервисов то есть кто чем пользуется а мы поняли что чем чем более сложно понять пользу от сервиса и чем сложнее его внедрить тем меньше проникновения ну например метриками пользовались 80 процентов команд распределенными трассировка не только 20 процентов потому что на самом деле распределенной тусовки внедрить очень сложно а пользу от них понимают далеко не все и полезно они будут на самом деле далеко не всем ну и здесь как любом неравенства с двумя переменными у нас два варианта либо у нас бесполезные сервисы либо их слишком сложно внедрить для того чтобы сделать стопроцентное проникновение всех сервисов везде нам нужно легко внедряемые сервисы которые приносят огромную пользу давайте начнем с пользу допустим мы сделали какую-нибудь ерунду ну это бывает это ерунда никому не нужна как избежать этого как как перестать делать бесполезные вещи у меня есть два два совета это не исчерпывающий список это то что помогло лично мне во первых у нас есть уникальная возможность не знаю как вы скорее всего для многих из вас это тоже верно я могу выйти из своего кабинета на рабочие зайти в соседний кабинет и увидеть своих пользователей это роскошь которой есть далеко не у всех и более того эти пользователи они очень расположены пообщаться со мной и я могу просто взять и сесть рядом с дежурным инженером посмотреть что он делает на работе как он решает свои задачи какими инструментами он пользуется а какими нет помечает ли он все сообщения система лифтинга как прочитанные сразу и это означает что не работает система лифтинга или gp3 он логе у себя на серверах вместо того чтобы смотреть их нашей системе агрегации логов за пять лет работы в контуре я провел в паре с дежурным инженерами в сумме примерно полгода это те полгода о которых я не сожалею ни одной минуте еще один способ это аналитика по тем самым паспортом и когда которые мы собираем я очень подробно рассказывал об этом в докладе который здесь есть посылки а сейчас приведу вам из него один очень короткий пример однажды мы ну мы делаем это регулярно но однажды мы взяли вот массу накопленных по смартфонов которые у нас есть и проанализировали какими общими чертами они обладают и вот один из примеров это один из графиков которые мы опубликовали в статье в нашей внутренней соцсети оказывается существенная часть здесь есть такой пик посередине существенная часть наших fa cup of длится примерно 1 час почему так если закопаться поглубже и посмотреть эти эти посмотрим и окажется что на самом деле этот час большую часть этого времени занимает передача сообщения от того кто заметил аварию к тому кто может ее починить и вот она польза вот место где можно нести пользу это место где можно улучшить систему мониторинга место где можно улучшить и лифтинг сделать так чтобы сообщение о том что произошла поломка доставлялась непосредственно человек который может ее починить это реальная польза это способ не делать ерунды нужно получать аналитику из всех мест откуда ее можно получать допустим мы научились этими или другими способами делать полезные сервисы но что если их очень сложный внедрять никто не будет отдавать предпочтение задачи по внедрению сервиса если она занимает месяц или полтора все будут делать бизнес задачи и не будут внедрять вашу инфраструктуру поэтому вам нужно уменьшать сложность и рецепта уменьшения сложности на самом деле довольно просты и я их просто перечислю и не буду углубляться ну во первых этот тот самый quickstart та самая штука как у графа на или кого на всю и отёки логирование во вторых то что мне кажется очень полезным шаблон приложения то есть какая-то какой-то готовый код в котором внедрены все ваши штуки как в котором показано как ими пользоваться и какая от них есть польза лучше всего будете слеты будут не просто примеры приложений на осаду готовый шаблон например веб сервиса который можно взять сгенерировать свое новое приложение и начать писать туда бизнес-кот а потом его за деплоить и вообще не подключать самому никакие библиотеки не для метод не дала gear ova ней ничего другого ну и наконец-то чат поддержки по которой я уже вам рассказывал это тоже очень важно потому что если вы оставите пользователи один на один с документацией то вы будете ничем не лучше чем любой внешний сервер стенки полости ксир чьи это open source да где можно почитать документацию или поискать на stackoverflow но спросить по большому счету неё кого если если у вас что-то не получается это может быть вашим большим преимуществом а против того чтобы команда делала все сама ну например мы победили а вот эту проблему да и наши сервисы стали очень полезными и все все стало работать из коробки и чат поддержки есть куда можно задавать вопросы и к нам пришел успех да мы наверное можем теперь расслабиться потому что у нас есть пользователя как вы думаете можно расслабиться никогда не расслабляться потому что пользователь этой это на самом деле следующая проблема следующая проблема и возможно самая большая проблема с которой на сегодняшний день столкнулись почему так давайте посмотрим на метрики вот примеру 40 миллионов уникальных метрик которые приходят в наш график прямо сейчас для того чтобы выдержать такой трафик для того чтобы сделать эту систему мы сделали там большой дорогой кластер crack house мы поставили зачатков разные дата-центре или отказоустойчивые там через usps между не машите делается трафик что при падении целого дата-центр ничего не переставала работать очень крутая система два инженера full-time пеллет на сие нарасти всякие штуки для того чтобы это работало что это за 40 миллионов метрик вот пример истории которая произошла в этом сентябре я вам сейчас почитаю инженер пишет в чат всем привет кто-то может мне объяснить смысл такого числа медиков и дальше идет такая порча на куча метрик которые отличаются друг от друга только какой-то случайной циферкой в у руля на что произошло кто-то ошибся в коде из-за этой ошибки к нам графит прилетела 2 миллиона уникальных метрик в каждый из которых там есть только одна . дело в том что такие проблемы очень сложно отловить практически невозможно отловить автоматически ну кроме самых тривиальных случаев и но эта ручная операция она совсем не как почти нет ни автоматизируется или вот еще один пример у нас была система лифтинга да еще дома эры и она работала нормально но в какой-то момент начала очень сильно тормозить очень сильно нагружать историю с метриками почему потому что в ней стало просто очень много триггеров отправил проверки их стало очень много и все стало работать очень медленно и когда мы посмотрели внутри этой системы мы поняли что мы никак не можем ее поменять улучшить поступал что у него архитектура вот такая которую нее нельзя масштабировать ну ничего страшного мы написали свою называется мойра как этими архитектуры недостатками не обладает сделано иначе и вот мы пришли в ситуацию когда у нас два инженера full-time пишет нога систему лифтинга 3 инженер сидит раскачивает сетевой стек на очень жирным сервис 4 гигагерцовом процессор чтобы там редис побыстрее работал а почему почему у нас так много справил проверки в нашей системе а лифтинга откуда эти десятки тысяч триггеров но вы наверное уже догадались до из этих а когда мы посмотрели повнимательнее оказалось что из этих 30 тысяч триггеров на 15000 никто не подписан то есть они просто нагревают воздух проверяя свое значение и никто никогда не узнает о том что они упали почему этот зашло мы на самом деле боясь с предыдущими проблемами сделали такую инфраструктуру в которой очень легко автоматизированными средствами можно заехать у нее очень низкий порог входа у нее очень большая воспринимаемая пользы и нашей единственной целью было набрать себе как можно больше пользователей выдать как можно больше первых dolls инфраструктуры бесплатно чтобы люди заезжали в наш графит чтобы они слали нам как можно больше метрик ура у нас 25 миллионов метрику а у нас 37 миллионов метрик это очень почте очень греет душу нашим иначе нашими сервисами пользуются мы совсем никак не защищались от того что нашу инфраструктуру будут использовать нерационально и самое неприятное что мы в какой-то момент поймали себя на том что мы по 12 часов в сутки занимаемся очень сложными высоко нагруженными системами очень сложные по 12 часов в день все инженеры сидят и пеллет высоконагруженные проекты и у нас совсем не остается времени то что подумайте зачем вообще этому мы это все делаем на самом деле эти штуки они очень интересны это вызывающе и инженерные задачи и о них можно рассказывать со стендов вот значит стою такой на стенде контура и рассказываю вам про кассандру в которой в которой проходит миллион значит событий в секунду и вы такие вау какая у вас классная кассандра алексей ищите пожать вам руку можно позвать вас на бокальчик пиво вечер что позадавать пони и вопросы но и можно даже докладов немножко рассказывать это да это все очень мешает и мешает подумать о том какую пользу я приношу своей работой кому-либо кроме своего резюме вот и зимы у меня улучшается остальными грею просто воздух на самом деле проблема не рационального использования общих ресурсов она известна давно она это известно давно за пределами нашего это вашего идти за пределами devops она называется трагедия общин и если вы вы заинтересованы в академическом подходе к этому можете почитать эту книжку нобелевская премия тысячи девятого года очень рекомендую но я сейчас академическим языком с вами разговаривать не хочу и я хотел бы поговорить с вами о том какие подходы есть у нас к решению этой проблемы пользователей и нерационального использования нашу инфраструктуру я кажется здесь есть истинные и ложные подходы и ложный подход здесь это один из ложных подходов здесь это какие-то искусственные ограничения и навязывания каких-то странных барьеров ну например нельзя описать больше чем 100 лог записей в день почему именно столько непонятную еще один ложный путь который я здесь вижу это давление на совесть ребята сходите приберитесь своих virtual koch посмотрите может быть и что-то уже не используете удалите лишние правильный путь как мне кажется это придумать правила игры и здесь у меня не будет четкой инструкции для вас на я хочу рассказать три истории которые у нас были и этими историями проиллюстрировать как мы пытаемся с этой проблемой справиться первая история называется elastic весом в петабайт и это отчасти отсылка к началу моего сегодняшнего доклада точнее первому минина кладу отчасти отсылка к одноименному докладу моего коллеги вова который здесь есть вот сидит на заднем ряду вы можете с ним прийти и поговорить с ним по elastic а я с вами хочу поговорить не про то как его развернуть а про то как сделать чтобы в нем не было как вы догадались основная основе конфликт в этой истории между командой который кладет логин elastico команды которые поддерживают мы покупаем железо докупаем докупая налогов становится все больше и больше и больше не понятно как этим справиться с огромной кластер слугами и и что делать запрещать как-то или ограничивать и ведь сердце кровью обливается ведь мы только что дали вам шаблон приложения из которого логе сами туда идут а теперь такие по видите ребят давайте вы перестанете это делать это очень странно можно ли как-то иначе вот эту проблему решить мне кажется что можно давайте посчитаем сколько стоит хранить эти логе мы же покупаем сами железом узнаем сколько инженера времени у него тратит когда мы это сделали оказалось что положить 10 гигабайт логов наш ластик стоят весит 26 рублей что мы можем сделать с этой информацией дело в том что в контуре ну наверно как и у вас в компании тоже у каждой команды есть свой бюджет из которого оплачивается труд разработчиков из которого покупаются мягкие кресла для их поп и из этого же бюджета я верю в то что из этого же бюджета нужно оплачивать и систему логирования они с какой-то магической внешне кубышки деньги на инфраструктуру компании и вот эта штука она она делает поста магический результат нет ничего более определяющего для менеджера команды чем не возможность нанять себе нового разработчика потому что в блоге сажали все деньги вы мне скажете команды же перестанут их писать если это стоит денег давайте просто не будем писать логе на самом деле нет не перестанут если если система логирование стоит команде тысячи рублей в месяц это это это ерунда никто не заметит даже если 10000 тоже скорее всего это никто не заметит а дальше это всего лишь вопрос баланса между тем сколько пользы приносит ваш инфраструктурный сервис и тем сколько он стоит команде и если этот баланс не в вашу пользу может быть холода подумать о том чтобы перестать может быть вам нужно подумать о том чтобы перестать делать этот elastic на петабайт если его стоимость превышает пользу которую команды от него получаю а что вы об этом узнали сейчас то что вы не продолжали этого делать вы не скажете но ведь команду идут в какой-нибудь облачные провайдеры если мы начнем требовать с них деньги за виртуалке но и хорошо хорошо что идут значит вам нужно перестать делать то что вы не умеете делать лучше чем amazon это это тяжелая это тяжелая таблетках проглотить перестаньте или или научитесь делать луч это базовые правила можно расширять таким образом чтобы стимулировать правильное и рациональное поведение команд который пользуется вашей инфраструктурой например недавно мы обнаружили что мелкие индексы в ластики они приводят довольно большому оверхеды ну то есть получается что если кто-то создал яндекс и положил туда одну лог запись это обходится нам не вдоль и копеек как можно было бы предположить а намного дороже поэтому мы дополнили это правило вот таким мы считаем что неполные 10 гигабайт в яндексе тоже стоит весит 26 рублей в год магия и команды либо перестают так делаете пишут меньшее количество больших индексов либо оплачивает расширение кластер если им так удобных следующий стоя которое еще рассказать эта история про умолчания у нас есть труба для передачи телеметрии через который проходит миллион событий в секунды при не рассказывал ее можно было подергать нас на стенде так вот логе из этой трубы перекладывается в ластик вот примеру скриншот киба на одной из команд здесь видно что у них логов летит примерно 500 тысяч в минуту это одна команда только три слога в минуту и мы подумали а прикольно было бы еще завести центре suite как какая классная идея у нас есть труба для в которые лежат все логе мы можем просто поставить центре и в ней в него переложить все ошибки а команде а кому ни чего не нужно делать вот такие 1 и у вас внезапно центре появился бесплатно нужно идти в библиотеку втаскивать там учиться с этим как-то работать отлично же да отлично кто-то сказал нет это это на самом деле очень в духе вот вот того уменьшения порога входа для команд по которой я говорил да и у всех будет из коробки работать но правильно нет как вы думаете сколько ошибок в минуту влезет в instansing если вы развернёте его на какой-нибудь средний железки кто думает что 100 что 100 в минуту влезет 101 человек есть больше больше нет смысла увеличат то думает что 10 тоже 15 до нет на самом деле примерно 1000 до примерно 1000 но давайте про фильтруем блоге этой команды по уровню смотрите там есть одно место в котором какой-то один момент в котором 40000 логов за минуту было понятно что это просто бессмысленный нагрев воздуха если мы поставим кластер в центре и переложим туда просто все логе всех команд по уровню mirror то это будет нагрев воздуха и бессмысленная трата денег какой смысл пускать туда команды которые просто не готовы для того чтобы разбирать с помощью такого точного и сложного дорогого инструмента свои ошибки это бессмысленно делать и вот такие неправильные умолчания одна лишь только галочка неправильно поставленная по умолчанию ваших инфраструктурных инструментах она может приводить к огромному перерасхода ресурс просто так вы просто делаете какие-то действия которые никому на самом деле не нужны сейчас мы перекладываем в в центре логин свой мэра только тех команд которые про фильтровали убрали оттуда все ненужное научили своих инженеров работать с этой системой кстати про дежурных инженеров будет моя последняя история на сегодня как вы помните у нас есть чат поддержки пользователей с лаки вот этот я его уже показывал вот и в этом канале естественно сидит вся наша команда несколько десятков инженеров и пользователя ожидают что мы будем в этом чате отвечать оперативно я уже говорил что дашь нас есть такое слов сколько времени мы отвечаем на запрос пользователю но вот вопрос до собственной техподдержки выделенной или 102 как у димы стального мы еще не доросли кто должен отвечать на эти вопросы кто будет отвечать на эти вопросы ну может отвечать случайный прохожий то есть тот кто просто допустим там закончил свою текущую задачу там пошел чаю налил зашел в чате костную там там пользовать учетно спрашивали ну давайте я им поотвечаю на самом деле это довольно плохо будет работать потому что время ответа будет в этой ситуации непредсказуемым качество ответа еще хуже потому что тебе ответит случайно инженер который ну может быть не очень хорошо знает эту систему при которой идет речь может быть нужно просто всем членам команды включить уведомления и просто присылать push уведомления каждый раз когда кто-то приходит с вопросом пусть кто первый добежит тот начинает вопрос будет отвечать ну понятно это тоже проблема потому что тогда у вас все инженеры будут постоянно получать push-уведомлений с chateau постоянно отвлекаться может быть на самом деле я я предпочитаю думать об инженерах как а в одном из ресурсов вашей команды это тоже разделяемый ресурс который тоже можно объявить как как как и вашу систему логирования если так получается что ваши пользователи думают что можно к любому из ваших инженеров прийти в любой момент времени и задать любой вопрос то никто из ваших инженеров не будет ни какую полезную работу делать никогда и так делать конечно тоже нельзя наш ответ на эту проблему это дежурный инженер тот самый инженер в работа которого состоит в том чтобы делать всякие не запланированные вещи тот человек который сидит на пиджей и там на телефоне на с и получает алё о том что что то сломалось продакшене от роботов обязанностью этого же человека является отвечать на вопросы пользователей в чате и работу этого человека можно сделать легче и у меня есть для этого несколько рецептов я сейчас про них расскажу во первых у вас все равно должна быть одна точка входа для пользователей никто не должен писать никому в личку вы должны рекламировать своим пользователям одну точку входа но для нас это наш чат в этот чат можно написать да ответит в ту или иную в тот или иной момент времени возможно ответит разные люди но писать нужно всегда в одно и то же место во вторых вашим пользователям должно быть легко узнать о том кто сейчас jurid мы делаем это с помощью того же самого чата в топе канала у нас автоматически пишется ну и особенно если у вас много разных сервисов по которыми связные journey как у нас здесь написаны имена людей которые дежурят сейчас и которые можно подойти и спросить если что-то непонятно или например сократить вот это вот самое время реакции в момент факап а если вы точно знаете кто кто сейчас вам может помочь ну и наконец у дежурного возникает довольно много повторяющихся задач то что нужно делать постоянно при заступлении на держу что при обработке запросов пользователей и такие задачи должны быть автоматизированы у нас есть свой инструмент который мы для этого используем внутренней в нем ведется расписание дежурств и от этого расписание происходит автоматическая выдача прав на доступ дежурного в продакшен в нем начала статически поставляет эти самые топике в чате как чтобы все знали кто сейчас дежурит ну и все остальное ну вот мы научились с помощью этих трех приемов установить пользователей мы установили правила игры которые мотивируют наших наши команды наших пользователей рационально использовать инфраструктуру мы установили разумную молчание которые не приводят к нагрева воздуха и бессмысленному расходованию железо и людей и мы контролируем не запланированную работу которую выполняют наши инженеры закончились на этом наши проблемы я думаю что нет я думаю что наша команда проклятая обречена сталкиваться с новыми проблемами опять и опять ds пошел и себя где я нахожусь вот на этом пути к инфраструктуре мечты и я думаю что я где-то посередине потому что с одной стороны у меня кассандра на винде а с другой бесконечность если я если я ушел по этой дороге дальше вас то сегодня я рассказал вам немножко о том что вас ждет в будущем а если вы ушли по этой дороге дальше меня то я надеюсь что вы где-нибудь в коридоре расскажите об этом будущим не найдем ли мы с вами когда-нибудь до конца этой дороге я думаю что нет но пока мы идем я уверен что мы должны задумываться о том какую пользу мы приносим нашим командам и и о том какой ценой это пользу достается спасибо для тех кто эти ссылки на доклады который да вот это прямо поверх это было отлично я даже не знаю первая или вторая часть не больше понравилось это было первое конечно про этот самый про как там чего-то миллионы куда-то чего-то влоги власти петабайты вот это все да на самом деле к сожалению как то вы плохо задавали вопросы поэтому сейчас давайте все вынули телефоны зашли в бот и быстренько нажали я напоминаю нажали смотреть все доклады промотали на 30 число 530 и давайте пишите вопросы вот у меня есть такой хороший вопрос что такое гарантии между командами чем они обеспечены между разными компаниями есть финансовая ответственность далее целой а вот одна команда обещала 5 9 мая команда а не дала что как да это хороший вопрос очень на самом деле это во многом вопрос доверия на самом деле возможно вы доверяете вашему подрядчику который вам по договору обещал 5 девяток он этот договор не выполнит и вы получите с него какую-то денежную компенсацию но поможет ли это вам то есть поможет ли это вам как ты последствия от этого факап нивелировать не ну вроде все меряется деньгами если от этого пострадали наши клиенты то мы заплатим ваши деньги им если это какой-то был ну если репутация пострадала то это тоже как-то в итоге заливается деньгами но если ваш дата-центры обещая который обещал вам 5 девяток облажался и сделал четыре девятки ваши пользователи сейчас в интернете в твиттере не ведают пишут что ваш сервис как вам поможет материальная компенсация от вашего не ну я же говорил в итоге репутационные издержки тоже можно решить деньгами там значит этот кризис-менеджмент сидела ну конечно как бы но неприятно но в итоге это ну деньгами это лучше чем ой ну не получилось на всех свои вы нас простите и все такое а безусловно я не пытаюсь уйти от этого ответа на самом деле мне кажется что в нормальной здоровой организацию любой команды есть свои задачи и цели и если у команды которая делает продукт который продается за деньги пользователям есть цель заработать сколько нибудь там миллионов или захватить какую-нибудь там долю рынка своим продуктом тоо инфраструктурной команды есть другие цели и одной из этой из этих целей может быть но без по обеспечению от этого уровня отказоустойчивости и от этого может зависеть я не знаю бонус менеджера премии команды если мы пообещали вот такую отказоустойчивость то мы попросили на нее столько ресурсов да мы же защищаем перед руководителями свои планы на закупку железо и когда мы говорим мы нам нужно вот столько железа зачем вам столько может быть вам нужно меньше тогда меньше девяток правильно и потом отвечаем за то что мы сказали но перед руководством они привет вот елена вот это ответ на ваш вопрос вот и на самом деле молодцы накидали вопросов так и надо что с вопросами мне рабочее время что с личной жизни во время дежурства что если дежурный не эксперт и как их учить о классные вопросы я даже жалею что мне пришло в голову это в доклад вставить но для этого у нас есть прекрасная гостиная и прекрасная аудитория замечательно давайте по порядку что с личной жизнью это вопрос сложный у меня прям такого мега ответа нет этот эту договоренность да и у нас мы пытаемся делать такие инструменты чтобы дежурному не нужно было круглые сутки сидеть и вот так вот смотреть как график идёт а если график звук пошел вверх то значит вам такое там с красными глазами нет вы пытаемся сделать эту здоровую здоровую к систему мониторинга договорённость у нас такая у нас приняты в разных командах по разному но вот в структуре либо недельные либо половинку недели дежурство то есть один человек дежурит либо пол недели либо неделю вот зачастую есть запасной дежурный то есть основной дежурный должен там плюс минус все время ходить с ноутбуком под мышкой вот но мало ли бывает человек то может быть самолете где-то летит или там не знаю пошел пообедать вот ноутбук с собой не взял всегда есть запасной дежурный который в случае необходимости подхватит такая ротацию эту ситуацию одна неделя через and given количество людей 2 2 какие-то плюшки там день отпуска там или какие-то деньги немножко за о сроке не журят не одалживаете нет мне на самом деле не кажется что это такая работа по крайней мере в нашей инфраструктуры ты не такая работа которая требует частого овертайма или части работы по ночам пока по случаются но методом главное чтоб сбивает из из ритма да то есть у неделю которую дежуришь ты там именно концерт не сходишь с друзьями не по тусишь и в общем то она одаривает до следующей и следуй частью просто было про то как то есть журнале эксперт как их учить да у нас у нас на самом деле есть несколько идей часть из которых мы сейчас в нами формате гипотезы мы проверяем их и не знаем сработает это или нет когда команды было поменьше все знали про все то есть любой человек мог дежурить и хотя бы какие-то самые простые проблемы и шить сам а случай если проблема сложного там все взорвалось пожертвует а центре то он просто позвонить возбудить человек который может ну да и стандарные скорейшем подскакал да но по мере роста команды мне кажется что это возможность потерялась то есть если у вас 80 человек да очень много сервисов понятно человек который является экспертом в эластики вряд ли может починить switch cisco в дата-центре это становится невозможным у каждого человека появляется у каждого есть какая-то своя специализация тот сервис по которому он может дежурить и дежурство она разделяется на более мелкие зоны ответственности допустим я дежурю эту неделю по елка кто-то другой дежурит эту неделю пока бернес сейчас мы пробуем одну интересную идею пока я не могу сказать успешно она или нет еще пока не мало данных чтобы судить мы предлагаем инженером выбрать себе вторую специализацию то есть если я занимаюсь по рабочие все время занимаюсь поддержкой ластика но мне интересно еще посмотреть как работает кубер не раз я могу записаться в ротацию дежурных поверни таз и пойти у ребят ну ну такую стажировку не стажировку как-то пойти с ними обменяться опытом так чтобы я мог дежурить и тем самым впитывал в себя знание о том как это работает будет это хорошо работать или нет пока сказать сложно мне кажется что такое в google и делают да да да да вот как был вопрос такой наверное немного банальный но суть потому что вы задали какие-то основы дежурство нам нужно еще раз проговорить значит вопрос что ты говоришь что вы победили запланированную работу а на самом деле вы просто сваливаете ее на одного козла отпущения до нуля в точности то что это как бы хороший вопрос но это совершенно нормально потому что в общем то вся затея дежурство это что отвлекается кто-то один для того чтобы не отвлекались все да кто кто бы не задал вопрос я не запланированную работу нельзя победить она все равно будет ну на то есть кто-то будет отвлекаться соответственно пусть развлекается тот кто нужно да да нужно просто impact радиус вот уменьшить это не запланированные работы чтобы все кроме одного делали чего нет полезная один человек страдает но работа да вот еще такой да вот отличный вопрос если вакансии дежурного кота снизить стать что это может зачать котов у нас нет а вот действительно действительно хороший вопрос это как вы получаете обратную связь от разработчиков как вы меряете мтс вот это прям очень хороший вопрос да тут все время все время разные способами всеми что-нибудь пробуя нот и я говорил про тот способ который который посидеть в паре с дежурным инженера мне кажется что наиболее наиболее прямой способ получения обратной связи да я сижу рядом с человеком и слышу как он умудряется когда наш когда нашу моего использует на самом деле это наиболее такой наверно прямой канал можно не просто понять что что человек скажет как его спросишь а вот что сделать вот в нашем лифтинге чтобы ты начал им пользоваться он скажет но мне не хватает вот вот этой вот чтоб место зеленого цвета фиолетовый был побежали сделали значит фиолетовый цвет и а теперь почему не пользуешься а теперь мы шрифт не нравится это на самом деле то что люди говорят это может быть неправдой да то что они делают это не врет вот это наверное самый прямой эффективный но время затратный способ иногда мы делаем вот так вот такое исследование по проникновению наших сервисов команды то есть мы спрашиваем людей вот вот все что у нас есть поставьте галочки то чем вы пользуетесь на итак мы понимаем что если у вас где-то проседает и понимаешь что каким-то сервисом пользуются мало можно сделать вывод что возможно как вот в том неравенство дали бы от него мало пользы либо это или бы очень сложно внедрить но кроме то может быть и не надо вообще а может быть вал выкинуть нужно быть честным с самим собой проще если сделку это фигню то нужно перестать делать я я верю в отыскании вот ну и наконец дамы мы к сожалению наверное думаю что это плохо мы не не применяем вот-вот нпс данных промоутер скоро и вот эти вот методы исследования удовлетворенности пользователей которые применяются нормальные люди которые хотят честно считать вот могло продавца только тем что нам много всяких pull request of и фичи и квестов приходится наш чат поддержки мы там говорим спасибо ваше мнение очень важно для нас мы обязательно сделаем вот еще вообще план прекрасный вопрос значит вот вся история с бюджетом для других команд ну когда у тебя бюджет какому-то сторонний для стороннего амазона и у тебя бюджет кончился amazon и как не сильно волнует чуть окончился бюджет но кончился больше не будешь пользоваться со внутренними командами такая фишка не проходит потому что если внутренний команды кончился бюджет а им нужно сделать что-то очень-очень важное для бизнеса the business придет и вас заставит и после того как это сделано однажды вот этот вот процесс ну как бы бюджет кончился но все равно давайте сделаем то в общем то вся идея бюджета уже выходит в окно тут на самом деле ответ из двух частей будет состоять во-первых нас то можно заставить вот elastic заставить очень сложно вместо одного миллиона два миллиона в себя в кинуть вот если если если бизнес приходит с тем что им нужно вот что-то сделать это очень важно то значит бизнес может дать денег на сервере ластика новые то есть ребята пожалуйста мы мы можем вам хочет u10 видеть мощность это другая накрутить у другой команды они у них андрею tilite вот возьми их безусловно у нас есть некий там общий пул некое пространство для маневра но так или иначе но такие вещи в диалоге на самом деле решают если вдруг какая-то команда приходите и говорите что нужно там радикально увеличить мощность систему логирования для того чтобы наш новый сервис смог в неё заехать но на самом деле скорее всего это повод разобраться что это за такой сервис и почему он так много пишет логов может быть ему так много не нужно но в целом команда всегда может сказать нет все таки нужно тогда если это это нужно оно должно подкрепляться деньгами иначе ничего не выйдет в целом никакой магии нет amazon покупает себе сервера за деньги которые берется клиентов мы покупаемся деньги да на amazon может всегда когда клиенты отказываются платить сказать нет а вот вы не факт что можете сказать о прям любому из ваших клиентов я могу я могу потому что если они пришлют нам столько столько метрик сколько я не смогу записать и у меня вся система весь график взорвется от этого я конечно скажу нет я обнаружу свои обязательства перед всеми остальными если у меня одна команда сделает что-то что нарушает целостной системы и на самом деле ну защищаться от вот таких пользователей это одна из важных задач инфраструктурной команды то есть уметь делать свой сервис так чтобы не рациональное или деструктивное поведение одного из пользователей не затрагивала других да хорошо вот еще вопрос мы видели ваш прекрасный трек с прекрасным проектом который называется фак abs прямо красиво скажи мне о вас как проходит вот сам по смартом вот сам разбор полетов если там что то интересное что ты нам можешь рассказать это зависит от масштабов масштабов а капота иногда это какой-то много командное взаимодействие когда создается отдельный канал флаке играет отдельный созвон люди или все люди садятся все вместе в одну комнату решают эту проблему бывает это какой-то более локальный факап когда что-то произошло инженер может быть даже один инженер который эту проблему решал еще что она но настолько вот фундаментальное важное что заслуживает описание он просто садится этот отчет пишет я много об этом рассказываю в докладе не помнит то да вот нижняя самая ссылка на там есть презентация видео и там я прям сильно посвящен паспортом я очень рекомендую как бы самонадеянно это ни звучало вам о посмотреть на эту тему она правда очень важно для меня вот ну и конечно я и оттуда ссылаюсь на это и сейчас вам порекомендую почитать гугловскую книжку про и сырья атласе один студент назван handbook of duty инцидент response гайд и и еще всех к на кого я там ссылаюсь чтобы понять как делают это люди но я тут я не самый главный город в этой области я всего лишь на плечах гигантов style отлично действительно хорошие книжки они вот доклад имеет смысл посмотреть и такой как сборный вопрос из многих концернов которые все-таки возникают это наверное происходящим по сам немножко да потому что вот был вопрос а что делать если не знают идут еще пару вопросов а куда обращаться если значит нужна помощь а как же быть вот творог ланделл он с тем кого ты дергаешь они это не на дежурстве мне кажется это все вокруг искалечен паца вопрос вокруг узкого ищем пас я честно признаюсь у нас практично в некоторых местах есть формальные формальные описанные процедуры эскалации формально описанная цепочки как нужно звонить это обычно делается в система где у нас у наших у нас есть какие-то обязательства перед командами которые используют эту структуру этих команд есть какие-то обязательства перед их клиентами если такое обязательства перед клиентами есть обычно эта продуктовая команда имеет неких дежурных дежурных инженеров или кого то еще кто отвечает за то что вот этот вот вот эти соло выполнялись вот и в этих дежурных инженеров есть инструкции о том как нужно действовать к кому нужно в каком порядке звонить там через сколько минут случае недоступности чего у нас внутри вайфу структурной команде практически таких вещей нет и я думаю что все держится на на культуре на большой личной ответственности каждого инженера то есть такой ситуации что кто-то заметил что все горит и спокойно положил телефон пошел спать такого никогда не бывает просто потому что все члены команды несут коллективную ответственность за все коллективную одновременно личную персональную ответственно мне кажется это было больше не мне позвонили а я не взял трубку это большего ой мне сейчас нужно звонить алексею а он во первых мой начальник во вторых у него сейчас выходные мне как-то неудобно я надеюсь что всякой фигни не бывает честно говоря то есть чтобы мне кто-то постеснялся позвонить потому что я начальник это очень это очень них контур ну понятно ok хорошо да вот еще еще вопрос как учитывается время решения пока по да это ручками вписывается по факту или есть какие-то вот какие-то способы отслеживания в принципе вот товары иди и так далее это как правило заполняет торту заполняет паспортом то есть в этом отчете там мы ведем их в и треки мне кажется очень важная вещь в то что вот в том же самом гугловской гайде в сырья букетом пример и все они в гугл докс то есть они ведут эти отчеты в гугл докс мне кажется это очень неудобно потому что невозможно потом нормальную аналитик устроить если вы делаете отчеты об инцидентах в бак трекеров и треки или неважно где у вас есть поля там можете там все верить и поставить что-нибудь еще и в том числе вы можете сделать машину читаемые поля когда началось когда факап начался когда когда о нем узнали люди когда его начали чинить когда его закончили чинить когда закончились последствия и потом вы можете все эти интервалы времени по всей массе паспортом of скопились какой-то фильтрации там группировкой просто проанализировать и понять где у вас больное место где где долго так долго идет информация или долго или долго чиним а где выберите не хватает все эти вещи их можно по вот этим отчетом подобрать многих заполняют люди то есть некое требует аналитики я не думаю что можно сделать систему которая прямо вызова статьи зачем до на самом деле все равно потом в этом разбираться и смотреть все логии в стеке и везде и уже там можно вполне восстановить всю историю происшествия но на самом деле с такими публичными вопросами мне кажется мы закончили продолжение на в экспертной зоне спасибо большое это было прекрасно"
}