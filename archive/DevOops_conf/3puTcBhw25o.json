{
  "video_id": "3puTcBhw25o",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Ну что ж друзья Всем привет Спасибо что пришли собственно Давайте познакомимся Меня зовут Максим се инжениринг меня зовут Антон и Я немножко расскажу о себе чуть-чуть попозже Да поэтому Давайте сначала немножечко проснёмся Если вдруг кто-то Ещё не проснулся Разогрей А вопрос в тему наверное доклада кто вообще знает что такое форм поднимите пожалуйста ручки Замечательно Замечательно а кто ненавидит вот этот вот язык на котором приходится кодить вот отлично отлично супер супер много рук а не приходилось ли вам случайно сталкиваться С какими другими вариантами взаимодействия с форм допустим вот как раз-таки cdk либо может быть иные интерпретации о замечательно Да у нас есть о чём рассказать нормально Вот ну собственно что от себя хочу сказать что эта тема максимально близка потому что у нас тоже немножко свои странные отношения с рафо мы это всё делаем через названием Jet вот а Антон расскажет соответственно свой подход и своё видение и то как они с ним взаимодействуют а не буду отнимать у вас больше времени А вам хорошего прослушивания Атон тебе хорошего выступления Всем спасибо супер Понемногу начнём А я более расширенной Эксперт Ну в первую очередь из-за того что у меня много разных команд Да сложно выделить какую-то одну компанию но хочется немножко в начале проговорить свой путь да В первую очередь я именно разработчик я не devops инженер Я не занимаюсь администрированием Linux машин или VPS или чего-то такого и в первую очередь Конечно я занимался хайло дом всю свою профессиональную карьеру и работал в таких крупнейших компаниях как вот Яндекс Одноклассники а мира револют и делал самые высоконагруженные сервисы которыми я уверен вы когда-либо польз или будете пользоваться Также занимаюсь обучением инженеров То есть это создание платформ написание курсов и повышение квалификации для людей которые хотят узнать что-то новое и конечно уже в компаниях консультирования создани эффективных команд под конкретную задачу с конкретными условиями Ну ещё есть какие-то варианты связи со мной если вдруг кому-то интересно можно написать Telegram или написать email Welcome Я думаю что пообщаемся будет здорово а значит темы доклада сегодня мы поговорим про язык разметки hcl в рамках рафом будет такой курс общей анатомии поговорим более подробно что там внутри какие есть нюансы особенности Я думаю что большинство если работали с рафом так или иначе эти особенности знают Но кто не работал вот в зале не все подняли руки я расскажу чуть-чуть более подробно отметим плюсы и минус томен которые нам предоставляют с точки зрения официальной документации Ну и каких-то продакшн историй Да которые я лично видел и где есть определённые нюансы а перейдём в мир cdk TF А я расскажу про эту технологию более подробно сейчас пока не буду останавливаться Но скажу как А это ещё один альтернативный вариант использования платформы рафом для управления инфраструктурой собственно главная тема доклада и мы разберём в подробностях как это происходит Ну и конечно продакшн опыт потому что любая технология или любые инициативы они так или иначе накладываются на какие-то бизнес-требования это необходимо учитывать потому что всё что вы привносить вам нужно так или иначе отображать на какие-то реалии да А ну и подведём итоги сделаем выводы и вы уже сами для себя поймёте будете ли вы это использовать в продакшене или Рассмотрите это в каком-то проекте с учётом тех условий которые мы здесь рассмотрим для кого это соответственно с одной стороны инженеры Те кто рафом уже использует и понимают для чего он нужен но и на самом деле среди нас также есть разработчики так же как и я кто терраформ может быть никогда не использовали Но хотели бы с этой платформой познакомиться с этой технологией А ну и вообще понять Как можно его использовать и Если да то вообще как это происходит да более подробно Ну я думаю что сведением Мы закончили Давайте проведём такой курс общей анатомии Да с чем мы вообще работаем с чем нам приходится жить да в большинстве компаний Ну в первую очередь это hcl это configuration Language соответственно язык конфигурации который позволяет нам описывать инфраструктуру да В первую очередь мы знаем его как такой декларативный выразительный инструмент который позволяет нам использовать совсем немного конструкций да В первую очередь это объявление некоторых переменных то есть мым таким образом задавать некоторую конфигурацию А мы можем описывать блоками ресурсы эти ресурсы имеют определённо название и тип ну супер подробно не буду останавливаться Я думаю что это очень занимательно и понятно с точки зрения слайдов а то есть мы можем описывать какие-то параметры лейбла и описывать некоторые дополнительные нюансы как здесь это теги да для определённых блоков а но и мы можем делать ссылки на уже готовые какие-то ресурсы если например у нас есть одна команда которая форм использует другая нет но мы хотим в терраформер сами каким-то другим способом Ну для этого есть специальный блок Data и А мы можем выводить какие-то данные получившиеся после применения нашей инфраструктуры на продакшене Ну то есть мы можем вывести например М не знаю какой-нибудь IP адрес созданного VPS к примеру Да иту а а вроде всё достаточно Понятно Мы делаем две команды terraform и terraform apply а более подробно м Первая команда она сохраняет й спрашивает вас как вы хотите им управлять то есть состояние необходимо для работы терраформа для того чтобы А этот инструмент понимал как вашу инфраструктуру изменять Да потому что состояний бывает множество есть с одной стороны ваша Cloud инфраструктура но форм должен сохранять определённую мето информацию которая вам необходима для того чтобы Вы могли точно понять что необходимо в этой инфраструктуре изменить для применения той декларативное вы описали ну и соответственно ф apply создаёт план применяет а вашу декларацию для вашей инфраструктуры а но я думаю вы так или иначе взаимодействуя с этой платф фрмо вы сталкивались с проблемами роста да То есть вы так или иначе я думаю создавали какие-то модули или думали о том как можно расширять этот инструмент для того чтобы покрывать всё больше и больше кейсов или как только у вас появляется не одна команда например а несколько сразу же встаёт вопрос как на самом деле а использовать ресурсы повторно да то есть Возможно с какими-то другими параметрами вы хотите создавать там одни и те же кластера тогда на помощь приходят так называемые модули да то есть это главная единица инфраструктуры которую вы можете дублировать применять несколько раз Ну вот в данном случае мы создаём некий модуль он в рабочей директории А может быть создан в виде такой под директории от директории modulus а также форм позволяет делать ссылки на модули которые уже созданы они где-то задеплоить S3 или например в пакетных менеджерах Ну в общем есть определённые структурные вещи которые форм делать позволяет Ну в данном случае такой пример показывает как модуль можно создать Ну в этом модуле внутри находится по специфике несколько рафом файлов да и они тоже в формате hl и там можно описать те блоки которые мы смотрели до этого Ну соответственно в отдельных файлах да потом их рафом скон контини ет и применят в виде модуля Всё просто ну и точка входа конечно Это mtf где мы можем на этот модуль ссылаться вроде всё просто Да но форм этим не ограничивается мы можем уйти от стандартной декларативное делать какие-то дополнительные вещи Ну например у нас в зависимости от значений переменных могут быть какие-то условия эти условия мы можем проверять с помощью тернарного оператора также мы можем создавать блоки ресурсов несколько раз да то есть в данном случае мы хотим например создать несколько имн аккаунтов да то есть нус нашей инфраструктуре Почему бы и нет ну мы просто взяли занро в виде списка Да и уже сослались на этот список в виде такого такой конструкции там и Сыла с помощью лейблов который называются for Да ну вот такая конструкция вроде как всё ещё с одной стороны декларативное уже применение какого какой-то функции да то есть мы уже начинаем Мить и чем сложнее ваша инфраструктура чем больше вы хотите значений блоков переиспользовать тем больше такого кода вы так или иначе увидите да им начинает Ну всё сложнее и сложнее управлять Кроме этого любой инструмент не живёт в каком-то вакууме Да с ним работают в первую очередь люди и машины но для людей есть специальные там среды разработки Где мы можем так или иначе см работать случае вот я взял определил некий некую переменную Да например buet Prix Type string но при этом взял и присвоил например этой переменной Ну вот какие-то скажем список из строк Да но никакую ошибку я в своей среде разработки не увидел Хотя при выполнении ф apply она действительно будет и кажется что это не совсем корректно и это ломает такой общий exp да Потому Мы хотим использовать инструменты с точки зрения продуктивности какого-то удобства Но это удобство очень легко потерять А кроме этого любая инфраструктура которую мы сделали тестировать на продакшене это немножко страшно поэтому хочется потестить это более-менее локально Да ну вот из версии терраформа 1.6 появился инструмент который рафом тест который позволяет сделать интеграционное тестирование Ну в данном случае это можно тестировать и соответственно App у этого подхода тоже есть определённые нюансы но в первую очередь у нас появляются уже такие новые файлы Test Ну в данном случае для какого-то вебсайта мы делаем ссылку на модуль который Мы создали до этого и начинаем описывать тест-кейсы то есть в данном случае например для сайта Нам нужен какой-то Бакет мы определили значение переменных Ну и начинаем начинаем вызывать наш модуль и проверять Асер Тами Действительно ли тот или иной кейс случился да то есть мы проверяем уже ну фактически немного так программирую да В нашей инфраструктуре с помощью операторов сравнения начинаем вызывать дополнительные функции например файл md5 и так далее и так далее вот Асер тов может быть несколько Ну и самый такой кейс тестирования что мы уже начинаем программировать то есть мы начинаем разбираться Ага То есть у нас например есть какие-то ассерт значит они работают ну наверное сверху вниз то есть есть какой-то движок который нашу программу начинает выполнять и этот движок на самом деле нам жёстко приказывает что мы можем делать А что мы делать не можем а из-за этого у нас отсутствие гибкости То есть если мы например сде хотим сделать какие-то параметри тесты если мы хотим сделать например а генерировать эти тесты и как-то вклиниться в ту инфраструктуру которую нам форм предлагает это всё можно конечно сделать но это дополнительные сложности и проблемы более того существует отсутствие каких-то либо Best practices Да потому что и у нас есть стандартные инструмент с одной стороны но и есть спати инструменты которые предоставляют другие компании Ну например тест да то есть мы при использовании форма начинаем не только даже самой самим инструментом пользоваться но и какими-то вещами которые а разработали а в другом контексте другие люди это с одной стороны и плюс и минус потому что вы можете прийти например в компанию сделать не некий процесс вроде как начать с а простого рафом файла main.tf но он так или иначе у вас разра если вас станет больше и больше команд станет не одна две А3 А вы так или иначе придёте к каким-то сложным а контекстам к сложным правилам и ну всем этим будет достаточно сложно управлять Ну и Кроме этого если вы заводите что-то стороннее вам надо как-то настроить CD сделать дополнительные вещи необходимые для того чтобы запускать ваши пайплайн Да ну и есть конечно и Такие интересные смешные моменты когда например смотришь в определённый ИС на гитхабе и там приходят люди которые е неско лет назад одни и те же вопросы Ну например по поводу которых мы уже Немного поговорили вот а потом они приходят уже спустя много лет и задают эти вопросы снова Да уже в этом же треде Но на самом деле там ничего не изменилось потому что у разработчика инструмента фом Ну у него своё видение да свой на то как это в принципе должно быть и подм некоторые ито глазами разработками а в первую очередь это определённая декларативное Но это всегда плюс а никто не будет спорить я думаю что А в простых случаях понятность - это м огромное преимущество А расширяемость с одной стороны есть да модули Но эти модули должны следовать определённой структуре А И эти модули А при разработке они уже становятся на самом деле не всегда удобными иде перестаёт их понимать а и могут быть некоторые проблемы если вы например эти модули Используйте в виде каких-то ссылок например на модули не знаю где-нибудь в S3 или ещё где-то а доступность и понятность документации ну здесь как плюс и минус для разработчика небольшой минус Потому что есть порог входа то есть надо зайти на сайт почитать как это всё происходит но потом быстро втягиваешь Я думаю для тех инженеров которые форм используют уже нет проблемы зайти почитать Что предоставляет тот или иной провайдер и какие блоки ресурсов существуют ну масштабируемость здесь я поставил минус потому что инструмент по определению он декларативное как я уже говорил там написать Некоторые циклы условные операторы то возникают проблемы Но это минус небольшой но его отметить необходимо Ну поддержка IDE Это точно минус потому что она несовершенна инструмент не такой что и молодой с одной стороны но явно у производителей инструментов для разработки есть свои приоритеты конечно ну и гибкость я бы не сказал что она большая потому что такие конструкции в виде композиции абстракции они не сказать что доступны то есть всё что мы можем сделать это некоторые модули А да мы можем сделать там свои провайдеры завести свои типы блоков Ну а так взять и например сделать свою какую-то User define function Ну уже будут сложности А ну и тестируемой тестируемой в каких-то продакшн системах которые я видел к ней всегда были определённые вопросы то есть да можно модули но сделать интеграционные тесты сделать так чтобы они были понятны И самое главное в любом тесте важно чтобы Вы могли его отлаживать вот такими возможностями уже форм не обладает то есть условно говоря Вы не можете зайти в вашу любимую поставить какой-то брейкпоинт и увидеть что там на самом деле происходит то есть в этом огромный минус И в понимании системы Это так или иначе отобразится и порог входа для разработчиков это всегда такой инструмент который они не очень любят То есть если вы обычного разработчика на языке программирования высокого уровня попросите изменить что-то в инфраструктуре вы встретите скорее всего большое сопротивление потому что мало того что необходимо понимать как эта инфраструктура устроена это ещё Ладно иногда разработчики которые имеют определённый опыт они так или иначе умеют с этим работать Да ну то есть они понимают что есть в их инфраструктуре что есть в их контуре Но как только вы попросите их какие-то форм файлы там модули поменять Ну вы столкнетесь проблемами они перестанут отвечать на ваши запросы будут переадресовывается то что я думаю в больших компаниях Вы видели неоднократно Ну и самый такой главный момент здесь бы хотелось поговорить подробнее Что А рафом - это infrastructure CDE но без кода то есть всё о чём мы сейчас говорили это некий язык разметки который позволяет вам декларативного это не язык программирования всё то что а создавалось последними десятилетиями в терраформеры но вы не можете создавать там классы вы не можете создавать какие-то функции вы не можете использовать стандартные пакетные менеджеры которые уже давно есть во всех языках программирования Это конечно не очень удобно Ну более подробно Давайте посмотрим на эту задачу со стороны разработки Ну вот действительно У нас есть уже знакомые языки программирования У нас есть знакомые конструкции мы все умеем работать например с операторами не знаю цикла или может можем писать условные конструкции какие-то У нас есть инструменты для абстракции композиции мы можем писать классы мы можем собирать их в модуле У нас есть отличная поддержка idee А как я уже говорил пакетный менеджер доступен во всех языках А ну и на самом деле всё что нам и инструменты тестирования безусловно они развивались icd про них отлично знает а иногда мы можем даже получить красивый аутпут в вашем лабе или в Team Сити что действительно позволяет находить проблему быстрее А ну у нас вроде как бы есть всё но нам не хватает одного элемента о котором мы сейчас и поговорим да нам бы хотелось бы получить в конце концов некий hcl файл то есть произвести операцию трансляции из из языка высокого уровня в некий низкоуровневый Ну давайте так скажем ассемблер в виде hcl а потом уже этот его применить средствами форма собственно это всё Что необходимо для того чтобы разработчиков затянуть в управление инфраструктурой с точки зрения написания таких скриптов Да ну и поговорим про cdk более подробно это Production level инструмент который выпустила наверное где-то 2 года назад ну такой prod его можно использовать в реальных системах в реальных проектах с поддержкой разных языков но мы про это поговорим чуть-чуть подробнее попозже что он из себя представляет концептуально в первую очередь это CD позволяет использовать все те же провайдеры и модули которые вы можете найти например на официальном сайте Или те которые вы создали вы можете создать приложение с помощью команды яке программирования вы можете написать ваши декларации блоков и ресурсов те которые вы делали в hl файлах выполнить команду cdk TF Sync и после этого получить terraform htl F Ну по умолчанию на формате Jon но вы можете определёнными флажками получить даже человекочитаемый hl файл ну и соответственно с помощью команды cdk TF deploy Вы можете выполнить команду apply которая применит эти изменения создаст план и также как и в случае форма спросит у вас хотите ли вы этот план применить на реальной инфраструктуре Ну и работа со й файлом она абсолютно такая же и ничем не отличается То есть если вы хотите использовать тот базовый набор управления состоянием он абсолютно такой же и Поговорим немного про поддерживаемые языки как правило в компании есть определённый набор языков или может быть один основной язык который компания использует А ну и я думаю что так или иначе люди которые занимаются программированием на бкдет себе а язык из этого списка А ну в данном случае у меня большой опыт работы на Java как я уже сказал я буду говорить больше о ней но формально А те слайды которые пойдут Дальше они будут применимы и к другим языкам программирования потому что А так или иначе конструкция этих языков Ну наверное кроме го они так или иначе похожи То есть это объектно-ориентированные языки Ну или с поддержкой объектно-ориентированных конструкций и я думаю что вы найдёте много общего но может быть там какие-то синтаксические нюансы будут А прокомментированы ну в первую очередь cdk TF и позволяет создать вам проект выбрать язык а в данном случае Java и вы получите По итогу готовый проект в вашей директории где вы эту команду выполняли и по умолчанию будет доступен один файл который также за вас CD ktf создаст он из себя будет представлять обычный класс как мы видим вве есть класс Main по умолчанию у него есть Public Static и в этом классе будет Вот такая странная конструкция да то есть будет New App это некий класс создан Да объект этого класса дальше будет создан некоторые параметры в конце выполнится команда которой мы уже говорили это Apps которая так или иначе создаст hcl файл Вот и здесь мы поговорим подробнее Да значит что такое Main СК Ну я думаю что кто-то работал Возможно со стека в терраформеры которая позволяет описывать некие некие части в виде например в виде окружений То есть например ва есть окружение может быть какое-то тест окружение или окружение Вот стеки они позволяют эти окружения описывать А по структуре Вот который будет создан он наследует фмк соответственно Так мы определяем что это ресурс определённого типа и Обратите внимание мы начинаем использовать язык программирования но также в декларативное мы видели в H файле Ну то есть в данном случае мы также включаем провайдер У него мы можем установить уже те же лейблы и сделать это в отличие от ля мы сделаем это типизированного на строчку там где ожидается строчка где ожидается список мы передаём список и ещё до тестирования Мы можем с помощью среды разработки понять ошиблись мы где-то или нет потому что статическая типизация Ну в данном случае при использовании языка jav или Например если вы будете использовать CP или Go вы это получите бесплатно это большой плюс я крайне это рекомендую и на больших проектах это всегда будет играть на руку а ну и посмотрим как мы можем уже создать не модуль Да потому что модули в cdk TF они уходят на второй план мы используем конструкции языка для того чтобы описывать некий набор ресурсов Да и передавать в них определённые параметры Ну давайте рассмотрим это более подробно То есть если мы хотим создать какой-то скажем сервис в Google клауде а что нам необходимо нам необходимо его как-то описать Ну сделаем это также декларативное у него будет какое-то имя а там будет какой-то docker Image а возможно описание М не знаю портов внешний он или внутренний потому что нам надо будет создать балансировщик Да а описать некоторое ДНС имя и А как только мы такой класс создадим который позволит нам создавать конфигурацию для а такого описание мы можем уже создавать сколько угодно таких сервисов это же огромное преимущество и любой разработчик на языке jav это может сделать достаточно быстро и посмотрим как это выглядит с точки зрения реального кода А ну здесь слайд немножко посложнее но я его так опишу значит мы создаём новый класс он сверху экстен то есть наследуется от такого класса который называется Construct constr в терминах терраформа - это некий расширенный блок Ну условно говоря блок ресурсов а но с дополнительными возможностями он а может в себе Он может быть как модуль то есть быть набором неких ресурсов но также Он позволяет а скажем подписываться на некоторые события жизненного цикла вашей конфигурации То есть вы можете например взять и внутри а сделать какие-нибудь вещи в виде обхода всех не знаю созданных ресурсов других классах и там применения не знаю сохранения куда-нибудь этих не знаю в какой-то дополнительный ж вдруг вам это надо на самом деле не то чтобы я это сильно много использовал кажется что это такая дополнительная возможность но упомянуть её стоит Ну и того мы создаём некий класс о в конструкторе принимает Cloud Run config Ну и на самом деле Вот мы описываем наш Cloud V2 сервис и это уже тип ресурса который вы можете увидеть в документации внимание если мы зайдём на официальный сайт форм провайдера для Гугла мы увидим всё тот же пример который Как видите один к одному транслируется в наш Исходный код на языке Java и Это же прекрасно потому что нам не нужно читать никакую дополнительную документацию для сгенерированного кода возможно вашего языка программирования вы видите всё то что находится уже на сайте и делаете по образу и подобию то есть никаких новых конструкций вам здесь знать не обязательно это Также вы можете создать в этом же классе скажем ресурсы для DN записей создать балансировщик условными операторами проверить и балансировщик должен быть или Эл и сделать всё то что вы делаете в целом в форме но уже в языке программирования А что будет дальше происходить как я уже говорил есть команда cdf Она выполнит ваш класс и создаст соответственно обычный hcl файл в формате J но уже в директории вашего проекта то есть Обратите внимание создаётся директория CD ktf Out и в ней Через несколько директорий создаётся CD ktf J для каждого стека Ну в данном случае devops 2024 означает что у нас есть такой стек Да вот и как я уже говорил он фоте J но передаче дополнительного параметра Вы можете даже получить человека читаемый файл и возможно У вас есть какие-то дополнительные инструменты валидации которую вы используете для процессинга ваших hcl файлов вы также можете их применить в вашем CCD палай и сделать например дополнительные статические проверки необходимые которые вам нужны для того чтобы проверить действительно Вы можете такую конфигурацию на продакшене применять или нет Вот это очень удобно и здорово а в конце концов применить такой htl файл Вы можете с помощью команды CD ktf deploy и А это так или иначе вызовет несколько команд если А ещё hcl файла нет то он создастся потом создастся план и выполнится так или иначе terraform apply вот никакой магии такое же управление состоянием А всё то же самое то что с чем вы работали уже в терраформ бонусы потому что любой подход он так или иначе обладает какими-то плюсами да про минусы Мы тоже поговорим Ну в первую очередь это понятные тесты которые пишет любой jav разработчика или разработчика на языке высокого уровня каждый день да то есть это тесты мы можем создать некий стек А синтезировать из него hcl файл но уже в памяти и соответственно а проверить что этот hcl файл а он имеет некоторые ресурсы с некоторыми параметрами Ну в данном случае что имя оно соответствует Example App и Это же прекрасно потому что вы можете например такие тесты отлаживать Вы можете смотреть Какое состояние памяти вашего приложения и делать всё то что вы делаете в языках высокого уровня А подведём некоторые итоги что cdk TF - Это отличный инструмент он даёт баланс декларативное То есть вы можете декларативное ресурсы так как вы это делали в обычном htl форме отлично расширяемость Вы можете создавать какие-то наборы классов например а паковать их в модули эти модули шарить между разными командами и А эти файлы будут э распространяться в виде модулей которые любая команда может подключить более того Вы по умолчанию получаете э версионирование а проверку целостности и отличную поддержку IDE потому что ваше IDE Уже понимает как работать с модулями на языках программирования не надо её этому учить а доступность и понятность документации - это тоже большой плюс который этот инструмент привносит Вы же действительно используете всё то что вы использовали для терраформа на официальном сайте вы можете увидеть все типы ресурсов типа провайдеры но при этом есть и дополнительная информация по языкам программирования переведена на любой язык мира А можно зайти и почитать отличная масштабируемость можно Описывать как и самые простейшие конфигурации в виде одного файла но делайте более сложные структуры хотите использовать какой-то дополнительный метод или функцию без проблем а сделали используете а проверили тестами написали интеграционные тесты А ничего сложного а поддержка IDE ну здесь только один плюс э уже м несколько десятилетий компании работают над тем чтобы работа в ваших языках программирования была эффективной и А продуктивной ну тестируемой а в принципе Понятно вы можете писать и Юнит тесты интеграционные тесты функциональные тесты Ну на самом деле любые интегрировать в их все icd pipeline и а запускать вместе или по отдельности а из минусов конечно это порог входа и здесь очень важно сказать что всё будет зависеть от той команды или компании Где вы так или иначе этот инструмент привносить потому что А если разработчику достаточно легко рассказать что у него есть новая библиотека которую он может использовать и генерировать ФМ файлы то ну не каждый инженер из devs департамента в целом готов писать Например на языке Java То есть тут надо всегда балансировать и находить некоторые консенсус а также разговаривать с людьми потому что любые процессы которые вы делаете они так или иначе влияют на то как люди с этим инструментом работают повлияют на найм и ну в общем-то будет говорить о вашей компании либо с плохой либо с хорошей стороны я надеюсь что с хорошей Ну и про CCD хочется сказать отдельно потому что придётся конечно а скрипты а тестирования применения А ну так или иначе научить э использовать потому что А если вы раньше использовали а только инструмент ФМ то в данном случае у вас появляется дополнительный шаг То есть Вам необходимо будет например в случае там jav или C Шарпа а скомпилировать вашу программу потом выполнить вот этот cdk TF Sync и в данном случае Конечно ваш CD pipel должен обладать определёнными свойствами Ну например раннеры должны были должны должны будут готовы использовать скажем gdk Да Java develop Kit для того чтобы можно было скомпилировать Вашу программу потом её запустить иногда это возможно иногда нет поэтому применяйте любую технологию сумом Ну и самый главный бонус который вы получаете в некотором смысле границы потому что ваши разработчики намного проще будут входить в этот инструмент работать с этим инструментом и работать с инфраструктурой о чём мы говорили до этого не только на уровне пользователей Но и на уровне создания этой инфраструктуры изменения её параметров Это здорово потому что любой разработчик который разбирается в инфраструктуре разбирается в сетях в базах данных это разработчик уже совсем другого уровня его можно уже использовать не только как некого человека который делает продуктовые задачи но он начнёт с удовольствием вникать и дальше его можно ставить на расследование инцидентов возможно производить какие-то более сложные манипуляции те которые до этого Он не совершал То есть вы будете в некотором смысле заниматься обучением и это здорово и хочется рассказать про мой опыт который был с инструментом C продакшене когда я прил в команду была Постав создания инфраструктуры управления этой инфраструктурой но в первую очередь на что я обратил внимание Когда в эту команду пришёл это конечно состав команды потому что А я посмотрел что Да есть несколько инженеров на jav и на котлине есть ML инженеры ML инженеры в основном используют инструмент Python А язык программирования который позволяет им писать какие-то Machine Learning вещи Да которые там делают определённую магию а но не было никаких выделенных devops инженеров и в данном случае создание например инфраструктуры с помощью языка разметки hcl Ну вносит определённые сложности потому что никто из этих разработчиков язык не знал Да То есть им придётся в это вникнуть вкатиться ну и это определённые сложности с которыми мне пришлось бы столкнуться а а для чего мы это всё делали Ну инфраструктуры было много то есть необходимо было уметь создавать такие кластера нату для того чтобы предоставлять некоторые инструменты взаимодействия Для различных компаний и эти кластера необходимо было изолировать и использовать их не в виде каких-то даже докер образов запущенных в одном кубернетес кластере А этих кластеров было несколько там были отдельные сетевые правила DNS имена и всё-всё-всё то что вы используете так или иначе в одной компании но надо это было транслировать и сделать так чтобы всё это было Независимо и работало постоянно без каких-либо проблем а и какой бонус Я уже получил Да после того как привнёс этот инструмент что разработчики после того как они поняли как это всё работает они начали сразу же отвечать за инфраструктуру то есть если разработчик делает какие-то изменения и эти изменения деплоя то всё что он делает если это ответственный человек Он начинает это эксплуатировать То есть просто Некому было это всё передать и да были какие-то моменты связаные например с наращиванием экспертизы потому что не все разработчики знают что такое например использовать какой-нибудь VPS в амазоне Или например как работают ДНС записи в некоторых нюансах всё это необходимо было конечно нарастить но в моменте это оказалось сильно проще чем нанимать отдельную команду которая бы всё это поддерживало ну и конечно прозрачность и скорость разработки это самый большой с точки зрения бизнеса потому что всё что мы делаем мы так или иначе делаем для того чтобы бизнес рос и развивался а людям платили хорошие деньги за то что они делают они получали от этого удовольствие То есть это сплошной вин-вин который удалось добиться достаточно быстро и легко Вот с использованием правильных инструментов всё то о чём мы так много говорим и так часто применяем Ну и на самом деле такой бонус Что А это и Def и devops да то есть мы получили некоторую структуру которая позволяет а самой себе а использовать самый главный подход о котором все мы здесь говорим Да это devops практики в виде того что этим занимаются Ну в данном случае одни и те же люди а давайте сделаем некоторые выводы наше время подходит к концу а Ну значит CD ktf ещё раз хочется подвести некоторую черту а Используйте этот инструмент он Production Ready А уже как несколько лет а он привнесет лучшие практики разработки по всё что вы можете прочитать в интернете с точки зрения и чистого кода и архитектуры и инструментов а вовлечённость позволяет вам действительно писать настоящий код на языке программирования высокого уров занима инструментом который позволяет только лишь декларативное сложные вещи Вот спасибо вам большое И я готов к вопросам и надеюсь что будут ответы Итак что ж я тут неожиданно вспомнил что я забыл сказать прод оставляйте пожалуйста обратную связь по докладу задавайте вопросики если они есть и да Антон Спасибо большое это было круто Давайте перейдём к вопросам если тщательно отлично Давайте молодой человек Добрый день Антон Спасибо большое за доклад очень интересно у меня такой вопрос Вот про расширяемость мы сейчас работаем с аблом и нам очень нравится что можем на а написать модуль который на чистом питоне может проработать с с с сделать сложные вещи форме этого очень не хватало в своё время а вот то что вы сейчас пишите на каком-то оп своё решение там нажа чем-то ещё это позволяет вам получить какой-то расширенный функционал формы или вы всё-таки ограничены возможностью hcl форма и не можете добавить каких-то своих там кастомных функций модулей чего-то ещё А да почему Мы ничем особо не ограничены потому что мы по итогу же получаем Ну есть мы занимаемся тра правильно то есть мы транслируем некий язык высокого уровня в htl файл То есть фактически Мы например в случае там джавы или питона мы можем например зачитывать конфигурацию из какого-то например не знаю внешнего источника Ну например из базы данных проблем никаких да более того мы можем там какие-то не знаю метрики сделать дополнительные если нам необходимо да то есть ну понять какие-то нюансы которые в hl файле по умолчанию мы получить не можем да и в целом как и в вашем случае я думаю что те практики которые вы использовали для того чтобы написать Python модули Да вы можете также и здесь писать на пайне например и делать всё то что вам необходимо то есть каких-то глобальных ограничений на самом деле нет но надо всегда иметь в виду Да что так или иначе после трансляции уже cdk atf никакого участия не принимает да То есть Вам необходимо также управлять файлом Вам необходимо также применять этот где-то что-то хранить если вам ходи Ну и всё такое то есть глобально Ну ограничений нет то есть вы можете Да любые дополнительные пакеты которые уже в вашем языке программирование созданы например на питоне вы используете не знаю там какие-нибудь стандартную библиотеку там работы с кмм Как вы говорили да Ну тоже самое в Джаве То есть вы можете взять любой пакет с мейна и его применить а разработчики этого пакета про ваш workflow работы CD ktf даже и знать не знали Ну то есть всё будет работать Хотел просто уточнить Просто вы говорили что трансляция идёт в обычный классический hcl файл в котором при нет даже функций Угу А Вы говорите что то что пишете на Джаве оно как-то решает эту проблему или неправильно понял А ну смотрите То есть если вы например пишете скажем в цикле в Джаве к примеру Да вы создаёте например в цикле Бади создаёте ресурсы Ну соответственно вы запустили цикл 10 раз но вы увидите 10 раз соответственно созданный блок в конечном файле то есть в этом плане вы получите какой-то hcl ну такого более низкого уровня конечно там эти циклы они отображены не будут потому что cdk TF Он не разбирается в том как ваша программа устроена Всё что он делает он лишь её запускает и вот ожидает что вы напишите правильный код который скомпилировать в hcl файл всё понял спасибо большое единст хотел бы пряно чуть-чуть дополнить ответ тут получается так что мы в этом плане не ограничены по функционалу генерации нета точнее джисона Простите но вот этот результирующий он всё равно упрётся в то что может делать провайдер То есть если в провайдере не прописана возможность добавлять какие-то лейблы на виртуалку то мы это не сможем соответственно сделать и он упадёт Да конечно и тоже самое как например с рофомс применятся и эта магия она тоже никуда не уходит Но самое главное что в cdf Вы можете сделать например дополнительно проверки чтобы у вас на этапе синтезирования то есть этого файла скажем ваш код упал и Вы получили информацию ещё до того как вы этот план попытаетесь применить Ну то есть это тоже здорово и позволяет делать Ну более сложные интересные вещи так дальше у нас есть ещё ручки Спасибо за доклад у меня простой но может быть важный вопрос работает я честно говоря не заводил насколько Эта история Заведётся Мне сложно сказать надо пробовать вот больше нет спасибо День добрый У меня вопрос такой провокационный А в чём кейс потому что рафом - это ну просто дёргал I по сути больше ничего просто достаточно ум и выглядит так как будто инфраструктура должна быть максимально статичной максимально Ну в рамках разумного естественно максимально детерминируемость первого взгляда А когда у нас код мы смотрим в код и мы не можем определить А что там реально будет пока мы не увидели план А у нас так и получилось что наша инфраструктура в данном случае как я уже говорил она максимально динамична нам приходилось такие кластера создавать А с определёнными нюансами и параметрами много-много раз то есть а так сделать чтобы мы написали один модуль в этом модуле можно было а описать всё что мы хотим к сожалению не получалось Вот поэтому как я уже говорил нельзя инструмент э принимать Ну просто и применять просто потому что он существует Да необходимо отталкиваться от требований в первую очередь бизнеса и той структуры команды которая у вас есть Но в нашем случае это хорошо зашло потому что вот эта динамика которая позволяет язык программирования добиться легко а она хорошо легла на инфраструктуру Но если у вас простой кейс и это статичная конфигурация с понятными блоками ресурсов которые уже есть в ваших провайдерах А можете не усложнять не надо этого делать то есть я об этом и говорю весь доклад что любой инструмент хорош в определённых ситуациях поэтому Ну нюансы есть да а если не секрет какой юзкейс не покрывал с статичными htl файлами плюс там ну не знаю ка простенький впер на питоне или Гра terate вот такие бизнес практики обще употребимые Ну например в случаях создания инфраструктуры Для различных заказчиков Скажем мы создавали наборы пайплайф Да и понятно что где-то отличались версии понятно что где-то отличались какие-то параметры в виде лимитов да и это легко работает с терраформ но нужно было там для некоторых случаев запускать какие-то дополнительные а-а ограничения настраивать дополнительные там Записи где-то поднимать пины всё это можно было описать в виде отдельных модулей в терраформер некоторая целостность структура то есть мы попробовали изначально так делать но как я уже говорил инструментарию разработчика он ограничен да То есть вы ш сели не всегда всё понятно с точки зрения комбинации модулей которые вы создаёте и вот эта динамика Она лишь усложняли сложно было тестировать мы не могли тести тестировать несколько модулей вместе то есть я вот показал пример который хорошо ложится Когда у нас там модуль один но как только модулей становятся несколько они должны работать в определённой комбинации то Ну уже начинаются проблемы Ну и Кроме этого с hl файлами если мы дополнительно используем какие-то а внешние обёртки там например на питоне или на го а Да так можно делать и многие компании действительно идут по этому пути но мы подумали Зачем если есть cdk TF и Это вроде как официальный путь который можно использовать то есть всё хорошо В зависимости от ситуации Ну вот эта ситуация у нас была да отвечу на предыдущий вопрос по он тофу Да с онф работает через переменную Раф binary name Что ж Всем спасибо Ещё раз спасибо Антон увидимся в дискуссионной зоне Спасибо вам"
}