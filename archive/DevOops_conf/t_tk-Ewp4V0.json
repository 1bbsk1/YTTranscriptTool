{
  "video_id": "t_tk-Ewp4V0",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "всем привет заходите рассаживайтесь меня зовут лена кирпичников я сегодня расскажу вам чего мы научились пока делали собственную систему а лифтинга я буду слова летом часто применять вместо вот этих вот 4 словно чтобы быстрее было простите мне этот жаргон вот перед тем как начать я хочу рассказать вам каким будет этот доклад дело в том что большинство докладов про системы мониторинга по сетям момент тинга они довольны технические то есть выходит человек рассказывает смотри какой какой pipeline метрик мы построили смотрите какая эффективность тора чел выдерживает 100 миллионов запросов в секунду и очень компактно хранить метрики посмотрите какой отличный интерфейс посмотрите какой замечательный кот мне честно говоря на такие доклады некоторое мин назад перестал интересном уходить потому что мне кажется что история про лю кенг эта история про людей больше чем по технологии почему на самом деле система рейтинга система которая высылает вам уведомление когда что-то не так это система которая имеет наиболее прямой доступ к вам как человеку вот у меня на руках есть часы и система лифтинга который работает нас в компании это единственная программа которая может в любое время дня и ночи непосредственно со мной пообщаться через эти часы или уведомление в телефон и прислать и поэтому гораздо важнее то как эта система как как я в ней работают чем-то как оно устроено внутри вот и мой рассказ это будет рассказ о дизайне системой лифтинга но дизайне в хорошем смысле не нет ни о том почему у нас кнопка зеленого цвета они синего о том какие решения вы принимали и как мы делали эту систему так чтобы инженеры которые поддерживают нашу систему могли следить за ее состоянием и не сойти с ума я думаю что мой доклад будет полезен не только тем кто воспользуется нашу системой лифтинга который называется мойра и скачает и и будет использовать ее так как мы предполагаем но и тем кто пишет свою систему инертен га или даже собирая систему мониторинга или оттенка из готовых компонент я думаю что будет полезно всем а вот и еще одна мысль который я хочу подчеркнуть и буду подчеркивать моем докладе это то что вообще-то задача задача уведомления нештатных ситуациях она не уникальна для идти у меня вот история из реальной жизни истории инженеров которые не являются идти инженерами не разработчиками тестировщиками не админами которые w напоминают то что происходит у нас и из этого можно извлечь уроки у меня будет несколько историй перед тем как я начну рассказывать для того чтобы было понятно почему почему собственно я могу рассказывать об этом кто и вообще такой это уже сказать вам два слова к нашу компанию наша компания не очень известна среди инженеров потому что то что мы делаем это в основном продукты для бизнеса вот но несколько вещей важно про нее знать для того чтобы понимать суть моего доклада а именно мы делаем продукты то есть мы не делаем софт на заказ мы делаем собственные продукты и мы их тепло им как облачные сервисы то есть у нас есть дата центры в них есть железо на нем установлена система хостинга тепло и и мы туда выкатываем свои тот код который мы написали и у нас довольно большая компания ну то есть она сравнима с крупнейшими компаниями в стране работают 1000 человек именно в разработке то есть это не считая менеджер по продажам и остальные специальности этой 0 или которые делают продукты больше 10 команд и из этого я но понятно что из этого следует что есть инфраструктурные команды которые вот для этих 50 продуктовых команд делают мониторинг делают диплом делаются хостинга лифтинг и все остальные вещи которые нужны для того чтобы можно было сидеть спокойно писать бизнес свеча вот и в одной из таких инфраструктурных команды работают собственная я занимаюсь контуре системами мониторинга лифтинга хостинга и тепло и сейчас мыс качество понятно что нам нужен мониторинг на потому что минуту простоя сервисов контура стоят миллионы рублей то есть от довольно ответственная вещь вот и для мониторе используем графит сейчас наверняка многие из вас подумали о октябре 2018 года на сцене стоит человека сейчас он будет рассказывать нам про графит на самом деле понятно графит был впервые опубликован по моему 2008 году вот сейчас по меркам айти эта технологии считаются уже очень ставит то есть соседнем зале будут рассказывать про губернатор и prometheus а я буду рассказывать вам про графит и вам наверное может быть не интересно но я должен рассказать вам про дизайн решение про дизайн решение которые позволяют графиту до сих пор быть таким живучим и до сих пор быть системы мониторинга выбора для многих больших компаний почему мне кажется что до сих пор жив графит почему мы до сих пор используем графит во-первых у модульный вот если но наверняка многие из вас вопрос граффити на миникарту эта картинка для многих будет знакома как выглядит графит который вы скачали из репозитория и установили себе состоит из 3 частей ну по сути 3 в нем есть релейная там по сути балансировщик в которой входят метрики дальше некий сторож которые складывают базу данных потом веб интерфейс который можно посмотреть графики ну примерно так выглядит график а как выглядит графит который сегодня работает в контуре который его прямо сейчас у нас production новой системы собирают метрики он выглядит вот так здесь нет ни одной строчки кода которая о которой можно было бы скачать из официального репозитория графита и тем не менее я до сих пор называют а графит то есть это не такая система которую мы если она перестала нас устраивать мы просто берем выбрасываем и вместо него ставим новую другую эта система которую можно заменять и дописывать по частям и это очень важное дизайн решения которая позволяет как идут до сих пор существовать второе по что я хочу сказать это простой формат данных смотрите формат данных графита он выглядит так имя метрики пробел значение a built-in штамп и все для того чтобы складывать данные графит или читать их оттуда достаточно знать вот это не нужно иметь никакой реализацию бинарного протокола можно написать барс кит который отправляет метрики в графит и это очень легко первое время мы с windows серверов отправляли метрики графит с помощью porsche скрипта ничего сложного и можно написать за один вечер и наконец последнее это вен это отсутствие какого-либо winder лака то есть нет никакой компании которая стояла буза графитом и например перестала бы его поддерживает нет некой компании которые хотела бы вам продать жизненно необходимые вещи в граффити каждую ком каждого компонента графита эта штука которую можно скачать у которой есть 2 3 4 альтернативные окон собственной реализации можно взять ту которая вам больше понравится чего не хватает граффити доказывает система лифтинга из коробки вы можете залить туда данные залить туда метрики но и вы можете посмотреть графики в веб-интерфейсе можете построить дашборд можете графа ну поверх поставить сделать классные дашборде но вот система которая будет присылать вам уведомление когда что-то пошло не так а понятно что она вам нужно потому что вы не можете с вами смотреть миллион графика в глазами даже если у вас очень много дежурных инженеров есть этой системы здесь нет но поскольку график система модульная и дописать к ней новый модуль очень легко естественного пан сердцу новинки есть довольно много готовых систем которые совместимы и которые можно подключить графиках а здесь когда вот этот вот эту систему а лифтинга бог кто-то делает здесь возникает первые дизайн решение по которой мы поговорим наверняка ну тем кто внимательно смотрит на на этот на эту картинку понятно в чем же стоит это дизайн решение это дизайн решения о том откуда нарисовать стрелочку откуда должны система лет у него должна брать данные чтобы проверять их и принимать решения нужно отправить уведомление или нет а давайте я для того чтобы немножко так зажечь разговор я поставлю из самого нелепого место из иска не леща данных вот почему бы нам нашей системе а лифтинга не взять и просто не читать базу данных напрямую от этих файлах там лежат и брать оттуда my метрики очевидно что это плохая идея не всем очевидно что это плохая идея ну я же недавно показывал стоит на котором вместо whisper оклик house неужели вы каждый раз будете переписывать систему лифтинга когда он уже заменить сторож наверное нет наверно лучше завязаться из какого на какое-то другое место где формат данных вот топ простой по которой я говорю и которые уж точно не поменяется в ночь тогда такое основополагающей блок графита вот эта идея уже лучше то есть здесь вот эта вот стрелочка она более отказу устойчива к смене модулей а вот но здесь есть та же проблема которую можно понять только если вы пользуетесь графитом а проблема это в том что на самом деле пользователь который строит графики они используют функции и суммируют между собой метрики стоят производные там вы считают делят вот это они делают в графит viber вот там есть все функции а вот карбон каша эти функции нет вот и пользователи которые хотят настраивать себе уведомление они конечно хотят функции тоже применять если стеночку поставить отсюда то этого делать не получится стрелочку оставить отсюда и так делает действительно подавляющее большинство система лифтинга с которой совместимым хитом они берут данные из api графит веба вот ну вот это уже вроде бы адекватное дизайн решение вроде бы даже девочку больше неоткуда ставить поэтому меня тут надо как-то завершить разговор но на самом деле мы разработчики система лифтинга мойра считаем что и отсюда стеночку ставить тоже неправильно почему об этом я расскажу вам чуть позже когда начну рассказывать свои истории а перед этим для тех кто лучше воспринимает информацию визуально для тех кому хочется пощупать что понять и не понятно из вот таких вот кругляшков я расскажу немного о мой g покажу вам очень короткий скринкаст самого базового сценарии использования этой системы смотрите я вот в этом скринкасте я добавляю а я добавляю триггер то есть правила по которого мне приходит уведомление ну например в этом случае я прямо возьму тот пример который у меня был на слайде про про такого графита я буду проверять не слишком ли высокая у меня загрузка цикл я пишу здесь имя метрики которая у меня была цепова по толпе рэнд цеху лодка sun вообще не тот но вот метрика в которой загрузка циpкa собственно я бы хотел получать предупреждения когда то есть менее инвазивные уведомление когда загрузка превысило 50 процентов и совсем серьезное уведомление когда 95 вот я создал это правилам и здесь есть важный интерфейсный момент смотрите я создал правило но я пока не написал куда мне присылать уведомления на стойке уведомления они хранятся отдельно здесь можно добавить канал по которому уведомление придет например флаг как джон уиллис завещал нам накинуть и смотрите это не специально несовпадения это совпадение и правила подписки которая расстраиваю она она связана с триггером через систему тегов то есть я не подписываюсь напрямую на на каждый на каждой каждый по которой я создал а связываю их между собой тегами это позволяет но разумно сосуществовать разным командам которые пользуются системой вот на этом собственно скринкаст закончился и я готов вернуться к своей первой истории к истории про которую я оставил завязку чуть чуть раньше эта история про то откуда брать данная система лифтинга картинка была вот такая и я сказал что ставит стрелочку здесь нам кажется неправильным почему я для того чтобы проиллюстрировать почему мне кажется неправильно ставить галочку отсюда приведу вам пример немножко из другой области представьте себе что у вас есть база данных mais quel mais quel и в ней лежит например 500 гигабайт данных не знаю может это байт данных и у вас есть 1000 пользователей этой системы которые могут делать к ней произвольные запросы вы даете им веб-интерфейс в котором можно написать ускорили запрос и поставить галочку пожалуйста делаю этот запрос каждые 10 секунд 1000 пользователей который не очень хорошо может быть разбираются в том как моей спальне устроила не просто пишут запрос select джон чего-нибудь и ставят галочку каждый 10 секунд вот система а лифтинга оно похоже очень паттерн использовать самолет инга очень похож ну вот на эту историю потому что как армию дилерском кости приходят пользователи который возможно не очень хорошо разбирается как внутри устроена эта система пишет в нее какой то запрос какие-то метрики вынимаются звездочками суммирует агрегирует стоит производные и нажимаем сохранить проверку проверять вот это вот вот запрос делать его каждый понятно что если у вас есть 1000 пользователей рано или поздно кто-то из них напишет такой запрос который очень являются очень тяжелым для вашей системы хранения то есть кто то напишет запрос который выполняется 30 секунд на вашей системе загружает ее на сто процентов и повторяется каждые 10 секунд то есть просто вы даете пользователям в инструмент для уничтожения вашей системы вместе с графитом это поляжет я видела несколько раз гарантированная история поэтому местами стрелочку вот отсюда мы написали систему метрики в которую попадают параллельно с основным хранилищем графита и что позволит что это позволяет нам делать в нашем основном граффити метке хранятся от года и больше в нашем самом граффити хранятся все метрики которые туда приходят но в нашей системе алё king методе хранятся только несколько часов столько сколько нужно для того чтобы оперативно отправлять уведомления для того чтобы проверить сколько загрузка процессора сейчас вам не нужны данные за 6 месяцев назад они где-то гоняться кроме того в нашу систему рейтинга попадают только те метрики на которые настроены хоть какие-то уведомления понятно что метрики они как логе их много пишут и очень мало читают также здесь много метрик приходят но на вход но из них проверки настроена только на небольшое подмножество и вот эти вот два фактора короткий срок хранения и фильтрации они позволяют нам вместить все данные мониторинга которые лежат море в память они лежат в одессе и поэтому пользователи могут делать практически какие угодно запросы с очень сложными облигациями это все работает очень быстро это не позволяет пользователям перегрузить наш основной кластер графита это работает даже когда основной кластер графита лежит ну и наоборот из лежит система лифтинга то это не нет не валит основной график вот но остается проблема по которой я говорю проблема в том что пользователи хотят применять функции да если мы поставили стеночку издалека функции которые есть графит вебер суммирования производные их там нет да но для этому что это open source мы смогли просто взять эти функции как библиотеку и включить ее в нашу систему alten гадот просто все функции которые есть граффити поддерживаются в мире следующая история которая хочу вам рассказать про другая дизайн решения эта история называется нет данных здесь я хочу с вами такое не были такую небольшое упражнение провести я хочу чтобы вот вы представите что что вы принимаете решение глядя на метрику какую лампочку дежурному инженеру зажечь зеленую все в порядке желтую значит что-то пошло не так ну в принципе не срочно или красную все горит нас очень чинить вот смотрите вам ход пошла пример вам на ход пошла метрика загрузка процессора на сервере с вашим приложением составляет 4 процента ну наверное так наверное это окей то есть наверно ничего делать не надо все нормально сервер не очень сильно загружен понятно что я очень упрощаю но вы делаете это упражнение со мной но эти пятьдесят восемь . загрузка процессора 58 процентов то считает что это окей зеленая лампочка ничего делать не надо многие а кто считает что это желтая лампочка а красная да есть даже прекрасно считают ну я райан я считаю сколько считать что такое желтое давайте еще раз 99 процентов ты считаешь что это окей ничего делать не надо а а желтая желтая есть а красная почти все окей согласен красное следующее упражнение это не ошибка это это слайд который я планировал показать что если вы не знаете что из 100 если данные перестали приходить а давайте кто считает что ты зеленая ближе к зеленому если данные перестали приходить и то считаю что это ближе к желтому за считают что это красная чем как давно хорошего посту 10 минут например к сна и окей я вот эту историю я хочу протестировать вам историю из реальной жизни это ракета ракета титан 2 у нее наверху чёрная штука круглая то ядерная боеголовка а внизу под ней баллон жидким топливом и доставать это там жидкое топливо вот где-то однажды в сентябре восьмидесятого года а вот на такой ракете в америке проводили служением и 2 инженеры должны были открутить крышечку но возле верха ракету там трюки с небольшого нужно открутить вот для этого нужна понятно подняться в этой шахте наверх к к к к к к верху ракеты и специальные отверткой короче членом покрутить немножко вот а что произошло во первых лишь очень долго не работал ли встали как это старая там все го лишь долго не работал и когда он заработал они поехали наверх оказалось что не забыл отвертку нужную с собой взять но мне уже очень много прошло а не спускаться места денег с собой были старые клещи они подумали что они крутят стальными клещами поднялись открутили и вы сколько плечи были старые уже расхлябанные а не уронили эту крышку вниз вот ну казалось бы чё-то кого-то на платформы упала и нормально подняли обратно прикрутили но в том что и платформы она как бы краям как эти примыкает и там резиночка такая что вниз ничего не провалилось в резиночка тоже была старая на моно прохудилась и эта крышка упала вниз мы крышка но такого размера 5 килограмм весит она упала вниз все там 80 метров и внизу пробил дырку хотите все потекло взрыв боеголовку там нашли за 400 метров от этой базы вот она не взорвалась чтобы он нормально но о чем эта история это история о том что с системой сложные инженерные системы они постепенно приходят в негодность небольшие изменения которые сейчас кажутся вам не критичными они постепенно накапливаются и приводят к тому что происходит катастрофа вы найти ничем не отличается если сейчас у вас на диске 90 процентов свободного места и вдруг перестали идти метрики вы можете на это честно говоря забить потому что понятно что там все было нормально еще вчера значит скорее всего все нормальные сейчас можно заняться kevin более важными делами и потом ему вернуться мы считаем что так нельзя и дизайн решения которые вы применили в мэры состоянии отсутствие данных это самое плохое состояние метрики хуже чем она это это и и интерфейс на и решение то есть если мы в верху показываемся матери которой находятся в самом плохом состоянии то вверху и мы показываем нет данных выше чем ошибку это и решение с уведомлениями то есть если уведомление приходит по какому-то более инвазивного каналу ну например если вардинге приходят вам по почте приходит sms то нет данных тоже будут приходить в самой стать они будут выходить по более более приоритетному каналах и тем итоге которые находятся состоянии нет данных напоминает вам о себе разу день все свёрток пропустили забыли забили каждый день мы напоминаем вам о том что нужно что то с этим сделать потому что когда нет данных это хуже чем когда ошибках и я рад что многие подняли руку когда я когда я предложил оценит это как ошибку следущий стоек то хочу вам рассказать про дизайн называется совсем не данных тут может показаться что это еще хуже чем затем нет данных до но в этой истории не совсем про то когда им показал эту картинку я сказал что это вот вот эта система которую нас есть она полностью параллельно автономная независимо от графита но тот кто внимательно смотрит на слайд понимает что я вас конечно же обманул тех кто не очень внимательно смотрит на слайд я сделаю подсказку мы не зависим почти ничего в граффити кроме балансировщика которая пересылает метрики которые пересылает одну копию метрик в стороне одну копию метрика наша система рейтингов и если если раз комнате создателей у паука он может упасть как любая система в ней есть . отказывай по области ручек в мою перестают идти метрики а как мы уже говорили отсутствие данных в мою трактуется как самое плохое состояние если у вас тысяч инженеров подписаны на уведомление о данные перестали типа всем метрикам ночью то нужно разбудить тысяч инженеров да нет нужно разбудить одного инженера который почти нет карбон и life вот и вновь от самого старта была система которая защищала от от такого поведения если в мою перестали приходить вообще метрики то все уведомления отключаются для всех кроме администраторы самой моего но это первое первый шаг к этому решению на самом деле жизнь она гораздо сложнее а вот и на самом деле понятно что в реальной жизни revive несколько они находятся на разных дата-центрах между сми дней балансируется трафик с помощью успех этой сетевой магии вот и все они отправляют свои ну какую-то часть метрик могу я сам история которое происходит в реальной жизни она выглядит примерно вот так то есть отпадаю отпал один карбонил и и в море перестала приходить часть метрика и допустим у вас есть 1000 пользователей 3 карбон голова если у вас перестал приходить треть метрик что нужно сделать уведомить 333 пользователя наверное тоже нет вот это решение но на самом деле уже сложно я его сейчас в нынешней версии мой расчет она будет следующим но в этом случае нужно действительно смотреть за потоком входящих метрики пытаться искать в нем аномалии пытаться понять это действительно правильный истинный сигнал о том что метрики от по вот этим вот этим сервисом перестали приходить или это по какая то поломка в самой системе мониторинга но вот этого решения она хочется сказать помогают спасать жизни она помогает спасать людей на самом деле и довольно большого количества людей следующая история наконец-то не прошел наконец-то не про нет ни про то как бороться с отсутствием данных это история позитивная про спа создание вещей осмотрите сейчас очень модно делать так называемый и пфр сервисы то есть сервисы у которых любое действие в нем можно сделать через океан а веб-интерфейс например это всего лишь один из способов работы с этим этим можно так строит то есть все что угодно чейза и 5 многие даже делают это не задумываясь но я хочу с вами поговорить о том почему это важно почему это важно случае система лифтинга у меня есть две истории поэтому первые снов мою домой конечно же есть теперь есть клиент на питоне и 1 стоит которая еще рассказать эту история провансе бог мы развертываем наши находились у данных например с помощью once i was an графита с помощью аль саббах и он давайте посмотрим пример например с базой данных кассандра да мы хотим развернуть кластер кассандры мы пишем ansi воплей букв в нем добавляем роли которые настраивают операционную систему ставят на нее jaws кассандрой ставят утилиты даймон джимми танцы это утилита для мониторинга даймонд собирает метрики с операционной системы у вас может быть там телеграф или все что угодно отжим extends по протоколу dmx самой кассандр собирает java метрики все это отправляется в графит и вот одной кнопкой с помощью play book вы развернули вот такую систему и получили даже бокс граффити а что с триггерами вот в обычной ситуации триггера вам пришлось бы настроить вручную то есть он пришлось не забыть поскольку раскатали антигон новый кластер кассандры пойти веб-интерфейс мойры или или чего угодно любой системы которое у вас есть bosson савин все что угодно и там в гаване и самой тоже есть цель or thing пойти и создать там вот на этот новый кластер себе уведомление подписать на него нужных людей это очень странно то есть это такой это недостающий кусочек вот и с помощью это я его можно сделать достающим вот тот который тот предел который я показывал вам в стойкости он создается вот таким вот небольшим ямам и знаете с не любят я могу что делать ван sibu без яблони как то есть довольно простая конфигурация и все что у нас есть полное описание системы она хранится в одном репозитории накатывают с одной кнопкой если вы добавили в кластер новый сервер он автоматически появляется в конфигурацию этих активов а вторая история эта история когда вы даете людям которые будут с вашей системой клиентов капель и говорить и делать с ними что хотите придумайте что-нибудь и вот соседняя команда которая ставим на одном этаже сидит в офисе она занимается система серой скалы сервис discovery фокси которые работают с этой системы все же дисковые и помогая всеми к сервисам общаться друг с другом вот и они посмотрели на тут опять который мы предоставили им система лифтинга и подумали что можем с этим сделать можно сделать вот что можно автоматически генерировать триггеры на основании того какие сервисы зарегистрированы все рисковые поскольку система сера дисковой и прокси который стоит между микро сервисами уже собирают некоторое количество телеметрии даже не требую от разработчика добавлять какую-то библиотеку внутрь а в эта система она может просто автоматически создавать еще и триггеры и размещая сервис ничего не делаю не подключаю в него не какую дополнительную ли отёку и не использую никакой дополнительный код получить из него не только метрики но и триггеры и получать уведомление когда например он начал кричать слишком много 500 коми эта штука звучит хорошо но какова на самом деле сработала то есть хорошее количество триггеров то есть количество правил уведомлений которые были у нас системе настроены вас полутора тысяч полторы тысячи люди настроили вручную до 10000 вот это вот оставшаяся часть этот идет которые сгенерированы автоматически и мне кажется что это качественное изменение но не количественное вручную вот то количество разработчиков которые нас есть десять тысяч лидеров и создали бы никогда есть это какая-то которые появляются только если есть автоматизация только если есть api и вот эти две истории мне кажется показывают что иметь api в том числе система халед king тоже очень важно история номер пять она снова будет с историей из реальной жизни чтобы вас немножко отвлечь от технологии я же обещал по технологии не сильно много загружать эта история про атомную электростанцию это атомная электростанция в америке называется своей miles and и как вы догадались из истории сокетами сейчас там что-то сгодиться смотрите опять же в том же самом восьмидесятом году что-то восьмидесятый год богат на такие вещи на не произошло вот что там снимался насос насос lanos и которые воду гоняет кто объекта набивается и потом крутит турбину но сломался вода перестала идти вот об этом конечно загорелась лампочка у оператора вот так примерно выглядит пульт управление атомной электростанции загорелась лампочка операторы это заметили естественно реактор отключили то есть опустили эти стержни еще одна лампочка загорелась начали значит понятно что всего вода там есть он начинает выкипать давление растет еще одна лампочка загара давление растет потом открылся клапан который сравнивает лишнее давление из этой системы тоже лампочка загорелась вот она давление вышла а потом этот клапан не закрылся давление ушло он должен был закрыться обратно он не закрылся естественно лампочка об этом тоже загорелась вот но поскольку там было так новом пачек этого никто не заметил то есть оттуда вышла не только лишнее давление но вообще всякое давление просто весь охлаждающая жидкость вышла и лекцию сгорел он сгорел вот и эта история чему она учит чему он учит нас разработчиков система лифтинга не должны быть слишком много лампочек должны гореть в аду за ведь только важные как это сделать ну как решето значит на сто процентов я честно говоря не знаю но у меня есть два решения которые мы применили у себя первые решение этот линк смотрите это скриншот из шлака опять john wiley сладко это это скриншот реально уведомление из лака здесь написано что на сервере и гкс 03 диск номер один в нем стало мало свободного места тут пороговое значение 30 стоит на нем стало мало а потом снова нормально в том снова мало а потом снова нормально там что-то происходит то есть как какие-то подземные стуки что-то происходит в этой системе и она все время швед вам уведомления это плохо потому что если у вас есть 100 писем и из них 99 о том что на на диске стала то 30 процентов то 29 основа 30 то самое одно важное о том что вас не закрылся клапан который вставлена и давление вы конечно пропустите чтобы которых которая справляться с этой ситуацией в моё называется продлен она просто смотрит за триггерами которые слишком часто срабатывает и постепенно после некоторого количества срабатываний начинают упаковывать сообщение готово триггеров пачки то есть вам приходит не ни сколько не 8 писем до одно но не 8 сообщений флаг одно и когда у этих сообщений становится на порядок меньше гораздо больший шанс что вы не пропустите то что действительно важно а вторая штука которая помогает справиться с этим он шквалом сквалан горящих лампочек ск волос сообщение о том что что-то не в порядке в системе это maintenance режим обслуживания например вот на этом скриншоте я быстро обращу ваше внимание на те места которые важны смотрите мы вывели на обслуживание server is the perfect 01 этот коса из графита сервер вот и там нет данных по одной из метрик вот дело в том что до он обслуживание он будет на обслуживание некоторое время еще может быть неделю или сколько-то времени а вот и от него постоянно моё постоянно поминает о том что данные с этого сервера перестали идти они перестали ти выполнить это плохо и моя работа напоминает это от под тот опять же самый шквал уведомлений тот самый это самое большое количество горящих лампочек как с этим справится можно можно сказать мою что вот конкретно вот эту метрику не нужно смотреть еще сколько-то времени но жить в данном случает четыре дня в течение четырех дней не нужно присылать никаких уведомлений что важно в чем важное обе завершение в этом месте этот срок всегда ограничен нельзя выключить метрику на неограниченный срок потому что это приведет к той истории socket ой это опять постепенная деградация системы которую выключают и забивают поэтому режим windows в море можно включить только на ограниченный срок он сам выключится и снова наполнить о том что что то не так с этим вся его что-то не в порядке последний история которой я хочу вам рассказать называется работа с 9 до 6 и здесь опять будет история из реального мира это корабль американский на 5 корабль джон маккейн по моему крейсер у него в борту drop хотите узнать почему потому что у него врезался другой корабль как это возможность просите вы как может вот в такой корабль на котором висят всякие штуки детекторы радаров и крутится как может черт побери венцу другой корабль очень просто система имеют свойство не срабатывать понятно что на таком корабле как в любой сложной системе есть множество систем защиты то есть многоуровневая защита от того чтобы него не приехал домой корабль и самый последний уровень этой защиту и когда все электронные системы отказали на каждом борту такого корабля сидит маяк он сидит и смотрит если он видит что к ним приближается такой корабль он сообщает об этом рулевому и рулевой отворачивает на этом не исключение такой моя кто же сидел сидя справа и слева и смотрел но что с ним произошло он конечно основу да он уснул катастрофа авария 10 человек погибло о чем чему это нас учит на самом деле в эти как мне кажется есть такая такая стигма вот если человек хотел сказать что он плохо работает счет недорабатывает не очень там такой командный игрок на рекламу от работа с девяти до шести потом домой уходит такая работа с девяти до шести настоящие программисты настоящие ниже не они работают круглыми сутками они всегда на посту это не уникальна для идти такая же история происходит в армии сша на флоте там люди работают по 20 часов в сутки а потом когда я нужно внимательно смотреть они что делают спят а как можно справиться с этим в системе а лифтинга как можно сделать так чтобы система рейтинга не будило тех людей которые должны сейчас спать не будило тех кому нужно поспать чтобы завтра быть внимательным для этого придумано расписание у нас в системе есть расписание и например допустим у вас есть веб-сайт на котором днем в среднем 1000 человек сидит пользователь тысячи пользователей наверное если у вас вдруг днем на нем 10 пользователей вы хотите получить об этом уведомление что-то пошло не так слишком мало пользователей на сайте может быть он не работает или тормозит вот но ночью ночью ваш сайт не так популярен на нем 23 человека в общем случае и иногда ночью ваша проверка будет хлопать ночью ваш ваш триггер будет сообщать вам о том что на сайте чет мало людей ну блин это ночью не все спят и поэтому в моём можно настроить расписание который отключает проверку метрики на ночь то есть можно сказать да ночью этот параметр не релевантен ночью никого не нужно будете за того что мало дней на моем сайте кроме того существует проверки которые вообще-то нельзя пропустить она их решение она может его можно отложить до утра то есть ночью например это некритично до таких проверок вас тоже есть расписание саня другого сорта они проверяют состояние системы они записывают событие которое произошло например ночью но но не будет вас они присылают сообщения о том что произошло за ночь одним дайджест вам утром то есть вы настраиваете что тихий период для этого для этой проверки с например с 12 ночи до 8 утра и 8 этого получит дайджест о том что произошло за ночь и не пропустите важное уведомление но и не прощаюсь от него ночью вы наконец через писание настраиваются индивидуально то есть вы можете заставить расписание дежурных инженеров и каждому из них настроить индивидуальный период вот этой вот подписки кто-то дежурит днем кто-то дежурить ночью есть но какое то вот какое это чередование и люди могут спать тогда когда им нужно спать последние пол истории которое я вам хочу рассказать это не правильная история не целиком потому что у нее есть история из реальной жизни а истории из моего никакой нет смотрите это история про звуковые уведомления вообще-то говорим какие звуки вызывают у вас тревожное ощущение звук сирены звук звонка это колокол бьет то есть это какие-то вот звуки которые чётко ассоциируется с тем что вам нужно обратить внимание какие то звуки это все звуки они довольны отличные то есть в общем этот этой пошла и бы зародилась нам за лет сто назад не очень много было способов излечения с громкого пронзительного звука можно было ударить током о том почему нибудь стукнуть или в дудинку подудеть вот в такую то что привлечь внимание но мы сейчас с вами живем 100 лет спустя по момента как как вот были эти примитивные источники извлечения звука и прямо сейчас у вас очень богатый инструмент для звуков до но мы по-прежнему пользуемся звонками ценами колокольчиками то есть теми звуками которые которые мы привыкли с тех времен как можно нам какое тут положении можно сделать от смыть и давайте посмотрим на на аэропорт наверняка многие из вас прилетели на самолете сюда из другого города и вот недавно были в зале ожидания примерно в таком и слушали что в этом зале ожидания постоянно делаются объявления нам постоянно говорят пассажира из такого-то выходите на посадку пассажир там такой-то и такой-то срочно бегите к своему кейту пассажиры из-за такого то вам нужно прийти в другой день и так далее постоянный поток звуковой информации постоянный поток аль артов из которых вам нужен только один но выслушать это постоянно вы никак не можете отфильтровать сообщение которое вам которые вам попадают уши кроме как слушать все хотят слушать все что вам говорят на самом деле сейчас есть исследование которые пытаются люди которые занимаются изучением система лифтинга такие люди есть в американских университетах они пытаются понять что с этим можно сделать и в одной из в одном из госпиталей американских происходит походе такой эксперимент там в госпиталях тоже знаете постоянно звучат какие то сообщения там доктор такой-то пойдете в авиационную вот и женщина которая занимается профессор из mighty по-моему она придумала вот что она придумала предварять вот такие голоса такие голосовые сообщения звуком хорошо распознаванием звуком например если сообщение связано с с лекарственными с таблетками это может быть звук когда печется баночка с таблетками и услышав такой звук вы сразу понимаете если вы работаете в больницу медперсонал вы понимаете это не для вас это для тех кто занимается лекарствами в аптеке вот вот такая история что из этого выйдет я пока не знаю я не знаю сможем ли мы применить это в но и но надеюсь что какой-нибудь вывод из этой истории из реального мира мы сделаем и что я бы хотел чтобы вы забрали с собой с моего доклада какие мысли вот там если по которой я сейчас говорил идея нужно брать не только языки то чем мы занимаемся как я уже говорил это не уникальная история не нужно думать что мы первопроходцы люди занимались с телами а лифтинга наверно несколько сот лет с тех пор как били в набат при приближении врагов люди думали как лучше сделать систему уведомления так чтобы не кричать волки когда не надо кричать волки и эти идеи можно брать их можно использовать у себя если вы захотите что-нибудь послушать про по истории визуального мира я рекомендую вам подсказку на эти надписи на резьбу это подкаст про дизайн это вообще неэтичный подкаст здесь я внизу оставил ссылочку на конкретный эпизод про звуковые уведомления топа что я сейчас рассказал аэропорт больница если вам интересно вот туда послушайте этот подкаст в нем есть идея которые вы сможете применить второе это думайте о людях когда пишете программы не думайте о том как сэкономить терабайт и не думайте о том как построить систему через который пойдет на наибольшее количество сообщений думайте о том как будет пользоваться этим инженеры потому что это люди которых вы будете будить по ночам ну и команды разработки моя не пустил у меня обратно в екатеринбурге если бы я не сказал это папа быть ему и оставил вам ссылки на документацию наш телеграм-канал в котором можно что-нибудь спросить если что то непонятно есть вопросы ну и на несколько вопросов я успел ответить прямо сейчас спасибо давайте перед тем вопросы отвечать поднимать его после кого-то красный цвет раздражает остается могу выключить ну вот не очень много людей ставлю здравствуй лексей спасибо за доклад хотел бы узнать каким образом реализована система напоминает о себе раз в день каким вопрос был такой или до микрофон есть мне очень слышно было каким образом устроена система которая напоминает разу день но я попробовать вид может быть не очень понял вопрос вот есть канал уведомление по которому пользователь получает уведомление о состоянии 3 метрики раз в день по этому же каналу высылается уведомление ваша метрика все еще в состоянии нет данных пожалуй америке если там то у допустим 1 инженер там есть n систем и там есть какие то возможно метрики которые он не успел просто зама intensity что-то вроде мы пройдут сразу все сто оповещений или там то есть есть какое-то ограничение поэтому ему ему придет напоминание ровно через сутки после момента как она перешла останина дома вот вот вот вот это хотел знать спасибо большое гости спасибо большое очень интересный доклад у меня два вопроса на вопрос 1 вот вы могли бы рассказать про то как устроена наша модель расписание то-есть метрики для пользователей пользователей метрики такие списки когда можно задать и второй вопрос а вот поговорили про модули в самом начале что граффити модульность высокой у меня вопрос можно ли использовать вашу сколько на модуль на может быть ваша система быть она как в отдельную модуль чтобы использовать и в других проектах и если с этим там такие два под вопрос и это начало написано ваша система и такой лицензии она распространяется спасибо начну если не сложно если можно со второго вопросов по модульность 1 паспорта насколько она модульная где можно ее использовать это standalone приложение которое ему требуется на входе передать метрики формате графита приз вот те вот та вот строчка имя пробел значение пробел таймс темп если у вас система которая может складывать метки килька fit перекладывать на пример очень предметов сможет перекладывать метрики в графит на постоянное хранение вы можете перекладывать их в моего то есть достаточно поддержать вот вам формат данных we do with интерфейс но есть api тоже ну если владя такое же поддерживаете можете в этом дельфийского месте использовать не проблема в авторизацию углубляться не буду это есть документации можно почитать а вот но в целом я не знаю насколько можно переиспользовать нам веб-интерфейс в том виде в котором есть но если если api и совместимое то наверное можно лицензиям эти даже не а почему я честно гони юрист поэтому я м эти вот первый вопрос можно расписание структура списания расписание как напоминаю у нас два вида первое списание она настраивается в триггере то есть тэги а только что я показал в скринкасте настраивается самопроверка пороговое значение и также настаивается расписание на самом будет довольно примитивные но в общем нам хватает дни недели и период времени то есть например не следить в субботу воскресения а следить там в будние дни там с десяти до шести например то есть один интервал времени и галочки с днями недели довольно примитивная система а вторая часть это настойка давай расписание которая присылает дайджест утром а настраивается в подписке то есть тэги проверяются ну допустим я подписан ночью а мой коллега другой инженер подписан днём и идёт все время круглые сутки работают но часть сообщения получаю часть он еще вопрос здравствует спасибо за вопрос скажи пожалуйста если у вас механизм эскалации эскалации по конец но это open source это отсутствие интерлока и мой вирусом были пользуется ребята из авито и они обещали нам скоро пурик вас подогнать эскалация me я понял пасибо я на самом деле с точки зрения дизайна продолжаю ответ на запрос я не убежден что эскалация должны быть мои возможно это как какой-то атрибуту системы вот инцидента кира печет юте то есть вот мой реагирует события она попадает в пейджер дьюти или виктор abs и уже там инциденты кинг там эскалацию там все остальное не знаю не убежден что должно быть частью моря но если полукрест подгонят там и примем спасибо за доклад такой вопрос вот про идеологию сноу дата поведением а есть какой-то рубильник который может поменять это я просто подоплека какая вопроса я долгие годы мониторил там реальную структуру всякий свечи биллинг там удаленные филиалы и ситуация когда drink там через месяц отваливается и сыном или влево экскаваторщик этого белок и он не мониторится у меня в глазу достаточно быстрому с таким подходом к она у да то само по себе поведением что ну да то это хуже чем р.р. она она гвоздями прибита мы убеждены в этом на сто процентов но после этого я рассказываю несколько других историй и одна из них это было примером он тиран свяжем я вот щас напомню вот смотрите если вот здесь чисто та же самая история мы мы повезли сервера вот этот вот сервер мы повезли в ту камеру центр он будет ездить по москве из одного цента в другой но несколько дам какое то время может быть его сегодня не успеют привести и мы не хотели бы чтобы у нас сейчас нам нас надоедало система уведомлениями напоминание об этом мы ставим режим maintenance на несколько дней и вот эти дни этот этот триггер молчит то есть он не сообщает нам о том что мы знаем что что-то не в порядке с этой системой но мы принимаем seller тому чтобы это починить вот я думаю что вот это решение проблемы по которой вы говорите ему интересно прекрасен ну допустим из витя филиал по какой нибудь там не знаю одессе леру или 3g или там что-то такое ужасное и он так работает то не работает есть да я не рассказывал про этому есть настройка интервала после которого метрика считается отсутствующей то есть там по обучению 10 минут если 10 минут нет данных то уведомление приходит глобальный параметр настаивать сложно сказать что если метрик нет больше то то есть увеличить или уменьшить его вот но поскольку архитектура это архитектура как коробку с коротким хранением данных то там конечно не рассчитывала что вы поставите что если месяц нет данных то тоже все в порядке но я бы не хотел честно говоря чтобы так делали спасибо"
}