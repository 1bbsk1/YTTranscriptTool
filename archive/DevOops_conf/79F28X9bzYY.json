{
  "video_id": "79F28X9bzYY",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "так Всем привет Рад что столько людей пришло хочу представить Алексея горбого мы вместе с Алексеем пилили распределенной системы в Одноклассниках долгое время сейчас Алексей отвечает за новейку решение в тинькове и доклад сегодня будет про то как автоматизировать управление кластерами Кассандры все делать по кнопке но для начала Хочу наполнить напомнить что у нас есть чат доклада там можно задавать все вопросы в конце мы это обсудим qr-код на слайде и не забудьте что потом можно помочь Алексея дискуссионной зоне так передаю слово Алексея приветствую Всем привет Я Алексей и сегодня расскажу как мы строим надежный решение на базе Касанов предоставляем его как сервис для начала немножко нас кто мы это более 30 миллионов счастливых клиентов Это десятки распределенная инфраструктура данных и самое главное это команда профессионалов которая все это обслуживает и поддерживает а о чем мы сегодня поговорим сегодня мы поговорим о нашем пути создания решения Кассандры ксервис кассандре в кубер на эти саникоторой обвязки вокруг оператора О том Почему пришлось пишут писать свой оператор Какие при этом проблемы пришлось решать собственно при создании своего решения и что мы понимаем под продуктовым подходом наверное собравшиеся надо клапан кассандре кто-то использует подальше Но кто использует основной подарочный помидорки О круто Почти половина Ну что для старых Я немножко прорекламирую но Кассандра это такая надежная отказа устойчивая распределенное высокоопределительная база данных касанга очень легко масштабируется Сандра постоянно развивается у Кассандры очень отзывчивые комбиники приятная всеобъемлющей документация понятный код И самое главное у нас есть очень большой опыт использования компании мы любим кассандру и умеем ее использовать Ну что поехали начиналось изначально у нас было достаточно много разрозненных кластеров Кассандра на железе каждая команда они были командным распределены также были там же посредством был каждая команда менеджера по своему что было жутко неудобно как поддержки так и в починки а мы решили Хватит это терпеть и Давайте будем делать кассандру по кнопке с чего все начиналось первая операция У нас уже есть платформа для управления сервисами разработками Вот квотами и так далее в Тинькофф где в платформа ссылочка на доклад ниже есть с помощью телефона Мы решили Давайте будем готовить виртуалки либо железная сервера напишем свой инстас манжет для управления контейнерами кассандрах пишем свой кластер менеджер для управления кластерами даже что-то начали писать получилось такая страшная схема которую даже смотреть не стоит Но остановились решили подумать тут на самом деле я как раз в трёх лицах Вот и подумали Какие же могут быть проблемы как дальше будем жить но действительно первая проблема это сложность управления ресурсами надо каким-то образом уметь размещать Кассандры на нодах нужно делать так чтобы эти касанты не боролись за ресурсы Нужно уметь управлять служебной операциями Но это Skylink восстановление ИПР рыбакап и так далее Также нужно понимать вообще что происходит когда у вас все поломалось и очевидно что данная схема она не добавляет понимания Ну и такое дополнительно это сложность для входа в проект новых инженеров которым придется разбираться как кассандре в схеме в коде И вообще вставляет дополнительных проблем Мы подумали А честно может помочь для управления сайтом наших мастеров действительно очевидно что рекламе не нуждается дополнительный и тут мы стали думать что же нам поможет предложить кассандру и губернатиз А мы перебирали несколько операторов и остановились а почему кицанова в первую очередь потому что основным контейнером Kit Santo является компания Data stax которая собственном антонит И кассандру за что я Большое спасибо кицанды уже включает в себя полный набор инструментов вокруг кластера который мы позже поговорим о Китае очень офигенные отзывчивые комьюнити прямо очень хороший у нее отличнейшая документация и это все вместе но и весело минусы которые тоже есть посмотрим что представляет собой оператор сердцем оператора является касса пиратов тот самый оператор который отдельно монтению дата Стас а сейчас он вам придется составе центра пирата А Он занимается тем что распределяет моды Кассандры по кубер кластерам следить за тем чтобы находились к системном состоянии вообще собственно поддерживает что Кассандра работала а другим очень важным компонентом оператора является гипер гипер это инструмент для поддержания данных Кассандры системном состоянии как сказал Александр волочков в свое выступление на Кассандра и Раша что если у вас на классе не работает ИП то ваши данные находятся в состоянии но и тут есть не полностью согласен Это очень важно чтобы у вас работал также kidson до Пираты есть инструмент для бэкапов и восстановления данных это медуза но по сути это сейчас единственный инструмент министр вменяемый инструмент для бэкапов восстановления Кассандры вот а вот кто знает вообще косан даже она такая хорошая распределенная система данные плицируется Кто знает для чего вообще нужно быка пить данные в определенной системе Поднимите руки Опа есть те кто знают замечательно в нашем случае мы делаем для того что первое защититься от логических ошибок Ну то есть разработчик сделал неправильный апдейт мы это обнаружили там через несколько дней и так далее либо от различного рода злодеянные действия таких шифровальщики также оператор включает себя ставки это такой крутой который представляет и так далее сам торгид является частью кластер но при этом не содержит себе данные Ну и как же жить без понимания происходит соответственно если представить все это виде такой красивый маркетинг картинки то можно вот рисовать как-то вот так Но если посмотреть более формально то можно это представить виде схема на которой помимо всего прочего видно что kitsuner оператор можно разделить на две логические части Control plain несколько Data Plane в которые можно расположить в различных кубинете кластерах что очень удобно Если у вас распределенная инфраструктура Мы подумали потестировали и поняли что нам не подходит мы первое мы не используем Да это такой хороший кручущий но в своем развитии он отстает от касанты то есть текущий момент поддерживает только 4.0 мы уже используем фишки 41 и на момент запуска в страги эти были было достаточно много багов для нас критичных которые устранялись либо слишком медленно либо не установится вообще мы используем свое внутреннее хранилище артефактов бинарных артефактов но образа пакеты библиотеки прежде чем Пойдет это впрот мы это либо собираем сами либо скачиваем валидируем только после этого это можем использовать нам оказалось удобнее использовать своей эксперметик на базе стандартного Кассандра экспортера и нам пришлось внести некоторые изменения для интеграции с внутренней системы чтобы аж типичный Первое у нас есть два Кассандра до центра у нас есть и перконтроллер виде отдельного дипломета который запускает в каждом кассандра-центре есть в кубе представлены и они распределяются по зонам отказа в каждом рынке У нас есть какое-то количество полов больше одного и в каждом позе запускается равно 6 контейнеров 2 и контейнеры конфликт который подкладывает медуза который работает только в том случае если у нас кластер надо восстановить без блогов это наша Сандерс Питер и медуза которая периодически если посмотреть консоль это выглядит примерно так у нас есть одноклассник в котором есть два касания дата-центра также у нас запущенный дипломета Ну и все вместе если посмотреть в виде кодов это выглядит как-то вот так Ну что прод нет Нельзя просто так взять и использовать продакшене Ну наверное даже можно Но в нашем случае мы же пилим сервис по кнопке соответственно нам нужно написать какой-то бэкент который будет предоставлять API от нашей любимой платформы и Для этого нам пришлось писать И что же у нас делает Первое он полностью управляет жизненным целиком кластер всех кластеров управляет пользователями ролями управляет квотами управляет бокапами и производит очистку мусора которая остается в клубе после работы оператора к сожалению пока это надо делать подробнее о Украине жизнь цикла входит очевидно нужно создать кластер мы его создаем Согласно шаблонам шаблоном также нам нужно убить скрили кластер мы это умеем делать мы умеем скайлить вертикально вернее шаблон горизонтально изменять размер диска также из интересных фишек мы можем ставить кластер на паузу для чего это может пригодится но допустим сознательный инженер или разработчик взяли создали себе кластер для теста потестировали поняли что кластер им какое-то время не понадобится допустим пару недель но данная при этом лучше сохранить они берут ставят кластер на паузу и когда импластик становится нужен Они горят восстановить власти и кластер восстанавливается ровном состоянии на котором они поставили на паузу Ну и очевидно что финалом жизненного цикла пластика любого является его удаление а что поговорим немножко шаблонах в нашем случае шаблон это пара из ресурсов и СиСи память и версии Кассандры на базе этих шаблонов у нас строится различные настройки генерируются различные стойки Живые и различные настройки Кассандра тут яму вообще для чего это нужно это нужно первое для планирования то есть мы таким образом можем планировать ресурсы лучше и для стандартизации Мы всегда в принципе понимаем лучше что где у нас происходит также наш пакет управляет пользователями он может создавать пользователей создавать кейспейс тут стоит остановиться подробнее для чего это нужно делать Мы не хотим давать пользователю возможность создавать есть Space чтобы У пользователя не было возможности ошибиться то есть мы создаем их стандартно и мы создаем их правильно также мы выдаем права пользователям диспейс и очевидно что пользователю нужно как-то авторизоваться соответственно Вольт также наш бакен берет на себя все полностью богатыми То есть пока по создаются по расписанию которое автоматически у нас мониторится чтобы капы вообще происходят что там ошибок нет и происходит периодически восстановление Пока Чтобы покапы не были богатыми А кто вообще тестирует в зале есть такие люди О Круто молодцы уважаю просто да мы это тоже делая себя и тоже Ну и производит удаление различных мусорных объектов допустим после работы медузы остаются много различных серди которые накопившись могут мешать работе кубик кластер Ну и там некоторые другие удаления кластер Да мы все это запилили у нас все это работает Мы решили остановиться и подумать А подумать то пришлось над кодом Дело в том что наш саундбакенд он тоже запущен в куберетесь и если посмотреть чуть подробнее то мы видим что у нас есть некоторые длительные синхронные операции управление пользователями саданики Space автоматификация кластера полми это все асинхронной операции и мы столкнулись тем что Вам приходится Все больше изощряться для того чтобы где-то хранить состояние чтобы бороться с состоянием гонки и все прочее тут подумали А что бы эти операции не взять и вынести в отдельный оператор Ты же мы можем сделать можем и решили вынести все это оператор оператор в принципе как оказалось написать не сложно то есть стандартный оператор ссылка ниже там отличнейшая документация там куча примеров разбили все наши операции на атамарные для хранения статуса Почему не используют метки аннотации взяли использование и фактически мы для каждой для каждой длительности написали конечный автомат метками все оказалось проще чем мы думали что же и мы немножко поговорим о проблемах Но прежде проблемах какие у нас есть нюансы которые мы не считаем проблемой пока но первое у нас сеть Какие до со всех пудов они должны быть доступны как клиентам так и другим кодом кластера нас точно также мы используем отдаем все IP адреса кластера за одним доменным именем пользователь бьет пользователь видит одно доменное имя которым он подключается Ну и пока у нас есть проблема что горизонтальный скрининг возможно только в большую сторону это такой нюанс пока есть мы не можем пока автоматически посчитать Можем ли мы для данного кластера сделать на нужное количество то есть мы этим работаем но пока к сожалению не реализовано теперь о проблемах первое проблемы с бэкапами все они хорошо они делаются по расписанию все замечательно но есть нюанс что внезапно мы обнаружили что первое мы занимаем канал бэкапов тебя растут как количество все таки растет и соответственно Мы даже немножко Да мы делаем Backup и тут вот да поняли что надо разносить время начало бокапа для разных кластеров причем разносить нужно не только при создании этих кластеров А этот процесс должен быть периодически нужно нужно постоянно мониторить загрузку канала загрузку S3 загрузку вообще ресурсов и ходить по кластерам и сдвигать время покапов и выяснился очень интересный момент что нужно не нужно удалять бэкапы полагаясь на стандартные которые есть составите сами пирата почему это нужно делать А если у вас в одном из прессе Есть несколько кластеров но Казалось бы обычная ситуация то медуза он удаляет бэкапы не только для своих мастеров что в общем-то печально Да мы сделали еще мы закинули квест в последние Если вы пользуетесь не последние оператора то лучше так не делать также Мы периодически восстанавливаем кластера и соответственно Какие возникли проблемы первое нельзя восстанавливать в тот же кластер и или с тем же имени киса на кластера тут достаточно смешно получается что класть о которой вы восстанавливаете он может стать частью продакшн кластера Что приводит деградации потери данных и так далее не очень хотелось бы также восстановление большого жирного кластера очевидно что требует много ресурсов но ровно столько же сколько потребляет ресурсов это власти что мы делали сейчас рассмотрим алгоритм тестирования первое мы выбираем кластер Согласно метки то есть мы смотрим когда он последний раз накапился и выбираем самый старый если он ни разу не выкатился но очевидно что мы выберем его Да дальше мы дублируем спецификацию и почему сам объект и цена пластик немножко подробнее мы дублием спецификацию через носик копи дальше мы переименовываем кица на кластер удаляем все дата-центры кроме одного потому что мы знаем что у нас в каждом пациента есть полная копия данных зачем их восстанавливать также мы меняем шаблон для кластерный минимальный и меняем тип тоже на самый дешевый нашем случае это HD чтобы не восстанавливаться на DSD дороже Ну и нам не нужен Кассандры кстати для восстановления очевидно что зачем нам тратить ресурсы Мы тоже дальше мы в принципе аналогичным образом копируем патчем сущности сердечки медуза backups После этого мы создаем кластер Когда у нас пластик создался мы создаем сердечко медуза после того как создали все сидишкам Джобс это стандартная процедура для центра у нас происходит так такое что класть останавливается и полностью все все ноды останавливаются и он начинает процесс восстановления то есть выкачкой заст-3 проверка все вот это вот кластер нас остановился мы его проверяем Казалось бы как можно проверить произвольный кластер на то что нормально восстановился Ну некоторых случаях можно смотреть схемы кластер делать какие-то запросы но нам показалось это слишком не оптимальным мы просто проверяем размер Ну и очевидно что на каждом шаге данного алгоритма у нас все обложено метриками обложена лептами мы знаем сколько мы по времени мы можем остановиться в случае какой-то аварии Когда нужно это восстановить есть у нас пришел нам не дать соответственно мы это дело исправляем что мы должны иметь диски какие у нас при этом были проблемы первая проблема что самой сердечки значение и сами им тренеры кисандеры они в общем-то против того чтобы значение царь было не мутабельно то есть они существенно против также в нашей текущей реализации Куба мы не можем увеличить размер позиции полем онлайн то есть Нам нужно останавливать плоды Ну из этого следует что все изменения должны происходить по одной ноге Да чисто теоретически можно работать сразу но тут мы решили просто перестраховаться что давайте посмотрим как мы это делаем изначально вообще проверяем Можем ли мы сейчас запускать процессы сайта опять чтобы перестраховаться у нас возможен только один процесс и сайт в одно время если Мы это можем соответственно вообще есть у нас у данного кластера дата-центры которые нужно еще После этого мы патчики цанду немножко подробнее а дело в том что у самого у самого кицандры и мутабельность взаимотабельностью этих параметров сидит валидеш наверху и по идее можно бы можно бы его отключить на какое-то время но опять же сами ментейнеры кидсанды они существенно против чтобы у этого хука была возможность его отключить что мы сделали Мы накрыли webhook на несуществующие ресурсы то есть мы заменили кассандр этот центр секс то есть мы таким образом патчем и собственно отключаем наш круг такой грязный дальше мы уже работаем с контрацептом немножко подробнее мы смотрим есть ли у нас поды которые нам нужно отрицать выбираем вот чисто произвольно берем запоминаем у него устанавливаем период тоже немножко подробнее для чего это нужно период того чтобы центр не запускал циклы и канцеляции и не мешал нам работать состоит сетами и так далее сущностями которые и здесь еще один момент что если посмотреть то видно что хватит период он находится в секции статус то есть его нельзя просто взять и запачить нужно патчить именно кастом ресурс остались статус Ну что ж мы запачили после этого мы удаляем State и удаляем пост который мы работаем тут стоит заметить что если есть другие подыто они абсолютно нормально продолжают работать и при этом все хорошо дальше мы патчем собственно писи здесь мы просто меняем сайт ждем пока все поменялось дальше мы восстанавливаем период После этого мы создаем сет и тут коса на дата-центр видит А у меня не хватает подав стоит и начинает запускать Этот плод после как под запустился мы это видим что у нас количество состояния по сторона количество мы считаем что у нас все хорошо Кассандры поднялась и если у нас не осталось собственно подав которые нужно дальше мы собственно центр мы там меняем уже и если у нас не осталось сангов запачить мы патчем собственно самому и цангу вся на кластер возвращаем в управление выпуклу и все хорошо Ну тоже также понятно что мы на каждом этапе данных данного алгоритма Мы полностью обложены мониторингами обложенной метриками мы знаем За сколько мы можем застрелить Да это процесс длительный но он конечный и в результате у нас типичный кластер теперь выглядит как-то Так у нас есть центра запущен в каком-то в каком-то одном у нас распределены проценты по доступности то есть по тем река бака по нас отливается на 63 логики имеют такие аудит отливаются наши внутреннюю систему Какие же у нас особенности вообще видит пользователь первое так как мы создаем и Space и сами то соответственно у нас нет полиции возможности создать splicational фактор данных всегда 3 то есть вот только ты дальше мы ограничиваем все пользовательские операции стиле они ниже локал клоун тут в самом докладе ниже ссылочки Что такое может такое консистенции Что такое мотивацию и так далее дальше мы запрещаем создавать пользователям почему это делаем потому что материал неправильно его использование даже в принципе правильно большинстве случаев приводит деградации кластера это печально также мы запищаем запросы салу фильтренинг если повести пример аналогии то это запросы с вулканом Ну зачем они нам нужны Нет мы не будем делать не будем разрешать для того чтобы уметь восстанавливаться за какое-то вменяемое время мы ограничиваем размер диска на одной ноте в один терабайт И к сожалению наш текущие три он накладывает вещи ограничения что с максимальное количество баков пока три Ну и также у нас есть полный авторизации операции изменения схемы Мы полностью всегда знаем что делал пользователь с кластером а что же пользователю Чем может сделать кластером Ну пользователь может создать базу данных он создает вас данных вводит имя водит тот кейс который он хочет водит версию Кассандры выбирает канал куда ему будут присылаться алифты если он не укажет канала Лев для алефтов он не сможет базу данных То есть он всегда должен понимать это выбирает конфигурацию реплики на тот самый шаблон выбирает размер реплики может выбрать это у него тестовое окружение либо продакшн окружение от этого зависит у него будет один тот акцентом Зачем тесте либо нажали кнопочку что мы видим первое мы видим что у нас база создается точнее статус создания с окружения канала для лептов и ссылочку на мониторинга фанеры сразу на каждый власти есть обязательно также мы видим что у нас данном случае есть дата-центра в каждом пациента есть конфигурация реплики пресетом сколько нот версия Кассандры и если посмотреть внизу то видно для подключения за которым собственно спрячется все ноды Ну вот у нас базы данных создалась а видим что она пришла статус активный чем же мы с ней можно сделать Ну первое мы должны к ней как-то подключиться для этого у нас есть URL и мы можем отобразить параметры авторизации нажимаем эту кнопочку Мы видим что у нас появляется токенс который Вам нужно сходить вольт чтобы его ограбить и там уже будет Будут секреты там продублировать свой URL там пользователь там пароль танки Space замечательно также можем поставить на паузу Я уже рассказывал чего это нужно мы можем редактировать параметр кластера что же мы сейчас можем именно сделать мы можем заскелить вертикально изменить конфигурацию реплики мы можем горизонтально увеличить количество и также мы можем изменить канал для лектов если мы вдруг случайно ошиблись К сожалению пока мы именно изюм и не можем изменить размер размер диска на ноги но вот и также мы можем базу данных удалить И вообще для защиты и только в этом случае мы используем такой не знаю Как обозвать прием что мы заставляем пользователя ввести имя этой базы только потом производится какие-то действия Ну данном случае пользователь будет базы и нажимать кнопочку удалить Ну что это сервис Да Казалось бы но нет это не сервис что для сервис сервис Для нас это не только Кнопка это целый такой большой комплекс мероприятий первое помощь при проектировании что же подразумеваем это в первую очередь моделирование данных на мой взгляд правильно моделирование данных Это примерно 60-80 процентов успеха работы кластера мы Для этого используем диаграмма Че бедко к сожалению именно вопрос моделирование данных не войдет этот доклад там можно будет посмотреть отдельно доклад Саша Пащенко на следующем джоке мы помогаем пользователю подобрать в зависимости от его данных статей компакшена под статьей компактный тоже очень сильно влияет также мы помогаем пользователя подобрать внутреннее представление таблиц допустим размер чанка и так далее Это тоже все не влияет на производительность дальше мы помогаем пользователю мигрировать данные Ну то есть у нас есть как у нас есть какой-то сервисного пользователя какие-то старые базы данных и очевидно что пользователь захочет мигрировать данные из старых неудобных баз данных в нашу красивую крутую удобную Ну первая миграция из Тая Кассандра Тут все просто сам процесс описан в общем-то на самом деле мы так ему исследуем что мы сначала пинем трафик на старой кластеры затем создаем Кит Санта кластер с тем же именем но до центра другое после этого запускаем процесс все еще общается со старым кластером дальше мы переключаем трафик на И после этого Вполне себе можно ставить власти Тут все просто тут никакой магии нету Кассандры позволяет к самой Молодец что же делать когда у нас есть необходимость иммигрировать не всю базу целиком а допустим либо если какие-то отдельные таблички либо вообще иммигрировать из окна после всего прочего и касановского Ну первое мы создаем кластер Согласно всем рекомендациям мы прорабатываем модели данных и включаем параллельную запись включили проверим запись И тем самым мы проверяем что у нас общем-то Кассандра выдержит просто нагрузку по записи дальше мы запускаем мигратор включая миграцию тут мы не только мигрируем данные тут опять же мы проверяем что у нас Кассандра выдержит там X2 x 5 x 10 нагрузку Да если не удержит надо разбираться После этого мы запускаем корпоратор тем самым мы проверяем что у нас данные в косанду записались те самые что нужно не записались правильно и опять же мы проверяем что Кассандры выдерживает нагрузку на чтение если она не выдержит Извините Надо разбираться После этого мы выбираем компаратор и включаем чтение из двух источников запись тоже до источника при этом у нас идет корпорация на клиенте это тоже важный этап если здесь есть какие-то ошибки с этим обязательно разбираться если ошибок нет замечательно мы отключаем чтение старого источника оставляем запись пока оба источника и живем Так какое-то время если тут все хорошо замечательно берем отключаем второй базы таким путем в принципе а что дальше сервис у нас это понятные для пользователя графики алерты что мы Для этого делаем первое пишем для всех алертов пишем гран-буки что делать пользователю пишем документацию чтобы было пользователю понятно что у него Происходит кластером что на графиках Какие действия нужно производить и так далее пользователи нажимать Понятно ограничение кластеров вот я вот описывал выше какие были ограничения наши пользователи понимают почему так происходит и для чего это сделано Ну и одно и то же важное что пользователь вообще не должен думать некий служебных операциях зачем это же сервис у него есть кнопка он не должен думать не бокапах не ИП ничем прочем он знает что у него что он создал пластик по кнопке у него есть все весь инструментарий и у него все работает само все остальное у нас собственно берет на себя Либо мы либо Ну и самое главное На мой взгляд что пользователь должен понимать как работать с кассандрой Как работает мы проводим постоянно регулярная презентации Как работает обменяемся лучшими практиками обменес лучшее практики как по построению так и податам оденгу и сейчас у нас уже в компании выросло два крутых инженера которые разбирается эта модель ноги и один нереально крутой у которого я прихожу советоваться который берет берет на себя много обязанностей по данному причем совершенно добровольно и наверное бесплатно Дима привет Ну что работает у нас уже в кассе более сотни кластеров и соответственно надо двигаться дальше что мы планируем дальше первое мы планируем в остальные из бакапа на определенную точку по кнопке сейчас текущей ализация Медуза это не позволяет на именно на pointime восстановиться увеличение размеров тоже по кнопке часто в работе уменьшение размер кластера по кнопке тоже над этим думаем встроенный VII инструмент это моделинга у господина кашлева который является одним измерением был отличный инструмент который на базе диаграммчик ботко строил именно уже ddl can который можно было платить собственно Мы хотим это повторить у себя сделать чтобы пользователь рисует использовать диаграммы чебатко и у него появляется уже такой сразу и он либо автоматически либо поправить немножко руками я платится власти дальше на базе этого мы собираемся сделать библиотек на нескольких языках программирования скорее всего там это будет и яваго питон чтобы библиотека бы это была Великая бердка и которая включал бы себя как операции по кластеру это наверное должно быть удобно и скорее всего будет пользоваться популярностью пользователь надо думать о том как правильно подключаться и так далее Ну и дальше у нас планах есть другие распределенная база как сервис Наверное это будет Первое будет гигабайты Яндекс есть несколько полезных ссылок особо рекомендую посмотреть Если вы еще не смотрели Раша где очень хорошо на русском языке рассказывается о кассандре рассказывается окицианды затронуты вопросы дата моделинга описан некоторые клиентский опыт вот прямо рекомендую как люди там сказано как люди живут с кит Сандрой из Кассандры вот мировые практики очень очень рекомендую а сервис Для нас это не Кнопка не только кнопку не столько Кнопка это именно целый большой комплекс мероприятий и над этим надо работать чтобы вашим сервисом было попользоваться удобно также всегда нужно разбираться как реализовано решение внутри Ну действительно в нашем случае нам пришлось патчики Санту нам пришлось починить отдельно медузу нам пришлось почить риппер то тоже достаточно интересно мы у себя запрещаем но сам себе гипер внутри использует запросы информации Казалось бы не там не нужны Ну действительно они нужны то есть там достаточно создать индекс у себя просто создаем индекс и убрали запроса Все просто все хорошо то есть не нужно лично для себя из этого проекта я вынес что слова нужно есть по кусочкам то есть вот изначально проект казался таким большим неподъемным у нас будут инженера инженеров но правильного декомпозировав и как-то по частям Мы в принципе Сколько за полгода вы сделали вот он же работает дальше Мы просто его допиливаем ну и самое важное На мой взгляд продукт мы делаем в первую очередь для клиентов то есть наши заказчики это клиенты это не наши руководители это незнание держателей там сервиса не менеджеры это клиенты это надо понимать Для чего делаем там акцент но я понимаю что все собрались для секса собрались принципе не сложно сделать классе по кнопке обычная Техническая работа это никакой не марки Science но опять же многие забывают для кого они это делают И от этого сервис получается неудобным И в частности Я вот уже сейчас обсуждениях слышал что это не наша работа мы это не будем делать собственно Для чего нам это делать не наша работа не кажется так быть не должно мы продукт делаем клиентов и Именно они наши заказчики то есть мы должны делать не надо лениться надо просто подумать что будет хорошо и делать Ну что ж Спасибо за внимание ваши вопросы Спасибо Алексей классный доклад много технических деталей У нас есть пара вопросов в чате первый твой любимый вопрос я думаю так рассматривали Клик Хаус или почему выбрали именно Кассандра У меня даже есть специальный слайд для данного вопроса Да мы безусловно рассматривали сциллу серьезно мы ее рассматривали но тут есть такие моменты первое мы Тестируем мы протестировали сциллу и мы не увидели какого-то перформанса который бы повышение перформанса ациллы по сравнению с той же самой безусловно если взять ссылку которая идет стандартной поставки и Кассандры которые поставки с непремальными настройками то сила выиграет силы такое офигенный хороший маркетинг то есть они действительно Вот именно вот так вот подходят то есть используешь кассандру они знают что Санта И вот так вот Вот так вот подходит И вот это тоже один был одним из тех пунктов которые отталкивают Ну и такой ответ что кассандру как я уже говорил мы любим зачем же нам изменять тем кого мы любим Спасибо так и второй вопрос в чате был так вы говорили что нужно разносить время бэкапов в этот разнос делаете вручную или автоматически опираясь на нагрузку если автоматически то как конечно вручную мы это не делаем Это вручную это как это такая обезьяне работа она достаточно бесполезная вот как мы это делаем У нас есть наша крутая внутренняя система мониторинга Sage которая собирается достаточно много почти со всего продакшена и соответственно на базе метрик можно строить какие-то отчеты Ну данном случае мы опираемся на отчеты первое по загрузке каналов и второе мы опираемся на отчеты по загрузке стоит и на базе этого мы наш наша функция ходит и бэкапов пока там все сделано достаточно топорно Я даже не знаю стоит ли это но при этом автоматически Да да конечно автоматически Но это обещание работы с руками делать это такое себе на мой взгляд Спасибо так в чате пока все продолжайте писать вопросы корку на слайде мы все равно обсудим дискуссии Давайте вопросы Из зала пожалуйста Да спасибо за доклад У меня есть вопрос А ты в принципе немножко осветил Да что Вы стараетесь пользователей тоже учить работать Кассандры чтобы они правильно пользовались Но все равно это все-таки сервис по кнопке чтобы они приходили без вас да нажимали кнопку получали кластер Мы тоже скоро будем делать многие разные базы как сервис Вопрос такой Кассандра довольно специфическая база не нужно уметь работать например ты не можешь там один ряд Написать много миллионов записи Да ты не можешь удалять очень много потому что будут проблемы с могилами Вот как-то это мониторить контролируете вообще что клиенты с этой базой делают они по кнопке получили это здорово А как потом контролировать что они сломали Это первый вопрос контролируете ли вы это и второй Это чья потом проблема И кому это все разруливать да Когда вы это заметили что что-то пошло не так да спасибо Ваня за вопросы Ну я начну со второго вопроса Чья проблема Проблема наша Мы команда мы должны решать проблемы а то что пользователи пользуются сервисом неправильно это значит где-то наши есть недоработка то есть пользователи должны пользоваться сервисом правильно по поводу контроля абсолютно тоже очевидный ответ у нас все что можно обложено метриками соответственно у тебя наметниках видно А тебя есть птицы и хорошо какого-то момента доходит потом загорается лампочка после этого к нам приходят либо не приходят если они уже сами достаточно опытные подсказываем как это правильно разрулить по поводу могила при удалении тут немножко сложнее Дело в том что у нас настроенные варниги на некоторые трэшхолды по количеству могилов в запросе но мы по количеству могилок которая получает пользователя запросе чтения Но это получается такая какая-то косвенная операция и если ты данная читаешь но очевидно что у тебя ты об этом не узнаешь как пока кого-то другого способа Как это узнать я к сожалению не знаю тут тоже обложена мониторингами То есть метрики аллерты тут знаешь только после того как это уже произошло не было таких проблем еще что у вас база Call стала того что там могил кулаком вставала база от этого была какая-то деградация которую лечили то есть там есть некоторые как это можно лечить соответственно у нас есть план мы пользуемся Спасибо еще вопросы Здравствуйте спасибо большое за доклад Вопрос такой как вы тестируете новые фичи на сервисе чтобы они не ломали уже существующие кластера И второй вопрос если например сервис данный момент стоит или не работает Что будет с тирами и как вот например если вы понимаете что он не так работает или что-то случилось с ним функционированием что Что вы делаете в этот момент так начнем свечей у нас есть три окружения получается Если окружения дев стоишь и провод но очевидно что мы Тестируем полностью функционал на дереве Меня это конечно жутко бесит но на каждый КАМиТ у тебя происходит долгие нудные противные интеграционные тесты то есть тебя все вот основные ручки которые у тебя есть vpi они все дергаются То есть ты вот это все должен все это должен пройти прежде чем твой комик попадет в Мастер вот таким образом По поводу того что если у нас сломается сервис если вас сломается бэкент не произойдет ничего сломается дальше работают есть есть управлять если что можем руками через не проблема а вот если сломается тут немножко сложнее да тут зависимости от того как он сломается могут быть проблемы Но жизнь такая еще уточнить вопрос Три разных сервиса или это все внутри одного то есть нет это у нас вообще отдельный губернатиз кластер Для Дева то есть для каждого отдельный губернатик власти для дерева то же самое стыч то же самое они большие поэтому можно много обновлять немного но периодически то есть вот скажем так можно разделить ее на пути То есть у нас идет 1 путь обновления как бы не снизу то есть обновление Куба обновление самой оператора его компонентов и обновление обновляется достаточно часто постоянно допиливаем там либо что-то еще а уже сам официанту мы обновляем там Достаточно долго и жесткое Тестируем Вот и после только обновляем это я там потому что они вносят иногда такие что это не стоит просто так брать и обновлять на пороги даже на тесте еще вопрос сказали когда сервис не работает можем руками что-то поменять когда сервис восстановились как синхронизируется настройки Хороший вопрос вот настройки чего настройки отдельных кластеров мы не синхронизируем мы можем руками Если вы поменяли руками то они у нас потом автоматически сами не меняются у нас загорается мониторинг что есть такой есть совпадение настроек для кластера в сервис конфигурации так скажем тогда и собственно в самом пласте Вот только так мы знаем Спасибо большое спасибо у нас кажется вышло время основного поэтому все остальные вопросы Мы предлагаем задать в дискуссии мы туда переместимся буквально через 2 минуты буквально за стеночкой входа Спасибо"
}