{
  "video_id": "4d4PvZoJ6QY",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Всем привет Всем привет ребята А мы рады вас видеть сегодня в этот утренний денёк хорошо что вы нашли силы Встать пораньше после автопати потому что не всегда это просто и пришли сюда Молодцы Спасибо вам Я хочу представить вам Александра шинкарёва основателя и владельца директора компании турмалин кор у Александра больше 12 лет опыта вой тики всё уже повидал от деплоя архив вручную собранных на вирту нанде вся контейнеризации заливки автоматической вр и сегодня Саша как раз расскажет про то как они попробовали придумали разработали и внедрили у себя поднятие кубера локально прям у разработчиков на тачках на локальных и у меня сразу вопрос Саш вот есть два пути наверное основных когда есть девос которые там шат за вот-то там ря и разработчики не особо вникают в это всё есть все кто на конференции присутствует вот первы ну я думаю тут Да и второй путь когда разрабы чуть сильнее погружены во всё это и умеют сами писать пайплайн образы собирать билдить деплоить и вопрос по какому пути пошли вы наверное и почему Ну получается так что весь этот доклад Он наверно скорее про второй путь когда у команды нет нет выделенного ресурса но есть достаточно экспертизы насмотренности опыт уже тоже как у меня в качестве консультанта архитектора а и мы пытаемся собрать всё что знаем вместе и получить лучший Dev Experience когда ты можешь это сделать просто И постепенно начинать с этим разбираться А не сразу в самой дебре когда тебе кто-то что-то показывает отдаёт тебе клавиатуру говорит Пиши Ямал вот мы пытаемся сделать чтобы это было доступно каждому это круто а разработчики они не сопротивляются тому что вот им надо что-то новое изучать уметь умирают умирают Да но я думаю что тут опять Да боль через принятие сначала умирают а потом приятный момент если человек подходит и говорит Да я попробовал дал этому шанс И подтянется это вот у нас про ТДД такая же штука бывает очень круто Тогда давай подробнее как раз и расскажешь как это устроено у вас в деталях и насколько это просто или тяжело мы как раз и посмотрим и тебе сло постараюсь всех убедить Окей ребята Ещё раз привет Спасибо Антон за введение сегодня ещё раз да поговорим о том как запускать веб продукт в кубе начиная от разработчиком заканчивая продом и клиентским железом супер Давайте потихоньку начинать в темпе медленного или быстрого вальса что нас сегодня ждёт начнём мы с того что расскажем С каким кейсом к нам пришёл клиент Какие условия вот эти ограничения сподвигли нас на то чтобы объединить все кусочки которые мы знаем и создать что-то лучшее более прикольное современная Потом посмотрим вместе с Джастином Бибером в деталях а что конкретно Как именно сниппеты примеры кода будут то есть всё в опенсорс всё в открытом доступе Вы можете брать использовать лайкать или дизлайка и надеюсь что по ходу доклада сложится впечатление что это нестрашно доступно и можно это использовать даже с коллегами которые только начинают свой путь там докер немножко разобрались а всё остальное ещё пока тёмный лес Итак какой же у нас был кейс вот если так его сильно обобщить то нам нужно было сделать r&d проект poc получить в результате трёх-четырёх сго стей мы немножко пере оверин нери и придумали что там нужен нам elastic sech cks S3 и всё это для ML сервисов и процессинга А самое главное что нам надо было быть готовыми к тому чтобы в конце этой итерации задеплоить Это куда угодно и что же значит задеплоить куда угодно и почему а потому что клиент не может выбрать типа А что же где мы будем хостить а какое облако мы можем выбрать А вот у тебя вообще бюджет есть в твоём отделе Да есть но я не хочу чу тебе его давать на вашу странную активность то есть деньги есть но очень сложная медленная бюрократическая машина поэтому непонятно где В итоге а соответственно надо быть готовыми к тому чтобы задеплоить куда угодно а куда угодно это либо Облако которое они выберут либо интранет И вот я немножко упустил что мы собирались сделать по дефолту кубернетес приложени потому что Для нас это уже Стандартный вариант как деплоить веб-приложение состоящее из нескольких ну микросервисов назовём их так что ещё влияло конечно то что мы делаем недельные спринта клиент сильно вовлечённых продукто оунер который хочет сразу играть с прототипом и смотреть получается Не получается Значит мы хотим дать ему возможность запускать эту штуку у себя на компьютере раз хостинга у нас нет также команде где-то надо что-то начинать и всё это вместе интегрировать и постоянно проверять опять-таки команда тоже хочет кушать первая идея которая приходит на ум Окей Клиент не может нам предоставить облако Давайте запили своё тестовое окружение поднимем его и будем счастливы опять-таки Да Клиент говорит нет Может вы сами мы говорим что нет мы сами тоже не хотим не готовы Потому что есть определённые риски что данные которые нам даст клиент которые мы где-то захотим в Облаке публичном Уте если мы захотим у себя внутри компании на серверах клиенту тоже как коннектится тоже проблема нерешаемая плюс Мы помним что мы не знаем где мы окажемся Че через 4 месяца поэтому этот вариант мы отме таем он не подходит и весь тот опыт который был на на тот момент агрегировать запускать весь проект локально в кубе каким-то приятным способом супер но почему в кубе то есть Может быть в докер композе поднять все эти там 5 сево сервисов и всё будет хорошо включая хранилище здесь опять-таки из опыта который мы дальше немножко посмотрим было сложно совмещать кубер который находится в проде и docker comp который находится локально который тоже нужно поддерживать А самый головняк начинается когда у вас есть порты в докер композе У вас есть 10 сервисов Вы не знаете как же эти порты вообще по какой схеме аллоцировать чтобы все запомнили и начинается Путаница и в проде ще другие порты там бы всё на восьмидесятом хостить и не заниматься ерундой и последняя концептуальная идея желание сделать лучше сделать гомогенное То есть одинаковое окружение насколько возможно одинаковый экспириенс работы с продом и работы локально разрабатывая продукт тоже чтобы там тоже был кубер в данном случае если кубер на проде кубер на компьютере меньше переключения контекста чуть как будто будет легче небольшая для тех вот может быть у кого коллеги путаются Что такое докер Что такое ку Бернес вот есть прекрасный иллюстрированный гайд кубернетес для детей вообще кто-нибудь встречался поднимите руку пожалуйста с этой штукой супер А кто советовал коллегам и они были благодарны вот один человек и я ещё Да супер Офигенная штука Я думаю что вот именно так надо делать гайды документацию вот На таком уровне с картинками Ну это прям шарте будет очень круто Я за ребят ребятам благодарен кто это сделал супер cuber локально чем же можем вообще создать локальный кубер Да из моего опыта который тоже ограничен приходит на ум ми Cube k3d k3s docker Деп в котором cuber тоже встроен и может быть существует уже ещё несколько разных вариантов опций куча А мы взяли и выбрали штуку под названием K Какие причины объективные документация сразу понравилась То есть ты открываешь тебе всё понятно ты такой чувствуешь что здесь поработали ребята на славу и сразу всё запустило по гетин стартед всё супер вообще классно а хорошая документация Мне кажется это вот какая-то забота которую ты чувствуешь Вот подспудно её сложно объяснить но ты когда работаешь с этим продуктом и с тем как он задокументировано тебе приятно А тебе позаботились те вопросы которые у тебя возникают ты на них быстро находишь ответы Хотя документация Ну среднего размера назовём её так Ну и конечно третья объективная причина клиент как крутой Технический специалист сказал что Ну я вот вообще пробовал запускать cuber локально вот kind а мы такие о не слышали Ну давай посмотрим и нам понравилось и всё сложилось напомню что kind нам нужен для того чтобы создать кластер куберский в докере и вот это важная штука здесь впервые появляется докер что кластер там мы создаём внутри контейнера не просто устанавливаем его как-то там или ещё что-то виртуалки разберём немножечко ещё технологии которые кроме кайда используются понятно что используется HM пакетный менеджер для кубернетес который позволяет задеплоить единственный сервис в cuber завернуть его и отдать кто-нибудь знает вообще что значит HM я тут сегодня утром решил погуглить Ага для тех кто ещё не задавался этим вопросом потому что helm helm File helm div вот это вот всё это рулевое колесо А кубернетес наверное тоже уже Погугли Но это что штурвальный штурман не штурман штурвальный Ага вот такая небольшая этимологическая пауза супер умеем деплоить один и начинаем переходить к тому что есть ещё фай у нас в этом Сета афа - это шаблонизатор поверх шаблонизатор которым является отвратительное объяснение если честно самое главное что фай позволяет не один сервис а несколько сервисов вот вчера на докладе ребята хорошую аналогию привели они тоже используют F что вот это как доке ко типа запускаешь сразу несколько сервисов тут несколько сервисов депт кто-нибудь вообще слышал про него Ага кто используют А кому понравилось Ага есть есть есть нюансы супер и здесь ещё есть div div использовали Кто использовал фай Окей согласен с вами эта штука позволяет посмотреть что изменилось с момента последнего релиза в кластер То есть ты видишь что в данном случае например там latest версия ЮА была заменена на локальный докер образ и это я покажу чуть попозже конкретный пример почему это так это просто как он показывает что поменялось Что добавилось типа как в гите очень удобно Круто У нас есть возможность задеплоить один мы можем задеплоить все А после того как мы задеплоил бы классно иметь возможность посмотреть что там моя позиция Давайте не будем использовать cli где Возможно Давайте не будем использовать git cli Давайте использовать git uui и учить этом молодых коллег которые только приступают и также Давайте использовать Lens или если важно Open Lens Хотя они опять сделали бесплатным использование для персонального для персональных целей то есть где-то полгода назад что-то или год нельзя было месяц Триал и потом CD А сейчас вот опять они откатились с тем что люди перестали польз раз которые не пользуются не просят компанию купить лицензию Вот я думаю что ВС очень просто это моё личное мнение супер есть куча инструментов и вот Три весёлых поросёнка Windows macos и Linux как бы спрашивают нам А что мы будем делать сколько документации напишем как будем отлаживать и возникает вопрос А может быть всё-таки продолжить педалировать тему Докера и максимизировать внедрение Докера э тоже как-нибудь в докер запихнуть потому что мы хотим кросс платформи Мы хотим чтобы у каждого запустилась У кого есть докер Вот это основная идея которую мы преследуем потом можете посмотреть там на стене смешная картина которая вот из Диснея и там подпись В общем забавная супер инструменты ещё раз подрез Все инструменты которые были названы отвечают за то чтобы в р вообще в принципе задеплоить это вот то что мы используем фай опциональная штука Но это наш выбор Kent Нам нужен чтобы кластер создать куда мы потом всё это задеплоил мы посмотрим что это и это наверное единственный инструмент который устанавливается просто на операционную систему только вчера понял что вот он-то у нас в докере не лежит и и ладно И здесь появляются вообще де контейнеры которые позволяют всё это в докере удобно для разработчиков предоставить кто вообще слышал что такое де контейнер про них кто пытался внедрить кто остался доволен да то есть где-то наполовину остались довольны сейчас немножко расскажу что это за технология такая де контейнеры это на самом деле всего лишь этен для IDE vs код которая бесплатная от Microsoft во многих используется технологиях на фронтенде скорее стандарт дефакто если из бесплатных выбирать и что позволяет делать этот extens Он позволяет открыть репозиторий внутри де контейнера И когда вы видите терминал который обычно у вас просто ведёт в операционную систему и в той папке в которой вы работаете на самом деле это терминал который запущен внутри докер контейнера в котором можно предустановленные инструменты и в нашем случае мы предустанавливать всё что было перечислено до этого и ещё немножко больше просто чтобы было и чтобы работало с десктопным докеров то есть ещ раз контейнер - это как бы то есть вот чтобы на ноутбук каждый раз всё не устанавливать А описать декларативное и вы просто вводите команду у вас всё работает не надо 50 раз всё устанавливать на разных системах и заказчику тоже можно это как-то передать Ага для контейнера можно использовать дофа как способ описания от туда нужно установить я такой е немножко пописал е пописал потом понял что я не могу никак согласовать все эти библиотеки а ещ доке пытался туда запихнуть и понял что я просто может некомпетентен для этой работы посмотрел что есть ещё и оказалось что есть в деф контейнерах фичи Кстати на Первом слайде про деф контейнеры была ссылка на доклад пса Год назад где мои коллеги уже рассказывали вводную про эту штуку Очень советую и есть контейнере фи которые позволили вот таким маленьким днм зависимости которые нам нужны и очень классно что они просто все заработали вот уже это может быть мне повезло именно в этом кейсе но вот всё сложилось оно работает и я счастлив доволен это видимо очень тонкие прослойки на самом деле над этими инструментами круто мы посмотрели какие инструменты что зачем почему давайте уже немножко углубит пример который намм нужен чтобы понять А как вообще че деплоить продукт и сквозным примером здесь будет Ду приложение в котором есть только UI который делает запросы API там введение списка простейшее никакой аутентификации никакой базы вс чтобы пример был максимально простым и показательным и здесь мы впервые начинаем говорить о таком термине как Local И что же такое Local Ну это вот как раз окружение разработчика чтобы запустить весь продукт и там у нас например в отличие от прода не будет htp потому что он нам вообще не нужен там и вот то что мы ручками делаем на компьютере на каждом Единственное сейчас это мы прописываем в Host вот такой вот домек чтобы было более похоже на продукт а не использовать Local Host меня вчера спросил Антон зачем мы это делаем и я подумал подумал и не понял В общем мы делаем может не делать надо Local Host просто оставлять тоже вариант супер есть Local Но что такое Local на самом деле Local - это ре в которой вот вверху вы видите контейнер фа СМИ которые описаны чтобы Def контейнер содержал в себе инструменты все которые нужны эту репу Мы открываем в ВС коде В контейнере там всё установлено дальше есть файл в котором описаны все сервисы продукта в нашем случае это функциональные сервисы это UI API А и конфигурационный файл для файл для кайда чтобы кластер создать вот там есть ссылочка это всё орное запускается можете пробовать если у кого не запустится и это касается всех примеров которые есть доклад Пожалуйста пишите подходите Я буду рад узнать что ничего не работает но мы старались вроде проверять супер есть репа запу репу хотим создать кластер первое что нам надо сделать У нас есть докер vs код мы репу склонили создаётся кластер по вот такому очень простому конфигурационном файлу здесь самое важное это из getting стада по сути что вот есть внешний порт 4080 и он мапи на внутренний порт 30.08 числа произвольные абсолютно Вы можете любые другие задать у нас получилось так чуть попозже расскажу почему О'кей конфигурационный файл есть Давайте создадим кластер в терминале Def контейнера вставляем вот такую команду создадим кластер с именем tod конфигурационный файл подсунули и важное штука что мы указываем что когда ты создашь кластер ты сгенерирует Cub Config для него чтобы к нему подключаться из Ленс деплоить в него и так далее Положи его вот в этот файл в репозитории который в git ignore находит Это позволяет не засорять глобальный конфиг не пытаться ёрзать эти контексты руками это страшное занятие зачем это оказывается можно просто изолировать в репе и всё будет супер ни на что не будет влиять во всём остальном компьютере а изоляция - это то что мы стараемся здесь делать в рамках этой активности создаём кластер Leo с нами согласен всё прошло успешно вот можно к нему уже подключаться смотреть что там происходит в Ленс что есть в дефолт нейм спейсе какие-то поды класс кластер есть теперь нужно в него задеплоить весь стек разберём на паре примеров Что содержится в фале он на самом деле очень небольшой в этом кейсе У него есть сервис Котлер чтобы тить запросы от U API это единственный общий сервис который нужно создать чтобы остальные функциональные сервисы работали тот он настолько простой дальше посмотрим в качестве примера ю часть Здесь тоже доста тно инса что зависит от AP ждт пока они запустят это вот что-то похоже на do comp когда мы тоже устанавливаем порядок запуска и важная мулька здесь которой я почему-то страшно горжусь Хотя может это абсолютно стандартная штука это то что мы в репозитории храним в репозитории ЮА храним Чар для прода и вот мы его оттуда подтягиваем сюда и потом отключаем внм https и заменяем до на тот который вхо образом мы не копируем чарт между репозитория всё вот централизовано как вчера было на докладе от коллеги Это я так понял называется ой git C или CS Cops да то есть вот когда репозиторий хранит и Исходный код и helm Chart вот на самом деле это такая же штука И что в этом чарте хранится в ua Ну вот я сказал что в Local env мы https отключаем А здесь https есть и здесь есть продуктовый домен вот в принципе эти вещи Мы переопределять в Local NV что ещё делает репозиторий каждый UI API они собирают докер образы гаю из Мастера стом который и используются везде в Local NV по умолчанию У нас сейчас и также комита чтобы можно конкретный комит было тоже запустить для меня оказалось новостью что вот в двадцать четвёртом году я вспомнил что есть разные вообще чипсеты платформы и что докер образы которые я просто собираю и они запускаются на винде маки линуксе они не запустят на моём Microsoft срфе который сегодня вообще отказался презентацию запускать и подключаться к клике ничего не работает вот что-то обновилось для меня это была полная неожиданность Я вспомнил что да точно есть же платформа вот зачем там столько тегов в докер хабе Обалдеть всё собрал добавил один флажок всё заработало а теперь развернёт как выглядит хф теперь одна команда для того чтобы всё это стало былью а указываем namespace Local Файлик и apply вот вывод конечный из терминала что все штуки задеплоить и всё красиво хорошо здесь есть один Костыль Ну который я считаю приемлемым как оказалось вот когда из Гита мы плим файлы а он никогда их не будет пули заново То есть ты там меняешь урол что угодно Он оставит их в кэше и вот это поковырять документацию оказалось что там есть команда которая с этой штукой позволяет справляться Я не стал её прятать никакой потому что ну вроде достаточно Просто каждый раз он заново этот гит репозиторий клонирует все которые нужны Здорово создали кластер задеплоить н видим что всё зелёненькое всё работает Как вы думаете что не так с этим скриншотом из ленса есть какие-нибудь догадки вопрос конечно с подвохом потому что единственное что с ним не так это то что это не скрин ко взяла и в Google презентации зафи это всё вектором текстом и в общем это Pixel Perfect сный скриншот из ленно в Google презентации Вот такая штука она большая Молодец чтобы всё было классно видно и читалось круто в Ленс всё есть в браузере мы можем открыть этот юай на порту вот этом внешнем как раз 4080 всё работает всё здорово Давайте проведём небольшой рекап потому что инструментов было много Рив было много и ещё де контейнер какой-то мерзкий В общем как это всё ещё раз работает каждый репозиторий содержит в себе Исходный код и Чар для прода это важно Он собирает докер образы и самое что нам интересно в Local NV - это latest мы хотим Запустить вот последний текущий стек самый популярный кес для вот этого того проекта который мы делали У нас есть которая запускается в В контейнере это важно там только инструменты установлены там не созда там нет кластера внутри него То есть это просто максимально маленький контейнер котором есть инструменты и вот когда мы вызываем команду kind Create эта штука в докере хостом через доке Out Of do создаёт контейнер Где живёт кластер и вот в этом контейнере Как раз-таки выставляется этот порт внешний и вот всё работает то есть контейнер не содержит кластер кластер живёт в отдельном докер контейнере Вот такая Жуть Супер ещё раз ещё ре капчик Что же нам надо чтобы это всё заработало на самом деле только докер vs код extension плим репу и запускаем две команды из михи Всё у нас запустился весь проект если мы аккуратно это всё поддержим ow будет всегда таким же ну с оговорками которые можно потом будет обсудить какие же у нас есть ежедневные сценарии работы с этим подходом во-первых конечно то что мы уже рассмотрели запуск всего проекта в его йте вторая Киллер фича которая раскрывается в большей степени для бедеров распределённого микросервисной сервис отде но никому не навредив и к проду желательно не коннектится и вот эта штука позволяет естественным образом подменить Например если запущу API я могу сказать U обращайся вот к этому API API обращайся к базе которая через ингресс торчит наружу и все будут счастливы Я могу дебажить а тот сервис я могу загасить Временно закомментировать или даже может остава при оных сценариях тоже срий возникает хорошо Я хочу сделать изменение собрать докер образ и проверить что вся штука с этим всё ещё работает ещё до того как я запущу comit до того как pipeline вот соберёт в фича ветки новый докер образ его я тоже могу использовать но может быть я хочу собрать это локально в Каде это делается следующим образом Да мы просто собираем docker Build чем-то его гиру в данном случае это Local to do UI 001 потом через kind Load мы засовываю это докер образ в тот кластер куда хотим вот там в конце это важно что он ему становится доступным и потом мы указываем в файле в той части которая касается версии юя что вот образ У тебя есть тег такой и не пуль его То есть там Always сейчас у нас по дефолту он пытается его скачать А здесь ты говоришь не скачивай он у тебя уже есть И на самом деле много крутых вещей позволяет делать там олай деплой очень прикольная крутая штука нам ещё самим предстоит до конца его доку проха выть Какие же проблемы с этим подходом есть Ну во-первых конечно это сложность всё равно если у вас есть команда разработки вы им даёте такую штуку А ещё как в моём сценарии они её тоже создавали и апробировать и пытались понять почему там местами ничего не работает Это непросто но с другой стороны так как эта штука изолирована Вы можете учиться там спокойно вы никому не навреди вы смотрите через Ленс Например сразу привыкает к нему если у вас Не дай Боже есть доступ к проду там также будете смотреть то есть появляются некоторая обученность пропадает страх как мне кажется вторая штука которую нам пришлось Научиться решать по пути это мы начали с того что деплоя всё на восьмидесятый порт для простоты восьмидесятый порт обычно занят а потом мы сделали следующий проект а потом следующий за ним на тех же рейсах и оказалось что один и тот же разработчик может быть вовлечен в два-три таких проекта И надо их запустить приходится стопа один запускать второй отвратительно посмотрели довольно легко нашли способ как выставлять разные порты вот у нас первый 4080 следующий 4090 потом будет 40.100 шагом 10 вдруг заснёт ещё какой-то набежал проект работает Всё круто ничего особо заморачиваться не нужно одна из ключевых штук это оперативная память ноутбука вашего коллеги которому предстоит это запускать если Мы начинали с совсем маленького простого проекта и даже на дизайнерском макбуке с 8 гигабайтами эта штука запускалась не быстро не сразу но запускалась потом когда мы добавляем сервисы становится больше куберу самому нужные ресурсы потому что мы здесь прямо в Control Plan это всё пло ему нужна оперативка там начинается тоже борьба 16 гиба вот если у вас 32 и более тогда довольно долго вы можете вообще никакие проблемы не решать Оно просто запускается вы там даже не парите реквесты лимиты вот вчера был классный доклад много у меня научил про реквесты на память SU не SU вот Антон мне рассказал про цпу может быть мы можем Тут ещё сами что-то доктис у вас всё точно классно будет 16 зависит от проекта который запускаете е одна сегодня говорил про и мы его используем по дефолту Какие с этим проблемы я запустил с там потом Мой коллега или Я обновил например эн всё мастер новый обновился Всё круто Я хочу его перезапустить мне надо вспомнить что надо убить под чтобы вот он заново перепотребление хотите А вы можете прямо коммитить теги а коммитов или конкретные релизы если у вас релизами всё это подписывается через Севе conventional com и вот это вот всё это можно делать это будет работать Но тогда надо не забывать апдейт эту версию в Local NV если это ваш latest но вы хотите точно сдать какую версию вы запустили можно делать руками но легко забыть в принципе можно автоматизировать довольно нормально Это поддаётся здесь выдержка из документации как раз када про подводные камни с лейте сом и почему там что-то не работает как ты зачастую ожидаешь Какие ещё штуки С таким подходом могут выстрелить То есть я в течение нескольких последних лет на разных командах это пробовал это было в разной степени готовности первое Почему такой проект Может начать становиться deprecated это когда продукт растёт команд становится больше они все начинают туда пихать и у каждого свои секреты по-разному назва и в какой-то момент Ты понимаешь что ты уже просто не хочешь не можешь по всем сходить и узнать какие тебе секреты в какие мент переменные положить и Где их взять чтобы запустить этот продукт Вот одна из причин которая привела на каком-то этапе к тому что всё хватит что может быть нормальным кстати тоже Посмотрим это дальше если вы настраиваете например только для винды вот у вас dnet Разработчики у них у всех винда у одного фронтенде двух маки там кто-то на убунте это фа потом пытается сделать это Крос платформенным ВС Это фейли потому что как я проверю у меня Винда Что у тебя там на Маке Я не знаю тоже одна из причин почему эта штука может не заработать если она сразу не кроссплатформенная и вот эти как раз вещи мы в этом подходе решаем также был кейс Когда в репозитории команда Объедини и и3 они вот не смогли решить же они остат то есть и там продук запу и здесь Но проблема стала в том что и там и там не запускалось в итоге забывали обновить и здесь забывали обновить там А те кто потребляли Например я был в команде фронтенде тимлидом А ребята вообще не понимают В чём разница и мне объяснили почему до comp почему k3d тут туфа вообще какой-то надо поставить что делать-то какой брать в итоге эту репу тоже по этим причинам а наш кес бы как раз что мы с самого спихнуть туда кафку elastic sech опыта у ребят с кавка немного там сразу три нода по дефолту вы пока сообразили что один нужен тоже чуть не прикончил этот процесс важно построить здоровый работающий процесс вокруг Local NV если он решает проблемы которые у вас есть Он позволяет запустить позволяет протестировать позволяет задеплоить мы это посмотрим и процесс настроен Так что эта штука включена по умолчанию он выживет и будет дальше эволюционировать а если он Ну вот есть и можно сделать то не факт что же делать когда сервисов становится слишком много когда они уже перестают влазить в компьютер естественно эволюция которую я участвовал и наблюдал А в одной из команд - это м переход к продуктовому энвайронмент или пре Продакшен где можно создать фича деплоймент полноценный То есть когда у вас весь деплоймент базируется на файле где-то есть все сервисы которые друг с другом дружат и все сразу деплоя путём небольших манипуляций Вы можете сделать так что у вас будет создаваться эфемерное окружение на фича ветку живущая 4 часа и саму себя убивающая или там можно пересоздать и это по сути и есть аналог Local только в Облаке Когда вы уже выросли ресурсов не хватает вы сделали Там и через там 10-15 минут вы уже там свою фичу дебажить которую иначе ну не проверить до подлинно Например я очень кайфанул когда очень долго готовился к S проект sle всё проверил всеми возможными способами с внешним Open ID провайдером и вот эта штука позволила мне так это протестировать даже вручную что я был уверен деплоить это и оно прошло удачно без сбоев Это очень крутая возможность это естественная эволюция решения Также можно Вот мои коллеги но они с до компом это сделали Здесь тоже это возможно отключать какие-то фичи то есть например телеметрию вырубили там полнотекстовый берём и Выключаем эту фичу в приложение она не работает но для проверки Core bu Flow Может она и не нужна тоже интересный приём который позволяет справляться но у нас есть тяжёлые сервисы нам они нужны что же как их запустить в кубе жесть Можно попробовать запустить doer comp но мы вроде пытались от него отказаться Какое же решение мы в итоге придумали А мы пришли к гибрид режи когда локально по там запускается локально но тяжелые сервисы ка мы купили у облачных провайдеров с шикарными админка каждому разработчику создали свой тенант свои очереди свои топики свои поисковые индексы они друг другу не мешали это очень круто это позволило во-первых прекратить попытки это заставить работать на тех компьютерах которые у на есть с ограничениями А во-вторых мы поняли что это классный вариант и соответственно Можно даже продуктовые ресурсы опять-таки грамотно применяя Вот это мульте подход использовать и вс будет аккуратно никто не будет ни с кем конфликтовать скрытый бонус всей этой штуки Это тесты то есть мы в компании топим за то что ТН тесты писать надо они ценные их должно быть мало они должны покрывать только кор но вот если такая штука есть проду запустить значит я могу и тесты запустить по этому продукту и проверить что какой бы из 10 микросервисов я не поправил даже не зная точно как они там взаимодействуют что вся штука всё ещё работает Основная это очень круто И вот идею которую мы ещё сами не успели реализовать Но кажется что нет никаких преград это в пайплайн в раннере который вращается там где достаточно оперативки создавать в изоляции этот кластер тоже и тоже запускать энды и смотреть что всё работает вот это то что у нас ещ в мпе и это будет работать это круто до какого-то предела Это точно будет получаться супер но шеф ты сказал что будет про прот будет про клиентское железо А про прот ещё не так много было Что Что происходит прод у нас был Local - это репа с де контейнером А у нас ещё вот в нашем подходе есть ещё прон и там всё что это репа депт в продуктовый кластер это https который шарится на все сервисы которые там есть и и опять-таки как слом и важно что прон не плот сами сервисы функциональные оно плот только общую инфраструктуру если у вас эфемерная база она туда тоже например может добавиться но сами сервисы не деплоя соответственно Что лежит в этой Репе в принципе всё очень похоже тоже фай который депт https сервисы для сертификатов enpt и вот появился то есть если Обратите внимание в первом слайде кфв никаких не было потому что это локальная штука сейчас полностью а здесь уже есть деплой а Def контейнер например используется только для того чтобы helmfile template вызвать команду и посмотреть А какие чарты С какими параметры Я бы применил в кластер по сути всё что сейчас там пока можно сделать и если посмотреть на то что лежит в сервисе В самом в U вот я говорил что UI билдит образы я говорил что UI хранит РТ и с продом У нас сейчас каждый сервис сам себя деплоить в прод И на самом деле это вот весь пайплайн весь файл для деплоя про кроме там объявления Chart registry импорта то есть вот тот же самые values Yamal фай используются которые мы в Local NV пере определяли чтобы отключить это PS и поменять домен На мой взгляд Прикольно Это вот про гомогенность тут мог быть helm просто А вот мы такие ость тут тоже будет HM файл чтобы ребята меньше страдали от разного куда же можно всю эту штуку в проде деплоить можно деплоить виртуалку создав там кластер можно деплоить в облако купив кластер и развернув туда А можно на метале тоже каким-то образом добыть кластер и развернуть его туда если Клиент говорит нас ничего не интересует ваше облако нас не интересует мы сами создадим кластер Мы лучшие инженеры 3 месяца спустя у нас ничего не работает но вот туда Вы можете залить через за круто Но что же про Вот это клиентское железо а Суть в том что Local это и есть о pris только в данном случае у вас компьютер разработчика используется как сервер а может использоваться сервер у клиента Как сервер и всё это сервер сервер сервер сервер в общем оно работает и может деплоить куда угодно каким образом вы берте вашу сейчас там в примере только поддерживает несколько окружений по умолчанию вы создаёте там новые окружения это может быть прод никак у нас когда про это там вот каждый сам себя депт мы такое хотим А можно создать что Про - это также все сервисы все зафиксированной версии вы знаете что задеплоил мы такое тоже делали Просто у нас тогда не было де контейнера но мы деи весь к на про целиком это получается у Mon когда выбо всех остальных сервисов у меня пример из жизни такой что был продукт состоящий из 25 сервисов он там несколько лет развивался релизный цикл 2 недели ты свою кнопочку поправил Ты точно знаешь что ни на кого ты там не повлияет никому но ты ждёшь 2 недели Пока все остальные сложные изменения в скале в датте в хранилищах они тоже будут протестированы но там было Куча идов и интен это было здорово и безопасно а е была хохма в том что они брали этот репозиторий в котором хранился файл и делали копию на каждый Маркет Маркет - это Каждая страна и там было ещё 10 таких репозиториев самый Трэш был это то чтобы вывести своё несчастное обновление через все страны вот такое тоже возможно и эта штука может быть изменена в этом русле это несложно то есть вот как раз таки Def про uit всё что угодно для кого же подходит на наш взгляд такая Фантастическая штука для стартапов для питонов там где вам надо быстро выдать результат и вы просто клонирует и начинаете пилить функционал оно уже деплоя вы можете презентовать это вот на хакатоне например думал презентуйте это комиссии у вас всё развёртывание это дополнительные очки помимо того что вы сделали функционально как зади зайни как пообщались с клиентом А у вас всё ещё разворачивается и в принципе готово к тому чтобы впт это всё внедрить маленькие и Средние проекты больше всего кажется раскрывается на средних проектах Где у вас несколько разработчиков несколько сервисов параллельно пили но вы хотите с самого начала вот этот настоящий Continuous integration Continuous deployment всё настроено берите Используйте будет работать если у вас не так много денег на облако у нас была проблема Не совсем в деньгах но я бы тоже подумал а зачем мне создавать если у меня тут всё работает и лишний повод в начале заставить всех коммуницировать активно общаться чтобы создать устойчивое в конце каждой неделе приложение тоже такое естественное ограничение и то что мы тоже делали это мы сделали Облачный продукт он доступен регистрируешься получаешь доступ работаешь ничего не деплоить клиент которому нужно только в интернете никакого доступа в интернет эта штука позволяет всё это сделать просто скопировав репу для них это вот то как раз то что ребята Я так понял вчера рассказывали на докладе про заводы как в завод вот у них тоже файл это как раз-таки та же самая штука для кого не подходит кажется что если у вас всё-таки большой продукт уже сейчас или он становится очень большим 2050 10000 микросервисов наверное Local вам всё-таки придётся забыть но вы можете его эволюционировать как я показал и это будет тоже естественным развитием потому что не сразу у вас становится 20 сервисов Может ваш продукт вообще не доживёт до этой фазы если у вас сложные внешние зависимости например вам надо лить или у вас там курсы вовлечены или ещ какие-то штуки которые вы ещ слабо контролируете они ещ и падают может стать кошмаром но можно подумать в сторону каких-то моковская Ну и Да если у вас мало ресурсов на компьютерах если у вас 16 и меньше оперативки это е стандарт Да будет сложно но тоже до какого-то предела будет работать опять-таки можно использовать какие выводы можно ещё подрез всё что было сказано до этого можно быстро бабахнуло в cuber скопировали репы вставили работаем над функционалом всё всё классно есть примеры как это использовать вот сейчас в следующем слайде я покажу QR кодики От простого к более сложному Уберите пожалуйста давайте фидбек контри Если есть желание я никогда никакие репы на докладах не смотрел Не скачивал Но может это тот случай когда имеет смысл просто это мне кажется получилось прикольно всё докери Зро на кроссплатформенное только от ВСС кода который бесплатный легковесный и кажется что это Малая цена за то чтобы было удобно использовать вот мм с развитие и масштабирование встроено уже в систему что имеется в виду это как раз-таки серая точечка А создав сейчас продукт вы не знаете будет он пользоваться успехом не будет выстрелить не выстрелить но с этой штукой у вас уже всё встроено вам потом не придётся 2 года автоматизировать деплой до одной кнопки и вот вкладываться в это потому что можно взять сейчас и в принципе это не так сложно изоляция а возможна у нас она есть и вы можете действительно деплоить куда хотите если там есть кубер я знаю кубер Бывает разный но я думаю что это работает цель кото у нас была она достигнута и мы это задеплоить Здесь вы можете увидеть ссылки на те три примера которые у нас есть это вот самый простой два сервиса без аутентификации to Real World там есть аутентификация аккаунты пермиссивный вебсайт тоже осный который к концу года в январе Тим задеплоить А и он будет работать это другой кейс там мска база но тоже забавная немножко из другой оперы Не энтерпрайза на этом У меня всё спасибо ребят Да спасибо Саша за доклади а переходим к вопросам единственная просьба да сразу тогда один один вопрос одна рука чтобы успели побольше задать А где у нас вот вот Вот вот третий Да и один вопросик потому что по времени остальные вопросы если что в дискуссионной зоне Да спасибо за доклад собственно вопрос А чего делать если не хочется использовать э Microsoft ский вот это вот среду разработки Ну тут вопрос насколько не хочется в принципе опять-таки Вот посмотрел де контейнер есть уже решение у них документация есть пакеты которые де контейнер транслирует docker файл Ну потому что там внутри докер файлы везде в этих чах Вы можете сгенерить docker файл и создав контейнер в нём тоже там есть docker Out Of docker настроенный про который есть дополнительные слайды после этого два Всё будет работать то есть на самом деле это не обязательно но это крутой приятный Dev Experience вот у нас vs код везде внедряет сложно объяснить что же это такое ещё один да и побежим Да добрый день спасибо тоже за доклад такой вопрос вот было упоминание что вы там бизнесу там менеджерам показывает всё Вопрос такой вот не знаю как у вас У нас в кровом Как говорится энтерпрайз всегда есть запрос на одну большую кнопку развернуть Всё Есть ли какое-то решение то есть надо ли идти тому же менеджеру писать doan контейнер поднять в нём развернуться Вот красная кнопка есть Ну получается как раз-таки можно сделать вот этот репу которая задеплоить фиче ветку это вот про то что я говорил что получается фича деплоймент и там действительно Да ты зашёл в пайплайн назовём чуть проще там Run pipeline переменную передал разверни мне из этой ветки или эту версию Да это можно сделать это Ну надо какую-то небольшую работу но это типа намного проще уже вся архитектура вот то что ребята вчера говорили Если у вас в архитектуру такая гибкость возможность заложена вам не придётся весь проект под это переделывать То есть это здесь заложено это возможно понял спасибо всеми Спасибо Саш спасибо Антон Спасибо ребята"
}