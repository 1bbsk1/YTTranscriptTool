{
  "video_id": "Kr8gcPUpI1w",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Итак всем привет Мы сегодня готовы рассказать о разработке в губернета с путь от спрей кранчер сложностях разработки в кубери об инфраструктуре о том как эти трудности мы преодолевали как проходила команда через эти трудности расскажет мой Тезка и тиммейт Игорь Алексеев Игорь имеет очень богатый опыт системном инжиниринге В разработке пишет на нескольких языках программирования отлично знает Линукс и не боится глубоко погружаться в Исходный код вот Что еще можно сказать Игорь прошел через корнило синтеха и не раз на деле доказал что строчки в резюме это не пустые слова вот Игорь привет Как настроение Привет отличное настроение очень рад вас всех здесь видеть на конференции Надеюсь мой доклад вам понравится Я с нетерпением жду доклад жду выступления Я думаю участники конференции тоже ждут его напомню что Да мы сейчас надо выпуск 2022 на конференции посвященные практикам devoops Игорь скажи пожалуйста кому будет первую очередь полезен и важен твой доклад Надеюсь мой доклад будет полезен всем кто работает с губернета сам как позиция operations так и разработчикам Спасибо большое Напомни всем участникам что ваши вопросы и пожелания Вы можете задать в telegram-чате в Техническом чате также не забывайте оценить доклад после выступления спикера Ну и в общем-то Я предлагаю не откладывать долгий ящик и начать начнем окей да всем еще раз привет Очень приятно вас здесь видеть меня зовут Игорь Алексеев я последние шесть лет работаю в роли дэ бокс и инженера 8 лет я познакомил компаниям зарабатывать качественные по пишу на got два года работы в город и Мой основной фокус это автоматизация процессов и автоматизация инфраструктуры а компания garaged это крутая компания делающая финтех мы предоставляем финансовые продукты на международных рынках доклад мы о том видите на слайде С какими проблемами можно столкнуться используя и как можно решить пара слов о том как мы сейчас используем разработки у нас в среди 14 кластеров диплоиться положение с помощью фильма разработчики используют актета для разворачивания кода в процессе разработки и все это работает Как обычно а Для начала я хочу задать вам вопрос надо ли использовать антибал для автоматизации когда-то когда мы пришли к использованию когда мы пришли к использованию VPS Почему hitsner Потому что очень дешево это оказалось мы начали разворачивать губернатос с помощью поскольку не предоставляет богатого образов мы остановились на хорошо знакомый нам Ubuntu Linux разворачивали мастера и ноты через HD дальше нам требовалось подготовить новую постановке в первую очередь защитить от подключения Извне мы прошли долгий путь но потом наши сетевые инженеры реализовали роутер на основе микротик который изолирует машину от подключений и Извне и обеспечивается соединение с авторизованными сетями и только потом мы сумели мы получили возможность диплоид непосредственно губернатос через спрей но к сожалению поддерживает Клауд и облака Так что нам пришлось отказаться от большей части возможных автоматизации использовать Спрей в режиме bair Metal таким образом как если бы управление железом со стороны софта было бы невозможно вот таким образом Например у нас не было возможности выделять диски для PR Systems Volvo но дайте себе балансировщики автоматически и отсюда мы переходим к проблемам у нас были проблемы спрей и первой проблемой было то что как оказалось наш файервол сразу скажу что Firewall мы могли бы доработать но пошли другим путем второй проблемой оказывается оказалось то что решает кластера чем больше рост кластер тем больше времени занимала внесение изменений например расширение с 10 до 11 всего Киров занимала 20 минут а с 30 8 до 40 это же операция занимала 1 час отдельной проблемой был обновление версии губернатоса по сути мы вынуждены были раскатывать кластер точно таким же образом как если бы мы его раскатываем создавали с нуля но и последовательно тренились ожидали завершения задач и антибала роль могла завершиться с ошибкой не дожидаясь не дожидаясь обновление ноды после чего приходилось стартовать роль вручную исключая ноды проверять обновилась ли надо фактически поскольку об этом ничего не мог сказать при аварийном завершении и все эти проблемы нарастали пропорционально количеству а кроме этого Cube спрей как я уже говорил несовместимость Клауд и это начало оказывать влияние ввиду того что у нас не было возможности из код управлять созданием балансировщиков для входящего трафика мы были вынуждены создать статический балансе и использовать схему СНГ то есть трафик фактически шел на случай на выборную ноду в кластере после чего уже средствами кубернета с перенаправлялся к нужным сервисам это создавало большое это было не очень надежно Кроме этого у нас не было возможности создавать pvc А так что пришлось полностью отказаться от персистентности в губернатости для разработки Ну и дальше у нас случались инциденты это были два больших инцидента которые заставили нас сильно задуматься О том что мы можем выбрать лучше чем спрей первым инцидентом первым падением кластера была ситуация которая может в принципе случиться с каждым вариантом кубера и ситуация была очень простая при возрастании нагрузки на кластер Мы решили вертикально масштабировать мастерноды в тот момент когда один из мастеров был отключен для того чтобы для изменения типа ну да чтобы накинуть возросла нагрузка на оставшиеся два мастера и на одном из них процесс сиди был убит киллером Как вы понимаете в результате кластер пришлось восстанавливать из осколков была потеряна часть данных CD и примерно день кластер был несколько часов кластер был недоступен а вот ситуация вторая заняла даже больше одного дня и здесь все было очень сложно мы Обновили версию губернатос а кажется это была версия 1.216 но столкнулись с некоторыми проблемами и решили откатить обновление при откате обновления спрей проигнорировал часть параметров это было связано с обновлением версии в результате чего в дополнение к существующему был раскатан калека а в результате поведения кластера стало неожиданным фактически это проявлялось следующим образом в мониторинге у нас все было в порядке статус всех нот был редди все было отлично но по запросе любого ресурса с большой вероятностью мы случайным образом получали 500 ошибки то есть загрузить страничку с несколькими картинками было просто невозможно вся ситуация вместе заняла пару дней и целые сутки все были все разработчики были без доступа к губернатос это все нас не устраивало Так что мы начали рассматривать альтернативы и где-то в январе этого года решили попробовать Раньше сразу к делу ранчо отличная автоматизация создания нот и даже целых кластеров а мы можем создавать шаблоны для разных типов ноут шаблоны Ke для кластеров и дальше из них Как из кирпичиков создавать новые кластеры все что касается настройки самих нот которые не относятся к губернатосу можно сделать через clouddinint в Hit называется а в Google Cloud то есть ну в принципе у любого практически облако есть такая возможность и все это поддерживается раньше третий преимущество пожалуй самое большое это децентрализация при использовании ранчо у нас нет точки отказа для работы созданного кластера сам раньше не нужен Точнее он может использоваться как прокси для авторизации Но это не обязательно и таким образом доступ к кластерам сохраняется даже в случае полного отказа самого ранчо единственный момент Я рекомендую использовать терминологии раньше контекст поскольку это делает доступ к кластеру под управлением ранчо абсолютно независимым от самого утра а масштабирование кластер независимо от количества нот в кластере масштаберования производится одной кнопкой это кнопка выглядит вот так вот это Scale Up и через пять минут После нажатия этой кнопки ну а двух до пяти минут в кластеры появляется одна или несколько новых нот которые полностью готовы к работе обновление версии cubernetos осуществляется из ранчо очень похожим образом обновление в отличие осуществляется в один шаг но надо обновляются Независимо А раньше очень хорошо Следит за тем чтобы все версии все ноды обновлялись как положено и за все время мы ни разу не сталкивались с проблемами очень хороший Кроме этого ранчо поддерживает хесмер клаустроен контейнер storage Driver и ноды и балансеры создаются через Клауд контроллер менеджер И то и другое написано ребятами непосредственно из hetzner и поддерживается отлично Кроме этого для каждого типа входящего трафика автоматически поднимается балансировщик который смотрит на нужный индекс а в итоге за полгода с небольшим использованием наш ранчо увеличился до 14 кластеров для разработчиков с перспективой увеличения по запросу и создание нового кластера для каждой ситуации когда это требуется обычно это один кластер на группу занимающуюся определенной добавление новых нот Как мастеров Так паркеров в том числе с каким-то специфическими лимитами или со специальным может быть оборудованием занимает 5-10 минут и осуществляется по одной кнопке реализовано отличное общепринятая модель таким образом Если вы хотите задействовать его в проводе Вы можете раздавать права назначать роли и все будет отлично но конечно для провода идеально использовать менеджер кластер от хорошего провайдера напомню вам вопрос заданный в начале доклада Надо ли юзать для достижения результатов Для комфортной работы мой ответ использовать не надо для результатов нужна удобная платформа для управления отлично подходит раньше Спасибо большое за внимание Очень рад был вас видеть буду рад ответить на ваши вопросы Игорь Спасибо большое было интересно послушать Вспомнить все эти трудности через которые мы прошли Ну а я хочу напомнить зрителям и участникам о том что вы можете оставить ваш поставить вашу оценку После сессии и можете задать вопросы и получить Я надеюсь на них ответы"
}