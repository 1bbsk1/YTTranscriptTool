{
  "video_id": "IpJgL-VRyaM",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "у а итак мы сегодня пообщаемся на тему авто скиллингов куда гнатов я не буду рассказывать про базовые концепции кубер нету я надеюсь все с ним знакомы а поднимите руку кто работает скутер notes and removes а вот это крутяк вот это классно знал бы я парочку слайдовую убрал хотел бы начать с того что как наверное многие в этом зале как я вижу мы создавали я лично создавал два разных проектов двух разных компаниях куда внес очень куда метов подобное и я соответственно понимаю куда гнета с хорошо изнутри я понимаю почему он важен почему нужно почему он так сильно стрельнул и соответственно опыт работы в кубер не та самая дольше чем существует cabernet из какой уникальная ситуация здесь вы видите qr-код и ссылку на сам доклад если хотите вы можете прямо слайда прямо сейчас скачать потому что внутри есть ссылки большое количество всяких орлов внутри можете посмотреть но и задавать вопросы уже глядя на слайде намного легче значит мы начнем с того что я вкратце буду увеличивать сложность наивного представления как работает этот скейлер в интернете потом мы затронем вопрос и конфигурации вопросы как его правильно встраивать какие проблемы в текущем of those келли легко для нас есть как эти проблемы решаются в настоящий момент в мире то есть я покажу два разных авто скейлеры альтернативных allies of those келлера один из которых написал я сам 2 компания дата долга и закончить тем что я расскажу как прямо сейчас происходит имплементации то есть я не комментирую новое решение of those киллеров кабинет оси я расскажу про этот процесс потому что но это может быть интересно а поднимите руку кто делает делал хоть один половика в артикулирует с ну так что я думаю всем будет интересно это послушать потому что это но такая непростая история вот и не немножечко советов по походу все сфотографировали кто хотел поехали дальше давайте давайте давайте итак почему губернатор полезен и почему он стрельнул я вкратце расскажу в основном эта тема денег вот как это ни странно но это деньги все деньги я как человек который создал два разных решения куда-то подобных я понимаю что когда новичок приходит в компанию надо его научить этому своему внутреннему кабинета су и на это уходит очень много ресурсов поэтому если новичок приходит он уже знает что такое губернатор как он работает то это уже огромный плюс мы не тратим огромное количество ресурсов на обучение + о губернатора в интернете есть хорошие написанные документации есть куча разных ритуалов гайдов которые позволяют вам самостоятельно изучить кабинета с не надо изучать его тратить на это время там первые недели работы то есть опять же это ресурс и опять же это деньги плюс в кабинет оси есть очень большое количество фич которые уже написаны уже готовы то есть эти оба решения которые мы писали которые я писал в разных компаниях они оба сдались конце концов кубер нету потому что невозможно за ним угнаться puffy чем просто нереально то есть у нас в любой компании нет такого количества ресурсов как есть у комьюнити который пишет об opensource продукт плюс есть такая вещь в кубе радости как авто скейлер и этот напрямую касается денег то есть пока вы не получаете входящие запросы пока вам не нужен большой пластика вас кластер будет маленьким вы не тратите на это деньги как только приходят запросы вы увеличиваете размер кластер и потом снова уменьшаете таким образом опять напрямую экономите деньги то есть вы видите что все те причины использование уберется который писал это в основном деньги ну и конечно же есть надежда что если большие игроки используют куда-то цепи штуку dignitas что в нем есть какое-то качество есть такая надежда но сейчас мы посмотрим про это качество итак предположим что мы пишем сервис который возвращает фотографию какой-то кошечки то есть фотография кошечки как сервис давайте посмотрим как она должна работать и как of those киллер будет не работать для того чтобы в целом коснуться всего of those киллера я должен все-таки немножко объяснить хотя бы все работаете все знаете что это такое я должен объяснить что это такое у нас есть сервис которым содержится куча метрик о нашей текущей системе большинство все плоды должны послать туда информацию и большинство метров и системой в том числе сам крест контроллера я не знаю очередей в зависит от того как вы настроите что тоже будет складываться внутренних сервере и of those киллер который работает в связке с этим метрик сервером он здесь помечен красным хотя он у меня коричневый вот но он считывает информацию из сервиса метрик и на основе этой информации принимает решение о том как изменять размер пластика то есть пришло больше запросов у вас через загружен загруженности пью ваших кодах внезапно увеличилась соответственно авто скейлер смотрит что вы превысили планку которую вы сами сконцентрировали надо увеличить количество кодов он увеличивает потом запросы ушли боже мой запрос и ушли циклу упала и он опять уменьшает размер пластиком и вот таким простым способом работает кулер нету авто скейлеры он приятном работает напрямую с дипломантом публикация контроллером с реплика сетом без разницы с кем вы работаете он просто изменяет одно конфигурацию внутри насколько много реплик должно быть в вашем вот в этот в этом объекте на ресурс здесь показано что вот у нас уже есть два пада но авто скейлер стартует еще два и они там в процессе создания прямо сейчас при этом все эти под они получат все входящие запросы от пользователя с помощью сервиса но это еще один объекту все его знаете вы все-таки с кубиком работать и вот в какой-то момент времени у нас внезапно нагрузка увеличилась ему увеличили авто скейлеры увеличил количество кодов тут в данном случае до десяти и вот они все обрабатывает входящие запросы все легко все понятно и предсказуемо и давайте посмотрим как это выглядит на графиках то есть в данном случае на графике синим у нас отображена в количество входящих запросов то есть вот там где то в районе меньше 50 ну вы написали маленький сервису это максимум что бота поставили в twitter чтобы он куда-то что-то постил но ник никто его не пользовать настоящий момент и у нас есть всего два года который работы для обработки данных запросов почему 2 почему не 0 почему не на я не один я не знаю насколько много вы слышали вот про эту концепцию этот я хочу немножко приняли сказать то есть лет двадцать назад наверное произошла смена парадигмы от того что вы должны рассматривать свои ресурсы как домашних живого у которого есть свое собственное имя есть выделено и печник вы его знаете перешло от отвод домашних животных стадом то есть когда у вас стадо у вас 1000 там коровы каждому не знаете имя вы не знаете айпишник наверно of those келин группа в амазоне это был первый серьезный удар вот по концепции сервиса как сервера как домашние животные вот но конечно же докер контейнеры его добили губерн этом потому что в докере вы рассмотрите любой под как какую-то временную сущность то есть вам нужно ее создали вам не нужно ее тут же убили вы не можете рассчитывать на то что оно будет существовать вечно вообще на то что оно будет существовать достаточно долго вот а в случае удержаться за работающие где-то в облаках становится еще хуже потому что amazon может внезапно сказать вы знаете этому перезагружаю меня тут проблемы с каком-то с каким-то инстанциям давайте его выключу и тогда все коды которые работы на этом инстанции они тоже погасится поэтому меньше чем 2 имеет смысла нет потому что иначе у вас если был бы один его выключили стало ноль и все запросы пользователей внезапно получили ошибку и так мы начинаем увеличивать нагрузку например как барух написал про ваш сервис с кошечками в твиттере толпа народу прибежала было 50 ом 100 запросов стала 900 запросов в минуту вот для того чтобы обработать эти 900 запросов в минуту нам надо увеличить количество кодов мы здесь предполагаем что каждый под может обработать 100 запросов минуту соответственно надо увеличить до 10 ну и потом просто происходит постепенный плавный спад этих запросов потому что но больше никому не интересен ваш сервис который котиков показывает кто считает что вот именно так работает от тоски или поднимите руку хорошо сейчас отвыкнуть и поднимать руку на такие вопросы потому что конечно же он работает совсем не так давайте посмотрим что на самом деле происходит в тот момент когда приходит большое количество пользовательских запросов у нас увеличивается количество запросов он на вашу систему но количество репликами начинает сразу расти почему а потому что это происходит из-за того что сейчас мы коснемся вопроса что всегда существует задержка между тем когда приходят запросы и тем как вы можете увеличить как of the skilled может увеличить количество кодов pawn по умолчанию если вы работаете просто с кластером уже готовому и вы не увеличите количество instance of the это до 90 секунд если вы работаете с каким-нибудь там озоном или гуглом его количество инстансов cabernet с увеличивается то есть это кластеров тасс киллерами начинает работать тов до 12 минут может происходить создание нового кода почему потому что посмотрим на картинку когда мы под загрузили сильно у него увеличилась циклон эту метрику начинает посылать метрик сервер мне track сервер не работает мгновенно цикл мгновенно увеличивается и не мгновенно посылается эта информация и того худшем случае на метрик сервер и получается информация обновляется в худшем случае через 60 секунд конечно чаще всего бывает быстрее приятно на авто скейлер сам по себе он запускается раз в 30 секунд и к примеру мучили 60 обновили информацию на метрик сервере через 30 секунд после этого запустился of those келлер и обработал эту информацию до вы у нас уже 90 секунд получилось не учитывая этого времени как под должен скрываться примерно 2 секунды и плюс еще неизвестное время для старта приложений внутри вашего падает уже от вас зависит я видел приложение которое стартует за 10 15 минут то есть как бы это на самом деле долго это плохой из кейс так не должно быть конечно но такое бывает и того получается что нас уже здесь девяносто две секунды как как такой реальный и диски из реальный случай как результат для простоты я здесь показываю что все идет задержка в минуту я в тоске ли работает за каждую минуту для того чтобы было более менее понятно как результат мы видим что количество кодов увеличилось до 10 через минуту то есть мы посмотрели что предыдущее количество запросов было там порядка 900 надо 10 кодов и вот мы их стартовали через минуту вот это вот задержка как раз она объясняется тем что нас метрики не сразу приходит авто скейлер не сразу работает и потом постепенно и происходит спад аналогично спад количество поводов он тоже происходит мгновенно тоже с та же самая девушка примерно в минуту при этом вот это вот закрашенная область как мы видим она соответствует моменту когда у нас количество пота все еще маленькое количество запросов уже большое и получается что вот два года внизу они могут обработать 200 запросов минуту а нам их пришлось 900 что произойдет оставшимися с места конечно же пользователь видит ошибку то есть своем приложении он видит ошибку на веб-страницу на видит ошибку где то он увидит эту ошибку вот вся эта закрашен область это проблемной области и есть 2 закрашенную область это та область когда мы уже пошли на спад по количеству запросов и нам не надо столько тут много кодов держать на мы задерживаемся на минуту и поэтому вот это вот желтая закрашенную область как выглядеть подсвечивается вот желтый закрашенной области то как раз та область когда мы теряем деньги мы могли бы иметь меньше подав тратить меньше ресурсов но мы их держим и поэтому вот это потраченные деньги ну что так работает авто скидок нет давайте посмотрим почему вот произошло рост количества метрик количество использования нашего кластера и в этот момент у нас происходит рост размеры кластер но почему-то с 2 до 6 можем почему до 6 если должен до 10 что произошло на самом деле авторский ли работает следующим образом у него есть две константы которые прописаны прямо внутри в коде губернатор и эти две константы то 2 и 4 это означает что мы ограничиваем скорость роста любого кластер а вот этими двумя показателями и мы выбираем 2 2 2 1 2 разные характеристики первое это мы смотрим сколько будет если текущее количество пота увеличить на 4 то есть два плюс четыре это 6 второе это мы смотрим сколько будет количество кодов если мы удвоим количество кодов два умножить на два это четыре мы среди этих двух показателей выбираем максимум 6 и увеличиваем количество кодов до 6 вот соответственно у нас вырастит до шести до десяти и соответственно ну потом вырасти до 9 потому что как бы следующий раз 6 до 9 уже достаточно просто вырасти и потом происходит постепенный спад как вы видите вот эти области стали левая область когда мы пользователю отдаем ошибки она стала больше потому что мы не смогли вы за гриф завести сразу до максимума это на самом деле проблема правая область чуть уменьшилась но это не так важно ну что ну наконец то вот так работает от тоски лег поднимите руку кто думает что так нет ну почти но нет вот давайте для того чтобы понять что происходит давайте посмотрим дальше во первых of those келлер имеет следующую конфигурацию он показывает минимальное количество максимальная размер кластер и количество реплик и нитки по которым надо судить для того чтобы понять как сканировать это стандартное описание hp и объектов плюс у него в коде есть эти две константы которых я рассказал 2 и 4 вы не можете их менять вообще никак и плюс есть еще два дополнительных construct 2 дополнительных конфигурации которые определяются целиком на губернаторский кластер первое это стрельцы он на окно в 300 секунд я сейчас принял расскажу и второе таранец этот допуск наверно про не так привести я про него тоже сейчас расскажу каким образом это работает а ну да здесь я поясняю что это размер пластик и причина по которой мы скрываемся соответственно эти две константы и два дополнительных параметров по которым щас расскажу итак предположим что у нас есть наш кластер что у нас приходит нагрузка и практика показывает что нагрузка не приходит просто так начинают постепенно плавно гости нет она идет вот такими скачками в коми всегда вот и соответственно за первым скачком всегда будет 2 скачок и для того чтобы с как это и из-за этого мы здесь имеем проблему то есть если посмотрим здесь то на самом деле второй скачок мы точно так же опаздываем на минуту и мы точно так же имеем вот эту вот область когда у нас пользователи эти запросы вообще никак не могут обработать но теоретически мы вот только что же имели нужное количество кодов теоретически для того чтобы решить эту проблему надо того что вот немножечко подождать не сразу начинать с коллировать вниз и это была первая идея как решать данный вопрос это называется far битную винду you for ben винду эта конфигурация которое было в кулер на такси до 111 включительно и она говорила так что если мы начали снижаться по количеству реплик то после первого снижения давать ему немножечко подождем вот и вот это вот конфигураций она была одна весь кластер в данном случае мы ждали там три дополнительных интервала а потом начинали снова расти и поэтому разница между этими двумя это вот вот это вот небольшая область которая изменилась веке зеленого стало чуть чуть поменьше то есть меньшее количество ошибок произошло в нашем классе это огромный плюс но в дальнейшем да вот этот робин винду дальнейшем придумали более хорошую систему называется цивилизационное окно стрельцы он накладывает следующим образом когда вы хотите начать снижать количество реплик в кластере вместо того чтобы сразу мгновенно начать стяжать давайте мы запишем а сколько мы хотим иметь реплик в кластере потом еще раз запишем не снижай потом еще раз а потом выбери максимальное значение за какое то время то есть вот это вот стабилизационной окно мы стабилизируем данный уровень и потом снижаемся вниз только если в течение там какого-то окна в данном случае по умолчанию 300 секунд мы все время хотели снижаться вот когда мы все так делаем то будем давайте снижаться понемножку вот это вот стабилизация на случае очень сильно помогает то есть вот это вот 2 2 зеленое окно 2 зеленый вот закрашенной области на стало намного меньше как вы видите мы переждали вот этот вот падение вниз количество запросов и соответственно это нам сильно помогло нашем кластере это того каким образом какие показатели метрик влияют на какие значения какие показания метрик isometric сервера влияет на количество реплик вот и соответственно вот это стабилитроны окно как я уже показывал это настройка на уровне кластер а то есть вы не можете отдельный hp и объект иметь с одним значением станционного окна второй со вторым вот соответственно основные проблемы текущего текущей вели зация в тоске лера следующее вы не можете контролировать скорость роста бластера или скорость уменьшения количества родов то есть не можете вообще никак есть две константы которые захардкожены во вторых вы не можете конфигурировать либо задержку скалирование либо вот этот стрельцы он на окно она тоже конфигурируется но уровень кластер а вот и это проблемы которые нам посмотреть очень сильно мешали соответственно но решили каким-то образом это решить и а здесь я хотела писать да да почему настройка стрельцы онного окна на кластер не помогает потому что бывает ни один тип ни один тип использования вашего кластера бывает их много самые простые два случая которые чаще всего приводят в качестве примера это входящие запросы пользователя когда вы должны как можно быстрее ответить и любой неотвеченный запрос эта проблема на стороне пользователя который мы хотим избежать а второе это как какой какая-то очередь обработки сообщений теоретически мы тоже хотим их обработать как можно быстрее но даже если мы их не сразу обработали ну как бы задержка небольшая произошла ничего страшного потому что это асинхронная обработка происходит в чем разница между этими подходами это в том что случае если мы обрабатываем входящие пользовательские запросы то мы хотим с традиционной окно как можно больше чем дольше стабилизационной окно тем дольше мы не уменьшаем размер кластера и следующий рост не вызовет проблем у пользователя случае асинхронной обработке очередей чем быстрее мы снизимся чем быстрее мы уменьшим количество реплик тем больше денег мы сохраним то есть у нас получается конфликт интересов для обработки асинхронных очередей нам нужно как можно быстрее снижать кластер для обработки входящих пользовательских запросов мы хотим как можно дольше не снижать размер кластера и получается что если мы не только одну конфигурацию которая на весь кластер целиком установится вы не вы не можете одновременно две проблемы своей решить разным разным способам ну либо иметь несколько кластеров кабинета для каждого способа использования это вообще глупости и соответственно вот данном случае данный график показывает синим это не входящий запрос у пользователя размера очереди который в данном случае авто с киллером воспринимается как основная причина увеличение или уменьшение размера кластера соответственно у нас увеличилось количество сообщений в очереди мы должны увеличить количество реплик мы его увеличиваем а потом что лицо на окно продолжать держаться потому что как бы у нас для обработки пользуются их запросов мы поставили с традиционных но достаточно большим и получается что вот это вот желтая закрашенная область это область потерянных нами денег то есть мы могли уменьшить с 9 там да 4 например 9 до 2 они уменьшили ну ладно вот у нас маленький кластер потому что у нас маленькие сервис с кошечками а было большой кластер там где вместо 900 можно иметь 200 кодов и представляете сколько можно денег экономить каждую минуту какие есть решения первое решение это конечно то решение которое сделал я это конце гроба и теперь поставляется второе решение это да да dog они посмотрели на мое решение мы переписывались с ними и они сделали альтернативное решение я покажу в чем разница и третье решение то которые прямо сейчас я делаю для того чтобы нужно вошло в состав кудрин это я надеюсь что получится войти в 117 все вроде как к этому идет но пока не доделал всегда уверенности нет давайте посмотрим я взял я россию кадр не тасс 1.11 и просто добавил туда дополнительные параметры которые нам не хватали фактически это размер кластера метрики плюс вот эти вот дополнительные параметры это насколько быстро эскалировать каждый кластер и насколько долго ждать прежде чем эскалировать вверх или вниз этот тот самый farben винду приготовила как про которые я вам рассказывал вот если бы я связался сус взялись 112 конечно бы я уже использовал стрельцом на окно на более приятные более логичны но тогда еще бы не было вот соответственно вот это вот решение давайте посмотрим те графики которая показывала кстати вот это вот правильный график как ведет себя в тоске ли это вот когда в руки поднимали вот вот это правильный ответ вот соответственно когда мы смотрим здесь мы выросли до 6 вместо 10 это вызывает какие-то проблемы а если мы используем консерву hp которые я только что рассказывал мы сразу можем вырасти до максимального до нужного назначения потому что мы управляем этой скоростью на для данного конкретного of those келлера мы говорим использую вот такие значения какие нам выгодно и соответственно вот это вот закрашена небольшая область это тот выигрыш который мы получаем с помощью конфигу лобач пей по сравнению с тем что находится в кубик напиться прямо сейчас вот она небольшая конечно но все сильно зависит от ваших кластеров от ваших нагрузок она может быть большая аналогично вы можете контролировать вниз аналогично вы можете управлять тем как farben винду тоже вы можете конфигурировать в случае если вы имеете дело с дата с датой винтами то есть как бы у вас очередь какое-то сообщение вы можете вот вот этот график это hp и как работает в кабинет оси а вот зеленый график этот топ как можно настроить конфигурации теперь то есть мы сразу пошли вниз мы не ожидаем мы мы не ждем нет никакого окна стабилизационного окна не ждем мы не ничего не ждем сразу можем уменьшить количество инстансов и вот этого желтого область это тот просят который мы получаем потому что мы сразу снизили количество кодов и меньше используем ресурсов ну то есть как бы вроде как он помогает но и у нас он работает в продакшене уже больше года он на самом деле помогает в чем отличие до тодоровского решение от моего решения вот это долго был очень интересный у space они хотели давайте сначала расскажу что такое торрент то есть когда мы рассчитываем нужно к нам нужное нам количество кодов которое должно быть в системе мы делаем примерно в следующие вычисления давайте рассмотрим для простоты что это мы рассматриваем значение метрики на одном отдельно взятом поди итак у нас текущая метрика там 80 процентов использования сепию а мы так настроили of those келлер чтобы он делал нашу систему чтобы было 50 процентов secu и того отношении 8051 1,65 лик в кластере только в том случае если у нас раньше вот это вот отношение уходят эта единица достаточно большую величину то есть если в данном случае у нас стало винс там 0.7 то мы ничего не будем делать потому что 0.61 да то есть 16 минус 1 это будет 06 06 меньше чем 07 и мы ничего не менять не будем обычно то лорен ставится около десяти процентов 0.1 по умолчанию вы можете то тоже поменять вот это достаточно сложное вычисление вы должны посчитать что вот я хочу уровень 50 а еще вот здесь вот у меня будет должен с обеих сторон для того чтобы там было от 40 до 60 это сложно вот и вместо этого дата так решил что мы хотим иметь два значения это нижний и верхний уровень воды вот more то есть если мы находимся в пределах между этим нижним и верхним уровнем мы ничего не делаем если мы выходим за пределы то мы как-то изменяя размер кластера выглядит примерно следующим образом то есть вот пример с тем же самым сепию вот это вот нижняя желтая линия это 40 процентов верхняя это 60 и соответственно пока мы находимся между 46 и 60 мы ничего трогать не будем не будем менять размер пластика если мы чуть меньше то мы уменьшаем если мы чуть больше то увеличиваем это гораздо проще с точки зрения человеческих вычислений не надо делать какие-то калькуляции стол and вот и поэтому они сделали от отдельные решения я привожу ссылки в конце можете посмотреть как это имплементировать ну и мы приходим к самому большому блока этот это решение которое сейчас делаю в квинсе здесь я буду рассказывать несколько вещей про то как надо сделать enhancing проползал про изменение 5 про изменение функциональности при документацию но и все ссылки которые я упоминаю они будут тоже в конце во первых для того чтобы начать работать как вернет вам надо прочитать массу документации но в смысле чтобы девелопмент делать какое-то чтобы и кого сделать ну как минимум вот эти вот 56 документов включая список всех сик спешил интер групп этой группы . верни тасс разбит на какие-то куски каждому куску соответствует своя группа ее для того чтобы изменить вот именно этот кусок вы должны в эту группу вступить участвовать созвон их смотреть что они там по email и посылают у них есть свои собственные правила по работе с кодом то есть все это внутри есть соответственно вот вот этот список документов это минимум которые вы должны прочитать а вообще для этого есть целые репозиторий комьюнити который вы желательно должны знать целиком ну я незнаю честное слово вот соответственно первое что вы должны сделать для того чтобы работать с кодом купюрница чтобы сделать какое-то улучшение вы должны разработать enhancement проползал губернатор hanson пропал в кип это примерно то же самое что и все то есть вы описываете проблему вы описываете как вы и хотите решить вы описывать альтернативное решение почему они не работают бла-бла-бла все то же самое что в ted с питоном бюджет и так далее так далее вот соответственно вот вот это вот ссылка на мои решения которые одному enhancer проползал который я написал там три pull request a соответственно я его несколько раз уже провел если интересно можете посмотреть после того как он попал вы получили добро на него после того как вы залили внутри вы начинаете работать над изменением и перед изменить ее это наверно самая сложная часть при работе с кубер нету сам функциональность код тесты все это бред по сравнению с этим cabernet и пием давайте посмотрим что изменилось выпей с точки зрения авторские лера и так помимо тех параметров которые уже были в авторские лиги нам нужно еще дополнительно контролировать скорость стабилизационные окно и мы должны это делать для обоих направлений вообще изначально не понятно почему мы имеем асимметричное решение ведь мы должны сканировать не только вверх и вниз и соответственно мы должны управлять скоростью скалирование только в окно и вниз и стабилизационной окно должно быть тоже для обоих направлений и как бы это звучит логичным плюс наверное одно из самых сложных и там надо правильно выбрать дефолты то есть когда вы делаете что-то новое когда вы делаете новую какой-то конфигурации должны четко понимать какой основной юз кейс будет использование авто скейлеры и какие дефолты должны быть в системе чтобы если пользователь ничего не указали это все работало примерно так как пользователя ожидают вот эти вот работы с дефолта my eyes кейсы в кипы это очень сильно используется то есть как бы вот пока я писал кеп я написал 6 по моему разных из кейсов user stories которых я описал как пользователи используют автор скейлер каким образом мы должны конфигурировать какие дефолтные значения и так далее так далее то есть это очень важно но и второй по важности это то что ваши пять который вы делаете которые вы создаете он должен быть очень общем то есть это не должно быть конкретное решение конкретной вашей проблемы и должно быть общее решение которое будет устраивать всех пользователей то есть вы должны заранее опять же придумать про всех будущих пользователей и самое главное он должен быть еще и расширяемым то есть если внезапно в какой-то момент арене придет еще кто-то и скажет а вы знаете а вот здесь у давайте вот так вот это должно быть возможно сейчас я покажу это все на примере я взял стандартную настройку авто скейлера в кодексе и добавил туда еще вот эти параметры точнее я добавил два и два блока скейла был дан и для скейл об я показал что мы когда рисуем верх мы можем увеличить на 4 пода или на сто процентов за последние 60 секунд то есть это тот дефолт который мы имели в интернет и теперь настраиваемый вот ну и плюс цивилизационный окно для движения должно быть 0 то есть это очевидный дефолт который я вам расписывал и мне показалось очевидно что вот я вот так вот опишу это очень удобно на самом деле удобно вы можете все настроить все что хотите звучит логично сразу после этого мне начали задавать вопросы и вот четыре самых важных вопросах во-первых должна быть обратная совместимость во вторых дефолтные значения которые я уже описывал предсказуемость системы и расширяемость системы давайте по очереди их пройдем во-первых обратная совместимость чисто для информации версии 1 и 5 авто скейлера она вышла в апреле 2016 года то есть уже больше трех лет она существует и она сейчас пока единственная стабильная версия средств на все что мы сейчас используем она как то должна переводиться в эту стабильную версию конвертироваться потом обратно если что и очень много вопросов связи с этим возникает у них они не хочу сейчас останавливаться на деталях но нужно понимать что если мы сейчас придумаем какой то следующие пять но вот вот с теми параметрами которые я здесь привожу то следующий лет пять он будет использоваться по умолчанию вот но когда он станет стабильным то есть мы должны думать в рамках достаточно больших периодов но это как минимум 5 может 10 кто знает вот скажем первая версия в версии 2 v2 beta 1 он появился в августе 2017 и до сих пор еще не стало джона и fila belotti второе это дефолтные значения давайте посмотрим вот пример из сверху приведён когда пользователь приходит и указывает давайте мы сделаем таки для направления скейл от мы сделаем под в 4 что это значит и когда начинаешь давайте такие вопросы понимаешь на самом деле не понятно что это значит то есть он указал пользователь указал под в 4 а это значит что процентов сколько так сколько у нас по умолчанию 100 или не стой или если он не указал то значит ничего не должно быть использоваться как предсказать непонятно а скажем стрельцы он на и окно здесь использовать или не использовать у нас скилла по умолчанию 0 но пользователь хочет 0 или не 0 ну наверно 0 а точно или нет непонятно аналогично представьте что то же самое для скилл down а там уже в ноль или 300 непонятно вот или что еще будет сложно скажу если он пользователь указывает что перед все концы равняется 30 то есть вот это вот роста в два раза или четыре года он за 30 секунд должен рассчитываться точно там будет четыре под и ну короче это сразу возникает столько вопросов что ты понимаешь что дефолтные значения непонятное столько использовать или не стоит и самое важно нет непонятно пользователь понимает или не понимаю это должны должен понимать вот и скажем а еще одна важная деталь скажем когда мы говорим что 4 пода или сто процентов мы среди них выбираем ведь максимальное значение то есть мы выбрали шесть они 4 когда на примере раньше вот а в случае с калдауны мы должны вы использовать максимальное значение абсолютных величинах или мы должны использовать максимальные изменения в абсолютных величинах то есть макс это вообще ни о чем это непонятно что происходит на самом деле вот и поэтому на самом деле пользователь глядя на эту конфигурацию ему будет очень тяжело понимать что происходит системе поэтому эта конфигурация конкретном случае вообще не правильно и надо все переделывать плюс возникают вопросы скажем в прямо сейчас в autos киллеров кабинета есть несколько тикетов которые говорят а давайте мы добавим вот такую штуку нам очень нужна или добавим такую штуку один из частых запросов а давайте мы сделаем мужчин и врач по последним дням которые там когда-то были или и врач по текущей последние десять минут нагрузки ну какие то вот такие вот вопросы как его добавить в эту функциональность то есть мы добавить еще один параметр a movie норвич 15 например там без 15 последних минут ну как-то оно вообще не будет ложиться в эту в эту именно настройку надо как то все это менять и как следствие мы пришли к другому решению вместе мы потому что я говорю мы потому что на самом деле вот в этом процессе участвует очень большое количество людей вы пишете плыви квест и приходит люди начинают комментировать задают свои вопросы бывают люди задают очень левый вопросы не понимаю ситуации такое бывает бывает люди приходят которые в самом программным не программный комитет как называется в группа которая следит за изменением айпи вот и они задают настолько сложные вопросы на которые ты сидишь и думаешь не знаешь как ответить вот и поэтому то получается такой коллективный разум я заново пересмотрел свое отношение к open source у потому что здесь на самом деле получается коллективное решение вопроса и к чему к чему пришли к тому что на самом деле вот когда вы указываете под 4 и процентов то это на самом деле вы указываете 2 разных полете то есть либо the policy будет работать либо это полете будет работать и среди них выбирается максимум вот этот максимум тоже должно быть где-то записан в виде опять в виде конструкционного параметра и плюс сверху вы накладываете стабилизационные окно которое смотрит последнее значение выбранных policy то есть получается такая многоуровневая система уже и в результате мы пришли вот к следующему и то есть это указано для skill up аналогично будет для скейл down то есть для скилл оба указывая что цивилизационное окно столько то что мы определяем два policy для поводов и для процентов мы указываем что select policy to max в данном случае то есть мы явно это определяем плюс мы определяем кучу других вещей например бывают я уже определился лепка лисси минимум select поле сидис и болт когда мы не рассматриваем вообще все эти полисе и это позволяет добавить расширяемости то есть если в какой то момент времени придет домой человека скажет я хочу все-таки mugen rr и что можно как-то подумать здесь с полисе добавить еще пули тимурович и вы дуры policy сделать по-другому расширяемость увеличилась нашей системе это важно еще раз хочу подчеркнуть что на самом деле вот этот процесс создание пол request a а точнее создание полувековая 100 для и пей изменении пи это очень долгий процесс я когда первым делом сделал пол request для пудры тасс а я сделал одновременно изменить бизнес изменение функциональности поправился тесты все у меня заработало все отлично я говорю вот смотрите вот ко мне приходят и говорят ну как бы вот здесь в давай поправим я начинаю править изменяя шипя и изменяешь функциональность не ешь тесты а потом кстати когда ты коп не забудь поправить потому что мы тип тоже поменяли как бы кеп это тоже документации ты правишь еще кэп заодно все поправилась говоришь смотрите они приходят газ лучше ну вот этого тоже не надо менять начать такое и ты снова снова начал опять меня теперь потом меняешь функциональность опять меняешь тесты меняешь cup и это на самом деле очень долго следующий этап это прав самой функциональности на самом деле это достаточно просто то есть когда вы смотрите на текущий год кабинета сон очень легко читается его легко писать тесты тестов куча но вы добавляете еще своих сложность возможно бывает только с тем как это все правильно запустить и с всякими intent тестами которые лайки то есть большая часть тикетов в кудрин эта стена вышли в гитхабе это на флейте тесты у меня вот этот тест иногда срабатывает иногда не срабатывает а посмотрите пожалуйста у нас из этого сей ломается и так далее ну это правда сложно потому что сделать хорошую систему тестирования такой большой систему как кудрин это достаточно сложно и они там в конкорде как-то работают и как то должны друг на друга влиять система тестирования все сложно вот но это все как бы рабочий процесс это все все можно сделать плюс вы должны сделать если вы сильно меняете функциональность cabernet вы должны сделать вроде ищем критерия это то каким образом это функциональность попадет пользователю то есть начало по опции через альфа по умолчанию выключено потом значит включить ну и все вот эти вот стандартные процессы как вы наверное часто пользовались разными альфа-бета опциями лучшие практики которые я бы советовал людям во первых сразу приготовьтесь большому количеству спама реально сразу начнут выходить 1 commit сделал и все и пошло во вторых сразу исходить из предположения что нужно два пола request 1 пол request на изменения пей который желательно сделать до того как вы пишете функциональность чтобы не переделывать это кучу 1 и 2 половик west на саму функциональности тесты в моем случае мне сказали что это обязательно потому что у меня очень сильно изменение пей и если я это слово в 1 пол request и не знаю там тысячи строчек кода изменения их очень тяжело посмотреть в одном половик вести поэтому мне это сказали без этого никак сейчас настоящий момент происходит переход сборки тестированию bernette а сама докер я не советую использовать докер я не смог это запустить у меня 16 гигабайт памяти на моем лаптопе и этого не хватает вот если у вас больше попробуйте может вас заработает и плюс изменение пиаре очень тяжело протащить и изменение 5 очень тяжело согласовать и поэтому заранее готовьтесь к тому что у вас это займет очень много времени здесь есть небольшой бонус трек который похоже у меня есть еще время затронуть 9 7 затронуть для отлично я вообще быстрее говорил чем обычно как это обычно происходит у меня на всех выступлениях когда волнуюсь один из сложных вопросов которые происходят в кабинет оси это релизы то есть когда вы делаете новый код и вы используете новый обуви с новую конфигурацию этот процесс он совершенно независим от того как работает артас келлер если вы посмотрели по схеме авто скейлер вообще не глядеть не на что он работает только с сервером метрик из диплом он там все если в этот момент вы начинаете релиз у вас происходит там какой-то blue green или еще что-то происходит или если вы используете старый и плетей шим-контроллер у вас rolling апдейт происходит то это на самом деле очень сложно есть очень большое количество и шью в гудермесе если посмотрите я привожу здесь парочку вот одно из них это если используется reload вместе с 40 это когда вы делаете для тех кто не знает когда вы делаете желал от вы можете сказать я хочу чтобы мы не уменьшали минимальное количество инстансов который работает настоящий момент кодов то есть например вот 10 имеете поводов и вы говорите я готов увеличить на 25 процентов то есть вы говорите все еще 25 вы увеличиваете на 25 процентов количество кодов когда они стартуют вы выключаете store потом снова увеличить его выключаете старый вот это под 40 он очень сильно мешает куда autos киллеру потому что вы увеличили количество инстансов они как бы начали принимать трафик в этот момент of those келлер смотрит у нас гораздо больше инстанции в чем есть он начинает по-другому смотреть на метрики метрики соответственно тоже изменяются потому что вот эти новые под и принимают запросы снижая соответственно количество запросов на остальные коды и вот этот процесс достаточно сложный вот этот вот конкуренте который там происходит одновременно имеем два процесса который никак не знают друг о друге в теории не знают теоретически может быть мы будем добавлять эту информацию в дальнейшем вов тоске лир они никак не знают друг о друге но они могут влиять друг на друга на самом деле из-за этого сложно есть несколько тикетов которые говорили мы когда происходит производил релиз у нас количество ходов увеличивается бесконечно пока мы не забираем все ресурсы это из-за того что of those келлер не заметил что там происходит все же че за того что он начал уменьшать количество поводов или увеличивать количество кодов а в этот момент of the rolling авдей происходит там тоже начал уменьшать увеличить количество кодов и это привело к race conditions что мы съели все ресурсы в системе и кластер упал ну такое тоже бывает есть несколько тикетов на эту тему они уже печатью закрыты плюс есть такая конфигурация у авто скейлера что по умолчанию количество если вы устанавливаете количество кодов в ноль то это означает что вы не хотите чтобы происходило скалирование кластера например вы там делаете какой-то кнр или если вы не хотите чтобы of those келли как-то вмешивался вот изменение в количество в ноль с другой стороны очень бывает полезно когда вы имеете с обработкой ивентов в очереди то есть ну вы знаете заранее что вас в очереди не будет ивентов 23:00 и только один час они там будут появляться зачем вам держать этот пот или два пода постоянно рабочими вы говорите давай уменьшим не в ноль вот это соответственно проблема потому что если вы покажете что можно уменьшать 0 то у меня меньше когда он уменьшится 0 он же не будет вести потому что по умолчанию 0 означает что вы не хотите сканировать это плохой дефолт выбранные по умолчанию возвращаясь к нашей схеме со сложностью и 5 вот это вот плохой дефолт выбранный давным-давно которые сейчас уже нельзя исправить потому что мы должны поддерживать такого compatibility и это становится сложно вот но какое-то решение придумали ticket закрыли хотя говорят что там ещё есть проблемы дополнительные плюс есть некоторое количество тикетов на новую функциональность в авто скейлеры в частности movie и врач или мы заранее говорим что мы хотим чтобы мы росли заранее вот до этого количество кодов в кластере по какому-то заранее описанному расписание я не думаю что of those киллер будет изменено или будет добавлено в вот эта функциональность ближайшем времени потому что ну потому что это сложно то есть вот я вот этот проект с добавлением функциональности авто скейлер виду уже месяца 4 и я до сих пор еще не заявился я надеюсь что я войду в 117 но еще неизвестно войну или нет вот то есть как бы добавить туда более сложную вещь вроде работы по расписанию или авто скейлер склон жабам ну как я не представляю себе сколько это времени займет так ну и все ссылки которые я здесь затрагивала перечислял в квадратных скобочках они здесь представлены еще раз хочу сказать что я веду подкаст так что я каждом наклеечки кому интересно подходите со мной общаться и обсуждать все вопросы в зону вопросов и ответов но это наверное все нет нет слышно вот так слышно спасибо иван на самом деле у нас еще даже до дискуссионной зоны есть практически 15 минут даже чуть побольше я что поторопился на им на интервью здесь есть чудесные специальные стульчики для этого садить и я не сказал в начале поэтому напомню ещё раз что у нас есть бот через который можно задавать вопросы и некоторые количество уже есть мы сейчас по ним пойдем на всем остальным я предлагаю писать и задавать эти вопросы сколько в итоге прошло времени с 1 пиара до ориентировочного релиза 117 я сейчас скажу точно потому что эта информация здесь присутствует вот время создания кэп 7 марта то есть это момент когда я фыркнул и ответку и начал работать над ним я не скажу что я потратил на это сто процентов времени конечно если бы я все время сидел и писал только код кубик это с это было бы быстрее было бы уже сделано но как вы понимаете никто не пишет кабинета с на сто процентов своего времени наверное кроме работников google и у меня своя работа еще есть так что как то так готовьтесь к полугоду как минимум спасибо по поводу работы на работодателе тут тоже есть такой веселый вопроса сколько времени суммарно ты вообще репортёр ли это время потраченное на эту на эту вещь работодателю знает ли он там потяжки ты ему за это или он себе и как вообще он отпустил тебя выработку вернется на самом деле это очень хороший вопрос с точки зрения что это же о концепции и я в подкасте уже про это делился что я по-новому взглянул на движение open source фактически я работаю сейчас вот с помощью этого проекта на google как это ни странно звучит где там google овцы я помашу вам ручкой тому что google контролирует сид группы google сидит в группе которая следит за изменением и 5 соответственно они принимают решение стоит делать это или не стоит давать разрешение или не давать и мой работодатель практически ну так получается он платит деньги за то что я разрабатывал ван сорс который контролирует google ну если посмотреть с этой стороны получается я на google.ru бесплатную делаю какой-то код вот с точки зрения нашей компании получается что мой работодатель согласился с тем что я буду делать этот бред потому что вот тот серди который я сделал кстати здесь будет доклад про операторы операторы серди очень близкие сущности пожалуйста сходить и я не помню помню в третьем зале в конце дня фёдор чем мошкин будет делать да вот вот это сергей она сильно зависит от лексику бернес а если вы делаете свое собственное серди купер на это сменяется у него меняется и 5 вы должны менять свой собственный код поэтому либо вы будете постоянно править свой собственный сергей либо вы сделаете это частью губернатора и больше не будете тратить на это ресурсы но вот такой-то рядов мы пошли на то чтобы менять кудир нету спасибо еще вопрос по поводу разные типы облаков понятно что вот эти красивые картинки для бизнеса имеют важное значение когда мы покупаем ресурсов в облаке а если смысл например да это сказать может быть был опыт или может быть были обсуждения как это все ложится ли на приватные облака если все равно инфраструктура свои деньги как будто бы заплачены вот это да это очень интересный опрос и в предыдущей кампании у нас был свое свой кластер то есть на своем железе мы гоняли свой собственный классика интернета со своми его разворачивали и все равно имеет смысл имеет смысл потому что губернатор эта штука который позволяет запускать эти угодно вы хотите можете запускать там тесты то есть если вы запустили свой собственный класс который обрабатывает кошечек и у него увеличилась до 100 но то они для да да сто пудов они вроде как не используется вроде как никому не нужны но эти ресурсы уже lacie раваны в кластере и соответственно из лионелла цикл и никто другой не может их использовать есть такая статья называется борг amiga и кабинета с опыт 10 лет работы с облаками что-то типа такого от гугла вот я советую прочитать в нем они рекомендуют что мы чтобы вы имели всегда один кластер cabernet асана все на продакшен настей джонг на тесты на seo и на все что угодно вот с одной стороны это очень удобно потому что тогда скажем вот этот вот кластер если вы с котиками уменьшили до там 1 1 2 кодов с а вместо ста то эти 198 освобожденных кодов вы можете использовать для того чтобы прогнать еще раз каким себя и тесты чтобы собрать какой-нибудь я не знаю докер-образ и так далее то есть фактически даже внутри одного вашего железного классика вы все равно будете освобождать ресурсы и у вас появятся дополнительные возможности чтобы их как-то использовать для других целей я не знаю еще раз прогнать машин ленин какой-нибудь или еще что нибудь вот с другой стороны когда мы на текущей работе спускается сделали три кластер и вместо одного то есть мы не используем вот этот подход который они советуют своя собственным теперь мы сделали три кластер а productions эйджинг и все остальное в том числе себя и тесты вот и пришли куда пришли google и сказали вот мы используем таким образом у нас вот такие вот как это вот такие причины то использовать мы не хотим там перемешивать настройки перемешивать использование продакшн и все остальное вот и гугл сказал пожалуй мы с вами согласна мы считаем сейчас что это классическое правильное использование куда гнется как то так но это круто и подтверждаю как человек который поддерживает приватные облака что на самом деле и ресурсы никогда не пропадают если их не взял коберна тисках можно дать еще кому-нибудь а еще такой вопрос а что изменится когда звонил авто скиллинг смерть уже и мы все перейдем на 117 и вы перейдёте и будете ли переходить и и какие ты видишь в связи с этим может быть сложности или наоборот интересности и и и будешь ли ты убеждать работодателя переходить со своего решения на гуглово вопрос хороший да конечно лучше всегда поддерживается собственное решение чтобы взбодрить в тебе всегда нуждался с другой стороны это был хакк не используйте его с другой стороны получается тут интересная ситуация мы используем кубик метод в продакшене уже больше года мы его не в продакшене используем там уже два с половиной года но мы никогда не использовали последнюю версию предметом никогда то есть мы отстаём как минимум на две мажорных версии и стараемся использовать последние минор но это это бывает сложно обновлять cabernet с но я не знаю так как обновить питон на продакшене это реально сложно и я не уверен что если мы будем использовать дальше железячки решением очень быстро начнем использовать 117 если это в 117 она войдет 117 там выйдет в ноябре в декабре соответственно ногу деньги года через два то есть на два года и обеспечивая работу я я безопасности а через два года я не знаю что будет через два года будет 5 die wut и ты нам что нибудь расскажешь расскажу про это дальше так народ у нас потихоньку заканчиваются вопросы в принципе мы можем закончить пораньше и пойти в дискуссионную зону сейчас я попробую обновить еще раз все это спасибо за внимание спасибо всем"
}