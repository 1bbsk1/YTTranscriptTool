{
  "video_id": "32IVzNo0rwM",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "добро пожаловать на диво всем привет глеб слушайте ошибки это вечная тема их наверное никогда все не починить и у меня лишь вопрос тебя а что сподвигло на такой доклад он слушает интересная штука потому что даже в названии самого доклада есть двойное дно все так как работа над ошибками которые мы дом с допускаемым в своем softy рыба там программах пишем там сервисах вот так же это собственная работа над ошибками вот создание the pipeline а чтобы это все обработать чтобы все в конце было хорошо и а что же вы делали до этого без этого папой да вы просто погуляв ошибках и вот к этому стремились или как же на самом деле этот зато игрушки то спойлеры из доклада но я пока не буду говорить сохраним некую интригу дальше по ходу уже посмотрим на хорошо окей меня сразу столько вопросов возникает на и теперь даже знать что из тех спойлер кто из них не спойлер в в принципе можем и начать сразу тогда давайте спасибо он работа над ошибками на самом деле такая будет довольно длинная история про то как мы всех большой компании переходили на центре это переход у нас занял наверное я порядка двух лет и в действительности на самом деле так маленький спойлер он еще не во всех местах у нас завершён но мы на самом деле в делаем работу работу над ошибками и вроде у нас все хорошо получается но давайте посмотрим в ретроспективно на вот эти истории там где-то 120 года начнем наверно с того как общем нас устроен pipeline доставки лагов и как он менялся во времени но если в прошлом году у нас было порядка там 60000 лог записи в секунду суммарно порядка 3 терабайта в данных сутки там уже вот в этом году мы там пробили потолок в 150000 слов записи секунду объем данных там превышает порядка шести терабайт за сутки в целом по плану устроен довольно просто у нас вот есть некоторое приложение в микро сервис которым мясники компонент который должен отправить лог записи куда-то дальше not этим куда-то дальше у нас на самом деле другом конце является elastic он такой индустриальный стандарт многие его используют ноги представляют как это как его готовить по просто сам ли в том как сделать нам вот эту передачу дай ластика можно делать очень разными способами мы пошли своим путем мы сделали систему которая красно занимается вот такой доставкой логов залива геркулеса эта штука у нас open source поэтому в принципе можно будет пройти по ссылочке на гитаре и попробовать его потыкаться мне вот к слову как раз вот это вот в правом верхнем углу так выглядит созвездии геркулеса в нашем звездном небе папой внутри устроен следующим образом у нас из приложения в сами ластика топор отправляются лог записи он формате в котором их ну привык получать elastic дальше они перекладываются специальную специальный шлюз который уже работает с кафкой как у нас как раз такая система которая который можно очень очень много проект прокидывать событий не обязательно логов дальше у нас есть специальная демон которые забирают эти logis кафки и уже складывает в ластик он понятно что пластик мы используем голы это - рядами иски по на который позволяет эти лог логе читать в целом по плане устроен таким образом но тут важно отметить что вот вопрос о том почему столько компонента зачем это было так делать в деятельности это у нас не просто pipeline доставки логов это целая система для доставки телеметрии надежной доставки телеметрии нас еще много различных демонов которые умеют в разные типы телеметрии то есть это и логе этой метрики и распределенной трассировки и еще другие типы телеметрии но всё там порядка 15 приложений а вот и к вопросу о том что а где здесь собственно говоря обработка ошибок и зачем она нужна обработка ошибок это по сути способ как-то понять насколько хорошо наш сервис работает какие у него ошибки возникают как часто и так далее вот в принципе раз у нас уже есть elastic не хочу мешает нам эти данные взыграет непосредственно из него эбонита мне таких удобных способов для агрегации поэтому у нас когда-то был написан такой небольшой на колян очный пеп который позволял используя данные ластика их вытаскивать и показывать удобном достаточно для пользователя виде конкретным индексом вот каким фичами он обладал но во-первых он был не по всем ошибкам а только там где есть эксепшен exception to the stack trace и чтобы группировать события было недостаточно просто по тип exception а там учился специальное поле россия по которому уже можно было ошибки группировать ну вот но и в этом вы by можно было еще отфильтровать ошибки которые на мне очень интересно пример это какая-то очень не значим ошибка в каком-то компоненте которые еще не влияет на работу системы и чтобы не видеть в общем списке ошибки не просто фильтра вальс общем так был устроен веб и получается нужно было единственно что на клиенток доработать ей вычислять вот этот вот хэш чтобы правильным образом и сгруппировать вот но у такого подхода есть существенный недостаток поскольку у нас единственное место где мы группируем ошибки это такой веб такой сервер лась приложение а то соответственно мы никакой статистики не по ошибкам имеем никакой то возможности а лифтинга а вот как мы узнаем чуть позже вот эти вещи они оказывается очень полезно за год что общем вот в таком плане сделать чтобы это можно было завести но сама такое 1 логично и место куда можно было бы эту штуку стоит откуда в адаптер к листику это вот это дело собирать но конкретно то можно сделать сбор метрик на какое-то общее количество как часто они проявляются вот это вот эту вещь может нам собрать вот при этом ни че не мешает но настроить такое примитивная лифтинг например мы можем отфильтровать ошибки по некоторым полям то есть интерес то те которые действительно важны и по которым нужно уведомить пользователя нота в качестве листинга использовалась просто email и туда 1 час соответственно можно было получить такой отчет она строить там фильтрацию и что именно как агрегировать это тоже мы сделали в этом своим baby чуть чуть расширив он так с этой штукой работали работали инженеры но во первых дежурный он мог зайти и в почту получить этот свой орт и потом дальше с ними разбираться это по сути такой может быть не очень оперативной но по-крайней мере возможностям в течение часа найти какую-то проблему и и начинаете справлять а вот но чтобы не ждать вот этого часа пока там кто-то придет ошибка с агрегированные активный мониторинг почему заключался что дежурный инженер допустим в момент релиза или там в ближайшее время после него в течение дня он просто реально глазкам заходил смотрел web смотрел какие ошибки приходят и если танк видел какую-то аномалию опять же таким ленинским прищуром то начинал с этим что-то делать в действительности такой вот активный мониторинг он еще оказался очень хорошо применим для тестировщиков почему потому что у нас есть ребенка окружении мы развернули на нем нашу систему погоняли какие-то тесты и вроде бы все работает но это компоненты могут давать сбой и как раз от строчки могли просто зайти в таком мониторинг для стретчинг упражнения посмотреть на то какие ошибки появились и дальше и соответственно там заводить дефекты и дальше как-то улучшать софт но действительности не все так просто и тут нам поможет аналитиков окапов вот он есть у нас такая практика когда мы собираем по спортом и по ним делаем какие-то выводы нот для примера рассмотрим парочку fa cup of это реальные факап которые у нас были в компании в прошлом году там в разных командах но тут для примера вот один взят здесь взят период времени в двое суток вот каждый столбец ошибки в час нужно понимать масштаб бедствия это точек но здесь 1300 шибок час и утверждается что вот на вот этом графике есть период когда произошёл некоторый факов но давайте попробуем понять а где все началось но во первых на очевидно что где-то воздействие то сначала вот этого первого пика ну потому что сложно не заметить вот этот всплеск окей хорошо вот если присмотреться тот вот есть вот маленькая такая подозрительная пипка который может быть тоже как-то относится к это к нашей проблеме так вот если мы сейчас возьмем вот эти все наши логе отфильтруем только по тем который действительно касались пока по мы получим такую картину что вот это маленький всплеск крошечный который был от под цифрой 2 он действительности был был связан с этим факап ом и это как раз первые ошибки которые в скором столкнулись наши пользователи вот это там было вечером 24 февраля уже ближе к ночи и начались массовые ошибки и только уже под утро были обращений от пользователей в техническую поддержку на как вины тут уже достаточно густо всего пофиксили путем отката и все стало хорошо но в принципе в таков окапи можно было сказать как ну вот вы там что-то делаете пост посмотрите на количество ошибок там не знаю монитор все активные вроде бы проблема решена в принципе вроде бы аргумент разумный и так можно сделать на давайте посмотрим на другой пример другой пример это уже к другая команда такое время у них прошел куда свой факап здесь точно также взят взятой вот эти ошибки то есть этот столбик и каждый это количество ошибок в час за двое суток вот и здесь уже потолочек побольше здесь до 8000 ошибок сейчас доходил давайте попробуем понять а где здесь все началось с ног может быть предположить что перед этим вторым всплеском где-то здесь пока но с другой стороны у нас где-то здесь слева тоже какие-то ошибки при большом количестве возникали вот тут прям такие столбики появляются может быть эта ошибка тут кто-то возможно заподозрит что что то здесь не ладное на самом деле где-то в прошлом на самом деле у ребят на через проблемы но если вы сейчас взять и попытаться отфильтровать и показать только те показать на этом графике те ошибки которые именно относится непосредственно к по вот но те кто обладает супер зрением они от увидели что там на несколько пикселей изменились какие-то столбики вот тут совсем не разглядеть а на самом деле 1 шип начались вас без середине дня они начались на следующие сутки утром было обращение в техническую поддержку пока там разбирались суть да дело в чем проблема нам через пару часов уже собственно или именно конкретно к fix у этой проблемы и быстро починили все стало хорошо но в целом важно понимать что примерно сутки у нас сервис был вот какая-то часть ариза была недоступна для пользователей что в этой ситуации делать все это говорил про активный мониторинг вот можно обратиться к помощи интернет и посмотрите какую проблему решают других местах например вот эта фотография я реальная фотография с блога одной крупной российской компании на хабре что здесь мы видим здесь видели достаточно много инженеров далее мониторы вот они там сидят смотрят в графике вот но нужно понимать что масштаб он может измениться задач стала много-много у нас там проекта все прочее топчут большой нагрузка большая общем блога всяких графиков событий много что делать ну наверное видимо увеличивать количество инженеров и давай давать ему чем больше мониторов от если приглядеться то можно посчитать количество мониторов и заметить что одного инженера аж целых двенадцать мониторов вот и причем те кто внимательно видели первую картинку они заметят что вот так большой экран который был вот он находится в конце вот этого openspace прост огромное количество инженеров которые только и делал что сутками смотрят график вроде бы да это решение но на самом деле вот если вот проанализировать вот эти факап и которые мы собирали в течение года можно сделать вывод что лишь имея а лифтинг половом ошибка то есть те которые мы не видели раньше можно избегать порядка десяти-пятнадцати инцидентов не то что как-то локализовать быстро факап а просто его избегать он не случился бы вообще вот ну понятно что эта практика на не возник и само по себе то есть понятно что там нужно всякие разные используют различное окружение эти посты и джинга нам канареечный тепло и прочее но самое главное что это действительно может помогать вот а поподробнее про то какой наличку пока похудела и вообще про культуру заполнение пасмурного можно вот так сделать только отсылку к докладу мои коллеги лишь кирпичникова а вот и в принципе там он рассказывает как мы к этому пришли и почему именно стали делать части аналитики пока по ну давайте вернемся к нашей действительности к тому что нужно что-то менять тут казалось бы как раз и должен появиться вот это центре который должен на спасти давайте сначала разберемся а почему именно центре они почему что то другое но тут же самое главное что как 1 м3 тут инструмент в котором есть allure teen anal а может так электричек которая была нам нужно но и сама второе надо по списку но не по значимости вещь это что можно делать инсталляцию центре всегда своем железе не использовать главной центре вот почему это действительно сейчас оказалось важным я вот расскажу чуть попозже от новой кроме этого еще центре сколько вас компания очень большая проектов очень много их несколько десятков некоторые команды они там тоже достаточно идут в ногу со временем и находят kids инструменты то есть были были примеру у нас компании когда отдельная команда а начинала использовать центре и имела положить но пытаюсь там миник вроде бы казалось бы что у них там меньше пока пав происходит что работа с ошибками обязательно упорядочивается и становится лучше жить и про к инженерам но и команде в целом вот поэтому мы и как раз решили взять в центре и попробовать его на масштабах компании вот но нужно понимать что если мы берем код инструмент нужно его они инфраструктуры которым хотим предлагать другим разработчикам другим командам нужно его как смесь продать для этого как раз я готовил дема которая показывает на примере от реального капо то есть тут мы взяли вот один из тот факт обувка протоссами так что разбирали и просто взять его попытаться вот эти логе все закинуть в в наш pipeline довести до центре и посмотреть как же она на самом деле будет у дать час посмотрим коротенькое видео как это все работает вот у нас получается ошибки есть но они не относятся к текущему релизу то есть нас релиз он безошибочный здесь все хорошо в целом у нас есть какие то ошибки которые там трека листам с предыдущих релизов которые когда-то давно возникали и здесь можно смотреть вот если посмотреть за сейчас вот у нас видно что ошибок стал чуть побольше как бы эти ошибки которые мы закидываем они как бы в реальном времени начинают наполняться наполняться наполняться и вот сейчас какой-то момент он нам пришел уведомление пришел удаления центре что что-то пошло не так просто на почту сообщение что такая-то у нас ошибка произошла там даже можно посмотреть какой-то stack trace но на самом-самом то что можно прям сразу из почты перейти в центре и увидеть собственного эту ошибку увидеть контекст это ошибки что произошло но что самое главное если мы сейчас перейдем в релизы вот увидим что да у нас привели появился новый релиз пошли блоге по новому релизу и мы увидели ошибку которая в этом новом релизе попал этот on the same которая у нас здесь появилось все можно в разных с разных сторон найти вот такой роста ошибка рот самая последняя пришла в принципе лев не получили это означает что инженер уже не через сутки узнает о проблеме а достаточно оперативно зависимости от того как мы настроим alert в нашем инструменте на данном случае там был по моему устроена пять минут это не суть важно окей вот мы решили использовать центре вот в принципе мы перед уже упоминал что ты там построить свой пайплайн диалогов давайте поймем почему не использовать вообще центре с дикон принципе там есть библиотека которым я тут сразу проявляются у такого подхода есть существенный достаток самый первый из них это что такой центре клиент работает модели and get что означает что он пытается отправить ошибку в центре если получилось to donate будет доставлено если что-то пошло где-то не по плану и где то ошибка к это произошла не важно на каком уровне ну просто и туз информации об ошибке потеряем бы довольно неприятно звучит особенно когда он сидел или например вдруг если центре не работает но может ли вдруг не работать центре мы нибудь может войти сохранить небольшую интригу просто такой подход он довольно хрупкий второй момент это вот такой вендор лак смотрите мы если выбираем использование центр sdk начать что в каждый микро сервис в каждое наше приложение мы должны строить библиотеку центре и и пользоваться если вдруг нам что-то не понравится а мы тоже делаем масштабах компании это будет довольно неприятно и заставляет разработчиков делать что-то другое это плохо почему это плохо но кроме того что действительно стоят люди и что-то потом что-то переделать от сам по себе не очень а то что у нас таких микро сервисах и на самом деле тысячи у нас десятки команд у каждой команды десятки микро сервисов сумме это накапливается там в тысячу и понятно что поменять для тысячи сервисов вот это вы не хотелось и в самое то главное что у нас есть под рукой труба который позволяет надежную доставку сделать и вот эта вещь которую ты сюда тоже бы добавил и и мы увидели эту проблему не сразу но она потом оказалось для нас очень существенная смотрите когда мы используем команда использует собственно sdk то есть они получаются на прямой пароля центре мы имеем никакого контроля состава инфраструктуры о том что кто и как отправляет центре действительности окажется очень важно и и тут как раз вот глядя на вот эти причины понятно зачем допустим использую эту трубу которая в принципе у нас уже есть это на самом деле получить эти данные довольно простой смотрите у нас уже есть pipeline который отправляет данные власти к нам просто нужно вот эти же самые данные перенаправить в другое русло и направить в центре но как вы понимаете не все так просто иначе бы от этого доклада бы просто бы не было но не все так просто с какими проблемами при этом сталкивались столкнули с большим количество проблем давайте разберем самые основные первое это группировка ошибок оказалось что не все так просто с ней not если в целом посмотреть как устроена группировка ошибок центре на там есть несколько типов событий в центре которые попадают вот если так очень грубо взять то есть три набора данных по которым можно и группировать это stack trace exception типок совершенно который возник и масса 400000 которые мы записали вместе с ошибкой одно из леса stack trace нам более менее понятно то есть если 2 ст актрису совпадают скорее всего шибко на ее можно сгруппировать тут вроде вопросов нет интересно когда у нас вот есть массаж и понятно одинаковой массы чего-нибудь группе рацию ошибку мыс очень разные соответственно группироваться не буду давайте посмотрим вот реальный пример реальный лук запись вот этот массаж который у нас салгира вался в качестве ошибки что мы здесь видим здесь вот есть видно какой то секатор но сразу и спойлер это на самом деле префикс трассировки мир сервисной дрессировки здесь есть еще какой-то какое то число которое тоже довольно уникально между отдельными запросами и сыщику это идентификатор я понятия не имею что это такое но это за то просто из залогов одной из команд ну и что с этим делать в действительности вот эта строка она по себе будет всегда уникальна потому что индикатор трассировки он меняется внутренней кипит индикатор который добавляет команда к своим налогом она там тоже меняется вот на помощь нам здесь приходит fingerprint это специальной технологии который позволяет нам сказать что вот у на данной ошибки будет вот такой то печаток и все которыми такой же отпечаток их нужно скопировать но как его формировать достаточно для посчитать какой-нибудь фишек например от шаблона нашего сообщения смотрите если лук запись она да она там уже готовы андрей дрянные показывается пользователю она там уже в не вставлен все нужное значение но поскольку мы используем структурированное логирование то у нас просто из шаблончик в котором потом просто какой-то мент поставляются нужное значение а здесь мы просто сразу будем считать игры print от целого шаблоном это принципе решает эту проблему травишь с которой мы столкнулись это то что ошибок в проектах может возникать внезапно довольно много и тут оказалось что полезно бы сделать тротлинг и таким образом снизить пиковую нагрузку от проектов и изолировать таким образом влияние одних проектов и одних команд которые пишут свеж любых других команд и у нас сервис работает как бы не очень хорошо ну допустим там решили что от 500 ошибок минуту и такая же довольно много но как мягкий продлен который позволит как раз какие-то срезать пике вот но мы на самом деле ждать и поняли что ошиблись и это недостаточно что бывает команды плохиши которым какой буду тротлинг не устанавливал какую бы норму не дел они всегда будут не упираться и отличать что в центре будет приходить очень и очень очень много ошибок 1 и грубо говоря тысячи ошибок которые не можем вот так вот выдать в центре от на самом деле не шутка реальность которой мы столкнулись это слишком много то есть да можно попотеть и попытаться до масштабировать центре на своих железках воду такого рода такой нагрузки но кажется что здесь что-то не так и нужно фундаментально менять подход поэтому здесь мы как раз поговорим с вами про тон а какие же ошибки идут к нам первый такой кризис смотрите ошибка что такое вот в нашем по планету и лог запись о который уровень логирование роль или fatale а вот попадает вот но если машинка подумать о кажется что вот этот тезис он вроде бы фактически но соответствует действительности но фундаментально он ошибочен и ошибка это не то что мы там за лаги равале с каким-то уровнем а это та та события требует реакции инженера то есть когда должен человек включится посмотреть в чем проблема и начать исправлять в противном случае ошибкой это считать не надо ну давайте посмотрим некоторые примеры с которыми мы сталкивались примеров таких довольно много самый такой типовой это ошибка и успешный ретро и в чем она заключается но давайте попробуем посмотреть логи которые у нас были в сервисе это тут все все логине только ошибки но здесь у нас сервис дался сделать запрос кому-то углу а затем ром стоит несколько сервисов вот он выбрал какую-то реплику и запрос что ты что то не получилось закончилась ошибкой но самое главное что сервис на этом не закончил свою работу он попытался отправить запрос на какую-то следующую реплику и вот это как раз реплика уже вернула успешный ответ смотрите с одной стороны ошибка у нас возникло но мы там сделали литра и все стало хорошо эти умение ошибка в лог упало там соответственно у нас счетчик в центре сработал и там прийти допустим тот же alert разработчику и вот он будет вынужден ночью просыпаться и разбираться с тем что на самом деле и не нужно было бы делать давайте посмотрим другой пример тоже это все реально и логий у которой вот вы вытащенный из разных сервисов из разных приложений из разных у разных команд отсутствует необходимо проводить смотрите здесь у нас сервис пытался сделать запрос на получение некоторого в сущности уведомлений но для конкретно пользователя он не смог это сделать потому что ему нельзя их показывать у него там 403 код ошибки вот казалось бы зачем сделать ошибку пользователей не прав это вроде бы нормально почему бы нет вот еще тоже один пример из похожего не серии протухла сессии но как известно у нас там в принципе browse сессия может потухнуть не знает он пользователь может открытие где-то много вкладке там может быть что то еще поменяться самое главное что это вполне естественная ситуация для нашего приложения когда вдруг там таким пользователям перестал быть действительно но тем не менее вот эта штука лакировалась с уровнем р.р. ok давайте еще посмотрим пример тоже довольно часто что к когда там что-то мы не нашли в какому-нибудь конечно но здесь данном случае был кэш организаций какой-то довольно там сложно хитро устроен и вот и в нем мы не смогли найти и там нужного абонента с каким-то индикатором там я кого-то пользователя не важно важно то что дано не нашлись конечно это что значит что он просто пойдем какое-то другое хранилище ассистент на я там из него может быть до по медине прочитаем данные в целом мы сможем эту ситуацию разрулить вот таких ошибок может быть много например ошибки валидации все та же ошибки ких то пользовательских данных то есть нам отправили что-то нехорошее вот мы поняли что это нехорошая но зачем-то заблокировали это с уровнем rh еще такой пример довольно хитро ошибки не очень очевидные почему допустим ладоги ровать как эра но давайте представим что у нас это не один сервис у нас некоторое цепочка сервисов вот у нас есть и 5 эскудо как раз на приходит допустим пользовательские запросы там направляется некоторые щуп and с этого бока это делать запрос допустим какой-то storage service смотрите предположим она сторож сервисе произошел отказ сам этот наш сервис не работает соответственно цепочки перед ним который стоял сервис он тоже не может адекватно обработать запрос пользователя и тоже по сути завершается ошибкой что же герман на самом деле здесь данном случае аж целых три ошибки хотя казалось бы что том что есть проблема достаточно было понять по одному единственному сервису вот но и вот таких вот примеров разнообразных их очень много и вот если попытаться их как-то классифицировать можно выделить следующие смотрите первое это то что сервисом стоять на поборол ошибку прошу mode видели на примере допустим непопадание в кэш да данные выпали из него или когда мы сделали успешно ритой то есть эти вещи когда сервис до столкнуться с какой-то проблемой сам с ней справился зачем будить разработчика зачем его трогать когда теле самостоятельно может это разрулить смотрите дальше еще может быть часть сценария у нас в принципе ошибка в каком-то сценарий это нормальная ситуация но например то что у нас нет пользователя прав то что у нас там валидация как не проходит это нормальная ситуация и в этой ситуации тоже нет никакого смысла логировать это как ошибку но и наверное то что чаще всего любят использовать инженеры это то что проблема то не на нашей стороне ну вот смотрите у нас два сервиса наш сервис работает мы делаем запрос к тому который не работает вообще на самом деле находится в зоне ответственности другой команды у них проблема возникла зачем нам просыпаться черном и лидирует на эту проблему кажется кто-то делал должен делать другой вроде бы логично одну что в этой ситуации нужно делать понятно что если ошибки и возникают из понятно что там и промахивается допустим ваш очень часто об этом было бы неплохо узнать вот помогают нам этом на самом деле метрики тут я бы наверное просто сделал бы отсылку к двум методологию с методологией от метро дороге то есть утилизация старейшин errors и рейд rs юрий принципе обе эти метрологии содержит себе вот эти метрики по ошибкам которые позволяют нам понять по типам ошибкам а их частоте возникновения по количеству эти метрики если мы собираем они позволят нам ретроспективно не обязательно очень пробиваю там вставать бежать чинить ретроспективно посмотреть в чем у нас конкретно проблемы какие надо настройки нам противник может быть где-то исправить какие-то баги ну допустим там возможно что ситуация когда там у нас пользователя не оказалось прав это просто именно баг в коде тут просто мы не должны были делать запрос когда уже понятно что у пользователя допустим нет соответствующих прав но это уже к вопросу о том как написан код вот и пример как раз хороший для вот такой вот в цепочке микро сервисов это использования трассировать но тренировками у нас ферментированный все наши микро сервисы и не позволяют там по некоторым трассировки построить дерево запросов и понятия где проблема возникла то есть у нас каком-то месте есть ошибка мы соответственно информацию о ней можем потом собрать вместе и полный контекст построить это в принципе будет достаточно но давайте примем а как вот с такими вот не ошибками надо бороться бороться можно рефакторинга моделирования в чем он заключается мы берем от открываем наш репозитории гриппом ищем по нему все вхождения когда мы лоббировали с уровнем р и просто меняем на warning там где действительно это имело бы смысл сделать из плюсов такого подхода это делается очень быстро действительно открыли коду базу нашли всех использования вашего логирование быстро пробежались там ну по контексту конечно поняли действительно делаете нет здесь на самом деле есть подводный камень и а что кода при этом не изменится если вас действительно был какой-то коде бак вы просто его замаскировали подворник но на самом деле ничего не поменяется до ошибок у вас будет меньше до вас будет меньше проспаться инженеры по ночам это на самом деле хорошо но качество кода не измените что несомненно плохо этом есть более продвинутый способ я была на золотой интерактивный итеративный подход он уже больше нацелен на работу дежурного то есть когда дежурный там вступает на дежурство ему на первое время доверяем такую задачу как брать некоторых ошибок смотреть в чем суть природы если это баги соответственно их исправлять если еще остались при этом какие еще ошибки то возвращаться в начало и продолжать продолжать поэтому цикл уйти не станет совсем хорошо плюс очевидный этом улучшаем качество кода закрываем баги ну кто бы сомневался с да здорово вот но существенный минус баги бывают сложные бумаги бывают и не простые и это на самом деле очень медленный процесс очень долгий путь нужно пройти вот это важно понимать что софтом при этом продолжают развиваться там с добавлением новых фич мы ну естественным путем добавляем новые баги и поэтому нужно понимать что такое путь он на самом деле может продолжаться до бесконечности особенно когда какие-нибудь такие хитрые баги которые но вроде бага вроде нет иди zenbodi вот и тут важно руководствовался принципом пар это то есть не пытаться сделать 0 фон ошибок сделать его таким чтобы стать жить стало комфортно какие вот даже у таких подходов есть проблемы самом деле не все так просто как может вначале показаться вот оно смотрите ошибки которые в нашем коде возникает понятно в этом поправили баги в этом поменяли уровне логирование все как бы здорово а что делать если кот находится каких-то общей библиотеках и в общей клиент другая команда вот и вы политикой вот там за лакировалась какая-то запись с уровнем р.р. но вставать ночью на alert который пришел придется вам они соответственно автору этой библиотеке и вот здесь вам нужно проявить все свои soft skills чтобы убедить разработчика что надо там с микки пустим уровень логирования ли что-то поправить ну вот как говорится каждый это решить эту проблему по-своему давайте посмотрим на примере как обще вот это проявляется и почему на самом деле в некоторых ситуациях вот эти вот error и может быть даже действительно error он на самом деле для нас вот лир для прикладных разработчиков какого-то этого нашего продукта может оказаться бесполезным вот смотрите вот это конкретный пример реального logo вот здесь у нас за лакировалась как р.р. что мы вам проще здесь раз подчеркивает никуда доска вообще библиотеки вот мы видим что здесь до нас погиб и почитать какой-то кусочек с каким-то идентификатором с какой-то тачки из какого-то дата-центра с каким-то смещением ну и вот почему этот произошёл потому что там через 10 код ошибки окей хорошо вот нам как прикладному разработчику на самом деле из этого всего полезно только время время когда произошла ошибка больше нам из этого ничего не извлечь действительности от того что здесь эра перейдет варнинг это он он будет на самом деле достаточно смотреть на то что реально влияет на наш прикладной код если у нас сервис не сломался все хорошо если наш сервис сломался то по идее логировать ошибка мы должны уже на своем уровне тот который нам будет понять дамы валерки прочитаем что случилось но было понятно что нам делать они не будить в данном случае разработчика библиотек или там сервисы которые мы обращаемся и спрашивать о что тоже здесь при условии что с этим дальше делать но ты чего то же такое довольно тоже например именно на уровне взаимодействия команд да смотрите если мы говорим про большую продуктовую команду у который может быть поделена на под команды или у нас там это взаимодействие на уровне разных проектов то есть интеграции взаимные кит или даже на мтс инфраструктуры взаимодействие может быть очень много этих межсервисного взаимодействие может быть много означает что какие-то сервисы которые находятся в одной цепочке они находятся в зоне ответственности разных команд теперь представьте ситуацию что у вас команды у них разная нам культура у них разные практики у них разная развитость инструментов которыми они пользуются понятно что да несмотря то что мы общие инструменты предлагаем все равно так или иначе команда не отличаются своей работе и тут получается смотрите какая ситуация вот вы допустим пользуйтесь каким-то чужим сервисом у вас очень хорошо развитые инструменты вы очень быстро узнаете о всех проблемах а у той команды того сервиса который вы используете так вот допустим ничего этого нет это означает что в проблемах будете узнавать раньше чем ваши коллеги и соответственно вся вот это вот польза от этих инструментов она сводится на нет потому что вам так или иначе придется идти к другой команде говорить вот ребята у вас есть проблема они так оао давайте сейчас будем разбираться и все этот процесс может затянуться вот поэтому конечно очень здорово когда уровень развитости вот этих инструментов и вообще у команд одинаковы но на практике конечно такое встречается очень редко поэтому нужно иметь ввиду на самом деле вот в этой истории есть еще не обратная сторона ведь не только в проблема в том что мы вот раньше узнали о какой-то проблеме вот это также ведь о том что какие-то разработчики а позаботились о том чтобы получить нужные alert и и понимать что есть ошибка что нет вот а другая команда может например это по-разному интерпретируют представьте ситуацию что там горит нужно в терминах село то есть вы допустим расчитывайте что другой сервис будет работать и у него там всегда будет возвращать на условно всегда будет возвращать успешное выполнение на кого-то запроса а другая команда допустим считает что она может позволить себе какой-нибудь довольно большой р budget и кажется что в этой ситуации ну вам нужно уметь договариваться опять же здесь нужно применять все свои soft skills для решения от этой проблемы так или иначе этот мы на протяжении долгого времени лишали вот эти решали эти проблемы почему в итоге пришли с действительности у нас при есть команды которая таких живут с нулевым фоном ошибок самом деле если вы столкнуть из команды перфекционистов и дадите инструмент центре не беспокойтесь там они будут держать все на нуле вот но на самом деле скорее исключение чем правило и как правило команды как раз приходит какой ситуация когда он не скопированных ошибок там несколько в день возникает вот пример того как пел о своей ошибке одна из команд у них было 100000 ошибок где нет они сгруппированных это вот их именно и ивентов отдельных вот они после работы проведенных работ с вилли это количество до 300 в день а если уже говорить потом как вот эти ошибочки сгруппировались там до каких-то однотипных вещей показалось что сгруппированных ошибок всего единиц фонда 10 и вот в принципе появилась у многих команд это самом деле очень здорово вот но не все так просто и не всегда все завершается хэппи-эндом забыли те команды которые просто не смогли по разным причинам либо они пользуются инструментами как на которые они не смогли ни как появляются точки зрения лагера ваней там сыпятся ошибки это могут быть какие-то внешние просто для чем не знаю то может быть это внешней базы данных еще что-нибудь либо команды которые просто там в рамках своего процесса разработки просто не могут выделить достаточное время взяться за что-то ну в принципе тут людей сложно осуждать потому что в конце концов там нектар проектах могут быть какой не мучай legacy который там делали десять лет назад который просто работает не трогай но никто просто не хочет разбираться с ними менять что-то списке какое бывает вот что мы в итоге с этим получили то есть если говорить в цифрах вот влогах нам в ошибках и прочим всего лагов и вот уже изначально говорил что данный момент у нас порядка 150 тысяч в секунду вот чисто плайн центре роду же в центре мы попытаемся доставить это 100000 понятно что то попытаться логе то есть инфа вардинге эрве их мы получается уже отфильтрованным jd центре уже вот этих ивентов отдельных именно с уровнем логирования р-р или fatal доходит уже сейчас порядка 75 секунду или как раз пришло самое время рассказать а почему же так важно для нас инсталляция от этого сервиса на нашей стороне они использования облачного варианта вот смотрите вот есть тим план в центре он там это в двадцать шесть баксов месяц подарок до 50000 ошибок из казалось бы это копейки особенно такого крупной компании к контур если вы хотите ошибок больше атомов можно в их калькуляторе выкрутить максимум до 6 миллионов ошибок за месяц этот нужно будет доплатить до 800 20 баксов ну казалось бы тоже деньги то не очень большие от меньше чем за плат одного разработчика noke но давайте посмотрим здесь семьдесят пять ошибок в секунду а сколько же это будет в месяц вот в месяц если перемножить сколько секунд у нас минуте сколько минут в части сколько у нас часов в сутках и сколько у нас дней в месяц мы получим внезапно порядка 200 миллионов и вот напомню что максимум самом деле а колоссальное количество ошибок которые просто вот сейчас запустили она очень большое то есть если это просто отправлять вот так че облачный сервис на него расходы под просто космически вот но на самом деле это еще не все и вот иногда это вот это вот семьдесят пять ошибок секунду такой нормальный средний фон можно так это назвать на самом деле иногда случается инцедент черт скрывать например просто взял случайный день когда он был инцидент и вот это график который показывает сколько мы вот этих логов за резали из-за превышения лимитов которым вы стоите на команды вот оказалось что там всего лишь за какие то три минуты мы просто зарезали 300000 ошибок если эти данные мы шли не через нас наш портленде у нас вот выставлен этот rapping то мы бы центре вот докинули вот это количество ошибок 1 не при этом нужно понимать что там если взять какие-нибудь инциденты покрупнее по продолжительные потом за пару-тройку таких инцидентов мы на самом деле уйдем далеко в космос о самом деле не все так плохо и наверное мой смысл он говорите о том как у нас сейчас устроен вот этот олег не как у нас поменялось и поменялось ли вообще работа дежурных а давайте начнем с али ртов здесь я буду говорить на примере одной из команд и здесь я призываю как раз снизу смотреть на конкретные цифры которые у них настроен the вальярд а х больше смотреть на этот подход который был выработан но смотрите вот у команды настроенной ошибки alert на ошибку если она проявилась больше десяти раз за минуту здесь важный момент не то что их 10 раз это на самом деле просто эмпирически определенное значение когда команде комфортно с этим значением жить а тут важно то что не на каждую первую же ошибку нужно реагировать нужно понимать что есть какой-то бюджет на ошибки и нужно реагировать с каким-то порогом важный момент который нужно для себя отметить второй важный момент это то что у нас ошибка новая ошибка она тоже провел сотни сколько раз да он стучит у команд выбор на три раза за минуту есть обратите внимание что опять же тут не на первую ошибку реагируем и сразу а мы ждем некоторое время провела там и раздвинут ok начинают мне реагировать и тут важно понять что рог на новые ошибки срабатывания наше наши реакции она должна быть более оперативно поэтому здесь папок находится более низки и наконец третий типа вертов это верно ошибки которые перри открылись смотрите мы когда-то столкнулись с ошибкой мы ее исправили за фиксили зарились за за фиксили нашу ошибку в центре это отметили это ошибки не было ни проявлялась не появлялась потом бах у нас какой-то момент каком-то релизе она снова появилась воскрес этот зомби и вот тут-то как раз нужно сразу реагировать что непонятно чем это связано и может быть мы там не знаю покатили какой-нибудь некорректно релиз не с той ветке может еще что то и тут надо реагировать как можно быстрее отреагировать на это нужно понять а какими способами вообще нам важно доставлять наши alert и карты можно доставлять принципе центре разными способами от выписав здесь получается топ-4 способ которые у нас пользуются командами притом то есть это сладкий электронная почта telegram пуловер это важно понимать что в зависимости от и критичности алерта можно использовать разные каналы доставки на примере одной из команд они пользуются слег с лаком и пуша грамм то есть лак для всех всех alert of a push allure уже для таких самых критичных которые надо прям агрессивно доставить на телефон у разработчика чтобы он гарантированно смог его прочитать их уже как-то там дальше начать реагировать но это и тут резонный вопрос а как понимаете какие alert и важных и неважно как общих дифференцировать самое главное то что нужно делать нужно обогащать наши вот эти ивенты который мы отправляем гамме атрибуты минут в терминах центре что такое может быть ну во-первых название сервис смотрите у нас есть какие-то критические сервисы без которых не работает наше приложение если в нем праздника youth alert и они наверное сутки важные если это какой-то вспомогательный сервис которым без которого мы можем жить и там игры ссуды крадешь у нас происходит почему бы и нет ok второе что тоже приходит на ум это окружение понятно что если произошло что-то нас три джинки кажется что будить разработчиков вовсе не надо да come to learn можем нам получить злаки чтобы разработчики на это отреагировал или тестировщик но в целом какой-то необходимости оперативного реагирования на этом не продакшен окружения нет также это могут быть который пользователя различные но смотрите в принципе понятно откуда добытую нашем коде вопрос какого потом использовать на самом деле центре она позволяет группировать событий не только вот как события сами по себе ошибки а также еще отмечает а как часто вот эти общие ошибки возникают в том смысле у какого количества пользователей и тут важно если мы в центре видим что ошибка появилась у большого количества пользователей то у ей надо идти бежать исправлять если это малое количество пользователей что может быть там можно подождать и как-то там вот в нашем рамках наших целей с этим как-то жить общего самом деле вот таких вот вещей которые можем обогатить их может быть много и не все зависит от того на как мы написали свой код что мы внутри делаем что используем на самом деле здесь на свой вкус можно выработать разные методологии в целом и сейчас он смотреть как благодаря вот аким или а там поменялось работать журнала верно имеет смысл посмотреть а как же изменился инструментарий дежурного то есть чем раньше пользовались чем стали пользоваться сейчас в девятнадцатом году стандартным набором инструментов для дежурного были получается alert от мойры то есть такая точка входа разработчику пришел alr допустим хотели грамотами или флаг он открыл посмотрел графики на графа не посмотрел что по метрикам происходит уже дальше пошел разбираться то может быть пологом флагов киба не может быть еще как-то общего только была точка входа в случае каких перерезав или просто когда вы прям дежурные сидел и мониторил какой то же до этого приводил пример он просто реально смотрел если вы начали сыпаться ошибки это слон нашим на конечном инструменте или даже в японии то нужно быстренько бежать и что-то делать что изменилось 1020 самом деле с точки зрения мой раньше не поменялось это также остается основным инструментом информирования о каких-то аномалиях и нештатных ситуациях но при этом к этому добавились allure то центре если раньше нужно было сидеть и активно мониторить с глазами смотреть что меняется сейчас мы человеческий фактор убрали и за вас делать цен залазь бы здорово да но надо понять насколько здорово и тут на как раз подойдем к следующему такой части не анонсированы к аналитике fa cup of более подробный как раз вот на вот таком переходном периоде вот не было центре явился центре на примере одной из команд которая как раз хорошо друг с ценой станом документируют своим факап и делает выводы какие то и поэтому в этой аналитики можно в принципе попробую сейчас пробежаться но смотрите за первые полгода 1019 года когда они еще не использовали центре у них произошло 26 инцидентов но там сложно судить о том насколько сейчас а там они были масштабные то есть это на самом деле не суть важно важно то что именно то что разработчики посчитали инцидентами и зафиксировали их в паспортах к сожалению там вот из инцидентов видимо были не достаточно значимый про них просто даже не заполнили толком посмотрим поэтому по ним по ним сложно какой-то вывод сделать вот но по стальным был заполнен и хорошо и можно их проанализировать код из них были пойманы по allure там по метрикам этого то что там говорю про мои ру как инструмента лифтинга метрикам вы были пойманы быстро локализованные проблему бы столько же разрешили команды разработки один из инцидентов был пойман случайно случайно это означает что например разработчик какой-нибудь просто зашел в не знаю кабану посмотреть какие-то логе может быть его что-то интересовало и вдруг увидел какую-то аномалию или там может быть целенаправленно осмотрел в инструмент своими глазками not опять же все-таки случайные вещи который зависит от человеческого фактора так вот и вот если посмотреть на все остальные так вот оказалось что осаго команда их не поймала это что означает что в лучшем случае это было сообщено другой команды которая пользуется допустим сервисами этой команды вот либо в худшем случае это пользователь обратились техподдержку и соответственно узнали мы через очень долгий долгий долгий путь и возможно прошло очень много времени понятно что там вот такое простое может даже измеряться днями самом деле в этом нет ничего хорошего так вот давайте посмотрим если вы вот эти инциденты произошли бы ситуации когда у ребят был бы центре чтобы произошло на самом деле произошло бы следующее оказалось что то что прямо ли случайно вполне можно было бы отследить центре а вот 9 из 19 которых были не пойман и командой они вполне могли быть отловлен и при помощи инструмента центре кажется это здорово но давайте посмотрим что же изменилось с за следующий год сейчас здесь а то уже статистика за примерно последних на полу года то есть это где-то весна лето осень то есть как раз то что попало на вот эту период вот этой масштабной пандемии за это время случилось 19 инцидентов ну тут количество сравнивать думал бессмысленно потому что она зависит от многих факторов можно смотреть про то как с этими инцидентами работали так вот эти из них были пойманы случайно то есть это опять же когда разработчику то то зашел посмотрел это может быть это мониторил важно то что это не при помощи наших автоматизированных инструмент шесть из этих инцидентов 6 из 19 инцидентов не были пойманы команды то есть опять же говорил что это другая команда могла сообщите лев конце концов это пользователи там обратились техническую поддержку вот опять инцидентов пойманы были при помощи метрик и вот как раз уже здесь инцидента были пойманы по ошибкам то есть при помощи инструмента центре это на самом деле уже радует то что инструмент на самом деле приносит пользу но тут важно отметить что ведь не известно о скольких инцидентов удалось избежать все это говорил вначале о том что если появится центре в командах то там 10 15 центов инцидента в принципе в среднем у нас это их можно было бы избегать вообще ну тут сложно сказать о себе такое сослагательном наклонении поэтому мы на это не обращаем внимание а посмотрим а как вот не знаю дальнейшее развитие с инструмента центре может быть там доработка alert of может быть доработка ошибок логирования могли бы помочь команда аналитика показывает что большую часть из этих вот инцидентов еще можно было бы поймать использованием центре ноты с пойманных случайных 2 то есть 2 из 5 все шесть которые не поймали сами команды в принципе могли бы поймать с помощью центре и вот то что было поймано по метрикам внезапно можно было поймать с помощью центре на не просто поймать а время получаться реакции она была бы меньше на самом деле вот эта ситуация бы дафа капа доведена бы просто не было это кажется действительно здорово и есть куда еще расти и как еще развиваться давайте попробуем какие-то выводы подвести вот мы проделать какую-то большую работу у нас там это на протяжении двух лет что-то менялось какие выводы сделали мы это в первую очередь мы как вот строителем проступил сделали такого что в действительности вот инфраструктуру которому делом ее нельзя по умолчанию давать всем команды которые используют я не должны быть к этому готовы вот такой факт с которым просто приходится жить второе то что те изменения которые мы хотели сделать они на самом деле для нас такая вроде кажется не значит незначительными тусит мы доставили новый инструмент ребята пользуетесь в действительности нужно понимать что с точки зрения команд это может потребовать защитно много времени потому что а то что мы хотим это какой-то там работа с технологом еще что то она не вписывается в какой-то там бизнес-план где нужно там закрыть какое-то количество новых бизнес фич и поэтому вот эти изменения они могут понимать в пучине очень много времени и самое главное что вот так просто команда это не смогут сделать и на самом деле нужно помогать нужно там терпеть нужно приходить к ним предлагать помощь с ними взаимодействовать и вот то что уже неск раз употреблял да вот эти soft skills который может быть не очень нравится разработчикам но их нужно прямо здесь вот прокачусь по максимуму и с этим а приходить команды и пытаться им помочь чтобы они быстрее смогли почти до релиза какие-то новые вещи ну что мы все хотим делать чтобы наши продукты были надежные и качественные ну и вот уже много раз отдел отсылки к портам который мы заполняем ее действительности они помогают делать полезные вещи помогают улучшать существующие продукты помогают находить новые инструменты которые могут решить проблемы вот общем это здорово и всем рекомендую но если говорить типа выводы какие то касательно непосредственного центре его то что вокруг него произошло то наверное самое главное это все-таки нельзя просто так взять и использовать центре здесь нужно прям брать и менять полностью подход к блокированию и провести просто огромную работу но это необходимая вещь если вы хотите пользоваться таким инструментом целом и намучились центре это я не знаю тут можно нам тоже на целых докладывать про то проблемные огребали непосредственно с центре как вот именно с точки зрения его эксплуатации ну вот когда вот мы добавили в свою трубу геркулес к нему вроде все стало оказалась вполне неплохо и вполне с этим можно жить и вот сейчас мы в принципе продолжаем развивать центре мы продолжаем развивать команды с точки зрения как раз там работы с ошибками и прочим есть анализируем пока по и попытаемся двигаться дальше дальше делать наши продукты качестве не вот на этом на позитивной ноте я бы хотел бы закончить поэтому всем спасибо за внимание давайте перейдем к вопросам полезно и интересно рубль от исхода где-то чтобы вопрос от такое изумление много говорил о том что до этого были инженеры такие которые специально сидят вот обвешать из кучи кучи-кучи в мониторов и перед ошибка глосуточно но постоянно тем и занимаются что смотрят по графике выискивают там ошибки преувеличивал утрировал или трем серьезно люди так сидели смотреть то что там и привел к фотографии на самом деле это не наши фотографии то из блога другой крупной компании не мне контура вот у которой дествительно сидят и круглые сутки смотрят в монитор и вот у нас мне реально был активный мониторинг допустим момент релизов разработчики посмотрели целенаправленно влоги появились этом ошибки или нет все это прям реально было окей а вот дежурные они 24 на 7 не сидят они смотрят у них все-таки есть вертолет про этот начал рассказывать до этого сидели 10 лет и это не дает такое вообще о нет нет нет нет очень конечно никто не сидел вот поэтому и alert и которую ты зачем такие были попроще вот который на коле ночные там через почту not они были такие что понятно что разработчику на почту уведомления вряд ли будет просыпаться потому что ну не короче не настроен это на почтовом клиенте такие возможности поэтому так как раз от был важен allure think который можно настроить по различным каналам с разным там уровнем навязчивости чтобы вот уж over который я даже телефон беззвучном режиме все равно узнаешь о том что у тебя пришло уведомление он проигнорирует все твои настройки на телефоне это самом деле здорово то есть эти вещи которые позволяют нам командам дом в любой ситуации достучаться до инженеров когда действительно необходимо а потом инженер такой просыпается смотрит блин но что такое data files позитив какого хрена расскажи вот как долго вы шли к тому чтобы соотношение сигнала с шумом привести в хоть какое-то приличное состояние а вот смотри и если говорить в целом за всех кто на среднюю температуру по больнице очень сложно посчитать вот есть те команды у которых в принципе вот сейчас они до сих пор не пользуются центре у них даже у них есть . из команды которых в принципе трафик не ждет еще в центре потому что мы не можем допустить потому что центре у нас треснет он те команды которые допустили они в принципе живут нормальной и у них целом благодаря вот этим рычажком когда-то вот поднять количество этот порог срабатывания allure то нет это настраивает пьют этот по моему занял там полгода из не ошибаюсь действительно это это долгий период потому что тут надо пережить несколько релизов чтобы у тебя там несколько инцидентов прям значимых таких были потому что без вот прям примеров проявления очень сложно понять что вот я сейчас поставлю там 10 ошибок и минуту и мне будет хорошо не так уж не получится у нас с этим есть вопрос из чата дмитрий спрашивает означает ли это что нужно делать так чтобы вырву водились только сообщение которое требует непосредственно реакция инженера если поднимаете инженеров два часа ночи не нужно это значит не error в идеальной картине мира да это ровно так должно быть понятно что на практике это сейчас не так поэтому это я говорил что ошибки которые у нас есть они с некоторым порогом срабатывания ну и в принципе практика показывает что всегда нужно задавать какой-то бюджет на ошибки и котором принципе просто надо смириться из которым надо жить хотя не отрицает что у нас есть команда перфекционисты которые там с нулевым фоном ошибок живот здорова-здорова а еще дмитрий интересуется мы когда на продакшен проводим тесты не внешне пользователям и внутри паровой проводим тестирование видим что может быть или ошибочный сценарий прям или еще что то но ошибки которая возникает в результате таких действий тоже ведь будут проходить через все стандартные операции они будут принимать инженеров вот как сетевой то есть это все должно быть или нужно как игнорировать вот это кстати очень прикольный сценарий и действительно о нем 100 стоит поговорить вот смотрите если мы делаем какие-то тестовый сценарий мы в принципе это делаем либо с какими-то тестами пользователями либо мы как-то иначе можем сообщить нашей системе что это какой-то такой проект программы тестовый сценарий это означает что мы можем наши ивенты снабдите каким-то полезным свойствам допустим там use ради которой тестовый а в уже непосредственно в лентах мы скажем что вот идентификатор вот это он должен быть равняться тому то тогда вот alert и допустим не надо отправлять либо отправлять но допустим в отдельный слаг от допустим сидят релиз менеджера или там знаки строчки еще кто-то это подводит водка такого вопроса вот получается вы пытаетесь какой-то контекста захватить из тех ошибок которые центре вам выдает насколько во первых широко вы можете захватывать контекст и и куст кастомизировать его во вторых насколько вы можете привязать к какому-то up stream контекста типа вот есть у нас несколько микро сервисов от одного приходит запрос в другой может быть еще по цепочке в 3 и контекст и с первого например с помощью центре вы можете как-то заходим вот это кстати хороший очень хороший вопрос у нас одна из команд на 1 из коробки там в центре мало что можно сделать надо все там затачивать что сделали в одной из команд они написали расширение к хрому которые при открытии страничке сн3 просто хочет хтмл который есть составляет ссылки на другие инструменты и ты просто открываешь и ошибку в центре нажимаешь ссылку которая добавил расширение коробы переходишь в другой стороны допустим увидишь пассировку целиком всю или там увидишь налоги которые относятся ко всей вот этой трассировки по всем всем всем сетевым взаимодействием что ты мог уже по ней как-то дальше работать а трассировка вы через что настраиваете какой инструмент здесь вот как раз вот если там вернуться история о том как у нас все это возникало здесь у нас собственный инструмент вот этот труба от это огромная труба через которую нас все и вся телеметрии идет этого столько восток геркулес там как раз у нас и трассировки все прочее а там уже дальше и соответственно а фишка умеет правильно давать кировке есть веб морду который можно зайти и построить дерево от рисовать дерево запросов там провалиться там в нужный span посмотреть что в нем произошло и вот вот это все не то что там какие-то инструменты у нас раз мы их делаем сами то есть понятно что там усилие не как у там большого комьюнити но это продолжаем развивать там появляется новый инструмент вот допустим недавно сделали штуку которая позволяет идентификатору трассировки получить все блоги которые у нас есть во всех индексах elastico у нас там десятки команд в разные индексы пишут прошла конкретно ошибкой можно пойти собрать эту всю информацию очень прикольная штука вот вот и о том сейчас пытаемся подавать команду чтобы они начинали этим пользоваться это даже в и восхищает андрей интересуется каким инструментом вы умудряетесь поднимать из на инженеров у которых беззвучном режиме телефон говорил слушай это прямо да да вот я сам пушером не пользуюсь я вот как это говорю со слов разработчика с которыми я говорил что да не пользуются паша миром и и вот он умеет и довольно агрессивно доставлять уведомления я не против и продолжают этим инструментом пользоваться можно могу добавить в почете например там на андроиде он прямо стоит средствами операционной системы может указать что приложения добавить в исключения и если ты в режиме не беспокоить это все равно делать аборт нас кстати эта фича не работает по крайней мере последний раз когда я пытался это включить не получилось и поэтому если держал того чтобы его включать вы добрее и были быть другой обязательно приходила такая подстава ? те кто дежурит они код разрабатывают или они только дежурят нет у нас как правило люди которые пишут код а ниже дежурю то есть у нас такая рада но я не буду сейчас говорить за все все все команды контура потому что там сколько частом 80 наркоман час примерно сложно сказать то есть вот за тех ребят про которых я знаю но у них идет ротация у меня даже в принципе ума инфраструктурной команде то есть я и подпишу и периодически же дежурил часто сам для меня неделя дежурство вот на 10 а мы сейчас ведем с вами диалог ничего не сломается и не взорвётся у меня все уведомление отключены никакой пушенко мне не продаются потому что мы его не используем в нашей команде т.к. если это случится какой у вас протокол работы у вас есть какой-то запасной дежурный если первый не проснулся этот доклад сидит читает но обычно это как но опять же это все в разных командах по разному то есть там праймари дежурный backup дежурный вот видно у меня не очень большая команда и здесь ты просто если не можешь кого там дежурит и просто в чате к там бросаешь ребята вот я там пару часов меня не будет пожалуйста подмените сознаюсь я сейчас забыл это сделать но я вчера ребятам предупредил что я буду за нет уже быть они как-то сами догадались все-таки человек это такая сложная нейронная сеть которая может вроде понять что нужно что дальше делать с этим по ночам кто дежурит то есть ты же дежуришь по ночам или я специально обычные люди но вот короче зависит опять же от размеров команд есть команда которая чем большие и у них ротация такая что ты грубо говоря там дежуришь может быть очень-очень редко там типа одна неделя там может быть в полгода вот это в принципе можно севиль там по пополнить или ли ребята дежурит там то есть пол недели ты дежуришь наполнитель кто-то другой потом у нас еще энтеритом так далее так далее так далее вот а так саунда получает что ночью принципе ребята реагировать но на самом деле он на моей памятью ночью у нас проведет на моем про активов вроде бы как бы было но там был кто-то другой дежурный друга посыпался мне короче везло на самом деле во всяких больших корпорациях у которых много офисов в разных географических локациях можно вообще устроить ротацию того что вот 8 часов скажем где нибудь в европе 8:09 в австралии команда дежурит 8 часов где-нибудь там в штатах и у них всех это просто рабочее время и они передают дежурство следующей команде и никому ночью и даже в нерабочее время дежурить не приходится это прям так удобно но нужно иметь конечно серьезно распределенную географию до этого мода так нам тут значит в чате нет вопросы пишите конечно будем сдавать у меня вопрос по докладывал плечо возник и гриша рассказывал про случай когда ошибка reprice и успешно проходит вот скажи пожалуйста какой твой совет как-то подобных случаях нужно писать мы сделали единичный запрос он упал а нам что не вашей пописать а когда же может куда запишется смотри у нас получается зависит от того как кот устроен то есть у нас есть эти библиотеки которые там умеют понимать там где патентные запросы не до патентный можно ли тратить нельзя ли правительство ну довольно сложная логика и как запросы делать некоторые запросы можно там делать параллельно может некоторым надо там следовать некоторым можно чуть-чуть подождать отправить короче там логика она может быть очень сложно вот конкретно у нас сама как выглядеть что делается запрос когда реплики если она ну пусть sequence шел до этот последовательные запросы вот получилось ошибка от нее мы ее как ошибку нила героем делаем еще одну запрос другой реплики если там завершилась успешно там и в конце просто никакой error не делом а если у нас все все все наши попытки закончились не успешно мы тогда и лагером как р а вот и вот здесь уже как раз вступает в дело вас error badge то есть мы смотрим по количеству ошибок которые возникают если и было много alert нужно делать если их было не очень много туалет соответственно не надо делать то есть это в двух местах получается настраивается во первых на стороне источник ошибки там есть какой-то retrieve сначала попробует поделайте только если не пойдет только тогда будет писать во вторых есть какой-то tracking бюджета оон где происходит на стороне этого геркулеса или где-то в центре встроили нет вот конкретно по к срабатыванию о какому-то порогу это в центре то есть там просто есть отдельный раздельщик в центре где-то маша лет lectus настраивать и там ты можешь сказать как часто даже на талии на ошибка при этом на самом деле язык он не очень богатый там ты можешь сказать что вот у меня вот это вот это вот это вот этой вот это должно выбрать либо что-то из этого исправил поэтому там приходится вот таких вот если нужно тонко настраивать их очень много отдельных alert улов делать их очень сложно короче и перемешать между собой в целом это можно сделать справедливо и тут тут поясняющий вопрос мы говорили что alert и появляются из ошибок и сыграв а из вольных гафин фонды багов и alert и поднимайте в общем смотрите вот у нас сейчас количество ошибок который приходит его уже вот так вот в центре хватает если честно еще больше она начинает уже там трещать новость игре там мы когда пробовали это делать это большое количество из мы прям ограничили и жестко что выше уровня которые более слабый чем r мы в принципе в центре не отправляем понятно что зла можно и вардинге отправляйте в принципе там даже стандартный клиент центре позволяет выбрать это и можно это сделать но нет мы такое не делаем конечно тогда нам станет еще больнее в разы просто тогда да вопросик вот ты говорил про количество ошибок которые отправляемся но ни разу не говорил про их размер вы коктейль имитируете размер текста сообщения стектрейсы которого отправляете в самую систему или у себя внутри обрабатывать два часа на память не вспомнил вот по моему чудо каких-то последних обсуждений что-то было порядка 64 килобайта размер одного такого файла до вот этого события который попадает центре этот текст от этой ошибки в этом их максимально насколько знаем об могу ошибаться у нас там вроде бы особых таких ограничений это про центре я даже часы не вспомнишь ли честно нет не помню короче моря володина вопрос сразу же дали то что в ветаптеке флешбэк смешную историю добавлял marling ненене про spring но про размер stack trace а мы я флобер и долгое время работал и мы там тоже делали пьем которые ошибки захватывает и так далее и у нас была такая проблема что нам прилетело ошибках гигантский просто стыков не знаю на сколько строк там но мы начали его обрабатывать парсить рекурсивно и схватили stack overflow рпк пытались в работать этот гигантский стык save мы в итоге раскрутили рекурсии и все стало нормально ну да это прямо жизненное проблема ну да я просто как раз почему про spring вспомнил что счет spring дворкович потом как бы прокси прокси prox погоняет фокси и там еще все это завернуто еще во что-нибудь просто космические станции но я участник него это вот это чтоб года два назад и это мужьями ты сейчас сейчас на него еще так на самом деле интересный вопрос а что сообщение складывать потому что у меня в опте был случай на стыке ваббаджек а и я java и я один какой-то версии и когда еще не но джавадян 4 когда еще не было cost buy for blood и что тогда делала спецификации пикассо говорил ну давайте все массаж складывать в итоге у нас на серверах out of memory возникало когда ошибка пытался распечататься 50 мегабайт на фиксацию на это вам не шутки можно discussion зоне бы там съесть как и что но имел такой восход и я такой всем разработчик пишу ошибку ну типа лог что-нибудь и она же может устареть бывает такое что сообщи ошибка говорит об одном а по факту код уже немножко поменяли он уже ничка другой и асад с начала которые смотрят на этот лог он двс не хватило collection в воде а на самом деле совсем не то от вас такое было и как с этим боролись я почти уверен что такое происходит потому что проблема этом актуализации логов и с кодом она как бы вполне естественно и часто встречающийся но каких то таких ситуаций как типа с этим бороться но с ходу не придумаю если честно а если я вот как разработчик пишу невозможную ситуацию на все знаем кис-кис-кис дефолт невозможная ситуация вот в этой дефолт метки нужно ли какой то там развернутая сообщение писатели достаточно сказать но без параметров ро вася шнирер ситуация недостижимо уход вообще вот без фото контекст и мне кажется это очень очень плохо делать и опасно потому что not a ситуациям когда такие возникают ты примерно сталкиваешься с такой штукой что без того чтобы зайти в код и посмотреть а какая же эта строчка кода и что там произошло не разобраться и кажется что если уже влоги есть достаточно необходимой информации то чтобы понять где конкретно проблема намного более большой плюс карму того кто писал лак соответственно в данном месте мне сразу приходит в голову очень мудрое изречение который мне один раз ты сказал старший коллега по работе когда я писал логия и он на мои ноги посмотрел такой курит хлеб когда я пишу логе я задаюсь одним вопросом кто их будет читать и в какой ситуации вот если задаваться этим вопросом каждый раз когда что-то пишу выбирать логировать и понял что да действительно зачастую очень полезный может быть в будущем я буду читать эти логе в ситуации того что четыре часа утра нужно срочно что-то починить нихрена не понятно поэтому нужно позаботиться о ближнем своём причем самое главное что на самом деле ты заботишься не только о ближнем своем скорее всего ты будешь заботиться о себе будущем и это тоже давайте позаботимся сия будущем и у меня такой вопрос глеб что ты думаешь про реестр ошибок и чтобы добровольно-принудительно каждую ошибку снабжать каким-то кодом ошибки которая будет уникальные в рамках всего проекта всех компании всех по понятным но это не так просто во-первых потому что вот так решил поминал своем докладе про группировку ошибок и потом тому как можно какие-то паторны выбирать мочить их и так далее но автоматически это сделать вообще очень не просто значит здесь где-то должно быть человеческий фактор который будет выбирать какая ошибка к чему относится какая у них группа и так далее и ты там и там будут разного рода ложное срабатывание значит либо не до группируем и будет там триллион ошибок у нас такое тоже было потому что в теле ошибки какой-нибудь идентификатор был который держит вместе и фига комната миллион разных ошибок которые на самом деле одни и те же можно группировать и из наоборот тоже может быть случайно сгруппировали то что не является одним и тем же и может быть какое то время когда системы были такие более ну не то чтобы простые но монолитные с очень строгими правилами исполнения типа когда ошибки ворот ли они вроде как приму для них есть реестр и по коду ошибки в более-менее можно понять в чем дело наверное а вот современном мире каратов двадцатка микро сервисов цепочку связывается бренда там комбинаторный взрыв какой реестр ошибок примерно так и кто-то хочет ведь здесь как раз оспорит особо-то не ищем здесь все так все так такой момент хотел уточнить вот у вас есть получается центре из него приходят новые ошибки и на них ольмерта и при этом есть еще наверное какие то другие источники например не знаю мониторинг того что на диске достаточно места там циpкa и все такое вы каким-то образом вот все это вместе каком-то месте вместе вместе интегрируйте штаны я понял я понял вопрос посмотри у нас получается вообще исторически получила что основным инструментом работы с такими налетами было мойра это отказ alert и по метрикам вот и там ребята кто-то даны давно сделали продукт его закон sorcery и еще своим пользуемся то есть у нас учатся точки за ними ты казашек завязан на стыке графита вот и у мэра на в принципе таким основным точка входа центре получаться является вспомогательной . вход когда alert именно от центра идут понятно что основная масса вертов она именно от идет этот метрик вот и какого-то сквозного такого взаимодействия между сервисами на данный момент нет возможно вы когда нибудь построем какой-нибудь свой космолет в котором можно будет сразу все все все все получить но пока не знают она вроде бы на данный момент нет вот этот по поводу вот этой штуки вообще на самом деле я вспомнил класную штуку вообще ведь на самом деле у нас эти ошибки бывают не только в бэг-энде а бывает еще по фронтэнда ошибки и вот тут-то самое интересное начинается как вот их собирать и там как раз группировкой на самом деле все еще хуже вот я с ребятами когда разговаривал на самом деле вот на плате цедента вот как раз концерна там пробыла в первой половине девятнадцатого года то что вот сейчас происходит двадцатом году этот я с ними общался и у них есть много еще фронтовых ошибок или мед и они их собирают с использованием своего собственного бэг-энда то есть у них получается лог с браузера попадает в их and point на их сервере там обогащаются нужным контекстом и дальше они уже стандартной трубой отправляют нам уже логе ну как обычные бакан блоги и вроде бы все хорошо вот выяснилось что группировать ошибки с фантов очень тяжело почему потому что во первых там стектрейсы с русским текстом мы находимся убрать да мы находимся в россии вроде бы все нормально спектр с английским текстом на какой-то стандарт да все нормально хорошо так вот иногда встречается stack trace с французским текст отказалась и все остальное дофига да да да да и вот с этим как раз очень тяжело работать как раз приходится придумывать и изобретать это про что говорил как раз то что надо китая там реестр ошибок придумайте прочее и там классифицировать их как то вот ровно вот этим ребята занимаются у них там классификация ошибок они когда получают ошибку на быка с фронта не сможет ага crochet этого суда и от так вот обогатить таким контекстном это таким контекстом это вообще не ошибка ее надо выкинуть и так далее там же ведь фронтам может не знать зациклиться какая-нибудь фигня на в комнате интернет эксплорер и упаси боже дай всяко можно быть идет друзья давайте переходить и в дискуссионную зону потому что это можно продолжать вообще бесконечно большое спасибо гриша большое спасибо володя и приглашаю всех внимательно прослушайте поболтать в discussion ки ссылка уже внизу по программе у нас дальше два коротеньких доклада можете посмотреть их"
}