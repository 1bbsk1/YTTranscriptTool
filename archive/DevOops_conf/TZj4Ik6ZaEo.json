{
  "video_id": "TZj4Ik6ZaEo",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "у а здравствуйте все еще раз меня зовут дмитрий столяров как вы уже услышали от алексея ну или не от алексея а знали до этого я уже 11 лет я являюсь техническим директором и учредителем компании флант и сегодня я буду говорить на необычную для меня тема потому что почему-то меня начали ассоциировать с исключительно там с докером иску берн эпосом и люди мне говорят что я какой-то евангелист губернатор это совершенно не так и я в целом все это конечно же просто усилит и которыми мы пользуемся для того чтобы добиваться наших результатов поэтому сегодня доклад на тему вообще никак не касающуюся дольки раз cobranet сам ну конечно же мы закончим в докер искупит в купе red оси как как как не закончится давайте быстренько определим скоб для того чтобы все понимали потому что доклад называется там десять лет он колчева мы научились скоб у него вполне конкретный есть куча тут приведены там и один процент не приведет способов как можно что-либо за мониторить я буду использовать жаргонные слова постоянно мониторить но мы все понимаем примерно что такое за мониторе так как какую-то какую-то какую-то информацию получить и послать есть куча системе есть классические типа zabbix на с прометеем есть еще более классический типа скрипта в кроне скрипт в кроне который что-нибудь проверяет и шлет alert это самый-самый самая лучшая система мониторинга и вот все вот эти вот штуки они шлют и шлют что-то и это что-то нам нужно научиться обрабатывать причем нужно научиться обрабатывать так чтобы так и все что не надо там обсыпалась остановилась да ну то есть вот освоить вот этот скилл у неё по по остановке alert of или ну так же круто и без без усилий на лице да и мы решили все вопросы вот доклад на самом деле о том какие инструменты нам как компании флант с достаточно специфичным контекстом пришлось придумать для того чтобы ну максимально приблизить приблизиться к возможностям то есть мы вот доклад нам на 80 процентов посвящен тому как alert и летят и что мы делаем с тем чтобы они чтобы с этим справиться ну и на остальные 20 он посвящен различным культурным и организационным историям которое нам как компании флант пришлось применять за нашу историю важный момент у нас достаточно специфичный случае мы берем ответственность за чужую инфраструктуру и и переделываем и мы отвечаем за то чтобы оно было доступно и соответственно для нас вообще там обработка alert of обработка инцидентов это одно из одна из ключевых вещей дай поэтому мы я не могу сказать что мы там компания 1с лет мы все 11 лет занимались обработкой alert of улучшали нашу систему данном и как возвращались безостановочное безостановочно к этому вопросу итак поехали начну я немножко с предыстории с того что было у нас 10 лет назад или 11 лет назад то есть сейчас на календаре у нас давайте будем считать 2009 год тогда в компании было несколько человек я не помню сколько неважно и на самом деле alert и приходили все на мой личный мобильный телефон я был единственно человеком который поднимал телефон смотрел что произошло и шел чинил нюансы бен все это было не так страшно потому что мы не пытались сладком alert и по какому-нибудь заканчивающимся диску или еще что-то там был исключительно бизнес monitoring the business высокоуровневые это были некоторые кроны которые проверяли что что-то важное точно работает если она не работает приходило sms к.а. понятно что система жутко примитивная но на самом деле на наш масштаб там 10 лет назад прекрасно работала время шло являлись новые проекты появлялись новые задачи и в какой-то момент я осознал что я не знаю немножко такой интимный момент я не знаю просто кто в такую станцию попадал и осознаешь у меня просто страшно просыпаться утром и по той простой причине что я боюсь увидеть mobile 600 например непрочитанных информации но есть нет на самом деле это жутко депрессивный момент потому что ты б а время один из утро ты просыпаешься в один с утра почему ты просыпаешься в один с утра ну вы знаете почему и на тот момент мы эту ситуацию решили очень кардинально я сказал что я больше не буду это делать 1 и давайте делать это по очереди и соответственно не дело в том что тогда уже там была в компании тип человек 5-6 и когда уже ты это делаешь раз в неделю это уже не так то есть это это некоторая отсрочка нормально и честно и рассрочка опять время шло я никогда не называю на там 10 11 не важно количество проектов росло количество людей работающих компании рослова и в какой то момент мы докатились до того чтобы о чем мы будем сами посмотрите смски давайте мы попросим кого-нибудь другого смотреть эти эсэмэски мы их ещё причем называли тогда не allure to my arms коми по каким-то причинам видимо смешно пошутил там люди смеются да да да дошло окей значит и мы сделали первую линию даже тогда году в 2010 когда мы это делали я буду врать годами на неважно мы понимали что это неправильно она что-то неправильно нанимать там специальных людей которые будут читать эсэмэски обрабатывать их но мы так сделали кстати тоже такие как бы забавные моменты данного вот и когда один дежуришь эсэмэски alert и приходят тебя когда у тебя появляется второй человек нужно сделать очень серьезные фактами по всего мониторинга какой правильно у вас было несколько точек из которых все это слабость его все это сладость какой-то ящик или в какой-то в какой-то номер телефона нужно теперь переделать так чтобы ты осталась в одно место и можно было переключать в общем все вот эти штуки мы сделали в какой-то момент у нас было даже мощнейшая система назывался журнал эсэмэс там были значит записи и был человек который смотрит в записи и типа если что-то часто начинает появляться он звонит уже настоящим дежурный говорит ребята тут какая-то эсэмэска часто приходит что-то не так это это жуть на 0 2010 год все все все нормально было но как бы смех смехом шутки-шутками а время шло и у нас к тому моменту уже в компании ровно было человек 30 и реально была первая линия которая работала и осуществляла я таки это сделал осуществляла начальную диагностику alert of но инженеры настоящие все больше и больше жаловались то что первая линия ничего не делает а первая линия было все больше и больше узнать тем что а сколько на нас специалистов и давайте я немножко пройдусь по тем штукам которые мы сделали которые мы осознали вот в этот период и и и что у нас из этого получилось ну во первых я сейчас быстро очень побегу идея номер один с нашей точки зрения ни в коем случае нельзя слать alert и разными путями да они все должны стекаться в одно место чтобы было где посмотреть в одном месте и проанализировать это очевидно лежит на поверхности точно так же в этом центральном месте должна быть возможность ну куда то заворачивать alert потому что но иначе мы не сможем организовать никакой дежурстве иначе мы не сможем пошарить эту ответственность в итоге пошарить ответственность за ну за обработку этих вещей очень важно по поводу транспортом и для себя пришли что мы для себя пришли к тому что электронная почта но совершенно не годится для доставки alert потому что вы ну как бы если вы шлете alert в электронную почту скорее всего вы их не читаете то что они не приходят своевременно мы пришли к тому что эсэмэски тоже жутко не подходит потому что с ними там другая проблема очень сложно найти ту тонкую тонкую тонкую грань когда это сообщение уже стоит там обычно или спам или ничего не приходит до ну то есть вот и найти вот это пограничное состояние ну практически невозможно слатина лир ты в группу в телеграме элиф канал с лайки тоже не годится потому что там коллективной ответственности непонятно кто за это отвечает плюс там нету ну механизма там структурировала поиска то есть с нашей точки зрения обычный способ существующие способы транспорта они просто не годятся для alert of и мы в итоге там сделали какой-то свою систему которая получает alert и и человек в ответе с ними должен нажать кнопочку я увидел я этим занимаюсь если он не нажала его уже начинают доставать по по другим каналам но опять же я обращаю внимание что у нас у нас было волны волнами на доклад называется он кол но у нас почти всегда была первая линия которая сидела за компом и обрабатывала alert и осуществляла некоторые фильтр но я подойду к этому еще чуть позже еще важный момент alert это не в коем случае не текст если вы ждете строчку с какой-то ошибкой то это скорее всего не работает мы как-то эволюционном тоже к этому приходили мы сначала к строчке добавили там сервер потом к строчке добавили какой-то там все верить и потом там еще дополнительные дополнительные поля и постепенно обогащая и пришли к тому что мы убрали текстовое сообщение изолента и у нас больше вариантов вот ее то есть на это некоторая сопроводительной информация основа это лейбл и вот еще один очень важный момент который ну у нас ушло несколько лет на то чтобы его до конца осознать инцидент ни в коем случае не равен allure туда потому что alert эта информация ну это это сообщение о проблеме то есть на нам сообщают что вот есть проблема а инцидент это самая проблема и разумеется инцидент может содержать много сообщение об этой проблеме с разных сторон и мы долгое время ну рассматривали отдельные alert и он долгое время не знаю там году в 2013 и по моему только я не буду знаками говорить когда мы начали объединять alert и в инцидент им как в один объект мэйбл и лейблы лейбл лейблы особенно с приходом куба вся идентификаций а ну должна быть построена на лейблах я думаю что киева лейбла не надо никому объяснять что это такое потому что все уже куб используют так или иначе то и если у вас alert приходит там от от сервера от физического то окей там все просто в лейбле написано название сервера если он приходит про какой-нибудь time on set то там наверное названием space advanced и так далее а интереснее это была некоторая такая очевидная часть да вы ни ни ни ни ни ни в коем случае не засыпайте не пугайтесь какие бывают alert и мы пришли к тому что есть два очень четких типа alert of это мгновенное которые говорят нам о том что что-то пошло не так очень характерный пример backup не прошел мы знаем когда он не прошел это это мгновенное сообщение или там уведомления от какого-нибудь дата-центра о том что ваши серверы будут отключены через 24 часа если вы наконец-то не заплатите денег это же тоже alert мгновенный а есть alert и длящееся я сейчас буду какие-то такие достаточно простые примеры но места на диске заканчивается она начала заканчиваться во сколько-то и и потом поскольку там у перестала заканчиваться даю этого у этого allure то есть время начала время конца с нашей точки зрения есть три разных протокола которыми вот эти длящееся alert и можно доставлять и самое очевидное это сообщение каждое не знаю 30 секунд или каждой минуту место заканчивается место заканчивается место заканчивается место заканчивается место заканчивается вместо заканчивается как только перестал это штука приходить это значит что места типа перестала заканчиваться и или или что или место закончилось и мониторинг вдох и больше не может слать и поэтому есть как бы второй вариант который говорит о том что два только сообщения место начала заканчиваться а потом место перестала заканчиваться у него тоже есть проблема что она требует от клиента гарантии доставки и соответственно нужно писать каких-то сложных клиентов которые нам смогут гарантировать доставку есть третий вариант место начала заканчиваться место все еще заканчивается все еще заканчивается все еще заканчивается потом в конце место перестала заканчиваться это самый такой простой вариант и у мгновенных у нас нет никакого состояния есть просто факт происхождения а у длящихся у нас есть состояние ну и в зависимость от протокола которым мы получаем эти алерта их может быть или два или три то есть он горит не горит состояние али рта или горит не горит и не знаем не знаем почему потому что когда у нас вот такой полный протокол до места начала заканчиваться место заканчивается место заканчивается потом пропал когда пропал когда он не сказал когда нам источник события не сказал что место закончилось это вот некоторые третье состояние о новом соответственно мы поняли что он уаль артов есть черт побери состояние и что для того чтобы получать alert и нужно обязательно использовать протокол который понимает вот эти вот состояние еще один момент дедупликации у кого-нибудь было так что было солер то мигала так загорался или газ собирался газ загорался газ ну это как бы нормальное состояние то есть это не нормальное состояние но все понимают что это достаточно частая штука и с учетом того что мы используем лейблы как у них набор лейблов это уникальный идентификатор alert а то мы с удовольствием все alert с одинаковым набором лейблов мы объединяем в серию альтов да и получаем что у нас не то что там что-то сломалось починила сломалась подчинялась что вот у нас есть группа событий до ломалась чинилось сломалась чинилось сломалась чинилось вот когда мы это сделали нам как бы ну достаточно большой кен был от от того что просто мы мы перестали это делать то что вы же делаете все люди которые шлют alert и в почту делают это сами в своем мозгу да и листья тех кто шлют alert и вот сыры и в чате в телеграме да вы же делаете это в своей голове вы смотрите аромат вот не работала или идете в графике а мы склеиваем я бы хотел немножко показать как это выглядит интерфейс очень быстро вот это вот некоторая шапочка allure то и тут прошу прощения это шапочка это инцидент в котором есть alert и в данном случае их 7 штук ну на экране видны только два но вообще их там 7 где-то там ниже и у инцидента есть лейбл и и это лейбл и общие для всех это тело и бы которые являются общими для всех внутренних элементов то есть лейбл trigger есть у всех внутренних али артов и лейбл губернатор есть у всех внутренних alert of или бы и лейбл примете есть у всех внутренних alert при этом у всех внутренних alai oli артов лейблы губернатора мита имеют одинаковое значение алой был 3d триггер имеет разное значение на ими соответственно посмотрев на инцидент можем сразу понять что там внутри глянули одним глазом и уже понятно что происходит ну а у оли ртов но в данном просто отображение показывается уникальная часть да то есть вот у этого allure то есть еще какие то там дополнительные лейблы которых нет у других alert еще интересный момент это вот мгновенный алерта который пришел один раз он там говорит мой скрыль там файл что-то там что-то там ну и он еще плохо они он неплохо сделан он там просто 1 а вот это уже проблема которая произошла 18 раз первый раз она произошла в час ночи последний раз 1800 и между этим еще 16 раз есть это мышкой навести она покажет конкретные периоды то есть мы как бы не делаем это вручную а на самом люб люб люб люб люб и собирается вот то же самое но только здесь alert и длящееся и смотрите первый раз у нас эта проблема это пятисотке на инварсе больше десяти процентов она была там с 15 0 9 до 15 13 последний раз там составить это досталь кита и вот между этим оно еще было восемь раз то есть вот такая вот группировка здесь показано состояние а но он alert горит желтый со мной что-то не так может быть плохо может быть хорошо но со мной что-то не так красный парень почему почему окей не зеленый почему ok серый ну как бы первое первое желание хочется к желтому красному зеленый добавить но ведь проблема была это не то что сейчас все хорошо то есть это же был инцидент он когда-то горел он он не зелёный он он просто сейчас не горит на то есть это не не не целый дом а это у нас возможно отстав от нома он уже больше не горит но вечер побери проблема была окей это вот некоторая некоторая база которая ну с моей точки зрения для нас было некоторым необходимым таким шагом потому что вот как только мы все вот эти штуки сделали мы смогли обрабатывать инциденты совершенно там в другом объеме обрабатывать олег то совершенно в другом объеме с гораздо меньшим количеством проблем то есть автоматизация все понимают еще несколько моментов я бы хотела отразить с моей точки зрения важных вот смотрите если уоллер то есть статус горит не горит инциденты это уже почти ticket и и у них есть некоторый рабочий процесс причем основа этого рабочего процесса она мне кажется она у всех одна всегда да это треш медицинская сортировка выживет не выживет надо заниматься той см и первое что мы сделаем мы принимаем решение надо ли этим заниматься прямо сейчас вот сию секунду стоит ли эта проблема вообще нашего внимания сейчас и соответственно или в неотложку или в на сделать ну и можем сразу закрыта типа если это неправда у нас процесс несколько сложнее я не буду его рассказывать но коснусь его ключевая ключевой point тут следующем что если вы начали всерьез подходить вопрос обработки инцидентов то конечно же каждый инцидент должен быть некоторым секи там который имеет некоторый жизненный процесс некоторый рабочий процесс который соответствует вашим там требованием вашим нюансам но ни одна ticket ная система не рассчитана на то чтобы обеспечить гарантию доставки потому что если вы вдруг если кто-то завел тикета его увидели не сразу обычно ну от этого там не то что люди не умирают до но у ticket ных систем не стоит там 1 списке важности задача обеспечить гарантию доставки информации того человек который должен получить просто такой вопрос не стоит мы были вынуждены сделать так что как бы вот факт того что человек увидел инцидент для нас является очень важным и мы требуем чтобы наши дежурные на первой линии могли смотрели инцидентом через десятки секунда если в течение минуты человек нажал кнопку что я это вижу я этим занимаюсь я еще не знаю что это такое вообще не знаю что это такое я не принял решение поэтому но я увидел я получил я этим занимаюсь еще момент вот вы когда в кити меняете исполнителя он подтверждает что он согласен с чем что поменяли на него вот ну очень-очень я не видел ни одной готовы система в которой вы меняете исполнителя там вы чертите это система которая придумана для того чтобы это сделать то есть идет смена исполнителя должно быть подтверждением вот как эстафетная палочка да это тоже не который некоторая основа ok я бы вернулся к нашей истории и вот когда мы все это сделали все стало сильно лучше то есть у нас возможно пропускная способность по тому сколько мы там инцидентов можем обрабатывать насколько хорошо у нас ушли все детские проблемы до главное мы перестали что-либо терять то есть проблема что мы что-то упустили что-то не заметили что-то забыли что полностью и на глаз раз в пять мы увеличили пропускную способность просто мы каждый год примерно в два раза вырастаем и мы там два или три года вырастали x2 имея все тех же людей весь тот же все то же количество сил которые это обрабатывают то есть вот внедрение этих измененном позволило там значительно постели и убрать детские проблемы значит но через два или через три года мы уткнулись опять в ту же самую историю в которой были до этого опять наша уже тогда первая и вторая линия потому что мы поделили обязанности у нас получилось две линии поддержки не успевает ничего диагностировать и по сути занимается одной единственной вещью она берет инцидент игры ой что-то произошло и звонит кому то или нет а это у нас всегда ломается мы на это не будем мы подождем пока она сама от отсохнет или как пройдет и как бы проблема которая культурная организационная проблема которая лежит в основе никуда не делась данном уперлись просто в новый в новые capacity в то что больше дальше не можем и тут хотелось бы переключиться копчик разным схемам организационным которые мы перепробовали но прежде чем к этому переключаться я бы хотела рассказать еще о нескольких штуках которые с моей точки зрения они не такие очевидные вот как как то что было до этого да но они важны и и нам ног чудо ли значит во первых вот смотрите слова инцидент она у всех вызывает достаточно негативное внутренние ощущения но суть эквивалента слову пожар вот если вам говорят сейчас что-то горит там не знаю вася мы горим вы как себя чувствуете отлично но проблема в в случае с пожаром всем понятно что нужно взять огнетушитель и потушите пока ты не потушить что не может ходить с инцидентами с моей точки зрения все дела все обстоит чуть чуть не так и бывают очень часто случаи когда инцидент он такой полу потушен или какие-то первые меры приняты а дальше от нас ничего не зависит вот все кто мне кажется это очевидный момент я могу сейчас ходу примеры приводить сервер сломался ему надо заказать новый диск мы давно не занимаемся там серверами но тем не менее да это же ну как наглядный момент новый диск уже заказали на этом сервере там было был была одна из реплик поэтому ничего страшного он может полежать что там сколько сколько-то дней диск едет но вот в это время мы же не будем идти исправлять во всех там я не знаю про миссиях еще чем-то да alert и или ну это это достаточно трудозатратно у нас продолжают сыпаться сообщения о том что этот сервер там недоступен потому что какие-то реплики на него не доступны там пачка лерд и у нас получается так что у нас висит инцидент что-то горит и долгое время мы ну та ну мы же все сделали как бы нового горит и горит очень сильное психологическое давление очень сильную деформацию это штука вызывает потому что когда у тебя горит три вещи которые на самом деле не горят а приходит 4 отношения к ней уже такое это еще одна вещь которая горит ну и что несмотря на то что по факту человек знает что все остальное там подчинена все остальные вопросы решены и ну способ борьбы с этим очень простой надо идти вот полу полу потушен и вещи убирать в тот момент когда мы их убрали правильно убрали очень но с моей точки зрения там очень большой результат был я это называю умный игнор и выглядит это нам очень просто отложить инцидента и можно указать на сколько на три часа на 6 часов мы знаем что у нас предложение рестарте со мы знаем что она рестарта раз 15 минут из-за того что там бака мы знаем что у нас 20 реплик и что это почти никак не эффекты пользователей там ноль один процент 5 соток из-за этого и вот у нас есть два сообщения два лифта restart и и пятисотке и инцидент о том что приложение иногда рестарты со мной это не аффект мы поговорили с разработчиками сказали ребята они говорят да бага есть пофиксим следующем релизе следующий релиз следующую пятницу отложили до следующего до после следующего понедельника и значит если все хорошо скорее чем мы поставили галочку обработать если если инцидент будет о'кей если в тот момент когда настал час икс все окей тон про сам закроется и мы бы никогда не узнаем а если нет он всплывет в обработку но тут теперь смотрите мы самый стремный момент в этом инциденте было информа было лет про пятисотке а вдруг наше приложение начнет 500 не ноль один процент а 20 процентов а мы об этом никогда не узнаем потому что это будет все в том же в том же и ну там циферка поменяется и тока чему мы пришли мы делаем разные alert и на разные уровни с разным там сверить я еще по сибири типа говорю ну грубо говоря там 01 процентов тепла к 5 процентов это варнинг не знаю там больше десяти процентов от a critical и если в инциденте один из какого-то изолятов увеличивается с и верите мы считаем такую штуку существенным изменениям и инцидент всплывает автоматом состояние которое требует принятие решения человеком человек смотрит у него там галочкой показано что вот эта штука поменялось вот здесь был все верить такой-то kong 500 и 0 1 процента до 20 процентов побежали чинить ну какие то меры принимать вот возможность умной игнорить дала очень много еще немножко конечно же мы о господи мониторинг мониторинга вообще любимая тема а кто-нибудь знает почему там граната нарисована потому что это на самом деле самый простой механизм batman свеча до что когда вы вытащили если вы отпустите гранату гарантировано об этом узнают есть если с вами что-то произошло более человека любимый пример это водный мотоцикл когда вам на руку надевается такая веревочка ключу да если вы вдруг с него слетаете он не уезжает он глохнет а это вот там классические классические средства batman свеча тут ведь ну как бы какая нови если в программировании есть две самых сложных проблем и это деменко и сброс к шейда то с моей точки зрения мониторинге есть одна сложная проблема это мониторинг мониторинга и на самом деле очень мало кто это делает ну по нормальному по сути все сводится к тому что каждый источник alert должен салат некоторое фейковое сообщение я все еще жив я все еще жив я все еще жив я все еще жив а система которая получает это alert она должна как только она перестала получать сообщение сказать ну его больше нет и это и завести внутренней alert о том что больше нет по-хорошему такой же дмс batman switch да я dns сокращаю по-хорошему такую же штуку бы сделать для человека который обрабатывает allure тогда ему 1 минуту ну требует нажатия на но это издевательство значит но как бы ключевая тема что надо обязательно сделать дмс со всех источников потому что иначе не работает еще очень полезная для нас вещь которую мы обнаружили мы начали на любые конечные форматы когда нам alert и приходят в не том формате заводить сообщение потому что если ты что то ошибся и послал мне том формате как бы получается глупых не узнаешь об этом никогда потому что формат не тот система приема вертов говорит не я не приму но никто об этом не узнает ok поиск ввиду того что у нас все на лейблах сходу получился поиск очень простой и тут вот три примера запросов но мне кажется они абсолютно очевидно и соответственно нас появилась возможность искать и alert и инциденты использовать такие же запросы для аналитики но из этого было сделано несколько интересных то есть в тот факт что мы сделали язык запросов в нашей системе до искать важно искать нужно без этого никуда но это дала дало еще там очень много дополнительных результатов и вот смотрите очень интересный пример есть у нас некоторый вася нам и он решил не знаю page хоть какой-нибудь сервер или он решил обновить кластер губернатор что делает вася если он в плохом настроении он идет и обновляет cabernet это вызывает какие-то alert и например alert о том что но дэв куба находится в разных версиях у нас есть на это alert ну на тот случай если дежурному приходит от талер дежурный что идет искать кто это сделал это очень эффективный способ работы то есть один делает устраивает создает alert и 2 обрабатывает находит того первого ну то есть как бы все все все при деле все заняты значит второй вариант если вас чуть лучше он идет в чатик в общей пишет я сейчас шатаю вот эту штуку до типа не удивляйтесь соответственно дежурный когда получает alert вам первым делом идет в чатик смотрит никто ли там ничего не шатает почему он идет смотреть то что он не в состоянии запомнить кто там еще что то это тоже тяжело но у нас получилось вот такая замечательная штука что например васи теперь он хороший он идет систему и говорит вот эти alert и завернуть на меня я сейчас читаю и он прямо подписывает контракт он говорит я отвечаю за вот эту группу alert ну или вот один пример по серверу второй пример понтам какому кластеру да вот проект такой-то кубовый кластер такой-то мне вся лента я за них несу ответственность когда я закончил работу я разобрал ну что-то лишнее и как бы снял себя ответственность ok ну собственно язык запросов маршрутизация еще один интересный момент мы это называем почему-то эффектом рыбки я не знаю почему и нас какая-то внутренняя байк в компании что рыбках это делает один круг по аквариуму а напрочь забывает что было и поэтому не интересно наворачивать круги по аквариуму я совершенно не знаю правда это или нет и даже не ну судя потому что люди готовы отрицательно это неправда смысл-то в чем если вы один отвечаете за обработку alert of вы знаете какие вещи происходят часто вы в них вкладываете время чтобы они не повторялись если вы шарите ответственность между несколькими людьми остаться ухудшается если людей хоть об этом человек семь так что один день один другой день другой и вы дежурите раз в неделю и например какая-то проблема происходит каждый день но один раз вы об этом узнаете когда не через неделю вы об этом узнаете через полгода потому что за неделю вы все забываете у вас эффект рыбки ну а за неделю если сзади ещё приходит нам 15-20 нелепых 50 инцидента которая надо разобрать ну что-то да там что-то да там и тут зашел пять минут починил ладно и ну нам очень сильно помогла штука что нас во всех инцидентах если такая вот кнопочка называется подобное и тут написано что 0 активных и 78 обработанных с такими же инцидентами если нажать сразу видно вот у нас уже это было вот он тогда тогда тогда кто делал а вот эти люди которые делали можно первых пойти спросить у них что же они там делали во вторых почитать в третьих увидеть одну вот эту циферку которая является горящая аналитикой и ну не вы выйти из этого замкнутого круга до сказать на следующем статус my те какого черта у нас уже семьдесят восемь раз это проблема происходило окей вот наверное на этом я бы сказал что он какие-то таких ключевые вещи фундамент до заканчивается и я бы хотел пробежаться немножко по тем вариантом которые у нас были по организации работы просто вам дать контекста потом я еще покажу несколько вещей а ну я уже говорил да что начинали мы там в очень небольшом составе и дежурил один я вот здесь кружочком показано это это я я дежурю а вот кружочка тот шаг который дежурит потом я уже говорил что мы поделили эту обязанность потом мы немножко подросли на стало больше не все дежурили потому что были какие-то новенькие моим боялись доверить численность проведена нереальная потом у нас появилась первая линия которая работала по 12:12 часовыми сменами потом мы по другому чуть стали подходить к обучению и поняли то что вот человек пока не начинает дежурить пока не начинает на равных с остальными нести ответственность там запруды он у нас не не настоящий сотрудник он такой по теме и вот как только он взял состоянии взять на себя ответственность он перестает быть стажером и мы начали это на самых ранних стадиях интеграции человек в компанию как бы вводить потом мы поменяли то как работает наша первая линия для того что они 12-часовая смена это практически не работала потому что все кто работал по 12 часов это убийство мы поменяли на 5 8 часовых смены там достаточно хитро ротация называется чернобыльский график но неважно в общем не я щас объясню просто не не так много не так много бизнес процессов до которые работают абсолютно круглосуточное ahiska это один из таких процессов которые работают высушенные там должны быть высоко высоко квалифицированные специалисты которая досмотрят в в некоторые датчики да ну если они неудачны посмотрят в общем а график называется потому что википедии он так называется не знаю почему ok дальше у нас появилось несколько команд а то есть ну как бы изначально небольшие были до потом у нас появилась вторая линия которая работала только в будни потом она стала круглосуточная линия и тут начале мы всякие эксперименты которые на самом деле ничем хорошим не закончились например мы подумали так у нас в команде который отвечает за группа проектов пять человек а давайте мы поделим так что вот вася главный инженер того проекта петь и главный инженер всего проекта и они как бы отвечают вот за за отдельные кусочки к чему это привело привело это к тому что если что-то происходит в одном проекте то первая линия звонит текущему дежурному из команды которые я не знаю проект немой позвони вася мы то есть и по сути вместо того чтобы но как бы мы полностью потеряли там отказоустойчивость мы полностью потеряли шеринг знания и конечно же мы от этой штуки отказались потом мы выделили всякие позиции типа тимлида за мы тимлида project а это уже было не так давно типа там два наверное года назад у нас появилась третья команда потом мы сказали что тимлид не дежурит потому что ты мне дежурит всегда она потому что по факту как бы он некоторая третья линия на тыс если инженер в команде что-то не может сделать он будет тимлида на и мы решили что тимлид не дежурит постоянно потом мы то же самое сделали замом тимлида который по сути там с тестем лидом по очереди дежурить на это некоторый там 3 линии а потом началась очень интересная чертовщина у нас возникла идея а чтобы почему бы не переделать вообще все что мы делаем не сделать наконец-то правильно и прежде чем рассказывать я наверное расскажу объясню почему вообще наличие там первой линии технической поддержки и так далее это жутко неправильные вещи этого быть не может не должно и так это не работает ни есть несколько примеров они почему-то все про кухню и как бы основа примера заключается в том что если вы готовить еду вы убираете на кухне потому что если не вы убираете вы не будете действовать рационально все кто покупал все кто помнит момент покупки первой посудомоечные машины может быть вы заметили что вы стали расходовать в 3 раза больше посуды это еще один пример да еще один пример и все у кого есть семья например там же надеяться да вот когда они уезжают в остаетесь один вы можете быть из одной тарелки 1 вилкой вы поели сполоснули поставили и вам вообще ничего не надо потому что вы действуете ну вы один вы действуете максимально рационально вообще эта штука называется фиаско рынка то есть когда рациональное поведение индивидуальных людей не приводят к рациональному поведению всей группы и господи вообще слово devops там логотип конференции да это же все о том же самом собственно чем когда у нас есть одни люди которые отвечают за то чтобы был новый функционал а другие люди которые отвечают за то что он была стабильность что у нас будет не нового функционала нестабильности да потому что одни тянут в одну сторону другие в другую я так по крайней мере понимаю этот логотип и может быть это короче моя интерпретация но и с первой линии то же самое то есть инженеров командах понимаю то что этот alert кому-то там придет кто-то там с ним разберется и мы нормально делать не будем мы это зальем людьми и со временем это приводит к тому что такое вам шума мусора становится больше больше и больше и ребята на первой линии страдают потому что они вообще не способна нечего делать и не займется кухней другого слова просто нет да а инженеры недовольны что как бы вообще с точки зрения и чего не делают она не хвалится проблема в том что это просто ну это не может работать но с одной стороны так с другой стороны есть куча частных случаев когда это может работать у нас был такой частный случай мы вполне себе комфортно прожили по сути 10 лет в этой организации понимая проблемы видя их там постоянно сталкиваясь но мы запустили первую попытку того чтобы это исправить где была следующая значит во первых мы платили достаточно небольшую зарплату ребята на первой-второй линии и человек работал только на первой линии когда-нибудь со временем он мог перейти на вторую линию когда-нибудь со временем он мог перейти в двух с инженерами по факту это никогда не происходило потому что за разбирают по инцидента ты ну честно говоря ничему не научишься да и не станешь карьерного роста никакого и вы подумали хорошо давайте удвоим зарплату ну параллельно конечно же поменяв людей и найдя людей которые там способны да большая вроде как потому что у нас там были ну как бы коллеги с которыми мы работали по пять лет они пять лет разбирали инциденты но я чувствую наверное свою ответственность за за это безобразие но они уже как бы не хотели ничего другого не спасли с ними мы увеличили зарплату вдвое мы дальше сказали очень интересно что человек работает две смены на первой линии потом отдыхает там две смены работает на второй линии потом отдыхает а в одном он работает неделю стажёром в devops команде и мы были уверенны что эта штука заработает потому что ну типа он работает стажёром в команде команда его научит покажет как правильно и все будет хорошо чем это закончилось а вот там несколько интересных моментов во первых люди работая на или 1 и 2 очень четко осознавали что они здесь временно они не хотят вообще всем этим мусором заниматься мы хотим туда вот что здесь она вообще не наша а мы здесь временно значит ну там много еще разных других нюансов было но по сути это была просто абсолютная фиаско и наша идея была решить вопросы ну как бы круглосуточного дежурства да хорошо решить освободив инженеров максимально с другой стороны обеспечить себя кадровые резервы в итоге мы не добились не ни одного не 2 и и близко а и закончилось все тем что мы по сути разогнали всех инженеров с jour ства в ноль и взяли сейчас это преимущественно девчонки и они отвечают за два вопроса это эскалация и коммуникация и они ничего не знают про то что что это за инцидент и что с ними делать они следят только затем чтобы информация была там не пропущено и она доехала а сто процентов вещей сто процентов аварии разруливают ребята в командах те же самые которые делают по-другому это просто не работает но это некоторый такой экскурс просто чтоб все понимали этот то тут нужно понимать что там больше 10 лет и он уже не в один день происходит это та я щас рассказал он там за 10 за 5 минут а это день день за днем месяц за месяцем когда-то чуть лучше что-то сделали стало чуть хуже объяснили ребята давайте там перестанем совать мусорные alert и ok но давайте вернемся к нашей основной теме я еще расскажу о нескольких вещах которые с моей точки зрения тоже были очень важными есть тоже возвращаясь к рыбке есть другая проблема что если у вас в компании часто что-то меняется если вы активно вы вносите изменение что-то улучшаете то есть всегда проблема с документацией потому что пришел какой-то alert или инцидент до вас 10 человек который дежурит по очереди кто его сделал что нам стоит меня здесь хотели это вопрос который возникает очень часто хорошо вы нашли того человека который это сделал и вы поняли что этот вас это хотели прошло два месяца этот инцидент приходит еще раз вы не помните окей допустим этот инцидент приходит каждый день вы почему-то его еще не поправили вы теперь помните что по нему надо делать но кому-то надо поменять действия как это сделать это вообще невозможно потому что надо найти всех кто это делал им сказать ни в коем случае так не делайте делайте теперь по-другому и вот эта вот история с управлением документаций очень сильно нас мучила и с моей точки зрения мы нашли там абсолютно опять очевидно и потом уже все решения абсолютно очевидны но и абсолютно замечательное решение которое выглядело вот так у нас всегда была бикини которое дано одно время она была викин одно время она была в ките но ключевая то здесь история в том что это какой-то идиотский пример вы даже не учитываете что там есть некоторые документация что нужно сделать и в этой документации есть язык запросов которые говорит каким allure там эту штуку подцепить соответственно если мы сделали какой-то alert и почему-то мы не могли не смогли описать в самом alert что с ним надо делать а это надо ну мы описываем это отдельно такое часто бывает потому что у нас источник не прометей или у нас этот alerts куча мест мы хотим в одном месте обновлять все это это документ hk автоматом подтягивается человек первый раз видит этот инцидент у него развернулась документация он ее посмотрела нажал кнопочку прочитал и когда он нажал кнопочку прочитала мы запомнили commit китовый в котором он его прочитал прошло какое то время мы поменяли документацию человеку приходит этот инцидент он видит изменение тыкает открывает гид лап с деппом а теперь надо делать не так а вот так работает вообще огонь ok на этом у меня наверное по ключевым вопросам все остался на главный вопрос значит звучит он вот так и мне кажется это в на которых говорили миллионы миллионы миллионы миллионы раз и я бы сейчас прошелся и сказал что существует на самом деле ну как бы грубо говоря три варианта да это внутреннее показатели показатели доступности и бизнес метрики мы можем пытаться смотреть на то сколько у нас там ну давай оперативной памяти и места на диске но скорее всего нам это не даст никаких результатов мы можем смотреть на показатели доступности как минимум на там коды ответов как максимум гонять смог тесты можем смотреть на бизнес метрики и с моей точки зрения вот все фреймворке которые говорят о том как построить мониторинг у них в основе одна единственная мысль и тут есть очень большая дилемма которая с одной стороны если мы используем внутренние показатели у нас получается очень много шума с другой стороны если мы используем показатели доступности или бизнес метрики мы узнаем об аварии только тогда когда она уже произошла то есть и как бы хочется иметь внутреннее показатели так чтобы мочь предугадать будущую аварию но не хочется иметь шума а потому что ну хорошо мы знаем что у нас про то лежит но что нам с этого он уже лежит а ну конечно надо бы быстрее починить мы же хотим да и вот это вот дилема она в основе вообще всего вопрос что мониторить у нас есть попытка ответить на этот вопрос для себя для нас самих некоторые модель которую мы пытаемся там развить и в которой мы пытаемся жить я сейчас попытаюсь вам они очень быстро изложить ну во первых есть замечательная штука который называется столь оси верите то ли priority я не знаю какие они я знаю про эту вещь несколько фактов самый главный факт что никто не знает что это означает вообще никто вот ни один человек ну если вас вы вы попросите пять человек написать alert об одном и том же они все один скажет эта инфа другой типах 3 ранен и все будут правы они вам еще объясняет почему права и это но на самом деле там у как бы нет однозначного способа но я щас к этому немножко вернусь мы докатились до того что мы замутили вот такую штуку и мы severity определяем в двух координатах у нас есть терминальная стадия того о чем это сверить и да и вот терминальная стадия это и так ну как бы максимум до того что может произойти мсм мы мы мы говорим какой impact будет в этой терминальной стадии вот когда у нас места на диске закончится это будет не важно или это будет она сейчас у нас еще не закончилось мы определяем в какой какой как какой impact будет в терминальной стадии и дальше говорим какова вероятность того что мы в эту терминальную стадию попадем в настоящий момент у нас 20 процентов на диске то это possible если 10 процентов то лайки если 0 to certain мы уже там есть мы как бы попытались некоторую некоторый фреймворк сделать по которому мы выводим все верите который у нас измеряется от одного до девяти то и это нам дало некоторые результат что более-менее все хотя бы договорились что это не варнинг и не info а что-то более конкретное но это только одна часть вторая очень важная часть это отделить понятие окружения вот если у вас с 1 то есть если у вас штука которая полностью ломает например ваше приложение это наверное с один так и вот если у вас сломался df и сломался прод с нашей точки зрения то всегда с один вопрос том что у нас кроме severity самого события вне зависимости от его от потребности этой штуки у нас есть еще дополнительная информация что это за окружение еще один очень важный момент это параметризация пороговых значений да и ну где-то закончившаяся на диске место это кстати с диском турнир не очень хороший пример то где-то ладов большое нормально идет лодов маленький это нормально то есть нужно иметь возможность всегда подбирать если мы хотим иметь вот этот вот сырой мониторинг параметризация уровня я начинаю торопиться прошу прощения параметризации уровня severity значит смотрите с с местом на диске хороший пример а проектирования база данных и когда заканчивается место на диске она пишет такой файл который короп нет вообще всю себя и для нас закончившееся на диске место это потеря данных да это это катастрофический impact ну потому что если вдруг она закончится все я привык привел утрированный пример но они бывают другие что ли типа если вы в нужный момент не добавить not to она уже не сможет ришар гнутся epam просто кароче на вам придется живые данные удалять но мне кажется были люди таких ситуациях или другой пример что у нас там есть ротация уже встроена и у нас эти там действий она сама тратите сада и вот это нужно всегда ну к сожалению указывать вручную еще один очень важный момент что все-таки alert и приходится писать с учетом архитектуры вот сервер сток у нас сервер не доступен это варнинг или критикал потому что если это 1 из 20 но всем понятно это наверное варнинг и в ином смысле возвращаясь к тому что я про кадров я был люблю рассказывать куб нам дал конечно же очень большую очень большой плюс потому что раньше мы не могли ни в каких ситуациях писать generic generic rule и потому что нужно было каждый раз под архитектуру писать рула сейчас мы можем писать же не рыкнул потому что мы знаем архитектуру за счет куба мы знаем что это там дипломат с 20 нот или мы можем группе узлов указать что эти состоит в данными их они не могут уходить а вот эта группа вообще может уходить нам нужно чтобы хотя бы там 60 процентов ее были доступны она как бы если мы говорим про ноды ok но это только си верить а я говорил что как бы у нас есть мысль что надо отделить окружение и мы отделение о краже окружении докатились до того что мы ввели для себя некоторые service level i уровня обслуживания тут приведены какие то какие то какие попало да и мы сказали что общего просто какой нас интересует надо ли нам обрабатывать этот alert вообще нам надо его обрабатывать или нет это вопрос который лежит в основе нам прошла ли нам надо с ним что-то делать если надо то как срочно это сначала или вон тот сначала а если не на дату когда надо или совсем не надо им и грубо говоря сказали что у нас есть вот группа где нам вообще не надо группы где можно не сразу и и группа где надо прям очень сразу и вот ну как бы такой подход позволил нам чуть-чуть меня сейчас сейчас продолжу и поясню и смотрите нас есть вот эта дилемма или поздно или лишние а наша идея основная какая мы шлём куча alert of но мы на них по сути вручную не реагируем да и если это но сейчас я вот этой картинке вернусь если это вот эта группа аль art of any погорели погасли ушли меня них ничего не знаем мы мы знаем мы смотрим ретроспективу раз период если это вот эта группа аль артов мы обрабатываем там в рабочее время набралось пачка пошли посмотрели разобрали место скоро закончится там еще что то еще что то но вы когда обрабатываете али ртами 20 штук я сейчас пройдусь там за полтора часа разберу это не так напряжный не так тяжело на вы уже многие аварии потенциальные можете предвосхитить ну и вот это вот разумеется обрабатываем сразу еще один момент который мы для себя вычислили но вычислили достаточно достаточно поздно но он очень интересным вот смотрите всегда когда вы пишите какой нибудь alert вы говорите если у меня la da fresh больше порога на протяжении вот такого периода тогда пошли то есть вас всегда есть порог и период действия это но какие-то таких да два показателя из я ничего не буду говорить про порог потому что я уже говорил и их приходится настраивать но со временем действия там есть опять-таки дилема и дима заключается в следующем что если вы например на тот же самый ладов поставите время действия 20 минут до скорее всего через двадцать минут если там шутера и происходит она уже будет дохлая да и это вам ничего не даст или если у вас есть всплески приличные в которой это тормозит на но они не 20-минутная двухминутные внегда об этом не узнаете если поставите один минут одноминутный порог вас за за за в завалившись штормом и ну как бы вот это вот эти качели да и мычит он них смотрели смотрели смотрели потом щелк и ну как бы осенило мы теперь всегда ставим время действия очень маленькая и всегда шлём все эти alert в нашу систему в которой они приходят из статусе pending и там валер то указано сколько он должен гореть для того чтобы стать на 100 еще маляр там то есть на самом деле мы просто перенесли pending из источников мониторингов центральное место и у нас теперь есть alert не догорел сколько надо времени он ушел в не произошло то есть на такой статус типа не случилось но мы получили опять возможность централизованные ретроспективы мы можем зайти и посмотреть более того мы в лентах пишем правило логической связи например воображаемый немножко примерно у нас есть совета о том что сервер стал недоступен и солер то то что сервер не пингуется есть alert о том что он не доступен по ssh понятно что скорее всего они связаны ну то есть если произойдет что-то одно скорее все произойдет два других да и когда вы пишете рула для allure то достаточно несложно сделать предположение о том что вот так штука может произойти а с учетом того что у нас есть язык запросов мы начали просто специальной аннотации к лентам писать к вере которые за засосать в себя и при этом получилось что у нас случается мажорный инцидент вот который надо обрабатывать у нас в него уже при притянуты alert и по всем минорным вещам на мужчин пологом на не надо ходить ни по каким графиком нечего смотреть не надо уж мы уже знаем что это не просто пруд отвалился а что у нас большое количество 500 у нас выскочила три ноты у нас там вся вся информация собрана и собственно возвращаясь к вопросу так как мы решаем вот эту дилемму ну вот мне кажется я ответил вот в таком сочетании ok последние нет не последнее по поводу кубан как только у нас появился куб появилось два момента частично недоступность от нормальное состояние постоянно а пока мы были на статических серваках все было по другому второй момент у нас многие вещи не сами это же это нормально и если вы будете пытаться мониторить куб из классических взглядов ничего хорошего из этого не выйдет вас будет постоянно счету штормить и вообще не тем чем мы сейчас занимаемся у нас есть замечательная идея начать писать ботов которые будут эти alert разгребать и как минимум делать вопрос эскалации автоматически да так чтобы мы определили на основании си верите и сервис ловила что эта штука должна быть течение 30 минут решена и мы даем 10 минут инженеру если он звоним автоматом тем ряду что мы точно не упускали но об этом позже позже я имею виду в следующем в следующий раз вот доклад называется чему мы научились чему научились и мне кажется сейчас на слайде некоторое краткое перечисление тому того чему мы научились быстро немножко графиков под конец два графика выглядят одинаково один с 2013 года по 2017 2 2017 по настоящее время это количество инцидентов единственное что это 2 разных версий так скажем нашу систему поэтому выглядит так как будто мы начинали каждый раз 0 но вот можно понять немножко там объем который о котором идет речь интереснее другое интереснее сравнения вот это количество инцидентов за 22 года 1883 года а вот это количество alert of падали ртами мы на самом деле понимаем не отдельные алерта сериале ртов а вот это количество событий когда что-то сломалось починилась сломалась починилась это сообщение которое валяться и вот если мы пытались по сообщениям что-то обрабатывать мы бы сейчас умерли потому что сейчас и в день приходит по 15 миллионов но как бы для для понимания но кучей кучей кучей автоматики мы складываем эти 15 миллионов примерно там 1000 в день из этой тысячи обрабатываем ну хорошей ситуации там 10 процентов мы хотим свести потому что мы обрабатываем там самую-самую шапочку но мы имеем весь подвесить всю подтянутую информацию и вот как бы это наверное основное чему мы научились сейчас быстро вы знаете то что компания фонтана это делает опасная тулы мы не знаем о посольстве эту штуку потому что мы в целом готовы ну просто это для от нас требует некоторых ресурсов поэтому если вы считаете что это было бы вам полезно я понимаю то что это для тех людей которые работают в одном проекте скорее всего вся вот эта вот вот эта штука которая там что-то месяц мне нужно да но если вы там средней или крупной компании у вас там десятки проект внутри то может быть это вам будет интересно напишите нам в твиттере или в фейсбуке типа ребята шарьте следующий момент если вы хотите это купить мы можем это продать черт побери ну как бы нам действительно интересно попробовать какие-то пробные внедрения с большим удовольствием третий момент мы бы мечтали сделать из этого продукта но мы понимаем что для того чтобы был продукт у него должен быть владелец да и мы если вы чувствуете что эта проблема для вас близко если вы хотите попробовать это сделать если вы верите что можно прежде чем делать давайте попробуем мы готовы то есть мы ищем партнера который бы взял на себя ответственность за этот проект и попробовал бы причем условие именно партнерский то есть мы готовы долю отдавать и это скорее плату это речь про долю я хотел бы сказать спасибо тем ребятам которые 10 лет эту штуку делали делают и и будут продолжать делать они делают не только это у нас все наши системы в качестве вывода мы не в матрице и пули останавливать не умеем но более-менее там отбивать научились выводы я бы сказал что сделает каждый сам да и то на что я надеюсь то что вы просто увидели какие-то инструментарии найдите систему я я сейчас на как бы стыдно да ну я приду тени не использовал никогда я знаю что там есть много функционал я знаю что есть несколько других систем сосок я знаю что есть некоторые по собственной системы я думаю что вы понимаете почему мы пошли этим путем да потому что у нас там достаточно специфичный кейс но не пытайтесь если вы хотите построить управление инцидентами не пытайтесь это делать на из омска давайте это вы таким вот выводом большое спасибо за внимание меня зовут дмитрий столяров и спасибо что выслушали"
}