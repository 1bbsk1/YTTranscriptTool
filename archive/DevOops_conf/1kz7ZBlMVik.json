{
  "video_id": "1kz7ZBlMVik",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "здравствуйте меня зовут касатин лепестков я работаю в норвежском офисе компании microsoft архитектором облачных решений и я хочу вам рассказать о том как создавать так называемый estate фууух сервисы в нашем облаке в игру ну разных контекстах слово стоит вам сейчас может означать совершенно разные вещи например те из вас кто работает с контейнерными оркестра то раме некая знает что там словом стоит full называется но по сути любая ну да которая что-нибудь пишет на диск поэтому давайте я начну с того что определю что я буду понимать под этим термином и начну я с метода от противного все мы с вами знаем что такое stateless сервисы да это такие сервисы которые у которых состояния хранится в я нибудь еще какого-нибудь внешнем хранилище например в базе данных и так вот стоит full service это все тоже самое только наоборот но давайте перейдем к более конкретным примером и пожалуй наиболее типичным конкретным примером такого рода сервисов можно назвать сервис бронирования авиабилетов в интернете или любых путешествий или командировок к примеру по сути дела любой интернет-магазин современный в части обработки корзины покупок тоже имеет явные признаки state service если мы посмотрим на другие области применения то может а назвать сервис обработки многофакторный аутентификации или например любой сервис реализующий чата чат бот этом этапе становится более менее виден набор характерных черт такого рода сервисов и мы можем попробовать их а поделить следующим образом ну понятно что у нашего сервиса всегда будет какой-нибудь состоянии но это состояние будет небольшим в размерах то есть это нет ни в коем случае не мегабайты а какая-то более компактная структура данных при этом экземпляр такого состояния у нас будет очень и очень много это могут быть сотни тысяч миллионы и так далее каждый экземпляр такого за строение на протяжении своего жизненного пути проходят через серию преобразований соответствие какие-нибудь алгоритм и главной задачей разработчика такого рода сервисов всегда является обеспечить консистентной этого состояния чтобы не случилось какие бы исключительной ситуации не возникли какие бы ситуации гонок не имели место быть состоянии ни в коем случае не должно использоваться сломаться ну и конечно ни в коем случае нельзя ни один из экземпляров нашего состояния потерять потому что скорее всего каждый из них стоит денег этом этапе теоретическая часть повествования по сути дела заканчивается я перехожу сугубо к практике и хочу вам показать вот такой вот тестовый демонстрационный примерный стоит фуд сервис называется скаут зимой я его специально написали в демонстрационных целях вот так вот выглядит его клиентская часть резкий web-интерфейс и это стоит фулл сервис который позволяет организовывать встречи митинги свидания если хотите вот так вот он выглядит и его заранее за тепло и в виде контейнер instance первым делом что вам нужно сделать здесь это залогиниться какие-нибудь ником и попробовать создать какой-нибудь встречу сначала с самим собой если встречу создана то все участники должны откликнуться если кто-нибудь отвечает отказом встреч становится отклоненный еще мы можем залогиниться по каким-нибудь другим ником и позвать на встречу ещё и как только все участники согласятся встреча становится подтвержденный зеленый ну как видите все очень просто клиентская часть нашего сервиса реализовано в применением react и typescript и немножко bootstrap но она у нас больше интересовать совершенно не будет что у нас будет интересовать такая-то серверная часть backend который я реализовал несколькими различными способами с применением нескольких различных инструментов которые у нас есть в и jour мощная самый простейший реализации серверной части намерены без применения каких бы то ни было сложных современных фреймворков или шаблонов проектирование это самый простой респе dot net core впп контроллер с двумя restful методами и в качестве хранилища состоянии мы будем здесь использовать regis как видим код очень прост у нас есть два метода первый метод это метод создания экземпляра нового экземпляры новые встречи все что в нем происходит это то что список участников сохраняется в редис в виде редис set второй метод метод получения ответа от участников и в нем как видите если кто-нибудь из участников отказался еще сразу становится отклоненной а если все участники стоящие согласились и это определяется по сравнению двух множеств в редис встречи становится подтвержденный ну единственный интересный момент и за то что акции об изменении состоянии встречи здесь отправляются здесь и далее отправляются на клиентов с помощью и your signal or service если будете говорить обязательно гуглите именно в такой последовательности режу сигнала of service к сожалению словом сигнала сейчас тоже называется огромное количество различных не связанных друг с другом фреймворков поэтому я подчеркиваю чтобы используем управляемый вижу sign of our service которым вы можете воспользоваться вижу здесь и далее будет используется один и тот же такой же одинаковый подход для этого поэтому мы будем больше к нему значатся не будем для тех кому интересно следить за повествованием по коду я сразу давайте я сразу приведу ссылку на исходнике вот все исходники лежат здесь пожалуйста изучаете комментируйте задавайте вопросы присылайте баги для того чтобы было еще более понятно внутренняя логика работы нашего боккен да я нарисовал вот такой вот блок-схему алгоритма которая тоже очень простая сервис ожидает ответа от участников как только кто-нибудь из участников отвечает отказом встреч становится отклоненный и если все участники согласились печь становится подтвержденный ну казалось бы если все так просто то зачем называется копья ломать придумывать какие-то сложные заумные архитектурные шаблоны или фреймворке почему бы не писать код таким образом и дальше но давайте вспомним что на данном этапе структура нашего состояния нашего сервиса исключительно простая мы всего лишь навсего храним два массива участников и логика consistent обеспечение консистентная сть этого состояния вполне укладывается в функциональность редиса то есть по сути дела мы используем редис для реализации всей этой логике давайте представим что наше состояние становится более сложным соответственно и логика обеспечение его консистенции sti тоже станет более сложной для реализации и возможности сервиса уже будет не хватать и тогда нам придется придумать это какими-то своими силами с помощью сложной логики или например оптимистический блокировок да конечно скажите вы но ведь мы можем воспользоваться принцип иметь идеологией domain-driven development и использовать для хранения состояния то что называется snapshot каждый раз загружать такое состояние в виде snapshot а из какого-нибудь хранилище модифицировать его нужным образом и потом виде сна вкусно псо тоже сохранять это состояние в какой-нибудь хранилище обратно и обеспечивать защиту от конкретного доступа с помощью например оптимистической блокировки да все так но давайте опять же представим что скажем участниками нашей встречи стали не 10 человек а к примеру сотня на этом этапе уже этот подход с оптимистическими блокировка места и станет менее продуктивным будет работать хуже а если мы скажем разрабатываем не сервис организации встреч а например сервис одновременного редактирования документов в интернете то этот подходит будет работать еще были плохо и медленно а уж если у нас например сервис бронирование билетов на футбольные матчи то вообще работать не будет вот собственно это и был типичный круг проблем возникающие перец разработчиками стоит full service of и исторически первой архитектурной моделью архитектурным шаблоном ным простить и улучшить какого рода сервиса стала модель акторов ну как мы все знаю модель акторов это по сути дела тоже самое объектно-ориентированное программирование но с одной с одной большой разницей до экземпляр актара можно представлять себе как экземпляр класса но с встроенной внутренней именно в иной критической секцией таким образом что ни один из методов такого класса actor а или в терминологии модели акторов методы принято называть обработчиками сообщений так вот ни один из этих обработчиков не может быть вызван параллельно одновременно несколько раз защиту от параллельного доступа обеспечивают для нас библиотека фреймворк и таким образом внутреннее состояние каждого экземпляра актара тоже стану становится защищенным от конкретного доступа и остается консистентные как бы из коробки исторически первым инструментом для реализации сервисов на модели акторов вижу как вы знаете стал вижу сервис фабрик и его подсистема режу сервис фабрик при лайбу actors и давайте посмотрим как реализовать наш пакет с помощью этого фреймворка вот модель акторов иллюстрировать внутреннюю работу и архитектуру системы принято с помощью диаграмма классов вот такую диаграмму классов я нарисовал для нашего бэг-энда на актерах она очень простая есть один единственный эктор опытный доктор и у него внутреннее состояние состоит из тех же самых двух массивов массив участников и массив согласившихся участников выглядит код реализации нашего бэг-энда на сервис фабрик кривая был actors это класс actor и код его тоже очень простой у него тоже есть те же самые 2 методы методы инициализации создание нового экземпляра встречи в нем все что происходит опять же это сохранение списка участников в хранилище состояния 2 me этот метод получения ответа от участника точно также загружает состоянии из хранилища сравнивает два списка участников если все участники согласились встреча становится подтверждена а если кто-нибудь отказался все становится отклоненным все это уже исключительно просто на что здесь можно и нужно обратить внимание ну во первых как мы видим состояние хранится не внутри класса рисующего эктор а во внешнем хранилище состояние которое представляется нам платформой фреймворком для этого в сервис фабрика vila vila я был actors у нас есть такой вот ваш помощник стоит менеджер и у него есть место для получения загрузки со строения и сохранения состояния и второй важный момент это то что как видите когда мы сохраняем состояние в это хранилище никаких дополнительных манипуляций и шагов для обеспечения консистентной steam применять не нужно потому что что мы используем модель акторов потому что вызовы любые вызовы этого метода параллельно несколько раз невозможно все они все эти вызовы и будут автоматически выстроенные в очередь платформой для нас поэтому заботиться о том чтобы что что-то может пойти не так в результате параллельных вызовов нам не требуется поэтому код получается вот настолько простой но конечно деплоить решение на сервис фабрик в игру в режиме реального времени это задача не тривиальная поэтому я за диплом наш сервис в air заранее вот так вот он выглядит в сервис фабрик их explorer это мой кластер сервис фабрик кластер у него есть пять нот и как мы видим туда за тепло и на одно приложение вот состоящий из таких компонентов и например компонент реализующие эктор и сейчас за тепло и на все пять нот вот так вот это выглядит ну и пользователь интерфейс в работает ровно так же как и все остальные разновидности можно просто проверить что он работает это это все хорошо скажите вы но нельзя ли чего-нибудь более современного желательно совместима со всеми последними веяниями и частности со всеми нами всем нам известный парадигмой сервер лес и да теперь вы же у нас есть такой инструмент и он известен как ее жор your balls functions это вот система суп компонент air functions и интересно что на моей памяти это первая готова реализация организовано и создано в компании microsoft реализация архитектурного шаблона который одним он известен как согла другие предпочитают его называть workflow некоторые называют persistent workflow а некоторым больше нравится название машины состоянии ли стоит стоит машин или persistent стоит машин но суть при этом никак не меняется и давайте посмотрим как реализовать наш бренд на архитектурном собой не сага и с применением air gear бафом час ну в технологий 3:03 монологи и сак внутреннюю логику принято и люстрировать помощью диаграмм состоянии вот такую диаграмму состояний за грамм переходов диаграмма переходов я нарисовала она тоже очень простая как только кто-нибудь из участников отказывается встречи приходит состояние склонена в красное состоянии если все участники согласились встреча становится подтвержденных tabbert зеленой и вот так вот выглядит код нашего бэг-энда на enter your fans но первое что мы можем здесь видеть это то что собственно вот этой вот и есть весь код нашего сервиса он умостился в один файл это типичное свойство проектов рисующих шаблон саги как правило саги пишутся функциональном стиле поэтому выглядит все даже если используется класса вся но выглядит все как одна большая и несколько маленьких функций в момент специфичен для drupal functions в любой durable faction всегда можно найти два основных компонента первая первая и самая важная часть это то что называется то что принято называть оркестрация или оркестре шин или оркестра tor метод это тот метод который собственно определяет логику работы саги и если мы пишем код массе шер кто такой метод является с помощью софт специального параметра обернутого соответствующим атрибутом оркестре integer логика работы саги нашем случае выглядит вот так вот она тоже очень простая мы даже до все очередного ответа от очередного участника если кто-нибудь из участников не согласился встреча становится сразу же становится отклоненной если все участники согласились становится стоящие подтвержденной второй типичный компонент любой дюймов аршин это так называемая activity методы это методов которых реализован собственно логика работы каждого шага из алгоритма и такие activity методы если у нас код пишет массажа является с помощью атрибута activity триггер единственное отличие таких методов от самых обычных обыкновенных все шахтных методов заключается в том как они вызываются вот если мы можем если видите вызываются они не напрямую а с помощью вот такого помощника call activity и recall activity вы фред райт теперь специально чтобы лучше продемонстрировать это все работает внутри я запустил конкретно эту эту реализацию себя локально на надев боксе давайте посмотрим как это выглядит под отладчиком вот я сейчас запущу день я дам новую встречу и вот мы попали в начало не методы регистрации оркестра таро давайте продолжим выполнение и давайте встреча например отклонил но самое первое что уже бросается то как мы видим все выглядит так как будто метод оркестра таро каждый раз выполняется заново с нуля самого начала чтобы не произошло при при при любом изменении со стороны клиента и это действительно так методы оркестров каждый раз как бы проигрываются заново с нуля самого начала и в этом и заключается специфика реализации шаблона саги в юар был шанс на самом деле хранилище сохраняется не само состояние цаги а история изменений этого состояния в реальности это по сути дела результаты вызова вызовов activity методов то есть используется принцип который нам известен например по архитектурному шаблону secures команд квн separation principle именно сохранения истории изменений и последующие по необходимости проигрывания это история изменений для того чтобы восстановить исходное текущее состояние состояния но за счет того что сохранение истории изменений естественно происходит в режиме и понтон не только добавление именно это и дает нам преимущество в плане производительности помимо того что история сохраняется в виде историей состояние сохраняется виде истории помимо этого у нас есть всегда возможность сохранять этой эти изменения не синхронно и асинхронно то есть не задерживать выполнение нашего кода благодаря этому код работает еще быстрее и наконец еще одно хорошее преимущество в том что нам историю этих изменений нам загружать из хранилища требуется очень редко по сути дела только тогда когда что-то пошло не так с виртуальные машины на которой наш код сейчас выполняется если она перегрузилась например или сломалась или что то еще пошло не так во всех остальных 99и процентах случаев история изменения состояние будет храниться в оперативной памяти и проигрывание методы оркестра таро будет всегда очень быстро именно поэтому activity методы и из методы оркестра то нам приходится вызывать не напрямую с помощью вот этой вот обертки помощника а именно потому что каждый из этих activity методов выполняется не каждый раз а только один раз все последующие проигрываю не и методы оркестра таро ранее в ранее полученный результат будет просто за часа из памяти из этой истории изменений то есть по сути дела применяется катер тонный шаблон известен известный нам как минимизация на самом деле а платформа air gear угол fac шанс пока еще находится в состоянии сказать про может промежуточного развития поэтому к сожалению встроенного графического инструмента для отслеживания мониторинга и управления экземплярами состояний в этой платформе пока нет но есть теперь у нас есть не встроенный инструмент и этот инструмент называется гербов access monitor он даст это опыт собственный проект естественно пишу его в основном я но я буду очень рад любой помощи ран с вашей страны если у вас найдется найдется время и возможность в частности он доступен в виде расширения я вижу студия код и вот так вот он выглядит с его помощью мы можем посмотреть имеющиеся у нас список на данный момент регистрации и посмотреть как изменяется каждый из них давайте сейчас создам новую встречу и вот списке появился экземпляр встрече он сейчас находится в состоянии running мы можем посмотреть на его внутренности вот его внутреннее состояние он состоит точно также из списка участников из песка согласились его участников и здесь внизу мы можем видеть историю всех операций и историю изменения состояния вот здесь сейчас мотор она находится в состоянии running давайте включим refresh и сейчас я встречу ну например ваню и вот спустя какое то время а встреча перешла в состояние экземпляре оркестра ции встречи пришел в состоянии комплит и списке изменений у нас появились изменение об изменении состоянии отправки событий и собственно завершении выполнения здесь я хочу очень кратко сравнить 2 же описанных архитектурных шаблона между собой модель акторов и согаз лишь workflow как я уже говорил модель акторов придумали уже очень давно еще в те времена когда самой сложной задачей было обеспечить надежный перевод денег создала банковского счета на другой собственно в этом контексте модель акторов изначально была придумана саги появились и главное store популярной в несколько позже уже во времена интернета тогда когда стала задача реализации по-настоящему распределенных систем и задача заменить в этих системах чем-нибудь распределенные транзакции поэтому фреймворков для актеров для модель акторов основной задачей было защитить внутреннее состояние акторов откат мяты от конкурентного доступа в то время как исторические саги в основном нацелен на защиту от исключительных ситуаций от потерь связи например о каких-то других ошибок в процессе выполнения но это все то как это было изначально сейчас конечно оба этих архитектурных шаблона и их реализации быстро движутся по направлению друг к другу начнем изготовители отметить что в любой редакции мода реакторов почти всегда есть встроенная возможность дикторов общаться между собой тельств отправлять друг другу сигналы таких встроенных возможностей в фрейм орках реализующих саги как правило нет но конечно мы всегда можем придумать собственный механизма для этого все это тоже очень хорошо у нас теперь есть инструмент для реализации есть ваш архитектурного шаблона сага из коробки но что если мы все таки хотим использовать модель акторов и в то же время совмещать и из прадед мой сервер лес и да теперь у нас есть инструмент и для этого тоже и он его ирис состоялся буквально где-то полгода назад он известен как и ажур durable and cities и давайте посмотрим как рисовать наш пакет с помощью и зерги руку entities вот его код вот класс нашего а джо чилл эктора виртуального актара или dublin city up and патенте и как можно видеть код но практически повторяет код актара в сервис фабрик с небольшими но важными изменениями прежде всего как мы можем виде состояния хранится в виде полей этого же класса вот у нас есть массив вернее множество участников и множество согласившихся участников и это как раз перестреляют тот факт что durante тест принц назвать виртуальными акт организации виртуальных акторов слова виртуальная коса означает что в каждый момент времени в оперативной памяти наших вычислительных виртуальных машин может и не присутствовать экземпляров конкретного автора фреймворк обеспечивает для нас загрузку здесь реализацию и последующую сериализации и сохранение в хранилище экземпляров наших акторов именно поэтому они и называются их принято называть виртуальными следует требования что те классы виртуальных акторов резьбу и дети должны быть все реализуемыми в остальном логикой photos моя есть метод или вине обработчик сигнала инициализации новые встречи в которой мы просто сохраняем список участников во внутренние множество и есть метод обработки ответы от участника который работает опять же ровно точно также путем сравнения множество мы определяем все участники согласились если все согласились мы переводим встречи с трением состоянии подтверждена и важный момент для durable entities это то что это ответственность разработчика удалять экземпляры деловой этики закончившие свой жизненный путь как я тоже уже заранее за тепло и и давайте посмотрим на то как оно работает внутри с помощью того же самый инструмент ядер был functions монитор сейчас я создам новую встречу и вот списке дыр ballantine's у нас появился новый экземпляр вот так вот он выглядит внутри вот его внутреннее состояние в нем массив участников и матче согласившихся участников сейчас я за встречу завершу подтвержу и если мы нажмём refresh встреча стала по ждем ее соответствующей экземпляр любой интерес был дает поэтому его состояние теперь стало пустым вот так вот выглядит законченной экземпляр dior ball и антител теперь если вкратце описать сегюр был entities и сравнить их со всеми предыдущими инструментами на которую мы смотрели этого можно видеть что все очень похоже на векторы в сервис фабрик но есть небольшие отличия есть все в том что беру вы едите это виртуальные акторы их состояния загружается и сохраняется для нас своим оркам и runtime автоматически в качестве хранилища используется eager to apple езжу tables потому что все это работало класс либо entirely класс actor а должен быть и реализуем но на самом деле состояние или изменения состояния в европу фарш нас тоже хранится вижу ты был и точно также загружается сохраняется автоматически то есть тут разницы большой нет обеспечение невозможности гонок то есть обеспечение последовательности вызова методов наших durable and city обеспечивать за счет выстраивания их в очередь в качестве чуть очереди используется и жопу важный момент для разработчика 2 рублей это в том что обработка исключение ошибок это целиком пока имеенно данный момент ответственность разработчикам механизмов ретро я или повторного запуска методов не предусмотрено и интересные важная особенность это то что в дербенте спать держится за все те же самые входящие и исходящие бандунге input и output бойниц что и в обычных вижу functions то есть например вы можете автоматически получать для себя данные из ее рта и был или например сервис баз и точно также автоматически отправлять данные какие-то внешние сервисы например таким образом в нашем примере отправляются модификации об изменении состояний на клиентов с помощью out put байден гав теперь я думаю слышно я прошу прощения это снова хотим констатин записан cove прошу прощения за изменившейся кот за изменить извинишься сифон я сейчас немножко в другом месте географически но я на этом моменте хотел бы что называется немножко перебить сам себя и добавить по интересных моментов обратить внимание на таскать пару общих мест в реализациях подобного рода фреймворков а и библиотек первое что бросается в глаза это то что как можно видеть по коду и по всем другим реализация во всех такого рода библиотеках и фрейм орках вызовы методов activity методов и делаешь нас например или отправка например сигнала фактором вызов их методов и в сервис фабрик и нет я не солю кран я просто разговариваю и вызовы методов dermatitis и прочие реализации все они реализуются как правило путем отправки сообщений в некую очередь до что это означает для нас как разработчиков так это то что все эти вызовы таких методов или отправка таких сигналов обработчиков должна быть тем или иным способом все реализуемо что это то что делает для нас фреймворк и соответственно украинка должна быть такая возможность сохранить все эти вызовы методов в какой-то формат который может использовать на диск что это означает для нас такая то что все параметры таких методов или обработчиков тоже должны быть с реализуемый тем или иным способом иными словами ну скажем передать ссылку на объект в такой этот например activity метод фидер углу fac шанс не получится это вам что называется не стайку оперативной памяти 2 интересный момент это что во всех подобных фрейму парках предусмотрены те или иные механизмы встроенные механизмы обеспечения уникальности экземпляров уникальность экземпляров состояния уникальность экземпляр факторов и так далее ну например сервис фабрик у нас есть класс а аиде котором есть механизмы встроены генерации головой на уникальных идентификаторов а также он может принимать какие-то идентификаторы сгенерированные нами как разработчиками и прогулок обеспечивает для нас создание либо активации экземпляров акторов по принципу get out город и это дает нам возможность гарантировать что скажи мне какие методы инициализации внутри нашего акторы не будут выполнены дважды или трижды если посмотреть на другие реализации например реализацию сак был объявить океан сервис батутом подход немножко другой там нам потребуется при определить метод цепи а логику маппинга логику отображения экземпляров сообщений на экземпляры состояний да он называется конфликтует how the fonts ага так вот джур-джур по functions к сожалению изначально все было немножко иначе эта библиотека сначала прошла немножко своим путём и там в первоначальной реализации метод который создает новые экземпляры dior google fonts новый оркестрацию называется ст от него sing он работал по принципу дед лет после соответствующих запри уже существовал он это от язык экземпляр перезапускал запускала он дал полнее дважды 2 2 1 или может быть там третий раз и так далее это конечно создавало проблемы особенно в случаях в конкретных случаях реализации обработчиков скажем корзины покупок у нас всегда появлялись шансы что расскажем покупок по ким по этим причинам будет обработано дважды или трижды то есть заказ будет отправлять несколько раз и это было конечно нехорошо но к счастью с версии 2 0 это ситуация бывает про логику работы этого метода можно сконфигурировать так чтобы он бросал исключение в случае если соответствующих заправлюсь уже существует и это хорошо на и наконец третий момент интересный момент это то что и доступ к экземпляров акторов экземпляром состоянии экземпляром извне подобного рода фреймворк ах как правило отсутствует то есть ну например сервис фабрик обращаться напрямую котором с мобильного клиента не получится дамба для этого потребуется сделать собственный прокси писать собственный пакте боксирую щий код то же самое и вы скажем будет durable and cities их других подобных реализациях но в этом плане опять же в дерево functions тетя кити рыбу functions реализация немножко другая и там такой такой интерфейс или такой специальный and paid для доступа к состоянием к экземплярам состоянии герба энди this idea обл санчес существует он как бы встроенный предоставляется фреймворком и у него есть отдельная собственное достаточно сложная система аутентификации но в принципе такой механизм использовать можно из холопки что называется не он не требует реализации каких-то внешних дополнительных интерфейсов или методов нашем сервисе но к сожалению поскольку этот интерфейс этот встроенный интерфейс служебный and point изначально не пролилось для такой для такого рода исполь такого рода вариантов использования он не достаточно хорошо для этого защищен иными словами там система аутентификации и авторизации недостаточно гранулярный ну и в реальности это будет означать что если вы скажем предоставите доступ к экземпляру к одному экземпляру состоянии вашему мобильному клиенту по сути вы будете представлять доступ ко всем экземпляр всех состояний это конечно нехорошо поэтому таким образом использовать этот н.п. не рекомендуется я бы по крайней мере не рекомендовал а вместо этого реализовывать стандартным образом путем реализации по характеру ющих методов например так как это делается в тех примерах кода которые я демонстрирую давайте продолжим видео и после этого я буду рад и счастлив ответить на вопросы и это по сути вам рассказать сегодня давайте кратко подытожим мы очень быстро и кратко рассмотрели два наиболее известных архитектурных шаблона для создания сервисов подобного рода стоит вал сервисов эта модель акторов и сара или workflow или persistent сага или персис that flow или как угодно еще вижу есть к встроенных реализации и и того и другого шаблона архитектурного шаблона для модели акторов есть даже не одна реализация теперь в частности есть ре зация 1 рубль functions и дербенте здесь то есть реализация шаблонов саги и мода реакторов и эти реализации derrubo франшизы герба entities полностью совместимые прекрасно работают в парадигме сервер лес наконец это не единственные возможности для вас реализовывать стиснул сервисы сервисы в режу другие сторонние презики библиотеки такие как например акатов нет или хорошо известная inservice бас или фреймворк microsoft orleans и другие тоже прекрасно работают в вижу вы прекрасно всегда можете их использовать и наконец большое спасибо вот ссылки на все исходники которые вам сегодня показывал на инструмент useful functions монитор как я говорил я буду очень рад любой помощи и также ссылка на мой персональный блог пожалуйста буду очень рад если вы если вы решите со мной связаться большое спасибо еще раз буду очень рад ответить на все ваши вопросы пожалуйста задавайте спасибо большое спасибо было лично мне очень интересно и познавательно это все вот к сожалению нас пока нет в чате каких-то вопросов ребят если вы хотели задать нашему спикера вопрос на тему a state service of ажуре то соответственно самое время это сделать но у нас на торчите 60 лет опыта в индустрии как я понимаю и мы сейчас обязательно чем-нибудь поговорим вот если позволить я начну я вот для но чуть заранее документацию по тем сервисом о которых шла речь и первое что бросается в глаза что java java в них не поддерживается может это как-то этот момент прокомментировать и и может быть есть какие-то планы на эту тему то что я могу сказать прямо сейчас jagwire живет ли один арбуз entities и dior был functions касается и журфак sms как таковых а все это помёт уточню а по она не поддерживается принципиально ввиду того что так платформа устроена или же но так сказать это там в процессе разработки когда-нибудь мы получим возможности на java писать дергал functions да вот прямо сейчас я смотрю на руководство по реализации и же functions вижу fangs на java таким образом жила как сформировать для фарша с как таковых поддерживается это значит скорее всего то со временем будут поддерживаться и your fans ядер ballantine's штука в том что все эти и сама платформа и functions и надстройки your угла function среди рублей интерес находится в процессе разработки этого послушные проекты все это open source проекты и поддержка новых фич и новых языков программирования все время добавляется но на это уходит время я не могу официально утверждать что вот в какой то момент времени будет работать то-то и счет и или что то еще но естественно надежду есть мы знаем что мы что касается герба фантагиро бойтесь по поддерживала языкам программирования по факту сейчас работает на сишарп либо на java script на java скрипте это значит что и на typescript тоже еще можно писать на питоне ну и для совсем продвинутых можно использовать of sharp я не пробовал order боитесь на данный момент это сишарп и java script слэш typescript соответственно работа над другими поддержка других языков программирования идет и наверняка появится штука в том что тиша как язык программирования для это functions и дефарж а соответственно и дербенте this это как бы встроен нативный естественный язык программирования до все остальные и реализации вашего кода на других языках программирования работают через специальный боксирую щи интерфейс специальный боксирую щий in point иными словами они настолько нативные но зато это дает возможность писать кого-то на других языках программе не в том числе на своих суп на тех на которых вы захотите сами есть возможность встраивать реализацию свой редакцию на своих языках программе если вы вдруг захотите понятную спа ну вот я хотел просто прокомментировать конструктор хотел прокомментировать что microsoft в последнее время до активно идет в open source и ну я так понимаю это тот же некий эксперимент насколько сообщества это будет интересно насколько люди будут готовы эту идею поддерживать если у тебя какой-то вопросик нашему спикеров к собственно говоря слушал доклад на себя просто записал интересный момент но того чего может быть докладчик не коснулся в рамках доклада можете прокомментировать в рамках вот именно конкретно этих решений обычно когда я patterns ага услышал первый раз это было довольно давно на этот пять назад вот когда начинались эти микро сервисные истории и вот эта вот история про бронирования отеля она по-моему самое стандартное и приводят практически как каноническую многих статьях докладных и так далее вот и основная идея как бы саги еще есть в том что да есть там условная прямые транзакции тогда когда ты собственно говоря там да то есть три атомарной транзакцией который управляется как раз таки вот этим координатором и основная как бы идея в том что на каждую приму транзакцию по идее должна быть некоторая обратная транзакция который откатывает состояние такое вас наверно это зависит от некоторые бизнес там логике домена в твоем примере я так понимаю что обратных транзакций как бы нет как класса потому что там в принципе понятно там стоит машина который выдает результаты да или нет да на какой-то а на само неких то данных вот а мне интересно как бы если какие-то инструменты которые как раз таки позволяют за как-то проще писали эти вот прям ее обратно транзакции так далее в рамках тех наверное инструментов которые ты рассказывал да если совсем кратко то нет расширить отец следующее мы этот углубляемся что называется в детали терминологии и возможно понимание терминов будет у нас сильно или может быть мисс не сильно разным но разным и поэтому я и обращал внимание что вот этот самый архитектурный шаблон некоторые называют его сага и некоторые называют его workflow кто-то называет еще как то насколько я себе представляю эту терминологию действительно термином сага чаще принято называть workflow в котором да есть методы которые как бы выполнять какую-то операцию есть другие методы которые предназначены для или обработчики сигналов которые предназначены для отката неких а красота есть во в теоретических статьях на эту тему принято называть саги замены определенных транзакций поэтому и реализация этих сах как правильно сильно похожи на реализацию определенных стран придется транзакций и на реализацию определенных транзакций но как вы можете заметить по коду и вот как эта моем примере этого используется не как определенная транзакция как не нечто нечто более общие то есть наверное если строго с научной точки зрения смотреть-то правильно это называть правильнее было бы это называется workflow считайте при этом сагу как архитектурой шаблон так сказать под множеством архитектурного шаблона workflow но опять же это все вопросы технологии некоторые могут думать об этом так они которые могут думать об этом всяк в конкретном примере который показывал шла речь о реализации алгоритма изменение состояния путем преобразования этого состояния серии конкретных шагов и каждый экземпляр или как каждый выполнение каждого шага фиксируется представить су называется чекпоинт вот это будет наиболее длинная и общее описание того архитектора шаблон по которой я говорю насколько это соответствует вашим представляете вот интересный вопрос ну тут смотри короче да просто это контакты наверно мне в жизни больше встречались задачи вот этого но она типа потому что в микро сервисах но обычно бывает так что то что бывает а как бы правильно доделать так что у каждого сервиса есть некоторые свое состояние причем но там где-то внешней хранится и тогда но может храниться и внутри самого сервиса зависит от реализации дать некоторое видел разных решение проблемы вот и поэтому обычно всегда встает задача о том как сохранить данные консистентной в рамках какого-то сложно workflow то есть когда там изменение в один сервис подают обычно никаких проблем нет чаще всего начинаются проблемы тогда когда тебе нужно по ней состоянии консистентной сразу в нескольких местах и здесь как бы уже начинается разного рода свистопляски с различного рода вот решений вот поэтому когда конечно можно говорит сага я помню там твои это интер 2 introduction где-то верил что вот мы будем это подразумевать под этим тайме так далее да например относится нам было бы интересно то есть если какие-то такие моменты уже может быть какие-то готовые но видимо их как бы не так надо просто сама может быть написать я так понимаю что этот мужик это сделает я прошу пощение я бы тут дополнил еще что встроенных механизмов отката каких-то изменений состояний не в dior был фарш нас нигде углу эти песни в других реализациях шаблонов сова нет и я уверен что это делается сознательно сознательными такие инструменты не делаются разработчиков библиотека для того чтобы предоставить больше возможностей или скажем так переложить эту ответственность на разработчиков сервиса так чтобы с разработчики могли и имели полную возможность реализовывать это наиболее эффективным образом если говорить о встроенных механизмов отката изменений то такой механизм встроенный готовый давно известен называется транзакции и реализация транзакций она есть во всех сферах управления с базами данных и прочих подобных серверах и если хотите вы всегда можете ими пользоваться именно этим суть сак и этого самого архитектурного шаблона в том чтобы чтобы дать вам можно с разработчиком отказаться от использования транзакции тем более распределенных транзакций да и как бы их мотивировать на это и поэтому таких встроенных инструментов не делается считается су разработчики должны сами подумать о том как правильно вкатить ту или иную операцию скажем как правильно отменить отправленный заказ если вдруг денег на счету оказалось недостаточно или что то еще пошло не так или скажем если да если товар на складах мне казалось как правильно отменить а папку всех остальных набор ну да в принципе ответим на 3 вопроса кит или могу сечени задать давай тогда я раз уж так а потом потом снова ты меня вот вопрос связи с тем что мы вот это вот назвали flow и и значит сразу у меня в голове возник всякие разные примеры там всевозможных системы где это потенциально применимо как на твой взгляд такого объема проекта там с точки зрения я не знаю объема бизнес-логики вообще стоит при помощи вот таких функций создавать то есть это скорее там какой-то небольшой объем там типа оля там обработка корзины до или можно устроить полноценную систему какой-то там какой-то документ наоборот управления ресурсами или что то еще ну как таковые фреймворке о которых шла речь никаких ограничений размеры и масштабы ваших сервисов не накладывают разве что может быть с точки зрения производительности в определённых ценовых категориях и в вы по факсу нас есть так называем про semkir да есть фактически бесплатный про sentir это когда вы не платите ничего вплоть до определенного количества вызовов а потом начинать платить за каждый вызов называется концам шин мод но есть другие про синкер которые для более специально предназначены для более масштабных сервисов для для большего для больше для гораздо большее загрузки до гораздо большую трафика а как при варке как как библиотеки конечно каких-то ограничений нет единственное что с архитектурной точки зрения конечно сервиса на подобных фреймворка х библиотеках принято строить по методологии микро сервисов вы можете сделать и монолит и даже очень большой мы на вид если хотите но сама суть и все соответствующие инструменты сопутствующие инструменту уйти привиты к framework of как бы дают вам возможность и мотивирует вас на то чтобы вы писали виде мика сервисов как можно более микро серых но как можно более гранулированного писали вашей сервисы от не обязательно ну то есть то есть получается что мы там можем иметь достаточно большое количество сфокусированных вот таких вот все вписав да там каждый занимается своим каким-то доменом но вот есть какие-то примеры какие самые там крупные аккаунт какое количество этих микро сервисов какое количество данных можно ведь и там рамках одного проекта работает есть ли какие-то референция к сожалению к сожалению прям щас не проведу никаких конкретных ссылок я так могу сказать что ограничений нет ботинок за ваши деньги сколько сервисов реализованных на и за фланг сосна derrubo франшиз нади рублей а также может иметь сколько у сколь угодно большой сервис фабрик класс парни если хотите да вот pro series fabric я могу сказать сервис слова и как фактически платформа на которой больше через то jours само по себе реализовано это известно так что вот вам масштаб реализации проектов на сильной слабой уже время да конечно сервис фабрик это сервис фабрика то есть вам нужно иметь свой кластер нужно его поддерживать нужно его администрировать и вряд ли вы будете писать миха сервиса для вашего стартапа на сервис фабрик потому что масштабы немножко больше получаются всегда то есть вам нужно быть как минимум его как-то загружать этот курс не точно как и скажем с кабинета с эти с кластером если у вас задача сделать я не знаю вот сервис по бронированию встреч в интернете вам убирает из кластер не нужен точно так какой сервис фабрика понятно немножко притерпелись применимость you создавать акты до такой вопрос был я не знаю ты показывал там где то что есть некий d-box есть дебаг ну и конечно избежал studio можешь какой-то там это встроенный инструмент вот так как я не мастер visual studio мне не совсем как бы понятно это было но у меня есть более такой вопрос здесь что дебаг это одна из его разновидностей тестирования ручного практике ваней просмотра как в программа правильно правильно работает да то есть некоторые такой его подведите скажем так а вот в целом вообще вот как тестировать все эти функции то есть они же там кадета внутри себя я так понимаю доложить какую-то инфраструктуру того же озера те же очереди который ты упомянул кадеты место где хранится состоянии вот эти вот собственно говоря моделей которые обрабатываются так далее вот как это все тестировать разработчику там при разработке может быть вся этом сети каком таком туре там и так далее интересный момент насколько дорог это все поставим это отличный вопрос и давайте сразу перескочим кадир была французской же functions герба faction саги рублей to this service фабри пока отложим эти фреймворке создавались изначально край и специально для обеспечения максимальных возможностей по тестированию по отладке и пользу работки вашего кода на один боксов что это значит на практике это что вашей air france вашу turbo functions вашу diablo и прочие проект на этот и для такие вот и всегда можете запускать на любой машине есть такая возможность всегда например на вашем где в боксе вот то что я демонстрировал в видео вы можете всегда запустить ваш проект локально и он будет работать практически также как он работает выжу то есть и your name случае предоставляет только вычислительной мощности ну и возможности по блокировке нагрузки а если у вас нет режу если или если вы хотите запускать писать отлаживать или тестировать ваш код где-то еще пожалуйста всегда есть такая выгнуть хвост для этого доступен он работает на любой машине на любой платформе на windows на linux на на маке как правило копишь тебя наиболее постоянном инструмент для написания кода для и же functions ядер бы факс лидер бойтесь этот visual studio код который тоже работает на всех основных платформах но это тоже не обязательно есть другие способы вы можете писать код вижу судья может писать код в блокноте можете писать код в web-интерфейсе и в порту и других редактор кофе пожалуйста сколько угодно по поводу тестирования более подробно поскольку код и же франшиз может работать на любой машине соответствовал может работать и на любой на любом intense инвестирования до из и и за deployment пул или из пула виртуальных машин где запускаются ваши билды июне тесты и например на машина где запускаются ваши интеграционные тесты и это тоже очень хорошо то есть вы можете всегда написать набор операционных тестов которые либо обращаются к вашим сервисом которые работать на той же машине либо обращается к вашим сервисом который уже сзади плойка работать в ажуре и проверяет работоспособность после того как вы за тепло и очередную версию то есть это все работает хорошо и практически нативно некоторые wap возникает в плане аутентификации к такого рода сервисом то есть к вашим сервисом который вы за тепло или в узор который написано я езжу functions который за диплоидных езжу и которые требуют какую-то сайта русификации например это может быть активная виктория играх и active directory или может быть у вас какие-то другие механизмы черкассы используются внешние сервисов дефекации типа фейсбука или соком еще поддерживается google например ли что-нибудь еще тогда логику ации механизмов аутентификации из ваших интеграционных тесто до вам придется как-то реализовывать специальным образом но это тоже стерилизуем а если посмотреть на мой влог есть несколько там статеек специально на эту тему о том как аутентифицироваться в сервисах нарежу functions и звание с ваших тестовых ромашин например насоса со временем либо нам здесь нам до заканчивает мирный ferre я так понимаю да спасибо ещё раз за доклад вот и приглашаем всех в дискуссионную зону ссылочку я за понимаем уже найти под player спасибо спасибо ребята спасибо константин за дыма зато и опыт ребятам за вопросы если у вас еще реально остались вопросы как я сказал саша переходите в зум ссылочка там такая логотип виде логотипа зума переходить и общайтесь там даже можно будет задать вопрос голосом как экспертом так и константину поэтому всем пока-пока до встречи в зуме а у нас спонсорский блок паскуда спасибо большое спасибо и до связи"
}