{
  "video_id": "J59E5oSe1WA",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Всем привет Итак кто же у нас сегодня в гостях в студии The ВПС маска Кто скрывается под тобой а у нас сегодня в гостях а Костя он же дипеш он же Брюханов он у нас гендиректор компании Деу ОПС рыцари в мире девопсом преподаватель А начиналось всё насколько я понимаю с тематических чатов и курсов которые Костя делал Да всё так Привет ребята привет Лев олев Кстати мой студент С недавних пор да Так уж вышло Привет ребята добро пожа Ну что будем потихонечку начинать начинаем да Значит так я начал бить по микрофону Но это был последний раз Лев меня пря знаешь так это подначивать наша тема звучит как Превращение из operations в Solution providers такой она стала только сегодня те из вас Кто такие позавчера смотрят на мою тему Такие блин что какие-то превращения какая-то ОПС команда производители решений Вы не переживайте тема не главная наполнение да Главное наполнение И сейчас мы конкретно к нему и перейдём что-то я начал нос чесать слишком много надо пристегнуть руки к ноуту Да блин как крышку скрыть так её не видно да что я наклонил во сейчас там ребята помогут А то нас вчера с Лёшей ругали ладно как вы все уже поняли мы сегодня с вами в такой будем расслабленной атмосфере у нас смузи доклад но тем не менее в нём есть зерно интересных инженерных решений погнали Итак кто же я такой да точно Левы прав здесь это маленько есть Меня зовут Константин Да я основатель до этого я работал в псе несколько лет но благополучно покинул рынок найма зато нанимаю сам имейте в виду Приходите кстати работать ко мне как уже Лев сказал я препод в университете ИТМО там я создал и преподаю собственные дисциплины пока что всего две это инфраструктура как код и технологии сборки и развёртывания по сам я тоже учусь получаю кандидатскую степень пишу диссертацию про для задач девопса К сожалению этого пока нет красивого названия вот заняли уже название Ух щики на самом деле оно бы здесь и подошло потому что - это когда мы навыки и практики девопса применяем для задач Эля А я вот хочу у тебя наоборот полу для правильно Блин так и должно быть как будто бы ведь девопс же любят на печи лежать чтобы всё работало Ну вот как раз а бытует мнение что девопсу как инженеру ему не надо разбираться во всём остальном как кот устроен как его декомпозировать это вот оставим инженерам скучные университетские дисциплины а девопс он должен что прийти трубу написать в пайплайн положить э репозиторий настроить заказчику отдать Угу Так нам Ох Лев сегодня провоцируешь меня на темо на которой я могу дискутировать очень долго всё зави от обстоятельств но я вам скажу так знаете вкратце чем больше вы умеете Тем вы дороже стоите и Тем вы более редкий инженер э безусловно есть на рынке вакансии для которых достаточно ничего не уметь вот написал пайплайн и забыл но я уверен что тренд идёт к тому что девопс потихонечку будет как бы эволюционировать Вот как раз в то про что дис у меня про такой dml ос Да что нам придётся разбираться в более серьёзных вещах поэтому Приходите к нам в ИТМО научим фундаментал вот ну что ж немножко так как бы подраз бави а Да точно Я же ещё создатель deos тут написано - это что такое Сейчас расскажу буквально через секунду Да ведущий одноимённого подкаста вчера Кто был на наше интервью с Сашей из The Kit Talks там тоже мы об этом поговорили что ж такое Deus Ops когда-то давным-давно когда я только начинал преподавать я преподавал много где и мне потребовалась знаешь такая точка входа в которую можно аккумулировать всех студентов чтобы просто анонсировать какие-то стримы какие-то там лекции я создал чат чтобы просто координировать сейчас он разросся это большое сообщество учащихся и работа специалистов У нас есть Youtube канал где мы проводим живые воркшопы разборы реальных рабочих задач ведём стримы и Подкасты с приглашённым гостями причём не только технического характера у нас был там и подкаст С психологами про выгорание у нас был стрим с рушанова Как писать правильно резюме в общем короче прикольно сейчас разрабатываем собственную платформу для education но о ней сегодня не будем К сожалению QR коды ЕС не успеете отсканировать то они будут ещё в конце Надеюсь мы до него успеем дойти те из вас кто со мной знаком знают эти знаменитые стримы по 5 часов Но мы будем торопиться погнали Итак с чего всё начиналось мы сегодня с вами проживём такую знаете классическую историю путешествия героя как по основам драматургии и вот сейчас у нас с вами стадия обычный мир самое что есть вот равная точка А это конечно же работа на которой мы уже работаем Ну либо только пришли значит вот мы пришли в новую классную компанию тут на суфлёр не видно но у нас с тобой в презе супер незаметно написано точно не банк да Значит мы пришли в новую классную компанию точно не банк много опытных специалистов нас встречают у нас там даже есть псы не мы там не один Нифига себе но ещё и бонусом у нас огромное количество разрабатываемых сервисов прям там доходит до сотен Всё как всегда делаем делается с нуля то есть нам приходит ребята всё сейчас будем программа 600 дней тут будут отсылки для своих иногда всё делаем по новой Делаем супер классный не банк Ну и конечно же Куда без них крайне амбициозные сроки вот у вас есть 600 дней значит с нуля Создайте второй там условный Тиньков да не банк Вот что мы в итоге видим Ну вот я решил привести пример конкретно свой из такой типовой с чем я сталкивался на работах Блин так прикольно Я не знаю зрители видят или нет Вот эти мои пометки которые знаешь типа шутки не для всех скорее всего их не витни могут уя поть яркость и г нужно находить всякие секретные отсылки у тебя презентацию потом я думаю люди пересмотрят и потом найдут о том что ты не сказал ребят Вот тут для вас очень много сегодня секретов будет Не пропустите значит конечно же целевой инструмент на проекте gitlab куда же без него когда-то там присутствовал рядышком м Сити но не будем о грустным Ух что мы с вами имеем в виду ну вообще довольно типовой такок когда у развёртывания на моём примере этом и есть что-то куда мы развёртывать мне тут немножко не повезло и на этом проекте у нас было всё и be Metal cuber и Open Shift не банковский и Яндек Cloud то есть прям полная солянка и нужно было с этим всем делом колдовать что ж глаза боятся руки делают что вообще происходило значит изначально была морепарк ВС то есть ну Мы помним Да у нас есть команда супер профессиональных разрабов здесь мы им доверяем пилят Наша задача - это прийти увидеть в лабе миллион репозиториев под эти все микросервисы и значит сделать их мы это назвали от девопс да то есть нужно каждом проекте создать пайплайн То есть gitlab файл создать докер файл который будет всё дело билдить ну Ича чтобы это всё дело деплоить к счастью тогда ещ не приходилось рафом ничего поднимать Яндекс Чуть позже появился на проекте поэтому тут в начале его ещё нет погнали значит что у нас ещё есть что получалось сделать но тут я думаю все через это проходили когда мы приходим На работу Ну вот тебе один проект мы такие класс написали пайплайн написали докер файлы радостно пока что ВС супер валят на созвона значит с управлением потом говорят Ну слушай Вот разрабы ещё два проекта сделали мы такие Не вопрос мы сейчас берём копи паст всё сделали Всё работает как часы нормас пока что всё прекрасно и тут в какой-то момент значит выкладывается ещё два сервиса и нам приходят разработчик говорит Слушай нам нужно аргумент новый добавить дофа там короче никак без вот какой-то пере мы такие ну Ой ладно идм Значит и во всех пяти проектах добавляем кто-то конечно сразу там немножко ругается что мы там версионирование им сбили в старых репозитория но без этого пока что никуда на данном слайде С горем пополам мы пережили вот этот вот инцидент и живём дальше и потом в какой-то замечательный день просыпаемся нам говорят Короче нам теперь нужно чтобы выкладывали образы не вре а допустим в Nexus он как раз был на слайде мы такие так это теперь C менять и нам надо теперь во всех проектах его менять так их ещё и больше стало и всё нам уже как бы всё это дело нравится не очень что делать-то ребят Вот каждый из вас наверно себя обнаруживал в такой ситуации уж я так по несколько раз В такой момент в крупной компании нанимается один джун который будет править все репозитории и происходит процесс автоматизации вот автоматизация руками Джуна То есть он такой как робот Как робот-пылесос А я всегда говорил вот если вы джун Будьте готовы что на вас скинут задачи которые жалко тратить сеньоров вот Итак давайте подведём немножко такой знаете сам какие мы получили проблемы во-первых у нас нету возможности одной правкой заменить ошибку во всех репозитория а они с каждым днём их всё больше потому что ну наш не банк развивается Да и проекты растут При этом если нам нужно что-то улучшить да то есть Ладно там уж Бог см с багами но если надо какие-то правки внести тоже нам придётся вносить во всех репозитория опять же не все разрабы и не все управленцы любят когда мы вносим правки вот прямо в репозитории с проектом там У некоторых есть привязка там какие-нибудь теги есть короче это обычно это конечно спускается как бы знаете на тормозах но никому не понравится Это вот причём самый-самый версионирование осталось по-старому у них оставили потом бак нашли что делать Ну бак в C например да C тоже уже разъехался То есть это вот и потом это превращается в историю когда уже начинают другие люди ходить править репозиторий у вас всё разъезжается И в итоге каждая команда живёт со своим зоопарком который Сама же и создала В итоге ты потом через год приходишь на проект где ты делал C А там вообще всё другое и ты такой что началось-то блин вот этот знаете configuration дрифт который мы все видели вот тут он как бы тоже начинает как бы прослеживаться да и с каждым новым проектом эта энтропия увеличивается потому что нам нужно всё больше и больше и больше этих окошек держать в поле зрения и это мы ещё до хелм чартов не дошли с их ингрессо а там тоже начнётся ещё как бы никому не пожелаешь в итоге мы Что понимаем что у нас изменился баланс здесь нужно голосом Галадриэль из колец сначала баланс изменился ээ то есть наша с вами работа по сопровождению и починке старых проектов точнее девопсом штук в них она занимает больше времени чем отде воп Сить новый проект Ну говоря правильно Да академически привести новый проект к практикам девопса при этом а задача девопса вроде бы должна сводиться к тому что ты должен тратить Меньше времени на работу но в итоге время затрачиваемое на изменения у тебя не не не уменьшилось но ты добавил много новый сложности в проек Ну да то есть Работать тебе стало сложнее и работать тебе стало хотеться меньше Ты уже в принципе наверно резюме обновляешь уже обновляешь юме ищешь на хка в какую контору ещё Прити там всё поломать и думаешь Ну там наверное будет лучше не будет ребят лучше кстати говоря спойлер я ладно это как-нибудь потом об Почему не будет лучше что же делать Ну давайте примем ягоды вспоминашки и немножко вообще Абрам чему Мы учились все э на конференциях на стримах на всяких курсах на тубах вообще везде во всех книжках Что нам говорили везде нам говорится одно переиспользование кода Ну и мы с вами даже вроде бы это усвоили то есть мы такие ну Да вот мы когда писали раньше мы вот додумались роли выносить отдельно и теперь одна роль у нас Если хорошо Мы е написали она у нас используется много где и кто-то такой из те кто и ещё фор модули Мы тоже научились выносить все такие да да Но на этом почему-то все останавливаются Ну ещё кто-то конечно же безусловно там Хм чарты хранит в репозитория отдельных кстати про это даже есть доклад на текущем де ВПС Как создать собственный репозиторий чартов при этом параллельно живут разработчики которые с вот такой толстенный книжкой паттерны программирования и разделения переиспользование кода потому что иначе ты в своём коде не разберёшься со да да причём открывает каждый год То есть каждый год осенью Мы ходим на несколько конференций и все говорят ребята будем переиспользовать а потом такие Ну всё закрываем эту книжку пошли писать заново то есть ещё раз мы с вами говорим о том что принцип repat Он супер важен но здесь хотим вам сегодня открыть глаза на то что возможно вы раньше упускать а именно мы с вами должны Взглянуть на наш gitlab C Ну и вообще на Ci пайплайн неважно gitlab это или что-то другое э и вообще на всё что не относится к продуктовой разработке то есть docker файлы Чар это всё тоже код А мы с вами вспоминаем да представленные для нас в виде команд то есть команда разработки - это по идее наш с вами заказчик псов ского Решение вот Ну да о практике вынесения в репозитории Я уже сказал тут у нас тоже скрытый есть текст кой опять оставляем это на самостоятельное изучение презентации после как домашняя работа Да вот тый слайд запоминаем начало трансформации этоже эро понял что дальше так жить нельзя и мы начинаем трансформацию Значит тут я вас хочу познакомить с решением которое в какой-то момент мы открыли для себя когда я ещё работал и что из этого Получилось конечно же постоянно вспоминаем про Don't repeat Yourself мы с вами как я уже говорил помним замечательно Я надеюсь спустя 5 лет плотной работы в девопс Ну кто-то дольше безусловно кто-то меньше Но тоже уже знает это вот вот святая святых л роли Да тут уж наконец-то Мы научились их более-менее правильно выносить правильно там покрывать переменными чтобы можно было всё тюнить независимо от ролей Ну и как я уже говорил да терраформ модули тоже но Неужели это всё на что мы способны Конечно же нет Э есть такая штука инкапсуляция И я предлагаю сегодня вот в контексте девопса м мыслить ею то есть мы с вами вот всякие девопсом сегодня представлять как серые ящики То есть как какое-то решение упаковано в коробочку Ну да мы можем посмотреть это не Black бок Но самое главное что оно убрано вообще от проекта вы на скриншоте можете увидеть как мы это сделали в своё время в том самом не банке Мы создали глобальную группу в лабе назвали её Dev Далеко ходить не стали за идеями и в ней мы Разместили подгруппы для каждого Типа так называемых депс ингредиентов Да НУП сущностей которые мы вообще полностью убрали из проектов это как вы видите ПБУ роли докер образы чарты рафо модули с рафом манифеста Но к этому мы ещё вернёмся и некие gitlab приколы причём самые внимательные из вас увидит что здесь есть такая штука gitlab Access groups про неё мы сегодня Говорить не будем может быть в дискуссии расскажем Я уже что это такое оставайтесь на дискуссию Итак давайте обо всём по порядку Ну долго не будем останавливаться на том о чём говорим уже много-много лет и пытаемся Вас как бы обучить этому даже в универе уже как бы дисциплины заводим такого рода это ПБУ роли с этим всё понятно по подгруппе для каждого из них в плейбук мы храним конфигурацию для определённых Ну понятно да что такое PlayBook это в идеале перечень ролей э-э соотнесённость с хостами из инвентаря Ну и собственно requirements для самих этих ролей - собственно Так у нас эти плейбук и выражены то есть мы описываем какой-то либо instance либо контур прописываем инвентарь а прописываем частное то есть чем отличаются Да плейбук от ролей то есть роли - это общее плейбук - это частное то есть ну вообще частное - это инвентар скажем так роль - Это для там тех кто для разработчиков это какая-то функция или какой-то класс А непосредственно роль а PlayBook - Это непосредственно Ну что-то вроде стандартного метода который всё запускает Ну да да вот и конфигурация в виде инвентаря типа гварс и всякое такое вот мы это храним так то есть тут пока что всё понятно так в принципе много где да то есть уже додумались плейбук убирать из проектов уже додумались роли не хранить с плейбук потому что иначе это невозможно версионирование пока что тоже всё понятно э абсолютно такая же ролевая модель то есть есть фор модули это как in роли то есть какая-то атомарная задача вынесена отдельно и её можно конфигурировать переменными и есть у нас директори Ой В смысле подгруппа с тифор манифеста мы для себя решили их называть планы Это не совсем корректно но так вот мы привыкли с самого начала ээ Да и так как-то проще типа форм план для прода так вот мы говорим в нём мы храним собственно наборы фор манифестов с вызовами модулей для каких-то конкретных контуров Ну обычно здесь лежит Всё для КД решений то есть локально мы никаких провайдеров терраформа не применяем это только для клауда использовалось дальше начинается интереснее то есть то ради чего мы тут с вами все собрались да это не инфраструктурные сущности следом то есть Первое - это хелм чарты Не совсем я согласен сам с собой Это Константин из прошлого её Обозначил как не инфраструктурная сущность но предположим что хелм чарт инфраструктуру не разворачивает как то есть Тефо могут развернуть инфру Хм чарт наверное всё-таки Ну я имею Я думаю что ты просто имел в виду что м Чар - это некий пакет который применяется на уже готовую инфраструктуру всё-таки это да то есть это пакет для кубера да да то есть больше скорее знаешь может отвечать за продуктовый какой-то требование то есть развернуть там фану для продукта или развернуть там саму Алику нежели развернуть контур Вот то есть с этим пока что тоже Мы с вами уже умеем работать то есть ну да с Хм чатом в целом всё понятно есть целые доклады И как я уже говорил на текущем деву обсе есть доклад Как сделать репозиторий собственный тут в целом Понятно убираем h& Chart из репозитория прое и он хорошо себя ведёт причём вы скажете А почему мы вообще что-то всё это убираем ребята Потому что если у вас 100 одинаковых проектов вам Зачем хранить 100 одинаковых чартов и все их отдельно версионирование да Ну это как изначально планировалось люди вот вам инструмент Где вы можете написать один раз код и его переиспользовать все такие Спасибо Замечательно У нас тут 100 микросервисов 100 чартов очень удобно и все знаешь называются типа Universal Chart Да есть ещё есть отдельная сущность людей которые начинают делать универсальный Хм Чар под все случаи жизни и это превращается в & plate код когда ты внутрь илов помещаешься держит ПХП Да ставить Вот это ко на силу не каждый понять Может когда ты это считаешь такое ребят делать не надо то есть нужно унифицировать Умно То есть Вам можно сделать один чарт для всех проектов на Джаве один чарт для всех проектов на ПХП Ну там тоже есть кстати Свои приколы но не нужно делать один для вообще всего на планете как и не нужно делать одну роль для всего на планете и один плейбук это только вас Привет В расстройство вот Ну и конечно же Куда без них это подгруппа для докер образов тут тоже всё понятно когда-то мы туда Просто убрали базовые образы Ну это было требования не банка что должны базовым разобраться от себя Ну ти вообще секьюр ная тоже история тем более сейчас там все начали сальсу внедрять и тебе не хочется зависеть от внешнего источника а потом мы поняли А нафига нам хранить докер образ с какой-то условной двой в каждом репозитории если они все одинаковые как в манифесте хакера Вы все одинаковые и мы это тоже всё поубирать в собственные как бы группу Где мы можем версионирование используется то что им действительно надо вот дальше самое главное ради чего мы здесь все собрались Святой Грааль пайплайф то есть мы на данный момент убрали из репозиториев продуктовых всё кроме Ну вот тут уж точно ничего не сделать pipeline типа он пишется в репу это максимум до чего мы дошли и в целом хорошо живут Ну да приходится копипастить пайплайн Но к сожалению это только начало и всё это можно сделать по-настоящему псов Ским мы это делали в несколько этапов мы ошибались и учились я здесь написал и здесь мы переходим к следующей стадии пути героя В путешествии это испытания и соб то есть вообще убрать пайплайн из репы - Это довольно жёсткое испытание Ну и вместе с ним возникает довольно жёсткий Соблазн при этом это испытание делать на системе которая изначально этого не подразумевала она сделала так что тебе надо положить файл с пайплайф А ты говоришь нет Нам не надо да ребята Это не попсов вот что же нам приходит на ум ну самое первое это использовать вообще базовую механику Яла то есть повторяющиеся куски кода в отдельный какой-то элемент изначально с этого ребята и начинали то использовали ям якоря допустим убирали там скажем какой-нибудь кусок который реально везде встречается На самый верх и потом его просто вызывали уже получше нача выглядеть потом тут я почему-то пропустил этот пункт ничего страшного расскажу так когда Мы научились может пропу Мы научились вызывать куски кода а потом Мы научились вызывать их и потютьков сказал ладно разрешаем вам ить на бесплатной версии То есть раньше это было платно и позволил нам выносить вообще эти куски в отдельные ял файлики и их просто инклуд то есть всё у нас в сие получается есть такая некая как вот использование либы и мы начинаем уже как бы так какое-то наше подсознание это рептильный мозг начинает говорить блин Вот как будто бы я это уже где-то видел но пока что мы ему такие отстань я тут пишу пайплайн ээ и мы додумались что можно убирать повторяющиеся куски кода файлы их инклюдед а потом мы додумывать рядом Мы же их можем убрать тоже в отдельный репозиторий и тогда во все проекты мы сможем оттуда ить повторяющиеся куски кода и ещё и версионирование ПХП Ну и Rules То есть это такие инклуд ися правила для м сия которые там тоже Ну сейчас увидите как это выглядит Вот то есть уже как бы Вкусно да и я говорил что это не только испытания но и Соблазны и вот в этом В этом моменте вам нужно остановиться сделать глубокий вдох потому что самый главный Соблазн который здесь возникает это начать бесконечно всё инк Ох ребята кто-то из вас возможно видел Стрим у меня как я не буду говорить куда пришёл работать девопсом по контракту и открылся и там просто файл где 10 строчек только слово in И всё И потом ты идёшь в эти файлы и в них ещё инклуд идёшь в те инклуд там вызовы баше в вызовах баше ещё одни Баши и короче я вот так вот сидел думаю а мне нужно было просто поменять Nexus у его искал Миллион Ну понятно там конечно ты можешь гребную да несмотря ни на что не не делайте так то есть если вы в какой-то момент видите что вы начали писать бесконечно include Скорее всего вы свернули не туда есть такая штука include Hell Я выдумал термин но она есть Как ты её не назови она есть здесь был даже слайд с примерами но он был настолько ужасен что я его удалил прямо сегодня утром и не стал значит смотрите ребят относитесь к getl идам как к en ролям то есть делайте просто атомарные работающие куски кода которые можно тюнить пере определяя дефолтные переменные Вот это минимальная сущность и есть самая как бы правильно работающая композиция прозрачная и ведущая себя так как мы ожидаем и отвечающая Как раз на основные вопросы которые мы зада иному коду очень часто люди вообще забывают что когда в случае разработки они-то могут в идее нажать там Ctrl нажать на Файлик и прыгнуть в нужный пакет кода и посмотреть что там написано и практика разделять всё на пакеты и властвовать она достаточно популярная но когда мы приходим в девопсом по разным репозитория которые надо ещё выкачать А ещё он внутри этих репозиторий люди начитавшись хороших книжек по различном флоус размещают по разным веткам Поэтому у тебя в один момент открывается 10 репозиториев в 10 разных веток и ты уже ещё ты код писать не начал но уже устал уже плохо провёл время уже точно понимаешь что надо снова возвращаться к резюме на ХХ Ну да примерно так это и выглядит и Ох Надеюсь вы вовремя почувствуете вот этот тонкий лёд когда действительно нужно вызывать инклуд когда вот Не надо Ну вот как я уже говорил Старайтесь мыслить одинаковыми абстракция Да вот есть терраформ манифесты там есть терраформ модули Ну понятно что и в форм модулях и в ролях можно внутри и даже в хелм чартах можно сделать зависимости и они будут подтягивать Ещё ещё роли Но это это нужно супер-мега редко и вот когда это нужно Вы прямо почувствуете внутренний голос что это сейчас нужно а ещё надо не забывать что в отличие когда там код ты скомпилированный Гита поэтому у вас пайплайн может превратиться в Запорожец который будет минут 20 только прогреваться готовиться всё необходимое закачивать вгруди был на слайде скриншот с моего стрима где я вот так вот сижу а на экране это и он на строк хотя там сй на две джаб по строк То есть вы точно этого не хотите так тут значит объяснили погнали дальше здесь я решил вам немножко показать как это выглядело у нас на проектах то есть Это пример getl идов есть у нас некий do в котором мы выносим такие самые базовые джаб без которых вообще Сложно представить сборку докер образа Да это Dock Lin docker Build и docker Push Ну причём кстати здесь как можете видеть do Push внутри уже вызывается докер логин очевидно Мы хотели бы залогиниться перед тем как пушить и нам нужно Это явно сделать вот Обратите внимание что всё используют переменные то есть мы не хардко ничего этому мы с вами должны были научиться ещ В разработке ролей То есть если ты пишешь что-то Что относится толь к конкретному проекту не пиши пиши переменную и выноси это туда и пиши для неё дефолтное значения дефолтные значения переменных которые здесь используются типа docker Build docker DIR Image ID docker F они есть Просто они будут чуть дальше то есть это пока что верхушка да то есть какие-то такие кусочки из которых соберётся сама J и вот непосредственно сама Ja do Build D у нас там есть do build я решил показать более такое привычное для смузи доклада это И вот вы видите что у самой как бы глобальной джаб есть переменные которые все сразу задаются как ролях то есть всё предопределено заранее то есть и по дефолту никакой до по дефолту можно определить поэто у нас там своя свой стандарт который мы применяем вам это может не подойти Но у нас просто пайла так пишутся что мы берём из днема Вот и дальше Просто вызываются перечень всех ранее определённых джав кусков джав кирпичиков Да вот примерно так выглядит об фа Ну вт боль билда каника и так далее а впоследствии мы его как бы просто вызываем как референс внутри сия и просто Обращаемся типа Сделай мне docker Build это мы сейчас ещё тоже покажем давайте пока такую остановку сделаем Что же нам в итоге до делать с пайплайн то есть мы сейчас вынесли куски пайплайф Репе они уже уехали успешно версионирование что с ним-то делать в нём сейчас у нас всё что есть это набор икв И потом скелет из джав которые вызывают наши вот эти кирпичики которые Кроме того ещё и ются через vbl выглядит как реально PlayBook при этом у нас есть gbl наши любимые которые позволяют даже не переопределять самим какие-то переменные просто имея проект уже затюнить джобы под этот проект то есть Помните я говорил да что у меня от Джоб нейма зависит Image ID так и помимо этого есть ещё Project variables и Group variables они нам что помогают делать Project variables помогают нам какие-то весы настроить там скажем для лма и разработчик например может тоже их там поменять maintainer например Group variables - это чаще всего секреты которые мы назначаем там типа кубе config чтобы что-то смогло куда-то подключиться что-то что не нужно разраб менять или видеть И вот так выглядит примерно наш gitlab C фа на данном шаге истории как я уже говорил да есть иды видите Да do Build ится конкретной версие ну здесь у меня M в этом примере и вот deploy тоже ится конкретной версии и дальше у нас просто Скелет вот видите Build PHP fpm и мы пишем extens do Build всё там он уже определ и нужная версия у нас вызвана здесь вот мы пере определяем стандартные переменные которые прописаны в инклуд Джа то есть мы указали Какой нам конкретно здесь нужен порт Какой файл подключить какой UB config использовать и какие вальсы то есть всё круто и дальше вызываем саму Джоб уже из этих икв здесь в принципе всё понятно но нам с вами хочется узнать-то в итоге самое главное что же нам делать-то с этим сием и тут мы понимаем с вами что этот C он одинаковый для вот однотипных проектов то есть для всех проектов с ПХП этот сй будет одинаковым для всех проектов с двой он тоже будет одинаковым потому что там просто скелет из инк дов и джабо ну вызова и всё что отличается это Вари былы которые в самом лабе что что-то вот прямо как будто вот знаете витает в воздухе о чём мы забываем постоянно а а мы забываем что нам вообще этот C здесь больше не нужен потому что gitlab нам позволяет унести C файл в отдельный репозиторий и просто его подключить то есть мы можем заставить репозиторий брать полностью описание пайплайн из другого репозитория вот здесь на примере вы видите тут прям внимательно Посмотрите пото что здесь три важных момента первый это Откуда мы берм проект конкретно здесь написано devs это группа gitlab flows и дальше Flow который называется PHP docker Flow это проект то есть вот из этого проекта мы будем брать C далее здесь же можно указать ветку либо г который мы берём Я указал Main чтобы вам было проще понять где здесь ветка Да а то я написал бы Саня и вы такие что это не понимаю написал То есть мы можем ровать наш он может развиваться и на разных проектах одного и того же там ПХП например или джавы мы можем использовать версию разную Ну это просто базовая история Чтобы никого не аффектив в какой-то новый этап а он не всем нужен Ну ребята должны Придя утром на работу не увидеть упавшие пайплайн поэтому мы никого не офек так как везде подключено стабильная версия которая конкретно для них и самое главное помимо репозитория ветки ещ мы можем указать конкретный файл То есть у нас например вот в разных Да вот есть ХП do Flow есть PHP без do Flow есть там Java и так далее То есть под всякие истории есть несколько разных схем пайплайн здесь написано тест Это означает что там есть шаги с тестом с билдом и слоем на проектах на которых тесты пока не написаны нам ещё не нужно тест мы подключаем просто Build deploy яму То есть у нас есть общий репозиторий где Flow по какому-то стеку в нём есть версии по тегам и веткам Да чтобы Мы понимали что нас никто не не за аффектион Нам нужен под наш проект то есть супер камизи Тема и вы всегда точно знаете что если на одном проекте работает то и на другом капец у нас время тикает Я так и знал что не успею погнали супер мега Быстро прям в двух словах значит это же всё меняет да то есть в проектов вообще не осталось ничего лишнего только файлы разработчиков наконец-то всё что не относится всё что относится к эксплуатации вообще оттуда вычищенный лежит по вот этим ру это ВС наша точка истины Мы правим один пайплайн вместо тысячи никого не афек благодаря версионирование Да здесь у меня отсылка на параллельный доклад Жени это кольцо всевластия Да один пайплайн чтобы править всеми Женя привет У нас с тобой одинаковые доклады параллельно друг другу Но мой шире для теперь деб специалисты разрабатывают собственные продукты то есть мы не сидим и не Пашем на проекте Да мы такие так надо разработать лоу для вот такого вот набора то есть мы превращаемся в производителей решений то есть мы разрабатываем продукт которым будут пользоваться заказчики а то бишь наши команды то есть команды - это заказчики потребители продукта на весь наш код начинают наконец-то Господи 5 лет об этом говорим применяться все практики работы с кодом У нас есть код Ю на пайплайн код ревью на куски пайплайф очень просто подключить к системе То есть если нам нужно от деть проект мы приходим с своим мешком вот этих кирпичей смотрим Что нужно этому проекту из кирпичиков выстраиваем нужный готовый пайплайн вот так смотрите как это выглядит Ну нам там я помню обещали пять бонусных минут Мы сейчас их потратим значит смотрите кирпичики Я люблю представлять как кирпичи Lego такие у нас есть решение для всех повторяемые задач и приходя на проект мы смотрим что им надо и выбираем нужные кирпичи нужных версий Да и собираем для каждого проекта нужный им пайплайн он как бы для них становится частным но при этом каждый его кусок Вот под лупой - это Общее какое-то решение где-то разработанное проверенное про ревью иное и оно точно поведёт себя так как мы этого хотим Ну основные бонусы Я уже озвучил да то есть мы можем версионирование одна конкретная тест версия Юнит тестов более того мы можем в разных проектах и в разных в ветках одного проекта использовать разные версии конкретного блока да то есть вот тут на примере с Project 2 Мы в релизе 2но используем новую версию тестов как бы вообще всё супер Понятно становится И самое главное наконец-то здесь получится что если у нас проект собирался в разных версиях по-разному то у нас для каждой из них будут для каждой ветки подключается разный этот как его зовут тег и C мы перестанем афек прошлые его релизы что теперь о как мы удачно прям конец презы что же теперь Ребят а теперь Значит у нас новая работа псов команда у нас превратилась из operations в Solution прова Ну либо solers Ну и то и то да Сначала мы с продюсирование потом запровадили мы разработали такую крупную концепцию модульных Панов про это теперь Много говорим и в рассказываем как писать пайплайн модульно а не целым блоком мы назвали этот подход вообще интеграции devops решения на проект Lego Ops пока что это рабочее Название но ему уже больше года я ещё год назад должен был выступить с этим докладом но Переезжал и перенёс его на этот год название можете предлагать в комментариях кстати кстати не забывайте писать свои вопросы в чат доклада Если они у вас есть мы обязательно на них отве Да и Приходите на дискуссию поболтаем все вместе э вот да конкурс на лучшее название данного подхода объявляю открытым и самые внимательные из вас скажут погоди какой devops ты же гендир а не devops в смысле же стал Solution провайдером Да действительно в какой-то момент я ушёл из найма но это только улучшило данный подход и его применимость потому что я открыл компанию мы теперь занимаемся B2B аутстаф и то о ЧМ я говорил оно нашу работу делает сильно проще и сильно репета вне потому что приходя на новый проект мы просто смотрим мы уже знаете не приходим такие Так а что там у вас какие-то кубернетес да а тут что мы уже приходим такие как циники и просто смотрим Какие кирпичи сюда надо приносить Потому что когда твои инженеры начинают тратить деньги не сторонние Компани какп то есть мы приходим смотрим Какие кирпичи нужны на этом проекте берм эти кирпичи и самое главное наши Псы с этим умеют работать и они приходя на проект уже знают что делать они приходят Да всё нормально раз раз раз собрали Фло из кирпичей наших то есть мы грубо говоря подключаем компанию к нашему как бы вот как это даже платформе Да коро коробочное решение Молодец коробочное решение не только скорость в как бы подключении devops процессов на проект это ещё и даёт нам возможность быстро переключать псов между разными компаниями даже не то что проектами взял одного Юнита пересадил на другой проект ой другую компанию всё он уже знает что там будет Ну просто другие кирпичики но они все задокументировано это тоже нас этому учит идис программирования всё должно быть задокументировано и логи у каждого вот этого кирпича В итоге все очень быстро вклиниться в работу да так выводы Да мы с вами Ну выводы такие типовые для любого рассказа про про форм про всё экономим время благодаря пере использованию кода получаем ожидаемый результат от деплоя это моё самое любимое год за годом рассказываю про этот ожидаемый результат Лёх очищение пайла и быстрота внедрения тут главное не провались в incl Hell чтобы быстро можно было прочитать про вообще ваш пайплайн Ну и готовые модули пайплайн S Service то есть ну бизнес-модель то есть вообще devops сес у нас получается Ну и дальше я благополучно позаимствовал из доклада Вики вольере с другой конференции эту как её цитату Авраама Линкольна Дайте мне 6 часов чтобы срубить дерево и я потрачу первые четыре на заточку топора это вот как раз про мето деятельности про деятельность Да мы вот потратили время сделали решение и теперь деревья рубятся только в путь что ж мы прямо вообще тиков тику ложились ребята Ставьте лайк за то что я впервые в жизни уложился в тайминг э с вами были кто А я хочу напомнить Я хочу напомнить во-первых Константин что ты обещал какое-то кодовое слово своим подписчикам Да молодцы вот мне напоминают все ребята для тех из вас Кто в курсе секретной игры которую я провожу на Деву обсе Сегодня у нас кодовое слово Лёха Кто бы это мог быть это неважно пока что Лёх у нас много есть знаменитых в нашем чате сегодня кодовое слово Лёха ээ оно не последнее Вы записываете порядок кодовых слов важен э Нам повезло точнее вам что сегодня ком Day вы бесплатно смогли получить ещё один кусочек пазла финальной загадки поздравляю вас с этим Ну и пришло время подводить такой финальный слайд Да это во-первых сказать спасибо за внимание поблагодарить зрителей команду Гру Груп конечно же Льва за то что он вобще оказался в Петербурге И вообще у нас единственный по-моему доклад когда эксперты спикер вместе сидят это такая наша будет теперь с тобой фишка я тоже У тебя буду на твоём докладе рядышком стоять свидимся Уви Приходите на наш слм доклад на в оффлайне в Москве вот ну и для тех кто думает Блин он же обещал в конце QR коды чтобы подписаться на его канал И этот как его чат Вот они я потратил целые сутки чтобы нарисовать красивые QR коды выглядящие как значки соцсетей для которых они предназначены пожалуйста сканируйте присоединяйтесь Вот хорошо проведём с вами время я хочу напомнить Не забывайте голосовать за доклад и Приходите к нам на сессию да на сессию вы ИТМО я не уточнил на какую на се увидимся на сессии"
}