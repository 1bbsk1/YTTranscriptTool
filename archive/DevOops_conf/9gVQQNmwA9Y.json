{
  "video_id": "9gVQQNmwA9Y",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Здравствуйте Добрый вечер Сегодня у нас будет очень интересный доклад тема актуальная в современном мире когда нельзя никому доверять и хочется хранить свои бинарные артефакты где-то рядом под своим контролем современном мире вообще не доверять облакам стоит либо относиться к этому с осторожностью вот сегодня Денисом про это расскажет собственно думаешь каким Абакан ты бы доверял сейчас ну я думаю что как бы вопрос не совсем в облаках Да но в принципе актуальности продукта про который я буду рассказывать я обязательно упомяну сегодня еще раз расскажу почему стоит на него обратить внимание что после доклада у нас будет Да да Давайте я напомню все таки что после доклада у нас будет дискуссия вопросы можно задавать во время доклада в Telegram канале и в конце Оцените пожалуйста доклад нам это очень важно Спасибо И давайте Денисом все-таки расскажет да давайте я хотел бы представить Вашему вниманию воркшоп на тему управления приватными бинарными репозиториями с использованием артипай Так ну Начну с того что Представлю себе Меня зовут Гарус Денис я занимаюсь программированием уже на протяжении примерно 20 лет из них последние лет 15 я программирую на Java в настоящий момент тружусь ведущим инженером тех компаний Huawei О чем я буду сегодня рассказывать ни один современный любой современный проект по разработке программного обеспечения не обходится без использования каких-то сторонних библиотек программирование библиотеки называется зависимостями или по-другому мы можем назвать артефактами допустим в мире Java это Java архив плюс какая-то документ Java документация возможно src и некоторая метаинформация которая добавляется инструментом который позволяет хранить и распространять артефакты Да в мире Java допустим это будет Майн практически каждый язык программирования популярный язык программирования имеет свое хранилище Да это хранилище называется бинарная репозитории и возможно такая ситуация что команда которая занимается разработкой программного продукта какого-то и необходимо не одно бинарное хранилище не один а несколько существует такие инструменты как менеджер бинарных репозиторий как раз который как раз и позволяет создавать разные бинарные репозитории и заниматься их администрированием переходим к картепаю артипай это как раз и есть такой менеджер бинарных репозиториев это опенсорсный проект который стартовал в 2020 году и с тех пор активно развивается инженеры которые уже знакомы с менеджером бинарных репозиториев могут задать справедливый вопрос Ну у нас уже есть такие инструменты как Nexus как артефакторе Зачем нам нужен еще и артипай Несмотря на то что артипаев достаточно молодой проект он уже в настоящий момент реализует широкий спектр репозиториев которые вы можете видеть на слайде Кроме того есть уникальные реализация это Например хекс пьем Если Вы планируете иметь свой репозиторий хранить для хранения пакетов эликсира или кто скорее всего у вас наверное не будет особого выбора Вы будете использовать для этого Кроме того артепай полностью открытый проект распространяется как я уже по моему упомянул под МИД лицензий и не требует покупки каких-либо лицензий он не имеет ограничения на использование типов репозиториев на количество созданных репозиториев на количество пользователей и тому подобное в отличие от тех инструментов которые есть на сегодняшний день так например Но другие инструменты Да вот артефакторе требует покупки лицензии в принципе в современных условиях это может оказаться достаточно проблематичным приобретение этих лицензий кому подойдет кому подойдет артепай на сегодняшний день поскольку в настоящее время проект находится на стадии активной разработки со всеми свойствами этой стадии рисками и трудностями то я думаю что артипаев все-таки подойдет удовлетворит потребности небольших команд небольших организаций также есть достаточно Интересный вариант использования Если вы занимаетесь разработкой каких-то приложений какого-то приложения которые взаимодействует с бинарными репозиториями то артипай может оказаться незаменимым инструментом для написания интеграционных тестов структура артипая но она достаточно простая Да это то есть сервер обрабатывающий запросы напор репозиторий набор адаптеров репозиториев это компонент который отвечает за генерацию соответствующих метаданных и сохранение определенной структуры Которая будет соответствовать типу репозитория в хранилище Ну и сами хранилище а мы из коробки в настоящий момент реализуем файловое хранилище S3 совместимые облако то есть мы также артефакты свои можем хранить в Облаке плюс редис и наверное особое внимание стоит обратить на пользовательское хранилище поиск хранилище позволяет разработчикам самим реализовать необходимый вариант хранения артефактов Например если вы захотите хранить свои данные в распределенной базе данных например такой как апачек знает то Для этого вам будет необходимо всего лишь реализовать несколько интерфейсов собрать жар-файл подложить его в класс под написать конфигурацию соответствующую и все вы можете уже использовать этот свое хранилище так хотелось бы рассказать что мы сегодня будем делать Да что мы получим уже перейдем к практической части мы создадим приватный maven репозиторий вообще если так брать про несколько слов сказать про классификацию репозиториев Марин то различают удаленные репозитории репозитория артефактов которых доступны через какой-то сетевой протокол среди них также есть паблик аудитории публичные и приватные разницы между пабликом приватными это как правило паблик репозитории доступной всем без ограничений любой может подключиться и скачать соответствующий артефакт библиотеку приватный как правило это репозитории которые внутри команды внутри организации используются только ей ну и плюс локальной репозиторий Локальный репозиторий это непосредственно репетиторий который созда на машине где запущен саммен вот мы создадим приватный мамин репозитории далее мы создадим прокси прокси мамавин прокси через Main Proxy мы будем получать артефакты из своего приватного и из публичного репозитории при этом артефакты из публичного репозитория будут кэшироваться это полезная штука Если у вас есть какие-то ограничения С трафиком и вы не хотите постоянно одни и те же артефакты качать по интернету да расходовать трафик то вы можете зафиксировать и уже через прокси получать эти артефакты внутри сети вот далее на примере простого предложения мы будем использовать для для сборки образа токера Open Source инструмент от Гугла Jeep про него несколько слов я упомяну сейчас это инструмент позволяющий контейнизировать Java приложение без использования Демона Докера и без написания докер файла такая вот интересная штука я хотел вам показать как это будет выглядеть то есть вся конфигурация необходимая для сборки для создания образа образа Докера она прописывается непосредственно в том файле Ну естественно для того чтобы публиковать наш образ мы поднимем свой докер репозиторий и потом в качестве тестировщика мы скачаем образ и запустим приложение в контейнере так это то что мы будем сегодня делать вот приступим ну для начала Я хотел бы пару слов сказать о структуре структуре каталогов нашего примера директорий артипай содержит непосредственно приложение darks приложением и конфигурация необходимая для запуска самого типа и создание контейнеров для конфигурации используется файлы в яму формате вот пожалуйста мы их будем мы их все посмотрим что там внутри написано Чего Что необходимо прописать для того чтобы создать наши репозитории каталог Data здесь будут храниться наш артефакты мы будем использовать хранилище файл storage File System и я приготовил два проекта Java 22 Java проекта один из них это будет наша библиотечка которую мы хотим хранить в своем приватном репозитории в принципе это библиотека очень простая Здесь всего один класс который содержит в себе статический метод который возвращает такую строку hellops вот в принципе Этот проект закрою поскольку он нам больше как бы не пригодится Да посмотрели что он делает этого вполне достаточно Так что еще есть Ну еще момент settings для выкачивания артефактов Да но это я потом Позже покажу его содержание вот в принципе все ну Давайте приступим к созданию репозиториев так Давайте посмотрим на конфигурационный файл артипа в принципе вот четыре строчки и их достаточно для того чтобы запустить наш экземпляр артипа ключевое слово Мета и мы указываем storage этот storage предназначен для хранения конфигурации репозиториев FS это расшифровка от файл систем аббревиатура файл System и путь Где будут храниться конфигурации репозиториев Как выглядит конфигурация репозитория файл называется My marven Yamal здесь одна особенность имя файла это в последующем я покажу это будет имя репозитория то есть в нашем случае будет репозиторий с названием Давайте посмотрим содержанием ключевое слово репа говорит о том что эта конфигурационные файлы репозитория тип как Неудивительно мален мы поднимаем репозиторий сторож файловая система и указываем путь Где будут храниться наш артефакты в нашем случае как я говорил Это будет Папочка Data Ну и для того чтобы разделять все-таки артефакт который мы получим от публичного репозитория через прокси то идет разделение плюс еще провод Вот сейчас эта папка пустая в принципе все готово для того чтобы запустить артипай и создать maven репозиторий Я подготовил такую командочку чтобы Ничего здесь не набирать открою окно терминала вот ну команда в принципе указываем джар файл config файл путь к конфигурации я назвал файл 83 поскольку мы будем поднимать этот экземпляр типа на порту 883 и соответственно вот указывается порт на котором мы будем поднимать экземпляр чтобы поскольку у нас будет несколько Чтобы не перепутать между собой вот я немножко разнес по именам запускаем вот стоит обратить внимание на вот эту строчку видим что артипай поднял репозиторий с именем на порту 883 я заранее собрал джарку с нашей с нашей библиотекой и сейчас хочу вам продемонстрировать Каким образом мы ее за диплом в наш только что созданный приватный удаленный репозиторий диплоить мы будем ее с использованием стандартного маминского плагина я также подготовил команду в принципе здесь ничего такого нету указывается координаты гропади артефакты 1 плюс версия путь к файлу и уже в качестве урла идет наша репозитории мамин вы видите порт 883 И как я говорил имя репозитория это имя файла с конфигурацией запускаем произошел download использовался репозиторий наш все успешно Давайте посмотрим как это выглядит на диске для этого переходим в папку которая говорил что у нас будет хранить наш артефакты открываем вот появился каталог с именем имя репозитория имя файла все соответствует и плюс артефакт который мы закинули в наш репозиторий вот непосредственно артефакт и плюс метаданные структура каталогов и которые используют артипа для хранения любых артефактов она соответствует той структуре которая использует непосредственно сам бинарный репозиторий Вот теперь давайте посмотрим как запустить прокси под прокси Я тоже подготовил в папку поскольку мы разнесем по портам я назвал файл май артипай 84 запускать будем на 84 порту сам файл есть на него посмотреть то конфигурационный файл Ничем не отличается от того что мы рассмотрели раньше ну за исключением того что каталог в котором будут храниться конфигурационные файлы репозитория другой информационный файл репозитория несколько отличается это уже будет тип Main Proxy в разделе Remote указаны репозитории которые будут использоваться для получения артефактов вот наш репозиторий и плюс публичный репозиторий публичный репозиторий настройка публичного репозитория расширена тем что мы еще указываем кэш в качестве кэша будет использоваться также сторож на файловой системе и путь Где будут храниться артефакты которые мы загрузим из публичного репозитория эти артефакты будут загружены у нас на диск И следующий раз когда кто-либо запросит этот артефакт через прокси мы уже не будем обращаться к публичному репозиторию а выгрузим его из нашего вот в принципе и все о настройке Main Proxy Давайте запустим откроем еще одну вкладочку я также заранее подготовил команду по запуску инстанция артипа команда та же самая то же самое джар файл но отличается естественно свой файл конфигурации и порт запускаем проверяем всё был создан репозиторий Майн прокси стартовал на 88 четвертом Порту Ну теперь самое время посмотреть на наше приложение Наше приложение которое мы будем собирать оно использует несколько артефактов да как я говорил первый артефакт Это непосредственно наша жарочка которую мы положили в наш приватный репозиторий и артефакт из публичного репозитория Я выбрал гуава такого отверстий посмотрим так ну гуава знает мою библиотеку не знает поскольку Марин когда загружает что-то из удаленного репозитория он этот артефакт сохраняет в локальном репозитории на машине где он был запущен поэтому необходимо для того чтобы у нас честный выкачка артефакта из через прокси надо почистить локальный это локальные репозиторий Да вот у меня здесь какие-то главные уже есть артефакты я их удаляю смотрю все теперь мое приложение не знает о том что Такие артефакты есть и мы должны будем выключить выкачивать я их буду с использованием следующего использованием следующем Майн settings вот указан наш мамин прокси через который мы будем качать и собственно то этого достаточно для того чтобы уже начать использовать этот Main Proxy Я подготовил также командочку которая будет компилировать проект и в процессе компиляции соответственно будут разрешены зависимости переходим новая вкладка Вот maven campile но плюс еще флажок с указанием settings все успешно смотрим вот получение Хеллоу лип нашего артефакта который был загружен до этого в приватный репозитории и плюс еще получение уже артефакта гуава видим что все команды Да все у нас произошло Через наш прокси Давайте посмотрим как это выглядит на диске вот на диске создан опять-таки обращаю Обратите внимание на название каталога Майн прокси он бьет с названием файла конфигурации и файл имя файла конфигурации это имя репозитория смотрим вот выкачанный артефакт в следующий раз если мы будем его запросим его У нашего прокси и его не окажется в локальном maven репозитории он будет уже получен с диска вот Ну дальше чтобы сделать образ приложения и поместить его в наш докер репозитории мы должны соответственно запустить этот докер репозиторий Так для этого переходим в папку с конфигурациями Я просто взял конфигурацию Майн до скопировал ее и сейчас я переименую Файлик назову его май докер соответственно наш репозиторий Докера будет называться мой докер Ну и все что необходимо сделать для того чтобы у нас появился репозиторий Докера это изменить тип с Марина на docker сохраняем все этого достаточно ну здесь видим естественно все зависимости были разрешены мы все зависимости Все получили вот этого достаточно для того чтобы уже начать пользоваться репозиторием докером вот Обратите внимание что я не при запускал Майн не перезапускал арки пай поскольку когда мы обратимся к артипаю попросим его чтобы он что-то положил в репозитории докер или что-то скачал из репозитории докер он обратиться уже К папке Где хранятся конфигурации файлы с конфигурациями найдет необходимую конфигурацию и поднимет соответствующий создаст под ними соответствующий адаптер репозитория поэтому мы можем даже не перезапускать А как бы вот на Живую изменять конфигурацию добавлять какие-то новые репозитории Вот давайте посмотрим на помпу в части джиба джип позволяет создать образ java-приложения без создания без написания докер файла вся конфигурация у нас содержится уже самом помните вот мы используем для этого плагин Гугловский вот вся конфигурация в принципе этого достаточно для того чтобы создать образ стоит обратить внимание на вот эту строчку Да здесь указан уже наш репозиторий Докера Ну и просто ими какой-то как будет у нас называться наше приложение вот приготовил я также командочку она очень простая что у нас все очень простое все делается легко и быстро запускаем Так ну сач так небольшая заминка сейчас Так давайте ка посмотрим Скорее всего я где-то наверное все таки опечатался когда так все я понял в чем проблема скорее всего генеральский эффект Когда у нас происходит прогон почему-то такое иногда бывает что что-то я в принципе то скорее всего я печатался в файле конфигурации Извините пожалуйста за задержку все-таки волнение некоторых Да вот мы видим что у нас все собралось был опубликован наш образ вот такое бывает волнуюсь как это выглядит на диске Вот Мы создали создался соответствующий каталог с артефактом докером непосредственно сам артефакт и необходимый метод данные вот таким вот образом у нас как бы все собралось Ну и все готово для того чтобы перейти к финальному шагу Да мы в роли тестировщика сейчас попытаемся скачать этот артефакт Ну и самое интересное наверное то что вот артефакт у нас был опубликован но если перейти допустим и посмотреть как что у нас в imagers Докера на локальном диске то мы увидим что этого артефакта здесь нет То есть другими словами джип создал образ токера и положил его сразу же непосредственно в репозитории удаленной репозиторий при этом он не использовал демон Докера Вот теперь давайте попытаемся получить А ну еще одна особенность небольшая про докер Если вы будете это повторять У себя на своей машине то наверное необходимо об этом упомянуть адрес обратного вызова для демона Докера он отличается от адреса обратного вызова который у нас операционной системе поскольку демон работает своей подсети поэтому для того чтобы нам обратиться к себе нужно использовать внешний ip-адрес посмотрю какой здесь внешний ip-адрес так копирую докер пул и остальную часть я скопирую из отсюда Так а ну докер демон докер еще он по умолчанию требует чтобы мы использовали безопасное соединение Но поскольку мы подняли артепай как соселя Хотя он поддерживает SL просто чтобы не перегружать доклад то соответственно нужно прописать еще файле конфигурации для Докера что мы доверяем себе и можно качать Без проблем Так для этого мы для этого мы должны прописать так Одну секундочку небольшая У меня здесь за таком вот все просто забыл сочетание клавиш которые позволяют посмотреть каталоге так прописываем IP адрес в insecure registers это настройки Демона Докера закрываем Так ну и Давайте попробуем выкачать для того чтобы теперь это все поднялось нужно еще рестартануть непосредственно докер чтобы он подцепил новые настроечки в принципе для того чтобы локально все это запустить это нужно делать такие вот небольшие упражнения Но как правило у нас все-таки удаленные репозитории он запускается не на той же машине на которой мы качаем свои артефакты так потребовались у нас еще дополнительно указать Да по умолчанию мы ничего не меняли в настройках безопасности поэтому по умолчанию у нас используется юзерные марки пай пароль артипай Так секунду сейчас мы авторизуемся так и теперь выкачиваем вот успешно выкачили это уже был получен образ с нашего докер репозитория Теперь мы можем посмотреть что у нас появился образ на локальном диске на локальном диске А на локальном репозитории Докера уже Давайте запустим его вот пожалуйста было запущено уже наша Java приложение Ну Какой вывод можно сделать Да все таки конечно какие-то вещи Может быть не совсем легко даются нужно очень внимательно работать с конфигурационными файлами стараться не опечатываться как вот у меня получилось опечаточка небольшая Да в конфигурации докер репозитория но в целом возвращаясь к нашему нашей презентации почему же стоит выбрать Почему стоит на него обратить внимание потому что артипай это прежде всего полностью открытый собственный проект который не требует покупки никаких лицензий не имеет никакого никаких ограничений реализует все популярные бинарные репозитории расширяемый То есть вы можете сами добавлять какие-то хранилища которые вам необходимо в последующем еще хотим некоторые плагинчики добавить Да какие-то которые позволят вам добавлять новые функционал при этом расширяя существующие существующие фичи и активно развивается Мы приглашаем вас принять участие в его развитии есть телеграм-канал типа пожалуйста Мы ждем от вашего от вас какой-то обратной связи предложений и Можно также поучаствовать написании кода переходите на github ставьте звездочки Если вам все понравилось в конце презентации подготовил некоторые полезные ссылки это документация артипая где Можно поподробнее узнать о том какие есть у него функции какие есть возможности и как его можно также еще сконфигурировать другие репозитории Кроме тех которые мы сегодня рассмотрели документация на джип потому что я сделал минимальную конфигурацию которая необходима для того чтобы просто Сделать образ Докера и ссылка на мой github аккаунт там где сохранил все файлы конфигурации которые мы сегодня рассматривали которые мы сегодня запускали Спасибо за внимание Я закончил готов ответить на вопрос есть какие-то вопросы появились еще раз Прошу прощения за некоторые технические задержки все-таки у нас живой воркшоп живой воркшоп все делаем по настоящему хорошо да спасибо на самом деле действительно бывают заминки Когда наживу это все работает но зато видно что эта штука работает и по крайней мере вы решить проблему можно в прямом эфире но Давайте Наверное сделаем как у нас есть несколько вопросов один из которых даже я хотел задать одним из первых да как на правах эксперта собственно первый вопрос Мы наверное обсудим здесь а следующие пойдем обсуждать экскурсионную зону а собственно Владимир Да задает практически идентичный вопрос который я хотел как я уже говорил задать это вот при хранении артефактов артипай выглядит так что мы все храним на файловой системе Что будет если у нас будет очень большое количество артефактов если какой-то поиск какие-то индексы какое-то расширение текущего модели хранения поиск артефактов у нас мы планируем его разрабатывать как я уже говорил все-таки у нас проект еще на стадии активного развития и вот это одна из фич который мы запланировали да то есть мы сейчас пока в настоящий момент еще развивали мы набирали количество репозиториев Вот то же самое пакеты для хранения эрланга это фича была добавлена буквально несколько месяцев назад то есть мы активно развиваемся мы создаем какие-то новые функциональности мы сейчас добавили Вот как раз фичу опять-таки недавно это пользовательское хранилище как упомянули да то что если вы не хотите хранить на файловой системе хотите хранить где-то Где вам удобно пожалуйста Элементарно реализуется несколько интерфейсов и вы можете использовать свое хранилище индекс Поиск и dashboard у нас dashboard у нас сейчас в работе находится да то есть сейчас мы его разрабатываем он буквально был включен в roadmap на 4 квартал этого года буквально в прошлом квартале мы завершили разработку рестайпи То есть у нас совсем такой молодой проект в стадии активной разработки и есть Задачка она в бэк логе родмапа это как раз то о чем вы спрашиваете вывод поиск артефактов получение о том что какие у нас есть то есть я правильно понимаю что сейчас при старте просто вычитывается все дерево каталогов и памяти строится Когда вы обращаетесь за каким-то артефактом Да вы соответственно указываете его координаты группы артефакта и плюс версия Если такого артефакт есть такой артефакт это будет найден то вы просто получите сообщение об ошибке о том что артефакт не найден хорошо спасибо тогда я думаю нам имеет смысл переместиться в дискуссионную зону Я бы очень хотел обсудить вопрос performance все-таки этого решения Да и как будете решать там вопросы надежности при условиях когда там некоторые становятся недоступны есть такое в планах Ну и тут у нас собственно есть вопросы от наших слушателей по поводу расширенных возможностей например политик удаления образов но я думаю это все Да с удовольствием спасибо спасибо за внимание Всем пока"
}