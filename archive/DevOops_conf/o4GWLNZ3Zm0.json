{
  "video_id": "o4GWLNZ3Zm0",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "лимассол не их санкт-петербург я считаю их надо перевести через реку аллах уа джалла ва славные как говорили у нас раньше опять это всем привет да да привез доз у меня чувство дежавю виктор гамов уже у нас был привет витя и тревогой cегодня тоже у нас уже был на конференции я тебе тоже пряжи концу как себе домой внутренне для и так как к себе домой но здесь уже хорошо тепло и хорошо встречают поэтому надо я вижу также но только ты уже даже футболочку не переделаешь каждый раз в одной и той же прямо и наверное в тренингах таких затянутыми колечками мы узнаем ну буквально два шага назад случайно и мы все узнаем хочу сказать что в москве 5 вечера время чайной прозой как говорю антон вались нам нужно бороться со стрессом голод и вот от этого всякого гипса я защищаюсь нормальным 1 солодовым десятилетним чаем очень рекомендую вот просто чтобы вы были в курсе но я тоже могли сделать вид что у меня налетел в чашке что-то очень вкусная ну ладно у меня там пусто вот смотрите по честному я не изображаю итак давайте все еще чуть чуть чуть ближе к теме сушу меня вот вопрос такой я когда прочитал описание доклада но я бы сказал что это вот история которую ты хочешь нам рассказать она подходит чуть ли не под любой современный проект я прав или это все-таки и позиционирует вот для каких-то определенных вещей история подходит под любой современный проект я просто хочу рассказать как мы свой определенный проект тоже взяли и запихнули вот в это дело поэтому на основе вот этого рассказа многие узнают как практически любой пройдут можно будет так вот крутить вертеть ее к отрегулировать переводе современные проекты с кафкой ну и не только с кафкой можно сказкой и главное что был кубер найтись мы же знаем каберне tits 2020 год год кубер не tissot простите но тут чуть-чуть обернитесь edit двигайся нам обязательно нужны потому что github списке то это как-то немножко странно это странно да это странно это как detox без китае так как армия без солдата движения есть прогресса нет как apache дисков киликов cabeza патча которых там теперь разберем ну что ж ладно давайте не будем мучить слушателей нашими остротами и тем что у нас у всех что-то тут налито начнем с помолясь как говорится дождем помолясь свой молясь это явный уже выпил так что предлагаю сделать видео на весь экран или приза его на весь экран и давайте же послушаем что он нам расскажет так давайте проверим что все работает проектор работает как вы проектов ноги это шутка никогда не устаревает поэтому естественно что это не проектах и the screen шиллинг у нас до сегодня добро пожаловать на доклад apache кафка devops of cabernet гипс очень такой получилось подбор дна чтобы много народу пришло и и собственно послушала про этот доклад о чем мы сегодня будем разговаривать я расскажу буквально настоящим слайды для если вы пропустили мой первый доклад в этом году на этой конференции меня зовут видите гамов я работаю в компании контент мы делаем streaming платформу и делаем облака кафка и я выступаю рассказывать всякие вещи о кафке стрим про сынги управлением вот этим всем зоопарка мы тогда ли там подобные найти меня можно практически везде если вы не можете найти ни где значит я плохой дебила pro 2 кейт и как бы это мне надо это меня гнать и гнать из профессии вон вон из профессии как говорится способность проходить на youtube я постараюсь каждый вторник каждый среду а делать slim и где мы разбираем какую-то часть технологии в течение если часов иногда я призываю гостей очень интересно получается и мы говорим не только программируемый варим просить operations the deployment и прочих прочь то есть вот такое если слово apache кафка вас не зывает ощущений про какие-то нативные народы севера американских штатов или какие-то ощущения которые связаны с прочтением литературы от известного писателя приходите в наш чат здесь мы говорим как раз просто поделённую стриминга систему и там можно задавать вопросы все такое то у нас сейчас в телеграме парковке у нас еще канал он мол трафик но чад там вся движуха происходит в чате еще важный слайд если если вдруг что-то оборвется если что-то потеряется если что-то сломается всегда можно взять сфотографировать вот этот слайдик и вытащите все примеры там можно найти пример репозитория которые я буду говорить это тот проекта которым мы начали разрабатывать у себя в нашей в небольшом кусочке то что то что называется наш отдел девелопер экспириэнс и вот этот эксперимент и которым я сегодня буду рассказывать какие вещи мы научились можно найти там значит еще один важный слайд этот слайд в котором ну собственно весь этот зоопарк нужно принести показать что у нас здесь будет происходить в вкратце опять же есть вы от нас отключитесь через пять минут то вы все-таки можете узнать о чем мы говорим сегодня мы будем говорить про github соответственно мы будем говорить про гид как это и будет интегрироваться с нашим то что куда мы все это дело тепло и конкретная имплементация вот этого github с оператором будет используется флаг сиди мы будем использовать shell оператор для определенных таких штук о которых я тоже расскажу для того чтобы заводить ресурсы которые может быть изначально не являются клауд не тиф но эти ресурсы тоже хотят быть и клауд нить и фум и поэтому будем заводить решил оператор ну и там уже собственно наши где наши постоял и собственно за кодеки у нас вот здесь будет немножечко кафки у нас вот здесь где мы этот самый картинка вот здесь будет немножко кафки будут всякие стримы будут кембридже ствий и прочее прочее прочее вот эти все штуки мы сегодня поговорим для тех кто первый раз может быть слышит про кафку но интересуется я сделаю не то что у кафка vanvan потому что мы сделали достаточно хороший коп кого ну лан с моим предыдущим коллегой санаториям мы делали доклад с которым мы забрали всякий инфраструктурой особенности самого начала здесь я в виду в такой узкий который сейчас является наиболее таким горячим наиболее использован боюсь кейс по построения микро сервисной архитектуры на и обмена данными внутри микро сервисных текстуры с помощью apache кафка и у подхода который называется and streaming или поток или захват потока сообщений или событий так что мы давайте поговорим вот например текущее состояние дел в мире микро сервисов 0 обычно как мы это все дело проектировали когда проектировали эти сервисы сервисы само действо через и пьянь один сервис например если ему нужно получить данность другого он может обращаться к нескольким сервисом одновременно и вызывает их напрямую то есть это вот такой подход который появилась на заре вообще становление идеи микро сервисов становление раз пилотах у монолита в в маленькие маленькие под программки но к чему это в большей степени приводила приводила потому что у нас такой получился асинхронный монолит потому что все равно сервиса взаимодействовали хотя хоть и самостоятельно все равны друг от друга могли зависеть каким-то образом при при внедрении подхода который называется вот event streaming или как бы потоке событий или захват вот этих потоков событий мы перестаем мыслить о состоянии системы как о каком-то конечном варианте но мы начинаем рассматривать систему скорее как какой-то поток какие-то событий и если у нас есть какая-то система в данном случае apache кафка является системой которая захватывает все события которые происходят системе то из этого можно делать несколько вещей например всегда можно в любой момент восстановить какую-то историю которая и леванта для определенного сервис то есть если у нас эти события были захвачены в одном как в этом месте то каждый сервис может из этого вынести какой-то определенный свой свой вывод который непосредственно необходим для этого сервиса также так как эта история так как это вот поток в этих событий хранится в кафки кафка продукт предоставляет возможность все это дело хранить на диске то есть это сидел не теряется мы всегда можем переиграть это поток событий чтобы вычленить какие-то там и иные факты про мы начинаем новую какую-то систему и это новая система будет взаимодействовать с нужного несколькими старыми данным я там потом уже покажу конкретно в пыль имитация как это будет выглядеть на технических каких-то моментах но вот это такой принцип по сути дела все что происходит системе представляет собой событие это событие является неизменяемая она записывается в этот лог и выглядит это как вот транзакционный лог что нам это дает в разрезе микро сервисов разрезе и вот этого микро сервис на взаимодействие или кросс процессного взаимодействия когда у нас система была монолитная когда у нас система была состояла из компонентов которые были внутри внутри данного большого большого-большого монолита мы могли доставлять наружный доступ через различные там и пиа и или там может даже только через баз данных и так далее при переходе к вот этому подходу с который связан с событиями у нас все сервисы общаются через вот эту единую точку входа который является наша events 3 мин платформа то есть вместо того чтобы например это использовать базу данных до для записи и здесь могут различные проблем возникает при том какую ловить измени никаких перестраивать и так далее вот это подход позволяет это все дела решать мы многие моменты опять же обсудили я не буду опять же останавливаться на них сегодня но вкратце это просто подводит меня к к тому же чему shogun deploy после вот этого рефакторинга и системная архитектура выглядит следующим образом то есть происходит такое разбиение на абсолютно независимые компоненты и эти компоненты в домодедово посредством передачи сообщений через различной кафка как или там например это не отменяет наличие баз данных углу или наличие какого-то хранилища внутри самого сервис наш сервис сам по себе может использовать и должен использовать какое-то хранилища для того чтобы оставаться как вы говорить по русский design and оставаться не непотопляемым да и в конкретном случае там есть определенные инструменты которые позволяют решать ту ю проблем без например даже дополнительного кодирования в данном случае как пример такого инструмента мы сегодня тоже его будем рассматривать является инструмент который называется кафка connect он включается в стандартный стандартный пакет apache кафка он является таким ну можно сказать applications и сервером для коннекторов которые позволяют цепляться к различным базам данных то есть ваши два сервиса на самом деле могут продолжать если там про какую-то legacy сервис который не умеет или не хочет или не нельзя его переписать на раба на работу с кафкой этот сервис можно подрезать через или интегрировать другим сервисам через кафка connect подцепляем совс коннектор баз данных одного сервиса и выбрасываем все эти сообщения внутрь кафку тогда сервис вообще не надо ничего знать о том что что у нас происходит то есть это вот архитектура нашего нашего приложения нашей системы которым будем деплоить у нас есть различные сервисы есть сервисы которые интегрироваться существующим система например на примере моей секула я буду здесь показывать как использовать этот коннектор авт убеждайтесь введение не забывайте писать вопросы если у вас они будут по ходу дела возникать пишите обязательно мы обсудим их в экспертной зоне и и так далее теперь переходим detox у при чем тут нет опции где это все отдела то есть что такое detox в моем понимании в разрезе вот того всего о чем мы сегодня будем разговаривать и tops это способ построения систем в которой есть он назвал компонент но два компонента я абсорбируют от каких-то еще дополнительные то ли которых мы тоже можем поговорить такие определенных нюансах значит но для начала мы говорим что есть у нас какой-то желаемое состояние системы которая описывается в виде тех же манифестов для для кубер найти со наших потому что они не были видны которая описывает состояние нашей системы как только состояние этой системы будет меняться при внедрении каких-то изменений например кто-то послал лапу request чтобы изменить мы прошли через эти все изменения мы задали те или иные вопросы тем людям которые хотят изменить весь об алкоголе прошел через эти поры квесты кадры view прошло все заработало и дальше все эти изменения у нас всегда можно отследить система которая позволяет нам обслуживать или так и держать состояние в детей держать состояние в нашей реальной системе является называется гипса пиратов и оператор здесь выглядит именно вот в таком виде о чем вы собственно вот этому сегодня будем рассматривать у меня есть репозиторий в котором хранятся и объяснения он или представление к моих сред то есть у меня-то продам диван бу не трогать он девал тмин и если нам нужно взаимодействие с каким-то внешним системам здесь сегодня у нас будет такой случай когда например система кафки не деза тепло и на внутри кубер нас есть она сама по себе эта система может быть за тепло и на либо отдельно на каком-то железе более мощным чем-то предоста который предоставляет каберне this элиза дипломе где-то в кладут это может быть любой либо клауд провайдер в нашем случае я буду показывать на примере конфу маклауд но это не суть это просто описание подхода которые будем использовать значит этот flags оператор это специальный компонент который будет сидеть внутри нашего купил на это и будет следить за изменения в нашем репозиторий как только что-то произошло в нашем прикуси торе и он будет вот это все дело и нго лидировать он все это дело будет сопоставлять с тем как это должно выглядеть внутри нашего комбинате и давайте начнем немножечко смотреть что я как бы вы тут распинаюсь со слайдами давайте все-таки начнем это все дело трогать нормальная с консоль коми и и и прочим прочим прочим в моем дема что будет используется качестве полик визитов так как я буду взаимодействие своим кластером который с dipline у меня еще не за тепло и на кстати мы увидим как про их будет происходить deployment этого кластера в в claude есть цикл силой мы не можем ничего не делать кубер найти сам без кубка такую контроля home у нас будет использоваться для того чтобы ну потому что flags например приехал видео филм chart мы будем используем чтобы тепло и я начал использовать я до этого использовал docker for тестов но вот мне показали кейт ready это очень такая прикольная среда которая позволяет очень легко запускать локальные кубер найти кластера и для для вот такой локальной разработки и работает все очень прикольно не не сжирает куча ресурсов мне очень понравился говорим про интересную такую штучку это называется куб сил и она будет завязана на то как мы будем обработать секретами и что что у нас здесь будет дело здесь происходить ну и есть такие побочные телике которые позволяют работать удобно жетончиком по удобно работать с противо студия mundo и вот эти вещи мы сейчас будем смотреть оставайтесь оставайтесь со мной я переключу экран data чтобы показать вам что у нас здесь происходит так и как как правильные сисадмины мы переходим в консоль q у меня здесь предварительно был подготовлен и за тепло и на классов в котором бежит мойку вернитесь если мы давайте посмотрим сколько у меня нос сколько у меня здесь много бежит у меня должна быть 5 но дав все это должно убежать не сильно далеко от меня из все это должно быть достаточно быстро без большого так сказать лет неси и раз два три 4 5 модов сейчас на нем ничего ничего не бежит никаких world лордов не бежит бежит только вот samsung убирать сам по себе мы начнем с нескольких вещей где моя подсказочка где моя подсказочку значит некоторые вещи будут необходимы для того чтобы моей скрипки все работали мы используем вот этот репозиторий это будет мой репозиторий где будут лежать этим сделаем так и мы будем сделать вот так чтобы было одновременно всем видно я надеюсь на экране всем видно если что если что не видно заряд вот май внутри когда я буду провяжу найти определенные настройки вот эти все вещи будут вычитаться это будет нужно для моего для моего сетапа дальше у меня нужно мой пользователь пользователь через которую я смогу ходить на этот igip репозитории чтобы мой оператор мог а на него и я хочу работать с определенный branch может он нам позволяет делать branch и достаточно легко все у нас будет подключаться переключаться все будет выглядеть круто поэтому я буду работать вот с этим я диву сам девайс branch и значит следующий компонент который я должен установить это мы о нём немножко сейчас поговорим он называется нами секрет контроллер мы будем использовать вот этот подход для того чтобы хранить наши пароль хорошо лихорадить пароля введите наверно не очень хорошо а если пароль и засекречены то в принципе не так страшно зачастую их создание секретами за сикретов внутри кубера занимается администратор и мы хотим этот процесс убрать администраторы из вот этого круга поэтому мы хотим иметь возможность хранить наши секреты хранить наши пароли засекречено виде внутри нашего git репозитория и что важно это даже будет безопасным можно хранится даже в публичной базе торе и почему потому что он будет зашифрован как это происходит с шифрование значит давайте посмотрим правее контроллер за диплом сюда мы видим что статус available replicas один следующий момент теперь для того чтобы я мог свои секреты шифровать я должен вычислить его опубликуем пищи ключ публичный ключ его хранится на самом деле в его если я пойду скажу ему скажу покажи мне логе вот он лежит его собственно публичный ключ чтобы этот публичный ключ не выдернуть умнее специальной скриптик который называется get паблике значит он просто выдернет и запишет это дело все внутри вот этого файлика секреты вот так он ничего я буду использовать чтобы локально подписать свои какие-то секреты что я здесь храню есть такая вот платформа что называется confront клауд и чтобы работать с этим концом клауд на данный момент существует силой и по не существует но он как бы не публично недоступен поэтому есть только сила для того чтобы работать сила мне нужно залогиниться и этот силой начнет работой соответственно с моим с моим с моим вот этим ресурсов поэтому я должен сначала эти секреты каким-то образом туда пробросить самый простой способ мне отсюда вот я могу пойти и создать это секрет из-за деплоить его в свою руку вернитесь это не освобождает вас от того чтобы правильно сказка фигур там arbok в убираете чтобы все чтобы там все заработало это только позволяет хранить эти секреты внутри кита поэтому давайте поедем и скажем ему на мы создадим 1 to connect давайте никто еще рано мы я хочу вам показать сначала в chrome значит идет мы используем стандартную команду cureit секрет мы не вне запускаем эту команду на кластере мы просто делаем драй ран и записываем результат в наш какой-то в наш какой-то файлик я участвовал создам и как это выглядит на нашем выглядят следующим образом локальные секреты которые мы хотим надо сделать высоту так это обычный секрет если возьму вот это вот сделаю и сделал что-то в стиле и это обычный секрет который заказе зашифрован зашифрован за взять хэш побоишься 4 пароль я вам свой не покажусь но как бы умельцы могут вычеркнуть его из из моего из моего из моего секретов значит мы сделали один секрет и второй секрет который мы будем использовать так как мой компоненты моя моя система будет использовать базу данных мне нужно где-то хранить и пароль к этой базе данных поэтому и я ему сейчас скажу connect секретно что просто просто самый-самый сгенерированный пароль для масел и мы его тоже тоже сделали и выглядит это следующим образом вот у нас есть connect оператор и давайте посмотрим какую пароля для мальчика луна здесь есть все как бы все все все в путь значит мы будем делать вот эти вещи следующий момент как только мы получили секрет опять же это все происходит локально на машине меня как системного администратора значит я могу теперь запустить команду которая позволит мне эти все секреты за собственно за силы в команду напомните-ка мне она по-моему называется что-то в стиле моих сил секретов значит давайте посмотрим как выглядит команда мой мак файл и ям скажу всем майк треть секрет секрет то есть есть специальный скрипт тег который позволяет мне это все дело запустить как вы понимаете никакой devops не может быть без никакой devops не может быть без скриптов об этом мы еще углубимся в более более глубоко значит есть кот и мы просто берем специальные видео но сначала где наши тот сам и берем эти все секреты мы подцепляем правилен worriment в данном случае у меня будет диван и дальше и с использованием публичного ключа которые только что выдернул я создаю вот эти собственно секреты мы запускаем этот таким образом что мы получаем мы получаем 2 2 новые директории нас получается directories tilt сил секреты в которых например мой контент клаус секрет выглядел таким образом все таки это тоже боишься 4-я принципе его тоже могу попробовать развернуть естественно как бы получится не получится да эти посмотрим получается фигня правильно потому что это фигня на самом деле зашифрованный с помощью публичного ключа моего оператора которые за тепло и ну же в купер не this secret который мы можем спокойно положить внутрь нашего это я вам говорю вот так вот так вот так говорю ему live demo live demo tilt вот так вот я могу руками я ему говорю push и все это улетела в мой в мой репозиторий красота внутри репозиторий все это дело должно сейчас появится следующий момент и чтобы все это заработало нам нужно теперь собственно этот оператор который все это дело заведет поэтому мы изберем и инсталлируем оператор работает это следующим образом будет запускаться скрипт который возьмёт и будет передает конфигурацию внутрь этого флаг со давайте пока пока он спускается я вам покажу этот скрип и нет выглядят следующим образом он будет вычитывать из-за informed variables который вещь которая судам прописал например чтобы он брал мои branch и чтобы он брал мою о правильные про правильной репозитории так далее и дальше он должен сделать следующее он выполнит мне ключ который я должен прописать свой бит чтобы чтобы я мог чтобы это все дело могло заработать то есть я вам говорю что flags сиди упс live demo таким образом я его разрешаю этому оператору доступ к своему репозиторию для того чтобы он мог следить за изменениями в нем так как запросили у нас пароль мы наговоримся к эту конференцию хорошо ключ создался не надо спасибо наш флаг сейчас будет что-то делать пока он что-то делает он ждет пока через какое-то время этот товарищ появится всё это подключилась у нас биту и теперь если я скажу видео здесь что произошло он увидел все вещи в папочках инвар mind например если я пойду и скажу по моей попы вот они моим возникнут у меня есть in warm and then бармица ездил и тут есть вот эти мои майкова сервис вот эти мои марка все улицы которым будем деплоить и еще один такой момент я здесь использую к самой это способ сверлите yabla и поверх одного в принципе в идеальном мире об конечно использовал какой-нибудь найди цель которую я скажу позже году тоже надо чтоб типа там наследование сделать все такое но для более простого такого случая я пока использую здесь к самой все мои микро сервисы deep ловится приблизительно одинаковым образом поэтому если пойти посмотреть вот email service у них одна и та же один на один и тот же подход они должны подключить в себе секрет который будет подключать их и комфорт кладу давай сейчас посмотрим что здесь происходит дача на консольку выведу например logo из из блога из цикла пиратов посмотреть что будет происходить и тем как что-то будет происходить что-то происходит я хочу немножечко поговорить про про другое дайте я здесь перестану широт здесь и вернусь в шиллинг на для для слайдов значит используется здесь оператора паторна во все поля что такого пирата паттерн это есть специально обученный человек который знает как делать определенные операции мы берем мы говорим слушай дорогой админ мы очень не хотим из тепло и томба базу данных и желательно чтобы было тепло и теон определенный диски и сзади плоть кафку определим количество модов и так далее и этот оператор этот админ знает как это дело запускать и тот же паттерн очень хорошо начал применяться в мире кубер найти за и поэтому появился такой подход который позволяет писать этот кастом ресурс контроллер контроллер который как основные ресурсы и сидит он внутри вашего кубер нити за он сидит там и принимает команды на различные на различные операции то есть таким образом наш наши flags контроллер это наш это наш оператор то есть если пойти посмотри сейчас я переключусь на консоль мы все посмотрим следующий момент так как я работаю с внешним ресурсам мне нужен способ управлять этим внешним ресурсам и делать там какие-то штуки на это внешним ресурсам поэтому мне я вот использую такой подход к то называется си клауд оператор значит как он работает это специальная вернее даже не специально это такой обобщенный оператор который имеет встраиваться власть сайкл всех событий которые происходят на кубер не теся и вызывать определенные команды в данном случае я ему хочу передать информацию о моем claude чтобы он пробежал по весну чтобы он все сделал так как вот их мне нужно в моем двоим клауд значит сейчас мы давайте чуть-чуть поближе на него посмотрим как это все дело выглядит так вы лет это следующим образом мы вернулись на и мы возвращаемся на значит вы где то следующим образом мой писание моего январь мета описание моего инвар минто выглядит следующим образом уделом нас оператор это такой же под который бежит внутри каберне this а вот так как вы где вода он наследуется с определенного имиджа и дальше туда подкладывать те вещи которые нужны для работы в том случае он туда подкладывать склад силой и работы его выглядит следующим образом есть определенный lifecycle который этот оператор поддерживает означает что нужно в нужный момент будут вызваны определенные методы этого файла и на определенных событиях будет передаваться вот изменения в этом бантинг контексте того ресурса который нас интересует что у нас интересует в данном конкретном ключе и нас интересуют если я пойду скажу им сюда нас интересует конфиг map следующего содержания этот конфиг map должен иметь в себе лэйбл который называется циклом и в этом лейбле будут прописаны все ресурсы которые мне нужно для того чтобы заводить эти ресурсы внутри шкафа club например если я хочу завести кафка кластер здесь то будет та команда которая будет называться где она нас а на оси клауд кафка кластер из нута он читает сначала involvement откуда-то и дальше если его не было он должен еще где-то суметь его создавать кластер лист класс app кредо то есть если кластер был не создан мы воссоздадим как выглядят описание как это все дело выглядит давайте посмотрим опять же в нашем а январь менти то что мы туда будем диплом нам нужен это bass так как оба из это то что одинаково подходит и для одевал android продакшена мы углубимся именно в кастомизированный у версию значит кастомизированный версия нашей говорит о чем есть у нас setconfig map а в котором есть определенный лейбл соответственно этот lame поэтому лейблу будет вызван и вот этим си клауд оператором поэтому я вот смотрите я сейчас здесь в консольки вывел урок из этого оператор и все события которые происходят в этом операторе будут вызываться и писаться суда например смотрите там где но сначала какой посмотрим типо типо типо вот например на создает январь да то есть он и создает этот informing в котором будет тепло и класс парковки вот он создал кластер кафки и этот кластер например дальше готов для того чтобы принимать определенные сообщения здесь здесь в этом ключе я например описываю свой инвайт своей кафки у меня вот есть вот этот класс app который называется мой костер из usb ордер у которого должны быть определенной конфигурации топика должна быть настройка access control list of так как вы деплоить это все дело в балте пользовательский in varmint где у вас есть много различных пользователей и постоянно что-то происходит нужно настраивать x control list и чтобы например одни не могли зайти в другое место когда я вам показывал вначале вот этот пример когда есть макро сервис они обмениваются этими сообщениями это не оставляет как это это не меняет ситуации о том что вам нужно делать restrict доступа чтобы те или иные юзеры микро сервисов не могли читать или писать поэтому и cells это это важно вот и дальше дальше дальше все то есть у нас создали сервис аккаунт который например который connect и кафка конёк будет использовать для того чтобы описать или читать данные давайте посмотрим как материализовалась на самом деле то есть я сейчас зашел в его я увидел этот in varmint кафка devops который мы вот здесь определили вот он этот in varmint 1 января а дальше он также создал с кем уретре это репозитории в котором будут храниться описании или metadata тех данных которые будут ходить по нашим топиком есть micro сервисиз ardors это мой то тут будет тепло это все мои сервисы все здесь будет происходить и если я посмотрю я сейчас давайте мы посмотрим ка посмотрим если дипломе полностью завершился дипломы полностью завершился я вижу что все побегут точит это наверное что-то из из прошлого мы сейчас еще посмотрим разберемся почему он запустился наверное он упал из-за того что что то ни было готово поэтому он перед запускался значит дальше вот они мои все предложения вот эти мои сервисы которые будут взаимодействовать там друг с другом есть у меня моя база данных которые тоже внутри записано там сгенерированные какие-то данные будут и все это дело уже уже бежит в нашем вернуть давайте еще один такой момент посмотрим значит топике топике создали с одной стороны топки те которые я создал для того чтобы мои приложения работали вы видите уже какие-то данные идут туда сюда в эти тропики и приложение которое бегут у меня внутри это приложение кафка стрим кавказ 3 мс также используют кафку для того чтобы хранить какие-то промежуточные данные например там информация о агрегации там например есть пришло сообщение его нужно отфильтровать но ключ не был выбран поэтому нужно этот топик и развернуть так чтобы ключ был явный поэтому туз присутствует этот рипов тишин топик например вот это значит мы приехали в мир в мир оператором пишите пожалуйста в комментарии если есть какие то вопросы по желанию еще раз я показываю повторюсь в нашем в нашем конкретном случае давайте я вам лучше покажу вот так значит вот пополам мы сейчас посмотрим этот описание этого пода это мой оператор бежит внутри этого пода забирает это дело из обычного doki doki registry и и теперь он будет все рот все все конфирмата система пойду ему скажу и например у нас есть конфиг map который называется этот наш собственно конфиг map позволяет создавать этот весь январь то есть вот таким образом мы описываем и это дело хранится у нас детей есть изменение будем собствен проводить мы можем использовать стандартные тулы типа дива и прочее прочее вот поэтому будем делать это таким образом давайте быстренько вернемся к нашим слайдам быстренько значит напомню это что мы сейчас смотрели смотрели на си клауд оператор который был сделан на основе шел оператора который слушает конфиг map по определенному пути и а материализует их в какие-то ресурсы внутри или снаружи значит зачем это нужно зачем это нужно скажите зачем это нужно если был бы меня на проводе кто-то сказал ведь зачем это нужно я привел пример системой которая не имеет встроенного 100 иной поддержки кубер натекла нету такого юз кейсы который позволял бы там легко это все дело праведность какой еще есть такой эскиз например у вас есть узкий чтобы разворачивать какие-то ноды на аверсе вас есть какие-то предложения которые бегут на драку вернетесь и они должны звонить с каким-то ресурсами во весь обвес использовать в с comand line tool например чтобы там опровергнуть какие-то другие сус например не знаю можно через там провернуть ляма ту которую вы будете вызывать внутрь снова предложение это тоже можно сделать с помощью вот этого shell оператор с помощью туши оператор может может сделать много разных других вещей и можно пойти посмотреть на youtube канал фланта где они рассказывают о каких-то вещах они еще рассказали ему на кукане в сентябре поэтому можно найти видосы посмотреть как все работает опять же для чего это сделано чтобы не писать своего оператора нога если вы не знаете его чтобы уже может быть какая-та инфраструктура существует эту инфраструктуру можно например быстренько подвязать и сделать ее такой клад найти ну более менее плотной следующий момент у меня еще есть один компонент который мы не рассматривали достаточно близко но этот компонент связан с кафка connect кафка connect работает следующим образом есть instance капкан это работает как отдельные worker и внутри и квартиру бегут отдельные таски таски представляют собой instance отдельного коннектора который выполняет определенную задачу очень похожи на плите чем сервер и как я вижу можно ли установить и джозеф кафка конёк нет не делать этого в принципе принципе ничего не мешает но лучше не надо это конечно на на уровне шутки но бывает в разные интересы люди как это при приходе определенной конфигурации для нашего connect оператора есть у меня еще один вкус так сказать еще один флеймер для этого shell оператора который называется connect оператор нет это я все еще прохлада пирата все еще рассказываю почему у меня слайды не обновились вот-вот правильно слайд дальше мы говорим про connect оператор 10 происходит в два в два этапа первый этап это мы диплом сам worker потому что worker это тоже и матч в котором бежит какой-нибудь jorney какого-нибудь коннекта но по умолчанию когда мы у диплом он не стартует поэтому нам нужно этот маркер стартовать с определенной конфигурации здесь происходит операция в два этапа первый этап это собственно тепло ментам подоили deployment который включается этого бургера а второй этап это как раз получение конфигурации и запуск давайте посмотрим как здесь у нас обстоят дела и какие собственно настройки у нас здесь нужно соблюсти так переходим в более расширенный экран я надеюсь все вот эти приключения вам видны потому что на меня никто сейчас не кричит значит все видно хорошо следующий момент если мы говорим про бы из давайте посмотрим да коннекта во первых есть следовать им и джеймс конект конект оператор connect оператор тот же самый такой пружин использовал оператор ему нужен только один одна команда карл который будет позволять соблюдать этот часочек давайте посмотрим как выглядит здесь конфигурация где мой откуда он будет вычитывать этот конфигурационный файл значит мы будем смотреть на конфиг map у которого есть лейбл connect и из этого конфиг мапо мы будем выдергивать field дата то есть например если мы говорим сюда мы тепло им сервис deployment мы говорим где он нас конект конект конект конект вот значит в данном случае я использую коннектор который называется бесси каноков что он будет делать он подключится к моей базе данных будет из этой базе данных по определенному ou или где-то каире нас наверно сейчас найдем эту q или учит какую таблицы будет вычитывать узи рэймонд password конвертер так далее тому подобное вычитывать таблицу каста мерз и а пушить все все что происходит в этой таблице каста нас в наш как оффтопик если я вот зайдут сейчас на море в канкун клауд и зайду в коснулись и например пойду посмотрю сообщения сейчас эти все сообщения мне покажутся и эти сообщения изначально были в массе клуба сданных ну не показались потому что надо прочитать все это дело с самого начала и мы должны их увидеть через три два один и не увидели ни одного сообщения вообще давайте посмотрим было ли было ли что-то наверное наверное ничего еще не было в этом в этом в этом топике давайте мы посмотрим если у нас вообще этот коннектор коннектор бежит как мы это дело посмотрим а мы это дело посмотрим с помощью давайте посмотрим давайте пока у нас есть коды вот этот один iconic сервис который эффективнее очень не нравится почему потому что он что-то делает не так давайте посмотрим логе вымывать ним конект конект сервис anak сервис который живой до который давайте сделаем иначе мы здесь возможно ему такую штучку который позволит нам очень быстро навигировать и смотреть что происходит внутри значит может быть mini fat каких-то ресурсов или чтоб этом роде значит давайте посмотрим вроде он подключился правильный кластер используется и коннектор бежит может быть у меня что то не так ой что-то не так в моей базе данных щас посмотрим если я пойду и скажу мой сиквел она должна то при по куллера ваться с какими-то данными вроде все бежит но будем считать что бежит будем считать что есть может быть в ней просто нет данных для этого конкретного дома но смысл смысл здесь такой значит что в чем нюанс такой есть для раков к connect связан нюанс заключается следующем его при наличии определенные возможности и при наличии как бы ресурсов которые позволяют учитывать данные быстрее мы можем его скелет независимо от от независимо от каких-то вещей например если мы чувствуем что данные из баз данных попадают не очень быстро мы можем его этот сервис адски и естественно мы знаем как как правильно или сервисы дают мы варим и он в коллег сервис чистим deployment и мы говорим replicas до 2 вот хранились все значит и я горю available in service статус репликах я брат пусть поднимается еще одна реплика поднимается и 1 то есть я ему сказал дорогой друг пожалуйста мне нужно две реплики а что произошло есть какие-то идеи напишите в чате что произошло почему почему было раз u2 а стала одна какой то какой то этот самый какой-то какой-то непорядок да то есть что произошло давайте посмотрим я вам показывал различные тулы которые в которую вы можете использовать у себя для того чтобы просматривать что дело происходит майкрофта devops я хочу пойти и сервис найти и сказать ему connect и посмотреть все события давайте посмотрим события почему он их не показывает вот андрей правильно смотрел доклад и он все правильно следил потому что гипс потому что github значит то из-за того что мой оператор сидит и следит за тем чтобы состояние моего гетто и состояние моего моего кубер найти со были одинаковые мне нужно этот процесс скиллинга и инициировать через гид все правильно то есть как мы это делаем мы это делаем например у нас есть in varmint который называется div мы говорим connect connect сервис и вот здесь уже вот здесь уже мы говорим две реплики и мы здесь уже дальше мы говорим met all if i do olympus что должно зайти должна теперь произойти все о том как все то что мы хотим мы хотим посмотреть чтобы наш почему почему вот эту эти коды он перебрасывает меня может просто ресурсов не хватает на моем кластере должно хватать я особо нигде ничего нет не устанавливаю через некоторое время давайте посмотрим реплики l2 количестве то что мы и хотели получить теперь мы видим что два пада а бегут и давайте потом вот здесь вот запустились и connect сам по себе уже предоставляет нам инструменты для того чтобы эти вещи для того чтобы нам эти вещи там как-то сами скоординировали все такое потому что и кавказ 3-ем и кафка connect они создавались как раз в том чтобы они работали только через кафку и кафкой всех этих всех этих ребят скоординировать они 22 по добегу пойти я вам еще одну вещь покажу которая позволит нам увидеть всю как это всю красоту и when driving архитектуры в частности хочется посмотреть на то как данные текут и перетекают друг друга мы видим здесь какая-то идет какая-то генерация что-то происходит да то есть кто-то пишет записывает опять же клёво то что у меня вот здесь вот прям пять терабайт из коробки и basic кластере basic сервисе прям вообще красота если вы хотите попробовать вот этот контент клауд напишите мне в telegram чик или в twitter я вам дам q под катом долларов на 200 чтобы могли поиграться с этой штучкой значит клёвая вещь называется data flow и она выглядит следующим образом например у нас есть топик ордера скота в котором поступает все входящие сообщения в нашей системе например вот есть ордер сервис который из него он про и читает и пишет да то есть у нас есть вот какая-то система которая пишет данном случае to connect with data generator который пишет данные в наш топик мы всегда можем посмотреть как данные распределены и как данные учитываются из этих ордеров соответственно если я нажму inspect я увижу кто продюсер кто читает значит и чтобы чтобы посмотреть содержимое этих сообщений я могу пойти обратно в топике не очень удобно но мы работаем над тем чтобы сделать в одном в одной вехе сейчас давайте посмотрим как выглядит наш ордера выглядит следующим образом например выглядит не очень красиво по причине того что это все за зашифровано зашифрован это бинарная информация которая приходит в формате авра то есть у нас есть например схема который описывает что здесь происходит у нас есть ордер в котором есть и die-cast номер айди состояния продукты и кончить и пошел ордер и это все дело писан схеме таким образом другие системы которые будут заинтересованы чтение этих ордеров им не нужно ничего делать экстра для того чтобы понять как расшифровать или как их развернуть этот ордер поэтому они вычитают схему из этого топика и они используют эту информацию например там есть ордер сервис есть фронт сервис который позволяет детектировать различные различные вещи то есть с этой стороны у нас консьюмер с эта сторона у нас продюсеры и здесь например вот можно посмотреть есть там какой то программа которая делает по имени рассмотреть она делает она пишет в топе клеменс садится на можно посмотреть состояние этого топика и какой сервис это все дело вычитывать то есть имея возможность будут это централизованное хранилище того где вся эта информация хранится мы можем мы получать достаточно интересные интересные сайты внутрь нашего нашего приложения значит и где все это делать это взять пример и всех этих сообщений у нас все это дело лежит вот эти вот эти все сервисы у них есть и свои свои deployment и например давайте посмотрим альберт сервис на все пролетает из-за кавказ 3 мс примера который лежит тоже налить хобби он завёрнут в docker и матч и такой bootstrap скрипт который вот эти наши секреты которые были сгенерированы путем взаимодействия с контент клауд силой то есть мы создали там юзеров мы сохранили ключ и пароль для того чтобы подключиться и прописали это вот вот конфиг файл который будет индексироваться качестве клиента в любой в любой наш любой наш под все равно это подключение к кафка класс пару с кем греческий урал это наш собственно и урал куда мы должны подключить и вот такая вот вот так вот таким образом все это дело может быть за dipline зачем я вам это все рассказываю почему нам самим это вот это интересно почему потому что мы например хотим таким же образом мы сделали внутри внутри своей небольшой организации который занимается девала про experience эти люди которые занимаются любил продвигать эти люди занимаются там подготовки для вас различных клевых дымок мы сделали вот этот проект для того чтобы внутри себя продемонстрирует практике о том как можно там constantly постоянно деплоить и эти примеры и и так далее там подобно поэтому вот тот кафка devops который я вам показываю на самом деле он бежит у нас вот здесь в двух дух ипостасях одна ипостась и у нас является девелопмент одна ипостась является production то есть мы например продакшен у нас сконфигурирован для того чтобы ну на грубое я есть этот класс там на которой установлен флаг flags оператор который мы читаем информацию только о продакшене и все это дело постоянно бюджет как только мы праге происходит какие изменения вышла новая версия какого-то кода вышла новая версия в этом обновили пример стримов мы это дело всё сюда переливаем и все это дело запускается у нас но собственно какое слово русская док fucking да то есть мы мы собственно и диму то что сами сами и сделали вы можете взять этот репозиторий и попробуйте поиграться с с определенным вещами например там подкрутить то что то что вам нужно конкретно для каких-то там ваших нужд и так далее давайте мы сейчас мы сейчас переключимся быстро на заключающий слайды мы сейчас уже вы сейчас уже увидели как и адские лил кафка connect через репозиторий то есть мы уже эту дэмку посмотрели показали значит если вы хотите узнать чуть-чуточку больше у нас есть те портал который называется devil по бокам френда то ем там куда мы пишем практически там весь контент который мы зарабатываем мы хотим чтобы была какая-то . куда вы пришли если вы там не знает что кухарка можете всегда пройти там почитать там есть может почитать там посмотреть видосик можно можно пойти взять туториала и пройти там по шагам и все это сделать я даже видос записал почему это мой второй самый любимый сайт на интернете и за сим я предлагаю всех пролиться сейчас дискуссии в обсуждения может быть мы сейчас с андреем обсудим какие то вопросы которые возникли по ходу я думаю сейчас отличный момент ну и собственно да мы мы спасибо всем кто был с нами сегодня андрей кусков очень яркая и громко и напишите нам в telegram канале если вы слышите нас и если все слышно есть определенные вопросы и ну ты уже говорил что-то там спрашивают кафка конец и у меня для тебя тоже есть вопрос для чего все это надо ты предлагалось как бы спросить и наверно давай давай начнем с этого вопроса до первую очередь для чего все это надо для того чтобы иметь у меня была простая задача нам нужно приходит люди спрашивают как нам организовать правильный сиди и наших стримов на нашей кафки мы вот делаем это так нам приходит кит консультанты говорят этот так вот вы ребята из компании комфорт твой вроде как вы знаете как молить кафку вот расскажите нам поэтому мы изначально поставили эту задачу такое больше такого большого проекта который позволит людям иметь понимание как войти как это все дело разворачивать как это все организовывать это раз во вторых это позволило нам тоже изучить скейт всех этих кубов там прям очень кратор потом он очень популярный и у нас даже есть свой оператор который позволяет де плоть кафку в классах я ним тоже рассказал на типсе в предыдущих годах и что он делает он умеет следить за то чтобы кафка бежала в вашем кластере там долго не падала сама лечилась сбалансировалась может быть растягивать стягивать и так далее и тому подобное и этот оператор но он был написан собственно на на нога и он там связан с определенными там вещами которые лицензии прочее прочее то есть есть ли какой-то кто-то хочет использовать этом кафку на кубер нить там есть у нас есть вот этот лицензирована пиратам есть и ресурсные операторы это достаточно большая такая среда в которой происходит очень много вещей вместо того чтобы иметь или там надевать людей которые будут минут вашу кафку люди пишут оператор люди пишут кастом контроллеры который позволяет управлять этим ставком внутри и такой делать такой автопилот и соответственно мы решили посмотреть как завести внутрь кабинете со системы или ресурсы которые не являются кубер на эти снеки поэтому вот после изысканий посмотрели нашел оператор до приходит писать на баше но знаете что самое интересное это не является ключевым каким-то внутренним вы можете писать скрипты на груди и главное чтобы внутри этого имиджа был runtime который позволял эти но мы знаем что нам when a groovy можно писать отличный шанс скрипты да и или даже на код линии кто-то пишет накоплен скрипте можно писать скрипты то есть здесь вас ничего не останавливает если вас останавливало то что вам нужно это менеджер ваших кубер и вам нужен для это учить год не обязательно вам нужно быть чуть для куба вы можете взять уже существующие утилиты которые вы использовали для диплом для управления тем софтом который не не было тепло интернете вот вот этот подход на самом деле показал достаточно интересный результат у нас например там тема есть дома есть и когда мы тепло и морковкой connect с помощью там каких-то там job of передаем эти ресурсы и теперь у нас есть дома где у нас есть свой собственный оператор который в принципе может любой коннектор диплом без каких-то особых усилий потому что чистую крипты которые позволяют управляться коннектор мужа у людей и они они просто есть при каждом ты как раз упомянул что у кого-то что-то уже есть насколько правда вот этот подход часто используется в продакшене там не только у вас утром а то есть куда можно сходить за вот реальным примерам большим каким-то как референсом это хороший вопрос и я знаю что у нас после того как мы собственно публиковали это многие погибают ныне вами клиенты потому что там есть люди которые зашли там из и сенсорсо и взяли стали внедрять себе вот этот подход потому что до этого они изобретали какие-то вещи до зачастую там detox это такая штука которая позволяет или там требует определенной ну как это сказать дисциплины что ли да то есть это не всегда вот этот пример когда я показал когда зашел ручкам подправил да он всегда такой достаточно tempted и многие вещи админом проще сделать через вот зайти ручками что-то подправить detox все-таки наставляет на такой путь правее проверяем убо или там постоянно как это по-русски сказать я пытаюсь rip радиуса был инвалида тоже всегда можно взять и понять что у нас и где происходит единство и фиксируешь изменения и потом уже только вследствие у тебя появляется что-то в окружении соответственно может уже повторно все это тоже самое про меня и самого начала до вот этого момента текущего да там и воспроизвести с любого промежуточного состояния до текущего я жаждал может быть кто то этот нюанс укажет может быть ты укажешь может быть я и как это можно но есть один недостаток в этом де topsy до 11 хранить что мы можем хранить и убить а можем мы хранить и jar ники можем узнаешь и с недавнего времени я бы так ответил да можем хранить у нас появился lfs если правильно называют то есть то что позволяет хранить там все что угодно в детей хот-дог файлы там хоть x или там художники сохранит да но можно ли спать на потолке можно но неудобно попадает одеялко постоянно такая же история с гипсом и хранение в этих binary и у нас здесь я об этом не говорил я об этом наверное может быть будет их следующей итерации или может быть какая то местный доклад с мастодонта my управления контейнеров у меня уже есть такой план сделайте такой livestream может быть после нового года когда мы еще вещи такая как контейнер если я здесь не учитываю потому что здесь я по умолчанию считаю что мои контейнеры где-то лежат да там докер в докер хобби и и и так далее никак это не учитывается здесь например здесь будет учитываться только изменениях сша и машина именам изменения тега эджа если мы это не ними должна да это дело должно закончиться в внутри git репозиторий то есть здесь вот этот вот flow взаимодействия с каким-то контейнер если он не был показан например я не показал у меня сразу вопрос извини я тебя порву вот вопрос прилетел в читу на мой взгляд очень хороший то есть люди хотят разобраться в том как github сработает мы делаем пиа и что проверяется в этот момент давайте на понятном программе вот код у нас есть собрали тесты запустили это этакий все хорошо или мы должны проверить что у нас этом как-то это развернется как мы это будем делать ну pr зачастую не это все на самом деле зависит от того что вы хотите сделать в принципе можно pr деплоить на какой-то стоит да то есть например сделать какую-то специальную джуму которая будет проверять каждый pr и его прогонять какие-то тест мы это пробить им а что какие-то смогут с ты даже выглядит unit тесты которые позволят вам про она хотя бы там что и от не ломает ничего существующего следующий момент фирташ позволяет вам вас есть чистые чисты такие div и которые показывают что у вас поменялось мы поменяли can find и дальше например вы можете начать там обсуждение почему-то меняется сел тут увидели кто-то меня это превью их можно устанавливать изменяем инфраструктуре до того как они случились да да да то есть в нашем репозитории вот этот наш этот флаг с контроля он смотрит на про независимости теория он смотрит именно за тех вещах которые отвечают за вот эти javascript и что может происходить на этапе али можно проходить что угодно все зависит насколько у вас полно всего башку репозитории у нас например мы его слоем там один один проектик который связан томск of the rifles она прям прогоняет все там предыдущие том the real и даже если никто их не трогал сначала происходит типа смог тест который просто скопили java чтобы за то чтобы ничего не сломалось потом он прогоне теста который не интеграционный который просто юнит-тесты потом он прогонит интеграционный тесты потом он выложит какой-то стейджинг веб-сайт но в принципе здесь в github суда вас не накладывает никаких ограничений с точки зрения что вы будете делать на этого хлопья он дает вам возможность использовать те же самые тулы которые вы использовали для ревью и сама проволока коренных изменений без привлечения к его сторонников если мы использовали дыру будет ширина трактора если вы использовали гибко ищут они будут работать точно также сил всю сложную работу за инвалида ции и проверкой того что состояние вашего git репозиторий состояния ваш куда кластера на себя возьмёт собственно пирата гид оператор топса пиратов там вот поэтому ну здесь особо нет смотрите любые workflow которые позволят вам работали и работают для многих вещей там можно каким-то get up action подвязать суда да и для чтобы этом автоматически запускалась можно сразу там делать deployment на какой-то код все развалилось и перемещаться в дискуссионную зону вот и колес по этому факту к нам присоединился пионеры сохранишь на конечно чтоб не выгонять вас последние десять лет я вам даже набросить могу дискуссионную комнату чтоб вам было интересного и вот знаете что верно есть та прекрасная дока которая называется что-то типа там wordpress хостинг он а в с best practice и там внутри нагреваешь это просто от сатаны на 20 листов с какими-то схемами просто через подмышку из кучи пунктов нарисованными всегда прогресс я просто хочу уточнит просто понимаешь раньше как было берез там не знаю wordpress но вот по фигу это приложению как положил базу данных положил рядом приложению нажал как бы запустить запустилась все хорошо теперь мы вокруг всего этого строим тут нам нужно кафка тут нам нужен не знаю там редис тут еще что-то тут memcache от история тут еще надо положить короче в bucket это все здорово эта технология когда это надо когда это тогда это надо это все очень круто а его хочу чтобы дискуссионной комнате обсудили а как все-таки не упасть в маразм и как понимать вот этот момент когда это все реально надо а ко мне ставить него аресом свернуть он как появился замечательная конференция делюкс это когда у джо игру на в если кончились а еноты когда была лишь рассказывал когда собирали веб-сайт веб-сайта собирался собственным схемам а и но надо закончились потому что у эмпиемы была куча опеки джей и файловый дескриптор быстро закончились вот так что так что да шутки шутки прессу далеко 5 секунд мне выламывает дверь люди в маске все бегом дискуссионную комнату расскажите о чем договорились же"
}