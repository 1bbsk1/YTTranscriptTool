{
  "video_id": "g6iBttPRzG8",
  "channel": "DevOops_conf",
  "title": "",
  "views": 0,
  "duration": 0,
  "published": "",
  "text": "Всем привет Да мы сегодня собрались для того чтобы коктейльный доклад поговорить о тестировании Меня зовут Дима сугробов Я инжиниринг-менеджер в одном из ритейлов и с нами сегодня Саша как он сам сказал в прошлом разработчик но теперь Перешел на темную сторону силы и сейчас занимается выстраиваем процесс доставки ценности клиенту микросервисами и прочими штуками Саша привет привет такой вопрос Вопрос такой смотри мы здесь будем разговаривать протестирование разработку люди собрались у нас с инженерным грандом И вопрос такой А почему ты тут о чем нам будешь рассказывать но А вообще я буду рассказывать больше про как бы процессы как в общем-то жить в условиях когда нету отдельной специализированной тестовой среды Вот и как бы так как это область очень связано с тестированием вы можете спросить как бы вообще почему это доклад на конференции de Vox А ну потому что в принципе про как бы культуру доставки и в докладе будет достаточно На мой взгляд количество инженерных деталей которые интересны практикующим инженером мы возможно не только предлагаю сразу же начать как считаешь да давай смотрите это те кто к нам пришел просьба такая что у вас есть чат можете смело Туда писать вопросы комментарии идеи там Саша будет постоянно вкидывать какие-то моменты вот будет круто если вы там будете присутствовать и задавать вопросы Саша прошу Александр Я занимаюсь консультированием одной из компаний Вы можете найти меня в различных сетях Я выступаю на конференциях я пишу статьи на медиум в общем-то Добавляйтесь Подписывайтесь ставьте лайки и прочие вещи еще это тоже интересный факт и будет использовано в одном из мемов презентации я все время довольно плотно работал над сервис mashion что получил вот такую вот ачивку и этот факт нам будет нужен немножко для понимания одного из мемов в рамках это единственный слайд на русском языке который не переводил потому что больше нравится в котором В общем такой знаете отказа ответственности что вот все что я буду сегодня рассказывать оно применимо в некоторых условиях вы должны понимать например ваших условиях или ваша компания какие-то моменты решения могут не применимые ну не говорите потому что сказал конференции что надо делать потом ничего не получилось всегда думайте своей головой вот теперь можно начинать Начнем с того что я как-то был на одной из конференции программа комитете и Мой коллега Он спросил вообще вот как организовываются разные среды для разработчиков было бы интересно послушать микро сервисной среде Потому что есть разные решения на хороших решений Нет не все так Ну давайте начнем в принципе и вот вспомним такие вот старые добрые времена когда были монолиты да и нет микросервисов нет проблем В том плане что мы можем легко тестировать наше приложение локально можем потестировать в любом его тестовом окружении можем развернуть быстренько там новый который нам нужен можем потестировать это на том тесте staging и так далее Везде где нам надо и принципе такой как я помню проблемы было то что нужно было ждать время когда монолитное приложение скомпилируется и поэтому были разного рода ресурсов компании которые позволяли делать разные ход reloading и так далее для того чтобы это время сокращать Ну а сейчас конечно Эпоха как бы немножко изменилась все перешли Так ладно на микро сервисы и как бы в принципе протестировать один микросервис тоже достаточно просто для разработчика данного локальной машине Ну вот потестировать большое количество сервисов уже может быть достаточно сложно Потому что есть разные связи системы распределенными это вносит свои коррективы поэтому давайте начнем с того что вообще в принципе как упаковывать и готовить среды разработчиков и Потом плавно перейдем как вообще готовится для разработчиков есть вариант такой достаточно понятный например что можно все пытаться развернуть и протестировать на мои машины например с помощью Понятное дело что вы вряд ли сможете поднять какой-то большое количество сервисов поэтому данная схема может работать какой-то ограниченным плюс к этому вас скорее всего будет какая-то отдельная конфигурация но это не так конфигурация с которой вы диплоитесь кластер будь то там любой там не важно для разработки тестирования или продакшн конечно поэтому есть решение которое позволяет сделать некоторую инъекцию сервиса с вашей локальной машине в общем-то в девелоперский кластер Ну и там перед Затем вы приходите какой-то дискриминатор Например если вы используете ваш трафик каким-то магическим чудесным образом оказывается на локальной машине и вы можете свой сервис протестировать здесь правда остается вопрос А как вообще в принципе тестировать например синхронных процессов если мы хотим и в этом случае как бы у нас есть проблемы с тем что тестирование синхронных вещей у нас как правило есть какие-то например топики подписки если мы говорим про очереди и в этом случае у нас становится подписки больше чем условно говоря какое-то количество клиентов и нам нужно вообще в принципе понимать например кто должен например сообщение прочитать сервис который локально и чтобы они еще не конфликтовали а в любом случае на тестирование локально имеет свои плюсы как и любой инженерное решение то есть мы получаем быстрый фидбеклуб это хорошо для каких-то простых из кейсов но тестировать что-то сложное сложно да то есть это комплексное скажем сложно Сложно коллаборировать Да вместе инженерами с другими разработчиками надо пригласить их на свою рабочую машину что ли показать поэтому Давайте пойдем другим вариантом организации это один из них это полное копирование всех вообще сервисов для каждого разработчика например Представьте что у нас есть такой вот жареный для всех где мы куда-то там пихаем какие-то более-менее стабильные версии сервисов и вот мы хотим создать для вас я хочу что-то тестировать и мы ему разворачиваем вообще все все что у нас есть поэтому Васи как бы есть своя логическая база данных как минимум для каждого сервиса и свои топики подписки какие-то их эмуляции тогда но в этом случае нам нужно решить некоторые проблемы во-первых мы должны уметь такую среду для вас и делать достаточно быстро потому что мы хотим экономить ресурсы Ну то есть например удалять среду ночью и восстанавливать ее скажем утро для этого нужно сделать так чтобы это было занимал немного времени Вася успевал максимум только может быть кофе попить с утра во-вторых системе становится очень много Ну то есть получить 10000 больше воркологов очень просто и с этим приходят разного рода проблемы же становится например достаточно могут быть какие-то проблемы затыки и так далее которые вам надо будет решать с тем что просто очень много ресурсов Ну и дополнительно к этому придется Скорее всего в том числе иметь какую-то отдельную конфигурацию для инфраструктурных компонентов То есть например база данных в контейнере они менеджмент сервиса разные эмуляторы для очередей они сами очереди так далее какие-то допущения их придется настраивать можно провести ряд оптимизации например копировать общение все какие-то только Core сервисы на остальные специфичные сервисы для вас и Вася на катится Да можно экономить ресурсы например каждую ночь подчищает такие инвалид и можно сделать оптимизацию создавать такие инварами для каждого разработчика например для какого-то склада из двух трех разработчиков которые Ну как-то там между собой наверное договорятся кто там Когда и отказаться от каких-то вещей которые в принципе на таких вещи как например для того чтобы оптимизировать скорость такая схема Вполне себе возможно ее можно сделать у нее свои бенефиты в том плане что вы получаете полную изоляцию у вас очень низкая получается когнитивная нагрузка на разработчика Потому что ты пришел твоя среда ты на него что-то делать Понятно данные нигде нигде не пересекаются Из минусов здесь можно Нужно отметить что да это схема потребляет достаточное количество ресурсов скорее всего нужно будет сделать кастомную конфигурацию для этого всего делаю вложиться в это время да свое и что еще важно что если скажем что-то на этой среде происходит у вас это Вася с большой вероятностью придется разбираться в этом самом Например если они не работают сервис авторизации он как бы вообще не бум-бум в общем-то в этих сервисах называется вероятно ему придется эти этот сервис как-то чинить здесь хочется сделать первый такой вопрос вообще в принципе Пишите в чатик Если вы использовали например или Present или какие-то его аналоги или вот например делали вот такую конфигурацию когда для каждой разработчики имел свой собственный песочницу в которой было Если не все то какая-то существенная часть всех сервисов которые есть компании а мы переходим к следующему варианту это инъекция сервиса Ну вот Представьте скажем что у нас есть основные сервисы Да какие-то и есть вот сервис который разработчик например пришел создал веточку свечей и получил соответственно где-то в пластырь с этой версии своего сервиса Затем в общем-то там это сервер версия диплоиться Каждый раз когда классно разработки Вот и потом чтобы Достучаться до своего сервиса мы говорим что Окей давайте мы сделаем опять-таки какой-то дискриминатор видео в котором укажем что мы хотим использовать конкретную версию сервиса и с помощью например сделаем руки для удобства мы можем поддержать кубки например там где-нибудь на уровне прокси того же мы можем распаковывать Путин и скажем превращать нужные понимаемые более того в принципе мы можем таким образом протестировать И больше количество сервисов чем один из большего количества Для этого нам нужно придумать какой-то формат для сервиса ты по нему собственно говоря трафик производить остается вопрос здесь связанные с тем что делать с асинхронными процессами Что делать с разными очереднее Да и какими-то такими вещами То есть те которые мы с помощью сервиса мыши решить не может к этому Вернемся чуть позже а пока скажем то что из бенефитов здесь конечно то что такая схема она потребляет значительно меньше ресурсов чем прошлое скорее всего если вас не знает ничего просили кто-то знает ему поможет потому что вообще принципе все использовать и включая того кто разрабатывает сервис аутентификации и здесь получается хорошая Такая коллаборация между можно легко тестировщик Вот тебе это специальный сходи с ними протестируй пожалуйста мои версии Из минусов основных здесь то что у нас плохая изоляция данных ПВХ изоляция ресурсов коснемся и довольно сложно тестировать синхронные процессы потому что у вас может быть много консилеров Например если конечно не попытаться с этим побороться вот и здесь я хочу опять-таки предложить вам написать что напишите в комментариях Если вы используете такую схему Да соответственно и если вы используете что-то для роутинга например с точки зрения синхронных процессов тоже интересно вот поэтому мы выбрали именно эту схему с сервисами инъекциями но понятно что недостатки достаточно существенные мы них поговорим Поэтому нам нужно было придумать Каким образом эти недостатки нивелировать поэтому сейчас мы будем немножко отвлечемся на тему именно тестовых средств Да и посмотрим как вообще в принципе как будто сервис имеется она помогает выстраивать такой как бы инвалид в котором и девелопмент и всегда находится на одном по сути физически вообще если мы говорим о типичных инвалидах то скорее всего в компании что-то похожее да то есть какой-то Продакшен и так далее может быть больше но эти три скорее всего Но что если мы будем совместим вот эти две среды девелопер стоишь в одну а не будем делать их разделение то есть вот нужно ставить такой мемчик то есть вот у нас есть деф у нас и стоишь мы скрестили получили то что я называю stabuder Давайте еще принципе разбираться что такое Почему такое Почему стабильный почему тогда у нас есть представьте себе один кластер Но на нем по сути есть некоторые набор У нас есть некоторая часть сервисов которые образует из себя логические Вот это самый стабильный по сути он из себя себе содержит все версии сервисов которые с теми же самыми версиями которые есть именно это позволяет сделать его стабильным потому что у вас те же самые уже стабильные версии Если Вы заходите просто так условно говоря вызывайте какой-то сервис или какой-то фронт и ничего не указываете вы попадаете как раз таки на этот и это по сути дела такое основание для разработки тестирования там проверки всего чего нам в общем-то и Понятное дело что он должен быть максимально стабильным потому что гоняется разные тесты на нем проходит Съемочная тестирование автоматизированные так далее и с этим разработчики как бы не должны на нем ничего тестировать на него нельзя ничего выкатить руками то все идет только строго через пайплайны и строго тогда когда артефакт выкатился в продакшн помимо этого на этом же самом логическом классе реку брендаса у нас есть такая логическая как бы среда которую назван бренд по сути дела в нее попадает как раз таки артефакты которые были созданы при создании франчай собирает ваш сервис в класса как раз таки могут в этом январамите что-то протестировать Они как раз таки могут с помощью той самой сервисной инъекции помимо этого у нас есть еще отдельная штука про релиз кандидатов по сути дела Когда идет жмейн и создается новый трек мы создаем кандидата это из кандидат диплоиться в тот же самый класс и для какого-то финального тестирования мы можем передать соответствующий и мы будем собственно говоря его и тестировать вы можете спросить а вообще к чему такие сложности Почему не сделать отдельные среды да то есть Почему не сделать отдельно Def отдельно Stage у нас так получилось у нас изначально был Def и в какой-то момент мы нос не было стыджа отдельно тестирование именно был отдельный класс и у нас стал вопрос А надо ли делать вообще в принципе отдельный класс для тестирования Вот и мы подумали во-первых это будет дешевле но это не главное конечно преимущество более важные вещи вот такие что во-первых нету разделения между как бы кластером для кластером для разработчиков Ну то есть по сути все работают Над одной средой и все стараются сделать так чтобы она была стабильной да то есть соответственно если что как бы разработчик пойдешь и починить то что ему надо во-вторых Если у нас есть как бы два класса один тестовый то нам нужно теперь держать стабильными ни один уже два потому что стоит тестирование тестирование должен быть стабильный по УМО нию разработчики наварами хотите быть стабильной потому что он был стабильный Потому что если сервис авторизации не работает то как бы вы как разработчики ничего не можете протестировать например ваши и вы все должны стабилизировать по сути надо делать двойную работу вместо одной поэтому решив Что Окей давайте мы оставим значит вот один такой как бы смешанный кластер нам нужно все это имплементировать все эти моменты Да там роутинг трафика придумать как асинхронные процессы тестировать и так далее для этого Конечно Нам нужно потратить некоторые усилия и даже где-то написать какой-то код вот начнем с простой части с роутинга трафика как раз этот мем Да что я линкер дефан но вот мы везде презентации Будем рассматривать и все потому что на тот момент когда Мы начинали это делать К сожалению сейчас он Это вроде как умеет делать на пока мы переходить есть это в планах но не прямо сейчас поэтому везде презентации будет Ну да как организм сервисную инъекцию в общем-то с помощью силы достаточно думаю тривиальная Задача В целом да то есть мы можем делать роутер трафика Согласно некоторым заголовкам и в принципе здесь нет никакого волшебства в том плане что листья есть сервис Вы можете его сделать и на основании него соответственно будет скользкий момент в этой истории в том что вот этот сервис обычно мы хотим диплоид с помощью камчата на стабильную версию должны про диплоить чтобы это было в Паке с самим сервисом но при этом не очень удобно добавлять Раута различного рода например те же самые прочие или на релиз кандидаты и так далее Потому что добавить это как бы в основных чарт Ну это не очень прикольно потому что уже почти ресурс по сути из другого чтобы решить эту проблему есть такая штука семерчь операторов которым вы можете сказать что Ну вот давайте мы должны закончить некоторыми раунтами некоторые таргетные и мы сейчас ресурс Мы можем диплоид с каждым или кандидатом и так далее это супер удобно в конце концов он будет иметь уже агрегировали в котором будет содержаться будет содержаться здесь необходимый нам а следующая штука которую нужно не забывать о том что нужно делать правильное прокидывание заголовках Ну ровно точно так же как с разного рода X и рекос той деле с заголовками для трейсинга то есть этот сервис сразу должен быть прокинут во всей по всей цепочке сервисов желательно включить трейсинг на стороне есть чтобы можно было разобрать Почему у вас тут запрос ушел не туда например вообще правильно ходит мои запросы обязательно в том числе добавить что-то в response ответа сервиса например тот же самый Trace ID для того чтобы можно было потом легко В джаггере листок драйвере найти в общем-то ваш конкретный запросы понять что же в нем происходило увеличены таким образом обсерватив дальше нам нужно понять понимать что так как у нас это одна среда у нас есть некоторые такие не очень очевидные кейсы с которыми мы сталкивались Ну во-первых так как использовалась одна база данных изначально то вот если разработчик что-то делал с миграция нехорошая то база данных на stable могла развалиться ну и соответственно тесты переставали проходить это не очень прикольная ситуация поэтому мы рассматривали несколько вариантов ее решения Ну во-первых первое решение которое мы придумали давайте мы для bruncher вообще сделаем отдельную позицию и будем Я каждый на каждую ночь наливать в принципе это достаточно неплохой способ но потом оказалось что для некоторых разработчики они вместе работают над одним и тем же сервисом иногда пересекается миграция еще чем-то и гораздо более стабильнее делать логическую базу на каждый на каждый например каждый день и мы выбрали этот вариант то есть там получается так что когда первый раз раньше Депп ловится мы создаем для него возить следующий такой неочевидный кей связан с выкупками во внешней системы Например если это внешне скажем платежная система ему посылаем request с какого-то канареечного релиза то выпук нам придет к сожалению не в канареечный релиз и потестировать эту часть она становится достаточно сложно потому что в общем-то никакая три внешней системы ничего не знает про вашу внутреннюю инфраструктуру здесь есть несколько вариантов решения один из них это пытаться жонглировать ссылками можно сказать что это плохой вариант мы его отвергли практически сразу потому что в этом случае все запросы как бы не важно кем инициированы будут идти на только на один источник и это может зафиксить что мы не хотим Дальше второе решение заключается в том чтобы сделать какие-то фейки продвинутый мойки для того чтобы вообще принципе убрать внешнюю зависимость и дальше им комментировать Вот инфраструктуру соответственно может принять правильное решение куда ему отправить Я не знаю это самый Вот Но в этом случае как бы мы теряем возможность там тестирования там Реальных например там запросов реальную систему и ну и просто это требует еще дополнительно какого-то программирования в итоге мы пришли к тому что сделали такой вот Smart Proxy который использует некие корреляционные для того чтобы мочить квесты и скажем он понимает потом что вот вот этот вот конкретный внешней системы он пришел для вот этого request который был инициированным релизом поэтому пожалуйста Ну и хранить хранимы все эти пары корреляции там В отдельной позиции В итоге выбрали этот вариант и он работает вполне себе прекрасно позволяет тестировать все что угодно и врачах и близ кандидатах и как угодно и потенциально даже такую штуку можно именно следующая тема это касается разблокирования асинхронный вот разных сценариях и тестирования Вот потому что вообще тестирование синхронных процессов само по себе не очень простое вот а когда у вас еще как бы все артефакты в одной среде как бы находятся это становится еще сложнее проблема все те же как бы да то есть вот у нас есть довольно много консилеров к одному к одной подписки мы используем но в принципе думаю что с другими системами можем иметь те же самые примеры проблем и основная штука здесь в том Значит кто вообще в принципе должен процессе Какой из потребителей для кого он предназначен мы использовали такой же подход принципе как база данных да то есть мы сначала подумали давайте мы создадим какую-то отдельную подписку для бранчей Вот но потом поняли что как бы разработчики могут пересекаться опять-таки на вот этой вот подписке и как бы лучше сделать отдельную подписки для каждого при этом топик у нас остается один нет смысла делать топик для различных и так далее версии потому что в этом случае нужен становится достаточно сложно так это пологий принципе отдельных подписок хватает в данном случае видно что если мы Передаем сервис сразу например Иван то соответственно у нас и про процессе это сообщение только Иван все остальные сервисы они просто скажут Nokia кнопочку Давайте скипнем процессе этого сообщения чтобы это имплементировать нужно решить несколько проблем Ну во-первых самая простая из них это создать статическую подписку для там канареечных релизов кандидатов и прочих вещей мы используем для продвижения для всех ресурсов у нас есть такая внутренняя штука называется сервис каталог куда разработчики могут формате могут внести какую-то метадату скажем это вот мой сервис мои доменная команда Там и так далее такие-то ресурсы например какие-то подписки какие-то топики какие-то базы данных и затем если мы видим что метод изменилась У нас есть машина которая пытается привести состояние ресурсов к некоторому желаемому состоянию и в данном случае это стоит машина вызывает некоторые модули модули могут быть самые разные и но у них определенные унифицированный интерфейс и каждый из этих модулей может соответственно что-то сделать чаще всего модули использовать телефон для того чтобы управлять ресурсами а некоторые могут Дули могут делать какие-то дополнительные действия например собирать разную информацию из разных тире формуловых стейтов автоматически заполнять конфигурацию для волота для сервисов и так далее и тому подобное поэтому дальше с точки зрения процесса дипломмента у нас получается следующая штука что опять-таки девелопер меняет что-то метаям или в сервис каталоге это отдельный репозитории соответственно с помощью мы эту новую метод дату оплавим в сервис сервис каталог которого есть сервис каталог вызывает с помощью стоит машины разного рода модулей и в общем-то модули применяют создают сервисный аккаунты топики и так далее и плане уже доставки приложения мы просто проверяем что у нас как бы все ресурсы созданы что наш статус текущий метаданных Он исполнен про процессе все ресурсы и процессе их коррект это принципе достаточно если мы этого не сделали то есть например то наверное сервис не стоит катить потому что ну наверное ему не хватит каких-то ресурсов чтобы корректно работать поэтому создание вот этой вот статических подписок для скандинатов было простым делом нам нужно было просто поменять немножко под модуль и он начал создавать помимо сны подписки еще и подписку для скандината и риск подписку для тестировщиков которые они например в своих каких-то тестах могут прощать сообщения посмотреть что вообще было послано конкретно немножко сложнее ситуация с динамическими подписками для бранчей в данном случае у нас нам Пришлось сделать еще один сервис мы его назвали сервис каталог куда мы регистрируем все как бы вот который у нас есть что это значит когда у нас разработчик при первом его прогоне мы регистрируем этот брендж сервис каталог затем мы делаем Окей нам нужно снова применить модуль идет какие у нас есть зарегистрированные и для каждого из них создает свою в данном случае сам subscription mp1 Ну и в случае когда вы делаете Как разработчик ваш мюржи квест то соответственно мы делаем обратную процедуру раз регистрации вашего бренча из инхаба опять-таки говорим OK за онлайн пожалуйста нам все ресурсы модуль и он эту подписку удаляет Таким образом у нас идет Такая по чистка ресурсов и у нас нет ресурсов есть с точки зрения Да вот например для бренча есть два отдельных этапа Это продвижение ресурсы и ресурсы как раз таки который например те же самые и наконец-то третий компонент это некоторые общие библиотека К сожалению без нее нельзя который разработчики должны использовать для того чтобы это все работало значит работает она следующим образом не есть как бы продюсер да то есть сделан продюсер берет и сервис контекста Он берет этот X Force который в нем есть и кладет этот атрибуты сообщения затем сообщение какой-то момент приходит на консилер и в консилере библиотеки есть такое как раз таки занимается тем что принимает решение А что мы должны с этим сообщением сделать Должны мы его скинуть Или мы должны про процессе и тут есть один такой хитрый момент когда к нам приходит например сообщение в котором например мы смотрим Если я например там рейка то я понимаю что это сообщение не для меня если я какой-то другой бранч Я тоже понимаю что сообщение для меня если я мой бранч МП Иванова нанимаю что да это сообщение для меня но основной сервис Он не понимает для надо ему обрабатывать это сообщение или нет они понимают это он По той простой причине что в отличие от истин где у нас есть Такая сущность как Virtual Service где описаны все маршруты этот сервис Он не на самом деле не знает ничего про окружение по крайней мере по умолчанию Поэтому нам Пришлось сделать так чтобы совместить его значит с Real Time конфигурации и когда какой-то брендж новые регистрируется в ходе мы получаем эту информацию Поэтому вот этот основной сервис знает о том во всем окружении которые есть и на основании этого уже может определить например вообще вот этот Иван есть где-то зарегистрированный такой врач или нет И случае если например не зарегистрирован то он процессе сообщения если зарегистрирован то он соответственно процессе его Ну и последний момент но как бы очень важный в том что этот раунд мы должны поместить обратно в клиентский контекст из атрибутов сообщений и все дальнейшие действия делать уже с этим контекстом с этим Почему Потому что это позволяет нам разблокировать вообще говоря в общем-то говоря тестирование очень сложных сценариев например как в этом случае да то есть вот у нас есть там сервис ордер сервис который в данном случае будет читать свою подписку и при этом если есть еще один сервис от которого есть он отошлет запрос именно в него они базовый сервис и с помощью такого мы можем как бы тестировать любые цепочки синхронных и асинхронных взаимодействий а если мы говорим про базы данных то тут в общем-то подход достаточно похожий как я уже говорил с подписками значит что мы сделали значит каждую ночь у нас есть экспорт баз данных gcs до соответственно мы храним некоторые дам базы логической именно которую мы берем с со стабильного основная версия база данных и затем когда мы создаем бранч Мы иниции у нас есть модуль который опять-таки смотрят Ага У нас в нашем клаусе нет такой базы для конкретного врача давай мы ее создадим Если еще нет и накатим туда соответствующие данные здесь есть Однако нужно помнить о некоторых проблемах но во-первых данных так таким образом лучше держать чтобы данных было не очень много на вашей среде там разработки но есть еще один такой момент что в какой-то точно будет данные которые неполные потому что скажем у нас есть представьте себе У нас есть например сервис платежей на сервис заказов Да И вот Мы создали платеж в stable заказ у нас соответственно был в браке В итоге база данных которые информация которая была в базе данных для бренджетов она потеряется со смертью бренча информация которая была поймать стабильная версия она останется Поэтому в какой-то момент Ваш там какой-нибудь платеж может иметь там референс на заказ который уже не существует с этим нужно как-то все это нас подводит к тому что кому что мы можем теперь создавать так называемые эфемерные инвалиды на нашей среде Что такое вообще в принципе эфемерный вариант И почему не нужны потому что в реальной жизни на самом деле есть много разных сценариев комплексы и какой-то момент к вам могут прийти сказать Она вообще говоря надо бы вот среду для конкретно команды платежей или там Мы хотим определенную среду для домена и вот среду Мы хотим тепло и чем мы хотим и соответственно девелоперской среды в которой есть какой-то и в этом случае мы говорим Что окей У нас есть какая-то часть мы называем это киста и Болгар но мы можем сделать некоторые инварами например в данном случае mp1 состоящий из двух сервисов и сервиса платежа и сервиса заказа и соответственно мы можем как бы тестировать любые сценарии мы можем тестировать эти сервисы именно как бы в этом январе что вот этот маленькая часть вот эти два сервиса это вот наш маленький такой эфемерный инвалид который Мы создали для того чтобы протестировать конкретной версии этих вот двух сервисов и какие здесь принципе эфемерные инвалиды могут быть самый простой из них это когда просто у вас есть какой-то сервис вы создали бранчик как разработчик и и соответственно мы его за диплоили вот нас получился такой эфемерный вами из одного сервиса такой вот Корнер кейс либо скажем у вас есть какая-то на жирос задача и вы этот задачи создаете разные бранчи в разных репозиториях и соответственно потом можете потестировать под одним миксус раунд который привязан к этой же задача Вы можете потестировать некоторые набор сервисов одновременно и помимо этого мы можем создать еще и кастомные январями например для какого-то склада например те кто занимается платежами для кого-то домен хауса и тогда и по сути у нас получается такая схема что нас такая как бы шина стабильных сервисов данных которых такие вот стабильные как бы версии они работают они протестированы и так далее мы можем создать множество разных эфемерных инвалидов они могут быть большие они могут быть маленькие они могут друг другом даже пересекаться если правильным образом сконструировать вот сразу Да скажем То есть это могут быть для домена это мы будем для команды это может быть для жира задачи это может быть для какой-то конкретной маленькой вашего врача и это разблокирует нам по сути Ну достаточно большие возможности для разного рода тестирования которые нам нужно и в этом случае мы можем создавать любые среды которые нужны некоторые как бы умозаключения во всей этой схеме до того как мы перейдем к вопросам но основные бенефиты в такой схеме которые мы видим для себя в том что у нас нет такого разрыва между как бы девелоперской средой и средой там для тестирования между разработчиками и все они работают коллаборируют в рамках вот одной вот этой среды Да это позволяет дополнительно уменьшить потребление каких-то ресурсов и создавать вот эти анвары менты по сути тогда когда Вы хотите стать конфигурации которую вам нужно для того чтобы потестировать какой-то конкретный иногда довольно сложно а из минусов как и любое техническое решение инженерное это решение имеет свои минусы и с ними как бы их нужно как бы принять Ну либо не использовать например это решение во-первых это большая когнитивная нагрузка на разработчиках вообще не только разработчиков вообще принципе на инженер в том числе например инженеров тестирование и на тех кто сопровождении так далее Потому что нужно разбираться нужно понимать что вот например вот мой сервис раунд он работает таким вот образом что мы используем такие-то технологии мы должны не забывать пробрасывать контекст внутри наших сервисов мы должны вы терять Если что-то идет не так и должен знать как я могу Погиба жить это дело Почему мой запрос например там уходит не в тот сервис который я ожидал что если это синхронные какие-то процессы связанные и так далее То я должен понимать всю цепочку например всю цепочку в джаггере что это сообщение пришло соответственно в какой-то конкретный сервис ушло в другой сервис было забрано определенным консилером и так далее Что конечно требует более высокой квалификации инженер если бы Например мы говорим о каких-то более классических вариантов Когда у нас есть отдельная среда разработки отдельная среда тестирования это конечно временные инвестиции не могу сказать что они прям сильно больше относительно того что скорее всего нужно было бы и так и так сделать Ну потому что скорее всего вам все равно на тестовой среде захотелось бы потестировать каких-то там близ кандидатов отдельно там от основных версий сервиса поэтому многие вещи которые как бы мы используем они классической такой архитектуре когда отдельно например И это не совсем как бы честно изоляция то есть по сути конечно у нас разные базы логические разные там подписки Там и так далее но при этом есть еще могут быть другие какие-то ресурсы которые мы тоже должны поддерживать изоляцию или это там какой-то маленький процент кейсах и мы готовы мириться с тем что в этих местах ляции у нас не будут изоляции Мы готовы с этим Вот это в принципе все вы можете задавать свои вопросы у нас Я так понимаю даже есть некоторое время чтобы на них ответить да Саш спасибо большое за доклад действительно видно что просто колоссальнейшая работала проделана для того чтобы построить вот эти эфемерное окружение Вот что хочу сказать две вещи первая вещь как сделать Благодарность тебе объявить от лица тех людей которые послушали Пожалуйста проходите обратную связь оценивайте доклад Я думаю Саша будет он очень благодарен и сейчас нас есть второй способ как можно поучаствовать дискуссии и сделать Сашу более радостным это как раз задавать вопросы Мы сейчас думаю здесь обсудим парочку вопросов дальше пройдем в дискуссионную зону тоже приходите будем очень рады видеть вас вот ну а Чтобы не терять время задам тебе вопрос который нам от Саши Михеева смотри есть такая ситуация есть Stage полная копия продакшена там есть образы которые напрямую работают такие же короче как на продакшене и есть ли смысл вообще выгораживать такие костыли делать полную копию прода и при этом туда закидывать корявые разработчики не протестированные билды потом откатывать все это потому что будут ошибки возможно автоматикой общем Стоит ли играть вещи потратить так много времени и вообще конечном итоге остаться довольным результатом который я рассказывал я думаю что эта схема как раз которую Александр Михеева Да полная копия продакшена но я думаю что любые решения они ну как бы имеет право на существование как бы сами по себе Вот и иногда такие как бы который по сути вот в некотором плане вот у нас этот stable Def он некоторое Ну пусть неполная копия Ну например не в плане ресурсов да то есть скажем полная копия Как посмотреть на это дело то есть там в принципе все те же самые сервисы которые продакшене у них ровно такая же архитектура Ну например в том плане что каждый сервис имеет свой instance базы данных физически Да скажем потому что типа микросервисная архитектура у них там честные топики честные подписки какие-то там эмуляторы условно говоря они могут потреблять меньше ресурсов или может быть меньше среде но по сути дела Вот этот но некоторые можно сказать что полная копия продаж Вот и на нее как бы никогда Мы например не выкатываем то что мы не готовы Так что я это не показывал в докладе но как бы то что у нас есть это такая схема тоже такая достаточно дискуссионная что сервис попадает в stable вот этот деф только после того как он уже за диплом в продакшн то есть сначала выполняется Job depoint Production И когда ты за промоутил свой сервис уже на сто процентов трафика ты имеешь право этот сервис автомат на вот этот stable как бы есть всегда только стабильной версии на них разработчики никогда ничего в общем-то никак по крайней мере руками мы это делать не даем поэтому зависит от цели и задач наверное в этот не стоит выкатывать версии которые не протестирована стоит выкаты как сбоку их тестировать Может быть как бы некоторые ситуациях Это и будет Мы решили для себя что у нас если какая-то стабильная среда то как бы давайте держать и максимально стабильные потому что мы на ней Тестируем и если она непонятно Я думаю что мы можем просто долго еще дискутировать на эту тему и тем более у нас уже есть другие вопросы которые мы тоже сейчас будем обсуждать но будем делать это в дискуссионные зоны поэтому спасибо большое за доклад переходим в дискуссионную зону Спасибо"
}