{
  "video_id": "X1pMUgZzJhg",
  "channel": "HighLoadChannel",
  "title": "Быстрый рендеринг с DOM шаблонизаторами / Борис Каплуновский (AviaSales.ru)",
  "views": 113,
  "duration": 2830,
  "published": "2017-03-30T23:39:10-07:00",
  "text": "меня слышно окей а скажите какую-нибудь картинку о отличная картинка есть окей я довольно долго работал над докладом и старался сделать его настолько противоречивым насколько это возможно и сразу начну с противоречия в корне не согласен с предыдущим докладом о том что web component ими можно пользоваться уже поднимался вопрос о 300 килобайтах я глубоко глубоко глубоко уверен что 300 килобайт для страницы javascript а это недопустимо много ok сегодня я расскажу вам довольно глубоком путешествие в frontend началось это путешествие так-то когда я обнаружил что frontend aviasales тормозит и надо что то делать это путешествие началось года полтора два назад и вещи о которых я буду рассказывать это сжатое повествование того что я узнал к самым критичным на мой взгляд в производительности frontend приложений является рендеринг да все мы знаем что работа с дом это такая вещь которую нужно стараться избегать чем больше вы делаете вызовов к дом и 5 тем медленнее работает ваше приложение и так о чем конкретно мы поговорим это о правилах игры на какие вещи в рендеринге в работе в приложении нужно обращать внимание какие параметры являются ключевыми для библиотеки шаблонизация для рендеринга какие есть типы шаблонизатор и дальше я немножечко пройдусь по костям гигантов это angular же с и реалист попытаюсь рассказать чем они мне не нравятся и почему они тормозят расскажу немножко о том что хорошего я нашел в других шаблонизатора и произведение которое мы создали основываясь на всех вышеизложенных знаниях наверное часть аудитории интересует что означает дайвер в левой части экрана наша команда разработки находится в таиланде и и я лично занимаюсь дайвингом и в моей голове родилась такая аналогия если вы находитесь под водой то очень меньше движение вы делаете тем больше кислорода вы сэкономите и больше сможете про плавать в дом мы видим примерно то же самое чем меньше обращение к дому вы делаете тем больше вероятность что пользователь не столкнется с тормозами итак начнем о правилах игры user experience using пелин зависит от скорости инициализации странице все мы глубоко увлечен и кэшированием страниц кэшированием страниц на селе но вынужден сразу же прыщи противоречиво заявить о кэширование не работает не работает потому что первый контакт сайтом у человека самый критичный если при первой загрузке сайт тормозит то второй раз пользователь клан может не вернуться первоначальной загрузке страницы крайне важно 2 вторая важная вещь это скорость реакции интерфейсом если человек нажал кнопку или checkbox и при этом мгновенно интерфейс не отреагировал пользователь может закрыть сайт и уйти на другой сайт туда где туда где интерфейс отзывчив следующая вещь это потребление ресурсов и на в на веб-страницах важны два стальных показатели это потребление процессора если вы если вы делаете много лишних действий в игре и ти процессор и у него не хватает времени чтобы обсчитать обсчитать анимации на интерфейсе или просто что-то перерисовать кроме того если вы создаете много лишних объектов это создает нагрузку на garbage collector если вы создаете нагрузку на garbage collector то периодически он будет вызываться и отзывчивость вашего приложения будут падать и последний но от этого не менее важный пункт это размер библиотеки смотрите если у вас single-player applications to двести-триста иногда даже 400 килобайт javascript а вы можете себе позволить однако же компонентный веб в направлении которого мы с вами все весело движемся подразумевает что страницы строят строится из разных веб-компонентов более того эти веб-компоненты зачастую произведены в разных компаниях да и приходится своей а со своим пакетом представим себе страницу на которой вставлена десяток видишь ты виджет курсов валют погоды авиабилетов чёрт чёрт о вступи чего и каждый из этих компонент если 300 килобайт и это только g с таким макаром у нас запросто получится страница которое весит 5 10 мегабайт все бы ничего и интернет становится все быстрее и быстрее но и появились мобильные устройства появились появились медленные сети и если вы если вы пользуетесь интернетом не в городе москва а где-нибудь на например в екатеринбурге то 15 мегабайт ный сайт окажется для вас совершенно недопустимой роскошью именно поэтому размер библиотеки на мой взгляд критичен а чуть позже я сравниваю несколько библиотек и не сравниваю полимер полимеры не спрашивают только по той причине что 200 килобайт для библиотеки вайп компонентов это слишком много итак перейдем немножко к теме разговора к шаблонизатор am всем и кто занимается разработкой в при привыкли уже к страховым шаблонизатор am строковые шаблонизатора это шаблонизатор и которые в результате своей работы возвращают нам строку в строку которую позже мы вставляем посредством и нарежьте м.л. в html это замечательный древний и всем привычный механизм однако он имеет ряд недостатков главный недостаток то что каждый раз когда вы привели шаблонизация и делаете вставка в и нарежьте м.л. приходится выкинуть есть дом который там был раньше и и вставить туда новый дом если мы насколько насколько я помню работа с дом очень и очень медленно если вы выкинули 20 треков с 30 атрибутами и вставили такие же те же 20 тегов действие атрибутами то это займет значительное время 20 миллисекунд запросто кроме того не из страха вышибло инициаторы не позволяют оставлять якоря для быстрых апдейтов от единичных атрибутов единичных так текстовых нот и тому подобное стал обнаружив эти дни оптимальности мы начали искать как же как же можно как же можно избавиться от этих недостатков что то что можно с этим сделать первым первое что что подсказал google это используете том и 5 эта штука не не очень простая но у нее есть плюсы вот это вот скриншот сайта jasper в benchmark который видят производительность строковых шаблонизатора составляющих русский html через энергичный мель и и дом же с здесь мы видим сверх верхней части производительность на андроиде и видим что джеймс дом и пи ай позволяет ускорить рендеринг в несколько раз ну вот здесь вот примерно в 3 в то же время на десктопных браузеров такого адского прироста производительности нету но поднимите руку те кто слышал про мобила ги дон который google обещает всем устроить ближайшее время я почти никто не слышал подождите так и для просева кто-нибудь слышал так окей ладно тогда немножко расскажу значит google примерно полгода назад начал обещает всем вам разработчикам мобила ги дон что это значит это значит что все сайты которые не адаптированы под мобильные устройства респонсивные адаптивные будут и 7 стираться в поисковой выдаче это значит что если вы не готовы к мобильным устройствам ну просто трафик с google а на ваших сайтах значительно уменьшится по сути о чем этот light это слайд наглядно говорит что используя дом и пей вы можете значительно ускорить рендеринг на мобильных устройствах причем это относится не только к андроидом как вы знаете все современные android и ios устройства используют один и тот же движок webkit примерно с одним набором оптимизации а значит такой же прироста производительности вы получите на всех ios устройствах если будете рендерить страницы и через том и 5 однако дом и pr штука довольно громоздкая здесь я привел пять основных вызовов с помощью которых можно создавать участке дом привел и я их примерно в том виде в котором они будут встречаться в коде вашей программы если вы будете создавать участке дом непосредственно через этот опять создание одного элемента который раньше у вас укладывался в 1517 может быть 30 и от символов через дом и 5 запросто у вас завтра завтра что у вас выльется в 5 10 строк строк кода время работы программистов цена а это значит что мы не можем заменить html на ручное программирование дом здесь-то нам и необходимы шаблонизатор и и как вы помните я уже упоминал что строка вышибло не за то ли медленно и хочется иметь дом шаблонизатор шаблонизатора работающий через дом и 5 но позволяющий пользоваться всеми теми плюшками которыми мы привыкли работая с обычными шаблонизатора me итак что же нам дают том же плане затар и кроме возможностей не использовать родной и джесс дом и 5 они позволяют сохранять дом объекты в переменной для быстрого обновления позже используя дом шаблонизатор и можно использовать один и тот же участок дом несколько раз что я имею ввиду предположим мы посещаем страницу веб магазина пользователи заходят в одну категорию товаров и в заготовленные шаблоны подставляются представляются данные об одном списке товаров когда человек приходит в другую категорию товаров в эти же шаблоны подставляются другие данные по сути мы не перри создаем дом мы используем одни и те же участки дом для отображения данных это позволяет очень сильно сэкономить и на ресурсов процессора и на память и ну и иногда время программистов после после осознания этой мысли что инструмент который мне нужен это дом шаблонизатор и мы пошли смотреть что же что же уже существует в индустрии чем уже можно воспользоваться чтобы быстро и качество на равна работает в дом быстро его рендерить а дальше я расскажу а где на мой взгляд оступились гиганты 1 гигант о котором я хочу рассказать это ангел erger поднимите руку кто использовал англия джесс а кто использовал anges в продакшене больше чем просто использовали интересно вот angular джейс мне кажется оступился прямо на самом старте если вы пользовались то наверное заметили что все шаблоны передаются на клиент в виде либо дом участков что является не очень хорошим стилем либо в виде строк после того как довольно после того как библиотека загрузилась angular вынужден скомпилить ваши строки или дом в реальные шаблоны то есть это происходит на клиенте представим себе интересную ситуацию пользователь заходит на страницу грузит ведь есть же с которого в общем для angular приложение может довольно много 100 200 300 килобайт запросто после этого каждый шаблон с разбором строк начинает компилится приводит это всего к одной вещи первоначальная загрузка ангар приложение может из-за вот этой вот самой компиляции во время которого пользователи занимаются чем угодно кроме работы с сайтом это может длиться полсекунды секунду я встречал сайты на которых процесс компиляции шаблону занимал даже две секунды и более того эта проблема нарастает как снежный ком чем больше шаблонов вашем приложении чем сложнее вашей сингл пышка плетей шин тем больше времени мы тратим на первоначальную компиляцию шаблонов следующая проблема в angular мы все помним что angular продавался нам господа не из google как первым и самым крутым приморском с двусторонним бензиновым причем это двусторонний биндинг реализуется через так называемые watcher и которые вы вешаете на структура данных для последующего отображения отображение в дом это тут есть интересная картинка на вы на неё не смотрите интересный в ней является только только вот этот вот замечательный цикл в ходе которого в ходе которого обходятся все вотчина всех данных которые как которые вас существуют в системе причем конечно же в документации вам никто и его всех и туториалов вам никто не будет рассказывать что заводчиками нужно следить приводят это буквально к следующему в какой-то момент ваше замечательное приложение начинает раз в 100 миллисекунд хорошо так фарма жевать начинаю тормозить анимации начинают начинает течь память оказывается что допускать много очиров просто нельзя как только вы допустили много локеров ваше приложение начинает спонтанно тормозить тут вы начинаете хитрый изощряться делать идти на что угодно сокращать количество ваучеров отказываться в приложении 2 старанию бензин городе которого выбрали angular только чтобы избавиться от тормозов кровь кроме того мне кажется архитектурной про машкой angular является то что в angular не существует единственного правильно описанного способа работать в дом директивы фактически независимых каждый из них работает с домом так как она считает нужным а получается что пройдясь по директивам angular а мы можем пометить некоторые директивы быстрыми некоторые директивы медленны некоторые директивы очень медленно поднимите руку кто считает что ng рипит быстро и директивы я не вижу ни одной руки окей как вы считаю что она медленно ну в общем то если вы под пользовались ею то наверное видели что если вы запихнёте сотни элементов в энгри пит да еще там будут watcher то рендерится все будет это очень долго проблема настолько широко что в рамках что работая с ангулярным а наша предыдущая версия выдачи была построена именно на angular нам пришлось написать свой лагерь и бит это сделал наш сотрудник антон решив в общем рассказывал об этом на множестве конференций кроме этого 50 килобайт минимизирована во и закругленного размера библиотеки на мой взгляд все-таки многовато ну то есть за что вы платите да если вы смотрите код angular а то в эти 50 килобайт а зашита собственная система классов туда зашита очень некачественная на мой взгляд версия андер скоро вот и это все вы получаете совершенно бесплатно в рамках 50 килобайт of кода следующие намного более качественный фреймворк на мой взгляд это реакция поднимите руку кто пользовался реакции с примерно в ту курс как angular кажется в этой аудитории не очень много но а судя по тому как бурлит интернет каждый каждый первый программист даже не всегда фронтовичка пользовался angular мы в восторге от него вот однако так с идея virtual дома понимать и роге кто знаком ещё не устали virtual дом а кто считает что virtual дом позволяет сильно ускорить работу с домом я так не считаю дальше покажу почему вот смотрите на что нам предлагает virtual том а virtual бам у нас является источником из которого рик джесс создает настоящий дом то есть кроме реального дома от создания которого вы никуда не денетесь virtual там всего лишь позволяет его создавать как джесс в памяти держит еще virtual тонда это называется избыточность это virtual там несколько меньше настоящего дома может быть 1 5 однако на самом деле вы вынуждены держать в памяти 2 копии virtual тому то есть вы держите настоящий дом вы держите отражение настоящего дома в виртуал доме кроме того каждый раз когда вы собираетесь делать div virtual доме вы делаете еще одну копию дома у вас был один дом теперь у вас их три молодцы более того на каждой изменения данных вы создаете еще одну копию virtual там это и есть 330 копия однако вы создаете ее с нуля это создает серьезная серьезную нагрузку на коробочка лектор ну и на процессор тоже кроме того библиотека на мой взгляд все еще жирная 35 килобайт ну и опять же ребята решили нарисовать свою систему классов нарисовать свой laughter оригинальный почему-то не устраивал и все это запихнули в 30 35 килобайт а кроме того там упакован virtual дом с мифическим алгоритм который якобы дает огромную производительность следующая проблема virtual дома и и акта в частности это то что реакция с ничего не знает о семантике ваших данных и посмотрим этот очень простой пример здесь мы видим во вложенных дива и в них вложен вложен еще один так ой чтобы изменить целью через virtual дом алгоритм virtual дома внутри реактора вынужден сравните 3 т.к. и одно текстовое значение если мы знаем семантику данных для нас достаточно сравнить только текстовое значение просто потому что шаблоне написано что внутри одного дива всегда другой div внутри следующий в 9-ой зачем нам их сравнивать каждый раз это ну это реально overheat кроме того если вы программировали на react to вы знакомы с такой штукой как фьюри render of mixing кто-нибудь видел прн драницын урок многие не думают и perfumes и подключив реакции считают что подключили и дальше будет быстрой нет суть фьюри render амиксин в том что чтобы избавиться от работы вы бы ни за что не догадаетесь чем spiritual дом то есть случается очень интересная ситуация на мой взгляд близкая конечный с началом господа из google пару лет продавали нам продавали нам react как штуку которая с помощью virtual дома адски ускоряют работу с дом а потом оказывается что чтобы быстро работать с домом нужно исключить virtual дом молодцы хорошо сделаем а теперь кое-что другого не найдя вдохновение ну конечно же подчеркнуть внешний из этих библиотек захотелось поискать быть может на планете есть библиотеке есть люди которые сделали что-то что-то лучше не пытался найти одну библиотеку серебряную пулю но хотел посмотреть посмотреть библиотеках вещи которые можно было бы использовать либо для ускорения реакции либо для создания своей библиотеке и вот что я нашел я не претендую на всеобъемлюще следующего обзора я всего лишь посмотрю рассматривать две интересные библиотеке и вот они первые из них роджерс на мой взгляд rayjet это правильный angular jest просто потому что размер библиотеки 5 килобайт ребята взяли абсолютно те же идеи что были в angular джесс но не стали переписывает валдис просто сказали ну а зачем он уже написан а ребята не стали переписывается изобретать свою систему классов с миксы нами паршивыми все мы ничего не стали делать наследова ничего не стали делать получили библиотеку в 5 килобайт производительность больше чем one gullari идею абсолютной те же однако однако и более того а шаблоны используемые в роджер использует семантику данных что дает еще неплохой прирост производительности но осталась и проблема компиляция шаблонов все еще происходит на клиенте это не очень быстро но уже намного лучше следующие библиотека которая привлекла мое внимание это петли g&p perfected же с использует ряд очень интересных оптимизаций в частности трасса для создания для создания шаблонов используется клон not а чуть дальше я покажу что это даёт большой прирост производительности но это решение позволяет пайпер клипу быть более прозрачным более понятным для девелопера но эти библиотеки нашлось бы недостатка она довольно большая ссора килобайт это больше чем react и несмотря на хорошие идеи разработки ведется довольно вяло этой библиотеке уже пару лет однако она до сих пор не вышла из стадии беты ну вот пообщавшись с этим библиотеками с другими библиотеками начитавшись начитавшись гурович ты мэр 5 я смог придумайте следующий список а техник которые позволяют ускорить работу с домом а первая вещь это virtual дом плюс и плюс и плюс ивановскую я долго искал нашел только один плюс он позволяет сократить количество вызовов да в том зачем самым подняв производительность однако overheat на создание о создании копии копии дома на мой взгляд все таки значительный сложный алгоритм и сравнения над которой до сих пор стоит завет завеса тайны от которой используется в реакция он но в общем то не такой бы за 100 быстрой как нам о нем обещают поднимите руку кто смотрел в алгоритм сравнения в реакции с один человек 2 а скажите как долго вы его искали в коде реактор ну например час 23 вы по ней ходили вы смотрели вы поняли как он работает до нее статей-то этих многая эти статьи считал проблема-то в том что в статьях написано написаны крутой алгоритм но как только вы начинаете зарываться в код но в общем дня два убьете точно чтобы понять как это по-настоящему работает более того всей этой магии которые о котором рассказывали в блогах там нет на мой взгляд но может тут ее найдет кроме того я сел на про а virtualbox сидит сидит на проблем на той проблеме что алгоритм ничего не знает о структуре данных пока мы ничего не знаем о структуре данных все наши wrapper и все наши элементы верстки негативно сказываются на производительности потому что алгоритм мёртвый дом должен их участвовать сравнение две техники о которых писали которые были известны очень давно это использование клон not о котором я уже говорил в рамках пайпер clips и докумен фрагмента есть эти техники используют для повышения производительности ни одна не другая техника насколько мне известно не используется ни евро ни в рай от хочу ни в angular джез не в реакции однако скриншот бенчмарка jasper х наглядно показывает что это позволяет ускорить работу с дом ну как минимум в три раза довольно не плохая практика очень советую пользоваться следующая техника которая лежит абсолютно на поверхности более того неявно встречается даже в ту турели при акты это созданию дом участков заранее давайте попытаюсь объяснить что я имею ввиду предположим человек заходит на страницу интернет-магазина электронных чайников вводят вводят название чайника название фирмы чайника который хочет приобрести в этот момент в этот момент на сервер отправляется поисковый запрос если ваши серверные программисты быстрые молниеносны то вы можете получить ответ за 20 миллисекунд эти 20 миллисекунд пользователь практически ничего не делает и в этот момент мы можем создать структуру дом под данные которые вернутся с нашего сервера довольно простая практика не знаю почему она не получила широкого применения для ее пользу и очень круто получается и того что получается мы шлём запрос на сервер пока мы ждем мы ждем ответа ответы сервера мы подготавливаем дом структуры дом под под данные которые должны к нам прийти сервера когда к нам приходит ответ сервера на самом деле нам его еще нужно разобрать чаще всего это не просто принять jison но и как-то адаптировать его под а.с. если к этому моменту дом у нас уже готов то те 2 3 4 миллисекунда которые которые у нас есть для работы же джинсы мы можем потратить на адаптацию и вставку данных дом и добавление данных на страницу очень советую и из использовать и это причем явным образом в ремарках эта штука не поддерживается но вы можете рука руками создать элемент при при отправке запроса на сервер и так снарядив шись всеми этими знаниями и найдя немножко свободного времени по ночам и выходных я решила написать небольшой прототип с которым мы стали дальше работать и того что же это шаблонизатор темпл он очень простой очень маленький там буквально меньше двух тысяч строк кода и так какими же свойствами он обладает шаблоны компиляции компилируется на момент сборки в javascript код то есть на клиенте никакой работа кроме загрузки javascript кода не делается возможность создать создавать куски дом заранее поддержана прямо в библиотеки библиотека позволяет легко и просто переиспользовать шаблоны размер библиотеки на мой взгяд более чем скромный в минимизированы и гриб ли нам виде это все всего 700 байт более того вещь которая мне в ней нравится больше всего это максимально быстрое обновление дом дальше попытаемся по кусочкам разобрать как же как же это все сделанные работает и так ну структура шаблона она крайне просто и примитивно собственно это усы внутри которых поставляются переменные в общем все довольно очевидно никакой магии кроме этого поддерживает две конструкции это порол итерация по ключу для циклов и ветвлений iv не поддерживаются выражение я некоторое время назад то появление react в индустрии доминировала мнение что нельзя не в коем случае мешать в ей модель я до сих пор верю что это правильный подход поэтому если хочется использовать сложные выражения лучше вынести это в отдельный компонент если помните есть такие есть такие паттерны проектирования презент и view мотал если вам нужно сложно подгадать сложно подготавливать данные для отображения в шаблон и лучше это делать там и не затягивать выражение в шаблон а дальше немножко покажу как с этим работать я считаю что не нужно на каждой на каждый чих создавать фреймворк будущее вэба и особенно компонентного ввв очень-очень маленьких и независимых библиотеках не требующих смены религии и выпиливания всего предыдущего из программы для своей интеграции в них и так как выглядит работа с temple of мы берем именованный шаблон из temple of up to этим об этом данные данные в нем вызовом обрит и вставляем его в дом фактически это очень похожа на работу с обычным дом и 5 также пьесы после того как нам как мы уже попользовались шаблоном мы можем убрать его и из дома просто вызовом ремус все очень просто как делается заблаговременно и создание doom-а предположим мы послали на сервер запрос и знаем что нам что сервера нам должен прийти набор чайников этот момент мы говорим говорим пулу шаблонов создай кришна 10 чайников он создается и когда мы в следующий раз будем делать такой же вызов get реально работы с домом не будет мы получим мужик уже подготовленный из рендере он их шаблон то есть получим получим шаблон для вставки в дом мгновенно когда этим удобнее всего пользоваться смотрите мы посылаем запрос на сервер и у нас есть 20 или секунд на самом деле конечно не 20 до скорее всего это 200 300 миллисекунд за 200 300 миллисекунд мы можем напиши ровать миллионы дом not то есть время достаточно а второй вариант это афишировать кэшировать шаблоны когда мы ожидаем дом контент loaded в дом контент road and наверно все знакомы на есть такая проблема что очень много очень много обработчиков подписываются на это событие и в итоге в момент прихода этого события просыпается чертова туча скриптов который которые все пока убёг начинают обрабатывать и после этого события а миллисекунд 100 приложение спит она глубоко считает там что-то чтобы сократить это ожидание можно кэширование дом шаблонов делать заранее до того как это событие к нам придет быстрые изменения были при внесении изменения в дом но тут я привожу простой понятный вызов он очень похож на очень похож на то как делается апдейт в реактор все помнят вызов реакций состоит разница только только в глубине стек а если вы видели то если вы смотрели насколько глубоко насколько функции функции делает вызова функции белый 3 акт перед тем как сделать целевое действие на а целевое действие у нас скорее всего такое просто подставить вновь просто поставить в дом это значение то знаете что для реактора это может быть глубина сто пятьдесят шестьдесят может быть больше каждый вызов особенно в динамических языках как javascript дается нам совершенно не бесплатно это не так медленно как дом вызов но все еще не бесплатно темпл позволяет делать эту замену с глубиной стыка 2 то есть по сути вызывается апдейт иногда это вызывается функция которая заменяет именно это значение по сути вот эта функция функция в или из глубиной штыка 2 мы получаем мы мы получаем целевое действие при этом я вызов апдейт рекомендуется использовать тогда когда мы хотим изменить сразу несколько значений ни одной если мы хотим изменить одно там и это можно сделать еще быстрее заменить прямым прямым вызовом property и тогда этот установка будет будет сделано с глубиной 100 к 1 быстрее физически невозможно перри использование шаблонов после того как пользователей сделал запрос поисковый запрос на чайнике насмотрелся на чайнике и сделал новый поисковый запрос мы можем вернуть шаблоны шаблоны в пул для дальнейшего использования чтобы потом их переиспользовать тоже поддерживает фреймворком вот такой вот функции релиз дальше попытаю попытаюсь вам продать этот инструмент с помощью бенчмарков а первый benchmark это я внизу всегда привожу всех всегда привожу ссылкам бич марк и помним что он от же с перси больше значит лучше в данном случае красная и the temple и синие это react с раком я сравнивают потому что react но наверное самое быстрое решение на он раз в пять быстрее чем angular обычно итак что же мы тут видим что первоначальная инициализация в темп и делается на ну процентов на 30 быстрее кроме 0 процентов на 10 15 firefox за счет чего живет получается внутри в конечном итоге используется абсолютно те же create элемент клиенты и текст not open child однако как я говорил в темп ли очень почти никогда нету глубины стыка больше двух по сути мы экономим время исключительно на вызовах внутри библиотеки те 35 килобайт javascript a court that который которые вы скачиваете для использования react отливаются вам ровно вот этой разницей в производительностью до длинные стыке следующий benchmark который который вы изобрели и прогнали это совпадает с of the blade это когда мы под стана подставляем в шаблон те же данные которые туда уже были подставлены это то место где должен проснуться virtual дом и сказать что ребята данные уже есть ничего делать не надо скажу сразу что для чистоты экспериментов на virtual дом я не использовал попью рендерер my queen и оказалось что оптимизации в самом браузере позволяют делать это в 4 раза быстрее virtual дом вносит тормоза в четыре раза нормально пойдем дальше с хардом да и там а еще интереснее hard апдейт это сценарий в котором шаблоне обновляется ни один участок дано все данные которые есть опять же не используем куриный миксы но он тут бы был и бесполезен и получаем ещё более интересные данные при hard аптеке выигрыш темпло ну вот он уже в десятки раз просто потому что там нет virtual дома virtual том на практике оказался очень очень ресурсоемкая операция и если вы глубоко программировали в react туда вы программировали react приложение то довольно быстро столкнулись с тем что работу с virtual домом нужно сократить я в этой идеи достиг полного перфекционизм и считаю что virtual том как как идея идея плохая его нужно выкинуть это сделает react нам легче килобайт на 20 и быстрее разбить однако библиотека темпл который мы делали очень маленькая дави остался это не facebook у нас их нету а миллионов инженеры часов у меня у нас есть только ну как вы понимаете разработка таких библиотек ты-то не очень продуктовые фичей в рабочее время заниматься этим не получается этим можно заниматься ночью небольшой группой энтузиастов поэтому для тех очень маленькая темпл не предлагают работа собирать работа то есть в реакции есть дом делегат в angular джесс своя работа с событиями но в общем то я и не считаю что нужно работу с событиями интегрировать в шаблонизатор то для этого можно из для работы событие можно использовать стандартные это even his inner можно использовать библиотеки для работы событиям мы используем дом зеленеет отрывки labs идти lapse it a fine и это подразделе эти подразделения fine in shell таймс ребята сделали очень хороший очень простую и производителя библиотеку ее размер если не ошибаюсь меньше 5 килобайт мы ее используем в паре с темпл и довольны результатами в пользу всех своих предыдущих бенчмарков и слов хочу сказать что а на данный момент темпл мы используем уже в двух проектах это мобильная версия aviasales.ru и новая поисковая выдача aviasales.ru в мобильной версии все шаблоны а преобразуется в 10 кило байт-кода речь идет о минимизирован им и зажатом коде и все приложение занимает 50 8 килобайт мне кажется это не плохой размер для довольно сложного символ при с приложением в следующим приложением которые мы разрабатывали была новая поисковая выдача там шаблоны уже занимают это более сложное приложение 15 лабает и все приложение занимает 70 килобайт ну так же было несколько интеграций с виджет с виджетами но они не менее интересны однако а 70 килобайт затем в подшипнике applications мне кажется это это хороший показатель до особенно если сравнивать с библиотеками которые весят везде собственно этот проект открыт в упал в open source и сейчас вы можете посмотреть его поиграться с ним по и поэтому юрий она все еще довольно с и рода как и говорил у нас нет огромного количества ресурсов для для того чтобы евангелизировать это наше произведение для того чтобы делать документации если интересно можете пойти там есть документация есть примеры есть плагина для гальки грунт и там вы можете увидеть хорошую производительность ну если я вас не утомил я готов ответить на ваши вопросы у нас еще есть 9 минут спасибо за доклад такой nine ключевой вопрос который я еще хотел тоже предыдущего докладчику задать что насчет сервер сайт рендеринга как я полностью сервер сайт рендеринга я его не дела у меня не было времени но мой коллега буквально пару дней назад загорелся этой идеей уже сделал pull request будет если надо будет круто спасибо просто это как раз проблема которая несколько дней последние голову вообще вот же с в этом плане очень хорошая штука дра все что вы можете сделать все что вы можете сделать на клиенте можете сделать совершенно собственно говоря в нем три спасибо дополняя предыдущий вопрос на самом деле глубоко убежден что virtual дом он создавался именно с целью того чтобы делать и сервис сайта клиент сайт рендеринг именно поэтому существует и любой другой библиотеке которые делает чистый клиентский рендеринг мы его не увидим я считаю именно поэтому а почему нет а берем но абсолютно тот же код шаблонизатора носить вставляем это буду дома а потом достаем оттуда энергичным и а это сделать любым шаблонизатор а как мы получим на аноде дом дерево они очень медленные очень а не будет быстрого это не допустимая скорость для серого рендеринга серьезно 11 плюс это мода мода написаны простите меня за эту ли лучшими с крестовыми программистами на планете это самый быстрый скриптовый язык если вы говорите что что на этом скрипте что нельзя что-то быстро просто вынужден с вами не согласиться окей тогда вопрос собственно 2 слышали про проект ostrovok.ru их опыт рендеринга базе с о чем то говорит что сказать по сути что он позволяет вам создать получить оттуда якоря дальше вы вынуждены работать дальше вы вынуждены работать уже уже неудобно то есть упираемся в прямой работы в домом это не очень хорошо спасибо последствии то вы говорите что вы искали библиотеки смотрели плюсы и минусы не подскажите может быть вы встречали называется мифрил мифрил может очень при нем рассказывать существами попив во первых это прямо жестко аллергия на фреймворке проблемы с такими вот какая если вашей системе уже есть один фреймворк чтобы втянуть на другой фреймворк вы должны выкинуть предыдущие да какой был он быстрый не был давайте стараться не делать и не затягивайте фреймворке кроме геморроя ничего не добавляют data in действительно можно делать очень быстрые вещи библиотека компактно но надо слишком низкого уровня и это framework фрэймворк am нет а здрасте спасибо за доклад отличный супер а вы скажите как вас в aviasales клиентский роутинг устроен больная проблема в первом приложение м aviasales.ru по сути у нас не сделан клиентский роутинга это символ пейдж плетей шин делается клинский routing понятно как через через history api проблема шаблонов полностью ортогонально проблемы клиентского роутинга темпл это движок шаблонизация если вы хотите сделать клиентский роутинг пойдите на git хоп в основном найдите там 300 библиотек по клиентского рейтинга возьмите ту что вам нравится а не та что шла в комплекте с ангулярным и и используйте пожалуйста а мы не используем утра самом деле принести что еще не используем клиентский роутинг на мой взгляд нужен тогда когда внутри сингл пейдж applications есть много страниц 10 20 30 если внутри внутри есть два типа страниц да как в нашем случае три типа страниц как нашем случае это форма поиска результаты поиска и детали билеты ради трех роутинга между тремя страницами затягивать библиотеку роутинга на мой взгляд небольшой оверхед но как только понадобится как я говорил это не прибор затянуть библиотеку которые реализуют просто и и хорошо и не нужно платить ангулярным здравствуйте я заметил что вас на слайдах все тесты приводятся chrome firefox но нету е я погуглил он производительности использовать фрагментов принципе и е страдает с производим использованием только смотрите краеугольный камень здесь на самом деле в мобильных устройствах на десктопах там где у нас стоят жирные мощные ресурсоемкие правда тепла емкие тепла производительные процессоры intel принципе проблем то и нет если вы не делаете глупости да не делаете сверх слишком много лишних движений и то у вас все и так более-менее окей работают вот когда вы приходите на мобилки это именно то место где и если есть то остаточных количеств нута начинаются проблемы поэтому но все-таки давайте давайте будем честными web кит на данный момент это примерно то чем был ее 10 лет назад если вы слушали докладчика из microsoft а который рассказывал разработке нового и то новый explorer тоже использует web кит вот инвалидов ну мы конечно поддерживаем инвалидов в лице 9 и 10 и и но их век предрешен и в общем если если человек пальто сих пор пользуется этими браузерами это человек в принципе уже привык к ущербному в его ну то есть вы готовы отказаться от клиентов с е-8 смотрите все наши сайты и оба этих проектов нормально работают и на мобильных explorer их яна яна яна яна десктопных explorer однако затачивать производительность под и эти сайты я не считаю огромной необходимостью тем не менее если вы сейчас используете react передано темпл вы все равно получите прирост глазки спасибо очень интересно скажите пожалуйста вы рассказали приложение которых себе содержит ну там 2 3 views то есть в принципе это очень простые приложения вынужден не согласиться это довольно сложные приложение ну давайте пойдем дальше по количеству там не знаю контроля а вот в больших прингл плеч предложению который очень это приложение там нет вот как в таких приложений достаточно низкого библиотеку использует чем больше не так не является в низком уровне библиотека в enterprise а-да-да-да суждено смотрите низкоуровневые приложения библиотеки это очень хорошо если у вас не ограниченное количество ресурсов да если у вас сидит 5 программистов да и вам нужно с пятью программистами сделать чудо вы не будете заниматься мифрил и мы низким уровнем ну просто что не успеете до если это enterprise там обычно полегче с деньгами мы в aviasales очистим на показателях дамы в каждый момент знаем мы вот-вот столько заработали денег больше сейчас не будет соответственно мы постоянно ищем компромиссно чтобы выигрывать в конкурентной борьбе наше приложение должны быть более качественными это значит что мы не можем использовать приложение то что наиболее широко используется в индустрии ампулярии акт мы должны быть немножко быстрее и задача найти компромисс между сложностью разработки и перфомансом нам если используем angular или react мы получаемся наше приложение работают как все ради большего перфоманса нужно делать что-то другое спасибо нужно все ли шаблонные рендерится на сервере шаблоны сейчас все рендерится на клиенте рендерится подождите то есть посмотрите на сервере происходит преобразование из шаблона javascript там дальше этот же javascript код можно использовать для серверного рендеринга а на данный момент у нас не было необходимости в этом но реализовать это как я уже говорил на ноги не сложно да мы подключаем любом любую дом библиотеку работаем с шаблонами в этой библиотеке потом есть по принципу реактора то есть нет никаких data binding of же я честно говоря я думал вот вопрос а когда же и зачем появился в реакции в реакции серверный рендеринг и нашел ответ в коде в коде реактор а в коде react а когда вы импровизируете компонент первоначальная вставка в дом делается через энри что м.л. это позволило господам из реактора сделать сделать северный рендеринг за бесплатно если мы уже делаем инари что м-р это значит что строка кода у нас уже есть а значит что серверные ну и на мой взгляд вот здесь подключились евангелисты react а которые ну которые этот пусть стали пропагандировать как таковой серверный рендеринг нам наверное нужен только в одном случае если мы делаем search engine optimisation так а во всех остальных случаях это способ ну способ передать по проводам больше данных сделать это можно но вот пока у нас надобности не было я просто вот в темп ли не заметил каких-то атрибутов на обработку кликов и я говорил это не не серверном ринге речь речь обработки событий яко целый слой посвятил этому темпл не занимается обработки событий для обработки событий но смотрите по сути это две вещи это том делегат и шаблонизатор ну плюс ещё куча странного кода темпл является только шаблонизатора если нужен дом делегата он очевидным нужен дата я предлагал использовать тонн delicate от от войны и shell таймс это довольно хороший дом делегат он легкий да если у темп 800 байт runtime библиотека у этой у дом делегата этого библиотека еще 5 килобайт а в сумме ну окей с этим можно жить это в десять раз меньше чем спасибо нас кончилась временно вопросы и сейчас начнется кофе-брейк поэтому давайте скажем спасибо борису и увидимся с вами в 4 часа"
}