{
  "video_id": "FvfPwG-ScL0",
  "channel": "HighLoadChannel",
  "title": "Как организовать поиск в стартапе, который планирует вырасти до масштабов Вконтакте/Богдан Гаркушин",
  "views": 290,
  "duration": 2909,
  "published": "2023-10-06T07:20:42-07:00",
  "text": "Меня зовут Богдан гаркушин я отвечаю за поиск ВКонтакте и расскажем соответственно про поиск коротко о себе и поиском занимаюсь примерно 20 лет начинался разработчика в те времена еще был хардкор если плюс плюс потом работал в Яндексе был просто менеджером и в те времена еще не было продакт-менеджеров потом был Рамблере и отвечал за продукт и сейчас вот работаю во ВКонтакте руковожу поисковым направлением о чем мы сегодня поговорим мы сегодня поговорим о движках ранжировании об архитектуре и еще о качестве поиска о том как его измерять при этом мы с Вами рассмотрим некий путь вашего проекта который начинается с чего-то маленького или вообще начинается с листа бумаги когда проекты еще в реальности не существует и посмотрим какие стадии он будет проходить относительно поиска как может меняться подход к поиску в зависимости от того насколько ваш проект вырос и Какие задачи и проблемы вы будете решать в это время а также мы посмотрим Ну коснемся оценки качества поиска и группа Или посмотрим на то как можно это качество поиска измерить все измерение Я в общем разбил на три части на 3 группы метрик метрики аудиторные метрики поисковые метрики конверсионные самое главное обычно что интересует это некие конверсионные метрики Например если вы хотите делайте поиск по людям или по видео то Вас интересует дружбы в конечном счёте или просмотре видео а поисковые метрики это как раз та самая позиция клика То есть если поиск релевантный то нужный результат он будет находиться выше или вообще результаты поиска будут Ну аудиторные метрики как правило это такая долгосрочная история она меняется не сразу и пользователи либо начинают к вам приходить если вы делаете что-то правильно либо от нас потихонечку начинают уходить если вы что-то меняете в поиске но делайте это ну не в ту сторону в которую хотят двигаться ваши пользователи а Итак мы стартуем ваш проект пока что только начинается он еще на бумаге вы готовитесь и у вас вот такое состояние проект в реальности нету данных мало результатов поиска предполагаемого потому что вы про это не думали про Это скорее всего подумал ваш дизайнер или кто-то там еще и в общем нет аудитории нет нагрузки и все ваши оценки на бумаге Ваш Ваше представление о том как будет выглядеть продукт для пользователя вот такое что-то там нарисовано что-то есть в фильме и вы пытаетесь спроектировать это сделать и мы здесь посмотрим на некую архитектуру возможно вашего решения и на подход к тому что нужно вообще сделать по большому счету примитивно архитектура выглядит так с приложения есть API Я за поиском есть базы данных и в общем-то никакие специализированные движки Здесь особо Наверное не нужны можно средствами базы данных просто сделать все предполагаемые и необходимые для поиска решения Но вот произошел произошел следующий этап и вы запустились То есть у вас уже появились первые пользователи и они хотят чего-то своего они начинают вам приходить через службу поддержки с пожеланиями Мы хотим вот этого мы хотим вот того Вы начинаете видеть что-то на своих метриках и графиках что что-то идет не так и у вас появляется некие новые функциональные требования например пользователям нужно чтобы по запросу Дима находился Дима в транслите Ну то есть кто-то пишет себя У нас социальности как Дима по-русски кто-то Дима английскими буквами или может быть вы хотите пользователь хочет под ними находить Дмитриев а еще он хочет чтобы найти не просто Дмитрия но еще и Дмитрия в транслите пример с димами потому что в отделе поиска больше всего Дим работает поэтому первое что пришел в голову что дальше естественно вот это вот история она немножко меняет подход к тому что должно быть в продукте и возникает вопрос вообще Вот мы сейчас что-то изменим а вообще пользователю это надо или нет Или он просто попросил потому что он так захотел и вот вот здесь возникает уже потребность в том чтобы что-то измерить и вот эти вот изменения которым вот Вернемся назад на один или два слайда Эта история про полноту То есть у вас был по запросу Дима один результат до этого А тут стало 4 А может быть 10 и влияет это на такую метрику качество поиска как процент поисков которых найдено хоть что-то и здесь возникает самая главная история Что важнее всего стало ли хорошо если операция только на метрику процента нуля результатов поиска то скорее всего вы конечно же метрики достигнете своему там руководству отчитаетесь что вы улучшили качество А может быть пользователь Ну как-то это не почувствует и я здесь мы мы неоднократно сталкивались с тем что мы снижали долю нуля результатов поиска разными способами а не видели никаких прокрасок на других метриках Например если Мы возвращаемся к поиску по людям то Дружба от этого больше не становилась И к чему я клоню Потому что всегда когда вы какую-то одну метрику в любом продукте неважно поиск это не поиск хотите выращивать Придумайте себе еще одну метрику которая будет ее проверять То есть это вот как бы как при первом программировании проверка на ноль то есть на крайние результаты то же самое и в продуктовых историях важно проверять чем-то еще то что вы создаете или пытаетесь улучшить Вот и когда у вас появляется вот это вот функциональные требования к вашему продукту в этот момент возникает история про то что вообще хорошо бы воспользоваться готовыми решениями которые специализируются на поиске в принципе средствами базы данных любой поиск можно сделать но это будет долго дорого Ну и в общем как-то бесконечно и вот в нашей архитектуре появляется элемент такой как поиск и в целом основная История это хороша тем что мы берем готовое специализированное решение с рынка или пишем его сами допустим Но в этот момент появляется основная такая проблема то что нужно постоянно базу данных сервиса синхронизировать с поиском этот процесс называется индексация то есть про это надо важно не забыть в качестве поисковых решений можно выбрать Ну разные которые существуют на рынке Я здесь предложу 3 или 4 с которыми хоть как-то имел дело на самом деле этих решений больше первое что приходит в голову самое простое Сфинкс достаточно простая штука которая интегрирована с УВД и в этом ее основное преимущество как-то раз мы даже в одном маленьком проекте это использовали и в целом хорошо выполнял свою функцию также есть API на питоне в принципе удобно устраивается а тут мы летом попробовали Во ВКонтакте прям такую штуку как Веспа в целом это сразу некий Нова новомодный векторный поиск ядро на c++ поэтому быстро Хотя вопрос спорный горизонтальное масштабирование позволяет вам добавлять данные и не переиндексировать все снова просто доставлять сервера и у вас как бы это решение будет работать ну и машинное обучение эта штука поддерживает не знаю плюс это или минус ориентирована на cubernetics в нашем случае был огромный большой плюс у нас была стажировка по стажируем Мы решили в летней стажировки поэкспериментировать с этим самым губернатисом точнее и в итоге в конечном счёте к осени у нас был ста превратился в человека в члена команды и мы получили Ну на самом деле большой плюс хотя на весту Мы конечно же ничего не перевели потому что вся инфраструктура У нас заточена под другую систему о которой будет дальше Дальше тоже на слуху эластик Search и sour это готовые движки поверх цены они на javi помогают делать быстрый Старт но минус в том что они отстают от цены и испытывают некоторые проблемы при большом объёме данных в моем опыте личном я сталкивался с ластиком когда работал в Рамблере Он практически использовался для всех сервисов поиска кроме почты как раз вот на почте мы столкнулись с тем что влетает постоянно огромное количество писем и стандартный Вот индексатор который синхронизирует поиск с базой данных он просто не справлялся с нагруз и пришлось писать индексатор самостоятельно Но если вы начинаете что-то писать самостоятельно власти к серчея или в солори то по сути вот она люцена это библиотека которая лежит в основе и проще использовать ее какие у нее плюсы и они же являются минусами Плюсы это то что это библиотека это же минус если у вас нет желания тратить на это время и инвестировать в это время и ресурсы разработки то это будет вам минусом А если вы делаете крупное высоконагруженное решение то вы можете с этим с этой библиотекой делать все что захотите это будет плюсом ну и плюс эта штука это это библиотека она развивается уже на протяжении порядка 20 лет поэтому все функциональности все возможности которые нужны в поиске она поддерживает движемся дальше собственно следующие первый этап когда мы занимались только движками относились к поиску как базе данных Он в нашем случае условно закончился Теперь вы задумались о качестве поиска А почему о нем Стоит задуматься потому что вдруг у вас стало много результатов примеры своей жизни буквально за полторы недели до того как выйти на работу ВКонтакте и заниматься поиском я уже знал что выхожу во ВКонтакт мы встречались в Подмосковье обсуждали один проект и сидели за столом соленой кузьминой и нам нужно было обменяться контактами поскольку я шел Во ВКонтакте я решил думаю контактами ВКонтакте и ввел запрос Алена Кузьмина Ну как вы видите тут 4000 результатов сейчас это 4100 Сколько было тогда я не знаю но тоже было много и нужно Алена кузьминой не было среди там в первой десятке в первой двадцатки А дальше у меня не хватило терпения искать и первое что мне пришло в голову А что если сделать поиск критерием ранжирования это расстояние Вот мы сейчас находимся здесь с вами в одном зале и по идее если сейчас войти в приложение ВКонтакте если каждый войдет и поищет друг друга то Логично было бы найти того кто сидит в этом зале они кого-то другого это была такая гипотеза когда из этой гипотезы Я уже выходил Во ВКонтакте чтобы что-то поменять и прежде чем реально что-то менять мы обратились в отдел который занимается друзьями которые занимаются развитием социального графа и Выяснилось что большинство дружб проходит именно вот она делится в зависимости от расстояния то есть первые порядка 20 или 40 процентов дружб происходит на расстоянии двух километров друг от друга порядка 60 процентов Друж происходят в расстоянии 20 км друг от друга то есть когда пользователь находится в одном городе Ну примерно средний город 20 километров Даже даже в Москве это такой достаточно большой объем район порядка 80 процентов Друж происходит на расстоянии 100 километров То есть это реальный фактор то есть вот это гипотеза которая у меня была до устраивания в контакт она была подтверждена определенными данными и мы решили в общем-то это сделать в поиске К сожалению я свой график про качество поиска немножко на потом перенес но заранее скажу что это третья Я про конверсионные метрики в этот момент прокрасилась у нас сразу на 20 процентов просто от того что мы стали ранжировать по расстоянию пользователей у нас из поиска стала на 20 процентов больше Дружбы что было прям явным показателем того что пользователям это было нужно но такая система она требует добавления еще одного элемента в нашу архитектуру это вот такая штука которая считает высчитывает блок который высчитывает форму ранжирования причем эту форму каждый из вас может в общем-то придумать сам если в общем-то любой из нас может что-нибудь придумать вот например отсортировать по расстоянию но но тут происходит как раз следующий этап следующий этап Когда у нас все также много результатов Но самое главное это критерии например Вы ищете Тимати и здесь с одной стороны в одном сценарии Вы хотите найти звезду какую-то Ну например Тимати Но на самом деле в социальной сети Вконтакте он оказывается выглядит как Тимур Юнусов они Тимати То есть сразу появляется история не только про звезд но и про синонимы а также Возможно вы все-таки ищете друга который решил называться почему-то Тимати также возможен социальный Граф Ну если мы в целом рассматриваем поиск на ранжирование может влиять количество общих друзей Ну понятное дело что расстояние остается как критерий но и новые знакомые то есть условно не только число общих друзей но и число друзей друзей тоже может влиять на то насколько высоко нужно поднимать тот или иной результат и тогда когда у нас критериев становится хотя бы 5 придумать форму ранжирования становится уже тяжело Вот и но ее можно придумать научит будет ли она учитывать все параметры и все критерии которые мы сюда заложим неизвестно вот поэтому мы здесь привлекаем на помощь машинное обучение машинное обучение просто за нас подбирает эту форму наша лишь задача правильно передать данные в этот блок в этот модуль и правильно обучиться и опять же в этот момент важно смотреть за метриками у вас поиски с действиями должны измениться в нашем случае когда мы добавили новые критерии кроме расстояния там синонимы Транслит и плюс добавили ранжирование у нас суммарно по-моему процентов на 25 увеличилось число дружбе Еще плюс к тому что было после расстояния то есть мы таким образом за год работы прям феерически вырастили число из поиска движемся дальше и бывает еще такой так называемый сложный eml То есть как в самом эмэле там тоже технологии как-то развиваются постоянно то есть они учатся по новому подбирать формулы и работают с разными историями То есть например если мы делаем поиск по видео то иногда вы не знаете Но помните что там какой-то был Волшебник в очках это может быть Гарри Поттер или опять же комик в очках Гарик Харламов или ведущий КВН Вы помните но не помните что зовут Александр Масляков а в этот момент там существует Фаст тексты существуют бирты это технологии как раз работы с текстом И нахождение синонимов дополнительных которые принято называть бедингами в общем по большому счету вся эта история про то чтобы еще больше собирать сигнал то есть в нашем случае в социальной сети Вконтакте когда выкладывается видео оно выкладывается час зачастую вместе с постом а к посту бывают еще комментарии так вот если из поста из комментариев можно собрать эти самые синонимы по которым тоже можно потом уметь искать схема при этом у нас не меняется просто модуль машинного обучения становится немножко другим движемся дальше в целом над качеством поиска мы поработали и это такая Бесконечная история которую можно заниматься годами Теперь мы можем подумаем про архитектуру и про нагрузку могу сказать что вопросы архитектурные могут наступить гораздо раньше чем вопросы качества поиска то есть эти блоки могут между собой меняться местами зависит от вашей ситуации вот как показывает опыт того же контакта сначала решались архитектурные вопросы потом решались вопросы качества но в вашем проекте может быть наоборот Ну то есть зависит от специфики так вот у вас Вам пришло много пользователей принесло высокую нагрузку что надо делать Вот как вы видите у вас красным стал пояс он иногда перестает отвечать или отвечает очень долго то время которое время ответа Вас не устраивает и пользователи от вас начинают уходить Понятное дело что самая простая история поставить реплику с репликацией наверное знакомы всех кто хоть раз делал проект с Любой базой данных та же самая репликация и в поиске Только эта репликация требует появления балансера который будет распределять нагрузку этот запрос пойдет сюда этот запрос пойдет вот сюда Это по абсолютно два или три или там 10 одинаковых серверов с одинаковыми данными с одинаковыми программным обеспечением и они отвечают на ваши вопросы другая проблема Когда у вас очень много данных как это выглядит то есть база данных сервиса такая что на один сервер поиска все это дело не помещается по разным причинам то есть Вы конечно можете и добавить дисковое пространство Но вот например у нас все поиски делаются в памяти в оперативной чтобы очень быстро отвечать пользователю все данные поисковые должны лежать в оперативной памяти такое требование у нас вы можете использовать для этого SSD диски которые тоже быстрые тогда у вас будет чуть дешевле стоить память Может вы на один сервер сможете положить больше данных но тем не менее такая ситуация возможна и здесь помогает шортирование шарнирование просто делите данные на несколько частей Например на две Таким образом у вас появляются два шарда и два две реплики половина данных лежит здесь половина данных лежит вот тут вот это все объединяется на уровне балансера и вот формула ранжирования ранжируется потом и выдается пользователю в том порядке в котором хотелось ему отдать Ну и следующий шаг по сути один из заключительных Когда у вас очень много сервисов когда компания выросла до Большого масштаба и вы у вас есть какой-то один корм бизнес и вы начинаете делать еще дополнительные бизнесы которые рядом с этим Core бизнесом выполняют какие-то задачи и этим сервисом тоже нужен поиск самое простое решение повторить то же самое что было только несколько раз Ну как бы забегая вперед скажу что точнее не забегая вперед а прямо сейчас скажу что вся эта история по большому счету у нас так и работает по разным причинам можно сказать что еще базы данных у нас разные это вот движки которые сегодня рассказывались о которых рассказывалось других секциях а движки поисковые у нас одинаковые мы сделали все на базе Вот и над всем этим Мы недавно решили сделать глобальный поиск в этом году в начале года в глобальном поиске вы могли найти только людей и сообщества А сейчас там есть и музыка и клипы и видео и Вот пример запроса Баста тут Сложно представить что хочет пользователь Когда будет подобный запрос он может быть хочет найти профиль Васи Вакуленко это тоже синоним Басты может быть он хочет подписаться на его сообщество Может хочет посмотреть видеоклип или короткий клип записанный под музыку Басты А может просто хочет какой-то альбом Баста послушать музыки всё это мы собрали в Единый глобальный поиск и сейчас во все работаем над ранжированием блоков для которых тоже нужно машинное обучение Итого ВКонтакте на данный момент поиск ВКонтакте сегодня это 6 крупных сервисов это 20 миллионов ежедневной аудитории которая создает нам нагрузку это порядка 50 миллионов поисков в сутки А поскольку мы ищем по каждому символу в отдельности То есть вы начинаете вводить пассивно и мы выдаем результаты поиска на каждый символ то этих запросов реально порядка 250 миллионов ты такой настоящий холод Ну а вообще у нас поисковых мастеров 54 в шести из них мы занимаемся качеством и еще в большом количестве мы поиск используем просто как базу данных Возможно ли другая архитектура Ну на самом деле возможно То есть можно физически на один сервер положить разные поиски поиски разных сервисов то есть мы берем каждый сервис разбиваем на маленькие единички вот эти вот маленькие виртуальные единицы Мы в хаотическом порядке раскладываем по всему доступному количеству серверов которые у нас есть а на уровне балансера или некого прокси от сервиса происходит некая маршрутизация которая знает что надо сходить на тот сервер на этот сервер поискать там там ну и получить результат такая архитектура наверное позволяет сильнее и лучше утилизировать ресурсы но обладает и своими минусами минус в эксплуатации поэтому мы мы остановились на предыдущей архитектуре она для нас более удобно но такая тоже возможно Итого мы с вами прошли путь от старта и до очень большого проекта с большим количеством сервисов с высокой нагрузкой с машинным обучением метриками и в общем-то посмотрели как менялся подход к организации поиска Привет На этом все спасибо Будем в контакте сейчас наши помощники вас найдут и принесут микрофон Добрый день У меня вопрос Вы говорите что у нас много данных в базах да у вас есть поисковая машина с какой-то видимо своим хранилищем Да с какими-то данными по которым вы в итоге ищете пример там Луценко там синонимы какой-то применение языковых правил то что у вас отдается на ленте в поиске вы эти данные откуда берете То есть вы берете из базы в которые у вас лежит поиск То есть вы индексируете туда все данные в моменте достаете их и отдаете на в Интерфейс Да либо же там вы индексируете какие-то атрибуты по ним ищете там плюс-минус там какие-то идентификаторы есть сваливаете его где-то прокси который у вас поисковый и идете уже за данным нормальную и потом только отдаете но как бы тут вопрос такой Ну получается это долго и Ну как-то у вас хорошо у нас мы ходим в разные базы Особенно для того чтобы собрать факторы ранжирования на основании которых будет выполняться сортировка результатов Мы конечно же пользуемся не только данными которые лежат в поисковом движке но и теми данными которые поставляет нам сервис например одним из факторов ранжирования конечно же является профиль человека который в данный момент ищет и этих данных в движке Нет мы не знаем кто будет искать и за счет объединения данных про пользователя и данных которые у нас есть об объекте который является результатом поиска мы как раз выполняем вот сортировку результатов поэтому ответ мы ходим во все источники доступные это максимально для формирования результатов поиска используются данные из поисковых движков а где-то они конечно же обогащаются сервисом ответ такой Богдан Спасибо большое за доклад очень интересно скажите пожалуйста вот у вас Бывает ли такие моменты когда нагрузка в какой-то короткий промежуток времени растёт кратно или выше после сравнивать с банковским приложением например момент когда все получили зарплату и пошли оплачивать там коммунальные услуги или что-то ещё и если есть такие моменты то как вы масштабируете нагрузку Да насколько это быстро происходит плавно Ну на самом деле в нашей системе Мы конечно же имеем свою поисковую архитектуру на этой архитектура конечно же встроена в общую архитектуру в Контакта и вообще она строилась на базе в контактовской архитектуре по работе с нагрузкой и в этой архитектуре предусмотрены каши которые умеют работать там на каком-то коротком промежутке времени и на протяжении этого короткого промежутка времени мы можем результаты поиска тоже кэшировать поэтому наверное не так критично получение зарплаты в банке в нашем случае но ситуации всплесков нагрузки у нас более или менее равномерно распределены по часам в течение дня в целом наверное вот такой ответ в целом Мы готовы Спасибо большое за доклад хотелось задать вопрос Следующий в презентации рассказали о том что вы ну показывали пример на базе именно поиска там по-честному по фамилии по сообществам и так далее насколько я помню вас ранее был Ну может сейчас есть посетный поиск по каким-то конкретным результатам то например по городу по вузу Там и так далее пасетный поиск у вас реализован всё также на лице цены или вы используете для этого другой сервис нет всё так же на лице у Конечно же это зона требует поиск который функционально позволяет выполнять такие задачи мой любимый вопрос на собеседовании Что такое фасетный поиск можно я не буду на него отвечать Спасибо за доклад Мне понравилось Меня зовут Федор Вопрос такой А какое отставание индексной базы от основной базы но по времени имею ввиду и особенно в части изменения данных то есть что-то кто-то изменил Через сколько в поиске это будет видно но на самом деле это происходит практически мгновенно Но вот тут вот на первом ряду сидит вся команда разработки они меня наверное поправят Или потом придут ко мне рассказывать что я что-то рассказал неправильно но это секунды за вами присматривают за мной присматривает конечно это прям секунды это прям порой доли секунд смотри смотри Извини что на ты не все данные требуют обновления Real Time то есть некоторые данные Например если у видео уже 100.000 лайков то плюс один лайк к нему особо информации в поисковом движке Ну не изменит ранжирование коренным образом а если лайков всего два то третий лайк очень важен Поэтому вот эта вот система Мы точно делали э чтобы не вот три алтайм вылетали например лайки это же изменение информации об объекте А чтобы они зависели от того в каком состоянии сейчас находится этот объект и если этот объект Вот это изменение для него не сильно значимое то тогда лайк прилетит С задержкой вот сгруппированном виде там сразу 100 лайков прилетит А сюда сразу 10 вот в зависимости первоначального количества задних рядов еще вопрос Здравствуйте Антон хотел бы спросить у вас вопрос по поводу разделения баз данных у вас было что вы разделяете базы данных по данным и есть поисковые машины которых тоже существует по количеству баз данных хотел спросить по поводу ранжирования у вас изначально какой-то выше стоит сервис который контролирует раньше и занимается балансировкой уже ранжированию где-то выше чтобы данные подтягивались именно те которые должно быть в этом ранжировании или как-то по-другому ну у нас есть два уровня ранжирования один уровень ранжирования на движках которые апеллируют меньшим количеством данных это принято называть неким таким черновым ранжированием или при ранком второй слой ранжирования у нас на уровне быканда То есть когда Back and уже оперирует всеми данными которые нам доступны в данный момент и на которые обучена формула и собственно этот ответ выше или ниже Один Первый слой на уровне люцена второй слой на уровне бизнес логики Спасибо за доклад Вопрос такой вот вы упомянули когда показывали про масштабирование вскользь так про репликацию и про шардирование Но вот у вас доклада как-то так очень гладко получилось что вот Взяли реплицировали Взяли шортировали а на самом деле тоже большая проблема Да вот куда выносится логика шарнирование По какому принципу нападет вас какой-то вот есть вот некий балансировщик вот Таинственный происходит вы сами писали то есть вот эту проблему масштабирование как решали Ну если если говорить про шарнирование на самом деле такой прям краеугольной проблемы в этом нет то есть можно придумать простейшие шарнирование используя остаток отделения на некое число равное количество серверов которые вас доступно для этого сервиса Поэтому вот это конечно логика будет на уровне балансировщика но это простая вот это вот остаток от деления остаток отделения один значит на первой на остаток отделения два Значит на второй 16 на 16 ничего Там сверху ни на кого А зачем зачем усложнять если можно просто сделать задачи Нет ну потому что бывают разные ситуации Да там то есть у вас грубо говоря там не знаю допустим если берём данные по алфавиту да бывает вы знаете там от А до в этом у вас триллион записи А вот там беда я там миллион Именно поэтому мы не используем алфавит для шортирования это один из вопросов на собеседование которое мы задаём Точнее ну на Технической части Спасибо Здесь вопрос Здравствуйте спасибо за доклад Как у вас устроен поиск сообщениям или сообщение в памяти так же как и с остальными Ну смысле в оперативно имею ввиду поезд по сообщениям это единственный поиск в который мы не внедряли поисковые технологии потому что он сам движок сообщений предполагает внутри себя поисковое решение и поиск по чатам Это сторонняя история То есть она отдельно от самих чатов а поиск по сообщениям внутри чата встроено в движок мы туда не планируем заходить потому что это потребует очень сильных ресурсов роста ресурсов по железу на эту задачу с которой в принципе текущее решение справляется на первом ряду Спасибо за доклад Вот вы упомянули что ранжирование двухуровневое то есть есть Где Когда ранжирует сам движок и некий следующий уровень который делает следующие ранжирование более Ну как бы подходящая пользователя и вот вопрос с пагинацией То есть получается вот этот второй слой получает какой-то все-все-все объекты что Нашлись и просто если как бы отсортировать вагинация может сбоить если мы не всё получаем от первого движка только первые 10 товаров а на самом деле в тысячи движков отправляется или там в шардов отправляются запросы с каждого шарда приходят по 1000 результатов или по 500 они обрезаются вот поэтому критерию и уже то что пришло но на уровне backendo выполняется выполняется ранжированием То есть получается дальше чем вот этот первый ответ от сервиса мы не сможем уже ну там ну не 500 а там дальше 500 это кстати одна из проблем с которой мы сейчас пытаемся которую мы решаем сейчас в одном из сервисов например в поиске по сообществам какая проблема нужно в идеале находить сообщества по трём критериям Первое или по четырём первый на первичном отсе- первый критерий это критерий популярности самого сообщества второй критерий это критерии близости сообщества там кто к тому месту положение Где находится сам пользователь в данный момент и третий критерий это вот в профиле пользователя есть условно учился учился в городе там таком-то ВУЗе был в таком-то городе родился в таком-то городе а сейчас нахожусь в Москве и вот это все в идеале тоже получить на первичном отборе и вот эту историю мы как раз сейчас конкретно в сообществах пытаемся порешать для того чтобы на первичном выборе из базы данных во вторичный контур попадали все исходные данные о том например какой-нибудь не знаю МФЦ который находится с вашим домом рядом Ну например не достанем Да но с МФЦ там проще потому что все-таки это первый критерий по расстоянию от вас хуже гораздо если там вы учились в какой-нибудь школе номер восемь в маленьком городке и она а школа номер восемь вообще-то много она практически в каждом городе есть вот в этот первый пул она просто не попала та школа в которой были Вы то есть просто решается путём энного количества запросов более узких и на уровне вот этом втором идет ранжирование из первого уровня из данных которые на Первом уровне отобраны по разным критериям Спасибо подскажите пожалуйста а как обеспечивается у вас гарантированность доставки данных в поисковые движки в том плане что в особенности если мы рассматриваем какую-то транзакционность операции То есть это кто-то отправляет допустим сообщение в очередь сообщений А что есть очередь сообщение допустим по какой-то причине недоступны и так далее если Потерянные какие-то сообщения как это решается Спасибо Да я к сожалению в эту часть не погружался я мог бы предложить моим ребятам ответить Но я знаю точно что у нас есть очередь доставки в в рамках ВК вот насколько Она отказывалась устойчивая и так далее я вот к сожалению не знаю просто на этот уровень продукта я не погружался очередь кто кладет сообщение это наш индексатор кладет У нас есть на самом деле защита от того что что-то не попало в индекс У нас конечно же есть у нас есть два вида индексаторов один вид индексаторов это оффлайн второй вид индексаторов это онлайн оффлайн индексатор может пойти в сервис и забрать все данные там условно заново вот а онлайн индексатор Он как раз отслеживает вот эти вот изменения которые происходят в течение дня что-то выложилось на стену что-то выложить в сообществе где-то произошли реакции где-то произошёл какой-то новый комментарий и вот это вот Реал тайм такая штука она обеспечивается за счет онлайн-индексаторов а оффлайн индексатор может как раз какой-то период времени сходить в сервис и все заново переиндексировать Ну Да добрый день спасибо за доклад вопрос про поиск по видео вы пользуетесь только текстовым отбором кандидатов при поиске по видео или пользуетесь каким-то векторным сейчас на данный момент у нас только текст но мы готовимся к тому чтобы был Вектор на самом деле скажу Так мы когда-то давно экспериментировали с вектором и с текстом был сделан Но мы его сейчас заново реанимируем и пытаемся подойти к этому вопросу на неком новом уровне во-первых пытаемся использовать поисковые движки в частности люцерна для хранения этих векторов А до этого это просто было сделано нафаст тексте и поэтому полноценно там индекс тяжело было такой большой хранить второй момент мы конечно же сейчас переобучим заново и будем прям вкладываться в это место чтобы из вот этого источника получать достаточно большой сигнал сервис Я надеюсь ты запоминаешь все вопросы Я уже сбился заметь никто не спрашивает как это было в mvp всех интересует что именно сейчас у Вас хорошо значит тема следующего доклада будет на все вопросы которые были заданы сегодня северные Друзья давайте еще один шанс последний вопрос который возможно попадет в список тех которые понравится Богдану за него подарит я вижу как это было в mvp Ну так коротко если Ну я могу лишь сказать как это было четыре года назад когда я пришел во ВКонтакте четыре года назад ВКонтакт развивался поиск был частью движка отдела движков продвижки сегодня рассказывал Илья Щербак и движки Ну а поисковая база Это был один из движков и естественно Эта история была самописная но был там Surge 2 был всего лишь один естественно были движок хинтов был движок тарг это движок рекламы Это тоже поисковая решение на базе него мы делали ранжирование по расстоянию и мы пытались сделать H3 и мы даже Начали его делать но когда спустя некий квартал Я понял что все идет Не туда Мы решили подумать как бы эту задачу решить по-другому и поняли что на рынок выпускать еще одну поисковое решение в Open Source это конечно круто и Наверное наши чувства собственного достоинства в это очень сильно потешило но с точки зрения бизнеса Наверное это было бы очень неэффективно вот поэтому с приходом нового технического директора который сегодня как раз выступал Он предложил люценну а я за это очень сильно ухватился потому что в моём предыдущем опыте в яндекс.почте мы использовали ванильную цену то есть то что как бы люцерна как люцена также как вот у нас здесь а в Рамблер поиске был ластик Search который тоже поверглю цены То есть все сложилось и мы решили А давайте мы не будем делать еще одно VP виде движка еще одного движка на рынке Давайте все-таки возьмем то что то с чем мы имели дело и попробуем на этом запуститься какой провокационный был вопрос Ну что давай выберем лучший вопрос за который мы подарим подарок от ВКонтакте пускай будет последний вопрос Лучше Богдан тебе тоже дарим подарок небольшой презент от конференции хайлот за классную тему поиска поиск это всегда классно это то что нам помогает то что делает нашу жизнь лучше друг Встань пожалуйста тебя не видят чтобы тебе вручить Классный подарок Спасибо большое спасибо друзья вам Я хочу сказать до свидания До завтра Завтра будет еще больше интересных Тем главное не переборщить сегодня вечером чтобы завтра прийти утром на первый же доклад всем До завтра Пока пока"
}