{
  "video_id": "_r8vLPTl0PE",
  "channel": "HighLoadChannel",
  "title": "Асинхронная репликация без цензуры / Олег Царёв (Mail.Ru Group)",
  "views": 2001,
  "duration": 2464,
  "published": "2017-04-22T12:17:32-07:00",
  "text": "есть мастер мастер неожиданно упал мы продолжаем работы система продолжает работать клиенты мигрируют на вторую базу в есть база нужно делать резервные копии если делать резервные копии на основной базе мы можем получить какие-то проблемы по деятельности увеличения времени отклика это плохо поэтому достаточно распространенный пример асинхронной репликации это снятие резервных копий со своего другой пример это миграция запросов каких-то чижовых запросов с мастера на своими с основной базой на вторую ну например состоянии отчетов иногда бывает потребностью чтобы приложение могло получать все обновления из базы желательно и в режиме реального времени и этим занимается библиотечка который называется lip своими есть ссылка сходить и почитайте отличная статья open source библиотека и мы ее используем у нас ну где-то по особенной она серверов который работает как носитель своими вот если забрать и вместе мы увидим вот такую картинку эта структура проекта я работаю у нас есть один мастер у нас есть куча свои wav файл power для резервирования если мастер упал своей для бэкапов своих для построения отчетов и несколько своего которые ретранслируют изменения на штуку который называется баннер д это название демона и он работает через своих и много поэтому стоят такие вот общий на достаточно большой проект достаточно большая база и при этом мы всегда работаем на сервис не падает мы раздаём рекламу и у нас достаточно серьезная нагрузка и репликация у нас используется повсеместно вот так все таки вот есть база и основной смысл а то что она гарантирует принцип все или ничего то есть изменение происходит либо целиком либо не происходит вообще ну например перевод денег и прочие интересные примеры кадр как как это делается сейчас мы коротко пробежимся как базы гарантирует целостность данных есть сервер есть оперативная память есть диск есть клиенты которые ходят базе память это организовано виде страничек когда приходит какой-то запрос на обновление данных странице модифицируется сначала в оперативной памяти потом попадает на диск проблема в том что принцип всё или ничего и на современном железе не представляете сделать возможным это физические ограничения мира даже с оперативной памятью трансакционный память появилась очень давно у ентого и непонятно вообще как с этим жить решения называется журнала мы пишем в отдельное место журнал то что мы хотим сделать мы сначала пишемся данных журнал после того как журнал зафиксирован на диске мы собственно и изменяем сами данные в памяти а потом возможно сильно позже эти данные окажутся на диске то есть журнал решает много проблем 1 консистенции данных лишь одна из функций это алгоритм называется алгоритмы по этой даме recovery тут есть ссылки потом изучите почитайте это весьма познавательно главного вопроса который встает перед разработчиком любой базы данных как организовать журнал как его описать как писать его меньше как сделать чтоб все это работал быстрее ну и опять же при чем здесь рипли catia прямой способ сделать аппликацию самый такой дерек своей это скопировать журнал с мастера на своих и применить его на своей журнал используется для гарантии консистенции данных тот же самый механизм можно сделать со своего и мы получаем репликацию по сути почти ничего не добавляем нашу систему пожгли сигел работает именно так грубо у него называется рахит лак и журнал попадает физические изменения то есть шрам попадает обновления страничек вот есть хранится в памяти на ней лежат какие-то данные мы снесет и сделали вот эту разницу мы записываем журнал и он потом уезжает на своей вот кто знает сколько журналов масики а вот кто думает что один журнал так один человек а два то думаю что журналов 3 кто думаю что их четыре так большинство не уверены вот давайте разбираться изначально масик или не было никаких журнал вообще был движок моей я сам мая smooth журнала нет так можно сделать так учить не делайте и вот на этом рисунке внизу вы видите штуку который называется storage engine storage engine это такая вещь такая сущность которая занимается вопросами как нам писать данные на диск и как нам их оттуда читать как по ним искать и все прочие вопросы вот потом прикрутили репликации репликации это вот одна строчка в самом левом квадрате key management services и utilities вот там вот и причем и для репликации потребовался журнал его начали писать он называется паяный релог у никто не думал по чтобы его использовать как то иначе просто сделали примерно в это же время мы теперь подарили новый сторож женщин который называется и на гибель ну вы наверное его знаете это широко используемая штука и вы на тебе свой журнал получилось журнал грубо говоря два и на тебе и собственно бэйн revoke с этим пришлось жить дальше вот этот момент на самом деле произошло ну грубо говоря это была точка невозврата дальше который появились проблемы которая решить очень тяжело вот то есть баяны revoke не используется для pointy тайме recovery восстановление данных и на типичный 1 ряду лог названием журнала не используется в репликации мы получилось что возрасте журнал 1 а у носителя их как бы два но вот это второй которая по мере лог который нужен ли репликация у него есть там целых грубо говоря там два или три формата смотря как посчитать вот ну вот самый такой первый которая появилась у которых было проще всего сделать на называется statement statement bass line revoke что это такое это просто файлов которую последовательно пишется транзакции за транзакции что транзакция мы и записали прошла еще одна транзакция мы и записали это выглядит как то так транзакцию указывается базы данных на которой совершается эти обновления указывается там станет времени начала транзакции из дальше идет сама транзакции второй тип называется колбасить аппликация это журнал которая пишется не сами запросы а те точки которые они меняют он состоит из двух частей before i мач и of the images на картинке by фото что сверху авто это то что внизу как это устроено выполнимость помещает эти строчки которые были долго выполнения транзакции вот красным цветом помечены строчки которые удаляются они есть before мы наверху но их нету внизу в авто и матче значит они удаляются этот это да ведь и enter ты помещается зеленом зелеными крапинки те строчки которые добавились синьки апдейты есть и в бифа и автор это обновление проблема с таким решением связаны с тем что ну например до недавнего времени грубый вид репликации писались мог все колонки и вообще вообще все даже если мы обновили одну скачать это починили и с этим должно стать полегче есть еще один тип репликации который называется ну точнее еще один вид войны тревогами xid bass он работает либо как statement by здесь либо к убийств но он широко распространён вот какой из этих журналов вообще говоря лучше то вопрос очень интересный вот кто думает что знает что такое реляционная таблица так очень очень мало людей а зачем вы пришли на этот доклад и вот иногда думаю что это массив вот люди обычно говорят что такое таблицы bad массив я которых говорят что это двумерный массив на самом деле это гораздо более сложная штука это мульти множество это сущность это грубо говоря набор определенного сорта кортежей над которым не задано порядка в сиквел таблицы нету порядка это важно и как результат когда вы делаете select звездочку из базы просканировать все записи результат выполнения запроса вам будет ну может меняться строчки могут быть в одном порядке мог быть другом про это нужно помнить вот пример запроса которые сытно убедить репликации будет работать некорректно мы из таблицу удалили праймари кей то есть игу ключ и добавили новый авто инкрементный на мастере своими разный порядок строчек все мы получили не консистентные данные эта особенность statement визит репликации и с этим ну сделать можно на самом деле не так много вот эта цитата из официальные носитель документации нужно создавать еще одну таблицу нее переливать данные указывают любой а потом ее переименовывать то есть и вот эта особенность она может выстрелить самых неожиданных местах вот тут наверное один из самых важных слайдов такого-то о том какие как репликации можно классифицировать работа на уровне хранилища как делать адрес называется физические репликации мы работаем напрямую со страницами губы ястреб ли catia где мы храним набор карт людей до и после транзакции это логическое ну еще вот сайт бесит репликация это вообще на уровне запросов так так не делают так сделано и отсюда идет такое важно интересное свойство когда он разработает ролл ps3 при кация логическая репликация она не знает какими на хранятся данные на диске вот и на debian туридду туридду лоты знаете подвесить у этих итог содержит эту информацию какую страницу мы обновили логически репликации ничего подобного не знает и получается для того чтобы репликация работало нужно делать какие-то операции в памяти и получается что физическая репликация росписи тела и на гибель она упирается в основном диск а мальчики или репликации она упирается в основном своим причем обе и ролл бесит и statement by stella убийственно хотя бы простая нужно найти с точки и сделать обновления statements 15 все гораздо хуже достаточном количестве нужно вообще выполнить запрос если запрос на мастере выполнялся там грубо говоря полчаса он будет выполняться полчаса на своей как бы то есть это репликация да ну достаточно неудачно кроме того упал после сиквел пишет на диск в два места всего это хранилище данных это журнал носителя получается таких мест 3 это хранилища я ебу spacely найди вишней и тандури дубок журнал и баннере его который используется в репликации писать получается надеть нужно грубо говоря в полтора раза больше это отличная архитектура носитель но они часто бывают проблемы вот кто видел тающую реплику мальчиков о вы меня понимаете вот как найти причину почему реплика тормозит это смешно но одновременно очень грустно диагностировать и сильно тяжело вот есть средства диагностики в матче кальяна зывается урок медленных запросов вот ну вы можете его открыть найти топ там самых тяжёлых запросов и исправить их мультипликации это не работает просто все работает работает она чего отставай ты открываешь локоть и вы и штамп ровным слоем размазанной куча за боссов которые работают примерно одно и тоже время и того чтобы понять почему он тормозит нужно проводить статистический анализ читать статистику какие там таблицы стали чаще использоваться нужно это сделать очень тяжело ну вот 56 57 появилась про фому схема в принципе на ее были на его базе такую диагностику сделать проще мы обычно открываем лог комментов побед и смотрим что же мы выкатили в то время когда репликации начала отставать вот ну иногда даже это не помогает и приходится ходить по всем разработчика спрашивать слушай что ты сделал это ты сломал репликацию а если найду покажи покажи что-то делал ну это грустно но с этим приходится жителям вот 8 конная репликация какой то вы помните там первый слайд есть мастер куда мы пишем есть фишка скатова мы оба говорят только читаем и своих не должен влиять на мастер и принципе вот в подписи он не влияет в и на дебила сожалению точнее масик или это не так для того чтобы стоять бс-3 при кация которая презирать запросы работала корректно есть специальный флажочек вы на гибель заметьте то есть у нас архитектура разделяет репликация выше астор очень же ниже но 47 джин для того чтобы репликация работала должен грубо говоря замедлять enter ты в таблицу другая проблема состоит в том что масса выполняет запрос после то параллельно то есть одновременно а своих может применять последовательно вот ну самый важный вопрос который спрашивать люди а почему не может применять их параллельно на самом деле с этим все непросто есть теорема стилизации транзакций которые рассказывает когда мы можем запросто выполнять параллельно когда последовательно этой отдельной сложная тема разберитесь не есть вам это интересно если вам это нужно вот взгляните пикассо упирается в снов диск поэтому ну дискаунтера но не пора ли лица и нас как-то не волнует ну в один поток все равно мы сидим с новым диски zepp мы почти не потребляем масик или репликация упирается в процессор и это прекрасная картинка большой мощностью вак 12 ядер работает одно ядро за она занята репликации из-за этого реплика задыхается это это очень грустно вот у для того чтобы выполнять запросы все-таки как-то параллельно есть такая штука который называется группировка запросов от войны тебе это вот и специальная опция кто управляет тем как именно мы группируем транзакции как именно мы пишем на диск но в чем проблема мы можем сгруппировать на уровне на тебе а уровнем выше на уране репликации это функциональность и не было в 2010 году кристенсен из мария тебе реализовывал вот эту фичу которая называется глубины revoke commit меня еще немножко поговорим вот ну то есть получается мы журнал повторяем на двух уровнях storage engine и репликация и нам нужно таскать вещи отсюда и сюда это а это сложный механизм журнал это достаточно сложный структура данных и вот приходится повторять на двух уровнях год более того и нам нужно одновременно континента писать сразу два журнала войсками то это еще хуже вот эта картинка которая взял из массе тюлька помощь бога она нам показывает вот два графика синенький это то как у нас масштабируется на геби когда мы ему добавляем 3d закидываем трендов число транзакций которые он обрабатывает возрастает а красная линия это ситуация когда включено включено репликация мы включаем репликацию и мы теряем масштабируемость потому что лак тоже любой мире мог пишите синхронно вот и голубой на рывок комитеты это решает ну куснуть что вообще так приходится делать из-за вот этого разделения 6 очень и внизу репликация наверху с этим всё плохо 56 носители и 57 эту проблему пытается решить уточните точнее как она уже решена в качесте есть глубоко мид и мастер тебе не отстаёт вот теперь он пытается использовать это для параллелизма репликации мы на своими запускаем всего мы пытаемся запросы из одной группы запустить параллели ну вот я написал что из этого нужно крутить вот ну я вот с октября прошлого года поскольку у нас данных много репликация постоянно отстаёт это все расстраиваются я пытался этот параллелизм увидеть то есть ну да возможно и что-то еще не понял возможность что-то не то настроив как бы было много попыток было общение 40 он спасибо диме лениво которой мне помогал в этом вот и результаты вот выглядит примерно так зеленый точнее голубой график это мальчик 055 что на графике немножко съехал по оси y у нас потребление процессора потребление процессора на своей глупой оси x это время и на данном графике мы можем видеть когда репликация начала догоняться с мастера и когда она закончила получать интересная картинка что 55 в один поток работает примерно также как параллельная репликация в 57 в четыре потока то есть у процессора живется большего зеленая линия работает по времени также там действительно там трудятся 4 3 до 4 потока работой по времени также если вы сделать один поток в 57 он будет работать хуже это какая-то регрессия и вот в 575 вроде как и хотели подчинить я проверил пока это актуально на моих быть марках это так это так на тестах с продакшен данными это данность и надеюсь что это исправит и в чем еще проблема для того чтобы иммигрировать не останавливаясь и сервис у нас в один момент времени на мастере будет запущен 55 она своими 57 в 55 лет у кого панели ловко мид значит 57 сможет работать только в один поток это означает что нашей реплика на 57 начнет отставать и не до гонятся никогда пока есть это регрессия мыть мигрировать не сможем мы сидим на 55 у нас нет выбора пока существует регрессия с однопоточный 57 репликации ну наши бойцы вот на это вот делают примерно так ну что с этим можно сделать ну вперед самая интересная часть я рассказал гораздо меньшими хотелось бы у меня материала на самом деле там часа нам три вот теперь а это все про суммирую ну во первых есть три типа журналов у после архитектурно есть фишка и есть репликация на физическом уровне есть запекаться на логическом уровне яички уровень напоминая это странице вот он бесславно силён тем что у него через его журнал идет вообще все обновление таблиц создание триггера создания хранимых процедур и поэтому с ним проблем возникает меньше ума сигналя зависимости от того какой тип привлекаться нас включен мы получаем либо логической репликации либо репликацию на уровне запросов вот принципе у любого из этих журналов и свои плюсы есть свои минусы и выбирает нужно осмотрительно вот ну чем они сильнее чем они слабы вот умудриться репликация на мастера фактически не влияет потому что ну не влияет стоит звездочка специальных своего все равно нужно скопировать журнал с мастера это конечно влияние плюс wave может попросить мастерами удалять журнал если он не успеет на если он там каким-то причинам загоняется мы остановились и запустили снова масик нули и вот вот есть таких три серьезных пенальти в трясине серьезных thread'ов как как на мастер влияет и репликация во первых это опция вы не гибель для того чтобы работал выстоять и победить рубрикация во-вторых без глубины revoke коммент мы не получаем масштабирование вот она получается all.biz репликация массе кивали она как бы работает получше но с ней все равно есть свои проблемы своих адрес упирается в диск мальчик юлю упирается в процессор вот с точки зрения потребления дисков тут интересно интересно вот у нас например will be with application махи галину и в пастбище значит будет примерно так же получается там десятки терабайт бога в день у нас просто вот нету дисков только всего хранить поэтому мы сидим настоятельным best как бы это тоже бывает важно еще реплика отстала нам нужно где-то хранить журнал ip-адрес в этом смысле тоже как бы по сравнению с этим увидеть репликации он выглядит хуже вот процессором сво его в принципе этому вы тоже уже поняли что во-первых нам важно построить хорошие индексы на своими для того чтобы строчки находились все запросы работали хорошо то есть достаточно странная метрика мы оптимизируем своей с точки зрения эффективности работы репликации то есть мы хотим своей для того чтобы строить отчеты а нам приходится еще настраивать чтобы своих мало того что отчеты строя учила как-то загоняться успевал построим много индекс он может перестать успевает и гоняться и это конечно печально ну вот массе calpers life 5 5 7 5 6 5 7 мы очень ждем когда он станет работать хорошо пока у нас не получается заставить его работает так как нам нужна ну другая важная тема это президент из данных вот позади сильно реплика это бинарная копия мастера то есть буквально вот если вы остановите запись на мастер дадите и репликации доехать до конца на своими остановите процесс на мастере свей сделаете бинарное сравнение по смеситель мастера ip-адресе колеса его вы увидите что они одинаковые то есть буквально одинаковые масик или это не так голубые стрип ли catia которая работая с магическим представлением с пептидами вот все апдейты несет и и dvd они работают корректно 7 еще хорошо а вот сайт индезит репутацию вы не так если вы неправильно настройки мастер и если вы потом запустить запустить и определенные такие запросы вы можете получить разные результаты вот с таблицами с запросами которые работают схемы базы создания таблиц построения индексов и все остальное все все еще грустнее они всегда идут как сырые запросы то есть вот alter table что-то там всегда идет как в сыром виде и вот нельзя сказать что вот мы взяли 2 пор там две базы них лежат там одинаковые данные но на диске то не организовано как-то по-разному и очень мы запустим альбертом и alter там нужно смотреть на каждый конкретный офер что он делает и вспоминать про особенность работы стоят без трипле кации вот ну смягчить bass там с ней истории еще интересней она либо такая либо такая не надо смотреть вот гибкость вот носитель чем он действительно лучше данный момент тем что секрет аппликация она более гибко вы можете построить разные индексы на матерей славе вы можете поменять даже схему данных вот я одному из клиентов писал патч на массе кулера убийст репликацию которая позволяет поменять порядок колонок ну то есть это иногда это бывает важно иногда это бывает нужно посмотрите сейчас возможности такой нет кроме того мальчика или есть lips вейль это очень важная штука мы ее очень любим наши дима на прикидываются массе говорю своим и они постоянно в режиме реального времени получает обновление то есть у нас например вот это задев представляет 5 примерно 5 секунд пользователи увидел баня в любом кликнула баннеры демон это все за агрегировать записал в базу спустя 5 секунд баннерный наш дом и которые раздают баннеры про это узнал это мощно мощное действительно средства вот подпись его нету однако что позади спланирует вот-вот не это рассказали товарищи которые занимает свой разработкой во первых есть такая штука как это называется вот декалога wog streaming реплики ищем это как и как бы это объяснить то это такой способ трансформировать right ahead wog например мы не хотим реплицировать все таблицы из данной базы ну не хотим и все вот мы хотим только вы часть час таблицы реплицировать вот-вот декалог стремительно причем позволяет массива объяснить что-то из таблиц будет уезжать на своей и кроме этого еще отсекал decoding вот декольте coding это такой способ визуализировать то что находится в подписи к le райд их итоге ну на самом деле если мы можем грубо говоря напечатать в каком-то виде то что у нас происходит на свою точнее что нам пришло через right ahead лак это значит что мы можем программно реализовать вот все то что делает лепс воев получили insert получили апдейт получили билет и у нас дернулся нужно call back мы узнали про изменения вот это называется очень кубик adding не знаю какую не сам статус они уже в релизе или еще нет пока но так или иначе после лиц к этому идет то есть и вывод из этого такой достаточно интересный лучше чего сделать нормальный журнал эту подпись журнал нормальный какого примерно ну и амиду функционально туда попадает все обновления данных туда попадаясь и изменения схемы вообще все и это даёт кучу плюшек например корректно работающую репликацию репликацию которого упирается только в диск они в процессор и вот имея такой журнал уже можно внести там не какие-то там дописать там некоторый набор патчей там в сам движок для мастера для сво его которая позволяет повысить гибкость ну то есть фильтровать таблицы имеют другие индексы и то есть журнал нормальный а вот еще журнал плохой как получилось ума сиквеле в силу исторических причин масик или он заложниках бы своего исторического развития ну чё там начнем писать журнал начали писать запросы войны revoke вот у нас есть аппликация а потом и на гибель а у них там свой журнал а потом еще а коза оказывается что их нужно писать туда и туда это еще и вместе то есть фича таланова сиквеле появились все эти сразу только вот проблема производительности корректность не решить уже ну невозможно это нереально это нужно это нужно реально просто переписать всю архитектуру которое связано с тора женщинами то есть но пройдет совсем немного времени ip-адрес puffy чем я думаю он догонит на секрет вот ну напоследок вот звонки от всего доклада если же там даже много чего не поняли ли вам нужно разбираться запомните два самых важных выводов репликация не является резервной копией она является там резервированием для работы она может являться много чем но резервной копии это не репликация & replication не резервной копии и второе по что нужно помнить особенно состоять он приедет мастикой и репликации то что таблица это не массив не двумерный массив а гомогенное мульти множество картаже это так называется вот если корректно с точки зрения компьютерс вот потом пересмотрите репликацию там есть лагерь объяснено что это значит опять же так вот получился не в этом суть и коллективном кучу людей мне помогали его делать кости осипов мячик или разработчик дмитрий леонов и много других людей вот ну у меня всё можно перейти к вопросам олег у меня не вопроса о просьба повторите пожалуйста следующие дорогие костюмеры репликации в москве не готова к продакшн и и не решает ваших бизнес задач спасибо масик или репликация применимо для своего класса задач и если вы понимаете какие что вы хотите от репликацией и что для вас наиболее важно и принимайте осознанное решение то естественном цикле репликацию можно использовать если вы в этом ничего не понимаете лучше возьмите подвигов ну он он просто прямо он просто работает 8 менее гибок у него там и своей проблемы но меньше шансов сделать что-то не так здравствуйте и спасибо за доклад большой а на и над вас левее получается у стены вы сказали что на полюсе нельзя реплицировать отдельно одну таблицу но и замечательный инструмент landis то и как раз как бы то что вы говорили проблемы с тем что много валов может скопиться можно 10 одну таблицу замечательно реплицировать как еще раз называется инструмент ланди 100 пакет какой тут он не идет в основной поставки нет не идет ну а ну да ну да вот разорительно много xoчy на примере что есть такой инструмент но значит это проблема не настолько больна спасибо за доклад там много деталей но вот допустим касательно по сгрыз я могу сказать опять упомянуть landis то что там с помощью него так как там логическая репликация легко делать апгрейт допустим между полюсами так как вал да он в общем виде меняет формат в ранних версиях под газ он менял формат просто вообще там катастрофически сейчас ну то есть он так более-менее устаканилась все равно меняется поэтому даже апгрейда пустим 9 ирина 94 он предоставляет сложности так как вы работаете как я понимаю плотно sql интересует вопрос как вы будете апгрейдить москве с одной версии на другую так как решение связанные с журналом не позволяют это делать ну вы спрашиваете про мы считали да с мохито или вообще говоря нет таких проблем потому что у него формат журнала не меняется относительно часто за любой него commit он в принципе он почти такой же носителем это выглядит так вот у нас есть мастя вот у нас есть своих мы гасим своих обновляем своей поднимаемого новой версии запускаем снова репликацию своих загоняется после этого мы активируем сценариев и у озера где ну типа мастер упал мы мигрируем всех клиентов на своих и вот у чудо у нас новый мастер на новой версии после этого репликация разворачивается задом наперёд с бывшего своего она бывший мастер ну мастер соответственно тоже апгрейде ца еда гоняется и мы снова получаем схему где у нас есть мастер исаев на уже новых версий творчеством да это сделать проблематичней я не знаю тому насколько у него хорошей совместимостью что там новая версия читает ли она орать их этого к старой версии добрый вечер я кажется спросить использовали вы такой движок как только д.б. потому что в нем например реплики желоб как раз не наблюдается но может быть конечно разная нагрузка но вот ну шевеления не знаю как работает только тебе а какой там кипит при кация логические физическое но по-моему он настраивается так же как и вот про убийство моему я пробовал которого весь но ну то есть там настраивается также как бы как москве то есть никаких ограничений в документации нет то есть видимо все типа применимы вот и как бы ну вот говорит шарики шилова нет и я не видел там приду как бы сколько она мохика или при этом вы наблюдали в окна и нагибин ну там когда и накипи и там свет выйдет репликация там не знаю а у ps3 пкт но мы вообще как бы отказались от и на тебе после соответственно 200 репосты в секунду то есть на запись это как баба за для zabbix а и мы перешли на то gdb там во первых ее сжатие мы получили там шесть раз сажать и как бы ну пока вот все хорошо db там получалось получались локи на удалении поэтому как бы отказались в данном варианте ну да и на тебе плохое решение для хранения логов ну мне нечего сказать я не знаю почему ну точнее я не уверен что только деби на например наших объемах и фитиль на будет работать хорошо а какие вас объем и собственно количество операций на вставку так вот свои выключились база мастер базу занимает полтора терабайта на мастера валится 6 тысяч запросов в секунду но там многие наверно половины чтения но где-то 1003 запросов в секунду на запись у нас есть и это запросто зачастую большие например обновление статистики пользователя мы там в гранулярный сью по-моему пять минут мы перечитываем баланс пользователя статистику по показам сколько мы показали его банеров сколько из них было кликнут а то есть и а это обновление получается всех рекламных кампаний одновременно то есть это запрос эти голы нас их 33 тысячи секунду идет мастер то название напрягается мастером все хорошо проблемы со своего в осваиваться регулярно начинает отставать и приходится как на ком слайде искать а что же такое поучусь у столько тебе не знаю можно посмотреть спасибо что до зари горит еще вопросы я правильно понимаю что что у вас по факту на продажу не только москве и несмотря на все недостатки которые вы перечислили statement боится так далее вы используете только его почему его почему планируете ты посмотри ну используемую масик или опять же по историческим причинам у нас есть огромное количество кода то но не знаю на помощь джанга например которые нельзя просто взять и переписать но огромный кгб с проект со своей историей со своим техническим долгом ну это не так просто нельзя просто вот взять взять из и бы поменять поэтому мы как-то учимся с ним жить ну вот я уже получил принципиальное согласие на эксперимент с переносом данных из махи крыльев с грешники о для отчет построения отчетов вот отчеты действительно сложно делает на мальчика или потому что там адрес и есть windows панчин есть всякие группировки вот это первый кейс такое на котором мы хотим попробовать по адресу вот ну скажем так хорошо я хочу попробовать адрес и если эксперимент быть успешным и возможно двинемся дальше а так мы заложники того что там решение которое было принято на там несколько лет назад когда вы подали сакстати репликации еще по моему даже и не было она нам головы нужно но нет было три gearbest репликация 1-мест свои проблемы скажите пожалуйста вы назвали полтора терабайта базу и 6 к господам кунду причем половина из них на инсекты palomino это моя грубая оценка ну примерно 1 ком железе то есть какая у вас диск с дисковой подсистемы на чем живет и какие камни и все все это дело кружится камни нового кхе-кхе он и точно не помню 2272 едва частота по моему два сокета на в каждом соки тип 1 по 6 ядер дисковая подсистема вот я не помню я скорее даже не знаю но обычные винты + ssd cache вот я сейчас боюсь соврать или этого без ssd cache я даже не смотрю потому что у нас мы не упираемся в диск у нас с мастером то вообще все хорошо но вот один из таких достаточно стандартов серверов она стоит как а типовой конфигурации он лишь нормальность ну он справляется с этим вот то есть проблемы со своего мы и они ну совсем другой сорт маленький вопрос там был график у вас с себя утилизации про ну ладно если нет общего просто к и почему на для 1 3 давай репликацию secu был больше 150 процентов но надо понимать что она над родовая я говорю один thread под тот тренд который применяет изменения как минимум у нас есть еще один трек который собственно с мастера за без забирает наш журнал как минимум кроме того у и нагибин внутри свои траты то есть то что вы видите что график больше 150 процентов ну разумеется там и на геби делай свою работу этот урок там копируются проверяет все это происходит само рубрика финтит просто сидит у по сто процентов циpкa и он из него не вывозит время репликации ну если она есть я например да гоняется или если она там отстает на речи ответе на ваш вопрос рассказывали в основном по родной мускул есть такие форте как верховный мария тебе насколько знаю не пытаются исправиться наследие мускулу там где осинского плохо продажи то можете сказать да мария debate оригинальная команда махи кого они первые сделали группой анри вакаме довели его до ума мне хочется вам достаточно много улучшение таких хороших как бы и они молодцы ну в целом там ситуация конечно получится посмотреть первую очередь наверное стоит ну моей точки зрения на марии и пить что делает они они как бы они бегут вперед ломая совместимость местами но и тут вперед отакона легко наносятся четыре года назад к датам работу там была такая политика мы делаем продукт который тропы инари пояс не для урока у версий ну то есть грубо говоря чтобы мы могли погасить масик или заменить бинарник аракавой на собственно питоновский и чтобы все работало такая политика была я не знаю поменялось она или нет но в этом смысле тихона ну она конечно но как какого какие-то учения но вот то что я говорил в теме доклада там это все это все едино это архитектурные проблемы они не связаны каким-то по ком в реализации которые можно там просто поправить"
}