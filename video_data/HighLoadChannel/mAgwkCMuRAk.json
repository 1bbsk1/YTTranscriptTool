{
  "video_id": "mAgwkCMuRAk",
  "channel": "HighLoadChannel",
  "title": "Производительность Unity3D: подводные камни / Алексей Чубарь (BIT.GAMES)",
  "views": 3218,
  "duration": 2604,
  "published": "2017-04-22T14:48:14-07:00",
  "text": "илья героев для android и айос которое было создано на базе unity3d как раз и за это время мы наткнулись на значительное количество граблей подводных камней касающихся производительности этого движка которых я бы хотел сейчас обзор на так рассказать если кто-то не знаком с тем что такое unity3d 4 ли это так называемый игровой движок это инструментарий для создания 3d приложений который из коробки содержит готовые реализации для различных низкоуровневых задачи которые чаще всего встречаются в играх таких как рендеринг обсчет анимации расчет физики воспроизведения звука и прочее и также содержит визуальный редактор для того чтобы этим всем управлять все сущности представляют в виде так называемых игровых объектов так и game обжиг а все аспекты их внешнего вида и поведения описываются набором компонентов которые к объекту прикреплены нас есть объект гремлин и ряд компонентов один из них отвечает чтобы гремлин выглядел как гремлин другой чтобы он двигался как гремлин 3 чтобы он соображал как гремлин 3 4 чтобы он умирал от пара ударом как гремлин все эти объекты настраиваются объединяются в эротическую структуру в мощном графическом такому визуальном редакторе и на выходе мы получаем сцену игровой уровень по сути в нашем случае ролевая игра такой дьябла на тем у кого нет времени на нормальный diablo и соответственно последний ряд где игрок встречает врагов встречает других игроков дерется с ними там побеждает и так далее понятно что когда у нас такой высокий уровень абстракции в этом есть определенные следствия то есть во первых благодаря визуальному редактору к разработке напрямую подключается люди которые не являются техническими специалистами например звукорежиссер вставляет звуки выгну напрямую level дизайнер собирает удобнее и добавлять их в игру минуя прослойку в лице программистов более того пропускаем все меньше и меньше диска у него кода через себя сами программисты все меньше задумывается о том как их действия на высоком уровне вот в этом визуальном редакторе отразятся на производительности итогового продукта на игре которые напущу на телефоне вот я постараюсь описать самые такие неожиданные и и важные вещи с точки зрения производительности даже если вы не занимаетесь разработкой игр то вероятнее всего вам это может быть полезно потому что unity широко сейчас используются в самых разных сферах но тем ни менее рассматривать будем через призму мобильных игр потому что с точки зрения производительности это суровый мир это мир который не прощает ошибок и тому есть ряд причин первое это высокая конкуренция google play и appstore и заполнены приложениями сотни тысяч игр на каждом или менее заметную найдется 10 клонов и как бы их ренаша ни была ваша игра если она тормозит то игрок уйдет играть конкурентом и запряженной причина это как раз специфика аудитории потому что аудитория обширна и большинство людей не являются техническими специалистами и многие из них особенно google play любят купить китайский планшет за три тысячи рублей поставить топовую игру увидит что это игра тормозит и написать негативный отзыв потому что по их мнению то разработчики виноваты и это плохо потому что во первых уходит сам такой игрок во вторых уходят все кто потенциально могли поставить игру вашим дальнейшем потому что они видят негативный фидбек и проходят мимо поэтому чтобы охватить максимально аудитории мы должны была быть даже тех кто играет на старом железе ну и соответственно третья причина это само железо и аппаратная и программная начинка достаточно специфичные в мобильных устройствах поэтому эту физику очень важно учитывать об этом хотелось бы сказать по подробней что же собственно там внутри там есть какой-то процесса и его архитектура принципиально отличается от того что у нас в настольных компьютерах то есть когда мы слышим что выходит очередной топовые там смартфон у которого 8 ядер нас половина гигагерца мы всё равно понимаем что это мягко говоря не классе дальше там есть какая-то батарейка и это отчасти причина по которой с этим остаются совсем другую производительность они заточены под минимальные энергопотребления потому что телефон должен хотя бы день поработать от своего аккумулятора тем не менее если вы будете нагружать процессор на все 100 процентов или активно передавать данные по сети вы посадите любую батарейку за пару часов и это не нравится никому это не нравится пользователям в первую очередь и это не нравится как следствие владельцам платформ то есть и apple и google в обновлении в своих операционках все жестче и жестче следят за тем как ваше приложение использует ресурс батарейки дальше да есть какая-то графическая карта но мягко говоря это опять же не джифорс там 250 и у мобильных графических решений есть и ряд существенных отличий принципиальных от настольных и а них я расскажу немножко ниже по подробнее но также важная составляющая аппаратной начинке это оперативная память и опять же цикла хотел звучит впечатляюще топовый смартфон имеет три четыре гигабайта это много однако на деле это не означает раздолье для разработчиков потому что во первых мы возвращаемся к видеокартам увидел карту мобильных устройствах нет свои видео памяти для своих нужд графический процессор будет задействовать именно вот эту оперативную память и во-вторых это особенность самих операционных систем android и ios они очень жестко следят за тем как приложение использует память и раздувать свое адресное пространство до бесконечности они не позволяют если ваше приложение использует память неэффективно и позволяет себе много операционной система просто выгружает его она исчезает даже если пользователь данный момент не взаимодействуют и это источник очень большого количества негативного фидбэка я недаром как бы говорил что там есть какой-то процесс это какая-то оперативной памяти так далее так далее потому что на деле количество аппаратных конфигураций которые имеются на рынке ну очень велико то есть текущая версия нашей игры поддерживает судя по данным google play 13 с половиной тысяч различных телефонов и планшетов ну или должна поддерживать при этом как видно последняя версия операционки соответственно топовую последние железу есть далеко не у всех большинство еще играет на 4 например трое за это означает либо бюджетные либо старые какие-то решения что примечательно даже как быки стереотипам пользователя ios они тоже не бегут каждый год за новым айпэдом или айфоном многие до сих пор у нас играют на втором айпэде или на четвертом айфоне а это устройство у которых всего 512 мегабайт оперативной памяти и это достаточно жесткое ограничение потому что как бы это эта память распределяется между операционной системы или фоновым процессами и так далее и еще чтобы должно остаться на шаги и перечислим и выявили лимит примерно 240 мегабайт если игра потребляет меньше то она может комфортно набора работает на устройствах на которых 512 мегабайт оперативки когда мы превышаем этот лимит в зависимости от устройства получаем самые различные негативные последствия падение фпс черные квадраты там вместо частей изображения когда памяти не хватает графическому ускорителю или вот уже упомянутые тихо и завершения приложения в таком случае мы никак не можем от ловить эту ситуацию и не можем получить некую отчётном ошибки остается только гадать почему же пользователи заявляют о крышах в таких жестких ограничениях на ум приходит первый совет главный общее которые уже сумму лил в документации unity он говорит о том что оптимизацию не следует откладывать на самый последний этап нужно постоянно учитывать то что вы разрабатываете для мобилок то есть каждый раз принимая то или иное решение на всех уровнях и всех этапах разработки нужно подумать как именно это отразится на производительности игры которые запущены на телефончике или на планшете китам за три тысячи рублей но остановимся более подробно на том почему же именно все начинает тормозить и иногда тут очевидная причина 1 этот код и как он работает в этом случае с unity мало того что криво написанный код и работает медленно зачастую даже прямо написанный код может начать тормозить его нужно будет переписать чтобы он выглядел криво но зато работал быстрее ну и второй существенный аспект это внутриигровые ресурсы модели и текстуры анимации звуки и все это имеет непосредственное влияние на скорость работы игры начнем с того что попроще с ресурсов видите очень удобно сделаны под иисуса в проект вы просто кидаете файл то и летун у того или иного типа в папочку с с вашим проектом и наращивать unity все вы можете его использовать это легко очень показать на примере звуков . мы просто кидаем mp3 мелодию в игру видим ее в нашем проекте вытаскиваем на сцену все музыка играет и как бы все на первый взгляд работает но однажды мы обнаружили что в нашей игре звуки при весьма скромные озвучки занимают 30 мегабайт оперативной памяти что с учетом ограничений в 240 довольно много причиной того оказалось как раз то что звукорежиссеру добавлял звуков в игру но я обратил внимание на то что все звуки по умолчанию добавляются с настойкой декомпрессор лоб это означает что каждый звук который мы используем на сцене из сжатого формата из того же самые бы 30 раз кодируются полностью вне сжатый формат и висит в таком виде в памяти готовы к воспроизведению естественно это очень расточительно такой мы можем себе позволить только для очень коротких звуков которые используют часто то есть например там звуки ударов такие крики то что вы мы слышим ну буквально 1 секунду в игре есть ли звук используются хотя бы немножко режу то лучше использовать формат contest in memory это будет означать что звук загружается в память и висит в сжатом формате раскодировать только для воспроизведения потом вот раз кодированный большой кусок он выбрасывается в следующем воспроизведение мы будем опять его раскодировать а для совсем длинных звуков например эмбиентом или музыки какой-то там музыкальной темы подходит формат streaming это означает что звук читается как частично частично раз кодируется эта часть воспроизводятся выбрасывается приходим к следующей части и повторять повторять повторять естественно последние два варианта связаны с постоянным декодированием звуков и поэтому имеют негативный текст с точки зрения увеличения нагрузки на центральный процессор который этим занимается но кипр мобильных устройств достаточно хорошо заточены под декодирование мультимедии поэтому этот негативный эффект он значительно ниже чем негативный эффект от такого безумного употребления оперативки вообще в целом специалисты unity рекомендуют экономить на звуках для мобильных игр потому что эти звуки мало кто слушает на самом деле типичный русский секс ваш игрок который едет в метро и максимум у него есть наушники в которых звучит музыка из его player и звуки в вашей игре слышат только несколько процентов игроков поэтому в общем то можно не стесняться сжатие отказа от стереозвучание потому что как бы это значительно уменьшит нагрузку и на декодирование и потребление памяти уже не сжатым звуком ну и вырезание битрейта тоже в принципе приемлемую насколько насколько это возможно также до важный игровой ресурс это анимации то есть данные о том как объекта меняют свои положением в игре это все та же занимает какую-то часть оперативной памяти и есть и так далее примерно стоит описан случай была такая пасхалка своеобразное если игрок в городе сидел долго ничего не делал у него персонаж начинал танцевать гангнам стайл это был такой очень длинная длина детализированной анимация смешна этом всем нравилось на канал что ее присутствие на сцене сразу отжигать 3 мегабайт оперативки просто игрок зашел в голод минус 3 мегабайта на анимацию которой он возможно даже никогда не увидит поэтому до дорогие анимации имеют цену и нужно стараться держать вещи и максимально простыми насколько того требуется игра непосредственно другой важный аспект анимации в том что когда у нас есть много объектов обсчитывать каждый из них достаточно дорого с точки зрения нагрузки на центральные процессов потому что нужно положение всех всех всех его частей в пространстве обновлять регулярно из этого из этой ситуации есть два выхода во первых можно уменьшить количество объектов которые мы общин в единицу времени и unity позволяет делать это автоматически в настройках компонента который отвечает за анимацию по умолчанию выставлено всегда то что объекты анимируются постоянно но есть варианты когда мы объекты которые на экране в данный момент не видны неё не обновляем и заново не обсчитывать соответственно снижая нагрузку на центральный процессор есть на негативный момент опять же вот этих вот оптимизации он состоит в том что если у вас например завязано какая-то логика анимации точно номер к анимации шага привязан звук шага непосредственно то если вы примените максимальную максимальную оптимизацию и совсем не будет обновлять объекта которые не видны это приведет к тому что вы не услышите врага который подкрадывается к вам со спины грубо говоря поэтому с ними нужно быть осторожным но для каких-то декоративных вещей которые вот просто там служат для красоты это подходит отлично другой путь это можно простить сами объекты у того же самого компонента они мастера есть опция автоматической оптимизации так называемых иерархии трансформаций как это работает например у нас есть персонаж у него есть умка предплечье и кисть и пальцы все это независимо отдельно может двигаться но на деле персонаж ничем не занимается кроме как рубит мечом тогда отдельно обсчитывать положение всех этих объектов нет большого смысла и вот эта вот кнопочка объединяет все эти объекты в один большой и вообще твоим один объект вместо вместо нескольких это намного дешевле это опять же имеет определенную цену потому что например мы теперь у нас находится кисть из кладут был положить меч в кисть уже нельзя поэтому в таких случаях нужно либо в свойствах модели после каждой автоматической оптимизации указывается что кисть была вот здесь либо писать какой-то скрипт который от автоматическую оптимизацию будет учитывать однако этот вариант все равно хорошо работает особенно в играх т.п. стратегии в реальном времени когда у вас много много много юнитов на экране одновременно присутствует он позволяет добиться выигрышу порядка 50 процентов процессорного времени на каждый кадр это очень существенное этим в принципе тоже можно пользоваться другой важный тип ресурсов этой трехмерной модели с ними работать тоже правил что есть анимациями чего детализированные сложнее тем больше они живут оперативки поэтому как бы тоже это место для компромиссов вторых модели можно увидеть и менять на литу в процессе выполнения программы включив опцию ри drive включении этой опции будет вам создавать каждый раз для каждой модели отдельную копию и все изменения будут применяться сначала к ней а потом уже к исходной модели поэтому общем если вы это включаете вы сразу удваиваете потребление оперативки и каждой моделью если вам это не нужно а в 95 процентах случаев это не не включайте от функцию экономики оперативную память также с точки зрения утилизации в unity встроенная автоматическая оптимизация моделей когда мы высшую собираете иглу под конкретную платформу там подготовит или подает это опция вырезает из всех моделей все сведения которые не нужны с учетом текущих настроек графики то есть например если у вас нет в игре динамического освещения то из моделей вырежут все и например нормали и это позволяет очень сильно сэкономить зачастую оперативную память опять же над для целевой платформы но если вы исхода как-то вот эти настройки графики будете менять вы можете получить визуальное артефакты так что проверяйте но в целом вот эту опцию советуют всегда оставлять включенный unity и специалисты когда делают доклады там своих конференциях так помимо прочего значит когда вы добавляете модель на сцену также просто перетащив ее там из пабчики иерархии back to your рендеринг настроен так что он поддерживает все все самые тяжеловесные красивости которые в unity только есть от опять то же самое динамическое освещение тени и отражения и так далее подумайте нужно ли она вам то есть мобильных играх зачастую это не нужно и если вам действительно это не нужно то выключите это сэкономить и ресурсы графического процессора ну и один из важнейших типов ресурсов это текстура потому что именно чист текстура зачастую отжирают самую большую долю оперативной памяти вашего приложения в итоге если речь идет о какой-то трехмерной сцене или об игре и поскольку у нас опять же нету выделенные видеопамяти что наши текстура всегда должны быть сжатыми даже когда мы их отправляем уже непосредственно на рендеринг на графический процессор они должны быть в сжатом формате на наше счастье есть формат сжатия и вертись и который поддерживается всеми устройствами на базе ос и формат сжатия детей которые поддерживают практически всеми устройствами на базе android поэтому настраивайте для всех текстур настраивайте сжатие отдельно под каждую платформу потому что по умолчанию может быть не сжатой или использовать не оптимальный формат сжатия используйте вот такие настройки тут правда есть нюанс опять же потому что формат витязь и имеет ряд ограничений первое ограничение тушит текстура должна быть квадратной вторая то что текстура сжатая в таком формате не поддерживает альфа-канал для этого применяется такой трюк текстуру просто дополняется до квадратной и разбивается на две части одна содержит rgb канал и 2 содержит альфа-канал закодированные каким-то другим цветом кроме того если у нас не нужна какая-то запредельная четкость контуров изображения мы можем текстуру ты тут альфа-канал еще дополнительно уменьшить в размерах то есть мы получим небольшие визуальные артефакты на краях но в целом как бы на маленьком экране это может быть незаметно но позволит получить дополнительный выигрыш за счет того что текстуру улучшается 4 раза по размеру и самый низ исходной maidy имеем такой вот очень существенный выигрыш 84 процента по размеров используемой оперативки то есть этот выигрыш компенсирует даже дополнение текстура до квадратный все у нас почти 70 процентов уменьшение размера вот этот подход на самом деле достаточно распространял среди unity разработчиков но почему-то до недавнего времени возможности делать это из коробки и в unity и не было теперь такая возможность появилась и в общем unity владик умеет автоматически дробить одну текстуру на дверь потом накладывать from the ими друг на друга но вот это автоматический вариант он не поддерживает уменьшение размера альфа-канал поэтому общем если вы будь его использовать вы себя лишаете дополнительного такого выигрыша так что в общем возможно лучше использовать какое-то свое кастомное решение для этих дел помимо того текстуры как и модели имеет возможность или драйт то есть изменения в процессе работы игры и работает это также на каждую текстуру будет создаваться копия если могут не нужна и не включаете это так что текстуры по умолчанию все когда не добавляется проект для них создаются версии в меньшем разрешении так называемый bitmap и они нужны для того чтобы экономить ресурсы графического процессора когда у нас и объект находится далеко от камеры и рисовать его в полном разрешении а в меньшем разрешении если у вас есть запас производительности по графическому процессору вы можете отключить генерацию этих мемов и сэкономить порядка 3 оперативной памяти на каждую стикс тут который у вас используется ну и также на для текстур в совет общей то что их размер должен быть разумным огромные текстуры это очень дорогого 5 их с точки зрения оперативной памяти во вторых с точки зрения нагрузки на графический процессор потому что графические процессоры в мобильных устройствах очень с большим трудом отрисовывает молоть еще в высоком разрешении и этот эффект усугубляется когда мы рисуем какую-то одну картинку поверх нее другую третью четвертую теряем результат первых нескольких отрисовок это получается очень долго очень эффективно и ведет к падению ввп с и целом поэтому такие ситуации нужно избегать стая ситуация называется overdraw благо в unity есть возможность посмотреть сцену с учетом вот этого overdraw классу окрашивает сам одним был прозрачным цветом соответственно будет темной самые участки ты где минимальной перекрытие наложения самые светлые будут означать самое большое количество слоев и самые наименее фиктивные собственные использования ресурсов вашего графического ускорителя для борьбы с этим самым умер 2 мы используем такой трюк мы все вот элементы заднего плана предварительно отрисовываем в tecsun несколько меньшего разрешения чем размер экрана и потом на экраны и растягиваем это уже позволяет немножечко сэкономить за счет уменьшенного разрешения поскольку плотность пикселей на дюйм достаточно велика на современных устройствах негативный эффект был почти не виден но самый большой выигрыш получается за счет того что мы как бы сделали вот идут полароидную фотокарточку нашего заднего плана и если у нас не двигается камера то мы можем не переиспользовать она у нас уже готова то есть задник не смещается относительно экрана ну просто его выводим за один проход это супер быстро и это очень дешево и мы можем направить все ресурсы на отрисовку уже юнитов в визуальных эффектов и из непосредственного геймплея вот в нашем случае выиграет однозначно богатые вот эти вот задники томск голосящий серове и так далее и видно насколько сильно падает нагрузка на графический ускоритель когда камера не двигается и мы перри используем вот эту фотокарточку много много кадров подряд поэтому общем то возьмите на заметку возможно в вашем приложении это тоже сработает теперь самая веселая часть код и как он работает оно самое веселое потому что случае с ресурсами и как-то все более менее логично да я не жал текстуры они у меня тоже алексу память игра вылетела плохо взаимосвязи между тем что вы пишете в коде это и тем как она в итоге работает на устройстве зачастую менее очевидны и причина тому и тут о какой путь проходит ваш код прежде чем попадает собственным на исполнение на устройстве вы пишете код на каком-то из языков скриптовых которые ну как они называются в unity языки высокого уровня пример там тиша компилятор unity транслируют это в байт-код на промежуточном языке так называемый intermediate english байт-код пакуются в да и лель это доели люблю попадает на устройство и там исполняется всегда исполнении unity всегда исполнении unity основан на среди исполнения монна старой версии плохой версии какой-то потому что в итоге этот runtime работает неэффективно это очень сильно проявляется в частности в работе с памятью все языки со сборкой мусора и ручного управления собственного освобождения памяти нет a garbage collector отрабатывает не своевременно в итоге мы имеем такую ситуацию приложение запускается имеет определенный пул памяти так называемый тип этот пул быстро заполняется и нам нужно еще тогда нам time билету систему еще вдвое больше удваивает этот путь этот пул также быстро фрагментируется заполняется и так далее удваивается удваивается удваивать однажды удвоив он никогда не уменьшается этот размер будет зарезервирован пока мы не выключаем наше приложение не верну в системе все сразу таким образом этот пул быстро разрастается до огромной длины быстро фрагментируется и в этом огромном пули уже все сложнее и сложнее найти к конкретное место под определенный блок памяти который нам понадобится и это в итоге ведет к катастрофическому снижению производительности потому что каждая даже самые малейшие локация начинает жрать очень много времени работает очень долго фпс падает очень сильно после нескольких минут игровой сессии ну из этой ситуации есть только один вывод выход снижать количество обращений к вот этой медленной памяти уменьшать ее использование снижать число локаций как это можно добиться у нас в распоряжении есть два типа памяти этого собственно этот медленный медленный hipp и стек нашего потока выполнения и соответственно есть два типа объектов так называемые ссылочные типы живут именно в этой вот медленной памяти а мы в стеке оперируем ссылкой на нем и другой тип объектов это валютой они ведут себя как скалярные типы как грубо говоря good числовые переменные они живут целиком на стыке копирую цветные присвоение в методы передаются по умолчанию по значению и так далее так далее соответственно первый совет логично из этого вытекающие это использовать в или you typed вместо ссылочных типов там где это уместно если у вас есть какой-то объект который олицетворяет просто и данные и фактически то есть содержу сложной логики возможно его будет уместно оформить как в или you type и вы можете избежать даже накладных расходов на передачу его по значению в методы используя ключевое слово реп то есть вы получите в или type который еще можно передавать по ссылке то есть это абсолютно бесплатная производительности этим можно пользоваться другой как бы такой наивный логичный совета ту уменьшать просто числа локации меньше 1 писать слова new year яркий пример когда какие-нибудь ваши методы создают временную коллекцию для каких-то своих уж потом они возвращают мы с нейтом делаем одно действие и потом отбрасываем на деле неизвестно когда garbage collector вот этому runtime соберет эту память на самом деле вернет системе или там с возможностью переиспользовать поэтому делайте один для временных их то мышления делать один бусин перед заполняете его очищайте и так далее обратить обращайтесь лучше к этой памяти один раз и навсегда чем много-много раз подряд совместить плюсы в или youtube и гибкость reference type можно помощью так называемых гибридных контейнеров у нас в частности используется такой гибридный контейнер как шелест то есть гибридный список по сути представляет собой вылетает объект в котором есть фиксированное число флотов и если и понимает фиксируем сотов есть ссылка на динамический контейнер если у нас количество элементов нашей коллекции не превышает количество этих pixie clips латов мы имеем по сути вылью type которые не используют эту медленную память не как если уж так случилось что вы превысили количество эффективных флотов мы обращаемся к этой медленной памяти лацием динамичный контейнер дальше наш контейнер живет полностью как обычный список когда мы работаем с каким трудным же удачными результатами вычислений позволяет среднем уменьшить число вот этих вот доступов к медленной памяти за счёт того что иногда этих доступов не происходит все помещается в в наши фиксированные slade и но однако для хранения данных долговременного эта логика может не очень хорошо подходить потому что появляются латать и логические разночтений утолил в данный момент сейчас ведет себя как вылью type только ссылочный тип и в общем поэтому так вот использовать нежелательно для временных вычислений подходит очень даже хорошо значит помимо того что пишите вы к локациям и падение производительности ведут даже встроенные возможности языка яркие примеры ты регулярные выражения я знаю что многие их используют и многие к ним привыкли многие их задействуют даже для простых вещей вы для сравнения строк но это не тот случай где можно это использовать а потому что в денете это очень дорого регулярке внутри там этой библиотеки и лоцируют очень много временных коллекций стоит вредных объектов в целом работают не быстро у нас например в игре тоже был такой фильтр мото то есть есть же час куда игрок пишут в том числе и плохие слова и чтобы плохие слова заметно звездочки у нас памяти всегда висел здоровый регулярка она оказывается использовался во все мегабайт оперативной памяти из нашего скромного лениться и когда это выяснилось в общем фильтр мото потребовался уже техническому директору и мы перенесли эту фильтрацию с клиента на серных целиком также понятно что конкатенации строк это тоже дорогое дело потому что у каждой плюсик от создание временного объекта для вашего промежуточного результата так что если вы комбинируете сроки такую сложную конструкцию лучше используются промежуточные какие-то buzzer и фиксированного например размера также достаточно коварная вещь и это анонимные место да и замыкания потому что они ведут к локации достаточно явным образом то есть каждой анонимный метод по сути временный объект и этот объект задается как только вы зашли в школу по где он объявлен то есть на самом деле в 99 процентах случаев вы можете не дойти досюда я объект не будет задействован но он ста процентах случаев будет создан и опять же будет утекать память вот таким явным образом потому что как бы тут вот совсем не ждешь такого поведения также библиотек link который позволяет строить запрос похожий на ice queen к коллекциям вот например сишарп она тоже не рекомендуется к использованию в игровых приложениях потому что по тем же причинам что и регулярке а на лации тут очень много промежуточных вот таких вот коллекций работает не быстро дальше начинается совсем интересные вещи например перебор коллекции с помощью пореч тоже ведет к локации мы работает гораздо медленнее чем цикл for данными оператор using которые используют для безопасного освобождения используемых ресурсов тоже ведет к локации и когда нет параметров в некоторые методы это тоже локация и причиной тому механизм который называется boxing иногда вашему runtime нужно рассматривать ваш объект вылью type как будто бы он ссылочный тип это например очень часто по нужно когда ваш были type реализует какой-нибудь интерфейс и тогда для вас ждут этот вот ваш валютой объект будет создан и перемещу будет создана его копии перемещена в динамическую медленную память и случаев когда это происходит на деле очень очень очень много и несмотря на то что этот объект по размеру небольшой boxing берет количеством поэтому внимательно обращайте на это внимание я не знаю изучите если вы будете писать на unity когда именно boxing возникает или обратитесь там камни в кулуарах мы это обсудим ну потому что это коварная вещь она очень явным образом ведёт к значительным утечкам памяти и и следует избегать и с ней нужно бороться значит повела от возможностей языка еще и сам api unity достаточно к ларин потому что он может скрывать очень тяжелые вещи очень явным образом например мы имеем два цикла на вид все выглядит достаточно безобидна то есть какой-то объект у него есть поле это массив вроде как и мы перебираем его элемента на деле оба этих циклов дудка локации а первый ведет вообще катастрофическим локациям потому что на самом деле это поле нас деле не поле а метод оформлены таким образом и этот метод возвращает тяжелую тяжелую структуру он задает этот массив заново и возвращает вам поэтому нужно будет внимание в документации unity если написано что какое-либо поле имеет тип массив или какой-либо метод возвращает массив то этот массив будет создан каждый раз заново каждый раз даже если и значение его из состав не поменялся ничего не кэшируются никогда даже если это выглядит как просто доступ к полю будет создан новый массив возвращён вам это может вести к катастрофическим общем аллокации там несколько мегабайт будет для перебора массива который на самом деле не меняется она будет просто выделено каждый кадр например и будет утекать помимо собственно больших аллокации вот такие безобидные поля могут скрывать ее в общем-то тяжёлую с точки зрения центрального процессора логику поэтому за этим тоже нужно следить кэшировать результаты которые вам возвращает вот эти вот поля например дальше когда речь заходит о каких-то интенсивных математических вычислениях зачастую бывает так что накладные расходы на вызов метода начинают сказываться на производительности негативно таких случаях компилятора языков типа си плюс плюс они вместо метода просто берут и встраивают его тело и таким образом у нас не возникает вот этих накладных расходов на вызов смену контекста возврат и так далее компилятор unity такого не делает ничего никогда опять же если у вас есть вызов метода в вашем коде высокоуровневым то он будет их фактически когда игра будет работать на мобильном устройстве поэтому если вы чувствуете что в вашей математики вот это вот накладные расходы на вызов имеют какую-то месту вам придется устраивать просто тело метода с одним то есть переписывать ваш код дублировать и так далее и так далее мы учителя конечно теряем в красоте но экономим из-за этого процессорное время прочел значит unity api в во многих случаях позволяет обратиться к свойствам некоторых компонентов по имени то есть передать строку там какую-то например и в общем получить по ней какое-то значение или выполнить какое действие на самом деле внутри api везде ходит хэши числовые поэтому каждый раз когда вы передаете строку от неё вычисляется хэш и уже он большой там передается глубже и глубже поэтому вычислить их езжу на ранее передавайте хэш сразу это бесплатная производительность почему бы этим не воспользовался ну и такое замечание что технология вызовы методов в по имени называемые reflection это очень медленно в случае с юнити это очень медленно и и задачи парсинга текста тоже работают не быстро поэтому если у вас есть poster текста который работает на reflection отказал от этого надо отказываться использовать или бинарных формат представления данных либо ну не знаю встроенной возможностью сериализации которые в unity есть мы подходим закономерно к вопросам о том как как как будьте здоровы как же собственно понять если у нас запас по производительности графического или центрального процессора где нам нужно кэшировать результат где дешевле будет его вычислить каждый раз заново и ответить на этот вопрос может только одним способом трахались в unity есть возможность профайле титул как в редакторе когда она запущен для тестов так и уже непосредственно когда запущен на устройство ну и другой способ это использовать какие-то системные инструменты там завязаны например конкретный на ios в этом случае это будет excluding струмент все как бы этим варианты имеют свои достоинства и недостатки но стоит заметить что профайлинг в редакторе подходит только для выявления каких-то глупейших ошибок с точки зрения производительности потому что во первых на вашем настольном компьютере и на телефоне принципиально разные железа и одни и те же вещи будут работать с разной скоростью там этом во вторых когда игра работает в редакторе unity добавляет у неё много системных разных обвязок и так далее и от этого берутся там своей аллокации какой слой вверх этому процессору и если в общем вы будете гоняться за призраками которых на самом деле не будет на готовом услугу да конечно устройство то вы потеряете время просто из двух вариантов профайлинга на устройстве мы рекомендуем системные инструменты потому что они не оперировать ими абстракциями которые вам unity придумывает то есть они видят игру именно с той точки зрения с которой и вид операционной системой и показывать таким образом максимально точную информацию помимо прочего недавно мы потеряли на хотя бы на время доверие к п файл unity вот по такой причине мы сделали какой-то новый там контент на и обновлении добавили новых монстров там локации разукрасили и так далее решили бы попали там сказал если это там на потребление прибавит решили что все здорово и еще есть запас по производительности далее 2 ipad тестеру игра вылетает через минуту и никаких отчётов об ошибке никаких краж и пунктов ничего нету заключили профайлер xcode вам на самом деле играю поглощала 260 мегабайт с лишним оперативки они 140 и как мы выяснили позже именно текстуры поглощали память поэтому непонятно почему unity собственном это не показал сейчас мы на форумах там пытаемся разобраться с ними как такое могло произойти unity папой лером не пользуемся сейчас мы сидим полностью на x колды инструмент значит таким образом пробежимся по всем тезисом еще разочек всегда помните о том что вы разрабатываете для мобилок какая у них специфика и железок и операционных систем помните об этом всегда когда как ваши действия могут повлиять на работу или на мобилки мобилках экономится оперативку не менее важна чем ресурс графического или центрального процессора поэтому экономить и оперативную память несмотря на растущие характеристика мобилок эти устройства все еще остаются полем для компромисса с точки зрения качества поэтому сжимаете урезайте насколько это уместно или возможно избегайте overdraw вы берегите свой графический ускоритель избегайте аллокации boxing поберегите центральный процессор и оперативную память помните об особенностях runtime а который никогда не отдает память системе об особенностях api и который может в каком-то таком неочевидном месте привести к локации были тяжёлые операции ну и регулярно прополисе насколько это возможно часто самыми точными инструментами которые есть наличие то есть возможно это неприятно потому что это долго собирать и глума устройству но это ваша прививка от гриппа это нужно делать регулярно к не очень приятно ноут вы себя защищаете от такой болезни как низкая производительность вашего конечного продукта на этом все и буду рад ответить на вопросы как бы не знаю какая добрый день и спасибо большое за доклад прямо очень полезно я разработал backend мобильных игр вот как раз у меня клиент unity теперь стало гораздо более все понятнее вопрос на самом деле такого плана под android если аналог из кода инструмент что прополиса таких вот точных инструментов которые бы в такой же степени сочетали точности удобства как xcode наверное я не могу предложить потому что там есть там где как какие-то консольные инструменты до которые позволяют получить дам конкретный момент времени который показывает распределение например оперативки папа тем этим нужно то есть сколько вас живет память и текстуры сколько там программный код сколько там отвечать реализатора для меня будет вам визуализаторов для них не попадался всяком случае можем какой-то all green там визуализируем в каких-то таких форматах хранилось может быть высокий ладно следующая тема вот соответственно instrumentation а именно по потреблением ресурсов до автоматизируйте ли вы профайлинг то есть если возможность там каких-нибудь ферма девайсов да на них дупло и цапы кошкина них находится и по файлы и потом гоняется по каким-то там за запуск загрузкой посмотреть сколько получилось вот насчет фирм девайсов там сильно тестирование пока тут ну то есть такие вещи есть только для функционального тестирования пока что нашла для функционального тестирования спалить и от la perla сексуальной сеуле есть вообще бот которые именно в редакторе бегает который убегает и глупости с точки зрения находится не там нет ли ошибок get дизайнерских таких ты еще и так далее так далее так далее это какая-то work или этого сами писать обзоры и написаны для unity на unity скрипта есть сами свое решение помимо этого сейчас есть набирает популярность вот о том же google play есть предрелизной тестирования так называемые там есть возможность играть с процентов покатить вот я такой вообще автоматизированную тему то есть несколько девайсов притом разных поколений там разных годов там до 30 цитат 2012 может быть и вы можете начать с пресса тест например какой то который туда зальете и перед тем как опубликовать игру она будет поэтому вот на записанному тесту и google и и прогонят на своей фирмы девайсов и покажу то есть не видела ли она нам на старом телефоне и как она с этим вопросом она работала нам вы увидите результаты виде скриншотов и виде то есть соотношение устройстве которых она работала и на которых нет это вот вы изучаете в google play да есть такая возможность и есть еще второй сервис который это делаю спасибо за доклад пара вопросов первый вопрос по поводу того когда мы забираем компонент по его именем строку передаем вы не смотрели как будет быстрее там же можно брать компонента его типу я придаю касается не получения компонентов по имени или по типу а например сейчас там был кстати один эту модель нет там приметами на касающиеся то чтобы ими мы триггер в анимации если по имени передаем то есть как бы чтобы поиграть у или иную анимацию то передать и числовой хэш который обычно заранее зачастую будет быстрее то же самое касается и работу с материалом их свойствами там там чуть глубже что проблема да и второй вопрос по динамическом освещении насколько вообще возможно в нынешней nude по вашему опыту с нынешним обстоятельствам дела так сказать вообще возможно использовать динамическое освещение там же насколько я знаю есть какое-то ограничение по количеству и динамических источников света все что нам нужно больше мы реализуем шейдерами ну да то есть как бы я пробовал там в нерабочее время грубо говоря экспериментировать с такими вещами там там дома там я пробовал делать сцену примитивных двумя источниками света там какой-то коробка дом и так далее в принципе два источника работает там час от vps на девайсе 2014 года но глубже я честно говоря не изучал дамы таких продвинутых и графических пишут не пользуются консорты изометрическая такая игра и всем визуальные эффекты и тени его очень они как правило решаются либо сильно уплощенным и средством либо там каким-то запеканием лиму шейдерами и так далее то есть честного динамического освещения на мобилках не могу сейчас предоставить именно такого прогноза когда их можно будет использовать полной мере спасибо спасибо за доклад вот вы много упоминали его ограничений на память которые вы выявили эмпирически еще немаловажный показатель вроде как количество вызовов рисования на уколов дары и вот я когда я если такое такая оценка до в unity как бы есть средства именно для отладки вдруг я просто не упоминал об этом сейчас в своем докладе то что это есть много другой информации по оптимизации трехмерных сцен с и минус вот этой точки зрения то есть общие техники которые касаются уменьшения количества вот этих двух голов они применимы как бы в играх и для приставок и для компьютера при для телефонов да и количество вызовов вот этих удавок олоф очень существенно влиять на производительность неважно независим вне зависимости от того используйте воюйте или нет unity обладает инструментарием для того чтобы считать эти два колы и как бы показывать вам откуда я на это называется сейчас подчас раньше называло друг он мне просто интересного для мобильных какое примерное ограничение то есть непрерывно плотно настольных там это могут быть тысячи игра все равно может и неплохо бы укладывают иметь порядок нескольких десятков но в целом как бы не смогу доставить ему сколько у нас от занимать в общем да баба ching используются должен широко и снижать вот это вот количество пахнут в играх которые мы делали раньше нам без использование unity вы стремились сводить ну порядка 50 дураков вот так но это были гораздо более примитивные двухмерные сцены поэтому как бы не известно сколько это оценка будет уместно для других проектов я думаю тут все достаточно индивидуально есть там infinity blade который работает на 2 устройства чтобы вам показать что они могу сейчас рисовать красиво и счастья проси все спасибо за внимание"
}