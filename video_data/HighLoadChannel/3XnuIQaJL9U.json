{
  "video_id": "3XnuIQaJL9U",
  "channel": "HighLoadChannel",
  "title": "Документация REST API / Артём Кузвесов (Ideco )",
  "views": 4439,
  "duration": 2454,
  "published": "2018-01-16T13:42:16-08:00",
  "text": "всем привет спасибо что пришли так меня уже представили меня зовут артем и я работаю в компании edeka я являюсь ведущим frontend разработчиком проекта шлюз безопасности и дкс с наверно не всем понятно как связан с лишь безопасности frontend я приведу пример простой допустим на гриле сейчас используют роутеры для доступа в интернет и с помощью этих роутеров обычно есть доступ к графическому интерфейсу через браузер в котором можем совершить какие-то настройки разработкой подобного интерфейса я как раз и занимаюсь помимо этого наша компания занимается разработкой продукты для ip-телефонии это этой кпв x и фильтром контентной фильтрации это дека selecta вообще помимо фронтэнда у меня есть опыт разработки серверной части api и мобильных приложений на основе языка javascript за свою практику я встречал много разных ситуаций и были ли такие случаи то что разработчики api не знали какие методы у них сейчас актуальны и какие надо использовать для решения той или иной задачи либо было документация по api но она была не актуально и вообще не соответствует соответствовал действительности я решил разобраться в этом вопросе получше давайте сначала определимся с тем о чем нас пойдет речь в теме доклада есть такое слово как api конечно можно чем зайти куда-нибудь википедию по встретит апреле мину я попробую дать более простой ответ то есть допустим у нас есть некая программа которая состоит из класса функций константы тогда ли это может быть когда операционной системы сервис приложения и для нас наступает роль черного ящика у которого из множества разных ручек archie шкаф которые мы можем крутить и вертеть как нам хочется чтоб положить в этот ящик входные данные после обработки на выходе у нас получается обработанные данные которые мы можем использовать как раз api это есть во множество ручек которые мы используем для того чтобы положить данные при этом нам абсолютно неважно как именно эти данные будут обрабатываться также говорю прогресса representations стоит трансфер это архитектурный стиль позволяющие сделать и сетевые взаимодействия более удобными прозрачными и стандартизованным давайте немножко подробнее на этом остановимся такие же у нас есть требования к архитектуре rest а во первых это модель клиент-сервер то есть получается что у нас клиентской части серверная разрабатываются отдельно что в свою очередь упрощает разработку сервера и приводит к более простой переносимости интерфейса коды клиента на другие платформы пишем допустим один сервер и его используем уже на мобильном приложении на сайте либо приложение в операционной системы следующее требование это отсутствие состояния то есть получается у нас не какие состояния о клиенте на сервер не хранятся при этом все запросы от клиента к серверу составлена таким образом чтобы сервер получил всю необходимую информацию из запроса третье требование это кэширование то есть получается то что клиент может кэшировать ответы сервера при этом ответа сервера должны быть явным или неявным образом помечены как каширу и мы или нет это в свою очередь также повышает производительность и даже может исключить какие-то клиент-серверные взаимодействия допустим использовать кэширование можно с помощью шти теперь это заголовки detect last-modified например четвертое требование сейчас единый интерфейс между клиентом и сервером то есть нас определяется интерфейс который должен быть один то есть допустим у нас все запросы идут определенным образом например через юрий при этом ресурсы отличается от представлений которые получает клиент то есть nas-сервер получается дает не базу данных какой-то джейсон xml или html который является выборка из этой базы данных так это требование это масштабируемость то есть получается то что у нас клиент может общаться с сервером либо через прослойку серверов при этом он точно не знает с кем он общается и это чаще всего используется для повышения производительности и распределения каширования еще 6 требования не обязательно которое называется код по требованию то есть получается что серверном может предоставить какой-то код по требованию например какой то zara скрипт код который мы можем спал пекли интим нас получилось шесть основных требований давайте еще рассмотрим методы для rest api во первых это метод creed метод post который позволяет создавать новый ресурс приведу аналогию с библиотекой допустим мы хотим добавить новую книгу и лето нам как раз подойдет метод post мы можем указать имя автора и название книги страниц жанр другой метод get предназначен для получения информации ресурсе мы можем запросить список всех книг можем запросить список отсортированы по комнату параметр например по автору либо если мы знаем уникальный идентификатор нашего ресурса например книги мы можем запросить уже информации только по конкретной книге и этом этот гад и является единственным безопасным методом потому что он никак не модифицирует данные для обновления данных у нас есть метод путь который обновляет данные ну например мы хотим обновить изменить у книги автора мы отправляем 1 мнением автора при этом нас базе данных вся информация о книге перезаписывается attending еще контента для обновления патч о чем он отличается да правильно он как раз предназначен для того чтобы изменить только одно поле например тот же автор если мы будем изменять имя автора через метод патч получается у нас базе изменится только автор остальные все поля останутся прежними ну и конечно же есть метод делит предназначены для удаления ресурса по его идее например у нас книга пришло в негодность и нам пришлось мне избавиться от этого подойдет отлично метод делиться также нужно вообще документировать об если вроде как все так прозрачно на самом деле бывают очень разные ситуации например может быть большая команда где много бы киндеров front эндеров и они могут особо даже не взаимодействует могут даже не пересекаться и при этом именно как то делать продукт либо например front эндеров не может быть доступа к репозиториям бэг-энда чтобы посмотреть как что написано или даже фронте frontier может быть не знаком с этим языком или другая ситуация компания решила отдать продукт на аутсорс допустим выпуск мобильного приложения и разработчикам также нужно документация по api и какие же у нас есть варианты для решения всех этой проблемы я расскажу те которые встречал в своей жизни но первых это можно все описывать на бумаге и допустим как-то распечатать или наклеить на стену на доску какой то это не очень удобно можно использовать markdown и писать и ридми файл и либо при структуры текст и тоже как-то использовать это даже встречал такие ситуации когда с помощью этих способов писали свои сервисы для документация api можно также использовать гугл докс и tables ну тут еще немного хуже обстоят дела потому что разработчику надо написать допустим методом или обновить его пойти совершенно другое место гугл докс допустили написать его описание для этого метода ну также можно писать комментарии в коде ну это возможно не очевидно будет для некоторых пользователей а некоторые разработчиков а некоторые разработчики даже не смогут попасть в репозитории и все это вызывает боль но раз есть такая проблема то должно быть как ты должен быть какие-то готовые решения да действительно здесь какие-то сервисы и и фромборке их на самом деле очень много и как же выбрать среди всего этого множества то что подойдет оптимальном давайте начнем с того что внесем какие-то требования например мы не хотим жестко завязываться на язык разработки давайте уберем несколько сервисов которые вы php документа пигмент они предназначены для печки и мистер блок предназначен для воды на джесс хорошо все равно у нас осталось достаточно много сервисов нас есть много сервисов которые являются по сути платными но внутри используют бесплатные давайте уберем их окей у нас осталось всего лишь три кандидата это хромал swagger и over blue print я предлагаю посмотреть на них подробнее давайте посмотрим кто поддерживает люблю print основным вентером является о пиаре и являются платными платформы куда можно публиковать документацию для api print общее разрабатываются этой компании и по сути мэттом пешим документацию в виде markdown а у ramal уже гораздо больше вендоров и основным разработчик являются мальцов и поддерживают такие крупные игроки как oracle и amazon это уже выглядит интересно посмотрим что там с лаггера тут уже больше интересных компаний изначально разрабатывает swagger компания смартвес получил поддержку swagger от links fondation улице red hat adobe atlassian это g и 1 т.р. google paypal microsoft обеим достаточно известные компании в мире эти все эти компании образуют между собой open api инициатив это команда которая занимается разработкой апельсин которая когда-то еще называлась swagger station по сути это формализованы спецификация которая является к системой множество инструментов для взаимодействия фронтэнда библиотек и api чем она разработана таким образом что не зависит от языка программирования и легко читаемы как человеком так и машины при этом если мы имеем какое-то уже написанный все за какую-то описаны спецификацию на ее основе мы можем сгенерировать код клиента круг от сервера получить документацию либо тесты кстати узнали то что в мире а питер есть некая церемония оскар и как раз в 2016 году swagger получил премию вот api words в номинация api инфраструктура как раз и за счет вот этой цепи fashion давайте немного еще дальше посмотрим и сравним наших конкурентов вообще исторически сложилось то что разработка идет таким образом top-down то есть мы сначала пишем код и реализуемого а потом по написанному коду строим спецификацию но своего пошел дальше и предложил другой подход то есть мы сначала описываем спецификацию а уже из этой спецификации можем получить код клиента или сервера документацию или тесты или все вместе возможно что этот подход будет пользуется популярность в будущем пока достаточно сложным об этом судить по поддержке языков выигрывает swagger нового сном это происходит за счет того что он поддерживает такие не часто встречаемые языки как да и например справедливости ради стоит сказать что все эти сервисы поддерживают все основные языки разработали например python руби си но джесс давайте посмотрим еще популярность среди интернета всего этого например по просто на stackoverflow нас лидирует slogger ну вообще по большинству параметров как мы видим резервуар тут сравнивают столько побед хабу например ядра этих трех сервисов по запросам google правда на 2016 год мы видим что с большим отрывом с большим бицепсом идет вперед своего отличие от своих конкурентов давайте немного подробней все еще все таки посмотрим допустим вот мы можем поставить на каме ты об люблю print мы видим то что сначала они достаточно активно что-то разрабатывали ну последние годы напорных стих у них все еще есть несколько открытых багов посмотрим ramal они сначала делали версию 0.8 и когда мы видим пик это где-то 2017 год они усиленно начали делать версию 10 и тогда было много комментов у них также сейчас есть несколько багов что мы видим также есть у них только сервис api дизайнер который предназначен для того чтобы мы можем писать одновременно спецификацию и посмотреть что у нас получается в виде документации этот проект уже поактивнее но также в нем есть еще открыты и баги посмотрим swagger своего достаточно много комментов и он более-менее равномерно разрабатывается до сих пор активных багов у него сейчас нету swagger юо и это библиотека для над графический интерфейс по сути сама документация была версия 20 недавно последние несколько лет про это чуть подробнее позже расскажу там багов сейчас нет сейчас они пилит новую версию 30 она в активной разработке и поэтому там всё ещё совершаются баги и она еще не production are 1 так же у нас есть в городе таро это сервис который позволяет также одновременно 50 спецификацию смотреть на получаемый результат тут есть один бак у второй версии которые все еще не закрыли и 0 багов в третьей версии ну и конечно есть лагерь codegen который позволяет генерировать под множество языков тут очень много комментов соответственно так как много комментов то есть и баги и все это как мы видим активно разрабатывается давайте на верность и остановимся slogger если мы будем искать в интернете что-то на эту тему мы обязательно наткнемся на что-то подобное на связаны с тем что игр переводится как выставлять что-то на показ нам нужен именно фромборк что же он нам даст ну во первых это документация красивая и тестирование получения генерация кода давайте начнем с я вот так выглядел ей для второй версии но буквально пару месяцев назад у нас вышло 3 версии теперь он выглядит так остановимся на версии 2 x он поддерживает более старой спецификации начиная от 1 до 2 поддерживает мультиязычность и при разворачивании он имеет достаточно много файлов давайте посмотрим сагир 3 он поддерживает только одну спецификацию самому последнюю 20 компактен при разворачивании но у него есть несколько баков он не поддерживает пока что мультиязычность не поддерживает некоторые параметры например мы не можем указать люди видят джейсону пока что и все из этого вытекающую получается у нас давайте рассмотрим top-down реализация вам приведу небольшой пример как это делается на практике и пользу я предоставлю доступ к репозиторию с этим проектом чтобы вы могли все это развернут в себя то есть у нас допустим есть написано какой написано к это приложение допустим это api для библиотеки оно очень простое и у него есть контроллер моделька роутер вентиляционный файл apps сложно надо сделать чтоб получить из всего этого написанного кода api 0 этого нам надо поставить я так как разрабатывают здесь я буду приводить примеры но джесс мы ставим пакет сагир ездок и в зависимости от версии uiaa надо поставить либо этот пакет либо этот так иди же нам теперь писать всю эту документацию у нас есть роутер который выглядит примерно так у него есть пути и методы которые доступны по этим путям давайте писать документацию здесь то есть мы пишем комментарии нала нотацию и говорим что эта нотация предназначена для сво дира говорим url по которому будет доступна и метод хоккей у нас появилась такая генерировалось такое окошко то есть у нас есть метод get который подсвечен определенным цветом также можем указать теги например можем генерировать некоторые запросы по определенным тегом например бук то есть все методы которые у нас будут иметь так бог там например great post по будут патчу они будут все собраны здесь можем добавить какую-то кого это описание она также будет доступном документации можем указать как будем передавать данные например через джейсон можем xml указывать вариантов достаточно много и давайте определим параметры которые будем передавать ну допустим мы хотим передавать жанр книги чтобы вы делать выборку по жанру ну у нас есть определенные параметры и это определенные варианты жанра и это будет на оскаре принтером это будет выглядеть так и мы прямо отсюда можем посмотреть какие варианты у нас доступным также можем писать такие у нас могут быть ответы можем просто писать код ответа и его описание и либо при желании можем даже добавить объект того что нам будет возвращаться документация это будет выглядеть следующим образом из-за грея им можем попробовать все что описали то есть нажимаем попробовать и получаем ответ с игры я и нам говорит тоже как мы можем попробовать от мы пустим крылом обычным с запросом сделать и в итоге вот мы получаем такой ответ и тут уже описание ответа от сервера идет я говорю читера не то что нас еще модель данных где он нас описана структура там допустим базу данных это автор название книги там статус просчитанный прочитаны жанр мы можем чтоб не перес пользователь чтобы написать каждый раз каждый параметр в несколько строк мы можем обращаться к ним по ссылкам давайте создадим тут рядом ямал файл в котором определим все параметры то есть мы можем определить эти параметры автор название книги то есть страниц например жанра статус прочитанными прочитаны можем сказать то что эти данные будет передаваться например боги как форма какие обязательные данные какие нет вообще можем заметить что по сути это поддержка идет джейсон схема и следовательно можем использовать все что есть женский метра то есть минимальное и максимальное значение обязательность ввода данных и даже ссылки как раз ссылками мы насчет сок мы и будем их использовать давайте опишем метод post ну начинается все так же как и где то мы говорим что это метод для сагир оговорим url по которому он будет доступен и что это за метод и какой так у него имеется вот мы получили метод post можем добавить описание и в каком виде мы будем отправлять данные давайте опишем теперь и параметры вот допустим через долларов можем описать ссылки они будут выглядеть так то есть мы тут можно также ввести все данные обязательное поле у нас выделено жирным и помечено также можем только писать ответ все аналогично как в методе год получается давайте попробуем отправить запрос на создание нового и книги мы заполнили данные и решили попробовать вот так же показалось как это сделать с помощью parla куда был послан аж степи запрос и сонным вернул сервер ну это еще не все нам надо еще описать другими также мы можем писать вот подобным образом методы get по идее путь по оси дэвид и в итоге мы получим что-то такое то есть каждый метод выделен своим светом что тоже весьма удобно может возникнуть ситуация то что у нас есть version of api и в какой-то момент у нас код метод становится устаревшим мы можем отметить всего как где прикрыт от и он зачеркнем c в нашей документации и также будет помечен что он устаревший но в версии ей три он выглядит еще лучше он просто становится vesti.ru и сразу становится ясно что с ним что-то не то так мы вроде как описали все наши методы теперь нам надо как-то собрать документацию давайте пойдем в основной файл инициализации онный то есть нам надо подключить генирельдо подключите сгенерировать как-то джейсон файл для этого нам надо ввести в него сам какие-то основные описания то есть мы можем сказать версию api что это за пиу нас ур основную его и в общем вы видите все это на скриншоте на экране мы можем указать как у нас будет ходить данные например http и https в соке ты всс по умолчанию данные будет ходить по тому пути по которым будет открыт согревай и мы говорим откуда мы будем собирать наши данные то есть это получается из роутером будем по аннотации смотреть и и снимал файла то есть вот эта вот информации которые писали она вводится тут теперь нам надо как-то получить именно джейсон ну на ноги это делается примерно так и остается добавить сам swagger ей то есть мы положим его например в папку паблик и это сделаем ее доступны swagger и версии 2 будет использовать достаточно много файлов папок тут получается лежит даже тут много файлов не менее fits и равана лизы даже и допустим bootstrap борьба он джейси все языки куча стиле нам надо пройти вас мной файл и допустим если мы хотим указать язык русский например можем сделать это и url по которому будет доступна наш джейсон с со спецификацией я ей три это уже просто несколько файлов без папок и они все являются унифицированными то также идем 8 файл и также указываем путь до нашего джейсона в конце презентации я дам ссылку на саму презентацию и вы сможете посмотреть эти примеры живую но для начала вам конечно их надо будет развернуть проект надо будет развернуть у себя на машине и давайте еще посмотрим на другой подход к реализации это то есть мы сначала описываем спецификацию а потом генерируем код но не стоит стоит не забывать то что с вами сделает всю работу за нас он даст нам какую-то рыбу но все бизнес-логику нам нужно будет описывать самостоятельно для этого используется в ограде то его можно развернуть локально поставил глобальным пакет swagger и допустим мы хотим развернуть его у нас есть такой сервис как фреймворк экспресс я решил привести пример на нем теперь у нас доступна наша наш новый проект для редактирования через едет мы можем его как-то стартануть и либо стартануть замок оными данными также можем запустить тест и на нем все это будет выглядеть примерно так у вас есть экран слева получается описывается спецификация справа получаемая документация и все это работает интерактивным то есть если вы что то удалите и это станет инвалидная спецификация вам сразу покажется ошибка и слева покопаться эти строки на которые стоит обратить внимание помимо локальной версии все это доступно онлайн то есть эта ссылка также будет презентация вы сможете все это посмотреть в живую так при генерации у нас получился у нас такая структура тут у нас есть основной файл swagger я мог где у нас будет сам спецификация лежать и какие-то дефолтные настройки для него давайте подключим базу данных чтобы как-то мы могли с этим совсем работать и возникает вопрос где теперь написать код ну надо писать его получается в лагерь ямал мы открываем можем открыть swagger did our но по сути это вот он использует вот этот файл и описываем подставляем допустим такой рендер как x-terra что-то вообще x-terra это как и какие используются для расширения возможностей с лаггера данном случае мы говорим какой у нас будет контроллер и для метода get можем указать метод который будет использоваться вот ей создаем файл с контроллером так нет давай сначала пишем модель данных и потом создадим files контролируем то есть мы указываем как мы будем его называть как указано было спецификации и самое интересное что у нас доступны все параметры уже немножко иначе то есть мы через сама обертку slogger и можем получить и любые параметры использовать их например так мы получаем твари параметр для того чтобы совершать сортировку так можем выбрать определенную определенные книги и либо все книги либо по переправам там случай у нас по жанру также мы можем писать другие методы например не используя уже на звание самого метода то есть мы говорим как у нас будет называться контроллер методы асан за по умолчанию там гейб будут спать делись например также у нас как я говорил предоставляет codegen так как я работаю за макаму приведу пример на маке то есть мы ставим пакет и по сути говорим что нам надо запустить код и генератор под конкретный язык из определенной спецификации и положить полученный код сюда закон достаточно много поддерживается например под серверную часть можем сгенерировать код на питоне на печкина но один а вот на эти также можем сгенерировать под клиента таких даже языках как borsh но под angular и разные версии выбор достаточно большой презентации есть пример которые можно будет посмотреть то есть тут есть варианты как все это будет выглядеть например если вы используете confluence и привязаны к этому сагир позволяет генерировать документацию прям туда либо вам надо предоставить документацию кому-то чтобы она была виде простой html без возможности не пробовать методы которые там описаны также можно это все сгенерировать даже в двух вариантах давайте посмотрим какие есть возможности шаги 1 и дейэн давайте посмотрим сначала на 3g и диету если например в шторм нас есть он два пакета один позволяет делать подсветку то есть ну подсветку и автодополнение когда мы описываем спецификацию а второй codegen то есть получается там мы можем поставить пакет который по сути также будет генерировать нам код на каком-то из языков также давайте посмотрим вижу код там где есть тоже два пакета даже три которые по сути являются лидерами но не проверяют насколько правильно валидация написанный лет и подсвечивает если что то не так мы подобный пакет есть под а там возникает вопрос как то можем все тестировать полученную документацию на самом деле можно мы можем сопоставлять полученный джейсон и либо ямал с теми путями и принтерами которые у нас описаны вопи проверять все ли соответствует действительности можем доверять валидацию gsm джейсон схема либо есть такой пакет который также расширяя спецификацию swagger через экстер и слова что-то можем описывать тестирование прямо в спецификации давайте сделаем несколько выводов по сводя ну это у него богатая спецификация большая поддержка позволяет генерировать код позволяет получать тесты об анапе спецификой шин достаточно ногу него плюсов вот тут я сделал дополнительные ссылки допустим чтобы мы будем дал слово нам вы можете посмотреть на baby print посмотреть как у него выглядеть я также вы можете поставить ей рамбла и своего вот есть первая ссылка это основные такие кейсы очень хорошая выжимка по всем кейсом как допустим работать с файлами с авторизацией из всем таким на очень хороших примерах и чуть ниже и другие будут ссылки на и репозитории примеров которые рассказывал то есть там top-down и bottom-up реализация то есть вы можете скачать их себе и ставите развернуть и вообще пожалуйста документируйте api не забывайте об этом потому что все это будет удобно и вам и люди которые это используют спасибо большое за внимание тут вот доступный qr-код ссылкой на доклад спасибо вопросы пожалуйста и ни у кого нет вопроса до спасибо артём за доклад о докладе вы сосредоточились на прямых конкурентов полного цикла какие ваши будут рекомендации если исторически сложилось большинство restful сервисов уже описаны но например вводил как подход к документированию того что было сделано до того как есть много сервисов которые позволяют конвертировать из одного из спецификаций в торгую там очень много их допустим почти все что можно все что столько это можно сконвертировать swagger вопил принц arden и посмотрите то есть исторически если уже сложилась экосистемы и конечные системы требуют водла да и требуется их задокументировать то просто механически пробросить название методов в swagger и обратно да это не даст там каких-то комментариев авторов то есть все то богатство которое из лагеря есть какие-нибудь средства которые позволяют сделать двухстороннюю синхронизацию чтобы ну не 10 раз вписывать если старая система принимает только воды выдает только в от ли не сталкивался но надо искать спасибо скажи нам самом деле swagger распространяется через npm и там очень много разных сервисов мне кажется то можем что-то наличие то что будет удобно вам mozilla здравствуйте спасибо за доклад я хотел спросить как у меня два вопроса первый поддерживали swagger и описание формата ответа с include a mi ну грубо говоря когда вас есть описка там дай мне список книг этого автора объекта книга но есть более автор дай чтобы каждый раз они дублировать каждого за объектов ты используешь include и в которых ты описываешь информация об авторе а в каждом объекте книги ссылаешься на нее можно сделать в описание того что должно приходить джейсон который как раз описывает а что вы говорите то есть можем говорить то что тот будет автор страниц и допустим статус прочитанными прочитано еще вы хотите чтобы это все автоматически запросам ходил другим до вот такого не встречал мы по-моему так нельзя себя еще вопрос спасибо за доклад вопрос такой на сайтах о пиаре и с лагером может завести платные аккаунты и пользоваться какими-то функциями там сейчас я видел что можно принципе все локально развернуть и воспользоваться этим локально бесплатно я правильно понимаю как ни странно поддерживал его продукт этапе blue print и живет он за счет него но также о пиаре работается с foger ею поддерживает его то есть мы можем спецификацию на своего рис разместить ее платно на о пиаре ну там можно один проект только бесплатно если больше то платно либо можно иметь только документацию с лагере и размещать ее локально ну вот так так же надо поднять будет просто его у себя на сервере куда-то и все это будет то есть всеми возможностями swagger и можно воспользоваться бесплатной бесплатно это платный сервис тесты make все бесплатно да можно да спасибо спасибо большое за доклад спасибо вам"
}