{
  "video_id": "jlQwOledbc0",
  "channel": "HighLoadChannel",
  "title": "Дезагрегация и открытость в сетях Ethernet / А.Петровский (Mellanox Technologies), Д.Криков (NGENIX)",
  "views": 719,
  "duration": 3456,
  "published": "2018-08-16T04:06:28-07:00",
  "text": "добрый день уважаемые коллеги меня зовут петровский александр я являюсь системным инженером компании mellanox и в этой презентации я хотел бы рассказать о том как с помощью готовых и что самое главное открытых решений можно строить не только высоконагруженные сервисы предложения но и высокопроизводительные решения для сетевые решения для дата-центров краткого компания милон огс мы являемся израильским производителем высокоскоростных решений interconnect а для цодов это коммутаторы сетевые карты кабели и трансиверы в общем все что нужно столько чтобы построить всех скоростную сеть центр обработки данных и соединить серверы система хранения или другие компоненты внутри кода между собой соответственно наш ключевой компетенции это создание собственных чипов то есть все все наши продукты которые мы делаем коммутаторы карты даже трансиверы кабели мы делаем на базе собственных чипов и соответственно это также дает нам очень большие возможности в плане предоставления как можно более открытого доступа к интерфейсам programmer не этих чипов ну и собственно для всего того на чем будет строиться мы текущей презентации то есть для построения открытых ethernet сетей в соде мы также являемся активным участником концов сообщества и в частности проекта open компьютер первую очередь я затрону такой феномен как white box коммутатора некоторые наверно слышали что это такое вкратце это коммутаторы с открытой платформой где можно выбирать не только железо коммутатора но и операционную систему которую можно ставить на это на это железо и сетевые приложения соответственно для коммутаторов соответственно основной фокус презентации это все-таки программная архитектура таких операционных систем и таких сетевых решений потому что аппаратные архитектуру я затрону но это не так интересна сама интересно все-таки как же должен выглядеть открытый софт сетевой для коммутаторы как он должен работать вместе с железом чтобы это было на высокой скорости эффективно надежно нестабильно ну и подтверждение моих слов мой коллега дмитрий кликов из компании gemix соответственно поделится своим опытом успешной реализации кейса применение таких коммутаторов в инфраструктуре сидел провайдера начнем сначала немного терминологии что такое дезагреганты который есть название презентации ну например access кисловой при приводит это как разделение чего-либо на отдельные компоненты собственно такой простой процесс это очень важный феномен стал в в процессе трансформации айти инфраструктуры дата-центром то есть там с 70-х годах годов прошлого века когда инфраструктуре доминировали высоком высоко производительные машины с очень жесткой архитектуре mainframe где связка между аппаратной платформой и соответственно программной платформы операционки тема приложением было очень жестко завязано и разрабатывал все в рамках одного как бы вентр производителя после этого там где-то уже в 90-х годах 80-х годах появилось так называемое в диктуй обеим писи которая ну по факту существую революцию в в центрах вы числителях создав открытую платформу на базе которой можно реализовывать аппаратных платформ на базе которой уже можно реализовать практически любые программные операционной системы разрабатывать приложение которые могут быть портирован на разные соответственно аппаратные платформы операционной системы в том числе и это дало толчок дальнейшему развитию то есть вот пример дезагреганты так сказать на лицо то есть железо отделена от операционки отделена от приложений ну и сейчас уже мы имеем то что приложение трансформируется постепенно микро сервисы еще более абстрагируясь от аппаратной платформы и даже от программы от программной платформы то есть это виртуализация conti реализация ну и вообще как бы распространение таких от вязаных вот конкретно аппаратной платформы приложений сервис в сетевом мире этот процесс начался гораздо позже то есть на десятки лет позже то есть где-то вот в двухтысячных до двухтысячных годов типичный коммутаторы выглядело примерно так это большой большой холодильник ну или маленькое устройство которое было полностью закрыта с точки зрения аппаратной платформы с точки зрения программной платформы состояла из тесной связке между железом операционной системой коммутатор всю операционной системой истинным приложениями это все это разрабатывался одним вендором и где-то вот с 10 года появились так называемые white box коммутаторы в которых соответственно железо стала связана от операционной системы и приложений немаловажную роль в этом процессе сыграли крупнейший веб-компании а также telekom провайдеры для которых но которые не хотели переплачивать за лишние функционал включенный в например в тесную связку между софтом и железом хотели просто покупать отдельно железо как отдельные сервера и уже там отдельно приобретать операционной системы или приложения некоторые даже разрабатывать начале разработки к сами то есть появились так называемые сетевые операционные системы отдельные вот-вот представители железа и сейчас уже эта экосистема она еще дальше расширилась появились целые сетевые приложения которые от вязаные не только от железо от непосредственно при зрителей коммутаторов но и самих операционных систем то есть все это может быть взаимозаменяемыми то есть различные оборот даже родителям железо может запускать различные операционки и может могут запускать различные приложения собственно что же такое открытость тогда давайте инфраструктуре открытость тесно связана с агрегации и тоже на примере серверов да то есть когда для каждого сервер есть целый список производителей стива процессора или мозга любого сервера также есть множество производители самих серверов то есть самих коробок внутри которых есть процессор или нового cisco dlp топ-5 и из-за этого из-за того что архитектура в принципе как процессора так и самого сервера открыто весь возможность использовать различные операционки linux windows bsd потому что угодно ну естественно есть целый набор приложений которые также являются курс платформенными и могут работать на всех этих операционных системах аналогичный процесс происходит и в сетях когда у нас switch вместо процессора основным компонентом свеча его сердцем является isic или чип который отчисляет а по рациям аппаратную коммутацию высокоскоростную пакетов на скорость интерфейса соответственно есть целый ряд производитель чипов включая нас еще там где-то 5-7 компаний есть еще больше перечень производителей собственно самих коробок самих железок коммутаторов которые на базе типов делают уже готовые продукты и за счет открытия архитектуры чипа первую очередь появилась принялся целый список операционных систем как открытых так и проприетарных или коммерческих которые могут работать на не только на различных железках но и на различных типах и пошли еще дальше и получили что есть приложение которое принципе всем уже некоторые из них всем знакомы например тоже клава которые уже там десяток лет она может работать не только на разных коммутаторах разных производительные на разных операционных систем используется внутри в качестве основной компонент почему этот феномен этот процесс агрегации открытость сейчас очень актуален в первую очередь он позволяет удешевить инфраструктуру центр обработки данных особенно что особенно важно для крупных судов то есть компании телекомы первый кто начал отодвигать они собственно исходили из этого то что комодики железа которая может можно купить просто там моего производителя с полки без софта она стоит дешевле чем какой-то венгерское железо куда зачастую заложено еще дополнительно маржа интеллектуальные собственник производителя здесь просто железка как голый сервер естественно это дешевле также софт чаще всего дешевле нас of this специализируется отдельные компании у них это у них специализация программная разработка и за счет этого как бы стоимость стоимость такой разработки она стоит дешевле чем делать все вместе и во многих случаях также софт можно вообще бесплатно получить если это открытые софт условно-бесплатно потому что нужно еще люди которым вы там будет разбираться не тоже нужно платить также это гибче в эксплуатации и зачастую прочность во первых нет привязки к вендору то есть предатель железо один приз авто другой можно в любой момент поменять и то и другое если вдруг по каким-то причинам вам захочется перейти с одного презрительно другой и можно самостоятельно расширять функциональность если случай закрытыми платформами все что можно сделать это пойти к вендору и запросить новую фичу ждать ягодами то здесь во многих случаях девяносто процентов случаях можно самим написать эту фичу или заказать ее какой-нибудь компании и также это надежное уже проверено то есть за последние там где-то 5 7 лет сначала развития такой концепции в первую очередь фейсбук гугл microsoft уже практически полностью используют собственные как бы коммутаторы на базе собственной платформе но естественно они заказывают это все у производителей на каких-то заводах но в большинстве случаев софт пишут сами например microsoft не так давно разработал из-за релизов паблик в пунктах свой процент тем кто называется sonic и это я уже используется уже в годами и сформирована целая эко-система который называется опыт над working или открыты открытой сети вот и я покажу собственно сколько она большая на следующих слайдах и во многих случаях также есть поддержка отдельная для от аппаратами производителей аппаратных решений программных решений то есть это не просто купили и соответственно вас оставить без поддержки нет многие производители железа оказывают поддержку на оборудования и произойти софта оказывает программную поддержку нас ванна собственно свои продукты небольшой ликбез по архитектуре коммутатора чтобы в дальнейшем было проще ориентироваться по мере углубления в технику собственно архитектуры типичного коммутатора ну я сейчас беру обычный обычный а пицца бокс то есть 1 юнит avaya коробка с кучей портов выглядит лечим образом то есть собственно сама система носили коробка железка в которой есть несколько основных компонента первого щита chip & seek собственно него подключенные порты они передают трафик на скорость интерфейсов 10-40 100 гигабит неважно собственно чип он передает трафик соответствие запрограммируем заранее таблицами для того чтобы то запрограммирует и сказать ему из какого порта в какой будет тратить передавать нужен какой-то софт который крутится насыпью то есть все что не чип это менеджмент как бы часть или control play состоящий из некого никому тренерский плата с процессором памяти sd ну то есть все как в обычном сериале только менее производительна ну и также есть обвязка которая контролирует питание вентиляторы светодиоды сенсора то есть это некий контроллер который там моргает светодиодом на свече при когда порт активируется вот поверх этого всего есть его операционная система которая крутится естественно процессоре и имеет доступ к чипу не ко всем остальным компонентам есть приложения которые реализуют конкретный сетевой функционал вот так примерно выглядит архитектура коммутатора соответственно если рассматривать экосистему открытых сетевых решений опять же ссылаясь на эту архитектуру то она выглядит лечим образом то есть у нас с точки зрения чипов есть целый ряд производитель чипов включая нас там про таком marvel и других которые делают чипы в том числе му который можно использовать в открытых в коммутаторах white box соответственно есть производители уже готовых систем то есть готовых коробок на базе этих чипов как в рамках концепции white box то есть это грубо говоря вы можете заказать на заводе железку она будет без лейбла поэтому лайтбокс white lable то есть очень много этих производителя в китае в тайване то смогут вам там по заказу склепать коммутатор под ваши требования и также есть производитель так называемый бренда твой бокс это то же самое что white box только от какого-то известного бренда то есть там с расширенным саппортом с дополнительными плюшками но в принципе суть от этого не меняется то есть это пример мы ведь видел и другие известные производители которые чаще всего берут вот эти white box и перри клетки своей маркой либо нашем случае делают свои железки снулля с точки зрения операционной системой сетевой есть целый ряд производителей как бы комплекса программ которые связаны с тела операционной системой а также счастливыми приложениями то есть это все в одном это готовый дистрибутив который можно поставить на коммутатор и он заработает сразу там будет функционал коммутации можете зации там еще дополнительные вещи есть производители например cumulus linux коммерческий linux есть наш операционной системы есть там целый ряд например открытых операционок например sonic это все сапун солнцу но это все поставляется в виде готового пакета дистрибутива для white box коммутаторов а также есть еще отдельные производители которые делают отдельные операционки например вот снайп карп kubuntu или big свеча планет arc linux это то есть суть эта платформа то есть эта операционная тема которая заточена под коммутаторы но на ней нет как бы логике на ней нет приложений и под это еще есть целый ряд приложений отдельных которые могут работать на различных операционках вот но реализует конкретный функционал там квакали лесу и реализует роутинг бюджет идеи реализует только бюджете и там сны про вот это тоже отдельный ratings т.к. вот там и сампе что-то еще все это отдельные софт и которые можно ставить использовать то есть вы видите что экосистема она в принципе уже очень широкая есть целый ряд именитых компаний в ней и это действительно используется в очень больших очень масштабных инфраструктурах по всему миру ну и также есть ряд компаний которые делают внутренние разработки чисто для себя google facebook amazon они пишут своей операционной системы свои приложения соответственно стоит вопрос все-таки что такой коммутатор это просто сервер с чипом или же не совсем потому что архитектура как бы от ли отличается от сервера только наличием чапан на самом деле это так но не совсем то есть во первых чип это не secu то есть у чипа уазика нет стандартной архитектуры это самое главное и собственно чип он передает пакет и на высокой скорости то есть цепи управляет чипом чип передает пакет цепью запускает операционки приложения которые свою очередь управляет чипом через некие и 5 соответственно на уровне контра play сетевая операционная система это не серверная операционная система то есть не совсем фирменная система потому что основе задача сетевой операционной системы это не какие-то сложные вычисления это управление периферии коммутатора предоставления доступа к интерфейсам чипа и польски интерфейс и села и веб-интерфейс чтобы настроить какой-то функционал свеча и сетевые приложения это все таки не обычные приложения они не проводят кита мощная расчеты не реализуют q сложная логика они в основном занимаются реализацией его функционала коммутации можете зации фильтрации трафика это менеджмент фич то есть в общем как бы случае можно их объединить так что они формируют оформленные таблицы внутри себя сетевых протоколов и программировать чип соответственно этими таблицами то есть с точки зрения как бы функционале связи между компонентами коммутатор в коммутаторе все как бы все обязана вокруг чипа то есть все сводится к чипу не процессору как сервер а именно чипу все работает для того чтобы запрограммирую правильно этот чип постепенно переходим непосредственно уже более глубокой деталей программе текстуре коммутатора хочу рассказать какие есть основные виды операционных систем которые встречаются вообще в коммутаторах и их основные компоненты различия традиционными операционка me для коммутаторов закрытые в текстуре там понятно то есть есть закрытые железо которая не как отдельно не программируется . но как blackbox ничего не сделать из операционка которая встроена в это железо есть закрытое приложение примеры там cisco jumper классический сетевой рендер есть коммерческие операционной системы которые работают поверх открытого железа зачастую являются закрытыми то есть програмное они все-таки закрыты там hydronic может быть там как проприетарной или внутренние компоненты для связи чипом проприетарной но приложения могут быть как с открытые так и открыты например вот есть cumulus до который использует смогу для в качестве protocols т.к. но в том числе имеет такие тачки закрытой компоненты внутри есть полностью открыт и операционки условно опять же которых открыты и железо открыт операционка открытый софт то есть это тот же sonic это окон свечи это обычный linux примером но не все так просто и можно углубиться еще дальше и все-таки понять что же такое сетевые приложения сетевые приложения делятся на несколько различных как бы категорий 1 это протокол стека которым я уже говорил но собственно основной основа protocols т.к. это базовые функции коммутации мушки за цель это bridging это spanning tree и это динамической можете зация в бюджете и так далее то есть задача protocols т.к. собрать внутренние таблицы корректно правильно чтобы потом их можно было запрограммировать на есть еще некий такой некая прослойка между протокол стеком и непосредственно железом который называется форме форме legend то есть это некий медово который стоит сидит между протокол стеком и чипом и он программирует этих на основании вот сформированных форме таблиц и спартак лс т.к. зачем он нужен ну потому что разные сети имеют разную архитектуру того чтобы ввести уровень абстракции уж там в рамках соответственно конкретных таблицы потому что одно чипа могут быть одни интерфейс программирования у другого другие различные детали реализации аппаратные таблиц ну соответственно прямую и spartacus т.к. зачастую невозможно просто взять и за охладить выбросить эту таблицу поэтому использую for managing реализует специфичные пьянь конкретного чипа и это 35 как бы для каждого чипа зачастую он свой если это чип профком это платком не пили из детей можно назвать колонок это белок из детей и так далее но для того чтобы иметь возможность абстрагироваться от железа сделать некий hal уровень есть такие прослойки для абстракции надо опять же венгерским языке 10 say it a switch abstraction то фейс есть там об она носила broadcom и есть ну целый ряд таких прослойка которые ставятся поверх из детей и позволяют там агенту не беспокоиться о том какой то внизу чипы все все за него это соответственно все преобразования происходят выглядит примерно так что протокол стек выгружает свой таблицы форме агент форме агент можно с помощью с дикки обращаться напрямую в чип или через абстрактный 5 сначала обращаться к саи например о том как дикие бомжи почему такая вот последствия здесь но еще хочу заметить что в большинстве случаев в качестве ядра операционной системы сетевой операционки используются linux стандартный лину с какими-то либо стандарт на него с минимальными переделками и если брать архитектура вот эту и переводите на реальный реализации в том же кума лось или в других операционках то получается следующая картина сюда еще добавляется такая небольшая прослойка который является по сути операционкой linux то есть вот это все слева это юзер space это какие-то там открыты или проприетарные просто приложение которое кроется use спейси и делает киц свои вещи программируют чип там параллельно вот но тем не менее так кота linux у linux есть свой стек достаточно хороший уже давно как бы опробованный сетевой стек у которого тоже есть внутренний таблицы таблицы коммутации ешьте зации вот и архитектуры выглядит основном следующим образом что протокол стек приложение сначала формирует внутренний таблицы ядра linux с помощью над линком протокола формирует таблицы коммутации можете зации там а это фильтр тисе и так далее а дальше уже фоне агент по сути ловит is not link сообщений изменения стилус т.к. linux и дальше их транслирует вниз то есть получается такой некий костыль то есть мы идем не напрямую через linux да и вч и пойдем сначала в ядро формируем таблицы ядра потом из ядра вытаскиваем эти таблицы соответственно визир space обратно и программируем уже чип то есть вот вот такая реализация это девяносто девять процентов соответственно операционных систем для buy боксов так реализован стоит вопрос ответ на зачем нужна вообще вот это все если есть linux с точки зрения компонентов это выглядит так то с традиционной операционки там понятно ядро закрытая внутри есть закрытый некий бинарник драйвер achi по есть форум для гент который тоже закрыт внутри него есть дикий и протокол стык закрыты коммерческие сетевые операционки на базе linux ядро становится открытым драйвер внутри ядра который нужен для программе нынче по все еще закрыт потому что он часть венди райт и собственность орбитальная вендора пользователей чипа агент закрытая штука внутри опять же из детей закрытый но protocols так открыто тоже клава и в открытых операционках например в том же сонике открывается почти все но тем не менее остаются закрытыми вот эти важные части этой виндовский из детей и сами драйвера чипа то есть получается что несмотря на то что мы называем операционки открытыми у нас низкая не использует linux то у нас верну остается как бы закрытые компоненты виде каких-то бинарник of которых непонятно что происходит их нельзя riverside по условиям соглашений там лицензионных и так далее но и это как бы самое узкое место с точки зрения доверия с точки зрения там потенциальных проблем соответственно этот вопрос почему будут это все эту сложную штуку форм лина агентом закрытыми предпо летальными с дикими с драйверами не привести какому-то полностью открытому открытой архитектуре и по максимуму задействовать уже готовые функции linux и мы приходим к следующей модели когда форме агент или ядра linux по сути сливаются и вместо этого агента отдельного мы используем обычный сетевой стек linux который уже есть он уже готов он полностью открыт этот стек во-первых давай поверх него работает стандартный протокол stricken визир спейси квагга bird любые там софт и маршрутизации или это linux брить может быть для л2 и по над ленку стандартному протоколу сетевом внутри ядра linux сообщить соответственно формирует внутренний таблицы стакан и все что нам нужно это получить некий драйвер соответственно который позволяет может забрать сформированы уже в линуксе промежут и таблицы и прошить их напрямую в чип и это драйвера сесть на нужен где открыт то есть по факту мы приходим к тому что нам нужно что-то вроде драйвер сетевой карты которые уже есть во всех для всех известных сетевых карт есть драйвер открытый в линуксе и он может спокойно поле совсем функция у нас всего 5 то же самое нам нужен нужно для чипа и в этой концепции получается что с точки зрения софта полностью исчезнут проприетарные компоненты соответственно такое уже в линуксе пытались делать достаточно давно есть три проекта которые какими-то различными образами соответственно реализуют возможности programmer на сетевых чипов напрямую из ядра linux первый проект всем известны наверно это папин врт софт для домашних роутеров что он делает он умеет программировать чипы домашних роутеров от версии было кроме реал таки вот и слинг это все это тоже open source но тем не менее он не совсем стандартно реализует функционал то есть для каждого порта этого коммутатора двинуться не появляется отдельных интерфейсах есть это некий такой easier space на агент который вот себя внутри описывают конфигурация дальше и и с помощью там интерфейса программируют сам linux fi не знает о том что есть какие интерфейс и есть какой-то чип всех скоростной ну и по этой причине он и не принят в up stream то есть он развивается отдельно для маленьких домашних ораторов в альфа и можете завтра где-то с версии 26 появилась следующая текстура внутри ядра linux уже десай дистрибьютор свеча ты типчик соответственно компания marvel разработала ее закон трибетил а вот эту как бы архитектуру для того чтобы управлять ну тоже чипами домашних роутеров небольшие там 100 мегабит гигабит на там 5 10 портов условно здесь уже гораздо бы стандартно с возу мы пошли каждый порт такого коммутатора это отдельно девайс то есть отдельный интерфейс там идти речь 1234 хлопец и едва функционал нативно то есть если вы эти порты в бридж добавляете в линуксе то есть bridge начинает коммутировать вот но эта вещь она как бы не такая гибкая не позвал на допустим ли я 3 функционал там до сих пор нет там не говоря уже о каких-то более сложных вещах которые появляются в коммутаторах чуть выше уровня от это центров особенно для домашней чипов это еще бы сойдет и вот начиная с версии нидра 44 полностью переработана концепция вообще сама идея программирования по из linux и появилась инфраструктура в первую очередь это модель драйверов катар называется свечи tf в составе ядра linux это именно модель это не конкретный драйвер которая реализует на приеме примитивы порты bridging роутинг access-list и туннеле то есть абстрактно и уже в рамках switch d.va есть драйвера которые эти примитивы конкретно рисует на железе соответственно в качестве драйверов например есть чип high-end коммутаторов mellanox и прекрасно работает со switch-ем соответствие сейчас это основной фокус разработке тем более что детей в этой концепции стал одними лишь driver 1 одним из драйверов съедал собственно что такое switch д всем сбил эта модель драйверов это в первую инфраструктура для do to play no flow до сетевого стека linux в аппаратный чем то есть она реализует базы примитивы как представление интерфейса в качестве на девайс то есть если у вас там тридцать два порта 100 гигабит на коммутаторе to switch df вам создать тридцать два порта в линуксе эти порты можно получать их состояние соответственно альта функционал поддерживается или три функционал access-list и и так далее какие драйвер сейчас есть есть наш драйвер который мы сами разрабатываем рамках этой инфраструктуры и он полностью контрастность он разрабатывается в об стриме называется ему xsw есть десай тесей такой тоже уровня абстракции но на реализует функционал switch дева для чипов сахара утра фан broadcom marvel и и других производителей лавин чипов есть драйвер для из аравии если ну и сарове эта технология позволяет сетевую карту разбить на несколько всей функции вот и каждую функцию можно назначить отдельно в каждую виртуальную машину и свечи трафик между виртуальными машинами не процессоре не в программном свечение а уже в аппаратной освещена кистевой карт вот с помощью switch до его можно собственный сервис настраивать как обычный linux порты бриджит их крутить и так далее есть виртуальный драйвер на котором свечах собственно тестировался и опробовал сессию функция называется рокер как выглядит of текстура linux коммутатором на switch да в принципе все очень просто есть железо white box и есть ядро linux которое собственно управлять им железо внутри ядра и сетевой стек стандартный без изменений и есть driver thd связав отвечает за о float состоянии стива стыка в железо соответственно поверх ядра можно использовать абсолютно любую дистрибутив вот хоть fedora red hat ubuntu debian altlinux неважно и использовать любой стандартный сетевой в стек или сетевые приложения которые уже есть в линуксе они будут работать главное чтобы они сформировали таблицы внутри ядра то есть и такого роберт это приятная утенка панова свечи то есть все что может работать still i'm стоякам linux все будет поддерживаться и аппарат на собственный пару слов о нашем драйвере я говорил наш драйвер это не то есть это не часть как бы это не switchback сам по себе это просто один из драйверов внутри инфраструктура стандарт то есть switch df разрабатывается сообществом наш драйвер разрабатывать нашими как бы идея такая что каждый производитель чипов собственно ручно разрабатывает свои драйвера также как сетевыми картами то есть каждый призовите льстивый карт будь то мы intel там logic неважно кто разработать свои драйвера то же самое с чипами соответственно драйвер уже есть в ядре можно включить подключить его в качестве модуля по умолчанию кстати включен представляет каждый под как отдельности в интерфейс и поддержит коммутацию бондин квиланы можете зации фильтрации так далее областной базовый функционал уже есть он работает охладиться на скорости сетевых интерфейсов по сути он выгружает состояние сети linux в чип как можно охарактеризовать то что он делает и трафик уже после этого идет не через процессор медленно а через чип текущий функционал который есть в этом драйвере это два функционал бриджем banning вела нас тпл дебита все что нужно принципе для обычного как бы l2 свеча в дата-центре фильтре функционал а пиво четыре пива 6 можете зация мультика сможете зации 7 перерыв игры туннеля любой лр300 который работает в линуксе можете зацепа политикам access-list и с помощью linux тисе слова классификатора поддержка об inflow опять же через access-list и сопин вас и чём и все необходимые фичи которые управляют там светодиод моргает правильно в коммутаторе управляет его или как питанием это все уже если мы какие-то специфичные сетевые вещи например сплит портов breakout коз управление буферами внутренними и там зеркальная трафика соответственно дистрибутивы любой дистрибутив с ядром желательно 48 стаж это все будет работать нативно протокол стек принципе любой мы протестировали все это сбер дома фаррар зорб кубик за бюджет и то есть квагга конечно же то есть все то что есть сейчас на приятности все работает ну и какие другие вещи например там вместе пить демона hype демон верфи демон это тоже все работает рамках там дополнительно функционал сетевого стека идея интересная но вопрос наверное стоит к той же этим пользуется в первую очередь по опыту это те кто хочет сэкономить самое главное и не боится самого linux что что самое главное тоже и немножко хокинг а потому что некоторые вещи все таки они специфичны и требуют небольшой доработки или тем кому нужна своей сетевая операционная система с минимум каких-то затрат на доработку то есть если вы какой то заказчик крупные вам нужно действительно свой сетевой пакет своим функционалом на базе этого можно очень быстро сделать свой дистрибутив соответственно люди которым нужны простые и доверенные среды с минимальным функционалом то есть например ну известно что чем меньше кода тем меньше багов тем меньше ненужных fitch тем меньше багов если заказчику нужен такого r2 простейший кому thirty snow park в другой зачем ему вообще все остальное можно это все вырезать в том числе из ядра и тогда решение станет надежнее нас есть заказчик финансовой компании крупных из которая так и делает у них критическая инфраструктура это high-frequency трейдинг для биржевых брокеров а там любая любое падение любая задержка это сразу же попадание на миллионы долларов поэтому они используют это решение первую очередь из-за того что она прозрачна открыто то есть они знают где конкретно что может произойти если произошло они могут сами это поправить ученик какую-то короткого времени мы конечно же гос сектор и оборонка там где особенно сейчас россии нужна полная прозрачность для сертификации там и других порции внутри них это тоже оценит там где интересные инфраструктуры с linux and went as linux везде на свечах на серверах виртуалка х нас родах то есть важная единственной фра структуры единстве операционной системы функционал стандартного r2 и r3 и что немаловажно интеграция с devops для автоматизации соответственно это могут быть киты клауд компании публичный приватный или тыл к компании сидел провайдеры и так далее и еще интересные заказчики тоже академии университеты которые те кто любит экспериментировать у нас есть один заказчик в израиле это университет большой который используют это для исследования в области новых сетевых протоколов то палагин то есть очень удобно заново например можно переписать сетевой стек тем ишь какие то вещи поэкспериментировать например сегмент роутинг балансировку нагрузки стен так это всего пан source можно менять практических и штуку ну еще немножко нюансов касательно того что открытый linux это все-таки это круто но это не сетевой операционной системы из коробки какие нюансы могут быть первое все-таки это нужно немножко будет доработать напильником если вы используете действительно открытый linux типа ubuntu то есть во первых нужно выбрать протокол стек нужно понять как вы будете управлять таким switch-ем через шоу либо через файлы конфигурации либо как ты через еще какие то вещи писать свой силой как вы будете это мониторить но многие кстати пользуются стандартными там забег сам например очень удобно также есть такая вещь коммутаторах который называется загрузчиком в отличие от серверов которые чаще всего развивается через пикси свечи все-таки разливается немножко другим загрузчиком это они и нужно важно чтобы дистрибутив на базе которого это все собирается имел возможность создать на базе него они загрузчик например есть уже готовые образы для ubuntu fedora ну это несложно сделать как будет управляться сама шоссе коммутатора но большинстве случаев вопрос как бы решается автоматически с вич доме уже есть функционал но тем ни менее какие-то вещи например если вам нужно чтобы светодиодами далее немножко по-другому или там управления вентиляторами велось соответственно немножко по другому там чтобы сэкономить энергию тоже нужно понимать это можно все тюнить механизм обновления как вы хотите обновляться классическое обновление свечей это скачать новый образ и сделать там системам great репутация и загрузиться с линуксом проблематично чаще всего это об это гетто апгрейда и вперед то есть это не атомарная такое обновление тоже принципе решаемым ну этот функционал который актуален в первую очередь для сетей нежели для цодов это конечно же силой кому-то это нужно кому то нет различные пиа и типа над конфа функционал специфические типы малого например когда номер два можно поставить 2 железки чтобы балансировать трафик между ними и отказоустойчивость но весло над flow это тоже нужно заранее предусмотреть как это будет реализовано потому что савичев реализует базовые функции linux в steam стыке какие дополнительные нужно выполнить реализации но тем не менее для 90 процентов функционала уже есть open source реализация в пакетах готовых ну и 10 процентов можно разработать самим в итоге собственно что мы имеем на данный момент с решениями на базе открытого на базе от открытого исходного кода и вообще с открытыми системами решений в первую очередь эта модель white box собственный видит является ключом из агрегации открытости сетей экосистему момент него сформировалась это действительно многомиллиардная система железом со в том приложениями в рамках up in networking открытые решение набирают набирает популярность собственно все крупнейшие веб-компании уже стараются собственной операционки для сетевых сетевых устройств формировать и использовать ну и linux собственно является основой большинства открытых операционок для white box свечей то есть но тем не менее это не исключает некоторых случаях наличие закрытых компонентов например из детей компоненты ли драйвера чипов и switch df связка switch дева linux white box это именно то что позволяет полностью отказаться от про при толщины в совке для коммутатора создатель pan source коммутатор и при этом хайн сеть построен на базе open source коммутатор это уже реально вот и функционирует уже используется продакшн и подтверждение своих слов я бы хотел передать слово моему коллеге дмитрию чтобы он рассказал про конкретный кейс который был реализован на базе спасибо александр здравствуйте коллеги я тут представляют не вендора поэтому мне можно избежать к я работаю в компании яндекс это сидел-сидел по сути эта инфраструктура обеспечивающих доставку контента которая делать это эффективно быстро на далее для чего он вообще нужен расскажу буквально пару слов если вдруг ты не знаком для того чтобы подвести собственно говоря к нашим задачам по коммутатором но в первую очередь для заказчиков для медиаресурсов которым необходимо давать большое количество трафика в основном это видео он-лайн вещание чаще всего необходимо доставлять это видео до конечных пользователей на очень высоких скоростях это будет очень большая объема трафика на крупных спортивных событиях полоса может достигать только вот по россии от 1 заказчика почти то рабита мы такие цифры видели ну естественно в мировых масштабах гораздо больше соответственно диссидент позволяет собирать это видео эти потоки данных заказчика в один поток и дальше масштабирует раздавать конечно пользователь для владельцев веб-ресурсов сидел кроме такого возможности масштабе трафика обеспечивает возможность масштабирования собственной инфраструктуры в том числе по вычислить им ресурсам потому что ген позволяет закодировать распределена статический контент сайтов соответственно давать его эффективный с кашей с ближайшей точке к пользователям соответственно эти запрос не падают на инфраструктуру заказчика не создает нагрузку и при этом при всем отдается в ближайший для пользователя точки поэтому дается очень быстро единственный способ это обеспечить это раздавать с распределенной инфраструктуры и на самом деле есть польза даже для не каширу ему контента потому что за счет такого то распределенной сети можно обеспечить экономию на уровне тисе пи за счет игры скан женщин винду и различными копами на большое расстояние осуществляется доставка без потерь а последней мили до пользователя там собственный маленький ртт поэтому в общем потери не так страшны ну и на самом деле сидит так как является фронтенда для веб ресурс у заказчика может обеспечивать тоже целый ряд дополнительных интересных фишек эти как с целью of lading а защита от ddos валидация пользователь много всего интересного но это просидел мы сейчас постепенно подходим к сети сопли для того что обеспечить такой необходим функционально уровне сидел-сидел должна быть масштабируемой горизонтально масштабируем распределенной структуры потому что пики трафика который падает населен они могут а на порядки превышать обычную загрузку к счастью а крупных событиях обычно известно заранее чемпионат мира по хоккею новый год поэтому к этому можно подготовиться но тем не менее вам нужно иметь огромный запас мощности поэтому единственный способ это обеспечит это иметь распределён инфраструктур в одном соде как показала практика получить энное количество случай гигабит нереально да можно 9 в каком-нить аяксе получить неплохие объема трафика и тюмени конкретный оператор в конкретную соде ну 10 без проблем габит м40 кто то отдаст кто-то не отдаст а вот если тебе нужно сотка то это уже нужно поискать этом уже в большой проблемой поэтому распределенных структур нас спасает какая специфика у сидена расскажу про структуру может построить по-разному можно построить большое количество маленьких узлов выглядит привлекательно ставим каждому оператору в каждый город нам по серверу достаточно на сервер будет все трафик отдается ближайший точек пользователям но на этом месте мы теряем всю эффективность каширования потому что хочется же отдавать из каша из ближайшей точке а если мы каждый видеофайл положим на каждый серы в каждом городе на этом либо разоримся либо не сможем себе позволить другой альтернативы который напрашивается которая в принципе для большинства вариантов с раздачи видео работает это сделать несколько дать мега узлов поставить их в москве если россия на крупных . обмена трафика подключить туда толстый канала от операторов и раздавать всю из этих точек будет все замечательно кашира ваться но возникает другие проблемы а попробую найти дайте объем утра такие порты об этой проблеме уже обозначил и б случае отказа мы теряем сразу заметно часики поэтому для себя мы нашли такой как промежуточный вариант это десятки узлов по россии1 узла более крупной какие-то мелкие в москве более крупная хабаровске помельче например но тем не менее и на каждом узле выключаемся к нескольким оператором если есть какой-нибудь x или несколько это самый крупный томас kx есть целый ряд это здорово это хорошо но тем не менее один узел это один крупный оператор и совместно с этого узла идет раздачи в сеть этого оператора в основном туда подключаться могут другие еще оператор но это дополнительно дополнительно соответственно для того чтобы построить сидел нам приходится решить 3 задачи во первых это как разместить и как подключить эти узлы обеспечить им нужно учить его инфраструктуру б каким образом сделать чтобы контент через вот такую конструкцию доставлялся не хуже не медленнее чем он доставляется напрямую потому что те то лишнее промежуточные узлы и элементы и они не всегда kosher уют и третий момент это как обеспечить правильную балансировку запросов по всем этим узлам это просидел из этого всего у нас вытекает несколько требований к нашему steam оборудованы котором использован для расширений узлов расширению и в контексте увеличение мощностей существующих узлов и установки новых узлов в во первых конечно же мы хотим не плодить кучу оборудование поэтому мы хотим возможность иметь одну железку куда мы подключим нужно количество серверов не пугайтесь цифр то что написано 10 или 40 мегабит 10 сироп на ваш сервер они разные бывают и для хранения для раздачи такие требования на каких-то узлах их меньшее количество может быть оборудование с меньшим количеством портов но тем не менее но коммутатор с 10 гбит на порты мы берем давно откуда появилось желание брать сотки на самом деле с учетом того что сотки мало кто дает пришло время на их переходить потому что на самом на крупных узлах иметь сотку оказывается выгоднее по этим причинам во первых десятками больше 80-ти просто не вырастишь канал из арсенала может поднять только с 8 портами стандартном варианте во вторых в частицы о дав стоимость караси ровки она не 0 боль того приходится за каждое волокно платить каждый месяц соответственно если это 80 значит это в лучшем случае восемь волокон а может быть и 16 и если с той стороны не готова поставить на волоконный модулю я в общем эта цифра ежемесячных платежей достаточно быстро окупается остаточный порт который сейчас становится на самом деле он дешевле дешевле поэтому сотки дальше так как это оборудование которое бы является таким узла образующим то она должна быть не только коммутатором у нас будет маршрутизатор у нас своя автономная система поэтому соответственно для взаимодействия с соседями нам необходимо бежать диджипик если так задуматься для того чтобы держать бюджет и с этими операторами хорошим для нормального распределен трафика нужно от них получать fool you без дорогущему 6 завтра никак не обойтись потому что сейчас вы уже более 600 тысяч префиксов прилетает соответственно кажется это попадало просто но у нас есть особенность так как мы пошли по принципу что мы ставим узел в первую очередь для раздачи в сети конкретного оператора и аяксе поэтому нам нет необходимости от каждого оператор принимать full над всех операторов принимаем их префиксы и певицы клиентов ассеты обычно это ну если небольшой оператор это могут быть сотни припять если крупные ну может быть 15 условно говоря тысяч префиксов если это aix ну а tikes а может быть там 50 60 тысяч префикса прилетать и то это уже не фатально а соответственно просто для хождения в интернет дефолт мы используем одного из оператора ну му-му-му-му-му может быть несколько в порядке приоритета это позволяет нам ограничиться цифры порядка сотни тысяч префиксов v for vendetta bass и на этом месте можем использовать и 3 коммутатор очень заманчиво до приходится выбирать какой конкретно барона использовать потому что недорогие литре коммутатора они могут поддерживать только не несколько тысяч маршрутов фиби зависит того как у них что реализовано может тебе за такое может быть отдельная память но тем ни менее ну вот есть варианты в частности решение на чипе аспектом от коллег который позволил нам таким образом расширить возможно наших узлов то что мы стояли перед этим у одержал максим 64 qam маршрутов ну и собственно говоря это уже позволяет нам потратили очень много денег на оборудование и расширяться таким способом так куда куда направлять надо все увидел по 1 я руками справлюсь мест откуда взялась мы справа atbox ну во первых а почему бы нет это коммутатор удовлетворяет нашим требованиям в этом мы очень любим вообщем открыто решение открыты платформа открыто программное обеспечение весь силен нас построен практически пол есть отдельный момент данного львиная доля программ общей которые использует открытая программное обеспечение вообще вот мы любим говорить о том что сидел это не какое-то как сложная технология не рокет сайенс но это огромное количество открытых известные технологии которые связаны достаточно сложной логической цепочке которому научились готовить и мы стараемся придерживаться это же идеи в эту когда мы поняли что с коммутатором можно также для того чтобы инженеры не разбирали специфики конкретности оборудовать собственный путь почему бы нет и попробовали ну про сетевой операционки коллег уже рассказал не буду этом останавливаться очень заманчиво было одним и тем же способом управлять серверами свечами ночи любви шеф соответственно хотелось попробовать пойти по этой же схеме мониторим мы что-то забег сам что-то своей системой roott вредно мониторинга тоже очень хотел все это применить ну вроде бы канзаши попробовать стали смотри какие есть варианты по железу из того что было доступно в россии не так много всего и при этом выбор сужался по возможным поставщиков по возможности пообщаться в живую живыми людьми поэтому де-факто единственный вариант оказался это мило нокс воли того когда мы стали только с ней общаться у них спектр был анонсирован еще физически его не было в россии здесь и в итоге бы они вы привезли нам одним из первых мы все это пощупали нам понравилась она взлетела ну и как дополнительная плюшка в беларуси есть part and 25 гигабит который пасу реализован также как десятки ты можешь получить почти задаром вместе 10 25 до нужно конечно силу карточку и даже мишка посмотрели cumulus работает но а мы ничего ручками не ставим соответственно нужно пикетировать свой софт там своя система пакетов неудобно во вторых посмотрели на цену цена осуществлялся собрали помню тысячами долларов в общем подумали они идея с ubuntu нам нравится попробуем и поставили ubuntu ubuntu по что поставить 16 в тот момент вы переходили 14 на 116 с ядром 4 тогда было меньше на 410 завелась заработала у нас все получилось да удобно хорошо настроили замечательным три недели погоняли все это все решили покупаем пробуем и сейчас железку уже где-то год стоит в бою реальный трафик на ней сейчас достигал наверно чем меньше 80 гигабит просто потому что мы поставили не нам в саму ключевую точку краску это был пилот это был эксперимент на е работает квагга обычно стандартно типовая квагга всем привычной в форме дтп с выгружается вот на момент рисования презентации посмотрел 71 к маршрутов естественно на вход в джипе поступает гораздо больше держим порядка 10 г pc 7 все работает да есть момент есть нюансы во первых это не сервер хотя кажется привычным сервером сказать аппаратное ограничение всплывают такие приколы как например шиты аппаратно ограничений на то что первые 30 с чем-то него он точно бит mac-адрес интерфейса они одинаково у всех интерфейсов соответственно мы поменяли на одном интерфейсе mac-адрес раз он изменился на других причем причем не полностью это было конечно сюрприз но потом выяснилось что снимок таффи чибана документирована ну просто вот такая вот необычная вещь да не все поддерживается в open source варианте настолько хорошо как она подержит коммерчески реализациях тем более в рисунках производителя например статистику повела интерфейсом даже в 410 снятию невозможно было это уже реализовано в следующих кадрах следующих версиях но все равно идет развитие постепенно постоянное развитие есть такие моменты как например необходимость последовательно конфигурирование сетевых элементов постоянность обязательно сначала нужно полностью сформировать бонд потом его только добавлять bridge и если ты этого не сделаешь то потом может не произойти а флот каких-то вещей васик но на самом деле эти вещи не являются чем-то вот таким прям сильно негативно это особенности конкретного решение с которым нужно быть знаком с которым можно жить поэтому что могу сказать в бою она работает если какие-то моменты и всплывает та в процессе реконфигурации просто потому что к сожалению табу для нас еще даже за год не окончательно изучено но в целом мы довольны будем брать будем пользоваться на внешность и месяцев мы закупили еще штук этих коммутатор более 700 гигабит собираемся на их подключить в ближайшие несколько месяцев не только только внешних подключений мы собираемся расширять используем функционал частности вот обещанные коллегами тессео float и прочие вкусные плюшки так что коллеги не могу сказать что это полностью вот такого прям enterprise решение но она работает она развивается в мы довольны спасибо"
}