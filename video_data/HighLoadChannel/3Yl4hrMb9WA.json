{
  "video_id": "3Yl4hrMb9WA",
  "channel": "HighLoadChannel",
  "title": "Шардинг в MongoDB / Henrik Ingo (MongoDB)",
  "views": 4136,
  "duration": 2847,
  "published": "2017-04-22T14:47:44-07:00",
  "text": "выбор только волчары клинка ставка по кассовой нового так и теперь мы поговорим про шар зону мешало шатенка это решение которое позволяет осуществить назад альной масштабирования мы говорили на тогда масштабе одеваться там нет а заодно шоу и войска нужно пользоваться необходимо создавать собственные инфраструктуры шан-цунга к некоторой компании создают внутренние вещи для этого у нас это встроенная wwan горизонтальное масштабирование по сути своей означает следующее традиционно когда речь идет о базах данных масштабировать базы данных легче купить 10 веб-серверов установить apache там electronic sports филатова 100 сенаторов и вы можете здесь градуса больше обрабатывать и все тебе запрос чем садимся как правило стать как мы это называем и соответственно таким образом пресекать лоббирование одной простой причине что вам сервер или applique сжать он сохраняет состояние пассата на сервер может все забывать за время но база данных ты должна его вспомнить именно поэтому масштабировать база данных сложнее поддерживать передано по сатаны и сложнее потому что вы не можете быть просто забывать сенсационным метод который мы используя ваш белый shopping вообще база данных русские они как раз и да точно нарушение было беды и проблемы высокими масштабными исторически подходит состоял не быть за нами масштабирование а в покупке более покрова сервера один из первых проектов когда мы сделались носки он был ш газеты в германии у них там было 36 что ли процессор в общем это было много и они вы заметили она майский аластер надо почти как в общем маска а сегодня это довольно распространенный подход и умело того что покупать все больше и больше и больше использовать именно такое шокированный кластер и за счет этого увеличить производительность надеяться что вместе производительности на один когда вы за а каковы же уровнем он к тебе sharding по сути означает позиционирование создание партизан в америке придумали слово sharding кстати такой шар кстати это вот когда большую каменюку вот если долбануть матку и отколется кусочку это шар данных могза него берется данных на душе за лаги для шансов необходимо выбрать один из этих слушала которой они становятся так называемом шапки если в реляционных данных воспользоваться позиционирование происходит примерно то же в этом кие у вас есть пространство значения от минус бесконечность до нуля то положительных значений до бесконечности случае с манга дибирова вас типа не и вас просто там все струне голосовать нам порядке и данные бинарные типы и все это вместе в одном пространстве значение и для того чтобы осуществить подвижник вы разделяете это пространство на небольшие диапазона и мы их называем танками и шар до одного сервера назвал это не тоже самое что 3 партиции может быть и то же самое но здесь для внутреннюю так скромно требуются для нас шапки пространство разбивается на слово несколько более мелких вал танков по умолчанию размер которого составляет от 4 мегабайта гиганта воды а затем он крепим автоматически возлагали молдаванин его нужно ходит границы этих чанков а затем автоматически начинает их сервисе затерло сначала все наши аргентину потом болеть и пустую там появляется шанс мозга тебе замечает что они оптимально распределяет данных мне нужно половину данных такой бились душат им он же теперь будет автоматически стремится к выравниванию ему данных на каждом шагу иногда кстати в этом не заинтересованы вы можете устанавливать собственные правила но если действия все по умолчанию то данные будут равномерно слоняться по всем шагам здесь вы видите запросов каире rutor избавиться для того чтобы обеспечить единую жрачку соединение прокси который отвечает за знание таблицы партиции и если вам допустим запросить пользовательский профиль пользователя хендрик все профили от а скажем то аж этот на единички и ангар с запросов было я про неё не знаете что эти дамы можно найти на шахте один туда-то я пожалуй запросы отправлен и соответственно ему вернется информации также проводит процесс балансирования которые балансируют объем данных между шар а чтобы у разработчика тратилось минут минимум сил вы не заметите разницы между ведь не даже замечательность между одним сервером начинаться с двух шагов во-первых добавить сервер и нужно жан шарден выбежала а затем необходимо сортировать коалиции по одним а связано это с тем что музыка теперь не знают автоматически начать переживать данных вы должны указать важно правильно вызвать жарким можно иногда ади использовать в качестве желтки но из исходить звонов из автоматических реализацию над ним и поэтому нужно сначала подумать потом сделать когда с мангой работа очень важна целом для понятного жизни манга тебе позволяется становитесь из который был дан но сетевые структуры данных не нужно специфицировать схему зло если что то не так можно потом поменять она очень такая же быстро реагирующим позволяет вложений на потом желать но решить а какой использовать шарли нужно за заранее до того как приступать к sharding теперь давайте посмотрим будем на архитектуру хорошо бы понять кир очки с которыми строится вот добегалась сегодня мы не так уж много говорили о реплицирования естественно кирпичики состоят том что вы начинаете давай сервера потом загружаете на laptop и проводить там раз там видишь там разработку когда выступает сам производства всем нужна высокая доступность и место единичного сизо у вас набор гривни к мисс 3 из 3 или более означает изначальные данные нас мастере которые копируются на шлейф жар они в мозгу называется праймериз ip-адрес отец порционирования у каждого шарда отдельный набор в этом бесплатно и чем лучше копии от реплики и каждый шар дав он управляет своим кусочка данных зон в dota был когда речь идет о dash может так получиться что 1 шард 1 шард но приятно скорее всего 1 шард это один намуль копий реплика когда вы вставляете желтом как он обращается мастер но будет и негабаритных ждала когда речь идет hd у вас может быть и такая ситуация зовут организовать что это означает строительные кирпичики это единичный сервис плюс еще внутри котла и один набор и прощение это один и вас таких реплик несколько для каждого помимо прокси запросов можно есть еще нас такая штука называется это фактически тоже стакана граница не раз она хранились регулирующие данные допустим таблица портишь младенцы это вот как раз у границ от лазера в целях большей доступности у вас может потребоваться религиозного алексей skype и манга я сам процесс и они разбивают допустим начинки информация сохраняется сердце у некоторых пользователей много допустим на каждом сервере приложений у вас может быть воронка с это может давать лучше производительность кстати давайте рассмотрим пример чартерного кастерам исчезала из этого что но начну я с комментарии для начала вам нужен компьютер и это такое место где хранятся все данные в кластере поэтому это нужно воды вместо обычный процесс гонка дик но начинайте высота сша конфиг we are не тогда сервер запустится в режиме конфиг сердцем индийских при этом он будет использовать еще другой порт видите он так приводится ford по молчания между затем он просто запускаете один процессом мой офис маршрутизации запросов магазин когда администрируйте кластер майка теперь вы должны соединиться с молодец он все комментарии жирного кластера исполняются на ну вот доходя до этого пункта начиная с этого плато же можем добавлять важный параметр который нам необходимо знать начиная работу с как соединять с кан фиксируем потому что их может быть не один как вот здесь нарисована а это серийный интерес большей доступности и обратите внимание тут конфиг baby для каждого мундуса нужно указать конфиг сервер чтобы они поняли куда ему прощаться затем мы запускаем процесс базы данных и один набор копии реплика сета и данном случае можно проигнорировать внимание на что чтобы использовал или оригинал вы можно использовать даже shard сервер который тоже будет использовать позицию по дефолту вас на газ по заднице если все этого делать . несколько процессов на одном и том же сервере будет использовать стандартный опорный а всем остальным нужно значится отдельный порт они будут использовать руки ну вот мы запустили манга тебе сервер по задано но он пока не соединен сказки для того чтобы добавить нужно осуществить вот такую команду id shorts добавить шалаву если у вас один сервер то вы используете 1 команда если это набор реплик и копий то мы используем это тоже ложатся соединение которое вы используете на контроль своим приложения была сессия имя и соответственно за новыми звезды ростов ничего тут особенного нет на чем добавить шахт это вот то что важно запомнить это такая команда которой вы должны помнить это очень старое переписывалась любой любой команды администрирование окин они с печалью это означает статус позволяет вам платье азарт от и вы видите как раз что результатом является то что к этому квартал господи не на 1 шард потом осуществляется аналогичным образом присоединения 2 и 3 шара и смысл горизонтального масштабирования вы можете действовать маленькими шажочками начнется с двух шагов я кстати еще вам рекомендую если уже обращайте шарден гу иметь более одного раввина есть некоторая вещь касаясь его разводить иль насти и масштабирование бывают ситуации когда запрос будет эффективным при единичном shortie но когда вас не используются два или три шарда а то вы можете и не добиться персонаж вам уж наверное поэтому лучше запланировать как минимум два шарда чтобы можно было проверить и где изменение производительности а потом в принципе можете пользоваться только одним шагом cialis тестирования сделать сначала 2 исходить нужно из того что другое приложение станет таким же популярным как долго обвязала чем прелесть горизонтального масштабирования не обязательно сразу начинает 63 там что маленькой компании понятное дело торговать начинаете в 3 шага и как сью suite что перегружается они снова за вы можете добавлять небольшими ручками где обитала по это же причина очень важно понять что в магазине очень просто добавить шаг 1 coletto все банда теперь начинает позировать профи блокирование данных чусовой данный нож от и означает что а нагрузка на нагрузка запросов будет также снижаться и это автоматически добавляет производительности вашему пластик мы добавили жадно но не добавили пока что обрабатываешь мы пока что сделали не опускались две команды 1 0 а собственно базы данных нужно запустить шопино позировать даже не знаю почему загружена с меня с моей точки зрения житель sky точки зрения не понят зачем-то нужно нужно делать лучше значит нужно активировать варды тормозя данных и для каждой коллекции данных нужно указать шапки и всем так все здесь такой же каско вы приобрели индекса это может быть одно поле позирование ки ошибки об этих ключах мы поговорим позднее есть такая же штука называется так это когда были правила задаете тому как осуществляется шагом потому что по умолчанию danner раскидывается равномерность а если вам нужно распределять данный не то используется таковые sharing например бизнес есть вас так интересно с процесс сноу например управление счет-фактуры системой прогони чудовищ вы получаете личную фактуру она активна в течение скажем 30 дней кто-то ее будет просматривать она будет слышать утверждение потом она будет оплачена заархивированы в течение пяти лет хотя конечно не по счету и некоторые используется такой принцип что свежий дома у нас хранятся на душе у меня желала у этого шансы появиться побольше такой вот высоко эффективным во всем но при этом на нем содержится всего один процент свежих в только что вошедшего и трубы шаг он где очень большие диски но они очень дешевые и большие где можно держать архивные данные течение пяти лет но эти данные вы практически не пойдешь еще один пример такого шарден га это когда политическим основанием или из-за производительности данные для разных пользователей базовом указываться в разных странах если я правильно понимаю в россии сейчас тоже обсуждение что данная для россии россия должна храниться в россии через такую законодатель китае такое радость в америке целях производительности есть смысл скажем если вы используете один шорт и там должны будут уродится данные американского чтобы ускорить обработку запросов соответственно американских и соответственно в сша за 100 миллисекунд обрабатывать запросы а вот между европой и азией можно до сих то есть видите какая разница 1 миллисекунда leatherman географическое расстояние это тоже очень важный фактор и самое важное некое место для мешающие достижения высокой производительности если вы хотите чтобы допустим все европейские пользователи были привязаны к одному шорты это можно сделать тоже самое грязи и для любого другого региона это действительно сгореть и делать это можно с помощью договор жажда например я сейчас показывает сводных снов механизм очень простой но позволяет работать тем не менее с того ли интересными а теперь давайте рассмотрим несколько примеров того как же лето работает поработала запрос интересовать вас могут три слова запросов первый из них целевые запросы которые на единичный ну или иногда на несколько шагов или фаз каторге это когда я тут посижу кастера но при этом должны разговаривать ну давайте стиле вам сначала разберемся по сути дела это означает следующее допустим мне нужно получить данные пользователя генри я использую кастильское ими в качестве шерлок легавые и вот когда поступает запрос у запросы есть значение которое можно ваш мотивировать на основание шапки в этом случае манга нет или так значит все 1 пользователя а до меня находится один вот сюда и направлять запрос шар даден нашел данные отправил обратно в manga с мангой с результат бриджит твои шар другого нет конечно не стал и в то же самое время эту систему используя другие позиции их данные будут пожар белого и шаге 3 собственно за счет этого и выбиваемся более высокой обязательности шаблон и потому что мы куклы получаем функционал параллельно а чтобы у нас нет зеленый запрос допустим мне нужно найти все пользователи живущих лесенке при этом нет такого шаткие как город проживания пользоваться в этом случае можно зажать почти то есть в этом случае по таблице нет информация по таблице по цене информация газели и ответ на этот запрос скорее всего распределен по рт нас есть на каждом квартиры буду пользователи живущие хельсинки поэтому совершенно понятно что мы с направляем все шары и все шарда отправляет ему отвесы ответ италия агрегировать с морозом и выдается виде единичного ответа но на каком-то шарды не будет пользоваться им все равно придется обнаружить то есть ресурсы она будет задействован а результат за лайки уже лежат вот кстати именно поэтому правильный выбор шарки целыми но такой важный момент сша вам нужно выбрать такой же объеме к раздоры присутствовал в запросах почти за чтобы чтобы в результате получилось что-то подобное так если ваше предложение все время будет работала с такими сад знак приезжают вы можно добавить 3 шард а то есть троица производительность но при этом у вас нагрузка будет является больше потому что фактически будет каждый шар c проделаю тоже работу что единичный шаг по этому добавить и может быть сколько угодно шар дав но на производительность это я вчера общался с человеком который добился все равно более высокой производительности но все равно результат был не но можно конечно эти объяснения почему это говорить но сейчас не об этом еще один пример я уже узнал что sharding был один из первых печи которым этапами лиц actor in a woman кдп было простенькое посадок одном добавляли новые филиалы и добавляли искать поверх чтобы они работали на единичном сервере и на острие это вещь не станет ребенка и поэтому мы это штука очень гордимся я и так вот мы получили сооружу идем его нужно направить на стяжала пещера а поскольку нам нужно чтобы результаты поняла эти роботы каждый шаг образом будут делать . подобных результатов если у вас есть правильно igr-100 они будут использовать ремонт и отделка не было построение иногда это хорошо иногда это нам слова краса нужно для некоторых типов запросов и это как раз то что нужно фрагментированный закрашен потому что один будет допустим нас отчетностью вопрос пользователя вал если вы делаете на одном сервере объем работы будет тот же только на одном сервере это будет дольше близнецы а здесь сложные шара работает параллельно с другими словами вы в 3 раза быстрее ответ получается что может служить и на границе зоны вот каждый шаг осуществлять сортировку и желтого мой результат отправлять манга из теперь манго и должен комбинировать результаты и оцифровать не так возможно потому что каждый сразу это же сам себе заздравный но тем не менее на самом направленная логика для кабинета и клиент получает результаты как если бы обратился все понятно пока как ну хорошо тогда у меня вот еще десять минут чтобы оставить время на вопросы решать проблему шатким вообще выбор правильного шостке это один из немногих случай мог бы тебе когда причина здесь в том что шапки он был английски называется то есть уже переделать раз шапки выбрали и уже дальше его и гляделась нужно будет совсем заданных нормальности makita поэтому такой вот он безоговорочно не такая уж большая проблема вот этого неизменность жалкие если вам нужно поменять шапки просто нужно удалить объект за новости его то есть с точки зрения банка теперь и так сложно это кстати час же бывает если вам нужно поменять знаки на мастере партиции должно нужно просто один утоли одни кто дарит новый объект создать потому что это собственно идентификатор объекта поэтому так вот шоттки нужно адаптировать логично он ограниченность в размере до 512 байт не джанан обычном меньше шаткий используются процесса мангой для маршрутизации запросов жарки вам нужен такой шапки который часто присутствуют запросу ты лазло последний пункт он может и не так важен во многих само число но тем ни менее манга тебе поддерживает уникальные индексы это такая вот у нас fitch которых нет на других базах помимо айди поля она тоже уникальна но так вот в этом случае вы используете шанс на уникальность не гарантирован возьму кострому потому что это было бы слишком уникальный индекс он физически расположена наша то есть фактически шарди раваном кластере невозможно уникальный индекс из этого следует что если у вас для записи с одним и тем же значением шапки тогда сооружались может быть за гарантированно за счет определенных усилий может произойти такая ситуация когда в разные шар данного изделия две записи с если произойдет все-таки столкновение то это не в ней ничего страшного не не смертельно если у вас два документа с одним и тем же здесь то может изучил вторгались просто мангас приостановится но может быть сегодня вам и будете обязательно но если вы с такой проблемы столкнуть в дальнейшем будете знать чем дело шапки нужно задуман дрищ его некоторых вещах он должен быть гр анализировать называем с хорошим настроением и значение и обязательно уникальное значение как газету чтобы было достаточно значит зывается множественность допустим у нас базы данных пользователя у нас есть информация от дома мужского пола типа совершенства логически мы можем разделить эти значение только на два набора значит это неудачный шарнирного нужно множественность отделения по половому признаку такой множественность состояние наших бордель данным и не смог jar а манга тебе про теломеры данных большинство чанков они должны быть относительно небольшие чтобы нормально работал процесс балансировки мы бы тебе шанс 50 гигабайт если ваш танк на же несколько пай не запустит его переносить между шагами дисков тяжело восприятия и если не удачно выбрать шапки днем ночью кто могут появиться такие гигантские чанки знаете по аналогии с а самолет имиджом бюджет манга теперь собственный только когда вы вставляете новые данные у не всегда единиц были высокие значения чем предыдущий если у вас данные допустим майский данные будут выходить в порядке америке если захотите это ставить манга теперь чтобы соответственно от меньшего больше сейчас мы вернемся в начало кей space ты space я это означает что у нас не все значения низкие слева большие справа привезла если каждая новая ставка большего значения наоборот liftago права и по умолчанию mondo di gi погулять фрагмент теперь одни поистине руются довольно то есть каждая ставка всегда будет падать последний час тогда программ заполняется он надо разбивается и балансируется но в момент доставки и даже если вас ждёт последний справа чанг окажется на единственным на как салата шахте вот вы купили 10 создали 10 шарджа а все записи идут на единственный желтый не добавляется производительность это просто взял и иметь ввиду когда выбирайте шерстки нужно иметь это в виду и потому что из-за этого поняла как будут распределяться запросы на чтение это предопределяет то каким образом будет идти у вас потом блокирование загрузки в этом смысле тоже очень важно правильно выбрать орске совы миша изоляция запросов адептами между таргетом и с котором оценка успешности так это поправимо всего расположение индексы если у вас запрос по диапазону ожидайте умножить на значение sharp чанг это тоже я пожалуй против шоу задвижкой грех это может быть очень эффективно для запросам диапазонов когда вы используете если же вы используете у вас могут с реджем возникнуть некоторые проблемы тогда нужно будет опрашивать все шарды использовать каторги за ну вот это когда мы во все шахты отправляем запрос вот собственно и все что я хотел вам рассказать теперь буду рад ответить на 3-4 вопросов пожалуйста микрофон первый ряд дождь и пожалуйста спасибо за интересный доклад у меня там у меня такой вопрос какая часть мозга тебе отвечает за перемещение чанка фрагментов и как бог тебе принимать решение как перемещать если у вас несколько центров обработки данных и вот в этом случае как поступать монах за 40 секс данный процесс балансировки идет в машине за 3gs вас несколько магесса серверов и они используют кончик базы данных и таким образом определяет то есть когда идет уравновешивание они отправляют в одну конкретного за конкретное место можно увидеть это в конфиг базе данных но работает это нам он гореть то есть манга с перемещая чанки да он вставляется данный в 1 шард и удаляет из другого шахте а как он принимает решение с ног смотрите вот вы создали знать и гендер разные правила и в этом случае будет следовать вашим правилам а я противном случае по умолчанию равномерное распределение него будет вот с этого будет исходить ворона не задокументировано можно исходить из того что это держит произвольном порядке но официальная официальная версия что идет равномерное распределение здравствуйте и спасибо большое за презентацию у меня несколько я знаю что есть некоторая проблема с манга потому что она не терпится сетевых отказов особенно в конфигурация с множественным до заданных есть ли какие-то альтернативы праздному ага ну короткий ответ нет вам нужен манга с виде шарнирного которого но он должен быть иной вы на яндекс зароботать да и знающего говорите испробуй нельзя использовать манга с в этом случае но проблему это решить может некоторые проблемы связаны с последующим когда конфиг сервер сервера использовать разные база данных им он gs не может добраться до всех конфиг серверов они могут перестать работать но обычные операции они даже работы если не работает то значит вмешаться а если у вас идея или планы в час объединить вечер которые касаются приложений который касается шарди ранее чтобы шарды как бы сказать пересекались думаю это архитектура шар дав останется прежней мы хотим поменять высокая доступность конфиг серверов то что сейчас она зафиксирована не используя приложение и какие странные они ведут себя совсем по-другому и некоторые из проблем которого вы упомянули выше они происходят как раз именно потому что они работают по-другому в будущее вы хотели бы использовать обычно репликацию конфиг серверов вот как-то так друзья спасибо за презентацию мне один вопрос касающийся удаление сильно раз и смешать и добавить то легко а как насчет удаления сервера из бластера жары рысакова есть такая команда только не помню как она звучит по моему тренинг процесс опустошения шарда данных называется training только вот я мне надо посмотреть я не помню точно как это звучит нужно сначала могу я попросить удалить данные с этого шанса возбудила это может занять какое-то время когда шанс пуст то его можно соответственно с помощью этой программы название команды как название которое не помню и удалить вот еще вопрос есть а если можно это будет последний вопрос чтобы следующего докладчика не прижимать по времени спасибо за доклад у меня простой вопрос область как понять когда использовать шаг смотр светлость непростую кстати вопрос но хороший три игры dead or alive но общая причина в том что делается это для достижения большей производительности но что за этим стоит внимательно смотрите допустим у вас много много данных и не то чтобы за производительностью гонит гонитесь на вас так много данных что диски у вас , ну допустим пятница терабайт диск на сервере дичь страшного но все равно неудобно правда же когда у вас riser гта5 раба дима давай много поэтому иногда sharding используется просто по той простой причине что данных много потом причина показать производительности связанного вам может потребоваться больше операций ввода-вывода в секунду больше памяти конечно память можно и к единичному сервера добавить но у вас может быть тут ограничение аромат что получить дополнительный терабайт памяти можно конечно здесь intel процессоры добавлять но это редко использовать когда мы нужно чего-то больше тогда используется sharding вот так могу ответить а хорошо но если у нас там 40 миллионов документов в одной в одном собрании появились и стали идет много запросов в эту коллекцию и оптимизированные индекс как мне кажется на некоторые запросы при этом обрабатывается медленно может ли нам sharding в этом случае помочь общее решение может быть состоит вы датирование но иногда бывает некоторых аналитических их запросов такой объем данных до вам нужно обработать миллиона записей иногда бывает иногда вы не можете добавить стоит об этом случае sharding очень может научить потому что вы разбиваете большой проблем на много маленьких и каждый шаг может вычислением заниматься параллельно и вы соответственно аппаратным способом а не за счет лучшего индексирования решайте проблему спасибо и вам спасибо за внимание"
}