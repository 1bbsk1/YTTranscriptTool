{
  "video_id": "dDryrO8y82c",
  "channel": "HighLoadChannel",
  "title": "Типичные ошибки при разработке приложений, работащих с PostgreSQL / Иван Фролков",
  "views": 11218,
  "duration": 3017,
  "published": "2020-04-27T12:21:13-07:00",
  "text": "всем добрый день как уже представили меня зовут его без professional и занимаюсь там поддержкой разработчиков то есть я не занимаюсь бы kappa me ну не особо отказоустойчивость не впрочем а о камни больше сваливаться вопросы почему это запас работает медленно как его можно ускорить почему у меня в приложении такие-то проблемы и прочее в том же духе рассказывать я естественно буду по собственному опыту то что я видел на своей работе части конечно относится к лицу часть вообще говоря по моему относится к любым базам да и можно даже не тоже не только к базам должен сказать что по многим вопросам на мой взгляд мнение может быть не только одну да у других людей соответственно может быть другой взгляд я считаю что они конечно имеют право на такую точку зрения но мне моя кажется как то разумнее тем не менее если кто-то не согласен что что всякое бывает главный вывод который я сделал из того как пересмотрел весь этот код который мне попался это по-хорошему то что заставить работать можно наверное фактически все главное должна и количество усердия то есть я видел сам разнообразное приложение например одно приложение создавала я не знаю что это было кстати он там делал это приложение знаю по понятным причинам я не могу рассказывать конкретно кому одно из какое приложение это был достаточно крупный федеральный проект и приложение славилась тем что она создавала огромное количество таблиц миллионы наверное что это были за таблицы по большей части пустые я честно говоря не знаю она создавала уничтожала и в общем это работало что интересно работать на windows если кто знает какой ты был спецназ грехи это был один тип успеть так как один требуется подгрести это один каталог она директория все таблицы создавались и соответственно в этом в этом каталоге и у нас нам получалось несколько миллионов файлов на выходные они пускали вакууму full & peace кто знает что это такое эти файлы tamb очищались в очищались и соответственно в понедельник все работало достаточно живенько к пятнице деградировала опять таким образом они жили несколько лет пока там какое-то федеральное решение не вышло этот проект не закрыли при желании можно завести все как горелка тьма прутков усердия все преодолевает иногда случается так что усердие преодолевает и разум с другой стороны я ни разу не видел чтобы люди делали глупость во имя глупости обычно если видишь что-то странное это за чем то сделано и даже у таких людей иногда можно даже поучиться у меня например на ней знакомы-то вник уже под колеса сделал все на триггерах соответственно любая бизнес-операции выглядел как вставку специальную таблицу после еще там триггеры прям вот веером рассыпали все так вот шевелилась базе когда я спросил зачем он отразил но он в принципе дал очень разумны и полезное объяснение тут тоже и чему поучиться он сказал что у меня всякая операция вид уникальный идентификатор и второй раз я уже не выполнил в принципе это вполне разумное соображение дальше хочу сказать что в силу скажем так специфики доклада может сложиться впечатление что все вокруг дураки один я умный это не так во первых как говорил один известный персонаж не здорово имеет нужду во враче а больные поэтому касались на камне вот таких послали во вторых не все они честно говоря глупые люди общем то совсем уж глупо я не видел ни разу всегда все было вполне разумно хотя вот в некоторым проблемами что-то не так понимают что то считает что работает одним образом работает другим но в общем как получается тем не менее не надо считать что я считаю себя самым умным это может сложиться такое впечатление ошибочный это не так и я тоже ошибаюсь ошибаюсь очень много как и все наверно мы ее вообще говоря мне кажется разумным не щит не пытаться не делать ошибок а быть готовым к ним я на этом немножечко подробнее дальше остановлюсь когда мы видим чужую базу данных чужую приложения на сказать что приложение вижу довольно специфично приложение режут . с точки зрения базы иногда я не вижу даже самого приложения кстати иногда полезно посмотреть что она делает вообще говоря создается в общем представлении как она организована но тем не менее я обычно вижу базу я обычно вижу запросы я обычно вижу код в базе часто вижу код который работает с базой но само приложение целиком не вижу тем не менее когда я вижу базу начинаю с ней разбираться что и как если вдруг что-то более-менее нужно сделать не совсем что такую тривиально не забрасывать в один конкретный по оптимизировать и что я заметил что к сожалению очень часто очень непосред наименование вот у меня тут видите она будет работать вот обратно давай вот такой вот замечательный вещь я наблюдал конкретно в одной базе это все были сущности одного пользователя один диффе катарцы называл совершенно по-разному были другие варианты что например в одной таблице есть user айди и в другой таблице есть юзера иди в одном случае это int предположим центами а в другой это какие-то строки чем это неудобно они люди может быть привычные как они привыкли к этому не знаю как то привыкли но тебе когда сталкиваешься приходится каждый раз внимательно разбираться что это такой может оказаться что угодно более того даже если это int это может оказаться не int юзера этом снимке на долю знающего что-то там поэтому мне кажется что с нормальной и самых нормальными нова ним жизнь была бы легче более того сама именование это тоже данные их тоже можно использовать если у вас данные именуете и и название колонок название таблицы именуется единообразно то например задача иметь список всех изображений в базе оказывается достаточно тривиально пройтись по колонкам который имеет определенное имя вот пожалуйста по каталогу мы получаем список всех список всех изображений может это первичный ключ можно прочее тоже надо это иметь ввиду ну вот еще тут то хотел уточнить показать что иногда очень непосредственно называют часть на русском часть на английском часть вообще непонятно как испанский был вот так сказать что я ничего не имею против русского ничего не имею против английского но кажется было бы хорошо все таки придерживаться одной и той же логике в именования да я понимаю что это проще сказать чем сделать потому что хорошо если базу делают один чувак или команды из нескольких человек небольшая они могут как то соблюдать свои стандарты если она разрабатываются десятилетними часть людей повалялась часть просто умирала там уже количество жене и все понятно но тем не менее все таки следует как-то за этим стремится поэтому какой вывод это может быть кажется тривиальным тем не менее это редко попадается именуете объект единообразно работа с объектом не должна требовать обращение коду документации обычно нету и либо она есть неполная либо она есть неверная вообще надо лезть в код каждый раз для каждой колонки для каждой таблицы проводить маленькие следует что это такое один раз ничего если вы этим занимаетесь целый день это выматывает очень крепко так что вот так вот дальше что такое комната будет спрашивать кто знает мышц руку поднять не то чтобы сильно густо common type expressions вот их очень любит разработчики надо был например принести а честно говоря думал что больше народу в курсе что это такое их очень любит разработчики потому что это позволяет скажем так сильно убранную не сильно упростить как-то структурировать написание сложных запросов ну сложный запрос отдельные отдельная тема тем не менее действительно помогает вы сделали то сделали это по-хорошему такое в такое стремление отображает что хорошо иметь дешевые view в ю к сожалению в подгрести есть временные представления они к сожалению имеет те же проблемы что и временные таблицы ты занимает место в каталоге и если вы задаете много у вас начинает бухнуть каталог об этом вчера рассказывал и его на об этом вчера рассказывай андрей ну я еще раз рассказываю то есть с этим конечно не очень хорошо их сейчас там кроме то кроме вариантов таких их сожалению нет и что я могу посоветовать но можно попытаться параметре пара моторизированные в юре функции делать это тоже отдельная тема в принципе можно даже чуть ли не доклад сделанная на этот в эту тему правда это уже специфичный будет grease овой ну и лекцию желе не динамически формировать запросы что если суть в случае приложения это в общем то туда-сюда то в случае если у вас код находится в базе не так оптимально сожалению такая проблема есть но надо иметь ввиду что комната expression сна каждый вот это вот свой запрос выделяет память системную если вы там храните много данных вас в общем могут быть проблемы она вытесняется на несколько тем не менее это снижает производительность на сказать что в двенадцатой версии сейчас которая будет come on the backs прошиваться они будут выноситься там при ряде условий во from и и просто переписываться запрос можно будет попросить их вести тебя по старому эту проблему как-то пытается решить возможно будет лучше это было бы хорошо конечно вот что вывод надо всегда иметь ввиду что с этой а это не бесплатно это потребляет ресурсы это к сожалению не средства логической организации акцент правда вопрос зачем они тогда нужны кроме как рекурсивные который тоже кстати потреблять ресурсы но все-таки иногда проще если в принципе выборка небольшая можно пользоваться и в общем надо стараться лишний раз не перри увлекаться вторая тема все как появился в возрасте джейсон он многие его очень полюбили в принципе и понять можно неструктурированные данные но к сожалению с ними то проблемы что в джексоне у нас хранится собственно говоря и метаданные и у вас размер базы тогда начинает зависеть почему-то от названия колонок что по моему как то глупо этим ним такой попадается как уже вчера кстати андрей говорил что разбор json даже зомби это все-таки достаточно затратная операция и лучше иметь важный пыс пыс кого вы типы как опять же я снова повторяю в одни виде отдельных колонок я неоднократно наблюдал структуру буквально вот как у меня указан в 1 в первом пункте слайда даже иногда даже без войди просто мы строим функционально яндекс по джейсону и что интересно кстати для маленьких выборку он работает весьма неплохо но когда мы начинаем выбирать большое количество данных тогда у нас плоскость вынужден сходить поднять все это разобрать если джейсон большой он оказывается вынесен в отдельный хранящий толст если кто знает это дополнительная нагрузка и рожать его и тенге сильно большой содержимое ца в общем получается тяжело хуже еще получается если у нас есть такая штука который в других случаях работает замечательно bitmap индекс can когда у нас указывается не так строка той страница просто странице там есть строка таким-то условиям под га соответственно понимает всю страницу вытаскивает оттуда все строки психо возможно поднимают из толстой возможно разжимать и проверяет рук говорят ли условия или нет это работает очень плохо поэтому если вы собираетесь использовать json в качестве универсального хранилище данных эта идея все-таки плохая база все-таки судьбе и по адресу не только не для этого как мне кажется его удобно использовать качестве параметров там переменных сложных структур данных возможно каких-то дополнительных всяких там дополнительно колоночка всяких нужно добавить строчки борзый может добавить но как основное хранилище используйте все таки идея плохая следующий пункт я хотел рассказать о константах в качестве примера я привожу транзакцию в эфире это реальная транса эфириум кто такое знает блокчейн такой фильм знаете да означает смотреть пожалуйста на слайд это совершенно реальная транзакция она прошла как можете видеть 19 февраля и сумму не составило 13 долларов 80 центов или а до 10 эфира что с ней не так может предсказать вот пожалуйста обратите внимание какую люди заплатили комиссию действительно такая комиссия 291 1000 долларов по нынешнему курсу боль 400 наверное вот такая штука выполнилась над сказать что такая транзакция так в тот день была не одна их было несколько на похожие суммы я не знаю что это было имела ли отношение к этому какая какой то какая то база что все это происходило я знаю что такие транзакции прошли очень это похоже на откровенную ошибку потому что transaction field вы можете посмотреть очень похожи на гэс в льюис кто то значит такой тыс похоже перепутали поля и умножили не на то я вот просто тут это человеческая драма для менять сумма очень большая честно скажу я прост столиком сидит человек и медленно понимает что он только что 30 тысяч долларов от правого никуда там реальность полмиллиона было я не знаю как это происходило что он сидит и молчит понимает или вдруг его вызывает и говорят что же у нас происходит в общем тут можно буквально фильм понимать какой то звук бастер там драма человеческая почему такая штука вообще говоря может возникнуть потому что есть замечание такое про constraint и что они не нужны и они снижают производительность до они снижают производительность и иногда очень значительно а теперь поставьте себя на место вот этого товарища которые ты проводил ну представь что это вы делали до и как вы думаете вот что лучше выяснять почему у нас нет ни прошло 13 долларов платеж или куда мы деле 300000 куда вы дели 300000 поэтому мне кажется что когда мы имеем дело со сложными важными операциями финансовыми там нужно правовыми какие-то имущественных даже с людьми у нас обязательно должны быть constraint и а именно фарингии чеки и возможно триггера хочу заметить что триггера на проверку встречается в реальной жизни очень редко хотя они для этого и предназначен в первую очередь они для какой-то бизнес логики именно проверять что еще хочу сказать значит у нас в принципе данные могут быть какого рода важные финансовые как предыдущая чтобы они отправить какую то сумму не пойми куда либо у нас данные могут быть представлен что-то там возможно там мы даже мусор частично понятно что на мусор constraint особо не наложишь мне кажется надо иметь скажем так понимание какие данные у нас какие если у нас есть какие-то важные данные и для них мы не можем дать точные ограничения то у нас большие проблемы уже в бизнес логики за этим надо внимательно смотреть если такой возникает ну или не знаю там заказчику или начальству доложить что у нас есть проблемы у нас все получается мне кажется что код который работает с финансовыми да с финансами вот непосредственно тут непосредственно отправка вообще это не банк туда не позволишь не скажешь извините мы тут чё то ошиблись все это ушло и код который работа с такими данными должен быть хрупким на малейший чих он должен ломаться я в данном случае вы просто бы вот маленькая условием добавили что сумма там миссии не может быть больше чем 1,1 эфира все все это не прошло вообще проблем бы не было тем не менее такой есть возможно для таких важных вещей есть смысл сделать вообще отдельный сервис валидации который будет проверять что там происходит на сколько верные данные и было бы хорошо чтобы этот сервис проверок писал не тот человек который пишет код тоже представьте что вот что в этом коде сначала написали отправку и тут же сделали проверку и наверняка это проверка будет пропустила ну не наверняка ну с очень большой вероятностью если бы код отправки в стал один человек расчет как отравляться кормить и прочего прочего опроверг описал бы другой человек исходя из других данных то соответственно своим кодом скорее всего это бы ни прошло вывод такой что проверок желательно для важных операций должно быть не меньше двух лучше больше тоже в разным количеством 50000р не стой но несколько проверок должно быть потому что рано или поздно одну из проверок вы сломаете солдат на хотя бы поможет 2 я лично на это натыкался когда у меня одна проверку я сломал 2 мне помогла не знаю может быть тут есть люди которые ошибок не делают тогда и их от наверно касается что еще хочу сказать достаточно важный вопрос лучше не выполнить неправильно не выполнить правильно чем выполнить неправильно операцию я тут как-то на днях потом потом ходил я люблю включить youtube и смотреть какой слушать какие-нибудь там рассказывать мне очень понравилась история это железнодорожной сигнализации как раз непосредственно отношение имеет до 1874 года у нас было принято английская система семафоров то есть семафора то они у меня на слайде они слева открытый и закрытый семафор у нас стоит горизонтально открытый у нас опущен вниз в чем проблема если вдруг что-то ломается семафор падает остается открытым поэтому после 70 1874 года в нашем отечестве приняли новую систему семафоров день семафор который открыт он смотрите вверху справа на складе если вдруг у нас что-то обрывается он процесс закрывается если у нас что-то идет не так лучше остановиться надо сказать что во первых а ну и так часть даже приятно слушать эту историю потому что был давно и люди погибших тех катастроф точно давно было но ошибаются все ошибаются все время на сказать что в 20-е годы когда принимали после семафоров от механических и световую сигнализацию сделали почему то что в разрешении движения это белый свет они зеленые как сейчас в результате выяснилось что если вдруг кто то почему-то разбивает красный светофильтр то машинист видит белый цвет и едет поэтому поменяли сейчас удачно красные движение запрещено движение разрешено там хитрее общий принцип такой поэтому возвращаясь к нашей истории код должен быть хрупким если что не так мы обваливаем ся они продолжаем работать и выполняться и что там гарену системе пламя что происходит вместе с этим возникает извечный вопрос где проверять введенные пользователем данные на клиенте или на сервере пому из предыдущей истории следует что надо проверять и там и там или луч еще по крайней мере у вас мусор не пролезет с этим правда часто люди сталкиваются когда работают с банковским всякими формами там чуть что не так оно все и все они работают у них удобно да но понять . зайди разработчика можно лучше не выполнить правильную операцию чем выполнить неправильное где держат люди без услуги к частично держит в приложении частично держат в базе предложение в youtube лика ищем сервере но часто в принципе 2 замке практически не остался идет ребенка держат сервере либо в базе в сервере все-таки имеет свои плюсы потому что иногда бывает срочные правки нужно что-то срочно поправить например ездили мы в одну крупную федеральную организацию у них была проблема от им опять же крупный банк по решению проект пик должен был обслуживать неожиданно почему-то отказался работать нужно срочно было переделывать на другой работ работу приложения смотрите невозможно буквально по политическим причинам я слышал возражение что дескать по американским законам это невозможно это нельзя есть такой а после как не помню кто оксли агс агс его пишем и он запрещает я спортивно интересно я посмотрел на этот американский акт он посвящен финансовом и кроме того в комментариях там в принципе вполне разумные требования чтобы посторонние люди не приходили на сервер ничего там не делали в принципе это вполне разумно хотя я знаю один случай когда запретили бывшим уволенному сотруднику ходить на сервер у них все упало потому что он это писал поддерживал ему было неприятно если бы эта работа перестала его оттуда вы вытурили все померла мышь принципе если логику держат в базе получается честно говоря не всегда хорошо почему а потому что все привыкли писать на декларативных языках и продолжает также делать в бане поэтому делают функцию бьет user banned user понимал потом вы снять что там bml может быть несколько юзеров какие-то осложнения и получается очень неудобные действительно на какой ja верности шар подписать удобнее почему-то никто вред за редким исключением не пишет именно декларативно именно леску или на реляционной реляционной модели что у нас не зачем нам иметь функцию get you зарба и 90 есть таблица айди это первичный ключ пользователя фактически может указатель на пользователя ну и поднимаете его зачем вам что-то еще надо сожалению люди вот на это как-то достаточно скверно реагирует опять же выводы как из этого можно сделать необходимо точно четко разделять данные какие данные у вас важны и какие данные у вас не важны какие на какие данные вас есть ограничение должны быть ограничения на финансы на людей на всяких законов законодательной речи на имущество и отношения либо вам прислали какой-то мусор откуда-то там что-то верное чуть не верно нужно вообще статистику посчитать у нас был случай что у нас по договору с одной организацией тоже крупные федеральные все такое при переносе базы 40 all of puzzles мы должны были еще им организовать constraint френки и данном случае казалось бы оказалось что невозможно потому что у них не получается есть которые ссылаются непонятно на что есть который ссылается на пустое в принципе тоже можно у них там нельзя было им продам возникает второй вопрос а ну хорошо эти данные неверны и а насколько верны те данные которые выглядят верными как вы это будете решать ну я не знаю в общем да говорит что константа мы им накладывать не будем потому что это к сожалению невозможно тем не менее вот такая неприятная история ну и наконец не надо писать процедурный код реляционной базе этой все-таки реляционной базы все-таки логику вас должна быть запросами и радиационными и соответственно а как она должна быть организована база довольно часто попадается очень хитро вывернуто и конструкции когда в базе все вот как тридцать тридцать тридцать тридцать процентов у нас наверное все уже очень тупое 30 процентов у нас вполне на мой взгляд разумно и 30 процентов что-то очень хитрая я наблюдал интернет-магазину которая была 30 30 тысяч товаров и список товаров по запросу который подходит строился одну секунду для 30 тысяч строк это в общем то убийственно много но такая вот организация данных была хорошая и возникали большие проблемы было туркомпания утру компании забыли отеле там им нужно было подбирать они пришли с запросом которые ну так частности у них выполнялся низко секут у них буквально там было около 50 тыс предложений по по турам вот путем неудачной организации данных они умудрились это все поднять до нескольких секунд и общем-то но к сожалению особого простор для оптимизации там не было поэтому мне кажется что одна из ошибок это слишком уж мудрить эти базы данных и изоляционной модель делались для реальных потребностей и вряд ли у вас что-то такое сильно неожиданное для которого нужно что-то больно очень хитрая скорее всего достаточно все достаточно должно прямолинейно получаться это кстати с этим и и работают удобнее потом и людям понять нее все хорошо в общем то если вам все время приходится писать хитрые запросы очень то это не потому что вы такой вот проблем человек а потому что скорее всего у вас данные не очень удачные добывает ситуация такая что данные проектировать для одного а в реальности оказалось что используется для другого ну бывает да что же теперь делать также наверное следует обратить внимание чтобы не устраивать ненужные сервис сотня тут слайде и перечитывать не буду приведен пример ада такая ситуация есть в общем то тоже перри увлекаться не надо правда к сожалению тут тоже есть замечание по поводу архивов опять же сошлюсь на вчерашнее выступление андрея кто-то его слышал наверное что он говорит что 50 процентов данных который бежит в базу они не нужны а может быть даже 90 я в принципе готов с ним согласиться потому что действительно пожалуй это так что такое субд свд на обеспечивает конкурентные непротиворечивый долларов bk восстановление случае сбой и прочее прочее прочее практически все большие базы это базы которые добавлять столько на только начни только на чтение добавили добавили и забыли гнусность не забыли лежит он там и лежит мыть не меняется если смысла хранить в базе ну если к этому требуется доступ транзакционный в это меняете меняете все-таки то да наверное следует если вы это не меняете тут уже вопрос дискуссионный если у вас данных немного то наверное можно положить и в базу она под рукой она удобнее но хорошо если вас данных очень много то наверное в базу класть не самая хорошая идея например если у вас есть коллекция видео файлов больших видеофильмов предположим флаги вряд ли это хорошо будет хранить в базе тем более что у подлез там есть определенные ограничения для full hd по крайне мере актуальные другой стороны если у вас какие-то чеки которых хорошо жмутся небольшого размера ну в принципе да можно подержать их базе не так страшно ну вот тут у меня тоже придет пару примеров еще на сказать что обычно но это уже так делюсь больше когда обсуждаешь с клиентом вопрос сколько у вас будет данных где-то рядом присутствует продавец схд и если я соответственно давлю что делать и поменьше продаются скидывает что данных у вас будут там экзабайт и вот все вот вам вам дам вам вам нужно несколько наших палок желательно подороже ну понятно общем то их задача продать побольше это ну что же делать но все-таки надо иметь ввиду что есть люди которые будут вам рассказать что у вас очень большой объем второе случае с проектированием опять же это добавление индексов индексы у нас могут либо добавить очень много пара десятков предположим но таблица там завести колонок либо наоборот очень мало в принципе не могу сказать что это часа совсем в часто встречается но вполне типичная ситуация когда у нас под ней одни и те же галочки в одном и том же порядке один патрон несколько индексов почему так получилось люди объяснить как-то не особенно лига потому что скажи мне почему те два одинаковых иных словечек ответить но ничего не ответят почему-то но почему то люди так получается если у вас есть базу посмотреть его там не фиксируйте не одни и те же колонки в одном и том же порядке несколько раз в принципе в любой особо заключим palmas кулер он не буду врать в пузыре себя можно посмотреть как использоваться индекса запросами если у вас по статистике они индекс они сходятся в чем-то это хорошие кандидаты подул их уничтожение индекс это лишний объем журнала это вот вывод это место в кэше вишни яндексе они не бесплатны и другой стороны уже совсем уж жадничайте не стоит если у вас есть запрос которому очень помогает контейнеры запрос важным по сорокет индекс ничего страшного для того не в общем-то и предназначены в общем то такая получилась как то что вот и так плохо так только надо делать хорошо что же делать дальше 2 второй вариант 2 странная вещь это когда у нас есть большие таблицы и эти таблицы не секционирование чем и плохо ну потому что все-таки лучше иметь дело с несколькими мелкими штуками чем с одной огромной например вам возвращать предыдущему пункту потребуется построить индекс он у вас будет строить скорее всего весьма долго и весьма нагружать машину на секционирование таблиц и можно индекса строить по частям потихонечку не блокируя ника там никого особо не загружая на какие-то таблицы можно построить на какие там уже не построить в общем-то больше простора для данных боль того у нас это уже чисто под грязцова я проблема есть вопрос с вакуумом то есть вакуум у нас начал что делать у нас просматривать таблицу зверски 96 возможно не целиком а то есть только то что поменялось а потом начинает сканировать индексы на предмет ссылок на удаленные строки случае большой таблицы он вас будет сканировать все индексы тоже большие кстати случае если у вас таблицы типичная пэн думали когда которая вот обычно большие бывают он у вас будет сканировать только маленькие индексы который относится к последним добавляем частям потому что старый секции они не изменялись и имени чуть делать не надо вы тоже можете здорово выиграть на производительности на сказать что вот его на вчера говорил что у нас сожалению сейчас ситуация секционирование воскресить достаточно смутная то есть как тут читал звукового кино еще нет золотого нему уже нет к сожалению спас man в ряде случаев важных причем превосходит секционирование которые есть в возрасте стандартная но развиваться боюсь что не будет и он не умеет параллельное выполнение что я в общем то неприятно то есть вот как-то у нас сейчас такая переходная ситуация ну надеюсь это все исправится понятно что все что до этого я рассказал рабочей части сводится к тому что лучше быть здоровым богатым чем бедным и больным но тем не менее надо это все таки как то иметь в виду не надо ничего сильно выдумывать если вы что-то сильно выдумывать вы скорее всего данные у вас где достаточно типичны вы скорее всего делать уж тут не так и надо в общем-то жадничать и стараться чтобы база была в общем то как то поменьше по объему чем меньше база тем она быстрее работает такой тупой наблюдение в идеале одна строчка одна колонка работы будет моментально ну тоже можно на самом деле себя убить об стену тем не менее следующий пункт обработка ошибок когда я с разработчиком говорю о том что если вдруг у вас что-то что-то пойдет не так что вы будете делать вообще не такой что читает настолько омерзительный гадостью что об этом и думать противно поэтому никто не думает из этого возникает в общем-то известные проблемы частично они связаны с тем что для многих запросов вообще говоря базы ведет себя достаточно адекватно если возникла какая-то ошибка на откатывает транзакцию и все и вроде ничего не было опять же возвращать потому что говорил ранее если у нас что-то пошло не так но мы у нас возвращаемся в исходное состояние это очень хорошо работает вне ты хорошо что он так хорошо работает и плохо хорошо потому что большинстве случаев делать ничего не надо плохо потому что в тех случаях когда делать чего то надо стон никто ничего не делает то что вы тогда не работал тогда ирод работало хорошо ну ладно очень типовая ситуация пропади оно все пропадом то есть мы перехватываем в перепуга искали исключение и вы игнорируем кто-то грел что-то не верю что никто не дело ну хорошо предположим никто не делал видел я другой вариант что когда мы перехватываем исключения помещаю в какую-то перемены то мы возвращаем обратно клиенту о чем нам это говорит это нам говорит о том что разработчики вообще говоря не понимаю что делать исключением не имеет ими пользоваться что довольно странно ну и наконец третий пункт если вы не знаете что делать с ошибка это очень важно то зачем вы перехватываете вот вы поймали чего ну вот я медведя поймал меня не пускает ошибка вариант написали написать у лука полететь дальше то есть мы у нас аж 5 продаж ну и черт с ним и дальше выполняем сейчас отправляем деньги как то вот надо либо знаете что делать либо не знаете что делать это уже скажем так чудо кот с клиента тут он на самом деле слишком аккуратный потому что клиенты если клиент приложения и клиент который заказчик вызывает какой-то операции с базы смотрят ошибку которая при этом получилось и там если ошибка что-то ошиблась то мы еще учет возвращаем код получается мутный путаный потому что на каждый чих у нас вот это вот постоянный поиск кроме того в ряде случаев не проверял куда ошибке считают что выполнится всегда всего хорошо есть а вдруг что то не выполнится будут проблемы но это все потому что люди на мой взгляд очень боятся исключений вот и в перепуга и сквере как-то с ними не слава богу очень многих и и соответственно и в клиенте очень плохо и почему это приводит вот в принципе вот нормальной обработка того же варианта предыдущего псевдокода она выглядит вам гораздо аккуратнее гораздо понятнее если мы выполняли операцию она называют она уже зашли причиной следующие значит все было хорошо если у нас какая-то ошибка произошла там и и обрабатываем если у нас неважно что произошло мы вычищаем заказа говорим соединение вот тут прям kotaku достаточно чисто я снова кодека сделать то сделать это сделать 10 и соответственно в джитибиси и есть искали exception транслятор например это spring springer же русском пока в этом свой есть и не знаю все шапки наверно to shoot свои ведь в принципе она не зря придумано есть повод им собственного воспользоваться зачем-то это было сделано уже правильно соответственно какие из этого выводы можно сделать не над первое не надо перекладывать ошибку который дизайн что делать лучше пусть у вас приложения вывалится с ошибкой вы будете объясняться что почему у нас это не работает чем вы сделать что то нет а вот поверьте объясняться почему не работает гораздо приятней чем выяснять куда вы дели деньги возвращаясь к именованию если вы аккуратно назовете хорошо единообразно хорошо назовете constraint и вы получите их в ошибке получив картрайт ошибки вы сможете сказать что и произошло вести тедаса ты зачем образом что-то отказ сказать пользователю что там написать в лоб можете как-то это обработать тут правда возникает соблазн писать и в кавычках тоже кавычках можно свалить пробелы и прочее прочее символы действительно можно это работает проблем возникает обычно с какими-то другими утилитами других производителей которые нередко атаки идентификатор спотыкаются но тем не менее вообще говоря можно соответственно костра констр это называть это кстати практически никто не делает очень жаль то что константу можно выяснить что и как что нет что не соответствует конце концов можно даже вести каталог что вот контент такой то это такая то ошибка там то там то то то то то что с ней можно делать это ошибкой кроме того надо бы рассмотреть ошибки не с точки зрения самой ошибки от точки зрения приложений что он может с ней сделать либо мы завершаем ся либо мы можем попробовать выполнить эту операцию еще одно наблюдение типовая ошибка medlock detected кто обрабатывает де блоки ну вот как-то не густо мне попадались люди которые говоришь где блоков в принципе не бывает но хорошо не бывает не бывает актер убеждать не стал ладно не будет с дидлами там тоже проблемы и чуть попозже коснусь хорошему что там люди пишут это меня не касается отнимаю делая занимаясь запросами но с ошибками такой обработка ошибок связано вообще достаточно типовая ситуация когда мы начинаем транзакцию что-то меняем в базе обращаемся к внешнему сервису он нам возвращает ошибку мы по этой ошибки как-то непонятно оступаемся и все потеряли соединения на пир она висеть может если по-другому не выстроена очень долго она может висеть часами сутками не знаю ну сутками в неделю висело по маркам видел для подвеса такие длинные транзакции очень неприятны вот принципе есть параметр этот маг солидный transaction по называется чуть не могу запомнить вот котором закисление просто будет отстреливать под весом тем не менее довольно типовая ситуация что у нас не хватает соединение мы сделали две тысячи давайте сделаем три тысячи давайте сделаем 10000 если кто может быть помнит указанного доволен до по-моему было юмореска где что мы посадили 10 гектаров там все съел долгоносик последним 20 гектаров никогда не до поддаются вот соответственно в реальности когда мы работаем с реальными людьми живыми вам не потребуется тысяча соединений вы понимаете что 1000 соединения цена каждого человека одно соединение по нормальному должно быть какой-то оператор что-то вводит у вас хорошо если там в 500 человек но откуда вас 1000 тем более что они по большей части вот вот возьмите самую нагрузок остер супермаркете который что там пробивает этот принцип вода врача не идет но сколько они у вас в нагрузку дадут но но не будет там буквально 5 если денег хватит за глаза для крупного супермаркета откуда вас 1000 на 1000 а если возможно 1000 соединений и вы не делать и что ты такого необычного то вы делаете что-то неправильно восточные китаем что-то не то ну и я опять же повторюсь обычно вся эта история связана с тем что обращается к вам сервису да неважно даже у себя в ходе возникает ошибка она вылетает либо и игнорирует в общем что там происходит и пойми что если мы ошибку не обрабатываем вот или забыли обработать то у нас дальше выполнение вообще говоря идет не пойми как вы летаете и не будет ждать может быть сам удивительный еще тоже ну попадается не то чтобы часто но смысле реально люди столкнутся проблем но сталкиваются потерянные обновления у нас два пользователя грузит 1 1 одну и ту же строку один меняет сохраняет потом второе сохраняет мнение 1 были потеряны в принципе как это можно обрабатывать штате пожалуйста кишат все строки в сиквел сервере microsoft.com есть колоночка почему-то называется time stamp переименовали там и дентина какой-то случайный для тифе катарна последние обновления ну мне кажется же в прогрессе можно такого не придумывать зачем это придумали microsoft я не очень понимаю можно взять просто строчку взять эту строчку которую ролл которая попала в таблице приобретаете в строку которая string которую последний символ высчитать одним хэш даже не стойки md5 предположим нам важно же не криптография изменения если они не совпадают строки изменились но там уже поступать соответственно и еще такое объедение что если у вас есть параллельная работа и вы на это как-то не обращайте внимание рано или поздно вы нажмете на эту ошибку вот у меня была ситуация что заявки на вывод подтверждали менеджеры то есть то там кот достался тут был не мой достался но наследованию вроде работу они начали на кнопочку и человеку проходила оплата правильно два человека загрузили одну и ту же форму один нажал оплата 2 нажал оплата ушла платочек два раза томпсон была небольшая общем не страшно тем не менее я делаю раз в неделю и должны были делать по очереди через неделю у каждой они этим не менее устроили вот такую проблему так что у нас если есть конкурентный доступ и вы это не предусмотрели ошибку вас рано или поздно случится вопрос когда помогли бы как раз в этом плане ограничения то есть например например на отправку уникальная иди отправили вставили один раз отправилась и все поэтому надо всё время разработчика помнить о конкурентности о том чтобы например уникальность сделать вручную довольно сложно это только базу можно сделать в принципе можно но это не стандартное средство потребуется ну и наверно для это больше для отчетов для прочего подходят хорошо помните об уровнях изоляции это опять же в конкурентности иногда кстати возникает что мы иногда вдруг не видим то что там произошло не учитываем дальше если у нас происходит работа с каким-то внешними сервисами практически у всех так что ты уже опаздываю практически у всех рабочих ситуация конечно мы вызываем и считаю что все получилось нормально причем все получилось сразу и хорошо если мы только делаем один раз я летал на ситуацию когда вы не coлдaт блог регулярно несколько сотен раз несколько сотен раз дергался внешней сервис и в общем все то были большие проблемы людей соответствии с внешними сервисами сначала вот этот маленький кусок кода его наверно а субъекта внимательно читать не будет но сначала 1 транзакциям помечаем что мы сейчас будем что-то делать с нижним сервисом и 2 транзакции делаем если мы вдруг свалимся между этими транзакциями мы по крайней мере то гораций второй раз не выполним ее можно будет сделать вручную но лучше не выполнить как я уже говорил правильно пирата чем выполнить неправильно и соответственно нет мимо не отменяем операцию у нас какие бывают либо в базе в одной либо двухфазный комет его я видел буквально две организации где он используется по делу остальные его не используют плюс еще в жизни я видел один раз вы использовали случайно вот тоже не понравилась едим патентной операция кто значит так один патент на операция хорошо вот у нас могут быть едим патентной операцию внешне это это здорово это насколько я помню киви так делал можно было через у них один патентной были операции а есть еще какие то были мне попадались денежные агрегатор у которых был просто вызов внешний веб сервиса отправить деньги на такой-то счет все то есть и привет не ответа но он был возвращен идентификатор как отправилась если вдруг какой-то сбой выяснить был нельзя отправлялась не отправлял что там произошло такое тоже попадается не очень хорошо тем не менее такое есть но я уже подхожу к концу мне уже пора закругляться еще типа моя ошибка у нас есть средство переноса данных вороту п.г. она арок новый номер переносит в подгорицу in american крестцовый на америка хороший тип но оракла вы нам bergara случай честно скажу он от одного байта там-то многих даже давать мы помыли дышите 4 там большое переменной длины действительно для чисел очень хорошо подходит под grease новый на америка 3 от трех до восьми байт префикса плюс по два байта на четыре символа он гораздо толще и общем то работа незачем быстро поэтому лучше если вы переносите данные 40 la то пожалуйста и 40 других баз не надо пихать все на в american америка это для денег лучше и лучше всякие счетчики этом прочее да индификатор и к власти в четыре или либо in 8 бит будет и быстрее и удобнее кроме того если в луна вилька не указывали точность то вам может повезти и получите число с очень высокой точностью потому что америка без ограничений он переменной длины и может занимать по-моему до полутора килобайт но число с высокой точностью не так поделите и пожалуйста поэтому для на мире канада указывают точность он + 2 не пытаемся там поесть просто им stamp есть time stands той зоной таймс там всегда должен быть ставим зоны вы убережете себя от кучи не то чтобы ошибок ну таким можете серьезно но обычно они досадные неприятные т.к. эта задача не пускается там что-то не находится все время лучше если делать и таймс там таймс там должен быть станет зоны все для флагов очень часто кто же как это утилита переноса используют 41 ринг 1 ну в принципе да можно вообще лучше есть есть не бульон логично боевой использовать тем более что он он и короче будет в возрасте по историческим причинам есть тип money он в общем то не такой плохой в нем можно хранить деньги лучше в нем не считать все-таки эти деньги но хранить можно в очень характерный пример использует слово ты ли дал был для денег то использует слово дабл для денег удивительно ну вот очень хорошо что не используйте тем не менее использует для денег это что-то введёт копеечном нисхождение мне очень приятно и тогда небольшой могут набегать эту что эти копейки там и миллиарда одновременно получить использует на америку с указанной точностью ну и наконец наверно половина хранит а у еды видич 32 вот еще есть специальный 1 специальный тип уитон два раза меньше меньше данных и я уже говорил выше производительность меньше ввод-вывод больше места в к шее прочее прочее дальше про временные таблицы уже завоеван сказал андрей еще раз я скажу они не очень хороши из-за них раздувается каталог уже говорили что это такое с другими транзакциями совсем плов получается в общем другой страны не надо читать вообще не для из польских если у вас есть какой-то там процесс который раз в минуты выполняете создать несколько временных таблиц ничего страшного-то нибудь у вас будет страшно создается десятками тысяч раз в секунду до тогда вас проблемы что делать если временные таблицы нужны а их нет и используйте к не получается кстати это вполне реально ситуации если вы работаете на реплики ну например мы можем на него реплики правда сделать unlocked таблицы и вполне себе работает достаточно неплохо по крайне мере каталог не взорвется то лучше так делать если вас там вам этого нужно много есть хороший модуль впуска лицу поговорим с это данные в памяти цессии в памяти сессии то есть можно там держать и наконец если вы работаете на реплики вам нужны временные таблицы ничего сделать не получается есть экстерн файл вдв но тоже не очень хорошо но тем не менее это хоть какое-то решение можно выгрузить промежуточные данные во временный файл потом просто почитать сейчас в новой версии можно выгружать в программу то есть там диска погибче все получается еще такая маленькая вещь как рмм часто ругают и вот уже ругал я вообще написал миску или мне казался до линча скажут что это удобней и хорошо но в то же время поездил посмотрел очень много проектов где rm работает очень неплохо есть где работает плохо но проблема не столько в районе сколько в том что у разработчиков проблемы еще маленькая вещь я уже закругляюсь есть такое понятие как la joc chicks это было бы они отличаются от колоночки типа блок white оказывается тем что по ним можно взад-вперед ездить и к сожалению с ними проблемы связаны ли они во первых устаревшие вот ну ладно не работает так это одна большая таблица со всеми вытекающими проблемы которая таблице не профи цианирование кстати ну и во-вторых они опять же могут теряться у нас есть клиент буквально вот перед тем как ехать сюда как раз и у них такая таблица и там где-то две трети потерянные большие объекты но вот тоже как нехорошо очень распухла и мешает им это таблица меня все вопросы есть какие-то у нас к сожалению вопросов вопросов много времени нет иван спасибо большая"
}