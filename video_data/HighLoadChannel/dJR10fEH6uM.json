{
  "video_id": "dJR10fEH6uM",
  "channel": "HighLoadChannel",
  "title": "Анализ запросов в MySQL, PostgreSQL, MongoDB  / Пётр Зайцев (Percona)",
  "views": 3149,
  "duration": 2980,
  "published": "2020-04-14T11:03:59-07:00",
  "text": "мы с вами поговорим о базах данных и непосредственно оптимизацию производитель для них то есть используют базы данных о света глаза на все равно вижу вижу пару так вот о чем мы поговорим мы поговорим о производительности баз данных вообще как мы к ней подходим как оптимизировать запросы и посмотрим некоторые тузы которые позволяют это делать лучше в частности я буду показывать некоторые скриншоты из нашего туза для оптимизации производительности которую мы делаем фер кони называется она перка на мониторинг менеджмент вот пока что она делает мониторинг менеджмент не делает но все будет все все в свое время и это полностью открытый продукт наверно уникальный в своем роде потому что другие продукты которые делают похожие вещи они либо счас продукты либо коммерческие продукты да вроде там манга devious менеджер mais quel enterprise manager и так далее и тому подобное ну ладно давайте прежде всего посмотрим на нашу основную цель да вообще чего хотят наши пользователи или босс да то есть у нас есть приложение которое понятное дело используют в базу данных и чего все хотят что в это приложение работало быстро не падала и так далее и тому подобного если это трансформировать на язык базы данных скажем так значит это будет означать что когда разработчики используют базы данных мы хотим чтобы она отвечала на запросы которые мы посылаем всегда для всех пользователей на все запросы и так далее и тому подобное а вот есть такой идеал но этот идеал скажем так он недостижим да потому что потому что у всех даже у самых крупных ресурсов да там с наверное самый грамотный инженер интим downtime случаются случается что termo тормозится и на самом деле пытаться минимизировать downtime давали свести его к нулю это слишком долго дорога и часто даже не практично кучку непрактично потому что для многих приложений это означает то что создается культура такая слишком консервативно да давайте ничего не будем менять а вдруг упадет и этой входит в конфликт с тем что нужно развивать продукт нужно двигаться вперед и нужно двигаться быстро интересно кто нибудь слышал такой термин как ссср и сайт реветь инжиниринг я а кто-нибудь его используют в своей компании вот 0 вижу всего пару cto что такое сайт reliability инжиниринг и как она вообще относится к базам данных и к тому же чем я вам рассказываю сад или видите инжиниринг это процесс который пошел от google который популяризировали такой процесс который весьма формальный хорошо структурированный подход по обеспечению надежности систем да вот они выпустили книжку по этому поводу ну вообще сейчас много много материала которые можно найти что интересно да и в в этой дисциплине эта дисциплина предполагает нам измерять производительность всего дома и инвестировать много обзоров берите мониторинг собирать данные organize анализировать их использовать для того чтобы мы могли превращать проблемы и решать их быстро она работает с такими концертами как сервис ловил индигерда что это означает что мы определили какой то вполне формальный критерий как у нас система работает и или или нет для этого критерия но обычно да там время отклика для каких-то транзакциях кого-то типа мы определяем service level объектов на там например что вот если мы имеем клиента кота который покупает там пытается завершить покупку мы хотим чтобы она проходила успешно в 99 99 процентов случаев и занимала это не более чем не знаю там пол пол секунды вот такое описание будет собой представлять этот самый service level объекте что тоже интересно в этом концепте это такой подход как р-р budget до что вели бюджет ошибок что это говорит это говорит о том что на самом деле мы не стремимся к тому чтобы систему нас отвечала всегда работала всегда мы понимаем что нам нужно принимать риски будут какие-то ошибки мы поэтому определяем сколько этого можем себе на себе позволить обычно это с точки зрения бизнеса мы коррелирует с тем сколько можем себе позволить с точки зрения revenue с точки зрения сколько пользы или потерпят да то есть для каких-то ресурсов он получается очень маленький для каких-то других вещей значительно больше что это у нас означает для базы данных для базы данных мы можем определить эти критерии как с точки зрения приложения да то есть у нас приложение содержит какую-то функцию например не знаю там поиска дать им и поиск то мы можем смотреть на силой который определен для приложения но сегментировать в каких случаях он операция не было выполнено успешно или была задержана из-за того что проблемы были с базы данных мы можем тоже самое смотреть с точки зрения к connect или с точки зрения доступности сервиса да то что у нас наша база данных работает и отвечает и часто это имеет смысл еще структурировать по типу запроса да то есть если у нас мыс смотрим на базу данных обычно у нас много разных запросов какие-то из них будут более тяжелых какие-то менее тяжелые всех их в одну кучу сваливать да там и для них делать одни и те же метрики непрактично имеет смысл смотреть разные типы запросы что эти должны завершаться не знаю за три миллисекунды а эти и за 50 нормально еще интересный момент это что понятное дело что база данных несмотря на то что она часто является проблемой проблема проблема не всегда является проблемой и если вы на весь в дверь которые отвечаете за за базу данных то хорошо бы иметь данные которые вы можете это доказать сколько клиентов у меня было которым я прихожу не говорят вот посмотрите на нашу базу данных вас что-то приложение тормозит games паршина а чего сразу-то на базу данных в чем у этого заданных то не говорит ну вот потому что нас всегда если что тормозит то это значит виновата база данных кто не сталкиваться с таким нет подходом добрых разработчик в вижу руки отлично значит если вы видите то что проблема действительно с базы данных и ни с чем то другим то на самом деле проблем могут быть как с точки зрения разработчиков так с точки зрения operations да там как мы это база данных обслуживаем что у нас может быть с точки зрения разработки дефекты в приложений разработчики например выполняет слишком много запросов один за другим датам написали страницу которая требует для загрузки 10 тысяч запросов это плохо да там и 100 вы там с базы данных не tune ли хорошо это не сделает делать окиньте очень экспансии в запросу да то есть если вы делаете там да какой то футов скан на 100 миллионов строк да там и как-то данные скачивайте все в приложении после этого их там обрабатывать опять-таки ничего с точки зрения базы данных здесь в здесь не не получится но также бывают часто запросы которые народ не очень хорошо за дизайнер и другой интересный момент которую мы часто сталкиваешься это то что у нас есть нормальный production work воды + девелоперы запускают какой-нибудь там поджог да там какие-нибудь отчеты или еще что-нибудь что базу данных собственно говоря перегружает кладет то же самое с точки зрения операционной отчасти базах данных у нас могут быть прости проблемы с собственным говорят операционной системой со сетью со сторожем да там и и опять-таки они выглядят то же самое как база тормозит на самом деле они не на уровне база данных то же самое у нас могут быть проблемы с каким-то дополнительным модам дата у него но уже не на уровне приложения после база данных а что его другой но например там мы запустили в какой он там backup копируем копируем файлы вот из-за этого все всё тормозит с чем еще мы сталкиваемся часто это что народ разработчики не совсем понимают насколько медленно и бывает сеть да то есть особенно если приложений у нас разрабатывается на не знаю там на лаптопе часто на система где у нас база данных и апликэйшен сервер живут на одном сервере потом это выносятся в систему где лайкните между сервером базам данных и приложениям большое за этого могут возникать куча проблем производительности опять таки с которыми на уровне базы данных ничего не решились ну хорошо и когда он стоит вопрос оптимизации запросов что это может вообще говоря означать проблема здесь бывают на самом деле разные да там которые формулируются первое бывает то что у нас есть приложение в принципе она работает неплохо но какая-то функционально с ним она тормозит до соответственно нам тогда нужно посмотреть когда у нас вызывается эта функциональность какие вызываются запрос и работать с ними очень часто вопрос возникает как нам оценить приложение вообще да там чтобы у нас приложение работало более быстро или же часто более эффективно чтобы нам можно было тратить набираешь нас этого это приложение меньше денег особенно это полезно в вк лауда там когда мы можем изменять размер intenso что вверх что вниз весьма весьма весьма быстро здесь следует тоже сказать что при анализ производительности и анализ запросов это конечно важно но это далеко не все с чем приходится сталкиваться для обеспечения высокой производительности баз данных то есть архитектуры то очень сильно влияет правильный выбор технологии да там не для всего у нас жизни подходит хорошо реляционной базы данных данными те технологии которые мы говорим правильный вызов железо весьма важны да там в клауд выбор инстансов и и так далее все вот эти вот вопрос и они могут очень сильно влиять на а производительность плюс с точки зрения вообще разработке системы часто несмотря на то что людям моего пошива да там которые очень любят увлекаться производительностью часто нужно работать и с другими вещами которые часто вступают в конфликт производительности дата мы хотим чтобы у нас было корректно работала система да там что например я говорю про корректность в широком плане да например для повышения производить если мы часто можем использовать кэш и но каши при этом нам дают часто бывают немножко устаревшие данные которые идут в конфликты этой самой корректностью безопасность опять таки да там использование каких нибудь там ссср tls замедляет вещи делать вещи так чтобы им было легко легко менять управлять опять таки часто их но делает более сложными если мы смотрим на запросы где же нам их смотреть то там и анализировать но на самом деле лучше всего это делать как в development in warm эти так и в продакшен и ну почему да потому что если в формате вы можете поймать запросы и как-то пофиксить до того как они выпадут в продакшн да это вполне очевидно но при этом никогда не удается все проблемы запросами поймать да продакшена да и даже если делается все хорошо все правильно почему потому что какие-то проблемы запросами они возникают уже по мере работы системы то например у нас получилось так что optimizer по какой-то причине начинает выбирать другой не оптимальный план выполнения запросов да там и с этим нужно как-то бороться встречается абсолютно на всех базах данных так вот это начиная с oracle заканчивая заканчиваю маску и вот я уже упоминал немножко про эффективность что интересно про эффективность особенно в клауд он спорит в клаудии системы нет ну не так не так много рук но есть такой интересный интересный взгляд да там на на клауд что если мы работаем в рамках ну боли к его традиционных дата-центров часто получить апгрейт это достаточно дорого и и сложно занимает какое-то время в клауд часто это делать очень просто это означает то что в клаудио можем часто наши грехи когда система сделана не оптимально но в рамках в каких-то масштабов просто решить то что мы используем очень большую мощную систему которая стоит дорого но при этом проезжаю проблема производительности а производительности нету как я видел некоторые люди это называют тюнингом по кредитной карточке то есть кто-нибудь сталось с такой проблемой вот я думаю что у многих разработчиков это любимый подход давайте мы сначала просто решим проблема может быть когда нибудь у нас дойдут руки пофиксить это правильно в итоге по нашему обществу опыту если вот смотреть на системы да там приложение которое используется база данных которые размещаются в клауд они часто значительно меньше оптимизированы чем чем раньше люди оптимизировали приложение ладно давайте посмотрим теперь на запросы все-таки то есть как я уже сказал запросы с базы данных это во первых то через чтоб на производительность системы смотрят ваши поиски вторые это нота за счет чего можно оптимизировать базу данных весьма очевидно на самом деле с точки зрения анализа производительности заброс в это происходит часто из самых разнообразных task-ов ну во первых как я уже говорил очень хорошо если у вас есть процесс когда вы вовремя девелопмента осматриваете новые запросы стал плохие запросов продакшене попадали очень часто мы в общем проводим активизацию прожить или системе периодически да там либо чтобы повысить эффективность снизить костры и так далее очень часто возникает такое желание посмотреть не желание возникает этого возникает необходимость анализа производительности запросов связанную с тем что у нас есть какой-то мешок у этой инцидент да то есть у нас что меняется по до инцидентом что база данных сейчас ведет себя не очень хорошо у нее есть какие-то проблемы с производительностью вот когда мы занимаемся инцидент trouble суть янгом что у нас возникает возникает такой вот интересный вопрос чаще всего да а что же у нас изменилась да вот эта система отработала вчера вроде мы ничего не не трогали но сегодня она работает неправильно тормозит окончил такое было ну часто да я помню еще где учился в университете данном преподаватель говорил что вот компьютер на самом деле это же конечные автоматы да там и их поведение она грубо говоря строго детерминировано ну и на самом деле в теории это конечно звучит звучит правильно на практике сейчас мы работаем с системами которые настолько сложные что мы не знаем да там их полностью не можем посмотреть что-то изменилось или нет во многих случаях мы у нас даже нет информации да там даже если вы не используете клауд посмотреть какой-нибудь там девайс как с с дисторшн а там у него там куча чего творится в программу mdi прочего мы не знаем и знать не можем да там или же какие-нибудь современные процессор у которых поведение очень сильно зависит от нормального режима дата в котором они работают которые тоже зависит кучу от всего да там включая от того какой поток конструкции они выполняют вот поэтому на самом деле часто понять непосредственно что произошло датами вот бывает не так не так просто и даже когда у нас происходит какой то вроде бы инцидент мы пытаемся разобраться дни в тем что его вызвало что изменилось а что плохо сейчас да там что можно пофиксить но если смотреть на это изменение да там от того что было вчера почему работала и что что изменилось какие у нас могут быть на самом деле здесь варианты первое что у нас что то изменилось запросами который входят 2 фоне приходится с тем второе это что у нас с джоном базы данных да там какие-то изменились вещи третье это что-то что у нас связано с операционной системой железом или общем там инвар ментам а 1 сыром там и так далее когда мы говорим про запросы что чаще всего здесь может происходить первое очень часто происходит изменение какие-то с тем как себя ведут юзера да там в онлайн приложения причем права и здоров я имею еду как людей так и машин очень часто бывает что не знаю какой нибудь там взбесился googlebot например или же кто-нибудь из партнеров которые используют ваша и pr изменился поведение дата вот им понадобилось именно сегодня сделать не знаю там 10 миллионов каких-то и и пикалов которые как как бы как как можно быстрее да там такие вещи понятно что меняют поведение и на юзеров часов другой причины по которым могут быть такие проблемы происходить это какие-то операционные проблемы да там ну например бывает что у людей должен используется кэш redis какой-нибудь да там и вот он сконфигурировать неправильно поэтому у нас вдруг резко пошел пошло кучи трафика на базу данных или же у нас есть кластер не знаю там один мастер несколько слоев соус конфигурация слетела все запросы идут только на один из серверов да там много таких проблем ну и наконец то могут быть проблемы которые действительно связаны с приложением дата мы зарелизили какую-нибудь там новую фишку которая посылает кучу запросов да там или же приложение ведет себя как-то неправильно при каких-то каких-то критериях вот когда мы смотрим на запросы здесь имеет смысл смотреть не только на число запросов которые получает система на на вход но и понятно дело какой микс этих запросов потому что опять таки запросы могут отличаться по по сложности да там даже не не в десятке в не в 1000 до тома в сотни тысяч и миллионы раз какие вопросы когда мы смотрим на систем имеет смысл спросите на что посмотреть обычно мы смотрим на запросы которые либо частые запросы которые типичная активный и грубо говоря там вместе смотреть на систему они часто активные да там или не создает много нагрузки и запросы которые требуют настя для себя много много работы вот если используя тупы тулузу bmm которую я указал на самом деле это можно там достаточно легко посмотреть вот здесь я например смотрю на запросы на их частоту мы видим с точки зрения чистоты запросов она достаточно стабильно да там около трех тысяч запросов секунды в данном случае вот но если нам посмотреть на лот или активность этих запросов которые составе мы видим что здесь уже есть некоторая вариаций адатов какие то что при каких-то случаях даже когда у нас число запросов сохраняется то же самое то число активных запрос в нас прыгает да там опять таки по каким-то каким-то каким-то причинам другой вопрос который интересен тоже да там как искал не все запросы которые у нас одинаково одинаково сложные то можно посмотреть что вот если здесь у нас на первом месте был какой-то вот select простой да там по первичному ключу то вот это вот второй запросе да у нас уже вверх влезает более тяжелый апдейт запрос а наш select приходит на третье место с точки зрения работы да там которые делают запросы на самом деле метрики такой хороший который бы нам говорила вот объем работы непосредственно ее нет да там потому что работа сможет быть разное насколько потребление процессор используя диска и тому подобное что я часто использую как не то как метрику работы это сколько запросов обработал обработал запрос да там это весьма хорошая метрика вот при этом частыми потому что когда мы оптимизируем запросы что мы стараемся изменить мы стараемся что в этот запрос использовал бы поменьше обрабатывал поменьше поменьше строчек да вот здесь мы можем видеть что на первом месте у нас есть какой-то запрос который лопате тпа 600000 строк строк секунду он самый дорогой надо сказать что он отличается от того запроса который у нас чаще всего активный и понятно дело отличается от того запроса которые наиболее частый да и на самом деле это типично следующий момент и которым имеет смысл обратить внимание что когда мы смотрим на занимаемся оптимизации запросов очень редко или таковы там тривиальный случай когда у нас какой то запрос да там он плохой всегда да там или у всех серверов проблема при этом это означает то что нужно обратить внимание на распределение да там всегда смотреть где у нас есть проблемы то есть вот в нашей тузы мы показываем как бы phase 1 по по разным критериям вот здесь мы я вот выделил то что он не хочет мне работать интересно ну ладно низкая такое какая-то магическая кнопка которую можно выделять а вот этого-то магическая кнопочка вот здесь от посмотреть на эту часть мы видим что здесь показываются схемы к которым приходит запрос мы видим что 99 процентов и сколько там 92 процента строчек которые были их заминированы да там они приходятся схема типе see one да там значит скорее всего с ней какие-то проблемы но понятно что это у меня тестовый стенд на самом деле в реальной жизни где это частью встречаются очень часто когда мы делаем какие-нибудь счас приложения у нас могут быть там много баз данных для разных для разных пользователей да там которых могут быть собственно говоря одни запросы вот с каким-то из них может что-то что-то случится но и при этом имеется у смотрите на другие критерии так давайте немножко ускорюсь я что ли какие у нас проблемы с базы данных часто имеет смысл смотреть на конкуренции да там не перегружать базу данных плохие запросы плохие где кувшин plans какой-то сайт блог про котором я говорил базы данных за мужественно чем-то да там например если мы не делаем там вакуум в паз груси в и на димой сколь несмотря то что нету вакуум могут быть подобный тоже эффект когда у нас таблицы много пустого места ей бы хорошо сделать optimizer на будет работать быстрее производительность кэша да там баффер буллу так далее тоже часто бывает проблема с точки зрения конференци что здесь надо знать вот есть такой закон хороший да там приходится компьютер сайнс который называется юрьевич the scalability ло или там закон универсальной масштабируемости как ты так должен звучать на раба русском по-русски что он означает что у любой система на самом деле есть некоторый диапазон конкор инси да там в котором она достигает максимальной производительности потому что если повышать конкуренции дальше-то потери на синхронизацию координацию и так далее они будут уже превышать benefit которую можем получить за счет более эффективного использования ресурсов при высокой конкуренции когда вы используете базы данных вот нужно опять-таки пытаемся кнопочку где а вот эта кнопочка о-оу вот чтобы база данных у нас где-то вот работала вот в этом диапазоне они где-нибудь здесь когда у нас уже пик пройден да там используем там connection pool какую my там прокси или что-нить в этом роде вот так вот следующий момент какие у нас могут быть проблемы с системой типичный да там swapping какие-нибудь взбесившийся be grown процессоры хай 1 зерна примерно сможет воровать процессор проблемы с со старой да там не тормозит сеть когда мы используем виртуализацию или вклад есть такая проблема злобных соседей да там когда у нас но из-за того что ресурсы не очень хорошо и enforce лица то что делают соседи могут влиять на производительность нашей системы вот на самом деле интересный пример по о том как степи you still может влиять на производительность в в реальной жизни да вот у нас был случай когда у клиента вот его производительность выглядело примерно вот так вот как этот внешний график график верху да там такие мощные прасад когда мы посмотрели на использование процессора мы видим да там опять таки что вот это вот когда проседает производительность у нас соответствует тому что процессор очень сильно уходит в то что большинство процессоров съедается steel вот проблема может быть достаточно типичное вот я указал the link если кто хочет прочитать более подробно посмотрите так ну хорошо скажем так со всеми этими вещами вы нашли какую-то конкретную конкретный запрос да там которую подозреваете что его нужно было бы хорошо оттенить на что требует на что имеет смысл обратить внимание первое часто хорошо запрос можно по провалить прав а я делается разным образом например и в подгруппе есть классная штука explain анала из да там когда можем выполнить запросы получить статистику о том как она выбралась на что на что ушло время где была сложность в mais quel часто используется провалит например в мае сколь workbench где мы можем выполнить запрос посмотреть на шоу статус каунта до и после выполнения запросов посмотреть что там нас реально реально произошло следующий момент это конечно explain да здесь можно explain опять таки он есть во всех базах данных при этом выглядит он конечно у них по-разному но идея примерно одинаковая да то что мы смотрим explain для наших для наших запросов смотрим что он выглядит выглядит хорошо при этом всегда нужно смотреть не только на explain кота сейчас но это как он может и будет меняться в будущем дано в мире если у нас есть пока что кант маленькая табличка которую всего лишь там тысячу строк explain показывает то что ее делается full-time исккон это не проблема но если вы знаете что вас будут планы что-то табличка вырастет до 100 миллионов до например потому что это ну какая вы там и history да и сначала на практически густая то понятно что такой план вам не подходит он он плохо что мы делаем в примем что помочь всему этого кроме непосредственно профайлинга а одного запроса можно посмотреть на profile всех запросов 1 класса до вот здесь например мы смотрим на конкретные этот запрос и можно посмотреть например что у этого запроса сколько там же скажу да там где-то там три процента уходит на чтение жесткого диска да это значит то что в принципе если мы будем добавлять памяти или там диск поставим быстрее то в принципе этот запрос и и производительность у нас не получится следующий интересный интересный вопрос и то есть запросы которые можно назвать тяжелыми запросами так а запросы которые но на самом деле требует много работы да вот например обычно запросы которые делают агрегация к это простой пример данном случае мы пытаемся посчитать среднее значение да там по какому-то в класс который грубо говоря может быть динамической если мы хотим делать что такое понятно что это надо будет шерстить много-много строчек подходит каким запросом на самом деле простой да там что база данных их обрабатывать нормально не может от них нужно избавиться возможно это можно сделать окуните штата например от предыдущем варианте если меня всегда интересуют данные только по целым дням то может быть я могу построить все самаре they был где вот это вот храниться данные по дням и сделать запрос более более быстрые так не не туда убежал вот регенерировать ресурсы можно но или используя какие-то системы которые работают с этим быстро да вот например если у вас есть корень такой запрос такого типа да там и данные вас будет находиться в клик хаоса не в майской то запрос будет но даже на той же одной машинки выполняться не знаю там 100 в тысячу раз быстрее потому что системы предназначены именно для таких вот тяжелых тяжелых запросов так у этой что-то обратно бегу будто педали вот что у нас дальше другой тип запросов это запросы которые были плохо за за дизайне ну да то есть это запросы которые можно сделать эффективными есть ли что-то подтюнить ну например сделать сделать схему которая лучше поддерживает поддерживают такие такие запросы и с этим надо работать ну и еще есть более дерзко сказать простой вид запросов далее вы можете посмотреть как мисс об типами на таких запросов это какие-то запросы с которыми бороться весьма просто где-то у нас опять не хватает не хватает индекса да то есть но например можно сделать вот такой да вот если у нас в первом случае если мы прогоняем запрос без каких-то индексов будет делать фолд обласкан понятное дело это не не эффективно если мы создадим яндекс по колонке last name то все будет резко бегать бегать куда куда быстрее второй вариант да там это запрос который требует небольшой трансформация для того чтобы работа а вот эффективно да то есть вместо того чтобы делать дэйт от на вот это вот на ордер дейда там и сравнивать с функцией то есть сравнение между двумя функциями часто работает не очень эффективно да там особенно есть это нас какая-нибудь там старт функция не встроенная функция куда лучше и и переписать так чтобы у вас колонка была сравниться в данном случае с там яйца до вместо а вот то есть тоже такая типичная ошибка которая к счастью достаточно легко решается ну в итоге если свистит и все к достаточно таким простым парочки парочка советов то есть во первых отстройте какой-нибудь процесс чтобы ловить плохие запроса до того как они пойдут в продакшен вот опять таки наверное это выглядит совсем как какая-то глупость и который я говорю на самом деле у очень многих компаний такого процесса нету есть надежды что разработчики все сами сделают правильно на этом что они хорошо понимают как оптимизировать вскоре и так далее очень часто это не так второе предполагаете что проблема в продакшен у вас запросами будут на этом запросов продакшен помаду плохие запросов productions ломаются и имейте и настроить всякие летал и чтобы запросы плохие можно было легко поймать и разобраться с ними ну и последнее да там что не все проблемы которые будут с производительности связано да там именно который выглядит как базы данных связан непосредственно с до его из engine когда ли это будет что то на уровне и выше приложение когда-то на уровне ниже операционная система январе мента и так далее ну что на этом у меня все и я буду рад ответить на ваши вопросы добрый день спасибо за доклад есть пару вопросов первый из них как может получиться так что на мастера своего запросы отрабатывают по разному но на самом деле это может получиться очень очень просто дождь и на них разная статистика даже чаще всего дело в том что статистика в морское такой формой сколь вопрос да там она не реплицируется с мастера на нас лайфа она обновляется на мастере и славе но по независимо и нисколько не литерами мистически по этой статистики строятся optimizer и или оптимизируются запросы ну да понять статистика используется при оптимизации запросов по ней делается какой-то план который может получиться разной на мастере на слове то есть это вот наиболее типичной причина ясна спасибо большое и второй вопрос какое то время было такое что на новый скилл джейсон гибкая настройка колонок потом в sql типа добавляли джейсон и может быть планируется какие-то data warehouse элементы добавлять в школу не знаете в питерхаус майской какие-то моменты но на самом деле здесь все достаточно сложно да то есть как бы как знаешь майской участво им владеет компания oracle data принципе у них есть другие решения да там для какой то делитель house непосредственно не над этим в майской будут добавлять вряд ли что делается я могу сказать что у oracle делают специальную как бы там сторож женщины расширение которое называется rapid которая представляет собой и на энрико lonestar вот но это будет как бы коммерческое расширение которое работает только в oracle cloud да то есть они говорят что блин по нему она будет летать супер классно супер быстро что скорее всего сделаю это в майской это параллельные запросы дата то есть то есть я думаю этому это произойдет спасибо большое спасибо давайте переместимся сейчас вот запомним что у нас есть еще два вопроса переместимся в новосибирск послушаем что нас спросят из глубины сибирских руд друзья остыл ссылали дальше это проверку sky туда новосибирск сами ехали тут было круто короче я тут такой лайфхак придумал говорю ногти бирск а давайте мы зажжем вопросов больше чем питерс дадим и у нас аж три вопроса я не знаю лишь разрешишь этот м задать нас три ну давай мы будем быстро их задавать вот александр бородатый там может брата пристегнула прийти давайте да поехали три вопроса о себе как раз из иркутска союзах ссыльный недавно попробовали переехать на перво на кластер из трех мастеров через к прокси и возникла проблема из которой собственно два вопроса коротких optima ясно одну таблицу в итоге клаусу репликацию и под нагрузкой копились запросы в итоге репликации разваливалась весь кластер подала ее также под нагрузка появились зиму блокировки транзакции когда три мастера как это отловить почему то происходит вот он то будет быстро задавать ему дали быстро отвечать вопрос сложный у тебя 10 секунд вложен 10 секунд вот но нас раза новосибирска вот туда смотрели на dt правильный пример красавца на дату так смотреть вот ну ладно так значит много может быть и разных вариантов и по второму скажу да что когда используется пикси и синхронной репликации the light in se транзакции commit он понятно дело увеличивается из-за этого должно увеличиваться число блокировок транзакций да то есть это собственно говоря нормально этого требуется ожидать да там что с optima из той был там не скажу так там еще были второй и третий вопрос друзья они все убежали но это нормально не все здесь все мы здесь здесь все день тут недобрый спасибо за доклад у меня такой вопрос вот способ борьбы с тяжелыми запросами как материалов бью это все как бы плохой подход приемлем подход или все-таки ум побороться за оптимизацию запросов к какой подход я тесно гарнира слышал моя мать и материала и спилю операцию материализованные представления материала из дьюс понятно понятно нет но как материализованный лью это один из и есть подход в да там для каких-то вещей он таких запросов он подходит да там для которых может такие view сделал для кота для этих то он он не подходит да то есть однозначно что все запросы нужно решать с помощью матери lazerini мафиози нельзя использовать никогда но ты так сказать нельзя и 3 turbo вопрос партер добрый день спасибо большое за доклад а у меня короткий вопрос мне очень нравится идея мониторить production вот и мы им он сам дает какой-то impact на перфоманс или он вообще абсолютно прозрачно и можно его использовать всегда спасибо ну я бы сказал когда что бесплатного мониторинга производитель не бывает но м м у него вверх от достаточно достаточно маленький мы тоже сделали что он настраивается да то есть если ну можно снизить объем данных которые вы например собираем и этим снизить снизить overhead в принце обычно вирха это не более чем пара процентов так мини поклон в сторону сибири ребят спасибо большое за вопрос и давайте вернемся к московским вопросам петербург сказал кстати что ты красавчик и вопросов вообще нет все понятно в верните нам свет пожалуйста и вот раз и вот там был два об поехали спасибо за доклад у меня вопрос такой вот у нас компания проводит на груше тестирование с базой данных выводит там список топ запросов но я как-то скептически отношусь к этому нагнуться тестируем потому что то есть все таки сантехнические такие и от продакшена они мало чем могут мало похоже могут быть вот стоит вообще им верить или как это вообще по груше тестировали так значит а ответ какой во-первых нагруженное тестирование делать стоит во вторых нагруженными тестированию верить не стоит да потому что понятно что в продакшене будут найдены и какие-то еще другие другие проблемы которые игрушечный тест не поймал но обычно если вы используете на груше на это степенью поймаете там тоже кучу каких-то проблем раньше до того как они войдут пойдут на продакшн отлично так а вот здесь был еще вопрос рука рука вопрос убежали хорошо вот сюда передайте пожалуйста микрофон и через минутку мы все должны передать слово ну собственно вопросам вытекает из первого вопросы которые задавали относительно того что разный план получается на разных серверах то есть очень часто мы такую ситуацию на самом деле попадаем и она лечится у нас просто аль тертый болтами и на тебе мы в итоге по сути мы получаем дефрагментацию таблицы насколько хорош такой подход потому что мы уже больше не знаем как бороться иногда мы просто полностью фактически на самом деле вопрос да то есть вы горите что ваша проблема лечится тем что сделали alter tail да означает ли это что она была вызвана я фрагментация это еще вопрос потому что альфир travel он тоже обновляет статистику да то есть если вы мне чтобы я бы диагностировал так да то есть можно за форсировать план который у вас есть на старом через финты и посмотреть он работает быстро или медленно если с тем же самым планом но выполняется все равно плохо это скорее всего фрагментация если же просто план другой до вылазят то это скорее всего связано не с фрагментацией это связано 100 вас съехала статистика по какой-то причине и тогда можно уже разбираться там могут быть и баги могут быть нормальная ситуация почему она съехала и отличается супер скажи просто кому за вопрос в москве мы подарим книжку а кому вопрос но вот давай куда был человек с нагрузочным тестированию которого или он уже убежал вы здесь уже убежал вот как вот так вот видишь пропустил хорошо при значит вот кто здесь был следующего тут тоже был такой человек только что спрашивал них плохо видно с а кто есть вопросы да вот этой секции руку поднимите они там забежал не забыл это отсюда новосибирск был а отсюда на север хорошо давайте оставим просто признание нет ни тоже надувается кому-то да димка кто нас ещё вопрос прошел ты уже забыл вот вот вот но давали получаете признали хочу вопрос не сдавали супер отлично"
}