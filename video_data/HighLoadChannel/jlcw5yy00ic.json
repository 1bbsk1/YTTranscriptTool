{
  "video_id": "jlcw5yy00ic",
  "channel": "HighLoadChannel",
  "title": "Геораспределенные системы / Евгений Кузовлев (Т-Банк)",
  "views": 579,
  "duration": 2940,
  "published": "2025-01-17T02:24:27-08:00",
  "text": "Привет ребята я Женя Я инженер Я действительно работаю техническим директором в т банке Для нас Для всех привычнее называть его Тиньков но теперь это Т банк отвечаю Я в банке за всё что связано с двумя словами платежи и переводы и сегодня по настоящему Я хочу поговорить не про предметную область а больше про инженерию хотя мы будем какие-то примеры рассматривать в контексте предметной области Я хочу поговорить про архитектуру геора систем я не буду наверное рассказывать там Почему я тут какой у меня опыт Я скорее расскажу одну историю которая со мной случись на заре моей инженерной карьеры лет почти 20 назад работал в игровой индустрии был бум онлайн игр я не непосредственно игры делал а я разрабатывал систему которая предоставляла игроку Личный кабинет для множества онлайн игр и там было в том числе магазин потому что самое прибыльная доходная модель - это fre To Play можно было покупать разных премиальных лошадок Премиум мечи доспехи и так далее и 20 лет назад Мы подумали что мы крутые Инне нам Маро и делать из системы которая стоит На одном сервере геора спрею систему но мы были молодыми инженерами без достаточного опыта поэтому мы её с масштабированию кто-то Получил две лошадки кто-то получил два уникальных меча не очень доволен был бизнес но в целом ситуацию отыграли это конечно достаточно забавная история потому что это такая развлекательная область Но кажется что в более серьёзных вещах вещах связанными с нашими персональными финансами в вещах связанными например с полётами там в космос в вещах связанных с медициной Надёжность она очень важна и геора спредер таких вещей и здесь я для того чтобы поговорить с вами о геоны системах и о примерах собственно мы с вами сегодня разберём сначала немного теории которая лежит в основе этих геора спредеры ограничения откуда они возникают какие у нас есть классы этих систем А дальше соответственно мы с вами разберём примеры сначала примеры неудач люди которые пошли решили что как мы 20 лет назад можно погуглить загуглить какое-то решение его внедрить и будет Успех А также разберём гипотетический пример который потенциально показывает что не всё так плохо и эти задачи имеют решение начнём с такой небольшой вводной когда я говорю про эту тему мне иногда задают вопросы как бы ну вот геора спредер но там же есть ещё и оркестрация хореография связи систем Я предпочитаю называть системы которые состоят из множества разных независимых частей и где нет такого влияния сетевых задержек когда эти независимые части стоят допустим на соседних серверах Я предпочитаю их называть комплексными и мы сегодня про них Говорить не будем это отдельная тема которой можно посвящать несколько докладов и которые можно плотно разбирать мы сегодня поговорим именно про геора спредеры одинаковы в своём функционале но географически разнесены друг от друга например они в разных дата-центра хотя бы в разных стойках между стойками тоже можно порть сеть или стоят при этом внутри Они обладают одним и тем же функционалом вот про это мы сегодня и поговорим про ограничение таких систем первое откуда вообще возникает идея Да сделать геора предел ную систему как я уже сказал зачастую мы говорим про Надёжность мы говорим что Надёжность - это то что побуждает нас создавать такие системы мы говорим что Надёжность - это то что побуждает интерес у бизнеса и в основном все инженеры дется на две части Те у кого дата-центр уже был перенесён в облако и те у кого ещё нет На моей вот в моей карьере такое случалось дважды оба раза был виноват экскаватор под управлением дедушки Фернандо который приезжал перекладывании делал дорогу и случайно задевал телекоммуникационный колодец который шёл к этому дата центру Несмотря на то что дата-центры были в обеих случаях тир 4 резервированный там шло пять независимых лучей по счастливой случайности эти пять лучей были в одном колодце дедушка Фернандо их перел и дата-центр возносил в облака К небесам соответственно это то что нас побуждает это делать вроде бы если у нас есть Два дата-центра Нужно два одновременно дедушки Фернандо такого как бы вероятность Крайне мала соответственно это то что нас побуждает делать сразу перед нами встаёт Это вопрос а как мы будем синхронизировать данные в этих дата-центра та проблема про которую я говорил в самом начале когда мы давали два премиума две коняшки за одну сумму денег Это вопрос синхронизации данных и у нас вообще в принципе есть два ортогональных подхода один - это полностью синхронный подход когда мы ждём ответа от всех другой асинхронный Ну и посередине какой-то промежуточный вариант в котором мы иногда можем себе позволить работать если мы говорим про асинхронный подход то предположим У нас есть с вами три дата-центра Почему три Ну просто красивое число и потому что прекрасная датабаза данных idb может на три дата-центра работать Вот соответственно в случае асинхронной системы пользовательский запрос может прилететь на любую из наших НОД но эта нода сразу выполнит пользовательский запрос и сразу даст ответ а синхронизация с остальными нодами пойдёт в фоновом режиме в синхронной системе всё не так в синхронной системе мы должны ждать ответа всех нот и только после этого мы вернём Соответственно ответ обратно клиенту который послал нам запрос а с одной стороны это выглядит надёжно как швейцарские часы но это дольше потому что как известно система всегда работает со скоростью самого медленного узла системы для того чтобы с одной стороны нивелировать скорость работы увеличить её с другой стороны гарантировать определённую степень надёжности не стопроцентную но достаточно высокую применяют гибридные подходы это когда например мы можем использовать кворум у нас есть три дата-центра мы говорим что для ответа пользователю нам достаточно чтобы две ноды из т то есть большинство подтвердило что выпо оно готово дать ответ в этом случае самый медленный Датан самая медленная нода отбрасывается и нивелируется медленная скорость работы в некоторых случаях вот второй Аспект работы с геора спредер работы с геора системами - это по-настоящему то как эта система относится к сбоям на кажды из вас наверняка в свой профессиональной классическими СУБД в режиме репликации ма сй Что происходит если нарушается связанность слей просто останавливается говорит что он потерял связь перестаёт соответственно получать данные это системы которые не толерантны не устойчивы к разделению они теряют способность качественно обслуживать клиентов в условиях нарушения сетевой связанности есть системы которые устойчивы к разделению они продолжают обслуживать клиентов вне зависимости от того потеряли они связь из узлов системы или нет соответственно Это третья характеристика любой геора системы как она относится к проблемам на сети все эти три характеристики объединяются в то что наверняка многие из вас слышали читали кто-то даже применял в своей жизни теорема бюра Она же кап теорема то есть по факту вот мы берём три характеристики система - это Надёжность это согласованность данных и устойчивость к разделению и в базовой такой очень примитивной версии кап теорема говорит что мы можем с вами выбрать любые две из трёх одной придётся пожертвовать в реальном мире когда мы с вами строим геора систему мы не можем полагаться на то что сети будут надёжны в принципе сеть - это ненадёжная вещь Вы должны всегда строить геора должны продолжить обслуживание поэтому по факту ситуация сводится к тому что вот эта вот характеристика пар tolerance то есть устойчивость к разделению толерантность к нарушениям на сети она для нас обязательна и наш выбор ещё больше сужается мы вольны выбрать между надёжностью и строгой согласованностью и выбора у нас практически нет если смотреть на примеры сетей на примеры систем которых соответству этим характеристикам то Ну классика систем которые жертвуют строгой согласованностью это ДНС например или cdn системы любой ДНС сервер продолжит обслуживать запросы пользовательского браузера пользовательских приложений даже в том случае если он потерял связь со всеми остальными серверами но получит обновление от корневого сервера он только тогда когда восстановится связь тогда когда система снова обретёт целостность с точки зрения систем класса CP это Например Google B Table и производная этой системы Но кажется что реальный мир Чуть более сложен чем мир в котором вот мы просто взяли три свойства определили а выбрать даже можем не из трёх а только из двух это действительно так систему достаточно ри с которой напечатан кабанчик все наверняка как минимум слышали про кабанчика многие читали некоторые даже знают автора вот это вот он он выпустил два таких программных программные статьи потом можете залезть По ссылкам почитать их с критикой классического подхода КП теорема и этот классический подход он как бы по-настоящему нем несколько узок и он разворачивается в более широкий подход А в дополнение классической кап теоремы теорему пас елк что это за теорема это теорема которая дополняет одним но очень важным существенным условием классическую кап теорему что система по-настоящему может обладать дополнительным свойством в случае если всё работает штатно Если у вас всё нормально с сетью если у вас не вышел из строя никакой контроллер если у вас всё хорошо а такого Ну как бы 99% времени у вас вообще-то всё хорошо а то есть дополнительное свойство это свойство либо минимизация время ответа на клиентские запросы либо строгая согласованность что получается вот внимательный человек может заметить что вообще-то в условиях нормальной работы получается противоречащая с классической теоремой кап мы можем получить систему которая и обладает характеристиками доступности и устойчиво к разделению и обладает строгой консистентность как будто бы серебряная же если посмотреть на примеры этих систем то в целом вот для классов здесь указано указаны примеры И кстати здесь вот ответ на вопрос почему монгодб так популярна потому что в нормальном режиме работы она обладает всеми тремя свойствами но там есть нюансы поэтому инженеры которые у которых монгодб падала не всегда её любят кстати говоря опять же говоря например про другого представителя который на этом слайде кассандру это яркий представитель того класса систем который меняет своё поведение в зависимости от настроек у Кандры есть такой параметр как режим консистентность запроса его можно выставить в режим One либо либо это то сколько нот должно подтвердить выполнение этого запроса если мы соответственно выставим режим и будем использовать е которы есть в внезапно э система из класса становится системой класса PC То есть она обладает строгой консистентность очень важно понимать что разные системы в зависимости от настроек могут вести себя по-разному Ну кассандру редко использует настройкой просто знаете про это собственно Вот это такая вводная краткая теория про то как вот Какие основы лежат в терион Мы тут с вами строим лоды у нас множество дата-центров какую систему нам выбрать что нам взять кассандру Мон не знаю может быть что-то ещё здесь я предлагаю посмотреть на те примеры которые были вот в моём опыте которые я наблюдал в реальности и через эту призму другого опыта ответить себе на вопрос а что же для важно я расскажу Две истории различных компаний которые не использовали ни кассандру ни Мон но в целом при их подходе ни Касандра монго бы их не спасла честно говоря первые Ребята это транснациональная корпорация у него было три дата-центра в абсолютно разных местах нашего земного шарика Австралия Великобритания и Соединённые Штаты и у них машине оператора запрос на идут только базе данных а база данных была обычной My ребята подумали нас три Датан Давайте все их использовать Ну как бы ребята знали про проблему синхронизации данных решили что у них должна быть строгая консистентность и использовали такую настройку Как Лера CL CL - это такая штука которая стоит сверху серверов ИВТ за ижт них работает со скоростью самого медленного сервера Что произошло у них время комита выросло то секунды запросов с Толстого клиента идёт несколько десятков в процессе работы оператора операторы практически перестали Ну эффективно пользоваться системой В итоге они промучасток поменяем О'кей у них была система класса PC не подошло другие ребята уже у нас в России У них было тоже два дата-центра у них был дата-центр в Питере и дата-центр в Москве они решили что э видимо посмотрели на первых галера кластер не подходит Давайте Мы настроим дву направленную асинхронную мастер мастер репликацию На том же самом май сиквеле А у этих ребят было интересней у них сначала Всё пошло хорошо айтишники отчитались и получили премии о том что они запустили два дата-центра но у них был какой-то класс данных который редко использовался он редко в системе появлялся но этот класс данных был очень востребован И как только этот класс данных появлялся за него конкуренция среди операторов на запросы появлялось аэ ребята по-настоящему проработали почти полгода к ним пришёл финансовый аудит этот аудит выявил что они за полгода начали тратить на неустойки по договорам в десятки раз больше и когда они раскопали откуда такие потери Они выяснили что вот возникает конкуренция за данные подписывается два договора на один и тот же блок данных и один договор потом не могут исполнить потому что данные одна копия вот не могут и штрафы возникает вопрос А что делать-то ну как бы вот два примера ребята пошли попробовали со строгой консистентность решили ребята пошли попробовали с надёжностью и со слабой консистентность А по факту ответ в этом звучит в несколько иной плоскости мы не можем рассматривать систему исключительно исходя из технической составляющей Мы обязаны определять архитектуру исходя из паттерна поведения нашей системы Это наверное Ключевая задача инженера Как ни странно при проектировании геора спреем это понятие Как работает ваш бизнес как работают ваши пользователи с вашими системами предполагаемыми которые вы строите которые вы проекте здесь есть ть я наблюдал как инженеры по нему ходят наверное с десяток раз этот путь абсолютно провальный самое простое Что можно сделать это пойти к бизнес заказчику лучше кому-то уровня гендиректора и спросить Дорогой товарищ гендиректор А что для тебя важнее данные не потерять или надёжную систему построить в этот момент хороший гендиректор скажет что дорогой друг Ты же айтишник у тебя голова большая мы тебе денежек много платим иди Пожалуйста реши эту проблему сам для нас важно и то и то про примеры плохого гендиректора Говорить не будем Вот но в целом бизнес не может ответить на такие вопросы ему действительно важно и то и то и здесь вам как инженеру очень важно самостоятельно принимать решени Вы конечно можете пойти и спросить кае можем лимы поте о запрос из но по-настоящему такие вопросы тоже слабо понятны бизнесу ребят с бизнесом можно разговаривать только на языке денег в контексте А можем ли мы допустить себе платить штрафы в месяц из расчёта 100 руб 100 руб кажется можем 10 Мино наверное нет вот где-то в этом диапазоне очень размытом И вам принимать решение геон архитектуры я сразу хочу сделать дисклеймер это не пример банка Это пример основанный на архитектуры одного Европейского финтеха он сильно упрощённый но он рабочий Абсолют на 100% Давайте предположим что вы строите финтех и вы строите банк У вас есть у клиентов карточки И вам нужно контролировать Балан на этих карточках сиво звучат абсурдно и невыполнимо Понятное дело что вы обязаны делать систему которая устойчива к разделению сеть от неё никуда не деться И вам говорят должна быть минимальная скорость ответа Ну то есть как бы на все ноды сразу запрос не отправишь а с другой стороны Вы должны синхронно контролировать баланс как бы ну нельзя одни и те же деньги потратить два раза т лоб это звучит нереализованная я вам сейчас открою тайну вам не важна скорость вам важно чтобы эта зарплата пришла вам вот допустим пятого числа каждого месяца вот написано у вас в трудовом договоре пятого числа Вот пятого числа пожалуйста при этом если бухгалтер нажал кнопочку в онлайн банкинге в 11 утра а вам денежка поступила в 2 дня для вас это более чем Ок ребят и для большинства людей это более чем Ок это первое сценарий и в этом сценарии внезапно нет скорости но там есть большая сумма относительно всех покупок есть зачисления больше чем тра это статистика а вторая предметная область чтоэто покупки вы пришли в магазин вы что-то покупаете у вас транзакция кратно меньше зачислений Но при этом вы пробивается на кассе продукты на вас строго смотрит кассирша на вас нервно дышит в спину значит два покупателя которые остались 5 минут до закрытия продажи специфических товаров на ТТХ м нужна скорость вам нужна надежность вы не можете допустить чтобы 5 минут проходила транзакция покупки она должна проходить Вот так это обратная ситуация но здесь есть важное Дополнение это очень маленькая сумма относительно зачислений и внезапно Если на это посмотреть вот так можно родить гипотетическом У нас есть с митан вот ва есть на три составляющих и все три составляющих разложить по каждому из дата-центров но только два из них вы промаркирован для списания и у вас получается интересная картина запрос приходит на любой дата-центр запрос списания запрос писания маленький опять же в тех магических 98% случаев вашего баланса и эта нода может ответить соответственно на запрос Да я списала денежные средства сразу если она попадает в этот баланс она точно также сразу ответит отказом если запрос превышает сумму всех трёх балансов потому что она их знает но только в одном случае будет задержка если локального баланса не хватает а суммарного баланса хватает в этом случае нода сходит к другим ном скажет Дайте мне денежек взаймы у меня тут большая транзакция агрегирующие отсюда из этого примера мы можем сделать очень важный вывод система которую мы сейчас вот так вот очень быстро в двух словах обрисовали может вести себя по-разному в зависимости от того какой у нас пользовательский сценарий и какой у нас пользовательский запрос в случае списаний маленьких списаний система ведёт как себя как система с минимальным временем ответа в 99% случае в случае когда у нас идт пополнение мы консистентной сценария дальше это вторая важная мысль про геора спредер что важно зачастую строить такие системы которые ведут себя по-разному в зависимости от пользовательских сценариях коих у вас наверняка больше одного в ваших системах наверно последней мыслью что хочется сказать всё равно есть желание пойти в интернет почитать Хабр почитать другие статьи посмотреть доклады и сказать Ну как бы it мир не стоит на месте может быть нам помогут облачные распределённые базы данных самая популярная которая у нас сейчас есть самая крутая ребята реально сделали очень классную штуку ydb Вы можете пойти в облако Вы можете взять Бау данных и вы можете подумать что это для вас серебряная пуля и здесь яхо предо реч точно также как использование Кандры точно также как использование Мон нес Зай онные юнс таже сае ydb это тоже сист которая обладает онми ограничениями да ребята сли очень очень очень крутую штуку это действительно распределённая система которая поддерживает транзакционная модель Ну во-первых там оптимистичные блокировки ваше приложение должно быть к этому готово А вовторых это система которая имеет определённые паттерны нагрузки паттерны поведения которые для неё не являются оптимальными самый простой Если ваше приложение например использует монотонно возрастающие первичные ключи Они же например в пок то для это паттерн нагрузки потому что в этом случае данные будут писаться на одну таблетку и вы не сможете использовать просто возможности этой базы данных на 100% это я говорю Не к тому что вы не вам не надо её использовать вам нужно её использовать там где она вам действительно поможет а для этого вам нужно понимать пользовательские сценарии и реальные возможности тех технологий которые вы используете Итак Подводя итоги что мы имеем что надо стараться в первую очередь не выстрелить себе в ногу строя распределённые системы антипаттерн - это всегда пойти погуглить это ребята антипаттерн потому что в этом случае Вы прямо движетесь к провалу гипотетический пример архитектуры которая может себя вести по-разному и может удовлетворять запросами я вас я вам привёл мы можем подискутировать потом в кулуарах как это подробнее работает Ну и две наверно самых главных которые мне хотелось сегодня озвучить с этой сцены Первое - это то что вам нельзя перекладывать ответственность на бизнес в принятии архитектурных решений архитектура системы в ваших руках Господа инженеры и вы должны понимать предметную область бизнеса Вы должны быть немножечко бизнес аналитиками продуктами кем угодно но это обязательно и что важно те системы которые реально будут работать они в разных сценариях в разных поведенческих моделях будут представлять из себя по факту разные системы с точки зрения геора продел и отказоустойчивости на этом У меня всё ребят вопросы Жень Спасибо большое Пока вы готовите вопросы Давайте онлайну по аплодирую все кто нас смотрит в интернети ребята привет этот шум вам У кого есть вопросы пока мы отдаём э микрофон вы бесплатно смотрите трансляцию главного зала благодаря нашему генеральному партнёру мтсу раньше это был оператор сотовой связи а сейчас это ещё Кибер бес облака развлечения финансовые сервисы хорошо когда есть партнёры пожалуйста а Здравствуйте меня зовут Антон у меня следующий вопрос Вот вы рассказали что вы делите э ваши Ну все запросы там на списание зачисление Вот Но в геора спредер нюанс что есть пользователи локальные которые находятся в том же городе есть пользователи которые Ну В путешествии И на самом деле Ну в герас системе Обычно они приходят на тот дата-центр который им ближе ну там при помощи ДНС ещ чего-то там такого вот как вы это используете вообще Мне кажется вы затронули тему про которую можно ещё сделать опять два доклада это тема у нас 15 минут я буду я буду краток это тема роутинг пользователей действительно базово пользователь приземлится на тот дата-центр который он ну который к нему ближе но не всегда это так Потому что есть домашние дата-центры для пользователей мы можем роти пользователя по параметру есть специфичные истории когда мы пользователя по каким-то причинам прива к одному или другому в конце концов история с тем что у нас опять та же самая сеть может сбой нуть и у нас весь трафик завер вот так вот и мы пойдём Вот так да именно так но я имел в виду что тот пользователь который путешествует его запрос может обрабатываться гораздо дольше чем локального Да может это происходит повсеместно если что если вот вы с во времена несколько лет назад своей карточкой своего банка ездили в другие страны ва транзакции действительно дольше это факт Давайте все вместе сожмётся да да спасибо крутой доклад А скажи А какое максимальное количество мастер реплик Вот таких финансовых системах честных как бы встречалось вообще Ну вот десятки там не знаю три смотрите вот архитектура той системы которую я показывал она в реальной жизни работала по-моему чех дата центрах Я знаю что виза в своё время имела одновременно работающих вос кластеров каждый из трёх дата-центров при этом пользователь мог переключаться между кластерами то есть ну как бы 8 на 3 мы умножаем Да получаем вот количество Спасибо про СБО за сказал но вот то что у меня возник вопрос из твоего доклада ты вот на всём докладе говоришь что инженер должен быть должен курить правиль область и соответственно и соответственно уметь это применять Да какие есть Бест практис по поиску правильных поведенческих паттернов и натягивания это на архитектуру поведенческий паттерн есть антипаттерн - это перекладывание решений на бизнес А поведенческий паттерн ты имеешь в виду как как обратную связь с бизнеса Да конечно то есть соответственно Как как я должен стать ближе к бизнесу и согласовывать с ним то что для него будет правильно не должен согласовывать вот здесь вот есть нюанс что в тот момент когда ты пойдёшь согласовывать тебя проведут через 10 кругов ада и в итоге доколе бууу до запятой какой-нибудь или свинюшки в правом нижнем углу здесь очень сложная вещь по-настоящему которую зачастую надо принять это наша с вами ответственность и мы должны принимать эти решения просто говорит бизнесу Да мы сделали систему которая удовлетворяет вашим требованиям всё Ты знаешь знаешь анекдот про бюрократию Нет расскажи согласование пожалуйста Евгений Спасибо большое за доклад У меня вопрос про запись в мультимастер То есть у нас распределённая система финансовая транзакции и поэтому наверное при снятии допустим какой-то суммы все мастера во всех геопозиция должны согласовать эту транзакцию И лишь после этого отвечать пользователю Но это ведёт к увеличение латен вот можешь прокомментировать Нет это не совсем так если мы вернёмся к картинке Я позволю себе к ней вернуться А у нас есть часть баланса которая доступна конкретной ноде и в рамках этого локального баланса нода вольна совершать операции как хочет то есть если мы снимаем денежные средства эти денежные средства не превышают локальный баланс ноды то есть по факту 30% от вашего Я сейчас очень утрированно про 30% от вашего баланса то ноде не нужно подтверждение соседних нот это нужно только в том случае если у вас снятие между 30 и 100% выше 100 сразу отказ ниже 30 нода сама примет решение можно Да Жень привет Фёдор Васильев Тек Я наверное не столько Вопрос сколько чуть прокомментировать так в зал такой послать посыл Да что не бойтесь писать репликацию на самом деле об этом пол доклада было это действительно работает да надо очень много будет разбираться в паттернах Вот Но это работает и по поводу количества дата-центров Да их три запускали и четвёртый запускали на короткое время в принципе на четырёх это работало вот так что спасибо за доклад очень интересно передают слово дальше один из авторов системы не выдержал прокомментировал прошу про хотел бы спросить можно ли сказать что прежде чем проектировать геора спрею систему надо наверное себе ответить на вопрос вс-таки как мы управляем данными А это вопрос как бы следствие вопроса какие у нас риски какие у нас пользовательские сценарии Да конечно ну то есть мы сначала вс-таки должны разработать модель данных а потом уже понимать как мы правильно е управ Можно я здесь порю Для меня модель данных и потоки данных это разные ве модель данных быть определена до определённой степени проработки э но не на 100% прежде чем мы соответственно начинаем проектировать общую структуру системы А вот пожалуйста Здравствуйте спасибо за доклад А первое по поводу пополнения и снятия я правильно понимаю что система упрощена И на самом деле там больше подсистемы больше бизнес сценариев для которых там распределены уже условия Как должна существовать система то есть пополнения бывают разные и снятия тоже бывают разные и скорость их работы всё-таки будет разная пополнение снятия по-настоящему практически полностью отражены там есть дополнительные слой пересисленных вопрос реконсиляция сверок Они тоже за рамками этой базовой СХ А ещё вот момент с ответственностью опять вернусь к тому моменту что инженер должен на себя брать ответственность за решение Как должна всё-таки функционировать система Но это же на этапе формирования требований должно выявляться и согласовываться всё-таки с бизнесом тоже системной аналитика вместе системной архитектора вроде как должны это всё выявить и согласовать с бизнесом а не так что уже потом в процессе эксплуатации в процессе проектирования инженер сам почему-то решил что вот так должно работать Э смотрите во-первых Я в ваших словах вижу разделение ответственности системный аналитик должен Я предпочитаю нас всех с вами называть инженерами если мы говорим что системный аналитик должен согласовать А потом разработчик заходить о тестировщика потом протестировать у нас точно есть проблема а это с одной стороны с другой стороны Да конечно все Корнер кейсы все exceptions все вот эти вот узкие места должны быть определены на этапе проектирования системы но идти согласовывать с бизнесом всё до малейших детали это путь никуда ребята вас не поймут бизнес очень удивится Если мы с ними это не согласуем когда всё стрельнет уже на проде Значит надо это согласовывать на их языке на языке бизнеса Спасибо ты понимаешь Да Что вот этот ответ говорить на языке бизнеса когда ты се он стоит очень дорого и много седых волос и упущенных дней работы команды Да пожалуйста Добрый день Спасибо большое за доклад Извини пожалуйста перпендикулярно и в одно сантиметре раз спасибо большое за доклад вопросики есть цифра три Это очень хорошо Ну когда у тебя один мастер Там две реплики ждут А когда цифра се Как предотвратить разделение данных когда мастер о пробле на сети и начинается всякая Мар т и проблемы на сети так я правильно услышал всё но это как бы если у нас мастер О это не совсем геора спредер Вера которые готовы включиться в случае какой-то нештатной нагрузки я всё-таки под геора преден системой понимаю историю когда у нас каждая нода может обработать любой пользовательский запрос Спасибо добры Да спасибо за доклад А можно вернуть картинку с тремя кластерами ещё вот я так понимаю Каждый из кластеров имеет свой баланс и может запросить баланс у другого если ему не хватает а вот проблема на сети У меня есть 100% денег 30% на каждом Ну грубо там 33 в этом случае есть два локальных баланса которые находятся в модели они не последние но ты знаешь в локальном дата-центре последние балансы соседних дата-центров если у тебя один дата-центр оторвало то можно принять решение в допустимых границах использовать локальные балансы внутри себя это Exception puff системе которой можно отдельно обработать то есть в итоге придёт отказ или она всё-таки сможет обработать и потом она сможет обработать Возможно не на 100% твоих средств а на 9999 в зависимости от настроек принятия риска который берёт на себя организация в этот момент понял спасибо спасибо А мой вопрос включал в себя прошлый вопрос но интересно как происходит репликация системе Вот асинхронно а если ДЦ теряются сразу после комита Значит мы получаем модели косин это означает только то что у нас возникают определённые финансовые риски вообще в принципе в финансовой системе работаем с финансовыми рисками кто-то пытается украсть карточку это тоже риск кто-то пытается создать поддельный сайт но здесь у нас как бы слава Богу не мошенники здесь у нас просто ДД Фернандо проезжал на экскаваторе СБО Евгений такой вопрос каковая Обычно вот в практике построение таких систем степень дублирования данных то есть вот здесь на ви подозрение что в реальной Промышленной системе это больше то есть вот как по вашему опыту в Горячем режиме дублирование обычно двух трёхкратное ещё плюс холодный резерв в обязательном порядке который подключается со скоростью где-то до часа Ну то есть вот прямо в Промышленной системе каждый вот из этих узлов Мы можем потерять условно на час так вж в Промышленной системе мы при оден радах рять не сразу но последовательно все дата-центры кроме одного Да буде СОБРа Евгений здравствуйте я ту я тут справа у вас Здравствуйте Да спасибо за доклад очень интересно А скажите пожалуйста как нам жить с такой ситуацией когда у нас появляется один клиент который делает очень много запи Ну очень много зачислений списаний но То есть у нас получается условно одна сущность которая может в принципе спокойно укладывать все три ноды одним только своим существованием Ну наверное Мы уже подходим к вопросу который как бы является вопросом шардирование или партиционирование данных да В данном случае нам не подходит клиентский идентификатор В вашем случае мы должны это дело как-то разбивать либо по запросам либо по каким-то другим у нас когда мы работаем с большим сложным клиентом Да который генерирует огромный поток трафика по-настоящему мы разбиваем поток данных равномерно и мы допускаем до определённого момента модели Event cons то есть условно мы понимаем что у клиента баланс 10 млрд рублей например и он постоянно трант мы говорим что до баланса в 1 млрд руб мы разрешаем моде cons потому что риски примерно нулевые есть хо туда в бизнес часть правильно Да конечном все такие решения они все вот они Ты должен понимать эту бизнес составляющую буде добро Да здравствуйте Евгений спасибо Меня зовут Илья Я немножко тоже там вот про историю когда ещё карточки работали в других странах я сам самом деле пожрал все эти проблемы у нас было Мар слей у нас была галера у нас галера мультимастер была Я надеюсь не изх компах Слава богу нет у нас был стап в Ази финансовый даже ну нужно было как-то пожить в какой-то момент мы уперлись в простую проблему вот уже сейчас начался разговор про неё про шардирование когда мы выяснили что у нас есть страны где трафик Локальный это 99% и в принципе шардирование спасло нас до момента пока мы не упёрлись в каналы стран и когда ты из головного не можешь даже запросить нормально В эти 10 мегабит свой отчёт и продолжая эту историю мы нашли способ как ладный спастись это Аманов верси которая имела геора спредер кой обмена данных это такая небольшая реклама Яндекс сделайте яб также адб также практически умеет только там порог чуть-чуть выше но он тоже есть Ну вот у яб была проблема что когда тестировали такую же схему на нём задержка была ну почти под секунду я думаю если возвращаться к диалогу с wdb нам стоит подождать какое-то время где-то я надеюсь Год максимум Когда у нас появится приме не из Яндекса они точно появятся я это могу гарантировать Ну и тогда вот про шардирование сам момент А вот у вас если было шардирование упирались вы в каналы как вы это решали в данном случае если говорить Вот про эту историю то у нас шардирование не было у нас все данные хранились на каждом серре по факту режиме там условно вот этой вот eventual consistency Да Если мы говорим про нас там как Т банк сейчас то наверное мы не ходим всё в положении Когда нам немножко повезло у нас очень хорошие каналы Спасибо Спасибо друзья все кто пишет через через чатик вы Когда пишете вопросы Мы не все успеваем задать вслух Потому что тут очень жаркий оффлайн но я спикеров потом принуждаю приходить в чатик и они До конца дня отвечают в крайнем случае завтра ещё последний день хайлоу как бы последний день помпе да будь добры Да спасибо большое за доклад очень интересно вот у меня вопрос немного в другом направлении Судя по всему вот эти вот нестандартные паттерны паттерны нового поколения Поделитесь опытом где они сконцентрированы знания про эти паттерны И как вы организовывается команды чтобы они в целом были в курсе каких-то вот нестандартных подходов потому что как мой предыдущий спикер сказал что когда бизнес ставит задачу он не очень знает вот эти вот все новые паттерны подходы А когда программист программирует уже поздно так как уже условно говоря архитектура согласована Где у вас сконцентрированы эти знания и как вы эти знания транслирует в головы разработчиков которые участвуют в проектировании этой системы Спасибо у нас есть прекрасное активности внутри их в принципе можно делать практически бесплатно мых кстати практически бесплат это чтото типа внутренних Мита они на регулярной основе делаются то есть где-то примерно там один раз в месяц где мы вытаскиваем все наиболее актуальные решения Ну там мы банк мы сталкиваемся с импортозамещения для нас там актуальная тема как для многих коллег там использование постгрес вместо Oracle Да там вот мы там собираем какую-то экспертную группу которая пое граблей на этой теме и вот она выходит рассказывает есть с помощью информационных активностей шарим внутри команд эту историю ребята приходят пьют кофе общаются там кушают бутерброд заодно усваивают материал помогает можно тогда то есть мне как Тим леду условно говоря надо просто говорить моим программистам что ходите на эти активности и не пропускайте их и следить затим я бы порекомендовал не просто говорить программистам а вам как тем ляду прийти на эту активность и что-то рассказать даже если вам кажется что то что вы расскажете са страшно Вот спикера когда ты вытаскиваешь туда Да я ничего не делаю что я делаю Да это всем известно фига это не всем известно выйдите и расскажите во влетевший смотри он почти снял шапочку спикера и надел шапочку члена ПК друзья все кто задал вопросы махни пожалуйста рукой Значит во-первых надо вручить матрёшку матрёшку Хайда за вопрос максимально важный для сообщества или комментарий У меня два будет как бы подарка один за максимально важный а другой за провокационный На мой взгляд отлично за максимально важный вот там вот мне очень понравилась наша дискуссия вот молодой человек с бородой прекрасно матрёшка Да вторая у похлопайте Слушай вот это вот это заявка заявка ещ одна Ты можешь в круглом столе это в 6 вечера участ провокационный Мне он очень понравился вначале потому что он немножко так дискуссию прямо сразу подогрел про задержки от нашего банка небольшой тоже Презент класс Тут ещё ещё прель махни рукой А ну или просто потом подойдёте уже не возьмёте и у нас ещё от МТСа есть подарок Вот его кому махни ещё раз кто задавал вопрос тогда я наверное вот Сергею Да вот и в твоей жизни чуть больше МТСа будет отлично Жень ну традиционно тебе тоже тебе тоже меч не беги всё хорошо мы тебя ценим тебе тоже памятный приз от конференции куда вы девается эти худи Я не знаю вот я их ношу Но это прекрасно иногда их носит Моя жена это просто Великолеп Привет Аня друзья значит сейчас мы уходим на перерыв дальше Идём по программе L"
}