{
  "video_id": "I9V5Q2gu5dU",
  "channel": "HighLoadChannel",
  "title": "Database Sharding the Right Way Easy, Reliable, and Open source/ Esen Sagynov, Lee Seongjun (CUBRID)",
  "views": 311,
  "duration": 2786,
  "published": "2017-04-25T08:02:58-07:00",
  "text": "эпоха великих географических открытий продолжается шокирующая азия раскрыла нам не все секреты и сеанса гринов поведает нам о самых горячих новостях база строения из самого сердца южной кореи и расскажет о том кому и зачем понадобилось собирать команду высококлассных инженеров и делать еще одну универсальную базу данных ну так вот зовут меня ясен сагинов я работаю в корпорации энд янг и я являюсь разработчиком и менеджер проекта кубрик прежде всего хотелось бы поблагодарить организаторов за приглашение на эту конференцию для меня большая честь выступать перед сообществом российских разработчиков я уже второй раз а приезжаю в москву в россию первый раз я приезжал в начале этого года в апреле месяце тогда здесь была технология по интернет-технологиям и там мы первый раз выступали с докладом о проекте над которым мы работаем это проект который называется гибрид это проект с открытым кодом эта система управления реляционной базы данных всё работает на даже на конференцию тогда мы говорили о самых разных вещах и главный вопрос состоял в следующем почему в иначе решение разрабатывать нашу собственную систему управления база данных это задача довольно сложная мы попытались объяснить каковы причины нашей работы мы должны были рассказать о том прежде все кто мы такие для того чтобы стало понятно зачем мы работы в этом направлении мы являемся первой компанией apple iphone технологии в южной корее и это 13 по размеру интернет компания в мире в компании иначе работает около 30000 веб-серверов среди них у нас есть около пяти тысяч серверов баз данных в конце прошлого доклада я объяснял чему мы научились а при разработке гибрид сегодня я продолжу рассказ на эту тему но тут я должен кое-что объяснить те кто не был на предыдущей конференции должна что такой гибрид кубрик это а полноценная система управления базами данных это система открытого кода у нас нет коммерческой версии которые продаются за деньги все это можно получить по адресу кубрик . urb есть в оке быть очень интересные хорошие вещи одна из важных функций это нативная поддержка горизонтального деление базу данных так и зама sharding распределение балансирования нагрузки связи система очень стабильная и мы используем ее для обеспечения 118 веб-сервисов только для нашей компании в южной корее гибрид это очень известное название на последней конференции сдавалась много вопросов фактически оба дня гибели дошли вопросы 7 часов задавались вопросы очень много обсуждений про hi-black потому что местные разработчики ничего а этой системе не знали бы очень интересно я надеюсь что сегодня у нас а также все получится очень интересно и не хуже чем в прошлый раз сегодня главное оттенка на презентации состоит в том как мы другие компании работы с большими данными сегодня большие данные открывают для многих та пони большие возможности и компаниям нужны решение для работы с этими данными для хранения этих данных для анализа для наблюдения и тогда не я и так обычно есть два решения либо мы используем на усик могли бы мы используем обычный сиквел высекали все понятно там имеются возможности для общего интерфейса там можно легко переходить с одной базы данных на другую относительно легко в случае носик пол то тут нет общего интерфейса и все решения разработаны разными группами они имеют разную функциональность именно поэтому многие отказываются от такого решения но с другой стороны есть много компаний даже в россии вы знаете и которые используют но стеклом можно ли сказать что это решение хорошо поддерживает большие данные если так что видимо наверное вот эти компании не стали бы использовать нашу систему управления базами данных для управления ресурсами да именно эти компании по-прежнему по-прежнему по-прежнему полагаются на реляционные базы данных разным причинам например у них нет опыта сноу сиквел например что еще но усику не поддерживает тот или иной язык это тебе моменты и люди instagram и другие говорят что они используют rdbms шаринга мотивационные базы данных шардена ком почему потому что они них нет людей которые на усе по достаточно хорошо знают вот и мне хочется тратить время и ресурсы для того чтобы изучать новые технологии сегодня они также говорят что использует sharding dbms вот почему на усекла встречает сопротивление сообщить нету секула нету aside нету стандартного интерфейса но и для того чтобы завершить уже если там посмотрим на рыночную долю оракал который дает хорошую базу данных рыночная доля уракова на мировом рынке в почти 50 процентов южной кореи и вы даже больше почти 70 процентов это oracle на рынке баз данных и это один из фактов которые подтверждают что на рынок у нас действительно такой если вы спросите крупные компании то они скажут да реляционные базы данных это самый лучший вариант для хранения критически важных данных это то что они говорят да горизонтальное распределение баз данных сейчас распространяется системы высокой доступности горизонтальное разделение вы не знаете что такое sharding да я надеюсь что знаете а если нет то я но вкратце скажу что это такое у вас предположим имеется база данных 1 она выросла стала большой и вы решили хранить не в одном месте потому что индексный файл стал огромным и производительность уже падает поэтому выделить эту базу данных ставить ее на несколько горизонтальных распределенных систем и лишь ардов и в зависимости от этого некоторые данные попадают в одну базу данных другие в другую вот собственно и все вот эти горизонтальные разделы называются шар даме уже есть целый ряд решений для шарлин га не все базы данных с открытым кодом поддерживают в нативном режиме шарда есть решение которые закрывают эту брешь но проблема с существующими решениями внешних компании состоит том что они внешне они строятся где-то с какими-то компаниями есть некоторый риск того что ну риск сам вести несовместимости багов даже если вы решите использовать такие внешние решения то иногда установка идет сложная настройка идет сложно и компании иногда решают не использовать этих эти решение даже если решают все равно возникают вопросы а высокая доступность поддерживается автоматическое восстановления поддерживается балансировка нагрузки поддерживается а если вы используете какие внешние решения не всегда вы получаете сразу ответ на этот вопрос идеальное решение такое чтобы все было в базе на льна хуже чтобы все в родном режиме их поддерживалась балансировка нагрузки высокая доступность все что вам нужно в одной базе данных это было бы конечно великолепно особенно для разработчиков в котором был все равно они видят одну базу данных и больше им ничего не надо и что им там еще сколько там шарда все равно и и я должен сказать что есть такая реляционные базы раны которая все это поддерживает который имеет сеять всю эту функциональность мы дтп не работает базы данных называется kill breed ей 2 год назад появилась версия новая кстати появится уже бета-версии есть 90 и оно появится вот вот и все что я сказал она поддерживает даже до версии 90 уже версия 841 поддерживала pulling соединений балансировка нагрузки и высокая доступность в нашей стране это очень важно а версии 90 мы добавляем в родном режиме sharding очень стабильный в следующей версии в будущем году будем поддерживать автоматическую балансировку между шар даме и так одна из уникальных функций хардинга кубрик базе данных состоит в том что мы работаем она работает не только с q брэдом но и спайси кулам и вскоре мы начнем поддержку оракал мы уже дали такое обязательство у нас уже есть решение только дата его протестировать вот как поддерживается это горизонтальное распределение sharding вы имеете одну базу данных и запросы идут к этой базе данных а уже дальше наше программное обеспечение middle в зависимости от вашей стратегии определяет откуда из какого шарда конкретно получать эти данные потом выдаются данные пользователю что интересно здесь простота установки все что вам нужно установить кубрик и все а кубрик есть две версии есть под linux есть под windows всё это очень легко просто устанавливаете кудрин а конфигурация после установки может настраиваться легко есть только три файла первый файл shard конфета основной конфигурационный файл для шар дав вы указываете здесь просто какая база данных на какого пользователя какой пароль нужно вводить подключиться к тому или иному шар ду и указываете файл соединительной connection тексте где вы указываете имя базы данных где она находится то есть имя хоста на и айпи адрес и далее по умолчанию вы используете модульную стратегию по умолчанию у вас 256 модулей если вы хотите добавить вашу собственную логику в этом случае вам нужно предоставить имя файла туда где указано имя библиотеки дальше файл connection тексте там только три колонки шарда идеи имя базы данных и где это база данных находятся хост это либо куприт либо мой сиквел может быть даже разнородная среда некоторые шарды могут быть на ком brady другие на мой se que le и 3 тени в конфигурационный файл это ключ и мы сравниваем входящий входящих величину с тем что здесь сказано вы указываете vk.com диапазоне в какой диапазон должен попадать плюч а вот библиотека в которой вы можете сделать вообще все что угодно вам не нужно ваши ключи в ключах указывать целое число вы можете указывать адрес юрл если хотите и говорить допустим точка ру все это шар туан какие-то дот ком шар 2 любая логика здесь поддерживается есть два типа входящих величин либо целые числа либо строка настройка очень простая после настройки конфигурации вы создаете шарды создаете эти маленькие база данных и для каждой из них вы должны иметь имя пользователя и пароль то есть пользователь может получать данные с этим паролем доступ к этим шагом потом вы наполняете базы данных с таблицами одна и та же схема работает для таблиц что еще в кубрике работает шарды могут убить generic тейлз то есть таблицы который не разделяются на шар до этого вида может и помните что в шарди один есть одна таблица только для вас не для других шар дав и после того как вы все достраиваете вы создаете базу данных и запускаете и и вот каждый шаг запускается отдельно на каждом посте а для выброс работников нужно знать юрл для соединения номер порта имя базы данных имя пользователя пароль все работает команда запроса есть результате все запрос поступает базу данных кубрик нашим мир определяет куда как а муж орду обращаться какой там идентификатор шарда происходит запрос получаются данные и выдаются данные пользователю внутри команды и сиквел а вы должны ну во все в качестве опции указать shard допустим номер студента student амбар и в зависимости от этой величины вы должны обратиться к тому или иному орду и вы должны можете дальше указать сиквел hand что вот в этом месте это все находится то есть всё это можно указать есть три здесь подсказки 1 шар какие то есть ключ шар да вы сами указываете имя шерлок которому будете обращаться второе это шар 2 или вы указываете ключ лезли если у вас но если вы пытаетесь не указывать колонку конкретно а просто указываете что вот величина используя киев для поиска шарда об и назад третье это вот если у вас есть общая таблица generic тайбл вы знаете что данные находятся здесь то тогда вы можете указать шарден тире катар 3 и запрос идет конкретно туда и так каким образом танцую для всех случаев у вас есть метод обычно когда люди пользуются шарден дам первая проблема состоит в том каким образом обеспечить уникальную идентификацию в кубрике есть разные решения которые можно здесь использовать либо наши собственные либо есть нова и бюро в не есть внешне лично я предлагаю пользоваться поддержкой уникальных чисел 64-разрядных они присваиваются последовательность и даже если у вас есть этот сервер который тоже генерирует последовательной логикой вы знаете где этот этот шар да это база данных тоже может в общем так гарантировать что все равно у вас база данных будет присваивать уникальные идентификаторы и разработчику не нужно просто об этом думать далее вот вкратце как обрабатывается запрос и как получается ответ то есть у вас вы получаете запрос вы обрабатываете он обрабатывается в бедовый базе данных и затем идет обращение к лорду а шарды всегда имеют независимые других средства резервирования в этом плане шарды друг другу не мешают и каждый шар имеет мастера если его вот если мастер shard падает to sleep автоматически подхватывает рабочую нагрузку вот предыдущий как на предыдущей конференции в апреле вот я уже говорил о том как работает sharding ну и если вас интересует это подходите ко мне после презентации сейчас давайте поговорим о пред производительности для того чтобы проанализировать как работает shard хорошо работает или не очень что таково производить король производительность шар генгам без него чтобы сравнить мы берем web service and drive который похожим на google drive персональная система которая используется у нас довольно популярна и в этом случае мы генерируем ну у нас есть система моделирования нагрузки 7 лайков вот себе литр который нагружает систему данными генерирует данные похожие на реальной и так какова максимальная производительность в тех или иных ситуациях к вот каковы сроки реагирования и чтобы получить эти данные мы для начала должны определить максимальное количество одновременных запросов которые будет генерировать наш наша система лучше не рейта and drive & drive генерирует максимум 256 запросов в секунду аппарат на эти данные мы используем 256 одновременных запросов и с такой одновременность юку bridge apc может обрабатывать почти 14 тысяч запросов в секунду то есть 50.000 транзакций в секунду это было первое измерение первый результат второй вопрос нужно ли нам использовать шарм или нет с душа где нга мы использовали просто базы данных кубрик sharding работал только на уровне приложений не на уровне порой до базы данных и мы ходили посмотреть шарден какой прирост производительности дает мы нашли три вещи если мы используем кубрик sharding стол во первых нагрузка на стопу на каждом посте резко падает падает время реагирования реакция идет гораздо быстрее и мы можем больше запросов обрабатывать в секунду вот на основе этих результатов во время моделирования во время испытаний бета неделю назад мы перенесли некоторые базы данных на конфигурацию с шарден ганс и второй тест производительности это хорошо известный benchmark стихе би си си и и вот какие результаты мы получили сценарий был такой мы использовали последнюю версию кубрина 90 и мой сиквел 55 28 конфигурация была по умолчанию кроме размеров буферов мы увеличили его 2 2 и 80 гигабайт нас обеих баз данных и в этом сценарии sharding использовался с одной базой данных который было 9 таблиц берем 5 миллионов записей в них была и вот какие результаты вы получили по бенчмаркам тебе сиси производительность была примерно одинаковое в массе кулев кубрике 5 песен в кубрике чуть-чуть побольше если мы подведем итог по шар рингу в кубрике у нас автоматически я используется pulling соединение автоматически нет балансировка нагрузки 8 шар дав автомате с автоматической поддержкой резервирование и аварийное восстановление у нас имеется не ограничены в принципе количество шар дав если вы хотите увеличить производительность и шарден гавай системе то у нас есть программное обеспечение medley которое позволяется до сделать позволяет увеличить производительность и вы можете каждый раз добавлять речи новых буксиров новых прокси новых брокеров для того чтобы увеличивать производительность каждый sharp может иметь также общей таблице 4 стейплз таблицы которые не разделяют пожар за если вы точно знаете что данные не будут расти то можно использовать такие generic tribal с общей таблице для в одном шарден и наконец в плане стратегий можно использовать разные стратегии можно использовать ваши собственные библиотеки и это хорошо мы сами ими пользуется как убедить short это очень легко и просто никаких проблем с конфигурацией и просто устанавливаете кубрик и все там уже как говорится включена это действительно надежное решение мы используем сейчас кубрик мои все простые инсталляции кубрик переносим в среду с шарден гам самая большая инсталляция это and drive and drive находится в японии этот сервис мы поддерживаем автоматический free under мы гарантируем высокую производительность в общем то данные их целостность мы поддерживаем несменяемость поддерживаем и в отличие от других решений open source которые поддерживается сообществом разработчиков кубрик поддерживается компанией н и ч н это самая крупная эти компании в корее у нас очень мощные сообщества разработчиков на корейском рынке и начиная с 2009 года мы пытаемся предоставить и другим глобальное ever can рассказать что есть решение open source которая полностью бесплатно и в котором включено все потому что по большей части разработчики в других странах просто не знают об этом вот и все и наша цель состоит в том чтобы рассказать им об этом решении решения есть мы работаем с ним она поддерживается самой крупной корпорации южной кореи что дальше будет происходить скупые там я уже говорил что сейчас версия 90 уже практически есть она подго поддерживает автоматическую ари балансировку нагрузки в следующем году эта версия выйдет на рынок поймем и этого мы увеличили в данной версии в 9 производительность q брэда и шар кинга и до версии 90 у нас уже было 90 процентная совместимость с масику поддержка с поддержка оракла множество функций оракла всех иерархических запросов аналитических запросов версии 90 мы расширим совместимость 40 вам до для статистики и далее мы усовершенствуем совместимость с масик валом и 40 вам почему мы это делаем потому что у нас очень много серверов которые работают с оракулом и с microsoft сиквел исмо и сиквел поэтому постепенно пытаемся перевести все с этих серверов на кубрик но для этого нам необходимо иметь решение которые будут поддерживать множество вендоров разнородное решение multi window ские решения oracle а есть хорошие функции мониторинга и и будем поддерживать эти функции в следующей версии q брэда как я уже говорил вам раньше мы не заставляем никого переходить на кубрик мы не хотим чтобы все что у вас было мы выбросили и кубрик установили работали только с ним мы там это даже не нужно мы хотим просто сказать следующее знаете что такое решение есть конечно если вы хотите вы можете их посмотреть если у вас есть время вы можете попытаться поработать с этой базой данных можете посмотреть как мы решаем те или иные проблемы можете посмотреть насколько вам это подходит или не подходит вы можете но все что вы делаете нам нравится вы можете пообщаться с вами через блоги этого нам достаточно это нам поможет конечно дальше разрабатывать нашу систему поддерживать или еще лучше чем сейчас и вкратце это все что я хотел сказать вам сегодня я был бы рад если бы вы мне задали какие-то вопросы и самое интересное для меня это именно свободной дискуссии поэтому пожалуйста если есть вопросы задавайте алла спасибо на кубрик действительно кажется мне интересным я пытаюсь сейчас загрузить но не могу для mac os найти никаких пакетов можно ли это почему вы не хотите чтобы поддерживал нас мака с в родном режиме это вопрос закона и конечно и многие пользователи могут всего задать имеет права в чем причина во-первых обычно на рынке нет множеств много установленных маг серверов слишком много ресурсов нужно затратить на то чтобы кубриков ска база данных работала на этих серверах для этого нам нужно это сделать пока этого нет и windows мы поддерживаем или на кс поддерживаем пока-пока вот так к сожалению у нас в ближайшие версии поддержки маг не будет но у нас есть а перед пожалуйста и если вам хочется напишите свой интерфейс протестируйте посмотрите на вашей виртуальной машине под линуксом это то что я делаю всегда для тестирования добрый день а если я правильно помню когда кубрик когда поступает запрос в мастер базу данных база данных выбирает с каким шар дам и работать где читайте то есть у вас появляется единая точка сбоя на домены и машине я прав если я правильно вас понял здесь я не ну вопрос конечно хорошая еда я показал вам что у нас есть бил vr и это program- это программное обеспечение промежуточного уровня d2r она поддерживает функции высокой доступности там может быть много программных средств медовые они могут работать в режиме чтения записи или только почтение вы знаете что некоторые вещи не меняются просто считывается и все и вы говорите что этот брокер этот шар и это миду vr должного работать только здесь вот этот этот этот шар и все только для чтения и все что вас для чтения все эти запросы вы отдаете туда и хорошо что кубрик shard он поддерживает аварийный подхват у вас может быть много брокеров и если какой-то брокер падает то другой брокер подхватывает аварийный подхватывает рабочую нагрузку а кто кто рассчитывает данные из шар дав medley надо посмотреть на архитектуру поподробней для того чтобы ответить на этот вопрос медовая имеет три процесса подерживает 3 процесса первый этаж арк брокер 2 это прокси и 3 это процесс который реально связывается с данными которые находятся на система хранения названием его каску bild applications сервер cos cos может быть для кобре да и как для моей сиквел а этот процесс это процесс чтения когда в кубрик поступает запрос он смотрит на балансировку нагрузки в зависимости от внутренних политик об этом принимается решение о том на какую и прокси отправлять этот запрос и тогда прокси это процесс который создает соединение между вашим драйвером и q брэдом и потом прокси внуть внутри смотрит проверяет стратегию шарден гаи обращается к тому шарден га панорама нужно через к сакас считывает данные и напрямую отдает их пользователю вот такой процесс у нас внутри происходит затем вам говорю просто что есть мир мир состоит из целого ряда процессов это все прекрасно до тех пор пока мы работаем в одной и той же сети а если же мы работаем на разных континентах может быть надо как-то протокол усовершенствовать чтобы он отвечал мне данными с помощью промах серия может быть клиенту показывал где данные искать думали об этом операция в нашей компании у нас много серверов в южной корее много серверов которые находятся в японии у нас есть межконтинентальные сети у нас есть очень популярные игры в японии которые одинаково популярны в корее и в японии у вас нет проблем с задержки сигнала в этом случае мы так а сформировали эту архитектуру клиенту не нужно думать о том что происходит вообще внутри все что делает клиенты это отправляет отклик и пущает результат отображают из дат в приложении даже если взять меч и или функцию шар zynga когда вы их добавляете вы можете что-то поменять и тут есть поддержку шар зико там нет поддержки клиенту не нужно об этом обо всем думать все что им нужно это всеравно части тут мы считаем наиболее оптимально архитектуры и последний вопрос дуэли вы а мастер репликации может быть у вас есть какие замечательные мысли по этому поводу у нас было в 2010 году родишься добавлено так у нас используется о комплексной аппликация мастер sleeve все это проделывается всегда поддерживается и собственно sharding поддерживая эти функции также большое спасибо а вы говорили о десяти процент и несовместимости с масик валом где именно находится это несовместимости в чем там проблема я что-то не понял поясните пожалуйста не вы сказали что кубрик совместим с масику билета на 90 процентов так где имеется несовместимость и почему именно она имеет место недостаток времени или какие-то принципиальные проблемы у нас есть определенные планы внутренние относительно следующих версий есть приоритеты относительно разработке новых функций говорят нам нужна такая то функциональность мы используем мое сердце и мы хотим перейти на кембриджа у нас есть приложение которое используют моя сиквел syntax и кубрик не поддерживает и мы думаем насколько важен этот syntax может быть какой то небольшой модуль этого сервиса использует это если мы не можем переписать если нам нужно использовать этот функциональный элемент то мы его добавляем есть где-то 150 крупных веб-сервисов который мы поддерживаем у нас активно используется москву и урока мы анализируем какие функции используются на всех серверах по всем в приложении мы анализируем то что мы на портировать на гибрид и соответственно добавляем поддержку там где кажется необходимым большое спасибо за доклад и сын гибрид похоже это очень интересное по всем совершенно замечательно но скажите следующие в чем его минусы в чем недостатки первая главная причина почему мы барик на войне использовать kill бред состоит следующим у нас нету важны стороны системы и версия 2 из анкет испытывает ресурсный голод если можно гордиться если есть хорошая аппаратная часть он будет работать быстрее всех но если оставить один гигабайт оперативной памяти то будет производить хуже чем в массе кули или может быть оси kool-aid я не знаю не тестировал точно но так нужно думать о вашей среде рабочий о вашему партнеру извлечение о облаке в котором вы работаете какой уровень у вас имеется на сколько большую вас трафик и зависимости от этого вы можете принять решение в какие-то моменты для ваших задач пудинга зачем вам нужны обширной функции но если вам нужна и чей-то в масик или этого нет если вам нужно тивные нативная поддержка шарден га тогда да тогда это решение очень актуальна она совершенно бесплатная но все построено открытом коде вам не нужно ломать голову над лицензиями вы можете создавать предложение на арке вроде коммерческие приложения и не нужно задуматься о том чтобы платить какие-то деньги n-ый член все делается на клиентском на уровне все очень приятно вопрос по шарден гу поддерживаете ли вы запросы кастрированные сегрегации в этой версии 90 мы не поддерживаем агрегацию во всех разделах во всех шарлах у нас в у нас и были соответствующие разделы и мы и планировали добавить еще один который назывался sharp пол и он давай информацию о запросах о получении данных которые решились бы в статистике по всем сортам это было бы работоспособным но у нас пока что не было ресурсов для реализации этого в версии бета но все это в планах есть интересный доклад спасибо я хочу вот о чем спросить о поддержке когда в языках программирования а что именно какие языки поддерживаются иначе это java мы работаем сессий это теперь у нас в у нас имеется а печки питер руби питон недавно мы добавили но уже с а до b dot net большая часть всех широко используемых технологий поддерживается нету ирунга нету планов а по поддержке эрланга потому что мы не знаем с алисой которая использует и который бы хотел использовать одновременный kill бред вот такого имеющаяся поддержка еще у нас где-то пару минут в нашем распоряжении есть да еще две минуты . 4 способ"
}