{
  "video_id": "9S5fZUNzqT8",
  "channel": "HighLoadChannel",
  "title": "Мониторинг сложных систем в 2019 году / Евгений Потапов, Сергей Спорышев (ITSumma)",
  "views": 2991,
  "duration": 2906,
  "published": "2019-12-05T12:52:39-08:00",
  "text": "так ну всем привет меня зовут сергей я из компании эти сумма к сожалению мы доклад готовили вдвоём с моим хорошим другом и коллегам евгением но по определенным причинам он не смог сегодня присутствовать но он передает всем пламенный привет сильно как бы не грущу потому что я к этому уже привыкший и я хочу представить вам наш доклад по поводу современного мониторинга что изменилось и что нужно делать чтобы не проспать проблему и чтобы ваш проект всегда был хотя бы 99 и 9 аптайм соблюдал так ну немного о себе еще раз меня зовут сергей в эти сумме я руковожу отделом высоконагруженных проектов уже более 10 лет в разработке то есть я разработчик я не админ пишу на всем на чем можно и в последние года полтора занимаюсь консалтингом по внедрением различных devops методологии и занимаюсь также еще обучением кубер нити суд для разработчиков и вот со своим багажом я хочу поделиться кейсами которые встречаются в нашей жизни для тех кто не знает компания эти сумма мы работаем 2008 года основной бизнес у нас это техподдержкой и круглосуточный мониторинг при этом также мы занимаемся построением различных строк сложных архитектур инфраструктур последнее время занимаемся big data и индустриальным интернетом вещей у нас уже более 400 клиентов это если в числа перевести порядка 10000 серваков на обслуживание и наверное порядка уже 20 процентов российского e-commerce а нас уже больше 100 человек мы распределены на четыре офиса головного офиса то в иркутске у нас находится джок что зал называется томской оэз иркутска а иркутска там соседний зал вот так же у нас есть офис в москве и в питере и у не так давно открыли офис штатах для работы с американскими клиентами ну тут наверное видно какие кого мы обслуживаем например сайт хабрахабр сочетают его саппорте мм и мыса портим ну очень много различных сми различных интернет стартапов проектов знаменитых и всех их мониторим тоже мы так вот как мы вообще до этого докатились что вообще изменилось за последние 10 лет в сфере мониторинг давайте немножко отмотаем время назад вернемся 2008 год когда мы начинали работать обычный в проект выглядел примерно вот так у нас есть одна железная тачка на ней крутится какой-то веб крутится какая-то база нам ее нужно за мониторить ставим конь zabbix либо любой другой удобно для вас инструмент и какие-то отдельные то есть проверки совершаем руками то есть например что пользую мы мониторим ответ странице там вес размер скорость ответа какие-то накручиваем кастомные метрики то есть например время последнего заказа в интернет-магазине скорость ответ от и в принципе у нас практически 100 процентов мониторинга покрывалась автоматически то есть нам практически ничего не приходилось поверх этого докручивать проходит сколько-то лет проект растет развивается мы начинаем его с кейлин у нас появляется например отдельный поисковый движок и работает она как-то все все все вот так вот то есть стрелочками попытался это отобразить при этом у нас появляются какие-то внешние сервисы но все равно большую часть мониторинга мы точно также закрываем установкой какого не zabbix а с этим всем живем отдельно также включаем ручной мониторинг то есть например проверяем что у нас товар например те же самые товары в поисковом движке обновляются индексируются проверяем интеграцию например с какой-то платежной системой что нас у нас она внешняя система платежная что у нас она отвечает она принимает наши денежки и точно так же мы организуем ручную проверку запросов то есть мы мониторим что у нас пользователь видит наш сайт при этом так как у нас уже несколько выебав мы мониторим что пользователя не выкидывается сессии то есть при при переключении на какой-то отдельный веб и вот этот у нас график немножко красная часть его увеличивается то есть ручная настройка мониторинга начинает занимать порядка 25 процентов и при этом все также 75 процентов то есть там те же самые инфраструктурный мониторинг при этом у нас уже может быть не один сервис сервер у нас уже может быть там несколько серверов серверов мы начинаем все это размазывать по виртуальным машинам и автоматической настройкой становится где-то на 75 процентов времени проходит еще какое-то время и сейчас будет замечательная история из жизни в которой я был очень хорошему задействуем лицом кому-нибудь как раз приходили с криком за мониторе нам пожалуйста все очень срочно кто-нибудь слышал такую фразу своей жизни круто а приходили с полным вообще комплектом то есть две недели до релиза 15 команд 25 разработчиков и при этом еще с полным полным комплектом технологий которые можно вообще утихнуть в проект то есть часть проекта на пике часть на питоне что-то на кошечки к что-то на но джесси есть еще там кафка и в конце вываливают вот такую схему за мониторить нужно за две недели а какой звук вы сдадите в первую очередь я думаю как бы все слышали этот звук звук растерянной мартышки а почему так происходит то есть у нас ручная нас ручной мониторинг становится за ним начинает занимать большую часть времени которую в принципе нужно потратить на мониторинг всего нашего проекта то есть у нас вот появляется во первых кого кластер на инфраструктура у нас появляется микро сервиса у нас понять появляется шина данных очереди очень большое количество внешних сервисов а также все эти сервисы как то должны все между собой взаимодействовать и собственно говоря почему у нас все стало таким красным давайте разберемся ну как я уже сказал у нас снижается мониторинг базовая инфра то есть мониторинг железо системного плотность на него практически времени не остается очень сильно мы начинаем завязываться на мониторинг бизнес-логики нашего приложения то есть о том во-первых как взаимодействует пользователь видит ли он то что он хочет видеть это как сервис и взаимодействуют между собой с окружающим миром все это нужно мониторить у нас возрастает уровень абстракции если раньше мы спокойно сидели например ладно на двух железных серверов на одном у нас крутился веб-сервер на другом была база данных сейчас у нас есть 10 серверов поверх них размах размазан кубик кто какое пользуется кубиком вроде нравится мне тоже не мне нравится он классный и все это нужно как-то мониторить и поэтому давайте я сейчас расскажу такие частные принят примеры почему все покраснела во первых не существу не существует волшебного инструмента если например в данной ситуации вам посоветуют давайте поставим прометей поставим графа ну накатим то нам нужно экспортер кубе стать metrics и все и все будет за мониторе на она не будет за мониторе на ни в коем случае то есть нельзя поставить волшебный инструмент который все сделает за вас также не существует волшебного человека который это сможет понять то есть у нас есть обычно на мониторинг проектов выделяет там 1 1 2 человеков а тут пришло 25 разработчиков которые поделились на 15 команд а почему не собстна игра поделились то есть каждая команда разрабатывает свой отдельный пункт сервис свой под продукт и особо не понимает даже как работают другие продукты другие другие 14 команд тут мы приходим к двум людям мы говорим за мониторьте то есть они должны во первых понять как работает каждая из приложений как они взаимодействуют между собой и за две недели это сделать не возможно также пришли как-то раз у нас разработчики мы поставили горит кафка у нас есть там говорить очереди за мониторьте нам кафку если мы за monitoring of cum и ни в коем случае не будем знать что у нас вся логика приложение работает то есть можно базово за мониторить штамм бисквита топике что нас появляется сообщение уходят но корректность работы приложения мы никак не сможем проверить просто за мониторе в кафку и нельзя за мониторить просто какой-то статус отдельного приложения что но там живого что она работает потому что немножко позже расскажу почему и такие 4 водных тезиса к чему мы в принципе пришли очень часто очень хорошо когда люди понимают что мониторинга их проектов нет гораздо хуже когда они не понимают что мониторинга нет они думают что он есть что там есть какие-то у них на графике есть какие то ли рты но они не видят то что проект вложиться то есть почему так происходит мониторинг это не проверка работы проекта мониторинг эта проверка корректной работы проекта ну и давайте собственно разбираться как с этим нам жить во-первых мониторинг современного какого-то программного продукта программного сервиса там вашего супер стартапа это отдельный проект ему нужно подходить как отдельному проекту соответственно его нужно планировать давайте с этим разбираться во первых ни в коем случае нельзя оставлять мониторинг на потом то есть местный мы пришли за две недели до релиза давайте все мониторить и и мы поняли что у нас два наших админа не невку никак не смогут за две недели понятия при этом еще давайте усложним задачу нас нет документации ту схему которую рисовал она уже не актуально потому что нарисовали неделю назад а уже все все все все все поменялось то есть за две недели это сделать в принципе невозможно то есть vaper либо нам придётся полностью стоппи топать разработку либо например если мы вышли на кой то пруфов концепт и проект уже начал на приносить какую-то финансовую прибыль понятно что бизнес будет не согласен останавливать разработку бизнесу будет важно за деплоить еще 10 новых фич чтобы он стал приносить ему еще в 10 раз больше денег по этому бизнесу важно объяснять что как какую важность имеет мониторинг для нашего проекта и как я уже сказал только разработчики понимают как оно все работает то есть админ никогда не разберется как работает от именно вот этот вот это гоночное приложение вот этот сервер на но джесси только программисты способны дать оценку понять как как это они должны объяснить как это мониторить что с этим делать и что здесь делать если она перестала работать и очень такой важный кейс самое важное как понять что наш проект не работает у нас его не могут с ним взаимодействовать пользователи поэтому мы очень часто в последнее время предлагаем выстраивать мониторинг сверху ни снизу как мы это делали раньше начиная там с мониторинга железо потом системного по и только потом приложение мы сейчас очень активно топим за то чтобы мониторим шел сверху то есть во первых мы должны мне за мониторить наши приложения как бизнес-единицы то есть их логическую составляющей что во-первых пользователь может с ними взаимодействовать и остальные компоненты на 6-м этаже могут с ними взаимодействовать и взаимодействовать корректно затем мы переходим к монитору мониторингу инфраструктуру то есть к системному по и к железу то есть здесь в принципе все понятно и после этого мы предлагаем заниматься мониторинга приложение как инженерные единицы я чуть позже расскажу чем это все отличается после этого дополнительными бонусами которые могут вместить параллельно во первых это организация лифтинга и организация сервис discovery потому что разработчики я сам знаю сам разработчик люди немножко без бак безбашенные они выкатывают много новых новых наук приложений и за этим нужно как-то следить нужно понимать что какой-то новый сервис который за тепло или в наш кумир нить из кластер как-то либо автоматически либо по не было понимание что его нужно обмане турить и самый важный кейс мониторинг а должен идти параллельно с разработкой нашего проекта ни в коем случае на потом если например вы вашу abs команду стали выделять в последний момент на организациях той последней себя сиди решений песочный для разработчиков либо каких-то еще других задач мониторинг вы обязательно пропустите и возможно никогда уже его не добавлять потому что разработка улетит гарду туда вперед и мониторинг будет ее постоянно догонять но актуальность вашего проекта он никак не не догонит давайте сейчас быстро разберем из каких частей состоит на вас мониторинг потом по каждой отдельность по отдельности пройдемся во первых а предложение как бизнес-единиц а то есть мы мониторим бизнес-логику нашего приложения мы мониторим их статус и и проводим так называемый нетрадиционный мониторинг очень интересная вещь сама этой фигнёй как-то раз занимался дальше инфраструктурный мониторинг это мониторинг уровня архыз регистрации мониторе ну там системного по мониторинг железо всем все понятно и мониторинг уже приложение как инженерные единицы то есть это работа с его лагами и the applications перформанс менеджмент мониторинг и tracing теперь такой небольшой дисклеймер а чем это все мониторить то есть мы составили уже как так называемый план мониторинга то есть мы поняли в каком этапе что мы мониторим как мониторим поэтому следует что мы 1 должны сделать это выбрать те мы будем мониторить то есть такие у нас нужно решить вопросы во первых это сбор данных и визуализациям хранение данных чем мы будем анализировать логе чем мы будем тратить очень важно это выбирать только после определения плана мониторинга потому что когда вы определите что быть и мониторить как вы будете это мониторить а у вас уже есть наш готовый какой-то набор инструментов может возникнуть 2 замечательных ситуации первое этот инструмент не способен это делать второе этот инструмент для вас слишком избыточен и можно обойтись куб инструментом куда попроще но как бы есть определенное индустриальный стандарт то есть все них знают то есть для сбора визуализации данных это сейчас прям топчик это prometheus и grafana при этом очень прикольные новые инструменты там телеграф как сборщик метрит метрик не дата про на дату читал буквально вчера по колесам ее не трогал но мне показалось он даже выглядит очень симпатично работает очень замечательное даже под покрасив шагов она выглядит для хранения данных понятно для сборки любые там серии sd от дибашки анализ логов и звездочка к стек то есть нас этой ибо елка либо явка тут уже кому как удобней для pm at рейсинга new relic black fire джаггер zip кен и небольшой а нет дальше при этом мы должны учитывать что мониторинг тоже должен мониторится если у вас монитор ник не за мониторинг вы никогда не узнаете что он у вас все у вас на начало ломаться мониторинг при этом должен работать как внутри кластера так и снаружи потому что если у вас пропадет к ногтям с внешним миром вроде по мониторингу все будет замечательно потому что все приложения в кластер а мониторинга не видят друг друга все хорошо работает связи с внешним миром нет поэтому у нас должен быть бо мониторинга и при этом мы обязательно должны следить за и вверх этом чтобы наш замечательный монстр манит мониторинговый не начал жрать все все ресурсы на самого себя поэтому например для охранения каких-то исторических данных я прям советую использовать так вот такой замечательный струмент танос для прометея и небольшой дисклеймер а про система хранения данных буквально недели три назад мой коллега евгений выступал в техасе на к принципе rcon alive и в этом докладе мы как раз проводили очень такой тщательный анализ современных tm series баз данных мы их очень сильно нагружали всякие различные проводили поведенческие тесты то есть при больших и сердцах при малых insert их данных как она себя ведет как она работает под нагрузкой поэтому очень скоро появится расшифровка этого доклада появится статейка появится видео обязательно всем скинем обязательно советую просмотру доклад получился очень интересный ну и давайте перейдем уже собстна горят мониторингу первое что мы определили от это мониторинг приложение как бизнес-единицы как нам его выстроить во первых для этого должен быть какой-то внешней мы его называем пин gator то есть внешний скрипт который проверяет наше приложение он что он должен проверить проверять во-первых нам просто что но живет об этом чуть позже и о том что как например то же самое пей которую предоставляет что она отвечает нам корректно что она работает то есть точно так же как раньше мы писали тесты мы также пишем теперь и какие-то метрики для этих для этого пей также очень хорошо чтобы у нас наше приложение выдавала на на внешку к это свое внутреннее состояние то есть например если нас какой-то там сервис на блоках нога который отправляет почту он будет очень круто если он будет нам выплевывать метрики например сколько писем отправилась успешно сколько писем не отправилась и приложение должно представлять какой-то внешней in point в том же самом про металл стояли что у нас какой-то экспортер пришел эти метрики забрал мы с ними уже дальше начали работать прекрасно понимаем что эту задачу мы должны возложить на разработчиков ни один админ этого сделать не сможет то есть это должны делать разработчики они должны это закладывать в разработку этого сервиса они должны при этом актуализировать метрики этого сервиса то есть например обновилась api и нас там добавить какое-то новая логика разработчики это сделать обязаны если этого не произойдёт то мониторинг ты уже никогда не догоните дальше hell статус наших приложений то есть точно так же отдельный in point который сообщает приложение живо приложения не живо при этом очень прикольная штука реализовано в эти считаешь самой либо среди нас пробы примерно делать нужно то же самое по каким-то контентом ваше приложение должно про сообщать я живу я мертва и какой-нибудь дашборд в котором мы по историческому срезу видим что приложение была жива потом произошло к это катастрофа лампочки стали красные потом лампочки стали зеленые то есть как это вообще делается это тоже задача разработчиков то есть обмен этого не сделают если у нас там сзади + новая версия сервиса метрики hell статуса должна быть точно обновлены если мы диплом кайта новый сервис мы должны сразу в дипломе с проверками то есть это кейсом от о том что бывает мониторинг делается не начале проекта а вы уже пришли на кой то готовый проект и вот это вот как-то нужно разгребать и еще один небольшой дисклеймер как вообще все это можно делать я в последнее время очень и очень сильно закопался в графа ну очень сильное исследую и поэтому первое что нужно делать обязательно используйте не стандартные плагины то есть те которые не поставляются в официальной сборки во первых это замечательный плагин причард который нам позволяет строить круговые диаграммы во вторых это очень прикольно разработка наших коллег из компании флант это статус map панель которая как раз позволяет нам выстроить такую мадрид матрицу состоянии где по вертикали у нас идут временные отметки по горизонтали карта наших сервисов а также я очень советую выделить какую-то команду небольшую команду разработчиков на работу с граф анной и не так давно мы тоже этим сильно занялись я сам этим занимаюсь очень скоро мы заносим наш собственный плагин для графа на который позволяет мониторить кубер очень прикольный инструмент там мы проводим интеграцию именно не только с прометеем как с выдавать или метрик так и с самим кубер найти sape и в одной их в один экран мы строим всю карту нашего приложения в кубе ри зелеными красными лампочками и на один на одном экране мы увидим всю картину того как наш проект живет при этом если что-то зашевелилось мы видим какие там есть сообщение об ошибках все остальное и соответственно это очень удобно для мониторинга кубера почему собственно и мы с этим начали так заморачиваться не так давно ясно сильно сам этим занимался вы усердно поставил официальный плагин для кубер от графа но он и не понравился то есть в нем половины того что я хочу видеть как разработчик проекта там там этого нет то есть по нему видно что большую часть 100 pro plugin описали именно админы потому что большая часть всего что там есть это просто иметь в лице был протез память диски все больше полезной информации как бы особо там не найти нельзя ладно продолжаем дальше теперь следующее последнее что нам нужно сделать в мониторинге приложения как бизнес-единицы это интеграционный мониторинг как я уже говорил например почему нельзя за мониторе кафку например у нас есть какой то какой то небольшой сервис осенью есть шина данных и 1 7 сервис кладет туда в кафку что-то второй сервис начала читает потом кладет результат своей работы третий сервис забирает как нам за мониторить вот такую вот штуку то есть первое что нам всегда предлагают за мониторить кафку это покрыть нам прямо мониторингов шину данных ответ неправильный то есть у нас не будет за мониторе на все это интеграционная схема окей продолжаем пробуем за мониторить каждый сервис то есть что в первый сервис корректно может покласть данные в шину 2 корректно читает забирает и пишет обратно и третье забирает это тоже не покроет всю нашу схему взаимодействий и даже если мы и за мониторим и кафку и все наши сервисы это тоже не вот это же не даст нам полную картину мониторить нужно вот так то есть мониторинг брокера это не мониторинг все системы коммуникации и мониторинг обработчиков это тоже не не мониторинг все системы коммуникации то есть идеальная картина заманит ариной кафки как нам приют и все говорить это вот так то есть мы мониторим и каждый сервис и шину данных это как они взаимодействуют между собой теперь немножко уйдем от того что здесь это насколько асинхронное взаимодействие то есть как производится интеграционный мониторинг то есть во первых у нас есть два типа коммуникации это синхронно и асинхронно и между компонентами нашей системы понятно что в синхронные коммуникации мы не можем делать какие-то паузу то есть мы должны ждать ответа поэтому мы пишем какие-то endpoint и которые стучатся в сервис мы ждем когда сервис нам ответит читаем данные проверяемых корректность если нас идет асинхронная коммуникация и проверяем мы входящее сообщение мы пишем какой то скрипт который читает из шина данных какой-то тестовый пакет и мониторим то что она может прочитать в асинхронной коммуникации на исходящее сообщение мы проверяем что сервис пишет наш пакет и в дальнейшем что мы делаем мы должны наш тестовый какой-то пакет прогнать через всю цепочку обработки то есть например если насосу такой-то интернет-магазин у нас пришел новый заказ первое там уведомления менеджеру дальше заказ должен быть сформирован заказ должен быть отгружен заказ должен быть этот перенос служб доставки пользователь должен быть уведомлен то есть всю цепочку мы должны проверять при этом важно чтобы это был не один какой-то тестовый пакет а набор тестовых пакетов понятно что эта задача разработчиков то есть мы должны в код нашего приложения загнать эту логику чтобы мониторинг не навредил рабочие способного нашему продукту чтобы у нас нечайно тестовый заказ не отправился на настоящий живой машине тестовому пользователю ну понятно что мы наших проектах только в разломаем это очень долго и сложно это нужно обязательно закладывать и проект мониторинга и в разработку нашего продукта и например на примере проект который делал я сам мы мониторим там вот такую цепочку данных то есть у нас есть объемный проект там идет очень активная коммуникация с видео сервисом внешним то есть что мы делаем у нас есть тестовый набор каких-то видеофайлов причем этого видео файлы разного размера 1 нас обработчик мы мониторим что у нас есть загрузка на удаленный сервер дальше сервис который отвечает за конвертацию этого видео за публикацию из рассылка уведомлений то есть как только мы тестовый к это видео падали на вход все это цепочки на выходе мы должны получить что у нас видео сконвертирован опубликовано и пользователю об этом уведомлен а то есть здесь почему я расскажу почему пакеты должны быть достойны разные тоже наш кейс мы на этом прям споткнулись мы сначала всю эту цепочку гоняли на одном видосе он вешал там 15 мегабайт какой-то момент внешняя пи х перестала принимать файлы больше десяти мегабайт то есть если у нас был бы направить с твое видео 5 мегабайт мы об этом мы даже не узнали поэтому тесты набор входных данных для всей для этой цепочке мониторинга должен быть заведомо разный должен покрывать как можно больше кейсов того где она может когда-то разломаться следующие с чем нам приходится работать это уровень инфраструктуры и собственно говоря это корень всех зол это именно то что все до сих пор называются с ногами мониторингом то есть всю логику приложения отбрасывают поэтому все свято верят что можно там за мониторить за две недели весь проект потому что в большинство людей под мониторингом понимает именно мониторинг инфраструктуры здесь как бы особо рассказывать нечего то есть сейчас есть большое готовы количество готовых решений причем для мониторинга как уровня от железа да уже уже до уровня регистрации то есть можно здесь уже как раз так там помогает поставьте prometheus и графа ну и все будет хорошо этот процесс можно запускать отдельно от проекта мониторинга и даже нужно его запускать отдельного проекта мониторинга но не нужно его запускать раньше времени потому что до какого-то момента вы все равно не будете знать какой у вас стек инструментов быт на проекте какой стыд железо и так далее и последнее о чем мы поговорим это мониторинг приложения как инженерной единицы то есть здесь как бы тоже все немножко все просто то есть во первых если у нас работа с лагами как я уже grill это и либо елка либо ее в к либо либо там лак стаж при этом с этого уровня мы можем снимать например мониторинг ошибок то есть сейчас очень хороший кейс когда каких-то микро сервисных инфраструктурах а мониторинг 400 aw 200 их 500 их ответов берется из елки то есть у нас в ластики лежит логе нашего комнат web-сервиса и мы очень удобно без какого-то верха до получаем наши количеством двухсотых 400 500 ответов и kasing а это всё лишь рисуем и в дальнейшем работа именно с влогами нам пригодится в нашем следующем следующем этапе это уже валер тенге то есть на для работы над инцидентами вот этот слайд сожалению не мой сайт моего коллега евгений поэтому кратенько расскажу то есть также у нас есть мониторинг именно апликэйшен уровня где и им можно пользовать когда пользоваться когда очень-очень быстро когда вот реально у нас осталось две недели до релиза и хоть как-то работоспособность нашего приложения за мониторить мы можем поставить какой там black black fire либо new relic и хоть как-то понимать что где-то приложение начинает крошиться если но так как у нас в последнее время архитектуры все-таки микро сервисные поэтому наш запрос когда он прилетает в систему он начинает вот так вот колбасили во все стороны понятно что один одним тему как бы не обойтись тут нам на помощь приходит tracing нашей практике чаще и чаще всего это ягер и есть очень прикольная статейка там причем небольшая статья и большой такой видео мануал где-то на час как построить tracing с используем дагер а при этом еще там с палец prometheus и все кроется в каберне тисе очень классный видос всем советую посмотреть как только презентацию расширится сразу нажимайте ссылку очень очень прикольно и тут мог стать понимаем что это тоже становится задачей разработчиков то есть только разработчики потом нам могут как бы показать где ну как она крошиться как с этим работать тут то есть мы уже понимаем что как бы в нашем мониторинге практически везде теперь звучит слово разработчик разработчик разработчик разработчиков давайте это запомним ну и собственно последняя к чему нужно подходить это организация лифтинга про организация лифтинга уже мы делали наверное докладов различных 5 то есть здесь тоже особо ничего нового то есть что вы должны учитывать первых это организация дежурств организация эскалации база знаний и пост мартом и то есть 100 как вообще потом 1 инцидента разбирались почему это важно ту час небольшой сейчас акт извинений а к своим коллегам есть нас один проект где во всей системе а лифтинга проставлен комментарий случае чего звонить сереже мой номер телефона на все системе а лифтинга серёже разберется они так давно как бы я обычно птиц период на меня в офисе то очень редко видят нас там час выстраивается прям пол полноценно линия тех первой линии поддержки и как-то раз я приехал домой из самолета 8 утра имя звонок на телефон здравствуйте вас беспокоят из компании эти сумму вас на проектом проблемой такой я спрошу не даже я думал может из интернет заказывал а потом вспомнил что мне звонят по шкале и которым я просто даже не видели такого быть не должно то есть у вас должна быть под четко построенного системой эскалации чтобы в каких случае чего каким людям звонить при этом разработчики вашего продукта тоже должно быть как бы на связи постоянно то есть держу что вы уже должны быть не только у эксплутационные команды но и вдв команды база знаний очень полезная вещь без нее жить невозможно посмотрим писать нужно обязательно поэтому потому что если вас произошел какой-то крупный инцидент крупная авария вы должны его разобрать на как скажем так наказать виновных и сделать все чтобы эта авария не повторилось никакие сосны для инструменты для этого всего можно принцип применять при дворе для arden лифтинга тут как бы все зависит от вас если вы хотите просто примитивные лампочки то можно тоже самый верх нибудь настроить той же самой графа не вас там будет на мониторе скрасит красненькая сердечко появляться то и значит в этом вашем сервисе что-то идет не так либо если что-то ходить сложнее то есть этот он тот же самый alert manager интегрируется он хорошо сок дыни для уведомлений на западе где мы сейчас работаем очень часто применяется для этого пейджер beauty такой прикольный инструмент во вторых allure должен быть читабелен то есть а потому что написано в вашей системе а я лифтинга вы должны сразу понимать какому сервису нужно идти и чинить кого нужно беспокоить кто зовет сервис отвечает но ясно грязь контроль за доставку за доставку уведомлений тоже очень важная вещь а я прикольная как раз за 35 минут уложился как хотел ну и собственно выводы современный мониторинг это не это не не установка на разного набора утилит это их доработка это доработка вашего продукта то есть волшебная когда по нации не существует во вторых фичей не должны идти в во вред вашему мониторингу бизнесу это нужно очень прямо четко как бы донести то есть в бизнес должен понимать что в конечном итоге если какая то есть пробел системе мониторинга если какая-то часть продукта не за мониторинга мы не узнаем что там произойдет авария этот эта авария как бы не принесет очень-очень большие убытки и большая часть наших современного наши мониторинга это задача разработчиков поэтому выделяете ваших разработчиков над там разработку метрик на активную коммуникацию со клод эксплуатационный командой то есть не оставляйте 2 обиженных админов которые дадут звук растерянной мартышки в одиночке чтоб они как-то сами это все поняли выделяете ваших разработчиков на построение систем мониторинга без этого мониторинг вы не построить ну тут красивые я тут мои контактные данные если кто хочет со мной пообщаться а если я просто очень глуп и я забыл визиточки своей поэтому фото те кто кому надо этот слайд и если будете мне пить печатать обязательно печатать их из хэштег хотя бы кхл из сайберия 19 5 в большом потоке сообщений у вас немножко пропущу спасибо за внимание ваши вопросы так а тут вопрос с микрофоном задаются да а вот вижу 1 раз привет спасибо большое за доклад очень интересный про мониторинг очень по делу меня зовут anton kovalenko я пристает к yandex облака у меня такой вопрос организационный но как наказывайте виновных после разбора на паспорте ну как бы по рукам конечно не даем то есть здесь уже именно такой менеджерский то есть ни в коем случае человека винить не нужно важного объяснить в чем ну в чем была его ошибка то есть если вы начнете говорить ты плохой ты плохой ты плохой ну человек просто сломается если человеку доходчиво объяснят что можно было сделать по-другому человек не сломается то есть главное в посмотрим на выделить что произошло по чьей вине что сделать чтобы это в дальнейшем избежать это такой же менеджерской психологический ответ так еще вопросы все что а вот вот рука вот вот вот вот вот вот вот и maite заранее еще ребята руки добрый день спасибо за доклад а вот есть какие-то лайфхаки как объяснить разработчикам что они должны это все делать для помощи нам для мониторинга ну лайфхаки какие я даже не знаю ну как бы я мы нашу команду как бы ну как бы научили это делает как бы вы объяснили важно что ребят смотрите ну вот есть команда админов но они не понимают как она работает просто не понимает мы мы сами когда вы сами его не понимаете как она работает вот тот проект с видео которое ты рассказал я сам до сих пор не понимаю как она работает не падает но она работает во вторых как бы это будет полезно можно объяснить стоит точки зрения что это будет полезным для дальнейшей исправления ошибок то есть если мы будем видеть какую-то статистику нашего приложения например есть реально там сервис на кошечки который читает культ rabbit и отправляет кучу push-уведомление в браузер если мы будем в какой то момент времени видеть статистику что у нас но при прочитано там 30 сообщений а успешно отправлено только 20 разработчики сами увидят что где-то есть проблема что можно 30 сделать тридцатью точно также например есть мне еще один проект он довольно таки сложный там много сих рассылок новая генерация различных отчетов и там мы прям это специально сделали чтобы умны в реал тайме видели сколько например вот я скажу слово билетов сгенерировано сгенерировал насколько ожидает генерации сколько зафейлилась сколько отправлено ожидает отправки запылилась отправка и так далее 8 графиков и сразу видно куда смотреть где исправлять ошибку то есть разработчикам это самим будет полезно как то так спасибо и вот на заднем ряду я вижу руку кажется он давит добрый день и спасибо за доклад скажите есть ли какие-то наборы практик или статьи или там телефоны для сервисов то есть там даже борды сразу allure тенге сразу предлагаются разработчикам какие-то с вашей стороны подходы и турнули руно тут зависит как бы вообще с кейсом то есть вообще честно сказать у нас большую часть проектов мониторится нашей самописная системой которая тогда все это умеет делать то есть и мониторить инфу мониторить там кубе все остальное и аллерген генерировать у нас там прикольно лестница если это подходить как так внешним продуктом то ну реально лучше пользоваться сообщение общепринятым стандартам то есть прометей графа на какой интеллект менеджер с abs джинни для рассылки уведомлений то есть как бы этого покроет где-то 80 процентов каких-то кейсов но 20 процентов при реально приходится дорабатывать самим то есть это ваша бизнес-логика только вы ее понимаете к тому что когда вводится приложение даже борды допустим с бизнеса важными метриками и так далее но знают только разработчики как они из кода чтобы максимум выехали в grafana ну если это ну можно поставить какой-то промежуточный datasource например чтобы ваш чтобы граф она могла ходить ли бампер напрямую вашу базу и выполнять запросы которые идут запросы которые дойдет даст разработчик либо если это будет promt можно сделать in point который скоро будет вываливать эти метрики в плен текстом промах замирает и уже их красиво рисует причем осмысленно мы видим там на прям наименование метки каунт send e-mail секс с там пятерка либо если мы хотим там сенатом усложнить мы навешиваем также лейблы и потом графа не все это фильтруется быть красиво прикольно так сейчас вопрос горелкам потом на первом ряду спасибо за доклад а вот что вы делаете если допустим разработчик написал метрику которая плохо считается там допустим много срабатывает не по делу например ну тут как бы этом как замечательно поговорки про волков то есть ну к этому нужно подходить с умом то есть от нужно контролить так как это задача и видно кодовая разработка то есть должен быть code review это должна добраться там техническим рядом команды и так далее она уже в продакшен по полу допустим печально это печально как говорится то есть нужно срочно нужно это исправлять то есть очень важно кстати при последнем там alert никого систем учитывать количество ложных срабатываний то есть когда мы например у нас система генерит там 100 фейковых alert of которые реально никому не полезны конечно моменте дежурные на смене которые тобою цену за лестница следит он просто же travel призов принято принято принят не предпринято какой-то важной альберт он пропустит поэтому должна вестись внешняя статистика того насколько allure там алертной информативно сколько они скажем так полезны и в принципе их например как какой-то какую-то метрику можно принципе ведь выпилить потому что оно не создает как бы ну полезность как-то так поднимите руки у кого еще есть вопросы от нашего на первом ряду вопрос и дальше еще 2 по крайней о привет привет ещё раз от играет с нами работал в компании да и вопрос на такой я знаю что у вас ты перечислил огромное количество всякого софта которые вы используете у вас было собственно разработка ну не тарелка с ней стало она живет развивается чуть упражнение рассказал а она же крутая пчуп про не рассказал а покажи мне нельзя говорить ожидайте как бы каммингс он еще один анонс а отлично вокруг центра зала потом будем последними слышно красивый сергей за доклад мне такой вопрос вот я так понимаю что допустим берем ситуацию 15 разработчиков 15 микро сервиса все сидят своим дам болотце значит а вот то что ты говорил что какое-то общее тестирование там овцы в целом системы компьютер не заводь вот хорошо там не сделали свою мониторчик своего там микро сервис а как в целом система работает как вот проходит там ну собственно говоря то есть как бы задача интеграционного мониторинга то есть первых если это с организационной точки зрения интересует то то есть следы можно собрать просто рядов команд чтобы они выстроили каюта схему взаимодействия то есть нарисовали наконец-то сделали документацию ко всему проекту не к отдельному сервисах всему проекту как она работает а затем вы вы вы чинили так называемых эти интеграционные цепочки то есть например здесь пришел запрос как он разлетается где его в каких узлах проверять что должно получится на выходе если именно с организацией к декодировщику программирование этого процесса то ну как как уже сказали то есть важно просто нести туда разработчиков насколько это важно насколько и ну и собственно гора это будет очень полезным для взаимодействия между командой чтобы люди не в болото наконец там варились а начали общаться с друг другу все понимаю что эти шнеки это люди такие очень замкнут и не любят ни с кем разговаривать но это будет полезно для них еще вопросы отлично сейчас поставил с последнего ряда идут рука в центре мониторинг занимается разработчики а сколько времени не им позволено заниматься разработка monitoring system monitoring метрик мы где-то уже ну с почему таким кило миллионам экспертизы где-то пришли к числу 20-15 процентов от времени разработки продукта то есть этого времени хватает чтобы заманить а ведь все чтобы не было каких-то гэпов если понятно если где-то факап минут план палочка может двигаться если как бы это обычная потоковое разработка есть в обычной потоки то про порядка 15 20 процентов времени смотреть так важно бизнесу это донести то есть точно также как нет ну в апреле этого года здесь на код вести был доклад про то как донести до бизнеса в чем польза рефакторинга точно также можно добиться донести в чем польза мониторинга то есть то есть есть это как она в экономике альтернативные издержки то есть здесь мы если сейчас не доделаем мы потеряем столько-то денег а если мы вот это не за мониторим то с вероятностью такой то мы когда-то потратим под потеряем вот столько денег и когда бизнесу скажут можно потерять вот столько а можно потерять вот столько бизнес согласится будет согласен на вот эту маленькую кучку чем на потом на большую еще у вас есть проблема с тем чтобы мониторинг можно чуть чуть погромче если мониторим система разрабатывает разработчики они соответственно делают там какие-то метрики какие-то лампочки чтобы потом тот кто мониторе у на эти лампочки обращал внимание как донести вот эту важность но вот тоже уже такую организационный вопрос это отдельная такая тема то есть мы делали про это очень много докладов то есть именно про организацию система дежурств про организацию первой линии то есть это вот особо как бы их задача они они должны этим заниматься то есть они должны смотреть и типа char зачем я здесь сижу они должны понимать важность этого этой метрики вас должна быть документация в которой там прописано что вот эта метрика но у неё там есть ну можно чего выставить уровень критичности типа там лоу приорити middle priority high priority то есть там ну человек который сидит за вашей панели должен под насколько страшно когда вот здесь загорелась красная лампочка как то так так еще вопросы отлично сергей спасибо за доклад такой вопрос ну вот немного кажется избыточное столько количество у нет 1 га я расскажу вот допустим ты говорил про мониторинг бизнес-логика да вы загружали видео да там смотреть как она обрабатывается и ты привел пример там магазины заказ пошел вот так же как бы участвуют на каком-то этапе люди там и надо вот закладывать логику не показывать им или какие-то скрипты чтобы отрабатывали за людей я понят и вот такие штуки в принципе могут быть обработаны mtn тестированием там стоит же к дому запуск можно да можно это делать но когда еще важно чтобы результат этого тестирования а были доступны онлайн то есть ну в реал тайме ну да то есть например у вас проект построен идеально то есть вас в коде нет ни одной ошибки ни одной мы живем в идеальном мире но в какой-то момент у вас идет взаимодействие с платежной системой внешней сервис он может это отвалится вы должны понимать что сервис отвален и что у вас ваша цепочка вашей обработки на найдется именно в этом моменте то есть во первых это будет просто полезно для того чтобы они понимать что вас отводилось платежка дальнейшем это либо переключение на каюта резервную платежную систему либо там то есть это главное чтобы это было видно как это сделать это прям можно можно при долго как бы сну но договаривать для вот таких кейсов принципе достаточно мониторить коды ответов то ну в принципе да согласен много 500 так значит этот пример был немножко как бы все но синтетические такой чтобы подвести к этой схеме на самом деле как бы там нужно смотреть зависимости от кейса как как это на конкретном примере и выбирать конкретный уже способ мониторинга всей этой штуки и последний шанс задать вопрос вот он добрый день спасибо за доклад хотелось бы узнать ваш опыт по дежурством потому что обычно все проблемы возникают самые неподходящие моменты и требуются допустим консультации целой группы людей каскада то есть там разные люди дают разную информацию соответственно это порой это приводит к еще большим вопросом поддержки у админов и соответственно как у вас выстроены договоренности с разработчиками и систем чтобы их можно было там мы будем грубо говоря в неудобном михаил вообще нужно ее отвечу не у нас я хочу я хочу если канал конечно не рассказывать и там можно посмотреть записи докладов моего коллеги евгения которую верность про эту тему сделал докладывать уже про то как это мы сами выстраивались с того момента она нас было 4 человека когда настало 90 человек то есть ну если кратко что там нужно учесть во первых это правильное построение измен то есть мы для этого что делаем у нас 2 3 смена проходят в иркутске это смены с 8 утра до 4 часов дня из четырех до двенадцати и затем когда вы куски с 12 до 8 утра у нас включается в работу успешная там зона где ребята работают вечером дальше и для взаимодействие с команды разработчиков у разработчиков тоже нужно выстроить какой то значит происходит ничего нет ничего не жил долго должен быть выстроить график дежурств то есть из над проектом работает там три человека понятно что в рабочий день они на связи то всегда вот они в офисе сидят в ночное время ну окей ну пожалуйста поспи с телефоном под под по духам я как бы сплю так всегда есть у меня он так как лежит я как бы уже привык даже отвечайте и говорить не просыпаясь но проекту реально на эту тему у нас очень много можем можно разговаривать в принципе как и а построение системы оповещений то есть в каком порядке кого оповещать то есть понятно люди это люди это не робот и человек может болеть человек может реально не услышать ваш телефонный звонок во зло должно быть кому эскалировать дает что если это просто штатный разработчик дальше это идет техник команды начальник разработки сиять от всевышний то есть двух словах получается это в основном с калинка ответственности да и и плюс договоренность людьми договоренности и построения грамотного адекватного графика держу что без этого никак спасибо сша и youtube канал сергей она пойдем в круг света с тобой а вот это на свет да спасибо тебе огромное за доклад вот оргкомитета программного комитета класс накат пассионарности прикольно мне мне нельзя я завтра в шесть утра прилечу в руку со всеми утра покупая лексуса но ты помнишь минут десять назад что происходило такой вопрос был сон лучше наверное наверное о том как донести до разработчиков важности того что мы все вместе делаем я не помню вот где-то ладно бы выходи сюда автор вопроса как донести до разработчиков вас важность всего от этого и как донести престо авторы лучшего вопрос а теперь тебе придётся найти этого человека блин деньги вот помнишь где то оттуда был вопрос кто спрашивал у них он не выдержу не выдержал а давайте вот выходи давай тебе расскажу как тебя звать где ты работаешь и почему-то прошел именно вы меня зовут валентин я сейчас работу в компании всемайки но на самом деле вопрос достаточно популярна жгучих заезды ну мы немножко настоящие до эту почесть вот вот те книжка будешь машинным обучением заниматься спасибо большое спасибо огромное"
}