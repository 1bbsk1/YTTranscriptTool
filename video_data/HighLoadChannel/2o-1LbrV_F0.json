{
  "video_id": "2o-1LbrV_F0",
  "channel": "HighLoadChannel",
  "title": "Dashboard as a code, или Путь от правок в UI до grafonnet / Антон Быстров (Percona/Simbirsoft)",
  "views": 740,
  "duration": 1479,
  "published": "2023-04-28T06:11:39-07:00",
  "text": "Привет коллеги Всем привет давайте начнем с коротенького вопроса Кто знает и кто пользует графа но отлично А кто пользует dashboard и этих даже борода у него их много отлично супер Я вас всех люблю уже давайте начнем перейдем к докладу собственно говоря как уже говорили тема доклада даже вот это или как мы прошли путь отправку к правкам уже в коде в Джейсон на самом деле хотел пропустить но наши перчики рассказали что он должен быть в общем кто я такой меня зовут Антон я делал с инженер и занимаюсь правками dashbot компании Да так все сложно но это есть вот в общем-то как мы докатились до такой жизни Почему вообще возникла мысль такой доклад сделать в один прекрасный день прилетели прилетел запрос о том что необходимо сделать маленькую маленькую палочку в панели над Самаре но когда начал уже копать Выяснилось что это самая она есть в 10 даже городах каждый дашборда это порядка 5-6 тысяч строк кода Джейсон эти Но и здесь стало на самом деле очень печально Ну мы инженера или кто начали разбирать что вообще как это все делать и как с этим жить первоначально поставили перед собой вопросы Как жить когда у тебя 50 плюс dashboard Каким образом с этими даже бородами работать Каким образом проводить них правки И самое главное после этих пород Каким образом проводить ревью чтобы тот человек который будет проводить ревью понял что ты хотел здесь сделать и смог проверить что ты собственно говоря здесь сделал и чтобы это было сравнить без болезней Ну давайте такую несколько синтетическую ситуацию вообще сферический проект вакууме сферический дивопс в вакууме пришла задача пришла Задачка что есть у нас проект необходимый проект поднять и выкатить его Продакшн Что мы делаем мы поднимаем стенды настраиваем окружение делаем теплой потом мы собственно говоря все что у нас это получилось сделаем бэкап делаем мониторинг Делаем логирование всё это обвязку аллертинг и дальше у нас наступает момент что у нас появляется монетка а приходит бизнес говорит а мы хотим ещё даже городу А здесь давать а там добавь и в один прекрасный момент мы себя ловим что мы просто тупо делаем даже бороды их Копаем колепаем и конца и края этому не видно А потом Исправь на предыдущий даже вроде Ну и всё Мы это всё закапываемся что нам делать нам надо каким-то образом все это шаблонтировать и сделать перед использованием какие-то участки кода чтобы мы могли править в одной точке и все это тиражилось на многие как уже выше что нам нужно сделать нам нужно сделать чтобы наш могли пять ревьюить и чтобы было понятно что мы натворили в этом коде Ну второй пункт третий пункт уже проговорил Ну и в общем-то просто мы инженера или где мы должны это все делать а Давайте немножко рассмотрим Каким образом мы можем делать правки правки мы можем делать первый путь самый легкий мы заходим в наш воду в ЮА и накликиваем быстренько кнопочками что мы хотим сделать получаем Все красиво радуемся Север уходим но случается что-то наш код теряется кто-то приходит правит все плохо все печально И что дальше делать неизвестно и каким образом растиражировать еще там на 100 инстансов тоже Вопрос хороший идем чуть дальше следующий вариант Мы открываем наш Джейсон и мы Терминатор 80 уровня 5100 проверяем нам надо здесь здесь делаем правки комментировать все хорошо но я не знаю где такого человека найти который сможет все это сделать оперативно и ничего потому что в этом варианте сломать Ну очень легко когда мы все это правильно хорошо если у нас есть какие-то линтеры Джейсона в доешки в стране Ну можем поломать неких момен логику А это мы не проверим кроме как они то есть такие правки это дорого но оно хотя бы приближено к нашему дашборд и закон Идем дальше Мы можем взять вариант применить какие-то сторонние библиотеки сторонние инструменты ну здесь пример котлин это находил статейку на хаббре из Киеве ребята сделали на котлине дашборды мы можем сделать на javascripti это рекомендует вода фана и графа нет также рекомендую мегафаный Ну После долгих исследований мы остановились на графанете чуть позже более подробно расскажу про него давайте сейчас рассмотрим графа Нет он работает непосредственно использует Джейсон Нет что есть Джейсон Джейсон был анонсирован компания Google в 2015 году и штука очень интересная как она вообще появилась на свет А то что инженер Google они тоже люди в определенный момент времени надоело править огромные файлы Джейсона руками не сказали Ну мы больше так жить не хотим у нас лапки сделайте нам пожалуйста какую-либо ту чтобы мы нажали кнопку сделать все хорошо и у нас все заработало Ну и появился Джейсон нет Джейсон нет именно применительно к дашбордам очень хорошо было описан в 2020 году на конфе fosda мы инженер-микрофанова и у него есть три Киллер фича которая нам нужны Первое это функция здесь мы объявляем дашборд присваиваем uid пристраивается при своем title компилируем если это можно так сказать и получаем наш городу вроде бы все неплохо но есть такой момент есть схема вершин на пятой строке И это всё хардкодом и здесь мы ничего сделать не можем Ну нам приходит на помощь патче в патчах мы вставляем кусок Джейсона именно вот с чем вершина 22 и всё хорошо Ну и следующий момент мы можем сделать импорт Какие задачи за счет импорта мы решаем мы решаем мы можем разбить наш Файлик на несколько частей каждая которая будет логи завершена и тем самым мы существенно облегчим review объемы кода уменьшим и сможем наши части зависимости от наших потребностей подключать в различные дашборды далее про Джейсон картинка поговорили графа нет графа Нет ну С позволения сказать это возможно частично будет профанации это своеобразная джинджа Vans агафанет Это для джейсоната это набор примитивов для примитив и шаблонов графаны в которых описаны куски наших дашборд а проект не сказать что супер динамично развивающаяся это чуть позже тоже отмечу отдельно но на данный момент там имплементировано шаблоны для седьмой графона далее что мы отсюда конкретно возьмем мы возьмем шаблонизацию пере использование как уже говорил выше проведем анализ наших dashbot что у нас встречается с какой частотой и что нам нужно автоматизировать и перевести в код на данном конкретном примере рассмотрен кусочек кода интервал с которого обновляется наш города из которой данный Как часто берутся все это мы загоняем в виде кода и далее мы это потом можем вот этот кусочек подключать наши дашборды уже буквально одной двумя строчками существенно задачу решили задачу решили такие моменты вот как уже говорил выше на данный момент для графа на 7 У нас сейчас Production будет вылет уже графа на 9 графа она по какой-то причине ребята не очень любят делиться документацией для новых схем Поэтому приходится многие вещи просто доделать на коленке это первое то есть версии схемы это первая боль вторая поскольку продукт которому мы занимаемся этой Пекло мониторинг менеджмент имеет кастомизацию некую агафана аграфанет содержит только для ванильных модулей только год для ванильных модулей Поэтому приходится некоторые вещи дорабатывать под себя и описываете в репозитории практически иногда на лету Ну давайте создадим Наш первый dashboard что здесь мы описываем здесь мы создаем скелет скелете мы импортируем модули как уже говорил выше и пишем код дашборд New описываем подтягиваем объявляем переменные которые были заявлены наших шаблонах и собираем код получаем пустой даже Скелет который нам необходимо наполнить наполняем просто добавляем панели модули и всякие прочие вещи здесь на этом примере мы подключаем различные сущности мы добавили стат пену добавили description Data Source И прописали и все прочее обвязку то что там есть Ну это легко достаточно можно найти документации и далее уже Мы идем в саму даже бороду в секцию Rails там прописываем откуда мы Какие данные берем Каким образом определяем Каким образом с этими данными работаем и собственно говоря у нас наша города уже готова вот пожалуйста из этого кода что собралось уже пошли в нее какие-то данные источники автоматически подтянулись Ну и все хорошо Данные есть вроде бы все хорошо даже бороду получили но есть проблемы Что наш метод это не является панацеей от всех бед и не является золотой пулей нам все равно первоначально когда мы создаем некую дошборду приходится создавать макет в наклейкивать мышкой и после этого макет переводить вход поскольку опять же чтобы наверно писать даже ходом это надо быть терминатором просто нереальным и также не совсем понятен механизм обновления шаблонов поскольку графа она сама это делает автоматически а здесь у нас многие вещи статика Поэтому при обновлении мажорных версий приходится все это будет придется все это переделывать руками большой объем работы ну и также как уже сказал выше большой объем работы с кодом что мы получили конкретно для себя для себя Мы решили нашу задачу что повторяющие участки кода мы переиспользовали мы существенно уменьшили рутину и ручную работу однотипные правки Да мы автоматизировали и также стало возможным проводить ревью кода который все сделано Спасибо большое ваши вопросы пока спикеру некуда убежать сцены мы будем общаться так начнем с помашите мне пожалуйста Ага начнем с правой части фронтенда так за лучший вопрос будет приз на этот раз для разнообразия от спикера и у тебя будет сложная задача запомнить лучший вопрос как нейрофизиолог предупреждаю это будет сложно поэтому прям вот сосредоточься там загибай пальцы считай и так далее Григорий можно добавлю но приз будет неожиданный Спасибо за доклад не использовал еще графон.нет ни разу Скажи пожалуйста ты говорил про 50 дашбордов там 50 с плюсом dashboard of их пилит все одна команда или несколько команд если несколько команд то Как организован процесс работы вот с участием нескольких команд с управлением изменениями не совсем понял вопрос Ну Попробую ответить все-таки пилит По большей части какие-то рутинные правки они на мне другие правки на возможно люди которым концепт делают другие команды все это делается на каком-то этапе подключаюсь я и положу уже окончательное приведение Это даже к общему стандартам то есть Эти люди которые пилят они все-таки накликивают А дальше уже ты руками переводишь И я тоже могу тоже накликать какие-то моменты и потом уже перевожу фото уже для окончательно со всем этим добром а переводишь вход вручную или есть какие-то инструменты чтобы автоматически пока уже пока Дальше не перешли Ну в смысле имеется ввиду вручную уже в плане кода вот о чем говорил то что Джейсона это можно назвать и кодом то что даже хранятся в джейсоне графон это делает из Джейсона это графа Надо же борт нет ли инструментов которые обратно преобразование пока не слышал Спасибо а большое спасибо единиц очень интересный доклад там тоже у себя сейчас посмотрим возможность перехода на какие-либо средства даже борта Скотт собственно вопрос чем-то похож на предыдущий Вот какие можете себе представить инструменты которые работают с дашбордом как с кодом Да с шаблоном упростят сделают более наглядные Ну то есть в идеале да как я хочу что-то кодить Да и сразу видите изменения тушь если особенно править существующей большой даже борт без какой-то наглядности Где какая панелька в ходе будет тяжело мне кажется Спасибо понял Наверное также вопрос инструментов на самом деле много Я предлагаю поговорить об этом в кулуарах потому что вопрос очень объемный когда приступал к изучению этого вопроса там я не знаю куча инструментов то что вот берем кусочек кода его имплементируем мы можем онлайн посмотреть что происходит там совершенно разные задачи которые ставят между собой Ну мы пришли Вот в итоге к этой к этому инструменту но опять же предлагаю потом переговорить поскольку вопросы они такие объемные это очень много времени займет вопросы это будет дискуссии уже скорее а не вопрос-ответ дискуссия организуем в кулуарах скажи вот когда у тебя дашборд как кот а кот как известно это текст до туда легко добавить тексты потом еще добавить текст и потом еще добавить текст Ну ты же не видишь какой в результате даст борт получится потом у тебя получается такой огромный дашборд с кучей там мелких индикаторов которые вот совсем никому не понятен скажи вот было ли в твоей практике такое что коды на фигачивали А dashboard в результате получался как Ну в общем не очень хорошем избыточник правильные слова здесь уже такое очень-очень Хороший вопрос и это вопрос скорее не кодовой базе А вопрос логики которые изначально закладывается то есть здесь нужна работа команды дизайна что это провод после каких-то изменений Мы берем наш борт его обкатываем в пределах сначала своей команды как вот вообще это процесс выглядит Давайте немножко раскрою секрет когда первоначально возникает идея хотим сделать добор А что мы хотим там мониторить а хотим мониторить вот это вот это вот это составляется какой-то какая-то схема что мы хотим делать команда возможно наша возможно другая начинает разрабатывать какой-то пруфов концепт накидывать руками панельки что там будет какая-то всё будет выглядеть потом производится демка по итогам демки Да штука хорошая Да штука хорошая необходимо что-то доделать либо какие-то прочее павки замечания после этого делают все эти правки уже проходит демка внутри компании уже более широкие пользователи оценивает то что сделали после этого даже публикуется в качестве экспериментального собирательства от пользователей параллельно идёт доработка и только после вот этого оригинальную экспериментальной стадии проходит его перевод уже в основную пул Где мы можем допустим массив его постгальзь еще что-то и вот в эти директории мы это вкладываем между идеей и имплементацией этой идеи Ну проходит по порядку может 3-4-5 месяцев скажи такая легкость изготовления дашбордов и Приводит ли к тому что начинают кушать но реально много таких джинсончиков яблоков и дашбордов становится слишком много или вы вот как-то контролируете их количество контролируется их смысл сейчас идёт рефакторинг поскольку многие вещи концепция поменялась ну скажем если изначально закладывать сетей что у нас базы данных работают на голову железе А теперь очень много тебя везде и контейнерализации соответственно Каким образом скрестить многие вещи которые между собой не скрещиваемые и поэтому переходит новую парадигму переходим вот буквально сейчас происходит доработка Home dashboard поэтому добавляется новые старые которые становятся не актуальными они прибиваются фронтенд слева Антон трека и лучший вопрос мне нельзя Я ведущий Но вот да спасибо большое за доклад а связанный с предыдущим вопросом вот просто мне тоже был опыт создания большого количества дашбордов а потом мы прикрепили туда ту аналитики которые смотрел а как часто люди туда заходят ими пользуются и проблемы возникает что тебе с одной стороны говорят девай больше больше А когда ты смотришь на утилизацию Ты понимаешь что на самом деле ими никто не пользуется Вот вы как-то смотрите что действительно Их используют так его используют или вот так вот его используют можно понять что это действительно нужно потому что в какой-то момент вы можете создать просто огромную кучу даже бордоводов которых будет сложно разбираться но может быть из них никому не нужны а да такой момент есть непосредственно есть то что дашборда на данный момент перегруженный некой технической информацией но когда нужны dashbada Давайте говорить откровенно то что когда что-то случилось Когда что-то где-то горит мы должны выяснить где Что горит и здесь стоит задача уже создать некую юзер Story что мы заходим на хондашборду первоначально когда открываем продукт и там видим индикатор красный все плохо индикатор зеленый все хорошо и мы должны уже идти на по уровням то есть создать вот эту именно самый юзер Story Top level плохо Хорошо где плохо насколько плохо смотрим допустим уровень базы данных рассыпалась у нас репликация идем ниже ниже ниже и в итоге докапываемся до этой проблемы Проблемы я думаю не в том что не посещаемой а то что Они между собой должны быть перелинкованы и динамическая линковка То есть у нас это индикатор горит а сам по себе он мало что значит что у нас где-то плохо Мы наводим мышку сюда у нас ссылка мы проваливаемся на уровень ниже и где уже смотрим Что у нас где происходит И вот я это вижу так только а сама даже Барда вот самая мы переходим на низкий уровень у нас открывается куча панели глаза разбегаются куда смотреть а кто знает мне в этом плане нравится демотиватор когда синер водит жена в курс дела показывает вот такой даже борт эдакий дашборды спрашивает А что это вас такое в правом нижнем углу маленькая там график постоянно вниз ползет А Это насколько хорошо мы понимаем наши даже борды Следующий вопрос фронт справа Антон запоминай Скажи пожалуйста ты вот сказал что позволяет работать с дешбордами как с кодом написание это же первая часть работы с кодом Есть ли что-то дальше там для себя для тестов для каких-то как совместимость с разными версиями если вот в этом плане что вот это больной на самом деле вопрос совместимость с различными версиями кофана авто тесты все прочее вот насчет автотестов не скажу это у нас они описывают автотесты но к сожалению туда глубоко не погружался но там есть то что здесь отображается здесь скрыты здесь насколько я знаю это все есть однозначно по поводу что первично курица лицо Да здесь пока у нас есть момент что первоначально все-таки Dash брода Как оно выглядит поскольку вот Глядя на код достаточно Сложно представить как это все будет выглядеть ЮА и компоновку и всякие прочие моменты нюансы их крайне сложно учитывать поэтому проще всё-таки сначала делать наглядным уточнение вопроса А как дальше процесс доставки обновлений у нас но опять же у нас несколько наверное не классических не классическая схема поскольку больше здесь о продукте мы все это комитием в репозитории в свой репозиторий открытой в гите и там уже при сборке новой версии оттуда забираются все эти джейсончики jsonette и встраиваются в продукт в конечной фронтенд справа Меня зовут Илья Антон Спасибо за доклад вопрос полтора скажем так первое Я изучал графа нет и выбрал графа налип потому что на пайтоне там оказалось чуть проще в плане структурирования и обновления И вот вопрос уже коллега задал Но тот же самый Насколько часто приходится перепиливать все после апдейта графан и потому что я по опыту знаю что брат совместимости есть но твои красивые графики Но если графаны уезжают в никуда это боль на самом деле пока пришлось только наверное один раз поскольку это все также в процессе внедрения в процессе работы посмотрели в графон это видели под седьмую версию начали дописывать под себя тот раз выходит девятый хафана и приходится переделывать Да это Да это проблема но мажорной версии выходят не очень часто но будем решать будем думать будем на связи да а скажи а Бывает ли такое что вот а то что разработчики зафигачили кодом но потом вот дашборд скрывается и выглядит ужасно из серии вот когда разработчик Ну не то что не дизайнер а вообще у него в голове связи между кодом и получившимся визуальным представлением нету а здесь Наверное возможен на этапе профу в концепт когда просто отображается А что мы хотим Какие данные видеть далее Это неизбежно все причесывается и приводится к виду что заходишь и Вау какая красота Ну что ж коллеги Давайте поборемся за Таинственный приз последний вопрос и переходим в Клары кто рискнет задать последний вопрос и побороться за приз прошу не знаю может быть уже спросили Я прошу попросить по поводу будущего Как вы видите Да вот ну будет все-таки через пять лет есть какое-то видение может быть какой-то другой при этом инструмент или все-таки эти будут команды развиваться и их все будет использовать Я думаю другой инструмент Не исключено если будет найдено что-то лучшее это однозначно будет использован но пока здесь вариант это понравился будем идти в этом направлении"
}