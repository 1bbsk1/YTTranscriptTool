{
  "video_id": "5TGMSRetQvU",
  "channel": "HighLoadChannel",
  "title": "200 интеграций на 5 разработчиков / Денис Божок (Ostrovok ru)",
  "views": 177,
  "duration": 2564,
  "published": "2024-10-29T02:48:12-07:00",
  "text": "я приглашаю на сцену Дениса пожог с докладом Как сделать свою жизнь себе и другим лучше чек но не совсем ну не ну как-то так но скорее Как сделать проще разработку так сейчас разберёмся с с гаджетами Так ладно А прежде чем начать Всем привет сделаем блиц опрос сколько здесь людей в повседневности использует гон а нет Ага не я поднял рук а потом опустил Сорри Потому что я не использую Вот но О'кей где-то половина хорошо но я думаю даже тем кто не использует будет интересно потому что мне тема была интересная Так что поехали кто я такой чем знаменит А меня зовут Денис божок как правильно сказали Я работаю тих диром в островке Вот кстати а кто знает что такое Островок О нифига нормально Вот Но те кто не знает я об этом Расскажу чуть попозже а да но есть не только тих дир сво короче вот свободная от работы время я ещё ныряю с ребятами там в морях и это вот фоточка где мы зависаем на 30 мтх на фоне слона шикарный Digital детокс Потому что никакой мобильник вы с собой туда не возьмёте вот что такое астк а компания А раньше я бы сказал что это сервис по бронированию отелей но по сути у нас там сервис по бронированию жилья потому что я сам там периодически беру апарты в разных местах вот поэтому это уже не только про отели появилось где-то в 2010 году я к команде присоединился в 2013 То есть если ретроспективно можно сказать что самое основание вот а так Ну поехали дальше интеграции что это такое зачем они нужны в принципе можно прикинуть что большая часть сервисов точнее компаний которые занимаются перепродажей каких-то услуг которые они где-то закупают там по IP им нужны какие-то интеграции есть интересные примеры такие как платёжные сервисы которым нужно как бы правильно тить платежи в правильной опиш в правильных локациях экспрес изр системы быстрых платежей - это хороший пример вот есть Мета поиски которые агрегирующие гибридная модель с которой мы работаем У нас есть прямой инвентарь То есть у нас отельеры пользуются экстранет это наш сервис они вбивают туда доступность с которой мы работаем Мы её показываем у нас уже на сайте но при этом есть и поставщики таких же услуг Их достаточно много как в принципе был спойлер название их 200 сейчас Ну около 200 В чём сложность спросите вы в чём сложность Вроде взял короче поставщика проинтегрировать но есть нюанси а пишка при этом у каждого своя то есть можете представить что там 200 поставщиков у каждого своя пишка и интегрировать её ну порой бывает больно а время ответов у каждого своё а пользователь не будет ждать вечно это как бы важный момент ошибки у каждого там тоже свои а иногда нам везёт нам предоставляют сабок для тестирования интеграции но есть смешной факт что есть СН боксы которые работают с девяти до шести и только в будни то есть приходит разработчик в компании включает свой компьютер работает на нём и sbox тоже рабо рает вот а потом не работает Очень удобно Вот помимо этого у нас есть ограничения по ресурсам мы не можем делать интеграции Вечно у нас ограничен набор людей и соответственно ограничен набор денег а и что же с этим делать чтобы при этом интегрироваться много с разными хорошими ребятами и не умереть А можем поговорить о подходах и что я имею в виду под подходами можно просто писать код а можно в принципе построить процесс так чтобы процесс написание кода был максимально эффективный но чтобы об этом говорить Давайте посмотрим на поиск как он устроен сверху или сбоку как удобно пользователь делает запрос допустим хохочет что-то поискать в Москве на двух взрослых на завтра э тема попадает в оте ядро это запрос бизнес логика Как накрутить цены там какие-то скидо сы что-нибудь ещё потом это отправляется в сервис интеграций Где вы можете видеть есть экстранет это наш прямой инвентарь и все остальные поставщики которых там уйма бронирование работает похожим образом только мы уже не условия поиска подставляем А когда вы выбираете какой-то тариф просите его забронировать пользователь сервис пользователей ходит в специаль серс который знает У какого поставщика конкретный тариф нужно забронировать вот а теперь давайте поговорим о том как организовать в принципе процесс разработки чтобы не страдать Как вы думаете В чём хороши программисты 10 баллов грифин Дору в программирование ВС правильно соответствено провокационный вопрос в не очень хороши О отлично отлично Я это назвал в операционной деятельности Но это то что нельзя назвать программированием всё правильно А как могут выглядеть интеграции вот допустим нашли какого-то поставщика и такие ребятушки Давайте с вами интегрироваться вы классники они такие Давайте поднимайте ТП сервер складывайте туда Excel файлики точнее мы их складываем А вы забираете мы такие серьёзно Короче может xml они такие не Вот и такие реально бывают и нужно как бы определить для себя Мы хотим короче с ними интегрироваться или нет А это всё занимает время вот поэтому Что такое операционка Да это не про Винду это про предварительную оценку IP возможности интеграции чтоб ну как бы не тратить время на ребят которые передают вам эльки а заниматься Ну работой чем-то другим вот нужно изучить документацию нужно соотнести объекты Ну в опиш поставщика с нашими Ну и как бы написать инструкцию как это дело проинтегрировать к нам Вот Но помимо интеграции есть ещё часть с поддержкой То есть когда там поставщик отстреливает по каким-то причинам у них там ошибки начинают сыпать или кстати бывает классная тема что ну типа работает поставщик Потом перестаёт спрашивает что случилось Мы формат I поменяли поэтому переезжайте обратной совместимости нет вот а ещ бывает инциденты по вине поставщика Когда вы там бронируете отель короче ромашка приезжайте а там отель Роза и вы так ничего себе вот а как розу Не зови как бы пахнуть будет всё равно ро Что же нам с этим делать Мы разделили зоны ответственности на две части Выдели специальную команду под операционку назвали их интеграции чтобы никто не догадался и Дали им в руки инструменты для отладки IP для написания документации и для разбора инцидентов Соответственно что у нас плюсов разработчики разрабатывают менеджер менеджере меньше контекста у каждой команды Вот и нам проще масштабировать получается Если мы хотим это масштабировать операционку добавляем менеджеров если мы хотим от масштабировать разработку добавляем разработку Ну как вы могли увидеть из названия на 200 интеграций пять разработчиков как правило достаточно Это значит что большая часть нагрузки ходит как раз таки в операционку Где же здесь c+ Plus спросите вы вроде бы конференция про разработку будет сейчас Но прежде чем об этом поговорить Давайте поговорим о том как можно реализовать сервис что я имею в виду вот нам нужно проинтегрировать поставщика какие у нас есть варианты Мы можем написать сервис для интеграции с конкретным поставщиком а назовём это микросервис вот делаем какой-то шаблонный сервис поднимаем его как бы ходим к поставщику через этот сервис Вроде всё работает все довольны как бы Какие плюсы Если у нас много поставщиков и в коде одного поставщика там закралась противная БАГУ то она может обрушить только один этот сервис а все наши интеграции что как бы плюс можно масштабировать отдельно поставщиков которые начали расти это будет выглядеть прозрачно Из минусов то что нам сложно будет выкатывать изменения которые касаются всех какие-то общие только если прям не делить дробно каждый этот сервис на какие-то микро модули вот накладные расходы на повторяющиеся операции выше потому что вы делаете больше http запросов в рамках сво сети у вас больше стерилизации стерилизации это как бы отнимает ресурс Ну и растёт энтропия как бы Когда у вас 3-4 поставщика то 34 сервиса наверное норм А если их 200 то 200 уже наверно не очень норм А если их ещё каждый масштабировать по 10 штук то уже как бы ну типа не очень есть ещё вариант с монолитом когда мы пишем просто один сервис который делает всё Одно кольцо чтобы управлять всеми Вот в м плюс головной боли нету проще вносить изменения так как всё в одном месте но есть проблема когда вам нужно кооперативно вносить изменения уже ну типа в большом объёме Ну и есть если случились ошибки в коде то он прикладывает весь Монолит все ваши интеграции короче графа разрываются в ошибках Ничего прикольного Ну и опять же ниже эффективность масштабирования потому что мы плодим монолиты мы плодим код который возможно нам не нужно использовать это жрет больше памяти ну не прикольно что же мы выбрали Ну мы ничего не выбирали выбор сделал нас Мы выбрали конечно Монолит Но это другое он у нас модульный Вот и чуть расскажу про то что это такое А по сути Это был эволюционный подход исторический про историю Расскажу чуть дальше мы просто ну типа изначально Островок Это был один сервис который постоянно мы добили добили добили добили на части и вот там как бы появился сервис с интеграция и модулями вот ну и плюс ещё там были вопросы к масштабированию Какие плюсы Вы можете видеть что я очень предвзято к этому решению потому что тут у нас одни плюсы но мы отделяем логику приложения от логики интеграции что как бы уже плюс мы можем разнести то есть мы можем сделать несколько приложений одно будет отвечать за поиск второй будет отвечать за бронирование и они будут использовать один и тотже код в плане библиотек легко кооперативно разрабатывать То есть каждый Ну можно взять 10 человек они будут разрабатывать 10 интеграций а потом ну как бы они не будут друг другу мешать Ну и всё ещё просто масштабировать как бы с теми же плюсами и минусами о которых мы говорили вот а модули по-прежнему влияют друг на друга то есть Сиф в одном модуле как бы заваливает всех остальных поэтому требования качества выше Значит надо лучше де тестировать Ну и масштаби опять же всех с друго Роны проще поднял 10 копий А дальше там как бы сами разберутся вот что там про код было да Э хорошо давайте поговорим чуть чуть больше про код но сначала про термины что такое фреймворк А я просто буду дальше использовать скорее всего термины Поэтому лучше с ними ознакомиться заранее Framework приложение которое собственно используют библиотеки которые мы будем писать это будет приложение может быть поиска бронирования либо что-то ещё то есть на самом деле у нас контекстов на самом деле больше но как бы для примера этого достаточно Вот сама библиотека модуль - это код интеграции конкретный с конкретным поставщиком и й - это по сути вариант размещения то есть включающий в себя стоимость комнату услуги там ещ какие-то метаданные вот как всё устроено с точки зрения библиотеки есть такая мапа где ключом выступает название поставщика а функция - это функция bu которая возвращает собственно объект интеграции с конкретным поставщиком дальше Запрос к этому фреймворк будь то поисковый или бронирование содержит название интеграции сам фреймворк по этому названию создаёт экземпляр объекта если его ещё нет в памяти вот а дальше внутри него вызывает функцию avot Search и возвращает результаты Вот как это выглядит на роне фреймворка как мы объявляем интерфейс функция Hotel Search он принимает контекст Кстати на минуточку этот контекст не Гош най контекст которому мы все привыкли как-то так получилось что давным-давно мы начали использовать го чуть ли не когда он только вышел и нам Понадобился Ну типа контекст а потом гофер изобрели свой контекст и мы стали путаться вот потом список отелей и возвращает собственно рытый на стороне библиотеки получается вот те функции билдеры которые возвращают объект вот как примерно выглядит инте ой реализация то есть вот она функция все те же параметры внутри что мы делаем внутри мы делаем мы проверяем параметры поиска как раз таки вот этот контекст и содержит параметры поиска которые мы хотим проверить потом создаём массив гостей заполняем его создаём запрос с определ параметрами и дальше кстати здесь будет спойлер здесь видите мы не вызываем тно какой-то http запрос а вызываем функцию Я его ласкаво называю но мне сказали так не делать Вот туда передаём функцию которую мы хотим вызвать контекст то есть параметры и сам запрос Ну и проверяем ошибочка больше кода слишком мало тоже так думаю но сначала занимательная история в принципе как про то как эволюционировал наш сервис Вот как я рассказывал у нас был один сервис когда Островок только появился Это был ну типа проект на Джанг на питоне вот он потихоньку рос развивался поисковая часть становилась всё сложнее и сложнее и мы её вынесли отдельно назвали ходкор Я когда только пришёл думал почему хоко оказалось что это hore для меня было неочевидно Вот Потом питон быстро переставал тащить потому что ну очень много бизнес логики навались в питоне и он начинать много цпу ребята инноваторы короче сделали го хадкор и перенесли это на Гош затем начало расти число интеграций а потому что когда-то это было там один-два поставщика это было не так короче сложно а тут нам надо было их уже там 1020 И надо было что-то сним делать поэтому мы вынесли это в отдельный сервис который назывался subd supplier Demon Вот и в какой-то момент мы поняли что ну есть как бы этап поиска и там очень много запросов это как бы нагрузка а есть этап бронирования и там важно важен не допустим да а там жно чтобы бронирование прошло и желательно успешно поэтому начали делить это на два Фло на бронирование и на поиск и мы такие ну типа Окей есть два Фло А что с интеграция потому что их надо как-то переиспользовать поэтому начали выносить это всё дело в библиотеку которую стали подключать и там и тут это мусорных генов У нас тоже было очень много мусорного кода потому что он Переезжал как есть у нас в одном месте были и собственно и логика и метрики инфраструктурные штуки там типа как логины писать Вот и при том что новые интеграции делались на примеры старых то просто брали короче копе там что-то переставлять выглядело Ну типа не очень Вот вообще что мы с этим делали мы разделили библиотеку условно говоря на два слоя назовём его Нижний и верхний нижний слой Клинт который максимально близок поставщику То есть это реализация ГОК ко провайдера он вообще никак не зависит от фреймворка его можно скопировать как есть другой проект и он будет работать его можно переиспользовать очень хорошо и верхний слой это Pack Search он как бы склеивает получается фреймворк уже с клиентом можно сказать что там ли ОВО плюсы клиент зависит только от изменений IP провайдера то есть мы можем рефать фреймворк и не страдать при этом мы можем засунуть его в другой фреймворк и тоже не будем страдать соответственно тесты тоже проще писать потому что ну нет никаких зависимостей в клиенте от фреймворка А вот мы можем использовать пакет клиент отдельно и у нас периодически integration менеджеры используют его для дебага I провайдера то есть мы это выносим в Клич ную какую-то тулузу и там что-то делаем Запроси делаем какие-нибудь вот ну и читаем из кода выше потому что код интеграции достаточно объёмный А мы разбиваем аналогичен и проще вносить изменения где примеры спросите вы хорош уже трещать вот вам пример но справедливости ради типа я специально накинул столько Потому что так Короче наверное у вас реакция как у меня когда первый раз открыл интеграцию такой Что здесь происходит Я каждый раз забываю что здесь происходит поэтому сейчас будем вместе разбираться Итак Кстати кто знает что такое что серьёзно что-то не густо Ну ладно ну ладно тогда от остальных ожидаю вопрос почему не промитей вот пушим туда значит что происходит в конкретный момент то есть какой-то эк да потом засека время делаем запрос смотрим за сколько запрос отработал проверяем ошибки пишем опять не дай Бог ошибка пишем влоги не забываем закрыть тело ответа всегда плачу на этом моменте вот потом читаем тело как бы если вдруг опять не смогли прочитать опять пишем логи вот и что у нас тут ещё смотрим С каким статусом завершился типа запрос и если вдруг тело больше ну мы его пишем в ло я м рассказывал про инциденты ромашки и розочки Вот и вот в этом моменте логи очень помогают Что с этим можно делать Вот Собственно как я говорил про обсервер точнее обсервер делаем специальный такой пакет в котором реализуем всё вот это вот то что нам нужно все метрики все логи ошибки обработку вот собственно обработку ошибок добавляем и оборачиваем нужные нам функции точнее нужные нам экшены уже с помощью этого пакета и Вот пример его реализации Ну такой в миниатюре по сути вот Du Call принимающий в себя функцию принимающий контекст принимающий запрос а внутри него мы уже там пишем что вот эта функция завершилась ошибкой если она завершилась ошибкой засека время обрабатываем все ошибки Пишем метрики пишем логи и радуемся жизни Вот такой пример его вызова в результате что мы получаем В результате мы получаем что мы когда читаем код интеграции мы читаем чисто логику Что происходит то есть мы сделали ли там запрос если ошибка с транспортом вернули класс транспортной ошибки если там http ошибка вернули класс http ошибки вот если проблема там с телом вернули проблема Ну короче с телом вот а всё что выше оно точнее всё что получает Эти ошибки оно уже их обрабатывает пишет влоги пишет метрики всё в одном месте очень удобно в результате мы получаем что всё как бы организовано в одном пакете логи метрики ошибки стандартизированные мы проще Ну нам проще расширять метрики логирования потому что ну типа Можно добавить просто всё в одно место В одном пакете все это про импорт и получится ну типа что у всех появились у всех поставщиков появились нужные метрики вот никто ничего не забывает отправлять когда ты реализуемую интеграцию то не забывай что так вот здесь короче надо время померить здесь надо ошибочка здесь вот это вот ничего делать не надо Ну и проще читать код так как его меньше а если кода меньше его ещё и выкидывать проще вот а да дженерики кто ими пользуется Да ладно почти как со ЦД Ну ладно А знаете мы проходили все этапы наверное злость короче вот Гнев торг принятие Вот но иногда нереально помогают И вот я расскажу когда у себя в интеграция мы применяем декартово произведение если кто-то не вкурит Что это такое Я сейчас расскажу Ну то есть я тоже не сразу врил мы используем во многих интеграция и это по сути генератор комбинации между го и тарифами которые приходят от поставщика например А ну ладно например увидим дальше Вот пример реализации вот допустим у нас есть структура запроса структура ответа потом структура комнаты и гостей вот исходя из этой информации пишем код организовываем Запрос к поставщику что нам вот нужно в Москве на опреде Да доступность длях взрослых ите первая группа гостей и одного взрослого это Ну не знаю либо тёща либо кто-то Forever Alone как вам больше нравится а что мы получаем в ответ мы получаем в ответ что вот допустим есть отель спутник а и там вот такой вот набор тарифов и можно наблюдать что допустим Guest Group ID то есть для первой группы У нас есть два тарифа и для второй группы есть два тарифа и мне как конечному пользователю хочется просто ну типа понять Какие у меня варианты бронирования есть Поэтому Составляем комбинации и здесь получается Четыре комбинации Вот раньше мы это дело писали э ну типа как есть в каждой интеграции это занимало время это ну приносило какие-то ошибки но дальше Мы перешли на дженерики И как мы их применяем вот допустим здесь мы собираем специальную мапу где у нас собственно ключом выступает ID группы А значением массив комнат которые для него доступны дальше мы эту мапу заполняем и у нас есть пакетик который идею которого мы спёрли из питона конечно же Tools внутри которого есть combinations Вот Мы туда передаём эту мапу на выходе получаем итератор по которому мы делаем что итери вот а так он выглядит изнутри То есть тут тот же самый дженерика сигнатура вот всё управление дальше передаётся в продук функцию прок её типа я показывать не буду она достаточно объёмная но у меня есть кое-что для вас почитать чтобы было интересно есть слева Это ссылка нак Как можно итеративности вот очень рекомендую в ЧМ плюс получается у нас от поставщиков могут приходить разные типы данных а при этом реализация итератора одна вот меньше дублирования кода быстрее писать быстрее удалять вот все счастливы что ж наверно надо подводить итоги что мы сделали в итоге мы разделили зо ответственности то есть самое важное Мне кажется вот про это могут люди упускать но это очень важная Тема что мы разделяем ответственность между разработчиками и людьми которые коммуницируют там с другими людьми это даёт прямо очень серьёзный бусты изводи Насти не нужно нагружать Бедного васяна тем что ну типа Напиши в поставщика узнаю как создать фтп короче вот это вот всё вот а три факто или интеграция то есть по сути мы их сделали шаблони Зро не их стало сильно проще клепать то есть ну реально просто типа по шаблону сделали новую интеграцию там внесли нужный код как бы все ошибки на месте си логи тоже на месте Ну и дальше чтобы сократив число кода которое надо писать и время которое надо на это тратить воспользуюсь дженериками Как вы видите в принципе можно пользоваться довольно удобно Вот если у вас вдруг остались точнее возникли вопросы либо есть холивар темы как раз Зачем нужны дженерики Я так понимаю здесь большинство вот что можно поспорить про кубе микросервисы пропето И про всё остальное Вот можете подходить к нам в том числе на там буду ВС обсудим вот а ещ если вам было интересно вот как бы - кодик ставьте лайки все дела Вот надеюсь всем понравилось слайды и презентации в другом - коде Поэтому если кому интересно пролистать Всё Всем спасибо спасибо большое за доклад Есть ли вопросы в зале Если у вас есть вопрос поднимите пожалуйста руку к вам подойдут с микрофоном задавайте пожалуйста вопрос микрофон Чётко и ясно держите микрофон урта это единственное место в котором он работает также у нас есть QR код на чат зала можно задавать вопросы туда Тогда я их зачитаю со сцены в микрофон и мы тоже на них ответим Ну а теперь вопрос Здравствуйте спасибо за доклад подскажите Вы сказали что масштабируется все интеграции разом под поставщиков если какой-то какая-то из интеграция пче либо по таймауту отвечает У вас есть автоматическая какая-то деградация отключения этой интеграции О это очень прикольная тема Спасибо за вопрос я хотел её включить доклад но мне сказали что это потянет на другой доклад ещё один вот у нас есть реально мониторинг А ну мы мониторим все логи все ошибки и у нас этот мониторинг Кстати сейчас я вспомню как он есть катор короче Капа ситор Возможно вы знали из тикка вот вот а он собственно со скриптами смотрит что происходит записывает какие-то экшены в редиску и тот кто делает запросы в нужных поставщиков он видит что Они отключены и он их типа отключает на какое-то время вот а потом могут прийти менеджеры интеграции такие О ничего себе ошибки связаться с ребятами там понять что это временно не временно и включить их обратно либо оно может типа периодически делать какие-то небольшие запросы проверять что поставщик ожил и уже тогда типа его включать обратно вот да такая тема есть супер Спасибо ещё вопрос из левой половины зала Спасибо за доклад Степан радионов X5 digit У меня вопрос Глядя на схему поиска показалось что Вы не реплицируемый объекты правильно я понял в сшили то вы реплицируемый раз когда я захожу на Островок и ищу отель в Питере вы идёте к поставщикам и прямо в ран тайме ищете но там сложно потому что и да и нет то есть можно так сказать У нас есть кэширование Поэтому если вы будете делать F5 то скорее всего к поставщикам эти запросы не пойдут но при этом мы бы очень хотели реплицировать все данные у себя как бы и отдавать их с какой-нибудь своей базы но в чём прикол Потому что когда мы делаем запрос типа Я хочу там в Москве на две ночи снять отель вот есть какая-то выдача вот этих штук но оно у нас есть только для конкретной Пакс группы А Пакс группа - это группа гостей то есть по сути там два взрослых Я не знаю там только такие звёзды только в такой-то локации и это очень узкая выборка то есть мы не можем её мы можем её переиспользовать только в случае если придёт такой же человек и сделать такой же запрос вот поэтому чаще всего Нам нужно ходить в поставщиков и запрашивать новые данные Вот Но при этом каширование есть В каком виде оно есть просто вот тут в связи с этим как раз вопрос вот представим Высокий сезон там майские праздники новогодние и у вас как вы уже говорили поставщики очень часто у них Инженерная Культура очень низкая у кого-то там на локальной машине разработчика крутится кто-то файлики на FTP выкладывает и вы Высокий сезон высокую нагрузку получает вместо того чтобы масштабировать Своим сильным it отделом перекладывает на плечах ваших поставщиков которые могут быть к ней не готовы Ну потому у них просто нет ваших ресурсов вот как вы с этим боретесь ну это кстати это тоже была идея засунуть в доклад на сказали что это уже третий доклад вот там есть тактики в том плане что бывают делаются запросы не сразу ко всем либо допустим если вот горячий сезон как раз таки на майские они как правило прилетают В какие-то одни и те же локации и эти штуки попадают в кэш поэтому мы можем их отдавать уже от себя вот бывают очень медленные поставщики которые там отвечают мину Вот Но они отвечают довольно интересным тарифам например мы их складываем к себе и переиспользовать мне вернулся другой А я говорю Ну типа вот значит пришёл нормальный тариф от очень медленно поставщика мы его положили к себе в базу и отдали потом то есть такие механики в целом есть вот просто они ну прям там их очень много и они достаточно сложные То есть я не смогу их прямо объёмно детально качественно объяснить Спасибо большое за вопрос Обожаю эти ситуации когда друзья приходят и говорят Ну ты же работаешь в этой компании у меня тут что-то не работает помоги почини Неважно кто ты Ты должен это починить нормально сделай нормально сделай нормально будет да Следующий вопрос поднимите пожалуйста руку Спасибо за доклад большой Аска такой вопрос с экономической стороны насколько было выгодно переходить переносить все сер весь сервис весь модуль Монолит с Пана На какие из этого были издержки и какие Как вы объяснили самому бизнесу что нужно переезжать это было Достаточно давно А спасибо за вопрос Это было Достаточно давно и тогда это выглядит Так ребят нам Короче надо перейти на го вот Иначе мы сдохнем Да всё переходи вот всё это Это всё что было Ну и плюс у нас сервис был тогда не очень сложный не очень большой его там перекати за пару месяцев его переписали вот а потом его уже начали пилить развивать там вот это вот всё Поэтому вот как раз в этом был Плюс потому что это был как раз момент когда Островок ещё ну типа был такой максимально стартап най и там эти изменения приносить было просто вот поэтому особых сложностей не возникало спасибо С левой половины зала вопрос а добрый день а Вот вы затронули тему логирования я так увидел что вы гите очень много событий и складывайте целиком там все ивенты вот а подскажите пожалуйста как вы их храните анализируйте нет ли проблем с переполнения и вот вообще вы с этим работаете шикарный вопрос тоже а потому что это уже четвёртый доклад вот у нас изначально очень давно появился сервис который назывался jh контекст вот ну типа это довольно странная задача Я не знаю Кстати сталкиваются с ней люди или нет Мы реально записываем ответы поставщиков потому что нам потом надо доказать что типа дураки не мы а вот всё-таки они вот поэтому это всё дело записываем и мы пересмотрели куча разных вариантов хранение постоянно думали про эластик там ещё про что-то Вот но ответы бывают очень разные очень много мегабайт нае поэтому написали свой Костыль условно говоря он работает Как он получается когда приходит запрос вот в этот фреймворк он отправляет этот запрос он его логит там не вни куда-то А в специальный сервис Он его забирает и дальше с ним делает интересные штуки он само тело допустим оттуда вычисляет какие-то метаданные складывает их там ну типа в KV хранилище по-моему чтобы можно было а нет даже не в KV А в пог чтобы можно было реляционной само тело оно типа сжимает и складывает на S3 Вот и когда у нас менеджер интеграции хочет посмотреть что же произошло он заходит допустим у нас есть ID сессии вот вбивает в поиск ID сессии а у него из S3 прямо в динамике подгружаются все вот эти вот жирные ответы которые он может на ти посмотреть и понять что произошло вот а я думаю что доп вопрос - это отличная идея особенно вопросы которые касаются конкретных утилит как их лучше использовать Можно ли было использовать что-то другое все эти вопросы намного лучше обсуждать в дискуссионной зоне которая будет доступна в которую уйдёт докладчик если выйти в правый выход то слева будет стоять докладчик и будет вас ждать в дискуссионной зоне сейчас передам слово следующему вопросу в правой половине зала Да обсудим короче Привет Спасибо большое за доклад Вопрос такой насколько модули В текущей реализации изолированы друг от друга ты говорил в презентации что вот у вас есть отдельные СДК и ещё сеч пакет и вопрос Можно ли сейчас текущей реализации вынести вот просто в отдельном микросервис для какого-то большого допустим парт который появится использовать эти модули и Уно там в монолите заменить вызов функции на запрос в отдельный сервис для того чтобы вот этот крупный один партнёр не влиял никак в общем на весь Монолит и в связи с этим собственно ещё маленький дополнительный вопрос Были ли ситуации когда один крупный партнёр влиял на весь Монолит из-за какой-то нагрузки Угу Понял спасибо А в новой версии реализации библиотек можно Ну то есть можно выносить И вот я как рассказывал что их можно чуть ли не в цела тузы выносить и они будут работать нормально Вот поэтому в принципе выносимо мы даже думали об этом мы думали как бы выносить поставщиков конкретных больших на специальные Тачки на их собственные чтобы ну как бы было более предсказуемо и масштабируемость это требует очень много внимания очень много То есть можно разложить всё по полочкам Но потом надо поддерживать порядок это типа требует времени вот а так чтобы изза какого-то конкретного поставщика у на всё отстрелил скорее бывало когда на заре островка Когда у нас было там два-три поставщика условно говоря и один поставщик - это было там 60% нашей доступности условно говоря если он отстреливался сорян у нас Ну ничего нет Ну ничего вообще вот а так что при этом лёг Монолит нет такого не было супер спасибо вопрос из левой половины зала там вот прямо в самом конце тянут руку тянут давно а да здравствуйте а как вы боретесь с несогласованность данных Вот оставляете это на откуп поставщикам либо на вашей стороне как-то это делаете вот бывают такие моменты что вы показали что можно забронировать условно А это уже забронировано вот как вы с этим справляетесь А хороший вопрос спасибо А у нас есть можно сказать такой мультистрой условно говоря то есть мы можем на одном этапе выдавать горячую выдачу то что у нас в коше там лежит или ещё где-нибудь да да А когда мы допустим переходим уже на страничку отеля мы эти данные перепроверять Ну как бы иначе будет не очень Вот и мы их перепроверять как раз таки у тех поставщиков которые вернули эти данные чтобы ну подтвердить что мы можем реально их забронировать следующим этапом чтобы они не потерялись в процессе бронирования есть уже пре бронирование когда мы допустим условно говоря складываем бронирование в корзину и хотим его там типа оплатить вот поэтому там разделено на такие части когда мы Ну типа стараемся как-то максимально консистентной Спасибо Есть ли ещё вопросы в зале вытяните руку пожалуйста Здравствуйте спасибо большое за доклад Очень интересно Вот вы описали проблему того что много поставщиков Да У всех свои технологии свои ограничения не думали не задумались ли о том чтобы стать каким-то локомотивом внедрения какого-то единого протокола обмена подобной информацией потому что сфера бронирования сечас развивается особенно после ухода букинга желание сделать что-то такое глобальное унифицированной сервисов спасибо спасибо желание всегда было на самом деле оно и сейчас есть вот вопрос в том Ну типа для этого нужен прямо фокус и это большая работа которая нужно прямо заниматься ей бы хотелось бы заняться вот но мы первое время решали вопросы своего масштабирования А дальше уже хочется двигаться Да в сторону стандартизации рынка потому что там Ну реально есть интересный прикол гиганты допустим вот тот же бунг они используют - для э ну короче для сферы туризма интересную тему об обмениваться доступностью через календарь вот ну то есть ну типа вот как Google календарь только есть другой календарь и там короче ну это очень сложно Ну типа очень старый очень медленный протокол но ребята не очень хотели почему-то его стандартизировать у нас же как бы ну типа есть желание всё-таки этим заняться чтобы как-то привести в порядок Вот супер спасибо Есть ли ещё вопросы в зале видела слева руку Здравствуйте спасибо за доклад очень интересно узнать насколько А долго разрабатывается у вас интеграции насколько они в принципе объёмные А и интересно узнать сколько времени примерно затрачивается на одну интеграцию до общих каких-то оптимизаций и после спасибо в абсолютных числах я не отвечу Но типа там не знаю 10 минут типа тире 3 часа Вот Но я могу сказать что у нас команда получается от масштабированных усно меся точно сделаем вот сильно зависит от поставка потому вот я смотрел сколько занимают по коду Какие Ну какие поставщики есть некоторые которые там занимают у словно 900 строк Ну типа там раз-раз и всё готово А есть некоторые которые занимают 10 п тысяч вот и это прямо ну сложные штуки Поэтому сильно зависит от того с кем мы интегрируем се Вот супер спасибо Есть ли ещё вопросы в зале поднимите пожалуйста руки Я не вижу в этом случае я считаю что Мы закончили сессию вопросов от помните что все дополнительные вопросы дискуссии диалоги можно провести с докладчиком в дискуссионной зоне которая находится у правого выхода вниз по лестнице там же вас будет ждать докладчик Ну а теперь давай выберем какой-нибудь вопрос для того чтобы подарить ему подарок от островка у меня стек переполнилась включение интеграции Мне очень понравилось потому что я правда хотел это внести в этот самый как его доклад в доклад в доклад хорошо автоотключение интеграции пожалуйста Не уходите Мы хотим Подарить вам подарок от островка если быть точно не мы а именно Островок хочет подарить вам подарок А теперь давай выберем вопрос для того чтобы подарить подарок от нашего партнёра ГазПром нец сейчас сек сеек я читаю У меня не очень понятный почек А я писала вслепую так чтобы на вас продолжать смотреть я не знаю что там написано Ну вот давай как не положить Высокий сезон поставщиков потому что тоже хорошая тема для доклада Отлично как не положить Высокий сезон поставщиков это нормально что я людей по вопросам называю Не уходите пожалуйста из зала мы тоже хотим вам подарить подарок от нашего спонсора и вас я тоже хочу поблагодарить я переключаюсь с Вы на ты Я считаю что это всё ещё доклад о том как упростить себе жизнь потому что ну я вот большую часть времени разрабатываю поэтому это условна большая сть моей жизни и вообще либо это либо тёмный Властелин Вот мне кажется что это было лучше Спасибо большое Спасибо большое вам тоже большое спасибо Давайте Поа"
}