{
  "video_id": "Y3iozw8jHN0",
  "channel": "HighLoadChannel",
  "title": "ClickHouse: блиц митап (вопросы и ответы) / Алексей Миловидов",
  "views": 4867,
  "duration": 3207,
  "published": "2019-05-14T14:44:34-07:00",
  "text": "у нас бы разрыв нас ася 1 ответ вас и и и арад раздав большое помещение все поместились так что можно начинать поднимать руки вам принесут микрофон есть ведь у вас микрофон на экран да неважно я лучше то что просили вы хотел вывести на экран скажу просто так пусто значит олехаус существует у него есть сайт для поддержки пользоваться есть замечательный чат телеграме там уже 2 тысяч человек я правда не знаю сколько из них батэ но тем не менее мы это уже пытались отметить мы наверно мои коллеги пытались отметить а я не успел вот наверх от то заходите смотрите чего там интересного звездочек полно но не так чтобы очень много 5490 не помню вот видите не круглое какое число надо увеличивать ну и конечно стоит смотреть а кто вообще разрабатывает клик house захвате могет хоп там contributor со и где-то 250 человек мы даже недавно добавили даст в такой очень интересной что количество кликов контрибьютором должно быть строго больше 205 и если их не шатед не проходит пожалуйста добрый день первый вопрос наверное будет по поводу вот я использую null таблиц то блеснул движком они навешивают 2 материализованные представления которые переливают данные в друге это длится с разными первичными ключами а уже на итоговые таблицы я не могу на весь матери зова на представление прошения данные не переливают он не видит insert of вы в эти таблицы почему так происходит это баг или фича твердо стоит на пока материализованные представления не работают каскад на самое интересное то что изначально это функционально задумывалась но в конце концов от неё избавились потому что казалось бы что она не так уж нужно но выясняется что она на самом деле нужно это надо будет доделывать вот интересно сможет ли кто-нибудь записывать что значит быть реализованы представляем должны работать каскадно то есть а если это запишем сейчас и не забудем есть очень большой шанс что это будет сейчас наверное решение такое то что вы пишите обычного это сезона представления но с более сложным запросом хотя если там по запросу тоже мог быть колес на проблемы до меч чего-то не нравится который вот тоже шипит . ну вот как-то немножко громко сейчас вот кажется нормально вот отлично вопрос пород мапу по городам опубликован до четвертого квартала 18 года что дальше в планах про ru1 очень интересно потому что конечно его приходится обновлять с учетом того что как мы действительно успеваем делать задачи и сейчас у нас проводом состоит из низких слоев задачи я самый крупный первый слой задач крупных которым мы будем делать ну низко месяцев это точно вполне возможно что до полугода и там три пункта первый пункт это доработка сколь доработка джайнов и в этот входят реализация возможности писать несколько джонов в одном запросе чтобы не надо было по цепочке все это перечислять и далее мертв join и и распределенные join и с pure touch кусков данных разбираем на оба китая передача пакетов между серверами вот довольно крупный пункт следующий пункт это гранулированные права доступа ограничения доступа пользователей к таблицам к старцам таблиц и даже к строкам возможности от настроить по нормальному и даже чтобы можно было подключить внешний справочник стать ими правами доступа и третий пункт это называется workload менеджмент возможность разделение ресурсов между запросами частного разделения ресурсов час например может ограничиться просто целиком скажем чтобы он использовал не больше там двух потоков или например что было использование площади 100 гигабайт оперативки а мы хотим ограничивать прямо ресурсы по отдельности скажем что есть некий пул с таким каким-то именем и все пользователи которые в этом пуля они должны уметь использовать не более 50 процентов сетевой полосы не более пяти ста процентов и abs причем я своего пса доступны то можно и до 100 процентов но если приходит какие-то более важные пользователи которые относятся к пулу там супер-важное пользователя а не получите раритета остальные будет соответственным образом запросы замедляться при выполнении вот это то что самый такой высоко руль план три крупные задачи которые ну вот сказать сроки это очень интересного того что это своеобразный такой тест на оптимизм но я все время говорю что я оптимист так что этот тест не знаю как бы сказать прохожу условий короче в первой половине следующего года все три задачи вот саша разработчик enhance из моей команды единственный кто пришел на highload вот ты что скажешь да ну и конечно нет тут а да чё ты разумная у меня это так себя я просто от прикинул то сделаем я напишу я уже знаю как это описать ну ладно не важно какая разница захотелось делаем нам написать то понятно можно да вот достаточно быстро особенно да если знаю уже все продумать но проблема в том чтобы отладить отловить все баги которые бывают у нас очень замысловатый то есть действительно она может начать появляться в релизах это все уже в первом полугодии но вот прям ставит стейплз ты был она станет чуть попозже я думаю и конечно же ты прав потому что каждая эта задача она именно такая высоко уровня не только потому что там важно довольно суть что ему нужно делать но и проблема в том что требуется некоторые изменения в коде чтобы сделать это по-хорошему вы знаете что мы разработчики мы очень хотим мечтаем чтобы все было сделано по хорошим прямо таким идеальным способом вот и собрать тот же управление ресурсами workload менеджмент из чего можно составить от задача если я захочу сделать так как я мечтал бы ее сделать суть в том что сначала я бы хотел в коде обобщить когда я говорю обобщит уже страшно немножко становится все таки тут главное не переборщить вот обобщить счетчики ресурсов ограничения на ресурсы квоты и эти самые пула ресурсов скажем есть у нас счетчика ресурсов количество строк врачебных из таблицы и мы должны иметь возможность написать что если какой-то ресурс используется полностью то нужно запросы продлить соответственно этом процент но там еще возникает некоторая проблема уже может быть техническая который не стоит говорить потому что но такую широкую аудиторию может быть стыдно но я все таки скажу что один из простых способов это когда на каждый запрос просто запускается там какой-то какое-то количество потоков и они иногда могут ждать но это довольно отстойно работает и нам придётся вынести обработка отдельный трек пулы сделать внутри к хаосу что-то типа нормального сюда но пожалуй я раскрываю секреты слишком сильно судя потому что вот некоторые начали радоваться радоваться между прочим рано алексей а планируется как-нибудь упрощать жизнь пользователям которые человек травмироваться там реплицироваться чтобы данные автоматически перетекали на новые реплики балансировали станут работа в этом направлении я знаю что это многих останавливает от каких-то решительных шагов вот что придется переливать всю таблицу их нужно будет переименовывать какое-то время класть а там будет и новые данные будут стоять или их нужно будет там сразу переключать в новую таблицу а потом доливать какие-то вьюки ну было больше неплохо если что-то продвинулась вот в плане автоматическое формирование самих данных вот вопрос прямо в точку потому что что сейчас в хаосе сортировали включался есть естественное формирование репликация но схема формирования жесткая и в этом есть как достоинства так недостаток потому что во-первых это значит то что система очень хорошо понимаем а вы всегда понимаете где лежат ваши данные как они распределяются куда идут запросы это очень удобно но в основном для кластеров не очень большого размера иногда есть другая задача если бы я просто 100 серверов хочу туда загружать данные и чтобы схема формирования выбралось автоматически и тут тоже не хотелось бы раскрывать секреты не потому что будет стыдно потому что задача то очень серьезное и надо много чего делать и сроки пока еще не понятно называется эта задача облачные таблицы что это такое вот именно то что вы говорите но ха ха но на самом деле всё гораздо более серьезно потому что нужно распределять данные так чтобы одновременно во первых два противоречивых требования и во-первых сохранить локальность распределение данных по некотором кручам по диапазону например то есть заливать его туда клик стрим какой-то данной рекламной системы и вам нужно чтобы если рекламодатель маленький вы могли сделать селектором затронул небольшое количество суворов чтобы масштабироваться по количеству таких запросов единицу времени ну например 100 совсем маркеры канала дать у неё два клика эти два клика лучше учитывать с одного сервера чем сразу состав но я 40 гадатель большой и он вам приносят то восемь процентов дохода то его лучше размазать причем не на 80 процентов серов вообще на 100 это одно требование а другое требование это во первых то чтобы был не очень большой финал insert of так сказать то есть когда вы делаете шорты то нельзя именно разбивать ставку на целую сотню сыров вот ну и также в это задача некоторые бонусы автоматически должны быть например это параллельно и восстановление реплик то что у нас то сложно скажем есть сервер и на каждом по 60 терабайт данных и нам нужно чтобы когда мы поставили другой такой сервер нам не нужно было именно 1 с одной другой реплики тащить это 62 а тащить сразу во всех и в принципе я особо не было требования по локальности дан а то это решалось бы очень просто что данный разбиваем на чанки чанки их расположения на случайно выбранных серах ну как в тоже из dfs сделано но к сожалению это работать где-то кипарисов немножечко другая вот вы вы нам скажете стоп а я работаю на я знаю что такое что другое не то что вы иметь вот значит еще одна проблема то что нам нужно сохранять минимизировать сетевой упал полосу пример ушах то есть было у нас там несколько кусков данных где-то расположенная с мы хотим их помёрзнуть то хотелось бы это делать максимально локально без излишней передача данных посетить но если я не буду сейчас перечислять все пункты я со коротко у меня есть такое описание я почему-то думал что в нем 13 пунктов но в нем оказалась сколько называется облачные таблице у нас навеки может быть мы даже его выложим наружу просто как концепт чтоб подумать потому что там есть парочка проблем которая пока еще не решен и даже в концепте нет конечно не через пять лет нет ну а первых на концерт вам план и никто не скажет я должна свои жизненные планы на пять лет не скажу впрочем и не хотелось я думаю это что мы следующем году точно должны сделать прототип очень хотелось это быстро да но не стоит надежда всегда должна быть ее можно я быстро вопросы 1 будет ли изменен дизайн кто страдал взаимодействие с калпа интервью с к упору интернет на первый момент там просто неожиданно проскакивает изменение когда есть много по ну то есть ли cause почему возникла проблема лекала запущены под большой нагрузкой и есть ещё одно поразительное приложение которое пожирает to pay cash и и shared memory неожиданно они начали над на другом плохо влияет пришлось это это эта ситуация мира вопрос именно по поводу кросс страна взаимодействия будет ли он меняться второй вопрос связанный с тем как репликация ну как бы будет насколько я слышал у вас уже есть новый дизайн и репликации оля с полным жестким подтверждением и отпуском в тот момент а если тип очень ну типа слишком вначале я вот пока не понял она уже в массе renew мастерами мастер и 4 месячной давности собранной как бы из мастера и последний третий вопрос я уже зубки берто выкину можно любой вопрос да сначала про выкидывание звуки пера это та задача которую мы пока что не включаем в план исключительно исходя из осторожности но все мечтают это сделать все мечтают выкинуть за кибер а давайте так я спрошу вас кто из вас не мечтает его выкинуть ну вообще-то молодцы потому что нормально же технология работает ясно и правильно настроить нет стройте в докере незачем в docker и звуки beer в докере не живет и против какое-то чудо как он не жрать вы ну ладно короче проблема есть и мы очень хотели бы по крамер предоставить оторвать его но двигаться к этому надо осторожной такими небольшими шагами и в качестве первого шага у нас сейчас обобщен внутри интерфейс взаимодействия то есть есть интерфейс который никак адзуки про не зависит и в принципе его можно было бы реализовать над другой системой все не так просто и первое что мы сделаем это реализуем его не на в другой системой и реализуем фейковый интерфейс фейковый реализацию закипит исключительно для того чтобы лучше тестировать наш код чтобы вставлять фолтын джексон в произвольное место и отладить здесь этот слой взаимодействие и если мы с этой задачей справимся то уже можно будет подойти к тому чтобы нога место поставить туда кое-что другое и тут а тут разные варианты есть то есть один вариант это эти сиди консул кто еще что назовет смотри но его не знаю вас по отдаче а какой-то классик да зря надо хотел парнем и да для репликации существует возможность указатель и шорткод это возможность существует довольно того но в течение нескольких последних версий были существенно исправления так что если вы хотите использовать эту возможность то есть запись подтверждаем от низких реплик то очень рекомендуется crack house обновить возможность предназначена для продакшна использования все нормально а мне они обязательно из мастера двери чистый дом крост родовые взаимодействие и пачка там было вроде 2 две половинки запрос вопрос нас активных были по их ешь или не понятно что он и пока у него это 3 парень просто очень люблю своим то есть проблема возникает из-за того что вымывается поиска с другими приложениями и страдает производительность house здесь я могу предложить целых три ответа на этот вопрос значит первая часть ответа это то что мы знаем об этой проблеме и иногда есть ситуация даже когда cry хаусом может вымывать свой пачкаешь из-за тяжелых мерзкой пошел мяч на 100 гигабайт и он идет и вся свежий данный вымывает эта проблема уже решена стебли в мастере там сделан очень просто что я замерз больше 10 гигабайт по умолчанию это можно настроить то он делается не через пачкаешь просто через о директ второй способ как можно эту проблему решить можно использовать одну из нескольких неведомых утилит одна из них называется vintage другая не помню как на то же самое на гол так я помню хотим вот или 3 называется кажется и of тулс типа утилиты для файлового каша короче поищите так вот с помощью них можно просто указать какой-то файл который для вас очень важен и можно посмотреть насколько он . shake или сделать так чтобы он вечно там находился просто так зафиксировать вот так от третий способ он такой более перспективный это вопрос наверное которым не стоит задать самому себе и нашей команде а не стоит ли нам в хаусе реализовать юзер space . я уже знаю у нас это почти каждая свобода использовать свой кошелек ли house полагается на операционную систему и что же вы давайте я думаю будет ну да самое интересно что этот каш имеет смысл делать именно для правильного распределения ресурсов потому что мог быть такие горячие запросы которым нужно обязательно скажет на мог быть тяжелое для которых хотелось бы чтобы они не занимали существенную часть его объема но это задача довольно тяжелая но простую но о переделке вот там где ты говорил про дэдпула на не поможет по-моему вообще никак не связана ну вот подгреб такое ощущение что было nokia еще раз посмотрю можно если разрешат я это тебе там кордом помыли еще как не отдам если можно отдать но не знаю кордом наверно можно на него вы смотрите понял я просто кардан по почте пришло сюда да лучше конечно яндекс тиц яндекс такси отправить ли теста я не совсем я не совсем понял но что вот вы говорите что и запачкана возможно замедление не только там есть какая-то паразитная ну давай так это уже просто перебор сильно с мастер на я готов потом подойти на лучше чуть более подробно объяснить эскиз даня словно пара вопросов относительно вам от view и замечательный параметр который запрещает черты матери выполнять запросы если не используется праймари к сожалению параметр аффекте time at you то есть если ты его включил в москве не использовать primary key to make you не будет создаваться можно ли это как то победить это был первый вопрос и второй вопрос случается иногда если сервер они очень большие дорогие что матвею падает по памяти и тот кусок данных который он пытался про переработать в тот момент когда упал по факту падения узнаю из логов понять на каком куски данных это произошло я не смогу приблизительно никогда вот собственно второй вопрос можно ли с этим что-то сделать кроме как воткнуть миллиард гигабайта оперативы в сервис то есть как ты контролируем это сделать для начала по поводу настройки force prime реки она у вас срабатывает когда вы вставляете в таблицу в таком случае решение может быть создать два профиля пользователя один для inserto в другой до селектор для себя актов ограничиться dance art of поставить чтобы ограничений не было все понял спасибо по поводу второго вопроса как работает вообще matter of view он работает как триггерный 1 сорт когда идет вставка пашки данных в таблицу то надо той пачка данных выполняется тот запрос который с которым создана материалов и это может требовать много оперативки если там агрегация например 8 кардинально sti и сразу предупрежу не очень хорошие идеи писать в этот запрос фильтрацию под рукой таблицы с помощью in или join тросов нет это все как можно расход оперативки уменьшить но один вариант это все-таки чуть чуть уменьшить размер пачки вставляем а как это сделать руками можно насильно как-то заставить ну то есть он выгребает как-то сам мы мы не можем понять сколько мы предоставляем по одному а он пытается запихать сразу там не знаю 10 этих insert of ну то есть он работает работает работает на раз там 150 этого inserto падает просто потому что видимо взял большую пачку сам как-то почему-то не известно и решила ее обработать новый вид вставляется данная пачками ну да вроде бы в таком случае делать а следующая первое уменьшится на стройку макс insert было касаясь в одном случае прямо при вставке блоки будут разбиваться на более мелкие во вторых есть еще две настройки мин insert блок says бойца и мин insert blog site роуз может быть специфического я вижу что вам очень интересно поэтому я расскажу эти настройки выполняют слияния маленьких блоков если вы вставляете данные в crack house по нативного протоколу или делать insert select то есть если на входе в шорт были маленькие блоки на целый поток этих маленьких блоков то они будут соединяться вместе еще не по нативном у сразу вопрос я сани по нативном у все определяется настройкой макс insert blog sites и сервер будет входящие данные из входящих данных формировать блоки именно такого размера но он соответственно фиг титана все на любые несет никакой конкретный пример части вертов нормально пролетает любого размера вот какую один большой вот он то есть в разные table to but effective все таблицы все insert и на все таблицы это настройка я можно задать глобального можно для пользователя можно даже на запрос на запрос прельстить интерфейсе просто пишет его руля там one percent настройка вот это равно чему-то можно на на один запрос просто сделать понял спасибо за этот и раз уж я захватил микрофон еще один можно относительно звук и звуки пера репликации всего вот этого вот опять же столкнуть если вы обещаете выкинуть за купер в принципе может быть дениску или не скоро вообще пока вообще не обещая вообще не обещаем тогда вопрос будет у нас есть некоторое поползновения в сторону этой возможности понятно там проблема возникает в двух местах проблемы номер 1 звуки пор говорю что все замечательно ваши inserto я получил а дальше пытается enter текке ни черта не получается уже непосредственно в в реплику и собственно эта ситуация тоже никак ну очень то есть влогах мы может быть что то найдем но что конкретно не ставилось никогда в жизни не узнаем это первый момент второй момент за кипр отвечает за де дупликацию соответственно завещает он сзади публикацию по херу по определенному и бывает такая ситуация что если например составляют данные там не знаю грубо говоря там с 1 по 10 какие-то ряды а потом так получается что меня предложение послала с 8 по 12 естественно никакой не публикации в этом случае не не произойдет они ставятся с 1 по 10 из 8 по 12 то есть хотелось бы чтобы с 8 по 10 не ставился два раза вот как как это можно победить еще для этого наверное единственный способ это хранить информацию о том что вы собираетесь что-то вставить в некоторой системе в качество систему может быть тот же звуки пор то есть вы выигрывали какой-то пачку данных впрочем если вы например вынимаете из кафки вы можете пометить в сад только после успешных к сожалению не исков кито языков кинет есть допустим вы вставляете из локальной файловой системы тогда вы можете нарезать данные на пачки виде файликов и если не получил стать фариг вы тот же самый файл и оставляете заново ну тут да тут понятно а относительно того что на звук теперь прошло дальше не ушло вот с этим как то быть ясные нашу кибер пришло а дальше не ушло то вы получите в ответ эксепшен почему-то получилось что не получим ну может быть и такой относительно недавно произошло нет это всегда было и всегда так и есть я снова получили в ответ на и черт что все ок данные точно вставлены ясно вы получили к нашим данные точно не вставлены если вы получили ранения разорвана то данные либо точно ставлю латакии это дающего еще спасибо добрый вечер я только погружаюсь в этот сказочный мир и у меня соответствующий вопрос хочется завязаться на загрузку данных при house напрямую из кафки то есть бискотто посредника стоит ли идти по этому пути и как хорошо это все работает да это возможность есть можно использовать движок таблиц кафка впрягался этот движок тавляется использовать можно сказать все единственно кроме яндекса яндексе во первых не кафка там другая система которая очень похожа на кафку и даже реализует похожий интерфейс но другая поэтому так получилось что у нас это дыра кафка даже вообще никак не используется но его использовать кучу других компаний скажем club flyer в которой он как раз был разработан и у них а нагрузка превышает нагрузку которую в яндексе почти в 100 раз в принципе можно доверять единственное все-таки покрытие тестами она на мой взгляд недостаточно забыл в нос и сил микрофон как быть с сложной структурой joiner то есть здесь как бы ощущение что cly house не умеет или я не прав ну вот когда из кафки мы читаем данные когда из кафки читаете данные и сложная структура джайнов ну как минимум больше одного уровня если то уже ничего не получается понять когда вы читаете данные сказки обычно это нужно только для того чтобы сразу оставить эти данные в при хаоса и дальше вплетался уже вы хотите сделать сложная структура джайнов или хочется чтобы просто клик хаусе можно было как то ему объяснить что вот эти поля на втором уровне уже вложенности нужно положить куда-то положить в грубо говоря есть таблица мы сделали or alter в 3-х у сета 5 полей в джейсоне у нас три поля на первом уровне и два поля на втором уровне вот чтобы он смог разложить эти пять полив плоский вид а я понял меня почему-то портала силе не послышалось что вы говорили join и послышалось join a до g & sons jison и абсолютно разные если честно говорят слоны как бы я их не не любил а я их вообще-то не люблю меня гораздо более приятный чем join и я обосрался сделал съехался все для поддержки джонсонов я особо не надо было делать join и также да как с поддержкой джейсона вкх все есть некоторые примитивная функции которые позволяют вынимать поля по определенным ключа мысли в слова просто хранятся в строке самый нормальный вариант если вы используете это только для предобработки данных то есть приходит вам данные с этим джейсон виде строки выкладывать в какую-то временную таблицу например или даже не обязательно во времена таблице можно использовать столбцы с материализованной а за ними перси материала и зад и применение такой функции вытащить что-то из херсона и с помощью этих функциям было бы очень хорошо если вы смогли данные заранее разложить на маленькие удобные столбцы завоз the house очень любит маленькие удобной столбцы я понял то есть лучше сделать в заранее лучше сделать это заранее но в принципе нормальный врант что-то можно делать тоже внутри crack house а например загружать в таблицу типа лак и сразу же следующим действием делается и сорт select с этими функцию в нормальную таблица нормальной данными а таблицы полога берете удаляете спасибо здрасти алексей вопрос по поводу бэкапов часто кейс что нам необходимо снимать backup какой-то конкретной таблицы которые достаточно тяжелый но как любые таблицы на вроде они имеют возможность изменяться и то есть мы допустим перестал быть нужен кот стал без моего потёрли добавили что-то новое и backup она становится него линой то есть мы их не можем просто так взять и накатить обратно как мы сейчас делаем мы бы кофем параллельно metadata ну чтобы можно было сделать похожую таблицу из нее уже потом перелить данные если какие-то рекомендации кита best practice а как это делается конкретно в яндексе и как можно это ускорить потому что каждый раз переливать там таблицу которое весит нам по 10 терабайт и перезаливать куда-то на хранилище и еще куда-то очень дорого тяжело и и теряется от этот смысл bacopa что у нас какой-то момент у про становится невалидным есть несколько подходов и наверное в яндексе используется самый сложный и самый неудобный и трудоемкий у нас для выкопав есть отдельные реплики который расположена на северах дурными полками причем на этих сферах расположены несколько к house серверов которые являются репликами разных нормальных серверов и на этих сферах дурными полками создан назад fs прочего то существует подъём иксом где она вообще говоря ну вроде нормально работает и вот изотов с создают со снапшоты это снапшоты хранятся сколько-то там штук и потом удаляются такие вот интересные бэкапы то есть обязательно иметь конкретные именно инцес самок ли хауса что у нас ну грубо говоря все таки операций у нас проходили там же то есть они там мог не брала какие-то selecta и ничего то есть на них нагрузка никто не идет но они просто нужно для того чтобы нас данный были идентичный консистентной всегда они нужны исключительно для того чтобы снимать или об соты вот это наверно самый неудобный способ из более удобных от фриз партизаны копирования полученных данных ну да это фриз портишь она работает но когда мы удалили уже какой-то столбец мы не можем просто это портит взятие заточить обратно да я понимаю но на самом деле если столбец одолеют а способ есть не обязательно добавить столбец говорю магический трюк значит из директора искусств с куском данных удаляете файл так сам . текста после этого может на его точить и все будет доложите что на таком строчка текста удалить я вот не помню но есть такой трюк что я счас торцов именно стала в таблице больше у вас есть куски где мяч старцев можно их прикрепить так что эти новые столбцы они будут просто изначально по умолчанию заполнены а если вы обратный вариант то есть с у нас количество столбцов уметь поменял с другой сторону то есть нас в копиях больше грубо говоря чем на проводе сейчас тогда примерно тоже самое но еще удаляется из директории этот лишний файл хотя кажется можно даже не удалять он будет наблюдать и но если chicks он просто пробовали как раз таки их взяли взять эти краски с разным количеством столбцов просто так ни за работа над суммой надо краски попробовал все это сделать да это так нужно улучшать функциональность фриз таблицы например недавно такой тривиальную вещь сделали теперь можно писать доктор тайрелл фриз и все да вся таблица будет за бока плена но да именно этот флажок у нас стоит просто определенная реплика не должна становиться лидером да по поводу того как прикреплять данные есть еще надежный способ вы создаете таблицу старые структуры в неё делаете attach этих партиций потом артрите эту таблицу и теперь partition можно переносить для переноса партиции есть запрос alter тайбл риплейс partisan from the evil вот главный специалист независимый специалист покликал ся говорит что все работает работает covers спасибо ален должности нет два вопроса в коротких один вопрос есть такая купер util утилита body бы как для переноса данных миграции с одного из кластеров другой из поддержкой как бы ришар линга насколько на какую продакшен рейде вот и второй вопрос это по как бы демократизация как мы по данным вставляем в клик house и вынимаем тест поддержка uhs-i формата пакет формата или например описание формального описания как работает как сгенерировать на эти формат там например я бы хотел выделить найти формат чтобы его отдать уже в клиф хаус в наиболее каком-то эффективным видим вот ну или поддержка пакета внутри cliff house а для начала отвечу на вторую часть вопроса просто чтобы вас порадовать поддержку паркета я уже многократно пообещал что будет в декабре зажаты в курсе почти готово у нас три задача запланирован на декабрь это поддержка вот паркета потом карт на нажатие столбцов возможность указать разные алгоритмы сжатия для отдельных столбцов и до декабря этого года может быть 31 декабря но в декабре я вкурсе вот и третья задача это возможность использования сложных дефолт выражений при вставке из джейсон и чурова кому его титана то ну надеюсь столько ведь хотя бы этот пригодится теперь вопрос по поводу греха ace cooper каховского пирата продакшн и мы его использовать продакшене для переноса данных между двумя вашими кластерами а собственно для себя дел и для себя скоро он поддерживает только копирование данных между кластерами но не ришар ding в пределах одного кластера можно сделать копирование данных из одной таблицы на в одном кластеров другой таблица на том же кластер номере sharding данных в пределах одной таблице будто лишь данных останется моим классный кластер копёр поможет сделать всё что угодно он может измениться его потенциале может изменить первичный ключ что-то типа короче все что угодно можно поменять так как вам нужно саму схему шарди руни естественно можно изменить и он предназначен для тех случаев когда у вас был один кластер вы поставили другой и хотите перевести эти данные полностью все поменяв но если у вас есть один свой вклад трон уже заполнен почти до предела то это работать не будет новостью потому что вот вы скопировали данные с кластера на котором было почти 600 сероваров на другой кластер в котором было 240 серверов но более мощных и там было несколько петабайт сжатых данных и десятки to the bait не сжатых данных и что все это скопировать на потребовалось примерно месяц и это после того как мы отладили все проблемы сколько скопирован стал продакшн и после этого копируем месяц в конце концов достигли скорость копируя один петабайт в неделю и конечно при этом оба кластер были рабочими алексей маленький вопросик планируется возможность создавать словари через да да да вот это одна стерпеть которая во втором слое нашего клана которая оптимистично и просты и понятны и будут сделаны неизвестно когда сейчас как раз полностью продумал синтаксис как это все делать потому что все таки конфигурация словари там много всяких параметров и осталось только написать код а микрофончик да еще такой вопрос наверное немножко не всем потому что и 9 драйверу выпущенному индексом он будет поддерживать вычисляем выражение для бачек секут так сложилось что его используя да будет точно также как просто вставка по версии протокола а когда значат для обычно сорта вы используете формат какой-то там все парой то тогда более интересна потому что этот формат содержит фиксированный набор столбцов в каждой строке в отличие от jason где я мог быть некоторые поля просто пропущены и получается что вас все остаться есть всех них есть значения и что именно вычислять вопрос понять на вернуть то что у есть в кли house подключены словарь и внешние и по кому-то яичника и добавляю некоторые поля по соответств принц arte я хочу добавить таблицу до их нужно заполнить целиком это работает я тут говорят что-то последние вопросы это работает если вы просто пишете insert теперь числа эти все останцы которые есть в вашем файле остальные перечисляются они будут заполнены этим вы счастливы и выражения записи driver разве это не поддерживается поддерживается но какие-то проблемы спида наряду со своим кодом то есть вы пишете денсер тенту тайбл скобочка открывается список столбцов до которых меньше прям вставляется остальные вот вы остальные дефолт и указаны вы вычитаем выражение от какого-то другого столбца от айтишника да и они не заполняются давайте мы мы это запишем стала проверить но мне даже тест наверно писан какой-то который подтверждал а можете прислать мне фотографию прямо хорошо я его посмотри сначала так сегодня у нас что-то мало было времени для обсуждаемые вродь только начали до сожалению наше время да наверно можно завтра продолжить я создадут такую же хорошую аудиторы саша у нас призы все роздана во-первых призывать во вторых тоже у нас бриз и выбрать лучший вопрос и подарить так лучше вопрос а давайте один бонусный вопрос будет сейчас вы попробуйте задать самый лучший вопрос и ясон я поверю в то что лучше я подарю вам эту книгу по душ ники в главном зале вы там были рассказывали как они хранят логе они поскольку приложения и льют логе совершенно с разным количеством полей не берут две колонки в одну колонку кладут массив с ключами вторую колонку кладут массив со значениями этих ключей и как бы потом замечательный строят по ним графике собственно вопрос вообще нормально если нет только делать а вот такая интересная ситуация что когда краха востока белого пошел окна source я всегда смотрел на вся схемы данных которые у других клиентов были и все время говорил что вот надо делать канонически правильным образом а сейчас ситуация изменилась такие сценарии использования украшался есть о которых я вообще они меня даже не снились так что теперь я могу точно сказать что это нормально если работает если довольны и все быстро и они еще со сцены конгресс холла хвалят кли house может как-то лучше мужчин да я думаю что можно лучше как я снова буду делать я я бы наверное сделал по-другому там была проблема с большим количеством разных таблиц с этой статистикой вопрос том что в разные приложения генерируют разные наборы полей соответственно хотелось бы не гель не не иметь миллион таблиц под под каждый отдельный applications класть все в один большой одну большую таблицу с лагами а тут выгребать но при этом соответственно иметь возможность хранить разное количество полей не делать миллион полив таблицы это ну такое ну как нам режется вот подушки решили что делать по-другому может быть еще какой-то между этими двумя крайностями подход до на самом деле варианты есть и с разные стороны какого варианта например один из вариантов который тоже неудобно и мне он тоже не нравится эта таблица со станции типа пользовательский параметр типа сша 41 ну вот и да и тот кто другая крайность я надеюсь когда будет матки на матфею мы все это с жетонами в джейсон их победим но пока этого нет другая крайность это место то поля типа key и value окей string допустимой валью один там strings рукой in the jar и такое тоже используется и в том числе у нас в метрике для пользовательских параметров которые не структурирована но к счастью это занимает очень небольшую долю таблица то есть таблица она в основном хорошая но немножечко все таки таких штук там есть ну и 3 3 варианта нет вот либо так есть третий вариант меня недавно рассказали люди которые даже про патч или cliff house чтобы он поддерживал никиты третий вариант суть в том что они сделали тип данных map отображения но отображения с небольшим количеством возможных ключей и суть в том что для каждого ключа который встречался мягким куски данных создается отдельный столбец на диске то есть получается flexible схема но данные все еще хранятся по столбцам для обычных смертных как этим быть дает его нормально решаю аббату не партесь давай здесь нет спасибо вот эта книжка вам как состоялся потому что вопрос сложный они говорят что у нас код плохой он больше похож на хакк и нам нужно его приводить в порядок да просто костыль да наверно стыдно но надо понимать что все-таки лгала source это довольно такая сложная штука я обычно говорю о просто как в сказке чем дальше тем страшнее там со всем спасибо"
}