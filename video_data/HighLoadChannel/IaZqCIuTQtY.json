{
  "video_id": "IaZqCIuTQtY",
  "channel": "HighLoadChannel",
  "title": "Смерть от распродажи / Анатолий Пласковский (Яндекс.Деньги)",
  "views": 1958,
  "duration": 2923,
  "published": "2017-12-11T02:23:09-08:00",
  "text": "всем привет народ заходите сейчас начнется меня зовут анатолий пластовский я работаю в рядах деньгах и по чуть-чуть потихонечку исследую производительность нашей финансовую систему для тех кто не видит моего лица вот можете посмотреть получше под увеличением познакомиться поближе со мной возможно кто то из вас уже про меня что то слышал потому что 2017 год знаковый наши службы безопасности вроде как пошла на уступки мы наконец-то можем выходить в люди и рассказывать о том что же мы делаем старший финансовой системой как мы общаемся с нашими контрагентами в лице и банков и магазинов с которой участвуют с нами наверняка кто-то читал вот эту замечательную статью под моим авторством есть такие люди вообще наверное но есть это хорошо статья на хабре вроде как в топе даже пролежала в ней мы рассказывали о том как мы замечательно долгая на стабильность грузили наш processing нашу собственную эмиссию карт выпуск карт но там был небольшой поток порядка там 20 30 операций в секунду и люди в комментах начали сразу хейтить хейтить набрасывать им было обидно но мы ещё не могли рассказать про самое интересное чем мы сегодня буду вам рассказывать это про карточной авторизации карточной авторизации и наверное распродажи который в основном на них держится спасибо ребятам из киви сразу говорю большое они как раз таки в комментах под этой статьей выбросили вот такой вот замечательный график это график очень четко показывает специфику работы каждой распродажа медленно-медленно очень небольшой приток операций в секунду идет до как будто был обычный день и в момент x распродажу случается нечто может быть скачок в прямо даже в тысячу раз большинство из вас здесь ходит уже по другим докладом люди там говорят и миллиарды операций в секунду миллионов операций в секунду а я скромно буду рассказывать по приблизительным оценкам от тысячи операций в секунду в чем между этом такая интересная разница ребят низкие сказали что это опыт их работы на распродаже распродаже по эквайрингу алиэкспресс а вы знаете какие у этой компании большие распродажа ну где-то 1000 в секунды там ведомости ru еще что-то я поискал даже какие-то газетные вставки ну вот нашел что-то что-то что-то наверное это тысяч операций в общем все сводится к тому что любая распродажа обладает приблизительно вот такой вот спецификой работы медленно потом много и главная специфика этих акций в нашей стране как вы думаете какая это смерть от распродажа как раз таки самые запоминающиеся распродажи на моей памяти который я наблюдал даже как пользователь это распродаже aliexpress 11 11 2015 года в тот момент на три дня легла и миссия большинства банков российской федерации и вот как взвесить если какой-то сервис который миллиард операций в секунду ляжет и люди пойдут гулять каком эти в детстве когда ты на телевизор выключали мультики заканчивались мы все шли на улицу гуляли то тут если ляжет и миссия всех карт то мы не сможем делать нечего я помню этот прекрасный погожий день 11 числа тогда вечном заехал на заправку и думаю распродажей видимо там идет все лежит и женщину на заправке смотрит на меня и говорит у вас на личный есть есть платите наличными у нас сегодня весь день что-то не работает пришлось заплатить наличными при этом каждому купюра на отдельно а посмотрела потому что видимо считалось что это заговор какой-то вот так или иначе это распродаже за эффекты было три дня нормальной работы всей платежной системы всех банков россии ты смотрите смерти от распродажи вот как так у нас есть 2 варианта или умереть на этой распродаже не выдержав этого потока или убежать от смерти в принципе я считаю что оба этих выбора делая такое личное какие-то банки не хотят вкладываться в развитие и говорят но это случается знаете раза в году ну подумаешь мы поляжем потом три дня после этого пока будем переваривать весь поток операциях который идет ничего страшного есть люди особенно финансовые системы в том числе и денежные которые говорят нет давайте мы все таки подготовимся выдержим эту нагрузку и получим хороший куш судя потому графике вы видели что у людей наверно там за одну секунду сразу меченый баланс сошелся это нормально яндекс деньги тоже хотят и участвует в разного рода распродажах у нас на входе есть несколько магазинов а конкретно несколько десятков тысяч магазинов каждый из которых или несколько вместе устраивают распродажи совокупный поток приходит в нас как в по иманд агрегатором мы собираем эти платежи и расписываем их по тем банком и янгом с которыми мы сотрудничаем они в свою очередь идут в платежные системы тех карт которыми были оплачены покупки не уходят банка-эмитента которые выпустили эти карты выглядит это приблизительно вот так вот для того чтобы подготовиться нормальные эффективных распродажи нам необходимо подготовить и себя и всю цепочку которая стоит за нами здесь повлиять не не только на свою производительность не на всех партнеров а учитывая что мы работаем финансовой среде и работаем с реальными деньгами чужих людей делая это весьма непростое карточная авторизация обычно состоит из двух частей это блокировка денег на счете а потом уже последующие списание наверняка если вы были за границей то при заезде в гостиницу вас например блокировалась какая-то сумма на счете но потом возвращалась но если вы конечно брали с собой полотенце то не возвращалась здесь тоже самое сначала сумма денег блокируется потом списывается поэтому во время распродажи обычно идут два потока первый поток основной который обычно и укладывает всю систему денежных переводов спать на долгие годы 2 идущий после нее это поток этих самых списаний клиринга что подразумевается когда я говорю про распродажа в яндекс деньгах 10000 магазинов несколько банков и кого аренду с которыми мы сотрудничаем и банки эмитенты практически все потому что мы не знаем какой карты будет платить человек это может быть и mastercard visa и мир unionpay и даже american express вроде бы как поэтому когда мы первый раз услышали о том что у нас глядят с продажам мы оживились потому что наши например выше и кадры сказали ну здорово смотрите какие там графики замечательные секунды выжить тысяч операций в секунду ну и наверное чек этой операции чатни как будто что-то ну рублей за 500 хотя бы можете представить себе что за секунду 500 тысяч рублей это шикарно многим там ипотеки вот так вот заплатить 4 секунды ипотека закрыта это были наши ожидания естественно все наши технические работники сказали естественно мы выдержим зуб даем вот и сказали давайте пока на тестовые среди я спокойненько посмотрим что у нас есть не просто очень интересна эта тема потому что я пришел на нее работать яндекс деньги это то задание которое мне дали как знаете первому человеку который пришел в полицейский участок и юный стажер отыскали посмотри ну что я надо ставить и где посмотрел получилось 5 транзакций в секунду и система больше не тащила сказать что многих это расстроило это ничего не сказать и люди сразу начали придумывать какие-то различные объяснения тому почему именно 5 не 1000 кто то говорил что тестовый стенд это не продакшен но на продакшен нельзя кто то говорил что вы знаете это просто вы не правильно мерить и правильно мерем ладно тогда мы подумали ну ладно хорошо если у нас на тестовой среде такие за не получается давайте попробуем мягко и безопасно выйти на продакшен чтобы померить но продакшене данных production она должна же быть лучше так вот на тестовой среде приблизительно или на продавши не выглядят наша система какие-то данные у нас приходят из магазина поступают в приемник для карт он уже делает запись о заказе в базу данных обновляя ее статус последующем уходит защитник который так или иначе обновляет данные об этом заказе смотрит если какие-то ограничения по числу операции по суммами операции подозрительной или вы личность может быть вообще террористами еще кто-то забывает блокирует платежи так же есть отдельный модуль компонент который называется магазы этим а газа у нас со своей маской работают они обработают непосредственно уже списание которые идут за авторизация my и соответственно передают данные в игру систему для полноценной обработки и в учет после чего получив всю необходимую данному все необходимые данные по данной транзакции с карт посылает запрос в банк эквайер а он уже идет дальше по цепочке платежную систему или в эмитента вы видели этом в пейнте просто мастер просто масть в первым главным вопросом вот этой схеме было как же мы будем эмулировать работу нашего банка-эквайера самый простой вариант которые только только пришел на ум давайте заглушку напишем заглушку нас развивались самые первые заглушки напоминали тупые были откровенно не всегда говорили об это тупая согласно всегда заглушка написано было набрать простом жетончики она просто говорила о скорость ответа около нуля то есть фактически мы просто забили на банк-эквайер и смотрели на всю работу в отрыве от него здорово умная заглушка я бы сказала чуть поумнее это как сказка трех братьев чуть чуть поумней а потому что она генерирует задержку от банка-эквайера в указанном нами диапазоне в чем тут проблема распределения равномерной то есть если мы указываем что банк отвечают за время о двух секунд до 5 секунд то где то в конце мы собираем данные по всем нашим запросам и получается что там равное распределение времени ответа наконец нас это перестало устраивать мы взяли реальные логе обработали их написали систему регулярной обработки получили что-то наподобие гауссовское зависимости померили эту голосов скую зависимости написали интеллектуальную заглушку и теперь у нас появилась вероятность времени ответа в этой заглушке которая так или иначе помогает эффективно эмулировать работу банка-эквайера ну хотя бы хоть какой то вот такой вот аналог идем на прод перед тем как выйти наоборот мы попытались учесть все риски для подготовки к распродаже тут и тестовые маршрутизации параллельно пользовательской что пользователи не дай бог не затронуть иначе если мы завалим нашу систему завалиться и то ее через который обрабатывает пользовательские транзакции и пользователи почему-то будут недовольны сделали специальные тестовые карты написали для них тестовые бен и внесли в этом маршруте за цию и решили во все вопросы с безопасностью мы внесли номера наших карт в исключения для тех правил то эвристики которая работает с с башенками сначала была идея сделать такую канареечный у ветку на продакшене выделенную исключительно специально для наших экспериментов помните как канарейки в шахтах первым умирает канарейкой если умерла канарейка шахтер эвакуируются если бы умирала деятельность в этой ветке мог бы моментально прекращали бы наш эксперимент и разбирались уже с его последствиями но в итоге это не прокатило а вот смотрите это наш индекс танк мы постреляли первые результаты стрельбы нашего продакшна действительно не 5 но во первых 20 справа и причем пикколо 20 а слева время ответа приблизительно полсекунды я не думаю что 20 это настолько же хорошо как и например тысячи у нас появились первые узкие места которые мы в принципе только где бы только не находили провалы в сохранение данных в баскина магазах не дефицит памяти там же стреляли первый раз мы достаточно интересно подготовки к стрельбам такой системы проходит обычно в ночное время и все стрельбы проходят день будь там с 3 ночи до 6 утра когда пользовательская активность на прием минимально и мы если что-то и уроним то уроним это максимально бережно иногда некоторые люди которые нам были нужны для анализа или починки были дома в это время и вы удивитесь они спали в это время и вот один раз я на эмоциях получив такие результаты позвонил нашему замечательному представителем биби и спросил в 5 утра что не так с баской ну что я могу сказать вот точная цитата того что он сказал это где-то первые первые самые стрельбы когда для всех это было еще в новинку люди как-то вы не хотели ночью просыпаться и такую чушь но хорошо что ж у нас дальше на самом деле спасибо этому человеку потому что он дальше предложил несколько доработок существенных которые помогли разогнать базу этих самых магазов до приемлемого уровня мы выключили какие-то совершенно очевидные вещи которые мешали продуктивной и производительной работе этой самой схемы после чего погрузились в аналитику опять-таки со стороны б.д. оказалось что у нас в то время была организована работа с ломами и эти самые ло бы работали под как конкретным лаком и этот лог заставлял писать данные во все новые области тем самым нагружая своими постоянными представлениями на и а псах нашу маску в результате получилось что у нас неоптимальное хранилище не оптимальные диски и не так хорошо наши запросы который используется поэтому мы свели вместе админов баз данных и разработчиков и попытаемся ты исправить кроме этого нам удалось оптимизировать выгрузку логов потому что оказалось что наша система была не предназначена для большой для работ услугами большого размера и одно дело когда у вас постоянно например на продавший не идет порядка десяти транзакций в секунду а тут пришла на 1000 или 2000 с этим возникают сложности ну и естественно мы не забыли проверяйте жива ли вообще наша заглушка более того чтобы более или менее уравновесить работают и заглушки мы сделали балансировщик и поставили несколько хостов на которых были размещены эти самые заглушки эти самые заглушки работали прекрасно их интеллектуальные версия они очень четко работали и показывали только отработает банк-эквайер с точки зрения времени ответы но на небольшом потоке спустя пару недель после всех проведенных оптимизации совместно с белыми с разработчиками мы получили что у нас есть существенный прирост можно до 300 транзакций в секунду мы уже более-менее выросли с 5 до 300 возвращаемся к нашей схемы после того как мы потеряли магазы и б.д. мы вернулись обратно к нашей основной компоненте который принимает на себя запросы с магазинов это база страттон оказалось что теперь мы перегружаем другую базу базу как раз таки того самого компонента который работает с картами обслуживают все заказы авторизации которые приходят к нему и складирует их непосредственно свою базу вот данные из нашего задница которые подтверждают что во первых мы съедали полностью утилизацию на жестком диске и 2 который показывает что она также б.д. он упирались в циpкa поэтому мы решили найти нормальные диски чтобы можно было на них более менее работать проблема была в том что детстве нужны были достаточно быстры и на рынке такие либо стоили очень дорого либо требовалось большое время чтобы их найти поэтому мы пока и мы с вами тоже отойдем от этой темы и проверим к нашу систему на стабильность в течение 12 часов мы подавали на нашу систему нагрузку в 100 дпс потому что одно дело добиться производительности 300 tps на 5 минут и упасть например потом другое дело выдерживать течение суток эту нагрузку чтобы не ложится так же как другие в итоге диски нашлись а нагрузку мы выдержали диски мы поставили и получили небольшой прирост до 600 дпс исключительно за счет дисков разгрузили нагрузку на диск сгрузили на баску теперь а нагрузку перешла дальше по схеме непосредственно на сам компонентами оказалось что сам компонент загружает себя тем что ходит во все остальные поэтому самым оптимальным решением было во первых отрубить те походы которые не нужны это раз во вторых оптимизировать те походы которые необходимо оставить и те походы которые можно было распараллелить распараллелить совершенно очевидные решения вот так мы и сделали следующим образом мы оптимизировали работу между с картом защитником так чтобы он эффективно работал но при этом выполнял свою функцию по блокировке нежелательных операций а всю деятельность по учету и обработки в ядре вместе с морозами поставили параллельным потоком с ограничением доступа то есть приблизительно так у нас есть приходит приходит заявка обрабатывается в страте и старт сразу посылается данные в эквайер а вся деятельность по учитывание этой транзакции у нас в системе проходит параллельно и что вы думаете после того как все это было сделано у нас время 1 операцию нашей системе сократилась где-то до 25 миллисекунд многие спросят что это за пике на графиках это данные самого первого эксперимента которые нас так сильно порадовало то что мы попробовали получили 25 миллисекунд это вообще какие-то офигенные числа и в итоге у нас получилось вот столько как вы думаете стоит радоваться если наша система выдерживает порядка 2000 транзакций в секунду даже больше чем вроде бы как на заявленных распродажах от которых писали газеты то есть любую распродажу наша система должна выдержать вроде бы как но с другой стороны это не совсем хорошо а мы даже баску самого скрата и сам scrat тоже немножко подделали вроде бы пара радоваться мы себя разогнали не стоит наступать на грабли на которые наступают большинство и разработчиков и в том числе разработчики в финансовых систем если вы работаете быстро ты не значит что вся цепочка вместе с вашими контрагентами работает так же быстро скажу так как только первый контрагент согласился поучаствовать вместе с нами банк-эквайер пострелять так сказать в него как только мы постреляли мы получили пять операций в секунду и через две минуты он упал в усмерть то есть замечательно мы где-то 200 две тысячи транзакций мы в себя принять мужем но передать никому не можем это вот ощущение своей собственной при вас превосходство своего ну ну и по идее вы могли бы забить и сказать что все хватит нет нет заглушка вместо заглушек должны выступать нормальные реальные банки которые могут обрабатывать все эти самые транзакции в общем идем стрелять в эквайринг как бы сказать если внутри одной финансовую организацию очень много ограничений очень много различных сложностей закрытости то связать 2 а то и четыре финансовой организации это вообще задача очень веселая очень веселая и то есть при чем вы работаете только по одному направлению а у нас банков и ква рингов много они все молодцы вот на самом деле с каждым из них договориться нужно иметь определённый особенный подход что обычно мы просим от банка-эквайера если он соглашается на наше условие поучаствовать в нашем эксперименте мы говорим предоставьте нам точку входа на своей стороне в которой мы будем стрелять и желательно чтобы там не было севильи 3ds ну так сказать так проще так лучше тысячи вполне себе реальных карт откуда мы будем стрелять на данный момент мы с вами предлагаем такую возможность у нас есть возможность имитировать собственные карты и использовать их в этих самых экспериментах но если например какой нибудь другой банк предоставит эти карты своей стороны то будет намного лучше знаете чем здесь большая проблема если мы тестируем например один банк и он предоставляет свои карты игры повторяйте используя наши карты это означает что эти карты не пойдут дальше платежную систему и в банк эмитента не эквайер равно эмитент и все операции выполняются быстрее потому что выбирают цепочку партнеров ну как минимум два звена поэтому лучше когда у нас есть два банка и каждая настолько хороший открыт что может дать карты для тестирования 1 а другой может дать карты для тестирования другого тогда это будет гораздо лучше из чего состоит бюджет такого эксперимента обычно бюджет и бесплатный надо сказать что мы исследуем на протяни на тестовых контурах во вполне себе реальным продакшене используя полной мощности нашей системы которые позволяют безопасно и проводить пользовательские транзакции и параллельно проводить подобного рода эксперименты в том числе это обеспечивается из-за высокой сознательности наших специалистов которые работают наши компании во-первых бюджет состоит из денег которые мы передаём платежной системе тех карт которые мы используем по разным статьям деньги которые мы передаём за комиссию эквайрингу и деньги которые непосредственно участвуют платежах мы стараемся на этом сэкономить так получается что большинство транзакций которые ходят в нашей системе они должны быть не меньше одного рубля если транзакция меньше одного рубля то высока вероятность того что банк эквайринг со своей стороны или уже дальше платежная система или банк-эмитент просто отобьют этот платеж потому что ему его невыгодно выполнять то что сами понимаете комиссия она идет по всем операциям здесь в данном случае они не могут ее снять и вот это тот самый первый эксперимент с первым банком есть разные банки есть банки которые достаточно быстро подстраивается под эксперимент есть которые не очень быстро когда мы только начинали это был первый эксперимент это такая старая фотография который я показывает о том что банк который говорит сразу давайте проверять 100 транзакций который может быть все таки лучше поменьше начать или хотя бы лесенкой подавать интенсивность входную тут нет давайте сразу 100 и мы получаем то что мы получаем что мы получаем что у нас мы подаем 100 и производительность и течение 1 минуты начинает сразу проседать а через минуту идет уже красная линия ошибок результате банк не успевает справляться и получаются одни ошибки на его стороне второй вариант банк дворе так хорошо давайте 5 мы подаем на него 5 транзакций в секунду хорошо мы подаем 5 транзакций в секунду и вот в течение 5 минут банк уходит в космос потому что время ответы от него растет и самые частые ответы оттуда у нас все штатно все штатно потому что согласно спецификациям работает из системы она не должна работать за за 50 секунд вам как клиентам тоже наверняка иногда непонятно где же ваши деньги в это время крутятся особо сознательные пользователи которые например платят через сеть что делают нажимают f5 а иногда у них просто бывает заклинивает полезное в 5 и в некоторых случаях это создает дополнительные заявки дополнительную нагрузку на систему которая и так справляется чудесно но тут два варианта есть банки у которые сразу уходят в усмерть есть банки которые начинают затягивать то есть такая актерская игра не от спасибо не надо имеют в таком духе мы относимся к ним так же как своим родственникам у них есть проблемы это не знаю что мы их не любим мы не помогаем им как-то развиваться и чинить свою производительность по идее мы же могли просто сказать вам жаль вы недель не держите нужную нагрузку до свидания ничего подобного мы помогаем как можем цены недавно даже в историю с одним из банков наши специалисты по модели настраивать им они пустили а мы им настраивали так или иначе я тату инфраструктур здесь есть некоторая отрешенность взаимопомощь и адекватность в отношениях но так вы думаете магазину и человеку за сколько времени приемлемо получить ответ вы не за 50 секунд точно многие магазины которые к нам ходят говорят вы знаете вот 5 секунд это хорошая цифра это хорошая цифра но за две секунды было бы лучше мы с этими цифрами идем в банк могут не знаю ничего там какой-нибудь менеджер банка гарит не знаю у меня по стандарту 35 секунд тридцать пять секунд плюс еще действенно имеющие плюс 15 туда еще 23 4 ну вот получается где-то полторы минуты и нормально но это разные банки опыт работы показывает что здесь замечательные технические специалисты в разных банках которые идут навстречу опять-таки и как только дело сводится до простого читы в телеграме в котором сидят два технических специалистов то работа идет гораздо быстрее то есть мы помогаем всем нет серьезно помогаем и если кто-то захочет стреляться пожалуйста нам мы поможем если магазин не готовы ждать больше пяти минут но мы объясняем что надо что-то менять с этим возвращаемся даем возможность банку или самому себе подтюнить что-то многие банки вполне справляются с этим они очень хороши те банкинг на первую которых сложную структура то есть между нами и банком есть несколько еще дополнительных контрагентов или у банка есть свои сторонники то есть банком по названию но например процессинг у него свой вендор у него там дополнительный какой то еще свой нотификации обслуживают еще кто то еще кто то нет я не знаю ничего не могу поменять и как нибудь какой нибудь поздней ночью а все-таки и стрельбы в основном проводится там с 3 до 5 вот например так как ноябрь вы все понимаете это благ фройды то сейчас например у я последний месяц активно занимался боевыми стрельбами где-то приблизительно два раза за ночь плюс еще днем два раза более менее нормально поэтому не удивляйтесь что на мой коллега с youtube не заснул удивляйтесь почему я еще не заснул идем дальше ищем распродажа а это не та картинка в общем распродажа на распродаже как только она начинается сразу появляются какие-то дополнительные проблемы вот смотрите сейчас важный момент вот график распродажи естественно без оси тот кто спросит почему нет оси ординат тоже нельзя показывать но я сразу скажу там несколько сотен несколько сотен операций в секунду это график из наших граф анны с одной из распродаж с группой наших контрагентов а вот например график который нам прислал банк эквайринг который тоже был благодарен за помощь в работе с ним моего батю не ли когда-то он был совсем не производительным а сейчас вырос где-то в сто раз по производительности из-за наших рекомендаций и советов из-за своей деятельности которых он обратил на это внимание он принял решение не игнорировать эту ситуацию не умереть во время распродажи разогнаться выдержать эту нагрузку и получить прибыль как только начинается распродажа мы все садимся вокруг мониторов то что уже повлияет ни на что обычно не можем берем попкорн и смотрим за тем как падают дома прям как замечательных фильме бойцовский клуб но расслабляться некогда вроде бы как добились результата две тысячи транзакций на нашей стороне подтягиваем банк-эквайер они сами подтягиваются нельзя расслабляться ради этого у нас в компании есть несколько замечательных приемов во-первых мы в рамках continuous integration вели у себя авто приемку релизов по производительности важно отметить потому что авто тестирования у многих есть этот процесс для многих компонентов о которых я уже до этого говорил замечательной понтовые схеме помогает отслеживать деградации или повышение производительности нагружая буквально каждый релиз регулярные боевые стрельбы на проводе как с контрагентами так и без контрагентов плюс постоянные review кода и тюнинг привлечение сознательных разработчиков на то чтобы можно было разогнаться что могу сказать сказать в заключение что боевые стрельбы с нашими партнерами продолжаются по моему сегодня должно быть как минимум 2 стрельбы и самое интересное они должны быть днем то есть это уже настолько стабильный и отработанный механизм что мы стреляем ся прямо днем мы прямо наших банков-партнеров мой коллега в петербурге вроде бы как должен был их грузить давайте им туда ему позвоню со своего смартфона очень легко и доступно его зовут витя он вроде как не знает час секунду я не знаю качество связи это чисто моя выдумка техник простит все шум будет а ведь привет суши ну чего вы грузите там ничего оба банка оба дачу днем ну ясно ну ладно хорошо все давай только могла давай пока мы ведь он прямо сейчас грузит какие-то банки поэтому если у кого то не выполняют в карточной операции то извиняйте ваше делать соответственно технически мы настолько подкована что у нас есть стабильный работающий алгоритм исследования производительность любой эмиссии и любого эквайринга поэтому если у вас есть какие-то идеи или желания проверить вашу миссию coloring технически мы на это способны вопросы договоренности это уже к нам и денег нам поэтому ваши вопросы ребят да растянута ли спасибо большое за доклад я здесь вот здесь 1 и 2 вопроса очень хочется оба задать не могу выбрать один вот все-таки стрельбы с точки зрения то есть это эта покупка чего-то и и стрельбы как бы этой эмуляции все-таки покупка происходит или нет что там происходит то есть как вы генерируете эти транзакции это транзакции реальными деньгами с реальных карт которые просто участвуют в эксперименте ну а там получается они что петух и с карты на карту или какая-то меня это исключительно карточную авторизация то есть когда мы с карты на счет магазина перечисляем деньги ну то есть потом транзакций по ней не будет только халдир уйти от ран занят нет будет благом всё по-честному все по-честному но тут есть два варианта либо мы можем провести только блокировки и оставить их подвижном состоянии пока они не истекут или сделать по ним три ринге дополнительно подтверждение этих блокировок и получить вот второй вопрос такой о насущном все-таки как вы объясните что там вот во всех залах говорят про миллионы транзакций в секунду а когда мы говорим про финансовые транзакции мы все-таки действительно говорим о тысячах транзакций в секунду в чем в чем разница разница в том что финансовая система в том числе банковская в россии она только развивается у нас не так много карт и не так много активных карт которыми люди пользуются по данным от моих коллег например из германии и соединенных штатов там поток существенно выше но все равно во всем мире на мировых распродажах он не превышает порядка 10000 транзакций в секунду это на самых крупных распродажах и большинство такой информацией в основном или находится под индией конкретной компании или просто носит гипотетический характер который а цены оценка от менеджера который не обладает техническими познаниями для того чтобы сформулировать конкретные вещи это мы сейчас про блокчейн еще дальше будем разговаривать про количество транзакций да пожалуйста спасибо за доклад это два вопроса первый вопрос выпытал как-то обговаривали с платежными системами с виза и master card мы так далее своей нагрузки и в том числе там чтобы они меньше денег снимали или бесплатно как-то проводили отдела и второй вопрос какие дальнейшие планы как бы вот вы на этом останавливаетесь или куда-то дальше идете как то еще планируете усложнять или развивать схему проверок этих хотим во-первых мы так или иначе пытаемся обговаривать с платежными системами то что мы делаем при этом это не всегда получается но надо сказать так как большинство банков на своей первоначальной стадии исследования показывает ну не хорошие результаты то платежная система в принципе не так сильно и замечает этот поток транзакции при этом получалось него прибыль за счет разного рода комиссии я не думаю что платежная система должна идти на уступки в этом направлении то есть это исключительно выбор нас и банков отваров участвовать в этом эксперименте или нет потому что участие в таких экспериментах она платно то что касается вопросов развития у нас появляется очень много новые логики в яндекс деньгах не только карточные авторизации но и много другого нового и все это мы планируем и уже частично используем на данный момент порядка 30 профиле у нас который мы используем проверяется на продакш ими в том числе с разного рода контрагентами мы работаем как с частными компаниями так и с государственными и вот на данный момент мне особо интересно область взаимодействием с государственными компаниями как вы знаете у нас есть например сервис проверки штрафов недавно появились сервисы оплаты парковок и буквально вот-вот у нас должны принять еще несколько новых сервисов по данному направлению и все они так или иначе подразумевают новый поток операций новый поток платежей и вот их всегда интересно реализовывает на продакшене не на тестовом стенде которым мы тоже используем фиктивно мной на продакшн натали спасибо большое за интересный доклад я слева от вас я так пойму за вашего доклада что у вас большую часть времени когда нет распродаж рису но большая часть ресурсов простаивает если у вас ну это не считается большой проблемой или считается и вы как-то придумали как их утилизировать остальную часть года вот расскажите об этом я бы не сказал скажем так на время распродаж мы подталкиваем дополнительные мощности в принципе большинство компаний отказывается подтаскивают дополнительные мощности и просто или лежит или не участвует в подобного рода распродажах отказываясь уже даже на менеджер скам уровне при заключении соглашений поэтому наша система загружена и обычным нашим потоком какие-то пиковые распродажи на этой отдельной истории которому обычно отдельно готовимся в ближайшее время будут новые распродажи в в ноябре посвященные черной пятницы во многих из них мы участвуем и самое интересное если во время них будет лежать и миссия других банков то вы можете спокойно оплатить покупку через яндекс деньги ну просто я могу это гарантировать исключительно вот потому что я знаю что этот сервис работает пара-пара-па-пам спаси большая жалко что у вас не было графика какой собственного типа карты использовать их желательно какого банка то есть иными словами может предположить что все настолько плохо что нет ни одного нормального банка нет ни одного типа карт и в россии вообще больше тысячи операции на всех это как никак не тема олега тинькова то что все банки не так ты получил только что сказал что только яндекс деньги будет работает она не понятно как если все плохо работы я сказал не так неосторожно 2 деньги гарантированно будут работать ну ваши ваши как бы компании с которыми вы работаете то есть и visa mastercard и вот это все вот это все будет плохая не хотят товар главное проблемное звено в россии это банки эмитенты процессинге обеспечивающие миссию карт не всегда несут высокую производительность за собой хорошо банки эмитенты там потягивает а нормально работает да да то есть два три сколько ну хоть какие-то цифры но и не знает в процентах 44 нормально работает четыре болта нормально они русские мы работаем только с русскими банками остальное во первых запрещенном спасибо анатолия новоцвета логотипов хотя можете назвать этих банков выключить трансляцию там есть черный цвет черный черный цвет голубой есть или уже голубых в россии не должно быть правильно продолжайте мы с вами все вообще это гарри чески эта политика партии это политика партии мы так зеленый он и смотрите так страх сейчас страх в глазах промелькнул страх нет ни этого страха объясняя во время последнего интервью газете коммерсант наш генеральный директор назвал четыре банка с которыми мы работаем в области эквайринга вы можете почитать эту статью эти банки указаны персонально первым языком ну это те о которых сейчас есть шанс и ближайший мой день директор говорит что эти банки хорошие у меня нет причин его не доверять я без микрофон нельзя будет добрый в следующий такие cypher вы можете сказать следующий вопрос нет зачем вам пожалуйста дальше и покажите им же крупным планом чтоб трансляция его видела простите большое за вопрос но как вы умудрились этого не заметить год назад два год назад 3 год назад не знаю там когда-нибудь и еще и мог много лет назад то есть ну как ну то есть вся компания мы говорит мы не знаем что у нас 5 транзакций секунду а потом и морил ну как я вот и понимаешь а потому что финансовый поток был меньше пяти транзакций но продать мне пример было меньше но не знаю у нас скопить чатике делают это как-то с большим каким-то минимуме меньшим пренебрежением не стоят и я в шоке спасибо давайте пожелаем друг другу что у нас у всех было столько денег что мы вот столько же тратили транзакцию нас было составных сколько в чатике от транзакции это было когда у нас еще 2 не было это была несколько лет назад это было несколько лет назад обстоятельно так вот каждое сообщение девушки это цветок пожалуйста лучше деньги анатолий спасибо за доклад пару мелких вопросов 1 не дули не думали вы ли вы как-то priority заводь ваши запросы именно ректор излечить обычных нормальных людей которые хотят заправиться от вот этих безумных зомби и второй маленький вопрос может может не думали ли вы каких-то алгоритмах другое мы знаем что этот банк обрабатывает не больше 10 запросов в секунду просто не грузить его сразу же rejects мы типа временно недоступны вот какие то китай эвристические алгоритмы защиты от перегруза то есть circuit breaker этом роде тут две вещи то есть почему зомби судим по себе вот я лично по себе сужу я сам безумные зомби и поэтому в операциях вот так во вторых то что касается предупреждать банки менеджеры банков заявляют более крупные цифры и просят именно их подавать на них мы люди простые нас просят мы подаем если если раз на 10 человек убеждается что это не совсем работает ну окей то есть по факту заявленной осло которая не заявляет она совсем совершенно далеко от реальности правильно да нет как раз таки просто ссылок который вообще в банковской среде присутствуют они достаточно высокие у нас есть контрагенты магазины для которых у которых и салат модулю пять секунд на это от силы и банки которые работают у них солана примеру крип 35 секунд по моему время ответа от эквайер нпс у кого страна глазах из вас телефона сыпется оси боится приоритетом тоже получается даже не нет не получается не манят мы просто честно исследуем случаем честный результат спасибо что дождались пожалуйста он отеле спасибо большое за доклад а вы говорили о транзакциях перфомансе прочим тут была речь наверное про бизнес транзакции ну или финансовые мне как тебе интересна каждая бизнес транзакция с из скольких транзакций в базе данных она состоит потому что иногда это может быть там один к одному иногда бизнес транзакции может состоять из десятков и даже сотен транзакции вбд это первый вопрос и 2 судя по конфигу я увидел у вас там под grease и oracle даже такие это это или наша компания сейчас проходит уже практически прошла долгий путь перехода от oracle и анапа сгрыз поэтому мы видим будущее наверное за по сбросу но я не знаю такие планы технические у нас спасибо первый вопрос трансакций да про транзакции в принципе одна такая карточная транзакция уже как я довел состоит из двух подтипов это блокировка из писания так вот на блокировки могут быть несколько даже походов в контрагента если так так организован протокола обмена данными по среднему могу сказать что на одну авторизацию с нашим любимым банком наверное у нас приходится порядка четырех запросов б д то есть вот это только на авторизацию я думаю по не больше десяти на всю операцию и блокировки из писания спасибо еще друзья здесь спасибо госпожа справа справа с нашим простите спасибо за доклад вопрос такой в бэг-энде арт bmf классические я так понимаю что это ради фула тетради надежности правильно вы рассматривали если вообще у вас необходимость там какие-нибудь in memory решения применяйте которые тоже обеспечивают надежность но работают они там в десятки раз быстрее или вам вот вы уперлись и по факту вам хватает больше не на фактически сейчас у нас есть очень существенный запас на две тысячи транзакций по карточным операциям основной нашей сферы деятельности по развитию этого направления идет работа с банками кавалерами помощью консультации если у них есть такая необходимость и они хотят участвовать распродажа вот пожалуйста да еще такой вопрос но наверно больше организационной когда взаимодействуете с банками в организационном плане не в техническом ну договариваетесь о нагрузке там выходите на тех специалистов и так далее ну ну исходя из логики наверно вам с маленькими банками проще то есть и договориться с маленьким проще и разогнать наверно маленький проще вот а с большими как раз наоборот ну там из топ-5 в россии наверно вот это как бы реально так или нет такой зависимости на самом деле все зависит от внутренней культуры компании и на самом деле может быть скажу очевидную вещь чем более и иерархически построенную структура банка тем сложнее принять решение на которые требуется множество соглашения прав и так далее банки даже даже из топ-5 многих есть более неформальный подход и как тогда вместе директора и и непосредственно исполнительно работают в одном часе сидят и там очень быстро можно получить 3 одобрения в течение минуты но есть такие банки о которых ты ждешь обязательно письменного уведомления виде письма на которые ты обязательно должен ответить и только в определенной переписки и только в определенном формате общения здесь просто как разные люди так и разные банки скажем можно находить какой-то определенный подход понятно это был анатолий московский спасибо большое"
}