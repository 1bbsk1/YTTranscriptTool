{
  "video_id": "33424uhD1ng",
  "channel": "HighLoadChannel",
  "title": "PostgreSQL на K8s в Zalando: два года в бою / Александр Кукушкин (Zalando SE)",
  "views": 4105,
  "duration": 2796,
  "published": "2020-04-14T11:32:12-07:00",
  "text": "я работаю в zalando уже почти семь лет кто из вас слышал о zalando для тех кто не слышал это компания похожая на российскую или моду мы продаем одежду и обувь но делаем это в европе в 17 странах у нас 7 есть семь своих логистических центров и складов zalando работает больше 15 тысяч человек и из них порядка 2000 работает в технолоджи все люди в технолоджи распределены примерно 200 ом командам которые пишут приложения и в последнее время мы диплом очень много всего ну-ка верни this и работаем много sq верните сам о чем вообще этот доклад значит в первую очередь для тех кто не очень знаком ce que вернитесь я немножко может быть расскажу о том что это вообще такое расскажу о том как мы диплом по знаку вернитесь с помощью спелые патроне какие задачи нам помогают решать по сгрыз оператор на кубе рн эти 7 и самое интересное самое мясо после всего этого пройдусь по проблему которые можно над на которой мы натыкаемся и которые приходится лечить и очень тщательно исследовать значит окей мы используем кубер нить из очень активно у нас более 140 кластеров это примерно 50 на 50 production & test in момент то есть каждый куст юнит получает свой два своих купер notice кластера на тестом можно гонять любые тесты можно деплоить как хочешь можно и ту туда есть и прямой доступ без а безо всякого контроля на продакшен deployment исключительно через соседи даже докеры мочишь который туда тепло это должен быть собран с помощью соседи доступа к продакшен кубер нити с кластером напрямую у нас нет но доступ возможен этого надо либо попросить коллегу заправить такой request такой так называемый принцип 2 4 глаз либо должен быть какой-то инцидент и дал должен быть открыть тикет в одном случае доступ может быть открыт с помощью инцидент тик это значит сколько у нас по сбросу наку вернитесь на самом деле цифра достаточно большая там получается примерно 10 среднем 10 по сгрыз кластеров на один кубер нить из кластер на самом деле по сгрыз оператор и по знаку вернитесь и работает не во всех кластеров а примерно наверное на сотни из них и из этих ста сорока так что в среднем до такая цифра еще больше значит кто из вас знаком с кубер нити сам с подвесом то есть в общем практически большинство я не думаю что следует уделять много времени написанию что вообще такой q вернитесь в принципе для инженеров которые не знают всегда можно найти какие-то ассоциации то есть физический сервер какой-то сервер и в кумир найтись и это называется но да и ее можно посмотреть то что у нас есть тут надо с помощью тузов виртуальная машина это на повернитесь будет подобие под и так далее и тому подобное все все это выглядит на картинке более красочно у нас есть одна или несколько мастернод и есть worker ноды на котором несколько значит кодов или приложений которые исключительно для кубики писать такие как купли докер френзики прокси и так далее есть ряд кодов это уже под и в которых будет работать ваше приложение как нам деплоить базы данных для баз данных нам нужно где-то хранить данные как вы все знаете докер был изначально не очень приспособлен для работы с данными на кубер найтись и ситуация в этом плане немножко лучше там есть такая вещь как persistent волю мы и перестанут валим клеем и самая вишенка на торте это стоит full set который во-первых позволяет нам запустить гарантированное количество кодов с стабильными и идентификаторами то есть у каждого под а будет всегда уникальное имя и самый главный стоит full set позволяет с помощью persistent вольем клеем и перечислим болен болен клейм template of автоматически создавать волею мы если они нужны или монтировать уже существующую волею мы к коду котором он был предназначен чтобы запускать по сгрыз или вообще приложения на к вернитесь и нам нужны контейнеры как правило повернитесь используется докер я не знаю можно ли сейчас использовать что-то другое вот нас есть свой докеры матче мы его называем спела спела в переводе с грузинского это слон вот внутри нашего имиджа у нас есть несколько версий по сгрыз а то есть на данный момент до сих пор начиная с 93 заканчивая версией 12 вот скоро будет в дополнении к этому там мы инсталлируем в этот ему всякие всевозможные полезные extensions пожгли совы и такие как портман печи крон позже из таскать там скилл биби и всевозможные дополнительные тузы такие как где bouncer это немножко анти паттерн к сожалению в мире докеры camber нить из нам это было необходимо поскольку этот же и матч мы используем помимо кубер нити с просто найти ту инстансов ума зоне для high visibility мы используем патроне вот и все это дело конфигурируется с помощью инвариант перевалов помощью переменных окружения так что такое патроне я думаю не стоит много рассказывать все уже должны знать это решение для автоматического переключения по сброса для хавела берите патроне написан на питоне и он интегрируется с кубер нити сам и делают пол сгрыз так сказать first class a citizen внутри кубер нить из то есть позволяет за деплоить по сгрыз нативно в принципе патроне по сгрыз может работать на кубер нить из безо всякого супервизор вроде оператора безо всякого безо всякой внешней помощи но патроне на самом деле немножко больше чем решение которое для автоматического файлов патроне позволяет деплоить новые кластер и то есть это выполнить и нет бибер для пол игры со либо можно с помощью патроне создать клон существующего кластера или выполнить point and america very это тоже бывает очень полезно в случае если мы добавляем новые реплики патроне будет их инициализировать и начнет стримить мастера и последнее чем тоже помогает патроне time and жить конфигурацию пол часа если мы хотим поменять какой-то параметров к в конфиге пол игры со нам можно всего лишь попросить патроне сделай это и он применит этот это значение к все многом как все это выглядит дипломы диплом стоит full set то есть на здесь на картинке у нас есть две ноты на каждом на каждой ноги будет свой пот и к каждому под у нас при а то чин persistent валим эти коды они внутри стоит функция то поэтому уходов именно дима 0 в данном случае дима один кто из них будет мастер кто из них будет реплика это решает патроне и патроним использует для выбора лидера для лидер рейс кубер не тирский объект and point то есть если у нас мастер пропал и происходит гонка за лидером то патроне во-первых между собой конектится решает кто будет новым лидером и под по после этого под новый тот кто решил я я должен быть лидером он попытается пытается обновить and point прописать свое имя туда и плюс прописать свой айпишник соответственно есть у нас еще сервис и лидер сервис если приложение будет конектится через этот сервис она всегда попадёт на под с мастером это так работает для реплику нас есть отдельный сервис где мы - репу например можно назвать как угодно тут важный ключевой момент мы должны использовать лейбл селектор роль равно реплика и тогда он выберет все коды с ролью реплика которые попадут в ад лейбл селектор вот как все это деплоить значит сначала мы как и все использовали я могу манифесты это задача принципе просто и мыть автоматизированное но никто не любит иметь дело с ямам он должен был быть человека читаемым и легко человек создаваемым но на самом деле он не то не тот и не другой но значит можно попробовать использовать home то есть будет ли такой easy deployment всего лишь одна команда у нас кластер готов но это не решает задачу rollin апгрейдов то есть если мы хотим провести mein rab great полоса мы хотим поменять докеры матч что нам надо сделать нам надо обновить стоит конфигурацию стоит feel so to speak у-у-у-убить коды которые относятся к этому стоит fools эту одно одного за другим вот другая некоторые есть про роли на грейда у нас может идти речь о роли на бреге самого повернитесь кластер и что это такое допустим вот у нас есть кластер из трёх нот значит но до 1 но до 2 но до 3 они расположены в разных вела билете зонах то есть разных дата-центрах это тоже важно потому что данные более мы с данными о нем распада обязан располагаться только вот в этих зонах значит если кубер нить из выполняет роль он апгрейт ему надо остановить резерве стартовать все worker и перезапустить их в случае с клауд in warm and какой ws когда мы термина этим какую-то какой-то счету instance он просто уходит и в итоге под будет запущен на новой ноги к чему это может приводить вот допустим у нас есть три кластера работают на 3 нодов мастера значит в первый два мастера в первую la beaute зон и один во второй значит оберните сначала убивает первую ноту мастера переезжают патроне этим занимается это вызывает такой небольшой interaction для приложения то есть на пару секунд connection и падают надо будет перри конектится вот уже не они очень хорошо но как бы мы с этим еще можно жить следующий шаг у нас мастера переехали и кубер нить из при выполнении роли наб great он убивает вторую ноду еще один мастер переезжает 2 мастер переезжает уже второй раз гораздо хуже никому такое не нравится у нас есть еще одна но до на который вдруг сейчас сказали все мастера и они при удалении последней ноты переезжают еще раз что у нас в итоге ужас то есть если посчитать то кластер а испытал три файла у р подряд то есть всего 30 у нас было всего трипода и получилось три файла вора кластер b2 класс сердце тоже 2 вот с этим надо что-то делать это надо оптимизировать и не только это на самом деле мы очень много страдали от того что управление кастерами было ручное то есть девелоперы приходит к нам про и просит мы хотим кластер по сброса мы создаем конфигурацию фарм оформляем pull request гид создаем кластер с помощью youtube все тело или с помощью каких там озон утилит амазона кластер работает после этого мы хотим его или зам грейдить или что-то там поменять на более мощный instance а это опять требует каких-то ручных вмешательств периодически надо создавать или у давать или удалять юзеров для сотрудников или нам нужно создавать юзеров для приложений в конечном итоге кластер либо продолжает жить либо и мы его удаляем значит какие наши цели нам надо в автоматизируйте абсолютно все тепло и менты с этим все понятно как бы это и раньше не было проблемой апгрейда кластеров это во-первых роли на great по сброса во вторых автоматизировать вот этот очень плохой роли на great кубер не this not самих создание пользователей всевозможных прилагают пользователей для приложений для сотрудников пользователей в базе и минимизировать количество файлов raw при любом таком мы intense соответственно мы решили все эти задачи с помощью нашего под газ оператора пропера про паттерн операторов повернитесь я не думаю что стоит рассказывать это всем известно идею в том что оператор просто в себя вбирает весь наш опыт и пытается делать автоматизирует все задачи которые мы делали но поскольку оператор эту машину этому может делать более качественные реагирует гораздо быстрее значит для того чтобы за тепло и кластер по сброса достаточно всего написать небольшой ямал файл здесь всего несколько ключевых моментов во-первых мы задаем имя кластер а мы еще должны задать на самом деле айди команды то есть ними команды team в котором я работаю называется eset отгадайте почему это основной принцип баз данных атоме сити и так далее это месте consistency аналогично durability вот мы задаем размер валиума в данном случае это 1 гигабайт значит к количество кодов 2 и версия по сброса мы хотим 11 в дополнении к этому можно задать михая то что оператор пожалуйста создай нам каких-то юзеров и создай базу данных и для для база данных укажи аврора вот эту пользователя как все это выглядит на практике приходит такой гибели player это либо человек либо себя и сиди он записывает вот этот ямал файл внутрь серги объекта который создал оператор оператор получает event по сгрыз оператор и начинает свою грязную работу он создает стоит full set с калиновская с каким-то количеством поводов он создает in point создает сервис создает секреты для приложения и для подвеса то есть для супер юзера и для для юзера через которые репликации работает приложение будет использовать секреты из кубер не tissot и конектится к этому сервису который в общем всегда нас будет подключать к мастеру значит как мы как нам оператор помогает бороться с проблемой rollin апгрейда роли нагрей докупить самого кубер не tissot возвращаемся назад к нашей старой картинки у нас есть три ноты у нас есть три кластера оператор знает что вот эти три ноты должны быть удалены из бластера поэтому он начинает действовать в первую очередь он удаляет реплики которые на этих модов + q вернитесь запустит эти реплики уже на новых модах потому что на старых нотах это запрещено делать получается такая картина одна надо полностью ушла потому что там уже нет никаких кодов на двух старых родах у нас еще работает мастера после этого оператор делает святогор и у нас мастера переезжают то есть качество свечи варов равно 1 после этого можно безопасно убить оставшиеся коды на новых которые еще не были загружены и все хорошо то есть количество свечи варов в данном случае потому что свеча вор был выполнен явным образом с помощью оператора равно всему одному все всего один даже в течение рабочего времени днем когда максимальный трафик большинство приложений способна пережить то есть им нужно будет рика перри конектится downtime будет всего пару секунд значит что у нас что мы видели плохого то есть какие мы ищу секс испытывали во первых мы все наши кубическую стира работаю твой ws отсюда возникают следующие проблемы во первых и ws и 5 ограничивает нас в количестве запросов которые можно выполнять через пять в случае если интенсивность запросов превышает какой-то порог и ws начинает срок лить что чем это плохо и поскольку мы используем ее дпс и 5 для того чтобы мы кубер нити сам используется для было себя и для того чтобы монтировать вмонтировать волею мы-то случае когда у нас под и переезжают на новые ноты подключения волею move может очень сильно задерживать и мы будем иметь наш пузырьковый кластеров немного деградированных состоянии там будет мастер но может быть не будет ни нет совсем реплик это не очень хорошо в случае если происходит deployment нового кластер а то это тоже может задержать это немножко неприятно на не фатально вот иногда и и ситу инстанции умирают в амазоне но к сожалению они вот не умирают вот как обычное железо все умерло и умерла нам с точки зрения мама зона и без волю мы еще подключены к этим инсам что это означает мы не можем их переиспользовать то есть наши данные где то есть но мы их не можем подключить к новым инстанциям и до тех пор пока instance не выключен абсолютно полностью с точки зрения мо зона валиум и так и висят то есть такой процесс занимает до 30 минут я виделся и на иногда даже больше это очень неприятно ночью ты проснулся и ждешь полчаса вот это немного не совсем проблема кубер нить из скорее проблема по сброса но если заканчивается место на диске ни к чему хорошему это не приводит отгрыз останавливается патроне пытается его при стартовать отгрыз стартует патрон него промоутер и происходит обратно та же ситуация недостаток места и такой круг крэш лук то есть надо обязательно занимать мониторить все включая и дисковое пространство вот особенно в облаках не принято использовать отдельные партии шины для логов например как как вы это делаете в дата-центре всегда используется просто всего один валим для всего это делается с точки зрения оптимизации затрат потому что маленький волен как правило дает очень маленькие ресурсы с точки зрения сруб утаили а вепсов большой волен дает вам больше вот почему мы не имплементировать авт an extent для воли его то есть в амазонии то можно сделать запрос то это всего один запрос и 5 и был у нас волю воле им в 100 гигабайт мы сделали его в пол терабайта и можем продолжать жить счастливо на самом деле если проанализировать все ситуации вот прямо все которые приводят к к тому что у нас место заканчивается то всего лишь некоторые из них реально отражают когда у нас количество данных выросла на то что необходимо делать of the extent во всех других случаях это у нас очень много каких-то медленных запросов очень много записывается логов то есть это все нам нужно оптимизировать если расширять волюма до бесконечности то это вылетает в копеечку иногда приложение просто забывают удалять старые данные иногда они приложения занимаются этим но по каким-то причинам такие джога ломаются то есть много всего происходит еще что мы замечали поскольку правил ability очень важно но без disaster recovery жить вообще нельзя мы используем воли для континиус раковин и для для того чтобы делать без бэкапы вот воля есть такая не очень хорошая черта он отказывается делать бэкап если встречает в дата директории файл размером больше полутора гигабайт в данном случае у нас 500 statements вырос до двух гигов вот я начал разбираться как так и выяснилось он забит вот такими запросами вида апдейт в r&d им и там сто пятьсот разных аргументов то есть точки зрения под газ это все разные запросы перестать стоит нас вырастает там до двух гигабайт польза от такого перестать стоит нас тоже нет еще и backup ломает то есть это конечно тоже не совсем ку-ку верните с относится но поскольку у нас огромный масштаб у нас много кластеров такие проблемы на такие проблему манатов над рано натыкаемся и это не очень приятно вот ещё одна проблема с воли он умеет брать быка только эксклюзивные бэкапы и в случае если вдруг под удалили или надо упала то внутри даты директории пожгли совы остается лейбл файл и все такой класть это такой такой такой дата директорию уже назад нельзя подцепить bizzarrini ирине цивилизации выход это использовать какой-нибудь лужу который позволяет позволяет делать не эксклюзивные бэкапы например пол джипе db крест тут есть 2 проблемы во первых это работает только начиная с 96 с пояса у нас местами из 95 в даже в облаках во вторых волны каждый раз когда его пытаюсь использовать я нахожу новые и новые проблемы сейчас мы решили включить его по умолчанию для восстановления из бэкапа всегда мы не используем воли а для архив для архивирования для без бэкапов мы до сих пор используем воли и теперь к самому мясу значит out of memory кто знаком с этим понятием вот в вдоль внутри докера или на кубер нить из это еще такой более непонятный зверь мы смотрим лог полоса видим один из процессов убит сигналом 9 мы точно знаем никто из людей не делал y не заходил на ноду не убивал все научены и доступа к продакшна нет начинаем копаться смотрим de mesa видим до 7 моррисси групп out of memory убивает поздравь но как понять что это именно наш процесс тут засаду в чем внутри контейнера у нас свои процесса егэ она хотя они отличаются то есть единственное что мы можем сделать с поставить время но при этом dimes touch - время выдает немножко смещенные почему-то вот можно попытаться отключить вам или настроить вот такой фейсконтроль параметр но в случае с контейнером собственно это мало чем поможет у нас там всего патроне по сгрыз то есть в итоге все просто зависнет и если никого не убить самое главное вот данный конкретный пример у нас memori memori memori лимит был указан в 8 гигов но ти групп на считала что используется 6 гигов + shared баф распугали пожгли совы еще два giga откуда набежали эти 6 гигов совершенно непонятно мы анализировали все процессы по сгорю совы и которые работали и никакие из этих процессов не занимались там памяти больше чем несколько мегабайт то есть у нас есть такое ощущение что все групп как может посчитать одну и ту же страницу из is shared memory несколько раз если какой-то из избы канатов и и запачкает чтобы немножко избавиться от этой проблемы мы уменьшили размер шара 2 фрс по умолчанию с 25 до 20 процессов процентов и количество случаев когда она так подала значительно сократилось то есть стала жить легче еще это про опять же про докера про кубер не this post гдз 11 версии вышел год назад production у нас попал спустя пару майнер релизов как обычно и к нам стали приходить люди жаловаться а чё это у нас приложение падают не падают там запросы падают с ошибкой нет места на диске начинаем разбираться оказывается места на диске это не там где у нас дата файлы лежат a shared memory и внутри докера по умолчанию но это shared memory 64 мегабайта всего и чем почему по сгрыз 11 он мозга с 11 появился parallels join он работает как он начнет сначала один маркер просто создает хэш записывает его в shared memory поскольку там у нас всего 64 мегабайта этот хэш туда не просто не помещается то есть что можно сделать на докере можно увеличить размер шаров dfm передав просто опцию указав новый размер ног обернитесь и так сделать нельзя то есть единственный способ это смонтировать ворьем ттм pfs валиум с именем дсм как то так то есть смонтировать и оттуда в операторе мы им имплементировать всего лишь одну настройку смонтировать вот такой волю соответственно включаем настройку получаем полю она не включена по умолчанию но видимо придется значит пол сброс тоже иногда доставляет опять во-первых логические slade и репликации при failover и могут терять позиции то есть с точки зрения патроне мы пытаемся сделать уменьшить вероятность пропустить какие-то ивенты патроне создаст слот после файла вора логический но нельзя указать на какой позиции она создавать вот еще если приложения очень жадны она может может открыть настолько много соединений что у нас появляется fatal тумане connections это ломает нам всю систему реплики не могут начать реплицируется matter и 12 пузырей в двенадцатой версии по сброса и я это решил пришлось взять уроки компилятор дебаггер и вынести maxwell maxwell sanders и zmax connections теперь для волос индра всегда есть отдельные slade и в плоскости больше мы таких проблем не увидим мы последние пожелания к по сбросу это было бы хорошо иметь такой built in connection puller но это так чтобы все знали еще что конечно самые вкусные напоследок значит человеческие ошибки очень часто люди когда описывают кластер манифест они создают либо слишком мало ресурсов либо слишком много то есть если можно описать манифест в котором указать всего не знаю там 100 мегабайт памяти она может быть даже запустится может быть будет даже работать он будет его оон киллер будет убивать все время если указать еще меньше она даже не запустится слишком большие ресурсы тоже приводит к проблемам как правило not pull там но да и фиксированных каких-то параметров то есть не знаю 4 ядра 32 гигов памяти если указать я хочу 5 ягер решат 4 га га то такой запрос зависит навсегда потому что но да не будет автоматически запущена кубер написано в нашем случае может кто-то эти проблемы решил вот что еще мы видели в продакшене кто-то удалил сервис аккаунт который используется оператором и спела соответственно все просто останавливается все полосы переходят в редон или это при при том что чтобы удалить сервис аккаунт надо было запросить доступ надо надо было чтобы какой-то твой коллега сидел рядом и проверял что ты делаешь все равно это происходит ямал форматирование я очень люблю этот картинку несмотря на то что наш кластер манифест не такой сложный вот мы периодически видели то что отступы не так выровнены рэй не так написано и так далее и тому подобное пришлось написать такую маленькую паузу в которую просто вбиваем название кластера версии версии по сброса выбирается из списка потому что мы видели когда люди указывали 10.10 например она так не будет работать надо указать ровно десятку размер волю мы и так далее и тому подобное то есть в итоге этот ул за генерирует манифест манифест можно скопировать сохранить файл отправить убит и выполнить на тестовом варианте у нас появляется вот тут сверху сверху еще одна кнопочка применить и тогда может она прямо там создаст принципе это практически все нам оператор позволяет постит почти полторы тысячи пуск рисовых кластеров они распределены практически нас так у вернитесь кластеров на этом мы затрачиваем минимальное количество усилий по ночам просыпаться если ты он шел среди недели приходится всего на один раз то есть каких-то больших проблем нету но мы работаем активно над тем чтобы не просыпаться вообще то есть любые проблемы которые мы идентифицируем мы стараемся решить имплементировать какое-то постоянное решение либо внутри патроне либо внутри спела либо оператор этим будет заниматься вот как то так все о чем я рассказывал у нас в open source оператор вместе с ю ай находится в своем репозитории патроне и спела в своем репозитории вот всем спасибо если есть вопросы да александр говорят для того чтобы прожить сто двадцать лет а ты уже вполне реально по оценкам сон одно из самых важных да вот правда все любят спать да спасибо тебе за глубоко практический взгляд который ты показал и за те проблемы которые топились я думаю что может быть даже еще в дискуссионные звонить или будут отвечать на твои вопросы тебе официально благодарность от оргкомитета и и маленький подарок для путешествий и руки вверх те кто имеют вопросы мне вопрос в рамках оператора можно настроить его ability зону для каждого конкретного экземпляра так ну для каждого конкретного экземпляра чего мастера или реплики не ну в принципе можно задать affinity анти-а финики то есть должен работать нужны еще вопросы или замечания были вопросы у александра поэтому может быть у вас есть ответ и поднимите руку вот так вот просто смотрите как когда вопросов мало или или это настолько незнакомой для вас темы у меня возникает тогда вас на вопрос зачем вы пришли и вопросы появились сразу спасибо привет спасибо за доклад очень классно было у меня на самом деле несколько вопросов первое используете ли вы это в продакшене вот да конечно у нас порядка 600 кластер и кластеров из этих 1400 в продакшене то есть вот именно вот эти 600 нас будет по ночам если что тестовые не будет но на тестовые мы тоже мониторим и они нам важны чтобы работали в течение дня потому что тесто в январе мент используется для разработки если разработчик не может использовать базу для разработки у него вся работа стоит соответственно мы до используем в продакшене более двух лет правильно я понимаю что вот этот оператор может работать только с external валим ими то есть хост пасом это работать не будет только с какими-то сетевыми дисками в принципе можно попробовать так в принципе да на данный момент все верно то есть мы хотим добавить возможность использовать локальные диски те же самые три волю мы на амазоне выглядит очень вкусно вот но значит засада засадах тут в чем сейчас мы можем подмонтировать эбби существующие без на новую ноту все данные здесь если нам если если данных нет нам надо их копировать и как бы размер кластеров бывает разный иногда это несколько мегабайт а иногда это терабайт и копирует терабайт и долго дорого затрат на то есть для задач где есть и a bound на базу вы используете обычные железные кластер ой как правило да то есть на сухой steam на амазоне на и 3 инстанциях там и там эфемерные ногами и диски то есть в принципе если instance умирает то его надо перри наливать но в принципе она работает достаточно надежно с нашим кубер нити с тимом это наверное даже не очень не будет работать потому что такой роли нагреть всех нот внутри кластер у нас происходит достаточно регулярно один-два раза в месяц вот соответственно 1 1 2 раза в месяц перри налево теток данные откуда-то тоже мало приятного спасибо александр оберните спасибо за доклад подскажите пожалуйста как у вас реализовано резервное копирование мы используем воли внутри докер-контейнер у нас работает крон который в час ночи делает полный бэкап и кроме этого там у нас настроен орков команд то есть все голы которые генерируются они отправляются в и стрима зоновский соответственно из борьбы капа плюс все голым если мы можем откатиться назад на любую точку и рита на что у нас по умолчанию 5 дней то есть в течение 5 дней мы можем остановиться на любую точку спасибо александр теперь справа пятна спасибо большое за доклад я вот если вы просыпаетесь 1 неделю получается вы засыпаете разделим это вот нет нет просто это вот немножко штормит от количество кластеров почему тысяч четыреста какую то есть какую глобальным зачем решаете ну и у нас будут значит 207 у нас 200 команд разработки у нас значит офис находится в берлине дортмунде хельсинки лисабоне дублине то есть так вот такой достаточно распределенный чем многом микро сервисов есть кафка соответственно все и синхронная и каждый микро сервис хочет базу как правило вот такая ситуация от микро сервисов есть минусы своей есть плюсы плюсы то есть минусы вот их очень бас очень много плюсы в том то что большинство вот этих кластеров у нас маленькие меньше гигабайта там процентов 80 наверное вот остальные могут быть очень большие там дать до терабайт и несколько терабайт даже а размер команды которая следит за тем чтобы все эти под греции работали то есть в моей команде у нас семь человек в принципе один человек способен от поддерживать способном состояние и чем больше мы автоматизируем тем больший размер кластеров мы можем пасти то есть это как пит сверху скотов то есть пит это наш кластер который работает в дата-центре за которым мы тут ухаживаем всячески а это скотт то есть если что то не так мы его при этом под от под прибиваем через год то есть вас тренд расти увеличить это количество и любое количество кластеров растет и по 7 теперь здесь на первый налево александр вопрос какие и без воли мы тип какие какой тип и и позволь ему использовать мы используем джипе тут простой причине они дешевле иван очень дорого то есть если нам нужно 3000 люксов это будет как минимум в два раза вдова и иван будет как минимум два раза дороже они у тыкались в предела и без и gp2 который двести пять мегабайт секунду не более иногда утыкается но в этом случае мы просто такие базу уносим скудра месяца к сожалению для то для этой проблемы есть простое решение сделать несколько воли мог сделать и 0 рейд вот и тем тем самым увеличить пропускную способность в кубе ранить это сделать нельзя соответственно либо мы выносим то есть мы выносим в любом случае sku верните эту базу запускаем на их счету либо и 3 winston со своими девайсом либо обычный instance который себе сработает но делаем strike аки есть еще это ограничение кубера кроме вот кроме но он point point и возможно ответ найдется сейчас скажу у нас отключены квоты то есть у нас нет квот цыбук а то иначе это было очень больно то есть когда мы указываем secu memory limit а и request там сто миль и core of например и вдруг у тебя контейнер превышает эти 100 то начинается жёсткий срок link 100 миллисекунд это совсем плохо то есть когда у тебя были запросы по миллисекунды отвечали и потом вдруг 101 это ужасно поэтому у нас код и отключены вообще глобально с этим живем еще чуть левее следующий вопрос а какие рпр тело вы бизнеса по пульсу гарантируйте мы мы не используем синхронную репликацию по простой причине что большинство у нас вещей абсолютно синхронны и прилетают из кафки вот время восстановления зависит собственно от размера кластер этот его активности от надо понимать то есть восстановить 1 терабайта накатить волос за сутки может занять много часов ну и данные соответственно можете потерять данные теряются там как правило папа по 12 вал сегмента последних то есть если атла вообще все плохо репликации у нас не отстаёт как правило есть еще время сегмент это принципе если маленькая нагрузка это может быть до если нагрузки нет на самом деле сегменты могут умирать не ротировать вообще кстати если нет транзакций да даже по таймауту там же автоматически можно по таймауту да да он должен но если нет транзакций они не ротируется эту я недавно за разбирался с этим спасибо если еще вопрос ребята ответы ok какой то из этих вопросов был лучшим правда наверное все были хороши спосибо вам я пока подержу и пока я забираю ты точно ты думаешь хорошо попытаюсь и просто вспомнишь надо вспомнить . отсюда был вопрос я забыл прошла отсюда был вопрос да да да вот это выходи к нам пожалуйста расскажи как тебя звать ну повтори коробку коротенько вопрос потому что без микрофона это произошло здесь вопрос повторить алексей компания райков вопрос был по поводу работает ли поиска или оператор с локальными воли маме и что делают зала на если есть какие-то задачи в которых важен и abs на базах это у нас больной вопрос периодически всплывает вот награда награда за боль поздравляем тебя друзья всем спасибо"
}