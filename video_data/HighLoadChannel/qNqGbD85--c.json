{
  "video_id": "qNqGbD85--c",
  "channel": "HighLoadChannel",
  "title": "Хранимые процедуры в NoSQL СУБД на примере Tarantool / Денис Линник (Mail.Ru)",
  "views": 930,
  "duration": 2807,
  "published": "2018-08-16T04:47:37-07:00",
  "text": "всем привет меня зовут дениз линн ник я разработчик медиа проектов mail.ru group я думаю ни для кого не секрет что в mail.ru тарантул используются ну довольно во многих проектах иметь а проекты стали не исключением мы построили несколько сервисов с использованием тарантул и одним из таких сервисов стал сервис авторизации собственно котором мы сегодня и поговорим на примере которого и разберем как вообще работают храним kef tarantul и и так что сегодня будет докладе мы поговорим в целом о том что такое хранимой процедуры как с помощью такого приема проектирования можно добиться увеличения производительность вашего сервиса поговорим в общих чертах о об особенностях сободы тарантул а также рассмотрим набор возможности которые тарантул предоставляют для того чтобы строить сервис цена хранимых процедурах полноценные сервис и в заключении мы посмотрим как такие сервисы на хранимых процедурах можно сделать еще более оптимальным и по профилирует и разберемся что и как работает в внутри тарантула и посмотрим на какие-то подводные камни и так хранимой процедуры храним процедура это какой-то код который исполняется на стороне базы данных отсюда вытекают преимущества такого подхода первая скорость можно раскрыть в два преимущества это сокращение числа запросов а значит сокращение сетевых задержек второе это сокращение числа передачи данных то есть не всегда нам нужно получать все данные но иногда нам нужно использовать все данные для получения какого результата например операций агрегации или еще чего то в таких случаях мы можем сэкономить на трафике и тем самым увеличить watenshi нашего сервиса также к преимуществам я отнес перри использование кода и перри использование самого сервиса на хранимых процедурах здесь стоит сказать что общий так что мы подразумеваем под сервисом сервис на хранимых процедурах это какая-то база данных описывающая свою схему предоставляющая какое-то appy appy и из набора хранимых процедур которые ждут какой-то функционал соответственно отсюда вытекает третье преимущество мы скрываем структуру данных мы можем использовать систему прав таким образом чтобы клиент который пользуется нашим сервисом не имел доступа напрямую к данным а взаимодействовал только с предоставленным api ukranian процедуру есть недостатки как правило хранимую процедуру сложно поддерживают в плане того что этот код нужно как-то тестировать если мы поменяли что-то хранимых процедурах то возможно нам нужно менять что-то в клиенте и при написании хранимых процедур происходит размытие бизнес-логики что я под этим подразумеваю если мы спроектировали сервис так что часть водите у нас обрабатывать хранимых процедурах а часть в логике на стороне сервера то наверное мы делаем что-то не так и в общем то эти недостатки они их можно избежать можно избежать правильно проектируя ваш сервис и так прежде чем рассказать почему вообще мы стали использовать тарантул для написания сервис авторизации давайте немного познакомимся поднимите руки те кто уже использовал тарантул хорошо это не страшно ваш доклад в общем-то начального уровня и мы разберем основные возможности начиная с самых простых примеров и так в общем почему мы решили использовать тарантул первые наверно самое главное тарантул у нас уже была на тот момент когда мы решили писать сервис авторизации соответственно нам не было никаких проблем включить его в нашу систему тепло и помимо этого у нас есть различные уже запущены и сервисы все они используют разные технологии как минимум разные языки программирования сервис авторизации мог потребоваться нескольким этим проектом поэтому хотелось придумать какое-то общее решение которое подойдет всем собственно вот сервис на хранимых процедурах и стал таким решением но хранимых процедур есть естественно не только в таранто это могла быть любая другая база данных здесь нам подошли преимущество который предоставляет тарантул например разрабатывая этот сервис авторизации одним из требований был сделать авторизацию через социальную сеть если вспомнить протоколу aus 2 то на определенном этапе требуется менять код который нам приходят от пользователя на refresh access token и соответственно нужно сделать http-запрос вот одно из возможностей храним кто тарантул это отправлять не блокирующие штыки запроса собственно вот поэтому мы решили использовать тарантул давайте теперь поговорим о том что вообще делает тарантул тарантул какие у него есть особенности первое о чем стоит сказать это довольно распространенное мнение что тарантул однопоточный вроде как и да и нет основных потоков тарантул несколько но транзакционный поток он один это решает многие проблемы например мы не блокируем никакие space с данными когда записываем ну какой смысл и блокировать у нас один традиционный поток он собственно все транзакции проводят блокировать ни от кого ничего не надо вот второй поток этого а в рай the heat look это такой файл в который при применении каких-то операций эти операции записываются таким образом достигается пир системность этого хранилища соответственно перезагружаю тарантул мы не теряем ни какие данные все данные накатываются по вот последовательно читают открыто hotlog до самого актуального состояния которое было и последний из основных потоков которые тоже стоит отметить это поток работы с сетью то то о чем я говорил сетевая работа в tarantul и не блокирующие это очень важно и так под системы хранения их сейчас 2 исторически 1 появился менты x собственно на картинках слева оперативная память о справа жесткий диск вот собственно это отражает преимущество 1 2 . mtx хранит все данные в оперативной памяти соответственно доступ на чтение на обновление данных у нас быстрый но мы ограниченный объём оперативной памяти оперативной память дорогая винил же в свою очередь хранит сами данные на диске индексы в оперативной памяти таким образом мы можем добиться хранение гораздо большего числа данных здесь стоит сказать о том как вообще тарантул хранит данные что это за такой формат значит данные хранятся в формате massage pack почему им выбором массаж пока этот формат оптимизирована объем хранения данных то есть если мы собираемся хранить единички и нолики массаж показа кодируют их как один бит и не более того то есть в этом основное преимущество мыса чп от формата информация себя представляет тип хранимых данных и дальше сами данные так пойдем дальше по индексам в тарантул ну в общем есть два основных индексов это хэши 3 причем хэш поддерживается только mtx и в докладе мы будем в основном рассматривать менты x ношу исторически это движок появился первым соответственно мы получаем от хэш индексов преимущество в скорости на вставку и удаление но недостатками является невозможность операции сортировки невозможность операций поиска по диапазону только полное совпадение собственно как и любые хэш-таблица дерево же нам позволяет поискать по сортировать то есть если не понятно сейчас на этапе проектирование сервиса что требуется сделать то лучше наверное выбрать три яндекс и так тарантул как база данных на данный момент может выступать довольно в различных ролях ролях это первое это то с чем чаще всего сравнивают тарантулы с редисом соответственно пирсе тесной окей в или хранилище перезагружаем данные остаются и храним ключ-значение второе это довольно экзотический зверь это транзакционный кэш такая вещь нам понадобится когда мы хотим синхронизировать какие-то данные между двумя разными процессами например при этом сделать это транзакционный то есть потока безопасно и третье собственно то к чему мы сегодня будем обращаться это applications фермер это сервер приложений которые позволяет исполнять какой-то код собственного достоинства почему почему именно тарантул как атлетично сервера нее какая-то другая сумма до директора нтку действительно быстрый об этом уже неоднократно говорили в разных докладах поэтому коротко скажу что почему именно почему мы выбрали его за то что он действительно быстрый это опять же вот эти не блокирующие операции это довольно важно для нас следующие два пункта встроенного аджит экосистема приложений вообще-то довольно спорные потому что последнее время на счет встроенного в тарантулы за кого ходят споры что вообще там ну дает больше проблем чем пользы связано это с гопи коллектором как и любого другого языка с автоматическим управлением памяти вот сейчас в качестве тюрьмы альтернативы рассматривается раз уже есть какой-то тестовый проект который позволяет в тарантула использовать раз но пока что царство поэтому мы будем все примеры рассматривать но сегодня и в действительно имеет свои плюсы он на борту джиджет это джастин тайм компе лир собственно трассирующий компилятор который ускоряет исполнение wakodo и получается ну не так медленно как чистого и имея на борту вашей базы данных полноценный язык программирования можно делать вообще любые штуки если понимать что происходит и не допускать ошибок работы скопич коллектором и какими-то особенностями от этого джед компилятора к недостаткам тарантула в целом мы как полетишь на сервера я отнес сложности с репликации и сложности масштабирования сейчас поясню значит сложности репликации какие если смотреть мастер своей привлекаться много как еще называют мастер реплика то сложности здесь никаких не возникает у работает как нужно сложности возникают на репликации мастер мастер так как мастер мастер асинхронные то при обновлении каких-то данных или удалений каких-то данных случае вот падение одного из мастеров может это может привести к не согласованности данных поэтому проектирую свой сервис отказоустойчивые имейте в виду что используя мастер мастер лучше писать только в одного из них это сохранит консистентных данных по поводу масштабирования ну как любая ножку и лесу п.д. трандл масштабируем масштабируем за счет того что мы обращаемся к данным покручу соответственно поэтому ключом можем шар дерется в tarantul и есть встроенное сортирование но она сейчас еще дорабатывается то есть требуется доработка в плане того что если какой-то шанс выпадает то нам нужно как-то узнать об этом и и начать ну либо писать данные по другому ключу в другой shortly был какой-то fall back имеете fov до fubag собственно с этими недостатками можно бороться можно использовать другие репликации можно жить на существую на существующем сортирование это проблемы разработчики тарантула не знают они с ними работаю но собственно уже во многих проектах пользуются тарантул поэтому с этим можно жить и так значит сервис авторизации которым я говорю сейчас мы рассмотрим начнем смотреть код мы сегодня будем смотреть довольно много кода первая функция которую мы рассмотрим довольно подробно это функции регистрации пользователя собственно приходит пользователь с каким-то емейлом и наш backend в данном случае на питоне но вообще-то на чем угодно вызывает метод регистрации и тарантул собственно на себя берет всю работу сейчас посмотрим какую так для начала опишем схему данных значит этого собственно подробно разберем один пример local db переменная которую мы возвращаем за этого модуля это аналог exports в надрез соответственно в внутри этой локальной таблицы это тип данных таблицы в называется мы создаем одну функцию db crate что это функция делать первое что делать это дает space space это аналог таблицы из баз данных как виде менеджер мы выбрали mintex соответственно все данные будут храниться в памяти if not exist рук говорит о том что ну если она еще не существует а создает таблицу довольно удобно при разработке теперь создадим индекс первый индекс в спейси в tarantul обязательной это прайморить и соответственно выбираем тип хэш и по поводу parts что это такое как я говорю данные хранятся в сочи party а внутри тарантула это представляется в виде сущности to pull the pale это что-то вроде массива последовать хранящиеся данные единица это означает что первая позиция этого табло и будет участвовать в этом яндексе здесь стоит отметить что вам не совсем обычный из программирования ум индексируется с единицами с нуля как ну вот так сделали создадим следующий индекс следующий индекс он по емейлу и его особенностью является то что он не уникальные и то что состоит из двух частей соответствие тарантул поддерживать составные индексы это может быть важно при проектировании а теперь создадим собственно саму хранимую процедуру который зарегистрирует пользователям создадим модуля us внутри модуля us определим функцию api которая может конфигурировать как-то наш сервис и вызовем дабы kreed создадим соответственно space с базой данных далее рассмотрим саму функцию регистрации что вообще нужно сделать нужно сначала проверить что пользователь еще не зарегистрирован а затем если он не зарегистрирован зарегистрировать его собственно что вот мы здесь и делаем проверяем потом регистрируем соответственно какой профит с точки зрения вообще сервиса мы здесь получили здесь он небольшой но уже ощутимый мы объединили две операции сначала чтение а затем insert запись в одну операцию таким образом мы сэкономили на сетевых задержках вот это такой небольшой выигрыш но уже выигрыш то есть если бы у нас была какая-то сложная логика которую ну можно написать на вой то выигрыш бы увеличивался пропорционально тому сколько операции вообще с базой данных мы хотели сделать и сколько данных мы туда сюда собирались гонять далее как все это запустить как вообще проверить что все это работает нужно создать систем сетей скрипт в tarantul и и в нем а собственно импортировать наш модуль все этого достаточно можно проверять что все работает с помощью опять же 3 литра нку стиль но естественно обращаться из трандл к самому себе не имеет никакого смысла мы же хотим использовать этот сервис из каких-то других сервисов значит вот пример кода на питон ну почему пит он выбрал популярные язык программирования это первое а второе в 35 питоне появился удобный синтаксис работы с и синхронностью и в примере используется синхронный коннектор собственно опять же почему это важно сам-то ранту не блокирующий если использовать к нему синхронный коннектор то в общем-то весь выигрыш пропадет поэтому выбирая коннектор к своему тарантулу имейте ввиду что если вы собираетесь писать и синхронный код внутри тарантул то возможно имеет смысл использовать а синхронный коннектор не блокирующий вот что еще нужно знать о коннекторах коннекторы к тарантулу были написаны разными разработчиками в разное время это привело к тому что разные разработчики по разным использовали мыса чп ок то есть тот дотошно проверял каждый тип и если мы туда отправляем единицу то он кодирует единицу действительно как один бит информации а если а тот кодируя как int как много бит соответственно это работает только если вы коннектором пользуетесь на операции непосредственно над данными здесь мы используем connection кол соответственно непосредственно с массаж пока мы не работаем такой проблемы не возникает просто имейте ввиду что если вы собираетесь работать с данными то либо проверить и что ваши коннекторы одинаково работают с мыса чп акком либо используете один коннектор из всех ваших проектов и так пойдем дальше сейчас мы рассмотрели регистрацию по e-mail теперь давайте рассмотрим регистрацию через социальную сеть это тот кейса которым я говорил с не блокирующий отправкой запроса собственно вот это не блокирующая отправка на что стоит обратить внимание код в общем-то не отличается асинхронного нечем но при этом является не блокирующим это довольно удобно нет вот этой мешанина call back еще стоит обратить внимание на вызов пикал это просто безопасный вызов который переходит заказ экшена если они случатся при работе сетью например вот с течет тайм-аут запросам хорошо теперь рассмотрим пример я на слайдах преимуществами приводил то что тарантул вообще-то имеет богатую к систему это действительно так у тарантула есть свой менеджер пакетов которые используют внутри себя менеджер пакетов и зло и позволяет поставить специальные пакеты которые были написаны для тарантула на такие пакеты при разработке я советую обратить особое внимание потому что они были действительно полезны здесь примере мы используем очередь то есть очередь реализованы на таран туле вот из коробки поставили ее с помощью утилиты тарантул сетей за рекой лиля и все у нас готово очередь на таран быстро просто и удобно следующая задача ну мы движемся дальше по нашему сервису и теперь нам потребовалось хранить помимо данных которые мы хранили раньше это пол пользователя то есть нужно совершить какую-то миграцию так как это делается для начала вообще определим культ функцию миграции и внутренние проверим что мы сейчас находимся не на реплики реплика времен ли и выполнять на ней какой-то код который будет менять данные это приводит к ошибкам делать такого нельзя далее сама миграция в самом миграция здесь из важного это итератор собственно вот цикл по которому мы идем он идет по оператору когда такое нужно такой нужен когда мы собираемся обновить их и как-то обработать большой объем данных соответственно iterator за раз выгружает только одну запись 1 табл что позволяет оптимизировать нам работу с оперативной памяти что в mind x особенно важно все данные в оперативной памяти мы не можем создавать еще копию чтобы по ней пройтись вот далее мы делаем добавляем пол и реплей simd apple реплей соответственно поправимо реке и вставят этот табу на место предыдущего обратить внимание нужно вот на это напоминаю что тарантул у нас имеет один поток транзакции а значит если мы запустим в этом потоке какую-то большую миграцию который выполняется на минуту-две или там час то на все это время тарантул будет заблокирован этого можно избежать если периодически вызывать файбер slip от нуля соответственно фармер slip что сделаю то он сделать youth и вернет управление основному вернет управление для других запросов по току транзакций соответственно будет периодически возвращаться сюда дорабатывать миграцию и вот в момент когда миграция идет сервису равно продолжит быть доступен теперь давайте поговорим такой задачей как оптимизация хранимых процедур мы уже получили какой-то какую прибавку производительность на том что мы перенесли часть бизнес логики в тарантул теперь давайте разберемся как сделать эту логику оптимальный так задача такая нужно посчитать про мальчиков и девочку базе данных давайте рассмотрим вот этот фрагмент кода значит создаем таблицу с мальчиками и девочками идем по индексу если мальчик то мальчик если девочка та девочка кто видит какие-то проблемы здесь что-то не оптимально написанная может быть память массив не всех результатов в памяти таблица из двух значений моего равно там какая-то цифра 7 равно такая эта цифра в память выгружается только и одинец на это пол который мы используем в операторе нет яндекс используется и яндекс используется потому что ну да действительно здесь яндекс не указан но мы используем праймари индекс то есть когда индекс неисправен и указан мы по дефолту используем прайм yandex он у нас хэш типа их ешь тип индекс поддерживает бокс индексов то есть операцию по всем тапом до миграция прошла то есть у нас уже там есть какие-то мальчики и девочки у всех эта запись есть к сожалению мы не можем выгрузить только четверочку мы действительно выгружаем места полно не оптимальности в этом нет ладно я подскажу в общем-то на каждой итерации мы делаем lookup похожу на каждой итерации мы пытаемся записать ну пытаемся каждый раз хэшировать фиммел слову или словом ld что приводит к лишним операциям с таблицей вот я так думал когда составлял эту презентацию думаю вот сейчас я померяю эти два примера и получаю разные результаты получу производительность вот ничего подобного напоминаю в тарантул встроен уаджиб аджит собственно трассирующий компилятор который создан для того чтобы оптимизировать наш тарантул и собственного jit на себя берет работу по тому чтобы оптимизировать вот этот фрагмент кода не делать каждый раз lookup похожу а внутри себя делать работу вот похожую на это создать какие-то локальные переменные и общаться непосредственно с ними соответственно вот этот фрагмент кода и вот этот фрагмент кода работают одинаково эффективно то есть вопрос был с подвохом там нет никакого ника ошибки производительности но сделать можно лучше сделать можно лучше если написать этот фрагмент кода на оси собственно сейчас мы посмотрим жесткий сильный ход но вдаваться в подробности мы не будем самое важное что мы поймем оттуда это как вообще тарантул работает внутри значит создаем какую-то функцию по типу мейна в которой определяем мета массив в котором будет функций аккаунт ну собственно перейдем к этой функции потому что всю работу в ней значит каунт принимает на вход вот властей это стык значит в этот стек мы положили айдишник space с пользователями поэтому и хищнику space а мы по имени индекса получили а хищник этого индекса собственно ну что отсюда можно понять что у каждого space и сядешь них у каждого индекса из тянешь некими можно как-то управлять дальше дальше мы делаем собственно тот же самый оператор который мы делали в что здесь стоит отметить что оказывается мы передаем в тарантул какие-то данные оон внутри себя еще их он ходит в тот самый формат мыса чп ок собственно перед тем как построить вот этот вот яндекс по итератор wall нам нужно создать пустой ключик собственно пустой ключик в в massage pack формате здесь создается дальше дальше мы создаем итератор потопал это как раз о том о чем мы говорили выгрузить только часть тепла нельзя можно выгрузить только целый то пол потому что тарантул оптимизирована проход по по индексам и проход потапом то есть последовательное чтение если ваша задача подразумевает чтение последовательно всех записей 100 плата тарантул это прям ваш выбор вот что мы здесь делаем мы создаем этот apple iterator не забываем его освободить дальше дальше собственно мы в этом-то полутора 3 доходим до нужного нам поля опять же декодируем его потому что каждое поле хранится в мыса чп от формате что вроде как добавляет нам лишней работы но оптимизирует наших хранения в оперативной памяти и собственно записываем пол здесь результаты которые мы получили собственно logic если отключен то мы получаем 9 секунд это 3 миллиона пользователей обсчитывается от полным проходом и смотрим сколько мальчика сколько девочек значит вчера был доклад о том что лу аджита оказывается не всегда эффективен что иногда его исключение приводит к повышению производительности вот в данном случае это не так в данном случае мы видим прирост производительности примерно в 4 раза вот если сравнивать а вариант с включенным jetta мысе варианта мы видим прирост производительности в шесть раз на разных хранимых процедурах на разных операциях можно получать прирост производительности вот до 10 раз а в некоторых случаях можно не получать никакого прироста производительности поэтому нужно вам это или нет решайте из контекста задачи если он действительно нужно больше производительность можно поковыряться с этим можно попробовать что то сделать но действительно в действительность разработка на сие для тарантул это сложная задача то есть первый раз когда я с этим разбирался у меня ушло на это наверное полторы недели это был довольно тяжело то есть писать на эту вышел бы ну да несколько там действительно нах одна функция вот написать модуль носи это довольно сложно учитывая что есть проблема с документации из нее ну не очевидно с чего начать просто сложно начать итак теперь рассмотрим а почему вообще оси год оказался быстрее сторон сильного кода за счет чего мы получили эту оптимизацию ну собственно фрагмент кода показывает как можно профилировать с помощью утилиты джоппер туз вот давайте посмотрим на результат профилирования вот того си запроса который мы видели как видно основная операция который занимает 53 процента времени то есть ну основное время выполнения всей процедуры это операций от apple bless это создание табло соответственно каждый раз когда мы выгружаем это действительно не проблема просто тарантул так работает мы создаем тапу вот напоминаю что сие версия работала в шесть раз быстрее чем моя версия и собственно вот почему я версия тапу bless занимает всего девять с половиной процентов всего времени выполнения что конечно несоизмеримо меньше а куда делась это время выполнения она делась на вова jit то есть различные функции уаджиб и различные функции гарбич коллектора которые выполнялись в этот момент собственно вот это и есть плата за удобство использования в общем подытожим хранимой процедуры писать можно и нужно в тех случаях когда требуется добиться более высокой производительности за счет экономии на сетевых задержках тарантул в качестве вот критично сервиса эту сейчас удобно и приличный сервис с развивающейся к с экосистемой приложений при этом он быстро он не блокирующий но имеет свои недостатки и которых нужно помнить но с которыми можно работать и тарантул помимо всего прочего предоставляют нам цепи который позволяет писать максимально эффективные хранимые процедуры и профилирование таких хранимых процедур это ещё один способ дополнительный понять что вообще в нашем сервисе не так почему он работает медленно и как можно сделать это лучше вот что дальше это было введение в тарантул определенного рода куда двигаться дальше значит здесь приведены некоторые модули тарантул модуль файбер это модуль для построения собрать in то есть делать многопоточность внутри таранто выносить файбер можно различной длительной операции честно посмотреть на модуль sharding без масштабирования гибкого ну наверное сейчас не куда дели репликации также никуда потому что нужно обеспечивать какую-то отказоустойчивость в тарантул версии 18 появился и сказать кстати о версиях тарантула не сказал примеры которые мы рассматривали все они подходят для тарантула высших версии 1 7 5 пользоваться версиями ниже этой версии но только если у вас есть какой-то легаси так берите последний тарантул они сейчас довольно стабильны и активно развиваются вот соответственно в версии тарантулы 18 появился сквер поддержкой скуэр синтаксиса изначально я на это смотрю скептически думал что блин просто для тех кто не может выучить его зачем это надо но причиной для этого есть и сквер позвали имеет внутри себя некоторые парсер этих запросов преобразую его в нативный код соответственно задачку с тем же нахождения числа мальчиков и девочек можно решить эффективно используем скрыль просто написать запрос грубая и возможно такой запрос окажется более производительным на же чем все версия вот так же рекомендую посмотреть на транзакции как транзакции работать тарантул и как объединить несколько запросов транзакцию это поможет сохранить консистентной ваших данных rocks это вот эти вот пакеты для тарантула существует множество пакетов тот же самый http был до определенного момента пакетом вне тарантула потом переехал внутреннего и наверное самое важное что есть это об тест это модуль для тестирование собственно в недостатках хранимых процедур было сказано что при нем процедуру трудно поддерживать это не всегда так особенно когда ваш код покрыт тестами собственно tab тест позволяет писать хорошие функциональные тесты ну если немножко схитрить можно написать и некоторые unit-тест и возможно даже интеграционные тесты собственно открывайте тестами ваш тарантул все будет гораздо проще в дальнейшей перспективе вот ну и в заключении я бы хотел привести несколько полезных ссылок первое это вот сам модуль авторизации довольно понятный написанный код для тех кто раньше но я никогда не писал может быть хорошей стартовой точкой то есть разобраться в нем попробовать что-то покрутить и поменять для тех кто ищет сервис авторизации тоже подойдет потому что ну может быть это ваше решение вторая ссылка это собственно тот самый таящей коннектор который мы использовали в примере из плюшек он асинхронные очень быстрый и последнее опять же самое важное вот в этом списке это типа телеграме с разработчиками тарантул советую если вы планируете использовать тарантул либо если у вас есть какие-то сомнения чтобы его использовать но вы хотите задать вопрос и добовляйтесь туда пишите и спрашивайте там сейчас порядка 500 человек и я еще не видел наверное 1 вопрос на который бы разработчики тарантул не ответили то есть идет активное обсуждение все время если хотите быть в курсе последних новостей мира тарантул то вот этот чат это ваш выбор на этом все если какие-то вопросы с радостью отвечу на них так микрофоны спасибо за доклад я бы хотел спросить вот касательно поддержки о нем процедур как они вообще хранятся и ирси они руются перси они рование как такового из коробки в тарантул не тут нужно будет придумать что то свое хранятся они вот в ну в репозитории в твоем например да ты создаешь тарантул стиле скрипт после чего в этом tarantul стиле скрипте нужно написать 103 квир который был и вот в момент когда тарантул стиль скрипт будет запущен хранимой процедуры из него выгрузится в памяти собственно в память будет болтаться тут есть один интересный момент что но по хорошему вообще-то базу данных нужно перезагружать когда у нас меняется какой-то код но в данном случае можно обойтись без этого можно с помощью встроенных в язык ло функций удалить уже импортированные модуль импортировать их заново таким образом мы получим перезагрузку кода хранимых процедур без перезагрузки сервера нам не придется пересчитывать вот вал файл вот спасибо за вопрос здравствуй спасибо за доклад подскажите пожалуйста вот как бы модуль авторизации вы написали на таран доли вроде бога все гладко и хорошо с каким главным челленджем пришлось столкнуться из-за того что выбрать должен тарантул что самое сложное было в модели в модели конкретно в рамках 3 зации или наши для вашего проект в рамках авторизации наверное сложности возникли ну во-первых со схемой то есть на тут моя когда начинала писать схемы еще не было до пришлось городить что такое схема вообще схемы это вот у нас есть the pale и в нем последовательно хранятся вот эти данные классно бы обратиться к ним по кому-то имени да но такой возможности тогда не было нужно было обращаться по вот индексу соответственно я написал кит свои модели и а сейчас уже в tarantul и появилась вот эта схемой можно и ей пользоваться главный челлендж наверное был реализовать wales эсперанто потому что ну не смотря на то что казалось бы волос уже везде описан 10 раз всеми переделан в нем все равно полно всяких вещей которые не то документированы и каждая социальная сеть которые там поддерживается она реализует какие то ну свои небольшая особенность например google он принимает только post запросы с определенными фейдерами да и все возвращаются разный формат пользователя то есть поля разные именованные сам решил разном формате вот поэтому просто разобраться в этом а так в целом по впечатления могу сказать что ну писать на таран туле это довольно приятно это полноценный язык программирования которые у тебя есть и база данных прям вот в коробке все довольно удобно спасибо за вопрос здравствуйте пассивы еще раз за доклад вопрос такой вот даром пола есть схема репликации фалмер если мне память не изменяет и как в контексте дипломы хранимых процедур до изменения кода обеспечить четкий консистентной данных то есть может быть есть какие-то кабуки от компании может быть это будет не очень много значит как обеспечить консистентной это то о чем я сказал пару слов нужно если предполагается к этому multimaster или при кация то общаться на запись нужно только с одним из этих мастеров значит проблемы там с двумя операциями это операция апдейт эта операция белит соответственно используя эти операции хранимых процедурах можно нарваться на определенные болячки получить не консистентные данные соответственно там и там соответственно ну рекомендация такая если нужно обеспечить консистентной данных жестко да то на запись общаться только с одним из мастеров ли бы проектировать свой сервис так чтобы в нем не было операций апдейт и белит вместо апдейт использовать операцию absurd данные вообще не удаляюсь ну то есть не всегда нужно удалять данные если это в контексте задачи подходят такие ограничения то можно использовать оба мастер мастера то есть все серверы серверы используют на запись спасибо за вопрос спасибо получили con слушать маленький вопрос в связи с тем что там учитывается целиком следует ли стремиться делать их не слишком длинными до однозначно следует по многим причинам ну во-первых хранить только то что нужно если есть какие-то не связанные данные разнести их лучше в разные space а связано это в том числе и с тем что если посмотреть на синтаксис операции апдейт например то там будет большая таблица внутри которой создаются много маленьких во табличек каждый относится к каждому индексов то плита есть вот этот индекс мы хотим сейчас обновить вот этот например просуммировать там есть разные операции напоминаю там lodgy там автоматическое управление памятью а таблицы в памяти это всегда проблема потому что чтобы ее очистить нужно проверить нет ливнев циклических ссылок поэтому таблица для хомячка электро это ну такая своего рода проблема поэтому однозначно нужно стремиться к тому что длина табло должна быть небольшой хотя сами данных то при в принципе ну вот в одной ячейке то плане могут быть произвольными любой длины спасибо за отдых здравствуйте меня зовут валентин хороший доклад sunday star on tour panda 2 см попов г н тарантул господа это поезда it's good question выю стран tool in many projects in out in bath вида можно говорить пород а хорошо собственно тарантул у нас использовался уже в проектах postgres но он тоже использовался но появился позже таранова то есть исторически так сложилось что мы использовали не пожгли самый склеит естественно мой сквер беднее это первое второе а ну из под колеса нельзя отправить запрос и сохраним keepass gresso а из хранимой процедуры на тарантул запрос отправить можно да и в контексте авторизации в контексте авторизации отправлять запрос ну довольно важно да в том числе для вас авторизации то есть тарантул страниц пожгли сам умеет конечно свои преимущества в плане удобства написания хранимых процедур но при этом у после естественно есть свои просто колоссальные преимущества в том числе это нормально мастер мастер импликации так далее спасибо за вопрос да все верно человек спасибо допрос вращение супер репликация для меня больной вопрос немножко а вот вопрос такой вот смотрите во первых я хочу уточнить сразу а поддерживать ли тарантулы просто не очень в курсе и красота центровую репликацию дата чтобы мы называем обычно его знак диплом храним ки в этом случае в нем вопрос так вот мы допустим хранимой процедуры что делать каким-то образом европы обрабатывать данные получай некие результаты мы имеем допустим не знаю там 5 но тарантула ваном до центра и 5 таранку другом до центре пытаемся как-то эту историю синхронизировать ну за определенным лагом репликации до между этим близнецы и мы последовательно допустим отключая ноды накатываем мою версию хранимых процедур можно не отключать ну а это я понял должно говорили что можно базу мире путать моя между что если у нас на точки входа в dc стоит какой-нибудь она не знаю практикам который каким-то образом resort соединение к базе данных то мы все таки как как понять то есть закончилась здесь обновление не закончилась то есть какие-то штатные механизмы контроля вот что интересует штатных механизмов контролем вот для версии текущей который приложения наверное нету ну всегда можно определить функцию api назвать ее вершину да и сделочку это мониторинг подергать эту функцию вершин всех инстансов да и же наверно кайт мониторинг 1 2 data center и так далее вот соответственно можно определить функцию от вершины периодически и дергать и смотреть обновился или код или нет то есть если беспокоить именно вопрос обновления кода то его можно решить написав соответствующий код опять же ну наверное этот самый оптимальный потому что либо я не знаю либо просто такую механизма нету проверить а какая сейчас версия кода внутри тарантула вот с коробки вот как-то так спасибо добрых наверное если вопросов больше нет тогда спасибо что послушали меня подключайтесь к группе и хочу еще напоследок сказать что по тарантул проходит митап и вот они прямо буквально под нами там есть специальная комната с тарантулом там сидят разработчики тарантула если вас интересует какие то вопросы то можно прийти сегодня с ним пообщаться вроде как они там весь день там же идут какие-то менее доклада вот на этом все спасибо"
}