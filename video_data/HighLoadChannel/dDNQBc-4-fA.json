{
  "video_id": "dDNQBc-4-fA",
  "channel": "HighLoadChannel",
  "title": "Кластеризация BigData на примере подарков в ОК / Артур Кадурин (Mail ru Group)",
  "views": 200,
  "duration": 1914,
  "published": "2017-04-22T14:47:47-07:00",
  "text": "я работаю в mail.ru и мы занимаемся тем что улучшаем наши рекламные сервисы но помимо этого мы еще стараемся помогать коллегам в других областях вот я на примере того как мы помогали одноклассником ранжировать подарки буду рассказывать кто если можно спросить кто из вас считает что вы работаете с big data ну есть люди да а кто при этом занимается machine learning еще побольше примет настойкой окей я так поняла что одновременно и тем и тем там единицы до какие-то до 23 у нас естественно и big data и машин learning это не совсем халат но очевидно поэтому я и в смежных областях уступка секции понятно раз я говорю про подарки то речь идет о том как люди их дарят и так уж вышло что я не работаю в одноклассниках и не имею права рассказывать о том какие там реальные объемы поэтому я собрал небольшой datasette конкретно для этой презентации посчитал интересные вещи этот dts это всего лишь 100 тысяч подарков в среднем они дарились примерно 500 раз ну тут понятно примерные цифры но что это значит это значит что если я хочу посчитать например насколько два подарка часто встречаются вместе то мне нужно примерно 100000 в квадрат возвести и это будет реальный объем событий что интересного можно сделать подарками и зачем вообще это нужно понятно что когда человек ищет подарок он бы хотел чтобы тот подарок который ему нужен появился как можно раньше там выдаче поисковой это очевидно задача ранжирование стандартные метрики по ее эффективности можно считать по разному кто то там может сказать что чем больше в итоге денег принес сервис тем лучше и мне другая нравится формулировка я считаю что чем раньше человек увидел то что ему нужно тем лучше то есть чем меньше он потратил времени чем выше в поиске его подарок тот самый который в итоге купят или подарит тем лучше ну вот это соответственно то как можно оценивать качество помимо очевидного ранжирования подарки хочется тегировать опять же это поднимает эффективность улучшает эффективность ранжирования какие то мы сможем дополнительные там фишечки считать типа использовать и любят подарки с тегом кошечки там или собачки и так далее сейчас легирование соответственно делается в основном модераторами и ну очевидно что если мы вдруг кости рисуем подарки хорошо то тагирова ть станет проще можно прям целыми кластерами или переносить разметку которая уже есть на новые подарки и так далее неочевидное но тоже очень важное применение это фильтрация когда у нас есть витрина там стопом лучших подарков понятно что если вдруг все подарки окажутся цветочками одними и теми же розами то это не очень хорошо поэтому если можем класс there'sa вате опять же отфильтровать одинаковые взять топ не просто среди всех подарков от опытом лучших кластеров из них там кусками по выбирать то это еще лучше ну и куда же без денег что вообще из себя представляет задача у нас есть лак в котором известно что пользователи а подарил подарок пользователю бы это помечено временем дарения там какими-то системными системной информации и так далее что из этого можно реально получить мы знаем что-то про пользователей там какие-то ecommerce интересы или социальный граф который там вокруг них на вернут мы знаем соответственно этой про получателя и про дарителя мы знаем про подарок что у него есть картинка что у него есть так мы можем картинку посмотреть мы знаем сколько стоит подарить этот подарок и так далее из таймс темпа мы можем извлечь информацию о том какой был праздник в этот момент был ли он может быть там у родственников дни рождения и так далее может быть это ночной подарок там или по понедельникам его дарят это все в общем понятно и очевидно но я бы хотел рассказать про кластеризацию более интересную и она становится более интересно когда мы всю эту информацию выкидываем и оставляем из всего logo только тот факт что пользователь а подарил подарок б все остальное мы забываем напрочь и пользуемся только этим ну по поводу того что если пользоваться еще чем то я в конце еще добавлю если у нас есть такая история то мы можем представить этот лог виде футбольного графа понятно у нас с одной стороны пользователей которые дарят подарки с другой стороны подарки которые дарятся пользователями они как-то между собой связаны и кажется ну у меня на экране плохо видно ребра но в общем понятно подарков много пользователей много связей между подарками и пользователями еще больше ну в общем bigdata немножко про кластеризацию кто представляет себе что это вообще такое есть такие по отлично значит буду быстрее рассказывать в общем ну определение я не мог конечно сюда не вынести на этот слайд у нас вообще вся история в том что мы взяли подарки по объединяли в похожие кучки и дальше вот все что там я раньше говорил делаем с ними классический алгоритм cummins раз все знают что такое кластеризация наверняка все знают что такое cummins в общем рассказывать не буду поэтому дальше но ну как бы не все так просто тот же самый cummins и большинство алгоритмов кластеризации они требуют возможности посчитать расстояние между точками или даже какими-то векторами задать координаты ну и понятно что там в комменте нам нужно читать центроида для этого нужно брать суммы как далее у нас как бы история другая непонятно чем делать расстояние нет пространства и это ничего нет фич нет выделить ничего не можем плохо но выход есть и он очень хороший вот эта мысль она в основе всего того что я тут сделал и в общем почему она хороша я наверное могу рассказывать часами но попробую покороче если мы выбираем подарок нашим друзьям то скорее всего на этот выбор влияет то что мы любим что нам нравится или что мы хотим сделать если нам нравятся машины но мы наверное нет нет да будем дарить машины если мы любим дарить цветы то понятно это будут цветы конечно когда мы дарим котиков мы кроме котиков дарим еще и там супер электрогитары но в целом вот у меня лично вероятность сочетания двух разных интересов в общем намного ниже чем одинаковых если так можно выразиться понятно что в среднем там есть допустим 100 интересов и вот каждая пара интересов она встречается не так уж часто поэтому котики дарятся часто с котиками ну пока что это предположение посмотрим что из этого выйдет если у нас есть такое предположение то мы можем вместо расстояние посчитать похожесть ну я не стал писать similarity не знаю почему но не суть важно соответственно для каждой пары подарков мы можем взять список пользователей которые его подарили их подарили и посчитать соотношение общих пользователей у этих двух подарков к общему количеству пользователей которые дарили вообще эти подарки штука называется коэффициент жаккар а в общем довольно распространенная мира почему форму к из трех частей не из двух там вот в правой части очень важно что на самом деле нам достаточно считать только мощность пересечения мощность объединения мы можем вывести из пересечения и мощностей в общем горевших пользователей у коэффициента же кара есть пара клевых свойств во-первых известно что ну понятно вообще что если два подарка подарили лась совершенно разным количеством пользователей там какой-то сто пятьсот пользователей какой-то там 5 пользователей the similarity между такими подарками будет очень маленькая потому что у нас в числителе пересечения она не больше чем маленькое множество и в знаменателе объединения которое не меньше чем большое множество ну в общем в этом есть смысл понятно что наверное такие подарки реально разные раз они там в разных ситуациях дарятся и по-разному с разной частотой может быть один даже если они на одну и ту же тематику то наверное один хороший другой плохой там или еще какие-то вещи с другой стороны конечно мы какую-то там можем потерять информацию но есть способы с этим справится если вдруг нужен и вторая важная на мой взгляд вещь это то что дополнение до единицы коэффициента же korra является метрикой вот я там привел статьи если интересно можно посмотреть ребята доказывают что выполняется неравенство треугольника помимо неравенство треугольника очевидно что коэффициент симметричен неважно там достояния между а и b такой же как между боя и расстояние от ада а коэффициент очевидно равен единице поэтому дополнение до единицы 00 метрика клёво можно кучу разных алгоритмов применять в том числе вот ну вроде база есть так коротенький итог есть лук посчитали similarity знаем что на этой семья реки можно класть и рисовать класс there'sa им ну возможно потом это кому-то пригодится и мы получим деньги как мы считаем похожесть все представляют себе что такое мапри deus новые крутые тогда тоже коротенько основная идея в том что мы сначала сгруппировали по пользователю все подарки которые он подарил и по плевались из первой джо бы тем что у нас просто парами подарков которые встретились в этой группе раваном сети по сути понятно что таким образом для каждого общего пользователя мы плюнули одну пару его второй жены просто смерть или эти пары почитали в общем количество общих пользователей собственно это вот пересечения его достаточно для того чтобы посчитать меру же карту не нужно читать еще и объединения как пластеризуется ну возможно по картинке многие узнали мы в таких ситуациях очень часто ну почти всегда наверное используем mcr по крайней мере для тестов м серии the mark of кластером процесс он в общем тоже довольно хорошо представлен в интернете можно быстренько нагуглить почитать основная идея в чем наши семена реки можно представить в виде sports матрицы в которой ячейки там с координатами и ежи это будут по сути ну вот земля реки которым посчитали если потом столбцы поделить борт нормировать просто на сумму элементов то это матриц можно интерпретировать как матрицу вероятности переходов из этой вершины в жить имитируя брожение поэтому граф мы вообще можем что-то сказать что происходит в алгоритме взяли матрицу переходов и делаем поочередно два шага во-первых возводим в степень n в примере в квадрат просто б ежи что это дает если и в изначальная матрица две чайки ежи была вероятность перехода из игры то в матриц разделен возведенный в квадрат это будет вероятность перехода из евро за два шага ровно и после этого второе действие это собственно возведение поэлементно явку 1 в степени эн нормировка заново если первое действие понятно легко интерпретируется то во втором случае интерпретации прям такой наглядно и наверное нету но его смысл в том что после второго действия вершины с большим весом точнее ребра с большим весом становится еще толще а там с маленьким еще тоньше то есть по сути граф разряжается можно так сказать и самое интересное в этом всем что такой процесс сходится к матрице которая на очередном этапе перестает меняться и вот на правой картинке пример это матрица разбивается на области связанности с в каждой области есть один или несколько тракторов которые связаны со всеми остальными точками и вообще не смотрится легко получить кластер а но если вот эти вещи перетирать как мастера ok взяли логе но очень и считать similarity класс there'sa вали но надо же как-то понять есть куча метрик для кластеризации всякие там инерции след там еще что то но это все сухо и непонятно даже если вдруг там хорошие цифры то человек нам говорит давайте посмотрим че реально получается а получается вот что оказывается что при таком подходе даже когда мы дарим цветы мы дарим по-разному здесь видно что кто-то любит дарить ромашки кто-то орхидей наверно это кто-то любит дарить орхидеи казалось бы вот у нас изначально нет никакой семантики все что мы взяли то просто там я подарил цветок на выходе ну если бы я был тем самым модератором который кодирует эти подарки не факт что я буду написал ромашка другой орхидее подарки которые просто относятся какой-то группе предметов они естественно тоже разделяются и очень довольно хорошо здесь туфли я не знаю кто эти люди если честно но кто-то дарит пасхальные яйца понятно на праздник причем я еще потом расскажу как мы еще круче это сделали но не суть важно понятно да то машинки те самые там был и все кластеров естественно сюда не могу вынести потому что это очень много и там можно рожать до утра но там был такой прекрасный кластер где много много фоточек геленваген а и там одна какая-то бедная него и у нее подпись мини гелик то есть подарки с праздником но там были пасха здесь новый год очень интересный кластер доброе утро спокойной ночи как бы на примере с цветами казалось бы они должны отделиться друг от друга но в общем я потом посидел подумал наверное все таки это реально одни и те же люди и поэтому они не разделились тоже не знаю там кто то наверное не такой плохой как я и любит жене страдает там доброе утро говорить через 1 классе в смысле понятно где эти женщины там беременность так вот эта вот история это все прекрасно представлена с левая циферки похоже очень на то что это детям дарят я на самом деле не знаю потому что у меня данным естественно все эти персонализированные я не знаю точно детям эти циферки дарят или нет или может быть это мамам там с детьми дарят или вообще просто кто-то любит там бабушки подарить 82 там вот но очень похоже что детям ну естественно женские подарки именно отделились в разные кластер а правда даже на самом деле что хорошо что характерные хорошо мы по кластером можем принципе посчитать сколько каких женщин у нас там по именам живет в россии но и в казахстане не суть важно еще круче это то что мы оказывается выбираем подарки не только по смыслу но и как они выглядят даже и это уже имеет проявление в в простом лаги там я подарил подарок без семантики без исследования пользователям без ничего здесь подарки с загнутым подписью по видно что у них в общем не так много общего по смыслу ну там конечно есть там сердечки понятно и зачетка но оказывается что кому-то нравится загнутой подпись у кого-то там были подарки в рамочке кого-то квадратный у кого там вертикальная надпись и так далее вот но много интересного все получается все работает куда это применять отдельная история но я думаю примерно понятно что мы еще делали интересного совсем быть во первых понятны другие метрики метрик много можно чего угодно делать но помимо непосредственно метрик мы брали там всякие цветовые там визуальные характеристики с подарочков это там простые в хаос в этом бен и или градиентные там гистограмм ки стандартные кароч признаки ничего такого особенно и по по нему например вот эти вот яйца тоже разбились очень хорошо тут видно у некоторых есть справа такая веточка вот вот те которые с веточкой с учетом визуальных характеристик вообще тоже в отдельный кластер выделились смысле это комбинированная было метрика то есть и вид подарка и дарение мы учитывали временные там какие-то расстояния для того чтобы праздники отделить там и еще что там тоже всё хорошо работает социальный граф ну на самом деле я не помню по моему я уже особо там в дебри не залазил на понятно что это тоже можно все использовать там друзья дарят не друзья неважно другие алгоритмы кластеризации вот всякие дабы сканы которые вроде должны там плотные куски находить так далее ну тоже все в общем мы даже делали не кластеризацию как таковой мы применяли идеи это найдем дирихле allocation соответственно встроив топике из подарков семантические топике там ну тоже интересная картина немножко другая mcl доски расковыряли переписали попробовали разные варианты например поигрался я в оригинальном алгоритмы у нас вероятность перехода из одной вершины в другую за n шагов я подставил в это место там вероятность пройти через вершину в один из первых n шагов они попасть в конце тоже все сходится все работает но я правда вот с теми ребятами которые там доказывали неравенство треугольника соперничать конечно не могу поэтому я очевидно не доказывал это все но работает обнулю не диагональ ки в матрице базовой то есть если сделать так что шанс остаться в той же вершине в графе равен нулю то вам может что-то интереснее будет и так далее но и другие данные это понятно на самом деле речь то не о подарках вы можете подумали что я про подарки на самом деле нет если ну тоже самое абсолютно тоже самое мы делали с логом посещений страничек в интернете класс there'sa вали домены класс there'sa вали запросы и так далее что еще можно делать тоже очевидно наверняка вы все знаете что памперсы вместе с пивом продаются собственная история где вам пирса и пиво встречаются в одном и том же чеки это все тоже вот оно но в общем идея ясна ну и небольшое заключение вот она очень простая идея очень простой подход очень простые данные вообще ничего сложного по-моему очень хороший результат и собственно давайте машин верните вот компьютерный мозг так сказать жечь это умеет делать спасибо вопросы good bye good спасибо за интересный доклад два вопроса первый вопрос вы где то в начале сказали что те кто получает подарки нам не интересны мы их едем уже они неинтересны я сказал что вот здесь я их не использовал ну а какие то есть основание для этого ведь с другой стороны человек может быть любит один человек любит они подорожают работу вы правы безусловно причем когда я этот вариант тоже делал там получается очень интересная картина тоже на другая там история была такая вот есть подарки типа любимой жене они объединились в один кластер я начал сомневаться вообще вот ну правильно ли мы делаем потому что как бы одной одной и той же там видимо женщине подносили несколько подарков любимой жене это интересная стать ну в общем там тоже есть свои особенности и естественно это тоже интересно и можно строить метрики более сложные то есть не так просто все спасибо и второй вопрос почему кластеризации они полноценную рекомендательная система учитывая кто кому то что такое полноценную рекомендательная система ну берем то я дарю там какой-то девушке смотрим что я обычно говорю что говорит похожий на меня люди так далее то есть я должна всё описано на самом деле возможно профит от этого был бы намного больше вот кластеризации и мне сразу предлагают в топе первые 10 подарков которые я чтобы подарю история в общем такая обычно под рекомендательные системы подрезает там какое-то матричное разложение sports матрица там для то что понять где происходит вообще рекомендатель из тем от намного больше поэтому вот когда вы сказали полноценное рекомендовать лишь о неполноте хоть какая-то система то есть профита наверное больше чем на выходе то рекомендательная система мышь понимаете просто она с другого боку ну то есть еще очень важный момент что отдельно взятый подарок или отдельно взятый пользователь это очень мало данных когда мы говорим о рекомендации фильмов мы обычно смотрим там десятки фильмов когда мы говорим о подарках очень часто ситуация когда вот я пришел подарил подарок и все что мне рекомендовать поэтому кластеризация здесь это укрупнение фич у нас один кластер это больше статистики чем один подарок они похожи они дарят с одними и теми же людьми но и на них мы можем собрать больше данных на кластер чем на подарок поэтому дальше вот почему нет вот я дарил в это из этих трех кластеров значит из этого я тоже что-то хочу подарить спасибо спасибо за доклад у меня вопрос про это об извлечении данных на собственном определюсь do not вы в какой то момент времени имели какой-то лог подарков у вас было ограниченное множество и так далее когда происходит например добавление новых подарков да ну праздники еще что случилось вам надо пересчитать возможность кластеризация пастеризация идет услуга в прошлый раз мы считали лог за год назад через полгода нас появились новые подарки мы считаем как дельту или мы опять начинаем откручиваете вот это сотворение logo здесь есть разные варианты это хороший вопрос потому что на самом деле итеративно и обновление вот всех вот этих систем и но всегда большая проблема есть что то что легко обновляется есть что-то ну например тот же людей обновлять легко добавили новых домах там чуть быстренько дельту посчитали все хорошо на например забыть старые данные при этом невозможно ну наверное возможно но мы не умеем все равно приходится там сдвигать окно и как-то там заново пересчитать m7 ну про обновление но никак не связан с обновлением поэтому нужно пересчитывать но в принципе сама кластеризация само по себе считается не очень медленно и там раз в день или там если речь идет о праздниках то 1 день вполне достаточно что делать чтобы кластер а сохранялись такими же как прошлый раз очень просто мы в нашу метрику добавляем дополнительно параметр были ли они в прошлый раз вместе у нас расстояние становится между ними чуть меньше если они уже были вместе и таким образом мы поддерживаем примерно то же самое кластеризацию добивая новые как бы подарочки добрый день спасибо за доклад и у меня вопрос я хочу присоединиться к первым вопрос в общем почему бы не использовать комплексный подход когда используется и кластеризация самих подарков и кластеризации профилей а точнее портрет в пользователи потому что если я одарил один подарок то похожее на меня пользователь мог дарить их там тысячи пример еще раз выбрала это примерно тот же самый вопрос на самом деле здесь речь о том чтобы объединить подарки в похожие группы о том что с ними дальше делать как их рекомендовать как вы дали выделять интересы пользователей как понимать каким пользователям что нравится это другой вопрос мы уменьшили простран размерность пространства на котором мы можем классифицировать пользователей там класс there'sa вать пользователь рекомендации делать и тем самым приблизились к решению вот задача как раз о рекомендациях это не полное решение всех проблем это ну такой шажок скажем так наверное можно еще добавить про про всю эту историю что в общем пользователей есть смысл оценивать не только подарками вот подарки очевидно только пользователям ну или там с небольшими дополнениями а пользователь это что-то более сложное чем там то что он подарил но в качестве фича для определения пользователь одной из можно использовать класс терра чё вопросы если на сейчас подождите микрофончик не подскажете данные в интернет выкладывали чтобы можно было поиграться нет не выкладывали и не планируется и не планируется но уже нет персонализация никакой но тем не менее по картинке подарочка я могу себе представить как можно его найти и понять кто подарил стоит зачем есть кучу интересных data set of в интернете можно тоже самое делать на других данных понятно спасибо если вопросов больше нет то меня можно найти в холле или там где-нибудь здесь когда всем спасибо артура может меня вопрос задавайте конечно подскажите что-нибудь с чего начать грубо говоря я до сих пор не работал с диетой чтобы почитать такого по моему нам ну такое вот чисто личное мнение читать наверное сложно поэтому я бы советовала курсы в интернете например н дреджей машин learning это зарубежный курс или 0 это зарубежные курсы на английском языке но наверняка есть субтитры на русском хорошо спасибо большое"
}