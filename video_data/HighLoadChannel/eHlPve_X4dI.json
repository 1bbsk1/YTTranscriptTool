{
  "video_id": "eHlPve_X4dI",
  "channel": "HighLoadChannel",
  "title": "Ответ на главный вопрос про Chef, Postgres и все такое / Иван Евтухович, Никита Борзых (Express42)",
  "views": 261,
  "duration": 2116,
  "published": "2017-04-22T14:45:49-07:00",
  "text": "ответ на главный вопрос про chef пост грязь и все такое это один из немногих докладов про конкретные инструменты почему иван и никита могут об этом говорить очень просто потому что они зарабатывают на этом деньги и так на сцене и ванги в tuch о вич и никита борзых до людей которые думают о том сколько денег случае отказа оборудования по различным причинам вы сидят рослые товарищи да то есть здесь нет надеюсь нет скорее всего нет научных сотрудников и все системы модных элементом облака ходу бластер это будет поздно начнут поглощать используется исключительно для одной целью чтобы зарабатывать деньги я не знаю как помочь работать больше но наш опыт показывает что мы можем сделать так чтобы родители меньше когда терять этики когда сервис который компания служить не работает вы можете работать по 2 причинам это либо отказа физическое оборудования либо ну как бы другой опять насчет принесет нас отказа физического рода необычные физические факты и случай если происходит какой-то отказ понятно сервис не работает либо работает не должно ближе к этой смеси отвечает и это проблема для сервисной то это потери денег с чем связаны эти риски это ну вот к забору дни понятно что нельзя предсказать как его можно минимизировать можно за дублировать как то образом оборудование либо если вам лень это делать то просто сделать на случай отказа просто его поменять это просто какой что если это делать все руками и то это занимает достаточно много времени заседатель novaservis это может занять на пару дней там может быть по можете повесить если пользоваться для системы и какой-нибудь экране конфигурации то такой операции конечно гораздо гораздо быстрее получается и ставь сделать 15 минут это вот такие риски которую можно страховать во-первых реагирование примирение конкретно сокращает плюс дело в том что если вы знаете админы это люди которые как обычно высшее образование прочитан кафка porters и они какают гонок поэзии не могут делать два раза одно и тоже одинаково через к натуры и обычная проблема то есть я реально в жизни один раз физически оборудование обычно это ну какая поставщиков конфигурации сколько ошибаться и более того вот наш опыт конца такой показывает что статистически я не настраивают 2 железки которые выполняют одну и ту же функцию одинаковы и за какой причине но как поэтому это факт делать рано вставать это позволяет сделать как бы и единообразно ну вот от таких ошибок настроимся опять же разработка происходит обычно как минимум в трех окружения это разработчика и окружение окружения пре-продакшн и production и проблема в том что при переносе ли изменение из-за разработчиков стрижек источников produce что если это делается не автоматически потерять какие-то данные то есть настройки различных по системы и зачастую как именно это приводит к тому что привыкать и на я версии происходит от качества вашего сервиса от этого опять и можно застраховаться конечно нельзя сделать с 3g их окружение и там три выбор для тушения пожара продакшна хотим потому что это дорого то есть помню году торга получается сделать максимально похожей и систем уровень конфигурации это вот как раз тот инструмент который позволяет это сделать сделать вашу сферу жизни которое вы используете ли разработки максимально похожий тогда не интеграция то есть изменений она начинаете на наиболее родим статей и ум в реальность того что вы понимаете ошибку при при выходки то есть на девелоперская машине там либо настоящий тебе разному сейчас если вы так удивительно но сам по себе шеф понятно там он прошел вам рассказать вообще систему про любите драться это целый класс программных продуктов ну собственно все плюс-минус похоже там выполнять одну и ту же функцию листам cmp чем-то 563 выходите шефом садик все конечно это просто молоток то есть знаю используйте тем проектом фигура тени даже если вы используете жизни готовые рецепты там где чего-то не спасает вас от того чтобы там где стать систем это свято базу данных она все но знать при этом там тоже использую такие типа системы вы должны также сбиваться в них но 6 систему против интеграции не позволяют наступать на грабли грешен то есть на те же самые грабли повторюсь на те же самые грабли реже просто потому что если один раз наступили на графе ли вы как-то это заскриптованы написали что таком случае поступаем так и больше на эти грабли не уступаете ну и тут у нас есть слово под название доклада по одной простой причине мы все ноты которые используются вашем окружении их условно можно разделить на 2 части те которые хранят пользоваться и данные те которые хранят вот те плоды которой они хранят ходят соски давности не все очень просто на самом оставил такую же другую ничего не произошло и как бы для нефиг систему про них вибраций больше решают проблему конфигурации максимально эффективно мы с вами хорошо максимально полно out why not которые хранят от аляски до ну так например база данных тут помимо а не используйте сделаны украине конфигураций на дачу использовать голову потому что эти данные не потерять еще но вот в нашей компании мы работаем в компании с этим называется display кстати вот компании звать экспресса 2 кто прочитал дуглас адамс и не смотрел фильм автостоп обогнать можно но мы занимаемся красных консалтингом в области высоких нагрузок устойчивости и пролетать еду рации и наша какой-нибудь используем систему проблеме кочегар совершил и они сейчас расскажешь на вокале понять это вопрос зала кто знает что большая отлично кто и так понятно а шеф это систему праздников сагу рациями на сайте шефа написано что-то от играющий фреймворк это все так а задача шефа а полностью контролировать конфигурацию ваших серверов начиная от сетапа машины и как бы из канавы стали шлифмашинку стали диск сидиромы как-то по-другому до интеграции сервисов между собой вас вашей базы данных которые там подобное шеф это наложение на руке она ставится на каждую вашу ногу нога на каждый мастер которую вы видите управлять конфигурировать может работать в двух режимах чем золото без сервер на верх над обычно не использую большом подошли и шеф креативную версии который использует сервер как хранилище данных и он может быть искать это очень удобно потому хотите найти допустим все выгоды которые нападавшие все бы когда находятся у и окружение делается через сера запуск тему здесь картинка 300 ли я скажу даже как акробат решается нам всем станет первым серов рамеш ник вы убили вам нужно поставить на порционную систему есть такие системы называются провяжем системы и the cobbler и виде kickstart архивах эта система которая позволяет установить операционную систему используя заранее готовый файл ответов либо где скрипты которые оставят вашу сеть вы дышите петли был заранее ночным хищником настраивается ваших пользователей вашему делается пакет делает работу которого делаете карте диск из систем из машины и прорыв hf так как он скитается это руби можно описать различные бренды в киеве в кабир система которая будет хотя цель этого это система внимательно данные и установит вашу машину так как как вы как ну как как вы попросите соответственно на этом этапе вас полностью шефу можно разворачивать готовы машину пустую без таких серость 2 и дальше у вас вам нужно настроить эту серость пустим это быка а вы говорите шефу что в этом бы к нему . серова разворачивает шефа сворачивает на этом сервере окружение и ставить ваше уважение к тому как это делает все станут не буду против hr и следующий момент когда у вас уже установлены это не знаю для этого в 6 используя специальные 71 которая позволяет найти в вашем сервер вашим первым идти тебе мастера это подобно и в итоге у нас получается что используя шеф не можем описать конфигураций один раз использовать некие на однако ни один и тот же год просто указывает специальном файле какой тип окружением и используя то есть и для разных его окружения можно использовать разные размеры дисковых массивов разный размер настройках mafia 2 и 1 подрезку или это очень удобно я не буду кошка может ничего больше потому что ну подробности в практике у нас всегда история буквально парочка расскажу историю оперативно это магазин обуви россию production причем у нас была проблема так это был еще кто-то бакиров этот конца ну и короче у нас посыпать ошибки банды партию причине то что избавился от стрижек 12 любить отеля надо почти 50 и соответственно здесь кто-то погиб 50 не поддержали сложные под запросы и соответственно поскольку убытка от каткова просто сделал беквордации был не автоматизирован мы очень-очень сильно как быстро провели банками час достаточно большая часть сайта не отвечала что был у нас украинский проект украинская стать носить другая история распорядка физически оборудование у нас один сервер самый главный на нем крутилась на порядка 15 крон задач и еще несколько копить демонов различными рад настройками этого сдавалась и один из его отправили фото на перезагрузку и он не поднялся но и вот и я до сих пор помню четыре назад мы не спали почти сутки твоем скале перед будут вспоминали чем отработает смотрели логе смотрели вот какие то аппарат здесь обычные история я думаю что не знаю как многих рисовать или этот длинный дал так почти суточное был обычно конечно картами поменьше и связаны они с тем что продажности для прививки но вот про одного крупного клиента который у нас появился в августе как обычно звонок по телефону и наконец-то лежит и это был на самом деле хороший клиент во первых рук них было по имени автоматизирован тепло это все было два способа тепло и зато это уже предложение обычных больше и более того плата мотивированность наделать стандартным инструментом там использовать местами более того у них было неплохое оборудования свое а там них вот когда пришли было машину то что чтение к байта под базу данных и они сами уже как бы тажке в нагрузке 500 запросов секунду то есть это был одном средняя команда не было скажет очень сильно но тем не менее они справились с тем когда но них пройдет гораздо вождь и мы опять готова уже платите танцах и они обратились к нам будет просто лежала лежал по по одной простой причине там несколько была база данных основном базе данных если найти подписью сегодня к и чтобы нормально работал запускается автомат удалять старой версии данных и поскольку по умолчанию по лицу автомату настроенного что ну как бы для для маленьких систем до при нагрузке он запускался что редко и делает огромную нагрузку на диск нам пришлось 1 чтобы потянуть автомату потом как обычно не хватало индексов большинство разработчиков строит индексы на глаз они как бы как обычно то есть его нужно их не хватает они точно хочет немного и вот как бы на такой стиль это мы поправим какие-то предельные запросы обычные стоит уже компании не поправили рассказывал был беспорядочный тепло через час не повод тепло велась с помощью шефа часть как ни странно из-за этого ну какой то какая проблема возникла потому что вот эта история с автоматом и поправили но операцию помимо этого до 1 тысячи до размера за того размера база данных просто что написал помещаться полностью в память если возникали добавьте когда вернулся небольшая таблица там смитов транзакциями база данных повалился диска водой не спеша и соответственно служит как нагрузка на диск и и все держала и приходилось ну очень быстро все это пройти потому что когда вот вы находитесь в состоянии вам надо быстро двигаться по разным серверам а обычно это связано не только с тем что надо учитывать базе данных отправить на постройках но еще и сам предложение кита запросы убрать еще чего-то если этот момент у вас там тепло и настроен у бога то вынесенному что не хочу выпить хочу не выходил из них там приставали абсорбера то и тепло и как вы ягоды что это причем это вот она жестко за достаточно хороший клиент потому что бывает гораздо хуже я с людьми которые принципе тепло и просто заходят и собираетесь делать это где то читал ну и отдачей были еще некоторые проблемы там с настройками уже использовал совершенно он еще не все шесть единого нужно предстоял на каждой ноги будущих клиентов какой в принципе гораздо проще было с ними интегрироваться и использовать наши вот рецепт для того чтобы автоматизирует то что у них есть но вот стоимость которые можно чистить давайте мы переехали на машинку по воле 102 потом еще разъехались об этом чуть попозже расскажу сейчас выберет расскажет о том о чем что нет итоге делает когда работала у них происходит современной любительскую для категория те кто делает book те кто и убили устанавливать ребята вы гордились искали толку а не раз в сутки запускали сколько у них это было ночью погиб мне было заметно непоставленный моста на диск и когда и спросили что у вас падет все воздано мы откатились назад на денежку установлена там такой проект что сейчас простое деньги работает вообще как можно в комплект тремя способами первый способ это не book поставите себе ногу некоторые люди город вокализацию как муку депозит обычно которые составил после вскоре эля потом дам поют машинки диск просто на базу данных и так a6 с ума и вообще это не вот вот второе это люди использовали дам это работает но базовых на стоянке прочистки дальше-то брюн активации работы благодаря тому что в поездку или есть балоги который движется на них постоянно из этих волну как как логикой спорят об этом не команды пишется страниц и благодаря этому можно делать рассудке полный backup базы и копить каждый love не копать приблизительно если вовсю потеряете будет тимин свои 5 минут работу свои базы это все настраивается можем поместить 5 минут мы не дрался на могла случаем на дороге цветы рокки пусть летит и руки-то случае мы сделали эту операцию стоит собака под ногтями интересно вообще потому что благодаря ему базу на материнство за 20 такой вот плюсы этого бука по очевидная а минусы ну практически нет одессы что вам нужно капица натуре локальную машинку рядом проблемой центру поддается любому то выкапывать ваших полагаться на члене есть такая утилита называется более это как робот такой маленький истребят маскировку эта штука тоже самое делает новую камеру на amazon сама вы просто прописываете ваши будущие amazon ключи вы говорите куда сохранить данные и она каждый лоб это каждые пять минут скидывать на масла это очень удобно вы сразу делаете всегда круто модно и диск проблема устанавливать довольно доступ потому что тема и от вашего центра довольно ваших сейчас используем как единую схему мы покажем всем намазан и раз и постараемся суточный пока просто болотов локально на сайт и клиенты часто раскидываем amazon это удобно потому что обычно ничтожно откатываться сказанное не более чем на сутки от того не быстро а 6 страниц на амазоне из проблем и звуковыми болотов не столько знаю что если вас очень большая нагрузка на диск при полном и камешек подтормаживать это лечится просто если он scheduler и цевки вы вставите поменьше приоритет но поиграть и это все работает нормально вот еще нюанс написано пишет backup plus что такое полный багама станут по 3 это просто backups альбом файликов после того собирали парики вы наказываете баллоне у вас база сама понимать какие данные крестьян и кафе нет версии до 9 1840 нужно было нко ликопина звоните 911 стыковать элита которые копируют файлики через протокол посредством бинарное вам не нужно ставить ваши деньги между машинами просто без звука порт и программировать это очень удобно можно пользоваться как говорил после сохранит традиционный лук это бинарный лоб и принципе тот же лоб можно использовать для реабилитации что собственно и делается аппликация в кодексе есть на час два варианта синхронные синхронная поскольку достаточно дружно проектные пользуемся синхронный ну 1 раз в отличие от лагов позволяет там но потерять данном случае потери мастера давать летали секунд или специально кто кого порядок более того у ритика царицы и особенности донести например носим на троих из политического балоги если у вас крепитация разбежалась я внутренне можете договориться к мастеру слив идет к вашим пока по этимологии у доски из бака все загадывают игры потом всех опять накатывает а вот на дополнительное приказу обязательно мониторить и потому что вы бывали ситуации наш дротики в они частично реплика настолько отстало от мастера к мастеру же не осталось данных о ну которые нужны для того чтобы спикировать на своих и если даны если вы не у вас нету нету бы готов не хранятся летает какой-то проблема перицо заново перезаливать реплику реплика точно также надевается команды по гпк после того как сделали бэкап вытаскиваете сцен тревоги через опять же бинарных протоколов я вообще в принципе и есть или фикации и сил хорошо не надо иметь доступ к шопах машинки базы данных и реплики обычно для чего используются реплики используют для ну во первых это фейлов в случае падения подымаетесь у вас есть чуть-чуть и стоящая копия реальные данные а второй момент конечно для сложных запросов и вот наш пальчик опять же показывает что зачастую делают мастер для для ботфорты да и ребрик триплекс используют для букета то есть когда муса другие фирмы отчеты как будто считаются текучий этих reporting то что называется и для этого очень хорошо подходит реплика но тут опять этот момент что post is under сотник а импликация и зону смотри бинарных логов если допустим да мастер какая-то версия танках удалена этот апдейт приходит нас ли он оставить это культуры gtr транзакции версии то на хочу используются в каком-то сервисе жители запрос тут возникает конфликт что делает накладывать изменения и запрос либо падает опрос и ждать и вот за это отвечает проект 20 мпа и стивен белый сколько ждать перед тем как ты измениться с мастер какая может быть проблемы если вы делаете все время то есть приоритет заброса то у вас может быть такая ситуация что вопрос его и посмотреть данные будут они будут не на качестве ноги мне на катится еще на своих но тут какой момент что если допустим этот момент падает мастер катер за три дня эти волокна да будет накатить это конечно не три дня на достаточно длительное время за и более того что вот например для листа за жизнью на блондины запросы делать мы сказали встал однажды все канада был кто-то сделал запрос к реальным пан цифре дня его же там через пару дней начали ругаться видно почудится в тела данных нету они как бы не находились на своих поэтому здесь там я как бы вот какой-то разумный компромисс выбрать между длиной запросто и которую между временем который вы будете ждать пока опять данные спасет но обычно делают как обычно если есть оборот дополнительно делают одну реплику которая максимально близко соответствует мастер на случай падения оборудования 2 люблю бутом которые тут полчаса час в зависимости от ваших потребностей ждет отстаёт от мастера ездит необходимо опять же опять же это не защищать из-за того что какие-то транзакции вас будет обрываться истошно конфликтуют версии эти транзакции обрывать или просто перезапустить с этим никаких проблем нет ok и вот про нашего клиента вот вот такая сделать за 1 базу данных и сделали вот так сверху это мастера а снизу это две машинки два своей вот есть мастер стоит увидеть это основная база данных а там петлю 2го сданы который занимается тоже open server ну как бы вот это вот фактически нас реплика которая держит сразу две базы данных он просто дешевле да какая история возникла я там у них плавочки больших русского запись в одну таблицу и более того в таблице спектр транзакций быстро росла день там из десятков миллионов записей и какой-то момент она начал заваливаться из дискового кэша ой ну если скажем под кисть от родительского крыша и фактически база данных установочные читать на печать но когда нет ни детей данные когда мы не пришли этот уже когда настолько мониторинг вот это мастернода красненькое то у нас это чтение они казались вот это не уровне запущена пока кстати то есть когда так устроен десной controllers каша у нас пользуется аппарат греется с корешом на запись и когда диск активная читают это у него плохо получается писать хочется увидеть человек этом как об очень приятно ген таком смысле вы у него есть возможность 558 постоянство габаритами сторонились скачок на запись конечно то есть что-то делать при таких нагрузках с плохим железом учить на колени а не слышал чтобы кто-то начинает хитрить и делать много нормальных сервера баз данных но цена вопроса хотя какая что надо позирует опустим стоит не ничке что они труда при этом миллиона рублей то есть это месяц работает небольшой команды программистов то есть понимаете что сделать это сложная система которая будет на мало какие то очень параллели цвет гораздо рожи чем купить хорошую же диск а вот например как бы технически нагрузка на своих как выглядит то есть возьмем виски запросы очень нам помог все в каком смысле что мы передвигаться тумба потом 3 и все эти машинки должно быть однако конфигурации потому что это нормально в принципе помню все до правды которые на поменять всегда причем так один или два забудет и зачастую там некоторые параметры в подписи может это перезагрузка это привод потому что сервера необходимо вводить downtime неприятной операции поэтому вот этих вещей было полетишь мы сделали вот наш рецепт подпись сейчас немножко не расскажет о да да не смогу много разных рецептов это бог использует под бездарно мы написали этим проект вот эти хочу рассказать общем в чем дело нам надоело ругайся на после первой установки черепа потом уже писали рецепт для шефа провайдер которые ставят пан инфо нас ему исходных условиях ему всего лишь аудитории он 4 и документации собственно очень просто были подогнуты из цели вы можете описать все настройки важных возрасте здесь как видите 10 немного почему потому что все остальное находится в дефолт дефолта никто из которых погрейся не спал который мы считаем правильным это позволит вам хотелось таким конфигом на бизнес пусть и базу данных как то будет работать нормально вот что здесь мы можем настроить все очевидным весь континент данных это понятно даже дефолтов право то чтобы это вот и вы и сделали аппликацию сейчас это просто создание специального любишь больна через два-три дня я напишу что можно было найти гнуть роли мастер-класс и ships to be a рабочих бы мастера не отвлекаться вы выстраиваете вас до на свои мастера слоев не вынуждать и получаете полностью рабочие моста слоев связку этого нет скором времени который позволяет работать сердце 2 окна позволяет делать духов и простые на ис-3 по выживанию опять же сам воскрес и этот вали собранно специальном сервис убил все разные темы снова сборки пакетов букета учитывается и вы можете посмотреть бог он сам по три что нужно репозитории сам скачает тому же использовать если вы их не использовали шеф потому что у вас были проблемы автострады или ты еще не величайшим сделать попробуйте вот и хорошо мы внедрили тупо мужа на одном прийти на 2 это будет отлично спасибо за внимание мы кратко рассказали о том как мы используем как использовать подписи чтобы познать и сейчас у нас буквально время на 2 вопроса это вот а вот тебе буду строить и база данных об систем опытных нет хороших и огород этим ножки интересовался был какой-то mandrin по моему и обострилась что может в связи с тем что можно прямо некрасовский one и как вы наводите нельзя пользоваться это мне дает запас продуктов но наших поэтому котоpая 9 они расписались крупный даже бизнеса в компании чтобы использовался мало нас когда нам и не понимала когда мы начинаем заниматься по видам главная проблема у них не была такой удобной как базы данных с информация всей системе шефа сервер как он считает информация всех машинах при первом запуске все клиентам он ведь я башенка такой атаки все проекты дальше вот эта игра бита информации можно использовать при написании раз приобретений не а транслировать с фронтов на все пакеты вы добавляете новый пакет у автоматически представиться все зависимые конфиге это сигнальных зайди почитай там память это было сделано достаточно плохо но в целом сейчас опустить гривой система то есть это вопрос такой каком году дело в том что вы имеете ну что есть мастер мастер аппликации вопрос правильно но в подписей на стандартам поставки есть синхронная мастер стоят рубрикация но дело в том что космосе что вас когда приходится просто мастер за комитета на славе и только потом отличались мастера то есть у вас время ответа как минимум удлиняется на заброс пустите туда обратно и это будет просто очень долго время твитов среднего систем очень сильно возрастет поэтому как бы мы не сможем страны аппликацию в этой системе я потому что симона я люблю catia даже самой сцене с мастер мастер будет что иначе стоит выводилось своих после всех этим ты становишься снижал это может быть это можно сделать автоматически на один вопрос как бы готов а чтобы по день то есть если вас про полазить она на секунду она бывает ситуации на своих начала казино будет система только подумать такое как бы я не знаю точно где-то какую как брали то что мы делаем это рабочие с кем она позволяет делать на небольшой кому-то учитывать что там сокол сразу году вас политически я ни разу давайте на самом деле в глаз на то что игра закончилась уже"
}