{
  "video_id": "FaSfRh3_AyQ",
  "channel": "HighLoadChannel",
  "title": "Общий флоу разработки в Ozon. Как сделать жизнь разработчиков проще? / Даниил Разумов (Ozon)",
  "views": 4043,
  "duration": 2807,
  "published": "2023-04-28T06:19:52-07:00",
  "text": "Всем привет Меня лишь уже представил Меня зовут Даня Я руководитель группы разработки автоматизации я сиди наша команда занимается разработкой собственно говоря и автоматизации процессы непрерывной доставки кода для всех команд в Озоне Вот и сегодня мы поговорим про общий Flow разработки в Озоне или как сделать жизнь разработчиков проще сначала немного цифры Метрика нас о нашей компании вообще чем мы занимаемся собственно говоря нас больше 3800 человек войти в OZON Tech Unity из них собственно говоря 12 релиз инженеров из которых состоит отдел CCD в том числе и моя команда которая реализует и поддерживает процесс непрерывной доставки кода во всём амазоне у нас более 4.000 сервисов в продакшн-классе или кубера если смотреть год назад эта цифра была около 3.000 то есть мы за год масштабировались в Тысячу сервисов и у нас в среднем происходит более 500 релизов Наоборот в день Вот и также мы честно говоря предоставляем более 10 пайплайнов разработчикам Для различных целей об этом Также сейчас будет чуть позже подробнее и вот немного метрик соответственно данный график показывает количество запускаемых Job в день ставим стемпом в 10 минут и если мы можете смотреть то у нас пики примерно имеют около 2500 Job запускаемых за 10 минут То есть если не сложные подсчёты провести около 250 Джов минуту у нас запускается в нашем процессе CCD и данная диаграмма у нас показывает количество используемых пайплайнов э-э проектами самые популярные пайплайн - Это paypaline для Go проектов 47% практически половина сервисов у нас используется специфичные пайпла для диплоя э гоп- сервисов следом за ним идёт это pip-line это 30%. за ним у нас идёт 14% - это э команд pipeline собственно говоря это общий pipeline который может использоваться все различными языками и платформами например питон Java и так далее следом за ним идет специфичный pipline для deply frontent приложений это 6 процентов и далее идут более мелкие которые очень редко используются для специфичных целей например Это диплоид 1С это airflow dogy Data Science и так далее собственно говоря о чем мы сегодня поговорим Первое это мы немножко вернемся к истории Как появилась команда релиз инженеров вазоне И что она привнесла далее мы обсудим почему же решили все-таки внедрять общий слову разработки на всю компанию и далее очень подробно пройдемся по пунктам как люди в зоне выкатываются от момента первого комита до выгодки приложения в prodclassic дальше окунемся в архитектурную составляющую наши системы после обсудим как внедряли предложенный фу далее будут короткие итоги и выводы Да немного истории команда релиз инженеров появилась в 2018 году одновременно запуском продакшн кластера кубера и в кратчайшие сроки команда организует процесс CD и собственно говоря вот что из этого Получилось у нас появились единые payplanet лабы Для различных целей которыми начали пользоваться разработчики в 2018 году когда только вся эта история зарождалась у нас был только один общий план как раз таки команд которого 14 процентов на предыдущей диаграмме и вот постепенно с каждым месяцем годом мы увеличивали количество пайплайнов которые мы предоставляем разработчикам и На данном этапе у нас больше 10 лайтлайнов которые разработчики могут юзать для выкладки своих приложений и происходит автоматизация процесс себя сидит то есть разработчиком не нужно было запариваться как выкатывать приложения что нужно было сделать им достаточно было величать наш пай-плайны И просто там кликать жопы в гитлабе и спокойного особо ни о чем не думать собственно говоря пример подключения пайплайнов свой проект мы используем gitlab и соответственно инклюд готовой сессиди решения занимает буквально четыре строчки У нас есть строчка Project это естественно репозиторий в детлабе который соответственно содержит все пайплайны которые мы предоставляем дальше ref это стабильная версия данного данных в нашем случае 005 Ну и файл это естественно pipeline который вы хотите использовать для диплоиса своего приложения в данном случае это гол пайплайн который является самым актуальным и часто используемыми на интеграция гитл джира вообще что это такое Это наша внутренняя разработка которая синхронизирует состояние тикетов джире с тем состоянием кода в детлабе кода в репозитория в gitlaby Что происходит с кодом собственно говоря вот простой пример у нас есть 7782 он изначально находится в статусе туду И как только разработчик делает пуш на gitlab сервер и в комит мессендже указывает в квадратных скобках название тикета ticket автоматически переезжает и статус статусом Progress и так всё движение тикета по борде у нас автоматизировано разработчиком там или менеджером вообще не нужно думать о том а Действительно ли в верном статусе находится его тикет движение ticket этого бордеона с автоматизировано и всё Круто быстро собственно говоря предпосылка внедрение общего флоу разработки все-таки почему же мы решили что все должны жить на одном слово все должны выкатываться одинаково все должны быть одинаковые статусы на борде в животе одинаковые переходы одинаковые одинаковые Flow работы с ветками в детей и так далее на первое это стандартизировать процесс выкатки изменения разработчиками для упрощения continuouse internation и ускорение доставки кода Ну действительно Если у вас есть какой-то единый стандарт как разработчики должны выкатывать свои изменения и он круто автоматизирован быстро и легко масштабируется и поддерживается это намного лучше чем у компании будет иметься э десятки различных флоу по выгодке по работе с бордой джира и так далее и это очень было сложно было поддерживать и масштабировать в дальнейшем и соответственно второй пункт вытекает плавность первого это экономия ресурсов на поддержке общих инструментов да как я уже сказал намного легче иметь какой-то единый Flow его поддерживать развивать и все будет круто Ну и такой пункт под звездочкой в 2020 году Озон проходил внутренний сок саудит и для того чтобы изменения которые разработчики доставляют на продакшена проходили больше проверок и были контролируемые также был разработан наш Flow собственно говоря этапы разработки вообще как выглядит разработка фичи в Озоне тут три пункта первый пункт это разработка логики то есть разра- получает какое-то задачу начинает пилить там бизнес-логику и после этого он тепло и cfd там что-то локальное тестирует Да и так далее Далее после того как разработка ВДВ окружении завершена происходит глобальное тестирование в релизной Ветке то есть ваша фича ветка вмёрзшивается в релизную и начинает проходить глобальное тестирование там коа причём в вашей релизной ветки э-э у вас может быть не только одна фича то есть есть команды которые э-э пилит очень большие релизы там раз в неделю э-э выкатывает один рейс в котором там десятки тысяч веток и это уже то есть в глобальном клубе А обкатывается все изменения и тепло это состояние и после того как все изменения в релизной Ветке протестированы э создаёт стек и происходит диплом продакшена а сейчас мы более подробно разберём э все этапы от момента когда у вас произошёл первый камень до момента э это как человек выкатился в рот со всей этой автоматизации автоматизации движения тикета по борде и так далее собственно первый пункт это разработка в окружении Это пример нашего гуапайплайна для диплоидов окружения Давайте быстренько пробежимся посмотрим что здесь происходит собственно говоря есть Stage Pre здесь у нас есть жобар она является блокирующей и в ней нас запускается внутренние проверки той версии приложения которую вы сейчас диплоити проверок очень много собственно говоря наверное стоит озвучить самое важное если у нас проверка на версию используем языка это вали для дуднета для Go насколько я знаю у нас только три последней версии языка держится там 1 19 1 18 и если э-э какой-то сервис имеет более низкую версию языка и он начинает диплоиться данная со словами Чувак где Обнови версия Потому что со старой версии Go катиться также у нас есть шаг Билд в билде у нас происходит Просто на самом деле сборка приложения то есть создание бинареи запуски Unit тестов линдеров и так далее следующий шаг у нас это шаг publish здесь у нас происходит сборка докер образа и перекладывание его в локальный git Love regis 3 проекта собственно говоря сразу хочу сказать что докер образы пишет разработчики самостоятельно в своем проекте Мы лишим предоставляем список базовых образов которые они могут использовать за основу при написании своего собственного также у нас есть шаг диплой здесь у нас из интересного это Джо бачек она сверяет комирочность покрываемость тестами мастер ветки и текущая ветки в которой вы диплоитесь и если она отрицательная то джоба фэлится но на данном этапе она у нас не блокирующая потому что там есть доработки есть моменты когда у тебя ковыряешь может упасть относительно мастер но при этом у тебя все строчки кода покрыты например когда там четыре факториал выпилил 1000 строк у тебя общее количество строк кода уменьшилась соответственно тоже упадёт независимо от того покрыл ты все стройки коды или нет Поэтому данный пока не блокирующее мы сейчас зарабатываем И как только готовый механизм появится она снова она станет блокирующей и уже не получится выкатиться разработчикам у которых упал ковырять относительно мастера Ну и девело здесь у нас происходит дисплей приложение в Дефо окружение кластер кубера диплоимся мы с помощью холма У нас есть написанный нами хомчат который там поддерживаем и не успеваем тоже наша команда Hand Chart разработчикам не нужно там клонить форкать в свой сервис и потому что он доставляется в бриджабе теплое в диплом доставляется из старые архива уже там потом происходит разархивирование и он уже готов его можно использовать локально там делать стал и так далее и Stage closs есть еще здесь у нас есть две джоба это cleandy waltment и register Clean собственно говоря удаляет текущий релиз сдев окружения и Джо бараджестриклин у нас удаляет собственно говоря образ из локального могут запускаться разработчиками но также оба автоматически триггерятся когда как только ветка удаляется То есть как только Вы удалили ветку после удаления происходит автоматический триггерных Джоб чтобы удалённые ненужные ресурсы как раньше здесь в кустерах и у нас очень интересный Вчера вы могли заметить буковку I это наша разработка с помощью которой вы можете быстро узнать что данные чтобы делает как только вы найдете на а и появится Вот такой Toolbox который покажет краткое описание Что данная джоба делает И если вы кликните на данную буковку А у вас редирект нет на confluence где уже будет более подробная информация по текущей Джобе Что она делает с какими параметрами запускается на каких ветках запускается там Какие ограничения и так далее Это у нас наша внутренняя разработка мы с помощью интегрируемся в юаньку гитлаба и для нужных Нам же представляем аннотация далее ну и собственно говоря вот Flow работы в окружении в gitlaby вся история про диплоя происходит у нас в фича ветки и также вот у нас есть такие статусы джиры которые связаны непосредственно с диплом в окружении У нас есть статус бы клок в дальний статус тики попадает как только он создался далее У нас есть статус туду В данный тикет разработчик самостоятельно перетягивает в данной статус ticket автоматически разработчик перетягивает как только он понимает что разработка по данному типу должна вот производиться в срок далее У нас есть статус то есть Кит находится в паузе собственно говоря тут разработчик также мануальной дергает ticket статус Холд Ну потому что он Холл тикет может попасть по различным причинам будь то там появился блогер со стороны соседней команды либо же там приоритеты поменялись и данные задачи сейчас не стоит заниматься А также есть статусом Progress который явно говорит что по фиче сейчас ведется активная разработка есть статус интервью тикет находится на ривье у своих коллег и статус девелопмент Дан который подсвечивает что разработка по данной фиче завершена про получены и так далее ну и вся эта история происходит естественно в кластера вот сейчас мы более активно пройдёмся по переходам и расскажем как они у нас автоматизированы переход из 100 долларов как я уже рассказывал ранее происходит при пуше в gitlab и в commit message указывая тикет по которому должен произойти переход и ticket автоматически переезжает статус in Progress переход из in Progress в интервью у нас соответственно происходит как только разработчик создал мерши квест по ветке в которой как раз таки в комитах указан тикет И как только он создает мертвый квест переезжает автоматически статусы на review также верный и обратное если там разработчик любит больше активнее активнее через жиры он может перетащить тикет из in Progress в интервью самостоятельно и тогда у тебя в гитлабе создастся автоматическими мерши квест ветки в которой присутствует в данной комет Также хочу сказать что у нас запрещено чтобы один тикет КАМиТ tickets с указанием в комете находился в двух и более проект то есть разработка должна вестись только в одном проекте по одному тикету Вот и переход из ревью в девелопмент Дан у нас происходит после получения нужного количества опробов на мерч квест сделан издание ветке все как только Вы получили опрос переехал в девелопмент Дан и соответственно разработки по нему завершены его можно отдавать в тестирование поэтому Пойдемте к следующему глобальному шагу это тестирование здесь у нас пример глупой плана для теплостей а тут уже бы многие нам знакомы я на них подробно не буду останавливаться есть джоба Create Release в рамках которой происходит создание релизов Джерри в которой входят все тикеты созданные в рамках данного релиза и на каждый из этих тикетов проставляется фикс вершин с указанием данного релиза далее мастер данная джоба автоматически подмершивает актуальные изменения из Мастер ветки вашего релизную ветку собственно говоря зачем это сделано есть команды которые очень активно разрабатывают которые могут катить там по три-четыре раза в день и у вас может случиться такая ситуация когда у вас релиз А уже выкатился мастер А релиз б ничего еще не знает об изменениях из Мастер изменениях из релизной ветки а в и поэтому запускается у которой есть три варианта Исхода первый вариант Исхода собственно говоря у вас изменения из Мастера увидев что актуальных Нет просто станет успешной и пайплайн пойдет дальше второй вариант собственно говоря у вас она может найти какие-то изменения их автоматически применить без конфликтов они спокойно применятся данный pipline за консолится и создаться новый автоматический план уже с подтянутыми изменениями из Мастера Ну и Третий вариант когда автоматически Джо попытается подмерзнуть у нее не получится потому что там будет локальные конфликты и тогда она свалится и разработчику придется самостоятельно фиксить конфликты руками а дальше Stage Build точно такой же creat Image и publish точно такой же тепло и у нас появляется jobo securitiskan данная желба разрабатывается команда информационной безопасности мы лишь интегрировали её в наш ищет уязвимости в образе которые используют разработчики для deploe зачем это сделано Ну вот в рамках событий там Весенней давности там этот достаточно сильно нам помогла потому что она просто проверяет Если вы что-то подтягиваете из интернета в ваш образ доставляете какой-то модуль чтобы он там не был взломан там не было каких-то проблем чтобы вы не получили каких-то Обломов не только там вашего приложения но и в целом там компания от этого плохо не должно было быть Джо бассейнженко здесь она аналогичная девелопу происходит диплоид Station как окружение пока пропустим и есть класс релиз Ready to prod собственно говоря данная джоба прожимается мануально разработчиком и она прожимается только тогда когда вот тестирование произошло весь этот релиз потестился никаких багов не найдено и данный прожимается когда ты понимаешь что действительно готов катиться в рот на данный Джобе у нас происходит проверка статусов тикетов которые вошли в данный релиз проверяется что тикеты в итоговом статусе который готов к диплом Продакшен Если вдруг какой-то стикетов не находится в статусе например находится там быклок там или не прогресс данное jobo faility потому что мы контролируем изменения которые разработчики вносят в провод и вот чтобы изменения попали в рот работы которые велись по данному тике то есть дикий должен был пройти всё движение по борде там произведена разработка пройденный кудривью пройденный тестирование и так далее после этого после данной проверки у нас автоматически создаётся gittek от camite на котором запустился данный pipeline и запускается pipeline для диплом про и вот собственно говоря как у нас выглядит автоматизация в гитлабе у нас вся история происходит в релизных ветках в джире У нас есть движение тикетов Да релиз тестинг рейтинг диплоид тикет автоматически переезжает из статуса девелопмент если запустился первый поимплант для релизной ветки в котором находится как раз таки коммиты с ними которые указаны и э тикет переезжает автоматически из реалистайтинг в радиусу диплоид по нажатию кнопочки Вот как раз таки который обещал вернуться а она прожимается мануально когда ты уже понимаешь что готов катится в провод и она вот все тикеты которые находятся в данном релизе перетягивает статус радиус диплоид который как раз-таки подсвечивает что данный фича готовы выкатываться в рот диплоид Production окружение говоря Вот пример gopy line для Deep Life Production окружения У нас есть релиз имидж на стриже паблиш она у нас перекладывает релизный образ которого приложение должно выкатываться в рот помимо если помимо глобального кислородисты он его кладет еще в хранилище артефактов артефакторе для чего это сделано Но для больше отказа устойчивости чтобы ваш релизный образ которого приложение катится в рот было сразу в двух местах это Lab registry И в артефактуре то есть если происходит какие-то проблемы с артефактуре То есть например часть образов потерялась или артефактории по какой-то причине доступен мы автоматически начинаем брать образы при диплоид из рейдере есть тачкенри собственно говоря здесь у нас происходит диплом приложения по схеме канареечного развёртывания про кстати схемы дипломов какие у нас есть в Озоне я сейчас также чуть попозже расскажу Ну вот на данном слайде у нас происходит диплом с помощью канарейчного развёртывания и после того как ты заделывался в провод потестил что все окей ты нажимаешь жабу колос-релиз которая закрывает все тикеты происходящие которые вы катались в рамках данного релиза она переводит их статус-кос смёрзшивает и смешивает релизную ветку ветку мастера и запускается автоматически для мастера ветки нам вот собственно говоря вся автоматизация переходит эту дипломов клосс у нас также автоматически и происходит при нажатии Джо баблос диплом с вот пайплайн для мастер ветки сразу скажу с мастера Мы не диплоимся в прот Здесь есть только диплоид дефостейджинг чтобы у нас в stageев davy тоже имелись актуальные изменения как на проде поэтому мы с мастер ветки еще дипломимся staging и в и вот еще самое важное джоба это Джо баклос на стрижек лос-аджоба делит набранчес она запускается у нас автоматически и автоматически удаляет все смешанные ветки Вот то есть все эти фичи ветки которые сначала вмёрзли в релизм А после этого релизная ветка вверглась мастер они удаляются автоматически и соответственно как я уже говорил ранее удаляются все релизы связанные с этим идти с этими ветками и образы из гидра Да Стратегии диплои в Озоне Я здесь Наверное подробно не буду останавливаться на том как это все устроено потому что все Стратегии в эти давно уже знаете я думаю Rolling update это стандартная стратегия когда собственно говоря у вас параллельно поднимается новая версия релиза там поднимается новые под и автоматически гасится под старой версии приложения вся история происходит без тайма также нас есть блю Грин теплой Когда у вас рядом с первой версией диплоя поднимается ещё вторая и потом вы можете просто свечить трафик на новой версии проверить что всё работает после этого удалить старую версию и стратегия кеннери которая как раз таки была предоставлена представлена на этом предыдущем слайде Здесь вы можете оперировать Какое количество Какой процент трафика у вас будет идти на новую версию релиза Какой процент трафика у вас будет идти на старую версию релиза и только после того как высвечите весь трафик на сто процентов на новый релиз Вы можете уже нажимать чтобы колос-релиз после этого там старые релиз у нас удалится вот это джоба кастомизирована то есть разработчики могут сами определять они могут хоть 100 Джоб закостомить мы предоставляем экстент для этой они могут хоть все 100 Джобс закостомить То есть у них какой-то критичное приложение с большим количеством РПС они могут хоть по одному проценту трафика свечи и смотреть всё ок по дефолту Мы предоставляем ноль 100 но разработчики опять же как я уже говорил могут кастомизировать и выделять сколько угодно процентов трафика и вот собственно говоря общая схема Flow в Озоне выглядит Вот так Тут уже полное взаимосвязь жира статусов и gitful я на ней подробно Останавливаться не буду потому что я там последние наверно 15 минут про это рассказывал Вы можете просто фотографировать посмотреть как это все выглядит лично И также у нас есть еще ход Fix Flow то есть предыдущий Flow который про который так подробно рассказывал он конечно крутой но иногда бывают моменты когда вам нужно выкатить что-то очень-очень срочно все горит у вас какой-то критичный бак и тогда вы можете воспользоваться просто создать Светку после этого нажмете рейтинг рот и также покатитесь с тегов провод То есть она мне как можно видно все овал и так сказать которые введены пунктиром они не участвуют в семьях от fixflow и вот здесь только есть Прогресс Ready to diplay сразу Close вот теперь поговорим про архитектурную составляющую как все у нас устроено внутри это целевая схема архитектуры из важного У нас есть Сначала мы поговорим про наш API данные API нам предоставляет единый предоставляет для похода в сторонний API который участвует вся сети процессе То есть это гитла попить жирапия Купера зоны это наш корпоративный менеджер потому что мы ещё умеем делать уведомляшки там успешности джопа о том что релиз какой-то выкатился и так далее То есть данный сервис предоставляет клиентов нам для похода в стороне API и уже всеми остальными сервисами которые участвуют системе мы ходим в API там кисловат жира не напрямую А вот через вот этот сервис потому что миновать там авторизацию и так далее далее У нас есть Сервер hooks это сервис написанный на питоне который предоставляет процесс при ресив хуков в гитлабе это по сути скрипт который запускается Перед каждым пушом в gitlaby и валидирует коммиты которые вы хотите доставить до провода по нашим внутренним политикам приватности я расскажу про Некоторые из них это первая проверка которая проверяет что во всех комитах которые Вы сейчас хотите доставить до гитлаба у вас указаны тикеты и тикеты существуют далее У нас есть проверка от ребят из информационной безопасности которая валидирует репозитории проверяет нет ли там за хардкоженных токенов паролей Логинов если она опять же находит кто-то там что-то тестировал и забыл токен выпить запомнил это на это найдёт и заблокирует пуш сразу же и также у нас есть Это проверка на лимит количества веток в репозитории на лимит количества веток в репозитории Get labo эту историю мы внедрили относительно недавно потому что многие разработчики очень часто что-то пытаются коммитить создают много фичеветок потом оставляют их бескозными А как я уже говорил у нас реджистрее очищается после того как ветка удалилась и очень много репозиторий в которой забитой ветками соответственно они забиты образами и за это у нас Раньше начал тупить и мы установили лимит на количество веток в репозитории 250 штук вот далее мы как раз таки обсудим целевую схему как у нас происходит автоматически автоматизация движения тикетов по борьбе жиры У нас есть лап жира сервера и соответственно с помощью веб-хуков написанных нами Мы собираем моменты с гид лабаз жиры и отправляем их изначально После этого они попадают в Кафка у нас там есть два топика один связанный другой связан с гитлабовскими лентами И после этого у нас есть сервис ресивер реализованный на гол который по сути является консьермерам он отчитывает два этих топика и в зависимости от того какая сейчас Я прилетела он его лидирует и двигает тикет в нужный статус а также данный сервис ресивер у нас собирает всю статистику по всем диплом вазоне то есть как только запускается мы собираем по ней статистику Сколько длился диплои сколько у нас поднимались под и по времени сколько торговали те или иные проверки и всю эту историю мы отправляем в Елка и потом уже в кебане смотрим анализируем и так далее выластик точнее да и у нас есть Клин наш консольная утилита реализованная на питоне которая как раз таки автоматизирует всю логику реализованную в наших планах Вот мы сейчас смотрели пайплайны в них жопы вот в них запускается на самом деле логика из консольной утилита на питоне у неё есть множество команд реализованных и по сути Мы в блоке с когда мы пишем гитласе указываем просто вызов той или иной команды Например там или теплой Вот это всё реализовано с помощью консольного утилиты на питоне собственно говоря теперь обсудим процесс внедрения Full как это всё внедрялось Первое это Первое это проектировка Flow то есть изначально мы продумывали Какие в какие статусы есть у тикетов точнее нет Первое это было проектировка Flow то есть мы думали какие статусы должны быть общие у тикетов Какие должны быть переходы между этими статусами после этого были доработки нашей интеграции getlab giro то есть мы дорабатывали наш как раз таки сервис ресивер чтобы он умел делать правильные переходы чтобы они были последовательными в общем там доработка со стороны написания кода была После этого мы обкатывали фон на нашем отделе естественно мы не стали это всю историю релизить сразу же мы обкатали это все на нашем отделе посмотрели почувствовали Как будет на этом жить будет ли на этом жить комфортно и только после этого происходит релиз словно весь сезон И после этого когда мы зарели сказали вот наше решение Оно такое давайте жить на этом После этого мы предоставляли свою временную помощь при переходе на наше решение другим командам У нас есть чатик в нашем корпоративном мессенджере по вопросам всей сети на данный момент более 3.500 юзеров которые каждый день к нам приходят за вопросы и вот как раз тот момент когда мы зарели фу к нам очень часто активно приходили спрашивали как это делать И вот мы помогали ребятам переходить на наш flow-разработки Ну и собственно говоря наверное надо потихоньку закругляться краткие итоги первое нам удалось создать единый процесс ACD которым пользуются все команды в Озоне параллельно с тем как параллельно с тем как мы разрабатывали общий Flow общий Flow разработки в Озоне Мы также подумали блин нам нужно посчитать вообще сколько человек нужно времени чтобы релизиться и тогда мы параллельно с этим процессом начали еще считать Маркет Мы научились считать таинту Маркет для нас это время между созданием релизной ветки до доставки кодов прот и после того как мы почитали в начале получилось около 25 минут и вот последний год мы начали активно оптимизировать маркет и добились оптимизации вот на данном этапе у нас 9,5 минут составляет время доставки кода напротив на самом деле тоже достаточно интересная тема я по времени доклада к сожалению не влезаю но процентов Маркета наверное стоит отдельно потому что очень много моментов как мы это все оптимизировали как мы это все учили считать то есть это достаточно тоже большой труд Ну и организовали процесс своевременной помощи разработчикам по вопросам себя сиди Да и как уже сказал у нас три с половиной тысячи юзеров корпоративном чатике в мессенджере где ребята каждый день приходят с какими-то доработками просят что-то посмотреть э-э просят немного изменить процесс Flow и так далее И у нас активно настроена система дежурств У нас есть Первая линия поддержки которая первостепенно там выделили на отдельные команды и там из четырёх ребят которые э-э перво-наперво отвечают на вопросы собственно говоря быстро реагирования и там в среднем реакцию на сообщение менее 2 минут чтобы Вот ребята человек задал чатик вопрос группа дежурных реагирует менее чем за 2 минуты и также линии поддержки которые решают более там серьезные моменты там архитектурные какие-то либо более критичные моменты Вот ребята из моей команды как раз таки Вторая линия поддержки которая которая тоже дежурит и которую призывает в чатике когда Первая линия не может ответить на вопрос У меня наверное все спасибо большое Спасибо поехали а у меня вопрос по поводу таймта Маркет 9 минут это включает себя тестирование Нет не включает Это чисто работа джоффлайне Спасибо Здравствуйте спасибо большое за доклад сейчас я хотел уточнить вы там говорили про ограничение в хранение веток Ну про количество лет Просто если вас там три 3 800 разработчиков Неужели так мало веток там небольшое число было Ну опять же то есть есть моменты и 3800 разработчиков это только в чехи вазмантехе но в целом У нас gitlab у нас распространяется на все юнитазоны там есть ozon.travel то есть как бы да я имею в виду что вот на подразделение бизнес Юнит ни разу не вылетали вот за него то есть не было случая Ну что больше веток создали чем ограничение или что в этом случае происходит конечно было да то есть изначально как только мы начали считать статистику мы увидели что у нас превышает лимит на 250 веток насколько я помню э-э около 93 позиции у нас на моём по-моему 25.000 проектов сейчас будет Лада да там какие-то архивные Окей но как только мы начали вот внедрять данную систему мы увидели что 93 репозитория превышает этот лимит и естественно мы ходили по ребятам говорили зачем вам столько веток Ну например есть репозитории которым нужно больше чем 250 лет например там тепло они с каждой новой версией для каждого версии нужна отдельная ветка и для таких репозиториев мы внедрили вайт-лист то есть мы имеем в отли- вайтлист репозиториев которые собственно говоря могут иметь более 250 веток Да и мы им установили какое-то ограниченное и ещё карточка просто автоматизация жира и вот именно переходов Это для разработчиков то только я просто имею в виду что у нас жира она чуть больше чем просто переход статусов то есть нас там релиз ноут пишутся ещё какие-то там вопросы для э-э развёртывания вопросов для тестирования А в данном случае разработчик Ну то есть кроме вот движений ничем не занимается в жире Ну конечно же нет то есть он активно пишет статус ипотеки там тогда ну автоматизация она ранчо ради автоматизации Ну то есть почему он лишний раз не может кнопочку нажать Ну просто Ну ещё раз у тебя может быть то есть многие люди живут по спринтам очень много тики там да и это упрощает просто жизнь разработчиков То есть ему не нужно думать Блин у меня сейчас дикие а семью или в inprogress типа Посмотрите мэра потому что как бы то есть ты сам понимаешь типа ты создала мир Ты знаешь что у тебя тикет точно находится нужном статусе а ты дальше Просто там в конце дня напишешь типа ну я сделал то-то и всё спасибо большое за ответ и передавайте назад Спасибо за доклад Подскажите пожалуйста как вы следите точнее разработчики следят за актуальностью до ветки в плане вот есть момент когда разработчик на неё встал и начал делать свою какую-то фичу а-а он это может неделю две колотить допустим что-то тяжёлая и она получается обратно это фича попадает в деф уже только после того как вливается в релиз что можно запустится и там увидели но за это время в Дебби могло произойти значительное количество изменений и мне кажется просто неизбежно конфликты вот на данном этапе Ну типа как фича редко попадает в релиз разработчик сам самостоятельно её вмёрзшивает и пример же есть там есть конфликты Они у неё локально появятся но когда релиз мёрджитцев Death Death мог уйти уже достаточно далеко от момента ответвления что соответственно в мастерстве А деф как Виртуальность то поддерживает то есть разработчик Сначала я хочу выливается Лев потому что на схеме там не было стрелочки из фичев вот я не очень вижу Ну соответственно Я так понимаю внизу чекаут находится с какой-то ветки и потом идем по фичи ветки и дальше вверх таким ободком а начинают разработчики С какой ветки свечи ветки спиче ветку От чего ответят от мастера от пачкаешься от мастер то есть мы утверждаем что мастер актуальные изменения он создает фичу ветку от мастера начинает разрабатывать потом как только разработка завершена Спасибо вот пожалуйста слева Здравствуйте спасибо доклад за доклад и я хотел бы немного разобраться с вашим Flow для stagex стенда можно на слайд вернуться да конечно На какой А вот где пайплайн для staging окружение вот отлично хотел понять почему у вас чека врач это считается диплом грубо говоря и я не увидел смог тестов То есть как понять разработчик что у него все хорошо после диплома смотри изначально мы предоставляем Давай сначала про тесты скажу изначально мы предоставляем разработчикам только с юнитами там смог тесты разработчики добавляют самостоятельно там легко инженеры добавляют их самостоятельно все зависит от того нужно ли разработчикам там какой-то интеграционное тестирование и так далее У нас есть шаблоны для использования там смог тестов и так далее но мы предоставляем Здесь изображен только дефолтный а уже потом мы предоставляем дополнительный которые могут накатить там и отправка информации валюту У нас тоже есть просто как бы базовый который мы предоставляем цветочком Вот это первое и второе чекове Rage Почему на Stage diploy на самом деле это сделано там из-за низов это из оптимизации timetamarket тут блин к сожалению у меня просто нету этих зависимости потому что их очень много и я просто на слайд они не очень хорошо поместились но в целом это сделано для оптимизации Маркета Вот если бы я на отдельный Stage перенес там немножко бы всё замедлилось вот как-то так понятно И можно еще вопрос по поводу смог тестов А цель вот вашего отдела это какое-то способствование соблюдение стандартов разработки в компании или нет то есть Почему разработчик сам решает когда ему запускать тесты почему это не закреплено где-то что ты вышел на Стрижем проверить что ты не сломал здоровенный стенд собственно говоря чем занимается наш отдел наш отдел и занимается предоставлением удобных инструментов автоматизации процесс вся сиди А по поводу того почему он должен запускать тесты Нет я имею в виду что допустим если одел девапса следит за циклом разработки программного обеспечения в компании соответственно есть какой-то наверное стандарт Которому все должны придерживаться потому что вам как divopson придется это контролировать весь зоопарк соответственно Вы можете сказать что у нас есть тузы для запуска самого тестов но запускать их надо сразу после диплои называем их смог тестами грубо говоря да Ну смотри по поводу тестов Эта история только у нас интегрируется Мы пока разработчикам предоставили предоставляем шаблоны для использования различных тестов там смог регресс пока просто предоставляем и разработчики пожеланиях используют но может быть в будущем это действительно станет снова как стандарт вот как как разрабатывали и действительно все команды уже будут писать там смог тесты и запускать их на том стриже на котором мы им скажем Окей понял спасибо большое вот там микрофон у кого справа в конце слева Данил Спасибо большое за доклад очень классный такой плотный понравился очень ты вначале говорил что у вас около 4000 сервисов диплоиться в проде хорошо сервис уже работают не изолировано друг от друга между собой как-то взаимодействует вчера про взаимодействие сервисов это статья наверно отдельного доклада здесь все-таки больше про себя я понимаю Да мой вопрос как раз с этим связан То есть вы при диплои как-то информируете Помогает ли платформа как-то информировать разработчиков о том что продукт их вышел на провод то есть чтобы потребителей можно было уведомить насколько я знаю смотри у нас есть во-первых механизм оповещения в чатиках то есть с помощью Вот как раз таки нашей инфраструктуры мы можем не только информировать там о движении тикетов но и также мы можем отсылать ноотисы в там разработчик может сам настроить Какие Нотис он хочет отправить себе в чатик естественно там если есть какие-то сервисы которые взаимосвязаны друг с другом Да э-э и одному сервису важно знать что сервис B изменился Вы можете просто там в чатике написать там релиз бы за диплоился И также у нас есть ещё фича э собственно говоря а Хмм Если вдруг два сервиса у нас взаимодействие с происходит gpc да И если а-а один сервис А сервис А завязан на контракте с сервисом б Вот мы предоставляем фичу которая То есть если вдруг контакт два поменяется вы об этом не знает всё сломается Мы предоставляем фичу собственно честно говоря как только происходит изменение протофайла сервиса а при создании мертвой Квеста мы Добавляем еще одну группу опроверов и в этой группе будут овнеры сервиса B чтобы они посмотрели не разломать или контракт и МР не будет заправлен Пока ребята сервиса B не скажут Типа все ок у нас все нормально работает конфигурациях в этих учтены вот эти зависимости и уведомления да да уведомление смотри уведомления по дефолту мы предоставляем но разработчики уже сами решают настраивать уведомления или нет то есть они забивают в какой чатик они хотят получать уведомления уведомления о чём они хотят получать и так далее да спасибо так пожалуйста Спасибо доклад такой вопрос по поводу автоматизации джера Правильно я понимаю что проставление версии не используете потому что у вас сервисы никак к проектам Джерри не привязана то что большое количество то есть у тебя может быть бардак жира и у тебя там типа десятки сервисов да то есть Поэтому просто то есть для автоматизации релиз но что-то ваше дело делает или это уже ответственность продуктовых команд фичи команд Здравствуйте спасибо за доклад У меня вопрос тоже связанный с джирой А как вы боретесь в эпоху как бы санкции Ну жиры То есть вы какие-то навык нашли или как-то к сожалению не могу ответить на вопрос потому что администрированием жира занимается вообще соседний отдел я не в курсе Понятно спасибо лайфхак такой находишь кого-нибудь из старых Яндекс и спрашиваешь когда у них жира не стало хватать и в принципе Часа через полтора вы освободить еще вопрос от лицензии на gitlab Как дела тогда мы сейчас активно переходим с приватной лицензии на бесплатную я к сожалению не знаю какой сейчас там процесс но вот этот Flow он не зависит от лицензии Red Lab и этот Flow работает может работать на бесплатной лицензии друзья в 15:50 здесь про дыры Open Source будет разговор Сейчас надо выбрать кому подарим два рюкзака для Победы принёс За какие вопросы рюкзаки то здесь да кому мы Кому мы давай вспоминай так вот кто Тебя зацепил Да паренек в очках способ получить про тесты про тесты Мне тоже понравился вопрос хорошо тебе тоже тебе тоже памятный приз от от конференции друзья спасибо большое сейчас спикер э вместе Это тебе я говорил быть не страшно Вот где флипчарт это Зона зона вопросов ответов всё что не успели Да Спросите там Ну и берегите друг друга"
}