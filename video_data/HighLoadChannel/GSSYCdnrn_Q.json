{
  "video_id": "GSSYCdnrn_Q",
  "channel": "HighLoadChannel",
  "title": "Масштабирование OpenAPI в API-first-компании / Максим Лапшин (Flussonic)",
  "views": 382,
  "duration": 2885,
  "published": "2024-10-29T03:08:37-07:00",
  "text": "так да Всем привет Меня зовут Максим Лашин я директор компании видео мы делаем видеостриминговый софт уже очень давно и Че длительного времени мы внедряем у себя Open как раз сегодня я хочу рассказать про наш опыт работы с Open кто-то Возможно с этим уже знаком кто-то у себя внедряет в компаниях кто-то с этим сталкивался так или иначе Т сразу чтобы было понятно м ИТ ре Т Так а у нас не листается можете починить пожалуйста мне нужно Да значит о чём я сегодня буду рассказывать во-первых что такое просто для тех кто слышал но не знает или первый раз слышит какието техе того вать инструментарий под наш рост и самое важное что за гуманитарная идея находится под этим инструментом потому что на самом деле это самое важное что есть про Open это именно то как как это помогает общаться людям чтобы было понятно сейчас у нас есть один моно репозиторий на всю нашу компанию он довольно такой среднего размера Это 1500 файлов которые разбросаны по по всему репозиторию это 64.000 строк кода с разными описаниями моделей данных структур а-а которые у нас есть и 51 Таргет на сборку То есть это 51 51 IP которое генерируется из того что мы делаем И то это 50 51 договорённость о которой мы договариваемся с клиентами наружу значит э что сейчас дальше будет Да вот какие-то ну чтобы просто было дальше понятно как мы будем двигаться во-первых Open Up - это на самом деле э прежде все не техническое средство А язык на котором договариваются люди он очень странный он очень технический Но это язык договоренности между людьми и только потом уже с компьютерами значит корак которая является важнейшей штукой у это соседняя гуманитарная идея которая опять же является тем как люди должны договариваться друг с другом Ну и без него строить систему крупные системы просто невозможно значит дальше мы посмотрим на то как получается кодифицированы ТЗ потому что это очень важная а кодификация - это вообще такой большой тренд всего нашего десятилетия последнего Да кодификация админов кодификация того кодификация сего Чем больше мы кодифицированы репозитория раскиданы СХ разных проектов как мы версионирование описаны http IP endp с этого всё начиналось в них описаны структуры структуры данных совпадают по описанию с J схемой то есть описано вот тут объект у него такие-то Поля это поле string это поле integer такие-то ограничения всё это описано в этих яль файлах после чего к этому сбоку лежат библиотеки для валидации всего этого это почти все библиотеки написаны на ноде то что было на Джаве оно практически не работает и из этого из этих файлов код генератора для сервера для клиентов или для чего-то ещё что потребуется Ну и сбоку всего этого J схемы валидаторы которые тоже рядом используют то есть Open в принципе сейчас J схемой пересекается и пользуется ей как инструментом Вот это техническое это то что вы видите на сайте Open в котором зайдёте увидите там вот такие будут вещи написаны это всё описание инструмента Прежде всего это гуманитарная идея прот это соглашение между людьми о том что до первой строчки кода мы договариваемся о том что это будет за система это очень важно Это очень похоже на В каком-то смысле на водопад может показаться вот такой прям старый когда мы сядем всё продумаем Нет это не так это нельзя путать с водопадом это не про водопад это именно про то что сначала мы договариваемся о том как конструкция выглядит снаружи только потом лезим внутрь начинаем ковырять детали и вот как например мы этим пользуемся если мы хотим любую систему поменять Точно также мы сначала идём в схемы Мы сначала меняем схему этой системы то есть схема схема какого-то продукта какого-то софта это то Как оно выглядит снаружи это его IP значит и тут у нас возникает Open как Контракт потому что у нас контракт First Значит надо на каком-то языке написать контракт можно написать большой Талмуд в нём будет текстом написано описание системы описание чего-то такие Талмуд Я видел но я ни разу не видел чтобы они были допи до конца чтобы по ним что-то делалось Ну у кого-то может быть другой опыт классно конечно но вообще Талмуд написанные текстом в родовом файле они программистами по-моему не читаются в принципе потому что ну просто программисты Word не открывают И всё И зачем это читать если там ничего хорошего не будет всё равно вот а Open - это такой вот получается такой компромисс потому что он достаточно прост для чтения в отличие от какого-нибудь XM Да программистам уже доверились сделать человека читаемый xml они сделали xml человека читаемый получилось хорошо вот и Но с другой стороны он достаточно однозначен чтобы быть машино пригодным То есть это важно получилось найти такой срез который и читаем глазами человеком причём не программистом и читаем машиной вот Он позволяет описывать будущий проект вот не погружаясь в детали что это очень важно если например сесть с если дать при обсуждении проекта свободу программисту он сразу полезет прям в самые в самые кишочки и будет закапывать в деталях на самом в старте А если дать всё описывать людям которые далеки от программирования они скажут Ну там в общем там как-нибудь сделайте и там что-нибудь будет понятно там разберёмся Ну в итоге получается не не такой не такой вариант перекоса он не приводит к результату а здесь мы видим как оно реально работает Ну например да что мы вот реальный кусок кода когда э программист пошёл сделал у нас кусочек кусочек openup схемы и радостно из своего ста вытащил тип н 8t говорит вот вам Пожалуйста посмотрите с этим вам надо уметь работать Ну что здесь получается что программист просит не программиста разобраться в новом концепции под названием 88t она не нужна это ошибка так не надо делать Вот так так мы не делаем это как раз про то как сделать xml даже из Open как в реальности происходит например в нашем случае работа с опе именно на стыке разных людей а мы например описываем такую вещь как ширина Ну там чего-то да А у неё есть тип Ну чтобы договориться да ширина у нас идёт это строка это Flat или integer вот дальше если программисту сильно нужно Он вписывает туда свой формат Ну потому что ему это нужно для кода генерации ну нужно человеку чтобы там был где-то н 8t Пускай это будет никто его здесь по рукам не бьёт и самое важное что здесь ещё возникает работа а тех писателя То есть у нас например тех писатели начали работать в Ну мы не смогли затащить их в код чтобы они из кода генерировать какую-то коде код документацию А вот по схемам получается очень хорошо самое важное что в отличие от обычной документации которая никак не Валиди и никак не сопоставляется с реальностью здесь у нас получается что когда у нас документация лежит возле схемы возникает хоть какая-то хоть минимальный вообще механизм сопоставления документации реальному коду Потому что когда вот это поле запт и выкинут его удалят вместе с документацией и больше следующий Клиент уже не будет ходить на старый устаревший кусок документации и говорит ребята Аче вас здесь написано что оно работает а этого больше нету И оно удалится сразу же вот это вот как бы других способов состыковать у нас честно говоря толком не получилось значит как это всё у нас работает технически значит яль файлы валяются как я уже говорил это стандартная стандартная веь для репозитория если пойти посмотреть Да значит вот вот эта вот конструкция вся у нас выложена на github мы подготовили выложили на github в конце будут ссылки Потому что некоторые технические вещи я сейчас буду скомкано опускать Ну чтобы не устраивать здесь чтение кода вслух а можно пойти посмотреть как у нас это сделано со всеми деталями Это рабочий репозиторий выложен и можно пойти взять значит Да дальше я фай засовываю в из делает J потом это пихает в валидатор это большая конструкция которая очень важна для всей механизации от этого ipf процесса ну после чего как правило бывает красный МР это нормально мы пользуемся лабам в нём естественно пихает Лин Ну пихает валидация в мерш реквесты если оно не прошло оно красное пока оно пока оно не позеленело к коллегам носить это рановато То есть это понятное правило вот дальше есть небольшой постпроцессора баты то есть нам не хватило мощности Open мы сделали небольшой пост процессинг я сейчас про него расскажу и получается один GS файл Только в нашем случае это 51 разный json файл для разных систем А из него дальше в одну сторону документация на сайте готовая А в другую сторону как раз процесс засовывая в проекты в те софти которые пользуются этими схемами и здесь есть разные подходы мы выбрали тот при котором по какому-то Ну по какому-то расписанию сам репозиторий всасывает к себе новую новую схему которой он должен отвечать то есть схема превращается в контракт после того как она уходит в Мастер контракт подтверждённый всеми кто Находится в компании так или иначе стыкуется с этим и когда она уходит в Мастере с этого момента считает что проект должен ей отвечать также мы принимаем что в принципе можно самые свежей версии схемы Ну не очень отвечать это тоже нормально Мы считаем что это как бы ну схема всегда может капельку обгонять реальность Вот Но как с этим быть Как же теперь стыковать с кодом Значит тут у нас когда мы с этим ста когда мы начали с этим работать в каких-то проектах у нас было сразу кодо генерация А в некоторых нам коллеги предложили сказали у нас Т классный язык программирования у нас всё классно мы сделаем генерацию по коду схемы значит генерация по коду не работает вообще это зло это обман в ней нет ничего хорошего причина очень простая когда человек генерирует по своей программе её формальную модель описание опи он не знает как он поломает зависимости других вот он пошёл и убрал какое-то ненужное поле которое стало ненужным оно действительно глупое Ну случайно его добавили не подумали он сделал Хорошо он сделал правильную вещь Он одно поле удалил другое переименовал всё стало у него нету технического способа узнать кому он сломает жизнь после этого но когда он прол все этапы Всё значит выкатил новый релиз оно разъехался и коллеги по компании или из других компаний говорят Ребята а что у вас всё сломалось у вас было нормально всё стало плохо Вот и при генерации по коду нет никакого технического способа нормально понять что ты что-то сломаешь когда у тебя идёт генерация по схеме но ты моментально узнаешь что ты что-то собираешься сломать людям Ты просто моментально это видишь уже нужны более сложные договорённости значит когенерация по схеме у неё тоже есть альтернативы можно не кодо генерацию А можно чтобы программист смотрел глазками в схему и аккуратно руками мы выбрали именно кодо генерацию по схеме потому что для меня как для директора компании это гарантия того что в каждом проекте У нас есть кто-то кто вот следит за такими вот ошибками людей теперь про про кодо генераторы К сожалению их рабочих Толком вообще-то я и не видел значит мы перебирали разные вот я не нашёл ни одного рабочего и мы везде просто брали для каждого проекта это A Rust Go Си Ну то что у нас компании используется рельсы везде Просто писали сами своё 2 дня работы и Вопрос закрыт А с чужим генератором возиться - это Мама родная Вот и что здесь очень ярко подсвечивается это важная штука да Опять же гуманитарная составляющая договорённости технические договорённости на словах они не работают То есть можно сколько угодно о чём-то собираться в переговорки тратить рабочее время вместо дела на разговоры в переговорки о ЧМ договариваться после чего всё это ментально выветривается когда человек погружается мы невнимательны мы ошибаемся Поэтому если есть возможность не договариваться устно договориться технически это всегда нужно а на словах оно не работает что мы собственно говоря и видели с вот там без кода генерации значит почему я сказал что проблемы с кодоева Да прежде всего у них проблемы честно говоря Они все такие они все пря придуманы наве то что я видел это прям вот jav такая jav Вот она вот у людей в прям в подходе к миру значит генерируются какие-то здоровенные штуки какие-то здоровенные монструозный конструкции которые куда-то должны вставляться как-то делаться А через те паттерны которые были популярны в девяностых э всё это довольно печально Особенно учитывая что на всех языках программирования количество разных даже просто хттп веб-сервер и фреймворков оно огромное подо всё не подстроили людей в этой инфраструктуре что подо все эти варианты сделать значит Поэтому просто получается что-то нерабочее но это не проблема а что с клиентской частью которая ходит по Open куда-то вообще говоря этим всем можно не пользоваться можно жить без генератора вы пользуетесь ежедневно разными Open ресурсами даже не заморачиваюсь наличием там схемы вы просто дёргает кулом что-то в скрипте и всё оно у вас работает и вы не парите о том что там что-то сломается лампочка вас Завет но можно пользоваться всем богатством Open и тогда уже необходимо пользоваться всей жёсткостью схемы вот с клиентскими лими всё лучше их проще делать там прям сильно проще Ну и самые хорошие они на Ява скрипте под браузер вот там прям всё классно и весело А на остальных языках программирования Ну учитывая что у нас в принципе из всех языков программирования нормальный ТП клиент есть только в Ява скрипте в браузере во всех остальных его просто нету из коробки то наверно в этом как раз и связано что где-то какие-то варианты неплохие но самые хорошие они на Ява скрипте выглядит оно получается в хорошем варианте выглядит вот как корба в её лучшем виде но только она работает в отличие от корб А как же мы живём если коды генераторы нужны а их нету вот какая-то тут такая лёгкая шизофрения да да ничего страшного берём node.js берём Jon файл про который я говорил Таргет сборки целевой он примитивный Он простой и пишем скрипт который просто берёт и поэтому код гнет просто по каждому эндпоинт создаём Файлик в котором заполняем какие-то поля функции генерируем его а и получается автогенераторе пози торий А почему э такая вот Костыль ная конструкция может показаться как-то странно что-то файл Там руками генерить ведь есть же такая интересная штука Как очень интересненько написать на Мета программировании те кто писал на рельсах они знают как там весело классно писать на вот ть функцию которая генерирует другие функции а а ещё вот тот кто отлаживать Как это на самом деле весело отлаживать и как это весело читать и искать в этом баге поэтому мы от этой идеи отказались у нас просто всё это ложится автогенератора автогенный код который можно просмотреть глазами человека отладить посмотреть что ну что что там пошло не так соответственно в в репозитории точно также у нас есть вариант проверить о том что то что у нас лежит оно всё оно по схеме соответствует ей не соответствует ей наличие автогенератора целиковый МР от робота его робот делает и там нет никакого ручного кода то есть мы знаем что есть пачка мров которые сделаны роботами и никто их не точно там не точно не было работы человека Теперь давайте про кодификацию упоминал и почему это важно значит когда мы договариваемся с человеком голосом это жжёт огромное количество нашей наших сил нашей жизненной энергии если мы хотим построить большую систему У нас есть огромное количество вещей которые надо обсуждать что будут за данные что с ними делать как они будут доставляться обрабатываться кто за это отвечает как это внедрять но если мы на самом старте нам об Том пробелы стоять или табы то мы с радостью сожжём всю нашу энергию до того как мы подойдём к самому интересному что наверняка многие из вас наблюдали на как бы в начале проекта на переговорах когда начинается проект какие-то переговорка мы что-то обсуждаем весело Классно а пом по что уже всем вот это вот вот так вот ничего не двигается А мы собственно говоря не подошли ещё к интересному Ну я по крайней мере такое наблюдал не однократно договорённости голосом они особенно если мы говорим не про задачи А про средства Они вообще скандальные конфликтные и их и в офисе это тяжело бывает вот тяжело собраться поговорить А на удалёнке когда мы лишены половины возможностей вообще нормальной коммуникации там всё ещё хуже ещё сложнее и мы получаем неприятную ситуацию что люди боятся заходить в конфликты это вообще кстати частая история А хороший менеджер должен заходить в конфликты чем он выше уровнем тем он быстрее лучше заходит в конфликты А ну программисты традиционно в конфликты не любят заходить вообще Потому что это не приятно это это тяжело это усилие это надо кому-то пойти сказать в лицо Что Василий я с тобой не согласен А вдруг он вдруг он отреагирует на это негативно Я же буду тогда травмирован значит в итоге получается что что люди вместо того чтобы судить острые проблемы они уходят от них и просто их сглаживают как будто бы нет выстрелят потом кому-то ещё а значит и вторая проблема что принуждение коллеги к соблюдению договорённости - это опять конфликт если мы о чём-то договорились Или например вот там Василий У тебя красные тесты Почему ты мержи с тестами которые покраснели я потом всё поправлю потом всё будет хорошо ну как вот Василия обвинить во лжи о том что мы знаем что он не будет ничего править никак тяжело это поэтому тут и возникает кодификация когда это Василию не сосед его по офису а робот говорит Василий пока у тебя тесты не позеленеет У тебя кнопка мерч не загорится вот если это говорит робот то с роботом Василий не спорит поэтому любая кодификация чего-либо она снижает трату количество трат Вот вот жизненных наших сил на эти обсуждения в опе Это очень хорошо видно по тому пласту валидации которая в НМ есть значит Какие проблемы снимают валидации в опе вот экономия нашей силы Ну есть простые базовые вещи Да мы банально можем расписать где Какого типа Поле из свежего У нас есть система которая выстреливает события из видеоаналитики мы придумали офигенную вещь а давайте значит для идентификатора события возьмём четырёх битный инт у которого первое 32 бита - это будет текущий тайп Ну там или побольше там миллисекунд тайм а потом какой-то Рандом такой вот Обычный snowflake ID А ну всё классно Только у нас теперь бегает человек из фронтенда и говорит ребят у меня в JavaScript не влезает в четырёх битный инт там нельзя мы говорим Ну сорян у нас был этап обсуждений был этап переговоров ты его пропустил пожалуйста как бы сейчас никто под тебя править это просто так не будет выноси это обратно по процедуре на общее пересмотре и давай думать как нам теперь везде поменять in на string или как те Жи с этой штукой дальше Конечно же мы выберем последнее потому что ради одного менять всё остальное не нужно и здесь снимается Это всё потому что если бы у нас не было такой такой договорённости тот человек мог просто пойти и везде поправить где может на строчке и типа тут строчки тут инты тут в одном ме месте у нас облась мы привели па в другом месте Там ту string и всё было бы вот такая вот кашица которая в которой превращается любая незваная штука что ещё бывает самое такое приятное и конфликтов - это по Ну кодовый стиль Да как нам Множественные имена не Множественные имена сл Case Snake Case вот это все эти вот эта вот мелочёвка которая так бесит программиста который видит чужой код Ну кто кто прогул тот знает да что вот если ты привык к одному а тут коллега берёт и в твой репозиторий вкатывается что-то в другом стиле Ну это прям это прям личное оскорбление и это Понятно Потому что это ну такая вот составляющая есть а здесь это всё убирается роботу Ты просто выставляешь по всей системе говоришь будем делать Вот так и у нас по всему по всей компании будет вот так никак по-другому И всё дальше пожалуйста выноси это на общее обсуждение и вот всех коллег убеждая о том что надо взять и поменять Вот это здесь всё Ну конечно это делать никто не будет если там нет прямо сильной необходимости А значит Ну и всякие есть прочие вещи которые мы мы например у себя доделали Ну например если у поля есть подчёркивание каунт в конце то это только integer вот ну не может быть там не не integer потому что если у тебя там string Наверное ты в принципе что-то неправильно делаешь потому что пускай клиенты все приучаются к тому что у нас что-то coun - это должен быть интеджер довольно Логично но как мы выяснили Бывает не всем такой логично иногда там появляются строки флоты что-то ещё вот и это всё получается а снизить Этот уровень бардака и конфликтности на на потом Ну который потом возникает значит по технической реализации Я был очень сильно удивлён увидев шикарный набор валидации у IBM клауда Я честно говоря вообще не думал что эта компания что-то ещё программирует учитывая что я про неё знал и слышал но как оказалось они Молодцы и меня очень приятно поразили у них очень хорошая вещь Ну и Платовский репозиторий тоже а очень шикарный набор настройки валидации это также технически всё это в ноде JS каких-то J файлах валяется вам из коробки поставляется здоровенный список дефолтных настроек с которыми можно жить что-то мы выкидываем потому что нам не нравится вот что-то добавляем свои меняем валидации как например стандартные Вещь это изменение Ну мы пытаемся у себя например сделать чтобы у нас во всех проектах компании были одинаковые ошибки эррора вот Ну так это работает теперь про морето а почему это важно Почему прежде всего мы увидели такую штуку что моно репозиторий позволяет людям из разных языков программирования из разных команд из разных проектов говорить об одних и тех же сущностях одинаково Вот у нас есть например такое понятие как видео сри Вот он есть у нас и на AP камере он у нас есть на транскодер на аналитике и ещё на пяти системах и у всех этих людей у них вот если их посадить по отдельно по комнатам у них будут разные вещи Например у тех кто делает систему видеонаблюдения у них у стрима будет ТСП ул и ТСП ул secondary второй а у тех кто делает видеостриминговый сервер у них будет просто набор инпутов у которых могут быть тспт какие-то ещё вещи и если Эти люди не будут синхронизироваться то когда они пытаются состыковать у них будут проблемы они будут говорить блин оно не стыкуется вместе Ну вот Они реально одно в другое не вставляется я сейчас привёл очень маленький пример на самом деле проблема бывает гораздо сильнее Аа и для того чтобы это работало у нас прямо правило что надо прежде чем кидаться описывать объект с нуля иди посмотри Кто из коллег такое уже описывал возможно тебе лучше рею зать их понятие этого объекта даже если оно к тебе чуть-чуть не очень подходит лучше подстроиться под соседа или с ним договориться чем иметь совершенно разное описание то есть лучше будет чуть-чуть немножко не стыковаться с тобой но можно потную несовместимые сущность вот в итоге у нас есть единый единое написание единый язык на котором мы обмениваемся между командами Мы реально можем на одном языке с ними говорить вот и из одно ещё есть документ что когда у тебя файл описа описывается в используется в разных проектах то тебе чтобы что-то добавить надо пойти и с ними со всеми поговорить Это добавляет проблем для добавления новых полей Это хорошо потому Чем меньше вот в контракт люди пихают чего-то тем больше они думают а так ли надо идти и вот об этой штуке договариваться Точно ли я хочу вот это этим грузить других людей если мне пять коллег сказали что это делать Не нужно Ну наверное клиенты тоже примерно такой же мне скажут если я это втащу сюда Хорошо я пойду и подумаю Может быть вообще этого делать здесь не нужно вообще обойдёмся без этого технические детали про репозиторий с ним с ним всё плохо оказалось потому что Open не пригоден для вот инструментарий Open не годится банально для того чтобы можно было сделать 10 каталогов и в них вот разные разные компоненты схемы валяются в разных файлика значит там возникает проблема с тем что ссылки зависимости просто разваливаются рассыпаются мы это всё переписали с нуля и валяется в репозитории можно посмотреть значит в чём проблема Когда у нас один файл ссылается он ссылается на файл из другого каталога Тот Тоже на кого-то ссылается В общем зависимости получается Они не резвятся не может найти нужный файл мы это переделали теперь у нас всё классно работает кроме одного в всяких ВС кодах Ну не так всё классно не так всё красиво потому что в простом варианте репозиторий Open он в всде хорошо читается в том как у нас он перестал читаться но что важно Т мы пошли е доделывать прото сос который у нас есть это понг из-за того что у нас один файл находится в разных проектах возникают такие моменты что некоторые Поля не везде нужны и в Open нет такого вот incl то есть включение по условия мы добавляли сами Ну например у нас На одном сервере у стрима нету поля сме hostname А в системе оркестра серверов это поле возникает потому что знать на каком сервере это поле этот Стрим живёт упрощая Ну вот примерно такая задача соответственно мы добавили ряд опций которые они в принципе наши приватные они для Open прозрачные незаметны он их не видит мы их потом дорси выкидываем удаляем это X scope и xow соотвественно X позволяет сделать следующую вещь он говорит что вот это поле оно видно только в этом и этом проекте в этом и этом таргете сборки Ну а X позволяет сделать следующее что когда мы хотим сделать срез какой-то небольшой то мы указываем Какие Поля из этого объекта вот в этом проекте будут видны Ну о чём здесь речь о том что на самом деле Open при все простоте Может вам не подойти Он простой в этом нет ничего фатального потом можно пойти добавить какие-то поля которые вы сами проинтерпретировать Ну что с ними до сделаете на выходе получите валидный Open который Вам устраивает проверкой всей этой конструкции Для нас стал возможность создания фронтенда до бэнда такая вот классическая история до этого до того как мы внедрили у се опе у нас была прям обычная для такого для ну для бардачке А с этим хорошо прогнать все все все тесты фронтенда потому что мы не знаем что там отломалась на фронтенде после этого Вот ответственно доработка на фронте могла идти только после того как мы на бэнде ВС Сделали что-то как-то Сделали точнее потому что мы не знаем что мы там сделали У нас же нету схемы у нас нет проекта по которым мы делаем Ну схемы по которой мы делаем Ну при переходе на Open у нас теперь есть схема фронтендер начинает работать смо сервером сразу же делает это гораздо быстрее чем Потому что у нас н не очень сложный и за несколько месяцев до того будет готов уже в которого можно делать документацию даже можно даже показывать клиентам и даже покликали всё хорошо кроме того что кроме МОК сервера А значит да и соответственно наши экзампл которые там же лежат в схеме они у нас используются в ответах МОК сервера МОК серверов для Open тоже Готовых нет А есть буквально парочка они примитивные никуда не годятся если честно тоже Ну курам на смех точно так же где-то за неделю мы написали код выложили Пожалуйста можете брать пользоваться смотреть переделывать под ваши под ваши нужды значит наши фронтенде я я насильно заставил фронтенде пользоваться МОК сервером теперь их оттуда не стащить они даже вот начинают сразу чем будем там пользоваться эндом У нас вот есть мы лучше доработать на МОК сервере чтобы вот у нас было по контракту это сечас очень важная штука то есть у насва два отдела друг от дру ста зави у них нет больше прямой зависимости нет такого что одни других ждут да Значит даже используется письма для генерации скриншотов пожалуйста это можно и чему Мы здесь научились опять же прогу монетарные идеи мы поменяли лексикон мы поменяли лексикон с которым отдел общаются друг с другом до этого у нас было КАТО простая вещь либо сервер нарушает контракт либо нэнд нарушает контракт либо все его соблюдают но контракт нам не оказывается не нравится он плохой Давайте поменяем контракт потому что вроде бы всё нормально но на выходе плохо уже просто по каким-то человеческим соображения Давайте менять контракт и уже все будут его выполнять как только получается загнать всех в вопрос А что собственно говоря нарушено там столько сразу возникает мыслительной деятельности которая раньше не велось это даже вообще удивительно а Так что с этим классно работать теперь прошли про версионирование это очень важная штука про которую я говорил с самого начала что происходит когда мы хотим доработать нашу наш наш софт доработать нашу схему доработать нашу систему значит я искренне считаю что сенк vering - это Химера она может быть работала когда-то когда люди То есть это Химера времён компакт дисков когда был очень чёткий цикл полтора года что-то прога через полтора года начинается значит в ужасе а хаотичное судорожное засовываю софта чтобы оно скомпилировать с компири это всё на болванку прожигает значит отдаются на завод завод делают болванки напечатают их рассылают по клиентам после чего начинают судорожно расовые на дискетах догонять пач версии то есть симан вершник возник оттуда а в современном мире он не работает и это обман А почему обман потому что у нас не бывает такого чтобы мы взяли и клиента сразу перетащили вот вам новая сотина Вот вы ей пользуетесь ну это издевательство мы все по чуть-чуть потихонечку стараемся все хорошие проекты меняются по чуть-чуть инкремента что-то новое добавили А вот новое Поле В А вот новый метод в Попробуйте новый метод вам понравился не понравился хорошо мы его убираем переделаем понравился все довольны всё хорошо теперь у нас входит в основную поставку продукта можете им пользоваться а вот этим уже Давайте не пользоваться потихонечку Давайте отмирать То есть все современные продукты которые нормально которыми можно пользоваться они пользуются на самом деле не симант верш у них просто есть календарь по которому они работают поэтому Севе не работает а отсюда значит что что история про вот у нас IP старая вот у нас IP версия 3 вот у нас версия четыре оно не работает Я даже помню доклад Яндекса где-то наверное Ром Может быть ты помнишь году в десятом о том что никогда не бывает дальше чем AP V3 вот у вас в AP V3 последнее что бывает в любом проекте что дальше уже нет сил людей перетаскивать а на самом деле даже AP V2 мы знаем что это как правило последнее дальше Просто потихонечку начинаем по чуть-чуть менять потому что всё столько уже людей этим пользуются что перетащить их всех с V2 на V3 Ну уже невозможно значит Есть такой сайт ha.com если вам интересует история про вот вообще про Contract First пожалуйста его есть блог там стоит прочесть от и до это ведёт его человек из убера он прямо вообще он крутой и у него описано как раз про Evolution мы вот полностью его придерживаемся новое Поле добавили пометили его как Privat чтобы кому-то показали посмотрели Нравится не нравится правильно не правильно легло не легло Если всё хорошо мы снимаем с него прайт даём описание теперь это наш контракт Мы его обещаем если нам какое-то поле нравится перестало поле метод Мы ставим указываем чем теперь вместо этого пользоваться в пшене и ставим ему это ничего не значащееся в котором мы это удалим то есть клиенту мы извещает к этому к этому месяцу надо будет что-то на что-то переехать как это всё читать лас с этого Open это раньше был свар но свар очень плохо и болезненно воспринял приход комьюнити Когда пришло комьюнити сказало свару Ребята у нас теперь комьюнити у нас другая картинка развития давайте вы теперь врай в то как мы видим развитие вашего продукта они это восприняли болезненно и у них своё видение Open 3 например версии 3.0 вот это там свар Open а комь ушло в другую сторону Ну Сва К сожалению мы его по сути лишились мы взяли более симпатичный рядок простой понятный инструмент который нам ясен делают его ребята из Львова как оказалось Наверно Наверное не поэтому они отказались от всех наших в патчей к ним вот наверное потому что это пересекалась с их платное версии потому что у них есть бесплатная версия на гитхабе есть платная версия не на гитхабе и вот какие-то фичи которые мы им портировали они сказали что они их не могут потому плат верси это обычная история прое проекты вали ККУ это как раз вот тот самый Del чтобы клиентам было видно когда оно будет удалено Вот это поле groups оно планируется к удалению вот оно помечено уже как удалённое и сказано когда это будет удалено ответственно клиент на своём валидаторе на своём вот этом вот на своём нере а кодо генераторе может пойти и что-то здесь проверить у себя чтоль и ски на конкретное полем документации чтобы можно было конкретное поле когда у тебя портянка из 100 100 полей в объекте то где-то там искать кого-то Это совершенно нереально значит где ещё мы используем Open у себя Кроме Джейсона Ну когда у нас есть микроскоп то всё кажется гвоздями поэтому мы Open используем для текстовых протоколов тоже прометеус У нас описан через Open hls - это m38 формат тоже через Open Почему Да потому что это удобно мы знаем Какие данные туда будут отдаваться У нас есть договорённость сверху донизу везде и даже если оно не лидирует сним данны одни и теже т это вот такая тоже важная мысль которая нам заработала что у нас нету сейчас не хватает это наглядного дифа по джисона потому что когда у тебя куча ям Ну При таком пост процессинг становится неясно как оно потом выливается становится сложным это вот тот границ которой мы подошли нету Валида на удаление пое технически можно поле удалить И это просто на усмотрение человека а как мы знаем договорённости голосом работают плохо лучше кодифицированный 3.0 из 3.1 это нужно для того чтобы работали всякие кодоева у людей на Джаве Вот и свары всё это прочего Ну просто не не не делали этого но в принципе нам к этим обращались Значит есть полезные ссылки они будут в докладе они есть здесь это apis you W Hate а как бы очень важный важ важное хранилище знаний и наши два репозитория в которых у нас в одном патче кре доку чтобы показывать визуально документацию и собственно наш пример нашего Open демо это репозиторий в котором маленький срез наших схем это наш продакшн который мы вытащили наружу убрали из него то что вас не касается и оставили там то что вам нужно и полезно прежде всего почти весь Яри Примерно вот так есть ли какие-то вопросы будут ли какие-то Вопросы Спасибо большое вот уже на втором ряду есть вопрос Ага да нам нужен человек с микрофоном или два человека с микрофоном да стой вот прямо садись между с секундочку Сейчас микрофон заработает И к себе его вот так раз Да отлично есть Большое спасибо за доклад Я так понял что такой подход позволил решить вопросы с генерацией технической документации А задавались вы проблемой с синхронизацией с проектной документацией нет потому что у нас нет проекта У нас есть продукт у нас чуть-чуть другая история Значит мы какое-то время возились пытались добиться хотя бы того чтобы у нас вот та часть которая пишется тех письмен то Ну это ближе к тому что проектно документации чтобы там хотя бы можно было как-то привязать сказать что вот это вот э функция она от этого энпо мы пользуемся флинтом для документации это росттелекомов ся наработка в ней в принципе подобные вещи в зачаточном виде есть у нас туда руки не дошли нело Это не первый наш подход к кодификации документации потому что мы пробовали разные варианты вплоть до того что если у нас есть есть снипет например конфигурации чтобы онон тестом проверялся нерабочая вещь оказалась по соображением организационно человечески непонятно кто за это отвечает То есть у нас у нас нет выделенного прожект менеджера который бы отвечал за то что эта штука она отвечает за реальность как это сделать Я с радостью послушаю тех у кого это получилось как как кто-то с смог сделать так чтобы у него за документацию отвечал человек который Ну технически и ответственны реально отвечает за то что там написано правильно чуть-чуть ещё уточнить в догонку Потому что если не проектно документации но системы там согласования рассмотрения в док Фло тоже вы не устраивались а а у нас согласование рассмотрения прежде всего по схеме идёт То есть у нас для того чтобы какая-то фича какая-то какой-то кусок кода поехал в разработку он сначала будет проходить через этап схемы То есть у нас возникает тикет вма в котором выписываются задачи которые которые мы Для клиента решаем которые Он решает точнее что мы хотим доработать у себя дальше туда возникает request в схемы и мы начинаем его обсуждать Что ага нам нужны вот такие-то сущности такая-то обработка этих сущностей всё а а дальше документация уже едет ну так как такой ребнок Нелюбимый так Давайте вот там смотрите у нас 47 секунд и три вопроса давайте что-нибудь сделаем а вот да микрофон Вот раз потом два а потом Вопрос такой если Разработчики если какие-то там специалисты из бизнеса пишут ялы то Ну глядя вперёд сразу возникает вопрос Когда каких-то данных много когда мы пишем их руками Возможны ошибки А вообще подход к снаряду совсем не первый То есть раньше были там и там Oracle S и различные и решения там SAS Di А все они по сути кодируют объекты данных каким-то дополнительными гуида Ну чтобы не запутаться может чтобы можно было их выбирать А как-то вы э проверяете э ну то есть то что это разработчик пишет То есть он может ошибиться в букве где-то ещё но при этом в другом месте не совпадёт смотрите слева там АЦ справа АЦЦ там давайте давайте Попробую ответить значит э э Первое у нас Э я не очень знаю проблемы которые решает вот Oracle там кто-то ещё Вы говорите но на попробую попробую Попробую угадать О чём о чём идёт речь Значит первое я указывал про кодо генерацию то есть когда у меня кодо генерации есть на серверной стороне она мне даёт гарантию того что ошибка программиста она не просочится наружу то есть наружу из сервера выезжает только то что попадает под эту схему и это у меня гарантирует кодоева мы поправим эту ошибку перегрим всё и выясним все проблемы которые Там возникли и слушать на этот счёт программиста мы уже не будем если он там скажет что А я хочу вот так Ну очень как бы твои проблемы а не знаю сколько это совпадает тем О чём вы спрашиваете Вот и второе - это как раз то что у нас сущность это в одном месте описано То есть если у нас есть вот объект Стрим то он слева и справа в клиенте и в сервере он физически генерируется из одного файла поэтому он просто по по по схеме работы он не окажется здесь и здесь то есть не будет такого что здесь руками набрали стрим с маленькой буква а здесь справа написали руками см с большой буквой и они поэтому не стыкуются потому что у них классы разные этого не будет потому что они приехали из одного файла Ну может быть это как-то поможет на ваш вопрос Спасибо Так давай следу Спасибо И вот уже выдали микрофон зададим друзья а остальное в дискуссионной зоне Я здесь Да выйду и буду весь ваш Максим никогда не уходит До последнего клиента Да пожалуйста Да спасибо Олег ВК Cloud Бин два вопроса коротких первый вопрос на тему так если у вас там хттпс там всё понятно специфик специфике тов или если там jpc это первый а второй Да И вот как это выглядит может быть если коротко и второй вопрос на тему Вот вы помечает методы как Del Ну дату удаления А как вы это делаете если вот у вас есть Клиенты они например не собираются переходить вы просто молча просто обрубают значит перво по первому как быть с чем-то кроме простого ХТП запрос ответ вообще нормально потому что я сказал что мы и текстовые форматы описываем уж запихать это в ить какой-нибудь кого-то ещё с grpc не знаю сейчас не скажу Там могут быть какие-то нюансы А с потоками с ивентов очень просто мы просто говорим что у нас есть поле у нас есть метод который вращает ивент А дальше описываем какие ивенты они могут быть после чего описываем рядом уже здесь мы должны голосом текстом писать договорённости как этим пользоваться значит ко Open напе есть сосед в котором прямо описывается там Там есть описание для ивент систем но он не стал развиваться потому что оказался просто не нужен э по сути той той машинерии которая есть в опе в целом достаточно хватает и для других систем может быть не так жёстко и не так вау прикольно из коробки но чуть-чуть придётся где-то потрогать и чуть-чуть больше договорённости Вот таких э hog на месте но они опять же они потом вылью в код и они будут точно так же такими же жёсткими То есть например Все ивенты которые выплёвывают из нашей системы они все также описаны в Open просто как обычные А первое второе про dec deled А ну во-первых можно пойти к Гуглу и спросить ребята хотите пожалуйста мне вот Google алике на версию которая была у вас в январе она работала хорошо так следующая идея да э посмотреть что из этого получится тут номерок оставил А значит но у нас нет сервиса мы даём софт о prem люди его сами обновляют ставят Когда хотят вот да есть те кто обновляться не любит те кто считают что надо обновляться уж так это раз в 2 года Ну чтобы это совсем Вот пробрало вот А есть те кто обновляются гораздо чаще и у них Меньше меньше нюанси ков меньше проблем кому подарим сувенир конференции А вот мужчине с таким с неприятны Нет за самый неприятный Вопрос самый нет самый болезненный Ну а что что тут как бы да это больно да у нас это бо А у всех больно все бо Да ладно это сложно он даже не вспотел всё нормально Да будьте добры вот за первый вопрос Подарите пожалуйста сувенир конференции Ну Максим традиционно Тебе тоже от хайлоу сувенир поставь его на полку своими трофеями"
}