{
  "video_id": "IdOOt81q8zs",
  "channel": "HighLoadChannel",
  "title": "Нужно прокачать NER-модель, но как? / Прохор Гладких (SberDevices)",
  "views": 66,
  "duration": 1861,
  "published": "2023-10-06T07:18:37-07:00",
  "text": "Салют Меня зовут Прохор Гладких Я работаю девайсах Как вы думаете чем занимаются Сбер девайсы и Да вы угадали они в основном делают девайсы Да умные устройства такие как Сбер топ вербокс Сбер тайм и также своей умные телевизоры хочу немножко похвастаться Сбер девайсы недавно продали свой первый миллион устройств Да что сейчас будет Сейчас мы поговорим про модель изучения сущности модельер Я работаю с лидом доклад будет длиться около 30 минут и потом будет секция вопросов Примерно 15 минут где мы сможем обсудить темы вокруг этого доклада и поотвечать на вопросы Давайте посмотрим на упрощенную во-первых Да забыл сказать в каждом из этих умных устройств работает умный ассистент Салют давайте рассмотрим упрощенную схему его работы запрос пользователя это может быть текстовый или речевой запрос проходит сначала распознавание речи далее работает модель извлечения новых сущности о котором мы сегодня будем говорить далее измельченные эти сущности уже и сам исходный текст попадает классификацию намерения мы определяем Что именно хочет пользователь и попадаем после этого в обработку навыком уже непосредственно который делает то что хочет пользователь там тоже используется извлеченные сущности Итак Давайте вспомним о том что такое наверно Что такое модель извлечения именного сущностей задача это звучит следующим образом то есть у нас есть какой-то текст мы извлекаем часть этого текста который которая соответствует определенному смыслу определенные сущности сущности бывают например Это геолокации Да там Россия Восточная Европа или даты или организации например также есть люди и тут даже есть сущность титул император Всероссийский но сущности конечно бывает не только стандартные как здесь на экране но и совершенно кастомные да под определенные бизнес задачи могут быть медицинские сущности могут быть любые другие хорошо вспомнили что такое nr О чем я сегодня поговорю во-первых хочется поговорить про разметку но не так глобально как это сделали мои коллеги в предыдущем докладе у нас разметка поменьше Да скажем так далее поговорим про то как подготовить этот сайт к обучению моделей и собрать все корабли и потом расскажу про наш инструмент анализа ошибок модели nr который мы с вами разработали в конце подытожим расскажем Что именно и сколько докинула по качеству да вначале хотел бы немножко подискутировать с вами на тему Как вы меряете качество своих моделей правильный ответ наверное здесь померить на продакшене Давайте поговорим об этапе когда мы меряем еще в оффлайне до продакшена еще не дошли наверное общая цель будет померяем на тесте Да так вот у меня был случай когда качество на тесте было 97 если мы говорим про задачу качеством репутационной корзине эта корзина который предъявляются повышенные требования было тоже неплохим 95 но на частотной корзине Это самый частотные запросы которые говорят пользователи в интеллектуальный ассистент качество было всего лишь 11 пунктов и вопрос почему так получилось почему такое плохое качество на частотной Карьере Да и плюс еще было 8 корзин и на них тоже было разное качество ответ наверное в том что задача nr А по сравнению с другими задачами классификация обладает дополнительным набором параметров например такими как взаимная встречаемости разных типов сущности их длина плотность и так далее И эти все параметры вносит дополнительные разнообразие то как мы собираем корзину Вы можете собрать разные картины с разными параметрами и качественно у них будет разные что я для себя извлек из этой истории это то что для задачи а возможно для других задач лучше мерить качество разных корзинах таким образом собрать их по-разному например мы собираем корзины разных девайсов если у вас кроме один источник то вы можете например собрать разные корзины день ночь или собрать там корзины с короткими вопросами собрать другую корзину с длинными запросами и таким образом Посмотрите слабые стороны своей модели а что вы думаете про то как мерить качество модели в оффлайне Давайте обсудим это в секции вопросов О чем я не буду сегодня рассказывать это как писать Я думаю те кто занимается им или все это умеет и как проводить об эксперимент тоже мы Говорить не будем поговорим про разметку Да задача nr Давайте поиграем в игру представим что вы разведчик У вас есть вот такая инструкция то есть две сущности локации организации инструкция написано что локации Это все что связано с адресами городами достопримечательностей и так далее организация организации компании и Вам пришел до станции метро Охотный ряд Как вы его разметите У вас есть две кнопки Да локации организации И вам нужно выбрать Кто считает что это локация поднимите руку и Да я тоже думаю что это локация но в нашей бизнес задачи заказчик сказал что локации с часами работы а станция метро имеются работы Должна быть размечена как организация поэтому мы это прописали в инструкции и размечали Но даже если мы знаем что это организация то как разметить Да можно разметить со словом метро можно включить станцию еще метро Да можно вообще не включать если мы оставим SS просто не пропишем этом инструкции то все будут через мячики будут размещать по-разному В итоге модель Мы тоже будем обучать на вот таком вот сайте с разной разметкой и она будет по-разному предсказывать в продакшене это все скажется на негативно скажется на качестве модели поэтому тут тоже прописать в инструкции что мы включаем слова станции метро другого пример Куда сходить на массаж тут ювенту разметить как локация как организация и вообще не размещайте слово массаж кто что думает кто за локацию кто за организацию а остальные так понимаю думаю что вообще размещать не нужно и Да они право Потому что это не название организации это именно вид деятельности Да и его размечать не нужно Это пример сложно Поэтому такие моменты лучше тоже прописать в инструкцию другой пример это Найди круглосуточный магазин и здесь как бы несколько организация довольно то разметки мы договорились с бизнесом что вот такие слова как круглосуточные мы не включаем в разметку Потому что это не входит непосредственно в название организации например ресторан со свежей рыбой Да мы со свежей рыбой не включим в разметку потому что это уже дополнительные атрибуты но есть следующий уровень вам приходит пример путь до продуктового круглосуточного магазина и продуктовый Вам нужен потому что это как бы входит название круглосуточные Вы до этого написали что не надо размечать и получается правильный третий вариант но не инструмент разметки не поддерживает разделенные сущность не сама не сам формат они не модель не поддерживает определенную сущность поэтому тут нужно тоже прописать что в этом случае сущность не разделяйте размещайте вот целиком вот такие моменты которые мы сейчас с вами рассмотрели они влияют на качество итог Как вы их пропишите в инструкции насколько это будет четко это все повлияет на итоговое качество разметки вот процесс там разметки для сдачи Nero он выглядит следующим образом ошибки разметки у нас могут быть по двум причинам обычно это неточная инструкция это как мы видели до этого неточности есть и тогда нужно ее дорабатывать либо невнимательность разметка То есть когда вы в инструкции все хорошо прописали но разведчик сразу ошибается то есть И для этого мы обычно добавляем экзамен то есть если экзамен не пройден мы не допускаем разметчика разметки и увеличиваем перекрытие Что такое перекрытие когда несколько разведчиков в данном случае 5 человек размечают один и тот же сэмпл например Включи песню Королевство кривых группа Пикник здесь есть две сущности это название музыки название песни и название группы например разведка может выглядеть как-то так каждый разметил по-своему дальше нам нужно как-то понять качество это разметки мы считаем согласованное Что такое согласованность берем самые популярные два примера да первый и последний потому что они одинаковые Это самый популярный разметка и считаем просто ее долю среди пяти получается 40 процентов потом усредняем по всем по всему и получаем вот эту заметно цифру да согласованности в тот момент когда вы делаете вот такие операции по доработке инструкции потом отправляйте на разметку и дальше анализируйте эту цифру согласованности и самое несогласованные примеры вы также можете посмотреть глазами и понять в чем причина несогласованности при доработке инструкции у вас согласованность должна постепенно каждую операцию расти и обычно начинается согласованность 50 это не очень много но по мере того как вы улучшаете инструкцию согласованность достигает 90 90 Тоже неплохо и после того как у вас хороший вы доработали инструкцию У вас хорошая инструкция Разведчики понимаешь что делать по этой инструкции Вы можете запустить весь этот уже до этого мы делали итерации частями а потом отправляете весь это получаете хорошую разметку Но после того как Вы получили хорошую разметку вам нужно еще ее подготовить перед тем как обучать на ней модель первый простой шаг о котором многие забывают это дедупликация текстов он сразу исключит возможность Лика и стрейна валидацию и тест далее стоит посмотреть на распределение по плотности по типам сущности вашем это сайте оно может выглядеть как-то так то есть есть частотные сущности например локации Видимо что плотность 80 процентов плотность это встречаемость каждого локация есть Почти в каждом сэмпле вашего и другие сущности которые очень редко встречаются там жанр музыкальное название песни музыкальная группа книги которые встречаются редко мы рекомендуем Если у вас есть популярные сущности которые постоянно встречаются понизить эту плотность до 50 с помощью чтобы модель не была готова Точнее не привыкала к тому что у вас сущность постоянно в каждой сэмпле есть то что она получится она учится агрессивная и будет также предсказывать практически в каждом сэмпле на проме а на проме может пойти Сампо в котором сущности нет поэтому наша рекомендация для популярных сущностей понижать плотность до 50 процентов с помощью негатив андерсенпинга но некоте Finder сэмблинг для Nero он не реализован для классификации у нас уже есть готовые функции этого Source Нет мы предлагаем сделать такой же сон это взаимно встречаемость типа в сущностей То есть например Мы видим что музыкальная группа и название песни Music встречается в вашем сайте 491 раз и мы вместе в одном сэмпле дальше мы можем этот Джейсон руками отредактировать и понизить встречаемости некоторых комбинаций которые нам слишком слишком частотные и дальше мы это уже можем скормить обычному алгоритму негати funder sampling который есть в Open Source также такое представление такой же сонник поможет нам сделать стратифицированное разбиение То есть разбиение сохранением распределения по типам сущностей В итоге у вас получится что-то такое То есть это разного размера то есть 110 тысяч сэмплов там 12-12 но у них распределение по типам сущности практически одинаковые И заметьте что здесь нету сущности у которых плотность больше 50 процентов из-за того что мы сделали негатив хорошо модель Вы обучили у вас за тепло или в продакшн Все хорошо отлично да то есть хорошая модель но потом наступает черный день Вам звонит менеджер и говорит модель кроме ошиблась что делать и самый простой подход это взять сэмплов которым она ошиблась докинуть его в Трейд перебучить модель из-за тепло но мы ищем легких путей и тем более этот путь Не совсем правильный потому что он исправляет только один конкретный сэмпл А причину почему ошибка возникла мы не исправили поэтому мы разработали свой инструмент анализа ошибок модельер как он работает то есть основная идея этого инструмента в том что все ошибки модели Кроме тех ошибок которые вызваны прям ошибками в ходе это редко бывает они вызваны тем что в трейном наборе на котором обучалась модель тоже были похожие ошибки соответственно как мы ищем эти похожие ошибки в тренде Мы берем исходные слова Например у нас запрос Закажи мне чистки классический И в нем есть сущность продукт чистки классический например ваша модель в продакшене не выделила эту сущность либо выделил неправильно не полностью либо выделилась другим типом и вы хотите понять почему мы берем эту фразу прогоняем разбиваем напые токены то есть видно что слово чизкейк длинная Да она разбилось на ч и скей и к который уже есть словаря дальше мы используем модель Роберта который мы используем для нашей модели nr причем Это не просто там Open Source ребят Это уже зафантюнина Именно под нашу задачу модель на входе в неё получаем для каждого проходим через ребята которые учитывает контекст да то есть Закажи мне тоже будет учитываться и на выходе получая вектора кодировщика для каждого пое токена если бы это была задача классификации то могу сделали дальше пулинг по всем векторам сверху и получили бы один Вектор но мы в нашем инструменте делаем буллинг только по векторам которые относятся к нашей сущности чизкей классический на выходе мы получаем один Вектор например размера 1024 просто тысяч 24 этот Вектор соответствует сущности частей классический в этом контексте Так мы делаем как для нашей фразы в которой мы ошиблись на продакшене так и для всех сущностей которые у нас есть в тренд это сети все эти сущности мы кладем Файз индекс чтобы по нему потом быстро можно было поискать И когда у вас возникает ошибка на продакшене Мы берем эту фразу прогоняем ее через получаем этот Вектор Да и поэтому вектору ищем ближайшие сущности Это позволяет понять откуда растут ноги до нашей ошибки давайте рассмотрим пример Как это работает интерфейс просто вызываем наш поисковый индекс Передаем с ошибками и Передаем количество ближайших соседей которые мы ищем для каждой ошибки допустим например Найди круглосуточный банкоматы модель не выделила сущность банкомата Хотя должна была выделить как организацию потому что это наше условие бизнес заказчика и мы видим что топ-6 ближайших сэмплов из строения набора а следующие да то есть в первом все корректно выделено во втором третьем и шестом Мы видим что сущность банкоматы не выделена да то есть мы видим откуда у нас эти ошибки в продакшене У нас есть ошибки в трейле их довольно много понятно что иногда модель будет работать корректно в продакшене но иногда и нет таких ошибок мы можем после этого отредактировать нашу инструкцию Да Разведчики не понимает как размещать банкомат надо это прописать и сделать итерацию улучшить этот сайт и таким образом искреннить именно проблема Почему у нас эта ошибка возникла Давайте другой пример Найди круглосуточные банкоматы А да это как раз ошибка другой пример поехали до Кремля здесь Кремль этой локация и видим что в топе первый пример коллектор размечен 2 3 4 размечены некорректно во втором и третьем сущность не размечена А в четвертом она размечена другой сущности как организация это тоже ошибка вот мы тоже можем исправить побочным эффектом нашего инструмента лекция довольно забавный инструмент в который можно скормить любой запрос придуманный даже придуманный да и посмотреть как в этом контексте наша модель смотрит на слово какое-то определенное или несколько слов Давайте придумаем запрос постройка маршрутной до Луны вряд ли такое кто-то спрашивает в интеллектуальная система правильно но почему бы нет почему мы не можем придумать Вопрос такой и посмотреть как на слово Луны в этом контексте смотрит наша модель Да интерфейс следующий мы просто слово на которое мы хотим посмотреть в контексте ставим в угловых скобках и видим что модель думает что луна в данном случае это организация и нашла примеры втроем наборе которые похожи Да на которые являются организациями например маршрут до Галактики То есть это похоже на луну Да маршрут Проложи маршрут до планеты и как доехать до Глобуса да то есть она думает модель нашей думает что это какая-то организация с названием Луна и мы хотим туда поехать довольно забавное такое интерпретация другой пример Давайте придумаем что-нибудь Закажи доставку гуся в яблоках вряд ли это заказывает доставки Но почему бы нет Можем поэкспериментировать и что думают наша модель Я обращу ваше внимание что мы можем несколько слов выделять будет делаться именно по этим словам и Вектор получится по ним и модель доходит топ-1 купить колбасу клиента сырокопченую Да это не совсем гусь яблоках но видимо этот самая близкая то что реально заказывать пользователи к нашей фразе и модель думает что гуси яблоках Это продукт резонно дальше я хотел бы подытожить наша модель работала качеством 70 до всех изменений и по итогам всех изменений качество выросло до 90 это F1 по точному совпадению как что и сколько докинуло во-первых работа с подготовкой Сета и замером качества на разных картин покинул 4 пункта далее Мы работали с инструкцией с инструментом анализа ошибок из колец ошибки редактировали инструкцию и таким образом разметили на этот ТСС за несколько итераций это нам тоже такие на четыре пункта еще после того как у вас хороший Дота сайт в котором мало ошибок или почти нет вы можете просто вкинуть большую модель с большим количеством параметров и обычно это хорошо докидывает Действительно это накинул еще 9 пунктов также были некоторые другие манипуляции это о которых мы не будем рассказывать ещё хотела сказать что через неделю у нас будет сберай Приходите пообщаться задевайся Это ссылка на канал в телеграме где будет все подробности и да спасибо за ваше внимание это все что хотел сказать сейчас начинается секция вопросов справа видите qr-код на обратную связь по докладу прошу перейти оставить свои комментарии а также здесь есть На социальные сети самое простое это перейти на github Прохор 33 и там уже есть все остальные хендлы и короткая ссылка на все слайды которые были шорты и м большой и большой G большой W и предлагаю сейчас секции вопросов вернуться к тому С чего начали Как вы измеряете качество ваших моделей в оффлайне на тесте или еще как-то Спасибо большое Прохор Господа аплодисменты аплодисменты аплодисменты Это же просто чудо Я вот Каждый раз когда слушаю доклады про email меня всегда поражает как иногда очень ну вот человеческий мозг не может так интерпретировать информацию как эмэль модели но какая как где-то маля с между гусем в яблоках и клинской сырокопченой колбасой Хотя Черт его знает что в принципе колбасе друзья я Напоминаю что у нас для онлайн зрителей есть наш чат туда Мы тоже ждём вопросы но а пока начнём с вопросов в зале Большое спасибо за доклад прям очень такая легатная Идея про анализы ошибок удовольствие стал когда слушал Меня зовут Иван у меня такой вопрос по поводу того все-таки чтобы минимизировать ошибки мира что считать сущностью вот в этом несколько примеров сделали например королевство кривые группы Пикник Почему бы не рассматривать сущности как вложенные то есть условно говоря Королевство кривых группа Пикник это название музыкального произведения поэтому группа Пикник это организация она очень сложно в другую таким образом можно ж целый ряд кейсов э-э решить Кремль - это одновременно и организация и локация Ну на том же факторывали в шестнадцатом году пытались орк вести для того чтобы такие проблемные кейсы там а-а размечать но это можно через через параллельную разметку Независимо вложенных в сущностей Или допустим тот же станция метро это действительно это и локация с точки зрения семантики и организация одновременно не улучшило бы работу алгоритма если Он учился просто параллельно распознавать разные типы сущности допуская вложенности это вот первый вопрос и еще второй вопрос по поводу Давайте по очереди Мы сначала на первое ответим а потом ко второму тоже будут Да спасибо за вопрос очень интересный на самом деле мы действительно рассматривали возможность сделать Мульти лейбл Это называется как разметку Да и мультяшный был модель которая смогла бы выделять сущности которая пересекаются между собой могут быть вложены могут пересекаться частично для этого мы когда начинали формировать список сущностей мы сделали разметку которая допускает пересечение сначала и проанализировали какие вообще сущности у нас могут пересекаться и вот оказалось что из 9 10 типов сущности которые мы извлекаем в нашем салюте у нас пересекается буквально 1-2 процента сущностей то есть именно в общем количестве и поэтому делать именно формат хранения модель которая бы поддерживал multi-lable это всегда немножко посложнее но самообучение план обучения хранение данных и так далее и в том числе и метрики не имело смысла доделать эту разметку Поэтому в нашем случае мы решили сделать мультиклац когда только каждое слово может относиться только к одной сочности но в целом Да при если у нас появится новые типы сущности которые подразумевают под собой пересечение то мы конечно рассмотрим возможность сделать мультилейбол модель поближе немножко микрофончик сущности магазина которая суточная Почему так не кажется ли это переусложнением разметки и не проще ли считать сущностью сущность атрибутом в целом почему я так думаю потому что можно перейти тогда какой-то синтаксической настройки то есть нерв это семантика но она сильно зависит от синтаксиса и тогда можно и разметку облегчить ассорам предоставлять предлагать им размещать целые синтаксические группы допустим именные там или глагольные А ну проще чем выделять по отдельные слова ну и соответственно интерпретировать модели это проще Я так понимаю вы предлагаете размещать атрибуты Да сущности Ну я даже предлагаю так упростить то есть рассматривать сущности и помечать как сущность синтаксические группы Ну да в рамках составляющих э кажется они тогда естественным образом у нас сущности попадают в одну иную группу крусущно магазине это именно группа например да вот и так просто будет проще и самой модельки проще Все сором проще но бизнес требования может быть корректировать это просто учесть потом просто проводке Угу Ну я так понял вас вопрос разделяется на два первый - это почему мы не использовали сущности её атрибуты Да в одном случае кажется атрибут части сущности грецкий орех то есть в любом случае это было суточный атрибут не является То есть вы предлагаете использовать именно дерево зависимости Да выделять э-э чтобы сразу выделять сущность целиком да да Ну на самом деле это интересная идея но я не видел такого то есть задачах разметки до такой практики чтобы разведчиком сразу давали полное дерево зависимости Да и возможность выделить только сразу несколько фраз но мы подумаем над этим на самом деле интересный момент Возможно это бы избавило до части ошибок именно Но тут еще надо чтобы правильно было разбор и чтобы он точно совпадал с тем что хочет бизнес заказчик потому что бизнес заказчик иногда говорит что я не хочу там свежую рыбу Да в ресторане мне просто название ресторана Выделите и всё остальное я сам сделал поэтому тут вопрос заказчика да то есть как он хочет выделять Спасибо за вопрос Слушай ну хотя смотри атрибут же может в принципе кардинально поменять класс сущности Например если Луна это допустим Как Луна на небе луна как магазин Да круглая луна как атрибут даёт нам к один класс сущности круглосуточная Луна даёт другую как раз сущности А смотри э это же контекст и он учитывается и во время разметки и во время инфекции модели на продакшене поэтому Даже если ты его не разметил то модель-то всё равно смотрит контекст поэтому это по-любому повлияет вопрос Андрей подскажите по инструментам анализа ошибок Вектор вы складываете фейс индекс но база да какая-то Что за база и Как мерить расстояние просто косинусное расстояние между векторами или какой-то другой способ интересный решение которое позволяет У вас есть какой-то Вектор Да например 1024 их много загрузить туда и сделаю он предоставляет быстрый поиск там можно в настройках выбрать несколько способов поисков в том числе там один из дефолтных это косинусное расстояние какое предложение Вот соответственно по мы использовали именно на расстоянии для поиска векторов он работает быстро и там если у вас очень много векторов то есть мы говорим там у нас это сотни тысяч если мы говорим про миллионы то там можно даже упрощённый какой-то алгоритм который Ну тоже будет быстро работать использовать спасибо Еще вопросы друзья все предельно ясно все предельно понятно у нас есть традиция за вопрос который больше всего понравился спикеру мы дарим подарочки Прохор то наверное это первый вопрос пожалуйста прошу вручите подарок это подарок от непосредственно компании и также кому второй подарок от организаторов отдадим спасибо спасибо Прохор мы тебя бесконечно благодарим от лица программного комитета от лица организаторов тебе памятный подарочек Спасибо чтобы ты к нам приходил чаще на конференции и толкал прекрасный абсолютно такие темы про то как работают в эти помощники которых У нас сейчас в каком-то количестве представлено и вы друг с другом конкурируете И тем самым делаете мир лучше спасибо большое друзья пока небольшой перерыв"
}