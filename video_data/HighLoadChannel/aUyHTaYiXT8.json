{
  "video_id": "aUyHTaYiXT8",
  "channel": "HighLoadChannel",
  "title": "Клиентоориентированный Data Lake в игровой компании / Максим Пчелин, Дина Сафина (Mail.ru Group)",
  "views": 1698,
  "duration": 3075,
  "published": "2020-04-14T10:46:49-07:00",
  "text": "меня зовут максим это дина привет мы работаем mogames это игровое направлении mail.ru сегодня мы вам расскажем о том как настроили наше хранилище почему оно получилось таким какой есть они каким другим начнем на самом деле самого простого кто вообще такие мы 52 х в играх я думаю на этом уровне как бы ванночки про оригинального не покажется то есть мы подрыв делаем два направления сервисов это хранилище для для dat аналитиков и регулярная отчетность за бизнеса для менеджеров многие отличные знаешь и такие за зверь и работать похожих департамент плюс-минус понятно то есть мы собираем храним преобразуем и предоставляем данные бизнесу внутри компании откуда все может пройти какая-то особенность в бдх ну плюс минус все представляют как это работает есть проект в нашем случае эта игра у него как от систем лагер меня своя чужая покупных хорошая плохая него это есть и обычно эти данные пишутся в базу пархатых поверх этой базы строятся витрины для агрегатов метрикой любой другой абстракции для аналитики вот я уже поверх этих витрины может быть в самой базы строится регулярная отчетность но любом удобном вам бей и строй всем аналитики причем начиная от ким простеньких пикселей olap кубов заканчивать jupiter ноутбуками для dat аналитиков машинах машин лидеров и так далее всё сейчас модно копыта плюс-минус понятного вокруг такой системы есть одна обида до 2-х команда она знает всем как облупленную все замечательно а что если ваша компании появляется второй проект кубков сайт самый простой вариант конечно было бы купить вторую команду нанять сделать вторую систему но это как-то дороговато это второй ход это 2 инфраструктура поддержкой так далее значит надо потерять самом деле поселить можно по-разному можно на уровне самой базы можно на уровень каких-то ветвей можно все последнего метнула уже отображение прикручиваете сойдет как это вопрос технологически но он более чем решаемый а что есть у вас допустим третий проект вот тут уже вторую команду заводить совсем не хочется двумя справились какой смысл еще заводить третью но подселение в лоб уже может им кончится ничем хорошим у вас могут проблемы с определением ресурсов у вас могут появиться про не совсем прав доступа допустим третий проект дело к это аутсорс на я компания и нельзя видеть данные первых двух проектов не дай бог но какая-то задача сложная но все еще решено а что вас допустим из таких проектов не 3 отрицать вот тут сама собственно интересное счет кто такие мой games это направление мало кто развивает фигурами одно из самых больших направлений mail.ru вот и проблема что нас таких проектов не тринитариев это 150 и причем все они очень разные у нас есть проекты свои разработки есть покупные они все на разных платформ и тут у нас есть писи и иксбокс playstation есть мобильный плафон даже we are игру сделали и важно понимать что все эти проекты еще делаются ни в одной точке они делаются 10 офисах по всему миру в этих офисах seat люди сотни людей принимающих решения глобально для бизнеса к замечательный бизнес диверсифицироваться ищет новой точки для роста все хорошо но что это значит для той самой несчастной отрубей 2-х годовых а команд что это значит каждый из игр и это данные что лаги руется в играх в играх лаги руется каждый шаг игрока когда он зашел когда он вышел где он получил уровень с кем он дрался где он потерял уровень купил что-нибудь потратил внутриигровую валюту или реально эти данные хранятся на сервере in place of the lobby льется частью с сервера часть из клиента и мы как компания не навязываем свою парадигма разработки и каждая игровая студия лагере данная так как им удобно чаще всего это конечно просто реляционные базы данных mais quel подря мари да поможет быть но счастье игр лагер не происходит на неожиданных инструментах и ластик search ходу под тарантул просто файлики такими джейсоне сложенные или просто просто блока данных ничем практически не разделена по которым и в итоге просто греппа им они лежат просто в кучки ну лакируется они по-разному зачем нам эти данные нужны во первых это логично поверх этих данных работать сама игра во вторых к этим данным приходят разные люди чтобы вы здесь цветом вопросы что было на прошлой неделе поставок мы запустили акцию какие прогнозы на следующий месяц можно ли как-то повлиять какие-то рекомендации то что повлиять на эти прогнозы эти данные интересуют но во первых игровых аналитиков и гейм-дизайнером которые собственно делают самую игру и стараются и улучшать во вторых маркетолога вых маркетологов и маркетинговых аналитиков которые распределяют трафик в третьих этому нити затар и которые покупают эту игру который приносит нам деньги ну и самое не самую последнюю очередь вопрос издают топы их интересует больше кросс проектный анализ то есть какая игра идёт лучше какая игра больше нравится пользователям а какая идет на спад ну и собственно сами что-то от нас хотят ну в первую очередь данных который говорил дину причем не какой-то одной конкретной игра для hnu причем эти дам нужны как ли ежедневно операционных задач так и лис трагических то есть начиная от того сколько в жизни дать тому страшного монстра в конце уровне чтобы игрокам было весело и заканчивать как правильно расставлять ресурс является компания каким проектом дать больше разработчик в каким меньше кому выделить маркетингу бюджет как а кто обойдется потому что не сможет с неправильным обладать от нас ожидают надежности мы все-таки работаю в крупной корпорации и не можем жить по принципу что вот вчера мы работали сегодня не работаем а поднимемся ну может через неделю из там сильно повезет что-нибудь придумаем от нас хотят экономия ну и конечно были усомнюсь рады купить в 1000 серверов на амазоне источник в поддержку но мы коммерческая компания и не можем все такую позволь даже бы очень хотелось все таки стараемся приносить деньги бизнесу а не тратить их налево направо куда мне захочется ну и от нас хотят клиентоориентированности для наших клиентов причем важно понимать что клиенты в данном случае ты на наши потребители заказчики то есть это менеджеры аналитики и монти затар и тех директора наших проектов наших игр так что такое это клиентоориентированность мы сервис крупной игровой компании и мы должны подстраиваться под каждую нашу игру и работать так чтобы им было удобно с нами сотрудничать и у нас есть любимая студия которая разрабатывает логирование в тесной связке с нами и в общем это очень скучная история у нас все работает идеально никаких нюансов у нас части игры покупная причем метро случайном эти игры достаются с недокументированные логированием то есть мы не знаем где что лежит таких случаях мы из команды забираешь приговор очки берем часы на unix то и мы начинаем входить в игру выходить из игры покупать стрелять играть и смотреть в какой момент в какой табличка что появится потом поверх этого мы пишем документации и уже поверх а этой документации работы а бывает что мы не можем найти общий язык с разработчиками ну буквально они пишут игровые логе китайскими иероглифами и вот ты берешь их ю т 8 916 т32 и везде иероглифа в таком случае берем просто самая симпатичная и что поделать в общем это с точки зрения разработчика очень увлекательные занятия но максим считают что копаться в супер уникальном лагерю не грыз за человек это непозволительная роскошь так что мы конечно можем упарываться за проектом а только если это нужно бизнесу на самом деле как только команда разработки особенно наши новички слышит упрется вот так вот подстраиваться возникает 1 сам-то что желание вот никогда в жизни этого не делать то что любой архитекторы любой разработчик хочешь сделать идеальную архитектуру который бы никто никогда не дышал не просил бы правит он восстановил с ней бы ездил на конференции нормально вот жизнь удалась но что произойдет на практике этим 300 не подстраивается допустим слишком сложные требования к нашим проектом для интеграции к нам на чем предъявлять начнет сам простое все начнут массово разбегаться причем у кого то получится лучше кто то сделать собственный 2-х своими собственными своими разработчиками он не будет на самом деле идеале мы бы тут ровно подходить идеально подходить под их проект но во первых это опять же это же дублирование ресурсов то есть это опять же люди фот инфраструктуры так поддержкой так далее во вторых это замкнутая всему 3 себя система то есть там будут даны только одного проекта их от фиг оттуда вытащишь фиг оттуда что-то получше так неудобно каких-то проектов ресурсов будет мало ну допустим маленькая игра и соответству несколько еще 5 2 а не будет никакого какие-то проектов посмотрит и скажет очнулась на фиг с такими приколами дать вообще без данных жить был будет весело вот это на самом деле компании еще хуже и немаловажно у наших менеджеров и топов не будет никакого понимания о том что происходит на проектов не будет понимание как еще характера вы хорошо к тебе плохо какие можно ли все таки лучше не надо может быть кого-то нас часто хвалить кого-то замотивирует острыми предметами в неожиданной мягкие места дочь бизнес очень быстро начнем терять эффективность ну то есть работа придется ну 150 проектов с чего начать взять все сто пятьдесят это чересчур амбициозно поэтому берем два три проекта который нам приносит максимальную выгоду и наиболее перспективным предположим мы хотим сделать даже борды самыми простыми метриками до ума у revenue и может быть чуть сложнее немножко экономики и рекомендации может прогнозов можем ли мы взять просто игровую базу ну во-первых кросс проектный анализ придется делать чуть ли не в экселе взять данные из одной базой 2 из 3 так так себе решение во вторых это игровая база то есть поверх этих данных работают игры и им важно чтобы база не была перегружена затем на каждая игра в какой-то момент всю историю ненужную вайпать мы не видим история поэтому единственно вариант это собрать все в едином месте и на данном этапе нам подойдет совершенно любое лицо до базы данных прикручиваем к ней бей строим графики все отлично ну что может так поступим возьмем по сгорю mais quel все еще новенькая реляционная и сверху timber но игру нас будущем будет 150 хорошо возможно с объемы которые эти игры нам на генерят справиться кластерное решение реляционной базы данных но что здесь делать с тем что источники мало того что находится совершенно разных системах они еще имеют очень разную структуру даже в реляционных базах данных все таблички отличаются друг от друга но у нас есть варианты где все данные хранятся в 1 широкой таблички нас есть дата вот которая надо будет собирать вещи у нас есть jison и в манге структур очень разное нас не получится все это запихнуть в одну резинку ну на самом деле с учетом простому как-то не получается работу вообще сделать на настолько песни сможем вопрос возьмем другую команду значит надо как-то по сложным на самом деле первое что приходит в голову это дата лайк ну во-первых это красиво во вторых в отличие от реляционных баз данных data light может хранить и неструктурированные данные и то есть соответственно это может стать единой точкой входа для всех ростех разнообразных источников говорил один то начинают каких-нибудь солнечных очков маны заканчивал по всех остров текстами франко просто где-то валяются также соответственно это может стать источником базой основы для cross проект аналитики данный нашу сходить в единую точку но конечно чтобы это вообще хоть как-то работал и нужны будет разные интерфейсы для разных потребителей то есть sql питона spark возможности пик есть у вас есть очень не обычный пользователь ну все что вам потребуется то есть оно может стать основой для гибкости для клиент ориентируясь которые мы говорим но мы выбрали очевидные решения наш детали на ходу пи он позволяет использовать неструктурированные данные он легко масштабируется добавлением дата note то есть возле ткань проект и не начинает генерить огромное количество данных добавляем do knot все хорошо мы вдруг покупаем 20 новых проектов добавляем еще два года но ты все хорошо помещаемся кроме того что немаловажно он хорошо изучен поэтому ответ на любое возникающий вопрос можно найти нас так аирфлоу но у соответственно что у нас получилось здесь несколько источников данная кладутся каким-то образом hadoop и мы представляем несколько инструментов для того чтобы аналитики могли разбираться в этих данных олесь который знаю только иску и листья которые предпочитают питоны liar ну собственно что у нас получается дальше самом деле происходит само и неожиданно у нас в ходу получается отлично те потребители когда у него уже зашли перестают пользоваться конкурирующим системами остальные отмирают для тех проект которого уже в нем устройство инструментами ежедневного использования но тут есть проблема на самом деле чем больше вы делаете чем лучше вы делать всё больше и вас хотят и очень быстро проектор уже внедрены наш ходу начинаю хоть больше данных и нужен таблиц или или и вот сколько на лесть скок найдем все пожалуйста залейте те когда которые проекта расчета не добавлен начинаю хотеть также чуева эти парни так все весь хлам этот на обочине истории все дин но и древние качество растут то есть вы не можете уже как портатив сказать ну вот это вот веселая система она может еще не работала с не работать все таки тут уже должен быть стабильным сервиса этих парней ваш взгляд такой каркас замечательный но хранилищ низко просвечивает и соответствующие сами проекты масштабируется растет все больше конечно потребителей данных становится все больше и больше и с учетом нашей наши условия что мы стараемся быть экономными не можем линейно развивать команду если 2 2 а разработчика заливаю два проекта и 4 pro team не можем еще 2 раза духа разработчиков нанять и соответственно нам нужно какое-то новое решение которое ведет нас дальше а куда из он сам не может там дешево их залечить это настраивать профессор как это ни обидно но в крупной компании невозможно просто придумать архитектуру хранилище с может быть там укус кем-то согласовать или раздавать нужно будет говорить с огромное количество людей в первую очередь а с бизнесом людьми который даёт вам деньги вам придется объяснять что нужно делать только нужно что не нужно нас , ради петабайтов заливать входящую что найдете опять же доказывать что любой константы руб а просит ваши проекты шло нужно докажешь они сильно будет полезно для бизнеса вам придется договариваться с аналитиками со включенным потребителями в обмен на те сервис который вы предоставляете на услуги они должны выдавать вам что-то взамен может быть это системный анализ бизнес-анализ тестирование придумали q это креатива для вашего хранилище любые те функциональные пробел корпус у вас не будет не хватает рук то есть нашем примере до 1 рассказал что мы очень любим исследовать источники когда проектов малым это можем себе позволить когда проект становится на поток у нас просто не хватит рука надо отдельно группу системного анализа проводить поэтому это отдали на сторону и на проектах аналитиков они конечно дико жалуется но иначе это просто будет делать никому вам также придется договориться с разработкой проектов то есть те кто разрабатывают эти игры устраивайте целый то есть какие-то параметры норм о том как вы можете вы взаимодействуете договариваться то как работать структуры данных просто если поля в стан исчезать появляться переименоваться вот вас какая команда размеры не будем все равно зацепитесь вам нужно быть договариваться своей разработкой искать некий компромисс между идеальным решением разработчики на самом хочет сделать вот это интересно там уже зима я не знаю запишет не дай бог вот так вот и стандартными решению которых не так интересно не так красивы но они подходят для всех их можно клепать быстро ну и раз мы говорили до этого о поддержке обоссал и нужно договариваться с админами а то что были allure тенге мониторинге на самом деле как только у вас появятся какие-либо ресурсы дополнительные лучше нанять собственного deux без него жить конечно весело взяли купили железо закинули в хранилище сможешь как он там полыхает но можно конечно на счету что 2 а разработчики будут тщательно эксплуатации разбираться но даже с учетом что они это умеют невозможно быть идеальна во всем есть какой-то порог даже которого уже нужен прислал своем деле и на продакшн и шеи нужен отдельный devops на самом деле после того как мы реализовали хранилище пусть этот вопрос тут можно и расслабиться вроде хранилище есть но работы чет там пыхтит и хочется не знаю там заявки на более интересным вещам но кашель на этом останавливаться нельзя как правильно говорит этот замечательный в жизни сожалению не балуют откуда это все возникает историю anki просто до появления hadoop вы могли обрабатывать аналитика и статистика ну примерно пять проектов uhh uhh лучше хуже худо-бедно как-то обрабатывали у нас там был бы все нормально после появления hadoop над на той же команде без увеличения ресурсов мы дошли до 10 проектов после карнавальный процесса взаимоотношение с окружающей действительности дошли до 15 то при отсутствии роста команды но есть проблема проект fun of не 15 у нас их 150 и причем более 50 из них важны и как бы вот что делать дальше нужен еще один прорыв следующий шаг мы можем сделать только за счет автоматизации как авторизации приходит на ум ну во первых как именно мы собираемся эти данные из источников понятно дело что сначала был крон куда без него два проекта это нормально три проекта 45 окей мы справляемся 10 проектов грепп блоге по утрам становится больно сейчас у нас ежедневно грузится порядка 12000 процессов и тут крон понятное дело совершенно не подходит нам нужен более мощный штурер мы выбрали scheduler air flow это open source решения изначально она зародилась в рамках и bnb изначально как open-source потом вы передали apache для разработки чем же она хорошо хорошо это кот драйвинге теле пишите скрипт на питоне а у вас он преобразовывается в даге дирекция цикле граф то есть направленная цикличная графа чуть позже я покажу как это выглядит собственно эти направляться к личной графы отлично подходит для поддержания зависимостей между задачами невозможно построить витрина по данным которые еще не пришли которые вы не успели загрузить это нужно взять на мониторить у него отлично обработчика ошибок если вдруг что-то какой-то процесс упал он и перезапускает указанного его количество раз предположим там проблем носить и часто бывают в некоторых местах и там 3 раза процесс подгружается если все таки что то чуть больше вышла из строя там не за табличка на источнике поменялось нам приходит письмо о том что что-то пошло не так кроме того airflow отличный ей то есть мы видим какие процессы еще выполняются какие завершились какие завершили с ошибкой отличный мониторинг в случае если вдруг в проекте данная за вчера например изменились мы можем из этого я и при запустить забор данных и общем контролировать практически все не залезая даже в код он кастомизируемый он строится поверх операторов операторы такие плагины для работы с конкретными источниками часть этих операторов поставляется в коробке большую часть написала комьюнити airflow также вы сами самостоятельно можете разрабатывать операторы это достаточно там очень простой интерфейс диету и так и рф ло отличный что и как же мы его используем наш 12000 процессов ну вот этот вот task который забирать данные вот этот конкретный из-под грей прикладывать в наше хранилище до него идет сенсор который выясняет если на источнике нужные нам данные за вчера после этого идет какая-то пост-обработка самое первичное приведение в нормальную форму то есть прикладывание из unix тайма в человеко читаемое время может быть какие-то замены чего-нибудь на что-нибудь в общем первичная обработка и это забор данных из одной сущности на одном источнике это забор данных из всех нужных нам сущностей одного источника и вот таких вот наборов у нас сейчас порядка 300 это вот наши 12 процесс который выполняется ежедневно ну и немножко реклама это русскоязычное комьюнити air flow стиль в тележке airflow отлично документация если вы хотите не знаю умный дом у себя дома разработать вы вам этого будет достаточно но если вы хотите в промышленных масштабах использовать то вас начнут интересовать вопросы не завернуть ли мне это простите забываю слова немножко нервничаю докер выдавайте льда не зарыта не в docker и как можно сказать стилизовать его а почему меня не работает вот ответ на эти вопросы чисел можно найти в этом комьюнити там самом деле вопрос а почему ничего не работает мои любимые особенно если не по шесть часов задаются и все разные решение предлагают хотя комментить хорошие на самом деле что итоге мы получили у нас было решение сначала без scheduler и на маленьком объеме то работу после как мы не видели нас резко выросло количество учеников сейчас их примерно 400 и все они обрабатывают нашу schedule почему ты источники и внутренние то есть это какие-то базовые наших игр проектов также внешние покупные системы статистики разнородной api и так далее наши турниры росло все это обрабатывает когда-то лайк и поверх него уже работает несколько систем это несколько инструментов разной сложности лера назначение несколько систем или аналитики ну вот тут тоже все хочется ну вот нормально вот все мы все сделали по может быть там нет нападем машинным обучением займемся то почему бы нет но к сожалению есть еще работать и собственно почему представьте нашу обычную рабочую пятницу мы уже после обеда уже планируем следующий спринт в тумане какие статьи на хабре почитать а там где-то вот на горизонте но вот где-то в районе кофеварки дат как бы появляется аналитик пятен вот такой очень красиво нарисовали такого а первых это аналитик он очень умный он рыжий потому что а потому что это же это хочу вот он любит работает с данными для работ за нужно танку нужен очень много и за счет этой работы он приносит пользу бизнесу он действительно делает проект лучше и эффективнее так далее раз он делает работу бизнеса лучшим и поэтому тоже очень любим убить еще пару из неожиданных особенно во первых он очень любит писать и звонить нам а второй сам саша узнать где мы живем так вот и что он сейчас вот такой abstract аналитик петя что он может 1 вт еще хотеть вроде все есть говорит и позавчера я была табличка с платежами юзер айди сумма платежа до то время платежа меня все устраивало данных был чуть меньше 10000 вот вчера тоже была чуть меньше 10000 а сегодня пришла 28 записей и мало того 28 записей там еще юзер иди и все все пустые но что можно поделать есть вдруг на источнике у нас что-нибудь ломается мы об этом узнаем сразу нам помогает airflow но если источник работает данные на источнике есть есть мои забрали забрали какие еще к нам вопросы но пить от этого не легче что можем с этим сделать мы разработали собственно систему контроля качества данных ежедневно она мониторит наше хранилище она же хранилище это порядка пяти тысяч а табличка есть руками мы его просмотреть вообще никак не можем она мониторит преподы в количестве строк смотрят где пустые поля которые не должны быть пустые проверять на дубль и в некоторых местах из кастомные проверки и ежедневно на почту всем заинтересованным лицам приходит alert и соответственно аналитики и тут проекты и выясняют почему почему платежей всего 28 ножи вчера была акция на проекте что-то чинит мы перезагружаем данное все в порядке ну на самом деле данный свой ускорен качество эти на самом я не очень-то разработка проекта если фильм данные важны и аппарате ну плюс минус это залечу все быстро трюка это хороший мяч еще одна проблема пить и не живет в вакууме купите есть начальник такое же как и у всех который не важно о часах начальник так вот и начальник пятен приходит каждый удар в офис бьет чашку кофе и каждый раз заходит наш б смотрят на платежные метрики проекты в печек как им какие нехорошие у нас показателем на пусть еще как и у них ретенция на растет как все замечательно это один прекрасный день приходит в города на вчера просто нет дабы как такое могло произойти ну ка ка бы ситуаций конь проект взял заржал мочу все ресурсы нужны таблички для данных для пейте просто не прогрузились ведь негодую ладно мы пришли нашли какую проблему к к к к к к это был проект выкинули нафиг все эти таблицы про грузили нужные пересчитали все в порядке извинились как ну нормально проходит неделя неделю всё работает на маленький недель опять метрики не пришли причем вроде водах весь матч собрался все данные плюс-минус на месте какое-то вот маленький справочник из этого курса валют его я взял не пришел ну как бы а начальнику петь на самом деле такие детали почему-то мне всё не собралось глубоко все равно метрик нет данных нет еще вот так несколько раз он просто перестанет пользоваться системы зачем система которая работает так нестабильно но мы боремся с этим с нефтью сторон во-первых мы мониторим ключевых загрузки overflow из внутри системы слой который позволяет определить все ли пришло всё ли прошло воры может какие-то затыки есть есть какие то данные не прогрузились то мы узнаем об этом на низко часов раньше чем абстрактный петя прибежит нам с этой проблемой может смотреться начали петь и об этом не узнает пашем успели всегда все залечить во-вторых мы настраиваем приоритеты не надо гнаться за несбыточном и все все равно никогда не загрузить огромный-огромный хранишь допустим часу ночью поэтому мы презираем за счет внутренних системы приоритетов очер flow он позволяет нам качественно выстраивать какие сеты загружу проезд каком порядке сколько они могут пойти в параллель вот эти все вещи в целом кого нет никакого смысла загружать данные каких-нибудь логов которые следуют аналитика мира в квартал перед тем как загрузить все данные начальника пейте просто бессмысленно ну в общем у нас все стало хорошо начальник доволен петя приходит на час пораньше начальника что подготовить мы прогноз к утреннему кофе а хранилищ занята почему такое может происходить во первых что такое хранилище занята ночью у нас идет процесс построения хранилища на свет ночной batch их проблемы с точным с ежедневным почему начинается в том случае когда ежедневный патч считается больше двадцати четырех часов но надо будет проблем через пару дней поэтому следить за этим обязательно но у нас а сам не 24 часа строится хранящая естественно она строится нас всего лишь ночью потому что днем к этому хранилищу должны ходить аналитики штык хит свои за просеке в общем работать поверх него поэтому утреннего кофе от питья хронич должна быть свободным это на самом деле проблема которая решается не за один раз ее нужно решать поэтапно и много раз проходить одни и те же этапы собственно обратно масштабирование начнем с того что как говорил максим мы грузим не все данные могу не только то что действительно нужно аналитиком кроме того все продолжаем и табличке мы мониторим если вдруг какая-то из них не используется там скажем полгода мы отключаем загрузку в эту из этого источника из-за таблички во вторых конечно же мы наращиваем мощности если вдруг мы понимаем что мы упираемся в сетку в я др а просто хранилище мы обязательно добавляем даты ноды в третьих мы обязательно оптимизируем worker и пулы мы делаем все чтобы каждая часть нашей системы утилизировать максимально в каждый момент времени построения хранилища естественно мы переписываем не оптимальные процессы ну примеру считаем и экономику поверх всей истории свеженькой только что выпущенные игры это занимает нас пять минут но через год история разрастается и и тот же запрос начинает отрабатывать скажем два часа это неприемлемо конечно в какой-то момент мой должны перестроиться на инкрементальный пересчет этот все позволяет нам каким-то образом контролировать ночной бачек ну и в сон часа счет рефакторинга и настройки airflow мы плюс-минус понимаю сколько будет единой ваш мы держим муках самое важно что аналитики тоже прекрасно знает во сколько он заканчивается и чистку это время между вот я приду к 10 утра ну и могу работать он приходит то же самое налетит питер в 10-15 и думают в час я сделаю запрос постройку и прогноз и будут прекрасен приходит хранилища а там вот так очень часто картины сожаления московском метро в нашем хранилище иногда тоже кто-то сажал все ресурсы а собственно почему это могло произойти но на самом деле самый простой аналитики пишут не оптимальные запросу они могут встать и допустим слишком сложными или за слишком много допустим взяли in queens цикл юпитере написали путь или 100 штук у параллель в чем все аналитики наш персонал своем деле их становится все больше и больше запросе чудесатее и чудесатее на так у кого дома самим самый простой можем ул заливать какое-то время все железом как бы это дорого но в котором какое-то время это бы прожила но не конечно запросу вниз ровно столько ресурсу сколько вы ему дадите там вы просто потратите все бюджета все будут как были недовольны так и останутся поэтому мы боремся следом с низкой точке ну в первую очередь квартира вани и мы оставляем нашим пользу хотя бы чуть-чуть ресурсов да он будет работать медленно дома будет страдать хотя бы отрабатывать видимость рабочей деятельности продолжается во вторых на самом что не менее важно это мониторинг сложенных ресурсов мы его реализовали на на части куда 1 класс 3 часть самописных и отдали его пользователям например наш показывает сколько ядер в яр не сожрал запрос какого-то пользователя кто забыл использовать parties и в ходу присваивал все его или допустим оперативку пользователя еще мешать не работает сами находит виновного находится где-то в офисе разбираются всеми доступными методами и на самолет он прошел то почему общее то они делают они мы и ответ различные их много а мы одни как бы ну иначе если бы он был допустим нас было мало проект в еще ладно мы бы это сами от отслеживали но на большом количеством надувшись будут прямо 9 на отдельную команду вот нанять его они только этим мы и занимались так себе развлечение долгосрочной перспективе это вообще без смысл нашего самое любимое это добровольно-принудительно обучение пользователей вы конечно не поверите но работ аналитиков это заключается не в камере в написании качество запросу ваши хранилище их работа отвечать на вопросы бизнеса и собственно кроме вас как именно в хавкой на хранилищем три компании никто в качестве запроса на лик вообще не заинтересован совсем никто поэтому мы пишем факеле пишем презентации confluence и проводим лекции наших аналитиков объясняю вот как можно работать так как нельзя работу как можно положить наш конечно одним очень веселым запросу мы это все стараемся объяснять еще в целом то сильно тратить время на доступность ресурсов гораздо важнее чем на их заливку потому что если с точки зрения бизнеса данные хранилище есть они доступны вот можешь их нет кабаны никому не нужен и в таком случае и так дошли мы до этого момента сильно нас довольны в общем да все наши пользователи довольны у них все хорошо что мы будем делать дальше а дальше пора бы налобный обновить версию ходу по говорят там impala понадежнее hive побыстрее приходим и к нашему админу он плачет и смеется за голову хватается не знает что делать в чем история разворачивались мой пару лет назад в режиме стартапа то есть вы взяли какой-то был железа подняли на нем ходу как смогли как получилось начали на него ведь какие хиты данные и это вышло быстро прекрасно бизнесу понравилось и они нам дали зеленый свет мы стали разрастаться как раз до этого момента но сейчас просто так обновить хранилище едет во первых как я говорил бы у железа во вторых очень очень разные даты ноты по размерам несмотря на то что эта hadoop десятикратное кратное изменение памяти на разных новых очень негативно него влияет на него влияет сервисы раскина как пап и вот теперь например версию бурге эти все приносить как первый вариант мы берем и все это делаем не знаю когда ночью или днем ночь на сохранились устроиться днем аналитики работают раз будем ругаться критиками потому что ты downtime и скорее всего все поднимется не с первого раза ну короче такси и ряд второй вариант пишу всем аналитиком извиняемся говорим вы знаете ребята следующие два месяца хранилище будет не работать мы будем обновлять нормально варианта но что это за датчик который можно выключить на два месяца это плохой никому не нужный battle ep так что очевидный вариант мы построили рядом свеженькая железо и потихонечку переезжаем просто на новую версию хранилища это проходит прозрачность для пользователей в 1 какой-то момент мы рассказываем какой проект в каком хранились и сейчас живет они поднимают ранее подготовленных нам нами функциях и все работает отлично коля наконец-то доволен и на самом деле с учетом что мы уже не просто занимаемся самом тем что там работаете уже в хранении сейчас жил о вы уже час основном две минуты тем чтобы она стала лучше росло оптимальней делаем уже у новую версию уже фактически вылили на под первый проект уже перешли паника и начни вопрос а вообще правильно ли мы это дело нормальной архитектура и а ты на самый простой для нас до с учетом наших водных какой у нас данные как не нам приходит как их потребляют это решение которое позволило самым дешевым способом покрыть наши потребности даже существу что мы ищем то новое решение вид изменяемся так далее тут очень важно понимать что он вас не могу получить немножко другим то есть если у тебя могли выбирать источники данных или допустим вас не было в живых аналитиков а были какие-то системы про хранилище архи трубы менялась вообще в целом менять архитектуры при смене водах это более чем правильно не надо держаться зубами за то что это там сделал прошла компания вот умею ничего другого делать не буду даже мы в принципе ни в коем случае не кастрирую . уж архитектуре не думаю что она брака будет всегда мы ни в коем случае не постараемся не терять нашу гибкость ну вот пример запустилась новенькая мобильная игра она с клиентов пишет жетончики в джинкс джинкс кидает афк афк у мы разбираем с парком раскладываем хранилище отлично данный у нас задача закрыто все хорошо проходит пару месяцев в хранилище нас начинает строиться как-то все дольше и дольше начинаем разбираться в чём вообще дело оказывается игра понравилась пользователям данных стал генерироваться в 50 раз больше и spark просто не справляется с разбором жетонов захватывается собой половина ресурсов хранилище ну что делать сначала мы изучали все это лось в один топиком и из парка мы собирали их по-разному сущности мы попросили разработка проектов делить их на разные сущности изначального еще на клиенте стал гораздо проще ну и надолго проект еще немножко вырос стали думать что делать дальше решили перейти с ежедневного разбора жетонов на ежечасной то есть раз в час мы забираем отекшие данные из кафки разбираемых с парком все хорошо в принципе это решение нас устроила но теперь нас хранилище строится не только ночью а круглосуточно тоже такой вариант вообще мы не стали держаться на spark прикрутили рядом playhouse у него есть отличный движок для разборки сонов он голове на их раскладывать по табличкам собственно данные мы льём из кафки сразу в клик house и оттуда уже забираем ходу это полностью решил нашу проблему и у нас с этим проектом больше никаких проблем мы конечно роимся не разводить зоопарк но в тех случаях когда это уместно мы обязательно используем новые решения и того стоило ли оно того стоило ли разворачивать ходу система контроля качества прикручивается airflow разбираться с клиентами общаться бизнес-процессы налаживать ну конечно стоило во-первых у наших у бизнеса появилась актуальной информации по всем проектам они знают где что сейчас происходит они знают какой проект у них теперь любимый а какое g ведется черном списке во вторых пользователя наши системы все начиная от гейм-дизайнеры заканчиваем маркетологами они перестали решение принимать исходя из собственно интуиции астрологических прогнозов а начали их принимать по данным в третьих мы и дали аналитиком ресурсы для того чтобы они делали свою собственную kids and они теперь прогнозной модели строит рекомендательные системы улучшают у игры собственном и ради тобой работаем ради того чтобы они улучшали наши игры спасибо всем вопрос подарим диму и максима за выступление за ваш доклад спасибо вам так же я напоминаю то что нас есть подарок за вопрос лучший кто хочет задать вопрос метку нравится как вы работаете с пресетами адресе как и проблема я вижу во первых если вы снимаете и там на баш или они могут все поправить его перри снимите а если эта кафка то все же не так просто не он дашнаки the dew вы выслать или заново идти ивента бог знает во вторых как аналитики знает что им после этого пересчитывать если данные поменялись трёхнедельной давности они там уже лет яншина в себя насчитали там на джонни и всего на свете им надо половину своих файликов пересчитать как им понять что изменилось что не изменилось когда когда задачей куда-то словно три разные команды распределена как эту как этот фарш вообще обратно проворачивать очень хорошо про спасибо вадим а я хотела расскажу сначала немножко проекторы каждый оператор работает именно таким образом то есть мы берем данный например за последнюю неделю из и лицо на базы данных берем вдруг там они изменили данный сучье роза позавчера из этой неделе можно работать то есть мы сами пересчитываем все наши вечеринки и до нужных для работы с кафкой мы написали собственный оператор он сохраняет отсечку данных которые мы забирали там вчера и мы сгорим только новые только пришедшие данные анализ ко мне приходится пересчитывать ничего делаем за них то есть все ветрянки страны они пользуются только теми данными которые им нужны я ведь она дополнительно для нас чуть-чуть дополню то есть у нас компанией и строго разделения прав и обязанностей то есть условно все что связано с регулярные отчеты все что связано с критическими данными считаем ли мы аналитики занимаются больше исследованиями от хоком и так далее то есть если топ-менеджера хочет смотреть какую-то важную цифру он будет смотреть то что мы право лидировали если посмотрит хочешь этот очень сложный но он лежит идет к аналитику на лети к нему забирает у один на один и аналитику же там может ради рану следует пересчитать добрый день спасибо за доклад у меня следующий вопрос вы упомянули что вас несколько month аналитиков от какой-то уленьку доступ к этим данным у них есть готовые там как вы разворачиваетесь может чуть погромче это очень плохо слышно 1 1 1 лот удался такой вопрос как аналитики получают доступ у той skillet питон я не знаю питон юпитеру упомянули то юпитер хаб для х его я не знаю и импалы у вас есть какой-то bm это решение или вы из клауда им доступ как вы security решили вот вот несколько вопросов можно ска как security решить проблемы с ходу потом то есть еще несколько команду как у нас организован примеру в обновили spark версию да то есть должны ли они обновляются на своих workstation их или у вас есть битвы и ну на самом деле прям сначала на тему что вот аналитиков много и так далее на самом деле стараемся в каждый наш игре был аналитик ну очень и что это не 150 аналитика их примерно в месяц нас 50 в каком новых сильно не уставлены самом деле мы просто все филина точки коммуникации нашего клеящего единое место то есть у нас сейчас ну для аналитиков именно это в основном кью для highway импалы как единое точка входа для скажем так прокачанных аналитиков дата-сайентистов это ее peterhof причем на не юпитер которого как обычно у всех блокнота вот и на своих рабочих станций это именно хоп где общей единым библиотеки общая единую secure на сервер слова и так далее есть мы по сути просто оторвали возможность вас в хранилище с какой-либо персонализируем машину что ты если хочешь к данным доступ иди в единую точку входа то есть дата настраивают м а так далее только там то есть мы просто не даем взойти откуда-то еще говорю что нас есть система разграничения прав доступа мы звук звук вот это не каждый аналитик имеет право получив пример информацию по тому сколько получает соседней проект естественно мы ограничиваем доступ на уровне пускай даже в акте которые которая который пускает аналитиков только в те грубо говоря базы данных которые и можно видеть данные привет спасибо за доклад а у меня пара вопросов первые использовать или вы какую-то модель в хранилище ну там тренев снежинка до того лт якорь и 2 как вы регистрируете но какие-то подобные задачи то есть я правильно понимаю вы допустим залили st john голую таблицу там неважно что там документам спас гри какую-то информацию вот и если у вас вырвал допустим там когда vds начинаете строить там к примеру там разложен какой-то набор операторов вот как вы его вот для разных таблиц и перри используйте либо запрос я на 14 2 второй его части мы конечно сначала складываем данные встреч область и после этого собственно на картинке долго кликать назад почти он вот вот это вот перекладывание встреч а вот это вот складывание уже в у нас называется о да и пришла к теория но в общем это то же самое что адрес вид ринке у нас строится в отдельных да гах в отдельных директа цикле граф они тоже связаны с этой с этой задачкой запускать столько поставок эта задача закончится таким образом у нас действительно идет по времени сначала строительстве они более-менее вместе и уже ближе к утру устроиться витрины и 1 просто помните про что был одну модель нас datalink собственно куча куча всяких данных из которых мы строим готовые витрины и должна нато помню что очень важно что именно скажем так носителем модели что наши имена данные проектов на заливаем как можно ближе существовать не по сути повторяем модель источника а вот уже витрину ему сами контроля не превышают принимаем решение что в сумках вы просто а вот фрегат проекта но должны быть плюс минут как было там у вас еще вопрос дадут с микрофоном а то опять же них нужно редко ко второму вопросу немножко вернусь нос когда новая таблица добавляется у вас просто ну автоматическая генерация дага как то происходит происходит там допустим когда вам еще одну таблицу там надо пролить мы сейчас работаем и драматическим добавлением то есть выбираем данных из-за метод метод история источника но пока мы это делаем вручную то есть пишем конфиг-файл по которому уже строится в тут решение flow почему еще кто-нибудь здравствуйте спасибо за доклад хотел спросить у вас вы сказали про автоматическую систему контроля данных на чем она основана вообще то есть как и на сделанном кита скрипты или какая-то система использована самописная система на написанной питания каждый раз когда данные в таблице появляется событий генерируется в отделе нашей базе данных напас гре оттуда система контроля качества так у уже считает какие данные пришли и проверяет данная собственно сохранились как это выглядит на практике данные пришли у нас и hive идет от привычка что за последнюю неделю данной есть мы их посчитаем смотрим количество смотрим дубли и какие-то строки и после этого уже генерируем отчет параметры ну по которым вообще проверяются все это кто задает или просто это набор кто-то сторон не может использовать или пока я пока это моя задаем у нас есть обмен очков которые мы регулируем какие именно нам дано и нужно проверять на качество какие то ну просто льются на всякий случай для история спасибо здравствуйте спасибо за доклад у меня такой вот вопрос вопрос именно к концепции вот вы у вас есть какой-то интерфейс на который сам забирает данные из проектов почему бы не попробовать изменить подход не пробовали вообще такую вещь что предоставить какую-то библиотеку опять же вами написанную для всех проектов которые и они будут над носили по этой библиотеке предоставлять данные такой вопрос не рассматривался если нет то почему и или почему не подошло прямо на больную мадам прям очень на больное то есть на самом деле на если бы мир был прекрасен как бы да вы бы очень этого и хотели потому что значит много сделали все таки api реализовали вы сидели вы где-то сбоку и просто оптимизировали проблему что у нас есть проект очень рада есть проекты где нет разработчиками вообще ну то есть как классно пусть муж и мы купили этот проект на проект сидит один менеджер он вопрос он там именно там и заводиться с комьюнити-менеджерами и так далее то есть ему некому будет руками заняться чтобы с этим api интегрироваться будем делать это мы то получится что мы делаем то же самое просто у нас еще одна просто еще одно звено да то есть но глобально для тех проект корысти а то наши на под боком для собственно заводки мы как бы стараемся хотя бы часть автоматизируют целиком и отдать у них вряд ли сможем потому что опять же ну это нужно всем во лидировать это ресурсы это ресурс игры ну то есть да но глобально для часть про окской мы придем к этому решению для части мы не сможем и она остается наши попечительстве потому что пустым нет ресурс то есть клиентоориентированность да поняла спасибо но больно да здравствуйте у меня такой вопрос вот вы говорите у вас какая-то часть витрин строится вашими силами да и есть дата like с которым работают аналитики как аналитики вообще понимают что где находится то есть ведется какими-то да дэвид что и что с чем же они там так далее ну скажем так тут у нас тоже очень простая борьба это опять же вики конфликт и так далее то есть у нас и на описания ключевых витрину сами видим что вот есть ты хочешь платежи смотри сюда ими пользоваться надо вот так если хочешь входу вот здесь а если ты аналитик каком тигрового проекты хочешь почитать бы там не знаю баланс боёв ноты аналитика во проекты кроме тебя френд никто вот тебя и твоего разработчика никто мехвод что там конкретно вы записали в таблиц никто не знает поэтому это налить их на эту же сам а если приходит аналитик соседнем происходит что-то кросс проект на тему горюнова там вот есть аналитик вот он знает если аналитика нет той datalife по этому проекту просто глубину то есть детально не нужен поэтому же такое включу и сущность которых мы разбираемся то есть ключевые вещи знаем и детализацию знает аналитика проекта но и витрины обычно мы строим сотрудничая с аналитиками то есть они ставят нам т.д. на витрины а мы уже делаем их более оптимальными и ежедневными ну то есть есть какая-то большая свалка аналитики ну вот вы посылаете один улицами by the lake зато есть в свалке есть часть структурная а остальное как пойдет и вот так как пойдет ну скажем так но это уже дело аналитика а вот структуру мы отвечаем а спасибо и второй вопрос у меня такой вас наверняка были запросы на какой-то онлайн аналитику ну то есть вот прямо на лету вот какие вот вы инструменты подход и использование ну на самом деле запросы есть что приятно flow умеет этим работают у нас есть ежечасные есть бесконечные которые работают постоянно допустим чтобы какой-то и быстро-быстро дергать и предоставлять данные хранилище но на самом-то пропишет именно аналитическая хранилище она не операционная аналитиком онлайн статистика факт практически не нужно ну то есть как бы они у самому делать сложные исследования под клубок истории что происходит проектом две минуты назад интересует их очень редкой мы можем предоставить этот сервис но мы стараемся тем как бы сказать не злоупотреблять чтобы хранить нем было свободно должно быть жива и не занята нами но в целом дошел умеет но мы постараемся это не идет и в нашем случае наше время к сожалению подошло концу спасибо за вопросы спасибо вам за выступление и выберите wheels вопрос который вам понравился больше всего про боль я люблю вопросы про боль рубин который товарищ в красный полом"
}