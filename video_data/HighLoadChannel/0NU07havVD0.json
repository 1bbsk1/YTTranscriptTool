{
  "video_id": "0NU07havVD0",
  "channel": "HighLoadChannel",
  "title": "Профилирование кода на C/C++ в *nix-системах / Александр Алексеев (Postgres Professional)",
  "views": 4379,
  "duration": 2871,
  "published": "2017-04-22T14:48:15-07:00",
  "text": "вот всем привет спасибо что пришли меня зовут александр алексеев вот мой доклад называется профилирование кодексе ну кода на си си плюс плюс в звездочка них системах да эта ссылка на мой бложик и она тут не случайно я еще расскажу почему вот два слова себе я работаю в замечательной компании позже 1 professional занимаюсь там разработкой ядра по с грейс келли написание для него extension of и вот всякое такое всякими такими задачами вот а также вы меня можете знать по подкасту двн вот если не знаете то послушайте может быть он вам понравится вот мы пытаемся делать и довольно разнообразный подкаст с хорошим звуком то есть там типично первые 40 минут это там интервью с каким-то гостем потом минут 40 50 рублей новостей потом ответа на вопрос слушатели очень стараемся сделать что было интересно и познавательно подкаст уже больше двух лет до о чем будет доклад что здесь будет это вот такой долгий перечень инструментов которые я использую для профилирования умные книжки красивые картинки вот обратите внимание когда я делал доклад изначально это был вообще 1 внутренний доклад в компанию и в нем было много много всяких таких сильно технических вещей типа как установить инструмент какие команды в баши набрать чтобы им воспользоваться и так далее когда я его по довольно хай-лоу то если вы не знаете то у всех докладчиков у них проходит суровый коучинг многократные притом по разным вектором то есть там один коучинг он об обязательной один он но остальные не опциональный притом опциональный коучинг это там типа как побороть боязнь сцены в таком роде то есть очень сурово подходит к очень серьезно подходит к организации всего этого дела вот и организаторы они предложили убрать всю эту вот технической части добавить больше кул стори красивых скриншотов и так далее те кому интересно вот именно как это запустить какие команды набрать те могут обратить документации и недаром на первом слайде была ссылка на мой бложик потому что все там есть то есть если вас интересует а вот там system the pond как-то сложно собирается на линуксе дата вот открываем ссылку с первого слайда и там будет вот прямо все все все в этом докладе будет скорее такой обзор чтобы вы представляли таки инструменты вообще есть и ну что они дают и когда как использовать в таком роде и да я уже говорил вначале я немного жалею что не назвал доклад профилирование практически чего угодно как мне подсказывает примерно где угодно потому что не обязательно быть программистом на сессии пришлет чтобы интересоваться этими инструментами то есть у всех же есть в продакшне и там engine.exe редис и не знаю виртуальной машины эрланга все это написано в ядро linux в конце концов все это написано на си это нужны но она иногда тупит но то есть моем случае тупит позарез вот у вас он тоже может быть продакшне и я вот этими инструментами пытаюсь выяснить почему он , почему он жрет много памяти вот у вас могут быть и другие программы на си которые тоже веду себя странно и вот все эти инструменты они вам помогут даже если вы не знаю носили пишите редко или вообще не держите небольшой дисклеймер дело в том что я не являюсь разработчиком одного из этих инструментов или не знаю но я вот простой программист который пользуется этими инструментами поэтому я не знаю вот могу не знать каких-то всех их возможностей я не знаю абсолютно всех инструментов которые существуют то есть у нас например в компании кому-то нравится инструмент инструмент под названием о прав полом он так называется но я вот жизнь его никогда не использовал вот у меня говорили что он похож на верх так что вот не воспринимаете это что я такой прям великий гуру всех названных инструментов к мечу в них или что-то в этом роде я вот пользуюсь ими они для меня неплохо работает в начале вот пока мы ждём людей вообще мне предлагали в 15 минут начать потому что это первый доклад здесь утра самые первые люди едут на автобусах автобус стоят в пробках вот в начале у меня будет такая небольшая не слишком техническая часть о чем от о том как не надо делать бич маркер потому что вот но я наблюдают что люди часто делают типичные ошибки когда делают мяч марте да то есть во первых это не повторяемость когда вы открываете какой-нибудь бложик и там такая классная статья что а вот мы померили что то и получили вот такие красивые графические там наше решение которые стоит не так уж дорого там типа в 500 раз быстрее при этом не приводятся никаких данных для повторения твои эксперименты никаких скриптов ничего это наверное хреновый бич марка и нужно сразу страницу закрыть и если вы не можете его повторить как можно ему вообще верить но вы должны хотя бы примерно такие же результаты мощных воспроизвести вы измеряете не то что думаете типичный пример это например мы хотим померить а как быстро у нас жесткий диск работает мы там весело набираем ddf там не знаю что нибудь куда-нибудь сюда пишем в диск и мере макак быстром собственно пишет вот кто изолон может но знает почему это не измерение скорости диска правильно да потому что на самом деле вы померили скорость с которой у вас как файловой системы работает вот и как это обойти это тоже интересная проблема взятия среднего это меня всегда бесило на наших митингах вот я вижу хирург ридус слушатели понимают да нам нужно понимать как быстро мы отвечаем пользователям запросы давайте построим в граффити там график среднего времени ответа вот проблема в том что этот график он не показывает вам у вас могут быть там среднее время такой красивый там не знаю 15 миллисекунд но есть пике таких по 15 секунд и они могут быть очень редки и вот это взять и среднего но их смазывает и вы думаете что во все здорово замечательно самом деле от не так поэтому но устроить ну хотя бы среднее и максимум это уже там даст вам вот вот вот такую картину вот если для вас это слишком просто строй себе проценте летом 95 99 вот это даст вам еще более хорошее представление но их не очень дешево строить и ну в принципе решаема а кто будет мыть маркович марки да это такая проблема например вы написали клевый тест который мерит сколько ответа в секунду генерит ваши приложения померили получили не знаю 4 тысячи запросов в секунду думайте что то как то маловато да надо понимать и давайте разберемся get убит проблем в том что ваш benchmark у на однопоточный под реальной нагрузкой ваше приложение там работает в не знаю сотни тысячи потоков и собственно вы не учились что ваш собственный меч марка это battlelog в данном случае это нужно понимать отсутствие анализа это когда новые померили говорите что-то купит надо не знаю все три почти все переписать нужно понимать почему она тупит игнорирование ошибок опять же вернемся к примеру с вашим допустим это не ваш мяч марка это абэ и вы его там натравили на свой сервис померили не знаю получили 5 миллионов запросов в секунду и радуйтесь у нас все очень быстро вот на вы не посмотрели то что все это не знаю ответы 404 например то есть нужно ошибки тоже учитывать неправильные настройки этого в моей сфере в базах данных это часто частая проблема потому что позарез он его настройки по умолчанию они предполагают что вы пытаетесь запустить его на микроволновки сейчас у нас сервера мощные поэтому все настройки по умолчанию надо прям очень сильно менять там побольше шарик boffins побольше work мимо вот и понимать что эти настройки делаю то есть если вы видите быть парк там даже с данными на которых ты сервис и даже со скриптами но там сказано мы впервые там с настройками по умолчанию по умолчанию не знаю мангале байпас gres все можно закрывать настройках по умолчанию это не конструктивный способ понимать что быстрее нетипичная нагрузка ну не знаю у вас 90 процент времени что-то читаю 10 процентов педжета вы решили напишем кошмар который фифти-фифти итак итак сделать ну зачем такой тыс и рвать ну то есть вы что-то с оптимизируйте просто это вам в продукте не сильно поможет маркетинга подгон тут у меня есть небольшая курс тория достоверно знаю что есть некоторые по дну были лет 5 назад производителя железо которые знали в но вот был некий журнал до который тестировал компьютера им нужно было на но они знали быть марк по которому этот журнал как бы тестирует компьютеры они свое железо собирали так чтобы она на этих быть марках выглядел хорошо вот в результате все очень здорово продавалась вот это как бы первый способ подгон и другой способ подгон это не знаю просто мы можем он году бы привести да то что они всегда на маленьких data set of все свои batch марте гоняют поэтому у них все помещается в памяти здорово работает когда у вас datasette перестает помещаться в память все перестает здорово работать вот то есть нужно понимать что это существует это не не иллюзорная такая вещь ну и другие свойства то есть близкий мне пример да уроку против возраста что быстрее вот может быть ура колонны быстрее там не знаю в 10 раз данного он и стоять как не себя это надо тоже учитывать может и нет я не быть марку ни разу и вообще никогда не видел если честно говорят немного потерял начну с того как не надо скорее быть марка скотт да но для создания полноты картины вот сам простой способ где таймов да и до дедовский метод когда мы вот у нас есть кусочек коды мы хотим понять насколько он быстро или медленно и мы померили время в начале выполнили код померили время в конце посчитали дельта и сделали вывод что код выполняется столько времени на самом деле не самый идиотский способ иногда он удобный удобен он например когда у вас этот код иногда тупит то есть очень редко там раз на десять тысяч запросов например вот почему нет плюс к этому он не такой дорогой как принято думать потому что у вас не происходит системный вызов как можно было бы думать в в линуксе не только в линуксе есть не в линуксе менять и механизм по-другому называется называется vds у вити оскол по сути у вас есть страница в ядре которая молиться в адресное пространство всех процессов и ваш дед таймов да и он превращается в обращении к оперативной памяти никого исполни происходит и но и не стоит его конечно использовать несмотря на то что он дешевый если вы делаете что-то со спинками потому спиной и они сами по себе довольно быстро работает то есть у вас вот то что вы меряете оно должно миллисекунды хотя бы выполняться иначе у вас просто погрешность будет на уровне измерения инструмент такие как и стресса утра из страз трасс этого в африке прикольно инструменты у них есть флажок минусы который показывает показывает сколько времени у вас какие сиско выполнялись ну электро рисуем библиотечные процедуры измеряет вот estrace он тискал а вот он тоже в принципе где-то может быть удобно в таких задачах не могу сказать что я этим часто пользуюсь джо прав есть такой прикольный струмент от приводится пример его у текста в отчетах тоже понятно что вот у нас есть процедуры в программе вот столько раз они были вызваны столько времени это в процентах выполнялось вот ну простой и наглядный отчет если вы написали микро benchmark но можно пользоваться с помощью g прав еще можно генерировать такие картинки это скорее пример того как не надо делать то есть запомнить эту картинку то здесь насколько 46 квадратиков да вот обратить внимание как много они место занимают тот именно процедуру на стрелочками что-то все время по написано ничего не понятно очень много не занимает вот мы увидим намного более наглядные отчеты чем этот вот но принципе красивая картинка можно начальство показать понтануться удобно отладчике на самом деле это уже пример инструментов которые приходится использовать на провести даже при профайлинга потому что у них есть клёвые свойства выполнять команды бо чем и туда можно написать в этом в этот набор батч команд бить и до получения бактерий за это очень удобно при отладке лоб контента на когда у вас происходит борьба за локи здесь у меня есть небольшая кул стори то есть это помог был самый первый патч который я написал для вас gresso или 2 не помню у конгресса у него есть своя реализация хэш-таблиц просить сильно заточная подзадачи под gresso и она в том числе может быть создано с такими флагами чтобы она использовалась разными процессами и пришел клиент с проблемой что вот у меня на таких-то запросах на такой-то схеме четкость и тупит пожалуйста помогите интересно что сначала вот с помощью этого приема с бактерий сам он показан он он разумеется ну то есть он показал что это вырезала так что вы запускаете g тебе не знаю там десять раз до в 5 случаях у вас бактерий висит на сем ap то есть на взять и logo ну то есть а вы чем в половине случаев на чем другом да ну то есть явно у вас процесс часто висит на спине локи что-то не то она простите на обычном локи что-то не так по актрис удалось найти а что это за код такой который там берет лог освобождай блог и там долго история можете там в третьих прочитать его там ссылка есть на статью на хабре где описана этот патч более подробно текстом и там же есть ссылка на обсуждение в hackers 5 можно найти все технические детали вот этот кусочек кода между взять и мы освобождением lockon свою очередь там проваливался куда-то в венах ешь где он крутился на взятие spylog а вот и собственно это удалось его с помощью tube отладчиков найти исправить предложить патч вот и в результате вот этот spylog который в венах ешь это хэш табличка в под грейся spylog который там был его превратили я не помню 8 или 16 пин логов которые там при определенных условиях берется разные удалось его пошарить вот и это уже в 96 есть первый замечательный инструмент поднимите руки ком он уже знаком ну так я думаю процентов 30 так навскидку вот замечательный струмент потому что он вверх топ он показывает показывать топ процедуру в данном случае в указанном процессе сколько время они выполняются тут я пытался это немножко от photoshop ну как бы не фотошопе game pe обработанный вариант для большего контраста не знаю видно или нет но тут вот верху там 30 процентов 20 процентов и мы видим какой то ресурс owner это неспроста в именах процедур вот что меня следующая кул стори она тоже пора реальный патч опять же пришел клиент сказал что у меня вот такие то запрос такая схема все тупит что делать вот начали отложить а у него такие такое enterprise на и приложение у него есть таблицы у него там типа 1000 дочерних таблиц в подгрести если кто то не знает там есть наследования таблиц как вот вот прям и с помощью перф топ и вот мы видим что в ресурсы умный все тупит оказалось что но ресурса умер это такая такой объект насколько слова объект она применима для и за косе который хранит в себя разные ресурсы там файл и жареную память что то еще я не помню там восемь видов разных и он написан в предположение что обычно вот мы ресурсы выделяем мы кладем их в массивчик до освобождаем в обратном порядке как бы и поэтому при удалении ресурсов он их начинает искать конца ну размер массива он знает но смысле у него есть яндекс последнего элемента оказалось что это это это условие выполняется не всегда ему приходится там во все стороны искать поэтому массива поэтому он тупит вот боя заключается в том что при определенном количестве ресурсов я не помню там больше 16 или какого-то такого порядка число этот массив он превращается в хэш-таблицу ну то есть как это правильно делается когда вы конфликта разрешаете в пошел пришли в соленый индекс массива потом идете там в одной из сторон вот как статика вопрос из кого-то интересует кому в третьем тысячелетии приходится писать свои хэш-таблицы вот вот я сижу и в двух матчах пишу свои хэш-таблицы потому что ну вот не подходит нам стандартные реализацию к сожалению вот это тоже уже есть в 96 там ресурса умерли не тупить если у вас портирована сильно таблица но сначала он все еще будет купить на просто слабее с помощью его перф и можно строить вот такие красивые картинки это называется flame графе поднимите руки кто знает что это а уже уже поменьше да процент в десяток навскидку это читается снизу в верх то есть внизу у нас есть процедура потом пропорционально тому сколько времени где она проводит но в свою очередь вызывает у нас поделена на другие процедуры потом вверх идем так также пропорционально делятся сколько времени она где проводят вот и так далее вверх это очень наглядный ну смысле это может быть непривычно если вы такой первый раз видите но на самом деле это очень наглядный отчет намного нагляднее вот того пример с графом который джип расстроит обратите внимание как экономно используется место и ну на свой доход нельзя показать на самом деле это svg он тут можно кликать во все это и у него есть подсказка которая там показывает процент и вот тут есть увеличенный кусок не знаю вам понятно нет это вот где то в середине часть прямо ровно в середине то есть можно прям кликнуть и получить вот такой вариант ну я показал это как как мог собственно собственное наверное все вот но мы этим часто пользуемся на предыдущей работе мы таким же образом анализировали логе там была другая история был как бы а как лазеры если это кому-то чем-то говорит распределённое приложение мы пологом строили вот такие вещи пытаясь понять где же у нас тормозит код но лаги разумеется нужен был со всех быканов агрегировать в общем удобная штука я всем рекомендую есть такой мужик зовут брендом грег вот кто знает этого мужика по моему еще меньше чем знает прошлом графе что странно потому что насколько я знаю брэндон грег это собственно может который изобрел flame графе и чуть ли не сам первых ну наверное не совсем один писал но существа не уложился также он известен видео на youtube и где он орёт на жесткие диски в дата-центре у него увеличивается в этом все до при обращении к этим диском замечательное видео есть кому интересно это реальная тема и но правда с хдд ssd не знаю это работает или нет вот было недавно прикольная история похожая про то как во время пожарных учений в банке вырубила весь дата-центр потому что них слишком громко свести или трубы которые подает вот этот газ который тушат огонь вот то есть тупой вибрации воздуха вырубила все диски до ноутбука бренда но мы еще вернемся потому что он вообще он такой мужик который знает все про профайлинг и очень много вода сил вложил сейчас он занимается этим в на фиксе пенси стад это инструмента исключительно для free bsd у кого фри без них продаж не поднимите руки вот воу воу четверо я думаю рука не будет а пятеро честно говоря я когда делал эти слайды я думал что рук не будет поэтому как бы здесь подробности особых нет premises так потому что но остальным это не очень интересно вот но краткое содержание такой что с его помощью можно делать все то же самое что с помощью пера фон также делает топ он также строит flame графы и ну то есть он ничем не хуже просто команды другие вот кому интересно вот ссылка на конкретную статью там все описано под мак нет то есть это чисто чисто frybest и переходим уже к более таким я бы сказал серьезным инструментом систем tapon помимо прочего позволяет ну вот выше выше до этого был профайлинг самцы туда где у нас что тормозить и синтепон позволяет делать еще больше там вы можете посмотреть буквально на все что угодно в ядре вершить свои хуки типа и померить таким образом сколько времени у вас там сколько у вас пакетов посети уходит там обращение ведическую помериться все что угодно то есть ограничено только вашей фантазией систем то позволяет писать вот такие вот скрипты в данном случае трясется вызов и перцем но то есть получения какого-то и 2 пакета вот плюсы-минусы но главный минус ну их 2 я бы назвал во первых его очень но это как мне какой-то официальный инструмент для linux это чуваки из red hat и если ничего не путаю запилили в основном для себя и в основном для трейдинга отладки своего кода как я это понимаю вот его очень не удобно устанавливать там нужно скачивать пакет с остаточными символами и др а потом его устанавливать потом очень долго компилить сам это system the pooh так просто тоже не компилится нужно определенной версии либо эльфы что там еще вот короче довольно геморойно но в конечном счете она даже начинает работать вор второй недостаток то что вам нужно хорошо понимать когда базу того что вы хотите проанализировать потратить то есть не все знают там на известь ядро linux я не знаю вот но если вы хорошо знаете свой код то можете это использовать есть интересные свойства код транслируется все потом этот это компилируется в модуль hydra этот мод ли hydra подгружается и уже там собирает всю статистику и все tracid при этом вы можете не бояться там делить на ноль и разыменовать указатель кит неправильный то есть это все о ней но если это написать скриптовом языке это не приведет к крыше ядра она просто аккуратно свернет лапки и выгрузиться но ваших игра продолжит работать есть автоматический вывод типов поднимите руки scales программиста на скалы и на хаскеле кто радуется 11 радуется я вижу вот ну короче да автоматический вывод типа правда типов там типа 2 или 3 но зато они автоматически выводится ну и лично мне было бы страшно использует в продакшене но потому что это такое немного странным не производит впечатление стабильного инструментах окно на один тот факт что у вас скрип секунд десять компилируется и загружается что в это время будет там тормозить не тормозить не очень понятно я бы не рискнул она может вы смели de trois тоже прикольно инструменты не только для фри бездне как мы скоро узнаем для в линуксе тоже есть все хорошо вот он похож на систем tab вот здесь в этом примере мы трейси чтобы а это вызов пол системный вызов пол притом для процессов которые называются по сгрыз вот здесь трясется с какими аргументами он вызывается и что возвращается плюс и минус во-первых он в отличие от систем tab он прям есть в системе из коробки ничего не надо устанавливать компиляции он вот-вот просто есть вафли везде в маке для linux он тоже есть в но если вы каким-то образом используйте oracle linux просто любопытство есть такие 40 linux не стесняйтесь попал руки я видел в рок ли linux есть петрович да кроме того есть проект de trois for linux на гитхабе он компилируется работает я проверял то есть в принципе можно пользоваться в отличие от систем tapa de trois не страшно использовать продакшене то есть заходите на ваш mac в боевом окружении пожалуйста тратите проходить все что угодно да и ну помоев как бы субъективного de trois он такой он больше для админов потому что у вас в ядре есть куча пробов на все что угодно да и вам не нужно знать кодовую базу вы просто говорите там хочу собрать статистику по их и пакетом доской сколько пришло сколько ушло кстати есть наборы готовых утилит вам не нужно обязательно все скриптами самим писать где trace букет называется wot assistant ap он скорее не для админов а для разработчиков то есть я знаю код ядра я хочу вот в этом месте потратить без написания какого-то кода но в смысле не по чего до сих пор мы говорили про профайлинг про профайлинг в плане использования пуда но еще часто проблемы это что если у меня сжирает много памяти лично вот мне нравится инструмент называется хип трек он если вы когда-нибудь использовали как называется вала green массив по моему в алгоритме saw да извините я проглядел вперед он такой же только быстрый вот и но с ограничением работает только на линуксе здесь пример тексту в отчеты не знаю насколько вам хорошо видно сколько тут найдено место которое отъедает больше всего памяти есть конкретно номера строк имена файлов с исходниками и так далее кроме того он может строить вот такие красивые отчеты этого в массив и вот есть такой нет такой инструмент массив visualizer вот в нем можно открывать это все в динамике то есть там типа побить росла потом вот достигла своего пика потом она там начала падать опять свобо ждать но спасибо дождаться опять выделяться и так далее там справа есть trace а вот все очень наглядно красиво да плюс и минус во-первых он быстрый в отличие опять же от вала гранита может цепляться к запущенным процессом можно запускать уже но смысле запускать под ним процесса красивые отчеты он умеет находить мама религий немножко кривенько их находят то есть если у вас там стандартной библиотекой языка выделил вот там 16 килобайт пакет свои внутренние нужды и там при экзит их не освободил он тоже зачем вот он скажет что это моим relic вот но в принципе довольно довольно полезный инструмент несмотря на все это вот можно построить гистограмму что у меня там кусочки памяти размером там восемь байт выделяются там больше всего а кусочки памяти размером 32 байта выделяются там чуть реже вот такая красивый гистограмм к получается вот просто так он ничего не знает если вам нужен стек или если вам нужно что-то за пределами linux то используйте вал грайнд я линуксоид поэтому я ничего не зная ни про какой vol 3 есть такая интересная тема в linux называется бекеев изначально это было беркли париж фильтр их как можно догадаться по названию до имеет отношение к беркли какой-то там фильтрации пакетов но она со временем т.е. это приземлил бпф он где-то в 26 ветку приземлился время в результате вода работали допилили и по сути он превратился в ну не без помощи уже упомянутого бреннана грега превратился в дет рейс в линуксе вот то есть он позволяет делать абсолютно все то же самое в но недавно у брэндона он был пост в блоге а где он пишет что в ядро 49 которые сейчас все еще release candidate насколько я знаю но скоро будет туда приземлились окончательно изменений в бехе больших крупных изменений не будет это не может быть что-то зарифа чат может быть немножко поправить но вот так что они будут много чего то активно добавлять такого уже не будет би си си это набор утилит который использует бпф для профайлинга разных мест ядра вот тут на картинке на самом деле это все название усилит то есть тут не знаю 10 сипит опыта внизу который вот там стрелочка идет типе позволяет там но честно говоря я не запускал я не знаю что он именно показывает ну видимо топ потребления drive или что-то в таком роде вот то есть вы фактически можете любое место потратить попрощались ведре недостаток у bb f в том что у него еще нет своего скриптового языка как есть отравишься как есть и систем то по но в этом направлении уже есть наработки в частности парни из red hat они подключились они взяли свой систем tab и и сделали его сборку для бпф а то есть используется язык систем то по но как бы она работает на обеих анапа какое-то ограниченное там по вообще не поддерживает строковый тип но они работают над этим суть в том что бегов это похоже наша далекая светлое будущее и он является таким наибольшим общим знаменателем которому в итоге пришли все компании потому что ну там были какие-то скрипты у фейсбука до было system the pale red hat а потому что им нужно было для разработки чтобы такой то есть они свою задачу решили им больше ничего не надо вот оао бпс это в результате то что должно решать нужды всех и она уже вот прямо в ведре из коробки готовы и похоже к этому в итоге все придут через пару лет наступит прям большое счастье главный вопрос который будоражит умы миллионов хорошо очень много инструментов что когда использовать вот лично я считаю что ну и что я использую отладчике если вы подозреваете ло контент его легко довольно заподозрить вы во-первых . просто не будете видеть что что-то живет большое количество времени наверно она висит в блоках вот первый если вы думаете что у первой супу это в обычном и чtoбьi всегда видно вот процессом живет много циpкa вот pm частота если у вас freja систем tab мне кажется бесполезной инструмент по той причине что есть первых он удобнее но это имеется еду в контексте именно профайлинга да то есть пропарить я могу perform для трассировки систем tab наверное ничего но просто он не про профайлинг вот дид рейс это если вы сидите под маком то вот эти trace это ваше все потому что он он умеет все вот хип трек для памяти valgrind я произносил valgrind vagrant до этого опечатка конечно вал гранд мастер это если вы не на линуксе и бпф это светлое будущее ну сейчас наверное я бы не стал ставить в 49 и продукт может вы смелей опять же книжки хочу порекомендовать с авторством брэндона грег 1 system performance enterprises and за клауд это потрясающая книга вот ее обязательно нужно читать всем поголовно это наверно там одна из лучших некоторые вообще когда-либо читал про как-то связано с программированием она взорвало мозг мне потом шрапнелью за дело мозги коллег и вопрос прочитайте вот вторая книга она прадед рейс завтра что опять же бренда на грега в соавторстве с парнем которую я к сожалению знаю чем он примечателен вот я ее не читал я я полистал это такой большой сборник рецептов прадед рейс то есть там дается командочка и что она делает там примеры скриптов и так на тысячу страниц но мне кажется не очень интересное чтиво вот но если вы сильно интересуюсь death ray сам там вечером полистать я думаю вред и не будет в куче онлайн-ресурсов блок брэндона грега подписаться обязательно он там постит умопомрачительные вещи и в общем это очень клевый блок блок de trois а я тоже читаю там тоже есть интересные статьи дальше это сай систем т.п. free везде в веке в ханбоке можно прочитать прадед рейс но даже если вы пользуетесь маком все равно полистайте ханбок там хороший есть пример вот и в конце это мануалы intel atom можно почитать как собственно перов на чем он паразитирует то есть за что такое вот эти пенсии перформанс момент аккаунта 1 и так далее то есть это все прям в процессорах есть инструкции которая позволяет все это мерить вот у меня все я даже почти нормально по времени уместился если у вас есть вопросы я буду рад на них ответить спасибо за доклад вот вы как бы в докладе больше сосредоточились на отдельный профайлинга там при разработке приложений вот real-time prada профайлинг в продакшене то есть у нас есть некое приложение она уже работает как подцепиться как посмотреть но там пир в топ можно сделать но вот допустим там мем реки исеть еще какие то вещи там systick вот например такую вещь вот не рассказывали вообще не знакомы с этим инструментом тут нужно сделать оговорку я разработчики ядра по сбросу у меня нет продакшена я шлю патчи в рассылку вот и получаю багрепорт и на гитхабе к моим там extension то есть это не так что я прям на захожу на сервер а я там что-то делаю поэтому я не могу на это сказать я знаю что есть инструмента дает опытом всякий экзо кс ну ты и так далее я не просто имени то что в активно пользовался вот но я все равно могу ответить наш вопрос что принцип тот же самый вы заходите на сервер называю набирай stomper в топ доведите то по процедурам только ваше приложение должно быть собрана с отладочные символами это не создает большое и вверх этна на только он исполняется то есть там буквально там процент или меньше вот берете редис собирается плачем символами говорите перд топ видите где тупит g дпс выполнение batch команд по моему наши админы так и цеплялись перед тем как это мне передали то есть одно это создаст какой-то небольшой тупняк в приложении но незначительный но без ступни к никак как вы еще этот ловить и вопросы о памяти хип трек он точно также можно может цепляться приложения цепляться от него по kontrol ц да интересно но тогда краткий ответ я вот прямо сейчас не знаю наверно по старинке там строить графики искать в каком релизе это сломалось как обычно откатывать накатывать не вопрос и здесь справа ты сказал сам конце доклада ну про про инструкции процессора которые помогают сделать делать замеры вопрос как раз именно про продакшен потому что очень часто картина который мы видим на девелоперской машине оно отличается от того что на продакшене особенно когда начинается огромная нагрузка может пожалуйста ну осветить вот немножко о чем ты говорил говоря про поддержку со стороны процессора и вопрос такой что есть сегодня для того что что помогает в железе понимать что происходит с авто мне внося сильной нагрузки на сильных искажений в работ сама программа потому что забудьте запустить valgrind ну просто невозможно ты не выйдешь даже на нужную нагрузку вот что можешь здесь по деталь немножечко раскрыть может быть ты что-то видела или хотя бы до шкид инструкции чуть-чуть куда гуглить мне кажется это смешанный какой-то вопрос потому что он с одной стороны про инструкция сэндлер с другой про отличия нагрузки в продакшне и на ноутбуке разработчика но до под нагрузка на час себя ведет не так как на у разработчика задача разработчика это уметь воспроизвести именно тот кейс который проявляется на продакшне вот ну пожалуй это все что я могу сказать мне как это с моей перспективы выглядят да то есть опять же я не админ мне сказали у нас на продакшене вот такой stack trace вот он прим кусок держи примерная схема такая примерно данные такая разберись почему тупит вот ну и я подбирал такие данные такие запросы чтобы получить такой же стектрейсы вот когда я разобрался что вот он стык то есть вот у меня такая же такой же кейс с президент я его правлю действительно довольно толпа править на ноутбуке разработчик какой-то другой battlelog мне трудно ответить на этот вопрос потому что я не совсем java программист я видел в блоге у брэндона то что он с помощью бпф а если я не путаю с помощью by пифа очень круто profile java это было буквально там недели две назад поэтому вы по истории постов легко найдете вот у него есть по уму же даже где-то видео выложено вот я думаю там есть ответ на ваш вопрос раз спасибо за доклад вы используете свои не той веры там гугла выскажемся ланговски taser давай не думаете я думаю что все не дайверы это очень здорово и но это мое субъективное мнение и если бы я описал какой-то session на проект с нуля я бы сделал так чтобы в тимси сели в демпинг вот с анькой зиры прогоняй подгонялись постоянные если что-то пошло не так даже если это не совсем вина приложение опросы не тайзер тупой все равно откаты вал бы и делать так чтобы она проходился не кайзер и потому что они находят реально очень клевые ошибки к сожалению по загрыз это проект немолодой ему там 20 лет недавно была и когда он создавался просто не той веры не знали их не было и я пытался проталкивать пачек которые исправляли что то что находится не кайзером например это у меня есть однако истории на тему например у вас есть записи в рейдах и блоге да и как это возрасте работает вы выделяете там кусок памяти я не помню на стойке или малаком потом туда у вас есть пять структуры до который соответствует записи валя вы туда что-то записали записали записали потом сделаете райт и вот эта штука уходит вал ну и всем следом проблема в том что вот эта структура она не идеализируйте целиком и там мы есть за счет выравнивания мусор меджидова полями и ну строго говоря это вот ну с точки зрения такого чувака помешанного на безопасности до security задроты это большой бак потому что у вас что то что было в памяти а ну вот раз и уехала файл вот это могут быть маленькие кусочки по ролей вот то есть я это нашёл я приложил предложил патч и его к сожаление отклонили сказав что ну это конечно здорово дано мы не хотим обновлять эту память и потому что это дорого и если у человека есть доступ к валу то наверно у вас еще больше security проблемы чем там утечка порубает из пороля вот ну наверное прагматично вот на отвечая на ваши вопросы с анитой zero это крутейшая штука я всем рекомендую их использовать спасибо за доклад вопрос такой вот ну по крайне мере мне пришлось столкнуться есть вот приложения ну точнее напряжения потоки которые постоянно что-то опрашивают ну полинг вот такой вот и вот на самом деле вот вопрос в том как вот их можно нормально провалить потому что у них вот эта функция опроса в том же перси всегда будет в топе и с очень большим отрывом от всего остального что они делают при том что вот эти вспомогательные функции которые там кроме вот этой функции они тоже очень важно если они будут там проседать то в итоге производительность будет сильно ниже но вот именно из за того что то поле щи и функции с время в топе очень сложно понять там по сути чуть не статистическая погрешность на все остальные функции сталкивались вы есть какие-то подходы как вот именно болящую функцию чуть-чуть отодвинуть назад и больше сосредоточиться на вот остальных я так слета не вот не готов предложить прям супер крутой решение кроме разделить на несколько процессов например а вы полете там hated апреле чтобы полить нет ну просто я вот не разработкой занимаются там по сути все потоки они занимаются чтением без блокировочным из очередей они читают что-то из очереди при этом не блокируется если они что-то прочитали они быстро они почти что все время висят на этой функции чтения и разбить это на несколько под потоков но не возможно не все будут поле щами вообще где почти что все потоки полисе и там очень сложно искать затыки вот очень сложно при том что казалось бы да чуть чуть вот какой и flesh не добавляешь вроде бы не изменяется нагрузка палящий функция особо но приложение проседает под производитель ством не 10 гигабит 98 становится вот но думал что может быть подскажите что нет я боюсь а вот так слет не готов вам ответят довольно такой специфический кейс в общем случае я бы рекомендовал мне полить ну как-то по-другому получать данные раз спасибо за так ладно было очень прикольно вопрос собственно такой вот допустим у меня есть сервис неважно на продакшене или нет вот он не работает все зашибись но в какой-то момент бах там он за пять секунд там все 32 гигов выжил начал слопать это происходит в рандомные совершенно момента времени вот и как бы единственное что успеваешь сделать это допустим хип снять просто с него пока он вообще полностью не умер и сервак не лег и ты такой смотришь допустим по коду и не понимаешь один ход такой божественный все круто выглядит потом смотришь valgrind монти говорит ну дак твой кот чего классный там нет никаких не утечек ничего вроде нет вот ну как бы он типа не потечет вот каким то образом из этого дампа допустим от хип треком тем же можно что-то вытянуть там не знаю каким быть типы может быть объектов самых часто выделяем и грубо говоря там если если у вас есть какое-то достаточно большое время в между тем что вот вы заметили этот кейс и и все упало до нет нет времени вот есть там всем 5 секунд и все и до свидания дальше уже ничего не сделать но скажем так если вы успеете хип треком подрубить скорее всего он вам ответит что потекло вот нет так нет ну а что тут сделаешь у вас продолжение работа хорошо потом раз выпала ну просто вот как бы допустим хип есть я его в какой-то момент допустим успел поймать сервис успел хип снять просто и у меня вот он лежит поэтому he put а можно как-нибудь а у вас на чем год есть ли секрет на плюсах я слышал я сам это не использовал но коллеги мне подсказывали что есть плагины для gdb которые если у вас есть корсар 8 и символами то вы можете построить какую-то статистику но я никогда не пользовался это интересный кейс спасибо спасибо подсказывают что есть на питоне плагин такой спасибо за доклад такой вопрос вот когда сталкивался сам с выбором профайлер а один из таких важных аспектов был то что некоторые профайлер и они сами очень большое влияние на производительность оказывают и вот из-за этого результаты там смазываться могут сильно вот из тех инструментов которые вы представили можете как-то отранжировать их по степени влияния на само приложение но я специально вот вы не советую walk right потому что он именно грешит этим перф он особо такого не вносят хет-трик он особо не вносят то есть нет ну да себя разумеется они какую-то вносят погрешность но насколько я осведомлен она не достаточно большая чтобы портить результаты чтобы не достаточно сильно портит понимание где тупит или где утекает то есть нового названы инструменты в этом плане хорошее но у нас еще есть минут пять если кто-то хочет что цена чем он подготовится ну тогда всем спасибо ловить меня в кулуарах спасибо"
}