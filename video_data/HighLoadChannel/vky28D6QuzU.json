{
  "video_id": "vky28D6QuzU",
  "channel": "HighLoadChannel",
  "title": "Неочевидные детали при запуске HTTPS в OK.Ru / Андрей Домась (Одноклассники)",
  "views": 1705,
  "duration": 2225,
  "published": "2017-04-22T14:47:57-07:00",
  "text": "разработчики и разработчики мобильных прилавков так всем доброе утро я поздравляю вас с началом этой замечательной большой конференции сегодня мы хотим открыть эту секцию в этом зале с 2 докладов посвященных безопасности и шифрованию и представит первый доклад будет я хочу представить докладчика андрей дома из компания одноклассники я думаю что про них не нужно много рассказывать вы и так про ним про них сами знаете наверно больше меня поприветствуем докачка я передаю тебе слово спасибо всем привет как меня слышно окей тогда давайте начнем еще расскажу кто я такой я ведущий системный администратор в социальной сети одноклассники ответьте мне пожалуйста на вопрос как вы думаете на чем зарабатывает социальная сеть на рекламе прозвучало среди прочего конечно безусловной рекламе и вот представьте себе что у нас были случаи когда мы обнаруживали что некоторые не очень хорошие провайдеры операторы на нашем портале на лету вырезали нашу рекламу и на ее место подставляли свою спустя какое то время когда мы уже готовились к запуску дтп с а мы услышали интересную мысль на хайло 2015 эта мысль прозвучала в докладе наталия орлова скорость доставка для пользователя она заключается в том что страницы плохо ттп с у доходит до пользователя быстрее это звучит немного странно на это действительно так потому что антивирусы и теперь уже не могут анализировать трафик потому что он зашифрован еще через какое-то время мы решили запускать на странице своей социальной сети финансовые сервисы и в тот самый момент по совокупности всех этих причин мы поняли что уже мы уже готовы уже пора брать и включать х дтп с запускать туда пользователей вот перед вами на экранах примерный список тем в которые необходимо погрузиться изучить исследовать чтобы успешно реализовать подобный проект об этом мы конечно говорить с вами не будем есть совершенно замечательные mozilla вск айви кино которое очень подробно разжеванный все эти вопросы вот свой проект если вы его только начинаете я рекомендую начинать именно с прочтения этих страниц там даже есть где-то can конфигуратор генератор конфигов для разных типов серверов если уж совсем не хочется заморачиваться мой доклад называется неочевидные детали при запуске для начала я предлагаю вам вернуться немного в прошлое к тому моменту когда мы только стояли были готовы взяться за этот проект у нас были некоторые сомнения беспокойство на этот счет что нас беспокоило мы прежде всего мы опасались что понадобится больше железа оно и понятно криптография дополнительные вычисления дополнительное процессор на и время значит надо больше больше камней вроде а у нас и без того много мы боялись микс от контента так называемого напомню что это такое если страница загружена по х ттп с какие-то отдельные элементы загрузились плохо ттп браузер уже не может в полной мере доверять всей страницы поэтому он вместо красивого зеленого замочка нам в адресной строке нарисует что-то желтенького в данном случае тщательный знак скажет пользователи что там не все в порядке мы решили раз уж делать значит будем делать как следует у нас должно быть все всегда зеленое но надо заметить что наши страницы весьма сложны там очень много элементов которые мы загружаем из разных в том числе неподконтрольных нам источников как выявлять в браузере микс от контент как с этим бороться этот вопрос оставался для нас открытым и этого опасались мы боялись что все-таки что-то начнет тормозить у пользователя а как же de peau антивирусы все должно ускориться тут надо немного отступить от основной канвы моего повествования есть такая штука в телекоме называется round trip time это время по сути дела время приема передачи время которые нужно потратить клиенту на отправку например пакета удаленной стороне плюс время который клиент потратят на ожидании ответа от удаленной страны а потому что это пакет был успешно там получен вот перед вами простой алгоритм установки десяти соединения то есть это хоть и т.п. можно и так сказать и вот например из наших основных дата-центров пинг до нью-йорка составляет 200 миллисекунд что это значит это значит что только работая на обычном хоть и т.п. пользователь в нью-йорке тратят 200 миллисекунд в холостую до полезные данные еще не передаются он просто сидит и ждет давайте посадим этого пользователя на хате тпс что произойдет добавится еще какие-то стрелочки еще какое-то бесполезно и взаимодействие здесь будет два дополнительных раунд 3 по 2 по 200 миллисекунд 400 что это значит а это значит что когда мы включим для этого пользователях от tps он уже будет ждать больше чем пол секунды полсекунды много это или мало для пользователя у нас например вот в америке активных пользователей примерно 1 миллион то есть 1 миллиона людей мы чуть-чуть подпортим жизнь вполне себе есть над чем поработать вот такие вопросы стояли перед нами мы нашли на них ответы за крыльев для себя но по дороге мы столкнулись с множеством подводных камней об этом и хочется рассказать хочется чтобы наш опыт не прошел впустую может быть он где-то еще принесет пользу итак давайте пробежимся по этим проблемам и как мы это все решали и так цепью и round trip time сначала позволю себе напомнить как происходит установка ктп соединения tls соединение браузер веб-сайт браузер пришло по веб-сайту по протоколах и дтп с дальше происходит обмен всякой разной информации обмен сертификатами согласования параметров шифрования самих шифров затем клиент и сервер браузер веб-сайт согласовывает так называемый мастер мастер ключ это симметричный ключ с помощью которого потом будет шифроваться весь передаваемый трафик вот эти вот набор информации из двух сторон называется tls сессии есть клиентская tlc сия есть серверное а все это действо называется фу-х джейк offutt шейк в мире ссср в мире tls это очень плохо это зло почему все значит зло заключается вот в этой фазе во первых там скрыт целый 1 round trip во вторых она очень она очень интенсивно потребляет центральный процессор потому что происходит вычисления в рамках алгоритм диффи-хеллмана очень большие степени возводится числа и один из путей оптимизации это каким-то образом или полностью устранить вот этот этап согласование мастер-ключа или каким-то образом сделать так чтобы он происходил пореже и действительно такие механизмы существуют рассмотрим один из них клиент-сервер фух и джейк состоялся с двух сторон образовались сессии клиентской и серверной а как только это произошло клиент-сервер сообщает клиенту аиде свои сессии все просто дальше происходит взаимодействие после чего клиент сервером разбегаются через какое то время когда клиент снова приходит к серверу он помню что у него уже есть клиентская сессия какой-то серверная дион сервер сообщает этот один сервер своем каши сессий в базе данных сессий находят цельсию если нашел он восстанавливает к себе ее в память они начинают использовать эту клиентскую и серверную сессию то есть они вернулись к тому самому состоянию которые вот только получили после полного хан шейка вот ртт сохранили центральный процессор время сохранили все здорово это все называется обрели этот хан шейк но у нас конечно с вами не маленький проект из одного сервера серверов много-много фронтов может быть и такое что пользователю перекинет на другой сервер но сейчас он пришел на один сервер через несколько секунд он пришел на другой сервер что будет происходить он попробую другому серверу предъявить тот же самый совершенно иди да разумеется другой сервер 2 вот сервер 2 он у себя ничего не найдет в своем каши этой сессии он скажет клиенту что твоя сессии не подошла потому такой едине неизвестен давай начинать с самого начала заново запускаем фух анджей то есть весь профит теряется и вот интернет rose а это довольно старая технология довольно старый механизм интернет роз интернет-проекты росли у всех становилась много серверов и потребовалось что-то более более качественное более более рабочие в такой схеме когда много серверов и в следующей своей инкарнации протокол sl а следующей инкарнации называется tls протокол получил новый механизм вот чем он заключается то же самое состояние полная henschel состоялся клиентской и серверной сессия как только образовалась сессия на стороне сервера сервер берёт эту сессию прямо вот кусочек памяти сессий и шифрует у с помощью никого ключа в результате получается такой блок данных этот блок называется ticket сервер отдает этот тикет на хранение клиенту клиент на своей стороне ассоциирует клиентскую сессию и ticket и где-то там сохраняет потом происходит взаимодействие две стороны разбегаются через какое то время когда клиент снова приходит к этому серверу он помнит что у нее есть ticket у него есть его клиентской сессия и он и тактики передает обратно серверу сервер пытается с помощью этого ключа обратно дешифровать ticket достать оттуда сессию вот и случае успеха случае успеха сейчас загружается в оперативную память сервера сервер начинается не работать опять обрели тонах хан шеек все здорово в чем главное отличие от предыдущего механизма ключ нам достаточно на все наши сервера разложить ключ ticket везде может быть успешно дешифровка то есть это такой стоят нас механизм предыдущий механизм зависел от состояние сервера этот механизм от состояние сервера не зависит то что я сейчас рассказывал в этот механизм с ticket ими это всея руси пятьдесят семьдесят семь можно его почитать это все хрон хорошо знакома ничего нового здесь нет чем я хочу вас удивить что нового я хочу вам сообщить мы конечно же у себя захотели реализовывать именно эту схему она больше всего подходила но перед этим мы решили все протестировать собрали лапы в лабораторных условиях начали запускать тесты и надо сказать что у нас продакшене очень много разных фронтов работает на базе разного концов снова не очень софта весь этот софт объединяет одна штука упал с л у нас вроде везде одна и та же версия из одного и того же пакета все точно также собрано ход этих фронтов работается опыта с целью везде одинаково все тоже самое и вот мы запускаем тесты на нашей лабе клиент пришел к джинкс у чего-то там про взаимодействовал с ним получил ticket окей с этим ticket onclick клиента идёт к другому engine ксу на обоих и джинсах лежит одинаковый ключ для шифрации дешифрации этикета что происходит дальше тикет подходит все как вы руси механизм работает профит получен все замечательно в этой жалобе тут же с этим жить и китам идем к другому фронту на х прокси то мы же точно такой же ключ что должно произойти судя по r и все все должно заработать но ticket почему-то не подходит к прокси говорит клиенту что твой ticket не валидный давай заново делать полный хан шейк если тут проблема подумали мы скорее всего есть потому что представьте страницы нашего портала на нем множество элементов все элементы загружаются с разных с разных наших сервисов на всех разным на всех сервисах работают разные типы фронтов и что же это получается клиент придет сначала на один сервис загрузит там картинку получит ticket а потом с этим пакетом когда пойдет на второй сервис второй сервис ему скажешь the ticket не подошел и клиент в судя по в соответствии с irs всех должен у себя это тикки тэнго лидировать то есть получается фронты будут постоянно портит тикеты друг друга и весь этот механизм равале развалится мы стали исследовать что же происходит на самом деле начали мы серверной стороны элмер приложение фронт там образуются серверные сессии которые потом шифруются и превращаются в тикеты которые дают с клиенту на хранение так вот что здесь важно в момент запуска сервер устанавливает у себя так называемый сессионный контекст это произвольный набор данных произвольной длины как правило просто текстовая строка как только он остановил себя вот этот сессионной контекст дальше приложение а именно о панель начинает этот системный контекст добавлять во все сессии после того как сессия восстанавливается с помощью совершенной идеей с помощью кики то неважно сервер упал на цель который в нем работает он проверяет что вот этот социальный контекст из сессии до текстовая строка соответствует тому что сейчас установлена в сервере если соответствует сервера пытается использовать если не соответствует сервер считает сессию не валидный и сообщают об этом клиенту интересно также что этот сессионной контекст ни для чего более не используется то есть вот он нужен специально под он есть ломает механизм и больше никакой пользы не приносит что зачем нас это удивило мы пошли посмотрели банально посмотрели документацию в опу нас и цели к функции которые устанавливают это сессионной контекста там прямо и написано что эту да действительно это механизм эта штука которая ломает механизм восстановление сессий на тот случай если вдруг сессия создана в другом фронте другом типе front она в другом совсем мало ли что и это действительно имеет смысл это резонно потому что сессия загружается в память и там там есть что сломать окей вот просто для справки вот такие сессионные контекст и устанавливаются в разных сортах open source нах это прямо захардкожены и значения можете потребовать поискать это действительно так это была северная страна дальше мы стали исследовать клиентскую сторону что происходит там вернемся к нашей первоначальной картинки вот этот механизм описан все вроде бы работает мы с вами упускаем тот один важный момент каким образом клиент ассоциируют конкретные текет с конкретным сервером с конкретным сервисом ведь клиент браузер он ходит по всему интернету у него этих тикетов там очень много от разных сервисов почему он наносит нам подсовывают именно наш вы все 57 семьи как это не регламентирует совершенно не понятно как это все происходит но благо есть о том собственный клиент и вам под собственные браузера мы посмотрели как это сделано там я могли посмотреть большинстве случаев все оказалось банально это full quality domain name и порт некоторые клиенты добавляют еще версию протокола rip кита параметр шифрования возможно что в итоге нужно лезть можно ли везде использовать один ключ или нужно везде на каждый тип франта раскладывать свой ключ будет ли все это работать на самом деле можно использовать теоретически можно использовать везде один ключ разложить по production ну дальше клиент будет разруливать сам это теоретически практически конечно чтобы вписаться в рамки и все нужно использовать на каждом типе фронта свой отдельный ключ пока это ничего не ломает но вот чтобы избежать избежать возможных сюрпризов в будущем просто лучше соответствовать эры все его не нарушать мы уменьшили потребление центрального процессора вот этим самым механизмом потому что исключили сделали в фазу согласование мастер-ключа очень редкой все хорошо но это полностью да мне скомпенсировал весь прирост на центральном процессоре от перехода на х ттп с мы решили посмотреть где еще можно что улучшить и посмотрели на хардварные уровень и увидели там такую штуку под названием выехал x2 это расширение системы системой команд x86 + различные улучшения в чем заключаются эти команды и улучшение они позволяют ускорить и облегчить вычисления которые криптографические вычислениями так совсем коротко говорить и вот примерно год назад вышла lts версия окон с эля 102 в которой какой-то код был написан переписан для работы вот с этими улучшениями в данный момент в большинстве дистрибутивов 102 еще нет там 101 используется в лучшем случае если мы хотим получить профит от этих улучшений нам придется самим собрать пакетика как мы помним последнее время очень часто находит уязвимости опыт нас с или придется пакетик мантий нить не забывать обновлять закрывать там дырки всякие стоит ли тут овчинка выделки каков от этого профит а вы excel x2 вот перед вами график утилизации центрального процессора нашего типичного фронта тут видно три фазы первая фаза этого просто просто tls есть дтп с есть никаких оптимизации не применено вторая фаза мы перезапускаем фронт на с open ссср 102 этот центральный процессор поддерживает а вы x расширение экономия циpкa 20 процентов если бы процессор поддерживал оу x2 то экономия была бы примерно 30 процентов сейчас надо сказать есть еще и а вы x 512 но у панаса цель пока еще не умеет этим ничего полезного делать и последнее последняя фаза мы подключаем сюда еще вот эти вот сессионные ticket а у которых я говорил итогу экономия составляет примерно 35 процентов это почти стопроцентная компенсация вообще прироста цикл от всего проекта от перехода на дтп с вы можете спросить в чем тут проблема здесь и так огромный запас подсыпку да зачем вообще было чего-то улучшать у нас очень много серверов у нас несколько дата-центров и например на случай вылета целого дата-центра нам необходимо иметь везде определенный запас по центральному процессору потому что в живые дата-центр сразу прилетит дополнительная нагрузка надо быть к этому всегда готовым давайте пойдем дальше давайте попробуем подумать на что клиент еще тратит время чтобы такого улучшить центральным процессором разобрались теперь боремся с временем на клиенте напомню вам как работает public key infrastructure есть некий авторите он выпускает некие сертификаты сертификаты устанавливаться в качестве серверных на веб-сайт и сама вторить инсталлирован в базу данных браузеру в качестве доверенного браузер приходит по протоколу ftp с к веб-сайту и дальше он смотрит что ему предъявляют сертификат который выпущена в туалете которому он доверяет ну соответственно браузер доверяет веб-сайту тут есть одна небольшая проблемка она связана с тем что серверные сертификаты как правило выпускаются на очень длительный срок полгода-год а то и того дольше одна из задач браузер это защиту своего пользователя и может случиться так что браузер пришел к веб-сайту а сертификат был отозван несколько дней назад браузеру конечно хочется своего пользователя защитить единственная возможность как он это может сделать про взаимодействовать со вторить и прийти к нему тут же и спросить этот сертификатом до сих пор валидный или тому же ли чего-то не то с ним и действительно браузер это делает он приходит к вторить и по специальному протоколу гусей спи и спрашивает у неё статус этого сертификата который предъявил ему веб-сайт что здесь плохого а то что пользователь ждет пока браузер про взаимодействует со вторить и авторите это не неподконтрольные совершенно среда для веб-сайта веб-сайт никак не может гарантировать скорость обмена информацией между браузером и авторите но обратим внимание вот ось и эспер этот синий квадратик это ответ по протокола васей speck который отдает авторите браузеру этот ответ подписан подписан для того чтобы статус сертификата было сложно подделать подделок по дороге подписан что это значит для нас для нас это для веб-сайта а это значит что мы можем сами сходить к этому авторите скачать у него забрать этот ответ где-то у себя скопировать на своей стороне и как только к нам приходит пользователь мы сразу же ему вместе со своим сертификатом будем этот ответ показывать ответ действительно в течение нескольких дней как правило эта технология называется очень pitstop link стерлинг то есть мы прикрепляем к нашему сертификату статус нашего сертификата сразу же каков выигрыш от этого всего на каков выигрыш вот кусочек трафика из так можно сказать снятый в жарком это я firefox он зашел на наш сайт одноклассники в тот момент когда у нас ось из pitstop link был отключен здесь видно что мой браузер firefox захотел при взаимодействовать с нашим авторите который наш сертификат выпустил вот он спрашивает статус нашего сертификата мой браузер на это потратил 67 миллисекунд как мы можем оценить это время много мало с учетом того что сама страница отдавалась потом 200 миллисекунд мы видим что есть деградация 25 процентов по времени по времени сервиса справедливости ради надо сказать что это деградация будет только при первом заходе браузера на на сайт это что касается например firefox фокс имеет в памяти кэш усе спи ответов то есть он один раз сходит к авторитету оси и спи ответом потом будет держать его в памяти до тех пор пока браузер не перезапустится или до тех пор пока ответ не устареет профит есть наличка нам говорит профит есть но есть и боль есть и боль давайте посмотрим какая боль как я уже сказал оси и спи имеет срок срок жизни усе спи ответ имеет срок жизни нужно периодически ходить к своему авторите заново выкачивает новый свежий ответ что здесь нас может поджидать сломался механизм этой ротации почему-то мы не смогли достать свежий ответ и начали отдавать пользователю просроченной протухшей что будет а сразу будет downtime вообще разные браузеры они в разные степени пока еще поддерживают этот механизм эту технологию сие списке пленку например firefox opera они сломаются сразу опера при этом например покажет красную страницу с ужасной ошибкой напугает пользователя ну другими словами этот downtime плохой усе и спи ответ мы не можем контролировать авторите мы не знаем что нам он отдает поэтому если он отдаст им что-то не то а мы это что-то не то попытаемся сучить пользователю будет такая же красная страница в опере будет такой же downtime меняем серверный сертификат это уже точно то чего никому не удастся избежать сертификат на сервере рано или поздно устареет его перевыпустят его придется везде обновлять и тут будет такая проблема вы отдаете усе спи ответ для одного сертификата для предыдущего старого вашего а сам сертификат у вас уже отдается новый сертификат с ответом не будет совпадать до статуса сообщайте для другого сертификата это тоже означает down time вот хороший пример скриншот с mozilla вс кого форума у нас как-то произошла проблема в соусе из pitstop лингам буквально за считанные минуты на форуме появилось сообщение от пользователя который обвинял уже firefox в том что он почему-то не может взаимодействовать с одноклассниками что-то там видимо сломалась на самом деле сломалась у нас зачем я вам это показываю я показывают хочу продемонстрировать масштаб и важность одной штуке эта штука это механизм отключения российский степ линк на лету такой стоп-кран рубильник рубильники вообще необходимо везде и всегда в при запуске кттс а рубильники необходимы точно дальше будут еще примеры где рубильники вам могут помочь в общем для стептинга это это маст хэв или проще не делать вовсе из песка пленка вообще без рубильников но пойдем дальше mixed контент что в нем плохого в чем сложность борьбы с ним для начала я напомню какой он бывает он бывает активный-пассивный пассивный это микс от контент который так можно сказать произошел в отношении элементов которые имеют доступ только к части страницы до например у элемента m&g картинка этот элемент имеет доступ только к той части страницы где собственно картинкой отображается активный нецид контент это такой вид контент который произошел в отношении элементов имеющих доступ ко всей страницы например элемент скрипт то может загрузиться java script который потом со всей страницы может делать все что угодно в чем между ними разница если происходит пассивный микс от контент браузер просто уберет зеленый замочек за адресной строки поставить вы статины знак если произошел активный микс от контент the browser полностью блокирует загрузку и работу этого элемента активный микс от контент очень опасен потому что например если будет заблокирован какой-то java script на странице что-то сломается в чем сложность чем сложность борьбы с митт контент во-первых он происходит в браузере это какая-то удаленная неподконтрольна и нам среда мы не можем посмотреть что там точно происходит не можем заглянуть в консоль не можем запустить тест и на странице много чужих ресурсов в нашем случае например бывает такое что мы показываем какой-то рекламный ролик который мы получаем из баннерной сети и внутри этого плеера внутри ролика происходит нецид контент мы обращаемся к баннерной сети говорим что ребята у вас тут микс от контента не говорят а мы не знаем это не наш player мы сами этот ролик берем от поставщиков каких-то рекламных вот пример микс от контента который когда-то произошел на страницах нашего портала в консоль браузер и открыто два сообщения желтая красная желтая the wording о том что месяц контент имеет место быть красная это что-то непонятное что-то там report on ли вот поговорим про красные что такое report он ли есть такой заголовок в дтп ответе content security policy с помощью этого заголовка сервер может установить некую политику для страницы политику того какие ресурсы можно загружать какие нельзя если ресурс не совпадает с этой политикой the browser блокирует загрузку этого ресурса к чему я про это к тому что есть у нет у этого заголовка собрат все тоже самое только report он ли такую же политику можно передать вот но при этом браузер ничего блокировать не будет а в этой политике помимо в этом заголовки помимо политики будет передан еще и некий адрес так вот если какой-то ресурс не будет соответствовать политики the browser пошлет на этот адрес некий отчет что это значит это значит мы можем написать такую хитрую политику в которой укажем что все что не все что загружается ни пуха ттп с у слать об этом отчет куда слать вот на какой-то наш адрес на этот адрес по запросам будут сыпаться вот такие отчеты форме джейсон формате джейсон здесь нас прежде всего интересует две верхние строчки blocked юра это элемент который пытался загрузится откуда он пытался загрузится документ юра это где произошел mixed контент все замечательно но есть один негативный момент очень по-разному разные браузеры шлют эти отчеты вот этот отчет он скорее всего был сделан в хроме потому что у chrome и есть такое свойство он отрезает в адресе заблокирована или заблокированного элемента отрезает все кроме доменного имени оставляет только доменное имя вот такое неудобство но это еще на этом на этом все беды не кончаются есть и серьезнее проблемы это обильное количество мусора который сыпется в эти отчеты вот например мусорный отчет сложно сказать что здесь произошло кто-то видимо сидел на сайте fishki.net там загрузился наш виджет шаринга этот connect ok.ru при этом каким-то образом здесь оказалась замешана какой-то сафари extinction почему в итоге нам прислали отчет об этом миксы в контенте и было там mixed контент совершенно непонятно это я все к чему к тому что придется все возможные вариации этого мусора отфильтровывать вот мы это и делаем мы это фильтруем и мусор выбрасываем а что мы делаем с полезными отчетами полезно отчета мы мониторим вот примерно графика который в итоге мы получили график mixed контентом разные кривые по разным доменам можете видеть есть один лидер у нас всегда почему-то в топе болтается 12 лидера выдающихся домена это расширение браузеров которые подмешивать к нам на страницу свою рекламу и там у них происходит mixed контент так вот спалились ну это пожалуй последнее из проблем из того списка чего мы боялись вот мы все сделали закрыли все эти вопросы у нас все зеленое все быстро железо много добавлять не пришлось и мы решили что все пора пора взять всех пользователей и скажем так 302 за директе на хате тпс и мы начали это делать но все оказалось очень непросто с полом массаж стволам масса интересных моментов например старые смартфоны они взяли и сломались в чем оказалось причина когда-то очень давно крипто стойким считалось длина ключа россии ключа 10 24 бита и смартфоны вполне хорошо с ней работают в наши дни крипто стойкой считается длина ключа минимум 2048 bit смартфоны просто смартфонов оказалась не готова к такой длине и смартфона сломались что мы с ними сделали мы просто их не redirect инахо ттп с по user-agent у другая проблема smart tv когда мы начали резиденции пользователей к нам службу поддержки посыпались посыпались претензии вопросы мой smart tv и тормозит дело в том что какое-то количество наших пользователей сидит у нас на портал на портале прямо вот через браузер smart tv и через приложение для smart его через браузер набирают там какие то сообщения переписываются с кем-то и у них все это начала тормозить пришлось тоже в общем то сделать для них исключения по user-agent у и не redirect тить и самое пожалуй такое интересное начале мы переключать пользователей они redirect это все хорошо и нашу службу поддержки star стала штормить туда масло посыпались жалобы о том что мой пароль не подходит мы сразу подумали что сломали авторизацию себя на портале срочно отключили redirect вернули все обратно это еще пример номер два когда вам может понадобиться рубильник да что-то отключить вот но нет авторизацию мы не сломали как думаете что было да верно пользователи были сохранены пароли в браузере а когда в руле в строке поменялось схема с хаты . хата тпс в общем-то браузер перестал мочить этот адрес да и пользователи сразу пытались с томми как могли свой пароль многие не вспомнили что мы сделали в этой ситуации мы стали включать redirect очень плавно включения redirect у нас заняло несколько месяцев в итоге мы специально растянули только чтобы спасти нашу службу техподдержки чтобы ее не затопило собственно давайте подведем выводы из моего выступления из моего доклада лучше иметь отдельный ключ для каждого типа фронтов для шифрования тикетов это совсем необязательным но вот что то мне подсказывает что лучше обязательно имейте оперативный механизм мимо их механизм для оперативного отключения российские стептинга или или лучше даже его не делайте если хотите заниматься этим механизмом микро-контент все из перри порт и вполне подходящая технология для этого очень полезная готовьтесь потому что будет много мусора надо будет посмотреть что это за мусор и сделать соответствующие фильтры ну и придется что-то делать со старыми клиентами потому что кто-то наверняка сломается смартфон это далеко не все что что сломалось браузер и забудут сохраненные пароли ну приготовьтесь объяснить пользователям что порой нужно будет восстановить у меня все спасибо что слушали надеюсь что будет полезно готов ответить на ваши вопросы да да да у меня вопрос простой вы вот эту штуку которая мониторит таки из 5 чад был панстарс наполнялись выложить нет это часть нашей сложной большой системы мониторинга и так это просто до в итоге какие сейчас версии протокола вас цель tls поддерживает одноклассники с вытри плс 10 я к сожалению не помню 11 т.р. с 12 до прошу скажите каким образом вы переводили клиентов плавно у нас есть два механизма плавный работы с пользователями все зависит от ситуации в каких-то случаях мы работаем с пользователем зависимости от их юзера иди то есть мы можем сказать что вот этому интервалу usa rogue грубо говоря включить redirect вот это первый способ второй способ у нас есть много фронтов пользователя между ними равномерно балансируется это позволяет нам например включите redirect на части фронтов потом но еще части и так далее кто-то еще пора заканчивать если вопросов больше нет да всем спасибо я буду еще здесь какое-то время находился могу полу арну отменить"
}