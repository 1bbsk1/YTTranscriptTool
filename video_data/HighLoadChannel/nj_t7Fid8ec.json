{
  "video_id": "nj_t7Fid8ec",
  "channel": "HighLoadChannel",
  "title": "Prometheus Operator: \"Out-of-the-Box\" Monitoring as a Code / Станислав Щербаков (Plesk)",
  "views": 2458,
  "duration": 1068,
  "published": "2021-10-04T02:47:02-07:00",
  "text": "всем привет на голос станислав друзья называют меня статьям что про себя могу сказать 85 года выпуска все запчасти оригинальные видел дождь 22 dial up by bets фидонет керну обслуживала порядка 700 а хостов порядка 2000 виртуалок кубов ский кластер видел ну вот 50 и порядка 400 подав компании блеск блеск это хотим панель 6 процентов интернетом 20 лет на рынке сильная команда разработчиков о чем будет сотни шни мой спич на типа порядка пройдемся значит от старых систем мониторинга до новых проблем и мониторинга как быстро легко починить сервис discovery простите как бы стали легко за мониторить инфраструктуру при помощи стирать discovery новых решений расскажу про прими того супер атор что это за решением и как мы катим собственно мониторинга закон про брейден инциденты выводы я буду вам рассказывать где мы находимся для понимания что было удобнее мониторинг состоит из трех китов это метрики alert и даже барби самого начала я что первая видел это nagios дальше был когти добавили графиков после этого увидели zabbix современной системы мониторинга например ну да там позволяет в отличие от zabbix a discovery сервис автоматически если раньше мы использовали юзер параметры и делали это в руками пусть каждый сервис нам приходилось добавляет руками то теперь надо то она позволяет нам самим discovery можно поставить вместо zabbix агент например а также примут что надо то она умеет standalone то что даже если у вас свалилась гора славную прими то вы сможете зайти на хвост и на нем собственно посмотреть что происходит у графа наверняка вы все знаете что касается аль ирвингом я стакана отличный инструмент называется карма он позволяет собрать вам с агрегировать данные совет менеджеров в в один простой визуальный даже борту здесь может быть несколько кластеров несколько лет менеджер вот если вот сто раз принимать в 1 лерд которую в пол спросите в жизни мне показался то это волки все кричали волки волки никаких волков не было давайте введём в плане как проблема мониторинга первый этап сборник вы не однако до сталкивались когда разработчикам надо выходить метрики admit реки только через админ мы проехали тот момент а метрики нас больше вчера все наверняка знакомый запрещено нас история а мы все мы хотим наверняка использовать не только я за год ну не только что это модно потому что если вы поправите руками например даже борту до и после при инсталляции или например вы не может учитывать изменения в коде можно смотреть акту когда что за к митингу прогиб наверняка все в курсе и анализ более то когда мы переехали систем мониторинга , например на примете у нас на чашу весов 2 система одна из них про металл с которым мы уже хотим используйте 1 zabbix которую мы не хотим уже сколько стану 2 поддерживать систему дорого youtube и ресурсом для некоторых из моих коллег оказалось что не так сложно слезть со старой системы давайте использовать просто новую как как мы до этого дошли мы взяли prometheus он собирает метрики в качестве консула матч использовать консул не обязательно тут использовать код сможете использовать любую стену считай discovery вместо zabbix агентов мы поменяли нам дату в какие профитом из этого получили надо the same сзади скарлом use параметры которые раньше приходилось обручена делать как это все конфигурируется очень просто при помощи и мало прошу обратить ваше внимание что у надо то есть отличный mitex пастой из латекса я буду на картиночке этот а пиво 1л metrics переходим к принтеру оператору знаете наверняка вот никого game changer а до которых всю игру поменял весы бина к этому слева справа вот эти значки замечательная и небольшой мемасик повернитесь это просто если вам недостаточно всех это ресурсов то вы пришли на правильную презентацию кто нибудь знает что такое каждом ресурсы финишем поднимите руки ну примерно половину здорово как я пытался объяснить ну не технарям человек такое вы поднялись здесь такой вещи как плагины например система extension of nude это расширение кабины сугубо я сам каждый ресурс выглядит как заголовок таблицы оокей велю который мы в этой ресурсы пинаем соответствие зелененький что такое операторы поднимите руки пожалуйста знает ну в отлично публика давайте в подробности не буду вдаваться нас есть куб узкие ресурсы у нас есть ресурсы системные и контроллер берут одну там другое туда-сюда менеджер типичная работа оператора пользователь загружает каждым ресурс оператор обработка этой консоли шлангу предоставляет этот пластик как выглядит архитектура правит и вас оператор у нас есть сервиса и вы написали за тепло и разработчики ясира с монитора всей разминайте service monitor осмотре примите us оператора смотрят за сервис монитором добавят конфигурацию parameters давайте разберем как вы бисер с монитор ну у нас есть api версия у нас есть на успей селекторов он смотрит на namespace и и обязательно в самый низ от селекторе с лейбла обратить внимание на релиз да это релиз про металась оператора то есть в кластере может быть несколько ресурсов типа про металла супер тот оператора если не нескольких команды хотя то использовал на конфигурация то можно использовать разные что нам дает кроме того оператора с коробки вот такое количество сервис мониторов мы получили это более чем достаточно для того чтобы покрыть базовые метрики кластера то есть это кордон с api сервис менеджер там ноты к спорту ргублей хочу хочешь как это все дибашки оранжевая часть это про металл с оператором голубая часть service monitor и сердцем этот расположен в серединке находит сервис который смотрит на вас сервис но все мы сложно давайтесь кому интересно в кулуарах расскажу будет весело как работает пропиталась оператора верхней потолочная справа мы видим типа ресурсов которым он предоставляет а он за ними смотрит он же генерируются мученики квадратик справа он же генерирует park conti про медоуз of принято велась это перечитывает и также про metals оператора отправляют alert manager вы загружая каждым ресурс перезагружаете конфигурацию и alert менеджера и самого про метался так выглядит по металлу сруб это обычный типичный pompville то есть вы создаете ресурсе по про металла суровым и и allure подгорске ничего сложного какие алерта мы получили из коробки ну практически все если вы раньше поставили кубер найтись и не знали где вас креслу бейки какие вас недоступные ноды на пряди куплет лег там как эсеры контроля менеджер то есть весь набор эспоо лифтинг обернется он предоставляет сугубо гореть карет и из коробки а также губы миксин это часть про металла супер а то ну как часть это отдельный проект который которая правит комьюнити он позволяет при помощи джейсон это компилятор барды но как мне сказал один коллега еще и даже бордо не компилировать и подзаняться мечем соответственно нас это все сделала как ты выложил скомпилировал а если вы обратите внимание вот это количество до шеи то есть раньше были олег то это количество даже которые получились коробки красивый даже бортика по этот cd очень здорово поставили открыли смотрим где у нас сен кластера какие были этот лидер чем джек сколько у нас это cd лежит работает опять же абсолютно бесплатны из коробки то же самое касается куплета то есть обратите внимание нужно на графике видны нет вам пиковое значение это время у только 10 секунд если бы у меня не было про метался пирата я бы даже не узнал об этом открыл графику где-то проблемки у нас есть так что примите вас операторов не предоставляет из коробки это lol team сторож но если вы знаете как у нас слева это стоит это простите по 2 носить фактом как это называется нейлон dir-100 ради дни long тема 3 слов точно простить стоит ли стала же не его цена числе она стоит с мы относимся к ядру к этому до справа у нас лом кем стоишь в качеством инвестора чем можете использовать два варианта это либо томас либо виктория метрик санта нас это сложно это монструозно а виктория меток своде классный набирает обороты если кто-нибудь про пользовался этим то пожалуйста поделитесь экспертизу я буду рад мы находимся вот тут значит мониторинга за код а если соляр тэмми понятно можете положить сей раз монитора и прометею суровы рядом с репозиторием кода то как мы диплом свои это alert его именно платформенные мы взяли hell i handed him он стал м все это знает как ним пользу долго рассказывать не буду кто нибудь сталкивался с выпуска телефона булатова неприятная вещь когда все уже позади при крите еврейская чарты 100 и было больно достаточно ну вот теперь про металась мне про metals оператора куплю instek но так как доклад еще планировался цвета сентябре такса переименовывать не стал как мы доставляем мы взяли home взяли ансимов взяли джин геймплей ты нарисовали групп wars иван сибли для разных фармит в рейдов вот так вот коли вместе запустили вроде работает как выглядит в коде ну вот типо текущей применением используя модуль анти балка 8s посмотрели в все про металл из руды которые находятся в отдельные файлы в репозитарии таким не тот не сложным образом применили теперь сна alert выглядит вот так вот я году порно тату и надо тоже можно холмы стала сделать кубер нитью она заехала а вот типичная гирлянда ты что если надо то недоступному давай орать просили обратить внимание что достаточно удобно вещь это рам буки когда вам приходит лет вы можете посмотреть ран бук и там сразу понятно что делать если упал engine что мы делаем проверяем конфигурацию ниже -30 мин джексон в таком духе под любой из кейс можно описать четко ставится дашбордов сожалению мы пока не используем графоман оператора и мы не можем доставлять namespace доставлять граф андрские даже борды из родных мест кейсов но в дальнейшем планируем группа горя вот так мы доставляем джейсон заворачиваем в яму и потом только диплом этот вкус кубер нить из джейсен с этим недоволен и за это бред инцидента наверно моя любимая вещь почему потому что но мало кто делится личным опытом и рассказывает ну прям утром личку как она есть значит самого начала пойдем за своим но за сынок fine 1 ч не может про металл с оператором это достать ваши этот cd and point из коробки придется как-то из и discovery течет с ними сделать второе самое больное если у нас не дай бог произошло изменение кастом ресурс дефиниция схема то будет больно есть огреет гайд и не всегда это работает и не дай бог вы подумайте удалить релиз если ударить или рис вас пропадут все кастом ресурс диффе не шины и что самое обидное все еще service monitor и грохнуться у вас плотвы перекатить и все здорово платформу мониторится разработчики приходят к гибели abs а где наши метрики бизнеса gaga смотрите мой alert и работаю всё классных году здесь раз mentor пропали но можно из предыдущих релизов достать как бы не но имейте виду никогда не удаляйте в любом случае картошки не надо этого делать если вы выберите не оптимальные параметры сервис мониторов например я хочу искать свои сервисы по всем ным space ом и канала станет в 150 или 200 namespace of у вас будет в про metals оператор обращаться к бисерова настолько много чтобы перебирать все сервис так что обязательно делайте мощную space чего не может про металась операторов это обновлять консервацию самого prometheus а без перезагрузки его имейте ввиду если какие-то базовые метрики про металл из меняете то примите от вас 300 понес это прямо как к пить дать вот поэтому я рекомендую использовать два медиуму то про медоуз и для того чтобы не было драк графиках и такая больная вещь как будто отсутствие меток нет метрик нет проблем на самом деле отсутствие меток эта проблема у нас карбид перестал работать так что имейте ввиду что если вас нет ну это не для даты с ваших метрик экспортеров то делать и на это alert и такая еще не очевидная вещь вы вроде как мы катим по металлу с оператор вроде все здорово но если у вас api сервер меньше терабайт памяти он будет поломки лиц а потому что происходит мы те самые хуки балет большого объема ну как бы она просто не работает ну и давайте попробуем проведут про заключение скажем что админ у нас больше не ботаник разработчики сами могут доставлять своей alert и метрики и данное решение вкладывается любой по план где вы используете кубер нить из с вам просто надо добавить в целом чарт 22 ресурс гиппо service monitor и про металл из рук ну и это все легко режется на трассах сразу код потому что вы эти самые ресурсы могут можете комитетов гид против сам вопрос спасибо большое так давайте вопросы как обычно говорю что вопросы можно задавать как здесь так и в онлайне если кто-то выйдет к нам в эфир будет супер и за лучший вопрос мы вручим книжку вот поэтому давайте активней да поехали есть у нас в микрофон спасибо за доклад на самом деле пачка вопросов 1 дате по одному посланы в кулуарах но набирайте лучше тогда что вы делаете со самым слабым звеном пробиты вас оператора самим про метался по ним и сколько сколько вас там метрик границы потому знаете интересный вопрос сколько про метал sonic армии все равно памяти много что этого мы ушли на викторию metrics потому что ну у нас 60 гигов памяти и выпады на самом деле я не озвучил да есть такая вещь как pictures 3 трикстер от компании comcast это реверс прокси и ретро металла су можно поставить эта штука оптимизирует вас запрос если вы большой раньше вы пилите у вас примет много памяти захочет рихтер помогает оптимизирует запросы это память есть меньше вот реальный пример например мы хотели посадить скуку на сетке желтом целевым оказалось он трафика желтом 130 мегабайт мегабит секунду для того что просто встать мы бы сделали выборку за месяц и у нас примут и уступал мы еще раз обновили в гавани дашборд и 2 примет его уступал мы то что поставки трикстера например и либо используйте остается какое-то стоит спасет только от запросов но если выкатили новой версии приложения в которой большая кардинально с метрик и метрик становится много они хранятся в памяти и они точно так же будут в видео я не готов тогда ответь на носу продавать кларк еще второй вопрос сразу вот вы говорите что у вас 2 prometheus а вы говорите что вас две реплики про медиа-среда как вы решаете такую вещь как отображение данных даже городе потому что каждый раз он идет в разный prometheus знаете у нас нагрузка того чтобы раза про митоз спрашивают метрики мясо не особо проломить это мгновение о том же о том что метрики разные то есть они же не синхронно за крыши запрашивают метрики 1 prometheus запросил там в 5 секунд второй всем секунд и ты в дашборд обновляет что он сначала показал одно на второй раз показывает чуть-чуть другие метрики но для вас это не проблема но дабы право понятно спасибо спасибо за доклад меня зовут роман он погромче да спасибо за доклад очень классная мысль была что не очень многие делятся опытом fa cup of вот и вопрос такой расскажи пожалуйста свой самый и 4 впечатляющий пока и как победили мы когда-то скале этот сюда страхом туда 5 потом решили миграцию дают вам 35 потом три обратно и было прикольно когда по порядок мемберов их ешь их поменялся и это задач наглости развалился от слова со всем удачи пришлось роковой рис 1 инстанции было очень неожиданно именно в отношении prometrium шапира но я играл я разрешу долю внешне сервис культура удалились я с работы еду в электричке вне ребята горят огни бизнеса в метрике я только у меня платформе на все работает проверил ну вот пришлось релизе откатываться понятно удаление крд файлов типа service monitor спасибо спасибо за доклад есть ли более простой способ собрать нужный себе кастомный и памяти у стек не вкапывайте джейсон нет про металл с оператор позволяет тебе кубу микен из коробки брать ребята уже все соседи они уже джейсон с компилировали и добавили его как уже готовую картинку изолятов то что просто так же про металл с операторы тебя кубу митин позволяет и alert и даже борды все из коробки видимо и пошло не по тому пути непобедимый пошел не по тому пути и выбрал купе прометею стек в этом и есть раньше направился пирата назывался якубом лексин заставляет alert дак они предлагают же с нет вот тут мнения то надо кастовая сверх поговорим эти обязательно расскажу надо обязательно это прям коробочное решение 100 проц а подойду спасибо"
}