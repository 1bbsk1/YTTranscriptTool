{
  "video_id": "lCMn52lMQks",
  "channel": "HighLoadChannel",
  "title": "Как использовать Yii2 в Enterprise? Взять лучшие практики из Symfony! / Виктор Демин (symfony.com)",
  "views": 2608,
  "duration": 1616,
  "published": "2020-07-17T06:27:32-07:00",
  "text": "папа ok давайте начинается всем добрый день меня зовут виктор можно скачать презентацию просто будет куча примеров можно поправить живую их сразу посмотреть меня зовут виктор я щас являются эти директором компании works ответственно по чуть-чуть познакомимся просто понимать аудиторию кто из вас пишет на ю я о класса кто из вас пишет на vasif или около сандаловый да и . остальном красную значит очень хорошего аудитория как раз я хотел бы рассмотреть как я думаю всем согласна что хороший код этот катал которым можно покрыть июне тестами юг очень красный from work если вы хотите быстро сделать какой то им вести или мб 1 маленький прототип сделать админку или еще что то то это очень классно выбор это очень просто моментально поднимаете админку потом приходит большой проекции тут начинается проблема приходят новые люди говорят о том что гиков нож надо подписать с нуля на до наварро вон одна сев они там же legacy есть как бы с этим надо как-то жить кучу задач новых приходят а тут надо переписывать в реальные жизненные у меня особо так не получилось мне приходилось работать с тем что есть я была вот это и если что я могу сделать со своей страны на проекте для того что мне жилось нормально это за юнит с то соответственно я хочу посоветовать таких 8 лайфхаков которые мне помогают на и писать unit тесты и для этого ее в том числе мне приходится писать хороший код то что с помощью таких небольших советов вы сможете легко поддерживать в хорошем состоянии первый такой бог это инвизе предыдущий докладчик конечно чуть говорю про другой потому возьмем классические стандартные визе все понимают надеюсь что подъема делаем какой-то html в модели и view соответственно в модели у нас скорее всего это что-то что отвечает за работу с базы данных и какой-то логикой в контроллер игрока то обычно говорят бизнес-логики то что объединяет модели вьюшку тут очень большие терминологически сложности поэтому будем очень аккуратные высказываниях ну вот собственно классический пример из документации сама воюя того что такое контроллер а дальше начинается очень сложно и дебаты на тему что такое тонки контроллер что такое тесты контроллеры какие они должны быть потому что в одной документации утверждают что контроллера должны быть толстые там должна быть бизнес-логика в другой документации у меня тоже да это обратная что контроллер должна быть танки никакой бизнес логики там не должно быть давайте попробуем разобраться что такое торги контроллер видимо если там молоко дата в корее фонтанки если много кода то видимо он не тонкий а какой-то толстый это примеры с мадженто просто взять давайте попробуем восстановить что же происходит мы берем документацию из-за юли и берем контроллер там создается какой-то новый пост хорошо пока все хорошо потом приходит бизнес и говорит потому что посты должны быть не опубликованы по умолчанию но что делает наш разработчика я я пишу посты неопубликованные добавляю прям вот там где создается логику ну видимо это какая-то бизнес-логика идем дальше на появляется задача сделать 1000 постов view есть отличным инструментом консольные тузы мы пишем такой какой-то консольную тузу на бизнес лойко расстояться торт то же самое посты должны быть не опубликован и как вы заметили тут что-то не так там какая-то copy-paste одинаковые куски хотелось бы их разнести по отдельности в какое-то отдельное место и вот бизнес-логику которую нас дублируется у против одинаковые в отдельный сервис какой-то или модельку или еще что-то и пишем соответственно простой сервис котором если наша бизнес-логику тут как раз чуть все усложняется бизнес говорит что хочет получать notification но то что создаст новый пост и предупреди меня если у нас бизнес-логика находится в каком-то 1-ом классе в без проблем создаем новый сервис и туда добавляем нашу логику тогда очень просто в одном месяце добавляем нашу логику проблем не топовая модификация вот тут уже как бы сложности что такое модель не совсем понятно то что с контроллером разобрались он должен быть тонкие скорее всего и там не должно быть никакой я много кода иначе копипаста сложно и непонятно как с этим работать модели бывает абсолютно разные и вот например вот такие их можно разному типизировать но в моем рассказе я хочу обратить внимание в случае и как раз на 3 крупных пока ответственно entity это по факту это моделька которая отвечает за сущность например эта сама машина репозитория да те модели которые позволяют нам находить нужные машины но то что среди всех машин найти нужную нам и уже сама логика если она будет храниться в классе например сервис этого тогда у нас понятия модель начинает побросать каким-то разными понятен и понятиями то что инте это сущность репозитории как раз методы где позволяют нам найти нужную машину либо пост и сама логика бизнес-логика мы вынесем в класс сервис чаще всего на особенно новички читая документацию считают что модель от active record и что это одно и то же достаточно много об этом в том что так ладно говорят не так октябре карта себя бросал рядов три разных вещи одновременно и the entity это репозитории incity менеджеры если мы будем ориентироваться на вторую доктрину томат так называется то что как раз по факту active record это старая legacy его не надо но его надо очень четко воспринимать что там лежат три разных вещи эта сущность метода поиска и методы работы с базы данных идем дальше у нас наши модельки начинают разрастаться в реальных проектах их очень много их надо как-то инициализировать они друг от друга зависит каждый раз сделать new что это томат проблематично я подробно не буду на этом останавливаться это говорились и в документации написано и в том числе в есть специальный контейнер которые упрощают это действие есть такая дмитрий ананко на который можно почитать это подробно расписано а вот соответственно использование достаточно простой то же место того чтобы делать жизнью какой-то класс мы делаем you great объект используем все достаточно просто и главное не у нас будет только как все три нас визировать важный момент как мы понимаем что you create обжиг где можно использовать где нельзя использовать это не указано тоже документация оно понятно дело во вью как-то странно это использовать в моделях или в контроллер и моделях нельзя использовать потому что это просто сам принцип говорит о том что модели получаются свою зависимость извне и ни в коем случае они не могут ассоциировать свои зависимости сами логику вынесли отдельно поэтому вот саму конструкцию это перед несмотря на то что на нам позволяет в любом месяцев копии и написать можно делать только в контроллерах такой следующий не совсем понятный момент который плохо освещен документации это как все нужно подключать вот контейнеры именно мобиль поэтому мало используются на реальных проектах ну во первых там есть маленький кусок в документации как в элементарном виде подключить если чуть сложнее у нас разрастается кусок кода мы можем использовать вот такой лайфхак мы в секцию bootstrap указываем класс в котором будем уже прописывать наши инициализации и как раз классе у нас есть возможность прописать в контейнер и все настройки которые нам надо следующий большой блок в ивентах этот механизм тоже есть у я думаю все его активно используют у нас есть event у нас есть триггер которые срабатывают как раскидает наш ивент и есть какие-то слушателя тут тоже в документации не очень освещено на как использовать реальных проектов потому что все делают по-разному кто-то хоть факте фрикар сует настройки кто-то в контроллер ну короче абсолютно по-разному встречается и очень важно понимать следующее вещи что конфликт мы можем сделать точно так же мы будем секцию быстро прописываем какое-то файла где мы конфигурируем она понимает что стал конфигурацию должен отвечать только за конфигурацию в случае у я например это просто видимо файле xml файле ли мы каким угодно тоже там не должно быть никакой логики никакого кода это просто конфигурация ивентов и сам ивент и тогда выглядят достаточно просто опять мы понимаем что то такие же контроллеры и там не должно быть бизнес-логики она должна быть в 1 классах сервисах поэтому контроллер тоже он тут тонкий это обычный контроллер хитер и приходим к такому самому важному в случае большой крупных проектов нам надо покрывать наш код тестами случаю есть отличный frog называется концепция там соседнем а докладе тоже тут рассказывают как раз про него подробнее поэтому я сильно останавливаться не буду я хочу как раз уделить внимание именно самим юнит тестом случае и 2 напоминаю что unit-тест это элементарная штука который проявляешь два плюс два равно четыре тоже порядке это элементарные действия такая тавтология что ничего не сломалось какие проблемы есть случаи и 2 давайте в одном классические классный пример profile у нас там есть какая-то хотя поле когда последний раз этот раз обновлялся и мы будем пытаться определить активно он или не активный ну достаточно частое явление в коллекции кода и попробуем обязательно этот юнит с то что пока проблем я то мы инициализируем наш profile и проверяем что на самом деле он возвращают то что мы хотим проблем пока нет второй момент это определить активный или неактивные вот тут возникают вопросы как на этом написали тест но я тоже на самом деле не знаю видимо не как поэтому мне приходится следовать этим советам который говорил в начале первым делом надо вынести бизнес-логику в отдельный класс в нашем случае например прав от сервис будет отвечать за без на злою которые там происходит окей переписали но у нас еще остается инстанцирован времени в принципе это тоже отдельная как бы логика ее хотел бы вынести в отдельный класс dbhelper и в давайте это сделаем хорошо по какому все понятно и все просто ибо нас мы написали unitas но в первом приближении тут все достаточно просто мы инициализируем класса прокидываем зависимости проверяем что методы возвращаются что нужно но тут тоже есть сложность как бывает текущее время но текущая мы не пока никак влиять не будем поэтому t равно упадет для того чтобы повлиять на текущее время мы пережил специальный класс мог детский промок и у него есть социально метод который позволяет задать текущее время окей без проблем когда все работают все как надо сам класс выглядит достаточно просто мы наследуем ся от родительского и делаем такие хитрые манипуляции каждый раз сделать руками вы это нековом смысла не то есть классная поза например маркеры можно активно использовать там есть куча полезных тут которые упрощают работу и тут опять к сожалению 2 достаточно legacy проектном вызывают проблемы мы попытались написать unit-тест на наш active record класс и он почему то ходит в базу что странно но приходится с этим что-то делать поэтому мы вызываем мог вот такой помощью конструкция можно замок из active рек от класс это не красиво но приходится из-за особенностей и тогда мы без проблем пишем обычный унитаз ты все хорошо следующая большая проблема которая у нас есть в я это всякие статические вы за ее очень любят и в документации и не только и и другие при варке тоже такие конструкции там юлия proquest appcache и тому подобное такого статические узами ездить очень большая проблема потому что классический unit-тест должен тестировать только один класс он не тестирует зависимости он тестирует как бы только один класс авто на должен быть замок она как замок и статический вызов но честно говоря я не знаю может кто-то мне кажется раз кажется что я неправ и как эта конструкция правильно замок с но с этим есть проблема как раз мы берем классический пример из документации которому очень многие следуют не надо было бы когда мы в полной красе используем статические вызовы какие то глобальные переменные и от достаточно проблематично и как бы написать на это юнитов но опять-таки я просто даже не знаю как на это написать его нет то я могу чуть-чуть переписать код так чтобы я мог написать без проблем unit-тест например мы его носим логику как и должны были в отдельный класс это в репозитории самым p4 ему протянем с помощью чая благо слава богу нам позволяет это сделать фавор без проблем автоматом прокидывать все зависимости и тогда да это выглядит тоже не очень легко носом этом можно протестировать мы мысли зиру им наш клан прокидываем ему зависимости и мокрым класс репозитории тоже мы влияем на то что будет возвращать класс репозитории и таким образом мы можем без проблем проверить наш логику со вторым методом у нас чуть посложнее тут уже непонятно как нормально было бы заменить все равно пить и есть косяки но хотя мы можем сделать вот таким образом мы выносим майонез лизации всех объектов которые можем через dio и закидываем то что не можем ну хотя бы обернув гетр как бы хоть как-то и тогда в этом случае мы уже можем написать юнит с это тоже выглядит конечно не очень красиво но это уже тестируемая с этим уже можно что-то делать в принципе как бы документации презентация можно посмотреть подробнее как именно это тестировать итога как прежде всего что я сказал что если следовать этим возьми советом то будет писать код намного проще oglan а потом и вот намного проще тестировать итогам и первые контроллеры фотки должны быть тонкими по крайней мере в случае модели они бывают разные и каждый отвечает за свое не надо нарушать букву и особенно обязательно используйте дед машиной экшена проекте это очень классная штука и и на активный юзать с ивентами тоже не мудрите они хороший инструмент но надо очень аккуратно и правильно его использовать для того чтобы работа с датами обязательно используют happier то что какой то отдельный класс который будет вам возвращать текущую дату и какие-то манипуляции делать соответственно после чего активно используйте маркеры для того чтобы работать с этими классами как ты их изменять ни в коем случае не спешите глобальные переменные не вызывайте каких-то статических вещей если уже вас заставляют это делать from work то хотя бы оберните это в отдельный guitar когда вы сможете это покрыть авторством ну а главное обязательно идите пишите юнит-тесты прямо сейчас и ваш весь проект автоматически станет лучше спасибо нужно задавать вопросы спасибо за доклад у меня такой вопрос у нас пройти тест человек как бы потому что большинство из них вот в общем вопрос как как начать их использовать например какая-то вопроса он собьёт очень сложно особенно женами потому что они не понимают что такое зачем писать а главное этот код которой они пишут но физически не покрываются unit-тест не только порог входа на это просто громаднейший даже если вы знаете как писать юнит-тесты вы не можете на их написать ответ на самый такой долгий путь к но и самый простой который я пытаюсь реализовывать постепенно упрощать этот процесс проще всего начинает не с unit тестов от приемочных приемочные тесты все понимают более ли менее итогах когда вы хотя бы научить писать приемочные тесты там функциональные потом такие интеграционные которые типы как юнит-тесты но не юнит с а потому что они ходят в базу еще что-то и вот после того как люди откроет какие-то там тесты они потому что такой как это писать можно приступать умных чисток unit-тест нам как раз именно которые не ходят никуда это такой вот последний шаг насколько знаю просто вы не то есть он тоже приду база как раз остальных просто глаза вот это спалось тестов нужно начинать не не обязательно юниты сказать очень сложно и как раз реально продукт но продуктов смысла в них достаточно мало когда люди не понимают зачем писать приема что это за люди понимают что вот этот функционал хоть как-то через жопу но работает когда на пожаре юнит-тесты вы проверили два плюс два равно четыре но и написать два равно четыре и так знаешь зачем это очевидно поэтому проще когда вас хороший проект хороша когда можно проклеить в стопроцентного фото тестами юнит-тесты мы а дальше уже знать приемочные но реальные такой бизнесовый жизни проще начинать , заходя на месте огромное спасибо очень полезный в отличие от многих людях очень полезный вопрос насчет структуры но думаю актив и как путают с моделями в тушении лежат в директории модель поэтому в этом на иную проблему вы предлагаете какую структуру то есть в этой же папке модель размещать сервис разделять или может быть их отдельно вытаскивать он выжил тут по-разному тут есть абсолютно разные способы на разных проектах парадом по структуре ru я тоже понял там по компонентам по каким-то там я ног и дальше уже как их структурировать либо как самый простой вариант так как ну хотя бы называете правильно модели и тогда автоматически паблике репозитории попадают все ли пятно модели которые репозитории все которые едете они попадают папочку идите дальше уже конечно так бывает иногда house но с этим уже проще и захотела неправильно названа выехал ногу положить эту папку как они называется буквально вчера была эта проблема вчера мы спорили на эту тему спасибо спасибо за код я ненавидишь а практически но меня такого общего плана будет вопрос я слышал фразу что какие то условно джек когда речь пойдет про 2 нам в контроллерах это все запихивать и но про модели понятно что не нужно нас есть еще сервиса есть еще этом репозитории еще какие то вещи на мой взгляд как лучше правильно из контроллера потом соответственно когда мы вызываем пропихивать то есть мы делаем ризоев в контроллере и потом туда инстанции пробрасываем или же соответственно в соответственно в этой сущности уже делаем результатом у нас есть еще бинти джуа бы это много всего может быть просто просто сервисы просто репозитории потому что не всегда мы работаем только с active рекордом сейчас говорю сейчас не до конца понял вопрос из еще раз страдают вопросом вы сказали что в моделях плохо а делать а вот в контроллерах на данный контроллер с была фраза нащо нас лазер то соответственно вот как правильно в контроллерах монтируем все нужные нам сервисы которые пойдут по всему lifecycle запроса и про вас он их ниже или же вполне ок если мы будем инстанциировать что это в там то где-то в сервисе лето в ивенте в листа нори тогда их а потому что вы не можете повлиять на это как раз те плюсы максом позволяет вынести все это в контроллер эта задача контроллера смысле вынести в контейнер это задача контейнера то что она полностью им решаются это не надо делать руками там что автоматически есть куча всяких докладов как именно инстанциировать а именно вызов с контейнером и тоже пропитывание контента лучше делать к в контроллерах иначе просто теряется смысл всего этого тела потому что в контроллер развиваете получить готовый объект на пути готовый модель и все ее используйте а как even инстанцирует вот это готовая модель полностью отвечает автор мог про модель да допустим сервис какой-то из условно мы там используем какой-нибудь сервис по работе с датой ума мужчин джорджу бы вызывается deathevent который вызывается из который за сервис тоже как модель тащатся мы в контроле в инстанцию руин какой-то класс устроено по работам за то неважно чем пробраться много параметров конструктор там 1 классом сервиса в нем побольше вам еще глубже на уровне потом еще глубже то есть вот так получается правильно выделяли жадности ни одного потому что модель они должны быть независимо от любой класс должен быть друг от друга независимой через пакет от не модель сейчас сервис это та же модель она тоже и контроллер можно как модель тоже подняли любой класс я не знаю если маркер или нет абсолютно любой класс не та же сам себя инстанциировать на то что они абсолютно друг от друга независимо в том числе контроллером в контроллер можно пропитывать все зависимости это позволяет сделать вывод то что ее позволяет асиф и не позволяет зарывали не пробуй тоже позволяет то можно вытащить узкому кругу все зависимости в любом классе надо получать извне потому что не тоже придумать как инстанциировать потому что все это должно делаться в овне ответила на даже не простое тамошние спросил на мой взгляд должно делаться в овне и все должно получаться через зависимость катит спасибо за доклад собственно вопрос вы получается этих рекорд класс можете с помощью библиотеки да но кори отдам пример да есть еще такая как бы такое понятие как текстуры которые позволяют задать в принципе какие-то первоначальные значения и успешно использовать в тестах используете ли вы fix тура собственно и да или нет да понял спасибо фактуру используем 20 не совсем маю не тест это интеграционный так получается потому что ходят в базу но то что вы тестируете одновременно этого здесь текстура в одновременно тестируете штаты ну у самого когда заработает unit-тест он монументален него нет никаких внешних зависимостей и она ровно два плюс два у нас есть интеграционные тесты нас их большинство да у нас есть текстура они ходят базу тоже и в их активность польза про контроллеры спасибо всем"
}