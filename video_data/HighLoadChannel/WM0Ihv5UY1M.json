{
  "video_id": "WM0Ihv5UY1M",
  "channel": "HighLoadChannel",
  "title": "Редактор Mail.Ru, или скорочтение за полчаса / Павел Зиновкин (Mail.Ru)",
  "views": 118,
  "duration": 2611,
  "published": "2017-04-22T14:47:43-07:00",
  "text": "ну и я вам расскажу о том как мы сделали три такта mail.ru если мы запустили неё сентябре в доступен в почте и облаке мы для редактирование цели и презентации мы используем решения пока сок противник на терне возраст на момент мы сделали самостоятельно что не так детка тип лишь пока техники бросить я продолжу рассказывать очень редактирование уродский документов мы сделать самостоятельно собственных просто так он как мы это делали какие вообще этапы прошло если сейчас ли разработчики смогут рассказать картин значит изначально мы не закладывались сделать редактор прямо с нуля я если честно не представляю так взять решить сделать замечание наполнитель слишком рискованно задача делалась именно не сразу к этапам этапы я хочу избирательного убираете создания или анализе под старую как я там общается знакома с редакторами можно многое узнали о творческой подарочки если вы увидите что то другое то то это скорее всего старых залива на самом деле это не только редактор уговаривала было несколько этапов которые прошли и на данный момент мы можем читать документы 9 просмотров гордость их экселевский файл презентации мы можем твой для не не приведёшь песнями инвертировать у нас переменная value будет стороны как все началось собственно решение было попробовать сделать просмотр документов использовала рассмотренных басов медные ворота не было мы сами и первые вопрос к этому погнулись как мечтать документы от требование было не использовались мой опыт работы месяц никаких переговоров и пожелания вниз пользу становится причине я не могли что лера используя должна большая и сложно было понять насколько решили утра movies ну и тут же изменять земли и такое нормально мы не могли хорошо позволить функциональности новые вещи делают переделать шариками решение ряд ряд минусов минусы формат формат систему еще плюс именно казалось наличие документации 350 где то так не говорю это со всем этим пороге новый формат microsoft это по сути заполнены works мы просто разрисовал прокомментировать очень сильно люблю такого решения и если мы читаем сами мы можем делать что угодно в принципе до тех пор пока не читаем нам и к нужному можем замечать физалис по ходу действия снялась и очень много через час документации которые она есть но на описываю побольше структуру взаимодействие между структурами это чистые телепатии приходилось учитывать документ сравнивать то что мы получали с тем что мы видим пор детали бога науки сеяли бравых и проводить параллель это череда и исключаем рио суждение продолжает использованы для решения вардов нам потребовалось для при где-то два месяца формат это вообще давно просто находясь на что нам нужно понять что делать вычищать вопрос бинарных форматы долго где-то год потребует чтобы читать все форматы таблицы презентации и просто ну и мы на самом деле учитель постоянно что-то радикально последний что мы имеем у нас есть интересный документ не открываем и видим эту картинку горд видеть вашу картинку фронтонные картинка она появляется в одних редакторах темнит они появляются не понятно почему она есть структура соответствие документации я чтением по документации для разбирайтесь в итоге мы создали свой вы теперь значит назвать но он делал то что мы хотим именно так как мы хотим то есть мы предпочитаем документы конечно то есть это меньше на секунду документы объем есть так называемые документ убийцы мы оставили пытаемся ним бороться не больше минуты после этого мы превращаемся при колитах и случай руки просто ну такая проблема сортов очень медленно формат лечение казалось бы более тексты формат номер может быть готовым как мы читали и зрительное увеличение мы в 4 данных которых только нужный нам документ можно держать эту информацию про сказки вы можете делать все что угодно с читами какие данные хотим когда хотим и мы можем управлять качеством чтения на самом деле почему очень хорошо процент ошибок надо менты 070 процент ошибок все этих документов и сидеть на них драконом побольше но воровские файлы последний чтобы было это 30 зависят по цене отдельно графики строятся потянут метр по количеству бортику ситуация на самом деле вначале сегодня хорошо всего вы топите на а значит все . как просмотрщик и говорил особо не мудрили то есть базовая архитектура не имеем здесь какого-то клиента имеет очередь паза и очередь задач где-то у нас есть частота почта там очень много файлов мы работаем через своеобразное значит клиенту в запрос обычно это какая то ссылка путем где забрать любыми планируют задачи на чтение очередь не дают какие-то данные фронтэнда это обычно ложкой менеджер начинает периодически опрашивать band на момент который документ можно получать недавно в это время очень нагревает этот файл он процессе то какими записи делать заказу привет моим опять получает формат готов начать показывать эту глину и не поздоровится напейтесь rng рендеринга для просмотра не получили браузер что нарисовали как говорил это займет разработках просмотр знал повар года где-то особенности даже самого начала работы с чтением показал что есть определенный ряд проблем который и сможем понятно только на практике соответственно закладывались на то что мы не знаем до конца берём рисков мы решили не делать не старым шагов и пускались не видим режиме запросы исполнялись пользователь ничего не видел и ничего не сломает все было прекрасно и мы получали информацию запуск также показал что мы очень плохо мечтали штуку 15 процентов были просто разлома мне чего-нибудь упадет нужно больше информации можно больше файлов от аудитории и в частности какой интересный момент вы делаете какой-то продукт вы думаете сейчас я вас формируют гида данные там для пользуются 2 какие данные сторон приложили все прекрасно вы раскатаете на приложение пользу и загружает данные и вы понимаете пользу загружать на youtube почему загружает но пользуетесь пользовать своими данными это не ваши до и по локации свои данные очень глупо на самом деле нужно было продолжать развитие но постоянно там слать запросы с клиента это очень плохо с начального включали процент польза ничего не видит но запрос выполняется юниту это трафика это плохо соответственно нужно было что то делать нужно было как-то улучшать мы решили печать начать строить привычки то есть я пряжки to the nail я покажу что это такое в чем была логика казалось бы у нас не работает нам нужно мы хотим еще сделать как буду работать мы хотим сделать еще функционал лойко была очень простая нам уже не сломать то что уже есть пользователя никто не захочет чтобы не сломался просмотр потому что мы ставили эксперимент хотели бесплатные пользователи и подобной троллейбусе а значит превьюшек много аудитория почты большая там миллионы пользователей десятков превьюшек много пользы постоянно смотрят письма там есть документы там есть превьюшки значок это незаметная фичи мы включаем у пользователя анна или показывается и оно не показывается как как и раньше на не показывать все прекрасно нам казалось что легко сделать то что у нас есть процента тоже рисует документ мы подумали можно использовать тот же сразу на сервисе прекрасно тот же самый каймой de jasmin за сменим тему света сервиса я пресной воды сейчас значит вот так выглядит превьюшки общение письма то есть интерфейс почты одинаково закалка языков и вот я взял написал это письмо отправил документа даже есть нарисованный каким кодом сейчас превью сделано гораздо более проще чем просмотр убрана целиком асинхронная стадия все делается в один проход значит получает запрос он сразу же пытается вы читать документ разобрать его и отражать но том же связывайся через командную строку там миссия собственности ну и читаем сами мы прекрасно управляем ситуацию обрезания контента нужно считать мечтаем мы решили рассказать о приложении было были сколько-нибудь визира на самом деле и нет понимания к набору данных которые приходят на не можно активизировать и не пытались как-то прогнозировать нагрузку потому что сложно было представить числа какие при как могли посчитать количество при высших которые можно рассказать но еще очень серьезно если придет много тяжелому смотрим что происходит справляем то нужно постоянно приложения типичная что происходит но это хорошо для нас года дома приложения обычно набор каких-то отличить про драко вы можете определить 250 тестов сейчас проводим оба и посмотрю что происходит они показывают декорированные ситуацию важно или три внимание где это нижний работать а значит и на самом деле очень хорошая вещь они более-менее стабильно показывает работу приложения чем больше данных тем более точных будут графики и размещением на разгар его не позволит времени увидеть чтобы расследовать убийство питер какой-то график возможен и что там начали делать по-другому очень хорошо позволяют и сыграно что просто на самом деле это все не выловишь миллиметр программированием приложения этого периода пристального взгляда что может работать так как приложение и вот эти шаги если вспомнить правила палитра к кому то или нет 2080 процентов результат вот это 20 серия далее очень большое качество результата часть производительности то есть мы замерили джесси css шаблон то есть он не запрашивал потом это реально правда может сделать запрос и прямо на сервере или работу правда без так уж мы также передавали шаблон же нас тут изначально он пытался зайти на ул мы сделали передач используем часов такая нация g 47 процентов производительности просто выключение и фичи но также картинки прямо в данный передаваемые фантом ну если примешь к фантом разориться определенных размерах он большой из тех размеров которыми полежи соответственно идет стадия фантом рами дарят превью он запаковывает и и теперь вы даете потом снова распаковываем жмём до нужного размер снова запаковываем лишние действия соперника промежутке полностью вы поете прим он сведёт меньшую сели на распаковку дает простое действие визите объем процессами работы над работы слова больше важны и других целей после этого нужно ступили которая тоже свой результат и сами не маленький глупый канавки далее тесто момент хочешь это очень-очень большая 10 байт информации на самом деле в пользовательской несколько дата-центров естественно сервис-ориентированной архитектура просмотр редактирования они брали призывали потенциальные мы делаем специализированная проговорив в пользу резон курица не резон скаченные файлы с определенного сервиса который мы просто говорим данным формам отвечает настя . соответственно по сути сервис права и и это удобно и заботе различать движение добровольцами себе но это приобрести вернулся в виде недостатков таких как серых справа и умирают нравится это нужно как-то понимать котором используется несколько типов данных нужно быть какой оставлять на проблем чтобы ускорить реакцию некоторых случаях провалился в некоторых случаях вы можете будет проводить обратной ситуации то есть у нас была проблема мы начали сбирать но лена и доказал что мы 30 процентов трафика на сервере который до этого раздавал павел делал другие вещи мы стали выходить на сильном и три спортсмена трафика вы ограничить проблему мы заметили своим графиком формирует информировали к проблеме они смогли решить соответственно нужны на все графики чтобы это видеть встреча умерить нужны тайм-аут ему подобные вещи если допустим на контур пользователя . допустимая ситуация редко но другу стильная такой запрос на самом деле может убить множество worker of если вы просто не ограничен по времени нужно срезать врача то есть уже в пути малым ваш сервере выживал под нагрузкой но и собственно по работая подобное способны участвовать не забывать что ваша задача продукты симбиоз они потребления correct и так прирежьте сейчас на самом деле мы используем до сих пор один код нечитаем и подавно сейчас это около 30 серверов чтобы понимать почему 30 серверов рекорд последнюю арту понедельник 27 миллионов привет было более 27 миллионов прививала построенной за сутки 30 серверов более 700 запросов секунду время работы где-то диапазон 488 из 800 миллисекунд на средних или ночью учитель по ходу 480 вообще машин ничего не делали они могут очень радует днем к сожалению день гошан явно почти интересный момент до сих пор превью исполняется функцию мы видим ошибки джесси очень проблемные места на самом деле гораздо короля-лича пока они позволяют нам говорить проблем то есть выход к на несколько серверов позволяет видеть чирки разворачиваем защитить пользователей да как незначительный процент код злей не увидеть превью но размечу минус не можем решать проблемы тут же сузил свой набор особенности пробудить жизни не отражать ну еще такой момент нас они сейчас часть превью строить уже не через антон же сочи с почему соответственно следующим шагом было редактировать 8 до понимание что можем вдоль хочу читаем довольно неплохо показывали документы а то есть не будет сложно но тут выполнить шагов которые хотелось бы сделать частью на самом деле сделали начальный просмотр предполагать какой мои рендере то есть это дом дерево джесс рисует дерево пожалуйста если вспомнить я не знаю кто то из вас сравнивал word и денни как они показывают документ удивилась разницу добыть его это очевидно деградация как таблица рисуется там много книг особенности это корсет к той мальвины тянули за жизни позволяет очень точно развитие какой дом опять же вот что удивительно печати вы говорите сейчас мы привезли стиле для печати будут прекрасно вы получаете пакет и который браузер печатать документы у вас такой отпечатано крон и что такое еще один момент ошибочное решение на начальных один в том что уму не читали может этот формат в котором оказываетесь дом с густом который мы храним не храним отчасти миску документов следующий момент уже на начальном этапе работы с бинарными гаметами было понимание мы не хотим их писать не каким предлогом то есть максимум на что не согласны это добрый да нет особенность бизнес-логики приложения каждому не правильный момент и документ сохраняется в бухарест тоже приятными и так это м и через к нормально показывает картинку которую мы хотим показывать чудесно был выбор из двух вариантов это или canvas или сага кому-то туда не знаком с этими вещами подробно скачивает такое браузерный к ну все знают что такое соответственно свой галина что другая технология оказалась был обе позволяют нарисовать что-то с определенной гибкостью выбирали celtic она не достаточно гибок загонять прощение за очень точно рендерить картинку так как мы этого хотим из приятностей мы форме обратной связи мы можем польза не может поставить галочки и мы сделаем скриншот документы как он увидеть то есть пользователь жалуется у меня что-то показать не так и начинается обычно станете любить а что же вы скажете сделайте скриншот эта сраная галочку через скриншот и уже на самом шаге мы разбираемся проблемы виде и глазами кубической пользователя ну и как и все новые технологии они дают определенные проблемы с браузерами стандартных старых вещей момент тебе вред печать из браузера не очень хорошее это не то что пользователь жду не то что они хотят этот теперь с которая не спишь до сих пор и соответственно выбор камаз он позволил генерировать r&d pdf при наличии определенных они некоторые если называют но скучать пользователя возможность отсутствует флаг аромамаркетинг туда попадают сюда разных собственно то проблемы которые которые как мы учитывали данные тот формат и насколько момент по сути это своеобразное дерево если это простой документ не просто текст текст пара него сей сердце какая-то строительство ложных бараках него вложен форматированный добавлять еще так можно продолжать определенной глубине этого ничего вот сам как делать ну если вы хотите работать в браузере проблема просеки документ на и через говорить про данным форматированием некоторые люди так умею я буду на этот документ может весить vidigi тонкий 6030 шестьдесят мегаватт он начинает эту пробирку пользу наверх и уйти или спорта и не понимает документ небольшое десяток страниц все лишь хорошо матирует становилось понятно что передавать строки и я хочу несут сделать текст полным нужно ли как коррида правильно нарисовать соответственно логичную мы обращаясь к кому-то элемент логично большинству по данной системе участка для редактирования переделать формат чтения этот посуде с проще и наборе домена потратить изменения или какие-то свойства которые с этого индекса начинается таблицы и на этом навести она заканчивается целью ведутся начинаются строках таблицы или ячейка у неё такие устройства можно взять просто текст можно взять просто все что угодно очень тщательно этот пришлось продать соответственно на вообще сменяясь логику топ-4 документы структуры все таки то что нам не пришлось дублировать другой путь обхода поэтому делим чтение так далее насколько усложнило разработку просто зачем просто взялись дублировали некоторые баги доси числовых кодов параллельно этого различали чем поработать и него polski 0 вот это старое дерево по-прежнему равна стороне вершине новое она может быть не работает местах не ломая старый была не была сто раз когда редактировать до сих пор в этом где-то 200 человек в самом деле будет включать мобильного неделю до сих пор видите мы разрабатываем о чем же хочется поговорить о чем-то рассказать самом деле качестве как мы добивались изначально все написано у нас не территории питание может несколько раз framework of простой жизни комплексе которые практически знаю деревянных просто работать тех местах где нужно исполнять места раньше документировать простота candida в решении которые мы принимаем просто да то как мы это все делаем наоборот мы документируем ну и очень важными это надежный точности без инструментов если документ не ударяет более чем одном операторе всем этим трем критериям могилу у нас было я могу рассказать вещах которые мы сделали так мы мужчины не которые не соблюдали некоторые из этих моментов в чем-то не работаю в чем-то не представляю не доставляет проблем естественно ударную ситуация тест junit тесты . сервис покрытие жестов для frontend функции каких-то для чтения сложного социального представьте у вас есть возрасте файл вы не можете верифицировать достоверность там не только вы не можете его переиспользовать вы не можете из дублировать от места потому что каким-то страну и альбома записаны два раза все он есть такой они так не файл приходит было восемь выглядит файл в которой она принципе особо не нужны мы используем просто агрессии к великолепных файл очень много и мы прогоняем стандартным процедурам чтения в течение на периодически хоботных не смотрят что-то взорвалось что-то неправильно сейчас мы заняли очень много проблем шло очень хорошая если двигатель накапливать чтобы ничего не забыть и байкеры очень изящный момент так как мы вынуждены сохранять документы мы постоянно проверяем столько хорошо мы его сохраняем можно прочитать документ редактировать писатель надежде будет прекрасно мы делаем документами с начальными данными так и будете сделали сами от себя также ожидать что-то правильно также открыли между ветками то есть прогоняем чтением кроме это делаем скриншот и на сервере и мы сравним эти два варианта брожения между вы это и без меня строго что мы с мужем себя сравнить как сильно затронуло дрожит из инструментов я не знаю графит все слышали что такое каким-то это система позволяет рисовать графики то есть она может получать данные и она позволяют эти графики рисовать граффити очень плохо справляются с нагрузкой если него очень и причина гулять да не удалились процента названием создаем пусть иную ситуацию и так же мы используем элементы названием центре нужен характерен для носа последнее время поступим позволяет нам слать стритрейсер на сервер и можем посмотреть их дарственных фамилию а текст очень удобно смотреть с пологом не всегда так удобно как получить его снять с в исполнении очень-очень вдогонку графитный установить инструмент назвали интаймом это по сути что-то по части больше мониторе настоятельно сервера позволяет не дали однозначный процесс также к ним графики вопросу лайк jens регрессия просто гоняет нас периодически или работы связанные течением качества и так же очень много момент который мы очень удалось у меня нашей команде инструмент фабрикатор написанную рабочих я слышала не будет куда поставить назад решили попробовать у себя его мы используем музыку других позволяет автоматизировать кудри вьются стандартные воины писал подсели я уже заметил посмотри пожалуйста это полный луна давай оторвет у нас такого нет подрыве выполняется при карле в режиме код даже не едет по истории по сути мы увидимся изменений может сказать другу смотреть ерунда и меня человек смотрят павел здравствуйте какие вас мысли возникают по поводу многопользовательского редактирования не возникают ну какие мысли у вас уже были к что вас посещала что вы хотите для этого сделать но это логично если вы редактируете документы если вы редактируете х онлайн логичный редактировать их многопользовательские определенные подготовительные действия сделаны скажем так скорее всего мы рано или поздно его сделаем в чем-то мы уже к этому готов чем-то еще нет просто и все-таки то понадобится типичные редактирования там два соединения вам нужно одно возьмете из 2 ожидаете данные для синхронизации какому духи там есть вариант лол полингом есть вариант с высоким мы их исследовали но пока на этом остановились не дать есть другие 3 минус 0 мы очень много работаем в качеством отображения качество характерны для гугла допустим он у учителей не устраивают наших пользователей она болеет он не устраивает нас если вы открываете queen там платежку вы смотрите понимаете что она еще ужасно я допустим я хочу таким инструментом поэтому пока она качества с отображением двигаем большая команда занимаюсь разработкой а значит у нас два бака индира не считая меня я в бэг-энд разработчика и сейчас у нас опять же тинькофф появится применять для килта редактирования если вообще думал подход операционной трансформации к этому же закладываете сейчас да мы исследовали это то есть если вы посмотрите форматы думаю узнаете такие фенечки операционные преобразования если посмотрите формату немного расскажет формат данных которых котором час приезжает документ он именно под это больше зато очень то есть это бог строка после по которым индексируем а сколько человек планирует команд уж есть но у нас произошло недавно расширение на самом деле наша команда на ранних стадиях общего очень мало народу мы как-то умудрялись все делать поэтому сейчас у нас гораздо больший темп разработки чем ранее кстати недавно мы набрали еще людей джессика джонс мы сильно приседали очень много джесса бакая дохода не так много джинсы и сложность же снова кодов довольно велика а пока не знаю возможно дальше будет фильм 1 раз здравствуйте хотелось бы уточнить насчет же с а когда редактирование документа происходит как там обрабатывать информацию и что отсылает потом на сервер при сохранении то есть это например если мы какой-то блок 1 редактируем много-много раз по-разному это прямо по шагам отправляется либо танки сложный очень майк и джей-си и результат потому что такое то дельта смотрите происходит редактирование на самом деле сейчас с небольшим с небольшой задержкой мы шлём эти команда формируется в определенный буфер то есть допустим команда вставка текста мы стали текст таким-то свойствами и мы шлём это на сервисе роном подтверждает номер то есть когда мы делаем как изменение на шляться и на сервере то сохраняется спасибо если заново перечитывать документ эти команды просто приюты документ по сути поднимется из них понятно спасибо добрый день я не совсем понял а где у вас просчитываются руны смысле расставляются буковки всякий размеры вот эти считаются на какой стадии на редактирование нет даже для отображения для отображения сервер прочитал документ он вычитал все эти свойства том числе свойства аранов далее выдается jison сервер джейсоне есть геометрии уже нет frontend все рассчитывает такой момент на серве допустим нет нужных шрифтов у пользователя они есть мы также присылаем сервер информацию по шрифтам допустим вот здесь метрики для приносит of чертов очень важно знать шириной символов и так далее очень тяжело в это все вписываться не знаете их размеров и клиент максимально пытается адаптировать отображение к тем возможным которые используются то есть это все на клиенте делается то есть для превьюшек выставили кучу шрифтов на машину чтобы там к адаму идет определенной деградации на самом деле мы валимся какими-то простейший шрифтом это не так критично на прививку notes не сильно похожи да получать может получиться не сильно похожи на сегодня момент показать пример что на самом деле там вот где презентации там другой шрифт оно допустимо похоже скажем так очень сложно вообще тот объем шрифтов который есть у пользователей то есть какой то десяток чертог которые которые есть они основные они очень большое количество пользователей а вот видите вот здесь или а еще один вопрос можно имеет ли смысл кошелевой афишировать конверсию вот вашу конвертацию повторяются ли документы у людей если это просмотр количество повторений очень мало мой каширу им это сейчас нет необходимости хранить эти данные долго где-то для привет по моему около часа время жизни может быть 15 по участию так не дочь назвали потом вы просто удаляем эти данные количество повторных и получили оси больше по организации клиентского кода вопрос насколько развитая в джесси объектная модель какие-то фреймворке муж для этого использовали или какие-то собственные наработки это первый вопрос и 2 можете какой-то отдаленной перспективе планируете блин каширования делать типо вот как джимайл оффлайн там google пробовал на потом вроде как то передумали значит так по организации клиентского кода организован доплела степени насколько мы могли это сделать какие-то фреймворке библиотеки они не использовали использовались в определенных частях были даже части грн помочь с практически выпилено целиком слишком своеобразные требования приходится очень много велосипеде но реалии требуют это а по части оффлайн кэширования такая необходимость назревает на просто пока не готовы это сделать больше на руки роимся в ресурсы и в то что мы еще сделаем а если делать то что планировали использовать там из kool-aid и лев html5 уже просто многие все об этом говорят но практически нет реализацию html5 в частности от мужа читалку реализуем такое онлайновая думаю мы лучше поймем когда ближе подойдем к задаче пока это стадии нам это нужно но мы не готовы это делать"
}