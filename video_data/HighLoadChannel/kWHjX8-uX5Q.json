{
  "video_id": "kWHjX8-uX5Q",
  "channel": "HighLoadChannel",
  "title": "Нагрузочное тестирование шины / Сергей Журин (Performance lab)",
  "views": 870,
  "duration": 2580,
  "published": "2019-05-14T14:46:43-07:00",
  "text": "сегодня продолжить таких докладов по про производительность и расскажу про нагрузочный шины я только эти нагрузку 11 как в проводе представляю компании performance lab пару слов компании что компания представляет услуги по различным видам тестирования это функциональное тестирование автоматизации тестирования нагрузочное тестирование нас уже около 300 человек есть офисы в москве ижевские в калифорнии в америке отличная около пяти лет занимаюсь на будущем цитированием немного про доклад доклад будет стоять из таких трех секций которых можно явно выделить 1 секция такое небольшое погружение в проект предметную область не о том как принципе можно подать нагрузку один в один как в праге какие у этого есть плюсы какие у этого есть минусы ну и потом реализация один она была менее успешно в какой-то мета на нас подвела и реализацию номер два более успешной почему соответственно мы пришли немного про компания один раз я попал в компанию это крупный ритейлер нам нужно было периодически тестировать шину shape shiny сопя и коннектимся стек sap technologies ab ярппи и серыми чар вот к шине connectivity различные веб-портал и это как и интернет-магазина через который можно сделать заказ и так и около 20 внутренних порталов компании для различных нужд через шину работали коммуникации с внешними компаниями это контрагенты банки различные государственные сервисы но непосредственно самим магазин их было несколько тысяч каждый магазин мог непосредственно общаться напрямую шины ну и как это обычный white это старый динозавры которым уже лет десять систему никогда не помрут но до сих пор продолжают работать и выполнять свою спиц или спичкой проекта то что шина это мишин critical система от которой требуется высокая производительность если ваши на начала работать медленно вся ваша компания начинает очень работать медленно мысли вашему упала вас начинается апокалипсис потому что вас перестали ездить фура и не знают какую товар куда нужно увести вас перестали идти продажи потому что нет взаимосвязи с центральным офисом базовом постоянно звонят пользователях питаются понятие когда же наконец то починить когда все заработать ну и наверное самый неприятный мед вам лично приходит высокая руководстве начиная следить за вашими результатами и того что к шине как всегда connex очень много частям практически любая система работает через шину мы сидели на проекте в целом и проводили то есть нагрузочное тестирование различных систем и вот время от времени какой-то периодичностью нам прилетали задача а давайте вы нам про цитируете снова шину со опять потому что vendor прислал новой рекомендации как сделать лучше заняться что эти рекомендации сразу на боевую систему накатывать это рискованно где сначала мы делаем апробацию на тестовом контуре иногда мы компания грилло что мы хотим идти в ногу со временем да и давайте мы будем обновлять я компонент системы которых же старые то что также сначала обновляемых на тесте потом переводим все наши обновления на вопрос ну и наверное самое главное задача самая важная для компания эта подготовка системы к высокому сезону но все это сезон различных распродаж сезонный праздник сезон когда компания запустила рекламу по телевизору по государственным каналом что вот у нас все круто самые дешевые товары приходите покупайте это создает нагрузку на все системы разум и создает нагрузка соответственно шину работала построена так что от нас требовалось подать нагрузку анализом с наши нас опять занимались и приглашенные люди из об россии мы продавали нагрузка не сидели под микроскопом делали различные тюнинге просили нас перри провести еще раз тесты с теми или иными параметрами трудности с которыми сталкиваешься когда ты стираешь принципе любую ширину не основная причина и трудности то что у вас большое количество систем интеграции это создает первую проблему что вас большая вариативность потоках данных вас каждой система работы со своим у них данные своем формате она работает по-своему протокол шина работы 24 на 7 какие системы вас активный утром когда происходит отгрузка товаров какие системы вас активные вечеру когда-то люди возвращаются с работы начинают больше покупать товар + система компания на межрегиональное и разные регионы активно в разное время и еще один большой момент то что большая вариативность самих данных с маленьким магазинов у них мало продаж они мало потребляют товаров в них маленькие пакеты большие такие крупные магазины они потребляют много товаров и они что здоровенный пакет и на грудка которая создается маленьким пакетом и большим пакетом она качественно различается все это создает большие сложности вы анализ ситуации что проанализировать как бы потоки данных которые идут через шума вам тоже самое что нужно протестировать в принципе работу всей компании здоровенный и на обычные методы которые применяются при проведении нагрузочные испытания шин это первый путем постепенного усложнения модели мы берем queen простенькую модель выбрали период какое взяли среднее количество операций средний пакеты подали нагрузку мы посмотрели на сколько у нас тест отличается от prada если тест отличается от правда очень сильно ну мы таки смотрим где о чем мы забыли ну давайте посмотрим что вот эту операцию нет однако это хаотически у нее очень большой разброс операции давайте добавим это в тест посмотрим лучше стало или хуже насколько английском приобрели приблизились и мы путем таких это раз мы мелем погрешность моделировании мы замерим сравнивая загрузку циpкa на тесте на проводе потребление оперативной памяти утилизацию дисков и утилизации сити вот на моей практике сравнение этих четырех параметров принципе хватает чтобы сказать что ваша нагрузочное тестирование результаты которые вы получите они будут релевантны для prado ну и другой вариант если вы не хотите больших сложности с анализом то вы можете просто подать нагрузку от 1 1 в 1 как она была здесь идея такая что если вы на одинаковом железе с на системы с одинаковой настройками в одно и то же время подойдите одни и те же самые данные то система good вести теперь идентична у этих двух методов есть свои плюсы и свои минусы то есть если вы говорим про постепенное усложнение модели ну вот путём нескольких таких то раций мы начинаем лучше понимать наши системы мы знаем все факторы ну или почти все фактор который у нас влияют на производительность нашей системы но нам не известно время на анализ и на построение модели вот приведу пару примеров допустим другой проект мы тестируем поисковую систему как обычно происходит нагрузочное тестирование ну мы берем какой-то пул запросов около тысячи во время тестирования выбираем произвольно из них лед подаем его тем самым создаем нагрузку здесь такой момент что на самом-то деле в продукте у вас какие-то запросы до чаще какие-то идут реже они нефть не все равномерно какие-то запросы допустит а ну смешные котята они очень часто не за кашированные а в тесте у нас каши абсолютно не используется потому что все запросы равномерно эту ошибку уже практически никто не допускает второй пример он немного похож на 1 но несколько сложнее допустим у нас магазин который шлет там где-то 2 мегабайт или один мегабайт данных о своих продажах то есть один мегабайт данных такая же самого на этот пример на том войны и мира здоровенный параметризовать полностью параметризовать это сообщение занимает очень много времени поэтому полностью никто не придут резать параметра нации идет таких параметров которые необходимы для обработки этого сообщения здесь возникает такой нюанс что если вам не повезет то вас данные в продукте we bought сильно отличается данных в тесте потому что продукте вас постоянно идут разные товары продажа разных товаров автовести когда мы делаем нагрузку упала ну а значит я буду рассказывать так где слайдов а есть технический специалист можете починить пожалуйста план такая здесь и нет для второго примера как бы не особо важны слайды знать что происходит у вас prod prod продукте we база данных наполнены совершенно по-другому как в тесте потому что остается постоянно идут продажи одних и тех же товаров и вас проблем начинаю с том что вас низкой запрос на проводе и на 200 работ и совершенно разное время и вот если мы грим прошли ну та система очень много и когда мы пытаюсь так постепенно постепенно усложнять модель не факт что вы хоть когда-нибудь вообще говоря сойдемся в этом процессе потому что сейчас предлагаю подождать врубился где его включать asus вам давайте пока чтобы не скучать а кто вообще сталкивался здесь нагрузочным тестированием шин я проблемы которые я описываю насколько они для вас актуально потому что вот я стал с такими проблемами если не дошли до 100 а я об этом то там немного расскажу ну лан предлагаю пусть пока чиниться а аппаратный комплекс месяц программным обеспечением ну давайте на сколько вам будет комфортно и понятно если я буду рассказывать без слайда чтобы хорошо так мы остановились на том что если выгрузить постепенно усложняет такой вот модель теперь на сложнее то вы хорошо понимаете что у вас происходит но вообще говоря не факт что когда-то сойдетесь в этом процессе ну у нас и светлая идея что если мы подадим вот один в один как она была вроде здесь есть проблема следующие и большая выгода что во-первых у вас очень маленькая погрешность моделирования туда вас нагрузка реально идет от 1 в 1 и по тесту реально можно сказать что происходит в праге но проблема следующая что вас область применимости модели она очень узкая этот выбранный временной интервал если вы подали нагрузку там с пяти до семи утра то вы знаете как придется тема с 5 до 7 утра и никакой про никакой другой период вы ничего может не можете сказать что будет когда там люди начнут что-то покупать что будет ночью как понедельник допустим отличается от пятница нужно ли проводить дополнительное тестирование что понять вот как мы будем работать пять на стуле как будем работать воскресенье у вас получается что очень-очень много тестов то есть первые модели вам очень много времени тратить на первичный анализ системы 2 модели вы очень много времени тратите на анализ результатов и как интерпретировать а что делать если у вас нет допустим что делать если у вас нет возможности снять сообщения с шин так что подай сообщение один в один как вроде вам нужно знать когда сообщение пришло на продукте и какое это было сообщение и допустим это не всегда представляется возможным шинам будет несколько загружены и допустим начинает снимать мне сообщение это просто убьет наш экшен убьет всю компанию вот поэтому есть такая светлая идея давайте снимем traffic system отправителя да ладно если у нас несколько тысяч магазинов то сделать это мы вообще говоря не можем ну нам приходит вторая светлая идея давайте напишем прокси не ставим прокси между шины и магазинами натравим на эту прокси несколько сотен магазинов с ними трафик с этого прокси и будет научиться но к сожалению идея обречена на провал потому что для неё требуется очень большие административные ресурсы вам никто никогда не согласует внести такое рк конфигурационный изменений в продакшн этому на дискач то наверное можно сделать это снять трафик маленького магазина среднего и крупного и по надеяться что у вас будет достаточно разнообразия в данных чтобы вы получили хорошие результаты что делать если вот как сказал человек у вас еще нету prada то есть под модель вы фрицы построить не можете мой совет вам лично что вот попробуйте собрать как можно больше информации вот в системе то есть какие факторы влияют на производительность это может быть там размеры данных то есть ли у вас маленькие размеры всех работ хорошо большие размеры все работает эта вариативность в пакетах данных найти как можно больше фактов который влияет на производительность еще на этапе выхода в прод потом вы это можете дать отдела мониторинга я делаю эксплуатации чтобы они заблаговременно были предупреждены когда у них так через месяц допустим пройдет будет проблема и наверно самое такая интересный момент а что делать если у вас железо в тесте она вообще говоря слабее чем то что есть вроде это большая проблема в но по исследованию компании кто хлам из лап только 43 процента компании имеют вот железов то есть примерно такой же как в прадед вот здесь есть два пути мы можем начинать заниматься экстраполяция my различными вот и погибнуть у них единственно верный частный случай когда экстраполяции работают когда у вас провод это состоят из одинаковых железок только вас против больше то есть допустим у вас в тесте 2 железки applications of вроде вас 50 тогда если вы найдете как бы как ведет себя вот конкретно же ленск ну наверное как то сможете оценить что у вас будет вроде когда их станет 50 ну и наверно тот вариант который мы идут большинство компаний они просто тестируют ночью тестирует ночью продакшене это несколько рискованно несколько страшно но если это сделать правильно то много компаний так делать и проблем ни у кого не возникает ощущение ли они кого-то не совращают непосредственно о проекте продукте состоял из около десяти нотекс опять в тесте у нас были точно такие же ноты с таким же настроить многих было всего лишь две на продукте есть потоки данных были жестко прибиты каждой ноги поэтому все ноды работали независимо друг относительно друга и никак не влияли на себя карту надо состояла из трех отдельных железок это центральный сервер альбом b&b 268 два и два сокета по 8 ядерного 74 1 гигагерц 128 гигабайт оперативной памяти и наверно очень хорошие диски там на 1 миллион abs не 2 applications или раабе ангел и ты 1:23 примерно столько же циклу примерно такое же только по два раза слабее оперативной памяти где-то 100 гигабайт и этом жесткие диски на 1 миллиона упс нагрузочный станцию нас были но обычно такие нагрузочных транс там просто них оперативной памяти было побольше вот обычный средний диски на 210 abs off здесь важно обратить внимание на вот эту разницу то что у нас продуктивен стояли реально современный хорошие жесткие диски в тесте у нас были там даже не создашь к это обычный сада и вот помимо задачи о том чтобы максимально приблизиться к породу она стала еще задача как нам сделать так чтобы нагрузочная станции не померла раньше шины как нам при помощи ведерко нагрузит здоровенный в россии вот приведу пример когда люди не особо обращали внимание на такие мелкие нюансы и получили они очень хороший результат мы тестировали некоторый интернет ресурс у нас был тестовый контур который был райан продукте вы по мощностям только к сожалению канал от нагрузочных станций до тестова контра было очень маски гораздо меньше чем там есть продуктивен и получилось так что вот какими идеями меня были вы крутыми специалистами супер-пупер людьми мы не могли нагрузить продуктивно просто вас канал очень узкий позволяет падает нагрузку и что было сделано тестирование было заморожено до момент пока в трясине расширят канал заморозка тестирование это означает что вас сроки все двигаются вот выход важного обновлений которые мы тестировали он соответственно сдвинулся на такой же срок это были некоторые такие маленький нюанс на которые не обратили внимание на который вылился в довольно неприятная ситуация для компании и перед тем как переходить к некоторым реализация повторим да что еще раз важный год я наверное считаю что важно это спросите тестировщиков о качестве вашего нагрузочного тестирования но спросите не в терминах а хорошо ли у нас хороший у нас тестирования спросить с терминах модели на какая волос применимость у модели какие какая вас погрешность моделирование они могут внедрить и начать вам говорит что вы смотрите 80 процентов нагрузки на провод создает 20 процентов операции у нас 65 процентов perros поэтому нас точно 99 процентов но чего такие крутые парни это запомните и потом попросить симулировать какой нибудь допустим прошлый понедельник которых была и посмотреть этом два графика загрузки цепную подойдите с ними скажите вот как же так точно 99 процентов на графике таковым их сильно различаются 2 момент что нагрузка 11 как в праге она вообще говоря не всегда полезно не всегда нужно то есть если вас простая система и простая модель пусть даже и такой михайлова то она описана довольно простую модель у нее и не надо городить каких-то сложных конструкций от которых потом будете больше гриба чем больше профита получите горчичное тестирования шин это сложно потому что вас трафик который идет через шину он очень рваный вас кито steam и что делать с тем что не делать что это отключило что-то включилось магазин которые работают они могут внезапно возникнуть проблемы с интернет каналам поэтому-то он трактовал 2 в нагрузку х проявлялась интернет-канал он перестал давать на грудь всем хлопка ничего нет потом проблем еще один раз он такой пик сделал большой убраться мне дальше прошел дать нагрузку и это был такой большой такой хаос очень сложно анализировать поэтому гораздо проще просто подать так вот она была и обращайте внимание на требовать нагрузочным старт непосредственно реализации номер один мы тестировали при помощи джимми утром потому что это было требование заказчика но все что я буду дальше говорить она применима вообще ко всем инструментам тестирования которые есть ну что там идея довольно просты и вы их можете реализовать на любом удобном инструменте вот система досталась нам в наследство то есть была какая-то команда которая провела нагрузочное тестирование потом по каким-то причинам вместо ее место занял пришла масло ну дальше проводили тестирование на то есть теми которая была нагрузка была сделана очень прост у нас есть какие-то нагрузочные станции мы по какой-то причине тестовые данные хранить в базе данных локальный во время теста выбираем данные не подаем их наши минус опять я думаю что такое решение было принято из-за того что вам очень удобно делать выбор интера выбор интервал за которую подаете нагрузку то есть и изменили два числа вы сказали запросе и вуаля вы там с 5 до 7 перешли там подается часу до двух и вам было очень легко им было очень легко горизонтально масштабируется есть мы сказали что вот это нагрузочный станции работает так вот с операциями а бейтс тоже мы всего лишь в одном месте вас польза просит поправили и у нас все хорошо ну и это привело к тому что у вас было прям отрезаться сообщение на лету я думаю что люди пример нашли вот по первому пути пути постепенного таком усложнение моделью то есть ну как предположить у нас есть какой-то вот у нас есть какой-то нагрузка до возьмем среднее мы подадим нагрузку средний посмотрим чтобы ну не совсем так поэтому давайте возьмем средние за весь интервала поделим наш интервал 15 минут и будем подавать средне за каждые 15 минут а же посмотрим сколько далеко мы стоим если снова нет ну давайте интервала сделан по пять минут ясен пришла такая в голову идея что если на вообще вот этот интервал снизить до 1 секунды над если как бы в прод в какую-то секунду пошла 10 сообщений но те же самые 10 сообщение в то же самое секунды подадим в тест у нас просто тест вообще отличаться не будут но здесь есть такая проблема что джимми трон не очень хорошо умеет работать с таким потому что идет очень большой overhead на создание thread'ов на их убийство вот поэтому надо как с этим быть и люди придумали одна секунда 1 отряда а что если вот тогда возьмём сейчас сообщение за это 10 за эту секунду и начнет подавать монах подаст конечно не zanussi куна будет подавать от какое-то время во вторую секунду теста 2 3 да со стасом возьмемся сообщение зато 2 секунды тоже начнет подавать вот так 3 секунды 4 секунды 5 секунд то есть постепенно нагрузка так будет расти и если у вас плавный рост нагрузки происходит когда вот google рост и нагрузки то до 45 градусов то вы очень хорошо эмулирует и production но если у вас есть какой-то пик вот этот пик он так вот размазывается мы не мы не можем подать этот пик потому что размазывать из такой архитектуры да вот это первой проблемой вторая проблема что у нас по-прежнему есть overhead на создание трудов к 1 секунду создавать рады это труд затратный много времени занимает поэтому мы хотим выделить какое-то перед тестом пул трудов и вот каждой труда в этом пуле будет брать сообщение в определенность секунду подавать и засыпать наконец снова не придет и очень потом снова просыпаться снова про сообщения с новых подавать их но засыпать его так будет весь тест проходить мы здесь хотим выбрать достаточно большой мы есть не хотим выбирать достаточно большое количество thread'ов потому что мы экономили ресурсы станции но если мы выберем трудов и так очень мало мы получим ситуации что thread должен подавать сообщение но начать по 2 сообщение закрыты период он еще не успел подай сообщение за прошлый период до у нас получается наложение в которой мы не знаем особо что делать поэтому как выбрать оптимальное количество оптимальное количество thread'ов но мы пройдем по всему графе по всему профилю выберем максимальное количество сообщений к такую секунду посмотрим сколько они поддаются ну соответствующее количество трудов возьмем как результат этой реализации то есть команда отстрелялась справилась и нагрузочные испытания вот передала это нам и его семейство сидели сайта реализации все у нас было хорошо вот пока у нас было мало интерфейс или нагрузкой сменялся нас плана то погрешность было около десяти процентов 10 процентов это очень хорошая погрешность то есть довольно таки маленький на потом компании перед произошло перераспределение между различными модами в различных потоками они стали как-то по-другому написано но ты вот и у нас возросло количество пиратство есть раньше у нас было на ноги 15 операция стала 40 до и нагрузку на стала изменяться речи и резко там нет страх статусов наш нагруженные останутся смогла выдавать всего лишь 70 поскольку высокий сезон был уже близко начался как бы хотела результату уже скоро тому как это обычно бывает в авральном режиме начали искать авто можно с проблемой ну и первый на что мы наткнулись что наверно хранить тестах до тестовых данных базе вокально это самая успешная идея да потому что вам нужна база данных по мощности такая же как на продуктивен в окее мы убили тесту убили эту базу данных выгрузили все локально ну потому что колин должно качаться быстро и тут мы отмыли что ну 250 иапф это 250 мс это как бы очень много вот проблема была в том что цвет с труда она не были поделены бы опираться мы по секундам да чтоб было удобно доставать и получалось так что вас большое количество таких маленьких файлов заместо жесткий диск вместо того чтобы читать как последователи он постоянно бегал от одного к другого и все все время работы который выходил все время работы который жесткий диск тротил он потратил на то что тон именно между данными бегал туда-сюда вот и на потребовал примерно 13000 thread'ов ну и для g метра это оказалось не таким очень гигантским числом которого не мог поднять но x наверное не знаю таких инструментов которые в принципе могут работать хорошо с тринадцатью тысячами страдаем потому что вас постоянно идет переключение контекста 1 3d к другой надо тратить очень много времени ресурс поскольку нужно было сделать быстро наш проджект-менеджером очень крутой мужик всякими правдами и неправдами на взял и на ты был еще там множество нагрузочных стаса которых уже расстреляли и подали стрелялись у нас было хорошо и стало понятно что да наверно с таким решением жить дальше не стоит ну а перед тем как переходить ко второму решаю не да еще раз зафиксируем что ну какие то банальные вещи что не храните тестовые данные в базе данных и не используйте гигантское количество thread'ов наверно такой осмысленный вывод что вот есть некоторые естественное развитие системы она как-то развивается только дополняется так далее и наступает момент когда не нужно убить то есть она уже не справляется с нагрузкой и здесь совет не надо пытаться реанимировать труб для похоронить просто бабушку же отдайте должен перейдите к новым инструменты но этот момент на который реально не обращает внимание то что подачи нагрузки тоже нуждается хорошим кони от нее тоже требуется производительность реализация 2 мы решили нокии значит у нас данные читаются с диска очень медленно давайте мы вся загрузим в оперативную память в очередь на сколько у нас 32 гигабайт оперативной памяти весьма приличным и не все конечно теста выданы туда загрузим но какую-то часть сможем вот поскольку у нас будут какие-то worker и разгребать это очередь ну пусть какой-то worker опять во время теста такие данные выдубичи что мы хотим в эту очередь класть мы хотим класть время подачи сообщение в реальном времени и само тело сообщение то есть если вот мы эмулируем про там с 5 утра и там 102 стремились секунды 236 пришло сообщение ну значит тест начался в 10:30 ну вот мы положим что первое сообщение 1032 стремились секунды было отправлять довольно понятно вот если более подробно архитектуру то все сообщения которые были все детство данным и их обвинили пачками get по 5000 это получились там zip-архив чеки и 300 500 мегабайт of теперь дисках читал очень быстро поскольку читал их последовательно works читал этот zip-архив взял и кинул на препроцессор препроцессор он их разве повал он начинает их фильтровать то есть если вот эта операция нашем тесте теперь началась вот мы выкидываем если вот это сообщение как бы не попадает по временной диапазон временной интервал за которым подъем нагрузкам ему тоже выкидай на оставляем только те что нам нужно но здесь происходило по факту правлений интенсивностью и вот сюда был зашит по факту наш просек ну соответственно worker и которую разгребали очередь они работали следующим образом то есть какой-то worker просто взял сообщение сделал минимальную параметризацию и такое горе таро сейчас только это времени до отправки сообщали мне там и осталась та ну 523 миллисекунд я посплю это время проснуться потом сообщение тогда когда его нужно потом возьму следующий вот так работал вот как итог к время подготовки высокого сезона данная архитектура позволило saab россии оптимизировать производительность ну например на страх 140 от в tps до 565 что весьма существенно но для нас главным главные победы было то что мы по смогли подать нагрузку с одной станции нагрузить реально шум от продуктов и вот приятно загрузка цп у нас была в районе 40 процентов на диске где-то на день с процентов были загружены ну и нарам на такую гигантскую очередь мы выделили где-то 16 гигабайтов дополнительный плюс который я всего этого решение наверно самый главный что регулируя степени сажаете в zip файлы вы можете перераспределять нагрузку между циpкa и дисками мы провели где мы привели два испытание когда у нас тест дано вообще не сжимались и когда вот была максимально зажать и zip архив то есть когда мы максимально djali у нас тест выданы начали занимать место на жестком диске в два раза меньше но у нас цикл возросло в два раза больше потребление циpкa то есть примерно в этих диапазонах можете балансировать между дисками и в цикл ну и просто регулировка интенсивности горы горизонтальное масштабирование них немножко подробнее поскольку у нас к тестам данным прим прибита время его отправки и это дело всего лишь один компонент наш препроцессор ты можем легко регулировать интенсивность то есть место потому что подать 102 стремились юката можно уменьшить это время в два раза запада этом 60 одну миллисекунду на следующее сообщение месте 200 вместо двух 136 миллисекунд падает 120 секунд можно подавать начать подавать сообщение до раза быстрее мы можем подавать сообщение в 2 раза медленнее как нам заблагорассудится можно взять и просто подойти 2 сообщения вместо одного и падали два раза большую нагрузку мы можем вообще как бы сказать нам не интересно как они шли в прайде мы хотим постоянно интенсивность и тогда просто мы прибиваем к время сообщения что кажется общение подается через 15 секунд после первого то есть как нам заблагорассудится можем регулировать интенсивность очень просто и горизонтальное масштабирование до мы сделали это просто мы решили не заморачиваться с и синхронизации разных нагрузочных станция между собой по нас какая-то станции начала убегать вперед какая-то не начала остывать вот опять же из того что к тестам данным была прибита время мы сказали но допустим у нас есть две станции поэтому каждое чётное сообщение выходит первая каждый нечетная со второй и таким образом достигается легко горизонтально масштабируется в других инструментах после эта ситуация начал анализировать какие вообще есть другие инструменты которые вам позволят подать нагрузку вот 11 как праге я не нашел то есть может быть они есть но они не сильно не распространены как бы я не нашел единственно что больше подходят на больше подходит под это индекс танк у него архитектура scheduler очень схожа с нашей или наши на самом деле очень сложно с архитектурой индекс танка но к сожалению из коробки он имеет позволять умеет подавать только постоянно нагрузку это такой равномерный рост и ступенчатый то есть готовясь к тому что вам придется дорабатывать его напильником итоге выводу что наверное призвать нагрузка один в один это просто доска но мне свои усилия на технической части больше потратить время на различные виды анализа интерпретация результатов ну такое тоже простой совет который никто практически никогда не соблюдая делаете просто когда это можно сделать просто путем просто другой организации данных и другой работы с ним вы можете увеличить производительность 8 раз ну и как повторить важные детали которые были по докладу что обращайте внимание на инструмент на 3 дня к нагрузочным станции и обращают внимание на качество тестирования как по скрипту есть такой вопрос который очень тесно связан с докладом но к сожалению выходят за его рамки вот так как же все-таки сделать так чтоб не наступить на наши грабли то есть хорошо вот я вам рассказал как решать раз решать просто а как сделать так же спас принц какая проблема не возникло здесь когда начинаешь думать получаются такие не очень как бы позитивные новости что вот как произошло так что люди вот вроде реализовать просто коммуне расскажи все города простота пришел на проект реализован и клевать плохо ли не неэффективно как так получилось наверное получилось так что игрался tender но и центр выиграет компании которые предлагает свои услуги минимальную стоимость эта компания просто реализовала как бы решение которое было применимо только для той ситуации в которой жила тогда компания до ситуация не менялась 8 месяцев и все было хорошо потом ситуация поменялась и решение перестал работать как бы ну наверное у тендеров есть положительные стороны и все эти моменты обсуждались когда принималось решение переходить или не переходить на тнт ряда но допустим наша команда мы сидели 8 месяцев эксплуатировали там не скажем так не оптимальное решение да хорошо мы могли взять и переписать его ну с одной стороны до вы могли переписать с другой стороны все таки мы не могли переписать то что подходит проджект-менеджеры говорю что решение плохое почему ты гришь ну вот эти плохо обрабатывает вот графику когда отеки плох обрабатывать операции много нить arrangements много thread'ов будет nice price никогда много трудов будет не справится но переписывать нельзя потому что но смотри решение жила год и еще два года проживет тамошний три или четыре если повезет до а сейчас из более 30 этой задачи поэтому всякие различные оптимизации мы их ставим так в конец приоритета вот поэтому тоже важный момент который следует учитывать что то как вы решаете различный организационный вопрос на самом деле зависят результаты на груше на тестируем которую получаете от но и на этом замечании хотел бы закончить доклад готов ответить на ваши вопросы спасибо сергей спасибо за доклад не услышал две вещи первая вещь как при подготовке нагрузочного тестирования особенно шины важный момент уделяется сатириком систем по сути мы не тестируем шину как шину мы тестируем ее вместе с элитным систему как мы при этом выделяем объект в этом случае мы как бы должны продублировать для сателлитов систем те же самые характеристики то же самое железа которые мы которые есть у них в кроме потому что в противном случае результаты получится неадекватными ну и соответственно если мы промышленным тестируем на промышленном контуре то соответственно мы можем разрушить данные в этих стать элитных системах нашими тестовыми данными можем да собственно как вот эти проблемы решались тела более подробно узнаем так ну мы не тестировали на проводе да потому что ну как бы по компании подрядчики это ответственность которую как бы не хотят прикладывать ну это большая ответ который как бы не хотят перекладывать вот из тех людей которые тестируют на продакшене но у них примерно есть детских основных идей что они настраивают механизм бэкапы механизма отката чтобы вас механизма отката занимал там пару часов всего лишь если вы реально что-то разрушили то вы могли потом взять очень быстро откатиться и они не давая систему до до того чтобы она полностью упала и полностью разрушилась не знаю ответил на ваш вопрос леня вот а все включая кухню да но это это сложный по задачу очень и как бы на иногда может быть просто неподъемным мы как бы тестировали в этот день компонент хотя бы до хорошо с вами протестируем как бы и вот все предприятие по факту все вот смежные системы но как паста когда такой возможности нет ну приходится обходиться тему что вы можете сделать вам процитировать всего лишь одну ногу и когда посмотреть как будет вести себя это но да и надеяться что продаж не на будет все себя также хорошо и вот как это будет дальше на да в этом случае менее сервере как бы здесь такая как бы ну палка как бы о двух концах . с одной стороны сложность да вы можете никогда не решить а другой все равно что то как то делать надо то есть нас были системы заглушки которые просто потребляли данные ну и как бы они не копились в шине вся как влияет вторая система на работу шины ну интересно было конечно посмотреть но не всегда получается хотелось бы спросить про генерацию сообщений вы их а генерируете связке с определенной деятельностью теста что делать если тест этом надежности длительностью 24 часа это будут же у него большие архивы в этом проблема доставай осталось четыре часа кита утром и шина шина может быть очень много данных поэтому проблему что нужно сначала сюда логировать вот эта очередь оно хорошо прокачивает данный когда визиту эти вас диск читает последовательно несколькими десятки мегабайт секунды можно удается выжить вот и вас нет проблем с вас не хватает данные она проседание по диску там то что память будет может утекать и не хватит у них в этот в этом решении как бы нет нет нигде я не вижу нигде память принципам что тыкать вас всю очередь который как бы разгребает сообщение подалась она уничтожается из памяти то есть в этом решении как бы таких проблем и не столкнуть данном решении максимальную нагрузку которую вы смогли выжить вот мы выжили я просто вот ну мы тестируем спасибо наса грамотно грустно 150 генераторов условному прошлому в такой 7 aero повесился день все как она синхронизируется вот скучаю машину они как бы мы игорю мы синхронизировали у нас получилось у нас не было проблем с синхронизацией в принципе потому что к тестовым даны были была прибита время вас как бы каждая станция знала время когда вам нужно подать той лентой то или иное сообщение не могла странно какая то убираешь вперед если я правильно понял то задержки как бы мы не подаём как бы прям вот один в один да вот миллисекунды миллисекунда но как минимум потому что у вас есть погрешность вычисления времени даже на то есть какие-то сдвиги конечно есть но это как бы не очень не скалывается сильно на продукте вид потому что продукте вас тоже сообщение как-то ходят хаотически если я правильно понял ваш вопрос в память не забирали исходные данные теста муджу метр может пора забрать данная память вот и выгружать потом данная тоже в момент тест с мы приехал тумбочками на диске давать и как бы это решит проблему с диском но смотри допустим у тебя писал изгибает тестовых данных которые ты хочешь прокачай за тест оперативный пассива 30 гигабайт но если 50 до такие вас проблемы то есть поэтому нужно и ткани которого очередь еще здесь был у человека вопрос еще давно хочет подать хочет спросить его слева от него тоже сидит можно передать им пожалуй микрофон быстрый вопрос джу метр в итоге использовали или уже от него полностью не 3 метра мы использовали ну как поскольку он сможет подавать мы используем мы его использовали здесь вы сделали надстройку которая уже метр кидала по очереди да и поочередно там ее счета или внутри g метра у них там есть кастомный код возможность и тот же сыр 223 фильтр на груди то есть мы на него все реализовали внутреннюю очередь но сейчас вроде есть инструмент же метр которые учат внутри организуют тредов да есть ради него дошли мы их просто не использовать так нам нам нам так было проще последний вопрос а все остальные вопросы в дискуссионные зоне можно будет обсудить хорошо ростки вопрос такой правильно я понимаю что пол вопрос по характеристике тестовых данных правильно и понимает что было по сути только два свойства это момент подачи сообщения какого-то и размеры этого сообщения нет ли какие-то были еще дополнительные свойства по тестам данным чтобы получить достаточно хорошую модель как бы я приводил пример когда вы допустим не не сделали достаточно вы разных достаточного разнообразие внутри ваших тестовых данных да и получается что у нас на тесте вся база данных забита тем что вы продаете один на одни и те же товары если как вы не обозначили такого достаточного разнообразия то вас начинаются проблемы с тем что у вас искали запрос по одним и тем же данным работать там допустим быстрее и всяких разных моментов их очень много таких вот маленьких нюансов которые мне представляется возможным как сразу же решил и определите спасибо слушателям"
}