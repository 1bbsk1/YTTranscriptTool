{
  "video_id": "aXctNOV2lUw",
  "channel": "HighLoadChannel",
  "title": "Митап 1: Микросервис. Highload User Group.",
  "views": 6364,
  "duration": 12732,
  "published": "2019-03-20T06:24:55-07:00",
  "text": "1 раз я нормально слышно поможете мне рукой да да меня слышно его пасибо смотрите это наш первый металл под брендом harlot самая такая на текущий момент злободневная тема этой микро сервисы и в общем мы начинаем ура спасибо кто я меня зовут мейсон вадим я рукой теле разработки систем платформ во with a toy собственно то про микро сервисы я вам так стартового расскажу это самые самые основы потому что вот этот метод мы в данный момент по крайней мере позиционируем как некую такую стартовую точку когда мы входим вот в эту чиной тематику и соответственно пытаемся а вот постепенно как то вот подвести вас к тому что вообще такой микро сервисы зачем они почему почему такой hyip и вообще где мы сейчас вот во всем этом хайпе смотрите есть такая штука наверно многие про неё слышали называется кривая гартнера она же там кривая зрелость технологии вот и в общем-то считается что нато любая технология проходит примерно один и тот же путь то есть начало там эта технология вообще рождается потом то некий такой hyip все горят блин это вот самая лучшая в мире технология все надо через нее делать и даже вот я не знаю там банки открывать потом вдруг ну ты оказываешь что банки она не открывает кучу проблем вот и все говорят мне не очередная шляпа все это короче pr это вот те на то нас обманули это все это вообще на самом деле не работает вот а потом наконец нет он народ понимает про что это так как это действительно использовать и для чего это нужно и уже вот в этом вот осмысленном ключе начинает подходить к тому что действительно эта технология может где она применяется и что с этим делать вот и если мы посмотрим на вот последнюю точку то это вот уже такое достаточно плавное развитие того что вот эта технология действительно должна была делать или к чему она постепенно эволюционировало вот но так или иначе смотрите вот в данный момент если мы посмотрим на то где сейчас у нас находится микро сервисы то это вот где-то между разочарованием осмыслением и над и тех кто там то немножко запаздывают они вот идут вниз ажиотажа то есть я очень много общаюсь там с теми кто он да только подходит к этой теме кто он тоже там собрал какие-то грабли у каждого свой фидбэк поэтому вот вот этот путь он достаточно такой длинный но так или иначе смотрите почему я говорю что мы в принципе уже подходим к осмыслению потому что появляется инструментарий которого там еще год назад не было который действительно закрывает он достаточно большое количество проблем есть уже появляются некие такие паттерны которые действительно там применив там 1 2 3 в там счет нам понятном по количестве мы решаем действительно проблемы поэтому в принципе на то можно считает что а есть уже те кто вышел на вот эту вот над плавную кривую и действительно начинает подходить к тому что осмысленно начинает применять микро сервисную текстуру давайте теперь попробуем понять и вообще про что это потому что я вот опять же очень часто встречаем такой знаете популярное мнение что микро сервисы придумали разработчики потому что им очень нравится всякие неведомые штук пилить и на самом деле когда это вот так происходит то микро сервисы нифига не залетают потому что он это выглядит это всегда одинакова тоесть это разработчики приходят на так бизнесу мы ребятам и говорят слушайте тут вот классная штука я через нее все решим на только вот наш большой большой страшный монолит распилить на маленькие кусочки бизнес слова ребята горят ну а чё нам это будет стоить то ничего просто он выпилить ну окей пилить и ничего больше не пострадает ничуть не пострадаем потом оказывается что к этой всей распылительные теме дополнительно нужен инструментарий нужно оказывается там какие-то кубер нету и куче всего и нато куча дополнительных людей которые все это должно поддерживать вот и тут то внутри ребята приходят и говорят нам еще надо полгода чтобы вокруг всего это зоопарк теперь неведомую хрень построить им бред как полгода выгорели ничего не поменяется ну вот так вот получилось вот этот момент когда вот так получилось тут-то всё и ломается потому что на то время не дают денег не дают и говорят ну вон вид как обычно там из говна и палок соберите и пусть она как это работает всё вот и на самом деле если мы говорим про микро сервис и то самый такой базовый посыл это в том что это вот в первую очередь некое такое вот административное решение когда мы понимаем что у нас система должна расти очень быстро когда мы понимаем что у нас куча независимых команд которые должны иметь возможность максимально независимо друг от друга работать когда мы понимаем что мы должны спилить наш бизнес не только вот в рамках одного города но там значительно больше и соответственно у нас команды в разных часовых поясах у нас станут очень сложной коммуникации и вот дробление этой системы она нам в этом помогает вот и вот эти вот подходы именно микро сервисов они во многом про это вот и не последним фактором здесь конечно является то что когда мы очень там быстро растем как бизнес band в том числе очень быстро должны искать людей в нашу команду все мы знаем что сейчас это набор людей в команду это проблема если мы ищем толковых людей поэтому если мы не расширяем свой стек там int заведомо себя ограничиваем потоки людей поэтому говоря о том что микро сервис это административный паттерн мы в том числе имеем ввиду что они нам условно говоря то есть есть определенная оговорки но так или иначе они нам помогают в том что мы можем использовать значительно шире стек технологий чем привод обычном монолите соответственно смотрите россии ты конечно ты истории как всегда есть минусы я вот кнута перечислил здесь вот на главных 4 и здесь именно вопрос в том что мы платим как бы усложнением системы мы платим тем что у нас появляется достаточно большое количество инструментария которого без вот все эти микро сервисной кухня мы бы вообще никогда не вводили и не слышали вот и важный над моменты denta дважды его буквально подчеркиваю это в том что дополнительный инструментарий становится действительно много это куча дополнительной экспертизы это куча дополнительных подходов разработки in the вы должны это вот понимать на старте вот соответственно для чего тогда вся эта история потому что ну естественно есть это помимо того что мы позволяем себе томские лить команды там набирать людей из разных нам технологических стыков мы вот обеспечивая независимую разработку также получаем возможность не только просто вот набирать людей там с разными там бэкграунда my языками и там всем остальным а мы даем себе возможность а там небольшое права на ошибку что называется то есть если раньше когда мы строили большую систему мы должны были четко вам правильно выбрать одну единственную базу мы должны были правильно выбрать фреймворк язык и все остальное и поменять его по ходу дела было безумно сложно и дорого то есть всегда одну то мы слышали истории про то как какой-нибудь гигант там через пять лет после успешного ну то там запуска вдруг неожиданно решил все переписать потому что все вот вот здесь у нас история становится немножко проще потому что мы можем переписывать это там по кусочкам то есть мы например сейчас вот в нашем-то инфраструктуре имеем энное количество micro series of написанных на печке - спокойном режиме переписываем их на гол янг и в общем не имеем никаких проблем вот и соответственно это вот история про то что он там и вот так вот изымая кусочки мы можем постепенно улучшать качество и кода и поддержки на там определенных частей нашей системы и также если мы правильно подходим к разработке микро сервисах если мы действительно обеспечиваем им изолированный запуск изолированных тестирования то это позволяет нам быстрее доставлять код production потому что мы тестируем уже не всю систему не вестью там из 20 тысяч тестов а мы прогоняем там десяток тестов в изолированном окружении это в разы дешевле и быстрее вот ну и соответственно если у нас в принципе масштабирование есть потому что я вела системы которые вот так вот гранулярный развиты но при этом в них нет масштабирования и люди которые вот так распилили в итоге и каюту плачут и говорят мне нафиг давайте обратно в монолите это сольем и все шляпа не работает поэтому если она есть то она действительно очень много упрощает и опять таки если мы правильно строим нашу микро сервис на архитектуру то как бы цена отказа становится чуть меньше то есть если раньше у нас падал весь монолит и над вылетала полностью все то сейчас у нас может вылететь маленький кусочек мы там не покажем где-нибудь одну кнопочку причем если мы на старте это понимали и учитывали что на то наша система не должна складываться как карточный домик то это действительно реальная минимизацию ущерба вот системе целиком собственно достаточно популярный вопрос который мне задают это вот когда не использовать вот здесь вот энное количество поинтов я не буду их все комментировать но так или иначе смотрите а общий камин здесь будет такой что если вы готовы качать экспертизу именно микро сервис но если вы готовы вкладываться вот вот есть дополнительный ту young совсем то вытекающим то стоит пробовать если же у вас нет людей которые там готовы поднять всю эту кухню нду вокруг в общем-то уже сложившийся инфраструктуры то я бы трижды подумал когда наоборот нужно это в первую очередь когда вам нужно очень быстро спилить вашу систему и здесь внутри папки лингам я имею в виду как процесс когда вы должны наращивать мощности там закидывает сервера фунта обслуживать большее количество пользователей так и функционально когда вы не можете нато всю систему там очень быстро писать собственными силами вы что-то lose our city и вы не готовы вот погружать там внешней компании ваш контекст не готовы там разглашать им коммерческую тайну и вы можете над им просто заказывать отдельные сервисы они будут заключать с вами контракт на api и его реализовывать это нормальная история и в общем-то это действительно прекрасно работает и в итоге достаточно там не знает регулярно в общем меня спрашивают а ты был вот сейчас стал новый проект стартовать с микро сервисов скажем так я бы стал именно потому что вот эту всю кухню то я уже прошел несколько раз понимаю где нужно подложить соломки и понимаю в каком месте действительно будет от от микро сервисов профит но если ответ что называется вот в самом общем смысле то нет я бы не стал в любом случае новый проект я бы начал с какого-то монолитного приложения я бы осмыслил контекст доменную модель я бы постарался понять где у меня действительно независимые части в этом приложении и дальше ну то там подойдя какой-то планке начал его распиливать но уже понимая как у меня что в бизнесе работает потому что когда мы стартуем новый проект чаще всего ничего не понятно это очень многое переделывается так часто что за этим просто не успеваешь поэтому вся эта история она становится настолько динамично что переколпаковать код перекашиваются контекст и все это еще накладывать на то что параллельно с этим осваивать кучу кучу новых тузов это сложно дорого и не эффективно поэтому общий вывод такой сначала подумайте готовы ли вы вот тащить это одновременно если нет то скорее всего вы просто когда-нибудь к этому придете это нормально вот смотрите вот такая съемка она просто как некая иллюстрация я ее там достаточно так регулярно показываю это вот примерно там одна двадцатая системы на базе которой я вот обычно иллюстрирую что вообще такое микро сервиса но вот если вы посмотрите там то здесь видно что он то достаточно высокая гранулярный есть какие-то вещи которые постоянно там это видео низкую который является вот отчасти сердцем вот этой всей этой системы это дальше идет над и некое взаимодействие сервисов между собой вот это вот тут некая такая опорная штука а дальше я ног это самые основные вещи расскажу смотрите на есть такой момент как single point авторов это история про то что когда мы пишем микро сервисы нельзя шарить базы между сервисами то есть тем самым вы создаете себе зависимости между сервисами вы потом по сути будете иметь ровно те же проблемы что у вас сейчас в монолите которые вы хотели бы порешать поэтому когда вы делаете ваш и сервисы вы либо должны четко понимать что вот это скоб данных должен обслуживать один конкретный сервис либо вы должны не менее четко понимать что вы разделите эти данные на несколько сервисов но тогда взаимодействие должно быть через api этих сервисов по другому быть не должно как только вы начнете шарить рождения в базу напрямую потом будет очень сложно развязать это в отдельной инстанции и система перестанет масштабироваться соответственно смотрите вот на вот этой картинке видите там то один из сервисов то него прямо помечено что это вот его собственная база и точно так же вот внизу другой сервис у него своя база вот они не пересекаются именно потому что каждая база у сервиса своя это не значит что у каждого свой engine обязательно должна быть например у нас там одному нгади беда а в ней несколько баз in the один сервер там обслуживает ну условно там 20 bass 20 сервисов но это разные базы и они между собой не пересекаются то есть это 20 сервисов каждый из которых знает что на этом сервере есть его база и только в нее он ходит соответственно смотрите есть определенные исключения но эти исключения а не надо тоже должны быть осмысленными то есть вот как здесь например на то у нас задействовано там influx baby для того чтобы являться по сути точкой обмена данными то есть один сервис только пишет второй только читает и грубо говоря это по сути тот же сервис это со своим и пей просто на то он организован в виде базы поэтому до могут быть исключения но эти исключения опять таки следует определенным правилам а одна база одно авнер ства данных тот кто то пишет он собственно является огненным тату читает ну велкам это просто здесь можно начинать что разновидность этой второй момент это шина данных то есть если мы говорим о том что у нас часть сервисов общается между собой просто вот через и винты сбрасывая их шину данных то он-то здесь важный момент в том что мы не гоняем данные целиком то есть там например у нас есть регистрация пользователя один сервис принял информацию о пользователе сгенерил юзера иди дальше он шину не сбрасывает всю информацию о пользователе он просто генерит event чтобы то появился новый юзер юзера иди такой то другой сервис это подхватят и создаст ему там аккаунт третий сервис это тоже подхватит поэтому юзера иди сходит в первый сервис скажет скажите мне имя этого пользователя заберет и нато пришлёт ему там приветственное письмо то есть вот эта вот история о том что шину мы не кидаем бизнес данные вот и следующий момент это то что когда мы используем шину мы четко должны понимать что это некая такая история про то что мы в бросили в черный ящик и обратно может не прилететь соответственно если у нас критично консистентных данных если у нас есть определенные завязки на то что вот эти данные в итоге должны собраться в правильном виде то значит мы четко должны понять как мы будем контролировать консистентной завершенность всего этого процесса как мы случае чего сделаем откат из грубо говоря у нас пользователь создался а там аккаунт мы ему создать не можем соответственно мы должны понять как мы всю эту историю откатим и приведем этого полете в консистентной вид ну то есть здесь вот например мы используем и миску и это очень часто народ вообще спрашивает а там что лучше всего в качестве шины смотрите мы выбираем - ну просто потому что он но не достаточно хорошо это решение показала себя когда мы используем в нескольких дата-центрах обмен вот через шину данными например на 3-беты мкф вот в этом кейсе большие проблемы поэтому если мы говорим называется in general то вот и энеску можно рекомендовать выбитым пью скорее всего нет что вот еще из таких общих рекомендаций это правильный старт сервиса то есть смотрите когда у нас монолит то мы четко знаем в какой момент что инициировала что ну так тому моменту когда вот этот метод выполнится уже все у нас запустилась микро сервисами не так то есть у вас там один сервис уже запустился 2 запустить через минуту если вы сделаете там на старте проверку например что мне вон тот сервис не ответил поэтому я упаду с ошибкой то скорее всего ваша система не запустится никогда потому что вот таких кросс связи это будет расти там прогрессии и соответственно в культ момент у вас случится детлок поэтому каждый сервис должен запуститься и какое-то время разумная ждать пока все его ресурсы соберутся и иметь там определенную реакцию на то как это будет соответственно второй важный момент это то что когда мы говорим о микро сервисах у нас должно быть минимум два инстанса которые запущены одновременно соответственно каждый сервис мы пишем так что два инстанция одновременно корректно работают если у вас 11 instance мешает другому то от гребете мало не покажется дальше по версиям многие про это забывают но на самом деле когда вы выкапываете новую версию то в этот момент у вас получается история что у вас две версии сервиса одновременно в продакшене когда у вас там 50 инстансов одного сервиса единый момент на его заменить на новую версию скорее всего не получится поэтому когда мы в даже вот момент диплом у нас уже две версии сервиса часто бывает их больше потому что есть завязки на api на том что ты исторически поддерживаем поэтому разрабатывая новую версию мы учитываем там определенные паторны то есть мы там например не ломаем совместимость схемы данных или там это как-то компенсируем мы вот эти вот момента мы обычно учитываем вот на старте следующий момент который здесь немножко расскажу это вот тот самый страшный touring я чуть-чуть чем из этого захвачу вот и как стартовая . это вот губернатор я последнее время он слышал да чё там microserver сейчас вот на такой верна пас поставим и все будет неверно не будет потому что губернатор решает из всей этой истории ну хорошо если треть потому что нато остальное это то как эти сервисы запустить не так как эти сервисы даже собрать и не то что там запустить потому что доку бернеса нужно там это все завернуть в докер контейнеры эти на ту докер контейнеры на кого-то сложить оттуда их нужно на то как-то доставить тот самый губернатор сформировать нормальный запуск и это проконтролировать и только потом уже на току бернетт as возьмет на себя часть вот этих всех забот но тем не менее у вас останется и контроль того что это вроде нормально все функционирует и того на то что у вас надо в том же самом губернаторе нормально шарятся ресурсы их действительно там каждому сервису хватает что у вас там то нет истории шумными соседями и так далее и так далее поэтому он до с одной стороны сейчас купер нас очень много на себя берет но далеко не все как альтернатива есть такая штука от компании хэши карп называется nomad и в чем здесь как бы бонус то есть она существенно проще то есть если вы в принципе вот примиритесь к этой истории если вы смотрите на то что там губернатор для нас сложно то попробуйте эту штуку просто как некий старт point как некую штуку которая помогает в регистрации в менеджменте ресурсов по железу и в общем-то это нормальная история вырастите из нома до перейдите на губернатор то есть в общем то 3 на данный момент не дано и все альтернативы там ты виде мясо и прочие шляпы и доложим то совсем не она следующая штука это когда мы уже собрали все эти микро сервис запустили их там в праге и вдруг у вас начинает там все это разваливаться то есть у вас есть там цепочка вызвав сервисов вы в какой-то момент счастлива обнаруживаете что в непонятном месте что-то развалилась вы не можете найти в каком-то он здесь как бы уже вступает в игру такая штука как трассировка и вот но есть такой инструмент как zip кен вот подключая которой вы каждый как бы переход от сервиса к сервису каждый год не то внутренний вызов можете блокировать и наглядно видеть что надо у вас цепочка оборвалась вот на этом сервисе там здесь сработал тайм-аута что то еще то есть вот это вот наглядность целостность системы она действительно важно когда вот этих сервис становится много опять же есть альтернативам ребята из юбера выпустили егерь и в общем то если так вот посмотреть то вот сейчас я бы вот это однозначно выбрал егерь но если вы больше любите внутри джаву вы здорово умеете готовить звуки пир то не нет никаких проблем еще разок взглянуть на zyckin следующая штука смотрите если мы говорим о том же танку бернат асти что он тогда ну то вы сразу это готово вот нырнуть в эту историю то он то встает вопрос как road traffic как это делать корректно и в общем стандартное решение которое есть услуг uber natasa это джон x например в виде там ingress и и в общем это та история который не очень хорошо себя показывает вот поэтому как вменяемой альтернатива я буду то здесь предложил январь вот не буду там подробнее рассказывать скорее сейчас накидываю ключевые слова если нато вы действительно решите в эту историю влезть то можно вот на это посмотреть оно того стоит вот и как бы ну там в дополнении к этому опять же эта история про взаимодействие сервисов и роутинг трафика и понимание как там например нам ограничить там сегмент наших сервисов как понять какие сервисы с кем взаимодействует и так далее и так далее там собрать какие-то базовые метре это вот у этой стены здесь нет а нам прекрасно помогает он с последними версиями губернатора нормально а интегрируется хотя вот и не самыми последними с определенными приседаниями тоже его можно подружить с я знаю достаточно интересный опыт наших ребят у нас lavita которую это запустили его там не на самой последней версии губернатор так что работает немножко расскажу про версия нирования потому что к этому тоже надо обычно не все и не сразу приходят очень многие стартуют с того чтобы друг когда выпускают новые версии сервисов то прям на старте начинают в api выгружать там то вот какие нибудь цифирьки там что то еще и в итоге получается что он вот эти цифры они вы оседают в других сервисах и становятся блогерами по переходу на новую версию соответственно здесь нормальным решением будет зафиксировать именно вот основной скоб данных и во лидировать его через схему то есть вот вместо такой истории получится вот одна у которой будет это дополнительный джейсон схема как-то работает посмотрите на то у нас есть вот такие данные их на то выдает там сервиса да вот и справа это схема сервиса потребителя то есть он ходит к этому сервису забирает же сон и на то что то там с ним делаем и вот если мы посмотрим вот самый низ где у нас блок рик white tone то мы увидим что на самом деле вот этому сервису нужно всего четыре поля и они вот в этой выдачи есть в любой версии потому что это базовые данные без которых мы вообще этот сервис никогда не выпустим все то есть мы отвязались полностью отверстие мы запросили ответ сервиса наложили вы уже сервисе потребители а вот и тот же сон схему проверили что до данные соответствуют и просто начинаем их использовать все ок в итоге вот такой выдачи нам более чем достаточно а это снимает кучу проблем следующий это такой интересный хакк это логирование то есть на то вы помните я рассказывал про егерь есть они над вот свою эту цепочку вызовов сервисов помечают такой штука как trace айди и в какой то момент мы пришли к тому что вот этот рейс иди на добавлять влоги и так давно там и там открывая егерь нашли точку в которого нас разваливается но почему в этом месте развалилась мы в егеря этого не видим то есть мы идем в наш хранилище логов включаем фильтр поэтому trace айди видим полностью на всю цепочку это слугами которая привела к тому что у нас где-то последние развалилась это очень упрощает и ускоряет отладку всех этих сервисов вот поэтому да ладно эта штука которая безумно дешево но очень помогает вот и еще один такой хак это дебаг мод это когда мы сервис в проводе не можем на самом деле нормально там либо жить но зато мы можем дернуть у него он-то некий and point и сказать это по включеном расширенное логирование что вот в этой ситуации когда с тобой непонятно чего происходит мы смогли понять больше что мы могли увидеть что происходит что привело вот именно к этой ситуации ну в общем все спасибо если у вас есть вопросы то самое время их задать да я вот вижу кучу рук а подскажите вот вопрос к организаторам у нас будет второй микрофон или это надо просто вот выкрикивать вместо бинга у нас будет второй микрофон поднимайте руки нет нет чуда не случилось нет если отлично подскажите пожалуйста какие интере коммендации потому что стоит логировать для того чтобы этим потом в большой системе было удобно пользоваться но это настолько широкий вопрос что я могу сбить такой глупой фразой все зависит от вашего контекста потому что смотрите из того что вот прям стоит логировать это вот тот самый trace айди который нато поможет вам вот собрать в принципе вот всю цепочку вызов и надо понять что привело к этой ситуации потому что принципе каждый сервис вы наверное тестировали по отдельности на то он у вас должен работать и на то грубо говоря над вот плотность того чтобы выводить и влоги ананта напрямую зависит от того какая информация вам нужно чтобы для этого сервиса понять что с ними не так принято для нас например там это какая-то там контекстной информации что там возможно там юзер пришел неполный возможно там и где-то там неправильный формат данных сделали там еще что то вот эти вот это все вещи которые там например особенно то что приводит крышам вот это все ну то улетает на то в логе в каком-то нута вменяемом виде то что касается трансформации данных по ходу дела это тоже мазков потому что а именно вот на какой-то комбинацией данных скорее всего у него рвет башку лишь вот как-то так хорошо спасибо здравствуйте большое спасибо за доклад хотел уточнить по одному пункту высказались трон не стоит вправлять бизнес данные в шину и к сожалению а сейчас ты видел что отправляли в шину все и вся можете уточнить что именно является бизнес тонами и почему это плохо туда отправлять смотрите на на самом деле вот бизнес данным здесь мы относим все что помимо айдишник а то есть вот например юзеры юзера мы там то получаем на приводом почту имя фамилия там это год рождения полы не знаю что еще но нтаб шину мы отправим только юзера иди вот потому что как только мы захотим изменить схему данных как только мы там то там не знает тип данных расширительном объем данных или там то уменьшить его то очень сложно будет отследить потребителей в шине потому что он наташина это вот некий черный ящик который мы сбросили и все кому надо самим должны про это узнать то есть они подписываются на этот ивент и говорят о пришел новый пользователь , вот как сервис там on the accounting пойду аккаунт создавая как сервис рассылок не дай ему почту над отправлю и грубо говоря вот этот момент мы создаем жесткую связь с структурой данных если начинаем отправлять ее в шину поэтому вот эта история она очень быстро делает вот всю эту микро сервисную архитектуру совершенно негибкой зато если мы отправляем только идиш ник-то в рамках вот этого сервиса помните я вот показывал схему данных то есть определён скоб дано который есть всегда и соответственно сервис который там например должен приезд она и письмо отправить он поэтому айдишник у обратиться к сервису владельцу данных и на то получит е-мейл гарантированно и мы не будем переживать что-то у нас кто-то другой отвалится из-за того что мы в шину стали бросать другой слепок данных все только вот главная причина в этом . да здравствует развивалки вопрос по и стеновой обычно эти слова идут вместе со словами сервис меж поэтому первый вопрос что вы под этим понимаете почему этих слов не было на слайде потому что тему довольны хребтова во вторых насколько мне известно in voip губер найтись и отдельный бизнес то не очень работает вот и туда же в догонку мне хотелось бы доклад как ваша кубрина из админов по поводу того как круто над они сделали и третий вопрос не кажется ли вам что вы через este пытаетесь закрыть проблемы архитектуры инфраструктурными ключами ну окей я надеюсь что я все еще помню последствия давайте я попробую ответить последовательно смотрите почему я не сказал про сервис мышь потому что я сразу сказала что я сейчас накидываю по сути ключевые слова вот если вы пойдете в эту историю то он про это стоит почитать и если вы начнете читать там про тажин из тела и смотреть на то что такой ингой то скорее всего вы очень быстро поймете для чего этот у другой и как они вам помогут вот это как бы что называется в целом теперь как бы вот то в частностях то есть если мы говорим о том что пытаемся ли мы через из тела закрыть какие то там то там архитектурные момент и это не совсем так потому что это скорее всего никак не связана с архитектурой потому что здесь мы строим некую прикол прикладную прослойку которая помогает нам и оперировать нашими микро сервисами более прозрачно и как бы не реализовывать определенную механику в каждом сервисе вы нас ля ее в сервис мышь поэтому этот раз одно из тех решений которые является откликом на потребности именно вот архитектурного паторну то есть когда у нас большое количество микро сервисов либо мы можем выпускать внутренние либо в которых и то же самое будем реализовать либо мы можем переложить часть этих усилий на тот же и стива и пользоваться его функционал спасибо да еще последний вопрос насколько глубоко он у вас вроде сейчас он у нас на этапе внедрения то есть он прошел это первичные тесты мы посмотрели как что и где едут а вот ближайшее время планируем именно ту же продакшна внедрение спасибо посвяти спасибо за доклад у меня вопрос как ты предполагаешь откатывать транзакции это вот такой вопрос если у тебя там много несчастных баз и нет источников правды в обе стороны привет давно не виделись спасибо слышит на самом деле надо если отвечать вот полу на твой вопрос это будет очень долго поэтому я отвечу очень коротко смотри то есть это все таки не настоящая транзакция то есть здесь не идет речи о том что у нас именно в момент когда вся эта штука происходит в каждой точки должны быть правильные данные скорее у нас должно быть метки которые говорят о том что этот процесс еще идет во первых вот а во вторых на того в этой истории чаще всего появляется некий контролирующий сервис который знает что вот энное количество сервисов подписались на то что они участники процесса и вот эти вот сервис и сказали что они являются типа там обязательными шагами или опциональными и в какой-то момент он просто смотрит что вот за там определенный тайм-аут мы либо собрали либо он опять же в шину обратно сбрасывает что тут ребята поэтому я технику не сложилось не шмогла поэтому давайте каждый подумает и в своем сервисе для себя поймет как ему компенсировать это вот не шмогла это вот если коротко спасибо я тебя поймаю потом ok брать спасибо как делать заглушки для сервисов без факт из есть какой-нибудь о каких заглушек идет речь ну например у разработчика на своей машине до в контуре разработчикам недоступны все сервисы которые употребляют должен смотрите здесь на самом деле нет какого-то прям всеобъемлющего ответа вот но как делаем чаще всего мы то есть есть некий сервис в которой мы выгружаем типа слепок правильного ответа то есть не то мы исходим из того что он это сервис всегда отвечает корректно то есть он выполняет определенный контракт и когда мы тестируем то он то мы поднимаем сервис который представляется что вот это я там сервиса bc вот и на определенные in point и он отдает моки вот этим оки мы снимаем на этапе прохождения сервиса через это наш pipeline то есть у нас есть там тестирование сервиса у нас есть нагрузочное тестирование вот в эти моменты мы имеем возможность снимать вот эти слепки ответов и нато класс thief's end of специальный сервис потом из этого сервиса дну то мы можем с генеральской ти мойки и есть определенная механика как типа запросить позитивный ответ негативный ответ минут а вот по этим слепком это ну относительно просто делается то есть это не покрывает сто процентов потребности но там скажем так процентов в 80 90 с этим абсолютно ок это все окей нет спасибо за так вопрос прорыва тимка энеску маску хорошо умеет сгау and дружить по какой причине вы решили что минскую сильно лучше чем работенку не осмотрите я не горел что мескию сильно лучше чем ребят я говорил что ну то есть определенный кейс именно когда мы говорим о микро сервисах то чаще всего у нас эта история про то что маленькие сообщения нужно быстро сервис и в нашем случае это еще и несколько дата-центров и когда мы пытаемся построить федерацию роботов которые нормально бы работали в муке то центровой среде там и отгребаем много очень странных и непонятных вещей ценностью такого нет то есть он прекрасно работает и на больших лет инси и прекрасно себя ведет когда у нас вдруг на другом конце вдруг что-то отламывается то есть именно вот в этом случае в этом кейсе он себя показывает хорошо спасибо за так вот скажите авто мучительный рукой я не вижу где вы о бинга пасибо стану что вы используете для хранения лагов и для по стране дашбордов смотрите для хранения логов мы в общем то стандартно используем л.к. вот но так как некий inside смотрите есть такая штука как ли house и мы в какой-то момент попробовали в нее выгружать влоги и с удивлением обнаружили что там терабайт сырых лугов становится там в 20 там 30 раз меньше это при загружать его в кли house и в общем если правильно эти лаги там нато предварительно приготовить там распарсить положительно там по определенным тегом вот они использовать полнотекстовый поиск то это вообще-то шикарная штука если же да там их там заранее не готовим то это вогнутый елка со всеми вытекающими про какой даже пойдет речь но это собственно стандартный если это но ты-то мелкота этой детали баки банан то либо там ее вариации и в общем то там мы просто ну так в качестве ключа задаем тот самый trace айди мы его нато храним в отдельном поле и по нему надо просто на на равно это делаем выборку вот а для cliff house а там как будто своим на ту приблуды здесь прям точно не скажу врать не буду и снова здравствуйте и еще один вопрос относительно того что у нас есть micro сервис и у каждого есть своя база данных как я понимаю вы используете кубер нить из и наверно докер правильно ну логично и достаточно известна проблема то что если мы поднимаю в docker и базу данных то по имеем кучу записи куча чтения и база данных ведет себя очень нехорошо как-то с этим боретесь поднимайте на тех же подав на которых мы с этим очень просто боремся мы не запускаем базы в кубер надписи дает на самом деле у нас первый доклад будет про маску или вк обернитесь на ближайшем hallowed кстати перк она научилась таки это делать как-то нет заворачивают и вот будем слушать что нет не надо так делать это твой доклад на холоде он уже был или еще будет будет хорошо значит нас два доклада одинок перк он и другое от фланта посмотрим да то есть как бы отлично вот вот и обсудим вадим спасибо огромное спасибо спасибо ребята так всем привет меня зовут олег был рад приветствовать на нашем первом help me the pitt почему все почему решили делать на почему решили делать митап и я смотрю на то как работает наш программной комедию нарежет все вообще да то есть как бы вот если это когда-то была если это очень просто там собрались очень такие очень крутые ребята таки немножко сна бы ну блин кто так делает восемнадцатом году разве так можно про это рассказывать какой вывод да можно из этого сделать нету информации нету мест где можно чему-то научиться с нуля до где можно послушать простой обзорный доклад обзорный доклад это прям черная метка для хайло воды обзорный доклад например там перечень технологий да вот например как сейчас до список список штук который можно использовать на микро сервисов это просто все сразу не пройдет holod исключительно при решении конкретных кейсах предполагается что все кто посещают highload уже знают что такое микро сервис кстати кто был находим хотя бы на одном все те же самые да понятно этот вид на для новичков если что хорошо ну да то есть мы решили сделать прям целую серию митапов про основы про то что уже как бы подразумевается то есть мы прям пройдемся по всем сколько их там 20 25 паттернов архитектурных и прям по каждому по металлу микро сервисы понятно дело с чему еще могли начать самой хайповой ща с история микро сервисы это первое потом подумаем что там накидаю в чатике в селе подписаны на чатик высоким говоря там чатик highload конференции мы там абсурдно с запрещенным телеграме мы там обсуждаем инкогнито да то есть как бы чтоб нас не запалили обсуждаем темы будущих мероприятий дальше пойдем примерно каждый месяц в разных городах не только в москве будем делать по митап чеку по одному на каждую каждый архитектурный паттерн соответственно через два года посмотрим что делать дальше так продолжаем у нас сейчас следующий доклад про собственно хорошо микро сервиса классно кстати у кого микро сервисы то есть вот прям реально да по чесноку микро сервисы вот прямо так нормально да то есть как бы у каждого микро сервиса своя база друг другу не лазят да всё по чесноку да у кого по чесноку микро сервисы хорошо ну нормально самом деле да . вы не у всех нового нормально так основная проблема да микро сервиса не так давно не то что появились здание так а кстати кто у кого просто может быть просто сервисной ориентированной архитектура ну что это на самом деле на мой взгляд почтенные тоже ok большая часть проектов разрабатывались начинали разрабатываться как монолитом мою часть проектов которые разрабатывались несколько лет назад начинали они большие толстенькие путники их надо пилить и вот этот большая головная боль как пили тебя то есть проекты по распилу монолитов проходят как бы занимает несколько лет иногда я знаю как тут же тоже avi там пилила своему на ли туда это было прикольно полная более история и сейчас у нас именно такой доклад мы послушаем а потом уже перерывчик на подкрепиться андрей передаю слово как пилили монолит в додо пицца нашим для пиццы да у нас алена управления да то есть нам сейчас как раз подключается что нужно 1 раз всё работает всем привет меня зовут андре мари вский я работаю в компании додо пицца мне сказали тут будут начинающие они тут есть этот доклад для вас будем по ходу импровизировать какие-нибудь и возможных олеварн ее истории поднимем которые продвинутым людям интересно жду запуска первого слайда окей окей так ну я о чем хотел рассказать да я хотел рассказать историю о том как мы распиливали свой монолит у нас есть большая legacy система сделанная в классической трехслойной архитектуре все по фаулер у соответственно как ее можно превратить микро сервисы зачем это делать какими способами это можно сделать ждем уже презентацию но додо пицца да давайте начну без слайдов да про закладки значит никаких закладок нет дело закрыто сегодня додо пицца это международная сеть пиццерий у нас 375 пиццерий в 10 странах мира это россия сша китай великобритания румыния страны средней азии страны прибалтики большинство пиццерий на текущий момент в россии по количеству пиццерий в принципе додо пицца эта сеть номер 1 в россии кто-нибудь кстати знает здесь вот про dota пиццу пробовал отлично потому что додо пицца это еще и первая компания которая давала рекламу на федеральных каналах вот нам очень понравилось мы будем это повторять потому что то рекламной кампании как бы сеть номер 1 в россии было в москве никому неизвестно то есть я куда бы ни приходило есть додо пицца зла как нет вынесу такого додо пицца вносил самом деле да надо захватывать москву питер чем мы сейчас и занимаемся ну параллельно захватывая китай и сша может быть powerpoint будет работать отлично так но без слайдов уже сложно становится потому что там архитектура нарисована но это расскажи про информационная система ваши параметры на двадцатый год когда как бы все и завертелось то есть 61 пиццерия 300 заказов часто еще запросов в секунду плюс сто пятьсот фич видим что особо наши квадратики это не поменялись то есть мы в этот же трехслойной архитектуру просто засунули все сто пятьсот вич в бэк-офисе теперь не только кассира пицца maker там и менеджер доставки менеджер смены офисы управляющий администратор тайный покупатель api для виджетов каких-то внешних на лэндингах все это там добавился клиентский сайта до пицца ru который подсел на ту же бизнес-логику бизнес-логика стала жирной все это там в одном наборе той лелик прокатываются заказа считается зарплата проводится инвентаризация считаются остатки отчеты теперь базу данных покраснела до и специальные совы красные стало плохо она как бы одна потребности вот у них у всех много соответственно вот они классические проблемы монолита это перегруженная база данных одна-единственная перегруженный веб-сервер но это была наша наверно специфическая проблема так вышло что в приложении было state full не надо комментировать думаю монолит он не падает по кирпичикам он падает сразу соответственно если где-то уязвимость бак там плохой неоптимальный код не работает всё сразу не и и менеджер отчеты не строят но самое страшное что и и пиццерия не может заказать принимать и выполнять монолит тяжело релизе понятно что даже по меня строчку кода бизнес в ее нужно провести там полный регресс не понятно что это за affected перри выкладывать все казалось бы такие независимые вещи как бэк-офис и клиентский сайт а выкладываются вместе потому что шарят единый бизнес layer который стоит из сильно связанного сложного запутанного года понятно что сложно с этим работать кладбище технологии до что этим называю вот с какими технологиями мы начали с такими монолит он и будет жить семь лет или 70 лет но что в принципе задача там перевести а склад и все четыре на допустим пор она ну настолько сложно что просто невозможно и добавить какие-то новые новый функционал на корму у вас нет они все четыре проект понятное дело нельзя плюс ко всему этому добавляется вот что о чем я рассказывал да то есть в 2015 году стало понятно что сеть будет расти то есть мы удваиваем каждый год количество пиццерии в сети а иногда даже в два с половиной раза она растет и это как бы не просто какой-то тренд построенный там в экселе на основе циферок предыдущих да это вполне конкретные были планы отдела продаж то есть известные города известные партнер известны даты открытия собственно этот план он как был построен там в 2014 пятнадцатом году он так и сбывается как бы сейчас у нас ну не совсем мы удвоились но будет больше 400 пиццерий концу года однозначно как бы вот этот план нам показывает что монолитная архитектура она под этот рост не масштабируется мы все понимаем что она масштабируется только вертикально то есть просто можно брать сервера мощнее и мощнее и мощнее что мы и делали мы перешли там на their 3 вижу потом нато r2 чуть не перешли на той r1 дальше переходить было некуда что здесь кстати и показано да то есть что произошло 2016 году она упала она упала она горела и упала то есть количество пиццерии выросла до 150 4 заказы выросли с 300 до 3000 запросы в секунду увеличились пять раз расходы на инфраструктуру или через двадцать раз тут это типичные вот закидывание проблем деньгами типичное вертикальное масштабирование когда вы просто наращиваем нашей мощности соответственно ну как бы проблемы понятные решения там тоже понятно она лежит в области микро сервисов но здесь тоже интересный кисть что как бы когда был пожар было не особо-то распила поэтому мы выжимали из монолита все что можно было выжать и это хороший кейс в том плане что ну не надо спешить ломать монолит потому что плохой код он не станет хорошим если мы его сломаем и там положим микро serviced останется там такой же плохой неоптимальный код и и такие же запросы вот если мы там делали state full но она не станет стоит леса то что станет нектар сервиса но соответственно мы сделали веб-сервера stateless мы просто переписали например сайт это пример того что можно взять там какой-то плохой неоптимальный код и переписать его не бояться этого не стесняться мы поставили началь эскалировать чтение то есть поставили реплики из реплик начали читать редко меняющиеся данные справочнике поставили хорошую подсистему кэширования между всем этим просто взяли планы запросов по шерсти или потеряли их то есть оптимизировали сами запросы в мастер базе облегчили там транзакции прочее плюс в том числе и в монолите не обязательно нужно идти микро сервисы можно найти какие-то вещи которые сделаны ну синхронными транзакционными напрасно и перенести их просто поставить там рыбе темпе и сделать очередь сообщений окей здесь вот собственно да выжимаем из монолита все делаете states ставьте кластер балансируете нагрузку kosher уйти все что сумеете не всегда можно малой кровью кэшировать понятно что у кэширование есть одна большая про мы это инвалида ция каша да но то что можно лучше и жировать точно также реплика читайте редко меняющиеся данные сама реплика не серебряная пуля потому что реплика всегда отстаёт ну в штатном режиме это какие-то миллисекунды в плохих ситуациях то секунды ужасных ситуациях этой минуты но естественно если сценарий когда мы пишем что-то в транзакция потом хотим читать из реплики такой сценарий делать нельзя потому что мы получим не консистентные несогласованные данные поэтому только редко меняющиеся даны только справочники вот можно так масштабировать чтением из реплик банальные запроса до оптимизируйте запросы кбт используйте асинхронных где можно и не стесняйтесь переписывать плохой код такие простые советы ну соответственно как видим даже внутри монолита можно решить топ горячих проблем остальные проблемы конечно же остались не решен и опять же мы не готовы к такому росту сети мы не готовы к тому что в 2020 году у нас будет две тысячи пиццерий собственно база данных у нас был майский майский он просто не масштабируется под это не как он там нет multimaster а то есть его низ масштабирует на запись там нет шарден га то есть все это нужно делать как-то хитрыми способами ну есть перк она но опять же таки их олеварн ее темы для кулуаров кто-нибудь видел вообще в природе хороший multimaster ну что-то да ворог ли enterprise на что то есть в москве или ну нет его можно да можно потом по подраться ok соответственно да вот оно решение до микро сервисной архитектура вместо одного большого монолита заменим его на множество небольших слабо связанных модулей взаимодействующих через и.п. я вот намерена дает такое абстрактное определение то есть не хочу сейчас говорить о том что такой микро сервис какой у вас куб как их правильно делать об этом мы поговорим чуть дальше просто уже из этого абстрактного определения понятен профи да то есть мы эти независимые маленькие сервисы можем независимо масштабировать можем выбирать какие-то релевантные технологии в зависимости от их задач в зависимости от той нагрузки которые они должны решать можем их независимо релизе и самое важное что часто не включают вот например есть доклад у виктора про микро сервисы он вот эти пункты не включает хотя я считаю что при правильной прожарки при правильной декомпозиции микро серы создают еще следующий профит мы можем получить реально разные силой мы можем управлять этими разными целей мы можем понимать что вот этот сервис для менеджера который строят отчет раз в неделю а вот этот сервис работает 24 на 7 он готовит пиццу и но от него зависит работоспособность и сети и опять же если все таки хорошо писать и декомпозировать кот-то разделяй и властвуй то есть такой код легче развивать и понимать переходим так самому собственно суть и рассказа как как же собственно нужно распилить монолитно микро сервис и вот здесь я собрал скажем так ну а славные легенды если там загуглить микро сервис это можно вот найти такие легенды что в микро серы сорта самое главное это слово микро то есть это ну что это команда которая может наесться двумя пиццами да не больше вот такая команда должна разрабатывать микро сервис или в нем должно быть 100 или 1000 строк если там 1000 одна строка кода это уже очень большой сервис он не микро его нужно там распилить на 2 или может быть мы возьмем просто там нашу базу данных или наш домен и вот каждая табличка это будет микро сервис или это unix своей то есть каждый микро сервис выполняет четко одну функцию выполняют его хорошо микро сервис помещается в голове или у него должна быть обязательно собственная б.д. ну много вопросов много легенд на эту тему и вот я думал как об этом интерес не рассказать и решил что если мы попробовал просто взять и сделать такой микро сервис вот мы пробуем его сделать да у нас есть монолит он занимается приемом заказа в том числе с разных источников сайта с косы с мобильного приложения частью приема заказа является конечно валидация заказа прекрасный кандидат чтобы сделать действительно стоящее микро сервис который поместится то в одной голове его могут делать два программиста ну почему два потому что один парень ну не может работать в нем будет 100 строк кода давайте в общем сделаем такой сервис то есть вырежем эту логику создадим сервис проверки заказа теперь когда мы принимаем заказ для того чтобы его проверить монолит каждый раз будет вызывать вылядит ордер вот у нашего сервиса и посмотрим что что собственно случится значит что у нас происходит с доступностью поскольку это сервис который где-то крутится он может быть недоступен совершенно не с по независимым по своим причинам просто он может отвалиться может как-то там скакать сеть в облаке это происходит часто там абсолютно анрил а я был network может просто если мы не поставили кластер ну не дай бог мы не сделали кластер то у нас там уйдет машина на перезагрузку будет обновляться windows весну тысячи причин почему он может быть недоступен залез на доступность машин нашего монолит она не улучшился на ухудшилось уж теперь он зависит от сервис он письмо ничего не может он не может принять заказ пиццерия не может работать и теперь если раньше не работал один монолит теперь они работают вдвоем что случился производительностью банальной вещи rp сида ремонт просижу школ до удаленный вызов это не in process вызов это не вызов дельте которая лежит рядом это сетевой вызов почти теперь традиционно да он имеет свою стоимость соответственно если понимать слова производительность как то количество запросов которые сервер может обработать единицу времени дата поскольку время отклика она адские выросла то производительность наша упал а потому что на каждый вот допустим мы не знаем хотим во лидировать заказ когда клиент меняет картину на какие-то другие его действия до мы вызываем монолит он реализует свой сценарий там ходит в базу и вызывает каждый раз вот этот сервис время отклика увеличилась ну что случилось безопасностью тоже тривиальная вещь поскольку это отдельный сервер это больше сервис больше не да и лель его нужно как-то защищать его нельзя просто так выставить интернет если мы его выставил интернет нам нужна какая-то авторизация ну проще всего в данном случае поскольку это такой белый сервис просто скрыть его во внутренней сети что происходит с инфраструктурой до но теперь мы понимаем что на самом деле с точки зрения вот ценности у нас появилось два монолита потому что раньше мы и вот молились на один монолит чтобы он не упал теперь мы молимся еще и на сервис проверки заказа чтобы он не упал оставаться таким золотыми его обвел желтой рамочкой вот она ушла от него зависит критичный функционал что случилось с релизами ну как бы независимые релизы они возможны только важно понимать что теперь мы должны поддерживать все версии этого сервиса которые могут использоваться монолитом потому что если мы поменяем вдруг айпи и так независимо за релизом то все поломается но надо признать что это не мега проблема в основном конечно меняется имплементация поэтому независимой релизы это наверно вот я дальше самаре скажу единственная позитивная история вот в таком микро сервисе что случилось с кодом да но мы теряем типизации матерями теле sense видите специально там написал смешную ошибку никто нам не помешает сделать такую ошибку больше не visual studio не raider соответственно нужна какая-то статически типизированный обертка вокруг оси и клиента нужно ее написать или сгенерировать что случилось с отладкой да мы больше не можем так бежать по нашему коду сделать с тупым тупо смотреть что там происходит особенно если мы сделали такой хороший микро сервис который мы написали например на кого у нас вся система на топните кстати не рассказал заметил никакой ступин ту мы не сделаем нам нужно это как-то все там пологом ковырять добавляем обязательно в каждой request correlation найди иначе мы просто пологом потом не соотнесем теле квесты которые пришли к нам из клиенты из браузера с теми которые пошли наших сервис проверки заказа то есть весь этот не а трассируем всю эту цепочку и так в итоге да мы поставили сервис в золотой кластер молимся на него так же как на монолит сделали ретро и обязательно потому что у нас андре-луи был network добавили correlation один request написали или сгенерировали отвертку вокруг а что тебе клиента и поддерживать все версия и которые вот могут быть в работе записал что вы получили но производительность у нас снизилась как я рассказывал инфраструктуру у нас усложнилась и даже возможно подорожала ну на самом деле это зависит мы можем поставить этот микро сервис там туда же приткнуть где монолит если там был какой-то запас по мощностям но манали джон обычно сжирает все мощности поэтому запаса нет его надо куда-то на новый сервер оставить доступность монолита потенциально снизилась теперь у него нет самостоятельно выселил зависит от нашего микро сервиса появилось много инфраструктурного кода все эти ретро и обертки поддержка версий ну и зеленые радостно это действительно стало весело их шо релизиться если вдруг бизнес хочет менять валидацию заказа но каждый день мы можем прямо релизе каждый день и каждый час это будет прекрасное удобно ну давайте что мы так набросились на маленькие micro series давайте сделаем его покрупней давайте теперь возьмем целый блок приема заказа и вырежем его из нашего монолита и скажем что вот теперь если мы хотим принять заказ он будет храниться в отдельной базе эта база будет принадлежать сервису своему сервис приема заказа и монолит будет вызывать create ордер каждый раз когда нужно принять заказ и соответственно заказы из база мы тоже удалим потому что они переедут свою в базу данных микро сервиса ну происходит очевидное до поскольку теперь это не одна база данных вызов микро сервиса он он не транзакционный мы как бы цел и созданных больше не гарантируем то есть если у нас был такой сценарий что мы хотим принять заказ отправить его в базу и обновить там историю покупок клиента больше это не происходит как одна транзакция то есть если у нас отваливается наш сервис приема заказа то ну тут зависит очередность если он отваливается первым как бы все хорошо ладно он отвалился ничего не делаем но если он не отвалился отвалилась например база то уже дальше не совсем понятно что делать потому что ну никаких механизмов для отката creator top service не предоставляет ну и в принципе это не так тривиально я думаю что все представляют значит здесь есть классическое решение до которое рекомендуется применять всем кто у кого нет особенно монолита кто начинать сразу с микро сервисов нужно просто не делать ничего синхронно нужно делать синхронно нужно использовать мисочку то есть мы просто берем и вент о том что у нас нужно принять какой-то заказ отправляется в мисочку дальше мисочки уже пушит тех кому эта информация нужна то есть он вызывает creator до руси раз приема заказа и он там вызывает что-то что-то в базе данных естественно все это сыр троими потому что мы помним дарила и был network все-все отваливается в любой момент просто на на миллисекунду моргнула сеть без retrieve ничего делать нельзя значит в чем специфика монолита да в том что синхронно и не превращается так просто вы синхронный то есть для того чтобы сделать синхронно и асинхронно нужно просто выкинуть весь монолиты написать код заново ну банально начиная с того что вот мы возьмем юань он же он же заблокированным чего-то ждёт дамы что-то добавляем какую-то запись в какую-то табличку на экране и пользователь ждет когда она там появится да если мы начнем делать это синхронно нам нужен просто другой тип uiaa который называется the space to space way ну который понимает что это в принципе отложено действие с непредсказуемым временем выполнение то есть хорошем случае это там миллисекунды в плохом случае там пять минут и как бы окей мы готовы к этой ситуации естественно ну монолит к этой ситуации не готов не так он спроектированный так он сделан поэтому здесь есть замечательный паттерн который называется локалку чем его суть мы в той же базе в которую монолит пишет все там что ему нужно создаем некую локальную очередь некую таблицу и в одной транзакции мы соответственно добавляем в эту локальную очередь информацию о том что нужно вызвать creed ортер что у нас появился заказ и выполняем все остальные транзакционные действия которые выполнял монолит раньше сам сценарий теперь ну соответственно эта транзакция да если она не пройдёт она там откатиться нет ну целостность гарантируется соответственно мы дальше ставим фоновую задачу которая извлекает из локальной очереди эти заказы и начинает их проталкивать сервис приема заказа конечно с ретро яме ну собственно здесь что это эта рабочая схема просто нужно понимать что не так-то просто это все выглядит ну соответственно если мы начинаем вот так проталкивать наш заказ с ретро ими он должен быть на shape должен быть эдем патентном иначе ретро и просто поспал создают дубликатов в базе данных то есть наши 5 должен понимать что такой заказ уже есть и как-то адекватно на это реагировать но это как бы еще не все допустим вот мы хотим чтоб наш сервис теперь не только создавался к основе обновлял его ну клиент неправильно ввела адрес он хочет это за адрес поправить поэтому мы сделали метод апдейт артер апдейт ardor он также пойдет через локальную очередь все эти события там накопятся их наша job в нашем фоновой задачи выберет и начнет вызывать сей раз приема заказа поскольку это network мы все понимаю что в метрике например отсутствие или наличие response а ничего не значит последовательность вызовов тоже ничего особо не значит она дойдет тогда когда дойдет поэтому собственно никакой очередность у нас не гарантируется у нас может произойти так штабные тортов придет раньше чем creed ортер и наш сервис он должен быть к этому готов наш сервис должен быть к этому готов он должен понимать что шел 1 тардар то мы как бы вот эту информацию запомним подождем когда придет греет ордер и дальше поднимем этот апдейт и в общем получим то что называется i want consist асада согласованность конечном счете то есть какой-то момент времени приняв все эти события мы получим их монолитной базе и в микро сервисной базе одинаковую картину данных что случилось бизнесом ну бизнес такое говорит он говорит ну асинхронность это все хорошо но например дело в том что у нас вся кухня мотивировано на скорость выполнения заказа то почему вдруг она стала там на три секунды позже приходить ну не совсем прямо на что они там получают у них там какие-то китай они получают за это премии все это важно хотим real-time да ну поэтому мы делаем просто такой а что здесь можно сделать какой здесь можно сделать real-time можно так чуть-чуть подсластить пилюлю поэтому мы вызываем корее тортов сразу то есть мы не ждем когда он ляжет в очередь там не ждем когда его отработает job а если он не прошел но просто не повезло ну скажем так он в 90 процентах случаев там пройдет и поскольку наша передам патентные коммутативной то нет проблем что он там заново попробует сознаете тот клеит ордер ничего не произойдет просто он проигнорирует этот запрос ну вот такой обходной маневр соответственно что с инфраструктурой доступностью силой ну та же самая история что это такой же критичный сервис на который точно также нужно обращать внимание как на весь монолит но что без него в принципе весь монолит не имеет смысла весь наш бизнес про то чтобы принять заказ и приготовить пиццу что слышно перова ним да она она масштабируется это как бы действительно true story то есть поскольку мы теперь в транзакции не выполняем кучу действий которые нужны для того чтобы создать заказ мы просто там добавляем какую-то запись то мы можем кидать тысячи таких ивентов в секунду мы можем выбрать для сервиса приема заказа уже какую-то другую базу не mais quel которая будет поддерживать допустим sharding соответственно как то соответственно масштабировать наш create ордер итоге до все то же самое доставил сервис кластер делаем ретро и correlation найди типизированный обертка нужно поддерживать несколько версий учимся жить без транзакции да то есть нам нужно очередь сообщений чаще всего в монолите это паттерн локалку добавляем его в код и не делаем наша пишет был он был энди патентный переделал чтобы он был коммутативным нужно принять звучит просто ну на словах звучит просто одна строчка 1 пуле там списке на самом деле увеличивает разработку там трудоемкости и он не знаю раз в пять просто чтобы сделать коммутативным ну если у нас есть событие и так с десяток с заказом да и все они от придут в каком-то порядке и все это нужно адекватно как-то воспринимать что имеем в итоге до производительность снизилась но я зачеркнул потому что мы наш micro series укрупнили соответственно мы просто вызываем его на каждый прием заказа и пренебрежимо вот этот уже уже вот эти cast in a network они пренебрежимо малы инфраструктура она также усложнилась подорожала доступность снизилась появилось очень много инфраструктурного кода ну то есть что я называю инфраструктурным кодом это не тот код который про бизнес на это тот код про то чтобы сделать ретро и про то чтобы он был импотент и про event консистенции прочее да все все что не про домен соответственно разрабатывать стало сложнее и дольше 5 баги стали дороже из-за отсутствия транзакции да тоже о чем я забыл упомянуть кстати что кто-нибудь когда это разбирал вот то что накопилось в очереди потому что вот хорошо мы говорили что сервис отваливается и нас спасает очередь data service когда не поднимется из очереди там все про пушиться в него окей что если в сервисе просто пока там бак и нужно всем подниматься днем и ночью чинить этот баг в это время в очереди накапливается там 10000 каких-нибудь ивентов которые нужно дальше раз кристи либо писать код который автоматом сделает либо это нужно сделать руками но тот кто делал тот поймёт что это ну это очень дорого это очень дорогие бриллиантовые баги получаются релизы сервиса быстрые лёгкие монолитная база данных разгрузилось действительно потому что основной поток запросов связанных со зданием заказы ушел из нее и действительно мы можем масштабируется по 1000 заказов в секунду реальная история реально сервис которые мы делали реальные как бы нагрузки который мы лорд тестер не буду дальше значит уже продолжать там что если еще крупнее попробуем сразу сделать выводы без картинок до что гипотеза в том что чем больше работы сервис может выполнить автономно тем меньше зависимости у него и и тем лучше с доступностью то есть мы вот этот факт что нашего доступность она как бы так пошатнулась мы его можем исправить просто у крупная наши микро серы всегда превращая их в макро сервиса и чем шире домен тем проще реализовать фича внутри сервиса тем не бывает такое что какой-то каприз бизнеса не за то непонятно как реализовать в такой синхронной архитектуре переходим к выводам дать то есть как же как же мы распилили монолитно микро сервисе что такое микро сервис по нашему с точки зрения функции это bound and контекст то есть это ровно то что рекомендует мартин фаулер в своей статье how to break монолит in the micros services он как бы говорит что если у вас есть монолита бить его поползут контекстом самое забавное что в другой статье которая называется по моему you shoot straight from a woman a little он говорит что не начинайте проекта с микро сервисов начинать всегда с монолита связав эти два утверждения воедино мы приходим к тому что балда контекст и единственный способ разбить монолит вообще на микро сервис выложен если вы начали с монолиту то вас уже монолитная вы хотите пить на микро сервис вот на он тот контекст значит он имеет свое хранилище данных и благодаря этому он обеспечивает 70 процентов из цикла сущностей своего домена благодаря этому как бы собственно мы можем как-то регулировать целей мы можем регулировать performance и время отклика потому что ему не нужно на каждый чих куда-то ходить и кого-то вызывать да он какую-то вот большую часть работы по своему домену может сделать сам он обеспечивает транзакционных для своих сущностей и у нас часто он имеет юань то есть мы в микросфер исключаем в том числе и пользовательский интерфейс например микро сервис casada он включает и рабочее место кассира его интерфейс с точки зрения бизнеса удобно когда микро сервис имеет смысл в мире бизнеса у них есть реальный продукт оунер это просто удобно ну кто знает тот поймет обсуждать это в едином баттлоге обсуждать этот там с точки зрения единого планирования с точки зрения инфраструктуры может быть развернута своем окружении имеет собственный солей для разработчика он живет в своем репозитории не делят прикладной код с другими сервисами релизиться независимо взаимодействуют с внешним миром через ebay мы по сути это я перечисляю то что у рихтера вылов докладе 12 факторные сервис и там дальше будет ссылочка ну и так чтобы похвалиться собственно а может и не похвалиться просто показать вот к чему мы пришли то есть действительно какие-то микро сервисы мы вынесли вот они нарисованы мы начали с производственных процессов сам наиболее критичных они действительно сделаны в тот парадигме как я рассказал о недостаточно макро они берут свой балл вот контекст свой крупный кусок домена свою ой свою базу и выполняют свою работу благодаря этому их и 5 кстати не невелик то есть это там два три четыре метода потому что они они сами выполнена достаточно большой кусок работы сами управляют жизненным циклом своих сущностей так но вот материалы которые я упомянул просто на всякий случай наверное все это видели уже а все спасибо осталось ли время на вопросы я просто вышел за все рамки развитие спать ваших доклад у меня такой вопрос может быть там прикладной вот вы рассказывали что в нескольких странах соответственно долл а работает интересно были ли какие-то случаи когда например бизнес-логика которая вынесена микро сервисы от страны к стране к примеру сильно отличалась как какие такие вопросы решали ну это такие случаи них полно то есть например интеграция с кассовыми аппаратами она везде разное ну и решается такой вопрос тем что но он лишается плагины архитектурой то есть micro сервис это как некое ядро вокруг которого работают плагины и подключаться разные плагины принадле интеграции с кассами но остальные вопрос точно так же ну какие там эсэмэс эквайринг и так далее решается через плагин и спасибо большое за доклад меня вот какой вопрос вы когда говорили о том что вы сократили время там насколько на три секунды получении заказа и может быть там типа 10 процентов заказов были не оплаченные ушли в никуда я не так говорил если что сказали 90 процентов они вот как бы правильные заказы цитата нет нет можно и поправлю если вопрос вокруг этого то наверное лучше сразу круг сколько эти миллисекунду в деньгах бизнесу стоит но ни одно не правильно возможно я высказался то есть не это я говорил я говорил что когда мы делаем синхронной асинхронном и пропускаем все через мисочку то у нас какие-то секунды там набрасываются но в каких-то плохих случаях соответственно если эти секунды важны бизнесу то есть вот обходной такой трюк который я показал он эти секунды экономит но будут конечно какой то процент а заказов которые не пройдут в таком синхронном режиме но они просто спустя те же секунды пройдут в асинхронном то есть они не теряются там не теряются деньги просто они чуть позже поступят в пиццерию ну на 10 секунд или на минуту позже дело в том что ну звучит это может быть и не важно но для бизнеса это реально критично потому что там мы стоит счетчик на секунды там такая мотивация ну то есть что нужно в общем то вплоть до секунд считается время приготовления пиццы спасибо так я услышал уже для меня наболевшее слова остынет до этот на и соответственно вы распилили не уходя с дот на это на микро сервиса doth not care уходи вот хорошо то есть вы все-таки микро сервиса масштабируете уже находясь на dota от кори и надо под linux но я сейчас даже скажу еще более страшную вещь мы начали пилить и даже что-то распилили без cooper шок шок зале аплодисменты вопрос был на самом раз тогда уже нужно дирижер да и вижу рк uber он был настолько сырой ну он сейчас стал достаточно сыроват но получше то сейчас мы уже в мир кубера входим соответственно мир куберы linux мы входим вот у меня вопрос был действительно как масштабируете и на чем то есть сервиса на кубе там остатки на винде дальше держимся какие-то и как это по компонентам немножечко сейчас кубер у нас это только пилот который выходит в продакшн потому что в принципе сам кубер вейдер вышел там какую-то превью потом еще вышел в другую какую-то стадию совершенно недавно вот до этого конечно но все это дело с просто руками то есть все это обычные виртуальные машины именно это и сдерживала кстати рост ну то есть скажу банальную вещь опять же вдруг кто не знает что действительно после кубера они начинают расти как на дрожжах то есть как только мы освоили кубер у нас там сразу появилось пять новых микро сервисов просто до этого они появлялись годами но потому что реально просто менеджер это все очень тяжело у вас предпочитают анимешную доменную модель обложенную том пачками сервисов или вы обогащаете свои модели и функционалом я лично pride анимешную модель в монолите был анемичной а модель но не потому что я ее предпочитаю там не я это делал вот самих уже сервисах как бы мы устали от холивар of там каждый предпочитает свою модель ну то есть то то что такого мне удалось уговорить они предпочитают анимешную те кто очень хочет они делают там классические ddd хорошо и второй вопрос а если на кухне интернет за барахлит то пицца не будет вот это странно что не было этого вопроса знаете я когда шел там сколько уже лет 5 назад компания я думал что эта проблема проблема оказалась вот за все пять лет что такое проблема не существует в принципе ну во-первых каждой пиццерии есть резервный канал то есть они обязаны подключать двух провайдеров и казалось бы да все держится на интернете ни разу за время существования dota с не представлял asos сколько серьезной проблемы отсутствие интернета они работают пицца не выпекается из нет интернета пицца не выпекается если там там нет никакого зла резервного плана нет ничего это вот тот самый интересный vision федора овчинникова который казался новым безумным скажем так да я лично слышал о каких мнений но спустя годы никогда не был одну ни одной подобной проблемы cex.io спадала там база у нас подала все подавай интернет не падал здоро андрей спасибо я передам перед тем как мы продолжим передам слово команде ламода чуть-чуть расскажет про их боль микро сервисы и расскажешь такой дальше до коллеги добрый день меня зовут тимур я руководитель отдела разработки онлайн-магазина в ламода мы все находимся в здании офиса ламода и самом деле история про микро сервисы нам очень-очень интересно потому что мы два года уже живем примерно в том аду и в таунхаусе про которые рассказывали коллеги мы даже сделали про этот доклад на эти мой коллега андрей феськов расскажу про наши архитектуру а вы распилили уже или или вы в процессе этот бесконечный процесс на самом деле потому что у нас очень большой монолиты их несколько они на питание на php и мы их постепенно распиливаем на голые ноги о чем нас этих радаре указано и дамы ушел мы большие мальчики мы переехали в поверни таз огребли с этим правда кучу проблем но микро сервисе позволили нам правда в бирме уменьшить тайм ту market упростить скиллинг наших приложений позволили нам использовать разные технологии по крайней мере в части to the bass для того чтобы хранить наши данные для того чтобы процессить у нас используется кафка и в целом мы были бы довольны если бы не количество микро сервиса которые есть сейчас у нас это порядка 50 или 70 штук и нагрузка например сеть которая возникает в процессе эксплуатации процессе скажем так использовать их микро heroes of она просто бешеная то есть это какие-то гигабит и и усиление нагрузки когда вы на один пользовательский запрос пунктом получаете плюс 10 запросов в разной микро сервисы сетевые это действительно большая проблема и на самом деле все то что просто сегодня работа рассказывали ребята это тоже нас сильно касается и мне кажется что вообще это хороший здравые идеи начать разговаривать про эти проблемы потому что ну вот за эти два года чтобы затем учимся было сложно в комьюнити потому что информация есть но и и очень мало и мы очень хотим услышать доклад про на холоде про базу данных в купер на это типа должность актуальная тема вообще велкам приходите к нам почаще нe имeeт об и мы готовы всех приглашать дальше же невидимо расскажет что вылетаешь друзья как обещали у нас сейчас будет пицца и я расскажу что еще нужно знать так как вы заметили у нас тут довольно узкий коридор поэтому мы будем медленно выходить из зала в одну дверку не толпись там если вы выйдете прям слева будут перси и пицца прям можно взять тарелочки проходить дальше справа вы найдете висит туалет а дальше будет коридору холл и можно выйти на покурить просьба в зал спицы не заходите очень берегут здесь покрытия и встречаемся через сколько минут олег встречаемся в 21:10 через 20 минут супер погнали мы будем разговаривать про то как с этим хозяйством жить и рассмотрим к пример работы микро сервисов по одной очень крупной компаний телекоммуникационной компании вот сейчас мы наблюдаем классические последствия монолита да то есть выход из зала зал один выход один да да распараллелить никак нельзя вот так делать ну смысле как бы здесь по-другому у него и у причем мы наблюдаем ситуацию прямо еще классическую просто а по-другому то и нельзя да потому что выхода другого нет а куда он ведет я не знаю он ведет на улицу там нет пиццы нет на второе это всё ещё до не 1 раз 1 1 1 или бумаги наша установка паза . давай 1 раз коллеги уже пора 3 минут осталось коллеги рассаживаемся рассаживаемся так во время предыдущего вопроса мы выяснили что здесь ну прям половина точно пишет на микро сервисах точно использовать этот паттерн ok давайте так я хочу немножко информация у кого больше двух микро сервисов пожалуйста поднимите руку продолжайте держать до больше двух больше трех больше 5 и больше десяти нормально больше 20 больше 50 больше 100 на 100 он сломался окей хорошо есть еще больше ста микро сервисов вот именно вот отдельность сущности которые типа про друг друга ничего не знают и общаются друг с другом по шине или как-то там окей много короче и как же это все богатство поддерживать нам сейчас расскажет дмитрий который про это все знает правильно итак начинаем 1 1 1 там не всякое нормально остальные слайды светлая не думаю что будет проблема итак все ред меня зовут дима столяров я из компании флант последние десять лет я работаю там техническим директором и в целом я один из основателей этой компании но я думаю что вы можете знать мое лицо по ряду других выступлений прежде чем начать рассказывать этот доклад я хочу сказать некоторые дисклеймер даже три диска мира во первых обычно хорошая история имеет некоторое начала некоторую сюжетную завязку имеет основной сюжет и имеет развязку у меня так получилось в этом докладе что здесь вот только начало только сюжетная завязка причем не просто начала и сюжетная завязка у меня это еще и трагедия то есть я как бы заранее извиняюсь но сегодня получится завязка трагедии но при этом будут некоторые выводы я думаю что будет интересно 2 дисклеймер всегда когда готовишь доклад ты сначала думаешь что будешь говорить об одном а когда ты делаешь доклад ты говоришь о другом любой человек который выступал это знает поэтому доклад будет совсем не о том что написано ну то есть на самом деле конечно об этом но очень мало про эксплуатацию и очень много про размер микро сервис третий диск война какой же был третий диск война а мы же занимаемся эксплуатацией и соответственно я никогда не занимался в прямую архитектурой и разработке программного обеспечения занимаюсь постоянной эксплуатации бибоп сам поэтому конечно это взгляд со стороны эксплуатации итак поехали я бы хотел начать свой доклад 1 очень старого и очень известного графика на котором по вертикали у нас есть продуктивность по горизонтали есть базовая сложность если мы возьмем монолит то график с монолитом выглядит вот так и вот это то самое место когда из-за сложности у нас из-за того что монолит разросся продуктивность и эффективность работы начинает падать если мы возьмем и нарисуем такой же график для монолиты понятно что никто это никогда не измерял понятно что это некоторое эмпирическое история но если мы возьмем такой же график дома для микро сервиса то поначалу у нас эффективность работы сильно ниже а потом когда эта штука разрастается мы деградируем не так сильно разумеется эту штуку придумал не я и вообще живя на этой планете в 2018 году что-нибудь придумать очень сложно эту штуку нарисовал этот график кто его нарисовал вот этот дядя его сегодня упоминали как минимум несколько раз его зовут мартин фаулер и это то как фаулер сравнивает микро сервис с монолитом по тому в какой момент когда что лучше делать так как мы все активно живем в истории с губернатором я бы хотел немножко расширить этот график и рассказать что в него привносит губернатор смотрите если мы говорим про микро сервисы и начинаем делать микро сервиса скальпер над сам-то у нас происходит вот такая штука почему потому что микро сервиса накладывает очень сильное требование на инфраструктуру ок убернатор большую часть этих требований разрешает и типа когда мы делаем микро сервис с кубинцем это может быть практически так же просто как делать монолит по крайней мере это может казаться в первый момент но надо помнить что если мы запихаем монолит в губернатор и воспользуемся там частью понятно что монолит уже давно и у всех он не совсем монолит он такой монолит об этом скажу позже но обратите внимание что губернатор тут практически ничего не меняется этим графиком с моей точки зрения и я дальше буду говорить о ситуации что у нас есть монолит и у нас есть micro сервисная архитектура и то и другое живет cabernet этот самая самая главная мысль которую я хочу сказать я ни разу в жизни не видел нормальной микро сервисной архитектуры ни разу в жизни ни в одном проекте у вас вопрос и вопрос номер один вообще димы стоит ли тебе верить а вопрос номер два что ты вообще понимаешь под нормальной микро сервисной архитектурой я начну с ответа на вопрос номер два вот если взять этот замечательную рисунок фаулера то вот эта зона это нормальная микро сервисной архитектура такая микро сервисная архитектура которая приносит вам реальную пользу которая не мешает вам жить а помогает увеличивает продуктивность я и дальше буду называть полезной микро сервис ностью ну простите за банальность определения разумеется есть вредная микро сервис ность это тогда когда ну вы поняли когда вы микро сервисы не добавляют а только оттягивают а понятно что определение очень неточное понятно что она базируется на каких-то ощущениях и воображаемом сравнение потому что мы видим проект с такой-то архитектурой и можем представить только как он бы выглядел там в монолите и мы видим монолит можем представить микро сервисов но это моя точка зрения и есть много причин почему я так считаю на базе моего личного опыта теперь про мой личный опыт смотрите я работаю в атланте и за этот год мы посмотрели восемьдесят пять проектов надо понимать что не все они микро сервисные и ну там может быть половина может быть даже треть имеют микро сервисную архитектуру но это очень много и большая часть людей которые работают в разработке не могут столько посмотреть мы как аутсорсинг компания имеем вот эту вот фишку консалтинга когда мы видим много много много разных проектов и у нас есть еще 2 фича мы не занимаемся там советами мы не занимаемся внедрением мы занимаемся обслуживанием подключи мы видим проект обычно много лет и мы видим как вот это вот микро сервисную архитектура много лет живет или как вот этот монолит много лет живет видим на вроде видим со всеми теми приколами которые та или иная архитектура приносят на продевать с начала года я посмотрел восемьдесят пять разных проектов от маленьких компаний от средних компаний и несколько от очень крупных но это там крупнейшая я не могу называть но крупнейшие компании в россии может быть в этой компании 5 разработчиков может быть в не 500 разработчиков вы понимаете что 500 разрабов это это очень много надеюсь вы теперь мне немножко верите и вот в чем история получилось как то так что я считаю что ни одно из тех архитектур который я видел не находится в хорошей зоне они все находятся в зоне вредной микро сервис насти и тут очень страшный момент для меня потому что я например сейчас обижаю всех наших клиентов и говорю что у них у всех очень хреново архитектура например но смотрите как к этому можно подойти к нам приходит новый клиент я замечаю у них какие-то ошибки которые уже видел других я знаю какие они посредстве приведут я рассказываю рассказываю рассказал мне не очень верят потому что пришел какой-то там чувак а вот мне когда олег бунин несколько недель назад написал расскажи про эксплуатацию микро сервисов мне прям знаете такой хочется рассказать один раз как это выглядит вот с нашей стороны со стороны эксплуатации со стороны фланта сейчас буду шутить все эти ваши микро сервисы как выглядят ну и попробовать все-таки систематизировать как-то наш опыт и поделиться им сейчас я начну очень сильно повторяй теорию но постараюсь принести вам интересно если взять опять фаулера и если посмотреть что у него написано что нам как какую пользу нам приносит микро сервиса то там четко написано три вещи это четкие границы модульности это независимые диплом и это свобода выбора технологии но в этом году 85 проекта в прошлом году не знаю сколько не считал 10 лет до этого тем более не считал я много разговаривал с разработчиками с архитекторами и спрашивал а зачем вы это сделали зачем вот этими красив зачем вам он с почему вы приняли такое решение и составил некоторый свой список ожиданий и вот что мы все вместе ждем от микро сервисов конечно же вещь номер один которую мы ждем это четкие границы модульности я переведу в ощущениях я вот сейчас буду постоянно варить про ощущения четкие границы модульности означает что вот у нас есть вот этот страшный монолит а мы его взяли разложили по аккуратненьким китовым repository им в которых у нас чисто и вот то мне перемешано что-то там теплое с красным или вы понимаете вот ожидании у у всех от микро сервиса что у нас будет вот по полочкам независимость деплоя мы все рассчитываем что мы сможем катать наши сервисы независимо зачем нам катать наши сервисы независимо мы потому что мы хотим быстрее разрабатывать мы хотим пароль и параллельно разрабатывать какие-то фичи поэтому мы хотим их катать отдельно на самом деле мы не хотим и отдельно катать мы хотим быстрее разрабатывать но ждем что нам микро сервисной архитектуру позволит их отдельно катать свободу выбора технологии всем понятно много они уже сегодня говорили пропускаю независимость разработки тоже мы ее очень сильно ждем от микро сервиса мы ждем что мы можем отдать этот микро сервис той команде этот микро сервис той команде или этот микро сервисному разработчику и тот тому и они параллельно что-то сделают и смогут быстрее разрабатывать разумеется мы ждем раздельные масштабировании мы ждем что наши замечательные микро сервиса мы сможем спилить отдельно разумеется мы ждем большую надежность есть какая-то такая история про частичную деградацию и все почему думают что есть у нас будет 20 микро сервисов об этом прошла докладчик очень хорошо говорил все почему-то думают что если у нас будет 20 микро сервисов и один из них наш нас будет частичная деградация не будет там какая-то кнопка работать мы ждем что у нас будет большая надежность мы ждем что у нас будет измеримость нагрузки мы будем понимать что вот под эту фичу у нас только то там ресурсов под эту фичу столько-то ресурсов от это фича у нас неоправданно тяжелая нам надо переписать мы будем понимать где где сколько ресурсов и самое главное чем мы ждем мы ждем что нас микро сервисы будут легкими вот вот это слово легкие я не знаю откуда она вообще берется если честно вот у нас есть монолит он какой тяжелый правильно а микро сервиса значит какие они легкие ну вы же все тоже так думаете микро сервис легкие вот мы ждем что будет легкий микро сервис я не помню зачем этот слайд а для того чтобы вам передать ту массу проблем которую я чувствую вижу я хочу вам рассказать как выглядит вот архитектура микро сервисная с которой я вынужден сталкиваться я хочу очень важный point отметить что я не я не имею ничего против людей которые делают эти ошибки но наверное 2018 год и настал момент перестать делать эти ошибки да и надо нам начать бороться с с этими ошибками более методично и поэтому я пришёл сегодня сюда специально прилетел для того чтобы вам это рассказать итак для того чтобы вы мне поверили я сейчас возьму и сделаю собирательный образ вот именно собирательный образ из кучи разных проектов налеплю архитектуру микро сервисную вредную вредно видите какой она вредная вы знаете вся поехали значит у нас будет проект интернет-магазина будущего который должен стать разумеется сначала конкурентом amazon а потом его выкинуть с рынка ну или хотя бы озона если не амазона у нас обязательно есть micro сервис каталог скажите у кого есть micro сервис каталог вашем проекте ну какие-то единичные руки я не верю короче судя судя по нашим клиентам микро сервис каталог должен быть у всех значит а значит у вас есть некрасиво из каталога вы просто боитесь об этом сказать короче мы думали что мы в этот микро сервис там будут у нас товары каталог товаров на мы сделаем интернет-магазин потом и правда подумали что там будут только категории товаров а товары будут лежать в отдельный микро сервисе продукт я сейчас начну очень быстро говорить потому что потому что надолго но я пока вам это не расскажу вы мне не поверите не поймете весь тот у нас обязательно есть micro сервис frontend который обращается каталога получает каталог товаров потом обращается к продукт и получать товары выдает наружу там или html или спа или черт знает что у нас обязательно есть пользователь с браузером который ходит в микро сервис frontend у нас обязательно есть micro сервисе который отвечает на запросы из браузер то не знаю pagination или там дополнительно информацию о товаре и так далее так далее так далее у нас обязательно есть micro service search что он делает все понимают у нас есть обязательно микро сервис ордер который что делает принимает заказы и хранит себе заказы позволяет их там как-то обрабатывать у нас обязательно есть micro сервис payment то ли эта интеграция со шлюзами туалета биллинг ну что-то в платежами явно как выяснилось у нас есть пользователя и под это мы сделали отдельный микро сервис как выяснилось пользователь нам надо логиниться и под это мы тоже сделали отдельный микро сервис они же микро вы помните кстати к микро сервисы aws вообще обращается каждый из микро сервисов на каждом запросе потому что им нужно проверить мы ничего там про про токены не знали поэтому на каждом запросе лоуса проверяем сессию а у юзера еще данные достаем из нас что сказать но это детали разумеется у нас есть мобильные приложения разумеется для мобильных приложений у нас есть мобильная пиа и разумеется у нас есть ldpi потому что нет ну какой интернет магазин без chateau а раз есть чат обязательно есть micro сервис websocket который реализует вы поняли асинхронный ebay высоких на картинке у наших товаров есть картинки и разумеется мою работу с картинками выделили в отдельный микро сервис и мышь который хранит данные микро сервисе сторож а ещё у нас есть видео которое тоже хранит данные микро сервисе сторож translation это вообще вот мое любимое мы же делаем amazon так как это amazon он должен быть во всех странах у нас должны быть переводы и мы решили что кнопочки в интерфейсе вообще все константы мы будем хранить в отдельном микро сервисе чтобы могли переводчики переводить и вот все это классно работала а ещё у нас есть local дизайн когда вот я первый раз увидел проект с двумя сервисами translation локализация знаете меня разорвало но потом выяснилось в организации или лежат странные информации о том какая там валюта сколько там точек после запятой и так далее зачем они это вытащили новости нам на сайте надо показывать новости под новости мы решили залепить отдельный frontend у нас основной фронт когда показывает блок обращается к news фронту тот ему выдают кусок hdmi ли он его всегда встраивает точно также мы сделали статический страницы потому что на сайте надо показывать контакт или информацию о доставке или вот роутер у большинства из вас есть это на консервы своего называете по-разному у вас была предыдущая версия сайта и ссылки были в яндексе и вам нужно было ссылки сохранил адресацию сохранить поэтому вы сделали микро ценность который хранит старые ссылки позволяет redirect она но адреса есть такой у вас ладно нету ну analytics если мы делаем amazon какой как как как как вообще может быть без без без анализа модератор это вообще самая прекрасная штука смотрите изначально мы думали что все заказы легитимные но потом выяснилось то что часть заказов нелегитимных а нам надо их как-то проверять соответственно над как звонить клиенту и спрашивать его действительно заказали поэтому вот смотрите сейчас начинается очень интересная штука поэтому когда пользователь создает заказ заказ создается в микро сервисе модератор и когда его модератор там проверяет нажимает кнопку заказа микро сервисом модератор создается микро сервисе ордер в это же логично разумеется раз у нас есть модератор значит нас есть внутренний пользователь значит у нас есть некоторая админка значит у нас есть фронту этого модератора ещё у нас есть конструктор товаров который как-то там нам позволяет характеристики товаров задавать еще что-то их добавлять это мой любимый микро сервис а знаете что он делает он склад пополняет не об а почему а потому что ну как бы когда бизнес прибежала попросил его сделать тех людей которые там за ними нг отвечают их не было бы хоть стажеры вообще задачи казалось очень странным поэтому сказали вот вот и иди сделай как бы все он сделал выкатил теперь так работает у нас есть micro сервис склад черт побери но вы не думаете это не склад эта штука которая загружает остатки склада на склад это вообще отдельное приложение которое никак и нам не относится мы это мы им не занимаюсь открыт другая команда занимается почуяли нет другая команда занимается а у нас своя микро сервисную архитектура есть еще orders к женщина самом деле processing заказов тоже совершенно в другой системе а мы здесь только их принимаем и туда отдаем в эту систему все значит вот у нас мощная микро сервисный архитектур давайте быстро посмотрим на чем это написали начале мы на руках потому что ну как бы мы любим руми фронтовые кусочки мы написали на но джейс потому что он асинхронный потому что можно удобно запросы проектировать ну понимаете да они не живут connection и aus это наслышаны написали на расти потому что туда валится столько запросов чтобы просто но мы мы мы поняли нам нужно носи носи мы побоялись взяли рост и мышц видео мы тоже хотели на растянули бак не нашли поэтому сделали нога тут у нас java разработчик был ее он сказал но ваш 1 vga и вот этим всем остальное мы написали на печать и почему потому что у нас начали заканчиваться сроки и нам нужно было сделать быстро уже наконец то вот еще мы сходили на конференцию по микро сервисом и нам сказали что каждого микро сервиса должно быть автономность соответственно своя база и свой кэш соответственно тут мы использовали memcache тут мы использовали редис тут нас файловый кеш почему стажер стажер мы его потом уволили а даже не знали что нас там файловый кеш varnish вот самая классная вещь вообще во всей этой архитектуре и the varnish знаете почему потому что из него дается 98 процентов всех request of если вот это все к чертям удалить об этом узнает только два процента пользователей а все остальное у нас все равно отдается искренно новый по-другому не заработала баз данных москве не знаю почему здесь здесь почему-то postgres поиск и аналитика без власти к вообще никак и конечно кассандра для 100 раджа ну потому что там 500 петабайт куда мы еще сложим как не в кассандру да почему нас 500 петабайт на 10 тысяч картинок просто don't ask ну вот такая вот архитектура возвращаемся мы к фаулер у и он говорит что микро сервисы приходят с расплатой ну говорит конечно немножко по-другому на мы это вот уже читаем именно так он говорит что так как систему распределенная мы начинаем конечно же заниматься программированием распределенные системы и со всеми вытекающими последствиями я не знаю как переводится на русский язык иван шел консистенции но я думаю что вы все знаете что этот термин означает и конечно же с микро сервисами у нас получается колоссальные первичен complexity но фоулера мы не считаем не слушаем а мы разбираемся с тем что же мы получили с нашими ожиданиями этот смотрите мы ожидали что у нас будут четкие границы модулей для того чтобы выкатить изменения сколько микро сервисов нам нужно поправить ни одно изменение мы не можем выкатить поправив один микро сервис мы правим минимум половину ну потому что нас translation потом просто минимум половину можно ли произвести можно и забраться в том как это работает без трассировщика нет поэтому вместо четких то есть у нас любой за про я почему про трассировщик потому что у нас любой запрос обрабатывается половиной микро сервиса вот чем мы не делали запрос там чик чик чик чик чик какая четкая граница модульности мы вообще не понимаем что происходит вместо четкие границы модульность у нас получился раз вы знаете паттерн большой комок грязи есть такой архитектурный паттерн вот получился распределенный кому грязи и он щас это докажу смотрите диаграмма как request находят нет ну ну ну вы видели тут ну она же так и ходит да да это для тех двух процентов независимость тепло и технически да мы можем перекатить каждый микро сервис отдельно реально можем но на практике с учетом того что у нас всегда выкатываются несколько микро сервисов у нас получается какая история мы никогда не знаем что нужно выкатить сначала этот или или тот микро сервис и мы должны записать что ввиду того что мы меняем там три четыре пять микро сервисов они один на другого зависит нам нужно помнить порядок релиза и нам нужно отдельно тестировать порядок релизы у нас выход превращается просто в какое-то ну это это мучение то есть нам нужно тестировать в правильном ли мы поряде на отдельном контре нам нужно тестировать правильном ли мы порядке выкатывай микро сервисы поэтому вместо независимости тепло и у нас получился просто дуб у нас отсутствие deploy мы не можем релизнуться для нас рис это страх свобода выбора технологий есть до давняя история про беспредел versus свобода вот не понимаю как здесь отличить свободу выбора технологий от беспредела выбора технологий очень важно не выбирать технологии потому что мы хотим это поиграть я всегда когда вижу микро сервис на расти или нога или на надо джейси вместо того чтобы написать php на простом языке в котором не надо думать про утечку ресурсов мне даже слов нету простите я не слышу ваш комментарий независимость разработки ну реально не слышно представьте себе сделать тестовый контур для для вот этого вот просто представьте себе сделать тестовый контур для этого нам нужно выкатить все это ну потому что она по отдельности никогда не работает и мы не можем ничего из этого по отдельности протестировать нужно все это целиком выкатить в точной копии что и прот а потом каждый раз когда мой пруд поменялись и все тестовые контура не забудь также обновить к чему это приводит к тому что количество тестовых контуров которые мы вообще можем содержать она там минимальный там два три в на уж мы просто больше поддерживать не можем а локальная могу это взять развернуть локально да нет ну да да да докер до 16 терабайт памяти в ноутбуке lenovo ну короче получается то что разработчик работает до с одним микро сервисом но он программирует наугад потому что он не может это никогда протестировать ему нужно дождаться когда освободится один из этих трех священных тестовых контуров которые мы не можем поддерживать и тут вот картинка независимость разработки такие порванные оковы а получается не возможность разработки потому что у нас одни сплошные баки блокировки и муки раздельные масштабирования да вот чем микро сервиса нам точно дают это раздельное масштабировании мы можем поставить наши бренды отдельно но базы данных у вас тоже горизонтально масштабируется в нашей архитектуре там только кассандра может масштабироваться все остальное москве лес после сами мы даже про мангу забыли соответственно раздельные масштабирование есть но она очень условная большая надежность но все понимаю да что выход из строя любого микро сервиса просто любого микро сервиса валит тут все наверное нет ни любого если там конструктор упадет наверное пользователя не узнают но выход из строя практически любого микро сервиса ломает все к чертям и самое главное мы не можем сделать один микро сервис отказа устойчивым почему потому что очень разный стык потому что нам нужно сделать отказоустойчивость каждого машинам каша каждого редиса каждого мая скверов и лавр везде все это продумать а их тут 30 это просто невозможно так как возможно в если у вас operation тим из 30 человек под интернет-магазин абсолютная неустойчивость это яркий атрибут вредной микро сервис ность нагрузка у нас реально измени мая легкость микро сервисов то есть был у нас простите вместо этого раньше один битрикс мы можем не никак не комментировать любим мы его или нет а получилось вот это смотрите понятно что у нас просто огромные сетевые накладки потому что мы начали делать что-то по request у нас появился round trip тайн которого раньше не было с которым мы не работали понятно что у нас запросы множится и у нас на входе не знаю 500р ps а а мы потом такие заходим на dns и смотрим 20 тысяч запросов на dns срезов и мы такие откуда вы видели это нет вашей архитектуре окей количество данных так как мы начали бороться с тем что у нас очень много sabre квестов мы начали данные реплицировать хранить какие-то там ну не очень синхронизированные но копии каши у нас количество данных в итоге выросло поэтому вместо легких микро сервисов мы получили сплошные накладные расходы но и этом все но и этим все не заканчивается shine общение я тут просто не видно вверх не помнишь и на слайде написано их почти 200 это напомнить шина сообщений нам нужно скорее всего ее сделать нам нужно скорее всего ее поддерживать нам нужно скорее всего научиться с ней работать нам нужно скорее всего освоить все паттерны и так далее так далее так далее вот это вообще моя самая любимая тема как сделать backup ну казалось бы взял да сделала вы понимаете что вот у этой архитектуры backup сделать просто невозможно вы не можете сделать point in time backup единственный способ сделать point in time backup выключить трафик весь дождаться пока все изменения там до прилетят в этот момент службы копить вы можете это сделать на пройдя в 5 пятницу вечером ok ну но нет но реально они но как бы не смешно да но но ни одна микро сервисная архитектура ни один проект микро сервисной архитектура не имеет консистентных бэкапов вы когда если вдруг не дай бог начнете из них восстановился вас фронт потеряете какие-то данные что-то там не долетит где-то будет не consistency ну это любом просто зачем это здесь непонятно несколько регионов мы же делаем серьезный проект который должен быть устойчив между разными регионами понимаете да что это сделать невозможно потому что от реплицировать каждый из вот этих вот стейдж штук просто анриал вот это вообще классная фича нам нужно резко обновить печки мы берем и делаем 25 коммитов в разные репозитарии или memcache мы берем и делаем 20 комментов хорошо что микро сервисов 30 вас как только количество становится большим вам нужно иногда вносить централизованное изменение вы нанимаете специального человек который он делает мир шире квестов гид лобби с одним и тем же изменениям ну чрезвычайная операционная сложность я не знаю как прокомментировать но у меня есть ощущение что там экспоненциальный рост ну то есть у вас штук становится не в 10 раз сложнее об стол и просто на пустом месте зачем тут этот слайд о я вспомнил зачем вот это слайд кроме вредной microserver снасти бывает очень вредная microserver снасть с моей точки зрения бывает еще и губительная микро сервис ность и если мы почитаем фаулера опять то он говорит что ребята делаете монолит сначала потому что ну и собственно почему он приводит свой личный опыт и говорить то что большая часть проектов которые стартовали как монолит а потом из-за возросшей сложности вынуждены были его распилить были успешны большая часть проектов которые стартовали с микро сервисной архитектура той или иной мере пострадали из-за этой микро сервисной архитектуры еще одна вещь о которой говорит как фаулер так и разные другие архитекторы для того чтобы вас проект микро сервисной архитектуре был успешным вы должны знать очень хорошо предметную область и как делать микро сервисную архитектуру и лучший способ узнать предметную область это сделает монолит который потом разрезать и предыдущий докладчик говорил ровно об этом если вы услышали но что делать если мы уже оказались в этой ситуации но вот если мы взяли и пришли в эту ситуацию как первый шаг к излечению алкоголизма вот спасибо признать очень приятно алексей первый шаг к решению любой проблемы согласиться с ней и понять что эта проблема ничто нам так нормально не не что мы хотим продолжать страдать что мы делаем когда у нас монолит разросся и стал огромным стал большим комком грязи что мы делаем ну после того как у нас закончились возможности докупать ресурсов мы его мы мы его режем режем монолит режем а вот если мы попали вот в эту историю мы должны это обратно склеивать резать ли не укрупнять главное понять что вот это вот чрезмерная микро сервис ность архитектуру нам мешает и не помогает начать укрупнять сейчас быстро пробегусь по тому как бы я эту крупняк вот в этом конкретном кейсе ну во-первых смотрите разумеется там услышь нас локализация над просто убить но потому что это какой то непонятно зачем а это должны были быть какие-то библиотечки встроенные ли там для этого есть обычные средства модульности языка если вам нужны какие то константы распространять не надо делать ради этого микро сервиса дальше вот вот это все что что не блеклое такое синее то есть практически все микро сервисы я бы объединил в один назвал бы его простите магазин но потому что сейчас объясню смотрите вот есть группа сервисов которая отвечает за то чтобы нарисовать нашу морду фонтен сайта и вполне логично было бы взять и сделать это одним приложением на нормальном современном языке на печке на рубины питоне не важно взять джингу рельсы или you или вот его любой современный фреймворк веб-разработки реализуют по данным вести позволяет что сделать взять и сделать вот так сделать что у вас есть 1 р.м. одна база данных и 2 applications и эта штука которая вполне себе хорошо работает она дает нормальную модульность мы еще работаем с одной базой мы еще не имеем весь вот этой сетевой сетевых сюрпризов мы не имеем распределенные системы и мы не имеем эйван шел consist in search прекрасно затащить туда же правда его от его даже не придется переписывать потому что он как был на родах так и есть вы по сути с читом понятно что это искусственное разделение это должен был быть один сервис понятно что наруби и кстати народе наруби можно писать синхронный код там есть машина не важно был он у нас на но джесси оставьте ничего страшного если он у вас будет хотите складывать какие то данные в ту же самую базу и вы от этого не умрёте вы можете даже эту базу создавать миграциями от рельсов или сделать отдельные миграции не главное что это лежит в одном китовом репе и я не предлагаю вам шанс делает костре я вам предлагаю сделать нормальное решение аккуратная модули зация в одном гитарном рифе вы можете взять и выкатить этот проект сделать нормально тестовой контуру и так далее опишите заезжают также отдельными компонентами смотрите в кубе рн одессе мы эти штуки запускаем отдельными in some мы все еще можем верить нагрузку мы все еще можем их отдельно skay лить но это у нас уже одно приложение чуть-чуть толстенькая но нормальная дальше вот эта вся история она сжимается в прекрасном в админку почему бы не быть опять в предыдущем слайде был была классная история про трехуровневую до frontend бизнес-логика база бизнес логика у нас в им висишь нам фреймворке обычно в модели иногда в контроллере иной модели в контроллере разговор не об этом склад вы помните да что это на самом деле сервис который загружает остатки со склада поэтому мы его затаскивает просто это маленькие сервисе который будет пополнять нашу базу вы все такие грустные до этого были веселая как как я как я показывал какая какая у нас история час как как мы начали лечить алкоголизм все-таки сидят нет но это у нас такой заставляет обратно этот монолит слышите будьте бы бы будьте позитивнее затащили orders клинч и вот эти три микро сервиса если нам уже нравится делать отдельные мы можем слепить штуку которая называется медиа analytics тоже можно оставить но для этого нам нужно сделать некоторые внутренней и 5 для того что данные затягивать заказ который на самом деле пополнение склада можно оставить отдельный микро сервисом и если бы мы делали так изначально у нас дело то у нас была бы здесь гораздо больше других микро сервисом мы бы начали делать историю со складом изначально то мы хотели что переделать весь магазин а получилось так что мы полтора года опять срок вымышлен но мы полтора года делали только витрину посмотрите на картину шире зачастую вот эти косяки с микро сервисами возникают из-за того что вы взяли какую-то свою задачу но вы хотите в микро сервисы поиграть ну как бы этом это звучит как как претензии как обида но реально такое ощущение человек вот смотрите под ноги вот я тут частное должен наградить вот в этом вот моим скобки микро сервисов слушайте мы приходили в большие компании в огромные и знаете чем мы там видели вы там видели 2 micro сервисных архитектуры два уровня ну то есть с одной стороны они все оперируют проектами у нас там проект они оперируют крупными кусками бизнес определи оперирует крупными кусками и вот если на это посмотреть сверху то это очень хорошая микро сервисной архитектура они там все эти проект так или иначе обмениваются данными по этой deep ловится независимого но заходишь каждый проект и каждом проекте уже микро сервисной архитектура вот такая как я показывал потому что чуваки взяли внутри ту задачу которую можно было сделать одним-двумя сервисами почему-то поделили на 30 потому что видимо иначе они себя просто плохо чувствуют если у них не 30 микро сервисов а основная мысль которую бы я хотел донести что слове микро сервисы слова микро лишнее и любой архитектор любая серьезная книга вам об этом говорит о том что микро сервис и вовсе черт побери не микро и в предыдущем докладе использовалось слово макро сервисы вот я с ним категорически не согласен вот тот пример который вам показал уже с сгруппированных история это все еще микро сервисы речь идет о том что эта вещь которая просто меньше огромного монолита пожалуйста вот пусть это будет единственная мысль которая останется после всего что я говорил но пожалуй это самое важное что не надо думать о микро сервисах как о чем-то маленьком окончательно закончить доклад бы я хотел следующем мыслью что в оригинале на этой картинке у фаулера есть еще одна надпись и с моей точки зрения это масс эта надпись важна не меньше чем то что помнить что микро сервис вовсе не микро эта надпись говорит о том что скилл и команды которая делает ваш проект всегда перевесят выбор между микро сервисом и монолитом все г д а вот всегда если команде не хватает скилов она полезла в микро сервисы это точно будет фатальная история минутка рекламы завтра или послезавтра мы релизе мы очень клёвый плагин для графа на я прошу весь несложно зайдите на git х плюс саммите большое спасибо меня зовут дмитрий столяров я обещал трагедию и обещал только начало но вот вы можете сами оценить получилось или нет подписывайтесь на наш shop youtube вот это все и большое спасибо вам за внимание здрасте еще раз я занимал через часик если что у меня собственно такой небольшой легкий наброс про алкоголизм его же можно не лечить можно вызывать дабы можно вызывать доктора который будет вам ставить ежедневно там еженедельно капельницу наса на самом деле приходить к нам да я иногда себя испытываю реально копыта мы ставим комп на капельницы потому что проект очень тяжелый и ну как бы у нас как у фланта очень мощные возможности ты вапсе мы реально вынуждены ставить капельницы но это не жалко смотреть ну как бы клиент просто затыкает проблему деньгами только с другой стороны вот это раз во вторых есть некоторый вопрос по поводу релевантности опыта все-таки вас аутсорс и это когда не хватает рук да то есть вы не видите как живут нет там нет нет нет нет нет к нам приходят все таки очень много клиентов за экспертизой ну то есть а к тому что у вас своей экспертиза у клиентов у которых нет то есть опыт немножечко может быть не релевантны да я понимаю что таки из такой вот мы можем этим мириться конечно тут окей ладно следующий вопрос спасибо за доклад большое я бы хотел спросить вы не думали что вот это вот микро сервисная архитектура которую вы показывали это собирательный образ до собирательный образ абсолютно верно он отражает бизнес-логику да если бизнес логика не идеально то нельзя решить проблему там ну микро сервисами монолит им еще чем-то вассер всегда будет какие-то вот все так перекосы ну тогда может быть не всегда микро сервиса виновата да в таком бардаке может быть виноват как бы бизнес до виновата не знание предметной области и непонимание как делать микро сервисную архитектуру или непонимание как сделать микро сервисную архитектуру и путь к успеху только если оба обе вещи есть если есть знание предметной области ну то бишь полное понимание бизнес-процессов возможность их перед строк и правильно выровнять и плюс понимание как делать микро сервисную архитектуру и все эти нюансы связанные с распределенными системами и все паттерны которые необходимы для этого ну это все понятно просто в реальном мире к сожалению но не всегда есть возможность начинайте с монолита картинка про монолит first 2015 года но сейчас 18 микро сервисы придумывались больше для того чтобы было возможно для того чтобы распилить монолит нет я бы поспорил это только одна из как бы целей до микросфер выше чем какое преимущество мы можем брать маленькие команды да как вот об этом сегодня говорили там про то что там команда там две пиццы до должно там съесть и количество такое должно быть мы берем эти маленькие команды может быть они где-то там по-своему работают решает какие-то задачи но в целом если у нас достаточно нормальная организация между ними всегда хорошо выйдет но я думаю что это будет преимуществом планетам скорости какой-то плане скорости микро сервисы имеют преимущество привели ну а почему нет но это пока мэдисона мы можем я с удовольствием после я понимаю что тема очень провокационная но я меня даже не заставили это была необходима страсть спасибо за доклад очень интересно можно перемотать вот на начало вот этого всего не уверен не самое начало где вот все это самое красивое и все нет это прям вот так нормально мне один вопрос он очень простой и наверное не совсем в тему архитектор данной схемы хрыч в это же собирательный образ смотрите а можно у меня к аудитории такой вопрос вы видели такие проекты поднимите руки кто видел скажите у вас такой проект вот смотри смотри смотрите я не буду это комментировать привет спасибо очень было смешно я просто я я хотел заметить что во-первых вопросу о релевантности твоего опыта дело в том что пацаны у которых все хорошо а не дав ленты не доходят все так вот поэтому вы конечно видите самую черную самую жесткую и конечно я утрирую да вот второй вот а можно период проката куда не там где у тебя стало все красиво но я бы не сказал что это красиво это жизнеспособно это прекрасно да вы вы там еще по ходу все сервисы переписали наруби да то есть это такая интересная история ну и почти до я я к тому что вот в тот момент когда у тебя появляется один как бы монолит который ты как бы отдельно тепло ешь но ходишь в одну базу то любое изменение например схемы требует пойти в несколько условно несвязанных приложений там все поменять и не лежат в одном готовом ребята обязательно я понимаю и обучение это ничего не меняет примерно конечно же вопрос в том что вот вот здесь вот это вот ожидания про модульность и она же пропала ну то есть она или пропала совсем или ты говоришь на вы просто модульность нормально своем монолите соблюдайте ну как бы мы выше станьте и ёжиками ну прикольно я задалась а просто надо понимать что тот факт что нас сервиса лежат в разных реках и общаются по сети никак не влияет вообще никак но то какая у нас получится модульность да но это не сильно лучше 2 point это маленькая задача это всего лишь морда магазина это не склад это не если вы сталкивались вот удода пиццы я же с ними абсолютно согласен андрей андре жида в общем то же самые старые они же сделали большие сервисы которые отвечают за конкретно за предметная область да здесь одна предметная область потому что до остальных от команда просто не добралась и не хватило ресурсов она занималась я работал в интернет-магазине довольно большом я точно могу сказать что здесь как минимум три предметной области которые друг с другом слабо связан нет я понимаю что аутсорсер и с эксплуатации они могут не до конца понимать предметную область но рассматривайте это как собирательный образ спасибо помог по моему вопросов не было большое спасибо история на самом деле будет круто я здесь как раз будет позитив да как транс синими красавица плохо плохо плохо у нас будет хорошо мы изначально на щупе либесмана лета мы пропустили туры нет у нас есть был кейс к там обратно собирали но это в другом проекте до такой был это нормально так в общем расскажу про микро сервисный проект который по сути длился около 14 спринтов и завершился буквально на днях завершился хорошо то есть вопреки того что целый день ему слушали то что microsoft а плохо больно но мы слышим слово что их надо уметь готовить вот это ключевое слово которое сегодня нужно понимать и соответственно один проект морально запороли этот проект меня запороли знаем все тонкости поэтому буду про него рассказать вкратце о себе очень кратко чем мы занимались музыкой занимаются заказной разработкой но не такой заказана зароботка кого там наклепали продали у нас все очень серьезно качественно и так далее то есть крупные крупняк нам приходит мы делаем для них большие проекта поскольку у них нет своего идти под ключ и соответственно будет разработки архитектор моя область интересов 200 раз отжал и соответственно процессов кампаний adwords как вы понимаете он пришел после того как в начале работ по microsoft 200 он пустил ничего проекте то есть проектом соответственно это крупный telekom это платежи автоплатежи хранения карт по возможность платить этих карт эта интеграция с агаром это несколько спа приложения на вебе плюс несколько пик для админки и так далее платеже не очень много 4 миллиона в месяц не большая цифра будет расти но и платежи с это надолго идут то есть там в момент они 10 секунд их много зависает команда пятачок она небольшая но потом мы поймем в чем именно смысл для нашей компании и для заказчиков было используя микросферы снова подхода семь месяцев стек dot net core 2 докер куб и ринулся краю говорю куб это значку bennett что вот что хотел заказчик заказчика у него была этот проект изначально это как раз был большой монолит но его делал другая компания и и они просто пер лишь то что доработки стоит дорого делаются долго и и решили просто возьмем к мы просто всю перепишем и им интересует как долгосрочное развитие проекта чтобы там если задать над корни зайдет взяли там не знаю на джаве писали нет проблем в свою очередь это что я вам от говорить о долгосрочной перспективах независимость их налоги и как раз там переписали там нажал там исчезнут он корм что случится то чтобы он реках знаете кто писал на visual basic и там десять лет назад что с ним стало никто сейчас не пишет на visual basic вас проект на visual basic это может быть проблемой независимая звезды нет соответственно как раз быстрый отклик бизнесу на рынок мы должны это поддержать и отец независимо масштабирование горизонтально чтобы там ребята купили серверов мы взяли доехали больше спроса сделаем из теста отказоустойчивость потому что это решение будет стоять прям на сайте этого оператора и то что хотел закачек что вы хотели мы в компании у нас тоже есть свои цели сколько мы занимаемся заказан доработкой вы хотели перед пользованием то есть как бы чем больше вы перес пользуйте код по сути вас получается много маленьких коробочек продуктов которые вы можете взять потом допустим эсэмэс рсв три проекта распихали в 4 вас там везде снимать пушки распихали вас везде push и духота авторизации там много всего можно перечислять мы посмотрим что у нас в итоге получилось и масштабируемость команда то есть какие тут правильные ребята говорили что можно что-то на аутсорс а дальше можно что-то дать ни опытным разработчикам что собственно мы и делали и в итоге давайте начнем прямо начнем с самого старта проекта ее прямо дойдем до конца до дупло и как мы тепло им как мы устроили так далее то есть у нас начинаются старт проекта старт проекта всегда нужно так номерная область правильно у нас был если был бы монолит мы бы там это поняли здесь у нас был некоторый опыт по разрезанию микро сервиса поэтому просто этот опыт использовали вот написано фразой или там от кого-то даминова эксперта сколько здесь у нас контекстов то бишь контекстов сколько micro series of мы можем из этой фразы как вы вышли есть идеи какие до класс все верно абонент то есть это как анти users рсд потом платеж мы можем платить это прямо через карта вот карты как раз эта история про то что не нужно там мелкозернистой разбивать намного многое маленький микро сервисов нашем конкретном кейсе абонент не может быть без карта карта не может быть без абонента поэтому карту мы тоже кладём в user сервис она там и автоплатежи то есть есть карты есть платежи есть какой то шедевр здравствуйте автоплатежи и тут важный момент как раз то что мы карта юзеру положить в один микро сервису как раз мы варили макро и микро the mini maxi на саммит они сильно имеет значения большие или маленькие суть в том что у вас один сервис выполнял конкретную задачу конкретный контекст и он был то есть нашем случае это управление поиск или со всеми вот и их атрибутами которые у нас может быть системе платежи это все пропало тяжение ничего не знает при клиентов автоплатежи они просто scheduler этих платежей и так далее то есть про размер можно честно говоря не думать думаете про контекст потому что если мы положили бы карт в 2 разных микро сервисов тарас бы мы постоянно в пресете походили бы забирали карту забирали пользовать у нас получился бы сетевой монолит по сути вот то есть вот посыл про не думайте размеров просто у тебя нет о контексте в конечном итоге мы какие сервисы есть то что на экран лезла покажу какие у нас получились разбить то есть это юзер управление пользователями платежи автоплатежи сверки то есть там мы с банками работаем сверяемся отчеты как раз да классный сервис отчеты все же у нас olap должен быть двухфакторная авторизация notification модификации псм с и соответственно scheduler работающий на винтах и конечно же авторизация один вот индикация еще не допилили но сейчас как раз на чем пилить команда небольшая но чтобы достичь данных целей как раз вот есть такой подход что архитектура система полностью соответственно которую компании мы один проект запилили так что у нас там все люди знали про все микро сервисы получилось ну не очень есть мы просто эффективно разбились на много маленьких команд нам на 4 команда и в каждой команде были от приоры сервиса в чем был плюс в том что люди оперировали десятью эти методами и десятью таблицами базы когда к ним пролетал какой-то request на изменение его сделать было просто элементарно тоже человек в очень маленькой области оперируют им достаточно легко понимать ее скорость разработки реально возросла еще один момент как в том проекте который был неудачный что мы делали мы и сказали у нас в окее там есть много микро сервисов мы везде сделаем одинаково архитектуру везде искали ддт пытались найти домена это было просто до драки доходил где адаменко на самом деле просто не был в этом вас есть умные и глупые сервиса умные этого допустим пойман там у нас xddd репозитории ивентами домена и так далее а есть глупо эсэмэс там всего 12 строк он просто должен отправить смску там нет домена репозитория вообще ничего не это просто сторонними политику построили проблем смысл вот то есть не нужно думать что все сервисы должны как-то быть одинаковыми похожими здесь нужно как-то понимать нечего по сложным сервисом база как мы говорили что он один сервис должна быть одна база домен чтобы домена составит сохранять базу должна быть к этому спрутом репозитории так далее теперь здесь вот очень важный момент что это почти теперь потому что мы с клиентом у склеим две с в продолжении мобильном всегда будем работать по сути пескари все поэтому важно чтобы у микро сервиса был именно http протокол если сделать coinsup вам придется потом кастить и соответственно конечно же мы будем можем асинхронно работать поэтому здесь у нас в нашем случае трепет и с это команда пуск верен чтобы у нас арест и консьюмер а соответственно через один и тот же код работали у простого сервисы это может быть просто крат то есть вот как раз сервис каталог про которые сегодня говорили у нас каталога нету но каталог можно было бы так реализовать просто доставать товары класс товаров от кэшировать их в этом сервис и так далее тоже листы 5 никакого там ребята и мы на это не нужно и соответственно другой вариант сервис у него может вообще не быть базу вполне очень простой код как вот с смс-ками просто 12 строк и тоже может быть rest и пиво может не быть и может быть какие-то консьюмер и костюм red не знаете это просто . приема ивентов то есть если асинхронно к нам прилетает кайт ивента это его принимать консьюмер из приходит page тебе запросы принимаю соответственно экшн теперь в конечном итоге у нас наши сервисы разделились таким образом что серенькие это у нас умная сервиса зелененькие это глупые то есть примерно 50 на 50 ом и на этом с экономили просто времени стали там одинаковых текстуру везде пилить идем дальше начинаем говорить про анти паттерна как вот как раз эта картинка которую показывали тож вас много сервисов они все друг другу ходит у нас появилась вот так вот все прям много сетевых связей но это по сути тоже от не правильности построения вот как мы можем построить неправильный microserver что тут у нас вот есть пмс пмс ariston материнское по сути у него данные про платежи он платежи совершает истории платежей в юзер сервиса то есть то что вы в сбербанк онлайн видите это как бы ну уже вследствие того что где-то был произведен платеж а транзакции в сверка хре consolation сыр и сверки это тоже следствие что где-то был произведен платеж а если клиент заходит начать смотреть свою историю можно уже сделать просто из там юзер сервис определить клиента сделать запрос пойман сей раз пошли типе и показать в транзакции почему нет очень удобно то же самое может завтра к следующему если на проблема есть вас payment service падает у вас падает все все кто от него зависит они упадут потому что вы не сможете больше получать эти транзакции от вас отказоустойчивость просто ну 0 это вы написали сетевой монолит вы взяли всю сложность от микро сервисов добавили city view издержки и собрали все проблемы есть другая истории сбыта часть то есть тока до у вас есть разные кто знают только термин к в виде как банда контекст здесь что-то тоже с мы только про микро сервиса то есть грубо говоря у нас платежи vpn-сервисы платежи а юзер сервис это те же самые платежи только это уже история пульт то есть там те же самые девчонки вот только мы немножко по другим углом на не смотрим и так далее транзакцию то же самое в платежах у нас 20 полей там много всяких технически полей против 3d secure там и так далее в истории платежей это ну нам не нужно нам нужно просто вот картинку после показывать поэтому просто сливаем туда одни и те же данные с помощью асинхронно взаимодействия в транзакциях в сверху все то же самое то меньше полей нужен то есть мы с лили асинхронно если сервис лежал в этот момент но вы ничего страшного дождется потом чуть позже что у нас в данном случае получается поскольку мы помним что у каждого сервиса есть свои базы класс у нас допустим падает юзер сервис вы платежи можем делать класс другая история у нас падает пойман series мы можем дойти на личные кабинеты посмотреть историю мы и не забираем откуда вы просто юзер сервисом пользуюсь тоже можем у нас сверху делают смочь они упали ну и черт с ними упали сделаны в час ночи в два часа ночи от проблем у нас как users rss поймал сервисом принимали показывали истории делали платежи так они будут их делать но тут возникает другая проблема микро сервисов транзакция всего лишь вот типа от ложной согласованность эта проблема вот здесь вот очень важно тот момент которым недавно обсуждали что нужна сильная команда нужно очень сильная команда чтобы все это дело прокачать поэтому отложен согласованность у нас происходит платеж vpn сервис у нас появляется как бы потер сам у нас есть два других сервисов нужно до согласовать данные в них чтобы раз не получилось то что с 1000 платежей юзер сервисы допустим 1 999 один куда-то потерялся со свертками эта ситуация может быть еще хуже с мыса с банком и сверимся что мы делаем мы сохраняем состоянии сыр освобожу и высылаем ивент в ребятам керри бетонку это брокер сообщение но я думаю все знаете что это такое но здесь весь фокус в чем он в том что мы берем и в базе данных делаем табличку в которой мы при храним эти лента мы реализуем кладем и состоянии сервис тоже берем мы кладем рядышком другую табличку и делаем все это в одной транзакция то есть у нас транзакционных локальное получается то есть мы event-ы состояние сердца всегда вместе как бы сохранять либо не сохраняя вообще и потом и специальный механизм который как scheduler потом эти винты пытается отправить у нас орбитрек просто чуть позже отправиться тот овен он гарантированно отправиться и у нас получается как раз и по самой отложен согласован то есть рано или поздно в два других сервиса данный придут вот это как делать отложенную согласованность и делать именно то казаться точность независимость сервисов друг от друга вот они должны быть независимы в данном случае нас получился зависимость первом случае нет ну и соответственно нас мы видели разные протоколы http и плюс еще есть вариации синхронности пьют когда мы используем ищи т.п. когда у нас клиент приходит говорит покажи мне моей карты синхронно как бы был смысл нет и можно прямо сейчас карту видеть свою прямо через секунду они купе это как раз вот эта согласованность плюсы таки долго играющий за задача то есть допустим мы делаем клиентов то платеж по снижению остатка ну пройдет он сейчас или пройдет там через десять минут не сильно важные проблема он не будете ждать когда же там она пройдет вот здесь incopy как раз подходит этот предпочтительными craster с натуры потому что почти peter frampton тайм-аут этом и прочие проблемы с которой нам не очень есть http полинг это вариация синхронно ваш типе то есть грубо говоря вы создать создали платеж вам вернулся идиш не капотом вас другой какой то таймер на fontaine de говорит а вот провел его провел его провел его провел его и вот этим провел он там ос крутилка 500 крутится и он значит проведен там есть вариации сокетами так далее но тем не менее тоже нужно знать про то что такая уж тебе можно использовать синхронно окей мы сделали много микро сервисов у нас есть клиент это какой-то web допустим спа приложения и у нас они все работают по ешьте теперь и что мы дадим соответственно нашему клиенту много разных точек будет выглядеть примерно вот так у то что какие-то изменения которые мы будем вносить дальше то по сути мы будем явно как бы то клиенту показывать все наши кишки нашей системы поэтому дело себе 5 твой и получается такая картина то есть мы клиента делаем некий фасад он смотрит в одну точку под этой точке соответственно у нас уже идет там какие-то наши микро сервисы как мы их там добавляем выбираем там клиент вообще не знает но здесь есть проблема какая нас проблема может быть потому что у нас и 51 системного в нашем случае tms несколько спа приложений и we are и мобильное приложение youth они все начинают ходить в один и пять но и веру нужно допустим там не знаю 10 и 5 методов эсэмэски допустим 3 там мобилку очень быстро развивается непрестанного радовать еще давайте еще мы лезем для них чисто много методов а другим эти методы вообще не нужны для вывода нужна какая-то специфический авторизация вот и соответственно это не очень хороший история более того вас много команд получается и перед как вот здесь на картинке четко показано что узкое место это не круто есть такой паттерн который называется back and front end то есть грубо под каждый фронт-энд мы делаем свой конкретный backend здесь тоже вопрос как бы адекватности то есть в нашем случае мобилкой в по ней работает по одному идею авиарейсом с по-другому это приватная то есть публичный api is private на япе приватный и публичный понятно что у них разный тип авторизации в админке там еще третий тип авторизации туда ходит просто тоже в то есть мы для каждого фонтейна сделали свой и 5 тут другой вопрос окей мы сделаем несколько пьяни то получается что мы если хотим круто метод сделать там и здесь мы должны написать выставить тут тут тут получается как-то не очень эффективно и если такая штука оцелот называется что такое оцелот но мы поскольку тут нет кори разрабатываем эта штука чисто для dota скоро но поскольку она вся в контейнере нет никаких проблем и использовать там в любых других языках если вы спорите контейнера это по сути тоже самое что энгельс но с одним но если джеймс мы можем управлять им только с помощью конфигов то эта библиотека вы его вставляете просто в свой код получается проксирование но при этом вы можете положить туда кэше логирование все что вам голову придется что вы сможете написать на языке программируют она может вложить его как раз задача как раз вот эти фронтэнда выставлять api вот допустим у нас есть много разных сервисов один из них картер из все у нас помните мы варили что лучше выставить ешьте типе протоколу сервис а не какой то там saab или еще что-то ты сейчас поймете почему вот у нас есть карцер съесть и 5 нет 1 1 картой где то есть получения карты по ее индификатор карте раз естественно владеет картами он может вполне вернуть эту карту в нормальном виде вернуть 404 там 400 и другие ошибки там положите выполняет эту задачу есть несколько фишек нужно ли в них нам что-то писать что-то кодить ну зачем а что такое у нас есть сервис который почти типе прекрасно это может отдать ну а пешком нужны соответственно эти методы они все там в публичным приватном там админ хотел смотреть карты палитра мы ставим в них оцелот говорим что сейчас у нас там будет только проксирование то есть нам снаружи в любой api приходит на пиве 1 карта иди там и соответственно делаем проксирование на этот сервис и все то есть мы просто все и пей наших micro series of просто выставляем мы ничего там не дописываем простых выставляем наружу в этом очень большой плюс потому что написав один раз метод в сервисе он потом можно выставить в разных api есть этапе будут появляться нужен другой метод выставить пожалуйста другого сервисом и выставлю только в 2 пи другой метод как это выглядит вот это по сути весь конфиг более того скажу что оцелот это можно развернуть в докер контейнер и все это будет бинарник который вы не будете менять в принципе вы будете менять только конфиге будет их падма плевать снаружи то есть его можно переиспользовать вот у нас api внешне srs вот по сути откуда мы приходим и куда мы приходим здесь мы показываем что типа получи карту поедешь них по 2 получить список всех карт и так далее здесь можно настраивать the mode и можно много чего поставь настраивать можно но он более конфигурируем чем джинс получается такая история что каждого оцелота просто по-своему конфигу другая история понятно у нас сервис может карту отдать весь маску это сложный кейс допустим мы должны заплатить дефолтной карта то есть мы должны взять карту понять что на дефолтном то есть карта по умолчанию у любого человека и нарекать в литровой банке такая карта план молчание там любимая карта втором 1 высвечивается и вот именно с неё заплатить но при монсе раз у нас ничего не знает про карту он говорит реквизиты есть от карта я заплачу нет реквизитов до свидания карты знает все про карта не знает про его визита но не знает ничего платежи есть другая пи х который тоже хочет что-то вызвать и заплатить то есть у нас какой вариант реализовать логику забора карта из карт сервиса в каком-то языке и и потом вызвать другой метод но вспомним что мы это просто делаем как прокси во первых то есть там какой-то код писать в принципе не желательно поэтому это вариант нам не очень подходит есть другой вариант это как раз опять же таки prius торию когда вот так вот все было нарисованного слайде мы говорим о кей у нас будет прямо сей раз платить а вот пускаем все в карцер сам исходит и заберет эту карту что у нас получается у нас во первых получается такой момент я не буду говорить просто там будет если карцер из упадет там в том кейси который правильно будет то же самое на самом деле сумма пойдет здесь у нас получается что пмс rs больше не может работать без другого сервиса он на него жестко завязан у него прям написано я вот в таком случае еду в другой сервис это не очень хорошо то есть сильная связанность и мы именно микро сердца от этого хотим и миру уйти поэтому тоже не крутой момент вот как раз момент который мы используем мы делаем агрегата то есть у нас есть 2а фишки которые делают платеж дефолтной карты там выстрел он там пмп дефолт корр допустим метод вот этот агрегат это по сути такой же сервис но он маленький простой здесь очень важный момент что из него не нужно сделать сетевой не сетевой просто монолит вас может получиться что вы туда много логики на пихаете вас получится неким аналитик вот туда нужно пихать естественно по минимуму но какая-то логика то может быть в данном случае то логика забери карту все карта у нас вернула 400 4 транслируя выше если с карты все в порядке то соответственно вызове пойман получи пойман пойди и одна его выписки сверху то есть грубо и вот этот агрегат отвечает за какие-то сложные кейсы взаимодействий по http вот и соответственно таких агрегатов может быть несколько некорректно кейс то есть это когда к вам нужно скорректировать несколько микро сервисов вот таким образом вот этот сетевой вот эту колбасу котором мы видели можете сбежать итог это немножко старая схема но общий масками она показывает что получилось то есть мы видим что есть контуром пути нам выделено три контура это приватная публичная и админка в публичном у нас соответственно стоит оцелоты про который говорил на ними стоит джеймс но это чисто там чтобы ссср был и вот как раз здесь схематично показаны и агрегаторы как раз и мы видим стрелочку что мы ли вам можем либо пойти напрямую микро сервис либо можем пойти через агрегатор это как раз вот тот самый кейс который пытался показать сложно в случаях мы идем через агрегатор в простых напрямую сервис про как проект в детей разложены то есть мы говорю это только что говорили что положить все в один мы положили в разные в целом не напрягаемся честно скажу здесь у нас подгруппой микро сервиса фронты font and spa приложение агрегаторы про которым мы говорили управление фру структуры и соответственно автотест то есть вот микро сервиса как для людом его проекты плюс есть вот такая вот штука где здесь написано time это значит что мы этот миг раз и раз написали таким образом что мы можем использовать любых других проектов он полностью как бы к этому проекта никак ну не завязан на него это как раз вот тот кейс когда мы говорили что мы хотим что ты переиспользовать это как раз вот эти оцелоты при котором были и пике твои приватный публичные админка и одно гетто тоже во многие литературе говорится что вот когда там несколько раз использовать не те же библиотеки это типа не круто да это так это не круто пока это библиотека нормально не versio не руется вот у нас везде в принципе есть там логирование мы не будем же мы сделать герои не писать там одно и то же там с ему рад был какой-то баг то нам придется в этом 20 местах исправлять в данном случае просто мы правим это будет пакете понимаемую версию там где нужно и все работает поверьте на слово за два господина года никаких проблем с этим не было но здесь важно понимать что вот багета и мы можем класть фундаментальные вещи такие как шифрования логирование так далее то есть то что развивается только тогда когда там баги кита находится постоянно развитие там нету то есть один раз написала и там сто раз по использовал давайте поговорим про инфраструктуру что в итоге вот можно использовать my красавица просто так вот там не знаю понятие в день каком-то сервер и так далее но это не очень эффективно эффективно это использует сочетании с докером потому что с брокером вы переспорить еще не только сами красавица еще всем всю структуру в окне то есть мы используем докер докер у нас лежит в кубе все что имеет какой-то перестал с это там база данных каши все остальное она лежит за пределами кубер не остаюсь в компиляцию нас то что немецкого состояния все секреты лежат в альте то есть какие-то секретные данные мы храним тоже отдельно все микро сервис нужно собирать поэтому непрерывно сборка это как раз начинается история про то что мы дупло им раздельности каждый микросфер если они соответственно с версии у них у всех своя и соответственно до play мы myname через enfeeble и инфраструктуры тоже управляем через n 7 вот так выглядит наш сервер непременно сборки то есть вот тут много много разных микро проекте кафани все зелёненькие и они порождают decker докер-контейнер которого есть свои версии она кладется в реестре далее про купер не то сегодня был целый доклад про губернатор но здесь я скажу очень просто что убирайтесь это то что вам может помочь избежать трудозатрат на то что будете делать руками в нем это просто дел все из коробки и и очень хорошо сочетается докером в принципе сейчас одно из лучших решений то есть это supervision то есть вы его сервису полон его поймешь и упал поднимет если вы создали несколько новых сей раз вас будет все раз discovery вам будет искать новый сервис вас там было три стало 10 он поймет что их 10 мне нужно там какие-то блокировщики pirastro и вам все самое авто скиллинг то есть тоже вы можете изменив один параметр у вас было три контейнера изменить его на 10 вас будет 10 и любавин диплом то есть это важная тема мы в другом проекте где мы не использует decker мы гринды play пытались на кто пусть и очень долго строить у нас все получилось но мы туда потратить очень много часов здесь это тоже опять же таки все идет из коробки это как раз та история что вас несколько версий micro series of у вас клиента работает с одним в этом момент и плодиться другой клиент это не замечают у них просто сейчас в данный момент работает версии муку боясь другая проблема что классный но не высыпаем он файлик metaplot там яма файлики в них нужно описать конфигурации версия который хочет дополнить и соответственно запускать этот файлик и он его выполнит ее начнет и плоть вот мы его скрестили с нашим in simple потому что он стал просто было экспертиза хорошая и в целом у нас получился как раз смеси депо и через поверни таз + n символ в принципе просто готовим эти файлики в правильном виде что потом их отдать кубу здесь вот мы как раз видим что у нас во первых 2 версию двух разных micro series of и еще здесь я не выделял но здесь видите есть версии 1 0 44 это файл бит то есть грубо говоря это тоже другой micro series который откладывается всегда в контейнер с другими рср сами он полностью перес пользуйтесь моего один раз написали и потом сто пятьсот раз разложили это же гораздо эффективнее чем каждый раз в новом проекте писать сборщик логов вот с монолитом если будет писать монолит вам каждым проектом нужно будет писать одно и то же более давно ли вы библиотеку какой-то сделаете но в данном случае это будет вас инфраструктура и рабочее решение один раз вам саляму больше других проектов больше никогда не пишем просто вы всегда так подклада в конечном итоге что он хотел заказчиком хотел нас долгосрочном развитии поскольку у нас все находится в разных реках с у нас там вот на корт помрет мы просто по одному сервису будем переводить этапа на java там на гол на все что хотите это нельзя 80 технологии но и соответственно зависимость развертывания здесь важный момент что мы видели что у нас там были с арестом push кварц там еще какой-то ну вот как вы думаете будет ли какие-то доработки по сервису ближайший год не будет их мы его написали все вас не все классно нам не надо ни тестировать не развертывать ничего все он написан и поэтому просто сужаем скоб тепло и до каких-то именно фич которые будут меняться на моей практике то есть в 1 спринт меняется но где-то там 23 сервис могут в нашем кейси там больших компаний наверно как-то по-другому в нашем кети меня эти два но у нас их там 1520 другом проекте то есть мы как бы тепло им там 15 процентов от всей системы и это действительно очень удобно зависимой масштабируя то что мы говорили вместе с у нас из проекта все живут как в разных контейнеров но там 10 комментариев по стали с платежами юзерам 3 люди хотят много истории смотреть мы сделали здесь 20 там три вот это тоже достигается это за отказоустойчивостью продемонстрировал на примере как у нас переливаются данные в три раза сервиса ну и при перес пользование про масштабирование команда сейчас расскажу то есть 100 из тех сервисов которые вам показывал сам начале нам удалось полностью перес пользовать ну 11 частично вот это пойман series его нужно как раз это тот кейси говорил что мы в одном проекте мы собирали обратно из-за нескольких микросфер с просто там очень сильно декомпозировать вот сейчас этот сервис можно распилить его можно распилить на снятие денег с карточки процессинг платежей и соответственно шлюзы платежей в принципе его можно распиливать и потом снятие денег с карточки просто сделать какой индекс касс вполне автоплатежи не перес пользу им тоже не жестко завязан и как бы на данный кейс сверки тоже отчетность она просто отчетность 2 факта на катализации понятно дело что ее можно легко перес пользовать она и в африке факторов авторизации сей раз написано работает отлично с msr с тоже пожалуйста через внешние элементы передаем параметры какого-нибудь там операторы пожалуйста начинаем там через мтс мегафон через что угодно сайте sms ки шу долю тоже внешней конфиг работает здесь просто это не наша сервис это докер контейнеры которым один раз написали много раз использовать файл бит это как раз то что была версия 44 тоже один раз написали говорим ум откуда из какой папки логе собирать он собирает дефекация тоже сампери используем оцелот это как раз тоже мы собрали контейнера туда какие-то базовые вещи положили снаружи вам топ конфете подписываем тоже полностью перес пользу ему вещь но и джинкс понятно то есть вот какие плюсы вот прекрасных туре мы извлекли то есть как бы была боль сегодня расстройства у нас вот неплохо вполне получилось мы нормально смогли разделить на некие домены и многие вещи переиспользовать собственно это была одна из важных целей для наших компания перес пользуюсь что потом это не взять второй раз 3 раз уж мы сказано разработка нам заказывать каждый раз одно и то же по сути каждый раз писать и сам srs это немножко глупо согласить и соответственно нас это тоже получилось но конечно же не буду вечно прям вот он все крутостью не говорили все про проблемы я тоже задонская про проблемы как другом монолитные аналитики то есть когда вас есть какая-то крутая там команда разработки там она все понимает как пилить правильно микросферы самурайская другая часть компании который не понимает как это делать и тут начинаются проблемы то есть зачем нам нужны vento когда мы всю жизнь пошлите пиво так взаимодействовали мы там просто запрашивали во всех точках описали почему нас был здесь и штука давно всегда была одна то есть от аналитика не сразу можно понять а где транзакция не транзакции у нас теперь а как же так почему у вас теперь платежи в трех разных базах лежат одно и то же тоже им было непонятно ну и почему почти типе постоянно все места там по 100 раз ходить тоже плохо они тоже не могли понять как мы это решили мы просто обучили мы создали создали канбан доску да у нас компания такая что мы людей как бы стараемся просто растить это кстати один из главных критерий попадания в компанию что человек хочет расти поэтому мы их обучали и review или то что они делают в начале там было просто там не знаю по 60 комментариев на каждую тележку что это за от вообще такой как ты мог это сделать в конечном итоге все очень хорошо все поняли там смысла went up чего вент отличается от команды чем в http отличается от ивентов и так далее получился такая доска я не знаю видно не видно это на самый пол доски там дальше идет разработка тестирование так далее то есть select то что нужно взять работу анализ это значит начинался аналитика и review это вот я review и то что там написано и соответственно назначить review все в порядке можно там брать на груминг и соответственно тому же команда команда сама разработка которых гораздо более глубоко в проект проникает она там говорить ну вот здесь может сделать и получи вот это зашло реально зашло где-то потраченное ну где-то два месяца сделали аналитику то же самое с тестированием здесь реально был косяк с тестированием то есть один из плюсов микро сервисов по которым тоже говорили что типа это удобно и тестирование она удобна и когда вы пишете теста на каждый сервис вот у нас была очень хорошая точнее есть есть хорошая команда тестировщика 2 реально круто тестирует обеспечивается хорошее качество поэтому подумали мы знали про то что нужно на каждый раз писать тесты но имеется new не теста вот какие то более высоко уровня там нашли тебе метода ну как бы отдали на откуп они начали писать тесты на опушке мы как будто мы увидели что мы взяли один единственный метод выставлю в три разных места сколько уже тестов написать это один метод него не надо 3 раза писать тесты вот и поэтому здесь писалось перед тестом вот тратилась на это время и соответственно таким образом тестирование стала узким местом что тоже стала неплохо и когда мы хотим что-то 3 патчить не говорю на можно там два дня тестировать потом у нас система такая сложно там у вас ивенты какие-то летают и два дня тестирование вот и соответственно в это тоже уперлись поняли эту проблему сейчас у нас решение такое что июня тест интеграционные функциональном мы будем писать сами мы про это знали про стану принялись грубо говоря сквозные мы все-таки стали тестировщиком то есть именно клиентский experience тестирует тестировщики а вот всякие там то что у нас event отправился после того как мы там карту создали этого будем инвестировать на этом все спасибо большое готов ответить на ваши вопросы и шатрам знал что ты сейчас вопрос задач мы не сильный пили мне karces привет ещё раз собственно вопрос про оцелот во-первых и норман ли он работает джим сам и что выставляйте наружу джинсы оцелот нет ли проблем связанности вот папа по одному будет вставать по одному я бы желал 3 смотри во первых первый момент потолок можно получать с целью то есть у массажиста для целей мы можем вообще выбрать на сам использоваться лот он с этим работает просто у нас уже была контейнер держимся второй момент они вполне связаны успешно работают проблемки то с этим не было то есть ты можешь выбрать и джексон сами ли деле использует оцелот вполне и вопрос тут очень tracing затрагивали с марикой ты получается часть логике у тебя работает через очереди сообщений у тебя теряете что типичный tracing ты об этом задумывался он не теряется потому что мыло героем ивента тоже тут кстати кто-то задавал вопрос по на логирование еще здесь человек смотри мыло героем все мыло героем запрос ответ и лагером все винты у нас есть три саиди и поэтому если где-то что-то произошло то у нас есть вся цепочка где мы понимаем как у нас аж тебе запросы пришли какие способности ответить ивенты выбросились вот но есть одна проблема что мы пишем 3 терабайта логов за месяц вот ее на заказчик немножко напрягается но зато вам и сало это можно там реально за пару минут решить спасибо привет я хотел просто сказать что 3 терабайта логов это не страшно я знаю пацанов которые пишут 10 терабайт логов в день я я хотел спросить вот о фишечки которые торчат наружу через вот эти три api guide в отеле вы как делаете что делаем а цели ну то есть в public api скорее всего есть метод который позволяет мне посмотреть мои карточки в админ api скорее всего тот же или другой метод который позволяет посмотреть все карточки это два разных методов карт сервис или то один и тот же метод в котором реализованы на цели все карточки всех клиент имеются ну например в данном случае поскольку все карточки всех клиентов к хранятся в карт сервисе и все карточки одного клиента хранятся в одном и том же сервис стоит просто два раза методов договоры который один мы выставим of public api другой мужеством только в админку так тогда я не понял в какой момент у вас получается экономия на количестве методов которые вы пишите потому что все методы вы все равно пишите отдельного конкретный кейс кей класс ну допустим мы отобразили все методы всех клиентов потом вы кликаете на 1 1 карта что происходит я не знаю вы хотите вы получаете детали карт точно таким же образом как его получается public api то есть данном случае вы используете тоже нет тогда непонятно зачем 3 гид вы просто для того чтобы она лишь не могли заметить во первых у нас в публичном openid авторизация она там не нужна в админке она можно причем там кербоз должен быть это 1 момент 2 момент в админке нужно просто гораздо меньше методов это мне нужен тиммейты тоже должен быть в паблике паблике должны быть те кто есть в админке это просто разделение на то есть мы нашему frontend только те методы которые ему нужны если этот фонтан развивается как то очень быстро мы под него дописываем методы их только выставляем вот а плюс получается в том что мы эти методы и прямо сейчас вы достаем если понадобится какой-то специфический метод чисто для некоего просто напишем вот он выстрелил от мира сего спасибо большой кирилл очень крутой интересный адекватный простой понятный новичкам а старался хотел сказать вам спасибо хотел сказать спасибо организаторам вот так можно не касаемо вашего доклада как касаемо всех предыдущие докладчики говорили о том что больше сейчас макро и микро это всегда не так это всегда больно или последний докладчик сказал о том что размер не имеет значения кто следующий спасибо большое за доклад у меня два на самом деле вопрос один скорее дополнение про предыдущий public api как соблюдается сик юность запросов то есть если я например прихожу совершенно какой-то левый человек который случайно узнал метод и через паблика 5 соответственно могу ли я зайти там посмотреть условные карточки какого-то клиента или всех клиентов вот автор вопрос это так как много сервисов ведете ли вы какую-то документацию и как вы обновляете что если происходит и где ну смотрите про публичный api там на самом деле ничего страшного не можете увидеть там ничего такой курил нет реквизиты чужого что карта не увидите может видеть если очень сильно постараться если вы будете знать gooid этой карты вы где там наберете то в принципе вы сможете посмотреть по ней какие-то параметры вот ничего секундного там нет все северные есть личном кабинете там есть авторизация там that is a человек уже может видеть свои там поменять ее себе посмотреть для того чтобы потом по карте чтоб почувствуешь второй момент по про забыл а документацию да ну во-первых смотрите вот этот кейс который я показывал это очень классная штука сейчас я ты куда туда так очень много много анимаций вот вот это на самом деле это часть документации это просто вырезанная страниц из confluence а если вы можете видеть здесь вот есть ссылочка чтобы кликнуть и попасть гид и ссылочку чтобы попасть на первую ноту куба на вторую на третью можно зайти через оцелот можно зайти через к прокси вот это вот тестировщик был просто взрыв мог ск мозга когда мы внедрили агрегаты короче никто не мог понять что это такое и зачем это нужно вот только к этому леса в эту схему они смогли понять вот это первый момент второй момент как мы строим документацию раньше вас мы документа забыла тоже монолитная критики писали доку на я пишу вот сейчас у нас что происходит мы в confluence и делаем долг у на методы micro series of микро сервиса сгруппированы по разделам а когда нужно написать какую-то статью уже одним а именно screen to visit бизнес техническим кейсом то вот эти вызовы методов как фрейма просто вставляются в конференции вот и получается что вот запросите карту фрейм оплатите фрейм и человек когда видит он читает как будто бы эта статья на самом деле это просто вставки из нарезок документации по конкретно микро сервисом вот да мы все документируем разок это прям учете люси вам смотрите спасибо в первую очередь за интересное выступление у меня вопрос довольно простой на технический если бы вы могли вернуться на слайд где вот фраза из которой вы пытаетесь красным там подсветить что-то с много много анимации ну да вы сказали что попытаемся из этой фразы выделить контекст и вот для меня то что подсвечена красным это не контекст скорее сущности да то есть это вот если спа семантики языка смотреть абонент карта платеж и автоплатеж существительные это сущности если это сущности тогда что такое бандит контекст в и контекст и или вы это приравниваете контекст это просто термин скажем так не знаю может быть не очень удачно русский язык переведем суть его просто не важно как то называется суть в том чтобы серы сделал какую-то конкретную вещь вот что будет это как раз логика не было размазана что у вас вот как предыдущем примерьте атланта там что у нас там тут склад а то что-то похожее на склад вот у них логика размазана а вот когда мы говорим про то что я назвать контекстом это значит что это целостно конкретно вот смотрите вот вы согласитесь со мной что здесь выделенный не контекст о сущности что ну я просто вуз терминологии просто microsoft он подходит больше там про контекста может быть и сущностям контекст контекст когда нести вот и сущности когда появляется контекст это та когда мы понимаем как какую деятельность над сущностью или вот существительным ведется вот тогда мы можем выделить например но там юзера юзера одни за это хороший пример как раз вот есть платежи и история платежей вот это одно и то же просто в разных контекстов неважно неважно как мы это называем главное чтобы это нормально работала получает сейчас lovers если вордака но если вот так объяснять то так получилось что у вас каждый на каждый микро сервис на каждую сущность выделен отдельный микро сервис да ну не сильно принципиально думаю да ну кейси класс все так и есть всем спасибо друзья спасибо что пришли если есть выжившие которые случайно хотят посетить экскурсию на наш десятый этаж нас тут есть пепси на выходе а если кто-то вдруг хочет экскурсию на десятый этаж собираемся в холле там наши инженеры смогут вам показать как они тот рылись от и вот тут около радара стоит тимур с ним тоже можно поговорить про наши микро сервисы всем спасибо что пришли и вы большие молодцы что досидели"
}