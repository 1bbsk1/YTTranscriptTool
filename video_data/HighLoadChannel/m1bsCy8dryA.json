{
  "video_id": "m1bsCy8dryA",
  "channel": "HighLoadChannel",
  "title": "Переосмысливая подход к инфраструктурному коду / Евгений Пивень (IPONWEB)",
  "views": 692,
  "duration": 2344,
  "published": "2018-08-16T03:56:55-07:00",
  "text": "а меня зовут евгений пивень я работаю в компании на пион веб сегодня я расскажу немного про наш опыт того как мы работали с кодом но кот не программный код инфраструктурный больше всего у нас опыты с папе там есть какие то другие вещи но сегодня большая часть будет про пакет вот соответственно я не ожидаю что у вас есть какой то опыт с этим те примеры которые я буду приводить они будут на по 5 но тем не менее я надеюсь они все будут достаточно понятны и и всем тем кто даже не имел с этим делом давайте сначала немного расскажу про то как выглядит примерно проект у нас в небе это очень базовая такая презентация проекта у нас есть админ server admin серверу это собственно сервер на котором крутится паппет мастер на нем хранится код попятный код конкретного проекта вот и соответственно все остальные сервера все остальные кусочки проекта они подключаются с помощью агента по расписанию каждый сколько-то минут кабмин х стул и после этого берут свой каталог проверяют что ресурсы которые у вас на сервере описаны соответствует тому что написано в каталоге если что-то не соответствует соответственно мы это что-то меняем вот соответственно вот эти вот кубики до который видите такой базовый пример этих кубиков их часто бывает много в каких-то проектах каких-то из этих кубиков нет например часто бывают проекты без базы данных каких-то проектов этих кубиков больше они более сложные и так далее но примерная базовая структура она вот такая проектов у нас всего пятьдесят то есть каждый проект это отдельная репозиторий отдельный набор данных один на бой там кредит шел за сикретов и вот это все вот соответственно в менеджменте такого количества проектов достаточно просто сделать ошибку если мы постоянно один и тот же код копируем да это все сложным и нагреть становится и так далее собственно про этот опыт я и расскажу но сначала для тех кто возможно не так хорошо знакомы с кодом который описывает конфигурацию я расскажу небольшие различия не небольшие возможны довольно большие различия на самом деле инфраструктурного кода первое это декларативность практически все а системы управления конфигурации они декларативные то есть по pidgey fancy было вот эти все штуки они работают примерно так то есть когда мы описываем как это файл у нас нет какой-то логики про то что если этого файла нет давайте его создадим если он там есть то что то поменяем мы просто говорим файл должен быть вот таким вот то есть у нас в этом месте должен быть файл с таким-то контентом такой умер групп с таким-то mode вот то есть мы прям полностью описываем состоянии файлы если какие-то из этих частей не соответствует тому что у нас лежит в системе дата паппет следующий прогон это поменяет и приведёт его к тому состоянию которая у нас написано собственно в каталоге следующий момент это то как паппет управляет ресурсами когда мы меняем вот первый кусочек кода на второй кусочек кода то логично предположить что вот у нас было описание крон задачи то есть у нас есть какая-то задача которая выполняется раз в час каждый раз когда у нас пять минут на часах вот мы потом приходим и меня первый кусочек на второй кусочек и мы ожидаем логично наверное что теперь у нас это же задача будет запускаться чуть-чуть по-другому а именно она будет запускаться в ноль минут 20 минут и 40 минут на самом же деле что происходит это то что про предыдущий ресурс так как он с другим именем у нас мы забываем то есть мы больше мы перестаем его - то есть у нас есть все еще задача в системе который называется rant с предыдущая она все еще продолжает запускаться каждые пять минут каждый час то есть в пять минут но при этом у нас сейчас еще создается новая задача которая теперь будет запускаться еще terra то есть у нас теперь на текущем хостел на котором раньше была старая конфигурации теперь у нас новая конфигурация у нас будет задача которая будет запускаться четыре раза и это еще не такая большая проблема возможно как то что новый хост который мы поднимем у него уже нету старой конфигурации на него прийти только новая конфигурация да и соответственно у нас начинается так называем configuration дживс когда у нас один сервер настроен по одному другой по-другому естественно это не очень хорошо вот я расскажу ещё про то как мы с этим научились бороться и последний момент про инфраструктурный код это часто такие неожиданные последствия изменений которые в какой-то момент у нас был вот ровно такое изменение то есть все что у нас поменялось это вот одна буква одна буква поменялось файлики эти синие d-man гади это привело к достаточно плохим последствиям наверное не очень просто догадаться вот конкретно по этому кусочку что могло пойти не так на самом деле что произошло помимо того что сам файл поменялся нашей конфигурация папина написано когда у нас меняется вот этот файл то у нас рестарте этот сервис который мой менеджер соответственно у нас на кучу проектов прилетели вот эти изменения и манул гонга шарды ли начали во всех 50 проектов внезапно рестарте ца вот на тех проектах на которых база была достаточно большая паппет не успевал это сделать руками приход а точнее паппет не успевал это сделать самому пришлось проходить туда руками псс этом по хардкору всем отделом поднимать мангу в общем это не очень хорошо итак возвращаемся к тому что мы сделали у нас это примерно представление того что у нас было раньше слева вот эти вот то что я показывал как у нас проект выглядит это вот эти вот зеленые квадратики которые вначале видны как эти как я уже сказал этих квадратиков примерно 50 у нас и все они пользуются так называемым common модулем этот ком он модуль соответственно то набор папе того кода который был похожий параметризирована часто во всех наших проектах количество кодов проекта было тоже достаточно большое потому что они использовали этот модуль и разные там с разными параметрами эти параметры тоже часто повторяются среди проектов но тем не менее этот весь код хранился в проект и к чему мы сейчас почти уже пришли это вот вторая картинка когда квадратики вот эти вот и проектов стали гораздо меньше как вы видите да то есть мы абстрагировались большую часть проектного кода в так называемый модуль профиль и разбили наш этот большой common модуль на много-много маленьких модулей немного слов про comon comon это стало таким синонимом в нашей компании чего-то очень плохого всегда ломающая работу примерно все мы как какого такого непонятного чего-то во-первых она off to deploy лодзь да то есть когда мы изменяли что-то в нем то эти изменения прилетали сразу вообще проект помимо вот этих 50 проектов которых я сказал у нас есть еще другие внутренние проекта на которых тоже этот модуль используется и примерно практически никто кто изменил этот модуль не понимал достаточно о нем чтобы понять что эти изменения точно хорошо применится во всех проектах потому что ни одна из этих команд не управляла всеми проектами то есть мы отвечаем конкретно моя команда она занимается вот этими 50 проектов есть команды которые занимаются другими вот этими внутренними проектами есть ещё проекты и так далее следующий момент в нем было все вместе в этом модуле да то есть там и какие-то ресурсы которые отвечали за мониторинг за юзеров за сервисы там за энглин к что угодно все это было прям вот в одном вот этом большом модули так как у нас это все of the deep ловилась нам приходилось поддерживать и старую и новую логику да то есть если мы хотим какие-то изменить параметры или что-то сделать по-другому нам приходилось соответственно спиливать какие-то страшные некрасивые проверки до которые там и работали и со старым да и с новым потом и потихонечку переводили все проекты на новый на новую логику до потихонечку выпиливали вот эту старую иногда забывали про неё иногда вот эти все страшные штуки iv и так далее оставались прям там и они продолжали жить потому кому модуля у нас был так называемый смог testing почему он в кавычках это потому что смогут testing обычно заключается в том что прежде чем накатить реальные изменения на хост мы проверяем что произойдет мы таком виде мы просто смотрели что происходит уже после того и применились вот ну и соответственно если прибегали дежурный значит что то что тут подсчёта пахло никто не так есть такая прекрасная книга куркин эффективный выплаты гасить cold хорошая книга начитавшись и и мы поняли что здесь очень много боли то есть нет никакого ну как бы главная суть этой книги примерно в том что нет никакого хорошего способа просто взять большой кусок legacy к воды кода и сделать из него прекрасный красивый кот вот но то что есть хорошего в этой книге из таких общих главных мыслей это то что процесс этот должен происходить потихоньку маленькими шагами и все это надо тестировать вот к чему мы собственно пришли то есть мы начали с того что начали разбивать вот этот большой камин модуль намного маленьких модулей первое что у нас было это вот более высокоуровневые модули то что ты джинкс манга тебе и так далее то есть модуль который сам паппет менеджер tab и также у нас были более низкоуровневые модули которые ресурсы из которых могли использоваться из других мест это вот модуль который метриками занимается жмите логирование мониторингом и так далее чтобы все это завести мы начали их тестировать первое до чего мы дошли это была база банальная полито ция и линд этому делали еще даже до этого то есть мы начали как то вы лидировать проверять что у нас просто кот хотя бы компе лицу до чтобы он не выкатывался какой-то совсем уж страшном виде да то есть мы смотрели что она хоть как-то работает вы лидируете так далее link это скорее было просто хорошо и приятно для всех да но никаким реальным эффектом это не вело но тем не менее кот стал становится более похожим они так когда там один человек да там много человек работает над одним модулем да естественно там все пишут по своему линд этому стал препятствовать следующее что мы вели это был вот это вот был довольно важный момент это был юнит-тесты с помощью не тестов мы используем инструмент который называется аспект по 5 собственно для unit тестов по 5 модулей и это наверно единственный вариант что он делает это вместо того чтобы применять паппи тайм код на какой-то реальный хост он просто делает ну что-то вроде псевдо такой компиляции да и проверяет что у вас при каких-то данных до есть какие то какие то результаты вашего кода то есть мы можем проверить вот например такие вещи то что у нас если мы этот код запустим да то у нас будет содержаться в нем пакет джинкс с таким . эта версия пакета которую мы применяем на холсте также тут можно проверить что у нас если при такой версии то есть у нас не очень большой зоопарк из операционных систем но тем не менее не менее какое-то количество версий ubuntu у нас есть да и можем сказать что например на этой версии ubuntu у нас будет такая версия бк суда на этой версии такая-то или если мы там какой-то параметры применим в этом модуле та та версия изменится на вот эту и так далее то есть это все мы можем хорошо тестировать с помощью unit тестов на модуле и дальше до чего мы дошли это то что мы стали делать джон док это наше такое внутреннее название он использует по пятницу попить strings это стандартная по первый инструмент для того чтобы генерировать документацию когда вы пишите комментарии к вашему коду в определенном формате он генерирует документацию превращает это вход e-mail но также может это сделать из этого джейсон и потом есть наша самописная туза попить тук он в которая берет markdown файлы которые в этой директории плюс это джейсон и генерит несколько страничек и прямых пушат сразу по к метку cue в confluence то есть у нас всегда обновленная теперь документация про каждого модуля хранится в конференции после каждого пуша до чего мы дошли по дороге так как у нас было довольно много изменений связи с тем что да мы там взяли вот этот большой кучу кода начали о том как это разгребать как ты это омри factory тьi так далее мы дошли до того что нашли вот такую красивую красивую конструкцию волшебную что она делает это она начинает мы начать ресурс у какого-то типа в данном случае крон и начинает их перчик это значит что вот этот кусочек кодов которая показал вначале да когда меняется название крон / да он вместо того чтобы забыть про старый кусочек он начинает менеджер весь хром тебе то есть если у нас был какой-то ресурс и он изменил название то он удаляет старые добавляет новый и соответственно всегда консистентная конфигурация хостов таким же образом можно мы начать юзеров таким же образом можно менеджер mode и например да то есть чтобы у вас всегда была консистентная состоянии хостов независимость того как вы там назвали а поменяли что-то то есть у нас нету становится меньше забытых ресурсов системе то же самое можно сделать с директориями то есть как вы знаете есть очень много сервисов у которых есть конвэй директории до в которой хранится какой-то набор конфигов например это актуально для какого-нибудь engine суда есть у нас есть несколько виртуальных хостов и конфигурация описано мы поменяли хоста забыли про старые star у нас остался мы думаем что у нас работает все хорошо потому что у нас два hasta оба обслуживаются все отлично на самом деле когда мы создаем хорст новый сервер дата у нас на нем уже опять же информация только в одном посте старый мы забыли это плохо а если мы начинаем путь жить вот эти директории то у нас соответственно в каких-то маленьких кусочков систему у нас начинается более атомарный более консистентные менеджмент вот этих вот директории с конфигами рестарты сервисов это все еще боль на самом деле за счет того что мы разгребли вот эти все команды мы стали это гораздо проще видеть там есть некоторые паттерны и программирования модулей в попить и чтобы легче видеть что от чего зависит вот но на самом деле это все еще решается так назову тем самым смог кастингом только теперь уже нормальным смог прессингом что перед применением да мы просто прогоняем снапом есть такой термин опу скажем тогда когда вы не не применяйте реально кода просто смотрите что произойдет после того как во как вы его применить и смотрим если у нас рестарте за сервис то возможно стоит задуматься если вы этого не ожидайте и следующий момент который мы сделали это мы начали работать надо проектным кодом то есть у нас было много include of вот этих ресурсов которые мы использовали ну и которые у нас есть в модулях все это очень часто повторялось в проектном коде еще есть такой момент что попить и важен порядок да то есть какие-то перемены у вас могут декларироваться в одном классе да потом следующем классе что-то страшных дел по на в общем если у вас есть два класса в одном из них декларируется переменная другой класс использует эту переменную то если вы их ну и за young людите в другом порядке да то у вас все будет плохо вот соответственно порядок важен да иногда это если правопорядок было неправильно это иногда приводило к проблемам да так как проектов много не все могут уследить за какими-то нюансами маленькими мы начали делать так называемый модуль профиль вот это как бы старый подход да то есть вот у нас есть но да это описание ноды у нас в проектом коде на этом у нас по порядку идут какое-то количество классов которые мы young людям вместо этого мы разбили его на 2 части да то есть вот первая часть теперь хранится модули профили оно одинаковое для всех проектов а вторая часть соответствует это одна строчка мы теперь ну как бы наш проектный код сводится к тому что мы просто делаем include одного профиля и там у нас профиля уже точно настроена в правильном порядке то что мы собственно хотим использовать для каждой конкретного типа ноды так как все еще есть какая-то разница в настройках да то есть очевидно все эти классы не будут использоваться совершенно одинаково в разных проектах до очевидно в разных проектах есть какая-то какие-то небольшие отличия да иногда большие отличия мы можем использовать такую штуку она называется хайр с помощью неё мы собственно это по 5 инструмент с помощью нее мы можем пробрасывать любые параметры на сколько угодно вглубь насколько мы хотим то есть если у нас тут напишем include профилем джинкс да и у нас там не написано какой то у другого класса внутри этого класса может быть еще один класс мы можем пробрасывать прям параметры прямо в самую глубь туда кнопка как угодно собственно то есть мы не обязана их доводить до верха до параметризировать там повторять одну и ту же логику мы можем прям любой из классов которые у нас дед из встречается по всей иерархии классов мы можем с помощью этого инструмента прямо пробрасывать куда нужно после этого мы начали понимать что помимо того что у нас есть модули до которые мы отдельно тестируем они отдельно работают все хорошо есть еще проектный код который тоже хочется тестировать мы это сделали с помощью unit тестов проекта вот у нас есть так называемый нет это болванка проектор в котором описаны какие-то базовый набор нот он покрывает примерно так 95 процентов наших кейсов может быть не все но большую часть у нас там покрыты и примерный подход тестирования заключается в следующем то есть мы когда делаем изменения в модуле тестируется модуль смотрим что там все хорошо а потом мы можем обновить версию этого модуля то нашего нового тега в инете и посмотреть что у нас и нет тоже тестируется хорошо вот после этого у нас есть branch и вот в этом и нити и мы пушем как бы результат вот этого всего если у нас тесты прошли там и пушем документы на релизные доки то есть пока что у нас реформ подход к релизу вот этого всего не полностью автоматизирован и возможно какое-то время мы еще будем продолжать это делать так вот но после того как мы запустили что-то убрать у нас документация долетает до опять же да confluence и там у нас собирается как бы информация об изменениях версии в модулях которые у нас теперь по сравнению с предыдущей версией вот и чем влоги всех модулей то есть мы в модулях пишем через блоге и соответственно какая-то дополнительная документация которую мы готовим к следующему релизу то есть у нас результатом вот этого постоянного обновления становится то что у нас и нет протестирован и документация следующему релизу готова что можно поймать на уровне тестирования проекта это дублированные потерянные ресурсы то есть часто у нас такие ситуации бывают когда мы например поняли что вот этот какой-то ресурс его лучше хранить не в эту модуля в этом модуле на то есть изначально помните да что у нас был большой один модуль в котором там все было очень много вот так вот собрано да иногда мы понимаем что надо что-то что-то откуда-то перевести соответственно когда у нас какой-то дублированный ресурс появляется дату мы можем это отловить на уровне тестах если у нас потерянная что то есть мы говорим мы ожидаем что с эта штука будет да если она теряется то на авторство тоже сваливаются циклические зависимости тоже есть такая штука в попить и когда из-за того что какие то есть можно указывать точно какие-то зависимостью каких-то ресурсов да если на уровне проекта когда мы собираем много модули вместе у нас они что-то ломается то эти циклические зависимости тоже можно обнаруживать на уровне теста проектов процесс релиза у нас теперь свелся к тому что мы больше не авто тепло и вот этот страшный модуль наш вот все модули протестировано все чем влоги готовы то есть у нас все это собирается в confluence и мы можем на это все удобно посмотреть когда релизе мы что еще можно сделать в эту сторону все вот эти следующие шаги они гораздо более дорогие поэтому возможно мы будем двигаться в эту сторону посмотрим acceptance тестирование это когда мы вместо unit тестов мы реально накатываем уже хост с каким то определенным набором манифестов папито вых и смотрим проверяем что у нас там все работает так как мы хотим на этом уровне можно проверять и дым патент ность кода то что сейчас у нас еще в процессе вот и такие вещи как например то что версия engine co действительно установилась то есть например на уровне unit тестов мы можем проверить что какую версию мы хотим установить но если такой пакет например в репозитории и в правильная ли версия в нем на самом деле джинкс у дома на уровне unit тестов мы такое не можем смотреть на уровне acceptance тестов это как раз то место где мы можем проверить действительно вот эти вещи то есть то что после применения наших нашего паппет кода у нас действительно устанавливается версия engine sata который мы хотели у нас слушается 80 порт если мы сделаем как он там curl да то нам вернет действительно тот html который мы и хоть ожидали увидеть integrations тест это в общем то используются те же самые инструменты это беккера rspec часто по пит использует можно использовать kitchen который у шефа есть такая штука вот но уже гораздо более большом формате да когда мы помимо 1 но дым и накатываем много но дай проверяем какие то между ними между ними зависимости между ними дал какие-то связи еще есть важный момент с изменениями когда мы есть у гитхаба есть такой инструмент который проверяет собственно две версии кода то есть вы можете сказать давайте возьмем вот этот branch и вот этот branch и сравним те ресурсы которые приедут из них на вот эту ноту и мы тогда можем отлавливать что у нас именно поменялось не то что будет как в конечном итоге да именно что вот какие-то изменения которые поменялись между двумя версиями за счет этого часто отлавливать какие-то очень странные нелогичные изменения ну и собственно выводы первый вывод это что для гаси код можно победить не надо его оставим оставлять в таком виде которой он есть с ним можно что-то делать потихонечку с помощью маленьких каких-то шажочков с помощью тестов но с ним можно и стоить что-то делать за счет этого собственно мы много выявили нюансов в этом коде много нашли таких вещей о которых уже давно все забыли никто ваш муж никогда не знал кто то когда то очень давно работал писал этот код теперь это все выплыла в маленькие модули теперь это все гораздо более видно и и гораздо более понятна вся для инфраструктурного кода это очень полезно и очень важно то есть там мы можем тестировать делать много каких-то полезных вещей типа генерации документов а вот с сиди надо быть довольно осторожно вот то есть возможно мы когда-то к этому придем но пока что это в процессе спасибо там есть какие-то мои маленькие контакты если есть какие то вопросы сейчас самое время спасибо за доклад по поводу legacy кода сталкивались вы с проблемами перехода с 3 по 5 4 как вы решали эти проблемы будет читалки владеть но на самом деле к счастью когда мы когда я только пришел в эту компанию на самом деле это буквально одна из первых моих задач было давайте вот приведем все проекты с 3 на 4 память это было не очень приятный момент но тогда еще ни о каких тестах речи не шло у нас был этот вот common да и просто переводили потихоньку подписывали проектный код то есть у нас как то было вот на тот момент как раз вот те самые всей их и что если у вас там не было проверки версии да ну там были вас бы пришлось ли вам использовать новый функционал которых 4 по 5 появился пришлось нам сейчас мы сейчас очень сильно характер этого пакета перебрасывать старый кот новые парадигмы а вот в модуле как раз команда вот про который я говорил большой модуль в нем было очень много всяких костылей которые как раз там были из-за того что нам нужно было поддерживать и ту и другую версию пакета вот когда мы уже делали маленькие модули мы понимали что больше у нас 4 5 больше 3 по 5 нигде нет и мы теперь можем уже использовать только новый код и соответственно не переживать об этом вот в самом начале я так понял что у вас проблема была совместной разработке то есть большой там кот какой-то который много людей писало часто ломался работали ли вы используете ли вы модули сторонний спать forge и как вы решаете проблемы когда там появляются какие-то изменения которые вам нужны или который наоборот вам что-то ломает да да хорошо вопрос используйте гордо live или какой другой system for живые модулем и практически не используем то есть у нас есть какой-то совсем минимум у нас есть тесто дали пвм mconcat стыда lip часто меняется ст удалит меняется это правда и мы его обновляем мы сейчас как бы в той же самой концепции мы можем протестировать проектный код до с новой версии стыда либо например и на этом этапе поймать какие-то возможные нюансы да там либо у нас единство я была проблема что там было недавно появились там функция тут джейсон она у нас была уже реализовано в нашем локальном там baby который у нас был вот я на чуть по другому работала ну как бы мы это решили тем что мы это достаточно рано заметили на уровне тестов да и просто переименовали нашу функцию стали пользоваться нашей переименовываю функции вот но вообще сильно больших проблем с использование for живым их модулей у нас не было я могу сказать наверное за счет того что мы довольно мало используя то есть какой-то автоматизации с апстримом у вас синхронизации с апстримом нету не совсем понял вопрос в плане синхронизации ну то есть как мы зации кода который вы используете себя мы используем другим наши модули они изначально фундаментально не чуть по-другому работают то есть тогда как например for живый модули nginx это модули у которого очень очень много параметров да и его можно использовать с кучей разных параметров чтобы сделать то чего вы хотите сделать на сервере да наш модуль у него гораздо гораздо меньше параметров он гораздо более маленький и он тут же четко заточен под то что конкретно мы хотим на наших то есть вы когда-то взяли modules for же и теперь поддерживать его сами этапом модулей от была взята не спорте а большинство модули была написана именно конкретно по те цели которая у нас были то есть наши цели они гораздо меньше чем чем for живые модули покрывают у нас нет поддержки например всяких там миллиарда операционных систем типа там free bsd и вот это вот все вот то есть у нас то что дорого это правда и кроме того что исторически так сложилось у меня нет на это ответа на то что почему мы так делаем вот если бы мы делали это сейчас возможно это было бы реализовано по другому но вот этот весь модуль команда он именно делался из парадигму того что мы хотим весь код писать а ну и последний вопрос почему именно пакет почему не чем опять же исторически так сложилось тут сложно что-то другое ответите да спасибо интересный доклад у меня несколько вопросов но 1 ну мы попить не используемый на шельфе сидим и вот интересует у вас версия не versio нирования модули практикуется да и очень на версиями да да кстати это про вопрос про то как мы выкатываем на отвечу сразу можно мы используем радистка у нас используется mercurial они гид по этому нас есть своя откачано я версия r10 к которая поддержит поддерживает mercurial и собственно да во всех проект у нас есть пакет файл в котором и проставленная теги который соответствует таком к меркурию ли который всех версий который мы нет librarian он умеет по зависимостям приносить все дерево модулей вот и нам это точно не подходит потому что мы точно должна быть уверена в консистентной стиверн то есть у нас нету такого что типа там вот пришел agrarian кто-то на форте выпустил новую версию нам прилетел внезапного версии что-то без спама следующий вопрос с автоматическим диплом вы от него полностью отказались или все еще практикуется и если практикуется то как вы вели фиксируется то что ничего не сломается какой-то стейджинг у вас есть нет авто диплом папе то вы их модули больше нет то есть нет у нас все модули теперь залочены у нас есть документированный процесс релиза у нас есть свой инструмент который берет вот этот пакет файл текущей паппет файл merged их новые версии просто дописывает те которые вот у нас вот в этом модуле в бранча хранятся и с таким образом у нас выкатывается целый набор новых мудро ещё один вопрос по поводу внедрения 7 интеграционных тестов у вас уже есть какое-то видение как вы это будете делать я понимаю инструмент есть инструмент по пятое это называется беккер и он умеет там есть описание такое в явно когда вы пишете что вот у нас есть админ ну то есть тот же самый админ как у нас да вот у нас есть какое-то количество нот прям на админу мы накатываем полный набор наших модулей которые нам нужен и потом все остальные ноты подключаются к нему и прямо берут снимок ну то есть полная ну примерно повторения прот инфраструктуры только это можно сделать например там из докер контейнер вот или это можно там развернуть вам в амазонии гугле где угодно спасибо спасибо большое за доклад такого вопроса не очень понял но сценарий разработчикам админ за комиссии all can he can джинсах и чуть-чуть сломался в продакшене ваш крутой балансе отдать в чьей вот сейчас вы заранее на этот вопрос ответить и сломается или нет с помощью текущих тест с помощью текущих тестов скорее всего нет нет я то есть процесс выкатывания скорее должен быть таким осторожным да то есть если у нас не очевидно глядя на конфиг engine is a или то вот это правда синтаксиса сломается печалит не очень очевидно а в попить и есть такой момент как вы любите индии то есть каждый файл мы можем во лидировать это конечно не стопроцентное предотвращение того что что то придет неверно это все правильно вот но на каком ну как бы хотя бы проверить что это валидный джинсовый конфиг это мы можем больше про логику и джинны но вообще да когда мы выкатываем какие-то более-менее серьезные вещи которые потенциально могут сломать продакшен да там и естественно делаем это частично то есть если у нас есть 20 балансира в проекте дамы выкатываем на один смотрим что через него чего-то на решение этого через бейкер да когда мы вот этот инструмент чтобы повторить как да да да структурой потом какими-то тестами внешними да вот тот же самый курда из какого-то там можно проверить на щетку вопрос про ему требуется infrastructure то есть не думали ли вы и может быть как вот подходу когда не паппет несирки ходят то есть пока не ходит в продакшен да и ломает то что работало вот как бы по 5 применяется на этапе создания образа то есть делать ровно то же самое только один раз для создания образа и потом уже идет диплом додумали конечно да к сожалению на данный момент инфраструктуру нас довольно тяжеловесная вот и процесс убивания ноты создания новых нот он дал волю дорогостоящий в точки зрения времени вот какие-то кусочки мы начинаем надо сейчас работать до не мы стараемся двигаться в эту сторону но на данном этапе это точно не реализуемы поэтому пока что пока что паппет пока что попить production спасибо вот еще вопросик вот вы говорили про профили вот и ну собственно вот провели приметам ноды в это по сути как роль как бы до туфель по петровской брось состоит из профилей соответственно есть как бы определенный набор эти профилей правильно понимаю что могу взять из этого множества профилей любое количество и применить к какому-то какой-то новой роли или все-таки применение каких то профили вместе может вы привести к тому что каталог не заберется профиле у нас пока штаб в процессе я могу сказать вот то есть на самом деле уровень роли мы помним про него но мы я бы сказал что мы бережем этот уровень абстракции для того чтобы понять как хорошо использует сейчас мы прям напрямую используем профили в проекте но возможно с ролями что-то что-то интересное потом то есть я пока не знаю на самом деле вот роли его теоретически можно хранить этот локальный модуль с ролью в проекте до самом вот возможно стоит все-таки отдельный модуль сделать роли в него included много профилей пока не знаю хорошо будет работать весь пример это когда отдельно роль великого ставлю с точки зрения папе то у них там есть примерно шесть подходов к дизайну вот этих ролей профилей там все очень нетривиально и опять же надо понимать что у нас почему профиль и вообще изначально придумали там как бы в них можно очень много дефолтов прокинуть модули да то есть модули изначально с точки зрения по 5 это вот эти вот for дживы и штуки до в которых можно того там миллиард каких-то параметров дамы из них используем там полмиллиарда до юноши работать так как нам нужна у нас же при этом есть своему свои модули в которых большинство параметров и также работает как нам нужно да то есть у нас на уровне профиля уже можно много из этих дефолтов не использовать потому что мы контролируем сами модулей сами дефолта в них вот поэтому с ролью пока сложно спасибо еще вопросы там где-то спасибо евгений за доклад нам на следующий вопрос вот вы говорили что вы отказались off to deploy а вот не появилось ли у вас проблемы с тем что как бы некоторые проекты не хотят обновлять машину ну по какому событию как бы ну то есть как бы вы их собственно обновляете спасибо ну там новый год рождество не на самом деле хороший вопрос мы обновляем у нас сейчас сейчас примерно расписание релизов каждые две недели то есть мы просто каждые две недели готовим набор модулей и потом их выкатываем в течение остатка недели на все проекты вот отказывается ли кто-то иногда это может наложиться на какой-то диплом программного кода да например проекте и ну естественно мы не хотим это все накладывать но в общем то сейчас все наши проджект-менеджеры в наших проектах понимают что это всегда приводит каким-то там обычно бонусом да это иногда что-то ломает но мы стараемся стараемся это чинить вот стараемся что такого больше не повторялось то есть нет таких чтобы прям отказывались потому что вот все плохо нет кто-то слева евгений еще раз спасибо меня зовут александр с компанией сбер тех на следующий вопрос поскольку вы начали для своей инфраструктура формировать некоторой который доказывает инфраструктурную конфигурацию дальше работать с этим у вас возможно возникла проблема с тем что ваша инфраструктура появилась ну своя маленькая инфраструктура вот этого собственность если вы его меняете а я уверен что вы вы меняете дорабатываете улучшаете то надо проверять валидность того что ваш собственный оон продолжит работать правильно все доставят вы как к решаете вот эту проблему влажность собираетесь ли вы это покрывать авто тестами для меня это реально стоящие проблема то есть у меня очень большой сей мне ну я сейчас с этим определенным способом работы мне интересно как вы может быть это решать честно пока нет то есть у нас есть какое-то количество руби джемов до которые используются при тестировании по 5 модулей до были уже такие случаи когда они ломались на момент их поломки мы их обычной penile тоже версии те которые она там не самая последняя предыдущая версия на которой она сработала да вот но это наверное единственное место где у нас были с этим проблемы с текущей на 6-ой то есть во всех остальных местах у нас есть jenkins который мы используем для собственного ну запуска тестов и пока в этом месте у нас все работало хорошо но я не могу сказать что мы супер далеко углубились в это дело всегда возможно сами конфигурации в дженкинс и она не они написаны кодом и вот мы перешли на код но всё ещё не пришли на покрыть его тестере вот спасибо еще вопросы но вижу вопросов нет спасибо евгенисты клад спасибок"
}