{
  "video_id": "pOF5_AclY-I",
  "channel": "HighLoadChannel",
  "title": "Когда лучше выбрать PHP вместо Go / Ильяс Салихов (retailCRM)",
  "views": 6789,
  "duration": 2317,
  "published": "2020-07-17T06:48:08-07:00",
  "text": "так ну начнем меня салихов я они летел crm говорит пропить и гол пару слов о нас мы серым номер один для e-commerce в россии и снг сейчас нами пользуются более 10000 интернет-магазинов может быть кто то она слышал но мы довольно-таки низшего решение специализируемся именно на и комиксы и того или иного рода продажа сейчас через над проходит заказов на сумму 90 миллиардов рублей в год если говорить о технических характеристиках то мы все живем в 3 дата центрах и у нас более 150 серверов проект запустился в 2013 году мы запускали проект на sinfonie и тогда это было буквально 2 sim вани сервиса постепенно росли появлялись новые сервисы существующие сервисы дробились на более мелкие и на данный момент у нас работу проект обеспечивать порядка 30 сервисов возникает у себя процентов на печке там выпечки у вас везде symfony 30 процентов на гол и 10 процентов на других языках и технологии качество воды у нас под грыз мы его любим и уважаем на сегодня речь не о нем сразу хочу предупредить что не буду пытаться ругать один язык и хвалить другой я скорее постараюсь показать где пить и себя показывает лучше в каких случаях целесообразно посмотреть в сторону глава почему принципе решил поговорить на эту тему мне кажется сейчас те могу несколько перегрета и многие хотят его попробовать заточить свой проект немало там и способствуют довольно небольшое количество докладов на тему go как на нем там переписываться какие-то куски кода или целые сервисы и как с этим здоров живет давайте попробуем более активно посмотреть на ситуацию для начала я гляну на google тренд за последние два года по этим двум языкам если посмотреть то доли pitch тип остается примерно на одном уровне он далеко медленно растет но в целом где-то не где-то а на порядок меньше чем . давайте попробуем понять почему же печки использовать большом количестве проектов и настоящее время в целом и конкретному нас для этого я хотел бы рассмотреть примеры примеры реальных страниц в нашей системе надеюсь они будут понятны какие-то страницы 1 страница это страница заказам это та страницы на которой менеджер по сути ведет свою работу с оформленным заказом он видит всю информацию о клиенте о том что он заказал формате доставки об оплатах и многом другом это большая страница большая форма здесь пример реального заказа форма содержит порядка 160 полей тех или иных и другая страница это список заказов здесь можно вытащить практически любую информацию о заказах и отфильтровать их по всему чему душа пожелает день доступно более 100 видов колонок и фильтров давайте попробуем прикинуть что нам потребуется для реализации этих страниц и что мы использовали ну во-первых мы работаем здесь с данными если посмотреть на эти собственно реальной страницы у нас используется порядка 50 сущностей и работать с ними как-то низкоуровневым не хочется хочется использовать уоррен давайте для примера возьмем для печки доктрину для кого я взял горн мы его используем в ряде важных проектов он входит в топ-3 время для go другие либо аналогичном по функциональности либо сильно слабее представим модель данных упрощенно где-то на порядок у нас будет заказ в нем будет только контакт на имя клиента дата оформления заказа и дата удаления при удалении заказа у нас фактически не будут удаляться из базы вторая модель к это товар в заказе и третья модель статус товара в заказе у нас есть только понятия помимо статуса заказа есть статусу его товаров с помощью них можно указывать состоянии комплектации либо причину по которой клиент или магазин отменил товар посмотрим как они описываются в доктрине я думаю многим знакомо это писание здесь приведён виде займа дельта-1 из сущности заказа класс со своими полями как скалярными так и полями связей аннотации модели вот для других двух сущностей все аналогично посмотрим как это выглядит в горне здесь все на первый взгляд все намного компактнее описания моделей не болезни даже на один слайд попробуем описать более тонкие настройки моделям допустим в связи между заказом и товарами в заказах нам нужно указать поведение каскадных операций допустим когда он персидским заказ чтобы у нас сразу базу персис теле и товары и также поведение при лазил воде чтобы у нас товаре сортировались поинишь нику по по сути по в том порядке который мы не добавлялись заказ если попытаться сделать то же самое в горне то мы обнаружим что там есть некое подобие каскадных операций есть похоже аннотация но она работает в лоб то есть если допустим вы вложенную сущность даже не меняли она все равно полетит на апдейт я там будет видно дальше в пример ну а лазил один как понять в принципе там нет все что вы хотите использовать в коде вам нужно выбирать заранее ok модель мы как-то писали дальше нужно ее применить базе данных давайте посмотрим что для этого есть языках в доктрине у нас есть две команды 1 мы можем создать миграцию и процентов 6-ть случаев это миграция уже подходит для использования в остальных случаях нужно либо ее какой-то мере да работать либо добавить операции по переносу данных ну и вторая команда собственно применяться миграцию тоже у нас есть go в горе столько инструменты по управлению миграциями сами же миграцию вам придется писать ручками а если вспомнить что у нас порядка 5-ти сущностей то это довольно таки большой объем работы при этом он рутинной и требующей внимательности а значит провоцирующую на ошибки ну а тысяч миграции ну то есть если кто то миграции дополнительно думаю вряд ли так ну модель создали схему в базе создали попробуем что не повыбирать на странице заказа думаю все просто там выборки поедешь ником потому что конкретно конкретный заказ давайте посмотрим на список заказов попробуем выбрать заказы с товарами в определенных статусах посмотрим как это выглядит в доктрине думаю также многим знакомый твари builder какие плюсы у твари билдера во-первых вы работаете с моделью и полями модели они с таблицы и полями таблицы и соответственно когда вы модель меняете вы сразу понимаете какие запросы вам нужно скорректировать и второе важное преимущество твари builder вам дает объектное представление запроса вот нередко многие запросы на выборки данных они повторяются в каких-то своих а частях и эти кусочки запросов их можно декомпозировать выносить в отдельный методы и переиспользовать тем самым это на самом деле большой плюс случае гарма если попытаться написать аналогичный запрос то вы нас что у него есть это хелперы пасквили здесь вы работаете с таблицами и спальнями этих таблиц соответственно когда вы модель меняется то какие запросы нужно поправить вы должны отслеживать сами ну и во вторых хелперы довольно таки ограничены даже здесь вот мне пришлось сделать хак чтобы указывать альянсу таблицы хотя в этом месте не предполагается что мы должны указывать элиас и чуть в другом виде это запросу же ломается как только мы данные выбрали после этого нам хочется их и изменить давайте посмотрим как с этим обстоит дело представим что к нам прилетел заказ и менеджер связывается с клиентом что party видеть его вот клиент говорит что он заказ будет принимать другой человек он просит изменить контактное имя и также просит отменить одну позицию заказом вот мы пробуем делать соответствующее изменение в заказе через доктрину и видим что они прозрачны транслируются в 2 байта нужных нам полей попробуем сделать то же самое в год в горами на первый взгляд код аналогичный но если посмотреть к чему он приводит то увидим что он приведет приводит к четырем апдейтом при этом два апдейта у нас для тех записи которые мы вообще не меняли это следствие такой работы в лоб каскадных операций и другие два апдейта если посмотреть внимательно то они меняют не изменившиеся поля а вообще все понятно записи ну и можно отсюда уже сделать вывод что если у нас активно чтение и запись идет там и таким образом можем перри затереть более актуальные данные старыми данными вот и тут придется в итоге у кого им прийти в горами либо крученым апдейтом тех полей которые вам нужно изменить либо добавлять лук и ему такси на уровне базы или на уровне самого приложения не очень удобно опять же преимущества r&m теряется ну и помимо этого подход data mapper а доктрина который по сути выполняют работу по отслеживание изменений мы его используем целом ряде своих кейс например у нас есть карточка клиента вот есть много данных по клиенту по своему клиенту а также есть связанные сущность и задачи и заметки к клиенту письма которые от него приходили ему отправлялись эту сущность у нас также создали того она фактически не удаляется из базы когда пользователь все интерфейс удаляют клиентов вот и если штатная функция такого софт удаления она работает из коробки в доктрине то есть проблем со связанными сущностями они остаются привязаны к удаленной якобы для доктрина удаленной записи вот и мы здесь это решаем как раз с помощью data mapper и доктрина который нам позволяет видеть все эти изменения в своем банды мы отслеживаем такие удаления вот с помощью своих аннотации показываем что делать с такими связями допустим визит клиента он без самого клиента мало имеет смысла поэтому и мы их удаляем вот если говорит например на звонках то все звонки всегда должны быть доступны в журнале звонков вот если клиент удаляется то звонок мы должны просто отвязать от клиента и уже показать клиенту от неизвестного человека другой кейс например у нас активно в системе используют функцию как истории изменения заказа которые фиксируются все что происходило заказам и аналогично функция для клиента есть при разработке это функция была ряд требований казалось бы на первый взгляд нам нужно здесь фиксировать все изменения просто по таблице но на самом деле фиксировать нужно не все а выборочно всегда есть какие-то служебные поля есть поля агрегаты которые не должны попадать в историю во вторых нужно фиксировать изменения вложенных сущностей потому что например когда вы меняете состав заказа это изменение связанной с заказом таблицы но для менеджера это по сути тоже измене и заказа и он хочет их видеть в истории и здесь вот как раз на слайде видно истории фиксируют а добавления товара и 3 хочется это все фиксирует автоматически что мы с помощью data mapper а и сделали мы отслеживаем все изменения с помощью аннотаций помечаем что нам нужно фиксировать как для скалярных полей так и для полей связи с другими сущностями которые автоматически также начинают отслеживаться истории если представить сколько для этого потребовалось бы чтобы сделать гол потребует много времени причем по сути патриот бы время на реализацию по сути библиотек которые к самой бизнес-задач они относятся вот так возвращаясь к нашим страничкам после того как с моделью мы разобрались нам нужно работать формами чтобы понять какой сложности формы приведу пару примеров есть состав заказа и как я уже говорил о товара в заказе есть статус вот если вы обычном состоянии товар нужно всегда указывать цену количество ставка ндс и ряд других обязательных полей то если товар отменен то уже все эти поля во лидировать и принимать не требуется и дополнительно к этому накладываться что это у нас коллекция товары могут динамически добавляться удаляться из состава другой пример блок доставки в заказе у нас есть api для доставок с помощью которого разработана нами и партнерами более 25 модулей интеграция службам доставкой и каждая служба она через api может помимо непосредственно приема заявки назад на доставку может регистрировать форме свои дополнительные поля допустим для почты россии этот номер отправления где можно его указать и дальше отслеживать для ship the road как здесь указано это например галочки наложенный платеж и оплата карты и таки опцию у самой служба доставки который может магазин выбрать и укажите доставки есть куча таких опций плюс например заказ можно разбивать на упаковке на отдельные при доставке я это все здесь указывается динамически для реализации таких форм мы используем все возможности симфонии по сути да абсолютно все это и вложенный формы без которых невозможно их реализовать такие страницы это события они позволяют вам динамически меняется состав формой исходя из входных данных этого лета ционные группы которые позволяют он динамически его лидировать данные исходя из входных данных или внешних данных коллекции снимают большую часть рутины при работе с массивами такими форм и еще важный момент этот доступ к сервисам из форм который у нас активно используется например при аутентификации и разграничение доступа один пользователь видит всю форму другой пользователь видит только часть полей вот плюс через настройки с ними можно отключать какие-то функции и опять же вас форма меняется в зависимости от этого форма может сама себя перри конфигурировать если посмотреть в год здесь есть некоторые библиотеки но они довольны и простые и подходят для примитивных форм даже до среднего уровня сложности формы они их придется допиливать если целом посмотреть на проект то за эти годы накопилось много логики много сложных бизнес лайки вот даже приведу простой пример chic что происходит при изменении заказов когда вот у вас приходит форма с какими-то изменений по заказам вам нужно проверить сначала права как в целом на раздел заказа таки на конкретные поля можно ли их менять потом допустим нужно отполировать у нас есть как встроенную систему валидации атаки пользуюсь ее популярности функции пользовательского лизации пользователи сами могут выражениями задать какие-то он валидаторы форме потом если у вас заказ до этого fiscal и zero вался то нужно проверить какие входят ли товары в фискальный человек них уже менять нельзя потом если у вас скидка на заказ ее нужно размазать по товару и округлить цены и если продолжать то список большой и это только для одной операции и наш опыт показывает что письки симфония они в реализации это бизнес свой бизнес логики не мешают значительным помогают и поэтому и пички sinfonie и мы выбираем продолжаем выбирать для подобного рода сервисов и задач а что же права в г как вы видите довольно таки много требуется делать ручной работы в целом ряде случаев и это даже не про то что язык плохой просто в нем нет той экосистемы фреймворков библиотек который есть пить п но опять же это не про недостатки за кого это про то что язык заточен немножко под другие задачи давайте я попробую пояснить в каких случаях стоит выбрать был опять же наших примеров во-первых вас должны быть очень узкая конкретная задача желательно с небольшой доменную моделью 5-10 сущностей пара примеров в наших сервисов диман коллектор у него есть боковая часть ногам есть фронтовая часть счетчик который остается на сайт и клиентов вот я начинаю трекать когда пользователи заходят на сайт что они смотрят и в сером уже сообщают о ключевых событиях по своей сути очень простой сервис при этом хорошо выполнять свои функции другой пример remix заниматься трикингом столбцы писем которые отправляют сером начиная доставки заканчивая открытием и перехода по ссылкам опять же сервис буквально на две три тысячи строк вот простой и по данную задачу очень хорошо подходит второй важный фактор когда он требуется настоящие многопоточность который печки сейчас в полной мере обеспечить не может также пару примеров у нас есть платформа rittal серым чат которая спустилась полгода назад это по сути агрегатор мессенджеров где менеджер может обрабатывать входящее сообщение вопросы вот клиентов которые пишут менеджеры и взаимодействовать с ними менеджеров видит кто пишет по компросу также видит карточку клиента справа заказы этого клиента и фтор в этой платформе много участников с одной стороны это транспортная api через которое из мессенджеров сообщения поступают платформу и ответы приходят в обратную сторону со второй стороны это менеджеры которые собственно видят все что происходит в чате к могут писать выполнять какие-то действия встретить стороны это батова яппи с помощью этого пи боты могут производить по сути все действия которые производят и менеджеры слушать события которые происходят сами писать могут даже при назначать диалоги например вот могут менеджеру просто подсказывать какие-то ответы и сердце раны с серым в которой дополняется карточка клиента история переписки и все эти участники они взаимодействию с платформы одновременно им нужно по друг друга переставать сообщения события реагировать на их действия здесь многопоточность гош но как никогда хорошо подходит и второй пример это один из ботов в этой платформе бат распределением он по сути занимаются распределением входящих диалогов на менеджеров исходя из их загрузки ему нужно смотреть у кого из менеджеров сколько уже диалог назначена и какие диалога закрываются ему нужно видеть кто уже появился в онлайне и кто ушел в офлайн кто себе просто выставила в системе статус занят ну и в принципе нужно быть слушать события в чатах понимать когда появлялись новые диалоги и уже в этот момент распределять их на менеджеров здесь также хорошо себя показывает многопоточность ну и третий фактор это производительность ну на самом деле желательно необязательный фактор вот если у вас есть первые два фактора то могу можно посмотреть и можно даже выбрать для вашей задачи а если все три то уже большая вероятность что он хорошо подойдет ну и прицепом у вас идут целый ряд преимущество это и обнаружение состоянии гонки без чего сложно разрабатывает многопоточное приложение это скорость как скорость сборки так и скорость самого конечного приложения это просто то как простота языка например у нас все что написано на главу писали те же ребята которые развивают и поддерживают симфонии проекты ну и простота обслуживания когда вас один бинарник к это очень удобно статический типы помогает очень при факторинге и позволяют увидеть большое количество ошибок еще на этапе компиляции но и надежность гон нас еще никогда не подводил напротив работает хорошо но в конечном итоге вам остается только выбирать подходящую технологию под задачу под разрабатываю сервис а дальше из этих сервисов компоновать упаковывать конечный продукт которые будут использовать пользователя на этом у меня все используйте подбирайте технологии под задачи а не пытайтесь притянуть за уши задачи под технологию которую вы хотите попробовать спасибо можете задавать свои вопросы есть у кого-нибудь привет ещё раз спасибо за доклад камыши бормотать на слайд где преимущество год мне кажется часть из этих пунктов субъективные например третий пункт он может прямо вытекать из того что задача простая соответственно если подобрать аналогичную простую задачу на php та простота реализации на php тоже будет плюсом если решительно php это же сам можешь сказать про ну по субъективность 4 пункта и 5 тыс это такой сомнительной сомнительное сравнение понимаю дам но это то что мы видим на практике то что нам помогает языке до в какой-то мере субъективно спасибо спасибо за доклад к если бы были фреймворке типа доктрин симфония принципе язык то ничем не ограничивает написание framework of таком будущем через пару лет когда не появится для печки уже не будет места получается но тут все сравнение было ну мне кажется чтобы написать аналогичной формовки там немножко придется пойти в разрез самих принципов языка ну стоит на да ну один из показателей то что год а на самом деле 10 или чуть больше 10 лет но я не до сих пор не появились вот это о чем то говорит и мне кажется это скорее всего говорит о том что они языке просто не нужны там с помощью него решаются другие задачи пример которых я приводил вот именно это я хочу сказать что они для разных задач и порой его пытаются выбрать для тех задач где pitch питона самом деле лучше себя показывает скажите пожалуйста выбирали г исходя из каких соображений просто собрать допустим многопоточность и производительность например есть шланг например почему много он просто нам понравился по сути это же наше решение но это совокупность этих факторов не знаю скорее летной она про просто ту про скорость входа на самом деле быстро спасибо за доклад у меня глупый вопрос был ли опыт использования одних и тех же сущностей одной и той же таблицы одновременно и в сейфе и нога и какой опыт если мы но если речь про то что два сервиса один наглым другой на симфонии работы с 1 этаже базой нет мы так не делаем у каждого сервиса если есть база то она своя вот но есть вот например в случае платформы чат и crm и там и там ну в чат а вы платформе там принципе вся переписка хранится серым загружается история переписки ником урезанном виде нее там есть по сути с точки зрения модели некая проекция на но они друг другу их передают папе я со вкусом здравствуйте спасибо за доклад вопрос когда же все таки лучше использовать печки потому что вот вас в докладе было там когда стоит использовать go я правильно понимаю за этого что вы подразумеваете что когда не эта ситуация в любом случае стоит выбирать печке или все-таки может быть есть какие-то пограничные ситуации когда стоит подумать о г то есть и между довольно очевидно что если она скрыта маленькая задача требующей высокой высокой производительности поэтому возьмем готом если у нас просто сайта пить пиво по поводу пограничных услуга каких-то ситуаций могли быть и пример или что интересно рассказать потому что это же наверное называть самый большой вопрос при выборе например к примеру то я на самом деле приводил по сути в нашем случае когда у вас довольно kia развести то бизнес-приложения вот у нас по сути облачно бизнес-приложения серым go подходит не очень здесь на печке писать намного удобнее ними какими критериями при руководствоваться только вообще на наличием каких-то вот библиотек типа доктрин той же да ну я на самом деле очень важно вот эта экосистема которая помогает вам писать приложение оно сильно экономит время нога вам придется это там 0 изобретать вот либо много ручной работы вают то есть нужно просто сначала оценить нужно ли библиотек сколько от нее понадобится если ответ да то как бы уже смотреть скучно печки да ну и на размер самого сервиса приложение понятно относительно небольшие сервисы стоя писать здравствуйте спасибо за доклад я к сожалению могу вообще еще ничего не писал но мне но я знаю какие то сравнения там пах об этом си сравнивались с другими языками и вот интересно если использовать в то получим и сразу там инструменты работы с сессиями пользователей там возможность легко отдать контент то есть response доступ к серверным каким-то константам но к данным сервера этом доме он что-нибудь ещё или нам придётся это вручную партии там хедер или что такое вы не сталкивались и сразу второй вопрос задам какого плана сервиса нога вы разрабатываете то ли то есть это api или это может быть в приложение которое ну собью high к самым первым вопросом давай есть вы такие сервера но они очень минималистично там есть сама база там захват запросы удобные отдача ответа можно подсунуть midgar ну наборами даже как правило не очень прям велик и часто сталкиваешься с отсутствием нужного что уже есть в том же симфония например так а второй вопрос еще по первому вопросу сессии например вы расшаривать то есть между request a mi сессия как хранится то есть года j да есть но этого то в рамках конкретных веб-серверов реализацию но таких про мини from у раков есть да у них том числе медовые река для работы с этими ok второй вопрос был про ваши сервис и нагло то есть это api сервисы или в приложение которое отдают ну да html случае г практика показывает наши по крайней мере что удобнее год делать из топи вот если нужен фронт для этого сервиса то его делать отдельных фронт который с этим api работает ну допустим у нас у ботов они все в маркетплейсе они по сути все работают сопи основной платформы или сами предоставлять т.п. но у них есть раздел настройки этого бота там конфигурация там допустим вот и распределения там сколько диалогов на моем же можно настроить вот и для вот этой части там тоже apes к по сути маленькая вот и свой фронт и третий вопрос верните пожалуйста назад сейчас скажу да какого слайда я просто номер забыл раньше раньше о вперед да да картинка с транспорт специально сделано ну это вопрос риторический это не специально кстати вот в данном случае есть это тоже пример большая часть транспортов для большей части массажеров реализованные нога вот ну там потому что не помню небольшая не транспорта неудобно например для одного из мессенджеров для которого нет официального пи вот но есть библиотеки которые работы с неофициально - по сути там с мобильными лес web api этого мессенджера и они говорят на печке он тоже пример что нету в каких-то библиотеки и мы за использовали . в этом случае у меня вопрос про все их случае г то есть ну так интегрально в среднем в больницу насколько он лучше или хуже чем тот который доступен на php что что и есть готовое много ли нужно писать самому ну вот функция тестирования встроена в самом год там есть прям командовал тест которая запускает с ты ну для тестирования там есть необходимый набор библиотек с этим проблем нет с этим все хорошо и все это не только тесты доставил ну-ка доставил он также эта часть языка в этом плане это плюс 2 ты не можешь описать по другому там просто вниз компиляция если ты бил и versio нирване вот это все версии они рование версия хопи то есть чтобы это все за деплоить в наверное в докере все это выкладывайте если есть да у нас это в докере в год кстати до последнего времени все было плохо с пакетными менеджер и вот последний крепится к столу полученное кита чё мне кажется не сравнима с тем же печки почему ну вопросов было задано много выберите которую вам больше всего запомнился и показался интересным ну вот дорадо в эти молодому человеку который дольки много вопросов задал"
}