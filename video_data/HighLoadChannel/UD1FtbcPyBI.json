{
  "video_id": "UD1FtbcPyBI",
  "channel": "HighLoadChannel",
  "title": "Веб-разработка без наркотиков с помощью PostgreSQL, Nginx и c2h5oh / Миша Кириллов (CINEMOOD)",
  "views": 767,
  "duration": 1407,
  "published": "2017-04-22T14:47:54-07:00",
  "text": "следующий доклад был бы очень интересен химиком потому что то будет доклад про то как из postgresql я сделала с полноценным сервер практически минимальными затратами поприветствуй михаил кириллов здрасте меня зовут миша и я хочу вам рассказать немножечко провокационный доклад о бэк-энд разработке вот я хочу поделиться с вами своим опытом немножко как я разрабатываю веб-проекты но веб-проекты когда я говорю в этом докладе я подразумеваю backend разработку именно вот расскажу вам как я жил до такой жизни и приведу какие-то примеры использования в своего подхода вот такая история ну эволюцию разработки мы все наверное знаем сначала у нас были голы ешьте мелки потом появилась необходимость запускать скрипт и придумали сиджей потом начали кита городить тимплей тэджон и потом начал каждый программист ходу придумывать пытаться свой фреймворк городить какой-нибудь rm который ну как правило зачастую не работает на нагрузках не держит их и сейчас наверное тенденция идет к тому что мы разрабатываем и пи ай какие то которые используются уже на клиентах и vip-клиентом используется один и тот же и пиа и мобильным клиентам и может быть там для каких-то мир сервисных взаимодействий вот я не отличаюсь от всех программистов я тоже начал придумывать свой фреймворк вот когда начинающий программист приходит weapon ужасается от обилия всяких штук которые муму на первый взгляд должны облегчить жизнь есть множество всяких диких ну и и не диких фреймворков чтобы изучить который надо потратить наверное не одну жизнь ни одного веб-разработчика разобраться в этом многообразии сложно вот я же хочу сказать что фреймворке на самом деле не должны усложнять разработка должны упрощать все-таки мы когда городе фромборке мы должны не забывать о том что мы делаем это все для того чтобы упростить разработку чтобы проще было понять и нам что мы хотим сделать и тем кто будет поддерживать наш код в дальнейшем вот и часто встречаются странные какие требования разработчикам например глубокое понимание отличий php версии одной другой там глубокое знание какого-то фреймворка yii уайтом конкретный версиями мне кажется это все откровенный бред вот извините я считаю что rm зло потому что разработчик не знает как работает система изнутри он не понимает ну что происходит внутри с данными внутри базы данных когда он что-то делает потом это начинают расти нагрузки и все это не работает начинает падать вот многие говорят что но ничего страшного мы поставим еще один сервер там еще 10 серверов у нас все будет работать на самом деле нет процессор на и время память не конечно и поддерживать парк из 10 и 100 серверов это совершенно разной задачей затраты на поддержку огромного парка железо они растут экспоненциально хотя по сути в веб-разработке в бэк-энд разработке задача несложные из базы данных достать какие-то цифры и переформатировать их отдать клиенту вот почему я использую пожгли scoin но наверное все тут знает что такое пузырей сквозь можно не вдаваться детали вот ну основной конечно аргумента что мне нравится наверное использовать его поэтому я использую остальное все уже притянуто за уши ну работает быстро багрец не но если сравнивать с какими-то привычными иску или реляционными субд или не реляционными субд и он работает вроде быстрее если ваграм затюнить вот можно написать храним кино любых языках можно написать свое расширение можно написать свой сторож чего угодно можно сделать под гриссом вот недавно появилась поддержка джейсон что тоже очень удобно что тоже очень удобно все эти того что мы постоянно разрабатываем всякие пиа и как правило эти пять общаются у нас данными джейсон формате вот брэндон extern тоже много говорить не надо все знают этот веб-сервер зарекомендовал себя достаточно хорошо быстродействию него колоссально достаточно высокое есть конечно сейчас появились другие веб-сервера который работает быстрее но мы несколько раз уже на кололись вот я тут тот же самый спирт пытался сделать на других штуках но приходится подрезать время от времени в отладке но они работают на первый взгляд быстрее вещи но эти но когда доходит до production а стоимость их поддержки намного выше вот что же такое спирт мой спирт спирт это тоненькая прослоечка которая позволяет проектировать запросы http напрямую в базу данных если у вас в базе данных логика реализованным в адресе виде хранимых процедур тем или иным образом бизнес-логика вы можете использовать это тоненькое расширение реализовать свой и pr ну почему спирт потому что engine.exe под gris это инструменты позволяющие ну как сказать сделать highload на коленочки такой ну михайлова ну конечно реального хайло да там не дойдет дело надо все это дело будет еще допиливать но с минимальными затратами сделать решение которое будет работать достаточно быстро реально быстро но если мы возьмем какое-то framework из коробки там не важно на каком языке он будет работать медленно очень медленно эта штука будет работать быстро вот я конечно извиняюсь я подробных тестов не сделал но штучками то я немножко погонял вот на моем ноутбуке на хилингом она выдает 14k запрос 14 запрос в секунду вот мне кажется это достаточно высоко если сравнивать хотя бы с тем же самым воскресным ну который там не конечно нечестно сейчас будет если я скажу но там две тысячи запросов в секунду но тесты не очень похожи были поэтому следующий раз я нового обещаю что я сделаю более подробные тесты которые будут отражать реальную картину вот что еще когда мы используем такой подход и и в разработке нам не надо держать большую команду инженеров нам надо держать только квалифицированных людей занимающихся обработкой и хранением данных вот мне кажется это огромный плюс когда тот человек который проектирует схему базы данных которые знают как хранить хранятся данные как оптимально их отдавать как их быстро упорядочить как быстро отдавать он же проектировать интерфейс к этой базе данных вот если это делать два разных человека то людям этим приходится много во-первых тратить времени на коммуникацию и результат получается хуже ну здесь переходим мы конкретным примером вот конкретный пример конфигурации engine.exe для моего вот этого спирта вот достаточно простая конфигурация нас интересует директива c 2 h 5 ваш пас мы задаем параметры соединения с базой данных и размер пула в данном случае 200 соединений постоянных будет поддерживаться с под грифом вот рутовый адрес на который который через который будем и наружу отдавать на шейпе они все машите зации есть два способа можно либо автоматически настроить маршрутизацию в этом случае адреса url будут копироваться на имена хранимых процедур самим спиртом либо написать свою функцию маршрутизации в данном случае используется своя функция маршрутизации ну и тайм-аут вот здесь пример функции маршрутизации он состоит и буквально из двух строчек с помощью этой функции мы мы пируем ural вами функция если функция у нас в схеме веб соответствующие для нашего вызова и пи ай найдено то вызывается эта функция возвращается и и результат наружу если функция не найдено мы возвращаем 404 вот случае ошибки мы возвращаем код ошибки вот все достаточно просто кстати сказать вот в том тесте про который я говорил где у меня было четырнадцать тысяч запросов в секунду как раз использовалось вот это вот функция в качестве обертки конкретно вот эта функция через через нее уже вызывалась другая функция которая выполняла выборку там из простейший таблицы ну прости простейший тест вот пример функции например мы хотим сделать функцию которая будет суммировать два числа это функция у нас не будет называться сумму она будет отдаваться вот снизу видите карловой пример вот она будет по этому адресу после того как мы создадим функцию вот эту базе данных веб сумм у нас появится автоматически функция и 5 соответствующим именем вот ниже пример вызова этой функции ну и соответственно вы все логику которая вам требуется можете в виде необходимых в вам функции реализовать а сам и уже реализацию внутреннюю хранение данных там обработки их уже прячьте в какие-то нужны непосредственно для разработки для понимания бизнес-логики функция и 5 здесь реализован только и pr интерфейс вот спирт поддерживает заголовки http заголовки ну и соответственно cookies вот здесь я показал пример как получить или отдать значение cookies да забыл сказать каждая функция принимает на вход два аргумента виде джейсона это cookies и параметры параметры посты get запрос и упаковываются в джейсон пример функции редиректов но мы возвращаем заголовок с соответствующим url он на вход этой функции мы подаем параметры у героев и возвращаем заголовок http с соответствующим значением ну здесь пример каких-то случайных рандомных заголовков если возникает необходимость отдавать какие-то заголовки ну например мы-то модем время выполнения запроса ли еще что-нибудь можно всех запихать обернуть вот непонятно как делать загрузку файлов на первый взгляд например нашей 5 требует загружать картинки например ну вот делал я интерфейс для рекламной системы то мы загружаем картиночки вот таким вот примитивным способом я реализовал загрузку картинок этот работает продакшн и уже почти год такая схема ну картинки сам engine x пишет картинку соответствующий каталог да и мы потом потом мы уже в дальнейшем из этого каталога разбираем разгребаем отдельным скриптом эти картинки перекладываем куда надо мною перерабатываем соответствующим образом а самозагрузка вот достаточно простая то есть есть два логично один оплот который торчит наружу в этом а плоть и опять же через средства стандартный engine.exe реализован request запрос на авторизацию если у нас выйти а есть функция авторизации чтобы неавторизованный пользователь и например не могли загружать картинки мы можем вызвать эту функцию если пользователь у нас нет не авторизован системе то он загрузить картинку не сможет вот такой на первый взгляд кривой способ но он не вызывает вообще практически никакого оверхеды пост данные пишется сразу на диск индексом и больше никуда не вынимаются не перекладываются вот еще возникает задача которую средствами субари решить на первый взгляд тоже не возможна отправка например e-mail каких-то уведомлений или подтверждение регистрации и авторизации ли что нибудь в этом духе но эту проблему можно решить тремя способами либо стандартными средствами мозга и солист иных на тифа и внешним скриптом можно сделать свою очередь можно сделать реализацию своей очереди там своей логике можно использовать какой-то готовое решение например вот есть очередь embas так называемая который написал франков иван погуглите мне кажется достаточно интересное решение которое позволяет поднять на подгрести сервер очередей простой вот ну можно складывать туда уведомление вынимать их внешним скриптом написать чем там пару строчек вот ну можно конечно при желании написать отправку почты прямо из храним кино подгрести но мне кажется это плохо потому что но если там читов колону вас станет то ip-адрес весь перестанет отвечать у вас все worker и будут заниматься тем что будут ждать ответа почтового сервера вот есть еще проблема авторизации пользователей авторизации пользователей именно в вашем веб-приложений в вашей бизнес злой в вашей логике вашего приложения вот есть два подхода базовых но мы либо мы можем генерить какие-то токина которые складывать в табличку и по этим токи нам авторизовать пользователи либо мы можем без хранения сессии подписывать какие-то системные данные дайны делать на основе этого токины можно использовать кит готовые решения джейсон нет talking вот я это решение возможные имплементировать в спирт для того чтобы можно было цепях же иметь готовое решение по авторизации пользователей так немножко скажу а об отладки и тестирования но жизнь поэтому я использую я и в работе вим вот но мне достаточно удобно работать при соответствующей дисциплины в организации файлов при написании тестов но у меня там все настроены по нажатии там на кнопочки выполняются тесты мне очень удобно это работать но приходится для этого конечно писать тесты но с другой стороны это дисциплинирует и ускоряет разработку когда реализация какого-то очередного модуля она сопровождается тестированием самого начала разработку ускоряется но потом эти тесты трансформируется в какие-то интеграционные тесты там тесты более высокого уровня мне кажется достаточно удобно единственное неудобство с которыми я столкнулся это отладка хранимых процедур то есть оплачко как такового нет или я может быть плохо искал вот по-моему кто-то на этой конференции будет рассказывать про отладку хранимых процедур но здесь я бы хотела сходить послушать мне кажется будет интересно вот но яблочко не нашел ну и происходит happy дебаггер все время там нотис бла бла бла и parting логов но не парсинг логов я когда запускаю теста я же вижу выводы по иску или и вот таким образом я отлаживают вот какие то решения для кантину integravision я не использовал но вот мне тут ребята подсказали вот ну мне кажется было бы интересно с этим разобраться и попробовать какие-то готовые решения для спирта на этом сделать вот вот c 2 h 5 а уж конечно есть и минусы вот есть сложность разработки то есть нужно обладать обладать какой-то первоначальной квалификации для того чтобы поднимать что делаешь если какой-то фреймворк другой вам дает мощные средства но вы в дальнейшем за это расплачиваетесь потому что вы нам можете наворотить чего-то и не понимать как это работает и потом зачастую задача разобраться как это работает и ускорить работу в склад сваливать на ты вапсе сисадминов но и все превращается в снежный ком там и переписывание фактически потом происходит продукты заново вот минус трудней найти квалифицированных инженеров но на первый взгляд кажется что их много на самом деле не так не так то и много вот я написал но я совсем недавно только выложил в открытый доступ мало документации мало примеров я буду работать и постараюсь написать побольше непривычно тестировать и отлаживать и сложности некоторые есть диплом ментам храним ок ну задачи на будущее я написал для себя как ленивый человек небольшой скриптик я соответствующим образом пишу в своем айпи а и комментарии к хранимым процедурам запускаю этот скрипт и на выходе получают документацию потому и пьянь которая дело то есть не документацию писать фактически не надо я комментируя код соответствующим образом получаю документацию вот я этот скрип тоже хочу довести до ума и выложить его составе пакета помимо этого я хочу сделать автоматическую песочницу для своего спирта то есть будет соответствующее лаконично включаться в engine.exe куда можно будет зайти через интерфейс поиграться подергать вызовы храним и 5 подставляя какие-то реальные данные что будет удобно для клиентской разработки фронтенда будет туда заходить и смотреть потому что не всегда не все from render и могут по тестам понять что происходит вот написать еще более подробный сравнительный анализ существующих решений ну и самое главное ко мне поступает предложение там-то прикрутить к спирту сё прикрутить я не хочу ничего больше прикручивать чтобы сохранить минимализм это быстродействие но вот которая получена ну собственно и все так как она быстро торопился извените если что не так спасибо кидайте тухлыми помидорами вопросы предложения а вот скажите пожалуйста этот модуль написан на си на си плюс плюс си си плюс плюс использовать скажем джинну просто вместо использовать можно сделать и так но это будет мне кажется медленнее работать но и опять же когда я делал начинал только делать это и решение первый раз я в одиннадцатом году тогда еще не было вот этого но не только была мысль еще сделать один модуль для engine.exe который можно будет ставить перед этим и pr для того чтобы генерировать какие-то не надо мажьте мылки да на базе каких-то шаблонов то есть например поставить модуль шаблонизатора который на базе джейсон получаемого и за pr будет отдавать наружу же html вот но в современной разработки мне кажется это уже не нужно потому что практически всегда всё собирается на клиенте в java скрипте но по крайней мере в моей практике спасибо коллеги еще вопросы есть михаил если возможность подключаться каким-либо еще сторонним базам к примеру каким-то in memory хранилищем ну дай во первых есть в engine.exe множит много модулей практически к любому хранилищу есть доступ из процедурки из хранимой используется но да да наверное из коннекторы но честно сказать я не изучал подробно этот вопрос то есть для меня это внешний внешняя задача была то есть я на базе engine.exe решал конфига эту задачу был был опыт когда мы проектировали запросы например vertical из-под gresso языке с помощью долинка подрисовок коллеги раз вопросов больше нет спасибо михаилом большой за доклад ни за что если у вас вопросы появятся всегда можете михаила славе снимет коридоре завести love переговорка задать их"
}