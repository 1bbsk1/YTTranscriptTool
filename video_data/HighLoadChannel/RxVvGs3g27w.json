{
  "video_id": "RxVvGs3g27w",
  "channel": "HighLoadChannel",
  "title": "У одного моего друга, не у меня, есть опыт работы с SAGA / Дмитрий Химион (Авито)",
  "views": 3183,
  "duration": 3247,
  "published": "2020-04-14T11:17:20-07:00",
  "text": "итак всем привет сегодняшняя тема моего доклада будет о сагах такая интересная а сущность в области икр сервисной среды меня зовут дмитрий симеон я работаю в компании vita работу в компанию это уже несколько лет и занимаясь вопросами обеспечения качества давайте небольшое интро про то как вообще появилась тема этого доклада или чем она основана чему доклада не врет это опыт не прямо мой я ни в чем не виноват я не ломал лжи ни разу авито и вообще позитивный человек другое дело мои коллеги мои друзья замечательные который уже в течение полутора твой более лет час так сложно уже вспомнить используют функционал сак для реализации на основе его различный функционал и естественно все интересные курьезы которые происходят у нас в процессе эксплуатации я вижу и мне все это время приходилось в этом участвовать с этим разбираться не накопил определенный багаж опыта которым хочется поделиться который будет безусловно полезен для тех кто либо использует этот механизм у себя либо собирается его имплементировать немножко по плану доклада значит первое что мы сделаем мы освежим вспомним что такое саги я расскажу про концепцию дальше я немножко расскажу о проблематике которой мы столкнулись и дальше мы разберем самые такие интересные кейсы которые на мой взгляд стоит выделить при работе с сагами и дам определенный набор рекомендации который мы вынесли из своего опыта при работе с рогами ну дальше там подведем итоги и по задаем вопросы и так что такое сага кто читал книжечку криса ричардсона некоторые количестве ок есть три встречаться на это разработчик евангелист который продвигает эту концепцию я читал книжечку он приезжал к нам летом с лекциями lavita кроме к сервисы в общем то что это такое это способ реализации функционала стран секционной семантикой в рамках микро сервисной среды также а это способ поддержать согласованность данных в микро сервисный среде без использования распределенных транзакций это такие самые верные ключевые такие важные вещи которые стоят освежить в памяти далее есть варианты реализации сак их всего три хореографическая когда у нас есть саган который в себя включает какое-то количество шагов вот здесь вот она представлена и они выполняются вне зависимости друг от друга и приводит к какому-то результату второй кейс это оркестра ционной асада выполнение шагов которой упорядоченное имеет какой то смысл какую-то логику под собой соответственно они выполняются в определенном порядке и третье это смешанный то есть в саге есть какая-то упорядоченная части неупорядоченно вроде пока все просто ничего такого с чем шагом точно не стоит путать это с распределенными транзакциями это прям 1 не равно другое ну как минимум по ряду причин перейден их на флаге что касается схемы работы да я ее наверно представлю вот так то есть есть некоторые сервис owner саги есть каком-то виде реализованный сага экзекутор неважно это какая-то dependency видели бы для сервиса или это какой-то отдельный отдельностоящий сервис который занимается управлением в полне ясогами и так далее и сами саги с логикой вот в нашем сегодняшнем докладе речи будет именно про сами саги про саму логику в сагах и как это работает как эти штуки выполняются в процессе работы это как они взаимодействуют наши микро сервисной средой и так давайте приступим к первому кейсу наверно это не самый удачный кейс с точки зрения experience a и наверное самый каноничный относительно сак на имплементацию пришла следующая функциональность которую мы погрузили в саге но особенность этого функционала была в том что не все шаги этой саги можно компенсировать то есть вроде как мы ломаем логику и концепцию сак но она вполне compatible то есть можно такой функционал погрузись лаги она будет работать если вам придется столкнуться с таким функционалом как-то будет выглядеть первое вот у нас сага здесь конкретно представлена регистрационный асада то есть упорядоченное как она работает вот в ней есть какие-то 6 транзакции 6 in point of 6 сервисов не участвует вот у нас есть три на которые компенсацию мы не можем сделать и увы это как текст вы можете столкнуться такой штукой да в любом варианте например отпиливаю кусок монолита вы вдруг понимаете что бизнес-логика она должна сохраниться вот в таком виде это нужно сделать сейчас и по-другому вам это не удастся сделать происходит файл то есть мы ее реализовали она работает происходит сбой неприятная ситуация естественно на стороне сага экзекьютора такая сова попадает хранилище заселенных сак и здесь мы получаем скал прочную работы то есть нам нужно все эти шаги как-то перри прокрутить и все-таки завершить их то есть допустить до конца и все-таки сделать преобразование системы да и состояния в состояние бы как-то можно сделать механизм smart retrieve он поможет то есть это механизм на стороне сага экзекьютора который в щадящем режиме не убивая наш микро сервисный мир щадящем режиме ретро от выполнения со который у нас есть и они так и заканчиваются успешно это абсолютно нормальная ситуация microserver среде так как сервис может переди плодиться какой-то сервис может за сбоить упасть и вот он перед поднимут и так далее и он здорово сокращает объем ручной работы которые вы будете иметь в результате сбоя таких сак то есть которые являются такими так скажем однонаправленными итак в чем может быть проблема с этим smart ретро проблема следующего характера начинает перри проигрывать посоленную сову и мы выйдем спецэффект на каком-то шаге нас and point ни один патентный и получается смешная ситуация например юзер есть какие-то перми шины и они раз какое-то время у него просто переключается туда-сюда это нехороший ситуациях же если там речь идёт о каких-нибудь лимитах списание или еще капнуть функционале то есть в используя механизм артрит раев мы на пару можем напороться на ситуацию что если у нас имплементация in point of участвующих саги является не не пакетной получается такая очень плохая штука естественно поселенные саги они скапливаются в сага стороны на стороне сага экзекьютора и в любом случае даже smart ретро my мы получаем какой-то объем ручной работой которые необходимо будет разгребать и он будет тем меньше чем лучше мы сделаем мониторинг этих сущностей резюмируя по вот этому кейсом рекомендации которая стоит сделать такой ситуации которых придерживаться если у вас будет необходимость реализовывать такая однонаправленная функционал в рамках шаг и путь по другому его никак не реализовать первое сделаете мониторинг мониторинг сагах он не очень каноничный то есть сага как минимум однонаправленная нами три состояния то есть в лит-ре говорит и секс с то есть секс с это зеленый прогон то есть оно полностью прошла сама без никаких проблем recovered это соответственно сага которая прошла после ретро им да то есть у нас был сбой и соответственно file to the saga которая даже после smart retrieve на попала в хранилище и мы с ней имеем дело вручную соответственно если вы клементи руи тьi такой функционал убедитесь выйдем патент насти шагов которые участвуют саги это прям скажем mesh in critical по-другому она работать вообще не будет вроде такая капитанская как бы рекомендация однако как показывает практика на нее можно напороться весьма просты и соответственно для сокращения объемов ручной работы которая скапливается в согаз тораджа поверенных сак имплементация механизм smart retrieve на стороне сага экзекьютора и так трейдов этой истории если у вас есть одна сторонняя сага то вы в любом случае получаете какой-то объем ручной работы так как сага является полностью или частично не откатывали это трейдов на которой мы идем имплементировать такой функционал в рамках сак если вас это так сказать ситуация не устраивает вы можете попробовать реализовать этот функционал каким то другим образом микро сервисным микро сервисной среде хоть он your own вот такой интересненький кейсом следующем кейсом который имеет смысл поделиться это кейс как ни странно разработки полноценные обычной саги который имеет вот такой вид абсолютно полноценная сага с прямыми компенсирующим и транзакциями в ней состоит там два и более шагов абсолютно каноничная штука то есть вот этот кейс мне кажется наиболее интересен с точки зрения чистоты его использования в разработке и так вот наш сага мы опять используем графическую сагу вот у нее зеленый прогон есть абсолютно такой же успешный компенсирующий врагом присели пятого шага что происходит она выполняется выполняется работает компенсирующие цепочки у нас отрабатывает мы видим мониторингах по филины исчадию recovered саги recover files оги секс с саги все хорошо и это может продолжаться достаточно долго но происходит breakin чингиз на сервисе номер 3 и после ломаешь его изменения перестает работать компенсирующий in point плохая ситуация здесь в том что на эту сагу в штатном режиме работы это не влияет абсолютно никак и мы можем узнать о ломающим изменение через день-два-три неделю и даже через 2 недели после того как они были сделаны и после них было еще 2-5 релизов этого же сервиса то есть найти такой ломающей извинением может быть сложно еще сложнее его потом исправить 1 к чему это приводит приводит это к тому что мы просто не можем откатить саду при том что в кейсах которые стоят до 3 шага то есть например кейсы когда у нас выльется шаг номер два вот этот вот мы абсолютно нормально откатывает у совы видим что она отлично отрабатывает и механизм сак у нас на бэг-энде работают нормально вот такой вот не очень хороший кейс если это сага на стадии компенсации феликса мы попадаем в кейс номер один когда по сути у нас получается односторонние сага которую мы завершить успешно или успешно откатить не можем то есть сага как такого не выполняет свою функцию что с этим можно делать ну во-первых до складирование в сторож по failing сак полноценных сайт происходит по такому же пути потому что мы возвращаемся к кисть номер один в нашем случае файл был в том что не были разработаны тесты на компенсирующие инфанта и на прямые ребята торопились и один из способов сделать разработку быстрее естественно пожертвовать какое-то количество тестов такое случается и все мы так делали да какие варианты так сказать тестирования так я могу предложить первое это классический описанный тест который ну все мы знаем как писать и наверное никакого интереса сильно он не представляет другой интерес представляет например генерация псевдо сак это генеративный подход к проверке сак это не тест эта проверка ее работоспособности каждый момент времени как та штука выглядит выглядит она примерно следующим образом вот у нас есть работает вот у нас есть наша замечательная на регистрационная сага и мы видим что у нее есть компенсирующие пути вот они да что-то тут извините с телевизором нет а вот они да так там видно отлично мы прибегаем к парсинг усаги как сущности и мы генерируем по ней просто пути ее обхода по сути то есть поступаем с ней как с графом в этом получаем мы не получаем тесты но мы получаем саги с всеми возможными путями и исполнения соответственно затрагивают все in point и которые в ней участвуют даже компенсирующие прогоняя такие псевдо саги перед релизом мы проверяем работоспособность каждый конкретные шаги в чем здесь как бы плюсы и минусы плюс это то что генерация псевдо саках это чуток дешевле чем разработка тестов на отдельные inpinto это плюс трейдов этой штуки то что нам нужно будет где-то реализовать механизм создания пейлоуда до который мы будем включать в каждой список который будет про гоняться ну и нам нужен какой-то reporting чтобы понять был секс с м то есть какой то опыт по выполнению этих псевдо так вот такая необычная и интересная штука и так вот этот такой каноничный кейс что какой какую ценность из него можно извлечь первая и самая капитанская то что опять сага едим патентная реализации in point of участвующих в ней этом островная штука второе компенсирующие шаги в саге в принципе это позитивный сценарий работы то есть это не что-то иди шенол или какой-то failover которого можно которой можно не делать это обязательный функционал как для разработки так и для тестирования самый ценный point здесь это то что мы из вот этого кейса выяснили следующую штуку что тесты на компенсирующие and point in a concept на на компенсирующие транзакции они носят куда большее значение чем даже тесты на прямые инвайты которые реализуют основную логику функционала и риса ги почему так потому что в случае файла саги механизм наш сагой бизе cutter запустит компенсирующую цепочку и приведет систему все-таки консистентные состояние и мы сможем например с этим сбоем что-то сделать то есть у нас будет консистентной рабочая система мы будем видеть файлы так что у нас идет с access recovery рост мониторинге да и мы должны смотреть бежать смотреть что у нас там с конкретным шагам происходит вот но работоспособность компенсирующих имплантов она просто прям супер мишин критику вот и даже важнее чем тесты на прямым point это такая вот такой вот наблюдение интересно ну естественно мониторинг мониторинг в сагах он такой необычный для полноценных саката четыре состояния которые нужно прыгать field recovered file когда у нас ведь как раз падение на цепочке компенсации это recovered компенсация успешная но и просто секс с ул это прямой пробор вот такие интересные наблюдения то что имеет смысла вывести из этого кейса следующий кейс случился с одним моим другом евгением пор не будем называть его фамилию мы столкнулись с реализации в рамках сак достаточно большого функционалом который туда так массивнее к запрыгнул и там поселился что об этом кейсе имеет смысл рассказать почему царь сага да как мы и полом обозвали является таким ну весьма сомнительным решением и такими штуками лучше дела не иметь 1 чем характеризуется царь сага это огромный размер функционала который в нее входит на примере слайда это там десятки и десятки десятке шагов для сак это не нормально что из этого следует в рамках микро сервисные среды выполнения каждого шага саги имеет какую то вероятность файла соответственно выполнение 50 шагов вместе с результатом успешно она начинает от вероятностей единицы стремительно пикировать как сбитый бомбардировщик если мы это переносим на highload продукт и через область вызова этой саги становится как бы 10-15-20 1000 rpm то это приводит прям скажем к совсем анти успеху это перестает работать вообще что касается проверки царь шаги здесь становится все интереснее и я бы здесь дал просто заметку что генеративный подход с генерацией псевдо сак он здесь будет работать весьма скверном так как с линейным ростом количества вот здесь вот линейный рост синенький графинчик in рост количества шара шагов сонет плюс не линейный рост времени проведении тестирования и за нелинейного количество infant в которые нам нужно выполнить на так сказать на каждый путь который мы сгенерили в саге на это это из-за компенсирующих путей они очень сильно увеличивают длительность тестирования вот здесь вот пример приведен пример когда у нас вот есть 19 шагов саги это x минут соответственно двадцать семь шагов саги мы прибавили восемь шагов то есть увеличили саду на 40 процентов время тестирование увеличивается в два раза то есть несложно постелите слитном доске или до 50 то это время возрастет в 8 раз но и в конце концов это замедлит разработку как минимум поэтому в случае работы с сагой лучше имплементировать честные тесты на инфуин ты в саге они будут работать и быстрее и не будут замедлять разработку возможно это будет чуть чуть дороже с точки зрения трудозатрат на саму разработку тестирование будет вести быстрее и релиза выполнять скорее что нужно из этого кейса вынести такие самые наверно значимые штуки что первое не делайте царь сак если вы вдруг столкнулись с этой с такой необходимостью и вам не знаю продукт не важно кто сует в имплементацию вот такой затененные функционал который вот а либо весь выполняется либо весь не выполняется и так далее то лучше подходов с этой штукой отработать так чтобы оно в принципе не появилась если это все таки не получается с доджить мы там не знаю уходили в отпуска на празднике на больничные но она нас все равно настигла та следующих поинтов стоит придерживаться значит стоит посмотреть на эту сову и посмотреть можно ли ее разбить без потери так сказать consistent насти данных на саги меньшего размера то есть если у вас есть советом двадцать шагов или тридцать шагов попробуйте побить на три шаги по десять шагов это будет сильно стабильней если это конечно концептуально можно сделать если например у вас есть саги и вы думаете что они большие как их за детектив но из опыта могу сказать что эти шаги обладают размером в 20 и более шагов вот мой собственный друг который имел дело с этой соли и еще один который мы помогал у них более радикальное мнение относительно больших сак то что сага вообще не должна превышать 5 шагов если в саге там больше пяти шагов десять шагов выжег а это фигня короче ну вот ее нужно там прибить как-нибудь или выкинуть как-то друг по-другому имплементировать этот функционал но я наверно не так радикально отношусь к этому наверное они все или больше более чем я с этим но двадцать шагов это уже тот момент когда усаги начинает прорезаться вот этот корона который нужно отпилить и так реализация компенсирующих шагов если у вас дернется палец в таком кейсе не реализовать компенсирующий шаг я думаю что поможет как только это большевистском пони и в общем обязательно имплементировать и компенсирующие шаги количество проверок если у вас есть вот такая царь сага количество тестов минимально обеспечивающих ее работоспособность равно количество шагов то есть это количество транзакций минус 1 плюс happy пас вот меньшим количеством тестов проверить работоспособность этой саги не представляется возможным проверить и если у вас есть такая сага вы используете механизм и в ней например 20 шагов от тестов 14 там точно чего-то не хватает ну и соответственно использовать при тестировании этой саги лучше использовать обычные песчаные тесты в перевес попытки делать генерации потому что чем больше сага тем будет быстрее увеличиваться длительность тестирование и вот такая штука интересная штука с которой тоже можно столкнуться при работе с сагами в повседневной жизни если вы каждый день там не знаю из принтов спринт реализуете на механизме со кк функционал то есть вы их постоянно пилите туда что-то постоянно попадает и саги там размером пять шесть семь восемь девять шагов постоянно является вашей такой работой интересный кейс начинают болеть от того как имп лимитирован сам механизм описание этой саги если посмотреть на презентацию в ней всегда есть вот такая пирамидальная структура и если сага так сказать адекватного размера три четыре пять шагов а это пирамидка она не вызывает никакой боли нам ну подумаешь 4 шага к ним еще три пути описать да ничего страшного на пять шагов тоже ничего страшного если постелить эту штуку хотя бы до 8 9 шагов на слайд уже не поместилась но человеческий фактор и вероятность допущения ошибки при описании компенсирующих цепочек она возрастает и вы фактически волей-неволей nafa копить и что с этим делать уникальных сущностей в саге так много их две прямые транзакции компенсирующие все это в принципе все что минимальный набор данных который описывает само-построение вот этих цепочек она не обязательно должна быть имплементировать именно в структуре самой саги его можно делегировать на уровень сага экзекьютора то есть ага экзекутус щитовая сагу работая с ней например это артист рациона и сага присели там пятого шага она сама строит компенсирующую цепочку из того по его докладу нас есть саги то есть этот механизм можно убрать и мы сократим трудозатраты но это имеет смысл только если у вас работа с шагами идет такая достаточно с хорошей периодичностью и саги у вас такого ну скажем так хорошего среднего размера то есть на сагах три четыре пять шагов это вообще не имеет смысла то есть они и так нормально пирамидки описываются и так хорошо работает и в поддержке там особо не накосячишь вот такая штука крупными мазками подводя итог по сказанному первое на чтобы я обратил внимание при работе с сагами это на быстрый мониторинг так как при работе с сагами mesh in critical отреагировать быстро на сбой так как в кейсах когда sagopa филина или состоянии recovery файл когда он с компенсирующая цепочка пав елена у нас начинает копиться объем ручной работы то есть тесс и которые то есть мы уже получили какой-то объем не консистентных данных и нам их нужно будет каким-то образом разгрести и чем быстрее мы на это реагируем и чем быстрее мы это пофиксим тем меньше ручной работы у нас будет тем меньше экспедит of вы получите в спринт и тем меньше у вас будет скол дроп на двухнедельной итерации лика и вас там генерации второй point весьма существенные царь саги крупные саги это антипа там на мой взгляд эта штука которую стоит избегать и соответственно если вы видите такую сагу там ну хотя бы двадцать шагов до там и более или там приближенные 20 попробуйте избежать попробуйте и раздолбить на куски но без потери консистентной седаны да так чтобы она все-таки разъехалась там на меньшие кусочки если все-таки придется такую штуку под давлением так сказать чем-либо давлением имплементировать то позаботьтесь о тестах на компенсирующий транзакций мониторинге по части ван вайс ок это такое тоже не очень хороший кейс однако весьма вероятный весьма живой с точки зрения концепции реализации функционала в разных системах он может попасться и может попадаться там ну где-то каждый десятый раз вполне себе и для него важны несколько штук 1 мониторинг второе это механизм retrieve чтобы сократить объем ручной работы 3 иди патентной сериализации шагов саги до шага sony следующая штука которую нужно подсветить и запомнить из вот этих кейсов под полноценным шагом это то что тесты на компенсирующим поинты в мире сак это первый приоритет над тестами на прямые напрямую реализацию окна прямые транзакции вот такой небольшой парадокс однако это так и они являются прямо mesh in critical для работоспособности механизма сакке самой саги в рамках микро сервисный архитектура мы соответственно такой небольшой довесок из лисок у вас много или вы дети что их будет много то есть это будет вашим вашей повседневной работы в вашем ваши давностью то имеет смысл посмотреть на структуру и и записью можно оптимизировать вот то есть реализовать на стороне сага экзекьютора механизм построения компенсирующих цепочек и сага станет компактный ну однако это лишнее приседания и если вы видите что у вас саги 34 шагом 5 не более то он будет ну наверно немножко избыточно вот такой вот у нас опыт накопился за полтора года давайте вопрос 1 1 1 2 3 спасибо огромное за доклад вот тебе официальный депозит благодарность от оргкомитета и еще нашу шер подарок если ты любишь куда-то ездишь сюда с собой удобную взять много мелочей спасибо да ребята вопрос поднимайте руки 1 рука 2 рука и даже я еще одну вижу прям спасибо за доклад отыскали вас много сак и как вы описываете сама машина состоянии так вот это какой-то метаязык dsl спасибо следующий вопрос правит а вот вы сказали про рациональные формы записи салям ближе к тебе микрофон слышно меня про рациональной формы записи со к какие вы видите формы рациональные вот поскольку сага это описание какого-то бизнес-процесса есть такие формы записи как bpm диаграмма используя ли вы их едите ли вы код на их основе нет мы их не использовать а как а как описывает что такое рациональная форма записи остановился смотрите вот если ходе писать постоянно у такие штуки просто копипаста это шанс накосячить и все если сделать делегировать на совбезе кьютер построение компенсирующих цепочек это похоже чем то на молодость и стинг то у вас просто немножко уменьшается количество рисков которые связаны со съемом фактором и все ну то есть рациональность записи она заключается в том что мы ограничиваемся в саге за описанием только всех необходимых частей а логику того как работать с этими частями мы выносим фарса газе cutter не знаю ответил ли я на вопрос зачем и bpm не используем вообще какой stack технологий как вы на чем реализовывать может быть какие то у вас есть решение полу коробочные там и найти есть команду например насколько я знаю у нас саги нога коробочных решений нас никаких нету то есть мы сами писали эту имплементацию вопросами пишет сервисами там его описываете на как то может быть вы с аналитиками вот процесс этот когда вы общаетесь с аналитиками вы просто им как вы получаете описание этой саги как вы их транслируйте в код процесс интересен но мы работаем в рамках и джейла аналитики у нас работают по большей части с продуктами мы с аналитиками взаимодействием не по вопросам реализации кого-то бизнес процесс обычно я все-таки какие-то метрики какие-то анализ результатов абэ тестов и так далее то есть у нас не нас взаимодействие с аналитиками какого именно дмитрий мне кажется таким количеством вопросов можно учил учебный курс дела про дочери очень подробный вот слева от тебя у нас будет несколько вопросов от роста входить здравствуйте спасибо за доклад мой вопрос правда уже задали вот в той пачки вопросов я придумал другой а вы не пробовали может быть помимо процессу написания сак может быть имеет смысл как-то подвигать состояние между сервисом чтобы сделать изменение состояния в рамках эти транзакции какой-то одной ну скажем так как альтернатива именно написанию за как там из двадцати шагов но как бы это сделан я да ну друг может быть думал об этом нет как но уверен что они много чего делали с особенно при реализации царь саги и пили лет функционал насколько я помню это откалывали какой-то достаточно крупный кусок монолита который просто так раздолбать более приятной форме за вменяемый срок не было возможностей и он лег вот таким в таком виде в сагу вот уверен что ребята там замороченные они пытались сделать разные варианты решения наверное да это один из способов сократить количество шагов или как-то передвинуть что спасибо здравствуйте спасибо за доклад короткий вопрос скажите пожалуйста какими инструментами вы тестируете саги значит есть два способа про которые я рассказал и есть еще подход сидиси тестирования то есть сага у нас реализация саги она сделана виде сервиса а соответственно продюсер из шагов саги это относительно сервиса сак это провайдера здесь может ну то есть здесь может сработать использование сидиси тестов для проверки шагов знакомы с концепцией консьюмер берем контракт вот вполне себе рабочий вариант спасибо еще просто вот отсюда где я стою здрасьте спасибо за доклад у меня два вопроса один вопрос такой я правильно понимаю что для того чтобы реализовать компенсирующие api методы в сервисах сервис должен по сути хранить все вот эти вот операции которые в нем были выполнены потому что компенсирующий операции сигнал типа отмени операцию сойди таким-то и сервис должен помнить о какой был и предыдущее состояние этой сущности да и других вариант но как бы то есть экзекьютора не хранит в себе там вот эти вот предыдущие следующие состояния это именно ответственность каждого сервиса это делать ну да странно но тогда со вопроса экзекутор сакон становится каким то супер мозга в нашей микро сервисной среды и до каких пор это хранится до бесконечности или как-то сервис понимает что вот эти вот предыдущие стая ненужные может их почистить вот честно говоря то как в кишках реализованы и компенсирующие транзакции в сагах на стороне с этих продюсеров сервисов продюсеров suck each на гарене расскажу можно дойти в нашу экспертную зону около 100 мне стенд авито и там есть наши ваш ники и я не знаю там ребята которые сервисом сак занимаются там сейчас там или нет и как бы прямо-таки и кишки поспрашивать у них и второй такой вопрос я правильно понимаю что в целом сага выполняется ну как бы фоновом режиме то есть изначально как бы этот инициатор он ее запушил в экзекутор и пошел что-то дальше делать а на фоне выполняется при этом может откатиться а тот кто запушил не знает об этом да я вначале вот наверное вот это не сказал сагана асинхронная штука то есть вот в нашей реализации у нас есть сервис дамы у него делегируем выполнение типа выполнила нам такую сагу и мы про это забываем дальше он нам просто а если он и и откатиться как а этот в профит ведь и тому кто запушил сагу нужно чтобы это выполнилась если он ее откатит он об этом сообщит сервису авнер усаги и на стороне сервиса у него саги должно быть обработка этих событий он должен понять и пока окей я не смог не знаю применить какую-то платную услугу к объявлению на авито что я типа делаю я говорю пользователю там либо делаю фидбэк либо делаю дополнительные запрос на выполнение этой саги дальше там либо по результатам состояние монеты саги принимается какое-то решение спасибо следующая просто ровно напротив тебя здравствуйте спасибо за доклад меня интересует вопрос валидации в целом в системе саги грубо говоря вот у нас есть 5 задач в разных сервисов и у каждого например у нас там есть uniq найма или еще какие-то такие вот примитивное задачи на которые могут быть могут отработать а может нет и нам надо именно валида ценный ответ как вообще в таких случаях работать с сагой и или лучше просто отказаться от валидация вообще запроса и ждать файлов на стороне хороший вопрос я не помню что она сага была реализована функция валидации изменение состояния то есть сервис продюсер должен гарантировать то что если он ответил об значит он реально uk ну вот то есть мы основываемся на такой парадигме но ведь мы можем прислать какие то данные которые заведомо сервис не сможет записать такой цель прислал какую-то иру если извинись и он на на запрос каким-то поил одам отвечает ошибкой значит у нас поселилась транзакций мы запускаем компенсирующую цепочку ну это получается без водицы он запросто есть ну я понял ваш ответ еще вопрос такой вот по царь саги скажите если двадцать шагов царь шаги возможно проблемы уже в самой микро сервисной архитектуре и там уже какие-то паторны равиоли нарисовался нет конкретно этот кейс он связан с распилом монолита то есть шаги для чего нужен в микро сервисном мире это первое для реализации транзакционный функционал транзакционный семантикой второе чем многие из нас сейчас занимается это для распила монолита что мы можем какие-то достаточно жирные куски монолита отпиливать оставлять их в виде реализации сад а дальше распиливать ее на какие-то куски которые дальше могут вообще либо раствориться в очень выползти из от вообще или дальше раздробить а уже на маленькие шаги то есть если у нас типа from scratch микро сервисной архитектура и появляется sores царь сага это что-то не то если царь саги появляется в контексте распила монолита это вполне нормальная история просто с ней нужно достаточно аккуратно работать я к тому что возможно во время распила монолита было неправильно выделено домен зона но да если мы монолиты доменная модель мне кажется здесь нет просят ответить без конкретики то есть надо за запиливать в нужный вновь проект чтобы видеть что там так или не так то есть абстракция годами не знаю как бы да правда доменная модель если есть не там пока варятся на в этом кейсе может помочь но может и не помочь . мы можем увидеть что блин ты как бы как тут ни крути ну вот нужно будет у так сделать давайте послушаем ещё вопросы у нас есть уже человек с микрофоном спасибо больше за доклад очень приятно слышите что позитивный человек так спокойно при рассказывает истории своих друзей то есть степень зрелости во vita использованию икра сервисов уже достаточно ну как выглядит очень круто просто наверное немножечко рядышком вот все привыкли говорить что микро сервисной архитектура требует того чтобы там где вовсе были качественные лучше там и разработчики буду более квалифицированы а что насчет ну как бы quality да вот я так понимаю что твой рассказ о нам больше всего как бы с позиции quality и кто-то опыта который вы огребли непосредственно на тестирование прочего вот как оцениваешь насколько квалификация тестировщика для того чтобы все это поднять посмотреть она нужно больше меньше или или вообще все то же самое значит первое если бы этой поднял не я то есть я просто ковырялся значит сбоях я работаю с нашими инцидентами взрывами и часть из них происходили по вине именно вот этих реализаций вот и они были красочными с фейерверками и хлопушками и днями устранения вот этих колбас поверенных сак естественно для работы как бы с кишками и реализации бэг-энда нужна какая-то как бы техническая подкованности на мой взгляд как бы херов щик уже так сказать давно это не должен быть тестировщик который вот сидит и тестирует ну то есть руками это инженер с высокой компетенции в области тестирования но это такой как бы программист ну вот точки зрения сложности тестирования здесь вообще нет никаких сложностей то есть на самом деле здесь атомарные сущности это один and point но максим что ты на него сделаешь я сделаю наверно datasette на один тест который будет генерить позитивный негативный boundary сценарий если уж говорить про тестированием поэт и ответил на вопросы ну то есть просто считается что как бы тестировщик в вашем понимании водительском понимании это человек который и проинспектирует код как бы да и ты прежде всего инженера не просто запустит там какой-то сценарий напишет тогда действительно конечно просто и в конце концов как бы у нас девелоперы тестируют еще такого удивил пиро занимается регресса мобильных приложений ничего как бы не обсохло у них ничего deux пошли дает пример да нету того будете тестирования относительно devops а блин а что там я его я его узнал спасибо ну в общем считаем что примерно такая же квалификации нужно что все это тестить со всеми этими веточками и компенсации вообще говоря вот эти тесты должен писать девелопер на стадии имплементации сагида как фичи это достаточно невского уровневый тест это юнита пятиста их делает devil 1 но там то есть какие проблемы у нас даже системной тесте пишут девелоперы вот но здесь ахнула реализует девелопер 100 херов щекам они садятся как бы перикла барышня смотрят на альфа-версию реализации как бы функционалу там фиксит баги дальше как бы products in тестирование в продакшен спасибо я надеюсь что еще два человека из того же сектор успеют задать вопросы на верхнем ряду здрасте я не очень понял про скутер скажи пожалуйста в итоге он вас хранит какой то стоит то есть вопрос о том у вас есть слова из пяти транзакций на 3 транзакции вы переплыли свой сага компьютер секрету что в этом случае произойдет у то есть у вас не знаю поменялся код потом мы решили сакаи скутер добавить еще один степ что произойдет хороший вопрос честно говоря я не знаю как он перри тепло и вается скорее всего происходит переключение ну то есть новые саги идут на новый институт сервиса с новой версии а старые сагида делают старый то есть это именно болгарин все дела свечи то есть до дает выполнить текущей там работал на уровне таком окей тогда еще такой вопрос состоит в итоге он хранит или нет что сага газики утром сага экзекутор для оркестра ционных сак стоит самой саги он сохраняется лучше вообще в любом случае то есть прошла сага не прошла ios там какой-то request айди и от внешнего как сервиса сагалова да это все хранится это мой все сохраняем это не стоит то есть мы храним стоит саги типа где она там застряла или все-таки она полностью выполнилась а все остальное это как бы сервисы провайдера у которого есть каждого свой стоишь где хранится уже конкретно бизнес сущности и такой будущем я бы хотел дать возможность еще 1 человек потому что у нас со временем интересный вопрос давай спасибо вопрос о том что вы делаете в случае если у вас есть параллель и выполняет ваш запрос то есть например я взял создал объявление и тут же понял что у меня есть ошибка и там сага состоит из n шагов и в какой-то момент нам например летом нужно сходить в отдельный сервис рамка х 2 саги и он чуть дольше ответил чем предыдущая сага то есть таком случайную больно проблем но в таком случае если у нас есть колледжем выполнение сак либо не обязателен и моих компенсируем либо они зависнут и мы будем иметь с ними ручное так сказать поработаем с ними руками то есть не проезжать никакой перри затирки то есть об этом есть вы изменили вас было объявление вы написали что вы иван а потом а я ж не ванги же игроки быстро взяли изменили 1 иван пошел по своим стопам потом вы изменили томас просто поселиться если у нас выполнение то есть последователь вполне нее со как-то забирала пелось та та которая будет 2 да она просто поселиться и мы будем иметь дело с по вселенной сага она либо компенсируется да у нас отработает компенсирующая цепочка либо мы скажем мы не можем компенсировать эта штука уже пойдет на ручной разбор давайте попробуем очередной просто привет ну у меня два коротких вопроса первый вопрос если какой-то в общей рецепт как выбрать между хореографией или регистрацией и второй вопрос возникают ли в саге проблемы с узкими горлышками или наоборот повышенной фоновой нагрузкой потому что децентрализованной процесс как получается смотрите по части спасибо нагрузки и децентрализации на эту тему у кости и в тех делал доклад на сибирском холоде можно поискать просто его доклад и он рассказывал именно про имплементацию самого сага экзекьютора нашего вот там он раскрывает в подробностях как мы все это сделали вот относительно способа реализации саги и смешанный хореографический раз конструкционный это зависит от функционала если шаге от вас есть какая-то цепочка если у вас шаги друг на друга за приди церовани это явная регистрационная сага есть и шаги могут выполняться параллельно вне зависимости друг от друга отправляя ивенты там через шину данных об успешности выполнения шага до соответственно это хореографическая сама то есть это функционал хореографического такого характера вот но и смешанные то есть здесь нужно смотреть на бизнес-логику того что вы реализуете вот как друзья и я верю что вы не удовлетворились этой сессии вопрос в ответ я прошу дмитрия еще побыть за пределами зала после окончания доклада сможете ты выбрать этот вопрос который больше сети понравился мне понравился вопрос про overlapping сак вот правда товарищ который вызывал похоже ушел ура у нас будет книжкой и крышкой вот здесь был тоже вопросы вижу там угощать тоже ушел я уже не помню про что он был но такой мощный мощный вопрос два мощных вопроса и не а помимо нас настолько уверенно себе ждущий ну что ж достается зрителям онлайн и priest спасибо огромное еще раз дмитрий спасибо всем вам"
}