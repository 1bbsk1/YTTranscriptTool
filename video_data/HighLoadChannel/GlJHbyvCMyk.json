{
  "video_id": "GlJHbyvCMyk",
  "channel": "HighLoadChannel",
  "title": "njs - родной JavaScript-скриптинг в nginx / Дмитрий Волынцев (Nginx, Inc.)",
  "views": 4954,
  "duration": 2866,
  "published": "2019-05-07T13:24:59-07:00",
  "text": "с если новые с а свои хендлеры для обработки различных стадий и запросы на языке java script совсем коротко обо мне меня зовут волос и дмитрий я работаю в компании jeunesse 2015 года за это время я уже успел поработать над самим в обсе роман дженкс в частности во open source версии и платной версии которые мы делаем для наших клиентов которые называются engine x плюс с 2017 года я активно занимаюсь вот проектом который я сегодня буду рассказывать итак приступим перед тем как я буду рассказывать о докладами что пробегусь по по его структуре о чём я буду говорить вначале я расскажу вообще зачем в принципе нужен скриптинг манжете зачем вам понадобился что что нам не хватает и что нам нужно дальше в рамках этого же вопроса и рамках этого пункта я пробегусь по тому что они так tab a200 и почему мы хотим знать что то что то лучше чем окон расти и как ты с этим не связываться во второй части я расскажу про какие у нас есть цель и что мы вообще пытаемся сделать и что не пытаемся в третьей части я расскажу немножко про сам интерпретатора java скрипта котором и пишем специально для нашего observers 4 части я немножко покажу очень какие-то простые примеры как уже сейчас можно использовать anges продакшене мы уже это используем и нашим клиентам предлагаем и закончу я свой рассказ слайдам про планы где какие у нас ближайший план на ближайшем будущем итак давайте вообще подумаем зачем в принципе еще что должен уметь современный прокси-сервер нам за что мы все любим gemix да это все такие стандартные вещи как балансировка нагрузки этой власти аминирование отдача статики и каширования все такие вещи что унижен x уже давно умеет однако уже в 2019 году и в последнее время в кендо на становится гораздо более такие нашор см и разнообразные если раньше вы там вас было несколько там каких-то крупных приложений на питон там php или в чем-то еще и внутри индекса вы могли написать просто несколько каких-то прокси посла кечинов к вашим брендом то сейчас ситуация немножко усложняется теперь бэг-энда у вас становится такие более разношерстные в прихода микро сервисных текстуры и вас фильм большое количество может быть маленьких микро сервисов и вас стоит это вопрос что стоит что вам стоит предпринять потому что либо вы должны как-то вот логику авторизации реплицировать каждого этих микро сервисов либо мы приходим к такому термин который называется опять готвальда это когда когда прокси-сервера становится не просто такой трубой который делает только у те вещи которые перед этим рассказал но еще в том числе занимается авторизация что проиллюстрировать вообще принципе что какая функциональность вам может потребоваться от и нужны часто в этом месте я хочу рассказать немножко про такой механизм авторизации которым нравится о канаде connect и в рамках этого в рамках этого механизма мы авторизуемся из отеля в две стадии то есть сам яндекс он просто проверяет какой-то специальный talking который выдал часто частности например может быть живет это кен и если пользователи это вот та кино не имеет он перенаправляет он специальный сервис который называется wind эти провайдер который уже сама в каким-то образом в разным способам может авторизовать пользователя по разным каким-то критериям и после этого пользователь снова возвращается к нам на яндекс яндекс дополнительно тот момент когда пользователь в него пришел он идет и проверяя что у этого и т.п. то тот и тот самый talkin' который ему прислал этот пользователь и после этого дает внутренней какой-то токен частности например можете тут же в этот токен и после этого уже клиент ходит к вам на ваши на ваши бэг-энда и на ваши микро сервисы уже ходит уже авторизованы то есть уже эту проблему решать не нужно что здесь какие альтернативы здесь вообще возможны можно написать какой то модуль на языке си до но довольно таки это не то реальная задача даже если вы вообще программист на языке си потому что мало того что вам нужно хорошо вообще уметь писать на языке на котором очень легко выстроить где много кроме этого вам нужно также очень хорошо разбираться в самом веб-сервер engine.exe это скажем так и чтобы стать хорошим модуль это надо знать примерно половину юджин x на самом деле чтобы ничего не сломать вот и получается либо мы подобны логику делаем делаем на языке вот так он низкого уровня мyзыки это достаточно трудоемка и расскажем такой термин error трон тогда как мы хотим вам дать в руки такой механизм более высоко воронью механизм где бы вы могли какую-то свою конкретную логику в частности подобные допустим логика могли нарисовать бы на языке более высокого уровня вот до альтернативу написание модули на языке си то есть crippling вам дает возможность какую-то высоко вор не логику писать не залезая внутренности индекс хорошо следующий пункт что не так sold in рейс до для тех кто не знает вообще как между собой связаны яндекс и опен-рейз то есть эта команда небольшая команда которую мы разрабатываем машины уже довольно давно там нет они сколько всего лишь человек мы пишем ядро чем эту игру открытая подберите лицензии и есть еще вообще отдельный проект который называется об интересе это вообще люди сторонний там начинал несколько людей из китая сейчас они переехали открыли компанию в в америке проблема в том что мы до с одной стороны можно сказать что вы пытаетесь делать похоже что уже есть до проблема в том что в философию который мы применяем к разработке самого индексом и в частности философию того что все директивы которые можете использовать это такие кирпичики которые между собой очень хорошо сочетается то есть вы можете их и них строить такие большие конструкции вас все это хорошо работает тогда как на привело к нарезке у вас есть большое количество таких ithaca решений вот у них возникла какая-то задача там что-то решить окей вот те специальные директиву тебе для этого сцене директивы в итоге что вообще написать какой-то хороший код или точнее хорошее приложение на с использованием окон расти вам нужно очень хорошо разбираться с огромным количеством директив который есть вы понравитесь это первое и второе это то что они не всегда сочетаются потому что мы знаем как этот код написан он же открыт и мы видим что какая-то они используют допустим утренний структура engine.exe и нам на нас это не устраивает не то что бы я сильно против подрасти это в принципе очень хороший проект я думаю и многие пользуются вместо вместо ванильного engine.exe однако мы хотим сделать что-то свое следующий минус который можно отметить все compadre se это то что там используются виртуальная машина но и вам самый неожиданный момент может выставить такое ограничение что даже наши три битных машинах у вас есть всего лишь 3 гигабайта вообще памяти для всех общий объект of которые выполняются данном маркере engine.exe то есть вполне тебе спичечную ситуация что ордер engine.exe вы можете иметь там десятки тысяч соединений там секунду если вы напишите какую то нетривиальные логику с использованием lua и там создадите тем чуть большее количество объектов самый неожиданный момент когда у вас самая большая нагрузка вам все это может выстрелить очень больно дальше следующий пункт это про сам язык опять и понятно что здесь очень большая доля субъективизма как каждый пишет как он на том языке на котором нравится и ничего против этого не имею однако здесь я рассказываю про мотивы которые нас мотивирует первый пункт это то что узкая ниша то есть язык он достаточно нишевый когда посмотрел по популярности языков это пример 29 место следующий пункт это синтаксис да опять таки можно к этому очень долго придираться играет какая-то мелочь не мелочь но летом индексация массивов с единиц это довольно по крайне мере для меня очень необычно это так скажем так раздражать следующий пункт это то что язык написано всего было 2000 до примерно в середине 90-х и с того времени он не очень-то развивается что наверное и тогда еще еще есть причин почему бы мы не хотели написать взять и использовать язык lua и написать что-то своем и в том числе не хотим чтобы экосистема и наша экосистема принести engine x они как то пересекались просто у людей будет большое количество в голове непонимание что происходит итак после того как мы определились с нашим играм ну давайте определимся что вообще мы хотим сделать мы хотим дать вам высокоуровневые скриптинг вроде в руки чтобы вы могли писать какую-то свою кастомной логику поверх уже существующего web-сервер джон x 1 пункта популярны язык программирование мы не хотим там чтобы этом изучали какой-то очередной возможность много других делал чем вы собираетесь заниматься и поэтому не хотелось бы изобретать какой-то свой или брать какой-то довольно таки странный язык это конечно первый пункт под этот пункт попадает довольно-таки большое количество операторов которые можно было бы использовать например питон и какие то еще но проблема в следующие все мы любим и используем engine x всем людям за то что он есть частности джек это легкий и и быстрый прокси-сервер спокойно выдерживает нагрузки и десятки тысяч а там даже до сотни тысяч спокойно запада запросов в секунду вот и получается если мы собираемся использовать в внутри внутри нашего web-сервера какой-то интерпретатор то он должен быть хотя бы он не должен сильно замедлять замедлять самый джин xoчy если он мы можем возьмем какой-то какой-то навороченное большой крутой мне может быть красиво писать но engine x вас потратиться в тыкву перестанет быть на жизнь сам как бы нам получается такой интернет это тоже не подходит следующий пункт это безопасность и устойчивость мы очень внимательно относимся к написанию кода нажмите потому что мы понимаем что это веб-сервер который стоит на миллионах сайтов он стоит на страже вообще ваших брендов и получается любой проект который мы собираемся использовать метро engine.exe он должен соответствовать этим же требований кроме того большинство проблем большинства интерпретатор в сторонних стоит том что ты самый джинкс написан так что если там у вас на системе на на фронт-энд там сервере у вас там закончилась память в какой-то причине там временно to inject в этом месте не сломается он просто насчет означать пятисотке он умеет хорошо обрабатывать и ситуацию нехватки памяти проблема с любыми интерпретатором большинством от оператора в том что они вообще такой что от обработать не умеет и часто просто завершает вам с крыш им ваш процесс так как у вас в каждом worker индекса огромное количество соединений и там тысячи и десятки тысяч его возможно там и сразу затестим огромное количество пользователей что нам тоже не приемлемо хорошо теперь почему мы остановились на языке java script 1 пункта торы можно здесь отметить это то что язык очень по крайне риф 2019 году это очень полярные за коврами программирование даже если вы на нем не пишется наверняка вы его с ними как-то где-то сталкивались как минимум всем остатки с не в браузере видеть какие-то кусочки кода огромное количество туториалов интернете огромное количество реализации различных интерпретаторов в тому подобных вещей это все плюс следующий пункт это то что си подобный синтаксис опять-таки это возможно какой то чисто элемент субъективизма но конкретно нам есть вполне определенная задача в этом месте мы собираемся ближайшее время позволить вам писателям код на языке жалкой прям в конфигах конфигурационных файлах engine.exe в этом месте нам синтаксис с фигурными скобочками очень пригодится потому что нам это позволит а очень красивые контрационные файл exe следующий пункт это то что язык активно развивается для тех кто не в курсе там постоянно каждый год выходят различные новые обновления и за каждого скрипт он становится лучше он заимствует какие-то хорошие действительно хорошие идея оперативы оперативные не картины а просто хорошие идеи других языков программирования функциональных языков в том числе и это не может не радовать последний пункт здесь эта модель вообще языка то как работает java-script очень похоже на то как работает самого индекс то есть модель java скрипта стоит том что у вас есть просто какая-то очередь событий каждому событию привязана какой-то обработчик и эти обработчики никогда не блокируются ни в каком месте они в крайнем случае просто создают еще какие-то события вот это ровно то что как устроена сама yandex потому что чтобы обрабатывать там десятки тысяч людей ней в секунду в параллели без всяких трендов без всяких каких-то других механизмов нам именно нужно то такой же такой же механизм и мы его используем три жены ксенона и закиси поэта что как бы хочет отдать что-то поудобнее дальше тут самый интересный вопрос о чем еще понадобилось заниматься велосипеда строением наверх а есть большое количество и они они точные часы у них про низко расскажу интерпретатора уже существующих почему открытых подъезде лицензии можно все использовать с удовольствием сидела как casual казалось бы однако проблема в том что если мы возьмем самые популярные интерпретатор и в частности в 8 и spider-man это те этапе татары которые используются внутри браузеров chrome и firefox они не неэффективно для задач внутри яндекс что это значит вообще как какая типичная общей моделью исполнения каждый из этих интерпретаторов внутри браузера браузер вы имеете примерно там 10 20 30 вкладок может быть больше не важно но определенное небольшое количество в каждой вкладке вы имеете какой-то код причем этого кода в наше время может быть там несколько мегабайт а это вкладка может довольно таки долго там целые приложения и получается вам нужно очень большую мощную муж энергию для всего этого начала вам нужно так компилятор вам нужна мощная garbage collector вам нужна куча всякой машинерии чтобы вообще с этим справляться однако вы можете себе позволить открытии новой вкладки сделать там 0 одну секунду допустим сколько ты еще там старцева интерпретатора он может быть чуть более медленно и потому что принципе не так часто это и происходит на сервере мы имеем совершенно другую ситуацию мы мы имеем такую ситуацию что вам приходит огромное огромное количество запросов в секунду при этом код который у вас есть он обычно небольшой во вторых этот код вы можете заранее при компилировать и в-третьих такта и и в-третьих секундочку так до этих здесь нет хорошо св 80 пойду monkey разобрались давайте есть еще альтернативная такой интерпретатор называется так ты он как раз по ночам для того чтобы можно было бы просто именно при на чем для встраивания в виде зыкина в процессы на и на языке си си плюс плюс и нам годовых вещей однако к сожалению если вы найдете зайдете на сайт и наши меньше марки тоже показывают на сайт doctype то они вам скажут что реформа за них он не не самое главное для для нас в яндекс чтобы опять книжных состава лос-анджелеса он мог бы обрабатывать большое количество соединений в секунду нам также важно чтобы бы татар был быстрым потому что иначе engine x перестань быть engine.exe второй пункт здесь стоит отметить это то что сам так ты панар рисует только стандарт языка из 5.1 для тех кто не знает это и это стандарт номер 2009 года то есть это примерно уже 10 десятилетней давности современной женской программист уже давно не пишут на этой версии и не любит любит какие-то более новые механизмы которые появились в следующих версиях поэтому так ты к нам тоже не подходит и последний пункт который стоит отметить это то что опять-таки когда вам важно чтобы выжать максимум производительности как по памяти так и папа подписи пью то в этом месте то что у вас есть собственный татар вы можете его написать именно так чтобы он хорошо читался с тем как работает сам сам engine.exe сама ваших уст приложения в частности нам допустим важно чтобы опять кен нас важно допустим чтобы самый первый татар поднимался очень быстро потому что мы хотим создавать по мини интерпретатору на каждый запрос об этом расскажу чуть позже итак здесь я хочу также сказать отдельно уточнить чем джез не является это не отличный сервер то есть если вы хотите написать какое-то большое развернуто приложение то пожалуйста используйте но джеймс мы не собираемся делать новый год же с мы собираемся сделать так чтобы индексы стала более гибким остался индексом application server это другое если вам не хотите но джесс то есть например внутри нашей компании также развивается такой параметр называется нужны кью нет это можно так его назвать яндекс версия 20 это все самые плюшки которые есть в самом engine.exe в родном плюс возможность запускать про мои родные приложения там php руби и тому подобные вещи второй пункт здесь это полноценная ре зация стандартов то есть понятно что если бы вообще откроете спецификацию там языка и там тысячу страниц примерно и это очень тысячи человеко-часов если не десятки тысяч мы над этим работаем но мы в первую очередь как относимся к этому по по принципу парето да мы делаем первую очередь вещи которые наиболее актуальны они закрывают большую часть и вообще проблем и нужд которые нужны в принципе при написании кода для под яндекс хорошо вот мы определились с целями теперь давайте яичко расскажу почему сам же сработает быстро то есть он же интерпретатор первый пункт это то что мы экономим тем что мы заранее как при компилируем код при старте индекса дальше следующий пункт интересный которые нам позволяют тоже очень сильно экономит как как память так и и пью этот это специальный механизм когда у вас есть вот при старте вы запустили и создали какую-то интерпретатор с кодом которые вы изначально засунули дальше для каждого запроса мы создаем копию даже склона этой виртуальной машины причем этот кулон делается довольно-таки эффективно те вещи которые они не имеют обл они они перри используются то что они не копируются полностью например код который мы с компилировали он редон его можно переиспользовать какие-то внутренние объекты которые константных тоже можно переиспользовать тем самым мы во-первых время к экономим на том сколько мы вообще копируем памяти и также мы экономим время экономим в саму время самого время копирования опять-таки когда у вас десятки тысяч запросов секунду все это становится очень актуальным дальше следующий пункт это про отсутствие jit компиляция казалось бы такая крутая штука почему и вообще здесь именно в этом пункте про про скорость проблем лежит компиляции в том что первый пункт это если вы хотите создать свой какой-то же компилятор а яндекс работает под огромное количество платформ под десятки примерно то вам получается нужно написать им жить компилятор фактически под каждую платформу что еще более нельзя ничем написать свой интерпретатор следующий пункт так назад следующий пункт здесь же состоит в том что ваш код если вы код который находится на профи сервис тесно там нет никакого смысла вычислено не за вычислять число пи или какие то другие там математики заниматься потому что до этого есть и совершенно другие вещи скорее всего ваш код он будет такой более высокоуровневые код там сходи туда сделает а то там преобразует а и по нашим почем марком в этом месте а сейчас тут компиляции нет никакого пользу потому что этот код скорость все выполнения самого императора будет уже зависеть нет от самого кода а вот и сама он терпит отара от тех опять вызовов который будет этот интерпретатор делать а в частности он будет больше ориентироваться именно временем в исполнении допустим механизм внутри с моей жены кс в частности на такой механизм сам request он работает честно дольше чем вообще любой код но не любой но по-крайней мере гораздо больше чем средний кот на java скрипте который мы скомпилировать хорошо последний пункт самое интересное тоже это отсутствие сборки мусора во первых почему вторых зачем 1 и чем вообще может без этого обойтись потому что мы создаем маленькую виртуальную машину для каждого запроса она нам стоит очень дешево мы можем спокойно и большинство запросов которые у нас есть они они короткоживущие там какие то там в долю секунды получается за это время каждый этих виртуальных машин не создать большое большое количество объектов временных это позволяет нам во первых сильно экономить как память так и опять кесси пью потому что вообще продвинутый какой-то там garbage collector это такой тоже очень сложный механизм вам нужно либо там refers к усадьбе какие-то всевозможные структуру данных использовать чтобы потом ходить и собираете эти объекты поэтому для большинства вообще текущих задач который мы используем нгс этого достаточно понятно что есть ситуации когда вы можете этом может оказаться недостаточно потому что например там бы проектировать какой-то высоких на востоке на и соединение она может там существа и довольно-таки долго в этот момент это может неприятно выстрелить поэтому мы в ближайшие год-два собираемся добавить опционально сборка мусора имена для таких случаев но в целом для большинства для божества из кейсов для которых мы используем и типично используется и она же сейчас нами и нашими клиентами и джесс это этого этого достаточно чтобы показать чтобы показать вообще что может сделать что все что дает те те усилия которые мы попытались сделать что они дают давайте посмотрим этот график здесь я показываю сколько можно сделать пустых контекстов внутрь с использованием каждых из каждого zing аппликаторов прошу обратить внимание что здесь у нас график логарифмический это ним несколько раз а примерно на два на два порядка опять таки здесь нет никакой сильной магии просто в том что просто проблема в том что и 8 spider make any any них другая задача они там поднимают какую-то большую толстую машинерии понимают какие-то всевозможные сложные механизмы естественно это занимает большое количество времени тогда как внж см от этого можем все и бежать хорошо теперь перейдем к практическим часть практической части здесь я расскажу как уже сейчас можно использовать ндс уже готовы наши на нашем официальном сайте можно использовать уже выключить нашей базе торий под ubuntu можно поставить пакет который позволит вам загрузить динамический модуль дальше если вы не хотите никаких ставить пакеты просто посмотреть в принципе как же сработает вот по этой ссылке есть ноги т'хаб есть пример где можно запускать ндс докере и посмотреть принципе руками потыкать что там происходит как это работает примерно хорошо приступаем к уже к использованию же с на практике если вы поставили его из из пакета то первым делом так как это динамический модуля нужно его на загрузить при помощи дегтева lot more you дальше мы используем директиву джесс include который где в качестве первого аргумента мы передаем ей имя файла где будет ваш код на языке java скрипт написан и последнее директивы которые мы используем это называется джесс контент в качестве первый аргумент она принимает ими функции который будет вас должна будет отдать тело частности для этой директивы тело клиентского запрос и ответ хорошо осмотримся и направо у нас стандартная функция языке java script в качестве аргумента на принимает объект запроса которые это легкий обертка легковесной обертка которая привязана к текущему объекту request и внутрь engine.exe и мы используем стандартный метод который к нему привязан он очень похож на директиву return который есть внутри самого яндекса и отдаем просто тело hello world кодом 200 все очень просто дальше чуть чуть поинтереснее представим что опять качества для иллюстрации вам какой-то причине понадобилось проектировать проектировать какие-то запросы ваши ястреба кита на amazon так вот вот то что здесь написано 1 1 5 директив да это все абсолютно стандартные вещи которые есть внутри самого алекса и этого нам но этого нам не хватает потому что нам нужно сделать вычислить два вот таких федора интересных первое называется x amazon дейт там нужна нам в специальном формате вычислить будет текущую дату и во втором федры нужно будет вычислить специальной токен авторизации который называется где нужно подписать при помощи своего ключа тот путь которому собираетесь пойти чтобы нас вообще можем пустил как раз вот этого механизма ванильным engine.exe мне хватает нам получается здесь нужно использовать что-то сторонние итак мы здесь используем новые такие директивы называется которой dressed они нам позволяют просто создать на языке java script любую переменную которую мы потом собираемся использовать внутри самого engine.exe итак мы создаем две переменных смотрим что это за переменная 1 на уточним должна вернуть текущую дату специальном формате который amazon хочет не какого-то стандартного это не совсем не стандартная да то если вы на языке женское пишите вы в принципе можете быстро написать что-то похоже но опять-таки потому что используется все стандартные объект и здесь к java-script вы сможете быстро подобрать написать что-то похоже это первый переменная вторая переменная здесь мы должны вычислить вычислить подпись для нашего пути которые мы по которым мы пойдем получается вначале мы вычисляем переменную где будет то что мы собираемся подписать тот путь bucket потом в fps и потом мы используем встроенный уже в наш интерпретатор несколько модулей которые позволяют вам работать с хэшами например здесь мы при помощи очень похожим образом как это реализовано джесс мы создаем маг потом его и используем наш язык а вот секрет который мы уже указали бы в конкурсу на файле engine.exe подписываем преобразуем формату боишься 4 и возвращаем вот и все получается мы сделали тот самый head of the relation и и собственно получается amazonas насчет после этого пуска так следующий следующий пример тоже больше для иллюстрации представим что по какой-то причине ну покрайней мере у наших клиентов такое возникала у вас есть какой-то сложный backend и вам нужно динамически redirect те запросы которые приходят внутрь индекса redirected на какие-то другие уже в букете в другие в другие пути и при этом вы хотите делал динамические потому что допустим стандартной map и которые обычно используются в таких случаях ее недостаточно здесь мы используем специальный такой механизм это называется aus request где где мы на языке java script сможем сходить файле где наша мама находится в из этой map и мы можем посмотреть если у нас подобное отображение если есть то мы вернем дальше при помощи директива острый closed мы вернем вот в переменную раут мы вернем там будет содержаться новый кадр в котором будет содержаться новый путь куда мы должны будем же родились уже в бэг-энде куда мы должны будем отправить наш запрос хорошо теперь смотрим на локейшн resort здесь мы будем писать и пишем как директиву джесс контент в ней как раз будем заниматься тем что будем открывать файлы смотреть есть у нас там нужно я помогу или нет а в следующем логичнее мы у нас здесь есть возможность локально слова с локального хоста мы сможем этом апа динамический апдейтить хорошо смотрим на первую функцию кусочек кода я пропустил внутри этой функции все что мы делаем мы открываем нашу наш файл смотрим если там наше отображение если оно есть там и в через кадр south возвращаем новый новый путь куда нам мы хотим среди инъекций пользователя через хадер раут и выходим получается директива уср квеста на этот кадр получит и уже в proxy passes мы отправим клиента с новым с новым путем дальше здесь вторая функция который позволяет нам как раз эту мапу динамический апдейтить то есть мы работаем уже принимаем клиентский клиентское тела при помощи стандартных механизмом женской потому и парнем что что у нас но ожидаем что там джейсон проверяем что формат валидный потом открываем наш файл наш файл с папой туда добавляем у нашего отображения и сохраняем его на этом на этом все получается что мы при помощи одного логично можем там в двух-трех обновить нашу маму при помощи 3 мы ее содержимое используем чтобы redirect сложным образом наши запросы на bp для понятно что писать на языке и внутри индекса довольно таки нетривиально потому что там понаписали какой-то кусок кода что-то не так сработает нужно посмотреть в блоге engine.exe все это неудобно для этого мы специально придумали специально придумали интерпретатор нет опыта to come on line шоу где вы можете какой-то ход запускать прямо из команды строки либо из файла то есть проверить что то что вы пишите она в принципе работает так как вы ожидаете здесь я просто иллюстрирую то что уже в это плита и то есть там в частность interpreter print работа уже с кашами для иллюстрации дальше работаю там солонины и функциями работы с не работа поддержка исключений перехват исключений там бык trace и тому подобные вещи хорошо я уже подхожу к концу что уже сейчас есть даже такие очень механизм можно уже рассчитывать когда вы будете писать какой-то свой код если захотите то есть все стандартные вещи которые есть в стандарте вот то есть 5.1 это стандарт 2009 года все эти объекты а неужели зова ны поддержкой ключей не замыкание все это все это есть дальше в с начала этого года мы активно стали уже работаем над добавлением функциональностей с . 6 в частности вот совсем недавно добавили поддержку модулей ближайшее время вот уже скоро закормить им поддержку в привычных функций тоже это очень популярная функциональность одна из популярных официальности который жестко и программисты спрашивали и последнее это то что до уже можно сейчас работать есть несколько встроенных модулей которые позволяют там допустим работать с нами работают с файлами и тому подобные вещи теперь расскажу о ближайшие планы что мы собираемся вообще в этом году сделать это беден кода чтобы не вам не приходилось использовать и директиву джесс include потому что особенно для простых каких-то вещей это может быть не очень удобно вместо этого мы собираемся сделать так чтобы могли писать код на языке java script там прям внутри конкурса на файлах engine.exe дальше эта работа над функциональностью самих модули то есть то что вы можете каким еще вещам внутри engine и к таким объектам тренинг сможете добраться из из кода на java script последний пункт это то что мы фоне этого как был для нас меня придет но тем не менее максим этим занимаемся это расширение поддержки стандартов самой скрипт то есть смола стандарта java-script потому что какие-то особо популярные вещи мы активно добавляем я на этом заканчиваю вы можете всегда со мной связаться и найти зарепортить свои какие то не знаю пожелания баги предложение на на гитхабе со мной связаться можно по этой почте и еще последний пункт если кто-то из вас среди вас есть программисты записи которым интересно было было бы писать очень аппликатора и свой то у нас в команде час два человека мы ищем 3 присылайте резюме будем общаться на этом я заканчиваю готовы отвечать вопросом на одну секунду значит сейчас сейчас вопросы будут поздравляю с открытием зала для аудиторий у нас для вас небольшой презент вот вот теперь вопросы спасибо большое задаваться у меня уже микрофон ты лучше спасибо за доклад душа у меня еще вопрос вот там было пример из реклам крипто то есть вы взяли всякие команды стану мы сейчас да у нас это реализовано как встроенный механизм час реклама но на самом деле мы щас поняли что мы не хотим и все как бы за полагаться на нестандартные вещи мы решили вот сделали сейчас модули они будут как импорт импорт экспорт то есть как это ис-6 то есть это с более продвинутой то есть из файлов мы тоже будет экспорта прописаться на функцию и вопрос следующий вот импорт модуля крипто почему не веб крипто я спецификация для веб cryptoapi хороший вопрос можно об этом потом поговорим спасибо хорошее предложение на да вот поближе вот спасибо два вопроса о первых вы сказали что язык развивается это очень удобно вы же сами его пишите а так понял и реализацию никакой не используете как вы сказать будете его поддерживать он параллельно развивается еще где-то ну как я уже сказала мы в первую очередь то есть какой-то цели до написать новые 8 у нас нет на самом деле есть мы нас более такой прагматичный подход мы делаем те вещи которые реально активно используется из языка поэтому что там успеть за той скоростью в которой он развивается турия для получится но то что пользуется популярностью по крайней мере вот эти вещи которые начнем активно пишет мы будем добавлять то есть вы будете оттуда вытаскивать какие-то свежие не нужные куски и вставлять и к себе вручную ну откуда вытаскивать ну так мы смотрим на спецификацию то есть мы рисуем их с нуля то есть на языке си спасибо еще маленький вопрос уточнения насчет вашего примера с матами правильно понимаю что все таки есть какая-то часть с глобальными данными как который можно работать сейчас нет то есть этот вот этот этот матовый это на сам деле загрузкой файлов то есть если этот файлик там не очень большой он за кашированного персоной и в оперативной памяти и the file cache то это все не критично про да я знаю потребности такую мы про нее думаем у нас в платной версии есть шарик хэш но мы мы думаем мы думаем как что-то похожее добавить мин тоже в бесплатной версии спасибо добрый день и canon флант собственно хотел спросить по поводу а первый вопрос у нас сейчас есть некая штука которую мы на накрутили и может ли нгс отправлять людей запросы на может такой вот и по поводу что может я не показывал пример их у нас есть кому на самом деле два модуля нгс который позволяет работать как ттп так и stream то есть для тех кто не знает стрим это аналог там к прокси где вы можете работать там на уровне эти спицы дней и либо youtube из соединений соответственно там можно там через катетер допустим что-то там фильтровать люди присоединение там во внешний мир отправлять какие-то дорожки сюда отлично и есть ли возможность нгс использовать как интерпретатор для своей программы да возможно то есть он не так привязан к джинсу как ну он как бы он как бы формируем тем что он есть то есть естественно сам сам проект javascript а он отдельно и есть два модуля который его используем то есть они как в принципе мы какие-то механизмы которые нам нужны и мы их создаем внутри интерпретатора чтобы использовать в наших моделях но у нас есть еще допустим 1 1 программа которую общаться magic сам никак не связано ком online help который вообще хороший пример того как она работает бежать спасибо вот вы показали какой фон ситжес контент который я могу сказать 200 там мы вернуть а можно асинхронная тогда возможно вокал beck там да можно можно можно создавать sabre квесты то есть можно там произвольное количество prequest воссоздать вы в эту функцию в которой вы передаете вы создаете когда фабрика вы используете свой кал бег и вы можете допустим там запустить там несколько sabre квестов когда они завершатся у вас ваш колбе по зовется то есть все это время же с контент будет ждать ну не ждать по крайне мере он завершит в только в тот момент когда все фабрикой совершаться асинхронная функция небольшая просьба перед тем как задавать вопрос пожалуйста представляйтесь если возможно там имя фамилия название компании если можете конечно если это публичной информации давайте спасибо немножко долго же друзья меня зовут максим компании яндекс деньги я хотел бы узнать вот вы говорили по поводу того что там в полном в платном функционале по поводу хэш map & greet разницы есть а если но вообще что-то касательной джинсы то что доступно engine x плюс или ну и и недоступного бледно сандали час ндс от чистого под source проект но у нас как бы вот то что я сказал про про маму она на самом деле то сторон не вообще механизм который есть внутри яндекс плюс в который мы можем добраться при помощи существующих механизмов снг с а то есть как бы самому джесси ничего платного нет это полностью открытый проект индекс плюс обладает к минут то же самое тоже можно использовать понятно а вот еще один вопрос не совсем помню может быть тот уже задавал ну как так смог ну может быть ответ какой то был касательно того что можно ли в этих скриптах делать с такой вызовы какие то ну стороннюю систему получены на основе ответ а потом да можно но это сейчас делается при помощи встроенного механизма sabre квест то есть вы должны определить какой locations в котором у вас будет прокси пас он будет куда-то ходить и вы а ты сын джесса можете туда из своего другого логично да сделать под запрос их произвольное количество можете сделать то есть в принципе это можно такие сделать россию прямой внизу алексей компании мтс скажи пожалуйста а планируется ли какой-то экосистему модулей да вот как раз мы добавили модулю и мы сейчас будем думать как не только ваших да мы надеемся хорошо и просто тоже по хотелось подробности и второй вопрос какие есть средства отладки профилирования числе runtime но опеки есть shell то чего получается может там какой-то свой код написать это не надо и в нем и в нем и в нем есть несколько механизмов то есть какие то вы можете вставить допустим запустить какой-то свой код и посчитать время которое вы его выполнение может понимаем что локи возникает под нагрузкой он у нас упавший логов никаких нет на самом деле то есть какого то специального именно что если возникают какие-то проблемы в коде то мы их видим только исключительно под нагрузкой я думаю это можно стоит использовать только стандартный механизм google google первых тулс у нас есть модуль который linux этому он как раз он на различные решить эту проблем не предъявите попытки меня зовут владимир у меня такой вопрос правильно я понимаю что мне ничего не мешает написать допустим unit-тест под модуль на java скрипте и такой частный вопрос насколько мне свою задумывался о переписывание уже готового модуля на si no angels ну я думаю это все зависит от людских допустим если у вас модульность он делает какую-то secu bound вещь например там допустим затем да но естественно верно и здесь не имеет смысла переписывать на java скрипте но если по большому счету весь ваш код он стоит из того что вы пытаетесь делать какие-то там запросы куда-то такой который в принципе легко напиться как бы высоко уровне вещества вполне себе имеет смысл потому что в этом месте вы будете опираться именно тоску по скорости разница будет то что напишите модуль носи и нажал skype я разница будет незначительным чтобы быть опираться в по времени в выполнении самих там выпустим sabre квестов они больше времени едят чем сам интерпретатор какой мере если там ничего никаких там бесконечных типов не делайте этого естественно это менее по времени занимает спасибо меня зовут марк скажите пожалуйста посмотрел ваш пример в котором вы на каждый запрос получается открывать нам connect гпд если это некорректно самом деле это файл открывается понял об антибе было написано хорошо но у дарьи но и вам случае скажите пожалуйста возможно ли между всеми этими request a mi глобальное какой то стоит хранить например подключении к базе открытый какой-то socket или ещё что-нибудь такое вот сейчас ничего похожего нет пока опять какие-то 10 есть вопрос в том как я уже говорил работа сейчас каждый интерпретатор он живёт сам по себе вот у вас запрос поработал и он он все уничтожился какого-то перед системного состояния кроме час файла нет вот как я уже сказал в плюсе у нас есть как бы есть еще один такой шарик мэтт можно назвать так вот там можно что-то их пирсе стены и хранить force проблема еще в том что так как в engine.exe большое количество ордеров вам не только нужно иметь доступ к текущим интерпретатор вам нужно на самом-то деле иметь к жареному состояния между всеми маркерами поэтому вам как бы глобальный стоит в данного индикатора недостаточно и вам нужно какой-то более такой продвинутой механизм виде ну как обычно это шарик map используется вот и сейчас нас есть он только плюсовой версии в каком-то виде не знаю когда там in our добавим в open source там на самом деле учить очень сложно в общем сложность мысли какая-то платная версия и у нас есть конфликт с тем что она будет сильно сочетаться не сочетаться конфликтовать бесплатной версии спасибо спасибо за доклад дима и стоп а как с мониторингом то есть вот вот заслуги есть переменные река ставим мне если например я написал не эффективный код на и джесс который тормозит будет ли увеличиваться эта переменная но там это время в доме запросы то есть то есть можно мониторить данного общается спасибо последний вопрос андрей кисляк эти сумма у меня чисто практический вопрос вы на одном из первых слайдов показывали что компилируется байт код при старте джон x как теперь будет если мы хоп сигнал будем посылать будет все перри компилироваться или как меня нарочно все объекты будут если мы например там очень много скриптов напишем это в какое-то время будет занимать ну я думаю ну да это будет но я думаю скорее всего вы будете упираться пока рамира вот из нашей из практики самая большая проблема на самом деле не в этом месте в том что когда люди пытаются использовать вам десятки сотни тысяч сертификатов вот старте сертификата это в разы 100 раз больше чем компиляции чего угодно в на 6 вольт и как раз вот недавно несколько месяцев назад мы добавили динамические сертификаты то есть можно и загружать динамически потому что допустим да вот совсем недавнего времени если вот в этом прописали там несколько там серверов каждого сертификат и некоторые компании caught fire типа они пытаются создавать сразу там 10 тысяч таких серверов и у них там restart индекса может занимать там полминуты например вот и для них точно так болезненно и вот я думаю вот в проблемы времени компиляции engine.exe вообще не вижу честно говоря по крайней по сравнению с а сегодня спасибо спасибо за доклад спасибо за ответы на вопросы у нас сейчас будет 10 будут к перемена мест на перед этим три важных объявления первое собственно докладчик никуда не уходит у нас не уходишь нас привыкли залазь дискуссионная зона так что пойди на какие-то вопросы еще можно продолжить там второе пожалуйста не забывайте писать нам отзывы и ставить оценки докладом писать все что вы о них думаете потому что это то над чем работает программный комитет мы должны знать насколько вам это все и третье самое приятное выбери пожалуйста лучшие вопросы заданных мы вручим приз так мне про нитку не давать нет нет не знаю кости можно бросить вопрос про скажу арест ристопии я что-то забыл да вот можно спасибо спасибо те кто остается увидимся через 10 минут"
}