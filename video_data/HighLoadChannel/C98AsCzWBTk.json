{
  "video_id": "C98AsCzWBTk",
  "channel": "HighLoadChannel",
  "title": "MyRocks Табличный Движок для MySQL / Алексей Майков (Facebook), Сергей Петруня (MariaDB Corporation)",
  "views": 698,
  "duration": 2676,
  "published": "2017-04-08T14:31:43-07:00",
  "text": "меня зовут олег меня зовут алексей майков а я расскажу про май рокс табличный движок для myspace и я раб работаю над этим движком течение последнего года в фейсбуке до этого я пять лет работал с различными сервисами фейсбука и до этого 8 лет проработал мы красавцы меня зовут всякие петруня я основной профиль это работа мария тебе в камере оптимизаторов до этого я работал в маскел последний год я а кроме маленькими еще половина времени уделяю работе нас появился план сегодняшней лекции начале мы расскажем мотивацию то есть зачем нам понадобилось разрабатывает новый движок потом я вкратце расскажу о технические показатели то есть насколько мы улучшили насколько мы решили наши проблемы потом сергей расскажет про устройство то есть почему движок показывать такие показатели том коснемся того как попробовать как вы можете уже попробовать сегодня это движок и закончим особенностью которым мы встретились при разработке этого движка ну что ж начнем с мотивации фейсбук использует массив для хранения уэл типе данных все ваши лайки и комменты метаданные про фотографии хранятся сортированных географически распределенных иисус их май сиквелом фокусом сегодняшнего разговора будет то как конкретный инсцес хранит данные а именно система дискового хранения на конкретном бизнесе мая скалам немного пройдемся про то как этот сторож эволюционировал значит первое поколение старриджа это были вращающиеся жесткие диски и всем известная проблема во всяком случае проблема с которой facebook столкнулся это то что жесткие диски обладают ограниченным числом операции ввода-вывода и для решения этой проблемы приходилось даже использовать жесткий диск частично той записывать заполнять его только на десять процентов а иногда и на 5 процентов что весьма неэффективно и для решения этой проблемы facebook перешел на использования флэша и тут значит сейчас будет попытка пошутить несколько лет серьезно конференция но тем не менее значит начали flash используется использовался гибридной то есть флеш использовался именно в качестве кэша на пляжу для вращающихся дисков вот потом перешли на полный your flash в чем проблемы в чем проблемы флэша ну первая проблема и и общем то основная в том что в расчете на доллар а когда оценивать эффективность надо именно считать расчете на доллар количество гигабайтов которую может купить на один доллар где-то двадцать пять раз больше чем количество гигабайтов которые можно купить если вы используете вращающиеся диски можно эту проблему решить покупкой более дешевого флэша но тогда выходит на 1 von проблема изнашиваемость и то есть дешевый flash например теллсы great flash обладает всего 1000 циклов полной перезаписи после этого flash выходит из строя более дорогой flash обладая десятью тысячами то всем элси flash дает 10000 циклов перезаписи на фейсбук шинам work лоде этого хватает на 10 лет извиняюсь на 5 лет но как я уже сказал этот flash двадцать пять раз дороже жестких дисков так но и для решения вот этих проблем мы решили разработать совместно смотри деби новый engine под названием май рокс дальше расскажу про бенчмарки которым мы прогнали которые показали что мой рог действительно работает и решает эти проблемы ну значит здесь указан данный результат и синтетического бенчмарка link and lindh как бы эмулирует график трафик социальной сети и вы можете видеть что урок для хранения тех же данных что ее на тебе требуют два раза меньше объема жесткого диска то есть с одного терабайта объем снизился до чуть не многим больше полутора полу полу пола терабайта да тут количество мегабайтов записанных в секунду практически идентичная картина rock baby пишет два раза меньше мегабайта в секунду следующий benchmark на использую чаще чем патч марки использовались production данные тоже rock baby 2 раза меньше использовал филипп компрессорный вы no debe и враг себе на этом графике показан один incense и на тебе и два идентичных и сын сырок zibi так как rock baby требует два раза меньше объема жесткого диска то есть смысл на одном сервере на этом сервере гонять 2 изн 40 себе и принципе разделись показатели для вот этих гистограмм между истцами не невозможно ну что еще интересного на в этом бенчмарки вы можете видеть что рокс baby побеждает и на тебе в объеме flash garbage collection данных и в объёме данных пишут sistar еще джоном если посмотрите на белок и relay лак то преимущество урок zibi нету потому что белок или laylock это up and only структуры и общем-то не оставить немного другого толка им и можно их даже не включать в рассмотрении так ну вот здесь retreat и ретрит у rox baby полтора раза хуже чем у и no debe то есть за все хорошее приходится платить дешевый сыр тока мышеловки вот это наша мышеловка но хорошие новости стоят том что flash справляется то есть такого ретрита для для фейсбука в общем-то хватает tab но это лейкен сел на пенсию удвоено вынес из урок деби где-то в два раза меньше чем и на тебе цепью то есть как вы видите на и на тебе цепью практически просто его и то есть 80 процентов свободных на удвоенном месяце рокс baby happy you сильнее занята еще вот интересный момент ей такие спайки появились эти спайки относятся возникают из за комп аксонов про которые мы поговорим позже но теперь я расскажу про устройство под каким об собственно образом нам удалось добиться таких показателей для начала мы поговорим о том как устроена вкратце очень поговорим о том как устроена и на тебе и на тебе используется хранит данных без звездочка дереве то есть у нас страничной организация данных есть одна корневая страница которая как такое краткое оглавление она содержит ссылки на дочерние страницы которые в конце концов содержат ссылки на лифте вы и страницы которые хранят данные поэтому у каждого значения ключа есть какая то есть какая то одна страница на которой он должен храниться поэтому если мы хотим это значение для этого ключа данные поменять то мы должны перезаписать всю страницу даже если ключ занимает небольшую часть и и если будет ещё апдейт для ключей на этой же странице то можно эти два апдейта применить вместе но если этого не случается и у нас апдейт идут в разные части таблицы то нам ничего не остается делать кроме как для каждого значения для каждого изменения ключ описать всю страницу то же самое происходит при ставке вставка происходит в какое-то определенное место для каждого ключа и мы вынуждены будем прочитать ту страницу записать в свободное место если свободного места нет то придется сделать печь с плиты записать даже 2 страницы компрессия она отработает тоже постранично каждой странице зажимается отдельно во первых страниц и страницы не небольшого размера там алгоритмы компрессии нигде особо на разогнаться вторая проблема то что останется необходимости но оставлять свободное место каждый с каждой операция вставки не устраивало печь сплит поэтому на практике странице вы на тебе не полностью заполнены что тоже отрицательно сказывается на общем размере баз данных если обобщить эту проблему попытаться то вы можете такое понятие амплификация это отношение размера данных на диске к собственно размеру данных то есть если я пишу пишу новые данные объемом 100 байт она диск пишутся килобайт то у меня в райт амплификация 10 уже записал в 10 раз больше чем записалась 10 раз больше чем я собственно хотел сохранить вы на тебе нет амплификация общем у нас устраивает проблема является в райт амплификация мы пишем много больше чем собственный объем данных который мы сохраняем и проблема является сайт амплификация то есть объем да это файла и дтп существенно больше чем те данные которые в нем хранятся и очевидно что может конечно вы на тебе эти решения так просто эта проблема так просто не решается в рамках бы звездочка дерево поэтому было очевидно что нужно что-то другое и это другое это logs так чуть мерч сейчас мы вкратце рассмотрим как он работает logs так чуть мягче это такой алгоритм ривер сити технология хранения данных работает следующим образом при записи мы данные пишем в менты был это какая-то иная структура которая позволяет их оттуда эффективно читать сканировать делать spa and look up и а для актера бейте чтобы эти данные не были потеряны в случае игрок они пишутся в лоб последовательно в какой-то момент mtb мы уже напишем столько что она достигает кого-то предельного размера в соответствии с нашим объем оперативной памяти и тогда и и выливают в st-файл стр это сокращение от сорта young people это файл на диске он имеет вот такую структуру в нем все ключи расположены упорядочена файл разбит на довольно большие блоки которые используют компрессия в конце файла есть оглавление это всё предназначено для того чтобы файлы можно было эффективно осуществлять поиск для записи и дальнейшей модификации файл не предназначен совершенно он пишется один раз и больше никогда не изменяется вот записали мы содержим mtv st-файл дмт был освободили и поехали дальше когда запах менты был заполнен вас во второй раз она пишется во второй файл и так у нас постепенно файлы накапливаются значит чтение идет следующим образом при чтении мы смотрим какие данные нас есть менты бл это самые свежие какие данные нас есть в первом и состав а или это то что было перед этим во втором и составили как более ранние данные так далее то есть почтение происходит слияние данных из нескольких источников и видно что по сравнению с и на тебе это конечно недостаток потому что мы читаем данные из нескольких мест это увеличивает 3 complications поскольку увеличение со 100 файлов вызовет дальнейшее замедление все больше и чтение устраивается процесс compact это слияние нескольких от 100 файлов в один основные цели этого процесса это первое уменьшение количества со 100 файлов чтобы у нас чтение не слишком сильно замедлялось второе это удаление старых записей если у нас разные со 100 файлы содержат разные версии одной и той же записи то все версии кроме последней в новый файл не берут поэтому общий размер файла после меня уже будет меньше чем общий размер файла в доме уже средство которое использует достижение цели - читаем сортированы из st-файл и и мы пишем опять-таки сортированный st-файл то есть мы пишем последовательно мы можем писать записи плотная без всяких дырок мы можем использовать хорошую же алгоритм компрессии на больших блоках как именно стратегии может быть много сначала освоим какие общие соображения хочется избегать крайностей то есть если у нас слишком много если мы делаем compact очень редко у нас состав файлы будут накапливаться и чтение будет замедляться с другой стороны если мы будем делать compaq шум очень часто там и получается перезаписываем одни и те же данные раз за разом в новые со 100 файлы что тоже что что ухудшит write амплификация второе соображение то хочется работать эффективно то есть файлы сливать похожих размеров уж если мы возьмем один очень большой файл и пытаемся вас лица очень маленьким файлом мы фактически прочитали большой файл и записали его обратно практически без изменений вышел маленьком файле много изменений не будет 2 таскает соображение то что хотелось бы сливать такие файлы которых содержатся разные версии одной записи чтобы старые версии побыстрее выкинуть и размер базы данных уменьшить существует много алгоритмов compaq шина в разных продуктах основанных на lsm некоторые из них общего назначения некоторые из них делают предположение о том какие данные например сохраняет таймс темп это они все время растут и практически никогда не обновляются только insert там вот мы рассмотрим один алгоритм как наиболее используем в нашем решении это не велит компакт devit компактно газона следующим образом все файлы разделяются на уровне есть уровень l0 это особый уровнем лежит один или более файлов каждый из которых может иметь любые ключи в себе дальше есть такого же размера как он 0 уровень l1 и и уровне с 1 по 5 они файлы лежащие в них содержат непересекающиеся диапазоны ключей то есть если мы возьмем какой это значение ключа там есть только один файл в котором это значением этот ключ может лежать кроме того уровне увеличиваются вот l1 имеет на данном рисунке размеров 50 мегабайт l2 даже используя какой-то фактор какой-то множитель в данном случае он 10 l2 он в 10 раз больше чем aladdin l3 будет еще в 10 раз больше l4 и так далее что это такая структура дает чтение при чтении нам нужно прочитать заглянуть во все файлы на l 0 потому что в любом из них может быть наш ключ и по одному максимум и в один файл на каждом из уровней потому что на других уровнях значения ключей не пересекаются для файлов то есть у нас complications у нас будет 5 по числу уровней плюс количество файлов на уровне l0 вот теперь посмотрим как происходит собственно запись и compact измен ты был данные пишутся всегда на нулевой уровень выталкиваются и они там файлы накапливаются когда их там становится количество данных на уровне нулевом превышает некий предел происходит выталкивание из 0 вл1 мы берем все файлы на уровне l0 и устраиваем к пак шин с теми файлами володин которые пересекаются по диапазону ключей с тем что у нас есть волной результат пишется володин если уровень aladdin в результате за не стал слишком большой достраивается compaq шин из уровня l1 и l2 брюсов мы рассмотрим какие есть файлы на уровне l1 какие спали на уровне l2 кто из них пересекается по значениям ключей и планируем несколько процессов суп кап-кап-кап compaq шин который производит соответсвующий compaq шин в результате все данные саладин оказываются на l2 ну и так далее если у нас есть переполнится l2 будет устроен compact nl-3 и так далее проливе рядком пак шин просуммируем что мы обсудили значит ридом президентом количество файлов на 0 плюс 5 по числу уровней сайт амплификация там 1.11 это понять можно исходя из для чего рассмотрим случай когда у нас уже много файлов много данных и все уровни заняты начать с на последнем уровне данные лежат плотно они записаны собирает амплификация один без дырок и каких-то там прочих проблем а на предыдущем предыдущий уровень он им составляет одну десятую от последнего уровня и в худшем случае там лежат новые версии то есть в худшем случае весь предыдущий уровень это это мусор этот те данные как который совершит вот тогда средства после вот это добавляет первую единичку после точки одну десятую следующий уровень добавит одну сотую и так далее вот поэтому 8 практическом случае у нас сайт amplify кришна 1.1 11 write амплификация поэта профи конечно несколько сложнее мы единица справа она от того что мы записали данные в уровень l0 а потом мы эти мы эти данные в общем случае перепишем последовательно володин l2 l3 и l4 l5 на каждом переписывание этот ключ который мы переписываемся l1 l2 он будет смелость десятью ключами которые уже лежат на l2 то есть мы все это прочитаем все данные на l2 и запишем как худший случай вот поэтому level фан-арт то есть 10 и то есть множитель к числу уровней вот как клей велит compact сравнивается с другими известными алгоритмами compaq шин она пишет достаточно много но она имеет такой характеристику что ни есть жесткое ограничение по почте или complications и хорошая оценка по сайтам при фетиш в принципе для данных которые имеют какое-то специфическое распределение можно выиграть найти другой комп action алгоритм с меньшим в рай там плевки или просто так сказать пожертвовать или дам причины уменьшить еще в рай the profession но даже с таким в этом префиксе он как видите как показал алексей мы обгоняем и на тебе общая значит сумму да еще есть такие соображения что новые изменения при этом сливаются друг с другом мы сначала пишем все на элдон там сливаем то есть если поиск кто-то пошел за постил пост и он пошел собирают лайки то все лайки сначала попадут новый винил 0 где они скорее всего свяжутся и над на l1 и дальнейшее уровне уже будет распространяться только одно обновление и по мере сливания новых изменений друг другом они будут мигрировать ниже в все более старые уровни вот это таскать достигает тех целей которые были поставлены на прошлом слайде вот общая сумма ли полок строкач он уменьшает white амплификация то есть мы можем делать меньше операции записи он уменьшает сайт applications размер базы у нас меньше становится на диске а платим мы за все это редчайший потому что нас операция чтения в случае влазит в несколько файлов конкретно для реализации технологии lsm есть такая библиотека level т.п. она написана на си плюс плюс это embedded lider и анализ интерфейс у неё киеве люстра она использует как раз в основном этот не велит compaq шин она open source она разработана в google для браузера хром то есть она применяется очень широко но у нее есть такой один недостаток что она не была разработана и не держит серверной нагрузки то есть не держит тот случай когда у нас много ядер много параллельных пользователей которые пытаются что-то менять первоначальные тесты facebook проводились на devil baby чтобы оценить сайт амплификация и write амплификация но когда зашла ничего собственно реально полей нагрузки пришлось level тебе фак ночь и назвать новую библиотеку rox baby это флаг левел де беф которые добавили серверные фичи мал тетради компакт компакт использует несколько треков мал тетради тм mtbf large можно есть несколько мин теплов на самом деле несколько они могут выталкиваться на диск разными трендами параллельно с rode link то есть искусственное замедление операция обновления если компактно начинает от них отставать префикс блум фильтр для range сконс мы об этом поговорим чуть позже колонки мелис но и остальные фичи которые таскать потребовались для того чтобы начать это гонять на все в равных условиях рокс тебе как сама библиотека уже нашла применение работает в продакшене в самом фейсбуке также в linkedin йаху и другие пользователи известны но все-таки рокс дебита библиотека она очень низком уровне интерфейс предоставляет келью star там есть операции типа put уделит в райтс вотч что-то вроде транзакции только без локов там нету ни отдельных таблиц не типов данных не вторичных индексов не удаленного доступа ничего такого поэтому для интегрирования с приложениями был написан столь очень джин для mais quel которые хранит данные в рок себе это табличный движок для mais quel то есть можно писать crate people people дальше definitions spot a major рокс db и данные был к будете вставлять вот таблицу данные они будут храниться в рокс тебе вот так же средствами москаль возможна конфигурация рокс тебе макс готов в тестом то есть и сколь семантика правильная там ensure the select и апдейты делают то что от них ожидает стандарта ce qui он поддерживает на загс и поддерживаются два уровня изоляции поддерживаться все типы данные которые поддерживают moscow индексы праймари secondary uniq secondary и в поиск по всем видам условий проходят эффективно мы рокс предоставляет оптимизатору мой сколь статистику чтобы он выбрал правильные планы и уже можно пробовать приложение как пробовать расскажет алексей код массив год мороз ключом webscale форк мои сиквела фейсбука вы и ford мои сиквелы который является паркомат webscale сиквел чтобы попробовать вы можете скачать исходники с гитхаба откомпилировать под вашу с и попробовать пока только так будущем рассматривается возможность включения мой рокс в марию если вы решите попробовать обязательно при присылайте нам отчеты если у вас возникает проблема присылайте нам ее мы попробуем вам помочь и если вы нашли баг открывайте и мы на него посмотрим а так же отзывы идеи даже патчи как бы все это рассматривается и где можно общаться то есть можно на гитхабе с помощью открытий еще сообщаться и также на урок zippy есть группа на фейсбуке можно попробовать не общаться тобто немного расскажу про то как при настройке ну я сразу скажу что на настроек много и подробно можно вот на этой вики печь прочитать про настройки вот но целом чтобы я хотел упомянуть во-первых настраивать нужно потому что настройки по умолчанию пришли изловил которые эти настройки не отвечают все серверным нагрузкам поэтому настраивать нужно но хорошая новость состоит том что настроек много и можно настроить практически все что угодно да ну как целом настроить lsm дерево то есть надо начать того что прикинусь потенциальный размер данных и и такого продиктует размер каждого уровня рекомендуется чтобы каждый уровень каждый последующий уровень был 10 раз больше предыдущего уровня и рекомендуется чтоб на первом уровне было ну в районе 10 файлов и чтоб сего уровне было ну где-то 4 или 5 и то есть исходя из этого можно настроить размер файлов и размер вам ты был рекомендуется раз настроить равному размеру файлов так теперь про то как настроить комп акцию значит чем чаще вас компактный запускается тем быстрее можно читать то есть уменьшается рид амплификация но чем чаще комп акции происходит тем больше рокстеди начинает писать на диск и увеличивается райт амплификация то есть вы должны понять что вам нужно что вам более важно и в соответствии с этим настроить как бы скорость комп акции так ну те что делать если вы знаете какая скорость компактный вам нужно но комп акция не справляется то есть во первых что происходит вы добавляете данный вмт бал данной добавляются скидываются на уровень 0 на уровне 0 накапливаются файлы и если файлы накапливаются то запись менты был приостанавливается а потом начинает файлов сам появляются ошибки вот в чем могут быть проблемы узкие места комп акции но одно из узких мест скажем самое главное эта компактная из нулевого уровня в 1 из 0 первый уровень можно контактировать только одним средам такова специфика lsm дерево поэтому рекомендуется не включать компрессию на нулевом первом и втором уровнях а уже там на последнем или на предпоследнем уровне нужно включить компрессию количество компактных тредов рекомендуется ставить равным количеству корову сепию количество флорида вставьте равном единице этого обычно достаточно и чтобы отследить за статистиками насколько все происходит хорошо можно использовать вот эту команду шоу engine rock baby статус который покажет сколько как часто компакты и происходит за чистики для каждого уровня и так далее с помощью переменной цикл переменной рокси by default sea of absence можно передать установки в рокстеди то есть все о чем я говорил можно задать помощью вот этой длинной строки и передать его в эту переменную то есть данном случае что мы передаем размер м табло 12 мегабайт размер файла на первом уровне 1 мегабайт и каждый уровень 10 раз больше предыдущего уровня есть еще вот такая переменная называется рок слиппи о выроет колумб м или absence зачем она нужна если у вас вор claude есть несколько типов данных у которых разный характер и вы хотите для каждого типа данных иметь свое отдельный lsm дерева со своими установками вы можете создать так называемый каллум families то есть каждый полон family соответствует одном одному и лосем дереву и установки для каждого лосем дерева можно передать используя вот это вот переменную в целом мы добавили больше чем 84 новых системных переменных мой сиквел тасю меня нет времени про всё рассказывать но возможности настройки очень обширны теперь поговорим немного про особенности lsm дерево с которыми мы столкнулись работай над этим плагином и как мы их преодолели вначале немного поговорим про про мгновенный backup значит это еще одна системная переменная называется рокс big red чекпоинт если вы присвоите этой переменной какую-то директорию то в этой директории возникнет точная копия всех данных хранящихся в rock baby touch id как это каким образом это достигается я напомню что 6 файлы в которых хранятся данные они readonly и ему табл то есть достаточно просто сделать на них еще одни ссылки в linux овская файл системе и у вас готова просто мгновенно снимок всех данных очень удобно как нас это даже для там терабайт ных баз данных это происходит мгновенно но сожалению эти этот снимок будет бесполезен почему во первых он создан на локальной машине может вы хотите перенести на другую машину ваши данные а во вторых это только росте by данные они не включают с кем эти синие джаста себе фарам файлы из самого масик вала значит мы написали вот такого скриптик май rocks at backup который решает обе этих проблем и вы можете запустить скрипт тег он создаст чекпоинт добавить него детей all файлы от мой сиквелом и выдаст их виде дар балла какой стремящегося торгово этот торгов можно поймать на другой машине используя засечь и распаковать и на самом деле он будет вызывать делать чекпоинт каждую минуту потому что передача пссс может занять там допустим 4 часа если вы 4 если вы один терабайт посылаете и когда передачи закончится у вас по я получится более менее более менее свежая копия базы на другом сервере вот и на удаленном сервере можно запустить тот же скрипт с параметрами минус минус бэк который взят возьмет эти файлы и переместит в эту директорию масик вала и у вас будет точной копии базы данных с исходного сервера еще несколько типовых по еще несколько особенностей которые встречаются когда пытаешься sql запустить на lsm дереве первое из них это сканирование в обратную сторону достаточно часто edius кейс особенно для фейсбука вот запрос который ищет последние 10 сообщений для каждого пользователя вот они естественно образом сканируются в обратную сторону с лимитом проблема в том что у нас волосам большой размер блока у нас использо компрессия поэтому блок читать с конца мы не можем мы можем такой читать сначала поэтому сканирование в обратную сторону у нас выглядит крайне неэффективно мы нажимаем целый блок только для того чтобы взять отдельную запись очевидного решения нет ул это и это было настолько большое таскать для нас проблемой что в качестве решения завели колом фирма не сохранением данных в обратном порядке то есть отдельный такой на тебе близко к теплу space у создает при создании таблицы можно указать в комментариях для индекса что этот индекс будет храниться в обратном порядке тогда он физически хранится в обратном порядке то тосканы в обратную сторону становится быстрыми ну как недостаток теперь сканы вперед будут медленными так что приходится выбирать вот еще одна особенность это блум фильтры для раньше сканов сначала поговорим про был фильтры вообще мы в gsm читаем из многих источников данные из нас есть какой-то ключ вот c1 мы его ищем во многих и состав аллах причем часто причем большинстве за состав ай лав его обычно нет решением является блум фильтр присоединить в каждую st если кто не знает что такое было фильтр это что-то вроде хэш-таблицы который имеет относительно небольшой размер относительно данных лежащих ней она может либо сказать что точно такого ключа и нету либо сказать что такой ключ может быть и тогда нужно смотреть и проверять если он там действительно и вот это общая для многих всм систем решение что вместе со 100 хранится будем фильтра который используется для проверки перед тем как читать из теста для понту капов все работает более менее хорошо а теперь посмотрим на рендж lookup и в данном случае есть еще в рендже первая трудность то что когда она споет lookup мы можем если мы нашли ключ в нем ты был до этого уже достаточно нам нет смысла смотреть в состав потому что там будто к предыдущей версии для range look up of это не так может позже у нас тут такой и мы нашли вмт был ключа 12 это ничего не значит он в что попадает на может быть в каком-то состав али есть 11 и нам придется всю ночь читать много файлов вторая проблема то что фильтр не работает потому что у нас от десяти до двадцати там могут быть разные разные значения hash hash а фильтр работает как хэш-таблицы ну в данном случае можно все прям перечислить от нас вы овчаров нельзя уже все возможные значения и поэтому решение было такой же блум фильтр заводится на префикс для колумб имели можно задать некий префикс число байт который будет отрезаться отключает по ним строится будем фильтр включи у нас хранится сначала индекс набор потом первая колонка потом 2 поэтому можно посчитать сколько байтов нужно в префикса отрезать чтобы двум фильтр применялся допустим для и к воде типа первой колонке тогда она будет его автоматически детектировать что он применим и будет его применять как когда возможно вот только с этим раньше сканы заработали достаточно быстро еще одна особенность этот ум stones после делиться у нас lsm поэтому мы не можем собственно данные удалять у нас команда делиться пишет в том что он то есть маркеры о том что значение удалено если мы удалим например сообщения за день а потом будем читать сообщение через раньше который перекрывает этот день то нам придется все эти том что он просканировать их не так много в общем но для данного запроса это количество сканируем их записи увеличится очень сильно и запросы резко замедлиться после такого большого уделит в качестве решения мы сделали следующие при записи в состав айл мы смотрим подсчитываем сколько там было там stones если там потому что у нас было очень много маркеров удаления в этом файле там они медленно назначаем компактен этого файла чтобы как можно быстрее от этих том stones избавился вот так что пришлось еще сделать еще побольше записи чем таскать оригинально планировалось для поддержания нормальной скорости чтения в общем и целом значит в мороз если будете пробовать надо предплечье ты там нет у всех фич которые человек ожидает от такого зрелого продукта зрелой базы данных там есть ограничение типа поймай окей обязателен сейчас таблицу без поймаете не создать индекс only работает не для всех типов данных alter ты был медленный online in place alter ты был как вы надели нету размер транзакции ограничен больше какого-то разговора там есть переменная которая позволяет гонять это большие апдейты но они будут не транзакционные нет как crash сейф мастер потому что фейсбук используется 7 sing если мастера грохается то ей просто был счастлив назначается новый мастера мама стирает уже не восстанавливается создается заново вот это все ограничения они не носят принципиального характера большинство из них для марок они временны и кстати если вы будете и сам что-то именно нужно то дайте нам знать есть шанс что это приоритета реализация этой фиче будет повышен вот ну выводы табличных движок мой рокс основан на rock baby он приносит lsm серверного уровня в москве решает проблемы with heavy загрузки то есть позволяет использовать меньшими чтобы ваша база занимало меньше места на диске и меньше операции записи меньше износ ssd элеватор pitch то что мы в 2 раза меньший на тебе и по размеру на диске по количество операций записи без значительного замедления чтения вот такое можно достичь состоянии интенсивная разработка не все сценарии использования еще покрыты но уже состоянии кого-то кое-что уже можно в принципе пробовать на сливах на репликах вот приглашаем к сотрудничеству весь движок и рок сгибе тоже open sans все можно скачать попробовать есть как уже алексей упоминал группа фейсбуке для обсуждения публичный багтрекер при подготовке данной презентации мы повзаимствовали несколько слайдов вот этих при станции на предыдущей конференции можете посмотреть там обсуждается моя рокс большие детали но и все рокс тебе + sql получается мой rocks у нас не осталось времени на вопросы так что мы будем тут рядом с или осталось осталось тогда растет спасибо за доклад два вопроса опрос еще есть их можно прямо сразу не отходя от кассы первый вопрос можете сказать для hdd ну есть какой-то профит или вообще нет смысла смотреть и второй вопрос по поводу мер джей пи дон процессу им можно как-то управлять потому что насколько я понимаю это достаточно трудозатратный и как бы производительность упадёт в самый неподходящий момент можно ли вот отложить эти мер штамм на ночь ли чун и я могу ответить попадаешь дидим на самом деле lsn структуру изначально придумывал для их сидим и профит лежни типу это что у уменьшается как бы количество right of the список и то же самое если вас right away workload профит ездили и ждите но если рид huevito скорее всего нет а по поводу лоджий то есть на самом деле вы горды происходит continues ли то есть это как такая замкнутая экосистема в аквариуме добавляются данные и в играйте происходит мер джин большинство мужей они не такие страшные про что в некоторых случаях файл можно просто переместить с одного уровня на другой ничего не читая непиша просто заметив записи ритуал теперь на другом уровне с него ключи не пересекались вот кроме того с откладыванием на ночь проблема может быть в том что у вас это к вечеру все будет все медленнее и медленнее я не знаю это хорошо в течение дня чтения будет замедляться то скатился уставать концу рабочего дня это текущая цель чтобы они были континиус они происходят достаточно часто раз в пять минут примерно так compact что такое случается донатом есть критерии то есть как только уровень переполняется tricky лица мяч по по времени ну кстати будет зависеть от объем выступами данных если вас ночи меньше данных поступает ты наверно будет меньше происходить но кстати вот хорошие печоре квест весь график да еще вопросы в чем вопрос холме образом я ребят вам спасибо за доклад я активный пользователь rox baby и просят ваша система на очень классно я могу сказать что на физики работают нормально то есть я использую все круто вот хотел просто добавить вы в особенности рук сгибе и в отличие после вельде by не упомянули очень классную вещь мерз оператор лично это было как бы один из основных вот моментов которые меняют ли тебе утащил наружу то есть а вот это хотел добавить если можете расскажите да наш оператор правда просто быть искавшие такое прошли знает rock my age оператора то можно враг сгибе записать не новый ключ а такое как бы команду когда будем вяжется с предыдущим ключом если правильно прямо это что-то сделать особенностями в том что вам не нужно делать сначала гетто дед modify райт до роста делать мир и уплаты ндс да именно такой вот вы сразу писать проблем потому что мне это не рухнули потому что моя рокс на текущий момент между оператором не используют в принципе подобная фича пола в другом движке в току тебе был апдейт но аффекте тролус когда можно было сделать апдейт который не говорил сколько он записи скажет сколько он записи обновил именно потому что он там делал что-то похожее на мерс оператор в принципе это можно добавить и надо такая тоже фича request для марок со но текущий момент это вы еще не реализовано спасибо просто спасибо большое за доклад скажите пожалуйста а вот можно в одной колонке земли хранить несколько таблиц или например одну таблицу хранить несколько колонн сломили можно назначить колумб family каждому индексу какую-то конкретную и во вторых есть специальное как бы имя для к вам фамилий называется первый индекс сел то так каждому индексу будет автоматически называл назначаться свой аккаунт имени с именем этого индекса вот одну таблицу в несколько кого-то и мне сохранить нельзя наверное было бы можно для партий шиллинга на текущий момент syntax не позволяет сказать для индивидуальных пар тишина в каких в то они должны быть в разных конфет из почти большое спасибо за вопросы к сожалению время заканчивается у нас я следующий доклад пытаясь мы просим если будут вопросы после следующего доклада ответить на североморске уж не уходите будем здесь да так что если будут спросим спасибо всем спасибо"
}