{
  "video_id": "g82_rBVWRFI",
  "channel": "HighLoadChannel",
  "title": "Виртуализируй меня... полностью! / Александр Лисаченко",
  "views": 103,
  "duration": 2962,
  "published": "2023-10-06T07:15:50-07:00",
  "text": "Привет Меня зовут Александр лисаченко и Наверное вы меня больше Знаете по всяким необычным докладам А кто слышал мы доклады проспект ориентированы программирование про запуск ассемблеры спички есть такие нет таких нет Ну тогда вас будет уникальная возможность найти мои доклады из прошлых выступлений пить пираша они в категории интересных и я думаю так сюда она не выводится еще пока Окей бывает кратко обо мне Я работаю настоящий момент в компании indrive indrive это глобальный сервис типа убера и мы позволяем пользователям перемещаться в пространстве и делаем это не только по России но мы делаем уже больше 40 странах с компьютерами у меня мой путь начался довольно давно Кто помнит поколение спектрумов и 64 килобайтов вот я примерно оттуда с тех времен и довольно долго я занимался системным программированием потом уходил в сторону веб-приложении потом ушел архитектуру и уже последние наверное больше десяти лет Я работаю На позиции Архитекторов в крупных компаниях как я уже упомянул являюсь автором Аспект ориентированного фреймворка в PHP Кто не знает загляните это интересную вещь Я думаю она позволит вам познакомиться Чуть более с Advanced парадигмами программирования Не только объектно-ориентирована но и Аспект на ориентированным и есть дикованный зверь под названием The Engine который позволяет писать плагины для самого PHP на языке PHP То есть если вы хотели когда-то в душе реализовать перегрузку операторов это можно сделать на чистом PHP Посмотрите будет интересно о чем мы будем говорить сегодня так кликер ушел отдыхать Ну без нее продолжим мы поговорим об истории развития php-invarning of когда-то мы все начинали с того что все запускало локально и ручками потом мы перейдем к докеру посмотрим какие-то типсы интригсы Как запускать PHP мульти режиме с доктор компос и запускаем в губернации но про cubernet будет не так много потому что губернация это отдельно огромная зона итак по истории развития PHP началась Она довольно давно мы праздновали уже юбилей недавно и я еще помню те замечательные времена когда Мы собирали PHP ручками и это было прям супер круто открываешь консольку и начинаешь прям вчитываться в сообщения компиляторах о том что там собралось не собралось какие есть вообще проблемы в общем было увлекательно Вот и Слава Богу что мы из этой эры вышли и наверное следующая эра которая всех захлестнула это установка из пакетов Я думаю что тут Наверное есть ребята которые у кого PHP стоит через Брю есть такие на локальных машинах Да не так много Ребят а кто ставил Там каким другим менеджером типа uptopkey вот есть такие соответственно вам будет очень интересно посмотреть дальше Потом пришли великие умы и придумали такую замечательную штуку как сам Я помню этот момент когда ты ставишь Windows приложения запускаешь у тебя все готово это блин такой неужели нельзя было сразу так сделать вот это все Прошло довольно быстро и я очень рад что мы дошли до той стадии где у нас появился такой замечательный инструмент как докер и сейчас невозможно представить чтобы какая-то современная интерпрайс система крупная Да она работала без каких-то виртуализации поэтому основная часть моего доклада Собственно как Вы уже поняли будет посвящена виртуализации а раньше было довольно сложно объяснить как работает докер Потому что если мы копнем глубже то там куча вещей связанных с группами с нами спейсами ядра на эспейсами сети и это все работает как черная магия потом появился инструмент под названием докер и благодаря докер у нас появилась очень крутая возможность запускать PHP в атаку с ними никакой установленной вообще версии PHP на нашей машине мы делаем Алия спички равняется Докера rn it указываем что нам нужно силовая версия PHP и мы сразу можем запустить версию 8.2 собственно почему бы нет кто-то там не перешел еще 74 на 81 мы можем прям взять и запустить на свои локальные машинки сейчас 82 поиграться запустить какие-то скрипты и дальше написав PHP минус вы вы получите Как ни странно работающий PHP но он какое-то время скачать там какие-то layers свои Но это все делается однократно и дальше все это работает и более того можно даже запускать встроенный PHP сервер через докер Я думаю все знаете ключик минус S вот он пробрасывается вот в этот верхний Аляска который у нас есть да и в этом аляси мы получаем полноценную работающий сервер мы пробрасываем порт 880 и мы можем открыть прям браузере наши приложения оно будет собственно открываться а что мне нравится или не нравится в докере это то что мы можем собрать под себя инвалид как правило есть очень много жалоб когда приходит допустим там не знаю дефопс Или разработчики блин а вы нам напротив там extention не поставили или вот вы там что-то не доставили напротив фатальная ошибка и таких ситуациях прям вот их бесчетное количество было всегда и всегда это там какая-то такая проблема которую нужно решать быстро и немедленно и когда мы пишем кастомные PHP имиджи очень часто приходится иметь дело вот с этой средней частью которая мне очень не нравится вот я как человек больше со стороны PHP со стороны прикладной Понятия не имею Зачем мне вот эти вот Вот это в общем штука она прям очень Мне не нравится и первое что бы хотел наверное порекомендовать В таких случаях есть Очень интересный проект под названием до кирпич пик Station Installer и это тот путь который я всем вам рекомендую когда вы будете работать своим докером перестать ставить extention ручками довешивать их вот так а воспользоваться этой библиотекой И основная фишка этого проекта в том что он позволяет Поставить все необходимые для конкретного экстеншна зависимости сам то есть он видит чего не хватает он понимает как это собрать и вы получаете место вот такой вот ужасное некрасивой вещи Очень лаконичную строчку с названием instantion GD все оно стало готово и работает и очень прикольно что мы можем использовать еще очень много фишек в самом докере я тут нарисовал крутого Мишку Вот кто знает чем раньше отличался докер Билд от докер buildx Build есть такие в зале спойлер сейчас это одно и то же в общем Небольшая предыстория докер развивался как отдельный продукт и появился довольно недавно дополнительная ветка расширение Докера под названием белкит и вот набор экспериментальных фичей которые недоступны в основном докере они были внесены из вот этой экспериментальной ветки разработки в основном ведь и поэтому то что раньше можно было найти через докер Билд Икс Билд это Например запуск билда под несколько платформ запуск с какими-то экспериментальными штуками сейчас это все внутри докер бьют и я наверное сейчас хотел бы рассмотреть несколько типовых примеров которые вам позволят в дальнейшем решить какие-то проблемы которые у вас возникают при работе с докером давайте наверное посмотрим вот на этот кусочек Кто делает примерно так же То есть у вас есть какой-то там гитхабчик или битбакет и вы добавляете приватный ключик Кто так делает А что здесь не очень хорошего в этой схеме почему лучше так не делать Да проблема этого подхода в том что если мы не сделаем нескольких слоев примеру вот так да не сделали первый какой-то базовый слой как Билд в котором мы пробросим аргументы то все те аргументы которые мы в первом случае передавали наш скрипт они останутся в истории соответственно любой желающий если мы не сделаем сквошне сделаем изолированный слой как вот здесь эти данные прям так будут поэтому пожалуйста так никогда не делайте то есть никакие секреты нельзя явно передавать в конечной образ вашего доктора приложения Что появилось сейчас у нас появился возможность использовать экспериментальные фичи и теперь докер поддерживает специальный синтакс я выделил эту строчку вверху этот синтаксис позволяет вам получить кучу дополнительных возможностей о которых я буду дальше на протяжении своей презентации рассказывать и одна из первых возможностей которые бы хотел вам рассказать это специализированный mout тип с названием ssh что он делает Он позволяет вам в момент билда вашего приложения нативно пробросить хвост машины необходимые если Саш ключик через Саша Агента все это выглядит Вот так мы получаем какое-то идентификатор сокета и дальше просто через докер бьют можем теперь изящно пробросить с ключиком shiful равняется то есть весь наш ssh контекст будет внутри докер билда что еще наверное нам как PHP разработчикам очень интересно запустить композор кто пробовал запустить composer Прямо во время билда чтобы потом прямо отработал во время билда а не через отдельный экзамен внутри работающего приложения вот удалось да ребята Вот и обычно это делается там с кучей всяких танцев с бубном это не очень удобно и очень медленно Расскажу какие вещи можно использовать первое опять-таки мы включаем наш расширенный синтаксис докер файла на текущий момент по моему Если не ошибаюсь последняя версия этого синтаксиса 1.4.2 То есть это уже четвертый минор этой версии расширение и что мы можем сделать первое что можем сделать мы можем указать специальным Во время перемен для композера в которой мы будем хранить всякие каши файлики конфигурации А дальше будем использовать крутые вещи первый маунта позволяет нам всю текущую директорию в которой мы запускаем докер пробросить папочку АПП но при этом она будет как бы изолирована то есть все изменения которые будут происходить в ней они будут не видны со стороны приложения но в то же время каким-то неведомым способом этот образ Этот способ работает на порядок быстрее то есть в обычном режиме установка пакетов composer занимает где-то пару минут а вот с этой штукой она пролетает там за десятки секунд второй что мы сделаем мы сделаем кэш для composer который будет переиспользоваться между всеми нашими билдами зачастую если у нас микросервисная архитектура есть пара там приложение на PHP и очень часто пакеты у нас уже где-то на билдовой машине в кошельком позера есть Поэтому глупо их еще раз доставать поэтому мы можем объявить Man Type cash дать ему идентификатор потому что каждый тип США имеет свой айдишник и указать куда мы хотим отремонтировать дальше все докер возьмет на себя И еще мы можем указать Type Secret это отдельная фича которая позволяет нам безболезненно и безопасно самое главное передавать секрет то есть наш вот тот Файлик South jsonum мы его снаружи пробросим и он нигде в билде не останется а докер будет иметь к нему доступ mountype Мы уже познакомились И дальше собственно запускаем composer Install который в нашей папочке приложение VP создаст финальный образ со всеми зависимостями и перенесем бьют так это что-то здесь дальше Очень часто я вижу следующую ошибку что если в компании есть несколько микросервисов каждый микросервис объявляет себе набор extension of отдельно пожалуйста так не надо делать сделайте один базовый образ PHP приложения для вашей компании Почему так нужно чтобы каждый разработчик не занимался установкой компиляции пакетов из особняков то есть Очень хочется чтобы пришедшие новые разработчик скачал прям готовый докер образ вашего приложения Единственное что ему нужно было подсунуть волю здесь я представил пример как может выглядеть базовый образ Давайте чуть задумнем Мы всегда используем последние достижения так сказать технологии это будет докер файл мы здесь указываем С какой версии будем билдеться Я указываю восьмую версию по умолчанию это будет 8.1 там какая-то последняя стабильная и вот здесь я еще хочу показать одну фичу наверное все вы уставали писать амперсандик в конце и вот эту косую черту вот с использованием docker файла extension 1.4 можно использовать heardog внутри docker файла И это прям отдельный кайф можно делать определение кода прям удобно и просто помимо этого Можно например какие-то инлайн дефинишные файлов тоже определять в самом докере например конфиг для джинса можно теперь не копий делать а прям внутри онлайн определить Очень круто и вторая фича которая появилась в расширении Докера это копии Линк эта штука позволяет создать не изменить последний ler Да который мы проводим изменения а создать два независимых лэера то есть Первое это то что мы устанавливали второе это то что мы пробросим там будет например настройки phpini но они совершенно независимые И когда вы будете изменять например в приложении настройки PHP для базового образа его не потребуется перебирать компостер просто возьмет аккуратно соберет последний layer и сможет его кэшировать эта штука иногда позволяет оптимизировать производительность и дальше мы теперь перейдем к тому как мы это все собрать здесь принципе ничего особенного нет билдеем имидж Нам нужно где-то в компании поднять реестр зачастую это бывает либо Харбор либо это бывает какие-нибудь решения от github То есть у каждого решения разные здесь выбирать какой удобнее и в своем приложении в каждом конкретном приложении мы уже пишем не фронт PHP 8 до села дефолтные или там fpm она пишем уже From наш образ приложения из компании и он быстро подкачивается мы быстро набьют машинах собираем его все рады и счастливы а следующий концепт который я хотел отметить это использование парадигмы 1 докер файл на одно приложение Почему так иногда бывают ситуации когда попадаются докер файл для разработки докер файл для тестов докер файл для продакшена и в итоге потом думаешь блин А почему тесты падают Оказывается extention это не докинули вот чтобы это все сделать красиво Я с ребятами нашел довольно хорошие паттерн разработки состоящие из четырех слоев у нас есть базовый слой в котором мы оставим все те экстеншины которые нужны прям нашему приложению Но от базового образа компании поэтому зачастую эта секция бывает пустой здесь просто Word где указано а вторая секция относится к так называемым инструментам разработки то есть мы хотим чтобы как мы залогинились нашу докер приложения чтобы там были и гиты композор и чтобы это все работало корректно вот поэтому вторая секция нужна нам для разработки третья секция нужна нам для создания Production образа для cubernet где мы поставим всей зависимости но при этом нам для нашего финального образа заметьте что Production от наследован от бейса то есть в нем нет ни композеры ни Гита в нем нет никаких временных файлов то есть там именно финальный образ приложения вот здесь можно делать еще крутую штуку которая Я не рассказываю но очень интересно это есть плагин для композера который дампит кэш в виде бинарных файлов и мы можем с третьего этапа давайте уже не только код PHP приложения но и собрать уже готовый код окша и запускать напроде уже не прогревая прямо на горячую в хайлоуине где-то Да например а подтягиваю готовую кэш вот отдельно Я хочу подчеркнуть вот эту команду она очень эффективно позволяет работать с композором мы с ребятами не могли найти хорошего способа Пока не наткнулись на вот этот Ман тайбанд с режимом RV не знаю что там делать докер но он делает это С такой скоростью что иногда кажется что это быстрее чем на реальной машине все никогда не видел чтобы композор под докером ставился чуть ли не так же как на хостовой машине придем к следующему этапу это докер компост это Как вы уже знаете наверное оркестратор поверт докером и в основном нужен тогда когда мы хотим поднять прямо Целый рабочий стек в котором будет все необходимое и выглядит этот стек довольно просто мы указываем имя нашего приложения Я всегда рекомендую использовать название Application там название вашего сервиса точка докер и самое важное попросить сделать администраторов которые у вас есть внутренний ДНС домен точка докер который будет реализовываться 127001 тогда очень легко можно прям браузере написать Application точка docker И он попадет Прям туда куда надо и вот здесь когда мы собираем наше приложение для докер composs Обратите внимание как мы пользуемся таргетом То есть если вы помните у нас наша базовое определение для Def envita включала установку китайском позера поэтому мы получим образ приложения который содержит все кроме кода А вот код мы как раз с помощью наших volum of туда и доставим мы сможем очень удобно редактировать наш код и при этом используя тот же самый докер образ чтобы потом опубликовать его на провод и в Production и мы можем подсунуть нашу конфигурацию печки и не по умолчанию в образе лежит Продакшен образ phpiny А вот таким волем мы можем спокойно перепределить какие-то настройки кто сталкивался вот с такой неприятной проблемой На тестах ты пытаешься там ты запустить А тебе в ответ Извините баиньк на порт Уже занят это прям вот частенько ситуация когда мы пытаемся либо там две ветки запустить либо два билда и все как бы приехали кто-то написал секцию порции Вот и с этим Очень удобно работать так делать не надо я покажу как надо и еще одна проблема Когда у нас из нашего докер образа подтягивается XD бак даже если на третьей версии Даже если он в режиме сбора только это все равно так медленно по сравнению с тем же самым пиков что мы долго не могли придумать как нам это сделать и ничего лучше как погуглить мануалы не придумалось идея довольно простая использовать мерч докер компост Definition of и вынести туда те расширения которые нам нужны под конкретную среду То есть если нам нужно что-то по дефразработку поместить это докер compose выбирает яму диск который скопируется потом Файлик без диска тесты в настройки можем положить докер компост и неограниченно создать докер compose любой инвайримент и дальше подтянуть makefile в котором мы сможем сделать подключение нужного файла Вот например что мы помещаем у себя когда работаем в локальном режиме первое что мы делаем а мы добавляем Network нашей компании snetwork нашей компании Для чего нужен чтобы мы в режиме разработки могли поднять один микросервис поднять второй микросервис докере и чтобы они между собой могли ходить при этом в шторме у нас будет открыто два проекта их можно параллельно дебажить супер круто супер удобно мы управляем портами порты мы пробрасываем только в Def режиме заметьте что в основном файлики у меня нигде не было указанной секции портс то есть она существует только на моей локальной машине и только для разработчиков и for Sport может быть проброшен из январями переменной примеру если у нас два приложения они все конкурируют за 80 порт мы можем их раскидать через январь минфалик по разным портам и вот здесь мы делаем еще один трюк который очень существенно ускоряют производительность локальной сборки Обратите внимание на разницу в контексте то есть в первом случае Первое это наш оригинальный Файлик для Примера в первом случае contec контекст равняется точка то есть вся директория нашего проекта и когда мы запускаемся локально нам нет смысла вообще всю нашу папку всю директорию с проектом гонять туда-сюда в докер контекст это долго и это занимает прям реально может минуты занимать Вот и Мы заметили что если мы подсунем пустую папочку в которой будет только докер файл поменяем контекст до папочки самим докером то докеру нужно пробросить всего лишь только дельфинишные докеры А все остальное у нас уже есть как Воля и это так быстро работает что у нас докер композап стал взлетать буквально моментально очень крутая фича а и мы Соединяем наш бэкенд с фронтендом для того чтобы они могли работать если будут какие-то редисы моем каши и прочее мы их отдельно так да пролетел чуть-чуть у нас инжектится январе не твориблы то есть все мы знаем про двух фактора Application обязательно пользуем файлики N для того чтобы пробросить настройки и мы подключаем XD бак то есть мы базу нашем образе XD бак и пиков extension отключаем а подключаем их через такие вот воли мы и создаем собственно Definition нашей сети просто указывает стернутуру один раз ее надо будет создать для тестового инвалимента у нас все сильно проще мы указываем только инвалид файл мы больше не указываем порты поэтому Когда наш бьют запускается на тестовых билдовых агентах мы получаем никакие конфликты и мы указываем Volume которые говорит нам о том что мы используем пиков для сбора cadcovery G вместо медленного XD Бага еще одна вещь которую я тоже хочу вам порекомендовать штука под названием мог Она позволяет для функциональных тестов замок эти все внешние вызовы и вы можете замокнуть все ваши внешние сервисы я здесь написал пару примеров альянсов То есть можно внутри сети Докера ходить прям вот на эти адреса и настроить с помощью php-юнита тест который бы ожидал что к этому сервису придут запросом ответь вот так-то для тестирования маст-хэв Ну и собственно что из нас представляют наши файлики с инвайдерментом это все типично кроме одной переменной о которой Расскажу чуть попозже зачем она нужна Почему в dist файлике мы используем компост Project name вот указываем какую-то конфигурацию шар от Хоста то есть деф режиме мы не хотим постоянно поднимать чистую новую базу данных дав мускуле Мы хотим подключиться на какой-то преднаполненный наш деф сервис sharet Service staging Service у кого-то даже провод сервис но я не хотел бы этого знать вот а в тестовом режиме мы гоняем все тесты только в докере То есть у нас поднимается через докер компост мускул в нем накатываются миграции все живы и счастливы возвращаясь к вот этой волшебной переменной которую мы задаем файлики это возможность сделать как бы namespace то есть если мы указываем эту переменную то докер compose используют значение этой переменной и припендить ее к названиям всех сервисов То есть если указать компост Project name равняется тест и у вас там база данных мускул поднимается как сервис то она так и будет называться тест дефис сиквел дефис один если мы сами ее задаем мы можем использовать ее как средство изоляции нашего тестового элемента от дефенварии мента и что мы можем сделать мы можем теперь сделать очень удобную штуку с помощью моих файла в локальном моих файле мы запускаем докер компост просто То есть он подцепит дефолтные Файлик точка nvid он подцепит дефолтный Файлик докер компост яму И он подцепит дефолтный Файлик докер компота то есть нам ничего не надо указывать а для тестов мы докер компост переопределяем таким образом что у нас теперь передается два файлика дефолтный докер компост яму И докер compost Test которые подключают собственно пиков подключает фаермок и наше приложение работает в расширенном январе да 10 переменных докер compose используется Вот это докер компост это переменная Саша а можешь повторить вопрос Или подожди давайте я микрофон там А то люди которые смотрят нас прямом эфире они не слышат ваш вопрос да или можно можно сдвинуть Ну давай не вопрос тут комментарий получается кроме переменной которая указывает имя окружение можно еще попросить переменную которая будет говорить какие файлы докер конфигурации использовать Да там есть такая переменная она называется докер compost файл Если ты про неё и она действительно есть но почему подошли к этому варианту нам помимо указания докер компост файлов нужно еще пробрасывать файл поэтому Пришли если прописать эту переменную то не нужно будет потом через F пробрасывать это тоже альтернативный вариант второй альтернативный вариант это докер-компос файл инварамид переменная кто-то тоже так использует это как бы альтернативные возможности тут главный концепт поймать для тех кто с этим не работал Им будет полезно и дальше как с этим работать удобно То есть у вас есть главный основной make-файл в котором есть какие-то таргеты и дальше Вы расширяете ваш make-файл читая переменную N То есть можно сделать Make Start указать NF Local или Make Start and Test и вас подгрузится соответственно два окружения первое будет для Def режим работы которая настроена наша базу данных а второй например вы будете гонять тесты которые работают в докере так потихонечку переходим к интересной части она будет довольно сжатая я специально не буду углубляться далеко потому что эта тема очень долгая очень обширная но тем не менее Итак cubernet это следующий логический этап после того как у вас есть докер после того как вы научились докер compose гонять тесты после того как разработчики все знают что такое докер как с этим работать у нас есть кубинец который позволяет нам масштабировать управлять регистрировать нашу докер нагрузку я тут попытался помучить миджорни и загнал туда странный запрос синий слоник летающего облаках состоящий из компьютеров в стиле киберпанк В общем мидерни что-то такое придумала даже проглядывается это где-то вид слона не тот возраст не то мускул не то PHP В общем что-то интересное Какие ингредиенты нам понадобятся для того чтобы сделать наш следующий шажок то есть мы хотим перейти от нашего Докера до режима cubernets Первое это поддержка 12 факторных приложений Я чуть дальше еще я вам расскажу во вторых нам нужно наш докер образ то есть мы его должны каким-то образом на себя pip-плайне собрать и Нам нужен какой-нибудь наш реестр поднятый в компании куда мы этот самый образ положим и скорее всего нам потребуется Head Chart А кто помчался использует пишет класс То есть у нас есть где-то десяток человек которые уже знает как собрать докерта и Туда положить все вещи вот вещей Туда положить действительно можно очень много и я думаю это autoscop мы его текущего доклада потому что там есть куча вещей если будет интересно подходите после беседы поговорим а потом фактор манифест для тех кто не знает это стандарт я бы его назвал разработки современных приложений Поэтому если вы этот стандарт не Используйте то до кубера вы не дойдете поэтому прежде чем дойти до кубера Давайте Посмотрите на вот этот манифест он декларативный он описывает ряд хороших паттерны Практик которые вам позволят сделать ваше приложение гибким масштабируем И самое главное минимизировать расхождение между вашим девелопер окружением тест окружением и продакшено окружением и как правило все современные платформы в том числе kubernets и докер и прочие регистраторы тоже поддерживают я написал тут дефинишный сервис Это довольно простая вещь но для тех кто только хочет заехать в cubernet это базовая наверное сущность чтобы просто создать сервис вам нужно такой яму Файлик вы даете имя своему Application и дальше указываете селектор по которому мы найдем наш приложение и мы указываем порты которые нам нужны для работы то есть сервис в общем случае это абстрактная сущность которая используется губернация для балансировки запросов это балансировщик если под капотом будет запущено много инстансов вашего приложения то сервис как раз выполняет задачу нахождения вашего сервиса Discovery и составление маппинга Куда за этими данными ходить и для того чтобы собственно запустить нашу нагрузку Нам нужен выбирать диплоинт то есть у нас есть докер образ мы его куда-то запушали как теперь снять в кубери здесь все будет довольно просто мы даем нашим дипломиту какое-то имя мы указываем лейблы по которому мы будем следить за количеством инстансов диплоинд позволяет нам масштабировать нашу нагрузку мы можем будущем туда подключать например горизонтальный автостеллеры мы можем автоматически следить за нагрузкой на наш приложение и в тимплейте Мы укажем те же самые лейблы То есть это образ того что мы будем создавать и для традиционного PHP приложения есть два варианта простой первый положить сразу в наш под контейнер с джинсом взять алтайн он самый быстрый самый простой легкий пробросить 80 порт из него и замонтировать Definition конфига который будет посылать запрос на нас backend и нам нужен наш Бэкон phpm для которого нужно будет пробросить наш докер образ это упрощенная версия здесь нету Lines Pro под действием деятельность проб здесь нет термины здесь нет политик безопасности То есть это то что Продакшен нельзя Но это то что позволит вам перейти от состояния был докер хочу кубер попробовать как попробовать написать и потом легковесная версия губернация которая работает по вердокера на вашей машине и можно уже играться с ингрессом с докерами сервисами все это можно буквально за один вечер освоить запуск cubernet и нам потребуется простой конфигмат здесь ничего интересного тоже нет мы указываем что мы будем делать запрос на наш бэкент в наш соседний контейнер работающий в этом поди по умолчанию все контейнеры в рамках одного повода они находятся по локал хосту 27001 Вот и на 9000 нам порту нас будет слушать PHP всё бы хорошо конечно запуском cubernet Но cubernets это вот такая история которая сверху выглядит как вершина айсберга то что я затронул это докер пододиплоинты вот на самом деле все сильно больше и сложнее если мы копнем дальше глубже там уже всякие кастомные ресурсы там пойдут операторы и нет контейнеры управление балансировкой нагрузки промете терроформы И чем дальше тем глубже потом пойдут более 20 вещи политика стивы политики там пойдут истину там пойдут какие-то хитрые штуки которые позволяют делать виртуальные сервисы вообще много чего интересного Ну как правило Чем больше ты Копаешь губернации тем больше понимаешь что для того чтобы что-то рассказать нужно бронировать целый день и тогда можно уже что-то про губернация рассказать поэтому я вот так подумал подумал решил что я это все не осилил рассказать за 30 минутный Слот но я готов что-то интересное Обсудить с теми кто имеет какие-то проблемы с губернатором или запуском приложений в cubernets напротив отдельно на этом все спасибо вам большое за внимание и я хотя бы попросить вас оставить обратную связь рекомендации но сейчас можно позадавать вопросы помучить Да здравствуйте Я самая быстрая рука на диком западе вот я представитель зайду сказали Я представитель Большое спасибо за доклад интересно узнал свежие докере Единственная проблема вашего доклада в том что он рассчитан на локальную разработку и я сейчас попробую пояснить Почему Потому что например в начале Когда вы говорите конечно безусловно очень удобно это ставить одной командой но у вас есть большой риск получить огромнейший образ там гиган на полтора потому что какие-то экстеншны собираются и есть такая проблема Да что у вас получается полуторагивая базовый образ который туда-сюда едет иногда это может быть очень критично вот второй момент по докер композу К сожалению этот докер компост Нельзя просто так взять будет и скопировать но условно на продакшн потому что он содержит часть Билд то есть при поднятии сервиса он будет пересобираться соответственно пришедшие там где вопс ему придётся или это переписать как-то или адаптировать вот Ну и все ваши рекомендации соответственно а моментально ломаются как только мы говорим про переход на куберетесь потому что там у нас уже возникает а-а под которой соответственно надо будет адаптировать все ваши практики и то что вы рассказали остаётся реально в рамках локальной разработки И последнее замечание Да поясняю то что когда вы говорили про монтирование что композитор собирается у нас также быстро локальной тачке Он правда собирается также быстро как на локальной машине потому что фактически эта команда монтируете локальный диск Спасибо Спасибо я думаю тут в принципе комментарии ваши понятны я сознательно выбрал доклад больше в сторону начинающих средних разработчиков потому что здесь основная проблема которая собственно сталкивалась как наверное архитектор приложении крупных что большое количество разработчиков не умеют то есть вот есть вот сюда которые супер хорошо понимает как работает докер куберы которые грубо говоря знают как это сделать правильно есть разработчики которые мучаются вот я видел как раз вот категорию ребят которые мучаются и цен моего доклада это как раз таки дать во-первых первое свежие знания касательно того как с этим работать некоторые паттерны очень хорошо и быстро помогают вот а всё то что касательно запуск там безусловно Всё нужно по-другому то есть из того что я оставил бы для запуска в Руди это докер файл и его последняя версия мы делаем Production образ в котором копируем бинарный обход приложения в который копируем в redonal-режиме в котором навешаем политики безопасности в которой мы навешиваем как я уже сказал кучу чеков на reddines чтобы мы могли принимать нагрузку тогда когда это надо потом мы навешиваем туда кучу штук касательно мониторинга Нам нужен туда завести скраппинг метрик Прометея я могу об этом говорить очень долго Поэтому я хотел пояснить правда мне понравился доклад я хотел подсветить тот момент что создавая создавая удобства для локальной разработки вы одновременно перекладываете даете очень много работы диопс команде если Такая существует просто это подсветить хотел безусловно где-то должен быть баланс Потому что есть замечательные Утверждение что разработчики диоп с командой - это одно целое и поэтому невозможно одним сделать продакшене а другим невозможно самим сделать какую-то платформу для себя которая будет сложна для разработчиков Поэтому да где-то будем балансировать находить варианты где-то ругаться где-то дружить но как правило Я считаю что все надо челленджить пусть команда приходит челленджи devops of пусть devopse приходит челленджит разработчиков тогда появляется что-то хорошее Да тут вопросик Александр Всем большое Валентин компания Соколов есть маленький комментарий по поводу пакета млокате про который вы сказали что можно скачать Мы к нему пришли Когда у нас стал падать пекал Мы просто не могли получить оттуда Ну образы того 404 начала Давайте непонятным причинам И причем 50 на 50 но теперь скорее всего ошибка связана была с тем что вы исчерпали количество запросов с вашего токена на github вам нужно либо Поставить кэширующие все прокси либо подсунуть четкую чтобы вас не натыкалась на лимит Я предполагаю что там проблема может быть в двух первая вам администраторы поставили Firewall и закрыли трафик наружу это очень часто и нужно с этим знакомиться знать там конфигурацию как ее прописать правильно использовать Я тоже с этим сталкивался иногда когда создают вокруг белдовой машины чтобы не уходили там код и кодовая база виртуальный периметр защищенный и действительно можно получать ошибки А когда начинаешь курлом то есть самый простой вариант проверить почему 404 сделать курул вербос зайти на машину где происходит Билд и посмотреть дернуть что происходит урлом и тогда сразу там видно откуда прилетел ответ почему он прилетел и в общем как-то его погибать Спасибо попробуем и Вопрос вот как подружить разработчиков ко мне пришел мой сказал сделай мини-куб локально чтобы у нас были общие черты и вот это вот все Если честно сходу не получилось может быть эти рекомендации куда покопать посмотреть чтобы у нас были общие настройки для получается губернация локального мини-куба Спасибо Да здесь смотрите здесь рекомендация такая Если вы идёте в uber то первое чтобы рекомендовал если вас стек гетерогены то есть PHP приложение да то идеальный вариант сделать один ханчард Хоум чарт сделать в отдельном репозитории куда есть доступ у диопсов и разработчиков и дальше сесть вместе с диопсами обсудить Как вы вместе с ним работаете То есть туда надо иметь возможность засылать пол request и работать вместе с ним еще важный Аспект обязательно для каждого хлам чарта Используйте семантическое версионирование у холма Есть Прикольная штука когда вы указываете вершин там можно также как в композере передавать шапочку типа последняя минорная версия из Мажора этот механизм очень удобный Почему Потому что если вы в рамках разработки Хэм черта делайте обратно несовместимые изменения Билд пайплайн который завязан на версию холма там по мажору единички он продолжит работать вот мы таким образом сделали себе способ как можно чарт развивать его контрибьютить но при этом не ломать вся сиди пайплайн сам себя сиди пайплани у нас тоже был описан в коде и когда мы вносили какие-то изменения мы потом приходили и также заслали пол request дивапсан на обновление пайплайна Вот еще одна рекомендация которая наверное дам не делать отдельные чарты под приложения это прям боль я столкнулся с тем что пришлось обновлять больше 90 репозиторов И после этого понял что универсальный чарт Это правильный ответ А если совсем на будущее посмотреть к чему идут современные тренды то сейчас новый подход это оператор То есть вы берете дело пса который использует например shell-оператор от того же фланта и он под вас пишет ваш класс теперь не сервисный дипломмент А вас там сервис и под него описаны все то что будет ставиться и как будет ставиться и вот там на самом деле безграничные возможности по управлению это вот то что я думаю будет трендом ближайшие пару лет можно коротко пожалуйста Я постараюсь максимально коротко Спасибо за доклад узнавал себя во всем даже в make-файлах вот О чем хотел спросить есть такая технология которая не особенно популярна Я когда назову минимум 10 человек так на меня покажут пальцем и скажут фу но она позволяет обойтись без кубика и Она позволяет буквально одной командой после докер компост закинуть в кластер это докерством да докер диплой и у вас все полетела ваши отношения к ней и если можно ваше тоже я использую тестовом контуре Да спасибо за вопрос про докер сворум его действительно обделяют Я наверное нахожусь на той стороне которая выберет вариант cubernet потому что для меня докер композ это урезанная версия cubernet то есть вроде декодернецы не дожили а докер мы знаем и получается вроде можно там с кучей упрощений заехать в проты оно будет работать Даже но опять-таки сейчас большинство современных провайдеров облачных не облачных все предоставляют услуги именно менеджер cubernets и к чему как бы мы приходим сейчас да как компания которая работает в мульти дата-центрах мульти регионов которые там строят свои решения по всему миру нам неудобно менеджить всё самим А это автоматически означает что у нас есть вариант менеджер докер sworm это тяжело его никто не делает то есть докер сувором это вот ваша там локально какой-то сетап он будет работающим он в принципе состоятельный но он имеет свои ограничения Саша спасибо большое Выбери пожалуйста автор самого интересного вопроса Я наверное думаю про хэлм было очень интересно это наверное правильный вопрос который я Да Это кто хорошо пожалуйста вручите подарок человеку который сидит в третьем ряду и у нас еще для тебя есть небольшой Презент Спасибо тебе большое за контент Ты уже в очередной раз все конференции проходят с твоим участием в качестве докладчика Спасибо тебе большое бессменный докладчик но я думаю что это мой крайний раз вот потом Ждите меня других конференции Спасибо тебе большое Презент С вами был Александр давайте поаплодируем и мы прям очень скоро будем выпускать на сцену"
}