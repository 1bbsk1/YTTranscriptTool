{
  "video_id": "d-H2K4I7-jk",
  "channel": "HighLoadChannel",
  "title": "flux, flux и в production / Виталий Медведев (ЦФТ)",
  "views": 4565,
  "duration": 2828,
  "published": "2021-10-04T02:49:44-07:00",
  "text": "меня зовут виталий медведев я работаю в компании центр финансовых технологий сегодня я вам расскажу о том с какими проблемами мы столкнулись в процессе diplo приложений продакшен когда у нас появился кластер к 8s ну и собственно как мы их решали для начала нужно немножко рассказать о том как все начиналось как все развивалось и что именно стало узким горлышком начиналось все достаточно давно в 2003 году мы стартовали на железках солярой их был достаточно немножко сервисов тоже было мало это все были монолиты инфраструктуру нам предоставлял снежный отдел то есть никаких прав у нас не было кроме как за тепло ит-сервис поднять его перед стартовать вот вот так и никакого автоматизации тоже никакой не было то есть все де пользоваться руками артефакты были абсолютно любые то есть это могли быть жарки какие-то конфиги и соответственно все весь процесс установки мог занимать несколько несколько недель и две недели это было достаточно быстро все изменения в продакшн вносились только через а псов в четырнадцатом году мы поняли что так дальше жить нельзя начали нашу первый этап трансформации во-первых инфраструктуру стали готовить мы сами на базе виртуальных машин в качестве configuration management нами был выбран паппет соответственно количество сервисов тоже увеличилась это монолит начал распиливается на микро сервисы но у нас уже появился более менее стандартизированный процесс то есть вся установка у нас происходило через по пять либо через какие-то самописные утилиты большая часть конечно только папе там появились стандартные артефакты это лпнп и какие-то рецепты на попить и которые описывают что нужно с этими ребенком и сделать и какой конфиг должен быть у приложение естественно очень сильно сократилось длительность то есть теперь один час это стало уже много но все равно большую часть изменений делал дело эксплуатации кроме этого микро сервисы принесли такую головную боль как микроменеджмент то есть их стало много их нужно обновлять обновлять желательно без простое всем им там нужны маленькие базы и маленькие там каши для каждого микро сервиса стало достаточно много микроменеджмента чтобы от этого избавиться в 2017 году мы решили что следующим этапом развития нашей инфраструктуры станет губернатор и семнадцатом году мы начали в восемнадцатом году мы запустили первое предложение в камере это был февраль и вот значит 5 инженеров собралось один выполняет фильмов горы хиллман стал у нас взлетает приложение взлетает бег взлетает фронт какой-то там прокси для него редис rabbit и все это за 15 минут все быстро все круто прям отлично тогда мы решили что он от нас это устраивает естественно никакого процесс у нас тогда не было но план был примерно такое же использовать то что у нас уже была то есть установка должна была происходить через helm of great артефактом является чарт а изменения на продакшн всю также выполняет сотрудники отдела эксплуатации и в общем ожидании у нас были такие что у нас будет волшебная кнопка мы не нажимаем и все происходит все отлично все хорошо прошел год всё было не так конечно на самом деле за этот год у нас было гораздо больше мячиков но они все нецензурные поэтому я нашел такой самый были менее нормальный и ставила почему это произошло во первых у нас очень сильно вырос штат разработки то есть на команду из-за псов в количестве шести семи человек приходится порядка 200 разработчиков эти разработчики попробовали один раз кубер над всем понравилось все быстро diplo это все быстро масштабируется скейлится в 5 10 20 реплик сколько тебе нужно деплоить в тест df стейджинг тоже особого труда не составляет соответственно количество версий количество релизов увеличилась кардинально той если раньше у нас был там 30 релизов то в пиковые какие-то месяце могло быть и 200 релизов в неделю нужно сказать что цикл как бы работаю в отделе эксплуатации устроен так что инженеры выходит на неделю в течение этой недели он занимается операционной деятельности то есть он занимается тем что обновляет какой-то там откатывает накатывает хотфиксы вот в общем такая операционная работа и получается что нет автоматизации всего этого дела то есть все выполняется руками происходит ошибки при накате то есть у нас был случай когда есть сервис а и этот сервиса обновили чар там сервиса б сервиса просто не стала слава богу там был trial ничего страшного не произошло на звоночек был тревожный и кроме этого у нас в инфраструктуре изменений тоже никоим образом не не фиксировались то есть задача выполнялось также руками что-то там про велась на через полгода забывалось кто к 100 зачем как это все делал и в итоге получилось что неделю инженер занимается обезьяне работой он делает helm of great говорится сотруднику сопровождении проверяйте тот проверяет он говорит о кей закрывая заявку берет следующую снова делает helm of great у него там 5 поляков поднимается он смотрит так какие поднялись проверяйте следующий и так бесконечно то есть это ужасно это на я думаю у всех все знают что такая работа она выматывает и ты просто ненавидишь и мы решили сделать хорошо чтобы сделать хорошо нужно понять что нам нужно во-первых конечно после того как мы попробовали паппет когда у нас все конфигурация лежит в git репозиторий infrastructure за код это первое что нам было нужно во вторых нам нужно чтобы все изменения они фиксировались то есть поскольку мы как бы финн тех то у нас есть требование регуляторов федеральных законов службы безопасности у нас их несколько штук внутри компании нужно чтобы все наше решение которые мы выберем она всему этому соответствовал и не хотелось бы чтобы на тесте у нас диплом по одному на bayou по другому то есть процедуру развертывания должна быть абсолютно одинаковая что на тесте что в дэви что австрия дженги что в продакшене и вот одним из уроков которые мы извлекли из того что когда мы начали внедрять паппет нужно сделать так чтобы не было революции то есть если ты придешь командам разработки скажешь ребят мы на новую штуку нашли она крутая но надо все все все сломать чего сделали и с нуля построить прекрасный мир будущего так не работает ну то есть работает но это очень долго больно я дорого нужно чтобы решение которое мы выберем она эволюционно развил эволюционно развела то что у нас уже есть и как бы похоже что тем что нам было нужно это был detox кто-то вообще в курсе что такое биток а кто пользуется инструментами ну неплохо на самом деле в общем для тех кто не в курсе я так кратенько пробегусь по принципам detox то есть основной принцип гид это источник правды и соответственно все изменения которые происходят в кластере они происходят только что дал как эти изменения оказались детей и соответственно никакой разницы между процедуры диплом в разных окружениях быть не должно и существуют две основные модели detox и это push & pull первое на что мы первое о чем мы подумали что наша весь код уже в репозитории там уже есть соседи инструменты то есть давайте просто вот то что у нас есть разовьем и получим ту самую push модель которая как бы состоит в том что человек коммитить какие-то изменения git репозиторий теги рица какой-то pipeline этот pipeline эти изменения применяет наш кластер сначала там тестовый station боевой я думаю классическая схема которую знает все мы так подумали и сразу же поняли что это невозможно потому что у нас много разных систем управления репозиториями то есть у нас есть гид лап у нас есть стаж у нас есть m-city ешь devops еще что то там и они разные везде разные подходы очень тяжело разные системы разный инструмент всей сети это опять же какие-то гид лап райнер и агенты bamboo дженкинс агенты тем сити вот их очень много какого-то одного лишь одного стандарта нет при этом они большая часть этих инструментов они располагаются не в продакшен сетях то есть у нас требований безопасности такие что есть production все эти защищен защищенном сегменте и не production сети получается что вот эти систему допустим тот же стаж он находится в корпоративной подсети его администрирует на уровне всей компании у нас нет там больших полномочий и соблюдать в этом случае требования регуляторов и и б достаточно сложно можно но сложно кроме этого команд много порядка 50 и есть команды там из двух человек который вот или какой-то маленький сервис они знать не знают как там настраивать эти и pipeline и они кому-то когда-то пришли им там помогли или вообще никому не приходили и руками тепло и то есть сборку у них какая то есть а деплоя не осуществляет руками получается что кому-то нужно будет взять на себя в этом случае обязанность поддерживать весь вот этот pipeline от начала и до конца pipeline как бы штук живая его нельзя сделать один раз и потом вы оставить его на на полгода как как ни в чем не бывало там постоянно происходят какие-то изменения а если ты не в контексте то уже через неделю очень тяжело понять что же зачем как происходит и мы опять же возвращаемся к тому что людей в отделе эксплуатации мало если мы примем на себя эту обязанность то мы будем просто заниматься тем что поддерживаем эти самые pipeline и таким образом уж модель она хорошая но нам она не подошла что собой представляет пу модель prep у модели обычно внутри кластера находится некий оператор он конечно может быть вне кластера но чаще всего размещают именно внутри этот оператор периодически pulid изменение которое нах улиц состоянии git репозитория и применяет его какие преимущества дает нам это эта модель во-первых мы начинаем использовать единую систему управления репозиториями это гид лап это гид лап в котором управляем мы соответственно мы можем достаточно гибко настраивать доступ внутри этого гид лобо плюс доступ самого оператора внутри кубер нету со используя стандартный рыбак cabernet из дальше получается что все вот эти инструменты то есть edit лап или боевые кластер и и оператор которые находятся внутри они находятся внутри production сетей по взаимодействия между ними проблем меньше то есть там уже согласованы какие-то доступа и блага слева это все получила благословение б то есть соблюдать требования становится гораздо проще упрощения кроме этого под капотом у стыка который мы выбрали его флаг сидит у него используются достаточно простые инструменты то есть это куб стиль и фильм ну а я думаю что коммитить в git репозиторий любой разработчик умеет то есть для разработчика достаточно просто и прозрачно он формирует один яма файлик комического в репозиторий далее через куб стиль этот файлик попадает в кластер дальше происходит установка через щель и еще один немаловажный фактор что это решение достаточно просто масштабировать если нам нужно оператор снимите немножко другими какими-то параметрами то это обычный тепло и внутри губернатор меняешь параметры разворачиваешь рядом за пять минут у тебя новая копия чуть-чуть другими параметрами в общем подумали мы подумали решили надо пробовать в итоге у нас получилось вот такая большая схема она окажется достаточно сложной но если рассматривать то как она развивалась то все будет гораздо проще началось все на самом деле с да то есть нам нужно вот из этой схемы поправить вот такие вещи то есть на старте у нас кластер админ полностью руками диплом все все все все что есть в кластере то есть это как какие-то ресурсы губернатор обычные ямал файлы так и чарты то есть другого способа diplo у нас в компании просто нет то есть это либо чарт для прикладных приложений приложений либо какие-то инфраструктурные вещи которые могут задаваться я бликами началось все с задачки по автоматизации мониторинга то есть когда мы только-только начинали готовить нас кластер мы выбрали в качестве решения по мониторингу про metals оператор соответственно prometheus оператор это решение которое позволяет вам автоматизировать мониторинг поскольку в кластере все динамически меняется нужно автоматически настраивать discovering понимать когда под и удалились когда они создались и добавлять их в параметре с автоматом делать это руками это тяжело больна и неправильно про митоз оператор оперируют кастомными ресурсами то есть все все все все все все что он делает она происходит через кастомное ресурсы изначально мы получается дипломе все эти к основные ресурсы вместе с чертом а чтобы за деплоить этот чарт нужны широкие привилегии кластерного уровня и все изменения в мониторинге проходили через нас когда приложение было немножко это было просто когда приложение стало много то в день там нужно было сделать 10 допустим изменений и инженеры за эксплуатации сережа вот он приходил ко мне спрашивал mucho к этим вы чё катим и так 10 раз день потом в итоге этот значок этим стало стикером в нашем sticker потери с фотографией сережек и что мы сделали мы решили что управление всеми этими кастомными ресурсами нужно отдать под flags план был такой то есть у нас есть не успеть мониторинг в него устанавливаем flags который будет входить специально созданный git репозиторий забирать оттуда я блики в в простом виде без всяких там кастомайзинг shablon шаблонов еще что-то простая блик и применять его в внутри кластера сказано сделано в итоге у нас получается такая схема сотрудник саппорта когда ему нужно поправить там ни на одну буковку v опечатку там какой-то параметр в запросе он комитет в репозиторий flags обнаруживает что там есть изменение применяет их и через там пару минут у вас новая конфигурация внутри кластера все счастливы то есть ночь укатит больше не стала люди смогли сделать изменение сами нам стало проще отлично на все это ушло 2 часа времени это было сделано очень быстро что мы сделали дальше мы просто масштабирование то на уровень выше то есть мы использовали точно такую же схему для своих инфраструктурных вещей то есть теперь какие-то кластерные роли какие-то политики что-то еще она у нас хранится в git репозиторий и точно также синхронизируется то есть мы точно знаем что у нас это не исчезнет даже если мы удалим какую-то crd жку да это больно но она поднимется автоматом там через пару минут вот осталось автоматизировать вторую часть то есть это установку чартов с чатами все немножко сложнее конечно же но востоке флаг сиди есть второй компонент который отвечает за установку чартов это фильм оператор фильм оператор это фактический binary на гол который обнаруживает также кастомные ресурсы называемый фильм релиз и устанавливает их удаляет изменяет в общем все что вам нужно кастомные ресурсы это фактически просто описание того какой черт какой версии и откуда вам нужно куда установить то есть он достаточно простой получается если нам удастся используя фильм оператор автоматизировать вот эти шаги то светлое будущее о которой мы думали она в принципе это окажется ближе чем кажется получается мы опять же выбрали тот же самый namespace мониторинг как подопытного кролика потому что там достаточно много мелких чартов то есть это все всевозможные экспортеры боты которые как бы важны но на бизнес напрямую не влияют и их можно спокойненько пошатать и то есть получается что у нас тот же самый репозитории в котором хранились кастомные ресурсы для про метался мы будем добавлять в них описание тех релизов как тех кем релизов которые мы хотим видеть в нашем кластере они через flags будут попадать в кластер и с помощью оператора будут устанавливаться опять же сказано сделано там буквально за неделю мы целиком весь на in space мониторинг перевели на новые рельсы точно так же там член какой-то команды у которого есть права на пуш в этот репозиторий вносит туда изменения flags применяет himmel ist который он хочет поставить фильма мир от фильм оператор это обнаруживает и устанавливает при этом нужно сказать что нам не пришлось переустанавливать ни одного chart то есть мы просто взяли то что у нас сейчас есть описали это в виде яма файла филлис и операторы обнаружил что эти релиз уже существуют подтянул их свою конфигурацию и начал ими управлять отлично конечно же мы просто масштабирование то на уровень выше и теперь у нас получилось что у нас есть один namespace и целиком инфраструктур на кластер которые целиком управляется через git репозиторий осталось масштабировать это на прикладные сервис то есть мы выделили там порядка 15 мин space of как-то логически их разделили чтобы ограничивать потом доступ чтобы внутри находились сервисы логически друг другом связаны и теперь осталось только сзади плоть туда flags и фильм оператор и конечно же мы не стали деплоить это руками а с помощью системного фильм оператора мы создали там 10 яма файликов вас появилась 1010 операторов там за 10 минут очень быстро очень удобно очень просто вот такая схема у нас в итоге получилось на всю эту схему на ее реализацию ушло около месяца при этом наверное недели полторы мы просто сидели и ждали не ну не может все быть так просто но оно должно сломаться ломайся нет ничего не ломается все работает все работает как нужно все все все просто все хорошо по репозиторию мы максимально упростили его то есть у нас там 2 папочки папочка production в которую мы складываем фильм релизы либо какие-то ресурсы губернатор и вот пример как выглядит him релиз то есть четыре строчки которые описывают что нам нужно вот взять чарты с git репозитория риф у него такой то путь в git репозиторий такой-то все после того как этот файлик появляется в репозиториев через пять минут он установлен на bayou аналогично у нас сделано для теста stylish разницы что фильм релиз для теста то может содержать какие-то переопределения окружений то есть в и льюс для хелен chart что у нас в итоге получилось во первых временно deploy сократилась 60 раз основное время которое занимало это это было ожидание с того момента как разработчик передал готовую версию до того момента как она будет установлена на бой то есть ожидание могло быть неделями потому неделю потому что фактически там все просто но у инженера огромная очередь таких простых заявок которые нужно выполнить нагрузка на инженеров эксплуатации в 10 раз упала то есть было 500 заявок стало 50 тех которые ну пока мы еще не автоматизировали я считаю что одной из основных основных достоинств стало то что ни один из релизов на мне пришлось переустанавливать то есть мы все это делали днем без простое просто мигрировали с одних рельсов на другие у нас появился infrastructure языков для нашей инфраструктуры для всех наших кластеров то есть и все наш кластер управляется абсолютно одинаковые если нам понадобится еще один кластер то мы просто установим туда системные компоненты укажем убит репозитории и вся вся вся инфраструктура namespace и какие-то crd жки кластерные роли в общем все все все что мы вот за три года наворотили у себя она окажется в пластыре там в течение 10 минут и неожиданным стало для нас то что у некоторых команд появился сидит то есть раньше они точно так же тепло или руками в основном это вот команды где очень малое количество человек после того как у нас появился стык флаг сиди у них это все стало автоматизировано то есть какие в итоге процессы у нас появились установка стала выражаться в том что разработчик создает мерче квест который потом применяет человек у которого есть права в git репозиторий артефактами это все также чарт плюс himmel из длительность максимально это 15 минут все достаточно быстро и наверно основное это то что теперь деплоить может не только сотрудник отдела эксплуатации сопровождении которое фактически обладала всеми теми же правами кроме изменения плюс у нас запустился проект когда для каких-то некритичных сервисов мы дали эту возможность команде разработки то есть теперь даже сопровождение в этом процессе не участвует разработчик сделал новую версию сделал мер сиквест какой-то ответственность самый-самый сотрудник из-за его команды посмотрел его применил новая версия на бою отлично то есть ускорение просто колоссальная но без ложки дегтя не обошлось первое это обзор выбелить это есть в первых версиях фильм оператора и факсов не было даже метрик prometheus а и то что у тебя происходит нужно было заходить и смотреть в логах сейчас как бы метрики появились появились дашборде и можно зайти на дашборд посмотреть статус своего релиза появился новый репозиторий с конфигурации с одной стороны это минус потому что их стало больше с другой стороны плюс потому что в одном месте ты можешь посмотреть состояние твои системы и фильм остается фильмом то есть фильм не очень хорошо работает зависимостями поэтому если какие-то большие комплексные чарты которые там стоят 10 20 30 микро сервисов со всеми зависимостями тут нужно хорошо протестировать посмотреть что все это правильно работает и в некоторых случаях мы просто в итоге все зависимости разряжая разрешаем заранее и фильм оператор не работать зависимостями так и быстрее и проще ну и какие выводы я хотел бы вообще подвести итог и tops оказался гораздо проще чем кажется то есть нам потребовался месяц чтобы с нуля поднять всю нашу систему рабочую которую мы не изменяли вот ей уже полтора два года и мы ее не изменили получается что после того как мы ее создали там начался процесс перехода прикладных чартов на эти рельсы он немножко конечно более затянут по времени чем месяц но в целом он тоже достаточно простой потому что со стороны разработки изменения минимальны раньше они вот этот чарт складывали куда-то в nexus чарт музеем теперь они фактически просто его кладут git репозиторий и указывают в фильм релизе какой тариф то есть все это делается я им там минимальное участие людей во вторых развивайте то что существуют потому что я думаю что если бы мы просто перечеркнули все что мы делали за год и начали с нуля ничего хорошего бы за это не вышло во-первых мы его по-любому с кем-нибудь поссорились между командами начались бы недопонимания во вторых это дорого и больно ну и в третьих серебряной пулей нет то есть то что получилось у нас в вашей инфраструктуре может быть по другому поэтому смотрите как это у вас используйте с максимально плюсы push-pull методов пробуйте начните с малого и вас все получится на этом у меня все спасибо за внимание вопрос как у нас серия вопросов так где наши помощники давайте сначала примут рядышком внизу главарей спасибо за locate за спасен компания плеск на слайдах вас написать мастер админ а каким образом вы вашего первичного доставляйте это может быть одессе какой-нибудь или вы всем даете сертификат я вот после класс ты разбил был провал по звуку по звуку не расслышал каким образом вы даете доступ вашим а перенос в кластер это ай би си или вы даете сему кластером сертификат вот у нас по сертификатам вот есть почему так давайте где-нибудь по серединке стараемся по максимуму от ведь есть ли вопросы из онлайна получается есть только два окружения тесте одно тестовое окружения один продакшен нет никакого знака стран нет нет конечно же есть просто у нас в кластере который в основном предназначены для разработки там иди встань jing тестом мыши какие-то дыма окружения то есть их там много но все они вот диплом по таким же этим вещам просто все это разделяется на этапе фильм релиза то есть у него есть несколько выльют файлов в котором указано верой до для окружения а как выглядит непрерывное тестирование тестирование процессора перед тепло как обеспечивается надежность кода и вот это на самом деле в зависит от команды то есть они сами решают как им это сделать вот мы решали задачу именно теплее именно тепло и того как она окажется в итоге в продакшен и чтобы это было точно так же на тесте паркета проверки проходили никаких я просто мастер и есть так или порцию я занимаюсь только вот operations я не могу сказать как это реализовано в командах на этапе тестирования просто обычный всякий кто знает что там в процессе выпускается либо смог тестировать и based on the thirst я думаю на самом деле это все запускается потому что в основном в тестовых средах весь процесс диплом через все и проходит то есть я там делает изменение в теме лизе пушистых в репозитории а дальше ты уже запуска тельства этом следующий какой ты там спасибо так давайте рядом вот сзади стараемся по максимуму ответить на вопросы привет топ он так что все у гитлера можете погромче да rigid abs предполагаю серги те вопрос клиентами тот же самый первый у нас волт а но тогда он не у кисти варварский полноценный бетон но почему у нас секреты хранятся в болте и получается что внешняя система то есть у нас же не только кубер нету у нас еще что-то и нас секрет хранятся в одном месте у тебя в чарте указано откуда брать все так хорошо так коллеги у кого еще вопрос кажется github завоевать не про то что все в детей дочитала по ты управляешь какими-то клауд на эти в средами через гид просто получается что если говорить о том что все таки те ты не можешь поставить туда оператора когда у тебя еще ничего нет у тебя голый кластер но какие у тебя есть git репозиториев которого лежит оператор она и никак не связаны тебе все равно нужно руками туда поставить что чтобы она начала работать без микрофона вот я думаю на самом деле я понимаю но это это скорее философский вопрос спасибо за доклад виталий семён java разработчик компании мтс вот такой вопрос к вы внедряли вот эти все подходы но и так понимаю что за дела много команд впоследствии было ли какое-то сопротивление со стороны разработчиков обсох что ты не хотят меня существующие процессы и возможность нужно много для этого переделать и они бы все оставили как есть были такие проблемы до на самом деле вот прям каких-то вот кто плыл ногой сказал что нет не было то есть изначально было такое что не нова опять какую-то новую штуку придумали опять на учет переделывать но собирается встречи мы говорим вот смотрите так так так и так они говорят у нас вот такие у нас вот такие у нас это работает вот так то есть мы вместе обсуждали как это сделать удобный им и нам но основная просто цель того что никто не хочет ждать неделю когда твой продукт зарелизить то есть вот его подготовил у тебя все готово у тебя там уже следующая операция утащу старая версия не выкатили на все понимают что это направлено не для того чтобы нам стало хорошо а это чтобы всем стало хорошо поэтому до пришлось что-то переделывать но это но не было такого что ребята там год свой сей выстраивали pipeline и написали мы пришли они такие все все все с нуля перестроили не то нет небольшие изменения внесли и и она работала то есть в целом потом через полгода-год мы собирались спрашивали ребят как я не помню что кто-то сказал это все вообще отстоем мы не хотим то то есть у всех был положительный feedback так давайте вот сюда у нас коллег и вот здесь уже давно ждут ну и потом еще я думаю вопросы 3 и на этом да здравствуйте меня зовут анна и у меня вопрос плане вот вы рассказали что берется кластер вот и инфра строчи закат github откуда берется кластер я не понял вот пустой кластер он откуда-то взять вот как предлагал человек мушкетера форма у вас как у нас начиналось все с версии 17 или 18 очень давно когда только кубе адам появился соответственно у нас там еще не кубе спрей не было толком ничего не было то есть мои deeply или его руками потом плюс как-то еще внутри автоматизировали то есть мы через кубе адам реплеере plaster ok откуда там берется flags все-таки руками до flags тоже руками ну не все полностью автоматизировано у нас просто мы не диплом кластере каждую неделю и слепых тепло или каждую неделю когда помрёт автоматизировали у нас просто нет такой задачи то есть они достаточно редко появляется новый этом поэтому но я к тому что инфра страхе за код все таки хотелось бы увидеть наверное как создание кластеров где будет такая задача если мы будем каждый день диплом кластер мы это сделаем то есть за все нужно что заплатить свою цену конечно можно упороться и сделать вообще все по кнопке но бизнесу даю нужны фичи бизнес нужно что все было стабильно работала поэтому вот установка кластеров языков мы пока просто ну это не самой приоритетной задачи окей а в плане приложения может быть приходилось сталкиваться с таким чтобы приложение окружение под приварен создавалась ну тот же namespace и умирал то есть динамическое динамическое вот я скажу что это самого начала как только у нас появился кластер у нас эта мысль сразу возникла она все еще в процессе то есть я думаю когда-то в какой-то в какой-то итерации мы к этому придем окей просто это наверное решает вопрос очереди на окружение если народом назад то просто смотрите какая мы в основном предоставляем наш пластыри как платформу для команд разработки а команды разработки уже внутри себя сами решают как им удобнее это сделать если у них появляется какая-то идея которой они не могут реализовать сами они приходят к нам дальше мы уже совместно решаем как это сделать то есть у как бы пока главная главная проблема вот того что говорите это удаление старого разработчик он легко тепло и но удалять он не хочет то есть она потом там месяцами может болтаться потреблять ресурсы и вот есть такая проблема окей и последний вопрос если вдруг не дай бог разработчик пришел и говорит вот у меня есть версия приложения на я хочу работать с другой версии приложения на что я свою выкатил и выкатилась это вот такого не было никогда просто вы хотите вы рядом ты всё автоматически создать фильм релиз которым одна цифра к будет отличаться версия 2 здесь версии 3 нет модель немножко не то получается ломается здесь мы забираем когда коммент был у нас обновился релиз а мы хотим пнуть в этот момент чтобы запустился еще один где была я вот правит не совсем понял я там у эту можно будет обсудить этого потом спасибо передайте рядом коллеги и потом будет мы наверное пару вопросов возьмем из центра зала отдаст спасибо за доклад был еще раз вопрос по поводу того как вообще идеал токио flags ты когда все что ты хочешь тепло и должно быть в гите она напиться именно на а вот эфемерные окружения то есть те же самые first реджекты мы хотим чтобы они варились моментально многое и бесконтрольно возможно определенных прицел ну мы пока они решали такую задачу вот прям чтоб я сказал что не сделали но ты сам операторе нету каких-то масштабных функции ну тут скорее всего какой-нибудь наверно верное нет тут просто еще сейчас активно разработав разрабатывается flags в 2 который очень сильно сильно увеличивает его возможностей может там это есть но я думаю что если посидеть и подумать можно сделать спасибо то есть можно можно автоматизировать создание проекта в гите тепло и там флаг со и все как-то там все это можно сделать я думаю с сего запад и несколько вопроса можете погромче орда 1 это как паук del решила проблему с малыми группами там два разработчика вот такие то типа вы опять все поменяли нам нужно постоянно менять версии run the home чартов или еще чего нибудь ну вот да для них то на самом деле особо ничего не поменялось то есть вот просто вот у них два разработчика они что-то новую версию выкатывают как бы дело в том что регламенты требует от нас чтобы весь этот процесс был задокументирован то есть они всегда создают заявку они раньше создавали заявку в которой указывали что эксплуатацию abs берешь вот этот чарт и устанавливаешь его ну то есть они все умеет писать home chart да ну точки как бы если они не умеют то приходит там делимся опытом то есть нет такого что там просто было момент что припой написать это сложно а типа home чарты это легко мне кажется hell charged гораздо проще чем pipeline руки разные репозитории под конфиг при этом пол модель мне вот интересно перри собрали порт новый динаре где-то лежат кстати где а потом обновляется конфиг обычно но комитет икоты конфиг и все сразу там вот экшена не будет когда binary ричи не сбил делись а конфитюр жирной и россии что он пытается куда-то развернуться там никаких таких проблем нет просто deploy происходит на последнем этапе то есть только после того как я все сбил билось когда у тебя есть докер-образ только после этого вносит изменения в репозитории происходит на кад ну то есть это разработчик сам должен дождаться пока рбу билд и и после этого уже пометить конфиге на самом деле у нас разработчики в тестовых средах а не руками там ничего не комитет все делать я незачем это делать разработчику если вся и может пойти взять один файлик и поменять там циферку то есть все таки есть пища я сейчас не буду есть почему в этом вся и нельзя и целом чарт потом закомитить непосредственно давайте да можно на это будет работать только в тестовой среде потому что нельзя это масштабировать на боевые среды потому что там доступа которые тебе не открою то есть потому что там вот эта система которая не имени может иметь право в боевой кластер not у тебя есть какой-нибудь build агент который не может боевой кластер просто и заносить изменения вот и все то есть напрямую сходить в порт и закомитить губернатор ресурсы нельзя сложить их гид ровно такие же ресурсы чтобы его автоматика туда снова и смотреть на это можно дать а где у вас есть эти системы то с чем работать она сработает git репозиторий есть право на доступ гитри безмен но там же 2 git репозиторий появил вон он находится в той же самой системе данных другой почему можно сделать хотя но по факту это будет то же самое то есть какие-то повернитесь ресурсы из не доверенной сети оказались напротив сити в одном случае они оказались опосредованно когда сам губернатор ну то есть что-то в губернатор сплотили их забирает и подсасывать себе складывает применяет опять-таки абсолютно не доверены потому что кто-то их там не доверенной сети здесь сложил или из той же сети просто напрямую и закомитить так они benny за комитета у тебя будет мертв сиквест на бой на бой просто так ничего не уедет то есть без человека который отвечает за это в тесте да это можно в тесте да можно но на бою нельзя так можно обладает я думаю можно будет пообщаться и обсудить этот вопрос более подробно все просто на самом деле detox решает много вопросов перекладывают ответственность управление версиями на разработчиков они теперь контролируют скажем так да и вы никогда настраиваете доступ к мастер ветки например да который катится вот собственно она определяет что туда может замерзнуть только человек который обладает компетенцией так далее добрый день александр меня зовут компании егсн с пав люксу пару вопросов он push модель поддерживает нет нет сравнивали ли вы орга сиди в этом плане хорошего потому что но мы используем его вот в принципе довольный он позволяет как раз переехать относительно плавно от обычных стандартных pipeline of к версии к ситуации когда у тебя разработчики фактически полностью а переходит на гипс в том плане что для разработчика который привык push модели у него подготавливается артефакты контейнеры куда-то они там пушиться и так далее ему еще приходится как бы куда-то еще в другой репозитарий коммитить какую-то циферку и это в общем относительная боль которая ну как бы не сразу заходит людям они привыкли к товарному комету который едет из одной ветки там мастер ветку интегрируется соответствующим образом и для них в их мирке вот работа с битом она как бы понятно а когда мы говорим что для того чтобы теперь еще куда-то уехала надо в другом проекте что-то завести у них немножко диссонанс возникает они привыкли собрал branch у запушил улетела в тест там стретч пратт три кнопки все хорошо как вы решаете такие трудные отличный вопрос почему мы выбрали именно flags когда вот я говорил о том что началось с про митоз оператора нам надо было решить маленькую задачку взять я блики и положить их в кубер это можно было сделать каким-то своими руками там написать что ты потом поддерживаете то баги там отлавливать посмотрел до есть орга сиди но он показался просто гораздо более сложными то есть флаг сам маленький binary который делает одну маленькую задачу берет и применяет купить цели а у орды сиди там он один на весь кластер ну я могу ошибаться это был достоин не не суть важно да то есть у него там какая-то веб морда какие-то компоненты он просто больше на самом деле не совсем ожидалось что такая маленькая задачка по автоматизации про митоз она вырастет такую большую схему то есть flags вот был тем что в нам был простое и удобное и простое удобно не надо насчет второго вопроса тут какая ситуация сразу же это был первый вопрос который сдавал задавали на всех встречах не но ребят мы куда то что то там комитет давайте мы выпустили складывать ты вы там настроить и в итоге мы пришли к тому что эти изменения делается и который собирает он у него есть доступ в этот репозитории в тестовую ветку и он там просто меняет эти циферки либо мы указываем в качестве rev a branch почетного то есть там изменение внес они сами раз катались окей то есть понятно то есть немножко доработал липой плане на сборке до который добавляют это стоящий чарт реагирует его и туда работа с двух сторон ну как бы мы сделали какую-то инфраструктурную вещь разработ команды разработки там у себя немножечко достану то есть раньше у них это собиралось и складывались art museum теперь это кладется в git и меня и царёв ну окей все понятно и последний вопрос наверное скорее всего будет отрицать но задам значит допустим у вас гид недоступен был довольно у нас на самом деле допустим такой кейс когда гид repository он во внутренней сети vpn и там сидела кластеров разбросанные по всему миру и как-то надо это все сделать плюс еще надо разложить везде в registry они и в разных клаудов и так далее вот это вот все приходилось ли складываем с такой зажим был такой был даже баг который был очень страшный на самом деле нам о его отловили на ранних этапах был какой баг нас получается стал недоступен гид по какой-то причине то ли носите что-то то еще и в фильм операторе они не сделали проверку при работе с зависимостями и он не смог обработать зависимости удалил их ну да это был единственный баррель его единственный баг после этого в мы в общем пересмотрели подход к обновлению к тестирование этого обновления но сейчас гид недоступен ничего страшного не происходит у тебя загорается мониторинг о том что флаг сможет синхронизировать а фильм оператору тоже мониторинг на все что есть она работает то что ты не можешь обновлять но все что есть остается неизменно ну окей но дальше вопрос я думаю товарах и так наверное давайте для следующих вопросов мы все вместе перейдем в кулуары тем более в кулуарах об цифровых кулуар доступны еще общения с аудиторией в онлайн я надеюсь что будет вопрос какой то из онлайна теперь вопрос к виталию какой вопрос был а вот последний просто отличный вопрос продление вопрос вам лучше вопрос но на самом деле луч да ну и по традиции небольшие подарки от организаторов нашей конференции давайте поблагодарим виталия огромное спасибо ему за интересный доклад ну и дальнейшее общение уже доступна в цифровых кулуарах спасибо всем большое за внимание спасибо"
}