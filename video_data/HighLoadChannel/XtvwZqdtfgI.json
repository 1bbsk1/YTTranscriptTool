{
  "video_id": "XtvwZqdtfgI",
  "channel": "HighLoadChannel",
  "title": "Service Mesh на стероидах. Часть 1 / Алексей Ефимов",
  "views": 8191,
  "duration": 3578,
  "published": "2022-03-21T13:13:03-07:00",
  "text": "привет uhd река громко да всем привет я алексей ефимов системный архитектор и в компании нет крекер и кто же такой наградил что это такое мы занимаемся разработкой программного извлечения для telekom компаний то есть по сути мы автоматизируем полный цикл бизнеса начиная там от биллинга серым а продаж работа с заказчиками и так далее и в наши типовые клиенты это топовые телеком операторы в странах в регионов и это операторы количество абонентов которых измеряется десятками миллионов до до 100 миллионов абонентов это может быть не обязательно абоненты сотовой это могут быть покупатель цифровых сервисов это могут быть покупателей в магазинах подписчики в общем даже там зрители фильмов вот это естественно современное большое приложение кубер нити с микро сервисы р базы данных различные кафка там все модные слова которые вы знаете скорее всего вы найдете в открытии там все это будет и так устроена архитектура над крекеры что мы построен на единой платформе от платформы и такой как бы центр поверх него строиться там всех систем и которые вот как вы думали во большого не втыкаются вот в эту вот платформу и я руковожу разработкой и сам вот сердце твой этой платформы так называемого облачного hydra а ядро а немыслимо без сервис миша то есть особенно вот в таких огромных приложениях я не буду расскажу что такой сервис меж я думаю что это все знает поднимите руки кто не знает что такое стенс мышь ну все я пошел по есть человек я для него буду рассказывать он не знает чудесно значит ну сервис мышц как лего только мышь то есть по сути он о том как собирать кубики из этих кубиков строить какие домики и основная идея сервис мешает каркас приложение он не создает архитектуру архитектуру стоит архитектор сервис миша он стоит каркас дом свои перекрытия а дальше в этот вы в этот дом заносится сантехнику кабели там этот дом начинает жить но начинается все с того что строится каркас дальше это конструктор из кубиков в нем есть типовые блоки как строится сервисных чтоб потом к этому сервис мышу можно было при линковать добавлять какие-то микро сервиса solution и и так далее и мой доклад о том какие бывают кубики в сервис мыши и какие домики из этого сервис мыши можно строить а можно строить из них довольно причудливые конструкции и вот первое правило разработчиков платформы кто здесь разрабатывает платформы лес лес рук вот интересным задумайте сейчас себе какой для вас первое правило теперь я покажу мое первое правило первое правило платформа должна приходить бесплатно для разработчиков если вы приходите к разработчику биллинга говорить и я сделали бы классную фичу мы ну вообще печешь ошибись а что нужно чтобы взять но вот здесь нужно код перед писать что-то на configure и а мое личное мнение ничего конец вот как бы приходишь к нему говоришь так нужно только взять рыбы и там что-то обновить но уже теплее если приходишь к разработчику говоришь просто поставь обновление на платформу фишек те придет бесплатно тогда ты лучший друг разработчика едва я тогда платформа становится успешной и вот я попытаюсь сейчас рассказать как именно делать сервис mistake чтобы она была ли разработчики сужен прозрачно чтобы они получали все новые фичи бесплатно итого часть 1 кубики из чего состоит сервис мышь первое правило микро и стервецы взаимодействию через гей твои день твой это декларация и 5 то есть на самом деле мы как вот когда пишем код мы сперва там пишем интерфейс и потом реализация примерно подобное происходит и сервис мыши вы сперва декларируете и пьянь через сервис мышь потом под этот сервис мышь устраиваете микро сервисы который будет его реализовывать дальше задачи gate в.ф. это условная маршрутизация если у вас просто будет ставить действий за ним микро сервис ничего интересного gateway предназначен для того чтобы отправить поток данных либо там в один миг россию с другой и в зависимости от условий и делается это по таблице маршрутизации вот весь мой почти доклад будет час крутится вокруг управление таблицы можете зации вокруг маршрутизации второй игрок сервис мыши то contra клайн на самом деле день твой штука бесправное он стоит лосс в нем лежит только его кусочек таблица маршрутизации а вся таблица маршрутизации лежит в контру play не и так получается что в качестве идей твой мы используем in vain тут как бы вариантов у нас на самом деле был немного а вот контур plain пришел с нам написать свой почему именно я тоже косвенно коснусь в твоей презентации значит gateway это обычный микро сервис это не стоит к вот когда я там произнес слова сервис мышь я думаю что 99 процентов из вас решили что я буду греть провести вот я не буду говорить про вести потому что у нас свой сервис меж в нем другая архитектура в нем другая парадигма а вот как бы почему то есть отличие у нас в том что у нас микро сервис gate winstar и стоит на входе в микро сервис и только то есть micro сервис декларирует публичный битвой декларирует публичный эти микро сервиса и он в отличии от истине стоит на выходе из микро сервиса здесь мы как бы два положительных вещи во-первых лишний хоппс зачем нам лишних область экономили один день твой второе имея вот такую архитектуру мы можем в день твои загружать только часть таблицы маршрутизации которые относятся именно к нему мы не загружаем туда все если бы у нас день твои стрелы на выходе из микро сервиса мы вынуждены были бы про грузить туда таблицы можете за целиком а в наших реалиях это 200 микро сервисов это будет сотни тысяч строк таблицы маршрутизации в каждом gate вы умножите она б это был гигабайты памяти только на гей твои и дальше есть у этого ядро быть и то есть такой микро сервис очень легко обойти он не встраивается в сетевой слой это обычный микро сервис в общем то никто не мешает раз разработчику обратиться с микро сервисом micron сервис на прямую но тут уж как говорится совесть лучший контролер но есть еще статический анализ который отлавливает такие вещи когда пытаются идти с одного где твоя смегла сервисными h-сервис немножечко вот таблица маршрутизации значит что это такое по сути это как бы mapping который задает как зависит от входящего запроса куда нужно пойти с какого up stream а в какой там stream и мы выбираем в таблице маршрутизации есть всего четыре критерия по которой мы можем выбрать вот эту вот перенаправление это хост это по сути и мидии твои порт день твой путь по которому мы переходим и хедер вот хитры такой наш основной критерий по которым мы будем делать муж низации видите если я добавляю кедр тест то у меня запрос пойдет на микро сервис ордер менеджмент тест и вообще на другой там на другой какой то опять таким образом я могу бросить в свой сервис smash свой свою конструкцию какой-то новый микро сервис из маршрутизировать на него запрос по параметру но не всегда этих четырех параметров хватает зачастую нужно маршрутизировать по каким то параметрам которые тут в боге или которая идет каком каком то сложным параметры хедера или там еще какие-то сложные вещи для этого у нас работают плагины январь вообще очень такая вообще хороший чувак его придумали откровенно говоря и в нем можно исполнять плагины плагин он исполняется да там лист амортизации он берет параметры которые приходят на вход и он может их распарсить он может как бы если не хватает параметр если нет нужного hidra он вытаскивает этот хидр вот у нас был какой-то путь в этом пути встречается какой то какой то ко сну мир таблица можете зация мы этого касмир воткнуть не можем мы горим путей маршрутизация будет по например вот каста мир 23 4 все три этот тестовый к ставит любим вот все что идет к этому костюмеру должно пойти на тестовый микро сервис плагин вытаскивают этого каста мира гайд о я узнаю значит нужно за засунуть нужный федор вот такая вот пара которая делает по сути неограниченные возможности условной маршрутизацией битвы и плагин что до вытаскивает дальше гей твои маршу дизер уют по кедру дальше день твои они в общем примерно все одинаковые но при этом все разные то есть их за чудо был сам он всегда один этой новой а то в какой роли будет работать день твой как он будет функционировать определяет его конфиг при этом у нас есть три типовых варианты действий в первый это ingress битвой тот кто стоит на входе в облака он выполняет проверку точинов отдыха выполняет входящую security через него публикуется публичный эти приложения ничто не может проникнуть в облака не пройдя в ingress где твой иваш внутренние 5 никак не засветится из облака если он ингрид где твой не зарегистрирован а дальше internal гей твой это те gateway которые работают внутри то есть через них идет коммуникация между микро сервисами там уже нет особенно не нужно особенно security но как бы они не видны из облака это работ все внутри есть игре с гей твой это тот парень который стоит на выходе из облака и он уже изолируют облако от тех интеграционных систем с которыми она работает я более подробно на игре с gateway сегодня остановлюсь и вот такой вот нехитрый поток данных запрос входит в ingress gateway крутится крутится крутится между интернами и потом уходит в downstream через игре с гей твой дальше помимо того что день твоей занимается балансировкой асари маршрутизации он еще занимается балансировкой вот такие его его две роли условной амортизация условная балансировка балансировка делается по правилам не по таблице но она нужна для того чтобы однотипные запросы отправить на какой то конкретную поду если мы говорим в терминах оберните со например для того чтобы отправиться на кит прогретой каши вот как бы балансировка делается между кодами не обязательно между микро сервисами и есть такая гривы вещь как стильность то есть мы можем задать правило по которому однотипные запросы всегда будут приходить на одну и ту же воду и вот это вот правило по какому критерию мы это будем делать она тоже управляется мы можем отправлять показ номеру пусть есть и по транзакции потом ордеру неважно и делается это либо похож рингу то есть последовательно перебираются все коды либо помогли for галь алгоритму но факт в том что если у вас есть какой-то айдишник по которому делается балансировкой то едешь них шесть и по ним запрос приходит всегда нападу номер два он всегда будет приходить на поду номер два кроме случаев когда например под и новые добавляются либо убираются при этом структура балансировки она может нарушиться но она снова станет консистентной то есть мы не решили мы долго на об этом думали на самом деле либо делать хоть табличку в которую говорить вот этот запрос должен идти вот на эту воду и всегда ее содержать до тогда при наружу при добавлении воды при изменении структуры все запросы пойдут именно туда ну так прикинули прикинули оказывается state басарга алгоритмы здесь намного намного более удобные потому что не нужно ничего синхронизировать все всегда consistent и этот параметр балансировки направляемый им можно управлять с помощью того же самого плагина и маршрутизация балансировка обычно могут совмещаться дальше следующая тема сервис мышь у нас иерархический то есть на самом деле это не то что вы даже собираете домик из кубиков а вы собрали там несколько домиков и потом из этих домиков строить какой-то город потому что то есть у нас к по сути это мышь мышей потому что приложение стали настолько большими их стало как бы так много что держать все это в одно мыши стало как бы крайне проблематично поэтому у нас есть там сейчас это два уровня есть нижний уровень это уровень общих сервисов они доступны каждому приложению есть верхний уровень это уровень станет приложений то есть каждое приложение например там вот ордер менеджмент она знает о своем нижнем уровне знает обжаренных сервисов но он не знает о своих соседях по дефолту то есть он как бы работает в сам себе а вот эти вот жареные сервиса в нём как бы им же птица я об этом на этом паттерне буду останавливаться существенно как бы более подробно потому что такой фактор роста мы доросли до этого паттерна да перешагнули примерно там сотни микро сервиса то есть через сотни микро сервисов в одном как бы в одной корзине все яйца держать стало уже не выгодно вот ну и вот есть регистрация внешнего вернее нижний слой регистрируется во внешних слоях для того чтобы было видно быть доступным по умолчанию вот это была такая вступительная часть о том как бы какие кубики очень мыши бывают давайте теперь смотреть эти прикладные проблемы мы решали и как этими кубиками воспользовались значит первая самый проблем неприкосновенность теряет по сути то с чего я начал если мы приходим к разработчику и варим те нужно что то изменить но скорее всего успеха это не возымеет поэтому водкой б типичная ситуация есть micron service client он вызывает микро сервис сервис и он вызывает и облака это уже по какому-то углу да вот по такому этот этот url он скорее всего зашит в коде но потому что делать две точки регистрации одного и того же то есть и сервис мышь и еще и где-то это углу буду регистрировать масло масляное поэтому скорее всего этот and point зашит в коде мало того этот and point он локальный без упоминания namespace а то есть вы одно и то же приложение в купер нечисти можно ставить в разные namespace ты и сам namespace в конфигурации не упоминается то есть это всегда ссылка локальный медь ордер менеджмент спортом удобно потому что в любой микро в любой namespace поставили но если вы вдруг не структурируете приложение и оказывается так что серым оказывается в одном найем спейси а ордер менеджмент другом на им спейси как бы сразу наступает вопрос а как же тогда я буду вы сделать вызов с учетом того что у меня еще есть и namespace и вот именно это в этом в том числе на помогает сервис мы что есть он изолирует нас rest руб а от реструктурирования приложения он изолирует все наши изменения тут если бы такие два паттерна то есть есть поттер номер один мы называем локальное связывание когда gateway ставится вместе с микро сервисом то есть когда мы мы в своем нами спейси именование должны сохранить если микро сервис ходит по адресу ордер менеджмент это всегда должен быть адрес ордер менеджмент и этот ордер адрес ордер менеджмент должен быть на чем-то выставлен это есть первая опция у нас появляется namespace идей твой и он уже в этом namespace и определяет а куда же дальше пойдет запрос либо на какой-то микросферы здесь либо снаружи облако либо в другой namespace ты бы первый первый вариант и gateway забирает на себя имя микро сервиса то есть если раньше ордер менеджмент он назывался микро сервис то теперь ордер менеджментом будет называться гей твой а микро сервис очень может называться ушах угодно он сам себя зарегистрирует гей твой самое главное сохраняется имя это вот святая святых чтобы именование сохранялась вот downstream может определяться динамически после этого можем запрос отправить другой namespace в этот же нэнси из за пределы облака единственное что и тут как бы сразу стоит отметить сервис меж это не интеграционная шина он не занимается трансформацией запросов то есть если у вас был и пиарит flash ордер да вы url запроса можете поменять но контракт и 1 здесь не поменяетесь у вас допустим запрос принимал джейсон он не начнет у вас от этого принимать ямы трансформация body это не задача сервис миша она была первая опция вторая опция ну не обязательно gateway за соль тот же namespace можно ограничиться просто сервис алиса это такая опция как бы она неуправляемая то есть всегда по вот этот сервис тридцатку берни тестер веселясь то есть вы заводите в этом же namespace и новый сервис этот сервис с namespace а указывает вот на этот сервис namespace и как бы такая просто получается типа нато да как вы только на уровне на уровне dns таблице 1 твои он уже переезжает в другой namespace как бы все остальное примерно то же самое самое главное что у вас в этом namespace и остается то же самое имя мы как бы именно сохранили значит не нужно переписывать код вот раз забирает на себя имя сервиса дальше может быть в общем то все что угодно и обычно алиас указывает на гей твои в другом микросферы другом на им спейси может указывать и на другой micro-sim это вот такой вот структурный паттерн давайте еще сейчас посмотрим как этот структурный паттерн в прикладных задачах используется вот возьмем себе такую прикладную задачу по сути это генри deployment у нас есть приложение в этом приложении мы хотим выкатить фичи различные фичи разным фокус-группа у нас есть фокус-группа который мы выкатываем фичу прогрессивная скидка тайцы накат однако набираешь себе в корзину больше и больше сервисов каких-то там товаров услуг и скидка накапливается есть 2 2 фокус-группа которые мы говорим о у тебя будет скидка зависимости двое локации если ты находишь там в деревне тебе там одни скидки если в городе другие скидки и это все нужно выкатывать параллельно чтобы она вместе работал на продакшене просто для каждый фокус группы по сути это тот же паттерн kinder с которым все мы хорошо знакома ну вот как он у нас реализован через наш сервис меж значит первое ездий твой этот день твой оттягивает на себя имя микро сервиса то есть эти был микро сервис а теперь появляется diy твой а и у него имя а за этим действием стоят версии микро сервисов каждая фича это версия микро сервисов то есть micro сервис а в данном случае у нас будет 5 в 3 в трех версиях версия с скидкой по геолокации версия скидкой прогрессивной и версия по умолчанию в которой никаких новых фич нету и версия это просто инкремент она как бы выдается при deployments неважно там будет она просто in комментируется дальше это версии просто технический айтишник он мало что говорит но есть таблица в которой мы говорим что вот это техническая версия соответствует вот этой вот фича прогрессивная скидкой до будет версия номер два геолокация это будет версии номер 3 и дальше мы в таблице мажьте зации прописываем что по версии номер два ходи на версию номер два микро сервиса и здесь вот будет код прогрессивной скидки по версии номер три ходи на версию третью миг расти расти здесь будет учет гео-локации то есть мы как бы поменяли код трижды за тепло или микро сервисы пожалуйста ходим на различные вещи при этом эта марте зация по если мы знаем версию можем пойти на нее если мы версию например да и то если мы узнаем версию можем пойти на неё и в зависимости от нее выбирается downstream при этом мы можем переходить на версию по умолчанию если какая версия не указано при этом мы можем ходить как по версии вот поэтому по этому полю так мы можем точно также ходить и по имени фичи имя фичи либо имя фичи добавляется в хедер его добавляю какой-нибудь up stream микро сервис портал там еще что-нибудь фронт-энд либо тоже самый плагин может понять что gotta catch фокус-группа для биолокации значит я должен для этого пользователь для этого запроса добавить хедер версию номер 3 и тогда маршрутизация будет сделано на версию микро services гео-локации при этом а зачастую фичу это не один микро сервис это может быть и на микро сервисов от у нас есть три микро сервиса и видно что в микро сервис tea есть все три фичи микро сервисы в есть топ 2 фича микро сервисе c есть только первая пища то есть вся эта конфигурация свечами версия мини она проливается по всей системе gateway'ев и когда у нас запрос идет он переходит между всеми микро стеру сами при этом фичи и вот идет версии их можно деплоить их можно удалять если фича они могут быть тепло и на параллельно и если допустим фичу принимается тестирования фокус-группе прошло успешно мы можем эту фичу промолчать она уходит в основной trang она уходит в основной г bass line и она начинает работать по умолчанию значит следующая проблема удешевление разработки то есть зачастую есть команда разработчиков есть команды тестировщиков есть команда конфигуратор of каждому нужно выдать свое окружение на котором они будут работать 100 разработчиков 100 микро сервисов если каждому выдать по окружению это все будет как бы очень в очень большую денежку все это выльется поэтому нужно это все удешевить нужно сделать чтобы как бы разработчикам добавление новые разработчика нового новой лабы делалось существенно дешевле значит что для этого делается основная идея что свою лапу разработчик тепло и только дельту только те микро сервисы как с которыми он будет работать при этом есть общий тран в котором за тепло и на все 100 процентов микро сервисов этот транг стабильной у каждого разработчика есть собственное на экспресс в облаке и он туда тепло и только то что изменил а все остальные микро сервис ты ему как бы подкладываются но они не deep ловятся физически они туда как бы инжир птица за счет средств сервис миша при этом этот namespace может быть не только в облаке он может быть и на локальном лэптопе разработчика и вот реально мы применяем у себя вот такую концепцию в командах там до 20 человек экономия получается до четырех раз этот не стиллер будет она не сделает вам разработку там в сто раз дешевле потому что все-таки там транков обычно несколько но вот там примерно 4 кратную разработку и и достичь вполне вполне себе реально и здесь опасно от отличие одно из отличий от предыдущей модели жизни про molto то есть для того чтобы ваша фича появилась tranque вам нужно пройти соседи цикл и она уже должна на катится на транг через соседи то есть песочница отделена его жесткой такой стеной от рамка поигрались под и стиле все извольте как бы закончиться в мастер собрать и лист накатить как бы и там вечером накатили хорошем смысле слова хороший 10 а с утра уже все нормально можно как бы начинать работать значит как же это все делается технически все теми же самыми щедрыми на самом деле все теми же приемами сервис миша с соблюдением того же самого золотого правила что ничего не должно меняться для прикладных разработчиков и что в каждом на им спейси коммуникация должна быть та же самая если у нас есть адрес серым 8080 он всегда должен быть серым 8080 и никогда не серым namespace 8080 значит у каждого девелопера есть namespace в этом namespace deep ловится дельты измененная микро сервисы который поменял этот разработчик вместе с каждым сервисом который он поменял тепло это его день твой для всего остального создаются services то есть когда у вас за тепло и на вот это вот песочница для разработчика вы туда откро и вы его откроете все имена микро сервисов они там останутся просто некоторые микро сервисы будут там лежать физически а некоторые микро сервисы будут подставлены в виде алиасов и вот что прописывается в таблице маршрутизации для тех микро сервисов которые есть в этом ним спейси делается 2 2 записи вот ордер менеджмент мы мы поменяли он у нас есть и в мастере в tranque и он у нас есть в этом самом вот namespace и значит делается 3 записи есть запись по умолчанию она показывает на микро сервис в tranque есть запись федором namespace то есть когда ми когда разработчик отправляет запрос там front-end и back-end он указывает вот моя песочница обработаем не пожалуйста мой запрос в моей песочницы с именем namespace сервис мышь это понимает и говорит так вот для этого на им space а вот эти вот микро сервисы в мыши зарегистрированы отправляя запрос туда остальные обрабатывая в мастере для мастера остается всего одна запись для grey для того что мне ничто не менялось в namespace и остается всего одна запись даже по если я укажу namespace вот в моем хедере я все равно пойду в как бы мастер этот самый второй а вторая опция когда мы работаем с лэптопа и здесь как бы самое интересное вот что если вы допустим но в топе отлаживайте фронт-энд все очень просто вы подняли у себя фронт-энд и этот фронт and butt-head в бэг-энд эта схема позволяет сделать обратное вы можете в облаке поднять front-end и back-end у себя и запросу вас из фронтенда облачного или там из какого-то бэг-энда облачного придет на laptop а потом вернется в облака то есть лэптоп как бы встраивается в единый поток запросов между облаком и этом самом здесь у нас для него дефекации мы считаем что webtop это тоже namespace просто у этого namespace есть титры хитрое имя это имя это по сути его айпишник слэш его адрес в домене нет а его домен не поет позволяет зарегистрировать dns имя на каждой а епишкина что делается 1 открывается vpn между лэптопом и облаком этот vpn он видит и сетку кодов и и сетку сервисов он сквозной он двухсторонний дальше этот сервис регистрируется в мыши облака в центральном tranque он регистрируется по его вот этому квази dns адресу но каждый сервис со своим портом то есть когда вы поднимаете несколько копий микро серию микро сервису стяну лэптопе физический айпишник у них будет один и тот же отличаться они будут только портом то есть это вот тот случай когда мы регистрируем микро сервис и сервис мыши по различным портам и дальше я просто регистрирую header с вот этим вот dns именем и как бы по нему мышь понимаешь того нужно через vpn по этой маршрутизации сходить на laptop и потом его вернуться обратно а почему мы используйтесь dns и вот это вот не поет на самом деле просто для унификации для того чтобы модель работы в стенд боксе и модель работы на лэптопе была рыба ровно одинаково естественно можно было сюда регистрировать и айпишник можно сюда было регистрируется что угодно но вот для унификации мы сделали вот такую модель вот как бы до маршрутизация по dns у этого самого лэптопа дальше следующей темы молчит и нэнси значит что такой мальте ценности это возможность использовать 1 и тот же набор y youtube love для разных заказчиков так чтобы они не пересекались как вы делает salesforce вы нарезаете там аккаунт де-факто на скорее всего мелкие аккаунт и все работают в одной песочницы с одними наборами микро сервисов просто используются разные базы данных вот мы в на открытии в продукте используя ту же самую модель то есть в основном у нас на все теннант и один игрек это был один instance микро сервиса просто под него под каждый теннант нарезается как нарезать своя база данных при этом теннант это необязательно заказчик это может быть тестировщик либо аналитик это очень такой хороший паттерн если человек занимается не кодирование мне разработкой микро сервиса а он занимается например конфигурацией портала конфигурация каталога то есть его изменения только в базе данных мы нарезаем под него отдельные базы данных не нарезает футбол но бывает такая ситуация когда нужно ее где куда был тоже нарезать база данных большая база данных не влезает там в память н баз данных тогда мы нарезаем под каждый теннант еще и микро сервис и теннант нельзя воткнуть пустить у реки причинам в хедер потому что очень хакнуть очень быстро он идет в животе то tiny-g в этот океан не понимает таблицы маршрутизации поэтому вместе работает пара плагин взял теннант из живота токена подставил в хедер и после этого сделал маршрутизацию на нужный микро сервис дальше самое интересное то что было бы вынесено в заголовок приложения это структурирование приложения когда у нас есть единая система состоящая из разных на in space of из разных приложений работает как одно целое физически разделена на различные модули каждый модуль это namespace либо общей либо частной и у каждого этого модуля в кубер нечисти может быть свой админ свои авторизация кого ты там и так далее свой housekeeping и фичи могут выкатываться по-разному каждой у каждой группы свой blue green network артист ротар ничего не знает о том что делается в ордер менеджер и наоборот у каждого свой сервис мышь у каждого свой стиль свой свой и pr получается такой мышь машин что мы делаем для этого по сути мы да дело делаем для приложений концепцию инверсии зависимости мы декларируем вот наше приложение вот его потребляемый и 5 и вот его публикуемый и 5 через паблик и 5 мы декларируем тот опять который пойдет в интернет через ingress битвой декларируем и pr для соседних приложений через за грецкие твоего декларируем потребляемые и 5 то есть если мой серым будет потреблять биллинг я заведу у себя в серыми гей твой с названием биллинг а вот какой именно беринг будет использоваться определиться у меня в момент деплоя пройдет инжекции зависимостей и у меня теорем поймет про биллинг есть еще ingress gateway для жареных сервисов который как там spring будьте инжекция бинов по дефолту произойдет у вас как бы где тут в текущей applications все зависимые сервисы и вот про из когда произойдет deploy пройдет связывание все это дело вот такой вот простую пука паукообразную структуру жареные сервисы взаим же птица по умолчанию в таблицу маршрутизации вот такая вот шляпа по звёздочке то есть если я придя в ордер менеджмент не нашел и pr логина я по умолчанию уйду в платформу центральный сервис который плагин будет то же самое вся рэми тоже не будет api аладдина он тоже уйдет вот сюда и он уйдет без какого-то кодирования он уйдет ибо автоматом а вот соседние приложение они уже связываются друг с другом биллинг втыкается биллинг серым втыкается вся рэм и как бы они друг на друга замыкаются дальше следующая тема работа с прогрета my кашами если у нас есть какая-то потребительская корзина которая работает на ком-то позе нам очень желательно чтобы все запросы ходили только на него для этого мы configure им надеяться что корзина будет тебе приходить еще и федором и пожалуйста по этой корзине маршрутизировать запросы всегда на одну позу это прекрасно работает когда корзина допустим этот айдишник корзина известен с портала вот он известен и тогда он всегда входит в одно место второй случай если корзина неизвестно мы пришли и корзину нужно создать она создастся и потом сможете анапа создаст в этом сможет отбалансировать с обычным куда то не туда для этого у нас вместе с гей твоим работает его коллега аиде генератор это обратный алгоритм машины зации он выдает айдишник так чтобы поэтому айдишник у сделалось потом маршрутизация на нужную позу мы пришли на поду он сходил воде генератор получила идиш ник вернул его порталу портал обратно возвращается в gateway и мы снова приходим на ту же воду и вот хитрость следующего уровня а что если приложение работает на нескольких дата-центров и у вас есть случай когда с одной корзиной работают два человека одновременно и как бы эти два человека раб подключились к разным дата-центром и мы приходим к задаче синхронизация к шее сто тысяч миллионов приемов синхронизации к шее существует мы из них выбрали самый простой не синхронизировать каши но обеспечить так чтобы между масштаба маршрутизация всегда было ровно в одну воду даже между центрами если я пришел на какой-то дата-центр какой-то корзиной я пришел день твой день твое понимает нет ни мой дата-центр он перебрасывает сюда это понимать дата-центр мой а какая же пода а вот это вот пода то есть это все делается за счет того что у нас в кедре приходит ведут корзина и правила маршрутизации между действиями а в данном случае здесь будет и правила маршрутизации и правила балансировки перекинет нас на нужный дата-центр на нужный гей твой и такая последняя тема которую я хотел рассказать эта абстракция для интеграции вы работали с интеграциями обычно у каждой интеграции свои тараканы у кого-то они мадагаскарские у кого-то обычные наши советские но они как есть всегда эти тараканы обычно это твоя собственная авторизация я и аутентификация второе это обычно сама подписанные tls сертификата которые раз тяжести понимают плохо то есть хотелось бы абстрагировать логику приложения от того что вот всех этих тараканов внешних интеграций поэтому у нас есть игре с битвой и атрибут . на которой мы как бы плагинами вот этот терменируем все вот эти тараканы да то есть мы делаем авторизацию аутентификацию в каждой внешнюю систему отдельно у нас эта система будет называться просто там серым 8080 вот in point с неработает микро сервис а физически мы просто мажьте зиру им запрос расшифровываем кастомный tls трафик делаем аутентификацию и как бы разработчики счастливая все счастливы ну и и грецкий твой работает через firewall через единый айпи адрес у нас никто не выходит за пределы сети вот такая вот тема я считаю что вообще это все был такой тизер к серии презентации которая надеюсь мы тут не на этом file1 наверно следующем вот как бы такой небольшой тизер что же будет дальше что же мы хотим еще рассказать первый это генри deployment полный цикл как это все работает вместе с devops он потому что такой magic который позволяет создавать удалять микро сервисы и как бы их каким-то образом ротировать и третье это вообще там на сладкое у нас есть конри теплометт еще и для мести джинга то есть те что вот я сейчас показывал для rest взаимодействия есть еще и для месседжем взаимодействия точность как бы такой сервис мышь для мастеринга рабби таммим тыковки надеюсь что мы в скором времени тоже об этой теме поговорим вот как бы всем спасибо за внимание алексей ефимов друзья мне придется еще два раза посмотреть да просто понять вот это все я надеюсь что я уверен в том что здесь люди гораздо быстрее соображают сейчас появятся руки а мы пока вручаем тебе в качестве благодарности сувениры это шарф шарф который вот у нас тиронут термос ну и конечно же вот именную рамочку да у нас есть уже вопросы тот у кого есть микрофон начинайте говорить у кого из микрофон меня есть микрофон я вы и мы вот так вот пойдем ребят вот кому-то повезет времени мало осталось я постараюсь быстренько спасибо большое за так вот очень интересно была очень крутая идея с песочницами собственно вот первый вопрос касательно них да вы говорили о том чтобы защищать их источники тем что туда нельзя дипой беспокойно но как бы мы все знаем что что-то случается и в двух туда что-то заде полость что не работает а и таким образом получается что вместо того чтобы экономить мы поставим потому что у нас сразу несколько разработчиков не могут пользоваться одним сервисом 0 1 песочница 1 одним вот этим танком вон сзади отмотаем собственно вопрос есть ли у вас какой-то процесс пока под одну или переключения на резерв на резервную вот еще раз повторюсь вот есть st paul frank да накинулся на ответственном нужно что то сделать чтобы не просто велась раза несколько разработчиков ни один атом 4 5 10 вот есть ли какой-то процесс переключения на резерв если вообще такой пока алекса вас а пока 2к алексей готовит ответ я скажу что ребят по одному вопросу в одни руки много рук вы придешь и нам на самом деле не нужно мне кажется от переувлажнения просто этих как бы вот этих песочниц грубое 2 то есть есть два транка вы подключаетесь в нужном транг и все вот за тепло ведь это все шляпу это другой минуты ваша песочнице deep ловится минута там пять стран где плавится минут ну 20 поэтому файл fast из таинств целом то есть транг ни один общий для всех у да нет конечно господь с вами транг он выдается на команду примерно там чек 15-20 до обычного командой может быть там два может быть 3 до в компании стис ни один травы господь с вами спасибо супер переходим к следующему вопросу о тебе алексей предстоит выбрать лучший кстати говоря очень хорошо да а судьи кто я вот ты я студента да спасибо большое за доклад очень полезный интересный вопрос в догонку тоже про песочницу каким образом очищается разработчики namespace ну то есть условно сейчас он работает вот над этими двумя печами и он сзади play all себе два вот две версии вот этого остальное использует через ты был пранк на следующий день работает над другими вещами и сзади плыл себе еще три микро сервиса на свой свою песочницу каким образом очищаются предыдущие два потому что нужно вот эти новые 3 тестировать предыдущий 2 стабильного брать на тут тоже очень просто дело в том что есть два способа deployment а это диплом and reinstall то есть чистый он себя просто все отчищает есть диплом от апдейт и вы просто говорите так либо я с нуля накатывает ранг либо я с нуля накатываю свой и namespace если накатываю свой он зачастил мои регистрации в tranque зачистит все базы данных и зачистят мой namespace все понятно супер спасибо следующий вопрос тут вот как сидим так и идем чтобы нам сократить время перехода онлайн онлайн нажимаете кнопочку выходите в эфир мы вас пустим без очереди да здравствую систематика консалтинг denis у меня я послушал с удовольствием ваш доклад очень понравился я понял что в целом мы все делаем правильно но есть вопросы вот как раз вопрос был про очереди и сервис мышь населением но мы будем ждать значит такого доклада и второй вопрос про безопасность внутри кластера вы вот показывали что перед каждым микро сервисом мы ставим ветвей в этом случае ну все неплохо мы можем токины на прив контролировать да а когда мы вот у вас был предпоследний там слайд console когда мы ставим кит вейна группу сервисов и проверяем безопасность там то есть внутри у нас подразумевается как бы доверенная среда или мы все-таки там можем делать tennant ность безопасность проверяет там и все такое не хочется тянуть с одной стороны так сервисы чтобы этим занималась инфраструктура но с другой стороны есть вот эта проверка безопасности должна быть максимально близко вот как она должна строить тут сайте я наверное немножечко не четко сказал то есть концепция безопасности на следующее у нас всегда безопасность проверяется на входе в микро сервис то есть внутри облака за безопасность отвечает каждый микро сервис то есть он делает авторизацию of tanks аутентификацию проверку живота токена то есть вы внутри микро сервиса даже если вы обойдёте мышь вы внутри микро сервиса ника не попадете вот эта штука она нужна для того чтобы рубля проинтегрировать под система безопасности внешних приложений с нашей то есть наша система принимает наши токена и наша безопасность вот этот и гризли твой он ведь окей я тебя за пан под нашим токи нам аутентифицироваться во внешней системе и после этого как бы ты уже м с ней работаешь тоже secu на то есть естественно внутри облака мы все тоже защищаем но тут там инвайт но вот не совсем смотрите in вой очень легко обойти потому что это обычный микро сервис то есть поэтому на самом январе security ну почти не проверяется потому что ну вот если бы мы это делали у нас была бы такая ложная уверенность в cig верности поэтому микро сервис обязан проверить всю securities там и на это есть security test и ян го и в общем-то он служит только для маршрутизации вот такой ответ и сел и подробности пожалуйста в дискуссионной зоне сейчас на многим он дальше of rat бриго при такой ситуации когда у нас вопрос просто как горячие пирожки мы сделаем самоорганизацию сделайте так чтобы ассистент вас увидел установите контакт глазами поднимите купюру куда-то вверх и вот тогда вы сможете задать вопрос здравствуйте и спасибо большое за доклад меня зовут александр и я бы хотела спросить следующий вопрос а можете немножечко рассказать про то как вы проводите трассировку всех этих запросов потому что у вас очень сложный путь и и какую-то проблему от ладится на продакшн и скорее всего проблематично трассировку и второй вопрос сразу это мониторинг потому что опять же очень много сервисов которые запущены одновременно как у вас настроенную сети алексей ты можешь ответить на один любую который тебе больше нравится не покатаешься обойти правила пони между знаете open telemetry на этот как бы все достаточно просто то есть каждый из этих как каждый из микро сервисов каждый из gateway'ев просто к его строить рейса иди складывает там систему трассировки то есть здесь детали этой хитрости то есть никакой нет просто если нужно транслировать нужно трассировать но вот так это растираем идет как так а кто еще успеет задать вопрос да спасибо за доклад насколько я понял в базу данных вы на горе и машет рукой базу данных и тоже через сервис меж полиция а я хотел спросить есть ли у вас какой-то автоматический election мастера если он упал и если да то как он все рос мешем интегрируется смотрите election мастера есть сервис смешивания интегрируется никак то есть вот все что я рассказала но касается ширины rest взаимодействие stay close на то есть здесь все версии 1 микро сервиса смотрят в одну базу верти они рование баз в этом концепте пока нет election мастера есть можем поговорить я расскажу как это делается но уже не в принять не пределах этого доклада то есть баз данных вы не через сервис мер школьницу нет и сейчас моя помощница степенно под в обратную сторону зала тут из онлайна спрашивают а нет ли опасности перегрева пода вследствие прикрепления юзеру в корзину так далее есть опасность перегрева фото в случае прикрепления же делаете много кодов вот ну то есть статистически когда количество кодов перерастает через десяток в общем-то heat shrink алгоритм особенно стильно но статистически более-менее выравнивается по этому не перегреваются случае чего можно отстрелить горячий супер у нас минут 4 примерно ну ладно 7 минут осталось на вопросы старайтесь задавать их коротко привет страж быстренько задач как коты клей твои реагирует на деградацию issues of в 1 поза или например на добавление новых инсов кокос это происходит вот в данный момент это не роль действия то есть за деградация должен отвечать мониторинг если у вас вдруг какой-то потом пошел в несознанку его нужно отстрелить конкретно gateway ну сейчас от него роль поэтому ответ никак спасибо вот так какие-то версии лучше вопросы уже появляются тебе еще рано отвечать простаты углероде здравствуйте у меня два вопроса один короткий другой провокационный добавила задай один важный один важный закон и важный хорошо вас нет ощущения что та штука который присваивает 17 она располагается не там джона не уловил логик присваивания ади шакти сиим должна располагаться до роутинга запросто конкретный под они после года чтобы потом эти не занимался и никита за просто обратно для чего это сделано было ли в докладе про и дискуссию нет про года у нас lancer да у нас да это было примерно вот там когда мы разговарили проглядывает балансировку да значит ну а эти сесть и он генерится ftp-сервером до входя который стоит на самом входе в облака поэтому присвоение айдишник а сесть и она естественно делается на самом верху до а и пред создавать сессию мы конечно не сможем у меня здесь был было речи о том что если бы это случается так что какой-то объект создается в каком-то микро сервисе вот на при этом покупательская корзина она будет создаваться явно не на самом верху она будет создаваться тип на самом дне и вот генерация идиш ника должна происходить там с учетом алгоритма балансировки все я понял супер пасибо огромное следующий вопрос давай потихоньку двигай сюда уже следующая зала снова чтобы вот тут много рук много русского складе сколько сколько интересного колонны где-то человек спасибо за выйди пожалуйста чтобы у тебя было за стран спасибо за большой и интересный доклад у меня вопрос про часть где у вас фича ветки внутренне фичи держатся и есть нам тепло и сервисов свеча bay и и вместе с is a и b дача это ответственность мер жить и выкатывать стенды в которые пересекаются функциональности разных вич вообще в общем-то об этом-то и речь что действительно одна фича может вернее там один микро сервис может быть profection несколькими фичами у вас есть какой-то negro сервис там не за серым и он будет за тепло int n 1 кто отвечает за то чтобы в конце концов кто победил ну в общем то project manager на самом деле нет вопрос о том что есть команда или там разработчик который занимается и пилит фичу а он знает только том что он пилит а есть какой-то совершенно другой куда лепить пилит б а в какой момент появятся стенд в которому и а и b фичи есть и туда трафик направляется в какой момент но в тот момент когда бывают добавил что-то личи одновременно обе устав расселись или как они 1 страну вот тут смотрите какая какая тема на самом деле обычно если фичи выкатываются в разных приложениях именно для этого структурирования сделано они выход могут выкатываться одновременно не друг друга не affected если вдруг оказывается что есть один микро сервис в нем в его код безе есть и фича а их еще б этого в разных версиях то естественно пойдет только одна и дальше получается что кто кто первый свою фичу в продакшен выпустил тот как бы и молодец вторая команда она должна будет уже пройти по более того сложному пути уже взять версию микро services 1 фичей и его за тепло и ца естественно что все это теперь бы делается не случайно если вы работать там серыми команды которые занимаются фичу мисс теорема они естественно на друг о друге знают вот если у вас есть биллинг есть are in the это разная команда не друг о друге не знают но именно для них сервис меж сделано иерархически вот тогда они друг друга друг друга фичами не перетирают и у них полностью независимый релизный цикл для green цикл там конри и так далее если фичи в один и тот же микро сервис ну чудес не бывает hot money мертвым поэтому первый идет production 2 идет намек ясно о тому же от мастера они снова делают свою ветку этом либо если конечно отлично есть ещё вопросы у кого микрофон говорите и в какой-то момент у в общем все происходит само собой все происходит само собой вот-вот смерти зреть вниманию спасибо большое за доклад крутая у вас в сочинец и хотелось бы тоже узнать про фичи вот например про прогрессивную скидку до или там гео-локации нужны будут новые плагины которые будут анализировать запроса каким-то образом эти плагины пишут сами команды разработки или все это нагружается на команду который платформы занимаются вот смотрите тут на самом деле есть две две опции для того чтобы сработала маршрутизация по таблице нужно просто чтобы пришел федор в нем была версия эту версию можно сделать двумя вещи двумя способами первый способ ее можно прислать напрямую с портала не разрабатывая плагина гей твою можно просто ходьбы портал или там самая система понимает ага это какой-то премиальный пользователь например потому что у него в юзер менеджменте пар оставлен флаг там премиальной пользуюсь бизнес-логика вставят сама хедер второе можно действительно сделать плагин но в блоге на есть одно существенное ограничение он не делает сетевого взаимодействия он этого делать не может то есть плагин вся работает по статике у него есть только все что он принял на вход и все что у него за configure но кругу римлянки поэтому сам плагин он в общем то платформенный у него не очень много логики да команда может configure конфигурацию на то есть она добавляет вот это пользователи такие вот пользователь сети они уже либо выдергиваются то есть плагины ну в большей части чаще разрабатывается платформой чем разработчиками бизнес-приложений спасибо ребята повезет еще кому-то одному и всех кто хотел задать вопрос но и вот просто микрофон до вас не дошел в кулуарах вы продолжите с алексеем надеюсь у вас будет время второму разу ты пожалуйста вот человек сидит свой рост рукой ну что так вот здесь желаю да да вот на первом году здесь есть да спасибо огромное да здравствует спасибо за доклад подскажите пожалуйста что как у вас реализуется авторизация вы используя какой-то свой сервер авторизации ли какой-то кастомный или какой-то пункт собственно которую вы включаете этот плагин по валидации токины по проверке всяких перми шинах и так далее именно как у вас это реализовано для публичного и для приватного пик ну автоматизация я надеюсь авторизация авторе за авторизация авторизация за пределы сервис мыши в общем-то вынести на то есть мы как я уже там говорил у нас концепция такая что авторизацию должен сделать каждый микро сервис сам по себе поэтому сервис мышь в общем-то не занимается авторизации единственное исключение сервис меж сделать интроспекция а токенов то есть если к нам приходит с севера там систему токен и оказалось что тотен был отозван потому что он был скомпрометирован и так далее то мы проверяем дальше авторизация уже проходит за пределами сервис миша уже как бы сам микро сервис решает можно этот api а и вызвать или нельзя это какие-то собственные сервер авторизации или это какой-то оком собственно вы используете но там значит авторизация из двух частей состоит то есть мы используем в качестве оденете менеджментом используйте клок то есть автон тифе catia и хранение ролей мы как бы храним натекло ти проверка соответствия улов уже делать с нашими внутренними сервисами супер спасибо огромное"
}