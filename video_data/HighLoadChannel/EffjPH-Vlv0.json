{
  "video_id": "EffjPH-Vlv0",
  "channel": "HighLoadChannel",
  "title": "Hadoop at scale: мы построили большой кластер, как его теперь сохранить? / Сергей Корсаков (Criteo)",
  "views": 758,
  "duration": 3010,
  "published": "2019-05-15T02:16:55-07:00",
  "text": "спасибо за тоже пришли в это утро на второй день я не знал ни нейрона спасибо и как говорится прежде чем начать презентаций нужно несколько ягод за land чтобы почувствовать аудиторию и немножко избавиться от страха выступления поэтому я приготовил несколько опрос стандартных начала первых я бы хотел спросить кто знает о компании cree ты услышал кто-нибудь даже если вчера например слышали вообще ага круто а кто знает кретова из тех кто не был вчера здесь о круто отлично немного человек 4 знал классно давайте начнутся рассказываешь к себе что было понятно кто им чем занимаюсь родился и в славном городе омске в сибири там же получил первый опыт работы в консалтинге и спустя некоторое время приехала москву в яндекс заниматься индекс поиском в яндексе а при работал три года и приехал во францию в компании кретова который занимается ретаргетинга и там я сейчас с вами благополучно я работаю на должности программного менеджера вместо вступления хотел сказать очень простую историю о том как мы как вообще моя жизнь начала началась в отделе сэр я полтора года назад я перешел в с одного этажа на другой я занимался разработкой изначально я занимался работал с командами которые занимались разработкой приложением fitch инжиниринга полтора года назад я получил предложение перейти на другой отдел и начать начать работать с командами которые были ответственны за наше ходу признаю кафку не говорили что ходу пфу на тот момент был в самом большими европе поэтому я недолго думая согласился ну значит идет примерно 2 день мои работы на этом новом это жирного модели чувство собственного достоинства от того что ты работаешь с таким большим ходу он растет с каждой минутой и тут приходит сообщение встала как говорят кнут сереж привет метку принять мне говорят сергея ты же новые пьем лайка и пьем это вот engineering program manager то чем я занимаюсь аллейка так как команда ответственна за ходу атаку на конечно да я и видишь как кажется что то идет не так второй день работы что когда что то идет не так какой вариант значит смотрите метрики мы идем смотреть метрики и мониторинге отыскать что на документ у нас мониторе камина рейками был вообще очень хорошо проблема была только в том что мониторинге у нас были технические то есть мы следили за нашими то там мало домино им надо ни за сетью за жесткими дисками другими вещами и этот момент что мы делаем я захожу и смотри ум , спрячь и что не так и вижу что у нас нет памяти просто с какого-то момента контейнеры приложение перестали запускаться просто из за того что не было ресурсов и соответственно очередь их приложение росла ну понятно чем мы делаем дальше мы пытаемся мы пытаемся понять какой из людей кто из общее людей кто какая из команд пытается что-то там сделать то что вредит другие этот момент я поняла что единственная метрика которая у меня была в кармане этого она выглядела примерно так я не знаю понятно ли бабушка вам что-нибудь здесь на этом пока не пойму здесь стоит мне поменялся адам не поменялся что-то пошло не так ну да ученик пока можно рассказывать появилась да ну чё-то не то немножко на быть мои заметки читать его отлично а при сдаче тоже грант этого тоже не было ну короче ладно ночью стоит кажется что-то пошло не так поняли что памяти нет памяти не то чтобы она отсутствует она полностью забита и новые приложения не могут запуститься из-за этого очень приложений растет пользователи немножко волнуется и задача была найти виновника торжества понять кто вообще чё там за релизе он и и зачем вообще получилось проблемы но зато у меня это было единственное метрика которая была недоступна и не знает понятно лишь ну ведь вам из этой метрики not mess тот момент было абсолютно ничего не понятно и и в этот момент я понял что следующий год моей работы в сырья с этими командами будет очень веселый и на в качестве сцепления как я говорил в нанси то чем буду рассказывать это том как сделать так чтобы все было хорошо при заданных условиях вас одно условие это уже существующей классный большой которые у нас есть эта куча клиентов которые этим пластырем пользуется и постоянные вас нагрузки хочу отметить что мы нашей команды которые с которым ее работы они не занимаются разработкой приложений мы просто даем инфраструктуру даем ходу подаем какие-то фреймворке нашим клиентам и уже эти клиенты сами несут ответственность за то что они делают за что они релизов мы никакого отношения вообще к релизу их приложений не имеем это вводные данные сделать а задача во вторых сделать так чтобы всем было хорошо о чем мы не будем говорить мы не будем говорить совсем о том как мы построили наш plaster смысла нет потому что в том году алексей вовченко по моему рефлексов ты рассказывал замечательно доклад о том как построить дата лайк для почты и доклад безумно классный советую тем кто не смотрел его обязательно пойти посмотреть потом предлагаю насладиться моим умением рисовать возможно я упомянул в описании доклада о том что я буду рассказывать о том как работать с клиентами на самом деле вчера я была вне всегда кланах и более-менее ног в каждом докладе рассказывается о том как работать и что делать если у вас там куча клиентов и они чего-то от вас хотят я решу эту часть выпилить почему потому что ну принципе вот все принципе они остаются теми же самыми вниз только на структура за которую несет ответственность я решил он согласился немножко на другом несколько месяцев назад может быть год я смотрел интервью одного менеджера из силиконовой долины вчера пытался найти его имя или не нашел поэтому просто будем называть его менеджером по моему он изъяв у и он пытался объяснять что такое сырья и он говорил вот смотрите у нас есть бизнес которая вот выражены людьми слева вот видит речная чистая отстрела это наш бизнес бизнес хочет идти к успеху успех находится справа но мы знаем что рано или поздно наш бизнес упрется в стену в кирпичную стену и остановится не сможем дальше и те и вот задача сырья заключается в том чтобы эту стену как можно дальше и усерднее двигать от бизнеса так чтобы бизнес ни на секунду не останавливался это может быть это то расстояние умножается на самом деле в месяцах то есть если вы можете знать что вас например через три месяца ли через полгода там ресурсов на ходу пи не станет и все остановится это не очень хороша и о чем я хочу сказать это о том о чем я буду рассказывать сегодня это о небольших кейсах которые нам в этом деле помогли некоторые из них покажутся очевидными некоторые нет надеюсь будет интересно поехали буквально три слайда честно не моих о том что он делает к это вообще прицела это ретаргетинг мы показываем рекламу кстати я хочу спросить забыл спросить интересная фраза можете поднять руки тех у кого нет от блока в браузерах спасибо воронка спасибо вам и так задача очень простая как видите три точки это обозначение того что мы в нужный момент времени нужному пользователи хотим нужно под нужную рекламы показать так чтобы он на нее кликнул мы займемся ретаргетинг что такое ретаргетинг это просто пока с тех продуктов которые пользователи уже видел или показ похожих продуктов которые пользователь лучше видел работает он следующим образом пользователь переходит на сайт рекламодателя там он смотрит какие-то продукты мы этого пользователя идентифицируем ставим укуку начинаем смотреть кем-то чем пользователь занимается такие сайты ходят какие продукты мы интересны потом какой-то момент времени пользователь переходит на сайт рекламодателя это может быть новостной сайт погодный сайт неважно главное сайт на которое можно размещать рекламу на котором мы можем купить или купить площадь для показа рекламы там мы пользователя идентифицировались с помощью той же самой cookies и показ персонализированный баннер этому пользователю и потом надеемся что пользователи tweeting потому что вот как александров человек говорил к сожалению нам не платят за показ нам платит только за клики за продали и последний слайд немой это real-time оптимизации для каждого баннера мы не просто посредник в показе рекламы мы не просто показываем готовые картинки мы генерируем баннер делом это очень быстро у нас миллионы продуктов которые мы можем показать миллионы различных вариаций баннеров которые можно показать и все мы это делаем на ли тут мы подбираем background layout для кнопок сами кнопки кино жаться продукты цвета и все это делаем очень быстро об этом и компании вся кратко об инфраструктуре и конкретно чем я занимаюсь критово я занимаюсь как и говорил краткой и ходу пам у нас есть шесть дата центров по всему миру это вот слева большой блок слева там есть куча приложений и эти все предложения они каким-то образом пишут логин пишут логи ставку на че нового нет потом за тыковки мы сам описаны средствами сохраняем на ходу пи и потом мы этими данными пользуется джо был preview's из поджигай на этом графике вы видите две катки я не знал возникает такой вопрос почему или нет но решил объяснить взял там что-то этот верхний край плане которые в синем прямоугольнички он для нас критичная почему потому что если данный начинают завязываться то мы не можем начинаем может начать терять деньги за счет того что мы у нас нет этих данных для обучения новых формул и еще мы очень сильно любим давайте данные нашим пользоваться нашим клиентам с минимальной задержкой то есть нашим партнерам чтобы они могли видеть эти красивые графики поэтому мы не очень хотим отдавать этот pipeline кому-нибудь кто пишет кастомной контра а кастомный код люди хотят делать хотят писать книги и приложения и поэтому мы сделали новый класс ставка streaming сделали мир декорирование между ними и сказали вот ребят вот этот класс я ваш делайте с ним что хотите немного числах в пике мы выдаем а наше приложение выдают дасти дасти не миллионов сообщений в секунду сутки это достигает 400 миллиардов сообщение в день в объеме это 500 р в день из них 410 из них точнее а всего 410 добавляем и удаляем просто потому что мы по законам мы не имеем право хранить данные на продолжительное количество времени это все сохраняется у нас в текущий момент времени на трех тысячах дата нотах каждый день на запускаются примерно 300 тысяч приложений на при deus и примерно 6000 ваших предложений так же у нас можно рассказать немножко наши аналитики делаете это не буду почему потому что вчера мы коллега александр назаров делал доклад аналитическая величина 100 петабайт если кому интересно аналитика можете пересмотреть сашин доклад потом когда он будет доступен вернемся к нашим метрикам вообще почему такой график у нас есть дело в том что на самом деле мы в рекламе решаем огромное количество задач и выключит разворованных задач у нас есть да это покуда the pipeline и и tls начальник белый юзер начинка и так далее ему потом на самом деле у нас как написано 70 больше 70 сервисных аккаунтов и более и это все места конца приближает принадлежат более 30 командным которые так или иначе используется на 3 deus помимо этого у нас есть еще более 100-а к пользовательской аккаунтов это аналитики и business intelligence люди которые пишут кинг как запросы мог еще чем делать тоже каким-то образом использовать пластырь так как вариант можно было разделить 1 постам несколько чтобы улучшить изоляцию чтобы например один пользователь не мог навредить другим пользователям или утюгом ока но к сожалению в наших реальных это очень дорого разделить на посты это значит потерять потерять в утилизация ауте волока хороший вариант но по некоторым причинам это не можем сделать видит по причина того что мы с компанией который представляет облака занимаемся возможно одинаковым бизнесом а вторая вторая причина это потому что облака дорога в наших реалиях что я начну делать естественно когда метрики плохие давайте делать хороший метрики они немножко здесь я их замы link чтобы не давать конкретные числа я не знал можно ли давать или нет ну картинка просто видно дали как примерно представления вас должна быть я полез и графит начал смотреть чем у нас вообще есть оказалось что у нас на самом деле есть паук в какие-то сервисы которые работают на кластере ведь которые что-то складирует графит но я начну делать начал склоните потом нашел данные об использовании dfs по объему данных потом нашел по количеству файлов чё то потом еще потом чешском нашел еще и в конце концов не получился грамену дашборд этот на этот даже гости какой-то момент я понял что на этот дашборд я трачу примерно час времени каждый день рождения прихожу и трачу часа времени то что лучше посмотреть а что делает наш пользователя как они не натворили чему за ночь пока я спал потом я вспомнил что дома давно и был разработчиком и написал систему шериф она просто простейший был за которой ходят разные источники беретки это данные запускает кит эвристические проверки и высылается письмо счастья хулиганом вот в конце концов спустя некоторыми понял что у нас с кластером все-таки есть проблемы хоть он и надежный хоть и там ничего не падает из технической точки зрения все хорошо на на все таки есть 2 проблемы опять пользовательские а можно назвать это просто deli общин что такое это просто когда пользователь нет контроля вас нет контроль над использованием ресурсов и отсутствие желания у этих пользователей что-то улучшать инфраструктуры рынка блемы это отсутствие king никаких конечно нас были но не полное множество тузов которые можно было бы использовать нашим пользователям а также не очень оптимально и хранение данных на этом кластере на нашем кластере и собственно наконец-то перейдем к первому кейса джейсон вчера после сатана доклады были попросту джейсоне собственно я очень люблю джейсон я скажу не засыпаю думай как же ислам прекрасен и каждое утро я просыпаюсь и думаю где вы мне еще внедрить джейсон числа но очень хороший но только до тех пор пока не приходит слон как только приходится слон обозначающий big data и играющих гармошка g-100 становится не самым лучшим решением но по понятным причинам джейсон занимает много места в леса немецкими схемы данных вот можем конечно вами поспорить там кто то может сказать что можно прикрутить кинуть колеса сбоку над несколькими данных у нас один раз выгнулась инцидент когда одно приложение начала писать свою ноги в чужой топик и мы это обнаружили только тогда когда эти данные пришли в чужом топике в чите fn и dfs и там уже пользователи какие так же быстро и запустили и поняли что ребят а тут какие-то данные которые вообще не мы генерируем и также он требует много secu на почему потому что каждый раз когда вы вообще что-то читаете среди офисов формате json вам нужно это джейсон расспросить какой вариант решения например пакет атомов существует множество вариантов они не данных на офис и у нас сейчас многие говорят около обычном формате хранения и мы подумали что наверное для логов очень формат хранения хороший такие такого очень формат который разработал twitter и который сейчас много где используется в то что в том числе у нас ну а вместо джейсоном этот паркет по колоночный можно писать про табов пока буду испытываем прекрасно почти прекрасный только при зачем приходить нужно ответить на вопрос действительно ли так хорош этот формат потому что многие о нем говорят нужно проверить автора если если он действительно хорош то возникает проблема как мигрировать 30 больше 30 команд на новый формат данных поехали значит в чем на 1 действительно так хороший парке поэтому ну на самом деле down хорош но не во всех кейсах но здесь что мы сделали мы решили провести эксперимент мы взяли какой-то большой лог действительно очень самый большой лог переконвертировали в 3 разных формата и начали читать данные из этих трех форматов и это как оказалось здесь вы видите по оси y этот секунд и время процесса на время которые тратятся на чтение формата опасен x количество полей которые мы читаем и злоба понятно что для формата json это оранжевая линия все очень плохо правда констант на потому что независимо от толку количество полей вы читаете нужно сильно прочитать и строчку вот но все очень плохо процессор на и время тратится очень большое парке протонов которым мы говорим так он пока гоночные он время принципе зависит от количество колонок и чем больше палок вы читаете на самом деле тем больше прими традиций какой-то момент когда вы например книги заходите читать больше в нашем случае там больше 50 процентов колонок вы поймете что этот формат не работает он не дает ему за такую производительность которую вы могли бы получить читаю данных меньше какой вариант есть есть еще замечательно формат 5 секунд то есть можно хранить про табов и те же самые но никакого научной информации от посадочном формате и для данного конкретного случая это будет работать какой здесь вывод можно сделать пакетов хорош но прежде чем его использовать постановить будет разработан для вас и может быть вам все таки не стоит колонкам сохранить определили формат как теперь на него мигрировать ну короче всего очень просто давайте мы будем писать все блоги в одном формате иначе tfs потом напишу им живую которой будет эти логе конвективных другой формат потом пойдем пользователям сказал смотритель данные в новом формате доступно а давайте вы теперь иммигрируете свой клад на новый формат план замечательной очень крутой имеет только две проблемы первая проблема это достаточный объем хранилища дело в том что у нас логе занимают примерно 30 процентов ходу по это 50 петабайт примерно и писать эти 50 это метод еще возможно там немножко сольки мир с оптимизированных от объема это все равно очень много это очень давно это расточительство а еще в тебя влюблен а потому что пользователи ленивые вот чего не делаете они будут ленивая и знаки скопа это длинный хвост и он всегда будут такие пользователя которые прям долго-долго the same после дела мента будут тянуть и вообще ничего не будет для вас сделать хоть вы хотите как начальнику хочешь ругайтесь на длинный хвост всегда будет поэтому такой такой способ нам не подошел тут я сделал небольшое отступление потом вернусь проблемы напомнили поэтому вот на эту картинку можете не смотреть это стандартная картинка из документации ходу при диарее чем я заю забыл удалить значит снимает ваше внимание очень плохо но посмотрите на числа справа все такое на им надо ну и но тут просто там какой-то вид астор данных которые вы храните в вашем ходу питом хранятся блоки файлы папки все это хранится память и и как следствие как только например как только количество файлов а файлы и по или папок превысит 300 миллионов сегодня каким бы каким какой большой бы ни было ваше наивно насколько вы память там не было в каменты вы достигнете той границы где ваш демочка лектором сказать ребят я тут поехал оставайтесь без меня можно конечно тюнить мы выбирали разные живые мы снова размешиваем и вытягивали azul мы поставили много перлина оперативная память и на север там нас порядка 700 с лишним гигабайта оперативной памяти из них 580 длина на кучу в любом случае вы просто подвигайте границу с которой мы столкнулись уходу по е стандартное средство решения проблем назвать это direction слякоть одеваешь надо просто это как шар линька вы просто берете и говорить вот эти вот данные ханин одноименного 9-дан от одного на другой но многие эти данный на 3 нам надо все прекрасно прекрасно все легко конфигурируется для исключения одной проблемы дело в том что вот здесь внизу две строчки показывают эта проблема дело в том что есть небольшая специфика переноса данных нас 1 нам надо на другую вот если например вы хотите принести ноги эти ноги пишутся в попу там юзер джон лакс users my plans to вас не получится это сделать почему потому что на им надо определяется кем то суффикс суффиксом у префиксом просите префиксом пути и поэтому чтобы перенести данные на номинальный ногу сделать шарди рования выделить какие-то метаданные дугу и нам надо вам нужно еще логе перенести в другое место и таким образом у нас получается уже две проблемы и которые нужно решить одновременно это изменить формат хранение данных перенести логина новые немного другое место начав с а также сделать это прозрачно для 30 пациентов пользователя и новичка нам приходит это диска что такое the disco когда вы почитаете и читайте и пишите в наш офис вы используете там вы используете input от форматы просто класса для доступа к данным и соответственно когда вы хотите читать данный формат и вы используете один оба класса к из другого формата того и набор классов и соответственно если вы хотите иммигрировать пользователи снова форманта на другой ему что-то от все переписать мы подумали а что если мы сделаем это свой мета информатор и мы его сделали что-то когда диск очень упрощенно здесь мы взяли и абстрагировались пользователя от формата в котором хранятся данные и от их месторасположения и теперь когда пользователь хочет почитать какой то лог сочинив с а ему не надо указывать никакой путь ему не надо указываете формат он просто указывает идиш ник и в конфигурации этого input от автомата к сожалению сейчас репозитории вас находится вся стая информация которая необходима для того чтобы найти эти данные и как ты их прочитать часто все находится в в нашем репозиториям выполнением перейти на какие-то страх потому что сейчас есть эта проблема с релизами нужно как-то синхронизировать релизы чтобы все эти схем одновременно выкатывались надеемся ты хоть не достоин это все решит сейчас как раз над этими работами более того существует проблема как я говорю это вот проблема решается то о чем я сказал это поможет вам решить нам помогло решить точнее проблема с изменением формата данных ну дело в том что мы как я говорю мы не хотели писать одновременно дублировать данные и поэтому какой-то момент времени нам бы пришлось взять и сказать смотрите вот мы пишем данные в одном формате в старом месте расположение начинать кого-то времени мы начнем другое место расположения и мы сделали так что это все работает как работает на самом деле вот информацию формат который видите отделение от конфигурации их может быть несколько и у них могут быть приоритеты и поэтому дает нашим это информатор что он делает он просто идет в место с наибольшим приоритетом смотрите есть там нет идем туда место это все прекрасно работает пользователю нагревания формат успешным с некоторыми проблемами но не очень большими и теперь у нас есть полный контроль над тем где хранятся данные в ком формате все прекрасно какие бонусы он получили все приказ не работает skype ну просто по определению а вот а также с интерфейсом и так же мы это все интегрировали в к скале next полный холодильник и spark отец фреймворке с которыми мы работаем по этой склон контроль над стенами данных давайте сразу на следующий слайд перемещусь давайте подумаем сколько может стоить 1 байт который вы добавляете в каждое сообщение влоги толик немного да но когда вы достигнете кого-то какого-то уровня по количество сообщений продаем их секундах это может вылиться в копеечку например в нашем случае я немножко округлил здесь если мы захотим этот один байт хотите самом большом блоге то каждый байт который кто-то хочет добавить вылиться 83 боится место на жестком диске на этот один сервер вот не очень круто а у нас не только мы-то здесь сидят люди вот про не качаем наговорили называется data нежнее додотто санте сны этого те люди которые любят тысячи есть люди которые точнее они любят много чего писать потом смотреть как вообще там вот формула эти любят много чем добавлять и раньше когда у нас был джейсон контроля на схемы не было об этом of он дает такой контроль и теперь например когда кто-то из пользователей сами тиц строчки и схему которая содержит себе string или лепетать стала у нас срабатывается тренер ручной но все же триггер и я иду разбираться и идти с людьми и разговаривать на тему этого десанта на этом это им надо или нет следующий кейс квота помните гориллам к победе вообще не знать что такое трагедии общин можете руку поднять он прикольно я ждал больше ну on the где общин вообще стандартная ситуация в экономике лектории мир очень коротко представьте что у вас есть поле с овцами и несколько фермерских хозяйств которые этим полем пользуются каждом фермерском хозяйстве есть одна овца все живут и все довольны опции дают шерсть и мир и покой на какой то момент времени 1 фермерское хозяйство что делает она говорит а если я выпущу еще одну овцу то как овец испанец стреляет ливанское хозяйство не очень больше травкина на лугу станет чуть чуть поменьше может быть никто этого не заметит но в тексте у меня будет 2 раза больше чем у других хозяйств я куплю себе плазменный телевизор ну и чо к чему это может привести конечно же я к тому что так подумают всех и все выведут повторится и в итоге вот так не будет и of the shogun год печально тагиле общин существует несколько решений на самом деле супер asian сопливая и закрывает решение это просто регулирования в день regular аналогия с полем это давайте мы просто повесим на каждого супа девочки поставить пастуха который будет смотреть киев спасутся и будем делать опять а и тому кто вот свое приводит овцу без бирки как это соотносится с тем что мы имеем в ярни и у вас есть учителя помните эту проблемы которые рассказал про память вот у нас была одна большая очередь для всех продакшен пользователя просто одна большая куча читайте этот одно поле с травкой и куча пользователей которые запускали свою джебы там и каждый пользователь не думал что ну блин очередь большая я так как будет могучим там по запустить такое что мне там посчитает куча всего и потом у нас вот все будет хорошо это заваливалась проблема нам хотелось это все нам хотелось разделить соответственно очередь на несколько и так чтобы мы не потеряли в утилизация так чтобы мы получили хорошую изоляцию в там в это же самое время и имели какие-то гарантии на самом деле это все наверное многим из вас это кажется прямо вообще очевидным очень легко ну просто меняем конфиге все замечательно работает и это действительно правда это снова столько неправда когда у вас уже куча пользователя есть эти пользователи все хотят ресурсы и вам эти ресурсы нужны между ними как-то поделить а когда вы начнете 9 ресурсы между ними они придут к вам скажут подождите ну я хочу больше почему ты будь дадите 20 процентов там очередь а нам 10 это была очень большая проблема к тому к тому же у вас есть 2 варианта разделены ресурсы на даже бы на самом деле больше вариантов я выведу this два из самых очевидных это разлить ресурс его пользователями разлить по департаментам он кажется у каждого способа есть свои плюсы и минусы если мы делим пользователя мы получаем хорошую изоляцию не как бы буду пользовать для каждого есть свои фото там есть какой-то предел за которым может выходить поверх этой квоты на сион и тот самый лучший уровень изоляция ну очень плохая утилизацию если вы если вы делаете из долины по департаментам то есть пытаетесь они пользователь который в одном и том же департаменте сгруппировать и положить в одну очередь это вам даст средних изоляцию но все он лучше чем вообще без изоляции но добавится зависимость от традиционных изменений каждый раз когда у вас куб каретки интеграционные изменения компания вам придется счет менять что помогла мы сделали всплыть если кого не боится мы просто взяли и решили нам очень нравится и зрения по департаментам мы очень сильно хотим этом формате те но мы не хотим привязываться к нам департаментом давайте вместо того чтобы называть очереди департаментами назовем их абстрагировано каким-то мы подумали давайте назовем их цветами и же прекрасные роду какой радуги плюс большой но там количество цветов ограничено уточнение очень ограничено но вот но и мужском представление ограничено их 7 и 7 и поэтому давайте мы сделаем все матчи людей полосой на всех хватит мы сделали длительно все помогло мы очень долго крайней потратили на то чтобы договориться с людьми на тему того кому сколько дать код все помогло и на сайте вот и ну и на самом деле большой плюс еще того что как большая очень красиво это выглядит на метриках и тиграна как я говорю трудно было использовать на работать когда вы пытаетесь начнет чем текли регулировать 3 на 4 гулять они будут вам приходить и говорить в нас нет времени у нас так хорошо вообще вот вы должны заниматься вы же лайк вы ответственно за ходу вы делаете вы почти джаббы какие-нибудь наши там смотрите как то все книги делать и на самом деле в этом сам есть смысл какой смысл пользователя они конечно ленивым но тогда у них нет представления о том как что-то улучшить можно они для них это будет казаться проблемам и при этом и плюс к этому как как правило ребята которые работают в командах которые пишут на призы бы там конечно есть сильные ребята но как правило эти ребята стали специализироваться в чем-то другом и они не такие профессионалы в мире ходу по вариант какой-то дать им инструменты сейчас говорим немножко об инструментах примерно два года назад камон пара месяцев назад я ищу посмотрите на утилизацию и более конкретно надо замечательный такая есть тут он называется доктор элефант что она делает враг это просто какой-то сервис котором есть набор эмпирических правил которые каким-то образом смотрятся на то как выполняется ваши джабле и дают такую статистику не садись qr не дается некий цао лир типа того что некоторые g бы не очень оптимизированы ну и вот я нашел к ютубу и не стало интересно если вы посмотрите в обведенные красным кружочком чистоту увидите что тот же банка этого просила на контейнер 8 гигабайт памяти максимально использовала 742 мегабайта то есть только 10 процентов от запрошенной памяти она использовала поэтому 90 процентов омытия которая была выделена просто простояла в течение выполнения этой джаббы потом мы взглянули на все с более высокого поля с более высокого подписано как сказать в общем в другом масштабе и поняли что на самом деле это проблема не только конкретный джаббы от объема вообще всего кластера на этом мягкий увидите желтая линия это память которая в сумме запрашивается всеми приложениями осени сине-зеленой полосочки простите это то что реально эффективно используется не поняли что половина памяти которая запрашивается нашим пользователям не используется а половина памяти при масштабе в 3000 машин это полторы тысячи серверов кажется сильно дорога спирова человечек это гармадон понимаю расскажу чуть позже думали как посидели постеры или подумали как то решать эту проблему и и решили сделать такую штуку под названием области причин что это такое ну давайте им просто сделаем так чтобы наша наш yarn говорил что у нас например не 500 терабайт памяти есть доступных а например 800 и если таких 808 100 гигабайт памяти эффективно будет использоваться только половина то есть 400 но все мы будем гладить память мы подумали а как говорится у нас столько много людей в это понятие что то что ты думаешь об этом думает еще шесть человек полезно смотреть она оказывается есть он оказывается есть и и вроде как там работа идет ки пиццы и надеемся что с кого это все будет советуем посмотреть называется держим 10 11 tickets посмотрите может спасти вам много ресурсов герман дон вернусь вот этот человечек леговски на это наша разработка которой мы сейчас выложили в opensuse к сожалению сожалению мы получили код не успели выложить документацию частных документации работаем поэтому не пугайтесь от того что документации нет вскроет там все появится этот момент мы поняли что нам хочется себе иметь больше статистики о запущенных контейнерах в в ярни не только запущенных контейнерах но я там например какие данные не читают потому что нам пришло осознание что мы не очень не следили с самого начала а там вообще кино сданы на кластере хранятся на то что мы не владели этим до нашими данным владеет пользователям был один только лагами и мы вообще не имеем понятия кто какими данными пользуется и вот для мадонна пример он может помочь с этим то есть онлайн собирать статистику о том кида начинается куда-куда данной пишутся и кучу другого статистики не буду здесь становится времени мало чуть об архитектуре в каждой конторе и мы запускаем не про небольшой один он на самом деле дает большого города практически незаметный эти агенты люд какую-то статистику в вот эти вот большие квадратики так много у нас к синенькие то контейнера не фрагменты я это все летят со формат avi формат льют в кафку а из кафки это уже льется вот в доктора или фон для того чтобы могли листва дня перечисли правило власти к пластик search и плохо видно почему-то не знаю видно или нет еще будет литься в ходу в ближайших варя кроме гармадона мы сделали ups но в отличие от гармадона упс быть залетин не вы счастливы возьмём канцелярскую быстро want profile сервис как оказалось ну наверно многие многие из вас знают что такое центров и еще наверное многие знают о том что есть такое a single а с них попали в которой написал андрей панин из mail.ru и мы подумали что наверное очень поста как-то каким-либо образом утаить вот асинхронной профайлер за использовать для наших грибов сказано сделано мы сделали сервис упс котором можно просто заходить выбирать вашей при конечные день выбирать количество контейнеров которые хотите профи про провели и смотреть на эти миграции на самом деле очень большой профит принесло но как большой приступа вот некоторые команды пришли и сказали что этого очень сильно помогает и они действительно начали видеть прозрачно видеть в каких местах они могут что-то улучшить блум twitter это просто пример того как какая-то команда просто интересная история сильно не сильно она сказать вяжется с докладом но я решил стать просто красивая история оптимизация есть у нас замечательная команда была называется в лобби ты инженерных которая занималась с некоторым негативным сборам по некоторым набором под задач в семье конкретная работа узнанными конкретно она не логин для того чтобы они потом использовались машинки для для обучение новой форме столько будет винтарь просто документ наверняка большинство летальных знать это вероятность я структура данных которая очень оптимально вам может отвечать на вопросы содержится элемент на малые в множестве элементов x y z для этого вам множество x y z вы строите блум фильтр это просто набор каких-то вшей на борт и хэши считается для каждого элемента из множества они потом вы и лимита w защита дитриха шаги смотрите это действенно 3 венички или нет если есть то есть это вероятность что элемент dom luis арендуется и но если есть хотя бы один нолик то точно именно луи не содержится в этом подмножество не запоминаете это не надо это запоминать я просто напомнил просто как мы это применили и у нас есть бедрик место это look bad request это те запросы которые к нам приходят это за праздник к нам приходит запрос о том хотим ли мы показать пользователю рекламу или нет это называется бедрик местом еще у нас есть например display the melodies тариф нас ещё куча всего на маленького человека диалогами лог дисплеев гораздо меньше почему папа бить по простой причине потому что мы в мире не так уж и много запросов относительно то есть там какой-то меньше процента и более того чтобы когда мы там summer очень нам нужно брать несколько дней брэдбери квестов просто потому что бизнес так хочет так вот это не очень эффективно просто дать ему чуть не очень эффективная команда сделала классно rihanna они построили был фильтр по дисплеем потом счет блокирует пропустили бедрик место оказалось что после этого бы 3 классе очень сильно уменьшается и и операция join занимает гораздо меньше и дает минус тридцать тридцать тридцать пять процентов не палите звучит непонятно много это или мало но на самом деле там вот изначально у нас это команда потребовал примерно 30 процентов 20 х 20 вас копейка центов ресурсов кластеров поэтому на самом деле это ведь на хорошее достижение времени мало ехать как сказать еще про бэкап потому что рано или поздно вы поймете что это но нужна она или поздно вы помните что у вас наверняка есть админа это те люди которые которых есть прав чуть больше чем у обычных смертных еще есть люди у которых толстый палец ну подтягивает а знаете да что такое тогда вы случаем нажимаете на ту клавишу на которые хотели эта ситуация называется толстым пальцем этот видео и каналы живем в идеальном мире эти доносится не пересекаются но все мы знаем что этот мир on tv не самые идеальные поэтому рано или поздно вы поймете что backup все-таки он необходим даже если вас репликация это все дела так шо ты все на пикап нужен и мы достигли 3 три решениями сел панели mapper все они пульс не подходили выбрали map и мы это был большой пункт как большой проект несколько недель мы тестировали всякие разные параметры чтение данных скорость восстановления куча других от итоге мы потом подошел больше всего и не хочется человека ван диска на диск это такое решение посмотрите есть я если вас не очень большие ван диска дает вам прям прозрачную синхронизацию разное реплицирования данных между кластерами совсем коротко будущая а то над чем можно было говорит на о чем и не буду говорить итак немощен это просто убивание контейнеров когда они используют другие ресурсы когда джаббы из-за какой-то очереди используют ресурсы другой очереди а там они сейчас нужны взвешенный рестлинг это давайте уж в самом деле мы использовать к пасте скончания века пастис cancelling многих знает он используется только один параметр в качестве конфигурации в качестве ограничения ресурса которые вы представляете пользователю это все зависит от ситуации мы используем доминантный способ это когда система смотрится на очередь смотрит какой у неё что часто чего чуть больше используется семью или memory или и этот параметр используется для ограничения конкретно этого ресурса какой минус ну потому что мы не знаем для каждой ночи легко и общая доминирующий ресурс будет и поэтому мы сейчас работаем над над написанием нового скрининга вниз king а калькулятора на самом деле который бы позволял задавать два параметра это ограничение на secu накрученными мария один бы из них были на время работал едва-едва класс тогда мы запускаем второй кластер и там куча проблем с этим связанных есть об этом я не буду говорить всем подходим консультант place все очень просто на самом деле подытожила чем я всем говорил сегодня самое начало думайте грамоте данных рано или поздно всем вот ваши упущение которые не пучения высота но чем вы не покусились самого начала выступы стрелец поэтому само начало думаете о том как вы будете хранить данные в конформации где и да и ну и под их тоже будете и также сделать и фортранс папок острижены игры в общем очень большая тема как сделать фракасс для ходу пахнут очень сложно у нас есть целая команда называется копла копла capacity planning да еще так за скин гоонского называется успех кто знает и они у нас будет на кран который будет делать farkas до нашего ходу по ее работать использовать издать задайте им рамки но не очень жесткие потому что ссылки не очень хочется чтобы пользователя к тому же такие сильно отличались своей бизнес-задач задача конечно него самое важное вот насадки пользователи должны как-то ничего фея питаться ограничивать дайте им обязательно в не такие сервисы чтобы они понимали вообще что происходит и видели что можно изменить и обучить их учите их тому как эти метрики использовать вообще чего не могут делать а потом жалуетесь на них и просите их это ты посреди слайд на самом деле мы очень любим общаться с людьми на эти вот около ходовые темы и вообще беда эта тема мы очень любим принимать власти людей поэтому если вы вдруг побудить из парижа то заезжайте власти мы обязательно сам говорим выпил чай и поделимся кинуться нашими нашими нашими достижениями и по спрашиваю вас о том как все устроено волосы к нам приезжают мы очень радуемся это реальный вид с нашей крыше там еще и фигу башне тоже видно с другой стороны на этом все спасибо большое теперь вопрос если есть очень много всего очень быстро я говорил простите если вдруг показалась интересной понял сергей спасибо за доклад очень интересно у меня вопрос по квотам вы сказали что перешли на концепцию по rainbow можно по подробней как вы юзерам в итоге вы выделяете не посредством вот эти цвета мои ресурсы реально большая тему нас на самом деле был был проект и прежде чем этот разделение внедрить на самом деле нам пришлось собрать всех инженер менеджер f1 как об одной команде и прям реально приговорить с внутренним менеджерами о том почему вообще какая проблема есть и как и почему не нужно решать прямо сейчас не ждать дальнейшего как мы это все сделали мы просто пытались скопировать задача которой выполняется на кластере потом по их отношению к нашему бизнесу так чтобы культа чтобы более-менее немножко было отношения понять что департамента меняются за команды приходится на вводе параметров другой но бизнес-задач кита выполняет эти приложения остаются и поэтому такое деление просто вот поэтому так мы сделали не знаю понятно или нет нет можем потом дорисую ну там когда вы разграничивать и очереди там есть несколько параметров это типа минимальное кого-то дочери и максимально кто-то за которая может приходить да это называется эластичностью настало стич нас есть для каждого очереди джаббы которые могут запускать эта очередь аксуме могут есть больше ресурсов чем есть для этого мы сделали ещё одну очередь названием под названием elasticity порядка на занимать 10 процентов от кластера и ну просто чтобы так сказать были кита свободно ресурсы чтобы пластичность поддержать примерно так а вот но удачно ганс вопроса вы ничего не сказали о провал доступ в астане когда разграничены к объектам внутри конечно на самом деле не очень силён или теме к сожалению посетили цена не отвечу у нас используются kiabi раз для нашего ходу кластера с более боль боль но в то же время пофиг и да конечно же мы не одни логе стараемся прятать от других пользователей которые содержат бизнес инициатив интернет информации которая должна быть доступна другим людям поэтому мой ответ короткий да у нас такое ограничение такие штуки у нас есть тратят больше ничего не могу сказать если но если интересно и могущественный если вам хочется поговорить кент не давайте мы потом судьба потом гнев вконтакте да и второй вопрос на ней позволить вы насколько вот ваш коллега вчера говорил вы работаете сухая вам на почему ну аналитики часть аналитиков работают с файлом по крайней мере так почему в этом смысле вы смотрели на формат паркета не на arc я не знаю без понятия были люди которые решили стать долл живут почти я не знаю может быть саши вам потому перед плавать не знаю , то ли нет их не спасибо спасибо кажется больше вопросов нет с а вот я в чем доброе утро во всех закат очень интересные инструменты часть из них ну точно буду пользоваться тоже думаю вопрос вот этот же гармадон который вы использовать в анализируйте дам словно как люди пишут используют эти данные хранилище anton а какие дальнейшие шаги то есть то пусть какой-нибудь клиент нальет там не знаю что терабайт какому-то мусора а там ведь что она не использует то есть что обычно там вы делаете какие-то административные шаги или просто выпиливать эти данные сохранились там не только вот у человека уменьшает понял сразу видно что либо у вас есть боль есть у нас в этом месте либо вы умеете предсказывать предлага давать интересные вопросы на самом деле это просто реально вопрос с данными очень большой вопрос то наша компания час стоит ну что некоторые ботаника то количество времени вообще нет за ним не следили и сейчас мы понимаем что он дан у нас объем данных растет и мы не понимаем иногда даже могли понять почему и на самом деле ген могут дать вам прямо классно в ответы на ваши вопросы потому что у нас есть целая отдельная команда отдельный менеджер заниматься проблемой отдельный проект названием to the goblins который как раз таки и для этого проекта на примадонн запихнули эту функциональность по отслеживанию того какие файлы читаются или киньте не читается пик до пены куда пишется то есть ответить на просто не могу наверное будем следить и знаю будем смотреть кто что пишет подобная питаться на клетки крона кейс с разговаривать с клиентами не знаю интересно поглощать небольшой вопрос а за самими запросам которые они пишут там смотрите сильно систематически условно за их качеством там на тоже разума структуру запрос они тоже там они не используют а вот и наш как они и правда сейчас в том числе этой заповеди поляну прокофьева начинай могу сказать хай вин заниматься другие команды вот здесь сидит саша саша подними руку пожалуйста посмотрите саша один доклад аналитические база данных сашин вот может с вами наверное пообщаться в кулуарах и отвечать вам на вопрос про hive нужен саранске занимается этими задачами спасибо большое спасибо вам"
}