{
  "video_id": "Lu4tsUvfYRc",
  "channel": "HighLoadChannel",
  "title": "Нагрузочные стрельбы по запросу / Антон Барабанов, Дмитрий Годов (Variti)",
  "views": 720,
  "duration": 2909,
  "published": "2019-05-14T14:46:00-07:00",
  "text": "мы сегодня расскажу будем стараться тестировать наших клиентов но и немножко мы работаем в компании варите забросить штуку меня зовут о том барабанов я руковожу разработкой хай-лоу система я занимаюсь уже 9 лет и все эти девять лет и занимаюсь в том числе и на грушин тестированием потому что без него ха лол всем разрабатывать невозможно здравствуйте меня зовут года дмитрий и я старше тестировщик в компании варите что мы собственно делаем само по себе компания разрабатывает систему защиты adidas так систему фильтрации легитимного трафик это требует работы на очень высоких скоростях для того чтобы эти скорости обеспечивать проверять что мы им соответствуем мы создали свой тестовый стенд на котором начали проводить сначала на грудь а потом 100 раз тестирования что такое стресс тестируем чему она немножко отличается нагрузочного да потому что мы эмулируем атаки то есть мы изучаем все атаки которые приходят наш кластер мы их препарируем и вставим их свои тестовые планы для того чтобы проверять свою собственную систему на успешное отражение таких атак и для того чтобы проверять впоследствии клиентов когда мы свой тестовый стенд запустили какое-то время с ним поработали более что он может быть полезен для кого то еще потому что множество людей уже умеет делать наружу тестировали но не все делают с тестирования некоторые люди думают что их сайт уязвим то есть михайлова система у них жить не узи манеру из винда уехала от системы они защищены от атак соответственно мы можем показать что это не совсем правда плюс к этому на грудь тестирование как правило это все-таки некая обычная нагрузка до о стресс-тестирование мы показываем что есть какие-то слабые места уязвимые точки в ресурсе их стоит поправить у самой стал разумеется когда мы проводим такие тесты мы соблюдаем законодательства рф то есть получаем разрешение соответствующие за подписью и печатью то есть нашей помощью de dos атаку сделать никого нельзя как мы это делаем немножечко хотелось бы рассказать ну так как мы тестируем клиентов которые не располагается в наших сетях то есть это происходит фактически в диком интернете для того чтобы наш тест не закончился на первой же минуте нам нужна какая-то подсеть для этого нас системные администраторы нам такой потеть организовали плюс для создания значительной нагрузке которые у нас есть свой тестовый сервер который тоже достаточно мощный для проведения подобного рода тестирования в процессе тестирования всегда может пойти что-то не так там какие-то сюрпризы случится там для этого у нас постоянный контакт заказчиком которые там только сообщает там какие-то результаты достигнуты хной может попросить что-то поменять в ходе и по завершению тестирования естественно мы составляем отчет в котором мы указываем какие-то недостатки то что мы обнаружили даем рекомендации о проделан то есть после проделанной тестирования пятерку мы подойдем вплотную собственно к различным методикам хотелось бы сформулировать несколько мыслей которые прозвучат несколько раз первая мысль случается в том что в стресс-тестирование много это не очень хорошо то есть чем меньше нагрузка мы сможем довести ресурс до отказа тем лучше если нам получится сделать так что веб-сайт перестал функционировать от одного запроса в секунду еще лучше того запаса в минуту это прекрасно чем в то что по закону подлости пользователи случайно попадут именно в это место или это будет не пользователя какие-то нехорошие люди вот как бы там ни было с чем меньше в нашем случае чем меньше тем лучше второй момент связан с тем что мы очень любим гетерогенные системы то есть мы всегда всем советуем системы делать гетерогенными причем разделять их в том числе на уровне собственно физическом только не только контейнеризации да именно физически разделять машины зачем за тем что если что-то откажетесь и что-то сломается полностью веб-сайт не прекратит функционирование если вас сломается там какой-то тяжелый функционал ну печально конечно но пользователи продолжит чем-то пользоваться и как-то жить третий момент связаны с тем что отказоустойчивость ресурсы и его способность выдерживать атаки способность выдерживать нагрузки закладывается на этапе проектирования на этапе рисование первых картинок в блокноте еще даже до и эмаль диаграмм и если там допущенной фатальная ошибка с таким нам доводилось сталкиваться к сожалению то исправить это потом очень сложно защитить можно но не очень прост и последний момент связан с тем что очень многие люди думают что хорошие за команда разработки это гарантия отказоустойчивости сервиса хорошая команда разработки это необходимая вещь сеньора это прекрасно но должна быть еще и хороший эксплуатации ли хороший devops то есть тех кто правильно сконфигурировать linux то правильно сконфигурировать сеть кто правильно напишет конфиге джон x сделает лимиты и прочее прочее в противном случае у вас все будет хорошо работать только на тесте а в продакшене все в какой-то момент после сломается хотелось бы пару слов сказать о том чем нагрузочное тестирование отличается от стресс-тестирование нагрузочное тестирование предназначена для того чтобы выявить пределы функционирования системы страз тестирования но направлен на то чтобы эта система сломать и посмотреть на то как она будет вести себя в процессе отказа тех или иных ее частей для проведения нагрузочного тестирования обычно собираются какие-то профили пользователей то есть эмулируется их поведение ну например есть у нас там интернет-магазин как банальный пример пользователь должен залогиниться положить что-то в корзину нажать кнопку купить там и заплатить или и так далее страз тестирование направлена на поиск именно слабых мест системы соответственно из предыдущего можно сделать такое так сказать подвести итог что нагрузочное тестирование она оперирует обычного строго определенными профилями пользователей и редко выходит за эти рамки в то время как во время стресс тестирования особенно для заказчика характер нагрузки обычно остается неизвестным то есть он до последнего не знает что ему будут нагружать собственно виды нагрузки мы обычно делим на нагрузке на уровне r7 это на нагрузке выводе приложения чаще всего под этим понимают только учтите пи выполните подозреваем всего по такого народе типе и нагрузка 034 начнем с r7 здесь есть определенная тащит ее черты именно в контексте а так они встречу во-первых такие атаки приходят непосредственно в приложения то есть отразить их какими силами и средствами мау реально они задействуют логику и за счет этого очень эффективно при небольшом трафике потребляют цыпа употребляют память диск базу данных и так далее так далее как и в случае три части вообще в случае любой атаки нагрузку проще создать чего обработать в случае всеми это к сожалению тоже так такой трафик не всегда просто отвезти его может отличить от легитимного по частотности чаще всего по тем или иным показателям но если все спланировано правильности все спланирована грамотно такие к сожалению инциденты тоже бывают то просто пологом понять где атака где нормальные люди невозможно ну и в качестве первого примера хотелось бы рассмотреть такое так как почти типе флуд из графика видно то что это обычно очень мощная атака в данном конкретном примере там в пекин превосходила 600 тысяч запросов в минуту чем они отличаются такие да так это самый простой способ создать нагрузку то есть берется какой-то инструмент нагрузочного тестирования примерно патч benchmark задается там какой-то запросик цель и вперед но при этом при таком простом подходе очень большая вероятность нарваться на кэширование сервера для этого это каширование можно легко обойти например добавив какие-то случайные строки строку запроса тем самым вынудив сервер отдавать постоянно свежего страницу генерируете и за ну так же не стоит забывать про user-agent в процессе создания такой нагрузки потому что многие easier агенты популярных этих инструментов тестирования они фильтруются системными администраторами еще поэтому нагрузка может просто до бэг-энда не долететь вставляя запрос более ли менее валидный заголовок взяты из браузера можно значительно повысить результат но при всей простоте такой вид а так имеет и свои недостатки первое это то что для создания такой нагрузки требуется все таки большие мощности и второе это такие атаки очень легко обнаруживаются особенно если идут с одного адреса они быстро начинают фильтроваться либо системными администраторами либо уже на уровне провайдера когда он видит то что с какого-то адреса началась на легитимная активность соответственно стает вопрос нам нужность снизить количество запросов в секунду но при этом не потерять в эффективности для этого нужно проявить немного фантазии и исследовать сайт нагрузить можно не только каналы или там сам быть серверной части приложения которые используются например база данных база данных или файловая система также можно поискать страницы которые там или места на сайте которые делают большие вычисления калькулятор и различные тона не знают подбор там продуктов и прочее прочее часто бывает так то что например на сайте есть какая-то большая печь и скрипт который генерит страницу состоящий в нескольких сот тысяч строк это тоже достаточно большая работа для сервера и такая страница является вкусной целью если можно так сказать но и всякие вот такие вот вещи в процессе поисков часто всплывает где мы такие вещи щен когда мы сканируем ресурс перед проведением такого тестирования переводчики что мы смотрим на сам сайт мы ищем всевозможные поля ввода всевозможные тяжелые файлы все что угодно все то что мы можем зацепиться все что может создать проблемы ресурсу и все что его замедляет есть банально помогает средства разработки в google chrome и firefox где показывается тайминги времени ответ по доменам это же сканируем что имеется ввиду если есть магазин об этом ком предположим то у него может быть под домен админа бац и ком это админка скорее всего в этой админке скорее всего на за авторизации но если в неё пустить нагрузку то это может стать проблема в том числе и для основного ресурса это может быть api абадском то есть это скорее всего ресурс для мобильных приложений приложение можно найти взять его в глупой истории в appstore дальше можно поставить специальную точку доступа препарировать и пей зарегистрировать тестового аккаунта и все здесь будет проблемы зачастую люди думают что все что защищена авторизации все что за авторизации да все это неуязвимо для тех или иных атак на отказ обслуживания то есть формально авторизации это лучшая капча это не так сделать 1020 тестах аккаунтов это очень просто вот сделав их мы получаем доступ к этому самому сложному неприкрытом функционал и собственно его ломаем скажем так если можно так выразиться естественно мы смотрим на историю то есть здесь упомянут robots.txt мы смотрим ученого борщев мы смотрим на view dns иногда мы ищем старой версии иисус то есть иногда бывает так что выкатили скажем mail 2 яндекс нет да вот остался моего яндекс нет и этот индекс на ту же не поддерживается на него не отводятся ресурсы разработки и он кушает базу данных причем начинают кушать и и неэффективен какие-то индексы удалили еще что-то случилось соответственно с его помощью можно задействовать ресурсы бэг-энда задействовать ресурсы всего того что стоит за версткой очень эффективно иногда не всегда такое случается довольно часть естественно при полируется вообще все параметры все параметры запроса то есть если поэтов запроса есть какая-то структура если в куках есть какая-то структура я немею ты сейчас sql-инъекция у нас листается или что-то взломай до пущей доступ несанкционированной я имею скажем запулить в глисон массив внутри cookies какое здоровенное значение создать там и не знаю большую влажность и так далее так далее вообще заставить партия работать неразумно долго ну и пятна первое что приходит в голову когда исследуешь сайт этом нагрузить базу данных потому что поиск есть почти у серп и почти у всех он к сожалению работает плохо почему-то не уделяют этому моменту внимание разработчики но тут есть одна рекомендация это соответственно не делать однотипных запросов потому что нарветесь на то же самое каширование примерно то же самое что из 6-ти пиццу дам получается делать какие-то случайные запросы в базу данных тоже не всегда эффективно потому что там пустые запрос и ответ и это все не всегда работает гораздо эффективнее немного исследовать опять же посмотреть прикладной область этого сайта и составить список ключевых слов которые относятся к этому поиску если там возвращаться к тому же самому магазину предположим мы торгуем тонкую нить автомобильной резины то можно посмотреть всякие там поискать радиус там подобрать машину и всякой такой комбинации таких слов заставят базу данных работать намного более в более скажем так сложных условиях и третий момент это использовать так называемую pagination то есть отдать поиску например предпоследнюю страницу выдачи намного сложнее чем отдать ему первую страницу и этим также с помощью этого можно немного разнообразить нагрузку хотелось бы он привести вот пример такого теста это вот было нагрузка в поиск тут видно то что с первой же секунды теста на скорости 10 запросов стоит лег и не отвечал если поиска нет то это не значит что сайт не содержит себе уязвимых каких-то полей ввода в первую очередь мы смотрим авторизацию что имеется ввиду очень любит сейчас делать такие сложные hаши внутри чтобы защитить базу логинов от атаки по радужным таблицам это здорово это хорошо как чек работаю безопасности могу и только приветствовать но при этом это потребляет большие ресурсы по ул и как следствие большой поток ложных авторизации приводит тому что машинка на которой все это крутится уходит по циpкa что на выходе сайт просто перестает работать все все возможные формы комментариев обратной связи и так далее это повод отправить туда в очень большие тексты или просто массовый флуд какое-то создать потому что все это сохраняется раз сохраняется наш пишется либо в базу и на диск если в базу прекрасно база не очень хорошо держит запись особенно больших банков да если ты на диск замечает на нагрузим диск его вряд ли там стоят быстро и создашь ки так далее и так далее дополнительно порой и сайты принимают какие-то файлы в формате там скажем где в том числе да ну замечательно берем файл размером 1 терабайт стоящей за один их одних нулей делаем где получаем файл размером несколько там сотен байт килобайт и отправляем его на сайт дальше он приковывает и участь очень интересный эффект на выходе хотелось бы немного уделить внимание таким сервисом популярным нынче как rest api rest api отличается от обычного сайта тем то что его намного сложнее защитить банальные способы там обхода всяких вот этих легитимной активности например там подбора паролей там прочее для rest api не работают также растопи очень просто сломать потому что обычно это просто какая-то напишешь к которая непосредственно обращается к базе данных соответственно используя такие же трюки как при поиске например или там большие посты джейсон и точно также можно легко вывести этот сервис из строя выводя такой сервис из строя наступают более тяжелые последствия для бизнеса потому что на них обычно завязаны не только какой-то там главный сайт но и мобильные приложения там или какие-то внутренние бизнес-процессы и например если это упадет все будет намного печальнее чем если вывести просто сайт из строя допустим мы исследовали сайт или у нас есть сайт который представляет из себя обычно это страничное приложение какой-нибудь лендинг там я не знаю визитка на котором нету ни поиска вообще ничего нету что тут можно сделать можно попробовать поискать какой-то тяжелый контент ну например там большие картинки которые дает этот сервер либо может быть он отдает кита бинарные файлы там pdf там документации или еще чем в этом духе и попробовать по выкачивать это все дело такой тест очень хорошо грузит файловую систему и очень эффективен бонусом ко всему этому идет то что такой тест очень хорошо забивает каналы то есть и даже если вы не положите сервер потом скачивая небольшой файл небольшие достаточно скоростях вы просто забьете канал до целевого сервера и опять же наступит отказ в обслуживании тоже он хотелось бы привести такой пример такого теста тут тоже видно то что на скорости уже 30 fps с первой же секунды сайт не отвечал а где он отвечал это более 500 ошибки сервера то есть на протяжении всего теста сайт лежал не стоит забывать также и про настройку своих серверов потому что слабый серверу это тоже проблема причем большая часто можно встретить такое то что кто то там купил какую-то virtual очку поставил туда пачек по умолчанию его настроил расположился в php приложения и вот на картинке результат собственно не прилагая никаких усилий нагрузка у нас ушло в корень здесь тоже тут видно что это 10 рпс всего подождали пять минут и сервер упал почему он упал до конца неизвестно но есть предположение что он например просто объелся памяти и перестал отвечать последнее время где-то последние год-два стали достаточно популярная таки волновые чем от связано с тем что многие организации покупают те или иные железки для защиты adidas плюс есть некоторое количество сервисов которые также страдают этим недостатком они требуют для фильтрации атаки какого-то времени накопления то есть где фильтруют атаку первые 30 40 секунд потом накапливают данные обучаются и начинают фильтрацию соответствуете 30 40 секунд на сайт можно запустить стоку что сайт будет лежать длительное время он будет разгребаться через какой-то интервал в случае данная таки был выбран интервал 10 минут это так реальная через десять минут сна прилетают новые порции атаки как правило видоизмененная то есть защита обучилась но сайт уже лежит защита обучилась запустил фильтрацию прилетает новая порция совершенно другая защита снова начинает обучение фильтрация фактически не работает защита неэффективно сайт недоступен такие атаки характерны очень высокими значениями на пике то есть это может достигать и не знаю 100 тысяч запросов секунда миллионы запросов в секунду если говорить по семьи сыграть по три-четыре то там могут быть какие-то сотни гигабит трафика или там соответственно с тремя сотнями кпп с в пакетах такие атаки они эффективны для обхода защиты ну не будем говорить к вам вот и в чем еще проблема в чем бонус как бы для людей которые занимаются защитой д которые не любят их получать и чем проблема людей которых создают даже не столько квалификации сколько проблема синхронизации то есть атаки идут букет как правило вот соответственно для того чтобы создать очень большой пик разовый требуется очень высокую степень синхронизации и тогда синхронизация координация она вызывает определенные проблемы не всегда получается то есть иногда это бывает какой такой пора ли параболический пик который довольно жалко на выходе помимо и теперь на уровне все мы любим эксплуатировал еще и другие протоколы что имеется ввиду как правило когда мы гуляем по обычно веб-сайт если тем более это обычный хостинг у него наружу торчит почтовые протоколы зачастую к сожалению на ружье торчит mais quel ну майской вообще комментировать не хочется понятно что база данных довольно просто складывается после этого ресурса нет и никаких логах вы этого не увидите нужен exceed argaria почтового про такого подверженная нагрузка в меньшей степени но тоже их можно нагружать достаточно эффективные тоже на выходе получить перегружается полу на сервере на сайте упомянут уязвимость мы вполне реально с помощью добивались определенного успеха то узел исчез sh2 16 года она конечно же почти у всех поправлено но ты не знаете что высота h нельзя подавать нагрузку можно то есть просто подается огромное количество 3 зации ssh съедает почти весь цикл на сервере дальше веб-сайт складывается от потока тому же 12 запроса в секунду раньше нужно было 100 а теперь нужно 12 12 в уже не как пологом не отличить от негативной нагрузки все еще у нас актуально множество соединения которые мы открываем сервер как правило этим раньше грешил apache ну по крайне мере все так думали наверное вот фактически этим грешит engine x потому что очень часто встречается дефолтный настройкой джон x соответственно лимитированное количество соединений который может держать открытыми соответственно открываемость количество соединений новости день джинкс уже не принимает и на выходе он не работает сайт не работает наш тестовый класть и он обладает достаточным циpкa чтобы отковать из elfin шейк в принципе на самом деле как показывает практика вот на это тоже надо это делать итак чтобы это случалось часто но это к сожалению происходит то есть с одной стороны понятно что пересели куда потому что выдачу гугла потому что ранжирование потому что безопасность другой стороны возился цель это к сожалению циpкa и циpкa это определенная проблема и хотелось бы на этом перейти к атакам на сетевом уровне когда мы говорим про такие напали три четыре мы говорим о моттаки новыми канала то есть такая нагрузка она достаточно легко почти всегда отличим от легитимной нагрузки навык ресурс если мы не говорим о каких-то специфических протоколах да если мы не говорим о какой-то телефонии которые используют в египет om отдельной проблемы отдельная история то большинство атак на в 34 они легко отличимы единственный вид атаки которые сложно отличить это от оксен флуд этих атак проблема для защиты особенно это касается веб-сайтов она феса в том что они бывают очень большими то есть когда мы говорим про атаки в 600 гигабит когда мы говорим про таки там в удара терабит а если правильно помню текущий рекорд и уже два терабит и сделали это всегда есть 3 4 соответственно но вы можете записать sky 2 терабит в секунду утра 3 бит в секунду принять такой трафика его correct обработать это действительно очень сложно даже таких компаний как авакова google соответственно они вызывают забить и канал они вызывают забить этих иных ресурсов особенность этих неправильно защищаться чаще всего мы измеряем их в гигабит ах как ни странно над этим корректным то есть единицы измерения в данном случае корректно это ппс это пакет пир секунд то есть пакет данном случае это то что обрабатывается на сетевого оборудования так как основная проблема здесь перегрузки сетевого оборудования то измерять стоит в этом потому что сколько там пришел гигабит в общем не принципиально но если только у вас не эти гигабит и не сожрали весь ваш канал ресурс и мы сегодня вспомним ну вспомни мы еще и проедите флуд но в основном поговорим о атаки сян сян флудом и сенат флотом сян сян акад соответственно пакетики которую нас пользуется при установке соединения почему собственно syn flood и сложно отличить от легитимной нагрузки потому что мы не понятно это sin пришел установка соединения это sin как часть инфу да да вот на графике представлен пример теста который мы проводили тут как раз можно посмотреть чем отличается смысле измерения by так секунду и в пакетах секунду то есть в данном случае нагрузка генерировали мы но у злоумышленников часто бывает так то что этот таких мощностей какие есть у нас ну такого сервера не бывает поэтому для организации подобного вида а так используется такая техника как амплификация заключается она в том то что некоторые нехороший человек сканирую интернет находит либо уязвим и либо неправильно настроенный сервер а который например в ответ на 17 пакет отвечает тремя оками а точнее сена к таким образом подделываю например адрес источника со своего на адрес целевого серверов можно с помощью одного пакетика увеличить мощность например в три раза и перенаправить трафик на жертву проблема опять же этих амплификации в том то что они очень сложно обнаруживаются в плане вычисления как раз плохих людей из примеров последних можно привести такой нашумевший случай связи memcache плюс сейчас в интернете очень много устройств всяких вот этих интернет of tanks эти эти камеры которые тоже очень часто ставится по дефолту и они по дефолту не правильно настроено через них такие таки злоумышленники делают чаще всего собственно ближе к силе флуду собственно к самому интересному наверное из всех таких атак на мой взгляд самому интересному как разработчика в чем здесь проблема проблема в том что зачастую системный администратор ресурсов используют для того чтобы отбиваться таких атак блокировку пайпе на мой взгляд блокировка по ip и это плохо даже случае всем а так случае 34 просто катастроф вот еще восемь страдает сожалению и только стены администратор со скриптами но еще и определенные системы защиты имеют к железке которые покупаются за очень большие деньги результатом такого такой блокировки обычно становится ну в нашем случае да когда мы проводим тестирование скажем блокировка собственной подсети да то есть firewall блокирует собственное класть им собственно потеть на выходе разрешаются внешне взаимодействия то есть если какие-то части программной системы работали через внешние канала такое как ни странно случается то и взаимодействие рушится всё ломается все мы любим а если мы знаем вай фай скажем офиса клиент или у нас измеряется работоспособность ресурсов с помощью тех или иных систем мониторинга с мы берем айпи адреса систем мониторинга мы берем айпи адреса вай-фая о снесите клиента и используемые в качестве источников на выходе вроде бы ресурс доступен вроде бы он работает но целевые горе адреса заблокирована что может учиться в реальной жизни реальной жизни может быть заблокирован скажем вай фай сеть конференции high-load где презентуется новый продукт компании впоследствии понятны это определенные бизнес издержки экономические издержки мы к сожалению во время своем тестирования ли к счастью вот не можем использовать амплификации через мелко жди не можем использовать амплификация какими-то внешними ресурсами потому что мы ограниченной подачей трафика только в эти api адресов которые нам разрешили нам соответственно единство пресекаться которому используют амплификации через сян сян ок то есть когда она отправку одного сена система отвечает двумя-тремя оками сена коми ставится на выходе атаку умножается в два-три раза это очень позитивно еще один момент связанный с блокировкой пайпинг с которым мы сталкивались с которым сталкиваются клиент во время такого тестирования него просто перепачкан так дальше клиент бегал прыгал пытался попасть на сервер вот ну понятно чего довольно сильно ему бы очень грустно что такую училась скажем так на слайде представлен список инструментов которыми мы пользуемся это первое это индекс танк для нагрузки на уровне а-7 частности там в качестве пушки используется фантом плюс у нас там есть несколько скриптов для генерации патронов для него там как раз вот этих вот разнообразных в чём я рассказывал и несколько скриптов для анализа результатов тисе пи дам для анализа сетевого трафика карман для анализа непосредственно сервера так как вы говорили о том то что бывает так то чтобы расположены соседние приложение up in excel и немного собственной магии вот с этой библиотекой dippy дикий для создания нагрузки на уровне или 34 эта библиотека от интела которая позволяет работать с сетевым интерфейсам минуя стек linux но тем самым повышая эффективность помимо этого теста мы используем определенный трафик генератора мы все за мере наносить не стали чтобы ну как не очень хороший тот он вот но все желающие могут найти получим словам трафике генератор вот естественно не мы используем не только но ваниль 3 4 она сама его используем еще иного нильсен вот потому что это позволяет создавать очень высокий поток нагрузки в пределах нескольких миллионов запросов секунды с одной машины вот и мы используем какое-то количество специальных инструментов которые мы пишем под специфический тест то есть если вспомнить узи масть под ssh соответственно естественно вот всем этим хозяйством так и вазе масть не может быть про эксплуатировала если это почтовые по такому-то мы берем почтовые какие-то утилиты или просто скрипты на них пишем ему смысле в библиотеке да я python голову так далее и в качестве такой резольвента хотелось бы привести несколько идей 1 заключается в том что помимо вот собственно этого самого классического гру что стелла и стресс из тела не править нужно обязательно у нас бы вполне реальный пример запуск нашего партнера которого мы защищали которого мы проводили тестирование на отказоустойчивость его субподрядчики скажем так так вот стеллой отказался провел классическое нагрузочное тестирование классическими сессиями которые он показал что он выдерживает штатную нагрузку все хорошо а когда нагрузка оказалось нештатный естественно вот пользователи пошли немножко по-другому использовать ресурсы на выходе этот субподрядчик лег вот пришлось срочно оградить костыли и во время запуска пришлось срочно ставить какие-то подпорки и так далее и так далее в общем попортишь очень много нервов у хорошего мало поэтому искать какие точки хорошо даже если вы защищены от dos-атак каким-то сервисом второй момент связан с тем что нужно изолировать одно другого то есть если у вас есть поиск то его нужно вынести на отдельные машины причем не в доке а вынести а совсем на деле машины желательно вынести потому что контейнеризации это прекрасный put on put on put on put и загруженный дескать загруженный диск поэтому все то что может лечь под маленькой нагрузкой все то что может сломаться под маленькая нагрузка лучше носить бог если у вас сломается поиск сломается авторизация это очень грустно это печальная третичный отказ но у вас хотя бы что-то продолжит работать до то есть этот магазин ту пользователя продолжить находить товара по каталогу переходить яндекса до покупать если они уже авторизованы ну вот или авторизовываться через это мы не знавал с 2 или как ты еще и не пренебрегайте использованием всевозможных облачных сервисов и cdn и защита cdn понятно мы говорили по атаку на тяжелый контент эксплуатирования больших файлов по то что очень малым потоком запросов можно забить канал в 10 гигабит поэтому я не думаю что большого количества ресурсов канал disney бита реальный интернет есть вот поставив cdn и закрыв такие файлы ото всех кроме cd лет тоже очень важно потому что с ней закрыт в то можно их найти и попробовать пойдем пить напрямую вот вы себя убережете от таких атак вот сердце защиты тоже понятно потому что т-34 атак на урале канала вы не защититесь вас просто такого канала скорее всего нету отель семя так вы тоже вариант учтите то что они тоже бывают очень большими вот плюс поиск маленьких а так это все таки прерогативой специальных сервисов специальных алгоритмов и регулярно обновляйте это тоже важно здесь сказано про 44 plus имеете виду тот факт что в этой версии ядра с этой версии дыра лесаки стали лофт с то есть стали лучше держать сен флуд это касается не только ядра это касается ssh демонов если они вас накрыта открытый наружу особенно это касается вообще всего потому что отслеживать те или иные вазе масти вы вряд ли сможете лучше обновляться регулярно собственно все спасибо спасибо да спасибо за доклад меня зовут урал компания raw один банк меня такой вопрос как вы определяете количество стресс-тестов то есть какие проводить какие нет потому что ситуация может ситуаций которые могут случиться их мам может быть очень много и причем их можно рассматривать как комбинации различных стрессовой ситуации вот как вы определите когда вот но количество этого достаточно а вот это уже как не стоит проводить смотрите значит мы когда проводится с тестированием проводим предварительное изучение ресурса и планируем мы нагрузка таким образом чтобы во-первых ресурс должен в естественно упасть до вот мы должны как можно раньше достигнуть отказов работоспособности второе мы должны этого достичь как можно и меньшими усилиями то есть сначала мы подаем ступенчато нагрузку уволим атаками во всевозможные поиски во всевозможные тяжелые формы запрос и так далее когда мы переходим уже к обязательной программе видео вот всевозможных flood of the мы мы находимся на связи с клиентом обязательно у нас заводится чатик там в телеграме в скайпе вот сопи неважно где вот где мы в случае если это большой флот особенно предупреждаем ждем отмашки что до подавайте смотрим если с той стороны идет крик остановитесь мать сразу останавливаем вот если это продакшн и и ресурс это все это проводится обычно ночью то есть после того чтобы такие тестирования ночью выходные соответственно минимизирован эффект для пользователя реальных вот ну и ступенчатая подача нагрузки то есть если мы видим что сайт отказал то он отказал по поводу количество тестов у нас есть какие-то определенные да вот как антон выразился обязательная программа который мы используем а там дальше уже по желанию заказчика обычно то есть ему хочется проверить то или иное и мы можем там добавить чего-то или наоборот убрать то есть как бы строгого там мы проводим 10 тестов такого нету то все зависит от ситуации и строгий набор да и сам ушел он в 50 тест в котором обязательно проведем есть тому зависит том что мы найдем на ресурсе на самом деле все что найдем все обязательно попробуем пойдем не понять . евгений компаний аркадием спасибо за доклад от вас на последнем слайде было просидел как защита вот атаки на использование больших файлов и так далее по сути это получается атака с исчерпания каналов перерастает в исчерпания вашего денежного счета потому что мы платим за трафик на седин получается через сидим вот и при этом усложняется процесс поиска вот этих букетов потому что сидена трудно анализировать логе приходит задержка и так далее вот как в этом случае что вы рекомендуете делать ну смотрите лучше если вам исчерпают бюджет чем вам щипают работоспособности ресурса бюджет вы можете пополнить wot там наверное смотреть конкретным сединами что там к чему вот в общем так это довольно дешевый поиск ботнетов ну знаете но нашли в ботнет венесуэле что с ним сделать венесуэлу заблокировать у меня допустим пользователю штатах зачем мне это венесуэла нужно а так я буду платить еще три недели за трафик сыне своего хорошо вы имеете разблокировать пайпе был не знаю какие нибудь варианты хотя бы либо что-то я могу сделать от oxygen а мухи не гипотетически можете вот если это у вас на сайте в принципе в то же самое наверно можете сделать из cd надо договориться с ними вот сообщить им о том что идет атака вот зачастую сервисы там cd на предоставляют услуги защиты от деда совместно с компанией значит adidas или это вообще одна и та же компания поэтому я думаю там есть договоренности которая позволит таких ситуаций избежать добрый день как алексей компанией кувшин спасибо за доклад не два вопроса на самом деле так вы проводите стресс-тестирование то ведете ли вы какой-то рейтинг де достигаешь сервисов то есть так только упал по вашей практике напросто и второй вопрос что обнаружение слабых места так далее использовать какие-то сканер аэлита ну то есть руками визуального нарядом делается так как мы сами эти does my tickets in service to ну конечно мы ведем таки рейтинг вот естественно где-то внутри вот но в большей степени в случае именно технического департамента до дева разработки нас интересует не какой-то рейтинг да там 1 2 3 места какие-то обычные проблемы то есть если мы видим что здесь сервисом и не знаю пусть это будет защита . cz да там такое наверное нет надеюсь вот то мы знаем что у этих ребят есть проблема с вот такими техниками да и снова такими техников можем добиться работоспособности чаще всего к сожалению приходит без защиты ну или к счастью вот что касается сканер авто сканер уязвимости мы не используем мы не пробуем осушить проникновение во первых и вторых сканер уязвимостей довольно большую нагрузку вот у нас есть жесткое правило что до часа икс то есть того момента когда мы можем стрелять мы не можем подавать ресурс больше одного запроса в секунду еще лучше не больше одного запроса в минуту потому что бывает так что подали запрос сделали три запроса и ресурс лег на пол дня ну реально был такой случай добрый день меня зовут артём компания tns нас два интернет-магазина довольно таки крупных и совместно 2 сервисов adidas щетинка райдеры скайпарк два основных игрока которые к сожалению не научились бороться с паркингом поэтому каждое утро по москве в десять и травмы парсинг принимаем за глаза нагрузочное тестирование казар очень хорошо показывает насколько нашей системы сейчас в каком состоянии они находятся так вот соответственно у меня в два вопроса наверно первый а это значит вы тестируете в основном естественно извне да то есть другие подсети там другие страны и проще есть сервисы как как и русал по защите adidas которые частично могут вас как-то притормозить иногда вообще остановить что делать когда тоже там apache benchmark запускается сотрудникам изнутри компании когда вам все лимиты request и в яндексе которые прописаны они никак не сработают на вашу внутреннюю сеть вот и там индекс танкан для patch патч марком сервер обычный фронтом кладется за одну-две минуты и второй вопрос в этот соответственно по паркингу как компания варите умеет бороться с парсинга хоть не создавать нагрузочное тестирование для клиентов а ведь я значит ну по поводу сразу притормозить и полностью остановить у нас не было ни одного то есть его не котором бы не достигают те проведенные тестирования были во всех путем тестирования ресурсы были доведены либо до полной неработоспособности либо в очень редких случаях добиваясь частично неработоспособностью силу специфичной постановки задач такая история если у вас изнутри сотрудник что-то ломает то это немножко другая область ну наверное вы можете придумывать какие-то системы защиты от этого самая простая это просто община потеть делить это почти продакшн это самое правильное научные сотрудники если это не разработчики не сетевой администратор а будут ходить в продакшен как обычные пользователи вот и без всяких белых списков если это необходимо вот если нужно белый список на отдельный там какой-то под и ресурс до админки и так далее вот случае с вас взломали разработчика или админы реальный разработчика те то башку запустить на эти вы не защитите и из вас админ хочешь сломать ваш ресурс тон его сломать он после сделать я сражён их стоп поэтому до топлива и нету что касается постинга то мы считаем что мы с ним умеем бороться достаточно хорошо вот ну детально давайте там если возможно после это будет последний вопрос и если останься чего прошу то вы можете задать их в дискуссии хорошо здравствуйте меня зовут дмитрий спасибо за доклад я хотел попросить уточнить вот я услышал про докладе прозвучала то что модный нынче rest плохо справляется с традиционными методами защиты не могли бы вы развернуть мысль и рассказать что вы имели в виду да конечно не rest справляется с медными защитами это защиты часто плохо спадет средств здесь история такая что когда мы говорим про сиро защитой 5 то какие у нас самые традиционные замечательные метре от методы работы сервиса защиты на уровне 7 это либо показать как чудо либо выдать и redirect либо что такого рода тоже как-то проезжаем по взаимодействует либо с браузером либо с пользователем случае rest api а и к сожалению даже redirect не всегда возможен браузеры пост ломают вот captcha вы тем более не как не отдадите на посети как вы captcha в suite в адрес он выдачи абсолютно спокойно я выдумал это вам нужно функционал помните то само собой я закладываю на уровне проектированию этот функционал если возложили на вы не проектирование вам аплодисменты правда я не видел ни одного из цепей в которые буду на воде коллектива не буду залог была заложена ковчег сожалению почти всегда это просто вот некий до дикий лес да и нечего туда нельзя встроить и там есть огромное количество приложений которые туда ходят и уже не поймут то есть даже если вы сделали вторую версию все останется 1 и это первое обязательно найдут и в нее обязательно пальнут то есть проблема именно в том что не всегда возможно про и взаимодействовать запустить кого это активное взаимодействия специфичный протокол да я понял спасибо а еще такой вопрос из практики ну то есть стресс-тестирование это конечно прекрасно все но угадать какой будет реальный трафик в продакшене ну то есть после стресса раз тестирования ну это такая из разряда магии вещь есть какая-то статистика насколько хорошо живут от тестированные вашей системы сервисы при реальной нагрузки пользователей смотрите все то что тестируя как правило жилу хорошо конечно были там когда-то давно инциденты вот разумеется в среднем все было хорошо в случае нашего сервиса все тем более хорошо потому что мы закладываем десятки тысяч запросов секунд машина вот или сотни тысяч запросов в секунду заведомо за пределами всего того что может прилететь в процентном соотношении станет в процентном у клиента мы не считали потому что у слонов все те кто к нам приходят они приходят смотреть насколько они лузина так атакам то есть у них уже работающий сейчас он живёт подавшие то есть если я скажу сейчас 99,9 процента я не ошибусь вот тут был один инцидент когда действительно партнер сам партнеров проверим все что называется его партнер не проверим сюда случился очень-очень хорошая история то есть бегали и суетились вот других таких отказов и не припомню спасибо большое спасибо спасибо"
}