{
  "video_id": "U4u4Bd0FtrY",
  "channel": "HighLoadChannel",
  "title": "Собственная система уведомлений о нештатных ситуациях / Алексей Кирпичников (Контур)",
  "views": 3957,
  "duration": 2781,
  "published": "2018-11-19T03:09:03-08:00",
  "text": "перед тем как начать я хочу оклад дело в том что как делают доклады пром система мониторинга я лифтинга обычно это доклады технически выходит докладчик и рассказывает вам смотрите мы сделали вот такой pipeline для метрик покачиваем через него 10 гигабит в секунду значит на 3 ядрах успеваем обработать 18 миллионов метрик в час вот такие вещи мой доклад будет совсем не такой мой доклад будет не технический и вот почему на самом деле система лифтинга как мне кажется эта история про людей потому что система лифтинга например это одна из не многих программ которым я доверяю прямой доступ к своему телу вот у меня на руке есть часы и система лифтинга может по дергать меня за эти часы по дергать меня за руку в любой момент ночью днем можно прямо сейчас даже и поэтому вот это вот вот в рассказ по система лифтинга он невозможен без рассказа про дизайн этой системы причем дизайн в хорошем смысле не ней рассказ о том почему у нас кнопкой синего цвета не зеленого рассказ о том какие решения мы принимаем при заводке этой системы для того чтобы наши дежурные инженеры могли следить за отказоустойчивостью и поэтому не сойти с ума от того что не могут спать по ночам кроме того важный момент моем докладе я хочу чтобы я хочу подчеркнуть чтобы вы понимали что я об этом хочу сказать это то что решение которое мы принимаем когда разрабатываем систему мониторинга они не от проблемы которые мы решаем они не уникальны для найти мы можем подчеркнуть подчеркнуть опыт из других областей инженерных и поэтому весь мой рассказ он будет состоять из шести истории некоторые из них будут сопровождаться историями из реального мира историями про ракету и про атомные электростанции про всякое такое прикольное а ну теперь пора начинать сначала я должен рассказать почему я почему я вообще могу рассказывать о тех алексей кирпичников могу рассказывать вам про системы а лифтинга вот я уверен что вы не знаете меня и не знаете компанию контур я даже не буду проделывать упражнения с поднятием рук кто знает что такое контура кто нет но тот же есть желающие подняли спасибо я я я расскажу вам абсолютный минимум который вам нужно знать по контуру для того чтобы убедиться в том что я имею право стоять на этой сцене рассказывать вам система мониторинга значит что такое контур во первых это продуктовая компания то есть это не заказная разработка собственные продукты во вторых эти продукты это облачные сервисы которые мы сами пишем и сами хотите в дата-центре поэтому мы должны их сами мониторить а в третьих это больше тысячи человек в разработке то есть не считая специалистов по продажам по поддержке сокрыл это разработчики тестировщики контейнеры пока я не вернусь производственные сотрудники которые работают в нескольких десятках команд делают разные продукты контура этого сном продукты для бизнеса именно поэтому в отличие от индексов и контура вы наверно ничего не знаете вот то что вы вряд ли в жизни сталкивается с продуктами вот и вот этот вот набор обстоятельств он как и в любой каком компании наверно которая занимается продуктовой разработкой облачных сервисов вот такого размера с таким количеством команд приводит к неизбежному выделению инфраструктурной команды которые занимаются вопросами тепло и хостинга плод платформа за сервис мониторинга лифтинг вот такими техническими вещами и как раз в такой команде работаю я и поэтому я стою перед вами и рассказываю о том о чем я сейчас рассказываю придем к системе мониторинга мы работаем в стеке графит и вот сейчас когда вы увидели этот логотип на экране наверняка многие из вас подумали насчет ноября 2018 года конференция highload главный зал вышел парень и будет нам сейчас рассказывать про графит довольно нелепо звучит но раз уж мы заговорили о рассматриваем а дизайн решениях вообще-то неплохо было бы посмотреть на график и понять какие дизайн решения привели к тому что он такой живущий то есть он был впервые опубликован 2008 году по меркам айти это такой мега динозавр непонятно вообще как еще есть люди кто его использует наверное это люди из из области вот как вот которые интерфейс java 6 версии еще вот там мэйнфрейма убийство такое давайте посмотрим это вообще интересное упражнение понять почему система живут долго как мне кажется почему до сих пор жив графит во-первых потому что он модульный вот смотрите если вы скачали графит из официального репозитория его установили он нот в при в самом примитивном видео он состоит из вот таких частей карбон или это балансировщик которые распределяются приходящие метрики по по брендам карбон кэш собственно backend который сохраняет базу данных веспер данные графит я пытаю ive котором можно смотреть графики вот так он выглядит из коробки а вот так он выглядит в контре посмотрите не осталось ни одной строчки кода из оригинального графита которая работала бы у нас сейчас продакшене но я по-прежнему называют и словом графит потому что мы заменяем никогда не заменяли его целиком вы заменяли его по частям заменяя каждый раз тот модуль который перестал справляться с нагрузкой это я считаю одно из важнейших решений которые позволяют графиту до сих пор быть живым его можно менять по кускам как лига второе решение это простой формат данных вот смотрите наверняка многие знакомы с охватом данных графита но чтобы еще раз подчеркнуть его простоту я его на экране вам покажу 1 1 . метрики в граффити она состоит из имени значение и метки времени таймс там просто unix timestamp вот попробовал бы я про табу фонд вот в таком виде сейчас на экране показать или какой-нибудь другой бинарный формат костанай меня бы не получилось и на самом деле это очень важное решение потому что благодаря этому вокруг графита появилась большая такая система всяких разных опасных штук которые можно к нему подключать которые позволяют собирать метрики с системы собирать метрик из разных базы данных собирать метки с чего угодно потому что это очень легко я могу написать ваш скрипт который отправляет медики в таком формате просто выдирать их там и спрос и сразу писать через откат в socket это легко могу за пять нот сделать вот никакой бинарный формат конечно таким такой гибкостью похвастаться не может и последняя почему он все еще жив это отсутствие winder лак то есть никто никогда не попросят вас заплатить за графит никто не предали скажут ребята мы сейчас решили что теперь репликация в граффити будет стоить 100000 долларов в год вот и все платите или или без аппликаций например вы запускаете не никто не может взять и перестать разрабатывали конфет просто потому что людей которые делают разные кусочки из которых состоит эта экосистема их уже слишком много кто-то уволился и перешел работать в google там и запрещают писать компонента графиту ну ладно найдется другой человек можно пикантных легко устью взять это все очень круто и именно поэтому у нас до сих пор жив графит в контуре но в граффити вот если его взять снова вот эту картинку из коробки не хватает одной важной штуке эта система лифтинга дело в том что если вы начали собирать в метрике со всех своих систем записали миллионы метрик в стоить можете посмотреть графики можете построить дашбордов компания но если у вас есть миллион метрик вы никогда не наймете миллион человек которые будут сидеть и смотреть в экраны мониторов и ждать пока эти метрики перейдут через красную линию вам нужны роботы которые будут следить за тяжу затем что это произошло и отправлять вам уведомления понять уведомлять дежурному инженеру вот и вот этой штуки по улучшению в граффити нет но поскольку графит модульный и и написать очень легко и конечно очень много людей уже это сделали и когда люди это делали они принимали первое дизайн решения по которой мы сегодня поговорим какое залезаем решение не хватает стрелочки нам нужно открыто стрелочку нарисовать откуда будут приходить данные в систему а лифтинга в эти для того чтобы проиллюстрировать важность этого дизайн решения в системе лифтинга я нарисую его из самого нелепого место из которого никому в голову не придется его рисовать это просто напрямую к это формат файлов в которых метрики хранятся получению cofete вот можно прямо из файлов эти данные брать для того чтобы проверять что метрика превысила какой-нибудь значения и отправлять олег так делать понятно не стоят если вы помните вот тот слайд на котором я нарисовал как выглядит график сейчас контуре понять уж никого веспер а там уже нет давно если бы метрика метрики значения метрик брилась из файлов веспер нам пришлось бы при замене это вас тораджи менять систему а лифтинга тоже поэтому логичнее было бы взять данные из какого-нибудь другого места ну например из carbon каша которые уже в каком-то более или менее понятным стабильным универсальным и простом api предоставляет эти данные которые можно подменять вот но это решение тоже неудачная а потому что в граффити есть довольно много функций и функций которые позволяют суммировать между собой метрики считать производные делить одни на другие и реализации всех этих функций он находится на самом деле во френд энди графит вебер и пользователям эти функции очень нравятся они хотят получать alert и когда в сумме по всем брендам количество ошибок превысила столько-то если мы поставим стрелочку из карбон кэша функциями этими воспользоваться не сможем получить их там просто нет поэтому большинство систем а лифтинга они берут данные из api графе цвет оттуда куда можно прямо написать genfit русское выражение сделать запрос и получить оттуда метрики у спасительными функциями и выслать уведомление с это необходимо так вот я вам скажу вот не это решение но неудачно это же и не удачность этого решения это одна из самых главных причин почему мы стали писать свою систему а лифтинга о том почему это решение не удачно я расскажу вам чуть позже а сейчас пришло время для тех кто воспринимает информацию лучше визуальное виде скринкастов а не в виде кружочков со стрелочками и слов докладчика пришло время для того чтобы показать супер короткий одноминутный скринкаст того как завести самую простую проверку в море дата веб-интерфейс майра смотрите я добавляю триггер это ну скажем так условия по которому будет проверяться метрика я здесь пример сделаю такой же как вот у меня было формате данных там метрика по загрузке процессора куда называется например циклу от процент percent это загрузка в процентах я сделаю какие-нибудь пороге ну например и будут присылать предупреждение если больше чем 50 процентов ошибка если больше чем 95 процентов может того соединить за какой-то интервал по мячу эту проверку тегом вот и теперь нужно подписаться заметьте что здесь есть еще одно интерфейс на и решение довольно не очевидное это то что я не подписываюсь на на триггер и которые создаю непосредственно я помещаю их тегами и потом подписываюсь на теги то есть я здесь создаю подписку через какой-нибудь канал например slug сейчас все очень любят флаг и добавляю подписку флаг над на так который я добавил к этому триггерах это позволяет работать в одной системе в одной инсталляции мэры разным командам вот и в самом 50 с лишним командам вместе не мешают друг другу у каждой команды есть свои теги у каждой команды есть свои подписки и мы можем все работать вместе тоже дизайн решение почему нет успел по пути рассказать пока показывал скринкаст ладно пришло время вернуться к моей истории про то откуда брать данные для проверки вот эта история номер один всего этих историй будет 6 совсем немного первая история называется параллельно и независимо вернемся к той картинке который я показывал и давайте попробую объяснить вам в чем проблема с этой ссылочкой на простом примере представьте что у вас есть какая-нибудь базы данных какие сейчас любят база данных там под газ например вот и вас есть инсоляция подкоса вы сделали такой к ней веб-интерфейс вот как как как на самом деле система лифтинга работает в его не пишите хочу там есть получать уведомления когда процент загрузкой цпу больше чем 50 что она делает на просто там раз в минуту например 0 и 1 какой-то интервал ходит в базу данных делает запрос сколько у нас сейчас загрузка циpкa 45 сколько сейчас 55 надо ли на вот и вас есть веб-интерфейс к этой системе ну представьте что у вас есть база данных под газ и вы сделали веб-интерфейс в которой можно записать произвольный запрос к этой базе данных и нажать кнопку делая этот запрос к базе данных каждую минуту и у вас есть 1000 пользователей которые не очень хорошо разбираются как работает postgres как делать в него эффективные запросы они просто делают кучу запросов и каждый из них повторяется раз в минуту пойдет не очень много дней работа этой системы пока какой-нибудь пользователь не сделает такой запрос который валит вашу базу данных но совсем то есть вы получаете систему которая автоматизировано доносят ваше хранилище метрик туда приходят куча пользователей которые вообще не умеют эффективные запросы делать и учить их этому бесполезно поэтому попользовавшись такими системами некоторое время мы пришли к выводу что дальше так жить нельзя и провели стрелочку совсем из другого места вот из этого что это означает мира система лифтинга который мы пишем она подключается к входящему потоку метрик параллельно с графитом то есть оно полностью не зависит от стоит же полностью не зависит от фронтэнда графита она получает тот же самый поток метрик и сохраняет его себе в базу данных что это дает графит это долговременное хранилище то есть там хранятся метрики допустим за год или за два но когда люди подстраивают уведомления они обычно пользуются метриками за последний короткий интервал самом простом случае нужна последняя точка вставить его склоняться точки за год ну а нужно только последние для того чтобы сравнить ее в каким-то порогом в простом случае в более сложно может быть вы захотите посчитать скользящие средние за последние 10 минут но для этого нужно 10 последних точек но не весь год поэтому данных которые нужны для системой лифтинга их на самом деле очень мало их можно положить в память какую-нибудь базу данных например редис и это будет работать гораздо быстрее кроме того вы настраиваете триггеры не на все мины на все метрики то есть у вас есть миллионы метрик но получаете лет вы хотите только по 5 тысячам например нато данных становится еще меньше и поэтому это все влезает в память и уже пользовать у пользователей уже нет такой легкой возможности убить вашу систему мониторинга собственно вот эта вот архитектура вот это дизайн решения которое параллельно отправляет медлите и в сторож графита и в систему лифтинга она не дает пользователям убить основной график работает тогда когда со мной графит упал и наоборот если пользователем все-таки удалось убить систему а лифтинга сам графит продолжает работать и тот момент который ну наверное вы подумали что действительно как же если вы провели стеночку заранее у нас пропала возможность поддерживать функции графит а благодаря тому что все эти штуки в кафе де очень модульные и они выложены в open source мы можем просто взять библиотеки графита и подключите их к библиотеке в нашу систему лифтинга этап это легко сделать и таким образом все функции также поддерживаются но при этом мы не загружаем циpкa в граффити вот такая первая история давайте перейдём ко второй и тут у меня будет небольшое упражнение для вас как для зала смотрите я предлагаю вам выполнить такую экспертную систему вы будете принимать решения какую лампочку зажигать какой какое уведомление отправлять зеленую желтую или красную все окей предупреждение из какая-то проблема или error ошибка надо срочно бежать и сочинить давайте у вас будет метрика загрузка цепова в процентах значение у нее сейчас 4 вот вы как экспертная система то считает что это зеленый свет типа все нормально можно не отправлять или большинство да можно я дальше не поднимать и стильная с вами согласен это скорее всего ok давайте второе упражнение допустим 58 процентов загрузка цп wog то считаете что то окей все равно определенная она довольно много а кто считает что это желтая лампочка положено дабы посмотреть примерно поровну ну давайте давайте вот у меня в презентации в армян пусть будет так давайте 99 процентов понятно что игрушечный пример кто читать что-то окей 99 не надо никого по уведомлять а кто считает что желтая лампочка аниме а а если красная в красное больше всего ну ладно согласен с вами красная вы наверно догадывались что здесь будет давайте еще одно упражнение проделаем кто считает что то окей это это это не это не ошибка слайде это pride пустой слайд я объясню в чем дело а дело в том что иногда данные просто перестают идти то есть вы вы получаете медики получаете получаете получаете а потом почему-то перестаете получать и как но как понять это хорошо или плохо вот когда нет данных это это окей это зеленая то есть у вас у вас была зеленая наверно может быть она и продолжает зеленым быть просто данные перестали идти ничего страшного сломалась систему отправки метрик для того чтобы проиллюстрировать мою мысль поэта я расскажу вам историю про ракету это ракета титан 2 американская она стоит в шахте наверху не такая чёрная штука эта ядерная боеголовка вот и однажды в августе восьмидесятого года с ней произошла такая история ее нужно было починить лет надо чинить вот для того чтобы ее починить нужно было отключить люк верхней части ракеты вот возле этой черной штуки небольшую пробочку открутить там чет поменять и обратно закрутить вот и пора ремонтников которые значит работали они должны были подняться на лифте на в шахте из лист которые поднимают открутить ее но была проблема ракета очень старая шахта старая и лифт он плохо работал в общем пока починили лифт ребята уже но уже много времени прошло нужно чинить они поехали наверх и поняли что забыли нужную отвертку вот на времени уже не было что-то спускаться они подумали ну ладно там паска купцами к врачу открутим ничего страшного вот они доехали на верх стали откручивать плоскогубцами плоскогубцы you они тоже были старые в старой ракета очень ищу жидкотопливная очень стая вас купцы тоже были старые они вот так вот значит шатались и они когда отключили эту пробочку они ее уронили вот они увидели но ничего страшного ниже на платформе стоят там ну как бы она упала на платформа из но проблема там между платформой и ракетой там такая резиновая прокладка которая нужно чтоб мусор всякий вниз не падал вот но прокладка старая была она она прохудилась немножко и эта пробка туда вниз упала она упала вниз вся 100 метров вниз пробил дырку в отчете оттуда вытекла все топливо взрыв короче катастрофа ядерная боеголовка заезда за 400 метров нашли от этого места но она не взорвалась вот что я хочу проиллюстрировать этим этой истории инженерном сложные системы инженерные они имеют свойство деградировать они реально портятся со временем и если вы вот эти вот мелкие детали не замечаете и не чинить и то они постепенно приходят такое состояние когда складываются вместе происходит катастрофа у вас шли метрики папа загрузки процессора я не всегда были окей всегда были зеленые шли-шли шли перестали идти скорее всего не на самом деле внутри по-прежнему зеленое и поэтому у вас есть очень большая мотивация очень в этом увидели в реальной жизни у инженеров нет мотивации чинить метрики которые перестали идти но когда таких меток становится много сумме они приводят вот к этому и поэтому при заводке мой мир мы приняли такое решение нет данных это самое плохое состояние метки которая может быть хуже чем ошибка если у вас нет данных мы включаем все свистки и заначки которые могут быть метрики по которым не данных приводят в посылке при сортировке по тому насколько все плохо выводится в самом верху выше чем метрики в которых даже ошибка даже красное состоянии метрики которые находятся цене не данных напоминают о том что в них нет данных раз в день 1 сутки дежурному инженеру приходят уведомления по этой медики по-прежнему нет данных по этой приметы ли по-прежнему нет данных можно ее починить это позволяет не впадать в состояние которое вот в той ракетой поехали дальше история номер три она называется вот так на самом деле это не история не про то что если все еще хуже чем в прошлом случае эта история про другое вот смотрите давайте вернем сотка этой схеме помните я говорил вам что вот эта схема это параллельно и независимо от графита но вы же наверное все видите да что что я соврал вам тогда для тех кто не видит я по немножко подчеркнул на самом деле может упасть карбон relay до карбон или этот тот балансировщик метрик это единственная точка которая является единой . отказывать для системы а лифтинга и для самого графита вот если он упал мою перестают приходить метрики и это означает что через короткое время все кто подписан все тысячи пользователей мойры они получают уведомление самого критичного сорта нет данных правильно ли будить в этом случае 600 на 600 тысяч несколько инженеров конечно нет правильно разбудите дежурного инженера мою чтобы он пошел разобрался почему в нее не идут данные вот и это одно это очень важное свойство мой рот важный инженерное решение которое вы приняли которая позволяет не разбудить в ложном уведомлениями просто одного инженера тысячу инженеров эта защита от от того что сломалась сама система мониторинга вот эта защита от того что перестали ти данные она встроена в мойра уже сейчас и вот я вам рекомендую если вы разрабатываете свою систему мониторинга или что-то делаете из из готовых кусочков тоже позаботиться о том чтобы если сломалась сама система мониторинга это не приводило к тому что мы будем всех инженеров более того на самом деле в реальной жизни с ситуация несколько более сложной то есть конечно же есть отказоустойчивость конечно же вот этих вот рылеев несколько и может сломаться могут сломаться не все из них а только один и например к нам-то и станет идти треть метрик вот и эту ситуацию конечно тоже нужно отслеживать то есть когда перестала идти треть метр екатерина одна пятая часть метой как понять кого одну пятую 1200 инженеров или все-таки по-прежнему одного инженера который за мой рис следит не понятно для того чтобы разбить эту ситуацию мы используем ну некоторую некоторую систему простенькую для отслеживания нам олей вот это будет в ближайшем релизе море сейчас этой системы нет часто более простая кто раньше но тем не менее вот вот эту ситуацию я хотел вам проиллюстрировать об этом тоже нужно думать как отличить ситуацию когда действительно нет метрика сервиса их до сломалась сама система мониторинга 4 история про которое хочу вам рассказать называется ручная работа и эта история о том как меняется поведение пользователей системы когда вы даете им api ведь как вы видели в скринкасте в море можно еслиб интерфейс можно завести себе правила проверки триггеров написать текст текстом просто поля в через браузер нам но сейчас это так не принято ты сейчас принято делать сервисы так называемый api first то есть когда все что можно сделать вашу сервисе можно сделать через api а веб-интерфейс это всего лишь один из вариантов использования api а может быть через командную строку можно делать что-то или делать post запроса через джейсоне делать через google вот и мы естественно инстинктивно тоже сделали мою api first но до конца не понимали когда это тело не понимали как люди будут этим пользоваться и вот я хочу привести вам два примера как в результате это оказалось как результате люди начали пользоваться этой а во первых мы используем ansi вал для управление конфигурациями в частности для управления конфигурациями баз данных например мы разворачиваем кастера кассандры с помощью ansi был на железе и что происходит в конфигурация ханство был при разве при развертывании база данных кассандра во-первых мы делаем базовую настройку операционной системы во вторых мы ставим понятно джоуи кассандру для того чтобы ногу поднять мы ставим даймонд отжим x-trans для того чтобы собирать даймондом метрики из системы диск памяти такое g-max транс для того чтобы собирать через протокол чем на кс метрики с кассандры вот и чего здесь не хватает здесь не хватает настройки триггеров понятно вы настроили базу данных и даже настроили отправку метрик с этой базы данных в вашу систему мониторинга но триггер это то что приходится делать вручную и понятно что люди забывают же забывают создавать нужные триггеры и инженеры забывают убрать сервер к из мониторинга который уже вышел из эксплуатации или добавить него новый и это приводит к это приводит к ошибкам это приводит к окопам поэтому у нас появилась благодаря тому что появился закон первичные ребятами и за wide open source питания чей драйвер ккм появился ansi был модуль который позволяет делать создавать и управлять триггерами через ansi был конфигурации через ямал и вот тот самый тигер который настраивал вручную на скин кости его можно вот таким я могу описать и все у вас в одном репозитории полная конфигурация всей системы включая мониторинг включая лифтинг это вот такой фазовый переход то есть это переход от ручной работы к автоматизированной которые есть благодаря тому что есть api 2 история это вообще в целом клиенты copy на разных языках дело в том что у нас основной язык в контуре тыс sharp вот понятно что ребята которые пишут на сишарпе они естественно тоже написали сша клиенткам или правда пока не был он пока не готов к пансиону пока не выложили здесь только питания чей но я надеюсь что мы скоро выложим тем не менее после того как ребята написали на сишарпе клиент copy майра количество триггеров которые настроены у нас системе она увеличилась с полутора тысяч дать 10000 сейчас по моему уже двенадцать или тринадцать тысяч что это означает вот на мой взгляд этот переход он не количественный и качественный потому что 10000 или 100000 триггеров вручную настроить нельзя просто никто не будет сидеть и сбивать эти вещи вручную это штуки которые появились благодаря автоматизации в частности system service discovery которые у нас есть и зарегистрированы разные мика сервисы и ребята написали демона который ходит сервис дисковые смотри какие сервисы там зарегистрированы и для каждого из них базовый набор триггеров создает в море автоматически вручную это понятно сделать никто бы никто бы не стал это делать и это мне кажется что это качественное изменение которое тоже был произошло благодаря тому что есть теперь поэтому эпифиз это не просто красивые слова эта вещь которая приводит к тому что пользователи начинают пользоваться вашей системой по-другому следующая история называется вот так здесь меня снова будет байка из реальной жизни знаете это атомная электростанция называется free майл айленд находится тоже в америке и как вы догадались из моей предыдущей стоит сокеты сейчас там что-то пойдет не так в один по совпадению странному тоже в восьмидесятом году но в сентябре по моему но это странно что вот в одном месте так много происходит стран но в америке на этой электростанции сломался насос сломался насос который воду качают который охлаждает реактор и превращается в пар крутит турбину ну понятно сломался насос казалось бы ничего страшного загорелась лампочка что сломался насос понятно что вода стала перегреваться потому что она больше перестала течь через контур и загорелась еще одна лампочка ему слишком большое давление в контуре охлаждения слишком большая температура загорелась 3 лампочка значит ну понятно дежурное это все видят у них есть на самом деле автоматизированная система которая просто через клапан стравливает это давление not клапан открылся лишнее давление справилась вот тоже загорелась лампочка открылся клапан вот но потом он не закрылся то есть там было механическая проблема да просто клапан не закрылся обратно и без того чтобы лишнее давление остаюсь там просто вся вытекла систему охлаждения но дежурный инженер и не замечали этого в течение 2 часов почему ну пульт управления там на электростанцию на вот так примерно выглядит вот и подставить если на нем горит примерно половину вот этих лампочек насколько насколько вообще легко понять что не так системе довольно сложно это проблема с которой мы сталкиваемся и войти есть прямая параллель дело в том что когда что то идет не так начинают но если в сложной системе что-то идет не так начинают срабатывать большое количество проверок загорается много лампы и среди этих лампочек иногда сложно заметить ту самую одну которое показывает вам что действительно нужно чинить на что нужно обратить внимание у нас есть два способа бороться с этой ситуацией первый способ называется 3 link а вот здесь есть пример это пример реального уведомления это уведомления скопировал просто из лака скриншот сделал уведомление о том что на диске стало мало свободного места вот там порогового значения как вы можете легко догадаться 30 вот и на что началась к этой операции вот то меньше то больше то меньше то больше то меньше что больше и в обычной ситуации это привело бы к тому что вам своими приходит уведомление то есть вительно все время есть фоновый поток вот этих 100 писем вам пришло или 100 сообщений флаг и свидетель 100 вы наверняка пропустить это самое одно важное о том что у вас например сдохла но да вот и мы боремся с этим системой тот линга она смотрит сколько каждый триггер отправляет уведомление в единицу времени и если это слишком много то начинает их склеивать и вот эти сообщения я все получил все вот эти вот срабатывания получил одним письмом дату себе мне пришел один олег действительно о том что где-то на каком-то из серверов места на диске она близка к тому чтобы закончится но я не получил восемь штук это это лучше одно лучше чем 8 а вторая система которая по цветовой дизайн решение которое позволяет на справиться с этой проблемой это режим обслуживания для каждый метрики вот здесь есть пример своей на одном из серверов вы просто вывели его из эксплуатации называется boys the grid 01 кстати вот но так ли хаоса под графитом вывели из эксплуатации просто потому что нужно сервер поменять и вот эта штука она висела бы у нас в в состоянии данных и постоянно мешало вот сам напоминала бы ас в том что нет данных каждый день она висела бы верху списка как я говорил нет данных это очень плохо нам бы не хотелось этого то есть на самом деле мы знаем что это надо вернется через неделю поэтому мы можем поставить ее в режим обслуживания и заглушить на время но важно что режим maintenance мы не разрешаем ставить на совсем любой maintenance это maintenance на время ну в нашем случае это не больше чем неделя то есть если через неделю вы по-прежнему ничего не сделали с этой штукой она снова начнет напоминать о себе иначе если у вас есть безлимитный maintenance все протухнет как в истории с ракетой у вас будут инженеры будут ставить все в maintenance забывать об этом она будет оставаться бесконечно тех пор пока не взорвется вот два способа которые мы используем для того чтобы бороться со шквалом уведомлений стул с большим количество уведомлений которые отвлекают история следующая история это история называется работа с девяти до шести и за общаюсь написан номер 76 на самом деле а вот и это снова байка это американский эсминец джон маккейн вот тут может быть кому то плохо видно у него в борту дыра и хотите узнать почему а вот почему он столкнулся другим кораблем ну то есть да вот этот дырка это просто там баржах него въехала грубо говоря вот почему это произошло за счет это военный корабль на нем много всяких штук висит сверху которые помогают ему находить свое положение в пространстве и не сталкиваться с другими кораблями вот это нелепо звучит да вот ну понятно что эта система могут отказывать как и любые инженерные системы вот и они но они отказали в одно и то же армия сша там все там все четко надежно там есть fall back в этой системы это люди они сидят на борту к ночь на левом борту и на правом борту сидит человек который смотрит он просто смотрит и если видит что на них едет такой корабль он быстро об этом сообщает кому надо вот что с этим человеком произошло он уснул вот здесь чем что я хотел сказать что я хотел вам сказать этой истории она называется работа с девяти до шести и мне кажется что в айти есть такая ну вот когда человек работ кажется что он работает плохо как-то не дотягивает как-то обратно домой уходит поздно приходит понимает вот он работает с 9 до 6 типов что ему все равно и мне кажется что это не уникальная проблема для нас вот здесь то же самое в армии сша тоже есть такая проблема работа с девяти до шести там считается что нельзя работать с 9 до 6 выспишься когда помрешь на на сушу сойдешь там работают по 20 часов в сутки и это приводит к тому что люди переутомлены дежурные на корабле переутомлены обойти дежурные инженеры переутомлены и они перестают замечать важное это приводит к корее нужно чтобы люди спали нужно чтобы чтобы люди спали им не должны приходить ложные уведомление тогда когда они должны спать например ночью как сделать чтобы человеку ночью не приходили ненужные уведомление мы решаем это с помощью расписаний расписание у нас бывают нескольких видов некоторые из них полностью отключают проверку метрики ну например если у вас есть вебсайт который популярен днем на нем много посетителей вы поставили себе проверку что сейчас посетить все посетители на сайте не должно быть меньше чем 1000 в любой момент времени если носитель на сайте 10 посетителей что-то пошло не так что-то не работает но ночью у вас на сайте посетители мало и 10 это нормально для ночью и вы не хотите ночью посыпаться того что вас десять человек на сайте вы можете настроить проверку чтобы эта проверка ночью просто не производилось вообще была отключена либо вы можете в другой ситуации в если вы хотите фиксировать события которые произошли ночью но они просто не настолько важно для того чтобы просыпаться от них по ночам на то что вы будете инженеры вы можете эту проверку оставить она будет работать но уведомление пришлет только с утра когда человек выйдет на работу и может в оффлайн режиме просто проверить что случилось то есть не важные уведомления можно отложить до утра их не взять или присылать прямо сейчас ночью и эти расписания настраиваются индивидуально для каждого дежурного инженера если кто-то работает у кого-то держу смена дежурное днем около то ночью у одного из них расписания будет такое у другого другое все хорошо ну вот на этом 6 истории закончились у меня на самом деле есть ещё половинка истории почему чем половинка почему не целое дело в том что эта история из реальной жизнью у которой нет нет половинки и зайти я сейчас все расскажу и оставлю для вас в качестве размышления можно ли из этого извлечь какой-то урок осмотрите эта история про звуковые уведомления вообще говорят есть звуки которые ассоциируются с чем-то тревожным с чем-то таким плохим это сирена завывание сирены звонок каких какой-то шум почему именно такие звуки ассоциируются у людей с с тревогой это так сложилось исторически потому что раньше лет сто назад у нас не было особо много способов извлекать громкие звуки то есть мы могли дудеть стучать пока лак по колоколов бить в колокола или по барабану он стучать или в элиту дети в такую штуку и и это осталось но все это сейчас средства выразительные средства звуковые они гораздо богаче даже мой старенький телефон siemens мог издавать полифонического мелодию на 40 голосов сейчас это вообще там реальных станции алиса включи мне какую-нибудь музыку а почему не пользуемся этим почему по-прежнему звук там входящего сообщения или звук alr то это звук как имитирующий какую-то вот такую старую штуку не понятно то что проиллюстрировать эту историю я покажу вам фотку из зала ожидания аэропорта наверняка многие из вас прилетели сюда на конференцию и ждали вас таком зале и все время снаружи вокруг вас был шум все время объявляют рейсы своими объявляют пассажиру такое то пойдите на посадку и для того чтобы не пропустить свое уведомление но это же уведомление по сути да но чтоб не пропустить свои уведомления вы должны слушать все уведомления вы не можете быстро определить какое уведомление ваши вы должны услуг послушать внимание пассажиров вылетающих рейсом номер и только потом вы поймете что это не ваш номер можно ли это как-то улучшить можно есть люди ну в университетах работают люди которые занимаются изучением система лифтинга и как сделать их лучше вот эти люди проводят сейчас эксперимент в одно из в одном из госпиталей знаете госпитале тоже там все время звуковые уведомления в американских особенно господа там доктор такое то пройдите в операционную и они приводят эксперимент который в начале каждого такого уведомления вставляет небольшой звуковой фрагмент который позволяет быстро понять уведомление для вас или не для вас например если это что-то связанное с лекарствами то там будет звук такого трясущегося значит трясущейся баночки с таблетками . и это позволяет быстро вас фильтровать то что вам не нужна вот эта история она пока в на 6 миллер тинга никакого применения не нашла я я не знаю найдет или нет но я это историю этой половинкой история хотел проиллюстрировать то что нужно постоянно смотреть вокруг нужно постоянно смотреть на то как люди решают задачи не войти потому что то что мы делаем она не уникальна для этих чтобы я хотел чтобы взяли с собой своего доклада то что я только что сказал идея из внешнего мира если вам интересно что-нибудь из внешнего мира я рекомендую вам серию подкасты на percent invisible это подкаст про дизайн вообще не вообще не технологических отказ это подкаст про дизайн здесь внизу есть ссылка потом скачаете презентацию есть ссылка на конкретную серию про про звуковые alert и послушайте можете послушать другие серии некоторые из них совсем не релевантны но некоторые из них дают просто бешеный inside второе думайте о людях когда пишете программы не только от терабит в секунду о тех людях которых будет за руку дергать вашу штука ну и наконец меня бы не пустили обратно в екатеринбург если бы я ни мне предложил вам попробовать мою а здесь есть ссылки на документацию наш телеграм-канал в котором можно задать вопрос если вам что-то будет непонятно вот моё отличная система вова колобаев вызовет отличный пользователь который принес нам много пользы попросил меня сказать что она очень отказоустойчивые у них уже два года в кавер на это все крутится ещё ни разу не падала говорю спасибо вам за давайте вопросам здравствуйте спасибо за доклад на рст в чём дело здесь мне вот интересует как эту систему с прометею сам из дружить можно можно потушить наметился вот как раз кого я подведите его вам расскажет как ну если коротко в из памяти вас уже можно экспортировать данные в графит вот так вот так и можно пассива просто стоите за ним да и все он задавайте в пир в белом задавайте пара здравствуйте спасибо большое за доклад скажите вы говорится что когда ночью 10 посетителей вы отключаете метрики а что если это очень важно и посетите можно по микрофончик даже просто плохо стой что если 10 посетителей ночью очень важное это всего лишь пример я привел пример ну тут то что мне приходит в голову как можно вот такой наиболее универсальный который понятен всем здесь просто я не не рассказываю как ну как это детка как реально делаем мы потому что этого пришлось слишком большую специфику наших сервисов рассказывать которые никому не интересно вот такой пример искусственный может быть то есть да если 10 посетителей важное вы можете сделать два разных триггер один который будет днем работать и с одними порогами другой ночью или можете настроить сложные то есть не пороге вне пороге вот эти вот 2 там валенки error она строить там есть продвинутый режим в море в котором можно просто выражение написать то есть если там значит то-то больше сталь кита это больше сталь кита то значит тогда присылать а если нет то нет и самой более сложный вопрос насколько сложно сделать систему предсказаний систему которая будет строить доверительный интервал и и фиксировать выход за доверительный интервал смотрите это решая это не является частью мойра как таковой потому что такие вещи обычно решаются вот в парадигме графита с помощью функции графита там есть довольно много разных функций в частности одно разные производные всякие предсказания вещи которые позволяют сравнить с историческими данными за за интервалы и это просто накручиваются функциями на метрику мойра уже анализирует но результирующее значение которое там допустим сравнивается с предсказано понял спасибо так сейчас раз потом 23 хорошо 1 раз я здесь правее смотрите да хорошо это были интересные истории но в них ничего не говорилось про такую любимую вещь как эскалация горацию будут скоро не но бог с ним что не будут скоро я хотел услышать скорее принципиальные отношения то есть ты за эскалации или против я за эскалацию и мы приехали ситуации в ближайших планах он ребята и завита по ощущали pollack вас прислать она цель теперь публично не отвертеться сша и на вид а ви траст вообще понятно спасибо отлично тремя рита ряду и можно даже follow-up такой на самом деле эскалации есть нет таких проблем сделать кастомный и port ну который будет ли мне slug нефть или гамма куда-нибудь еще делать в давлении например в поезжу duty или виктор abs если у вас есть деньги можете эскалации прямо сейчас получить спасибо за доклад вопрос насчет троттлинга вы говорили чтобы не мучить инженера вы схлопывается сообщения вопрос в том когда проблема пришла первый раз они надо уведомить обязательно а потом ещё 2 чтобы не мучай вопрос как вы это делаете вы сначала ждете часа два там другая я понял вопрос замуж не полазать довольно примитивной обрести к первые первые несколько уведомлений присылаются во время а потом ну каждый раз когда происходит новое событие мы анализируем сколько их было за последний например час если их было больше чем там например столько-то то тогда следующее мы уже отложим на полчаса вперед и на час вперед с on довольно простые эвристики но они хорошо работают большинстве случаев спасибо будьте добры алексей спасибо за доклад а вопрос простой вот там есть у вас тихий режим и проблема такая вот который счет пока вижу не было об этом сказано а вот его нельзя навечно включить не понял что еще обычная когда приходит много уведомления некоторые люди находясь под нагрузкой до всякие уведомления вообще в принципе отключают а выключают вообще все уведомлен да вот у вас как бы сказано что есть тихий режим но вот как-то не был открыт но освещен вопрос по каким-то там таймингом насколько его можно включить и кто вообще этим занимается до 23 зубчатый будет состоять мой ответ во первых тихий режим ну там по простая часть ответа у нас расписание они по дням недели и по времени то есть можно сказать хочу получать в будние дни с 9 до 6 вот нет сложные системы как можно там во вторник там 2 до 3 а в среду там с 5 до 8 такого нет принцип очень простой простые интервалы а вот более сложная часть ответа мне кажется что да то вот когда люди отключают уведомление совсем в этот момент все что мы делали все что все наши старания они уже пошли прахом то есть нужно пытаться создать такую систему которая не провоцируют людей выключать уведомления если я вот по опыту знаю и что если человек настроил redirect писем от системой лифтинга в другую папку это уже все есть это уже потеряно человек может то есть он не будет читать вот и все что я оговорился вот эти вот дизайн решение не направлена на то чтобы не дойти до этого если до этого дошло то все здравствуйте вопросик я смотрю не работал поэтому если это есть документации раз прошу простить за глупый реализованы какие-либо сдп нэнси настучи если у меня массовый выход какие-то проблемы сети у меня масса зарабатывают триггеры нет или на одном посте что-то случилось неплохое и там срабатывает сразу 43 игра нет нет нет то есть там нет никакой системы семантического анализа что означают ваши метрики они говорит они понимают что хост один и тот же в двух разных триггерах он просто нет вы как-то решили эту проблему нет нет не коси большая алексей на корректный ответ это пока нет нельзя говорить нет на дворец пока нет надо честно говорить у вас отпал вопрос пока нет молодец почетные грамоты и запись твоего доклада новых аэс спасибо большое и скажи кому мы подарим книжку за вопрос кому мы падаем мишку за вопрос я наверное хотела подарить мишку за вопрос про то как работает тот link когда он срабатывает сразу а когда он срабатывает не сразу это вот вот из той части завода спасибо за вопросы спасибо большое успехов"
}