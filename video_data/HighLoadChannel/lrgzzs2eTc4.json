{
  "video_id": "lrgzzs2eTc4",
  "channel": "HighLoadChannel",
  "title": "SQL/JSON: реализуем стандарт и не останавливаемся на этом / Александр Коротков",
  "views": 967,
  "duration": 2918,
  "published": "2020-04-14T11:30:00-07:00",
  "text": "давно мы на самом деле уже реализовали стандарт вскоре джейсон вот никита глухов под руководством всем известного олега болтунова сделал большой набор почините патч достаточно долго долго лежали в hackers их там был кое-какой на них фидбэк в общем но в итоге чтобы их закомитить это уже только я в 2018 году получил статус к метро и начал значит эти эти почаще потихонечку разгребать вот и в12 релиз у меня получилось закомитить джейсон пас сам ну да самое ядро жизнь искали джейсон стандарт а вот про это все я сейчас подробнее расскажу вот краткая история про сам про поддержку новой ускорили web отгрыз вот началось все с типа данных из top который был просто как расширение это грубо говоря перловый хэш который в одном одном атомарном типе данных иску или хранится вот то есть уже как бы некоторое такое набор пар ключ-значение некоторая и гибкость этим обеспечивалось потом силами портового сообщества в 2012 году был сделан джейсон но этот жильцом был такой достаточно наивный то есть это был просто текстовый формат текстовый тип вот но в принципе часто к так и остался ну после которого обеспечивалось валидация соответствия джейсон стандарту и некоторые достаточно простые типа операции потом собственно мы вот феди сигаев олег бурханов я сделали в 2014 году тип джейсон б в котором уже было эффективно и бинарное хранение то есть грубо говоря чтобы достать значение конкретного ключика не надо было парсить весь документ и соответственно ну производительность у этого типа данных намного выше вот-вот в этом году собственно удалось закомитить в позы джейсон паз под газ-12 который вот-вот выйдет часть стандарта искали джейсон и вот ожидаем что наверное 2020 году у нас уже будет соответствие стандарту то есть не сам не просто сам голый но не то что голый не просто джейсон паса еще и все стандарты определенные стандартам с ним операции сейчас про это все более подробно расскажу вот но про то что два типа для джейсон есть подлость и так исторически сложилось я уже упомянул вот это один слайд который включает себя все их отличие вот то есть в чем преимущество типа джейсон то что он сохраняет вообще все что было в текст вам все что есть текстом представление джейсон то есть у вас там может быть ключ два раза там пробелов много и так далее порядок ключей jay sin b и он все это нивелирует но зато он ключи держит держит отсортированы me и в них можно быстро бинарным поиском искать и за счет этого ну собственно там извлечение ключа быстро и вот все это было замечательно но проблема была в том что не хватало встроенных операций не хватало чтобы искать в джейсон ах то есть вот например вот как выглядела запрос для джейсен бы который искал color red color red который встречается в любой части джейсон документа то есть для того чтобы вот такое сделать то есть пройти рекурсивно по всему документу найти встречается ли там ключ color равное значению red но чтобы все это сделать стандартными искали конструкциями получался огромный запрос которые вы видите слева вот лучше просто воспринять его как сложные запросы даже не пытаться понять что там написано что мозг можно сломать вот но собственно чтобы было удобнее искать в джейсен б мы сделали расширение которое называется и сквере то бишь это тип данных которые реализуют запрос если вы знаете там в подгрести есть там т сквере там elk вере и так далее тоже нами реализованы и вот мы по аналогии сделали джея сквере то есть тип данных которые реализуют какой язык запросов достаточно в ряде поисковых задач удобней видите вот как в данном случаи когда мы ищем color red насколько стал простой лаконичный запрос пузыря нему и плюс к этому мы еще сделали специальные джин индексы для поддержки таких запросов вот все это замечательно тут показан google тренд и показано что собственно популярность под газ а она очень сильно пошла вперед именно когда джейсен by появился потому что пользователи хотели очень большой был hyip вокруг маску или и вот на том что в подписи было появилась поддержка в 1 из реляционных баз же снг это как раз очень очень сильно популярность по сбросу увеличила вот но сейчас появился еще и искали стандарте поддержка джейсон вот то есть если сравнить сколько вот сколько времени прошло до вот как в подписи вернее нет никак в возрасте как появились начали появляться джейсон базы данных и то когда значит вы скрыли стандарт включился джейсон то есть это восемь лет прошло с тех пор как и сквозь foundation понял что надо поддерживать джейсон вот то бишь стандарт он определяет целую кучу понятие которую нужно чтобы сказать как реляционная база должна уметь работать с документами вот я немножко так немножко по деталям пройдусь первое что там есть это sql джейсон да там отдал вот вот первый раз если читать стандарт это может вообще дико сбивать быть ничего не понятно потому что как бы ну есть стандарт джейсона и он вроде бы все уже определил какой даты модуль еще вот но дата моду на самом деле он определяет не то как вот джейсон лежит в строке а то в какие типы объектов мы умеем поднимать его в памяти грубо говоря распарсить то бишь мы можем сделать например daytime тип лежала у нас в джейсоне 40 с до тогда мы можем из нее сделать тип daytime вот потом сконструировать из этого какой-то еще объект вот а потом этот объект обратно и реализуется в жили сон этот daytime превратиться в строку то есть вот эта вот дата модал это именно то что происходит в памяти вот эти вот включая там daytime и и всякие разные другие штуки собственно вот стандарт также включает язык expose джейсон паз до оговорка по фрейду да потому что джейсон пас действительно он был навеян экспо сам хотя он конечно там поменьше возможности чем в eg спаси пока очень известно что будет будущем вот но до определяет этот язык и собственно наверное это большая часть вообще того раздела стандарте который посвящено искали джейсона это именно джейсон паз и включает в себя вот набор функций то есть функции которые позволяют работать с с джейс джейсон посомтри грубо говоря там кану функции там типа извлечь все значения из джейсон документа который матч в 76 сантосом вот так вот теперь про поддержку про поддержку вскоре джейсона вот в подписи в подгрести мы пока поддерживаем иска или джейсон только в типе джейсон б вот а это значит что это стандарты для как бы типу джейсон дэй соответствует вот два таких квалифаер а которые называются ordered и uni кейс то есть в джейсон by и ключи и уникальные то есть не может быть там два ключа с разными значениями и они все отсортированы вот стандарт позволяет работать и без указания таких вещей но пока что мы еще не поддерживаем пока что мы еще это не поддерживаем значит сам язык мы же язык джейсен пас его имплементации она за комично в под газ-12 за исключением поддержки даты и времени вот но дата и время уже за комично в под газ-13 так есть еще и вот есть у нас свои функции у нас пока не получит пока еще стандартные функции реализовать для работать женщин по ст достаточно сложно поэтому у нас еще есть пока свои функции и индексы мы уже поддерживаем вот так как и встроенные индексы и индексы в нашем расширение j сквере об этом я сейчас по подробнее подробнее расскажу вот но для начала про то вообще что такое что собой представляет джейсон пас джейсон пас он использует нотацию видите в виде точек вот то есть вот доллар означает весь документ ну потом ну . а то значит ключ осмотр там внутри этого объекта к следующей 3 часа и так далее вот значит вот там квадратные скобки это доступ к элементам массива то есть квадратных скобках можно написать звездочку будет доступ ко всему массиву ко всем элементам либо можно использовать вот там перечисление яндексе и индексов синтаксис через с режимом и так далее фильтр то есть можно через фильтр можно выбирать только те элементы которые удовлетворяют определенному условию то здесь смотрите мы выбрали там a b c а потом хотим чтобы в внутри этого объекта было которая по пути a b c расположена добыл еще свойства x со значением большим 10 вот соответственно вот внутри фильтра это используется значок собачка это текущий фильтруем и елемент вот есть еще разные методы которые можно вызывать для значений джейсона вских то бишь вот есть метод type он возвращает тип виде строки там says размер для арея там всякие преобразования типов типа там не не знаю floor ну стандартные такие обычные методы вот константы константы можно задавать но вот как я уже сказал вернее не только константы вот есть поддержка можно не только ник только некий текущий элемент не только текущему документу обращаться или которого мы вычисляем же и сам посла можно еще и туда пробрасывать определенные перемены и вот видеть как доллар фу это значит переменная с названием фу вот ну и потом тут константы строковая константа числовая константа гулевская ну вот и собственно ну вот то то о чем я уже говорил доступ к полям к полям объекта к атрибутам объекта и к элементам массива вот ну в общем так все все в принципе наверное достаточно понятно вот еще пример буква джейсон пас который фильтрует в соответствии с лейблами ну то есть в соответствии с переменными то есть вот мы выбираем случае там документ с описанием зданий до выбираем этажи с уровнем меньшим чем за данный параметр это max level вот потом внутреннего выбираем уже апартаменты у которых площадь превосходит тоже за данный параметр ну в принципе такие достаточно тривиальные ну достаточно тривиальный запрос мне кажется все должно быть понятно арифметические выражения поддерживаются там там не знаю минус плюс умножить поделить то есть и можно что-то посчитать внутри этого джейсен пас а потом это еще чем-нибудь сравнить наверное наверное тут особых вопросов нету так ну и потом можно например что-то посчитать до потом поместить этот скобочки и вызвать потом какой-то метод это все та же легально там посчитали какую-нибудь формулу потом сзади вызвали метод округлить и так далее вот синтаксические ошибки они рапортуют еще на том этапе когда мы строку костюмов джейсон класса фильтр фильтр я в принципе уже показал на примерах фильтр ну как это on грубо говоря аналог услуга в иску или синтаксис это ? вот и внутри значит мы задаем предикат с предикат это то условия которые мы проверяем для всех фильтруемых элементов вот и что важно еще что в предикат ах подавляются ошибки ну то есть грубо говоря вы там сложили внутри предиката a + b a + b это оказались не знаю там не числа массивы для которых операции сложения не определено в же и santos но если при условии что это внутри предиката то у вас это ошибка она будет подавлена и эти строки просто не отфильтруются то есть у вас в этом случае на уровне es que el ошибка не про броситься да и еще есть такая тонкость что у искали джейсона есть режимы есть режим strict есть режим lax вот как я это вот как я это могу описать вам короткими словами то есть режим режим strict он делает в точности то что написано вот а режим лакс это он пытается превратиться в javascript знаете который там не знаю выдыхается там автоматически там строку в число там это такое вот здесь правда строку в число нет но вот он пытается автоматически например разворачивать массивы то есть вы применили например фильтр не к элементам массива к самому массива массиву и вот этот режим лакс он попытается это автоматически определить и сама понять что вам нужно массив развернуть и вот такие вот штуки он всякие делает это но зачастую это приводит таким странным ну не очевидным и контр интуитивным последствиям вот почему я и провел аналогию со скриптом вот моя личная рекомендация это использовать strict но некоторые люди могут быть со мной не согласны так ну так вот еще немножко здесь есть по про предикаты но есть понятную операции сравнения там больше меньше равно и так далее логические операции вот они обозначаются значками как все есть предикат экзист соответственно после предиката экзист следует под выражение и если это под выражение что-то нашло то у нас будет true если не нашло то будет фолз вот есть like regex это соответственно но по регулярному выражению проверка старт swiss тоже поиск но проверка префикса строки вот и за новым собственно проверяет что что вы вот в этом внутри этого подвыражения под выражение не удалось посчитать не удалось посчитать тоже как как пример какая-то произошла ошибка мы применили недопустимую операцию было у нас строка мы сказали ей floor там округлите ответственно округлить округлять мы умеем только число вот ну вот то что от ошибки при вычислениях они превращаются в она так в данном случае вот зину здесь ошибка потому что мы ищем массиве и мы выполняем эти ману арифметическую операцию деления соответственно строка мы не можем настройку поделить вот и мы видим что там где у нас была проверь и проверка результатов деления мы вернули нас результат 12 получился да потому что они но для них успешно было было посчитано предиката он оказался ту вот а мы можем сделать и за но вот тогда собственном и вот получим вот эту строку а для который посчитать предикат не получилось методы вот что касается интересных методов есть такой метод как киева илью и этот метод что делает он берет значит объект и разворачивает его в все мол объект или массив и разворачивает его во все значения которые в нем содержатся вот то есть в данном случае в данном случае что у нас получилось что вот у нас есть два массив и там есть два объекта у них имена атрибутов abcd значит что сделал этот кий вылью это он сделал такой плоский плоский массив в котором стив все значения содержит то есть видно что есть кей у него такое значение какие бы так это вот и есть еще айди это идентификатор того объекта внутри которого этот ключ содержался то есть видно что вот здесь можно понять что ты перевести а и б они внутри одного объекта сойди 16 есть ключи cd то они внутри другого объекта с сойди 56 соответственно здесь последовательность айтишников стандартам не требуется имплементации они могут как как хотят эти айдишники генерить вот лишь бы у одинаковых объектов но айдишники совпадали вот поэтому мы в подлости чтобы нам было удобнее просто используем в качестве здесь в катара объекты его физическое смещение внутри джейсон by папа байт его так оказалось проще всего удобнее всего сделать вот ну вот еще пример математически как можно применить разные методы вычисления так ну вот видели джейсон паз и были с этим самым с поиском по зданиям вот например джейсон раз посмотрим структуру джейсона а потом как-то ним выполняется запрос и вот этот джейсон в нем есть описание нашего московского офиса вот то есть тут вначале идет вот у него есть адрес понятно там определенные свойства потом это же там но здесь для простоты два этажа содержится и на каждом этаже это соответственно помещение и в помещениях уже набор свойств мы там следующий этаж ним тоже помещение набор свойств вот в принципе достаточно такой несложный джейсон но что-нибудь интересно на нем можно показать так вот такой джейсон и по поиск и джейсон пас на что это жизнь по сделает он берет ищет по всем этажам по всем помещениям чтобы площадь была от 40 до 90 квадратных метров вот посмотрим как он работает значит он идет в начале ну вот корневой объект из него он идет в свойства floor в свойства floor идет потом значит из floor он выбрал оба обойти этажа вот дальше собственно когда он выбрал оба этажа он начинает идти циклом по уже помещением которые есть в этих этажах вот проверяет проверяет вот этот предикат ирия для каждого из помещения получается вот дошел все все помещения выбрал и для каждого из них проверяет выполнение предиката вот собственно вот выполнение предикат он проверил нашел два помещения ну то есть по сути вот экзекутор джейсон паса это такой банальный достаточно экзекутор который делает ну вложенные циклы прошелся прошелся и идет циклом там по этажам внутренней вот потому что здесь есть грубо говоря это звездочка до поэт потом внутри этого цикла будет еще один цикл по этим самым по помещениям вот тут самаре так strict ире и и лакс вот здесь опять вернемся к strict и лак с режимом вот всем еще отличие в том что лакс он позволяет вам игнорировать отсутствие структурные ошибки там отсутствие например необходимых ключей или если вы обратились там к массиву как объекта к объекту как массиву и так далее the strict этого делать не позволяет и кидает ошибку вот ну то-то же здесь при пример тоже доступ к объектам не того типа так дальше смотрим ну это это то что я уже говорю о то что предикат он подавляет ошибки возвращает а но в обоих случаях случаях и strict и лакс вот только лакс он может структурной ошибки он подавляет даже сильнее так что душа не возвращается но он то есть и за новым тут ничего не будет возвращено ну вот это то что тоже немного уже говорил то что лакс он автоматически разворачивает разворачивает объекты вот то есть если мы берем и делаем так если мы делаем фильтр по по массиву и при этом мы не не развернули некоторый элемент потому что вот смотрите здесь есть поиск элемент номер 5 элемент номер пять он находится внутри вложенного массива вот если мы делаем lacks the lock сама автоматически развернет все массивы и вернет нам эту нужную пятерочку а если мы сделаем strict the strict при поиске пятерочки ничего не найдет то есть стрипти нужно было бы сделать эту звездочку в квадратных скобочках а потом еще раз звездочку квадратных скобочках вот так в целом вот я немного рассказал про сам язык джейсон пас теперь вот про то как это реализовано в пользовались я может быть уж заметил джейсон пас реализован в подписи как отдельный тип для этого типа данных есть сейчас набор функций по сгрыз о-вах с помощью которых можно поэтому джейсон пасу там и искать фильтровать и так далее поддерживаются существующие индексы в нем вот и почему мы собственно мы так сделали почему мы пока не поддерживаем вот выражение которые заданы стандартам а поддерживаем свои функции это потому что называется слона лучше есть по частям и потому что стандарт очень большой и если пытаться все это все его реализацию уместить в один релиз цикл то можно было бы вообще никогда ничего не закомитить поэтому мы пошли путем разбиения то есть сейчас мы в двенадцатую версию закомитить джейсон паз для которого пока есть наши кастомные функции для работы с ним которые нам оказалось проще сделать а уже вот тринадцатую версию надеюсь удастся закончить уже стандартные выражения для джейсон пас вот как какие как выглядит функции которые у нас сейчас в подгрести есть для работы джейсон по сама функция экзист проверяешь что джейсон паз для данного документа возвратил хотя бы что нибудь хотя бы один элемент соответственно если уж что-то возвратил то это будет true вот есть функция матч функциями оно похоже во многом на экзист она выражается даже через экзист но она проверяет что просто джейсон по свернул один элемент в котором есть true ее удобно использовать чтобы скажем просто написать там я не знаю доллар а больше десяти это как бы такой джейсон поражение которое вам вернула один boolean вот и чтобы по нему отфильтровать документы удобно использовать вот эту функцию jason de passe матч есть функция куэрри к вере возвращает нам все все то что джейсен пас нашел но клэри она возвращает нам это в roxette то есть грубо говоря в табличку табличный вид есть еще джейсен беппо сквере array которая возвращает нам это все в виде массива и это в ряде случаев бывают удобнее еще есть джейсен беппо сквере first она из всех результатов возвращает нам нам 1 вот и здесь плюс но ну удобно использовать когда вот у вас джейсон паз и вы знаете что вам точно нужен только один элемент например у вас женщин пас который только один только одно значение всегда возвращает чтобы вам не делать никакого там развратом и так далее никак не и разворачивать массивы вот эту вот функцию феаста тоже бывает удобно использовать и ждем еще есть преимущество по performance у то что экзист и фёст они останавливаются и и когда они находят первый элемент то они восстановлены останавливаются и не выполняют дальше женщин посту сексист нашел один вернул один результат то все дальше он им но не будет выполнять же с impass и в ряде случаев это бывает быстрее вот теперь по поводу того как и у этих функциях функций параметры собственно параметры параметр здесь 4 первый параметр это сам джейсон документ для которого мы выполняем это наш запрос собственно джейсон пас это наш запрос wars это выебал это те дополнительные параметры которые мы передаём для выполнения нашего женщин паз и silent еще один параметр это значит если мы silence устанавливаем в true это значит мы хотим подавлять ошибки вот пример вот такой у нас есть массив чисел один два три четыре пять мы выбираем из них те которые больше параметра x и передаём параметр x равный двум ну вот мы выбрали таким образом три четыре пять и но это qr и она вернула нам эти три четыре пять виде массива ну вот по поводу silent а значит вот пример мы берем и делаем доступ к массиву как будто это объект пытаемся прочитать его атрибут если silent не устанавливать в true то получается ошибка если silent поставить стру то ошибки не будет просто нет результатов ну вот еще примеры других функций экзист вот есть объект с одним суп атрибутом а вот соответственно если мы ищем этот ребят а то получается труа если ищем б которого нет то получается фолз в принципе довольно очевидное вот например как но для чего нужен меч то есть вот у вас есть а и вы пишете выражение равно единице свои просто проверяете и вас из этого получился один boolean принципе такой же запрос можно было мешать экзист тогда вам нужно было бы выбрать вот этот элемент а а потом к нему ещё применить фильтр что значение равно единице это как бы такой ну немножко менее очевидная запись поэтому мы сделали еще и функцию матч иногда и удобнее использовать вот у кэрри кэрри вот тот же запросу который мы смотрели вот он вернет 345 но только в виде трех отдельных строк там константу можно менять там результат получится другой упырей все тоже самое только результат заворачивается массив водкой рейв рост значит кого reset что делает он возвращает нам первый элемент то есть вот то тот запрос который возвращает массив три четыре пять когда мы делаем кого и first он возвращает просто 3 или если если результатов нет он вернет нам ну причем это именно будет этот самый иску или ну не джейсону скинул вот такая тонкость ее надо учитывать потому что значение которые мы выбрали оно могло бы быть джейсона вскинул am поэтому чтобы отличать одно и другого когда ничего не найдено у нас иску или вскинул возвращается вот значит для функций матче экзист есть еще операторы которые в принципе делают то же самое что и они то есть вот для экзист это собачка ? для матчей это собачка собачка ну для тех кто с подвесом работает со всякими индексами его работает вот эти вот обозначения я думаю собачка собачка уже вопросов особых не вызывают вот эти операторы в принципе ничто не мешает пользоваться функциями да и казалось бы зачем нужны еще и операторы и операторы нам нужны для того чтобы иметь поддержку индексов потому что по сбросу он умеет ускорять выражение которое выглядит как колонка оператор значения хотя на самом деле сейчас уже стало немножко лучше если я успею то я об этом тоже расскажу так в силу отсутствия времени я про это сейчас немножко пропущу но тут слайд просто сравнение запросов но суть в том что джейсен пасом можно гораздо более лаконично написать чем вот эти конструкции там в иску или со стрелочками еще не дай бог под запросами и так далее конечно ну лаконичность это безусловный плюс 6 сантоса вот тут еще пример как времени времени мало я буду пропускать вот но джей сквере я конечно extinction который мы еще в 2014 году написали он беднее конечно чем джейсон пас это безусловно но в чем-то он лаконичность у него еще еще сильнее ну вот здесь пример который показывает как одно и тоже можно написать через джерри сквере и через джейсон пас а это как на иску или но пример похож на то что я в начале показывал страшный запрос который не надо читать вот daytime да это позволяет распарсить нам строку которая содержит дату в саму дату а потом с этой даты можно будет что-нибудь интересное сделать ну хотя на самом деле сейчас пока ее можно только сравнить с другой датой но это тоже полезно то есть в каком бы не было у вас формате да то вы можете взять указать этот формат распарсить все и сравнить там не знаю на больше меньше отфильтровать в полисе двенадцатом этого еще нет вот в подписи 13 это уже закончено вот и в общем все здесь вроде как вроде как хорошо в этом месте да соответствие стандарту что касается женщин паса у нас в самое полная то есть вот это сравнительная табличка здесь для возраста 12 14 из 15 ну для подвеса 13 уже будет 15 из 15 потому что do it time тоже тоже доехал так вот помимо официальные доки есть еще вот такая вот и мешочка от олега бурханова которую можно потом но это презентацию скачать перейти по ссылке там тоже довольно все так по-человечески в примерах рожон а поддерживаются индексы есть в подгрести два типа встроенных индексов это джейсон by abs который просто отдельно индексирует все ключи и значения просто не зависимо от того где они встретили в структуре он их отдельно извлекает отдельно индексируют или джейсон б-г shops отпечатка он называется жизнь пипа собс суть в том что он берет пути которые состоят из всех ключей и значений на конце и берет от него хэш и суть в том что для вот таких операций как контент ну то есть что один документ содержит в себе другой как сосед это работает замечательно эта операция поддерживается еще и работает очень и очень быстро вот соответственно оба этих об класса они они сейчас поддерживают джейсен пас но в тех случаях когда когда это возможно понятно что если вы например будете мочить строку паре гаксуд а не один из этих индексов вас не сработает вот а если там какие-то более простые штуки штуки сработают и в же сквере у нас тоже есть об классы которые позволяют индексировать джейсон пас вот я сейчас детально разжевывают не буду просто надо знать что такое есть если вам не хватило встроенных об классов есть смысл поставить же и сквере ну вот пример что можно использовать существующий джейсон индексы производительность вот ну производительность я не буду детально останавливаться в общем тут только тонкость есть некоторые что бывают функция ему то был бывают функции power to stay был вот ему-то было не приду отчисляются один раз перед выполнением запроса стоит будут каждый раз вычисляться в этом выражении здесь есть такая тонкость но времени на нее нет запросы всякие бенчмарки общем если вкратце суть всех бенчмарков она сводится к тому что у джейсон паса намного более легковесный executor чем собственно подрисовываю экзекутор вот и грубо говоря если вы пишите ваш запрос через об select и через весь inpace у вас асимптотическая производительность ну будет одинаковая вот другая там от н н это размер документа но константа джейсон паса будет сильно лучше потому что он сильно легковес не там просто бежит с циклом по документу он не берет и не формируют тупые над которыми работает там какая-нибудь но до экзекьютора и все это ужасно тормозит то есть выигрыш именно просто за счет более более быстрого экзекьютора идет а есть ещё такая тема которая называется interojo inc с легкой руки олега она появилась суть в том что уже можно как бы когда у нас есть женщин пас можно делать join и уже в рамках одного документа фактически вот то есть например такой пример что мы ищем люк базы данных по фильмам и мы ищем людей которые в одном и том же фильме из были как режиссерами так и актеры но человек человек был в фильме и режиссером и актером одновременно мы ищем всех таких людей вот и поскольку он у нас вот такой джейсон чик в котором по каждому человеку все его все его фильмы в которых он был режиссером есть отдельный массивчик отдельный массив и где он был актером в общем мы можем все это за того что вся информация есть в одном документе мы делаем такой join в рамках одного документа и он даже быстро работает вот но он быстро работает потому что нам просто повезло в данном случае она самом деле of симпатическая производительность у нас не очень хороший у нас вылезает там о том квадрат вот просто в силу специфики datasette а все получилось хорошо а на самом деле нужно этим инструментом пользоваться с осторожностью так но я все та же промотаю так ну понятно для чего нужен джейсон пас это во-первых потому что это стандарт во-вторых потому что это удобный и лаконичный язык на котором можно написать все гораздо гораздо проще и банально быстрее даже набрать этот вопрос вот ну и третье это то что экзекутор быстрее быстрее где кьютер и работает ну вот рот map в рот в рот baby значит что у нас есть понятно поддержка всех функций которые заданы стандарте это подписи 13 чтобы были не наши специальные функции именно те выражения которые специфицированы стандарте daytime за комичен планер саппорт сейчас я немножечко пробегусь еще под а потому что нам осталось сделать это вот люди все которые работали над с грехом же и сонам немножко вот пробегусь по тому что осталось сделать и будут но можно будет вопрос еще задать вот ну вот стандартные стандартные функции они такие они похоже на то что мы сделали но там много-много синтаксиса много всего вот в том числе вот параметры для об классов это важно это позволит сейчас яндекс по джейсон бы он работает так что он индексирует все а если мы сделаем что можно будет внутри класса передать параметр то в этот в этом параметры можно будет например задать джейсон пасов все пути которые мы хотим проиндексировать и соответственно тогда такой индекс если вы правильно выберите что им какие именно части джейсон by надо проиндексировать то он будет меньше overheat на maintenance иметь вот так ладно этой в возрасте 12 появилась такая прикольная штука это если у вас есть функция появилась возможность для нее сделать поддержку тоже поддержку индексного поиска это получилось буря тому что очень много по этому поводу страдали ребята из под gist вот потому что у них тоже все для пользователя выглядит в виде функции там не знаю какой нибудь там aver labs но чтобы это работало с индексами aver labs это онлайн ница в выражении то есть это иску иная функция которой онлайн за которая превращается в оператор пересечения боуден боксов и реальную и реальная функция over labs вот это все очень странно работала хотя работала но появилась такая функция которая позволяет такие преобразования делать без вот этого inline а а делать это с помощью специальной системной процедуры и в но мы планируем для джейсон пас такую поддержку сделать чтобы можно было использовать не только вот операторы которые мы написали но и обычные функции типа вот джейсон by pass экзист так ну ладно расширение синтаксиса это уже детали это я наверно не буду рассказывать немножечко времени осталось на вопросы спасибо за внимание давайте попросим буквально буквально два вопроса у нас есть соответственно sage выбери кто тебе наиболее симпатий я вот-вот из-за руках irusik да ты человек спасибо большое за доклад вопрос такой насколько оправдана существование лакс учитывая его не всегда очевидны и результаты ну как в том же джек вере в том же java скрипте если есть возможность указать sound труб и зачем тогда нужен лакс когда можно обойтись только со ён там у насколько различны и может быть могут быть кейсов дух этих параметрах ну насчет как бы насчет оправданности смотрите есть стандарт возраст от старается соответствовать стандарту если стандарте не написана какая-то совсем уж глупость то мы стараемся ему соответствовать и тут как бы ну мы даже особый вопрос такой честно говоря не ставим ну лакс я даже не знаю мне вот это мое мнение мне лакс не очень нравится поэтому я как бы так доклад строил против него но эммы есть и другие мнения то есть где то он позволяет что-то сэкономить да то есть например если у вас действительно может быть такое что вы ищете например оос может быть завёрнуты элементы там во влажные максим массив а могут быть не завернутые если не просто потому что вы по невнимательность этого не указали вам нужно оба кейса обработать то например случае strict вам придется выражение как бы сложнее писать вам нужно будет это это написать а bloksi у вас будет лаконично и выражение как бы ну наверное ничего тут особо больше сказать короткий вопрос мой врач кого-нибудь именно короткий там короткий вот давайте короткий без микрофона не надо я бегу да я действительно очень короткий вопрос является ли теперь по сгрыз убийцей манги какой вопрос но всегда был убийцей манги не но я не знаю на самом деле наверное для того чтобы быть совсем убийцы манги нужен встроенный sharding все-таки потому что ну я не знаю на сколько он хорошо работает по я знаю что он там есть вот когда у нас будет встроенный sharding мы будем совсем уже убийцы убийцей спасибо огромное александр спасибо об от нас спасибо видела таких от подарков и трат на память о том что ты здесь был моего так кстати лучший вопрос нужно выбрать кто тебе у нас было два в принципе одному пирушку а другому книжку давайте справедливо так а что это у нас есть туда кружкой книжка куда мы кружку отправляем куда книжку тебе решать ничего себя нет ничего давайте вот у вас более умный вопрос был вам у вас у вас быстрый поэтому вам провокационные висел спасибо огромное еще раз"
}