{
  "video_id": "dpTMjjqJSUk",
  "channel": "HighLoadChannel",
  "title": "Domain Driven Design в Go — это не больно (почти) / Илья Сергунин (Авито)",
  "views": 763,
  "duration": 2835,
  "published": "2024-10-29T02:48:12-07:00",
  "text": "Я сейчас на сцену приглашаю Илью для того чтобы рассказать про то зачем это в го и почему это не больно да привет гофер И всем кто просто интересуется языком сегодня как раз хочу рассказать про то как можно попробовать реализовать DD в и какие инструменты использовать немножко о себе Я работаю в Авито последние 2 года передаю ваши смартфоны в хорошие руки перед этим читал исходники Яндекса до того как это стало мейнстримом А перед этим делал медицинскую информационную систему в которой была уйма бизнес логики провяз инфраструктурным кодом и любая фича доставалось нам сбоем приходилось искать где Что Как поправить и при этом никогда не было уверенности а не создали ли мы новый Баг и наш любимый пользователь стал недовольным поэтому В текущей команде Мы решили попробовать ddd при этом не в стандартным способом в го у нас Довольно простой Фло на словах У нас Продавец продаёт партнёр партнёре через оценку телефона подготовку перепродажа дальше покупателю А в текущем докладе я попытаюсь объяснить как можно натянуть D Наго без синтаксического сахара и Магии которая есть в два подобных языках и без больших крутых урк дата марами которые также отсутствуют в го Зачем вообще это пытаться делать для себя и в команде мы ответили на этот вопрос таким образом что мы помещаем бизнес логику в одно место и делаем её очевидной явной И понятной тем самым и также независимой от внешних зависимостей благодаря этому мы можем написать на неё Юнит тесты и чуть быть более чуть уверенными в том что новая фича не сломала нам что-то и всё вместе это нам упрощает поддержку и развитие проекта а короткий план нашего путешествия мы пролетите паттерны а немножко затронем точнее пройдём часть тактических паттернов которые есть ddd и посмотрим на инструменты которые помогают нам их реализовывать О чём ddd начнём с ddd И начнём с домена домен - это та предметная область в которой работает Наш бизнес в моём случае это Авито и это доска объявления далее мы с бизнесом разговариваем вырабатываем общую терминологию и называем это единым языком то есть вместо например записи в базе данных мы конкретно говорим что это объявление вместо Рудо операций на создание удаления обновления и так далее мы говорим о конкретных бизнес сценариях А и также выделяем акторов не пользователь а продавец и покупатель а далее после того как у нас есть единый язык мы можем попытаться начать определять ограниченные контексты а то есть это границы той проблемы которую приносит нам бизнес и которую мы будем решать зачем нам это нужно чтобы понимать что и для чего мы делаем и не копировать реальный мир в его сложности и многообразии А на слайде вы видите примеры ограниченных контекстов которые есть в Авито это объявление доставка поиск профиль и так далее В каждом из них мы используем чаще всего свой единый язык то есть например в объявлении У нас есть объявление с кото которое мы можем разместить изменить у и далее есть свои пользователи и они частично мигрируют в другой контекст и могут находить своё отражение например в доставке и эта миграция эту миграцию мы отображает контекстов также на карте контекстов мы отображая интерфейс какие методы и какое публичное а один контекст использует от другого а вот мы пролетели с вами стратегические паттерны ите приу доклада а точнее к тактическим паттернам первое И самое главное так как мы определили единый язык мы его начинаем переносить Почти один к одному в код то есть мы говорили о продавцах покупателей супер стали селлеры и байеры есть объекты такие говорили об объявлении также добавили о конкретных бизнес сценариев тоже самое переносим в код Дальше можно заметить что например некоторые значения могут казаться довольно маленькими как например in string и которые могут перейти в цену и заголовок и тут нужно понимать мы выбрали что даже такие мелкие значения мы переносим себе в код потому что с бизнесом вряд ли мы будем говорить и услышим от него что знаете строка может быть короче меньше короче 255 символов скорее всего бизнес к нам придёт и скажет у вас заголовок а выявление может быть короче 255 символов и чтобы говорить на одном языке Мы также переносим в код его а далее хочется сказать что куда мы кладём надо понимать что доло это основа это так сказать база нашего приложения и независимо от того какую архитектуру вы используете слоистую гексагональный слой и он независим явно от внешних зависимостей А тут ключевое слово явно иногда в наших доменных сервисах может понадобиться внешние данные либо какие-то сложные расч и чтобы это реализовать мы используем инверсию зависимо Это довольно про где мы задаём интерфейс в нашем домене и храним именно в домене его а снаружи подсовывает ную реализацию то есть в данном примере у нас есть репозиторий пользователя в домене и мы подсовывают наших нужд так бы это выглядело в коде всё довольно просто интерфейс сервис в котором это используется идва конкретной реализации Извне чтобы сделать свой до слой сильным и независимым можно использовать следующие нте это deg он проверяет корректность зависимости по тем правилам которые вы задали он встроен гон Надеюсь вы его все используете в своей работе также альтернативно если вам не хватает рда Вы можете использовать goar lint который помимо проверки зависимости напрямую дополнительно отыскивает даже инверсии зависимостей чтобы прям Стопудово защититься в своём коде в нашем проекте хватает ИП грда но вы можете использовать и goar Clint теперь Хотелось бы поговорить о том о данных как их объединять и как сделать так чтобы они отвечали сами за себя и сгрузить в них как можно больше ответственности и сделать их самовару А давайте взглянем Например у нас есть архивация довольно простая операция А в изначально виде мы получили данные из базы данных потом прописали в поле которое отвечает за архивацию и сохранили вроде бы хорошо дальше бизнес к нам приходит и говорит что ребят кажется что архивировать все объявления не имеет смысла Давайте добавим А статусы либо что-то ещё в этом роде чтобы например новые Или точнее чтобы черновики и забаненные объявления не нельзя было заархивировать мы говорим не проблема добавили немножко бизнес логики радуемся но все знают что бизнес неугомонный и всегда накидывает что-то ещё он приходит к нам и говорит у нас слишком много старых объявлений поэтому Давайте их пожалуйста архивировать мы говорим не проблема копируем который код у нас был и думаем что вроде бы всё хорошо Но в действительности мы создаём две точки Правды и так не стоит делать Почему Потому что если вы будете продолжать в своём проекте придерживаться такого правила то при любом новом добавлении функционала вам прид менять его во многих местах тем самым вы не будете его сложнее тестировать и вы можете забыть в какой-то момент где-то поменять условия тем самым получить проблему на проде А мы этого естественно не хотим поэтому определяем к каким данным относится данная проверка и загружаем её туда то есть например объявление Мы хотим его архивировать и бизнес нам явно говорит чуваки мы архиви объявление То есть это первый звоночек что действи к самим данным и когда мы так загружаем действия и кладём прикрепляем их К данным нам проще их менять в будущем и плюс можно легко покрыть тестами потому что нет внешних зависимостей и здесь Мы чисто проверяем бизнес логику и сами сам код приложения становится более читальным и можно легче определить А где Какой слой теперь хочется уже перейти конкретно к самим паттернам которые есть мы поговорили о самовару емо надо понимать что она относится к любым доменным объектам а первым доменным Объект который я хочу рассмотреть в ddd - это объект значения что это такое чаще всего это свойство либо атрибут а примером такого объекта может являться фамилия ими отчества размер цвет количество позиций товара айдини и так далее А давайте посмотрим как можно понять что вот у нас есть например сущность объявления и из него нужно что-то выделить сейчас мы на примере видим что у нас есть сценарий покупки Вроде бы мы прикрепили поведение к самим данным объявления но в действительности можно увидеть что available и Reserved можно попытаться выделить ещё бизнес с нами говорит всё время о каких-то количествах позиции мы можем её какое-то время игнорировать Но чем больше бизнес сценариев у нас появляется тем более явно Мы видим что это отдельные данные То есть тут надо понимать что метод by он о покупке Но что именно мы делаем с данными доступности и количество позиций А мы резервируется при доставке товара мы списываем резерв при возврате и при например слиянии двух объявлений мы суммируем позиции и видим то что то что мы делаем с данными и то как называется метод Какой сценарий идёт здесь они не совпадают это и есть звоночек того что всего данные можно ещ объединить плюс можно добавить несколько полей между нашими данными и заметить что между ними была Слабая связь а стала ещё слабее и поэтому пожалуйста если вы видите что бизнес говорит о каком-то концепте его методы и то как изменяется не совпадает с названием то выделяйте их в отдельный объект и в данном случае мы выделяем в обект значение количество позиций либо сейчас я хотел бы поговорить о свойствах которые есть у объекта значения первое и наверное самое отличительное то что у объекта значение нет айди ников это просто нужно принять а плюс это звучит довольно логично Что например у свойства либо атрибута нашей сущности Не может быть айдини а далее надо следующее свойство то что у объекта значения они сравниваются по значению и в Гош это сделано довольно удобно через оператор сравнения Но это можно легко потерять Если вы решите добавить указатели Поэтому в объекте значения мы не используем в Гош указатели только прям в супер критичных случаях Да если мы добавим Мы конечно можем попытаться пофиксить страшным методом внизу слайда но тут вопрос хотите ли настолько вы хотите экономить память и точно ли вам это нужно также не Используйте указатели когда передаёте аргументы в Почему ответ довольно прост если передавать указатели в аргументы метода как в данном случае мы передаём резерв 5 в метод как указатель мы можем снаружи его поменять И тем самым отобрать часть ответственности у данных и разломать эти данные и сделать их любыми поэтому не используем указатели и в аргументах далее следующее свойство обект значение неизменяемый что Это имеется в виду метод предполагает создание нового объекта и Возвращение его а не перезапись либо изменение данных чтобы это Чуть более явно отразить в и также объекты значения неизменяемые явно показать Мы возвращаем новое значение в методе и не используем указатели при объявлении метода дальше хотелось бы расширить немножко объекты значения и рассказать про их вариацию te Power micr types дальше я буду называть их типы в ЧМ преимущество Ну во-первых они объявляются довольно просто все лишь строчку и дают нам дополнительный контекст о том что происходит за счёт именования то есть мы не просто видим какой-то in а видим конкретное конкретную концепцию из нашего домена также они дают проверку типов нельзя сказать что это прям супер круто но это полезно Так как экономит нам время и нам не придется в ран тайме отлавливать эту ошибку если у нас сценарий довольно большой А в нашем же случае просто при компиляции мы получим эту ошибку а следующим и более наверное нужным свойством мини типов то что мы к ним можем привязать какое-то поведение первое через фабрику то есть мы можем проверять айдини что они больше нуля и также к мини типу можно отнести емы которые мы также можем привязать интересную бизнес логику Например у нас Мы привязали к ним статусы и мы знаем В какой статус Можно перейти и благодаря тому что это отдельный выделенный тип мы используем дополнительный нте exos который проверяет А все ли значения этого типа Были рассмотрены Это довольно полезно чтобы не пропустить все какой-то из переходов при особенно при его добавлении либо изменении поэтому стоит использовать мини типы особенно если у вас концепту который может описать ти привязывается бизнес логика теперь хочется затронуть такую тему публичные приватные поля А думаю многие в проекте начинают писать свои описывать свои данные с помощью публичных полей это Окей Хотя в идеале если смотреть на то что говорится в DD они должны быть приватными чтобы мы не могли нарушить валидацию Никаким образом в нашем же проекте мы используем публичные поля одна чтобы уменьшить вероятность ошибки мы сделали себе часть ограничений первое ограничение мы не используем структурные типы А извините структурные теги зачем их можно использовать во-первых чтобы быстро сделать какое-то представление например J теги либо xml нае теги а вроде бы звучит хорошо мы быстро поставляем выводя данные которые хочет пользователь Но что если у нас пользователь бывает разных видов то есть продавец должен видеть количество доступных позиций а покупатель А я бы сказал что резервированный он точно не должен видеть и не сказал бы точно а вообще должен ли он видеть эти данные А И если мы используем структурные теги мы лишаем такой возможности и можем допустить ошибку что выведем не те данные которые ожидали либо выведем что-то большее плюс публичные поля и структурные теги позволяют нам создавать данные наши объекты без валидации через тот же самый алинг любого энкодера и чтобы запретить использовать в своих проектах структурные теги мы используем связку в виде маг и самописец поля можно менять где угодно и как угодно как мы видим то что у нас есть количество позиций оно равное единица и потом мы записываем резервирование любое значение которое нам захочется чтобы не каждый раз не смотреть в реквест не искать Такие интересные места мы написали для себя linter Go Public Field сразу замечу что все литеры о которых я говорю они публичные их можно найти в общем доступе и в конце презентации будет ссылка Вот теперь давайте подытожим в своих проектах мы используем публичные поля потому что у приватных полей есть большой минус того что нам придётся очень много писать либо геров либо ДТК чтобы переливать одни данные на другие и чтобы убрать те минусы которые есть у публичных полей мы запрещаем использование структурных тегов за счёт связки мак и gard и тоже самое делаем только с помощью друго литера для запрета изменения публичных полей теперь хочется перейти к другому доменному объекту к сущности или Тити сущности сущность в ddd представляет себе Объект который идентифицируется не за счёт данных То есть у нас есть объявление и мы понимаем что заголовок если мы понимаем заголовок объявления Само объявление останется самим собой и это свойство достигается зачёт того что у Объявления есть ID и это наверное Одно из самых главных отличий объекта значения от сущности далее благодаря тому что у нас есть отдельный айдини А мы даём следующее свойство сущности изменчивость то есть на протяжении всего своего жизненного цикла мы одну сущность идентифицирую также как она была в начале просто меняются её поля Чтобы достичь этого в Гош тут довольно просто мы э используем указатели для этой структуры то есть при создании структуры мы используем указатели и при объявлении методов Мы также используем указатели тут всё довольно просто и если сравнить а сущности объект значения А можно как раз увидеть эти различия они оба объекта само Валиди ися но сущность имеет дишни у объекта значения его нет а и отличаются тем что сущность изменяемая значения нет теперь хочется поговорить об агрегатах либо корневой сущности на протяжении доклада я говорил что объявление - Это сущность в действительности она является сущность сущностью но корневой или агрегатом агрегат - это кластер объектов которые мы рассматриваем как единицу единое целое это единое целое может включать в себ одну либо более сущностей и также несколько объектов значения также следующее свойство агрегата заключается в том что обладает глобальным ID то есть так же как и Тити есть айди ник но он глобальный что под этим подразумевается что с агрегатами могут работать внешние системы либо другие агрегаты а продавец может э изменять агрегат например каким-то образом либо внешняя система захочет поменять Но если а внешняя система хохочет Достучаться до внутренних частей этого агрегата она уже не сможет к нему получить доступ потому что внутренние сущности не обладают глобальным айдини ком и если же нам всё-таки нужно поработать с изображением из внешней системы мы Обращаемся через дишни агрегата и работаем с методами этого агрегата и э никогда не получаем напрямую саму сущность из этого агрегата работаем именно через методы а также надо понимать а как нам проводить границы нашего агрегата я бы сказал что по немедленной согласованности что Это имеется в виду у нас есть бизнес правила которые мы хотим соблюдать эти бизнес правила могут вызываться часто либо редко и стоить нам дорого и могут иметь разную стоимость в работе с базой данных и тут надо понимать что если агрегат делать довольно большим то стоимость сохранения и получения как единого лого из даны будет довольно высокой и в данном случае мы видим что есть правило что в объявлении всего 10 может быть максимум 10 картинок предполагаем что данное бизнес правило выполняется и проверяется довольно часто поэтому можно сказать что здесь достаточно провести границу Однако у нас есть и другое бизнес правило что пользователь не может создать Больше 15 объявлений и тут возникает вопрос а Нужно ли делать супер большой агрегат который будет включать в себя продавца и всех его объявлений ответ нет потому что чтобы получить эти данные А У пользователя может быть бесконечное множество объявлений и потом сохранить всё это единым куском мы довольно сильно Нару нагрузили правила того что продавец не может создать Больше 15 объявлений лучше делать отдельно и не делать гигантский агрегат Но если же вс-таки у вас есть правило которое выполняется хоть и редко но оно всё равно должно быть немедленно согласовано и выполняться автомат то тут ответ довольно прост используем доменные сервисы и доменные события которые в свою очередь оборачиваются в транзакцию или если вам этого не хватает то тогда ваш путь направлен к cons теперь хочется поговорить Откуда же берутся наши доменные обк кто их создаёт первое чтобы мы хотели когда мы создаём наши объекты они должны создаваться Валид на слайде вы видите пример Надеюсь вы видите где здесь может быть ошибка у нас есть мини тип с ценой И мы присваиваем новую цену нашему объявлению ошибка здесь заключается в том что по факту это присвоение типов и никакой валидации здесь внутри нет И чтобы э валидация добавилась можно использовать как раз фабрике в которую жа валидацию и создание нашего объекта И тем самым лишаем себя возможности ошибиться следующим свойством которое нам даёт фабрики то что можно задать значение по умолчанию в гошкевича то при попытке к ним обратиться по ключу А мы получим панику и в ран тайме отлавливать ошибки довольно неудобно поэтому фабрики с их свойством того что они создают объекты а валидные объекты и заполняя значение по умолчанию позволяет всё это избежать плюс фабрики могут а улучшать читаемость кода за счёт э удобных названий например мы регистрируем пользователя либо даём ответ на какое-то сообщение создавая это сообщение а чтобы мы в своём проекте чтобы фабрики использовались всегда и не было ошибки с приведением типов либо создания случайного объекта без валидации мы себе сделали нте goof Link который проверяет и блокирует создание объектов без фабрики и финальное бы рассказать про репозиторий по факту это посредник между доменом и источником данных в идеале репозиторий выглядит следующим образом У нас есть метод на получение либо несколько методов и методы для сохранения этих данных в БД аэ давайте рассмотрим А когда это может нам понадобиться вообще такой интерфейс и репозиторий А в данном случае при создании объявления мы а получаем селлера проверяем например что он существует либо он не забанен потом а получаем также категорию и э напрямую используя конкретную реализацию базы данных кидаем это в БД самых Тимати ий пример который я знаю когда говорят что репозитории - это круто - Это замена базы данных но предполагаю что редко кто с этим встречался а Да у меня был можно сказать опыт переезда с одной БД на другую Но точнее мы распиливали один большой сервис на несколько и у нас была скорее замена источника данных а бд мы не меняли у нас БД осталось та же самая но поменялся источник данных и в таком случае когда вы растёте и предполагаете что у вас будет распил на несколько сервисов это может быть удобно Следующий пункт когда удобны репозитории - это накинуть кши то есть мы берм скрываем наши ши под интерфейсом репозитория и радуемся всё довольно просто и наверное более применимые примеры Когда удобно использовать репозитории то что мы можем менять нашу базу данных и структуру внутри не меняя наш до смотрим конкретный пример у нас есть объект значения с контактами где есть телефоны Telegram например Viber и мы решили прописать что они хранятся в джейсоне потом мы поняли что кажется их можно хранить не в не просто текстом а а в виде реального поля J в нашей БД После этого мы к нам пришёл бизнес и говорит что нам нужно для модерации искать конкретные телефоны пользователей либо объявления по телефону если бы мы не отделили репозиторий домен доменные объекты и данные баз данных с помощью репозитория то нам бы пришлось первое мы заводим в базе данных поле но мы бы так это сделали и далее нам бы пришлось поменять доменный код добавив ещё одно поле в объявление и начав дополнительно дублировать эти данные именно в доменном объекте фактически репозиторий позволяет этого избежать за сч того что у нас довольно удоб и в нём как раз мы и скрываем то какие данные куда мы кладём и подытожим плюс репозитория можно сказать так что они позволяют менять типы не меняя доменных объектов также изменять имена полей А переводить сущности в объект значения почти не затрагивая доменных объектов И если нам требуется нормализация либо денормализация также репозитории с этим хорошо справляются не при этом нам не нужно затрагивать наш бизнес логику И вообще туда залазить сейчас хотелось бы рассказать А что не является репозиторием у вас на слайде есть пример здесь мы видим что есть операция где мы баним и кажется по аргументам можно понять что здесь происходит бан объявления и описание причины почему мы забанили Однако если мы туда закинем ещё пару аргументов например ID нам будет тяжело разобраться А что именно мы здесь баним мы баним пользователя баним объявление и что именно здесь происходит и здесь переползает часть доменной логики часть бизнес правил именно в репозиторий и этого не стоит делать тоже самое можно сказать и про метод prom мы не можем явно себе объяснить А что мы промо что мы поднимаем селлера его объявления его картинки и здесь нам придётся смотреть внутрь чтобы разобраться а что конкретно здесь происходит и здесь происходит границ поэтому данный интерфейс является плохим примером репозитория также неправильным примером репозитория является когда мы добавляем работу с несколькими сущностями в этот репозиторий если вам нужно Да вы можете это сделать но это флажок о том что вы сделали неправильное разбиение на агрегаты И когда вы понимаете что нужно внешней системе работать независимо от того что это за объявление с его изображениями то скорее всего изображение нужно вносить в отдельный агрегат и такой репозиторий является хорошим знаком об этом Теперь давайте поговорим о как вообще реализовать репозитории в Go и какие есть особенности А первое И самое главное в доменных объектах мы не используем структурные теги также мы не используем не использовали их как для представления также не используем для работы с БД и не используем реализации интерфейсов которые позволяют сохранить данные в какую-то бш То есть например SC value для элик либо unm J и ма для чего-либо друго далее хочется поговорить Как бы выглядел сам репозиторий в сть действий явно и здесь как раз мы мам данные явно А чтобы не пропустить ни одно поле которое у нас есть в данных бш можно использовать линтер который написан внизу слайда он проверяет что все поля у структуры задано тоже самое происходит и в обратную сторону когда мы получаем данные из БД простой просто берм данные закидываем их в Новую структуру так бы выглядел получение данных он довольно прост здесь нет никаких никаких сложностей А мы получили данных и перевели их в домен Через наш Data mapper то же самое происходит в обратную сторону при сохранении Однако здесь есть небольшая ошибка пожалуйста Не забывайте о транзакциях потому что мы работаем э с агрегатами агрегаты представляют единое целое и в данном случае мы получаем агрегат объявлений и его части в виде изображений и они должны включаться а в один объект А можно соблюдать транзакции Примерно вот таким условием а оно довольно простое но мы для себя чтобы не писать этот рутинный код каждый раз написали небольшую обёртку в виде менеджера транзакции которой вы также можете воспользоваться и подрез всё вышесказанное А говорите с бизнесом на Едином языке а переводите этот единый язык Почти один к одному ваш код чтобы Новые люди в проекте могли А и слушать бизнес и читать код и понимаете А что вообще происходит в вашем домене также делайте доменное слой сильным и независимым для упрощения тестирования и поддержание проекта и следите за данными они должны быть самостоятельными то есть они должны само валидировать себя А вам для этого нужно контролировать их публичность либо использо сделать все методы приватными либо использовать линтер и мини советы объект значения Всегда почти без указателя в сущности наоборот используют указатели и их создаём через фабрики вместо аистов чтобы не получить невалидные объекты и используем репозитории чтобы работать с бш А на этом плюс-минус всё маленький дисклеймер на следующем слайде и слайдах дальше будет большое количество литературы и статей на которые можно посмотреть изучить если вам интересно И спасибо за внимание ставьте лайки этому докладу если тоже хотите себе иметь читае удобную бизнес логику И при этом я вам дал направление в этом спасибо большое это было очень круто ставьте лайки Подписывайтесь на наш канал вступайте пожалуйста в чат зала для того чтобы задать туда вопросы я в таком случае озвучу их со сцены и вы получите на них ответ для того чтобы задать вопросы зала поднимайте руки к вам подойдут люди дадут микрофон задавайте пожалуйста свои вопросы в микрофон для того чтобы их было слышно и нам и вам первый вопрос С левой половины зоны Да очень интересный доклад спасибо Как я понял вы из базы данных данные достаёт всегда целиком агрегатом Как быть в том случае когда нам нужно получить список объявлений на всю страницу там из двадцати штук Вы же потянется все картинки и всё прочее что в этом агрегате лежит это так а тут надо понимать что бизнес логика и сложные запросы на получение у нас отделяются то есть если нам нужно соблюдать бизнес правила А в поиске нам чаще всего просто нужна вся выдача мы не делаем какие-то сложные проверки или а определение того я не знаю что нужно сохранить и как нужно обновить Поэтому если у нас сложный запрос то мы его делаем отдельно через кри и возможно готовим даже отдельную Д тошку для этого чтобы вывести супер Спасибо Следующий вопрос с правой половины зала Да меня слышно Добрый день Илья Спасибо за доклад в вашем меня Кирилл зовут в вашем докладе там в одном месте появился такое слово как доменный сервис да ещё раз чуть подробнее когда такая штука Как сервис появилась Когда в ней появилась необходимость и вторая часть вопроса вот ортогональный подход к ddd там transaction скрипт его называет или процедурный подход Да там тоже есть сервисы так вот Вот чем доменный сервис отличается от того сервиса и какие у него есть преимущества или недостатки услышал доменный сервис - это ещё один паттерн в D о котором я не рассказал чем же Да можно просто сразу начать и определять А чем отличается доменный сервис и сервис уровня приложения в доменном сервисе предполагается что есть Принятие решения относительно бизнес правил надо понимать что в доменном сервисе могут быть репозитории получение внешних данных но например мы туда не тащим явно работу с транзакциями это оставляем на уровне сервиса приложения а но мы туда кладём например условие а проверку то что пользователь существует или то что он забанен и Для нас это важно для принятия решения чтобы понять идём мы дальше или нет а вот открытие закрытие транзакции либо подготовка данных для передачи в домен оставляем на уровень приложения Спасибо большое Давайте уточнение Да спасибо большое Вы понимаете меня без слов уточнение в дискуссионной зоне всегда можно обсудить можно поговорить там с докладчиком сейчас поднимите пожалуйста руки для того чтобы мы выбрали Следующий вопрос в левой половине зала пожалуйста Спасибо за доклад А вопрос был то что у нас в доменных сущностях Ну можно делать методы Вот ты показывал архив там ещё какие-нибудь допустим то есть правильно делать сначала в доменной сущности вызывать этот метод а потом через репозиторий типа его ну сохранять целиком этот объект в базу правильно да Ага Окей если так то соответственно Нам получается нужно каждый раз в репозитории реализовывать Ну большой сль запрос в котором мы все поля эти обновляем то есть в зависимости от того какое мы поле изменили А тут всё зависит от того какой ты дата maer будешь использовать А в своих проектах мы применяем да условно мам одно на другое а в hibernate либо в других штуках в других р в других языках там есть вычисление А если ты готов это Ну то есть готов написать крутой дата мапе для Гош будет супер но это довольно сложная задача а плюс ты выиграешь не так много поэтому да В текущей версии мы берём весь объект кладём его при этом делаем агрегаты не супер большими чтобы не умирать и работаем таким образом понял спасибо спасибо я переформулировка профита использования ддд в Go ведь всё-таки это пришло немножко из других языков а для себя в команде мы нашли следующие профили профи в том что мы говорим с бизнесом на одном языке то есть нам бизнес говорит о каком-то сценарии мы понимаем его и сразу переносим его в код плюс у нас получается шло расширение команды и было очень удобно когда люди приходили они например им говорят проф объявление либо про модерацию и он в коде может найти этот участок и более явно понять А что там внутри происходит если не использовать шку это будет сделать сложно Ну и плюс у нас почти весь проект Именно доменная его часть покрыта тестами юнитами которые довольно лёгкие И тем самым позволяют нам рели даже в пятницу и Возможно даже вечером с Почему вы используете ddt Go потому что это популярный вопрос я не удивлена Давайте дадим слово правой половине зала Алло привет Спасибо за доклад я хотел уточнить момент насчёт всё-таки тегов структур ты сказал что есть такая проблема что через теги можно как бы не явно например создать некорректный обект либо там соответственно его за маршалит неправильно а такой вопрос Мы же условно говоря для тех же Можем сами определять кастомные маршале на маршале и например туда внести какой-то кусок с бизнес Вот как ты говорил например мы не хотим показывать какие-то публичные поля продавцу То есть вы просто считаете условно говоря Это плохой Практик что вы например вот функцию аманга придел за затаскивает такие куски логики или какая тут мотивация Ну смотри у тебя отображение может зави СБО може завить от многих условий и Например у метода и у тебя не так много параметров которые ты можешь передать и тут возникает вопрос А как как раз эти параметры передать Как понять А в каком представлении нам нужно чтобы в этом методе это представление сформировать и в этом как раз сложность То есть ты не знаеш например какой пользователь запрашивает и ты не можешь это передать в Отлично спасибо на меня тут капсом кричат в чат что нужны ссылки на линтер Я предлагаю людям которым прямо нужны ссылки посмотреть потом в презентацию Да в презентации и там все ссылки явля точнее все ссылки на Лин являются ссылками и вы можете на них посмотреть вот это по поводу ссылок и ещё есть вопрос прото и маппинг ВТО ты говорил что это плохо Почему а я скорее сказал бы что это неудобно Именно поэтому мы используем публичные Поля это неплохо Это для себя мы не нашли удобного решения которое бы позволило нам быстро создавать эти д Тошкин попробовать посмотреть сторону кода генерации а но мы так как у нас был уже готовый проект А мы его начали сначала развивать А потом поняли что нам нужно ddd мы не смогли доказать бизнесу что типа Ребята давайте перепишем весь проект и сделаем всё приватным Поэтому в эту сторону мы не двигались и не рассматривали написание генераторов которые бы нам создавали удобные мапперы между доменным слоем и внешним внешними слоями Ага пому это это это неплохо д Тош это хорошо но мы не нашли для себя удобного инструмента и не сделали его хорошо спасибо Я думаю это отвечает на вопрос Давайте вопрос из левой половины зала Здравствуйте спасибо за доклад Меня зовут Максим Подскажите я правильно понимаю что кроме того что вы используете ддд Вы ещё используете паттерны там CS которые позволяют разделить на вход-выход данные верно именно явно мы пытаемся его у себя именно в своём проекте внедрить потому что мы видим что часть Вот как раз первый вопрос был если большие запросы Да мы именно Явно через это и отделяем понял тогда вот у меня отсюда есть вопрос Скажите насколько большой должен быть сервис что был оправдан вот этот подход с написанием вот такого огромной обёртки по сути вот всё что мы сейчас разговаривали То есть если у меня сервис он делает Просто круд насколько мне вообще вот оправдано не не оправдано собственно поэтому я спрашиваю давайте я формулируют что твоей задаче подходит DD какие критерии у задачи нужно чувствовать понимаю сер зт Да но тут надо понимать что к вам приходит бизнес он может рассказать типа мы предполагаем что там проект будет жить 2 года 3 года и тут уже это первый звоночек Почему нужно двигаться в сторону ddd далее Вы можете посмотреть Ну то есть у вас скорее всего сто подо будет быстрый первый запуск который вы сделаете через крут и далее Если вы чувствуете что в какой-то момент вам прям супер больно Либо вы начина оши на каких-то мелочах это ещ один звоночек что нужно применить D конкретных метрик я вам не назову потому что здесь очень много эвристики и всё зависит от ситуации Давайте Обсуждение Обсуждение выведем в дискуссионную зону недаром она называется дискуссионная для того чтобы там проводить дискуссии а не в зале а в зале мы вс-таки решили что вопрос ответ сессия льне поднимите пожалуйста руки у кого ещ есть вопрос Давайте подойдём в центральную часть зала и дадим молодому человеку задать вопрос Да привет У меня вопрос про ID корневой сущности Чуть более подробно понять что это такое какое-то может быть тип данных там ну чуть более подроб просто и где она создаётся когда она появляется вообще это такой же дишни как и у просто по нему можно Достучаться до агрегата а именно айдини у энтити а не у агрегата они недоступны снаружи то есть они условно являются локальными внутри этого агрегата и уникальными внутри одного агрегата создаются также через фабрики Либо мы у себя создаём Ну перенесли это на уровень репозитория чтобы репозиторий выдавал нам генерированию хоть провайдером этих ашнико была база хоть какой-то отдельный сервис либо какой-то Кипер которая это всё хранит ответи на вопрос Хорошо я поняла можно дальше продолжить обсуждение в дискуссионной зо Есть ли ещё вопросы в зале поднимите пожалуйста Руку вот там в конце зала есть вопрос Подойдите пожалуйста с микрофоном Здравствуйте спасибо за доклад вот такой вопрос Вот все эти выкладки создание выявления ти это на самом деле работа и в общем-то не простая даже слож и может существовать альтернативный вариант чтобы ну давайте мы не будем тратить столько времени вот так сильно упа чтобы всё это вскрыть мы и так уже понимаем что нам надо реализовать Давайте просто напишем код Вот с таким сопротивлением сталкивались ли вы и как его преодолевали если Да мне повезло с командой мы все пришли из каких-то проектов где были боли когда мы какую-то мелкую фичу нам приходилось читать портянки плюс не было понятно где бизнес логика где инфраструктурный код поэтому я с такой проблемой к счастью наверное не сталкивался но как бы я бы объяснял наверное искал бы проекты в интернете и говорил бы типа Расскажи что здесь Давай ты мне расскажешь что здесь происходит и давал бы примеры на и чтобы там человек и таким образом на сравнени Я бы попытался выехать и объяснять человеку Спасибо у нас есть время ровно на последний вопрос притом достаточно быстрый ответ Это к тебе про Да рассматривали ли мини типы для запретов изменения публичных полей вместо линтех и если вы думали об этом то почему передумали А можно Повторить ещё раз я могу дать тебе прямо прочитать а не рассматривали ли вы мини типы для запрета изменений публичных полей вместо литеров если думали мы отказались а интересный вопрос было бы хорошо посмотреть на код но создавая мини типы мы всё равно можем использовать приведение типов из одного к другой и таким образом спокойно нарушать валидацию хорошо но тут мне лучше показать Ну как бы я и не обязана была понять но я не поняла Я думаю что ты можешь подробнее про это с примерами кода например поговорить в дискуссионной зоне то можно меня всегда найти вот по среднему тегу а написать в личку Если хотите я доступен Да а не обещаю что отвечу быстро но отвечу Ну хотя бы что-то пообещал Спасибо"
}