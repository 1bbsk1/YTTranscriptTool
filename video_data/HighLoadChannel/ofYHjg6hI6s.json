{
  "video_id": "ofYHjg6hI6s",
  "channel": "HighLoadChannel",
  "title": "Risk Control System, или Антифрод-перезагрузка / Федор Васильев (ECommPay IT)",
  "views": 2057,
  "duration": 2915,
  "published": "2020-04-14T11:23:16-07:00",
  "text": "вот доклад мы называется риск control system мили anti-flag перезагрузка представляю компанию и компы эти из группы компаний и компаний а кстати кто-нибудь был на всех трех докладах понтифф роду кто-нибудь хоть а так вот я смотрю кстати были люди есть есть макей потом расскажете мне таскать фидбэк интересно значит чем занимается компания и компы идти и компы это онлайн processing то есть мы проводим платежи на сайтах мерчантов это традиционный карточные платежи а также альтернативные платежную систему коих у нас сейчас насчитывается там 100 плюс но это всем известный и яндекс если россия понятно что это вич от alipay если это китай там азия вот в европе из своей альтернативной платежной системе с ним мы тоже работаем вот что надо отметить а нашей компании что мы настоящий фильм тех компания у нас полный цикл разработки всех вообще продуктов которые нужны для онлайн процессинга вот собственно ядра поймут пейджа пвх финн система ну и так же вот anti-fraud сегодня я расскажу про это направление анти флот наш финансовый собственно что обычно классически считается финансовым анти фродом ну это понятно что использование платежных чужих платежных реквизитов украденной карты к аккаунту и так далее самое самое распространенное самая классическая использование уязвимости в платежном модули на сайте ли процессинге это реже встречается он тоже бывает френдли фрод это когда пользователь чет там купил на карту там неважно на нем на вкус на свой кошелек а потом приходит и говорит а ведь вообще был не я я не я корова не моя давайте мне чардж бег ну то есть возврат давайте это френдли фрод этим тоже надо бороться это немножко другие методы но мы тоже пытаемся это делать ну и методы социальной инженерии самый сложная тема очень сложно с этим бороться это прямой развод когда человеку звонят и говорят узнаешь я там представитель банка еще с и мазь придет и мне там скажи что там написано и я там чуть и сделаю народ ведется бороться с этим очень сложно вот немножко об этом тоже может быть скажу но но для нас для нас именно для нас анти фродом и вообще как бы то чем мы боремся является не только вот эти вот классические вещи но также ещё и противодействии отмыванию денег анти manila wondering m-elle как мы сокращаем это прежде всего скоренко мён такой довольно специфический скоренко мён я а также санкционные списки различные у нас поддерживаться три вида санкционных списка сейчас и комплаенс-контроль это со стороны платежных систем выставляются некие требования и еще государственных регулирующих органов но они могут быть очень разные и очень странные там например в какой-то стране запрещены платежи там с генов другой стороны там три дуги банков могут быть какие-то ограничения по оборотам по выводу по вводу мы тоже решаем эти задачи и даже иногда в первую очередь приходится решать задачи по комплаенс ее поимели немножко покажу расскажу как я вижу эволюцию финн тех анти фродо вот мне кажется что любовь не тех анти фрод проходит примерно через такие этапы и наш тоже проходил об этом там будет сначала был список все просто политика разрешения политика запрещения казалось бы ну что тут все хорошо красиво да какие бывают списке ну там где-то 40 видов по моему плюс-минус и на видов вот там это пан и это номера карт они конечно не хранятся у нас в открытом виде потому что подпись а dsm но там хэши вот бен и это первые шесть цифр карты и кишки страны индификатор и на на сайте мирча email и телефон да все что угодно вообще на самом деле может быть вот но как бы список слишком скучно поэтому наслаивается еще отдыхать слой это сразу очень хочется программируемый скоринг ограничение оборотов и борьба с подбором платежных реквизитов список слишком скучно поехали дальше мало огня мало огня надо побольше огня то уже пошла поджигать пошли пакеты правило то есть какие-то очень сложные спарринге очень сложные друг с другом связаны и правила работающий согласовано complaint с платёжных систем это я об этом говорил начали fin printing конечных устройств особо актуально сейчас вот контроль подозрительно активности реализация а м л и не очевидный fruit паттерны который мы пытаемся закрывать машин lernen гам но это как бы такой более теоретическое что ли а на практике обычно вот получается как-то вот так что там написано то может мне объяснить и подзаголовки создал правильно азбуки морзе сосны вот как бы там вот до этого ты был так вот вроде чинно благородно на практике она вот часто часто приводит к этому ладно что у нас было когда я пришел в команду анти фродо это было полтора года назад у нас был проект фрод стоп ничего плохого не скажу это предыдущее поколение программистов его написала у него выдуло такой stack технологий буквально быстренько пробежимся этапа взгляд 9 4 5 6 мин кэш rabbit and from work и 11 для админки по он php фреймворк и такой динозавр он кое где используется вот у нас тоже ну ну работает все что могу сказать вот тот же для админки это страшный сон мой я там вообще то есть после там реактор мне было тяжело очень там тот же это они не разобрался честно скажу как бы трудно было очень большие проблемы у нас были когда мы что-то пытались в админке там менять с этими это java скрипта вам библиотекой 60 типа фильтров на примерно 1000 списков и миллионы записи в этих списках суммарно и некий такой миль ну может как подобие емеля вот отложенные там через такие механизмы не очень так скажем передовые можно даже сказать чуть не совсем имели такой просто пост анализ пол ручной значит что у нас там была по характеристикам синхронная система работающие под женственных и т.п. это принципиально важно для таких систем как моя как вообще вот то что мы делаем то есть все в антифризе финансовым хотят чтобы ты послал туда запрос и те тут же сразу ответили вот прямо в этом же вы также хотите по сессии типов да или нет вот поэтому система принципиально синхронная расчетная нагрузка это 20 транзакций в секунду имеется ввиду финансовые транзакции не запроса финансовые транзакции вот это уже было и максимальной нагрузке то есть в то время когда я пришел вот максимальная нагрузка равнялась тому что это вот это вот все могло переварить вот 622 миллисекунды время анализа ну то есть уже так минуте к секунд миллисекунд секунде приближается вот и фред raid 0 2 фридрейха ты ключевой показатель для anti-fraud систем финансовых от соотношения общей суммы фондовых транзакций к общей сумме с окрестных транзакций вот он был 0 2 процента 2 промилле или две тысячных но это нормально скажем так оптимизация ну собственно все это пришел посмотрел первый день моей работы в fraps топе мантиф роде мне прилетел critical bug сразу то есть привет федор мы тебя ждали а у нас тут critical bug и войну прикольно что так бразильская система починили за тепло или там за первым деле два таких случаев было но что делать оптимизацию все равно нужно я пытался оптимизировать предыдущую систему ну просто потому что надо было время выиграть а жить как-то надо это все в продакшене там под нагрузкой 50 основных иску или запросов были ускорены 10 там переписаны просто нормально да для некоторых был создан индекс недостающие и 3 просто выкинули ну договорились заказчиком говорим ну под запросам там ваще адские то есть он там выполняется 500 миллисекунд а если их много то там вся база ляжет там томом и вот по-другому сделаем то есть работает да конечно давай по-другому предложи как я предлагаю делаем она работникам очень быстро то есть вот эта вот часть работ и заказчиком что иногда можно что-то объяснить что это так плохо по-другому будет лучше отважная довольно часть это было проведено стало лучше там сейчас будет потомка насколько вот добавлены были слои вы тут все понятно скалирование чтения изоляция некоторые запросы друг от друга пришлось точить движок не просто это было пришлось ну справились но больше не хочется чего был безнадежно админка я просто то я немножко упоминал но там какие то изменения в носить что-то делать там господи боже мой ну приходил сделали но тяжело система отложенных заданий тоже то еще те еще дебри и sharding я просто не но просто не придумал как мне sharding этот движок строить я пытался новый выше моих сил было какие были результаты оптимизации значит у нас отмасштабировать это все до 100 вт до 100 транзакций в секунду сейчас такая примерно нагрузка в среднем у нас идет по photoshop тоже он по старой системе он тоже сейчас production еще две системы в продакшене вот и он сейчас держит нормально и у него время анализа 312 миллисекунд сейчас принципе неплохо но как бы есть и плохие моменты значит более наши устаревшие технологии пытались обновиться до 55 йорке на семерку на php но там было трудно решили что вот лучше уж новую систему дождемся старую пока оставим как говорится золотое правило админ эксплуатации работает не трожь вот так вот поступили недостаточная гибкость особенно в админке то есть самая система то ничего так можно там было развивать и фильтры все что угодно вот в админке очень тяжело достигнут предел масштабирование все я не знаю как там дальше масштабировать особенно на запись потому что сортирование не встроить вот морали устаревания компонентов тоже понятно но и отсутствие синхронной машины арлингана это очень хотелось можно было бы имплементировать но в совокупности со всем остальным уже не очень хотелось и вот вы видите что просвечивает вот это вот клякса вот который там было с подписью сос ну вот что-то оно такое вот уже наклевались а может быть даже и вот это окно мы что мы мы хотим танцевать то есть у нас очень быстро ну на первой неделе моей работы собственно в команде родилась идея штампа чтобы нам не замахнуться на вильяма нашего так скачет шекспир ну чтобы не написать новый система просто почему нет вот требования что нам надо было сделать это переварить десятки миллионов запросов в день новая молодежная админка гибкость настройки правил скорость анализа максимум 100 миллисекунд finger printing устройств их здесь эры такой дата-центр реплики шину так называем и машин learning рождение нового проекта значит тут история забавная ну вот что у нас было видите на слайдах как бы там мне все говорят у темного драйву команда много драйва решил должна слайд вынести типа нас много dragons вот кстати да вот это вот что это настоящий скриншот из телег this телеги когда мы обсуждали название проекта в принципе известно это фред kia известны точные тайминги появления название там потом буковка его летает остается rcs рис control system и вот даже вот там минуту известны когда мне это светлая мысль в голову пришла в результате стал названием новой системы тогда еще только задумывались о том что ее надо писать это ещё ничего не начато просто вот ну что надо сделать самые первые когда у вас есть принципиальное желание написать новый продукт про не придумать название же правильно вот там благим забавная маленькая история когда я подготовил архитектуру концепт буквально в пару страничек в конфликте ну совсем так об общем емнип отзывается один из наших рядов и говорит федос уж пойдем в кулуарах поговорим о тебя там ждут продукту будете делать там по посоветуемся . да да конечно пойдем захожу в переговорка там сидят все наши идти в директора голова помой говорят федор но чего мы тебя ждали презенты нам новую систему я только это как на экзамене себя почувствовал которым ты никак не готовился души и она говорит что я не готов это вообще не комильфо ну вышел с умным видом рассказал показал эти тантре архитектурных даже не слайда 3 архитектурных съемки до рассказал все довольно долго подробно много вопросов не задавали все обсудили но и в конце мне сказали федор хорошо дерзай поехали первое что было придумано или такой проработана это собственно hdsl кто значит куда sl в принципе ну немного dsl и это domain спецификой будь то есть это некий язык на котором удобно описывать ту предметную область и как бы манипулировать ей тем людям которые занимаются в данном случае это наши риск аналитики замечательный то есть от язык для них не для меня не для программистов а для риск аналитиков вот это первое что было рождено он сначала там первые драфты были были не такие то есть ну как это всегда бывает потом это обсуждается вот ну я не буду так подробно останавливаться это такой интерактивный языка собственно из безе туда вот тут принципе так более-менее все понятно читаем а вот из основного ну пожалуйста это отметить что тут такая вот интересная штучка как аес ф applications that function там дальше об этом будет вот это вот project пан point blank own это вот как раз она посмотрите на него потом дальше там будет с ней пример вот в общем язык был написан для риск аналитиков новый технологический стек ну тут интересно то есть ну во-первых очевидно 72 php ну или большую часть 72 используется на продакшне без фреймворков без фреймворков но чтобы сэкономить время просто собственном не фреймворке там не особо нужны мы используем кое какие маленькие библиотечки там слуги фай какой-нибудь ну что не совсем маленькая не тяжелая но большие серьезные развиты фары марки мне не нужны у нас написано как бы свои генератор to move the close of data api такое джами ближе я вот до этого занимался джавой потом перешел с php такое тоже бывает ну как бы не нужен нам бывший морг я считаю что я сэкономил сэкономил на этом определенные миллисекунды за который мы так боремся первомайское как может быть вы видели на предыдущий системе использовался пожгли ничего плохого пор пожгли сказать не могу нравится мне и перк он нравится мне и мускуле пожгли честно ну у нас идет некий сносит нас в сторону mais quel а большинство продуктов нашей компании на майскую или построены нашей башни ки любят большим mais quel они говорят что его проще отменить проще эксплуатировать они в этом правую в общем то на мой взгляд но при этом он полностью покрывает все наши за а че по крайней мере на данный момент поэтому мы сейчас используем мой сколько почти во всех проектах в том числе вот в новом тоже решили его использовать тарантул я честно хотел использовать тарантул вот прямо могу поклясться на книги которые будут дарить там да вот но так получилось что у нашей компании был негативный очень опыт общения с этим продуктом он там в продакшене нюся хорошо павел там по чьей вине это сложный вопрос на background уже был такой вот я поговорил еще с нашими тех специально с теми людьми которые эксплуатировали у нас поговорил с другими людьми из других компаний которые тарантул имеет на проводе и в общем я уже начал зло примирятся я там сейчас на реализуют этот dsl наш прям в лось сделаем красиво быстро будет ну как бы все молодежному но на общем в результате от тарантул пришлось отказаться просто по соображениям убоялись мы что ненадежно все будет работать поэтому нет поэтому редиса причем radisson изменил роль то есть если тарантул это был бы какой-то такой application service data есть ну то есть что-то такое более серьезное а пока php был бы в каком-то глубоком бэг-энде то редис нет родиться это просто стал кашира еще слой причем кашель число локальные об этом будет сказано когда будет архитектура очереди в базе не буду останавливаться в апрельский плохо 57 не поддерживает на его можно хорошо эмулировать есть кому интересно потом покажу просто после вот бьют же с ю материал хотели попробовать я сам хотел попробовать но я на до этого писал на реакция а вот юнит многие говорят you быстрее разрабатывать как бы быстрее на нем я хотел попробовать но не попробовал то есть результате записал мой программист я ни одной строчки кода в объеме написал до сих пор и хотя мне даже прям ticket и были в жире там фёдор вот ты должен ознакомиться как устроена твоя админка вообще на вьют это шепотом если что я такой да да да у меня там время выделен ну просто задача выталкиваются более погряз в бэг-энде короче говоря питон ну понятно для чего питон где машин learning концепция sf быстренько publications that functions что ценно я сам придумал это вот второй этот ролик хранимых процедур собственно по названию надо же понятно ну суть в том что это охранник только наоборот все в этом публикациями в том числе самый scoin сам важный момент что должно быть оптимизирована программистом он головой блин отвечает за то что написала серьезно и проверим тестером но он тоже чем-то там отвечает вот ну тут некий это прямо из документации по сути цитата на там немножко podrick томный чтобы было удобно смотреть ну вот примера с их функции как раз вот той которая была рассказывает дальше тут особо подробно не буду их довольно много они разные специфически вот у нас есть библиотека сейчас их там штук сто шесть штук вот они там делятся на несколько типов ну вот тот который 7 из 2 штуки тут который предыдущие она как раз к этому классу относятся ну это вот какие-то основы оборот какие-то сложные вычисления они такие ретроспективные в прошлый идут вот от всего момента и в прошлое вот аналитический управляющие трансформирующие особо не буду останавливаться это часть ds эля нашего который знает сердце так архитектуру данных 9 темпы et impera я подписал это значит что это значит им знает до разделяй и властвуй это выйти низм как сейчас говорят собственное to count ну легло в основу архитектуры данных у меня что у нас есть значит как мы делим как мы сплитим данные прежде всего у нас есть так называемые cold и ход дата это условное название ну так чтобы нам ориентироваться они на самом деле являются от табличками в одной и той же семье просто разными в одной много записи в другой нет ответственно в комнате хранятся в несколько месяцев и вот я забыл сказать важное речь о транзакционных до данных так называемый пойман да то как мы это называем но это вот запись когда транзакция идет это вот все что они известны вот значит сначала запись идет вот так сначала приходит inspection request от мы так называем запрос на анализ так сказать фрод не фрод пишет данные в кол дату там автоинкремент найди потом записаться вход дату вот соответственно приложение зависимости от того как когда идет аналитика приложение знает куда ему идти фонда только о dat когда идет агрегация если агрегация длинная то из-за длины промежутка времени нужно он идет в калл дату если за короткий а так бывает чаще всего именно так подобраны интервалы он идет ход дату понятно что есть некие а нет непонятных надо остановиться вот хранить все все данные за все время вход дать нельзя потому что она разрастется до там миллиарда транзакций и довольно быстро на самом деле там в пределах года вот и это все нафиг во-первых диски кончится во вторых тормозить будет жутко 0 то много и в этом нет бизнес потребности то есть пока мере у нас мы с этим не сталкиваемся чтобы была такая бизнес потребность данные через некоторое время переносится вайс house в ледник откуда могут быть извлечены но не applications специальной процедурой довольно медленный вот но если надо будет какой-то навести гейшами проводить финансовые то можно поднять данные такого пока ни разу не был на моей памяти но это возможно вот период данной которыми идет оперирование они вот ход до тикал дате но есть бы копнуть бэкапить бака тут все понятно как еще мы сплитим данные мастер да без мастера как бы ничего да альфа и омега но нужен слоев потому что кликухи много читают некоторые вещи можно читать со слова некоторые нет там понятно что с инициативно к отставанию но часть запросов можно смело оттуда читать какие нельзя ну читаем с мастер там кое-какие есть прием еще улов как это обойти но я не буду об этом в этой презентации рассказывать 2 slave каскадный для совсем фоновых процессов каких-то там агрегатов которые не в реал тайме которые складываются на будущее мониторинг и дамп но как бы понятно надо же как-то нам расти по записи сортирования наверное это такой вопрос я не знаю на миллион долларов войти про универсальный функцию шарди рования вот как кто изобретет универсальную функцию шарди рования чтобы все всегда хорошо работала тот наверно мне заполучить какую премию там мы ничего не изобрели с расскажу вот у нас ситуация довольно простая у нас sharding просто естественным образом уэст проистекает из предметной области и того как мы обрабатываем данные это всего-навсего мерчанта где то есть у нас родирование идет просто памир чем ну тут условно там 100 больше меньше на самом деле там немножко не так но это неважно суть именно в этом потому что большинство аналитики вот этой вот real time ago и она в рамках мирча всегда есть исключения но для этого есть агрегаты отдельные которые сбоку стоят вот но в основном в основном это все идет рамках мирча вот зачем нужен редис редиска нам нужен для списков на самом деле оригиналы хранятся mais quel и но тоски чтобы разгрузить mais quel ну еще + кэш такой до быстренький мы поставили редис и apple kumho читает данные опасно списков со локального редиса используя зацеп такой механизм очень удобный вот и вот собственно тут можно увидеть как это примерно происходит score там имя списка tab федор допустим надо на нем попробовать найти и она возвращается вот-вот score как раз это int число - в нашем случае этот экспорт м штамм то есть время истечения элемента в этом списке то что они могут быть не вечный бан и какие-то временные вот если сравнивается сноу и если как бы больше то значит еще не истекло если меньше то все уже истекло и мы считаем что нету элемента в списке тоже довольно просто неплохо разгружает базу потому что ну а основную базу потому что у нас много обращений к спискам по понятным причинам системной архитектура кратенько из интересного у нас две линии blue green диплом он так называемой то есть тепло идет на оффлайн линию вот в данном случае 2 ну зачем это сделано пускается маленький трафик на второй линии 2 процента у нас из двух процентов начинается и если что-то вот не до тестированы ли как это вот ну не совместимого лишь то что называется то мы теряем вот эти два процента трафика только не больше и сразу монету а сидит мониторинг они уже у них есть инструкция они мониторят новую линию вот эти 2 процент трафика смотрит как идут транзакции чего происходит если все нормально процент потихоньку повышается и все переливается на линию 2 вот apple кух у нас сейчас на самом деле там по моему 64 но неважно у них вот эти локальные редис по которой говорил оффлайн он отвечает за все очереди в том числе в очереди наполнение актуализации того что лежит локальных хадисах а также очередь который раскладывает эти рубаки этого программы на нашем ds или диплом о да понятно для тепло и у нас все сиди дженкинс соответственно этот как его паппет вот в диплом сможем хоть десять раз в день но конечно этого не происходит на в реальности внутри тепло и в неделю происходит в пятницу не диплом но опасно всем понятно вот админской apple kumho тоже все понятно но эмаль но даст с то про машин лирник все крутится вокруг mais quel а он как бы является сердцем этой системы зачем нам и мы вопрос с одной стороны простой с другой стороны ну не знаю но мы сформулировали задачу так необходимость выявления скрытых врат паттернов в традиционном потоки дело в том что с определением так сказать фронт паттернов которые нам известны нашим риск аналитиком все хорошо потому что они все описаны еще во frost appeal is fast опытом мы их импортировали в рцр cs вот какие-то новые фронт паттерн и появляются их тоже описываю то есть люди не зря свой хлеб взять это все есть но вот когда какая-то такая штука которая человек не может быстро понять и так сказать описать то тут там мы так это наше наше предположение мы можем тут попробовать машин learning ну шо у нас да и папа индустрий положительный опыт для наших задач ему порешили ну а чё нам не попробовать вот да там так была смешная история тоже что но я на корпоративе летнему под под отхожу к ярославу сагану это на глава нашего аренде с бутылочкой того что обычно пьют на корпоративе и говорю я росла и росла говорю я тут новую систему делают куда 2 я знаю знаю вот слушай мне тут нужен машин learning откуда да я даже договорить по-моему не успел том что я хочу чтобы ты мне помог тон из них машин learning and века водку я согласен конфигурация хорошо что вы до круга поняли ну пошли к боссом боссы сразу все это одобрили ребят дерзайте это хорошо так что машин лирник делал не я я скорее как выступал как заказчик координатор интегратора то всего мою систему лучше у нас была сильно ти как их разнородные данные сравнить небольшой data set for the reported mps от самый важный пункт у нас есть фродо report поскольку мы являемся так сказать партнером платежных систем международных они нам приходят а нам говорят вот эта транзакция фродо во я тогда тоже продавая но на этом собственно нужно очень можно учить можно и нужно учиться мы выбрать для себя индекс к от boost потому что для такой задачи на наш взгляд он подходит на понятно что там с градиентным бустинга мы потеряем решение все как обычно вот что мы сделали ну datasette из наиболее проблемным трафик резко аналитики прям специально отобрали там по критериям вот это вот это вот это около 50 фичей в результате мы оставили вот две миллисекунды анализ по готовой модели это сейчас в продакшене вот ну там плюс еще badger писи там про добавкой задержка там 5 получается миллисекунд под полностью как сходить и вернуться это важно потому что я вот был я поборюсь за скорости и мне очень было важно игорь ярослав а быстро будет работать им когда я не знаю горит еще попробуем мы попробовали получилось быстро вот и переобучение раз несколько дней сейчас этот имели на продакшне он работает но он не declined не не rejected как мы говорим и своим reject am когда фрод система говорит что это фрод считает что это фрод он не rejected но он все свои он запускается вообще во всех абсолютно глупо kohana всех транзакциях и просто блокирует ну то есть вот я считаю что это фрод от у нас специальная ложечку лаги руется потом сейчас происходит как раз тот период когда резко аналитики эти транзакции вручную прям реально многие и там пол вручную смотрят и думают ну вообще как буккене окей то что мало ли как оно там обучил сейчас происходит это cs то есть мы учимся корректировать модель пока пока очень хорошие у нас показатели я их не могущество публиковать потому что но они ещё пока не официальные но пока нам нравится пока нам нравится как он подчищает трафика именно эта роль у него бабла было для него выделено в нашей системе вот так кровь дата-центр applications что такое красота центре кто знает что это такое а кто не был на докладе же не кузовлево тоже диком пойти и вот он как раз рассказывал про кросс дата-центре плетей шин как у нас в других проектах это делается я про свой в просто в двух словах скажу но на самом деле похоже похоже по отношению к тому что было у него значит работоспособность случае аварии имеется виду дата-центр затопит 2 будет работать географически разнесенные dc но чтоб ближе быть просто элементарно к пользователям но приятней платить например с кенгуру были ну там из австралии из-за из сибири да вот грусть и бери приятнее платить в сибирский дата-центра из австралии в австралийский вот это способ горизонтального масштабирования почему нет так есть что мы делали это актив актив это обязательно потому что ну зачем нам держать оборудование этому в бэкапе ну нет вот и вышел консистенсии то есть это согласованность в конечном смысле почему так потому что иначе не будет работать чем-то надо жертвовать мы пожертвовали именно этим но согласованность протоколом должна быть гарантирована то есть пусть в конечном смысле пусть через несколько секунд или минут но должно быть одинаково вот репликация пакетами на уровне приложения под и простых это т.п. пакеты и полные просто отправляются выход т.п. и political оставляет венцы ну собственно тот кто последний менял какие-то данные считает что он и прав некое упрощение номер жить там нереально то есть я обдумал об этом чтобы там по полям как-то мин нет это там надо все хранить отдельно слишком будет дорого в наших архитектуре архитектуре появляется дополнительная но на и где sure not они взаимодействуют на самом деле токс друг другом чтобы никого другого не трогать 1 у нее у них там на что да вот над сказать что появляются настройки mais quel и ну стандартный довольно настройки для мульти мастера чтобы точно и кишки не пересеклись да вот пока ттп в 1с поток сейчас все это работает и есть локальные очереди на выход то есть очередь о первых дата-центра во второй и наоборот и они обмениваются в такой схеме если несколько дата-центров то будет топология звезда то есть будет каждый каждому рассказывать в принципе ничего сложного сейчас вот прямо сейчас мы запустим в процессе запуска именно этой схемы на природе она хорошо себя показала все работает напротив вот пока не запускали not конференции как-то не хочется запускать как пока я тут могли что наверно на следующей неделе в запустим уже полноценным мониторинг системы но три волшебные слова кабана prometheus графа на кибо на для бизнеса и просто логов он упадет подстава sixer чем prometheus grafana ну что тут сказать я наверно скажу что я считаю что мониторинг системы такой верхние уровни вы должен быть бизнесовый вот и у нас пока есть у нас есть буквально десяток наверное вот таких бизнеса вых метрика то самое важное такая вот прям по которой все видно на самом деле от средние время анализа вот если вдруг что-то не так не завис диском с памятью сцепу то с чем угодно сразу видно вот серьезно прямо моментально видно что начинает ползти или прямо взлетает поэтому это очень я всем рекомендую использовать именно бизнес метрики а потом когда уже по бизнес метрики там есть какие-то триггеры ты уже увидел что что-то не то идешь уже там zabbix который у нас тоже кэш есть и уже начинаешь смотря да там что-то с диском там нет имени с памятью не хватает чего-то тестирование то же самое на самом деле особо важно что теста бизнесовые наши то есть ра замечательно пишет бизнесовые тесты до программист к этому отношение вот именно к этим тестом не имеют отношения это так принципиально сделано вот этот юнит тесты на концепции бизнесовый то есть он генерит традиционный поток такой похоже вот на то что реально происходит и провоцирует какие-то действия со стороны системы например посылает 4 транзакции а 5 такая чтобы вот эти 4 далее следующий reject ну так чтобы так устроил пока соответственно который тестируется так устроен что он должен дать реджекты проверяет по факту да или нет ну там более сложный кейси их там больше ста вот это же и есть наш регресс дальше тут ну ничего особо интересного мы я попытался tdd ну то есть ты здравень дизайну никак нет не получается у меня это делать честно скажу не могу описать сначала тест потом потом не тест вот но все остальное там довольно стандартно и так ближе к концу к итогам на что-то х новой системы красненьким понятно выделено новая значит синхронная система работающие по джейсон их и т.п. тоже самое все то есть тут ничего не изменилось вот расчетная нагрузка сейчас я ее оцениваться него и мы не права не проводили пока теста такого скажу честно я сейчас оцениваю что выдержит вот то что мы написали 500 транзакций в секунду на 2 дата-центрах вот было двадцать транзакций в секунду когда я пришел время анализа под нагрузкой 65 миллисекунд это в пиках то есть это средний там вот вы видели там 55 и так далее вот было 622 фродо raid 0 17 немножко улучшилась но это не даже не на не по моей не моя заслуга резко аналитиков нашему тоже приятно вот синхронный машин learning немножко о нем сказал сейчас он на стадии так сказать опыт на как это называется испытаний в общем почти почти он скоро начнет reject этим их на большие надежды возлагаем finger конечных устройств ничего не говорил потому что время ограничено это вообще цела доклад на делать и плюс не все хочется светить сами понимаете все таки машине вот их здесь r вот вот допустим да кстати графика моя вот это я нарисовал я вообще рисовать не умею серьезно это не думайте там я на бумажке чет я сидел какую-то задачу там думал что именно бумажки чисто машинально там это rcs а потом смотрю да блин прикольно короче повесил там на доску у нас а вам думать чуть в пресс не вставить сфоткал очистил ставил нормально красиво почему быстро сплит данных по максимуму это самый важный пункт на мой взгляд еще можно распылить но это следующий раз наверное не пишем лишнего в php про это тоже хочу сделать доклад реально хочу сделать доклад на какой в конференции может быть даже на этой вот но тут просто коротко не расскажешь играем фреймворке это следствие с предыдущего пункта жесткой review оптимизации сквозь бойцов вот это вот хороший пункт нельзя забывать о том что программисты и блин любят забивать на оптимизацию нужно чтобы до башни ки гоняли да и сами они до к этому должны относиться к 1 review и прочее не сохраняем медленные ru пакет просто программно делается то есть если кто то пытается сохранить рубок в котором он вставлял товару пока тут наши технострой программы вот эти модели на вставлял фиг знать чего миллиона можно вставить много как бы до проверок он при сохранении прогоняет внутренний тест который трафик льет на уже транслированы транслированы программу если там медленнее чем определенное значение том как я не буду сохранять вообще то есть как бы давай чуть там обратись там разработчика пусть счет оптимизируют или сам подумай вот параноидально мониторим бизнес логе то есть что-то начинает работать медленнее надо смитти смотреть почему что случилось и такое происходит его могу сказать что сейчас там у нас там один из бизнес метрик там стало перцентиль тех которые за меньше 100 миллисекунд что-то упало вот я не знаю пока не было времени разобраться вот но так сказать это довольно важно спасибо вопросы с вами был фёдор васильев и композите да еще пока готовится микрофон тондо на правах рекламы ярослав про которую я упоминал он буквально за мной будет в другом зале читать доклад своим другом николаем прогиба us как склизко скрестить клик house сгибай-разгибай да так что кому идти мы интересным пожалуйста спасибо большое за интересный доклад у меня просто повод поподробнее промышленные лимит можно то есть у вас как идет там мочевая обработка идет да вы ставите там в колоночки плотный вот потом человек там проверяет как то так вот меня или онлайн вы принимаете решение значит смотри вопрос про то как модель обучается так ли мне не обучается а именно модель уже обучена china но вы как принимаете решение в онлайне в рот не фрод или тогда вон ранее борода ей посылается сигнал это дерево оно отвечает считает она фродом или нет вот соответственно на вход и модель нужно подать до навечно тогда соответствовать и 50 фичей поддаются 50 вич и эти фичи вы когда подготавливайте они прилетают к нам spain пейджа то есть когда идет платеж то есть основная система ртс его получает из внешнего мира знаете да если что-то надо обогатить оно обогащает такое бывает ну из своих внутренних ресурсов так сказать и отправляет от асинхронного черепа джерси в машин learning дерево для вот этого анти рода у вас нет алгоритма например нужно предыдущий там сто тысяч транзакции обработать что принять решение фрод оленев рот такого алгоритма вас нету и не планируется не я не понял но когда дереву часа научиться на выборке не но на абабуа она обучилась пришла новая транзакция вам нужно принять решение в рот от релиф рот соответственно чтобы по данной транзакции сделать решение нужно посмотреть предыдущие 103 тысячи транзакций для этого мерчант айди у вас есть делает собственно делает основная система как раз вот этот вот агрегационную такой анализ real-time это делает основная система не машины урану вот то есть транзакция приходит и у вас там агрегат строятся и 50 фитиля не это как бы последовательный процесс и сначала идет обычный анализ вот вот эти рубаки программы там вот функции встроены их много на самом деле там от синтетический был рубок чисто показать искать возможности языка а в реальном в реальном в реальных руб а как там там 100 проверок и там из этих ста проверок 50 каких-то грига ционных функций вот как вы назвали типа а посмотрим ничего там была у этого мирча у этого там payment method и там за последнее время и сколько там был рекламе скоков родов и там типа если вы прям в программе написано если больше 5 то там reject или если будешь пить это скоринг какой то начинается вот эти агрегата вы заранее строить нет нет нет большинство нет большой не большинство его real time i was быстро потому что в регистрирует внешне они как раз не родись они в майской москве или и они быстро потому что там есть индексы и там все заранее уже с оптимизирована то есть это мне это непроизвольный запрос из но там просто если строчек будет например 10 тысяч то яндекс уже по 10000 строчек не очень хорошо будет работать что у вас там строчек немного и так понимаю да обычно большому галич до в большинстве случаев действительно идет очень хорошая фильтрация и поэтому строчку действительно как правило немного это одна из задач которые надо было решить давайте дальше спасибо выиграл сюда пожалуйста да кстати и прости прости книжечку ты че там книжечка еще положено будет за лучший вопрос ну вот да вопрос такой велась ли параллельно разработка новой системы старой ты заработал насти старое а то есть вы взяли на себя риски что если с новой системой что-то пойдет не так то есть да все верно такое мы же риска control как бы поэтому дата команда я вам больше скажу сейчас две системы на продакшене то есть они обе то есть но здесь находят друг друга сейчас есть новая пытается догнать старую не она уже перегнала даже а смысл тогда старую систему держать деление на мы у нас есть компоненты старые в которой которые не умеют ходить научить ему там нужно писать это все их будь скоро отключать поэтому это как вот на такой прицеп некоторый то есть я насчет готовится этот лица будет постепенно уменьшаться она уже уменьшается там оцепили там слои в дополнительный который был там он уже не нужен стал потихоньку ресурсы у нее забирают до система старой она уходит в историю я снова спасибо давайте тут тоже хотят люди там много вопросов это приятно раз ты просила за доклад и у вас теперь старая система работает параллельно основа это хорошая то что вы сказали о том что ваша старая система на вашем трафике видела 0,2 процента а так ваша новая система видит 0,17 процента так и вы понимаете что вот эти три сотых это же но тоже неудач по моему рождение наоборот но как же наоборот ведь так то один тот же там было так каждого 500 нет здесь важно соотношение то есть чем меньше соотношение чем лучше нинея вы не по не может неправильно я не программер неправильно сказал это то что уже прошло через нас mps признала фродом то есть то что мы пропустили понимать да и чем это меньше тем лучше вот она недостаточно четко проговорил это вот по распределенность у вас правильно понимаю что паша ингу распределяется в нормальном режиме то есть один не очень всегда идет на один да да ну точно на самом деле на шар дениска мир чей то есть не одни у него да да и не очень-то идет на всегда идет в конкретный шарда не имею ввиду конкретно еда дата центра я в проценты нет нет на ну хорошо есть вот если говорить про нашу систему то нет и у вас есть те несколько секунд возможных за одежда будет какое-то время платит 2 раза превышают ваши лимиты да то есть вот этот момент постоянно спрашивают кстати вот как вы там совершая костин снасти когда если переключился платеж там садовода центр на другой это это заложены в риске просто вот реально то есть то есть мы просто готов рискнуть этими деньгами потому что и после по-другому делать слишком дорого а процент вот таких транзакций когда там перри переключений во-первых трафик когда идет реально в нормальной ситуации мы за трафик не отвечаем мы стоим за платежным гейтом который крутит трафик от в него это все вылетает но когда у него все влетает идет в нас напрямую то есть но если вот так отвечать при в принципе то да эта проблема есть она больше не наша get out но готовы с этими риском мириться атакой все специфический вопрос как вы сейчас с тем что бен и стали там 9 и 11 значные ну это не бины и in и стали да и на длины они 6 узнаете сейчас у нас у нас эти в списке они универсальны и надо сделать и инов да пожалуйста не ухудшило а список генов у нас есть старые нет понятно что вы когда определяете платеж по старик текущей платеж определяйте банк все хорошо а когда надо стать платеж постави кати которые возможно поменялся банк ваши выгонит же системы онлайн получения денег да вот соответственно поставить кати может поменяться в банк множество меня отсюда но вы об этом не знаете ну вот я просто к тому что к ним я никак я не готов на это ответить я не мне менеджеру именно вот таблицу бинов мы это же получаем ну а еще раз вас вы получили карту 2 месяца назад вы в этот момент определили банк вот открыто информацию остался только бил шесть цифр банк ну я так скажу если честно в в антифризе бен это такое ну да да они там к вспомогательный фактор у нас так привет спасибо большое за доклад hotels во-первых спросить про сортирование shard ключём выступает мерчант айди нету ли при этом перекоса соответственно по данным в пользу более конечно соответственно оборотистых мерчанта чего-нибудь затем делаете сейчас на данный момент нет то есть мы просто просто знаем какой трафик умер чей и вот примерно так руками и что только так сейчас тогда стужи 100 я думал об этом тоже есть с такого клетка потому как бы там просто на мой взгляд логичнее пакоста миру сортировать но это нет нет как выяснилось нет мы тоже такая то что кричал хотел но потом так смотрели на ти агрегат который нам будут нужны именно в почете нет окей из туда же валакаса миру там друзья бумагу табак добавить у нас такой час проекте спирс он называется это вот как раз она это вот даже не совсем кастует человек некий да и это отдельный агрегат вообще отдельный который обсчитывается как человек то есть как он платил как и платежный место всех мячей так далее это вот этим решает сейчас мы это в проекте ну может расскажу когда не об этом может быть ты уже ответил на мой следующий вопрос хотел спросить как краска 100 мера проверяют вот условно говоря на одном мер чемпион западу от этого дома этот персоналом для и finger printing учитывается естественно ну понимаете и еще вопрос про пост обработку условно говоря есть платеж который не попал в вов рот по поводу все 0 17 процента при этом как бы дальше есть вероятность того что мтс пришлет чем бег по нему на коне так и происходит всегда остается если какая-то автоматизированная обработка есть до автоматизировано оборота к есть эти списки выгружаются проходит через 2-х мы забираем их из 2-х обновляем а назвать и что это фрод п.п. называется mbps фрод флаг и все мы знаем об этом машинное обучение получают выгрузку обучается на линии я немножко не о том это когда списке от mbsa прижали а до того как прийти списке чтобы не попадать начать бег что-нибудь такой или это только риск аналитики жаришь к аналитике решают надо с этим борется до собственно борьба с church bk метод а зачем нужен мантиф рот может я не сказал об этом надо бы стоило да да конечно время на вопросы кончилось на находитесь вы сможете все обсудить дискуссию они зоне как мне надо вручить да и тогда нужно вручить лучший вопрос но выбрали но мне все понравились давайте я наверно это уже у вас тоже подаете 2 дом подарка можно конечно хорошо его давать вам я вручу вот это вот прям меня так попали в тему она платная а так порой да где он так иди сюда вот модуль в белый так сказать и что это как называется все мы вас тоже поздравляем спасибо спасибо так и самая главная это мы вас благодаря спасибо большое за ваши труды и вклад передаю привет всем кто смотрит трансляции виде всего доброго"
}