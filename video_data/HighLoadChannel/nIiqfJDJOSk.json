{
  "video_id": "nIiqfJDJOSk",
  "channel": "HighLoadChannel",
  "title": "Новые возможности выполнения запросов в Postgres 10, 11 & PostgresPro / Иван Фролков (Постгрес Про)",
  "views": 2954,
  "duration": 2865,
  "published": "2019-01-14T00:12:44-08:00",
  "text": "я франков и вам компания по сгрыз профессиональной наша компания занимается разработкой коммерческого варианта под греться ну и соответственно плотно работает с публичной доступной версии как может быть вы знаете новый релиз скажи каждый новый релиз выходит где-то в сентябре октябре и этот год не является исключением соответственно в сентябре-октябре мы ждем новую версию postgres 11 на самом деле я конечно много смотрю что стоит у людей очень много еще люди остался старыми версиями так что даже возможности десятой версии нередко недоиспользуются вот сейчас уже выходит 11 над сказать что особо революционных изменений в ней скажем так есть nordic скорее тектонические где-то внутри и снаружи пока не виден начнем снаружи виде но особо не проявляется соответственно а также изменения пока на первый взгляд в основном эволюционные есть куда расти есть и понятно что дальше будет меняться что будет происходить она на текущий момент я вам расскажу что у нас появилась в 11 версии и то что мы наша компания хочет добавить в нашу версию и что возможно войдет и соответственно в общедоступный вариант итак первое что у нас появилось вот к сожалению я не глядя приют применил шаблон который мне прислали представители поэтому я заголовки очень маленькие получились и это обнаружил уже довольно поздно обратил внимание вот у нас первая возможность самая такая яркая это jit компиляция теперь можно компилировать запросы в не посредством машинный код при подготовке запроса на что он компилируется выполняется где это может быть использована это во-первых ну как я вижу к указано в условия веря в также tlist это список колоночка который у нас получается все ли где это агрегаты это выборки из собственно строки projection то есть когда мы не всю строку выбираем определенные колоночки вот то пол ди farming это тоже разбираемся с тапком дело в том что в подгрести из организации данных конкретно из-за ну love доступ время доступа к кого какой то колонки зависит как ни странно от количество колонок а там находится перед ней в принципе времени большое если у вас колонок меньше тысячи можно этим пренебречь бугай я не знаю о есть как больше тысячи колонн очка таблица вот пожалуйста зачем стать из не секрет ну да всякое бывает в общем на самом деле не так страшно я думаю кстати что вы на этом можете хорошо выиграть вот если у вас там есть колонка литре то с этого мне особо по крайней мере сцапал дефо ринга jit компиляцию выловим особо радости не будет я думаю с вашей вот полторы тысячи колоночка очень будет неплохо то есть когда у какой-то последний исходить будет хорошо это все во время компиляции запрос выполняется обращаю внимание nnv вам потребуется старшей версии чем 39 я когда пытался у себя собрать у меня ванильный debian стоит на десктопе соответственно с ним какую тыловым я apt-get поставил что версия не то пришлось вытаскивать более свежим и с ним соответственно собираться вот но надо сказать что несмотря на обещание грамотных возможностей на типовых запросах то есть когда немного колонок не какие-то сильно извращенные условия я особого выигрыш не получил да она в принципе быстрее получается но не сказать чтобы радикально дальше меня будет пример где она удивительно радикально быстрее но он немножечко искусственный джут компиляция определяется соответственно определенными переменными их можно выставить можно поставить от листа можете включить jack of cost это у нас насколько рассчитанная стоимость запроса должна быть больше чтобы он включился средствами можно будут нехилую вдоль поставить он всегда будет включаться очень небесное он не будет включаться тут дальше подробности идут я разработчика прикладной я не разработчика собственно subj д поэтому вот например там всякие важные в опции честно говорим не молчу говорят его завод можно включить можно выключить вот но тем не менее вот такие возможности есть кто-то может быть не интересуется может покупать вот пример когда это хозяйство работает мылу генерирую много строк достаточно бестолков запрос но зато работает показывают по крайней мере вакуум сесть на таблицу анализируем вот у нас выбирается 9 конструктор 9 колонок опять же если на 1 2 это вообще бы не будет чувствоваться больше начиная чувствуется дальше специально выключается про реализация я не еще буду рассказывать пузыри начиная с 10 версии в 11 все более больно любит агрессивно парализует выполнение но тут надо соответственно выключить и соответственно включить жить в любом случае вот соответственно вот такой вот запрос у нас получается с он из afam вообще говоря вот в реальности я в степень ничего не возводил меня больше все как-то суммы какие-то там оборотно-сальдовая ведомость вы подались ну кто-то вообще там занимается и математикой может быть кому-то это актуально например у меня любимого руководителя у них звездный каталог есть да вот там какого-то безумного размера тоже в общем то задач как ни странно чем странно вот занимается звездам к долгому я как не занимался меня все больше какие-то люди люди до финансы но тем не менее он не степени возводит и получает в общем-то достаточно неплохой результат посмотреть и красного выделено сколько выполняется бюджета и сколько с g там вот так вот запросто обращаем внимание если у вас 2 секунды выполнять и льна я округляю 2 секунд бежит от аджита выполняется за секунду в общем-то два раза быстрее запрос достаточно искусственный на мой взгляд но тем не менее тоже такое бывает соответственно если волос что подобно есть или как у вас полторы тысячи колонок я думаю что на этом можно хорошо выиграть будет смотреть мне правда интересно потому что делать таблицы полторы тысяч колонки я честно скажу поленился вот может быть что-то будет интересно и дальше следующее наболевшая для пуска лица тема честно скажу это секционирование она вообще парус к 0 перевод переводится коллекционирование в оригинале называется противник его по-русски позиционирование портишь ник называют по-разному ну я все-таки постарайтесь придерживаться нашей родной терминологии сколько она хороша другой вопрос ну по крайне мере надо быть последовательным и так чем же было всегда была проблема проблема была в том что в 96 и раньше до 96 секционирование на самом деле реализовалась с помощью нас летний таблиц и работал довольно плохо потому что секции можно было отсекать только в том случае если включить экз они внезапно как литерал даже не как параметры более того она работала с довольно скверно с большим количеством секций то есть там 10 из текста хорошо даже с ветеранами например 2000 секцию же а получалось довольно грустно на большем количестве секция можно было налететь на ошибку в десятой версии с виду все улучшилась на самом деле внутри она как была так и осталась просто просто добавился синтаксис должен сказать что наша компания к десятой версии сделала модуль pg пасман который умел отличать секции разбирать отсекать не нужны как в случае когда ключ позиционируем не задан литералов так если параметрам даже и случае join a по ключу отекать в 11 версии ситуация улучшается это не наше это то что предлагает кому на общественное появился первичный ключ к сожалению он появился но как то вот не до конца потому что на него к сожалению френки ими салат с нельзя должен входить включить акционерами в принципе это логично это во всех базах так сделано зато работает он конфликта он конфликта удобно соответственно и есть триггер и на таблицу все хорошо работает добавили акционер не похож и при обновлении ключа строки могут мигрировать не нужно писать триггер можно сделать секцию по умолчанию туда будут попадать все то что не попадает нормальной секции должен сказать что у нас в модуле послана есть авто создание секция мне это кажется удобней потому что так у нас в случае ошибки если непонятно куда девать все навалится куда-то в кучу и потом будет долго разбираться может я ошибаюсь может в ряде случаев хорошо но тем не менее так сделана такая позиция есть отдельный параметр для того чтобы оптимизировать соединение таблиц но он по умолчанию выключен его нужно заключать и я в общем то достаточно скептически отношусь к этому но можете они опять же не прав но как-то сомнительно вообще мне не очень нравится collision секционирование версии посадка равен но лучше я чуть чуть дальше покажу как она на конкретном примере как она работает ну и соответственно можно создать локальный индус грубо говоря на родительскую таблицы и он автоматически будет создана дочерних таблицах с большим количеством секций оптимизации к сожалению фактически не проводилось то есть если вы хотите 10000 тексты на таблицу сделать будет наверное все таки не очень хорошо там начинаются проблемы уже даже несколько текстами сколько с каталогом потому что для того чтобы что-то выбрать из таблицы на таблицу нас на всю таблицу нужно наложить жить блокировку нужно искать среди множества таблицы возникает в общем с этим лог contain шины и не очень хорошо у нас позвони это дело оптимизировали тут еще пока не очень я к разработчикам послана приставал там давайте сделаем уже было 100000 секции иметь вот побольше они старались до 100 тыс это не дотянули но 10000 живет нормально вот обещали и адски рую из комитета партии удаление портится во время выполнения запроса у меня тут примера я дальше на него буду ссылаться он состоит из двух таблиц первая таблица у нас с композитным типом езда из двух колонн очка пол и род деятельности ну и вторая а и соответственно обращаю внимание что у нас эта композитный тип состоит из мужчин водителей и женщин нянечек да вот e-mail e-mail и есть одна женщина водитель дальше там тоже будет в ряде случаев это использоваться а вторая таблица вот делается из-за 1 и соответственно спицы они растут жирно выделено последняя строчка первичный ключ и выделяем чуть выше можно видеть как она по списку секционирование хочу указать хэш довольно честно говоря такой тупике там остатка отделение берется можно было бы наверное лучше хотя не знаю опять же у нас в паз по воле неволе начинаю к трупу рекламируя просто говорю можно секционирования все говорю по выражению можете сами выражение указатель будет разбивать по секциями пример как создается секции этой таблице то есть у нас нянечки в одну идут водитель в другую секцию идут добавит первичный ключ и соответственно добавляем всех из первых таблиц которым с композитным композит эколог и добавляем в первое вот то последнее интервью как это работает с рефералами смотрим что получилось федералами работает хорошо мы выбираем только ту секцию которая нам нужна вообще красота ну честно говоря ты раньше была игре вышивать не работала с параметрами с параметрами обращаем внимание тоже вполне себе работает вот пример и значит указывая все это дело всё завелось дальше есть такое понятие в подгрести как и нет плана то есть запрос который будет выполнен перед выполнением основного запроса вот обращаю внимание тут которые условия select доллар 3 from user лимит 1 соответственно это попадает в нет план и тоже работает у меня жирного выделено на языке то есть в общем то все получается нормально хорошо а теперь я в следующем попытаюсь с джой нить соединить у меня всего две секции жирным я выделяю то что к сожалению в данном случае это не работает вот это вообще говоря грустно хотя в реальных в реальной жизни может быть не настолько потому что как-то не попадалось что-либо используется и деньги либо вообще не использует это параметра задают обычно бату секционирования такого такое число и там в общем то и это им оказывается не так критична может быть хотя хотелось бы чтобы работал вообще во всех случаях по крайней мере вот так тоже может быть может быть в ряде случаев кому-то это устроит но опять же это общественная публичная версия доступна всем нужно использовать если у вас секции немного там полсотни предположим почему нет вполне себе право способный вариант для ряд случаев что еще можно сказать про секционирование в общем то это хороший шаг вперед потому что у нас появились триггеры у нас появились первичные ключи скорее первичные ключи скорее всего наверняка доделаю то что них можно будет ссылаться это правда здорово но надо уметь и а течение во время выполнения конечно хотелось бы чтобы таблица было гораздо больше секций потому что секционирование с большим количеством мы скажем так группируем однотипные данные рядом это уменьшает вот вывод увеличит производительность очень хотелось бы вот ну и соответственно не могу конечно не сказать что у нас все это работает с индексами произошли тоже заметны изменения в 11 версии в общем то в данном случае про вставку раньше при прохождении индекса каждый раз один при вставке каждый раз проходился от корня до 300 если мы вставляем предположим первичный ключ у нас по их of the genie рефбек serial или serial то соответственно была большая драка было тяжело и выбирать сейчас он если вставляется он на всякий случай кешируется в принципе это неплохо поднимает производительность значит сканирования страниц хэш индексов тоже если мы соответственно выбираем несколько значений х и у нас предположение уникален раньше у нас каждый раз для каждого значения для х индекса брался multics страницу конкретно сейчас один раз он берется это вообще в ряде случаев здорово ускоряет производительность наконец хэш эгист и джинны могут работать уровню изоляции сериала и забыл кто нить его использовал сериала izovol а почему так плохо вам не нравится вообще говоря если вы делаете способ обратить внимание пожалуйста уровень изоляции сериала из был вон там шикарные он в общем то такого нет нигде в возрасте есть конечно недостатки но то что дает сериала и забыл он действительно дает посредственно выполнение люди скажем так в отличие от многих других которые дают сам что-то залечь на по большому счету серверов обратить внимание я кстати практически уверен что если вы его не используете то наверняка очень многих у вас возникать ошибки которые вы просто не замечаете в базе смотрите еще раз говорю ладно я отклонился немножечко и появился ход апдейт шаг уход апдейт тоже никто не знает кто знает такой ход апдейт один человек да как-то вот глядите чем дело что у нас происходит когда мы добавляем туда же добавляем обновляем сроков подгрести у нас при этом обновляется тоже яндексе но старые строки не удаляются в яндексе то есть предположим вы добавили еще обновили строчку у нас старая помечена как удаленное новая вставлена вставлена значение в яндекс но старые значение индексов продолжает ссылаться на удаленную строку когда вы будем выбираться выбирать по индексу мы получим два возможных варианта у нас пузырь исходит посмотрит а хоть строка удалена и нам ее не покажет если мы обновляем колонку которая не входит в яндекс да в общем-то мы сильно упрощая можем яндекс и она состоится на той же странице мы можем индекса не трогать и не садисты несколько уменьшить их замусоривание это раньше работало только для индексов которые просто значения колонки но сейчас может это будет в 11 версии работать том случае если это индекс и по функциональное построены под функции от колодки на ведение полезное не могу сказать что она про воду всем очень нужно но в ряде случаев будет конечно хорошо бы чем-то полезна но без такого дальше кто не будешь загадывать дело имел один человек имел вы наверное заражу д нет а вот в db2 есть возможность ответственно было бы сейчас есть вставлять колоночки в яндекс который не индексируется вы наверное видели вот но сейчас в 11 версии это появляется в подгрести это дело наша компания вот это по-моему года три пытались пропихнуть он очень консервативно подогретого и сообщество очень тяжело принимали в принципе там если при вы при этом пару багов их поправили значит сейчас можно соответственно индексировать по определенным колонкам плюс индекс добавлять другие зачем это надо это на для того чтобы мы при получении данных если он нужно в итоге только эти колодки вот тут первый пример abcd до предложим весь нас запросов использоваться только abcd колоночки мы можем прямо получать из индекса не обращаюсь к таблице вмещает вывод вы вот вывод увеличить производительность в общем-то очень неплохо тут правда стоит вопрос а почему бы их просто не включить в в яндекс без include обезумев не не как отдельный данная прямо там будет ну да какой там время уйдет на сравнении но не такое большое но тут 2 два возражения есть во первых мы можем сделать уникальным конкретно по двум колонн очкам у него всем четырем это интересное ограничение и второе не такое очевидное у нас вот эти вот дополнительные колонки не обязаны уметь индексироваться по для b3 для больше меньше у нас это могут быть полигоны какие то у нас это могут быть в этом отрезке и координаты и прочие вещи то есть мы координаты больше меньше сравнивать понятное дело не можем они у нас все-таки многомерное тоже должен сказать что второе казалось бы не всем надо то есть кто география не занимается ируини ты не только на самом деле кто занимается чем географическим да никто может оказаться чем-то очень полезная вещь и общем то штука есть и в ряде случаев она очень хорошо позволяет ускорить выполнение запросов эта полезная вещь обращай внимание соответственно еще мы теперь умеем делать бипоп bitmap индексу близко к щетку bitmap индекс can кто-нибудь знает понятно ну в общем в этот способ доступа к ipo сейчас буду рассказать это будет очень долго щенков free space map тоже никто не знает человек знает хорошо вообще говоря возраст видео для для таблицы специальный by byt bitmap и где указывает какая страница занята какая ночь можно писать нельзя писать вот теперь во время вакуума там на премьеру проходят во втором припер проходит устроить это ускоряет вакуум опять же ускорение сканер индексы можно пропускать ускорили группками тачку группками знает люди я сейчас лучше тогда бочку небольшую расскажу есть одна такая не буду говорить какая in memory database кивала и все все как положено не транзакционные поэтому чрезвычайно быстро и вот и разработчики он хвалится что я очень быстро и потом он начал сравнивать под гостями оказалось что пост быстрее почему оказалось быстрее потому что у него он был честный он пометил да он старался делать все хорошо у него на каждый коммент производил tseng а под колеса заметил группами мы говорим commit у нас подгрести сразу финн к матчу подождет там несколько миллисекунд вдруг щука подойдет комитете языками тим сейчас это немножечко ускорили в общем-то тоже поднимать производительность на сказать что под вообще от версии к версии там поправили здесь поправили здесь поправили производились в общем то так потихонечку растет тут выросла там выросла то есть если раньше на 95 предположим такое представление было что миллион строк вернуть это примерно секунду сейчас уже два миллиона строк это примерно секунду железо тоже кстати большое внимание то есть у юбки кочку то там таких вещах он потихонечку разгоняется значит то теперь папа взгляд фото умеет больше делать с апдейтом гейтом удалён на удаленных серверах ускорилось работать с тостами можно теперь делать размер иван сегмента задавать не при компиляции сервера а при не тебе что такое вал сегмент не знает ну уже хорошо вот дальше вам сегменты хранились раньше с предпоследнего чик пу это сейчас хранятся с последнего чекпоинта это вообще говоря приносили нагруженной базе меньше место выходит подвалы если вы у вас не сильно груженый база воскресим вообще ничего не заметить если сильно нагружена базам люди у них к сожалению просто не виновен на диске места не было перенести некуда было в общем то иногда это может быть очень важно иногда правда не очень важно появился trunk lid логической репликация на все более и более такая хорошее становится припер может опрокидывать ключ понимаю зачем ну ладно из бы из бекапа можно временные я блоге таблице не вставляется ну иногда кстати это бывает проблем когда они очень большие он их бы копил неудобно чипсов потоковые репликации тоже насколько помню мы делали то есть мы обнаружим ошибочки достаточно раньше можно привлекать что сад у правого позиции промотать на это не для разработчиков это больше для админов теперь стал быстро работать добавление наткнулся дефолтным значением она впишется в каталог это в 11 версии можно вакуума на лай сделать нескольких таблиц сразу тоже общем-то хорошо и наконец для индексов наверно главное возможность параллельно и построение все время ко мне люди говорили как же так у меня куча ядер почему я не могу параллельно настройке яндекс и на самом деле не совсем так и раньше можно было строить cреди create index конкурент ли если вас индексов ногу в принципе можно было правильно строить но сейчас можно строить наконец параллельно индексы в несколько потоков правда естественно вам потребуется хорошие железом вот в вуз первую очередь но я да конечно чем все это работало то есть если у вас один диск вы навряд ли на этом чуть сильно вы играете если дисков много то уже будет плюс я чуть дальше покажу я все он десктопе это делал это происходило чуть лучше было дальше параллельности что такое хочется join и кто знает он короче говоря теперь когда большие таблицы похожу соединяются стал эффективнее я вот никак могу рассказать но принц прохожу это очень долго рассказывать или пары ликвидировалась созданию них некоторых ну понятно что например регионал там сложнее про лизе про лизирующий дальше иногда чрезвычайно эффективная уже не знаю почему раньше не сделали вещь как передачи лимит в параллельных исполнителей это в общем то позволяет быстро отсекать ненужное значения ну вот я у себя делал как раз эту табличку это у меня на десктопе там один диск 16 гигабайт но вот он скажем такой в один поток 2 секунды делает в два потока водка обратить внимание alter ты был как сделать пролиться разрешить провели за не индексов 18 секунд в принципе логично там таблиц небольшая диск 1 в общем то не понятно с чего им сильного разгоняться если у вас там я der побольше хорошие вот вывод я думаю что можно что все это дело хорошо ускорить ну вот тут например как раз я показываю как работает парализация вы пускаете в одиннадцатом на сказать что он все больше и больше сейчас становится склонен парализация не всегда это хорошо если у вас большой поток одновременных запросов лучше выключить скорее всего если у вас нет сложных запросов потому что синхронизация между маркерами правильно выполнение тоже требуют какие-то ресурсы это в общем тоже может негативно сказаться если если ваш запрос скажем так относительно немного не более менее хитрый да в принципе вы на этом можете выиграть то есть тут тоже как-то просматривать у меня вот соединяются две таблицы обратить внимание я добавляю плюс 0 чтобы выключить индекс can и первый вариант у нас хэш джоуи но идет в один поток он выполнять есеньке выделил у нас на секунду и три десятых 1373 миллисекунды второй вариант люблю такие вещи так и маленькие швед и самые планы большие все сразу смотрят внимательно вот вот там вот синенькими там это крупнее покажу выделю насколько он выполнялся если вы собираетесь плотно работать с пальцев в общем то пора бы уже привыкать начинать читать параллельные планы дальше их будет больше в час в общем то так и вы часто чистоты частоты уже особо не растут а за то что я деру увеличивается вот у нас а народ пинает там и 704 6 ядер например машину то есть чем дальше тем больше так что проверь смотреть на такие планы привыкать так что у нас получилось вот у нас это более крупно так сказать более лучше одеваться первая строчка у нас спасительное выполнение 2 параллельно в два потока ну как видите в два потока стал в два раза быстрее ну вот уже в общем-то неплохо было больше я der можно было бы еще наверно то мы вряд ли сильно выиграла но тем ни менее выиграла бы сейчас начнет в 11 версии как я уже говорил с научился делать хорошо хоть join с большими таблицами хорошее такое полезное нововведение так у меня тут торопят постарайся покороче улучшить сбор статистики для сильно неравномерных распределений это когда у нас предположим на 2 миллиона строк на у нас одна строчка не попадает то есть как я вам показывал у нас есть мужчина водитель и женщин нянечки одна женщина водитель по закону подлости как раз вот такие неординарные распределения обычно очень часто именно они не ну и нужны они интересуют иногда с этим оптимизатор спотыкался в версии дети сделали статистику по нескольким колонкам честно говоря можно было лучше сделать и я сейчас постараюсь успеть об этом сказать к сожалению сейчас только указывают корреляции между колонками до десятой версии или до текущей версии не собирается статистика между колонками то после считал селективность что селективность знаете таблица условия очень хорошо вот читал как произведение селективности то есть если у нас однако аллочка 025 предположим в 25 процентов выбирала и другая выбирала 25 процентов но у нас перемножаю а так как значение запросто могут коррелировать это приводило к серьезную ошибку сейчас корреляцию отслеживает и у нас компании тушку что сделала я надеюсь это у нас попадет значение в нашу версию так дальше сделали оконные функции соответствия стандарту sql 2011 года это к тому что было добавили во-первых группы есть кто оконный флаконы функция использовал использовали люди вот ручка рожу вот сейчас соответствие стандарту то есть появились группы вверх-вниз ограничения и можно вот и включ евклид карен дрова там и еще ряд ограничений с эксклю там работает то есть можно уже с этим тоже как-то веселиться дальше мелочь но приятно полного текста потому что вы можете в сквере дописать неправильно пользователь оседать писать discovery какой-нибудь марево не она скорее всего напишет не так да не было необъяснимо ревана хоть и грудь нет здесь она будет ругаться все будет виноват и сейчас можно писать вот так вот по английски ну да он по крайней мере вшит попытается осмысленность этого сделать не ахти какое достижение ну пусть будет то же самое с джонсоном можно полнотекстовый поиск дела кто желает случаев полезно не то чтобы тоже смертельно как ну хорошо что есть дальше теперь по моему очень сомнительные нововведение теперь можно управлять транзакциями списку или но не только примерно ним правда для этого надо писать специальные колбу зато вы можете по дороге сказать commit или там мария rollback мне это честно говоря кажется не очень хорошей идеей потому что было как то логичнее в этом плане если вначале функцию то все ананас транзакты выполняется завершилась успешно все нормально завершился ошибка загс откатилась сейчас можно управлять видимо это кому-то было очень надо это пропихнули интересно что был почище с мир джим люди 40-го обычно жалеют а где горит в подгрести мерч кто ж л никто не жалел хорошо вот в пузырьки пытались просите в возрасте пытались сделать мэр он не слышно в подписи пытались делать меньше он практически прошел его то вставляли то удаляли в конце концов удалили в 11 версии мяч не попал в принципе понятно почему он и как его рок ли при параллельное выполнение могут давать ошибки он конфликт до апдейт он этого не делает он работает корректно вот меж с ошибочки вы к сожалению поэтому его не взяли хотя там большие были проблемы бага бич кто пользовался ну там не вышки ворошили возможности можете обратить внимание вот и в каэс добавили дальше . и прочитал до милана композитных тип хан она обиделась бы вот теперь можно делать до милана композитных типов я не знаю для кого это критично вообще говоря логично это было бы ожидать этого не было теперь можно вот я тут пример что у нас предположим и скрипта кариесе bitcoin ну и и создающего ограничениями bitcoin 1 8 знаков после запятой если останусь учет и есть то у нас будет проблем у нас не получится такой домен можно сделать песку или теперь наконец можно выходить и едет и кредит чтобы народ не путался мне стать не помню как нам выходить о control-d находился на завод ну теперь еще опция появились вот люди столкнулись с такой проблемой в копия вот больше начались на до в позиции теперь работает вот такое условие это по стандарту то есть нам степень равна единице чего в степени возводится получается и то же самое с единицей как не возводи будет один дальше интересная вещь обращу внимание некоторые слом мозгом это у нас пытаются сделать оптимизацию грубо iv грубой может выполняться двумя способами если вы наверно знаете первое это хэш и второе это сортировкой хэш он выполняется только тогда когда число групп ожидается небольшим в принципе если вы хотите кому-то свалить backend это можно использовать такой хакерский то есть вас выставить такое славе что групп будет очень много пузыри считать будем будет читать у групп мало в окне есть небольшой вы в общем то можете и черпать у память такого можно добиться даже мы это делали там отложились но тем ни менее обычно обычно не ошибается кстати и если групп немного то у нас идет соединение хорошо если группа много почти все уникальные у нас панели сортировкой тут начинаются два варианта сортировкой выполнение у меня тут один затем не очевидны предложен вариант 1 что какие каком порядке ключи стоят в общем неважно грубой там это не указывает казалось бы что если мы сначала по своим более скажем так значение колонку с большим количеством значений это ускорит процесс группировки да это в принципе так если у нас колонки примерно одинаковые у меня тут в примере как можно видеть и выбирается сначала по серия а то до 20 и 2 до 200 тысяч то есть 2 очка у нас более скажем так уникально более длинное соответствие когда мы грубая 12 пишем у нас весь запрос выполнять за 11 секунд когда мы меняем местами у нас запрос выполняется за 15 вот такая штука у нас пытаются сделать автоматическую расстановку правильного порядка колонок я честно говоря о несколько скептически настроена эту тему потому что боюсь что угадать не получится но я к чему хочу к чему это привожу пример что если вы будете писать запрос грубой сортировкой обратить внимание на порядок аулак грубой может быть пеппа переставить будет получше тоже вот интересно почему так происходит потому что у нас колоночки для вот с 2 который получается они длиннее сравниваются дольше вот такая штука дальше это с моей подачи будет такая вещь как оптимизация сиденье за таблица саму с собой по первичному ключу оказалась бы это очень странная вещь зачем занять таблицу со муса будь то бишь комплектовать такой дел о она чего делали дубли по первичному ключу глядите зачем мне это надо было во первых это попадается vrm то что генерит вот но во вторых иногда я сам это делал видеть какая ситуация у нас может быть таблица с сотрудниками там у него есть имя отчество там когда работает когда уволился какие там что и как было подробность дальше у нас может быть в юха представление виноват с подробным описанием человека его дети сколько он зарплату получал там зарплаты за последние полгода заплатили за и ровно за последние полгода начальник там начальник начальника много чего еще вам даже большая штука может быть общем-то выписывать июне очень удобно лучшего запихнуть во вью и пользоваться и тут как раз у нас в некотором смысле очень удачно поднимается вопрос о повышении пенсионного возраста если у нас будет бизнес задачи например показать людей которые скоро выйдут на пенсию то например другой месяц назад это были люди которые которого скоро будет 55 или 60 а сейчас очень может быть что эта функция поменяется за гораздо более хитрый а потом еще раз поменять потому что на моей памяти пенсионная дела году ккк за пятнадцать раз меняли я честно говоря не думаю что они дальше буду бояться соответственно у нас будет достаточно хитрая view который будет показывать людей которые скоро будут на пенсию разумеется на подробность там не надо нам достаточно первичного ключа ну и задача вывести хозяин подробности или людей которых скоро на пенсию вполне логично вот написать вот например вот просто с джо нить одну одну views другой по-хорошему получается что мы дженнер таблица само собой по первичному ключу и соответственно наша версия с нашим вот наш оптимизации все это прекрасно вываливает просто доступ у всех сканов данном случае к таблице все очень хорошо работает метод незамысловатая достаточно view было и не стал выписывать и сложные правила которые также стимуле к не знаю вот но такая вот штука у нас появилась очень приятно дальше мы postgres про будем уметь выставлять параметры в другой сессии передо мной сейчас алексей вертинский уступала про мы не только рассказывал это часто возникает задача а что у нас сделает то сайте посмотреть с модулем off to explain например получили совсем хорошо и можно грузить соседние цессии попросить стала из все всего того что он выполняет про породу выключить можно для всего сервера оксана light ставить довольно грустно потому что он здорово загружает одну сессию можно посмотреть и причем мы там получим не только сколько строк например возвращает запрос а сколько он внутри себя строк обрабатывает что вообще говоря вы нигде и нигде больше не увидите это очень интересная возможность и очень приятно что это будет функция будет из списка пиду котором поставить но и кусок конфигурации которые нужно и наконец у нас будет еще такая вещь как сбор статистики как я уже говорил для многолуночных индексов если у нас индекс по низким колонкам у нас будет уже есть это правда есть не не то чтобы не то что мы сейчас предлагаем разрабатываем по крайней мере вот и это резко этапе откуда возникла задача она я давно хотел приставал но скажем разработчик который это делал он налетел на это на один эти 1с очень любит соединять по низким колонку пускать по одной колонке хорошо снят при нормально оценивает количество соединений строк с несколькими колонками у него начинается беда сильно очень ошибается ему это надоело потому что в конце концов к нему через свалилась камни частично и вот реализовали что у нас теперь для яндекс он собирается отдельная статистика и планеры и использует собственно говоря у меня на этом наверное все есть у кого какие то вопросы или нет да будьте добры пожалуйста спасибо за доклад продам что понял у меня вот такой губский вопрос мы вот сейчас мы двигались сын со мной и моими datagrid baby навыков у нас есть проекта примерно 300 гигабайт весит данные плюс индексы все сидит в памяти нас все устраивает скорость устраивает чё там у нас обращение диском минимальное надейся на что костюм и жаловать что как бы им приходится зову как оплатить вот вопрос есть какие-то подводные камни если вот в подкасте такую же штуку провернуть что все данные сидели в кэше большого объема зафер ну смотря что с ними делать собираетесь внутри 100 гигабайт вообще говоря базу не очень большая вот я вам скажу так по опыту миграции 40 la обычно базам начинают работать быстрее и потому что пост для стал столько лучше oracle а вот опрос потому что дурацкие запросы переписывают пуму исключить если использовать на урок вами гриф к подрыву турун ту же самое способ поза 6 некое недоверие то есть это как бы все обкатана то есть проекты которые там надо что вот эти все сидят именно в памяти вот здесь есть есть да есть у вас есть вырождение есть на детей на новом подгрузить это выписали не понял в загс и работают напугались а в загсе у них все в памяти седина все данные у них по wi-fi не сидит у по крайней мере именно про подводные камни то есть это не то попадут на камеру музами сидит сидит под колеса вообще говорят достаточно безразлично в память не впарить и вот он работает интерфейс который предоставляет зимой preteens темы работает все хорошо ну и в том плане что под газ работает нормально опять же он говорит если у вас есть связи о рождении или загран паспорта это posts имейте ввиду ну ладно хорошо пасибо так еще в будьте добры два небольших вопросов дам один может чуть побольше я правильно понял что jit только с 11 версии до из той был он еще его нет стебли до то есть последний стоял это 10 4 он вообще до 11 версии еще нет он она будет сентябрь и октябрь и как и говорил хорошо это первый вопрос был второй вопрос а когда появится полноценный первичные ключи в стебле для секционирование таблиц ну это chevy линер 11 версии герань какой год сейчас у нас 18 наш девятнадцатом году не раньше не раньше осени девятнадцатого года я спасибо последний вопрос как вы смотрите на производительность связки postgres и hibernate спасибо знаете больше зависит от разработчиков которые пишут на гибер ники я видел много людей у которых все нормально с этим делом в общем-то не выделываться все будет хорошо и знать личку или нормально писать например я видел заброс бибер нет с одной таблице было семь left outer join вдунул другой по тому же ключу к одной и той же ну это явно что-то там не так написано ли просто вот если все аккуратно делать получается все достаточно неплохо еще вопросы по сути спасибо за доклад у меня более больше технический вопрос такого плана то есть как сейчас обстоит в бете во второй как бы репликация то есть как все жалуюсь 10:06 что там приходится приделывать слонь или другие какие то вещи ну вам очевидно нужно логической репликацию да а чего магичка репликант достаточно ограничено честно говоря вот особую что-то сделали но сильное и так вот взято прямо сильные не допиливать а что в общих задач выполняйте но как бы мастер мастер мастер слайд как бы там были вот о чем вас не устраивает обычно по такую в принципе можно как и всегда можно сделать как-то бы вы вернуться когда красивое решение почему бы не воспользоваться знаете например я могу понять когда у нас в москве обычно по регионам раздают какие-то данные причем каждый регион свои должны быть и регион тоже какие-то данные отдает в москву например такую репликацию логическая понимаю вот вас такой такой случай да фактически у меня такой случай то что как бы очень много легальная региональных bass как бы держать мистик возможно данных как по крайней мере я особо и не пинали логика репликацию да спасибо да будь добр и нет не слышно вас будет и на записи просто что ты и зал и говорят да отвечают спасибо за доклад у меня вопрос а вот вы говорите потом что каким-то образом решается проблема очень неравномерного распределения данных в колонке по статистике a turkish с помощью гистограмм как это в потрусить глядите то что есть ваниль и есть к сожалению только корреляция между колонками то что делаем мы тут как раз последний слайд да у нас будет гистограммы у нас будет ком он вылез мужского и так далее короче гистограмм в обычном подписи получается не будет дать так еще будь добра ну тогда давайте я выйду в коридор и можете меня там а мы вас благодарим за участие за очень интересный доклад и вручаем вам благодарность"
}