{
  "video_id": "MVmyXtP2wNk",
  "channel": "HighLoadChannel",
  "title": "Трансляция HighLoad++ Весна 2021, 17.05, зал 3",
  "views": 641,
  "duration": 37464,
  "published": "2021-10-04T02:49:43-07:00",
  "text": "у есть новый где это самое есть как метод хондо или что то в этом духе вот метод findall как раз заточен на то чтобы как бы поверх него уже runtime делателям да и лямды оптимизировали оптимизация лям то это отдельная большая история для jet компилятора и в принципе она как бы должно работать но там два года назад когда я общался с людьми которые разбираются в том как написано 2 м вы приложили к этому руку их мнение было не столь однозначна что там все работает но в целом как бы наверное потихонечку допиливают до стачивают полируют и в целом ответ что jit компилятор с рефлексией нормально работает второй как бы комментарий то что на самом деле с рефлексией нет таких больших performance проблем проблем возникает того что люди неправильные используют если риф летом как основная идея основная трюк заключается в том чтобы кашель путь метаданные и так сказать вот эти вот все и reflection объект правильно резать и тогда как бы да естественно это не в дневнике вызовы который может оптимизировать компилятор но на фоне той дичь которую творят современные java фреймворке это не самая большая проблема так начинаем так по времени только меня сориентируйте хорошо начинаем буду будем разбираться по ходу доклада еще раз доброе утро коллеги прошу прощения за так сказать вышедшую задержку меня зовут алексей рагозин и последние лет пятнадцать я занимался высоконагруженные системами для java в различных индустриях вот сейчас я работаю в дочь и банки занимаюсь корпоративными платежами ну как я уже упомянул производительность это не про то как работает компиляторы не про то как вы пишете код производительность это врата как высот тестировать и тем не менее как бы код надо писать хочется писать его как-то чтобы вот тут ну ну так чтобы компилятора хотя бы был шанс и возникает много вопросов как что не до термини раваны выполнение и так далее и здесь мне вспомнилась цитата артура кварков что любая достаточно продвинутая технология неотличима от магии до тех пор пока вы не разберетесь в том как она устроена и вот в рамках доклада я попытаюсь в какие-то ключи ключевые моменты вам дать чтобы вам проще было понимать всю эту магию дальше в своей практике и так первая скорость и языки программирования в первую очередь динамически языки программирования и один из таких мифов это то что интерпретатор медленнее компилятора коллеги дальше прощения адекват отведя с 1 1 1 да вот такая вот черная магия бывает что у нас произошли технические проблемы зато алексея потренировался в искусстве стендапа что тоже очень полезно поаплодируем ему это была не просто серьезно доклад скорее всего будет перенесён либо на следующий highload с организаторами уже решим этот вопрос вот алексей можешь конечно в кулуарах хочешь для тебя выпрошу ноутбук и раскатываем из какой-то экран и рассказать еще раз всю эту историю либо ты смотри как то вот удобней кей коллеги давайте пройдем в зону для общения и я смогу ответить на все вопросы которые вас были к сожалению доклад я наверно уже рассказать не смогу но так получилось алексей подожди подожди подожди сейчас способ аплодируем у нас же были вопросы сразу скоро с барри вопросы без во время 600 поэтому вспомни пожалуйста свой кто такой вопрос я больше понравился очень активный молодой человек который задавал хорошие вопросы активно мало человек подойти пожалуйста хну дедушка всегда говорил мне как важно трудиться и заниматься чем-нибудь настоящим где должна на чем говорит он был агроном и всю жизнь занимался сельским хозяйством и я продолжаю его дело все начинается здесь еда которую мы одежда которую мы носим лекарства в которые нам так необходимы сельское хозяйство обеспечивает нас всем даже удивительно как многого мы добились каждый день мы создаём что-то новых изобретая планируем здесь и мне нравится быть к этому при частом ведь когда ты занимаешься чем-нибудь настоящему это всегда ну привет я артем я бывший доктор хабл сейчас ведущий показано брючины я бывших наконец привет я саша гостями команде процессинга на задача взять всю статистику доставить ее да нет ты говорил что-то про культуру кода в чем ваша говорил особенность что такое использовать культура кода в моем случае я имел двух недель на подход я приверженец теории что его и не возможных решений не бывает мы не интересных решений этом можно найти какую-то составляющую которое понравится либо конкретно тебе либо в целом команде и на этом драме можно делать безумные вещи выстраивать безумные системы которые будут потом не двигать вас мир если о них рассказывать и скучно не будет будь никогда когда важно это просто понимает если идти с этой тенденции с этой этим пониманием драй ведь людей-то использованием этого нужно построить прям гигантскую интересно системы расскажу что-то конкретно что трижды под этим безумен под безумными не скучно решения проблем одна из систем который мы делали это аномалии то так то есть система поиска аномалии у нас график тема не не новое но мы ее решили для универсальном виде для миллионов график это собственно и будет темой моего доклада я буду рассказывать именно о том как какие запросы боль не о самой системе а ее подходе мы очень много веселились всякими научными статьями с войском информации у нас не было изначально там большого опыта построения подобных систем но мы взяли cliff house мы взяли и реализовали на чистом petals of scam господь не чистый ног и колонок на этом искали мы реализовали модели предсказаний воткнули туда сотни миллионов графику и она считается процессе минимальный шаг 10 и это все еще при этом не на самых больших окей пред расскажу подробнее слушай откуда все такую ты бьешь в себе тоже получила для такого подхода ну просто люди когда начинают чем дольше работать индустрии тема не давайте возьмем приняты давайте будем делать так как надо не давайте не будем лезть за пределы того что то что обычно не lacetti вот взять из ведра чтобы делать реально не скучные безумные постоянно думать изобретатель но здесь есть такая знаешь фраза он дает то есть когда ты находишься на самом краю индустрии это не какое-то физическое положение что вот я проработал 20 лет теперь я могу ступить первые ряды и начать драйве нет это не так происходит так как тогда когда ты начинаешь падать на индастри лавал структур киты делаешь работу ты ее сделал поставил галочку для зимы что я умею делать или рассказал об этом какой-то доклад до что нового изобретена что нового продвину как продвинулась инфраструктура в синди индустрия в целом если ты просто сделал то же самое что делали другие ведь намного интересней погрузиться во внутрь какой-то новый вещь взять что-то новое как-то по-другому повернуть под новым ракурсом сделать какие-то новые выводы используя те же самые инфраструктурные вещи о которых говорят там очень многие но повернуть и под таким углом под которым никто еще не поворачивал увидеть что это работает может быть немножечко где-то подкаст и не без этого но результате добиться того что никто никогда не делал и благодаря тебе благодаря тому что ты привнес и рассказал о чем ты с подвигал кого-то двинул двинуться дальше расширить горизонты своего восприятия мира но сейчас узнаешь как думают что особенно чем больше работать чем больше изучают вещей таки да все уже изобретено и все что изобретена довольно тривиально и придумано не лучшим способом да и особые улучшать никуда давайте просто этим пользоваться и не собственно можно так сказать если вызывать возьмём ситуацию десятилетней давности начала десятых годов тогда тоже так все говорили но тогда не было кли хауса не было кафки не было куча языков которые сейчас используются повсеместно да тогда уже тоже было все изобретено но это не так мы двигаемся мы развиваемся и когда-то в древние века люди считали компьютеры что необходимо я не помню точно фраза что по-моему 2 мегабайта оперативной памяти будет достаточно всем и люди в это верили вопрос ваша вера если вы не будете подвергать свою веру сомнения не будете критически мыслить а действительно ли все изобретено а действительно ли нельзя эту конкретную тузу улучшить или как-то повернуть под неизвестным углом таким образом чтобы она начала приносить пользу еще где-то без этого да можно действительно сказать что все изобретено сложить бабки просто начать это использовать а можно попытаться но что сейчас думаешь про индустрию вот она сейчас ты ее видишь что тебе мне кажется где надо изобретать где как слабые места чтобы ты стал понять вот даже в тех подходах который вы построили той системе который вы построили где те решения где тебе приходится идти на компромиссы такой блин здесь не круто надо здесь сделать круче вот этого не хватает этого не хватает да я понял вопрос на самом деле это абсолютно нетривиальный вопрос можно выстраивать что-то новое во всех сферах и очень многие это делают тот же самый house продолжает развиваться и они решают основную нашу боль а если уже не решили честно не могу точно сказать это звуки к примеру за кибер им боль у всех наших последний бой к нам приходил к вам киллер за звуки первым так вот потому что он немножечко разросся в памяти всего лишь 16 гигабайтами каждая система невозможно сделать совершенно нету совершать это только цель ему к ней можно стремиться да мы сделали мы процессе миллиона графиков но мы это не делаем бесплатно мы это делаем за счет конкретно известных там ресурсов которые мы на этот ради есть узкие места которые для нас являются проблемы тоже за мысом языке про для нас эта проблема невозможно постоянно горизонтально масштабироваться соответственно рано или поздно придется дальше развивать эту штуку чтобы оно было быстрее и эффективнее поэтому нет абсолютно во всех сферах есть куда расти только для того чтобы это сделать необходимо обладать знанием и опытом в этой сфере конкретно в нашем случае да мы очень хотим избавиться в за киперов у нас практически к любой сфере при так или иначе последова на привязан и он доставляет большую часть проблем вы уже пытались пока нет мало еще вот хотя бы когда-то в этом думаешь как ты думаешь какой стороны здесь улиц как избавиться я думаю именно менять собственное решение разрешение которые были сделаны у нас таким образом чтобы и покрыть задачу и меньше ушатывает зэки поскольку он нужен нам о последованном нас нет задачи сделать его идеальным то есть нас нет задачи на него тратить и собственно нас есть задача именно нашу проблему решить а ее можно решить в том числе к примеру уменьшив нагрузку на зу кипр предыдущую идею которую мы реализовывали она это не учитывал будущее будет когда вы строили вот система которая рассказывала у вас были какие-то камни преткновения из-за чего то вы спорили чтобы сложного всего проблем не да наверное вот лично для меня это было проблема ранжирование аномалий я говорю конкретно про она будет а также систему которую мы сделали для чего нужно объяснить проблему комбинаторного взрыва у нас есть примеру там график с параметрами нас есть страна оператор пользователь там и еще с десяток разных параметров каждой из них если примеру 10 параметров каждой из них по 100 то мы получаем 10 20 комбинации параметров и каждый из них может потенциально обладать цифры это безумные объемы и с этим как бы ну никто работать не будет но как при условии того чтобы примеру определяете 99,9 процентов всех значений то есть три девятки это вас немножечко нем много мало но 10 в семнадцатой аномалий и вот как как найти среди них аномалию то есть естественно там есть ложноположительные естественно там есть обычно аномальный естественно там есть изменение ожидаемые которые как бы попали под аномалию но это все надо сан жировать до цифра естественно взяты с потолка никто не работает с 10 семнадцатой степени графиков потому что ну это прям очень жестко но даже с 1000 графиков проблема ранжирования она стоит очень остро можно сделать самый простой и понятный способ это когда вы берете и говорите что чем больше цифра в графике и реальным тем важнее номоли но в этом случае какой-нибудь интегральный график пользователей во всем мире скакнет на полтора процента вверх и вы визуально даже ну да скок ну ладно но это будет самая большая аномалия за счет того что цифра само по себе больше нежели так где у вас какой-нибудь стране количество пользователь упала в половину там это катастрофа а этому аномально ладно окей будем жить дальше и вот именно эту проблему я пытался решить это было две недели когда я просто сидел с гигантским объёмом данных и просто писал запросы разными вариантами 1 случае вытаскивал какие-то дополнительные параметры метрики из данных для того чтобы хоть как-то вытащить ну и вкратце примерно как что было за решение я получил коэффициент немножечко в попугаях но коэффициент который говорил о разглядит графиков график предсказание графика реальных значений использую его из используя нормализацию на общий вес графика то есть отношения его числа к общей сумме всех графиков внутри там какого-то report и еще нескольких других коэффициентов я получил более менее функцию которая не позволит выдать цифру по которой могу сортировать и эта цифра мне уже сделала что график с большим разлет am график с большей аномалий визуально именно визуальный будет выше чем график с меньшим визуальным разлет успехов вам в работе над этим до строить систему и изобретаете сего большая надеюсь вы избавите suzuki пера и сделать это отличное других научить и тоже будем посмотреть здравствуйте я артем я бывший доктора хабра про эти михайлов доклад номер два сегодняшний ленте все будет хорошо я в это верю встречаем олега бабки нас темой как написать свой индекс в тарантул поприветствуем лет у нас работает mail.ru сейчас он рассказывает нам как же его написать этот самый индекс 2 сторон тут всем привет да меня зовут олег bowen я работаю в mail.ru в tarantul а при этом не являюсь разработчиком тарантул карраско реактивы пользователям тарантула то есть пишу проекты на tarantul а вот этот доклад посвящен я которому эксперименту который я делал для себя в большей степени ну и расскажу вам о том как вот с позиций человек который эксплуатирует скажем так тарантул написать свой индекс попытаться его встроить и что для этого нужно вот давайте начнем с того что такое вообще тарантул если кто то не знает cessna тарантулы то с одной стороны сервер приложений вы можете писать свой код на lua или там носи и кроме этого тарантул эта база данных все знают что элита разу за то что это in memory база данных вот мы на самом деле все не так просто и у нас есть еще и движок для хранения данных на диске при этом доклад будет посвящен именно движку mintex который предназначен который предназначен для написания и хранение данных в оперативной памяти немножечко вступления и того как запустить тарантул как начать им пользоваться соответственно когда вы спите там тарантул в одну строчку вы можете активировать все возможности базы данных команды бокс f и g соответственно эта информация потребуется дальше здесь я не указал дополнительных опций хотя их большое количество просто по умолчанию начал создаем space space это аналог таблицы в обычных реляционных базах данных но в отличие от иных баз данных как минимум один индекс первичный должен существовать в tarantul списа единицами хранения данных спаси являются to play кортежа и опять-таки в отличие от реляционных баз данных у нас нет ограничения на длину и на типы полей у этих кортежей ограничения на тип касается только полей которые проиндексирована и в данном случае у меня есть первое поле тип on-site я указал это явно и остальные поля никак не фиксированная могут быть различных типов вот после того как мы вставили киты данные мы их можем поселить сумму чего из первичного же индекса с помощью простого selecta и более специализированный случай если вам нужно например извлечь по какому-то ключу поиска то есть мы указываем тип оператора и достаем все кортежи у которых первое поле в строго больше единицы также одной из основных интересных фич тарантула является наличие вторичных индексов вот точно также вы можете создать этот индекс и явно указать при выборке что этот индекс используется и в данном случае мы по силе ксель а кортежи у которых второе поле равно слово world то есть никого планировщика в интерфейсе у вас нету если вам нужно поселить по какому то определенному индексу то вы указываете его явно дальше хотелось бы поговорить о многомерных данных что такое многомерные данные в самом простейшем случае это географические координаты то есть как яркий самый пример то есть широта-долгота и запросы которые мы хотим делать к таким за такими данными это например выбрать информацию которой пролежит некоторые ограниченной области в пространстве но на самом деле задача шире и интереснее попробуем открыть какой-нибудь онлайн-магазин например и выбрать в нем какой-нибудь товар я вот выбрал для себя смартфоны и посмотрим и характеристики есть вообще у смартфонов там диагональ экрана емкость аккумулятора цена марка это вот набор из некоторых непрерывных и дискретных характеристик который мы опять-таки хотим как-то ограничить и выбрать аналогично например с автомобилями и более математически это выглядит как некоторое пространство в котором каждая точка является нашим товаром и мы ограничиваем некоторую область в этом пространстве многомерным и пользователь хочет получить то что находится в ограниченной это этим запросам области соответственно как это можно решать в самом простом случае мы просто пройдем по всей таблицы и попробуем проверить удовлетворяет запись нашим критериям но это долго и проблему поиска данных обычно решают индексы то есть мы используем специальные типы индексов для определенных запросов и это ускоряет время ответа нам индексы бывают разных типов ну затронем парочку первый тип индекса это b3 он используя по умолчанию в большинстве баз данных в том числе и 3 яндекс по умолчанию используются для движка mintex tarantul а этот индекс не подходит для решения задачи поиска многомерных данных потому что он является одномерным данные в нем отсортированные по возрастанию скажем так и поиск иметь логарифмическую сложность то есть но при этом отсортированный колонка отдельно r3 индекс который как раз подходит для того чтобы решать эту задачу пространство разбивается некоторые ограничивающие прямоугольники и по дереву мы спускаемся в то место которое нас интересует которое выбрал пользователь соответственно по про посмотрим как это решается прямо сейчас tarantul а чтобы дальнейшее примеры имели чуть больше смысла попробуем заполнить пространство некоторым набором данных просто по сетке и выбрать из этой сетки просто квадратик соответственно создаем также space создаем ему яндекс и начинаем заполнять в данном случае я вставляю кортеж из трех полей первое поле не имея не будет иметь никакого смысла в наших запасов просто некоторым антона счетчик остальные два поля это координаты вот самым наивным подходим мы напишем восемь строчек кода для того чтобы получить интересующие нас данные но при этом если у нас данных много то мы просканируем каждый кортеж в нашем спасся то есть что очень долго и в общем-то не приемлемо и как попробуем решить данную задачу с помощью b3 индекс на как я сказал там данные отсортированы лишь по одному измерению и посмотрим как использование b3 индекса может облегчить нашу боль построим в 3 яндекс по двум колонкам по 2 3 и сделаем запрос из начиная с точки 1 1 дальше у нас будет идти . 12 13 которая уже не принадлежит нашей области поиска 1420 21 и так далее то есть часть данных которые нам не нужны но все-таки просканируем но зато мы сможем написать такое условие по которому стоит прекратить это сканирование то есть что уменьшит количество от количества перебираем их нами данных но по-прежнему это все равно фокус скан и r3 индекс как раз предназначен для того чтобы делать подобного плана запроса заметьте что здесь мы создаем на самом деле и space и яндекс еще раз и данные начинают иметь несколько иную структуру эта особенность тарантула эта особенность r3 индекса здесь у нас не три поля в кортеже а два поля при этом второе поле имеет тип массив из двух элементов то есть те наши самые координаты дальше мы создаем индекс rt просто указываем ему другой тип не просто 3 и указываем размерность равную двум а в дальнейшем и просто пишем запрос и нам сразу возвращаются нужные нам данные то есть мы не перебираем ничего дополнительно на клиенте в луи и так далее ну теперь я заинтересовался можно ли как-то по-другому решить данную задачу и решил рассмотреть такую структуру как кривая зад порядка кривая зад порядка это такая кривая которая каждой точке в пространстве сопоставляет некоторую точку на плоской кривой строится эта кривая по следующим правилам мы берем нашу точку в пространстве начинаем побитого перемешивать координаты этой точки вот получаем некоторую бытовую строку как с этим затем работать ограничу нас есть ограничение в пространстве и граничные точки на диагонали мы можем отобразить на эту кривую вот при этом заметим что часть точек которые лежат на этой кривой между этими границами выходит за интересующую нас область что мы можем тогда сделать представим себе что мы начинаем оперироваться по этой кривой берем точку проверяем при принадлежит ли она интересующей нас области и если принадлежит то возвращаем ее о пользователе идем дальше и понимаем что мы вышли за границу каким-то образом мы это поняли вот эти опции у нас есть самая первая опция продолжить сканировать и ждать пока мы вернёмся обратно в эту область но это опять таки сведется к вулкану или попробовать перепрыгнуть и вернуться в область поиска естественно вернувшийся область поиска мы снова работаем с теми точками который просил пользователь и возвращаемых ему заканчиваем и когда доходим до верхней границы теперь как это строить тарантул да и в принципе в любую базу данных в общем случае соответственно нужно научиться вычислять эти z адреса сохранить их в сорте ровном видео в некоторый контейнер я выбрал v3 для этого ну и реализовать алгоритма поиска для того чтобы можно было как раз эти точки выбирать чтобы можно было делать эти прыжки и теперь непосредственно к тарантула а что доступно разработчику соответственно я выбрал некоторый список ключевых компонентов tarantul а на самом деле их очень много вот но такие самые базовая хотел бы покрыть ими и рассмотреть соответственно смол на самом деле это спешилась мемориала катар в tarantul и есть некоторые набора локаторов с которыми он работает для того чтобы максимально оптимальна под свои задачи аллоцировать освобождать память вот кроме этого части локаторов писали заточена под определенные задачи так например есть локатор мем пул например и этот локатор предназначен специально для того чтобы лоцировать большое количество объектов одного и того же размера при этом за адреса в рамках одного индекса имеют фиксированный и один и тот же размер я воспользовался этим типом локатора он подходил под мою задачу соответственно это давало некоторых прирост при аллокации таких строк теперь салат если вспомните 2 славе назад это на самом деле просто набор алгоритмов и структур данных соответственно в tarantul и есть индексы бесед хэш r3 и эти структуры реализованы в виде отдельных библиотек ну кроме этого есть и структуры которые нужны для обычного клиентского кода и на сервер приложений они базы данных они также там находятся кроме этого тарантул как я сказал это серый приложений он имеет интерфейс с одной стороны ложки с другой стороны у вас есть хищная api вы можете писать хранимой процедуры носи рождествено вы написали какой-то код носи вам нужно как-то про бросить его клиенту сделать это можно несколькими способами это с помощью лу оси api и с помощью lodgy то в этом фай потому что самом деле тарантул используют не просто lua а реализацию языка lua lua jit то есть поддержкой jet компиляции ну и си api вы можете писать не только nalu вы можете писать хранимой процедурой носи вот и у тарантулы есть отдельная api который вы можете дергать извлекать из языка си как например для охраняю в процедур так и например если пишете сторонние модули вот ну и куда же без сети обычно тарантулов из тарантул собирают кластер и для этого у тарантула есть отдельный протокол по которому работу все внутренние процессы такие как кирка как репликация ровд вот кроме этого сторонний коннекторы или сами другие тарантулы клиенты могут приходить и делать запросы ну и кроме этого есть отдельный компонент реализация свин протокол этому аж типе клиент который также взаимодействует с сетью простите не будет мы тут про яндексе но сам факт того что это важный компонент стоит отметить средства что понадобилось для того чтобы это в итоге строить написать алгоритм для работы с зато адресами за использовать уже существующие бы дерева и битовый массив соответственно так битовая строка которая будет содержать себе z адрес сам интересно что отметить это то что данный битовый массив имеет фиксированный размер и всегда будет каротин 8 байтом на этом тоже можно было сэкономить некоторое количество операций и fav и это стоит отметить отдельно то есть это битовый массив константа го размера теперь как работать зад адресами изначально как я сказал единицы хранения в tarantul является кортеж кортеж можно условно представить как некоторый заголовок и массив формате massage pack ответственно для того чтобы посчитать зад адрес мы должны учесть те поля который пользователь выбрал как индексируем и и выбрать их декодировать в примитивные session и и типы чтоб затем можно было работать ну и в дальнейшем перемешать данные ну кроме то полу в пользователь также в запросах указывает ключи но здесь истории точно такая же нам будет пролетать массив формате massage pack хранение в бы дереве практически идентична с тем как это сделано в текущем 3 яндексе на тот момент когда я писал структура хранящиеся в дереве в 3 для two индекса выглядел вот как сверху это просто указатель на то пол и некоторая подсказка использовали при сравнении to pull off для ускорения сравнения и плюс в моем случае все получилось примерно так же то есть это тот же указатель на это пол и сам z адрес вычислений от этого табло и также интересно покрыть работу с типами с от адреса должны быть упорядоченными но при этом всегда ли значение и их битовые представления упорядоченны одинаково если мы работаем с by знаковыми типом это все у нас хорошо у нас есть там шесть семь и в битвам представлений они также будут возрастающая располагаться а вот здесь знак ой а вот со знаковыми типами у нас проблемы старший бит у знаковых типов отвечать за знак поэтому все отрицательные числа в биты вам представление больше чем положительные решать это пришлось нормализацией и мы просто дальше незадача меняли старший байт ays erge вид для чисел с плавающей точкой тоже такая проблема стоит на все не так просто но это задача также решается и путем достаточно довольно несложных преобразований они есть и также отдельно захотелось поработать со строками то есть строки популярный тип но поскольку все указанные выше примитивные типы уважаться только в восемь байт то и строки пришлось подрезать до восьми байт строки своем битвам представлений также лексикографические отсортированы и те строки которые получались больше восьми байт приходилось обрезать те которые меньше приходилось заполнять с конца нулями соответственно если пользователи не хватало бы такой длины для фильтрации он мог бы отфильтровать на клиенте вот ну и самое сердце можно сказать это алгоритм на jump им который принимает в себя 2 граничные точки и должен пройтись по тем точкам которые попадают в границу области в пространстве и как я сказал при итерации мы можем по кривой проектироваться так что . окажется в это момент за пределами нужной нам области что делать в этот момент да в общем то просто перепрыгнуть так называемый interception point точку пересекающую границу и таким образом продолжить возвращать пользователю данные примечательно что для этого алгоритма не требуется преобразовывать данные обратно где карповым координатам то есть у нас есть просто несколько битовых строк и мы работаем только с ними примерно такую это ли не имеет алгоритм имеет линейную сложность от длины этой битовой строке ну ровно также как и сам как алгоритм проверки того что точка принадлежит заданный пользователем области известно в tarantul яндекс это некоторую структуру которой есть некоторые набора методов соответственно часть из этих методов служебные мы их не будем рассматривать например что при что стоит делать если индекс обновляется также не будем рассматривать те и методы которые 2 часа статистику то есть размера индексы сколько в нем элементов какую память он занимает но при этом есть интересные методы для именно работы с данными например метод get в uvs у себя в работе я его никак не использовал потому что метод get работает только с уникальными индексами в моем случае обеспечить уникальность индекса было достаточно сложно именно из-за работы со строками то есть две строки могут иметь одинаковый префикс но при этом быть совершенно разными по этому соблюсти уникальность не получалось поэтому indis всегда не уникальный на вафле как и встроенных тарантул r3 также есть метод replace который на самом деле не только replace но еще и делить апдейт insert вот если нужно удалить the new то пол будет равен null если это как отличить insert от реплей со да в общем-то по параметру до при place мод то есть insert эта операция не дым патентная то есть уникальный индекс а не смогу вставить одну и ту же запись дважды а вот риплейс может заменять сколько угодно ну естественно с помощью этого параметра до при place мод это можно различать но в моем случае он даже не понадобился потому что еда всегда не уникальный не crate итератор то есть когда мы делаем либо pairs либо select создается iterator который потом последовательно обходят интересующие нас данные ну и как раз за этой функцией находилась а логика итерации по кривой зад порядка средств когда индекс был написан нужно был задуматься о том как пользователь зло через ло будет с ним работать соответственно попробуем решить примерно похожее дача тем что были вначале тесно создаем индекс первичный задаем он должен быть уникальным у нас индекс не уникальный поэтому опять-таки воспользуемся монотонным счетчиком создадим индекс из двух частей для простоты визуализации и понимание ну и заполним его дальше дальше можно сделать просто поиск по в некоторых прямоугольной области нам все вернется поиск отдельной точке на самом деле поскольку яндекс не уникальна могла бы вернуться больше одного значения но в данном случае мы указали . поиск с открытым интервалом то есть по оси x у нас есть ограничение по оси y у нас нет ограничений ну и также полу интервалы по каждой из осей теперь как тестировать с чем сравнивать это решение было написано захотелось понять насколько она адекватность стоит ли продолжать развивать это все дело и стоит ли это все contribute сам тарантул соответственно изначально как я говорил b3 не подходит для решения задачи поиска в многомерном ногами среди многомерных данных и наиболее логично проверить вообще стоит ли игра свеч сравнив это дело с к нам есть ли хоть какой-то выигрыш но я проверил тест apple достаточно коле ночная и получал и заключались в следующем я брал миллион точек и в располагал их в некотором пространстве затем увеличивало размеры с этого пространства и смотрел как изменялась время выполнение запросов не стоит удивляться что время поиска снижалась при увеличении пространство для привозят порядка просто преувеличение пространство меньше шанс того что . упадет в область поиска то есть и селективный целиком и в некотором интервале и в общем то здесь все выглядело обнадеживающий то есть да это лучше чем в узком при этом если задать данные определенным ну в общем не неравномерно распределенных точек дух ситуация несколько менялось то есть если я часть данных выводил за область поиска чтобы дерево практически тренировалась по пустой области а вот у зад кривой возникали лишние паразитные прыжке ну и соответственно sr3 та самая структуру которой как раз и предназначен для решения этой задачи в по нескольким критериям здесь уже имело смысл сравнивать и скорость записи и память которую потребляет данный индекс и как искать в прямоугольной области время поиска и запись выглядело тоже обнадеживающий то есть практически в два раза на больших размерностях зад кривая работала быстрее примерно та же самая выдел и в памяти потребляемой это индекс на основе зад кривой получился компактнее а вот с поиском все получилось достаточно проблематично соответственно на больших размерностях те которые куст и дерево просто сканеры выбирала из пустой области а вот у кривой зад порядка возникали проблемы собственно поэтому я ты осталась в рамках эксперимента который на самом деле получился не особо удачным в плане итога но тем не менее все равно интересно вот ну кроме этого за год все изменилось и в tarantul и появился менеджер транзакций сам сам по себе доклад про manger транзакции к сожалению не попал в программу презентации но теперь надо если захотеть подержать это в текущей версии нужно подружить кривую зад порядка с этим менеджером информацию о менеджере транзакцией вы можете найти либо на ю тубе либо под прочитать статью на хабре минутка рекламы мы что получается нечто было сделано и считаю все таки что отрицательный результат тоже результат и теперь я поняла как работать сам тарантул делюсь этим этой информацией с вами ну и в чем то чувствую себя уверенной а когда разрабатываю на тарантула при этом тарантул это open source продукт и вы можете прийти на git хоп посмотреть исходники что-то для себя узнать что-то изменить предложить нам эти изменения но не бойтесь экспериментировать вы если у вас есть какие-то желания вы можете прийти к нам и оставить и шью в репозитории git хобби ну и так же присылать свой пыл request если все-таки хотите помочь проекту спасибо за внимание вопросы олег спасибо за доклад на давайте вопросов сдаем наши онлайн слушатели тоже могут вопросы задавать там есть специальная кнопочка на плеере поэтому не стесняйтесь олег пасибо мир вот этот фон олег пасе большой стакан а скажи пожалуйста сколько у тебя за него времени вот на этот прототип сколько ты потратил чистого времени разработкой тестирования всего это но чистого времени то есть это было это писалось свободное время я могу слышать потратил там два-три месяца именно вот разработка прототипа хотя сама идея вот раскуривания сортов тарантул тоже заняла до этого часть времени но именно разработки но вот в свободное время несколько месяцев я вот занимался задачей и и второй вопрос сразу в ту же тему большая ли кодовые по сути при этом получилось сколько строчек кода примерно но это ушло сколько строчек кода в моем патча получилось но я думаю там две три тысячи строк получилось с учетом того что часть кода было достаточно шаблоны то есть нужно было реализовать интерфейс и для того чтобы соответствовать интерфейсу индекса tarantul микрофон не работает секунду так этот теоретический вопрос если ты не слышал то я повторю соответственно тарантул сам по себе однопоточный и если делаем один запрос на планете достаточно быстро но если мы начинаем делать курил последовательность запросов то они становятся в очередь и выполняются уже медленнее до тарантул однопоточный но это все таки эту проблему можно решить ответственно как это работает на низком уровне мы делаем запрос например вставку после этого 3 мы передаем управления скажу так другим клиентам вот и в это время мы ждем записи вал когда записывал проходит мы возвращаем управление если мы хотим делать это большое количество запросов то здесь есть два вывода выхода если мы делаем это из одного клиента то есть смысла обернуть все в одну большую транзакцию тогда мы делаем кучу запросов и они бачок записываются в red hat лоб а про select запросы до select и будут последовательно выполняться это так но все select и делаются с оперативной памяти но ну да и из и выполнить один запросе остальные клиенты будут ждать это так сейчас я видел задача это уже не знаю road map не road map задач на создание raid view для больших запросов и соответственно в этом случае team for 5 отдельный трек или файбер для того чтобы делать большие запросы в таранто ли им на параллельно но пока это лишь идея в онлайне нас нет вопросов простите спасибо за такое у меня два вопроса первый это да какой размерности выдавших доходили многомерных индексах делит еще работала потому что подогретым стандартный бокс столь и антон до размеренный вместе 100 больше не работает в tarantul и r3 имеет ограничение на размерность 20 здесь я тоже решил для сравнения используют размерность 20 но в принципе там поднять до 30 32 ну вот есть возможность потому что дальше начинаются манипуляции светлыми мазками там все бы скорее еще больше деградировала но вот эта размерность 20 максимально возможное для создания и второй вопрос вот вы показали как вы можете с данными в яндексе работать но во первых если в tarantul include к индексу то есть видимо не возможность положить данные рядом с индексом от строки нет но это и не нужно ну то есть это дисковый движок и если и яндекс это отдельная структура и хранит физические данные только первичный индекс мы делаем запрос к вторичному яндексе у нас лежит там указатель над apple поэтому никого там проигрыша в производительности у нас нету то есть мы просто по указателю берем какое-то значение еще вопросы спасибо за доклад хотел еще узнать о наскок там отличается построении индекса для движка винила лишь к вот вами макс ну это вообще два разных мира про движок движок винил в нем всего один тип индекса и это lsm дерево вас там такое нельзя сделал да и там ну там придется заморачиваться с тем чтобы это все еще на диск сохранять и особо винилом я это не смотрел даже исходите винил на самом деле вот только смотрел момент но если хочется побольше узнать и винил то в принципе на предыдущих аллодах также проекта рассказывалось и можно найти видеозаписи еще вопрос для винила сами индекса они хранятся также рядом с данными на жестком диске вот на жестком диске насколько я знаю да то есть если мы делаем вторичный индекс то он включает себя некоторые указать они сейчас там еще включается часть указатели на первичный индекс то есть первичный ключ и по нему мы потом достаем те данные которые уже нужны пользователя спасибо то есть не целиком до хранятся то плод во вторичном алексей еще вопрос вот b3 дерево но хорошо мы если там добавляются данным и еще там добавим еще парочку у колонок в яндексе там можем задать специфичный там комиссии колонок там прежде сито и нам нужно ускорить какой-то конкретный запрос мы можем там выбрать там четыре колонки по которому создать яндекс вот вопрос от про ваш эксперимент и вот как можно комбинировать и ваш поиск его вот поиска да у нас все дополнительные фильтры которые хорошо ложатся на бы три дерева но какого-то особого алгоритма именно мер же индексов нету соответственно нужно писать какие-то свои условия небольшой скрипт на ло которое будет сканировать по индексу и потом дополнительно отфильтровывать коды полу ну по пользовательскому условию данные уже скажем так на уровне ложь него приложениями на уровне лишнего приложения ну или там не знаю иску или за использовать в таранто ли вместе с quelle спасибо если больше вопросов нет поблагодарим нашего уважаемого спикер сегодня состоялся дебют как я понял на хайло де дебют на выступление поэтому это это вдвойне почетно призыв в студию далек еще выбери пожалуйста вопрос лучший который ты понравилось так лучший вопрос давайте последний вопрос про хотя сейчас зажмите что не понравилось больше просто было много данных о вы много вопросов именно про устройство самого тарантула давайте вот самый первый вопрос не на про яндекс который был стендап плиз самый первый вопрос индекс который был спасибо еще раз спасибо продолжить может на в кулуарах слева у выхода но от вас то справа ведь за компанию все компании это маленький стартап chic это будет в начале ролика всех тел мы создаем крупнейшую в россии облачную платформу а также предлагаем в аренду выделенный сервер на свое оборудование цик дата центра наши клиенты это ведь образовательной платформы службы доставки linea игры в банке и сервисы для видеоконференций и обработки фотографии на данный момент у нас больше 18 тысяч клиентов клиенты хранят у нас гигантский объем данных испускает высоко нагруженное приложение мы сами пишем прокатываем и поддерживаем свои сервиса и все это об дата-центрах который мы тоже строимся мы всегда думаем о качестве и надежности потому что от этого зависит надежность приложение наших клиентов выбираем самые нужные сервисы и делаем их так чтобы ими можно было гордиться сотрудники всегда в курсе того что происходит в компании для этого мы устраиваем много различных внутренних мероприятий менеджмента рассказывает об успехах в файлах а надо модель продуктовая команда показывает актуальные рот map и а еще мы получаем подробные фидбэк от коллег с которыми работаем чаще всего есть подозрение что мало где так как здесь больше всего в работе меня нравится близость к пользователям и возможность быстро получать от них обратную связь проверять любые гипотезы и влияет на наполнение продукты фичами мы все время движения слег talk поддерживать развитие своих сотрудников или любой инженер дата-центра может вырасти в разработчика а наш офис менеджер и продолжает карьеру работы с ключевыми клиентами при динозавра протирается нашего кажется им пока рано внутри привет я артем и снова здрасте я редактировал бывший рукой я бывший доктора хабра сейчас ведущий подкаста мы обречены рад познакомиться чем занимаешься сейчас начнем регулярно чем работаешь глобально я как бы маленький предводители мама группы разработки просто беру поиска новички которые мы растим за грехи мои тяжкие мы все еще гоняем замшелые самописный движок сфинкс который я когда-то позже видимость грехи будь он неладен описал и мы побежу поддерживаем и развиваем всякому дописывать ты же его сделал давно и не для vita ты просто как вы правду он вообще как-то считаю что он выдержал те требовали которым сейчас у него есть то есть api тоже тоже меняется и там сейчас 80 видов объявления завтра будет 160 миллионов но при этом у нас как бы боевой поиск это 80 миллионов объявлений это то что оперативно доступно каждую секунду в каждом первом пользователю массы всякие внутренние системы которые тоже нас миксов крутится в которых и побольше да миллиардами измеряется например у админ ты с архивом всех объявлений но что интересно это принципе тоже не сильно я знаю светлом прошлом были инстанции в которых и еще больше там сотни тысяч серверов и этому засвечен большим количестом документ по большому счету кирилл езда достаточно некомфортно оперируете и был тогда и до сих пор мы может когда ничего с этим наконец сделаем вот но как бы я к тому что масштаб там порядка 100 миллионов документов 1 10 миллиардов документ когда мы привычно 10 но сейчас таких боевых условиях есть моменты на которые ты смотришь такой боли ну почему я тогда там не знаю после лет назад не сделал по-другому 20 а что выглядит на все 13 ментальные возраст и вообще 11 но к несчастью 20 а во вторых на эти моменты они есть понимаете постоянно все эти последние 20 лет в любой конкретно взятый момент вы мне хочется взять и все переписать на хрен вот 0 нет надо держать себя в руках нельзя все ломать над на чем-то сидеть а некоторые моменты наверно там наоборот удивляешься блин-компот копыт замши лаа ты меня не работает до сих пор и честно говоря нежелание люто бешено полностью переписать а в основном скорее ну наверно больше половины года который делается это все таки что то что будет меняться можешь например расскажи какие то вещи которые ты был меньше всего готов который был сложнее всего этот движок поиск сатаны тоже сейчас у нас мы там включает общем m-elle модули я не думал что 20 лет назад об этом думал что такое 20 лет назад как никогда не догадался о том что есть такая штука как имели которое по большому счету над статистиками цена стероидов и там линейная модель с сотней входов а нет мы с тремя входами пайки не как ни странно в этой части все достаточно легко как раз интегрируется то есть интеграция той же самой модели ранжирование это достаточно штука оказалась простая потому что привело бы к нему к подобному с 1 готов многое steam один прекрасный момент уже там вырос там концепция под названием utmost сигнал оранжевая форму выраженными так далее выросла некая считалка этих самых сигналов форма выражения и все что оставалось делать это просто чтобы обеспечить возможность подцепить у дев функцию и в эту да я функцию передавать достаточно большой бинарный блок со всеми сигнал беранже вами которые мы хотим туда передавать достаточно тривиальных занятия вот поэтому это был сезон еще десять лет назад опять таки дев действует назад по моему мой первый раз какие такие боль меняем или обычной модели в похожем или делалось это в тот момент не для авито делалось для одного тогдашнего клиент которые строил там маленькие поисковик по одной среднего размера европейской стране вот там был соответствует тоже сфинкс там были модели и дам первый раз на эти самые модель поручу ли он тебя вопрос лежит лежал до определенного момента в open source все после определенных увлекательных событий переживаний нас м с одной стороны с другой стороны я внезапно понял что прямо сию секунду никакого прока с этого конкурса не будет ни для какой заинтересованной стороны но смысле для проекта роток не вижу для себя ту книжки более вот и пока о таком закрытом режиме может быть как open-source вернемся может расскажут что такое случилось почему так шо он там этот длинный увлекательный или наоборот длинная не очень интересная история вкратце и как бы это давай совсем большими масками следующим образом очень непросто зарабатывается пенсов снова движка которые ты абсолютно за бесплатно делаешь раздаешь и и пытаешься зарабатывать хрен пойми чего нельзя все отдавать за бесплатно надо 4 продавать вот продавать у нас как бы всегда были некоторые сложности и поэтому на самом деле текущую версию который разрабатываемые тем бы послушать я ее прикрыл еще в годы когда покупки зарабатывается танцор снова движка не кончились уже там не знаю группу а летом четырнадцатом году если при помощи уже было понятно что то что то менять в кавычках в бизнес модель бизнес в гигантских кавычках потому что особого бизнеса в этом утра лес к счастью не было а и уже тогда искать решила что могу делать где-то разрез версия за деньги вот версия без денег и поэтому некие большие фундаментальные перья белки которые были за тельны учетом до дома в четырнадцатом будет надо их прикрыть и потом где-то провести линию разрез соответственно после всех этих перипетий названием кассовый разрыв довольно бога получается жили до 1 нормального кассового разрыва с одной стороны но здорово говорят там 90 процент так называемых стартапов как будет в это дело заезжают на дистанции в 1 1 2 3 года дергались несколько дольше в свое время но ну чё за твоего оказался достаточно фатальным очередной разрыв читы деньги кончились совсем самое главное что приток денег кончилось тоже совсем там было еще массу неприятных моментов точно как и как сказать там как в любом разводе скажем так но это уже наверное тема для отдельного рассказа и обычно там акула нам рассказанным с углем и мечами за четырьмя литрами пиво и постепенном переходе от и вон когда он был в open source его легче было ним работать был какой-то вклад от сообщества значимой интересный вопрос легче или нет я бы сказал что хомячки как-то сильно комфортнее наоборот то есть понятное дело что в целом всегда удобнее работать когда ты nissan там как курочка по зернышку тут копеечку так капельку а вот снова нихера когда сзади к тебе прилеплены мышечных гигантская компания со всеми ресурсами и возможностью эти ресурсы так или иначе использовать ну как будет понятно дело сильно более комфортно режим жизнь вот понятное дело что тут как бы палка о двух концах и естественно если у тебя твой проекта люто бешено взлетает и сам начинает генерировать сильно больше денег чем у при большой компании у него в принципе когда не забуду за бюджете вы то наверно пара некий спин-офф open чинить а тут песчаную большой компании лучше со сфинксом это случае сосфен смогут всю жизнь достаточно мало зарабатывал всю жизнь как бы это соответственно его независимая жизнь была не сказать чтобы как бы усеяна розовыми лепестками и корпоративными с черной икрой с соответственно выдающиеся золотых чашечках бриллиантовыми ложечками поэтому в рамках большой компанией ну честно говоря одну жить легче много чем по меньшей мере вот на это этом стартовые фазе под названием и еще пока там свои 100 миллионов долларов с share via не делаем году вот чисто теоретически чисто теоретически наверное можно построить разработка следующим образом что у тебя есть достаточно большое количество компания интересант of каждая делает разве из которых делают достаточно новое хорошее и интересное и которая можно скажем так в общую тонула хорошо уложить а его проект замерз теоретически это возможно какие то вот прям супер комьюнити проекты такие есть тот же пост бриз например по большому счету вот такой супер танцы проект на котором трудиться далеко не одна компания и каждая взгляд об отбеливает что там вот вообще делился этой а swings до такого масштаба черт его знает то ли не дорос то ли в принципе невозможно что он до такого масштаба дорос потому что насколько я смотрел и язык я смотрю на более другие проекты которые тоже про поезд в основном и понятное дело люсин и все что поведает нам о библиотечка люсин и тот сервер который в этом сезоне модно строить поехали set а они всегда у меня конечно может неверное впечатление пошли к недостаточно хорошо там умею распарсить 250 мегабайт джавс кого года 220 мегабайт из которого это в основном то мне нужны реальные комментарии и там тривиальный фабрик но у меня такое ощущение что по меньшей мере в ядре скажем так движка библиотек и так далее где-то процентов 90 года делается в этом крайне ограниченным кругом лиц который возможно формально ходит по разным компании но их там допустим 5 даритель думает об opensource что это тоже очень мало людей на самом деле то есть он такой открытый но контролю за бред а большой рассказ контрибьютором пару человек стал именно так большое количество контрибьютором при этом одновременно с этим может возникать в какой части там типа а вот в ядром и лезть опасаемся но зато мы прикрутили вот этот плагин вот этот плагин и вот этот план вот такая вот штука она конечно цветёт и пахнет сильно сказать все сели на шепчи чем покупки кого привлечь к разработке ядра при каких условиях ты бы вернул его в концерт сложный вопрос вот на данный момент я натурально не вижу никакого атомов фиктивного плюс от open source а кроме никого имиджа и даже уже не уверен насколько как бы это важно и не важно для конкретных пользователей для того чтобы этот имидж был вот если бы сейчас ты мог вернуться в прошлое с текущими своими знаниями о том во что превратится в проект и что-то одно сделать по-другому что это была не ну это ответ на этот вопрос нет несчастью готов еще до того как я придумал сфинкс и он звучит примерно как а в момент ваучерной приватизации я бы выбрал я щекотки украл ящик водки много ваучер на которой там складывается условными газпром потом верти руется в биткойны и в принципе на данный момент был он маску меня где-то уже в подметки вот если стаки признание ну ладно успеха теперь хорошо готовится докладов надеюсь получится круто хорошо выступать ай да надеюсь дивы пасибо ну что prada им наше увлекательное путешествие в мир технологии следующая тема как мы создавали data management platform вазон расскажет нам про все нюансы евгений чмель и поприветствуем всем привет сегодня речь пойдет о нем и о том как мы и создавали относительно молодой проект и ему чуть больше двух лет мой доклад будет состоять из вводной части в первой части грамм описанию как мы его используем какой профит мы от него имеем и далее перейду к архитектуре давайте начнем так agenda что такое game pe 1 2 интерфейс конструктора сегментов ключевая часть и последняя это архитектура так что такое гимпи гимпи это платформа для построения сегментов пользователей с целью таргетинга ключевым понятиям game pe является сегмент что такой сегмент сегмент это просто набор пользователи которые собраны по каким-то правилам все это может быть там use ради либо сейшелы в качестве фильтров может быть использован город бренд категории либо поисковый запрос типу от формы с которой взаимодействует пользователь с озоном дальше у сегмента есть ряд атрибутов это dish ник какой то номер до название ты цель есть время x время экспирации сколько времени будет находиться пользователь в сегменте type тип где тип сегменты у нас есть два типа это динамический и статический дейт интервал фактически это два вида то это дата создания сегмента да и дата окончания когда его можно удалить и юзер кончите это количество пользователей в сегменте примеры использования сегментов да то есть что мы что мы делаем на их основе то есть в чем они участвуют в каких механиках это отправка нотификаций рассылка писем то есть можем показывать какие-то баннеры этом страницы с товарами так так так же мы используем сегменты в ценообразовании через маркетинг и маркетинговые акции в принципе как бы любая механика может быть завязано на сегменты мы даже об этом не делаем иногда так изначально сегменты создавались вручную то есть как это выглядело то есть поступало заявка от какой-то команды от менеджера там маркетолога в общем не не важно от кого да и разработчик начала выяснять там на таких данных сделать сегмент сюда куда пойти за этой информацией хартфорде во всю логику в общем на это уходило очень много времени да и в какой-то момент заявок стало очень много и пришли к тому что нужно создавать конструктор сегментов то есть как-то ускорять процесс как слишком много времени тратится тратилась на разработку ну и первый вопрос который у нас возникает то на каких данных можно строить сегменты выбор выбор как бы у нас был до это либо использовать данные tracker tracker скажем так сервис до которые ответственны за агрегацию пользовательских событий то есть принципе вся пульс пользоваться я история может быть и ее можно получить и сколько у савка через написав какой-то запрос да и эти данные ивенты попадают в клик через tracker также был вариант и использует и gdfs как бы но какие-то там тесты до небольшие показали что принципе через парке ситом выполнять запросы да как бы то время выполнения как бы она была там в 30 раз бы ниже облаков как бы в сторону с даже то есть сколько он здесь был как бы ну такое самое быстрое решение в общем позже мы ну и и кликал с мы стали как бы использовать это как бы самый первый источник данных для построения сегментов позже мы еще добавили в потом потому что в ней хранилось информация по заказам раз в сутки выполняется выгрузка из ума с это ордер management system 1 сутки мы выгружаем инфу по заказу вверх и принципе по этим данным тоже можно строить там какие-то сегмента там допустим по среднему чеку то есть что пользователь покупает там допустим за последние две недели там за последний год так далее кому то есть то чем он интересуется этом слайде представлена прям примерно то как по пользователей взаимодействие с озоном скажем так то есть из чего появляется события пустим пользователь может там что то нажать да там посмотреть какой то товар то есть заходит сначала на озон открывать там допустим какой-то интерфейс до какой-то окошечко там вдали это событие улетает в трекере потом попадает уже в клик если пользуется оформлять какой-то заказ это все летит в массы потом раз в сутки это все складывается как бы vertica ну как это может быть как это выглядит для пользовать когда допустим нажал на кнопочку добавить товар в корзину там да и либо напомни-ка mymenu в выпадающем списке и дальше этот эволюции летит как-то процессе c и сохраняется далее интерфейс конструкторы сегментов когда менеджер решает создать какой-то сегмент да там допустим га маркетинговые акции или еще еще для чего-то там для промо рассылки то есть первое что первый вопрос который мог задается это она по какому ивенту нужно каким данным нужно отфильтровать пользователи здесь он выбирает действие допустим просмотр товара на пи пи пи пи пи пи эта карточка товара дали им выбирает параметр категория и в качестве категорий допустим может выбрать там рыба и морепродукты также задаёт тип сегмента динамически что означает что сегмент позже будет обновляться раз в сутки правило выбирает интервал выборки в примере это три дня можно выбирать до 90 дней мы просто ограничились специально чтобы сильно клик не нагружать и также может выбрать сегмент из которой пользователь нужно будет исключить когда он будет попадать добавляться в текущей сегмент если будет валить для условиям который выбрал менеджер после того как он накликал кондишен его то есть может посмотреть примерно что у него получилось если он нажимается кнопочка там создать все сегменты и все и дальше уже происходит building целях отладки мы еще добавили такой фичи что можно было рассмотреть запрос который сформирует конструктор сегментов клик запрос у нас формируется также или не только для клика списаны для верочке том числе так теперь переходим к архитектуре как бы гимпи вообще как было в сухом остатке как бы если взять тогда-то состоит из двух таблиц это таблицы я одет которая содержит связки или таблицы сегментами которые ссылается на эти связки и вот здесь мы что такое связка у нее есть корневой элемент это таргитай де который объединяет сессии какого-то пользователями связки может быть принципе отсутствовать гадюшник юзера но может быть там много сессий для деньги одна связка как один юзер далее пример того как выглядят сегменты то есть таблица сегмента всего лишь две колонки день по айди это тот самый таргет который ссылается на связке связка нас в 1-м хранятся до и в качестве ключей этого джисона используются а лишь ники сегментов то есть 66 и 365 под документы это поляр source это источник данных до которых выгони источник который инициировал создание сегмента ресурсе expires это таймс темп то есть время добавления пользователя в сегмента и время экспирации есть когда пользователь должен вылететь из сегмента как это выглядит то есть менеджер создает сегмент потом к сегменту происходит от touch расписание создается расписанию с условиями сборки и все это выполняет importer и далее importer на основе расписание порождает задачи периодически на пире сборку сегмента здесь представлен пример определение фильтров да то есть это где сончик фактически здесь два фильтра они выделены в красненькими квадратиками а и б видите верх самый верху это формула она говорит что нужно будет эти два фильтра потом объединить то есть они по ней формируется запрос в клик получается потом возвращается ответ видео нижников да и далее importer выполняет мерс полученных результатов и получаем из результирующий набор сохраняется под каким-то сегментом пример запросы которые может быть в клик для одного фильтра вот таким как бы это пример простого запрос они могут быть очень большие мы пробовали делать посылать строить один комплекс и такой запрос содержащий несколько мелких он выполнялся очень медленный да то есть в принципе решили лучше делать разбивку выполнять их параллельно а потом применять алгоритмы сортировочные станции для того чтобы уже там отсекатель не и ненужных пользователей по формуле помимо и бартер на сервис консьюмер который выполняет real-time сборку сегментов что такое real-time в нашем понимании это значит что пользовать этот сегмент настолько быстро насколько можно при получении ивента и из кафки весь консьюмер слушает разные топике разных сервисов до в частности и трекера у марса и других в общем и при получении ивента да он подвергается к какому-то процессе лудо и далее users добавляется в сегмент такая логика на кода более добавление пользователя в real time segment она постоянно hard ходится разработчикам то есть конструктора для этого нет еще операция которую выполняет консьюмер это меж сегментов то есть когда нужно сегменты сессии и сегменты пользователя обид нить идти то есть это происходит это первый дефекации да когда это надо допустим и если пользователи не был залогинен до было только сессия мы не знали его его одышку но для него уже есть какие-то сегменты с теми а потом залогинился мы вычислили что для его диске есть какие-то другие сегменты в этом случае мы выполняем объединение этих сегментов если вкратце то так там несколько сложнее ну и как бы также есть задача это вернуть сегменты по use ради либо совершенно идея к нам ходят сервис и отправляет use ради как в запросе да и мы возвращаем им сразу все сегменты которые есть для данного пользователя так и также ей задачи то есть и вернуть всех пользователей из сегмента и выполнить пересечения различных сегментов как мы это делаем был так как сегменты мы храним в подгрести до в общем выбрать всякие жиров как бы не предполагается возможном то есть это сложена это долго вообщем мы просто экспортируем сегменты раз в сутки в клик и далее сервис и статистика api позволяет выполнять пересечении таким сегментом которых хранятся в реке пример за пример запроса в статье six api то есть допустим нужно получить cal количество пользователей в сегменте то есть он может попав по формуле простите то есть можно передать формулу состоящую из трех сегментов и получить пересечении этих сегментов на определенную дату как правило используется текущая дата еще примеры то есть можно использовать операции прели приоритизации готов приоритета круглые скобочки или допустим да получить все для конкретного сегмента ну из запрос которых формирует деньги стать и скорпион может выглядеть так вот если мы хотели взять пересечении трех сегментов он сформирует такой запрос то есть на вход принимает формулу делает такой запрос внутри него есть билдер запросов и возвращает пользователя принципе выполните все это довольно быстро ну и проблема с которой мы столкнулись большие джейсон и сегмента мы храним же сон и бы в какой-то момент сначала они не быстро раздвигание это не сильно ощущалась но как бы потом уже стала чувствоваться и сервис темпе сервис ггц как бы так как у нас глисон и растут до иногда остаются сегменты которые уже не используются их можно удалить в общем мы решили сделать сервис который будет чистить жетончики время от времени сейчас он правда в разработке еще не готов но скоро завершил он то есть он должен будет как то время удалять старые сегменты и в том числе удалять сегменты какие-то по требованию которые больше бизнесу не нужны то есть никаких акциях нет никаких рассылках не участвует да и сейчас получается у нас importer и консьюмер два сервиса пишет в одни и те же базы то есть один конструктор это importer и консилер для построения a real-time сегментов да и вот здесь как это выглядит сейчас то есть конструктор формирует матч на обновление то есть он пишет матчами сегменты фар формирует базис пользователя и получается на каждый сегмент формируется отдельный матч то есть сегменты обновляются не независимыми задачами то есть это не очень хорошо потому что получается на каждый сегмент нам нужно отправлять отдельные за запросы как бы и появилась идея группировать сегменты по юзерам обновлять сразу несколько центов за 1 absurd то есть за одну операцию обновления и этим будете заниматься сименс worker сервис тоже сейчас процессе разработки немножко осталось сделать совсем и как это будет выглядеть выглядит то будет так что imported будет отправлять пары сеть методе use ради в топик сегмент консьюмер будет делать то же самое а вот тир будет их вычитывать то есть и таким образом будет время от времени скажем так писать матчи в таблицу 7 издание соответственно связки тоже то есть мы ожидаем получения какого-то там профита ну и об общая схема сервисов она выглядит вот так в принципе я про них уже все рассказал так как бы такое самое большое и пробежимся еще еще раз чтоб в говорю утряслось то есть консилера используем для построения real-time сегментов да и для биржа game pe api отдает сегменты по запросу importer это конструктор сегментов да и плюс api по добавлению пользователей в сегмента есть любой сервис может нам вернуть ручку и добавить даче азеров сегмент экспортер это экспорт сегментов клик стати six это получение пересечений и пользователей сегмента гоца это чистка до цель с целью уменьшения веса на чем меньше часов соответственно тем проще учитывать быстрее и переписывать мы переписывать же сон когда тогда когда нам нужно обновить хотя бы один сегмент для пользователя worker эта группировка сити сегментов по юзеру в бочке с последующим обновлением так первая проблема с которой мы столкнулись это частая смена сессии их очень часто меняет тестовый аккаунт и то есть из за этого стола притормаживать операциями ржа сегментов потому что возникали очень большие связки в общем как мы это решили мы поставили и лимит на количество адэшников такой связке немножко изменили алгоритм нержа об этом нужно помнить что принципе могут быть пользователь который очень часто меняются сессии второе в общем когда у нас был один мастер содержащие в котором хранились сегменты да там как бы мы довольно таки быстро уперлись его лимиты нас инфо инфо и выставлены лимиты пустим на тот же диск то есть мы можем писать там то есть у нас есть ограничение на 17 к iops то есть выше его под поднять он не могут попасть на печен of the thames в случае допустим падение одной из нот чтобы можно было быстро восстановиться того поднять еще один из нас погреться другой тачки на чтобы было было достаточно ресурсов как бы эти ограничения общие для всех так ну и так как таблицы были большие да вообще мы время от времени стали вынуждены были выполнять pg репак для того чтобы сжимать таблицу сервис она росла репак выполнялся не всегда успешно длился 2 4 6 часов там так как запись была очень активный принципе нам приходилось вообще-то запись останавливать практике ну и мы решили пошариться на 12 пар в принципе это помогло еще одна проблема это лишнее перезаписывание сегментов то есть вы на этом на этом рисунке по вертикали это не запуска а обновлений да а по горизонтали это это каждый квадратик это грубо говоря день и и первый день мы убираем 90 дней допустим во второй тоже и каждый раз клика house про проходился по всем этим партийцам там у него партии цианирование под по дням и на это и каждый раз он возвращал очень много пользователей и всех мы их сохраняли очень плохо что мы сделали мы стали результирующий набор с пересекать пользовались с набором пользователь которые имели хоть какую-то активность буквально за последние два календарных дня это помогло немножко метрик до шар деньгам и имели такие показатели по epson елово-пиво рейдж оранжевый график они оранжевая полоска на верхнем графике это мастер уперлись в лимиты всплеск справа это экспорт клик ну вот его это у нас вот таким был да получается у нас 12 одержана каждой точке после шаринга у нас получилось что-то по таблице 7 разнеслась на smd и одним об стала седмица едим об стали храниться до как бы в разных местах да то есть здесь айди map и опции нет ой простите не достигает даже 3 до принципе это норм всплеска это тоже экспорт клик для нас это нормально но таблицах на серваках signals и abs и у нас принципе там на мастере не примерно 5 к до потребления на реплика там три ну и его решено соответственно такой на мастер реплики количество апдейтов до примерно на 2 с половиной трех к на мастерах в секунду в выводы какие мы сделали первое что закладываться на real-time сборку сегментов то есть по сути это подтягиваем попасть лямда туры то есть в этом случае надобность пересборки практически отпадает у вас второе что чем больше джейсон тем сильнее ощущается деградация скорости у нас есть экземпляры там пол гигантский la байт как бы если помните что большие джейсон и подвергаются механизму то стинга то есть под gri создает отдельную табличку тостадо которая хранит уже это в лесочке по 2 килобайты примерно он разбивает эти фактически у вас одно поле джейсон может быть на несколько страниц разбитых как бы ну не и неё не очень хорошо но для для нас норм обновлять сегмента лучше патчами этакий ну мы также экспериментировать по срочным моделью данных то есть нормализованный когда хранились и бинты в одной строке они в лесу на данный вариант приз пищу как бы потому что в в этом случае вы можете столкнуться сильная фрагментирован ностью данных то есть если мы и селекции все сегменты с джейсону там это может читать 5 страниц допустим ну в лучшем случае 1 а если он будет нормализованная модели у нас там будет 307 это поможет нам прочитать 50 и 100 и и больше то есть ну и последнее когда лучше несколько маленьких таблиц чем одна большая то есть грубо говоря сша sharing лучше делать потому что это проще обслуживать спасибо за внимание всем оси выявление вопросы спасибо евгении суда кварта меня такой вопрос при использовании шарден га возникали ли у вас проблемы с не только выбором сегментах но и допустим с их сортировкой или таких задач еще не стояло сортировкой вы смотрите наш шар ник у нас фактически мы его делали на клиенте то есть мы сделали посла там получается под по таргитай ди маре реализовали под таргитай дину принципе проблем никаких не было то есть мы даже за ложились на балансировку что потом можно было как какой-то слот перенести там новую моду как бы с сортировкой но данные не сильно фрагментирован и у нас там грубо говоря используется и you did the targeted это юдит они разбросаны по таблице понятно тогда еще одну дополнительную вопрос если можно когда вы формируете baci для актеров вы подбираете юзер как-то релевантная или они просто у самого по очереди идут смотрим мы получаем пользователь допустим из клика то и доли и дроби на bacci но для юзера димы призови этот паркет айди да то есть если его нет мы создаем получается создается в клиентском приложении то есть это генерить и далее в бачок когда направляется используется сортировка еще то есть мы сортируем затяну в во избежание де блоков если их не сортировать то можно ставить дизлайки как бы мы это и словили вначале когда так спасибо за доклад вопрос такое у нас есть сегмента который подклеили сжат мы добрались до стали юзеров из клика а вот дальше как у вас происходит то есть мы назначили код сегмент пользователь теперь нужно отобразить для него фронте там какую-то планочку либо скидочку то есть это куда-то должно пойти дальше по стрелочке ну смотри как сегменты лежат в прогресс если нужно по сегменту выполнить будете них применить какую-то там акцию даты и мешаем баннер показать скидку да то есть это этой от задач уже другого сервиса то есть у нас ходят какие-то сервисы другие там все весы связаны с маркетинговыми акциями там еще чем то там рекомендательные из они получают по use ради либо пососи сад сегментов в общем и далее там как-то это применяет у себя то есть это уже страна у нас как бы не касается вы только предоставляем сегменты вот вы назначили какой-то истину какому-то пользователю сегмент его записываете базу данных пользователей или вот или пользователь заходит на сайт у него по потоки ну либо там поедишь нику каждый раз идет туго пешку ваш соответственно для получения сегмента если там есть сегмент он ему отдается смотрит пользователь заходит на сайт как бы там такой относительно для длинных короткий путь то есть он проходит скажем так через но есть сервис такой называется composer в общем через него происходит там оба говоря скажем такой виджетов то есть поход вам в разные вертикали то есть он это как бы его страница это там куча разных виджетов за каждый виджет там может разные команды то есть и есть возможность себя там поставить какой-то iv чек на конкретный сегмент для конкретного виджета ну и помимо этого чая там еще и цену сделать да как бы и когда запрос проходит через этот composer да получается он идет в дивизии mpi передает нам юзера иди там либо сессии мы возвращаем ему сегменты также помимо compose равно сходят другие сервисы то есть как бы фактически гимпи это про то что просто создать сегмент сбил ведь и отдать эти сегменты по use ради либо саша леди вот так и коротенький вопроса почему не использовали для хранения сегментов писания что не специфично там для джейсона там типа типа магии почему в позвольте смотри тут классный в вопрос да многие из коробки же sharding то есть да вообще супер вообще изначально как бы там отцы-основатели темпе вообще ничего хотели aerospike ну потому что быстро то есть как бы но не не получили о прав на него кто то сказал что типа неновых как бы делаете типа пожгли что было был persistent манга как бы она в зоне не используется вообще то есть как бы под gris редис к игре щен не так давно появился aerospike и принципе на этом как бы практически все кое-где там есть тарантул очень недавно там стали использовать как бы так что ну к сожалению с манга нет мы проводили эксперименты с мангой да вот конкретно наша команда принципе по скорости примерно тот же самый путь глэсс проводил получается мог new не очень хороший там на маленьком количестве сегментов с распределенными транзакциями ну а мангу нас так как никто готовить не умеет нормальная и в несколько раз еще вел нерабочее состояние как бы ириш перекрестились решили что короче оставим на потом нужно научиться с ней работать инфа не поддерживать ну вот так спасибо у нас онлайн вопрос ну кто-то хочет еще на экране задавайте какой завод лучше вспышки так не очень слышно было так вроде бы первый вопрос нато на каких данных мы собираемся обмена дают сегменты мы собираем только на основе своих данных на только на собственный в принципе есть возможность поддержать а техники вручную но как бы клипа пользователи все а зоновские такого нет что потом кто какие то еще каких-то еще визиров строили катенину use ради как бы за генерации no use ради мы не отвечаем то есть для нас вообще как бритни бета как бы просто едешь к user1 происходит не менее это другая вертикаль делает то есть там при регистрации юзера того ему назначается use ради и все дальше уже умному как бы попадает как-то в день то есть когда мы читаем ивенты и сколько усатому либо и is where текке что-то selecting либо можно загрузить вручную айдишники через интерфейс да то есть но вот как то так ну причем как сегменты у нас есть папа анонимом принципе и парни на него но папа планируем это процессе им как бы сказать сколько сегментов там мы построена помпона не на пользу им я как бы не могу смотрите у нас получается нет интеграция с другими системами пока что то есть никаких там кубке sing of ничего такого конкретно вас вот такого нет спасибо спасибо возили последний вопрос спасибо за доклад скажите пожалуйста вот последнем вопросе как раз поднялась на тему которую я хотел уточнить как вы работаете с теми пользователями которые не дают согласие на обработку своей персональной информации по сути которых нельзя потрогать и которых нельзя добавлять сегменты спасибо так то смотрите перед выступлением доклада как бы это все там оговаривалось как бы те кто из пользователей инструмент то есть как бы да там все нормально должно быть как бы это мой перед переживать не стоит ведь мы не нарушать спасибо я вас обманул давайте еще и на вопрос вот молодой человек рвался в бой спасибо за доклад у вас был пример фильтра для сегмента где выбирается просмотр какого-то продукта вопрос какой проходит время между тем как человека просмотрел продукт тем как он появился в в сегменте и его увидели сервисы которые должны его таргетировать ну допустим он посмотрел продукт далее создается event какой тогда которую 0 попадает в 3 tracker здесь может уходить там допустим три четыре пять минут то есть зависимости от нагрузки на tracker как только это влетела в клик то есть уже можно как-то это выдернуть и создать сегмент как только в день ты записалась сегмент сразу же можно его использовать у нас там никаких каши нету нигде то есть как бы очень кажется и в итоге как во время получается что резника вы какую-то таки время чтобы сказать и проектом 35 минут сейчас услышал это попадание пользу пользователь что-то на сайте сделал полетел events то есть проходит как как там где-то тревожит около 5 минут и мы уже имеем только только после мы имеем информацию как на который на основе которой можно строить все сегменты бывает быстрее то есть бывает по разному вать прям моментально в среднем где-то 35 минут бывает очень быстро спасибо еще раз спасибо евгений поаплодируем подержим я не нужно выбрать лучший вопрос самое сложное в докладе выступали снова сложных x только было а вот 5 первый вопрос кто задал бог просто он был быстрый рост проденьте спасибо так у нас еще и есть подарки от озона то есть три ходе то есть тоже за вопросы хоть и хотели бы раздать а можно в принципе в кулуарах сделать ну хорошо давайте тогда под подойдите ко мне бы пока не уходи сейчас мы вас наградим спасибо начал россии по зато клад да друзья проходим в кулуары нужно скажем так проветрить ну а потом артем я бывший сейчас козуб огорчен обречены рядом с порезом знакомиться репка насколько заменялись в компании комплект безопасности приложений безопасностью приложений это что-то особенное не как сказать что-то особенно я стоял где-то такой важный момент который связывает собственно мер разработки и меры безопасности потому что зачастую как решаются себя себя люди делают безопасности это ребята которые не знаю периодически запускают какие-то сканеры уязвимостей и дальше приходит предположим к ребятам инфраструктуры с ослами ребята здесь не знаю какое нибудь узел мои приложения но обычно этих со сканера связанные с безопасности vendors кого по что если не знаю вы предположим на капельку им тапочки он black star вес если у вас есть компании своей разработка то разработчики пишет уникальные уязвимости которые сканер уже не найдут обычно это есть предположение знает о дженесс с которыми пользуется большинство компаний для удара бдительно нужен при собственно вот я пытаешься внедрять различные практики безопасные разработки поиска узи масти собственно в разработке который ведется в компании работает и в чем заключается процесс какие мы пользуемся различными во-первых с камерами которые именно сделаны для практичности курить это статический анализаторы к 1 безопасность мимический анализаторы кода на безопасность различные сканер зависимостей которые проверяют и вообще фреймворке какие библиотеки используются и все ли там хорошо безопасницу также свои большие инструмента не слизь какая-то специфическая позже логика который не может осилить динамический анализатор из коробки то есть предположим тот же групп sief enterprises юта прокаченного любовь писать enterprise они не всегда могут качественно проскочить на безопасность то есть например динамический сканеры как работают они отправляют какие-то приводы с кавычками и дальше смотрит такой ответ пришел и не всегда таким сканером предположим по зубам какие-то специфические приложение какие-то специфичных запросы и предположим одних мы пишем код свою логику и также проводим ручное тестирование потому что 1 делает безопасность когда не знаю какой нибудь кавычки ты можешь зайти под админом другое дело то что есть должен какая-то бизнес-логика и предположим она может немножко несерьезная реализована и уже предположен какого-то типа узи масти надо проверять рука ну и также проводим какие-то тренинги и пытаемся всячески просвещать разработчиков помогает правильно составлять техническое задание консультировать на каких моментах не могли подумать как это сделал безопаснее на моменте именно дизайн ну вот именно когда ты проводишь покидали глюкозу так а вообще существует что ты учишь бочков как писать код так чтобы было безопасно бы не было уязвимостей мы проводим тренинги с точки зрения любви кода мы спали используем подход грей бокса тестирования когда мы одновременно имеем исходный код приложения положим понято дебаг режиме и дальше предположим отправляем поднимаем приложение локально подключаемся к и пешки и дальше смотрим а также на себя пойдет тот или иной пилот который мы отправились клиента и как он пройдет в приложении вот примерно с точки зрения такого региона безопасно ну плюс поиск каких-то типичных небезопасных функций который практически во всех языках программирования есть различные магические методы и валы которые ну плохая идея использовать нам разработчики периодически во всех компаниях что-то использовать бездумно хотя не знаю вы х мануале к их языку написано что ребят если вы это используете на десять раз по дому но не всегда там устроит 10 раз подумайте собственности такие функции мы тоже ищем глазами если только ложь а вы по каким то причинам с этим не справилась них статический анализатор но чаще всего статические анализаторы справляются с таким review еще мне кажется и часто встречали такое отношение к безопасности что это ну какие то просто формальности перестраховки паранойя нет ну я в принципе наверное могу конечно вообще что штаты перестраховки паранойя но если у вас есть команда ищем security который занимается именно безопасностью вашего приложения вашего кода то мне кажется разработчикам если они научатся дружить и правильно понимаете эту команду станет легче жить потому что куда наверное проще когда теперь принесли уязвимость которую нашли еще на стадии тестирования на кстати стоит жара чем когда какой-то хакер вынесет знает что-нибудь через приложение перебежит бизнес а посреди ночи сослали надо срочно что-то фиксить мне кажется ну ты запишешь верить помогает чуть спокойнее жить разработчик ну вот как на твой практики по них это доносить как мы это объяснять приходится на самом деле в большинстве своем я сталкиваюсь разработчики которые сами хотят винить антиса них просыпаться потому что очень быстро до людей доходят то что если самостоятельно в этом всем разобраться если самостоятельно вникнуть и приходить ко мне по любому вопросу и консультироваться то скорее всего у них получится написать безопасный код и и когда он едет до меня что а там уже будет минимальное количество проблем и им не придется это исправлять здесь же есть какие то еще не только какую потребность безопасности какие-то еще требования регуляторов например да конечно конечно требование от регуляторов есть мы например и компании adss компанец и мы собственно должны использовать вот все что связано с жизненным циклом безопасных страховок это и нам статическими завтра динамически это можно подходить к этим требованием абсолютно по-разному и соблюдать их по-разному мы стараемся дамы эти кривые соблюдаем мы но мы стараемся делать больше чем у требует регулятор потому что же больше очередь да потому что это надо не для того чтобы быть вся действия компании да понятно это надо но в первую очередь как бы это безопасность который влияет и на нас и на наших клиентов и мы хотим предоставлять качественный безопасный продукт может быть расскажу какими надо скиллами будет чтобы заниматься тем чем ты занимаешься наверное понимать собственно как пишется код как работают приложение понимать собственно пока путин база данных как строится запросы как наверное работает уязвимости и общем и целом как как работает как работает в приложении потому что надо во первых еще но не определенную фантазию и наверное желание бесконечное желание узнавать что-то новое ну вообще звучит вроде как что это надо уметь чтобы уметь разрабатывать тоже я милую может взять особенности чтобы именоваться иметь нюх на безопасность и если я мне меня верны сложно про это судить потому что это ведь про себя и про друзей и коллег но я наверное мне сложно сказать что безопаснее чем заключаются но возможно это просто какой-то специфический специфическое мышление с большим желанием столько сломать но она но мать она опять же без с одним желанием что-то сломать мне кажется их нельзя а поскольку надо еще понимать собственно как написан код потому что одно дело отправлять кавычки облака боксом когда ты видишь незнакомец сайтик и просто кидаешь кавычки другое дело разобраться и распутать общее а что же происходит на может быть даже небольшой короткий ликбез такой вкратце я пару советов как писать так чтобы у тебя было меньше вопросы к разработчикам ну такие его наверное самый главный совет это хорошо знаете язык на котором ты пишешь если есть какое-то сомнение по поводу использования той или иной функции пойти и еще раз прочитать на сайте посвященном второму языку про это например для php в большинстве большинстве функции если они предположению безопасные как же антирия life большими красными больше большой такой текст выделены красным или были сказаны не использовать это функции если бы именно не понимаете что она делает не понимаете как сделать я безопасны 1 верное основное то самое главное просто и хорошо знать язык и также читать материалы про то ниже а такие специфичные для того языка и вообще насколько того чтобы хакерские скилл и прокачано безопасника интересная грань что вы едите и те и другие должны иметь и умеет что-то похожее но мне кажется что хороший безопасников должна быть с очень хорошей хакерских строить потому что в любом случае когда от ее работы ощущение какой-то компании и занимает съезд зачитать если ты не понимаешь как ломать ты вряд ли поймешь как защищать туда так ну ладно спасибо тебе за рассказ пусть расскажу пишут безопасный код и чтобы проблем было поменьше и возможно когда это это будут продолжаем наш highload тема коротко и ясно надежные быстрый бы копай на по сгорел es que el расскажет нам об этом daniele за хлыстов из самого яндекса поприветствуем друзья 1 2 всем привет так слайда видно меня зовут данил зав и став я хочу сегодня рассказать о том как мы в команде индекс облака делаем бэкап и погреться немного более надежными и быстрыми на самом деле хотелось начать с того что этот доклад уже далеко не первый это у нас целая серия докладов которые мы докладываем про нашу утилита для резервного копирования который называется во лжи и поэтому в этом докладе я не буду останавливаться на каких-то базовых вещах а я буду рассказывать о сном про новые фичи поэтому те кто хочет деталях ознакомиться можете посмотреть предыдущие доклады сейчас я сделаю небольшое введение для тех кто возможно ещё не совсем в теме резервного копирования если вам нужно просто перенести данные с одного кластера подвеса на другой вы можете использовать консольную утилиту которые из коробки с подвесом называется пиджи дамп она сделает логическую копию данных какие у него есть преимущество она не зависит от версии под gres вы можете перемещать даны между разными версиями без проблем вы можете брать только те данные которые вам нужны тоже большой плюс но если у вас все серьезно и вам нужно восстановление на точку во времени вам уже нужно не логическая и физическая копия и в подвесе нам повезло есть тоже функционал готовый api оказывается пиджи start backup что он делает он создает чекпоинт контрольную точку нужно для того чтобы привести данные на диске в актуальное состояние также на время создания backup мы включаем full пожрать это нам нужно для того чтобы если страница была изменена в воротах и блок сразу пошла полная версия змеиной странице это такая небольшая защита от кэша файловой системы если у нас кита данные не актуализировали со время чик point а также мы записываем его сын начала быка по он нам понадобится в дальнейшем ну конечно я думаю многие из вас знают что просто вызвать 500 бэкап и скопировать файлы недостаточно для того чтобы восстановиться . во времени нам нужна физическая копия файлов плюс посоветовал сегментов начиная с н начало быка по и заканчивая . и времени на которую мы хотим восстановиться и чтобы не делать все это дело руками не вызывать пиджи start backup не копировать файлы не находить вал сегменты у нас в прогрессе опять же есть хорошая консольная команда в коробке который называется пиджи боевиков по сути она использует тот же самый jester кпп и с помощью нее вы можете очень просто создать резервную копию физическую но нам конечно всегда хочется немножечко большего мы хотим сжимать наши бы копаешь чтобы не занимали меньше места мы хотим параллелизма чтобы ускорить снятие и восстановление из бэкапов мы хотим и шифрование чтобы в наши бэкап и никто не заглядывал посторонние мы хотим троттлинга ресурсов чтобы снять и backup а нет ни мало слишком много процессор ных ресурсов может быть дисковых может быть сетевых ресурсов sh100 с которого мы снимаем backup также мы хотим удобный инструмент для митинга для управления пикапами например мы хотим хранить только бэкапы за последние 7 дней и хорошие новости внезапно у нас есть круто и вакансия бы каталка которая называется вал dji.com написано на гол и она по сути большую часть всех этих вещей умеет делать по сути был такой небольшой introduction счастье расскажу что вообще во лжи нового 1 фича про который я хочу поговорить называется верификация конкретности истории white hat logo она называется сложены но по сути своей очень полезное простая если мы посмотрим на пример топологии кластер высокой доступности с архивом мы можем увидеть здесь то что мы в данном сценарии снимаем backup из реплик и архивируем волс мастера и нас в контексте данной фичи будет интересовать именно пункт с архивации вал поднимите пожалуйста руки кто уже пользуется во лжи возможно после этого доклада вас станет больше вот кто уже пользовался вот же я думаю настраивали архив mod archive команд и по сути что делает во лжи он при выполнении archive команда загружает вальсы комменты в облачный архив его сегменты просто лежат там таким же набором файликов по сути в название каждого сегмента она состоит из двух частей первая первая часть содержит номер той майна а вторая часть содержит lsn для тех кто скажите кто вообще знакомы с понятием таймлайна в прогрессе так хорошо тогда я не зря сделал следующий слайд зачем вообще нужны в прогрессе timeline и предположим вот вы у вас все было хорошо вы там делали бэкапы вам внезапно понадобилось восстановиться два дня назад и для того чтобы вы не перезаписывали историю после восстановления из бэкапа описали новую в здесь есть понятие timeline of и когда вы становитесь bacopa у вас timeline интернете на единицу то есть на картинке у нас вот было допустим было восстановить с бэкапом глупость что угодно например свеча вера или файл over и у нас начался новый timeline и соответственно в архива сегментов у нас появились вал сегменты с тайманим 2 ну конечно вот этих двух вещей не достаточно чтобы погреться потом проиграть непрерывную историю вас сегментов подвеса нужно еще знать в какой конкретный момент произошло переключение т.е. лосин переключения для этого есть специальные файлик с метаданными которые называются time on his three файл соответственно в нашем случае был записан файлик у которого timeline 2 . history можно посмотреть что в этом файлики вообще внутри содержится для этого даже в облака далеко ходить не надо можно зайти просто в папку переживал посмотреть если у нас танки to his three фабрики если вы уже с вы уже было переключение таймлайна наверняка они там есть вот и а также данном примере у нас есть h 3 history файлика давайте посмотрим что в четвертом в четвертом у нас видим три строчки до в каждой строчке у нас содержится некоторой информации а именно у нас сначала индификатор таймлайна с которого произошло переключения lsn на котором произошло переключение и комментарий в произвольной форме соответственно мы видим что на этом примере у нас до 4 таймлайна есть история с тремя переключениями первое приключение было вот с первого на второй в первой строчке во второй строчке со 2 на 3 и 3 строчки 3 4 так ну и какие вообще с этим всем делом могут быть проблемы первая проблема которая часто бывает в кластерах высокой доступности если у нас какие-то появляются проблемы с его связанностью еще на это накладываются неправильно встроенный сервис координации вроде за кипера у нас может быть ситуация называется сплит brain по сути что может произойти в результате это то что у нас в облачном хранилище попадет новый time line 6 хотя у нас актуальный той майн остался 5 и несмотря на то что автоматика должна быстро погасить 2 мастер в облаке нас останется лишь не поймай на которых дальнейшем может вызвать проблемы который нам не нужно соответственно мы можем делать простую проверку на неизвестные timeline и как она будет работать мы просто просканируем все загруженные timeline и и посмотрим вот у нас допустим есть timeline с индексом меньше чем текущий поймаем кластера мы его оставим текущей монтаже в принципе не вызывает никаких сомнений то что он у нас валидный а вот какой нибудь timeline у которого индификатор и выше чем текущий может означать что у нас произошла какая-то нештатная ситуация это что требуется участие оператора человека чтобы он посмотрел точно ли там все в порядке у нас с кластером следующая проблема которая может быть это недоступность в остальные . во времени как почему это может случиться у нас может быть утерян либо один вал сегмент либо файлик с метаданными history файл и обе этих причины могут вызывать и недоступность расстоянии . времени потому что мы не сможем поиграть последовал сегментов нас будет дырка и как мы это можем проверить что у нас нет этой проблемы мы можем просто узнать секущей the man текущей лосин и пройти по вал сегментом назад во времени используя time he is 3 файлы переключаться по поймай нам и так дойти до самого раннего bacopa если в ходе этого обхода мы не нашли никаких лишь не нашли никаких отсутствующих вал сегментов это значит то что у нас есть возможность выполнить party time recovery начиная от самого раннего bacopa и заканчивая текущем и лосином знаешь все хорошо как собственно использовать эти проверки для этого мы сделали команду новый вал джек которая называется волдыри фай она краски призвана выполнять проверки состояния архива вал в облаке для того чтобы провериться на неизвестные этой мой не нужно использовать проверку который называется твои main все просто на скрин на примере видно то что мы запускаем проверку timeline у нас текущей этой момент просто это 4 максимальный который мы нашли в этом в облачном хранилище тоже 4 поэтому все хорошо статусу кей для того чтобы проверить доступность point in time recovery мы запуск который называется int и агрессия тут видно как работает она сначала находит самый ранний backup который находится в торджи и потом сканирует по цветности вас сегментов на предмет берг и видим то что на скрине тоже все хорошо она нашла три таймлайна и среди них не нашла ни одной дырки то есть у нас 2 3 4 timeline статус в них окей так ну и используете провели проверки можно начать спать немножечко спокойнее ну чтобы спать ещё немножечко спокойнее можно использовать следующую фичу которая называется верификация checksum страниц вообще зачем вам нужна кеес проблемы ну за проблемы далеко ходить не надо проблема это коррупции если вы из внезапно зашли и увидели у вас в воде под gresso вот какие-то такие похожие ошибки это может быть признаком того что вас в кластере произошли коррупции данных и причин для коррупции на самом деле быть может быть множество это могут быть проблемы с дисками проблемы ошибки в микро программах проблемы с файловой системой баги и ошибки в паз гресия такие тоже могут быть внезапно ошибки в процессе репликации баги в со все которые вы делайте бэкап в общем причин просто множество и на самом деле в подвесе начиная с версии 9.3 уже все обо всем позаботились там появились чиксу мы и в праздничных файлах в заголовке каждой странице есть специальное поле которая называется педи тип сам и там хранится чип сумма страницы с помощью которой можно убедиться что страница не была повреждена ну казалось бы все хорошо но какие с этим могут быть проблемы проблема заключается в том-то даже если в кластеры у нас включены checksum и то мы можем узнать о коррупции данных только момент обращения к данным и либо если мы специально запустим проверку щека сумму по всему кластеру таким образом мы можем иметь поврежденные данные но мы можем у них не знать довольно-таки долгое время пока не попробуем к ним обратиться и может даже найти того что эти данные по буду склонен backup поэтому важно проверять checksum и при снятии bacopa собственно теперь можно это сделать и во лжи нужно просто добавить флаг verify к команде backup уж ну либо в конфиге указать соответствующий параметр тру это позволит определить потенциально проблемные backup как можно раньше случае если при создании бэкапов же заметил что в каких-то из страничный файл и cove у нас не совпали чип суммы он запишет эту информацию метаданные bacopa чтобы потом мы могли этим воспользоваться ну и теперь можем спать немножечко ещё спокойнее потому что у нас есть еще и проверка checksum вот после того как мы убедились что наши backup устали немножечко более надежными мы можем сделать их немножечко более быстрыми а именно использовалась обратно распаковку дельта бэкапов вообще сначала расскажу в принципе что такое у нас во лжи дельта бэкапы мы используем называемая lnb из дельты как они работают предположим у нас есть какой-то базовый бэкап и мы хотим сделать дельты backup начинаем процесс быка по и идем по файлам постраничный файлом идем по первому файлу и смотрим по каждой странице lsn страницы и если у нас сын страниц и больше чем сэм конца прошлого bacopa это значит устраниться поменялось это что нам нужно включить ее в кольцо проходимся так во всем файликом и у нас составляется такая карта измененных страниц после этого для каждого файла по этой карте мы составляем дельта файлы который у нас и пойдут в backup до затем поставок у нас есть какая-то цепочка из дельты бэкапов чтобы восстановиться из последнего быка по нам нужно совершить следующие действия сначала распаковать полный backup затем распаковать дельта бэкапы и так далее по цепочке пока мы не дойдем до последнего дельта backup а какие вот могут бы тут проблемы я думаю тут видно то что мы некоторые страницы перезаписываем и тем самым мы делаем лишнюю нагрузку на диск а это что делает это замедляет время восстановления из бэкапа как мы можем это оптимизировать мы можем избавиться от лишних перезаписи мы можем сначала распаковывать последней даты backup дальше предыдущий и так записывай страница только те которые которых у нас еще нет итак доходить до полного бака по и в конце у нас получится тоже сама восстановлен data backup насколько все это сделало быстрее работает ну можно посмотреть benchmark я выдержку сделал таким небольшим графиком по оси y у нас нагрузка на диск по оси x время и слева можно видеть распаковку дельта backup а в обратную успокою а справа стандартную распаковку для бэкапа и можно видеть что обратная распаковка справляется в разы быстрее как все это дело включить довольно таки просто нужно просто добавить флаг riverside антек команде бэк-офис либо в конфиге дописать во лжи и us reversing равным труб ну и тут приходит сразу же небольшой такой бонус на самом деле использую обратную распаковку страниц некоторые архивы промежуточные из пряжи тельцы могут содержать страницы могут стать полностью и страниц который нам уже не нужны а это значит что мы эти архивы можем упускать их загрузку и для того чтобы включить этот режим нужно у волшебников и добавить еще 1 факт skip arredo don't tires но чтобы эта фича работала эффективно при создании backup а нужно также использовать рейтинг composer чтобы он мог предсказывать какие страницы меняются часто и стараться и группировать в отдельные tar архивы чтобы повышать вероятность что мы при восстановлении с обратной распаковкой их пропустим так ну и как нам все это дело попробовать у себя как я уже говорил достаточно просто зайти в нашей базе торе и на гитхабе не забудь поставить звездочку и скачать последний релиз потому что пока что еще релиза со всеми перечисленными фичами полного не было а вообще у нас еще есть много идей поэтому если хотите поучаствовать в разработке крутого проекта приходите к нам мы всегда будем рады новым по трибьюта рам и всегда будем рады по reviews ваши pull request а вот спасибо теперь это понимаю часть с вопросами спасибо за доклад вот несколько раз упомянули о том что мы будем спать спокойно связи с этим такой вопрос вот из слайда я понял что эта информация о том что произошло с бэкапом она в какой-то джейсон выгружается до мониторинг есть какой-то встроенный то есть метрики после выпуска метался или еще чего нет у нас есть во лжи метаданные bacopa которые хранятся рядом с бэкапом это просто такой же сон файлик и сверху мы ничего еще не прикручивали к нему вы можете все прикрутить это свою обвязку чтобы посмотреть на это в общем нужно славе что то придумать что реально спокойно все про им спасибо вот там человек руку по нему спасибо за доклад а у меня такой вопрос по поводу можно ли например вместо того чтобы прогонять изменение самого конца эти дельты бэкапы как-то объединять до на самом деле в других бак опилках например пиджи пробег of есть специальный функционал который позволяет объединять после дтп кпв один и на самом деле мы тоже у нас есть планах когда найдутся свободное время лев может быть найдется какой-нибудь талант не вы человек который захочет это сделать мы будем рады такому парик месяца который бы позволил объединить несколько последних даты бэкапов у нас есть кстати мы участвуем google summer of code и поэтому если среди аудитории есть студенты которые планируются хорошо провести лето и получить стипендию от гугла и поучаствовать в прикольном проекте приходите к нам на google summer of code у нас есть много прикольных идей и вы можете хорошо провести лето спасибо да здравствуйте спасибо за так вот хотелось бы узнать о обратные бэкапы мы не получим в конечном итоге не консистентные данные когда накатим бэкап и не учтем предыдущие изменения спасибо ну смотрите тут такая схема то что мы когда распаковываем 20 вернусь на слайд назад когда мы распаковываем дельта backup в обратном порядке у нас такая схема в том то что у нас последним дайте бэкапе самая новая версия страниц и по сути версии этой же самой странице более старые они уже устаревшие нам они в принципе уже не нужны то есть пропуская и загрузку мы ничего не теряем потому что у нас уже есть более на аверсе и по сути мы не пропустим любом случае никакой никаких данных там просто человек хотел что добавить в одну ну и ним дельты бэкапе хранятся изменения от полного бака по о нет нет нет у нас есть целая цепочка и последнее дтп к пятнице изменяет последний директор ну мы ж не знаем просили на дельта когда накатываем самый последний backup почему нет когда мы закатываем сам средний backup у нас краски с текущей схеме само небо копыт astron среднего дельте backup мы его знаем мы знаем всю цепочку от последнего да и табака по до полного бака по мы ее знаем изначально поэтому можем пони пробежаться так все я понял пасибо большое спасибо за доклад я правильно понимаю что а вот же это так называемая теплая backup а то есть у нас есть какой-то базовый бэкап и за счет а пока погонщиков мы как бы ну делаем какой то бэкап и потом должны накатить на базу и backup эти мальчики это первый вопрос второй вопрос какие стороны поддерживают ваш волги ну допустим ну я правильно понимаю что для создания дельта backup а он должен видеть все бэкапы который создавал то есть если у нас из 3 хранилища да куда мы выходим на можем ли мы вот использовать его нативно спасибо да конечно так начиная с первого вопроса да совершенно верно нужно сначала накатить ну вообще для того чтобы собака по нужно иметь все бэкапы начиная с полного и вот по цепочке до этой дельты это нужно знать вот ада по сторожем получается у нас во лжи одна из кирпич это то что у нас есть поддержка различных облаков например с 3 совместимы с google cloud storage вот никто николай самохвалов давно делал прикольный доклад называется над пропастью во лжи где он рассказывал как они прикольно заводили чинили во лжи google cloud storage вот поэтому у нас это одна из киллер фичей то что мы очень хорошо описал облака вот да спасибо и еще вопросик у вас получается бинарная бэкапы правильно то есть для того чтобы восстановить ваш backup нужен postgresql той же самой версии с которой снят и да копы ну для того чтобы оставить наши backup вообще получается да нужно его у нас составляется просто впустую директорию и потом конечно же нужно тоже такая же версия мажорная погреться которая была при создании урожденный пока мира да я и так слышно трансляции возможно люди не услышит давайте пролистаю назад этот садик краста кипра информацию которую мы получаем поврежденным страницам мы смотрим на поврежденные блоки вот у нас если посмотрите например у нас есть в личном файлики для каждого страничного файла такой вот словарик с поврежденными блоками там показываются сам корабль blogs и просто их номера по сути используя эту информацию можно найти конкретно какие данные по здесь и были повреждены вот но говорил у нас еще не к автоматике нет это скорее так просто как мета информация которая уже нужно для того чтобы в ручном режиме потому что все таки коррупции слава богу ну не так уж и ежесекундно встречающееся явление как то попытаться что-то починить вот то есть сейчас покажу вот если посмотреть здесь на ошибку как раз таки написаны валит ph блок и of relations bass и директорию ну и путь к страничного фабрику на диске вот и мы во лжи также записываем и тот же самый путь и просто говорим еще какие блоки по этому пути были повреждены нет странице считается поврежденный когда у нас у нас и специальное поле в погреться встреч на файла каждой страницы в заголовке есть специальное поле чек суммой и получается мы когда проиграем чук сумму мы считаем чип сумму всей страницы но за исключением полищука суммой чтобы как бы не было никаких проблем вот и сравниваем со значением которых нет в чек сумме вот если у нас что повредилась наса что сумма не совпадёт и мы скажем что страницы повреждена ну слушайте возможно есть но я вот сегодня рассказывал про этот других методов насколько насколько мне известно я не знаю других ментов ну получается сумма в лесу щи у нас будет расхождение чиксу мы и и посчитаны чем сумма даже если мы удалим чип сумму тоже не совпадет с тесном а если пропадают страница полностью вместе с чек и знать со значением тех суммы и skidata как бы узнаете такую аварию когда теряется полностью страница вопрос понятен так понятия ноздри а смотря что значит под теряется потому что достаточно съесть кита байта на диске которые мы пытаемся прочитать по адресу то есть она потеряться никуда не может и мы просто нас будет ошибка чтение этой страницы сразу же моментально страничного файле но даже не может просто уйти куда-то словно говоря мы всегда знаем конкретно где она должна находиться средства когда мы пробуем почитать мы просто получим то что нас не сопрет checksum а вот и все там вроде еще в заголовке есть специальные magic биты который позволяет убедить в том что страница вообще что-то мне совсем полная каша написано спасибо за доклад я правильно понимаю что вот эти вот дельты дельта wolof она дает какую-то эффективность только для will типе где переписываются данные для data warehouse а не тот не для data warehouse а где данные только добавляются правильно да здесь все данные только добавляюсь это будет не так эффективна чем при перезапись здрасте спасибо за доклад у меня такой вопрос вы приводили график сравнения производительности можно по нему вернуться до сравнивали вы производительность вашего решения с другими конкурентными решениями ну и досадили я думал сделать водопад какую-то такую секцию со сравнением но как-то решил что все чтоб мериться не стали еще сравнивая с другими вот если интересно можно как-нибудь попробовать забудешь моргать вот пока что директ находил будешь марков таких сравнительных это просто надо тестировать и сравнивать до вас timeline вашего решения есть было бы круто увидеть timeline конкурентов сравни с вашим да было бы круто мы тоже думали спасибо еще вопросы спасибо за доклад доклад подскажи а при потом при таком подходе если необходимость делать периодически полный бэкап и да как правило мы сделаем полный бэкап и через семь лет то есть у нас чтобы эта цепочка не раздавалось до больших размеров мы делаем каждому полный backup каждый сингл я дополню свой вопрос про производительность я если вы делаете бэкапы каждые семь лет то вот здесь это подозреваю время восстановления за какой-то не очень большой период если у вас вот скажем 6 половиной лет сколько времени будет восстанавливаться mockup из такой цепочки нет посмотрите у нас как правило дкб как делать ежедневно то есть нас максимум будет вот там недели разницы то есть таких длинных цепочек 6 половиной лет правильно ну вы сказали что полный backup нужно делать 1 7 лет del революционное я снимаю за вопрос спасибо отличная практика 1 7 лет делать бэкапы вообще не нужны 1 7 лет существенно это так это интересно здравствуйте и спасибо за доклад интересно узнать стала как вы получили это число именно 7 дельты то с чем связано да просто чтобы раз в неделю у нас был полный backup окей спасибо я думаю все нанял спасибо за доклад вам спасибо за вопросы осталось самое сложно выбрать лучший вопрос классика жанра так мне на самом деле подавись просто вот этого человека и честно говоря забыл как его зовут вот как зовут олег олегу вручается книжка интересно с картинками себя проходит кулуары если какие-то вопросы только появится можно всегда задать спикеру добрый день меня зовут александр сергиенко я ведущий разработчик направлении потоковой обработки и больших данных компания flex наш компании имеет более чем 15 летнюю историю и обладает обширной экспертизой в области финте х банковском секторе сфере кредитных бюро не секрет что этот сегмент айти является одним из самых технологичных и требовать иных с точки зрения объемов данных скоростью обработки тайну market масштабируемости отказоустойчивости вместе эти требуем дают разработчикам широкие возможности для технического творчества и применения новых концепций подходов и технологий в этом tech talk я бы хотел посвятить тему монетизации кредитных историй и выделить наиболее яркие с технической точки зрения моменты с которыми мы сталкивались в проект компания flex связанные с построением аналитической платформы крупнейшего российского кредитного бюро позволяет раскрыть тематику обработки и колоссального объёма данных на фоне высоких требований к отзывчивости стабильности и горизонтальной масштабируемости системы законодательства российской федерации обязывает финансовые организации передавать сведения о кредитных историях заемщиков в так называемые кредитные бюро каждый приобретенный кредит будто покупку нового автомобиля или ипотека каждый платеж или просрочка даже сам факт запроса отчета по кредитной истории выполнены через интерфейс на web-сайте все это становится частью истории и входит в обширный и непрерывно расширяющийся массив данных кредитного бюро случае рассматриваемой аналитической платформы речь идет о сотнях миллионах хранимых кредитных историй и связанной с ним информации каждый день как git на игру обрабатывает десятки миллионов запросов отчетов по кредитным историям сотен гигабайт новых изменений от кредитных организаций и формирует миллионы вы до мнений о полученных обновлениях для банков клиентов в основе бизнеса кредитного бюро лежат три типа продуктов обслуживание запросов отчетов по кредитным историям анализ изменений в историях и формирования уведомлений различных типов это так называемые триггеры а также оценка заемщика с точки зрения его надежности и платежеспособности так называемые ско ринге триггер это некоторые события который является реакцией на то или иное изменение в кредитной истории чем меньше временной отрезок между изменениям и производным событиям тем выше вероятность успешной монетизации этих данных рассмотрим реальный пример михаил открыл счета в банках каждый из которых занимается потребительским кредитованием оба банка охранят кредитной истории своих клиентов в одном и том же кредитным дыру но банк номер два назовем его best best offer дополнительно приобрёл продукт триггеры в отношении ряда своих клиентов в том числе и нашего героя михаила михаил приобретает в кредит новый смартфон и по случайности для расчета процентов и переплат обращается к менеджеру банка номера gtin клиентам которого самый является банк запрашивает кредитную историю михайлов бюро и после получения ответ и предлагает ему кредит под восемь процентов запрос кредитной истории от банка номер один также является ее частью аналитической платформы бюро обрабатывает запрос с точки зрения триггеров и генерируют уведомление для второго банка то есть банка в с best offer который ранее приобрела соответствую услугу реагирую на полученную давление банк номер два присылает михаил с мсс выгодным контур предложением кредита под более низкий процент и клиент с радостью его принимает рассмотрены сценарий описывает лишь малую часть возможных вариантов монетизации данных по кредитным историям ходе анализа требований и предпроектного обследования анти ландшафта кредитного бюро мы поняли что технический 100 кв asdasd а в основе которого лежит симбиоз уже ставший классикой big data и потоковых подходов к работе с данными может решить существующие проблемы и дать бизнесу возможность реализовывать принципиально новые продукты при разработке аналитической платформы критически важными для нас являлись следующие требования первое это снижение той тумаркин для новых продуктов второе переход от пакетные к потоковой обработки и real-time продуктом с минимальными задержками обработки третье внедрение технологии машинного обучения и жизненные циклы разработки моделей так называемый м.л. abs для задач с салинга и 4 надежность гибкой горизонтальная масштабируемость и высокая отказоустойчивость платформы на достижение поставленных целей мы применяли лучшей практики devops и м лег сработаем среди истории моделей мой flow и тепло и рисуем процессы сессии день используем современные фреймворке библиотеки потоковый как встретилась так и state hwy обработки данных дать bank light flow апачи клинка почти spark of the streams пируем до толик на базе hadoop используем apache cassandra для оперативного хранения данных и c в качестве хранилища файлов масштабирования отказоустойчивость обеспечивается рядом подходов и технологий в основе которых лежит платформа артист рации контейнеров и падших центральной части топологий аналитической платформы находятся высоко нагруженные потоковые приложения которые также называется под лайнами они разработаются использую приборка апачи frank который располагается под зонтом продукта удачная регистрации разнородных потоковых сервисов которые двоится live band клауд follow the tour платформы полностью соблюдают концепции реактивной архитектуры взаимодействие между отдельными сервисами и поль планами полностью асинхронно реализовано с помощью пачиков к политическая платформа разделена на технологические под модули которые обладают слабой связностью независимо масштабируются и строго изолированной можно выделить следующие основные модули аналитической платформ первый это pipeline и поговорить на обработки данных которые обслуживают процессы захвата анализа и трансформации входных данных 2 этапа система master data management of которые идентифицируют изменения или запрос и определяет к какому субъекта кредитной истории он относится 3 этапа клайн и триггеров и поклонись корнаков это основные и самые нагруженные потоковые приложения платформы которых служит соответствую бизнес продукции в том числе оперируют модели машинного обучения в скоринговая система выявления изменений и формирования гектору в данных для бизнес-парк line of и модели обучения это наш последний под модуль источники данных романтической платформы можно разделить на два сегмента первый сегмент это онлайн поток который включает запросы скоринга и отчеты по кредиту истории помашу these руется в платформу при помощи rest api а и построенном на базе этой клики клок этот поток обслуживается стекла с микро сервисами и выделенными pipeline амин основе live band клауд лу и а к стримить на данный момент они обрабатывает около трех с половиной 5 миллионов запросов в сутки второй сегмент источников это пакетные данные которые состоят из файлов с изменениями по кредитным историям пакетным запросов спаррингов отчетом по историям а так же с сервисным файлами которые обслуживать бизнес продукты платформы например списке клиентов для отслеживания в отношении триггеров этот сегмент обслуживается высоко нагруженными потоковыми приложениями на основе apache пинг и в данный момент обрабатывать около 80 миллионов изменений в сутки с неравномерным распределением нагрузки с пиками до 15000 событий в секунду каждый сегментов и модули аналитической платформы спроектирован с учетом гибкое горизонтальным что беру имости пакетные до мы 2 сегмента анализируются и разделяются на отдельные события с момента появления такого события платформы функционирует в рамках событий на ориентированной архитектуры каждое обновление или запрос проходит идентификацию в подсистеме master data менеджмент и обращается средними о субъекте изменения эти обогащенные дискретные события в потоковом режиме передаются в подсистему выявления изменений и далее обрабатывать специфически в зависимости от типа при обработке изменения кредитных историй рассчитываются дэн ты так называемые состояние было стола и соответствии с текущими настройками формируются новые события для дальнейшего анализа в pipeline их триггеров и формирования онлайн уведомлений для клиентов бюро давайте вспомним наш кейс с михаилом его покупкой подсистема оперативной обработки событий также занимается расчётами викторов так называемых печей для моделей спарринга при поступлении запроса на scaling вектор извлекать из оперативного хранилища и подается на вход модели бёдер из запроса сама же модель при этом за diplona как обычный под кластера опыт shift разработка модели машинного обучения для сколько выполняется в отдельной области так называемой аналитической песочнице это 1-ый класс строкам shift и инсталляция cf или hadoop оснащена инструментами для работы специалистов в области дата сайнс проект гипотез валидации моделей а также механизме вынос и модели в продакшен на базе репозиториев модели и мой flow результаты работы бизнес сегмента фанатической платформы то есть результаты запросов кредитных историй сколь инков а также события по триггером могут передаваться при этом в режиме онлайн через и пео или с помощью services and events или пакет на с помощью файлов механизм получения результатов зависит от возможности и потребности клиента и никак не ограничиваться стороны платформы в ядре тех логического стыка платформы лежит фреймворк артист рацией гетерогенных потоковых park live live band плавать flow фактически это точечный фреймворк объединяющую кубер найти с операторы apache spark а почерк pink & ака который позволяет строить разнородной с точки зрения бэкенд pipeline в контексте единого метаописания и процессов дипломатов среде вышлет эрику берну эти с разными действия между компонентами pipeline of асинхронная для этого используется пачиков краденый цикла по чаплинка я против спарки делегируется соответствующим губернатор оператором подавляющее большинство потоковых приложений аналитической платформы работают сохранением состояния так называемый csl обработкой 90 процентов стрит по обработке выполняется с помощью apache и fling остальные десять с помощью apache и spark ev основном это касается работы с даты лайк и hadoop потоки встретил обработки на плачу при зачастую шарнира ванны с высоким максимальным параллелизмом что позволяет быстро менять степень параллелизма операторов на более на горных участках проекты и выполнять безант альные масштабирование системы с появлением нативной поддержки губернатор в ревизия против финк 113 перспективе мы планируем отказаться от текущего купер нас операторов рынка от компании лифт и реализовать динамическое масштабирование fling рабов тоже настал момент делать выводы проект аналитической платформы для активного бюро позволил полностью перевести существовавшие ранее бизнес продукты на real-time обработку радикально повысило производительность отказоустойчивость масштабируемость за счет новые реактивные событий на ориентированные архитектуры ключевой бизнес продукты триггеры теперь выполняется в режиме онлайн и задержка между получением обновление и формированием события для клиентов 90 процентов случаев не превышает 10 секунд при пиковых нагрузках аналитическая платформа обрабатывает десятки миллионов изменений ежедневно обслуживает высокие пиковые нагрузки до 15000 событий в секунду и при этом имеет возможности для гибкого горизонтального масштабирования с ростом числа клиентов средства разработки проверки и вы в продакшен для модели машину обучения также позволяет повысить качество продуктов скоринга и снизить тайм ту марки для новых моделей и продуктов технологии фас дата и потоковой обработки в целом позволяют достичь минимальный задержек и значительно повысить монетизацию ваших бизнес данных и снова всем привет продолжаем не расслабляемся все покушались отдохнули пора снова за работу и чтобы мозг тоже работал до сегодня мы с вами пойдем в историю потому что доклад называется как мы попали в истории stories сервисы объявлений с нами сегодня александр аникин is yours если не ошибаюсь работает земли дом backend направлении поприветствуем всем привет я александр аникин я тимлид 1 сбн команд и вы который занимается продуктов разработкой и сегодня я хочу вам рассказать о том как мы запускали сервис истории или о чем будет доклад по началу я расскажу о оу по историях велел и что это такое расскажу про их особенностям дальше я верхнем уровне у пройдусь по архитектуре и инструментам которые мы использовали для разработки этого сервиса затем я подробно пройдусь по теме ради со так как он является основной ключевой частью нашей системы и расскажу о проблемах с которыми мы столкнулись и как мы их решали в конце концов конечно же поделюсь результатами кому будет интересен этот доклад для всех тех кто не пользуется редисом или пользуется винтовка кэшем а также для всех тех кто может быть не планирует делать истории в своих сервисов но надеюсь что какие-то решения будут вам интересны прежде чем продолжить хочу рассказать о том что такое юла юла и такой сефард the service объявлений крупнейший сервис объявлений которые позволяют продавцам и покупателям найти друг друга дела заботиться о безопасности пользователей решает проблемы с доставкой дела помогает пользователям общаться друг с другом или есть встроенные петухи звонки прямо внутри приложения и недавно его интегрировалась в к запустив пока объявления в общем юла делает много инструментов которые позволяют пользователям покупателем продавцам как-то улучшать свой опыт и одним из таких инструментов как раз были истории в юле скорее всего вы заметили что формат историей довольно популярен везде используются практически везде и в чем же отличие наших историй от других и для чего вообще мы их делали в первую очередь мы хотели дать инструмент продавцам профессиональным продавцам рассказать о себе на еще большую аудиторию именно поэтому мы разместили истории на самом верху главного экрана нашего приложения также мы хотели дать возможность рассказать продавцом о своих объявлениях услуга в новом формате поэтому мы добавили в нашей истории с не только фото но и видео и все это в конечном итоге должно должно помогает повышать доверие к себе и к своим объявлениям или услугам и отсюда особенности истории на или первым делом истории создают сами пользователи то есть весь контент всей истории которые мы видим деле это история созданы самими пользователями как следствие этого идет к тому что этого контента очень много и это первым делом тоже влияет на качество контента соответственно второе что нам нужно для наших историй это модерация как же особенность наших историй или является то что ленты историей который отображается на главном экране оно персонализировано она рассчитывается для каждого пользователя персонально и зависит от таких от гиа от подписок пользователей интересов и так же для того чтобы нам от рисовать эту ленту нам необходимо учитывать просмотры то есть все просмотры всех историй какие истории пользователь видел какие нет для того чтобы отобразить эту ленту так как это так как истории находится на главном экране требования к нашему сервису довольно высоки то есть наши три наш сервис должен быстро отвечать и быть довольно отказывай устойчиво ну и под конец так как это продукт это нужно было сделать ещё вчера немного расскажу про использую терминологию как это вообще выглядит история история это фото или видео которое пользователь загрузил в его к истории пользователь может прикрепить ссылку либо на свой профиль либо на свое объявление группа историей группа история сложно догадаться это несколько историй сгруппированы в одну группу для упрощения это история одного пользователя preview preview это некая обложка группы в превью по сути это кружочек в котором отображается 1 не просмотренной а история в этой группе для текущего пользователя для пользователя формируется список групп для каждой из этих групп мы формируем превью и вот именно этот список preview он как раз и отображается на главном экране теперь хочу рассказать как это все работает начнем с публикации истории первым делом клиент делает запрос в api и создает пустую историю так называемый черновик для чего нам нужен черновик дело в том что на клиенте несколько историй могут загружаться параллельно сделан для оптимизации и таким образом вторая история может загрузиться чем первая вторая история может пройти модерацию быстрее чем первое и таким образом черновики помогают нам сохранить список историй именно в том хронологическом порядке в котором пользователь их создавал после того как клиент сделал запрос на за черновиком идет загрузка фото и видео после фото и видео после загрузки клиенты сохраняют уже с генерирую сгенерированную историю после этого история попадает на модерацию если необходимо идет обработка видео после этого история публикуются и эта история становится доступным для всех как это выглядит под капотом приходят запросы api схема немного упрощена просто чтобы понять как это примерно работает после того как пришел запрос мы сохраняем данные в базу саму историю после того как история сохранена начинается процесс загрузки медиа ожидаем ответ отметить сервиса после того как ответ успешно получен мы отправляем историю на модерацию уже после того как модерация прошла история публикуется в этот момент история становится доступна для всех для всех пользователей ул и так как нашей истории еще и базируется на подписках пользователя то следующим шагом мы получаем все подписки текущего пользователя и уже обновляем верно все ленты всех его подписчиков об этом я расскажу немножко попозже что касаемо просмотром теперь да про просмотр на главном экране юлы мы видим некую ленту истории которая персонализировано как я уже говорил и генерируется из масса параметров это лента учитывает она отсортировано по новизне то есть более новые истории пользователь видит начали более старые в конце также учитываются просмотр то есть если какие-то истории были уже просмотрено пользователям эти истории убираются в конец списка перейдя в любую из групп в этой ленте пользователь может ли стать истории влево-вправо переходить из одной группы в другую 105 анимацию в общем этот полный аналог инстаграма по сути как это происходит на стороне бака нда тоже схематично для начала мы получаем список групп который мы должны отобразить пользователю то бишь ленту затем мы получаем весь контент каждой группы для того чтобы просчитать какую историю мы должны показать после этого мы получаем все просмотра текущего пользователя и после этого формируются лента и уже конечно лента уходят на клиент и так верхнего уровня мы прошлись примерно по архитектуре и хочется рассказать прежде чем и сказать о деталях хочет рассказать о технологии которые мы используем в или мы используем php его как основные языки программирования мангры дисков к тарантул в принципе стандартный набор изначально когда мы проектировали этот сервис мы планировали использовать мангу как основную базу данных и использовать редис просто как кэш однако в процессе разработки мы пересмотрели наш подход мы оставили мангу только для как резервную базу данных и стали использовать ray диск как полноценную базу данных и дневник и группы ленты просмотры в общем все данные практически которые нас есть мы храним именно в одессе кафка у нас осталось для общения между сервисами для модерации для обработки видео и тарантул мы используем для очередей так как редис по сути является центральной частью нашего сервиса я хочу рассказать поподробнее о том как устроим радиус у нас как мы с ним работаем и какие данные мы в нем храним исторически редис или прошел несколько стадий развития начинали естественно мы как и все с обычные символы ноды пробка кэш пишем данные получаем данные все работает все замечательно однако в какой-то момент мы задумались о масштабирования отказоустойчивости с отказоустойчивостью нам помог ради сэнте но тут тоже никакого рокет сайенс а все довольно легко настраивается помогает нам с этим однако в такой схеме для сортирования нам пришлось механизм ордера нам пришлось реализовывать на стороне клиента мы использовали количественных и sharing он позволил нам избежать проблем с добавлением или наоборот удалением но тэсс кластера но остались про тем что данные мигрируют все равно приходилось руками и мы какое-то время жили с этой схемой и в какой то момент мы пришли все-таки крайзис кластеру редис кластер в принципе решает все эти проблемы под капотом миграции данных между нодами отказоустойчивость шарди рования еще много кто из вас пользуется ради с кластером в продакшне учащийся я думал меньше окей значит будет интересно в или у нас много родис кластеров на самом деле и каждый кластер на используется для каких-то определенных типов данных все эти кластеры настроены под эти данные но принципиально родис кластеров или выглядит следующим образом это 3 дата центра три независимых дата-центра мастера кластера распределяются по этим дата-центром равномерно как мы видим на этой схеме и для каждого мастера в этом кластер и мы 2 2 дополнительные ноды которые лежат соседних дата-центрах такой подход нам позволяет спокойно пережить падение одного дата центра и продолжать отдавать она и жить с этим спокойно также мы не делаем большие ноды то есть все наши мастера за редким исключением обычно не превышают больше двух гигабайт это обусловлено тем что в таком случае эти ноты во-первых быстрее там биться быстрее поднимаются и требует меньше цикл чем например если бы мы использовали одну ноту но большего объема например нам 4 гигабайта так как для нас родится кластер должен отвечать быстро мы больше оптимизируем подсыпку нежели по памяти потому что память для нас дешевле в принципе примерно так выглядит кластер но есть небольшая проблема то что управлять таким кластером довольно сложно если not десятки там может быть там не знаю еще больше это несколько дата-центров это несколько физических серверов случае падения каких-то not надо понять что за реплицировать куда перевести из какого дата-центра в общем это боль и это надо сделать на основе вывода по сути ради ск ли мы от вообще не вариант к счастью мы сделали в юле такую штуку как ради скала старту который может использоваться для мониторинга таких проблем и для автоматического каких проблем по сути он решает следующие проблемы если мастер и реплика находится в одном дата центре следующий проблема которого может решить это несколько реплик находится в до в одном дата-центре еще одна проблема которую он автоматически решает это то что у нашего мастера нет реплик либо их недостаточное количество обычно мы реплицировать используем по двери блики на мастера также экспериментальным путём мы выяснили что для нас падения в кластере больше 12 мастеров приводит к тому что время восстановления такого кластер растет практически экспоненциально то есть именно больше 12 поэтому мы стараемся не делать больше 12 мастеров в рамках одного кластера на одном сервере если нам нужно больше соответственно 30 мастеров мы используем уже не 3 сервера a6 серверов которые точно также в разных dc и последняя в принципе очевидно то что вытекает из всех пунктов выше редис однопоточный поэтому мы можем разместить на физическом сервере столько нот редиса сколько я der мы имеем для нашей стандартной машины пятьдесят шесть ядер мы выявили что мы не можем мы не размещаем больше тридцати семи мастеров почему при падении одного физического сервера все ноты которые там есть все мастера которые есть на этом сервере должны равномерно распределиться по двум другим серверам соответственно если мы используем тридцать семь мастеров то 37 пополам это примерно 19 по 19 мастеров переедут на два других сервера 56 -19 это как раз и будет та цифра в 37 таким образом мы всегда держим некий запас для того чтобы упавшие мастера чтобы было куда переехать так поставок мы примерно пробежались посмотрели как выглядит кластер вели я хочу рассказать о том с какими проблемами мы столкнулись и собственного как мы их решали 1 проблема как ни странно это конечно был пользовательский контент тут в принципе порядка самом деле это не было проблемой у нас отлично работает модерация и ни один пользователь на самом для морально не пострадал я серьезно то основной задачей сама сможет задачи было до нас решить то как мы будем хранить данные в одессе нам необходимо хранить персональные ленты всех пользователей уметь ее сортировать по новизне нам необходимо хранить все просмотры всех пользователей всех историй то есть должен большой бен данных и также нам надо уметь сортировать истории в рамках одной группы чтобы сохранить и хронологический порядок как не раз уже говорилось родиться это в принципе не только кэш но и целый набор встроенных типов данных которых нем есть эти типы данных помогают решать различные задачи принципе если этих типов данных не хватает можно использовать la можно использовать сторонние модули мы ввели в принципе активно используем практически все эти типы данных в нашем сервисе я хочу остановиться на сорта цветов и строках потому что они используются активнее больше всего так сорта ct что из себя представляет сорта цвет в одессе это некий список элементов где каждый элемент имеет еще собственный score с помощью стандартных средств редиса мы можем добавлять элементы в этот список убирать менять элементом score и одна из особенностей интересных фич этого сорта цитата что мы можем получать этот список отсортированный в том или ином направлении более того мы можем получать часть этого списка где score удовлетворяет каким-то нашим потребностям например там score больше там 10 или меньше 12 и так как мы используем сорта цвет сорта центах мы храним группу историей по сути как элемент мы храним идентификатор истории как скоро мы храним дату создания истории теперь при добавлении истории мы делаем зад в эту группу и соответственно конец списка попадает новый элемент с новой истории такой подход позволяет нам хранить группу историей сохранять его хронологический порядок сортировать и показывать всегда в правильном порядке вне зависимости от того как клиентах запросил также сорта цет мы используем для персональных лент в отличие от групп мы храним в элементе уже идентификатор не самой история группы историей и также мы храним как спор не дату создания а дату обновления группы таким образом когда какая-то группа историей обновляется по сути мы делаем ту же самую операцию это за и обновляется score по факту обновляется score у того элемента который мы обновили такой подход еще позволяет нам решить еще одну проблему дело в том что когда мы делаем за от мы по факту не знаем если такой это элемент в списке или нет и сорта ces сорта сет из коробки решает эту проблему потому что он следит за уникальностью элементов с этим теперь перейдем к строкам в строках мы храним сами объекты истории объекты истории мы храним сервированном виде в виде строки почему не в кэше дело в том что в кэше несмотря на то что мы выиграем по памяти мы потеряем по сложности то есть по сути подсыпку поэтому для нас лучше сделать стерилизацию на клиенте и положить уже строку в редис для редиса меньше нагрузка по циpкa для того чтобы обеспечить больше рпс это важнее также в строках мы храним счетчики просмотров тут в принципе все понятно и интересно для нас стала задача как хранить все просмотры пользователей то есть нам нужно понимать какие истории он уже видел а какие нет для этого мы тоже используем строки выглядят примерно следующим образом допустим у нас есть группа историей после того как пользователь посмотрел первую историю мы сохраняем этот индификатор в ключ изначально мы вообще планировали хранить все айдишники всех историй которые пользователь посмотрел но если прикинуть в самом плохом кейси это будет по сути перемножении всех активных истории всех активных пользователей это большой объем данных мы решили как-то это упростить соответственно мы придумали такой механизм после того как пользователь просмотрит вторую историю мы не создаем новый ключ мы в тот же ключ записываем айдишник второй истории и так как нашей истории расположены в хронологическом порядке это нам всегда позволяет понять какая история будет следующее то есть пользователь не может посмотреть вторую историю не увидев первый по сути мы храним некий курсор но что делать если историю на которую мы ссылаемся как просмотр пользователь удалил дело в том что мы используем мангу в проекте и соответственно все идентификаторы который мы используем в наших объектах это манга и de mon гайде легко переводится в time stamp и в принципе их можно сравнивать друг с другом поэтому даже если такого объект в сети нет то мы легко можем найти следующий элемент у которого дата создания выше предыдущей но выше текущей решение такой задачи приводит нас к тому что для того чтобы получить рассчитать просмотре ность всей ленте на главной нам нужно сделать м запросов в редис где n это количество групп вот этих кружочков и для каждого этого кружочка нам нужно для каждой группы получить смотрел ее пользователь не смотрел где он там остановился и так далее их символ но дед в принципе не проблема мы делаем ульте get мы получаем 10 ключей условно и десяток значений и дальше там с ними что-то делали но в шрадер овнам кластере такой подход не работает шрадер нам кластере мульти get может отрабатывать только на одном шарди то есть мы не можем использовать этот подход но счастью в родис кластеры в одессе подумали об этом eurodisc кластере есть такая простая штука как хэштег по сути это фигурные скобки которые указывают радиусу ту часть ключа от которой будет браться хэш и соответственно высчитываться хэш слот таким образом с помощью хэштегов мы можем четко понимать какие данные у нас будут храниться гарантирован на одном шарди благодаря этому мы можем сделать уже мульти get в шарди раваном кластере и получить эти данные за один запрос с проблемы в принципе решено очень частая проблема при работе с кластером это медленные ответы редиса при практически любой нагрузке и причем эти ответы они тем медленнее чем больше кластер проблема в принципе уже изученные решена и про него уже много кто говорил есть прекрасный доклад от 18 года на ради sconfig где подробно рассказывается про эту проблему я прибегу лишь по верхам просто расскажу в чем проблема допустим мы видим что время ответы ради со довольно большой лезем свой лоб и получаем примерно следующую картину и видим некие кластер слот что это общее такое в том что в одессе используется механизмах слот то есть по сути флотов есть 16384 и все они равномерно размазаны по всем мастерам кластера то есть каждый мастер знает за какие слоты он отвечает соответственно перед тем как сделать запрос в редис мы получить актуальную слот мапу где мы будем знать в какой слот в какую ноту идти рассчитать из нашего ключа текущей свод и после этого сделать уже в конкретный вопрос заключён соответственно таким образом на каждый запрос в редис на каждый поход в редис мы делаем два запроса получения суд map и и получение данных решается просто надо кэшировать вот папа на клиенте либо использовать библиотеки которые уже реализовали каширование на своей стороне после применения такого подхода обычно картина выглядит примерно следующим образом следующих проблем с которым мы столкнулись который для нас была очень актуально это оптимизация хранения списков дело в том что наш сервис очень активно используют списке и мы заметили что потребление циpкa при использовании таких списков довольно большое но для нас было большим дело в том что в одессе списке хранятся в двух внутренних типах данных это zip лист и dictionary dict по умолчанию все speedkick отца в zip листе zip лист оптимизирован по памяти но тяжелее попрошу в то время как dictionary на бартон не оптимален папа требует больше памяти для хранения списков но сложность получения списка из этого говоря проще таким образом есть настройка которая позволяет указать жестко количество элементов в списке после которого он перестанет хранится в zip листе будет храниться в dictionary таким образом мы принудительно храним списке все не пустые списке в таком формате это позволило нам решить одну проблему дело в том что когда списке имеют размер очень близкий к тому что в настройках то очень большая вероятность того что список будет постоянно переходить из одного типа данных в другой тип данных и радиусу для того чтобы перестроить эти списки нужно постоянно постоянно перестраивать эти списки это тоже очень сильно грузит радиус подсыпал собственно говоря после того как мы стали хранить списке сразу в dictionary мы получили следующую картину и теперь теперь собственно говоря у нас примерно по 4 процента циpкa нагрузку в среднем на ноду то есть мы вы получили выигрыш порядка 15 процентов пунктов для нас это было очень критично и наверное самая интересная и самая такая не тривиальная проблема с которой мы столкнулись в итоге при разработке stories of это была проблема бибера почему именно бибера вообще бибер это тот человек с которым собственно говоря в instagram у первого случились проблемы с лайками дело в том что у всех сервисов которые так или иначе работают подписками механизмы для обработки подписок и для как ты для работы с ними они оптимизированы и когда появляется человек у которого подписок сотни тысяч десятки миллионов там неважно зависит лишь от масштабов сервиса эти механизмы перестают работать и это доставляет больших проблем расскажу на примере как это вообще работает допустим у нас есть пользователь у него есть несколько подписчиков так как наша наша история основаны на подписках для того чтобы пользователю отобразить его ленту мы должны сходить в сервис подписок получить всех тех на кого он подписан получить их контент и отобразить пользователю звучит не очень поэтому мы используем немножко другой механизм от обратного при добавлении контента пользователем на которого подписан и другие люди мы также добавляем в их персональные ленты тот контент который добавил сам пользователь соответственно добавляется еще контент обновляем лента добавляется контент обновляем ленту и все замечательно теперь когда пользователь заходит на главную ли он просто получает персональную ленту отображают ее и не нужно лишний раз использовать подписки чтобы получается когда происходит такая проблема с бибером когда появляется бибер нам приходится на каждое обновление контента такого бибера делать там десятки там сотни миллионы каких-то телодвижений которые по сути нагружают нашу систему и мы решили это таким образом мы помечаем таких пользователей в которых очень очень много подписок как бибер и и для них отключаем механизм обновления лент подписчиков соответственно после того как бибер добавляет себе какой-то контент свою ленту мы не обновляем подписки не обновляем все ленты подписчиков но при этом когда пользователь заходит в лу мы получаем его ленту получаем всех дибиров на которых он подписан и маржи motul and таким образом это некий баланс между двумя подходами по работе с подписками и это очень легко настраивать для загрузки своего серого сервиса можно выставить любое значение как результаты в итоге сервис запущен сервис запущен быстро сроки кластер которые обслуживают только истории получают нагрузку порядка в 30 30 fps это средняя нагрузка пике бывают данных до 40 до 50 к среднее потребление подсыпал на ноду кластера порядка четырех процентов то есть запас прочности очень большой и время ответа нашего сервиса в среднем десять миллисекунд благодаря этому благодаря радиусу вообще нам удалось решить эту проблему очень быстро на самом деле редис очень гибок в настройках и нам очень легко было настроить radisson в принципе быстрый но если чуть-чуть его подтюнить можно получить очень очень хорошую производительность и более того редис настраивается itunes очень легко благодаря радису и вообще встроенные функциональности которые есть это и типы данных и кластерное решение мы можем решать подобные задачи очень быстро потому что редис практически решил основную часть инфраструктурных задач и позволил нам сфокусироваться чисто на продуктовых решениях на этом у меня все спасибо спасибо александр хороший доклад у нас есть здесь как на вопросы спасибо было интересно скажите пожалуйста к и кейс вот вы используете кластеры де сада в нескольких дата-центров и в одном то центре у вас там расположен допустим 20 мастеров сколько вы сказали цифра не помню и что происходит вот упал дата-центр мастера переехали механизм обратного приключения как у вас реализовано через редиску которое вы написали или как или врач вручную это все происходит скажите даков равномерное распределение нодом мастеров да еще с это вопрос а давайте я щас на это отвечу по факту до после падения по факту машины все мастера которые там были они до ноды соответственно реплики в других пусть в других дата-центров других машинах они становятся мастерами после того как мы поднимаем точнее еще должен даже до того как мы поднимаем их сервис редиска master tool который вот мы сделали он позволяет следить за тем чтобы количество мастеров было равномерно распределено потому что после того как много упала родис начинает голосовать кто из реплик станет мастером и есть такая вероятность того что например 10 реплик упала в 10 мастеров и полу и все десять поднялись на одном сервере радецкого старту позволяет пром условно мы можем прям сказать точно что вот ты будешь мастером таким образом перед ну то есть получается просто ручной обратно извращение но обратно и распределение наверное то есть после того как поднялся нужно сказать ему что эти всего как теперь живут мастера та-да-да-да так примерно происходит в окей хорошо и спасибо второй вопрос понятно что я сертификация все-таки данные вы сохраняете там знаю там же журнал какое-то ведет своего быка пить или нет или вот говорить что у вас есть свои вы и мы не пишем там называется по моему правильно либо другой метод либо комбинированный конкретно в этом кластер и мы на что так что да persistent ность для нас здесь была менее принципиально чем скорость но тем ни менее сперси нам помогает манга то есть условно те данные которые приходят от клиента мы кладем в мангу кладем в редис и используем же редис просто какая то есть кроме просмотров в принципе все данные теоретически можно прогреть конкретно в этом кейсе you в этом кластере у нас up and done для отключим но при этом есть только snapshot gdb который раз в какое-то время делает дам not за счет того что но да в принципе маленькие это не занимают очень большого времени сейчас не очень понимаю вопроса смысле а но на самом деле это я примерно понял о чем проблема у нас roi des кластер он спрятан за к прокси на то есть там на уровнях a proxy все это решается спасибо за доклад здесь на мой вопрос вы уже этих частично ответили предыдущим ответом мой вопрос про вытеснение ключей так как у вас основная информация ну редис использовать как основная основной из . надо на вот вы сказали что как минимум для просмотров вы храните только в одессе данные вот сталкивались с проблемой вытеснение ключа вот и может быть тюнингу как-то это меняли алгоритм вытеснение ключей в одессе в данном случае мы не упирались такую проблему то есть принципе но у нас довольно большой кластер вот то есть нас все туда влезает и чисто теоретически даже просмотры по аналитическим данным можно как-то будет поднять но с продуктовой точки зрения потеря просмотра какой-то группы она не критично поэтому мы изначально не задумывались накиньте механизмом чтобы мы железно могли их потом восстановить до проблемы именно вытеснения ключей мы не доходили но в рамках этой задачей в рамках этого кластера еще вопросы господа и дамы добрый день александр коллега это же александр компания хотел бы сказать я посчитал вот результаты и 4 процента на ядро классно это посчитал получилось сто тридцать восемь процентов из 56 ядро сервера используется не кажется ли вам что каким-то этики power наверх и дом таким что такая хорошая железка занимается ничем ну так я на самом деле для этого сервиса есть как минимум три таких железки по факту есть еще так как у нас у нас на каждой из машин на самом деле может находиться больше одного кластер а вот но до в данном случае у нас где-то порядка порядка тридцати-сорока not мастеров редиса ну пока можем себе позволить понятно ещё такой вопрос на самом деле я уезжал на корфу и у меня разработчика спрашивает почему 6 гигабайт ready снова это плохо игры давай чуть по другому сделанную инсталляцию там другой редис там на самом деле сингл используем ну неважно так будет кластер там еще что то вот вы если вдруг вам разработчик подойдет и спросит почему александр больше двух гигабайт вы не рекомендуете скажите свое слово спасибо окей на самом деле pro 2 гигабайта да есть на самом деле тут все просто 2 гигабайта по сути этот тот небольшой объем который позволит нам во первых быстро дам кнут ноду сущего быстро ее поднять после рестарта редиса то есть в принципе это такой ну как сказать ней талон но такое среднее значение которое можно использовать опять же при использовании двух гигов при 56 ядрах это как раз будет примерно там половина или целая память стандартной тачки опять же это зависит еще от кластер а потому что при а в данном случае для нас не критично какие-то данные поэтому мы например хранимых только percent percent если мы используем только дамп rtb то есть мы не используем up and up on ул но при этом если мы будем использовать для каких-то других данных например долгоживущие каши или данные которые очень важны и там занимают очень большой объем данных то в принципе почему бы не использовать больше чем меньше но до чем проще с ней работать о постоянно установится и последнее это вопрос просто когда 6 гигабайт и и стандартный конфиг заливаете у вас много rtb будет зовут при достаточном обновление ключей я не знаю каждые пять минут скидывать собственно эту базу для rgb если вы посмотрите на графике то он будет занимать но достаточно серьезно и долгое время вот ну и собственно это поскольку все таки это все в одном треке решается то это фактически может очистить ваш основной но основные задачи кризиса как обработка ключей вот поэтому наверное здесь как раз вот этот 2 гигабайта и ключевым как бы будет более-менее такой оптимальная производительность и хотя можно настроить наверное богатеев ну как вы правильно можно сделать любое количество просто так проще да спасибо еще раз спасибо александр хороший доклад мы сейчас подарочек сделаем и вам еще нужно выбрать самый понравившийся вам вопрос мы подарим книгу с вашего позволения экспозиция с вашего решения на самом деле все вопросы были довольно интересные я бы выбрал вот молодого человека потому что там алексей поздравляю спасибо если повязки это вопросы можно проследовать кулуары и собственно задать их тоже есть микрофончик neoflex создает эти платформы для цифровой трансформации бизнеса помогая заказчикам получать устойчивые конкурентные преимущества мы фокусируемся на заказной разработке программного обеспечения используя передовые технологии и подходы наш отраслевой опыт и технологическая экспертиза усиленные готовыми программными компонентами акселератора my разработки позволяют решать бизнес-задачи любого уровня сложности сегодня многие проекты просто развития компании последних лет обусловлено тем что мы работаем на острие самых современных информационных технологий на любые технологии к монетизируются и становятся общепринятыми чтобы обеспечить движение вперед необходимо постоянно находить что-то новое я уверен что neoflex такая компания которая на иначе но метки развития сможет предложить рынку новые равна идеи вне зависимости от уровня сложности объема задачи и географии мы с заинтересованностью относимся к каждому клиенту мы ценим наших заказчиков и их доверие так как понимаем что именно их выбор дает нам возможность принимать участие в инновационных проектах влияющих на развитие отрасли если мы беремся за какой-то проект мы обязательно доделываем его до конца из нужен результат если мы работаем с каким-то клиентам то мы делаем так чтобы клиенты получил то что он хотел тогда когда он хотел из тем качествам до который нам не просто будет стоять на мы будем гордиться стремясь быть лучшими в своем деле мы постоянно осваиваем новые технологии и инструменты развиваем методологию своей деятельности и совершенствуем собственные акселераторы разработки для того чтобы обеспечить максимально качественный результат для заказчика сегодня мы старались делать то что мы не делали вчера если мы задумываем что-то на завтра то обязательно так как мы не делали или это как бы а новому настроим команды или используем новые технологии или используем какие-то новые подходы но обязательно делаю следующий шаг мы делаем его как-то по-другому как-то интереснее как то лучше география наших проектов охватывает более 18 стран европы и азии и африки обладая глубокой технологической экспертизу и знанием бизнес-процессов мы реализуем проекты для крупнейших финансовых организаций в партнерстве с ведущими вендорами айти решений мы работаем в очень высокотехнологичной сфере области информационных технологий преимущественно для финансовых институтов и сегодня компетентность выходит на первый план банки и компании укрупняются там работают очень высоко профессиональные люди кого же они выбирают в качестве партнеров для своих айти проектов конечно же эти организации в которых с их точки зрения есть необходимая экспертиза которые могут дополнить знания внутренней команды заказчика главное в neoflex это люди их знания и скорость мысли в отношениях с клиентами доверия мы знаем что такое ответственность подкрепляем каждое слово действиям и результатом об этом говорят сотни успешных проектов для крупнейших российских и иностранных банков и компаний лидеров своих отрасли ну был дубльгис мы даем в ту дай его в туре вида санчес его одну заслон из people фиалка ногти твое чадо и пилот так что connection быть скромный field да и авто дай мегафон на xd из connection штанга штанга это он о той вас контракта является лайков вот такой фанат апреля тебя таковой mouth and certainly no вскоре gromovac с без звуков с твоим ваша цель интернет свечей lt lt g 2001 г.р. speed мегафон усоскин угон джимми кул ты тет-а-тет этот шанс fate of a и гигабайт список cs и издав фича ведь битва идти сын и туда и выкупит business solutions смотри шанс по окр колчак ризотто пальцы ионы цинка и а ведь мегафон особенно в ой павел привет я рад я бывший закрою сейчас ведущий подкаста мы обреченным при этом знакомиться лавина чем ты занимаешься я архитектор в решении работы в московском офисе компании redhead последние года 4 наверное я делаю всякие штуки вокруг devops а вокруг убираете сами красивой архитектурой cell 5 утечь да я прочитал что ты учу вас компании популяризатора микро сервисов это маркетинговый ход да смысле но это видение нашего маркетинга я для более скромное прошествии corsa не но в принципе да ну и что микро сервиса так действительно хороши как они все говорят последнее время потому что я частенько начинаю слушать критику критика была есть и будет это неизбежно в моем понимании это это неизбежно ну на ближайшие какой-то обозримую перспективу горизонт событий все равно все там будем часто бывает что действительно замечательная технология но технология подразумевает присутствие какое-то культуры и каких навыков вокруг этих технологии часто не хватает ну какие то проблемы именно вылил бы тут понимаешь что то как бы кто я такой чтобы критиковать с одной стороны с другой стороны в неформального общения часто вижу часто понимаю то что допустим вот ситуация с abs с командой сопровождении каких-то там технологических платформ часто бывает то что с административной точки зрения руководства не готовы инвестировать в эту команду люди несколько оторваны от вот общего какого-то глобального цикла им через забор передают задачи и говорят справляется как хотите с ними не ведутся какие-то диалоги о прекрасно получается на выходе то что у нас такая борьба за псевдо стабильность мы боремся за то чтобы просто продолжала гореть лампочка на самом деле мы сидим своем отсеке славы понимаем что вообще происходит и что делать что делать есть такая идея то что давайте попробуем переделать психологию методологию работа наша команда в сторону и сэргэ чуть-чуть про наверно терминологии зачем это вообще нужно сергей сырья это сайт ривай ability инжиниринг я очень плохо слова и фразы дальше-то будет аббревиатура а заряда и стороне по сути это такая специальная редакция на самом деле devops практик потому что делится devops абсолютно те же фундаментальные принципы концепции главная разница то что мы как параноики пытаемся выстроить более отказываю стоящую про структуру с одной стороны с другой стороны мы принимаем перспективу наших конечных потребителей и это безумно логично моем понимании то есть мы мы воспринимаем любую операцию проблему как сарт новую проблему то есть с перспективы того же пользователя абсолютно все равно каком уровне во что-то сломалось на спрос на доступен сервис перспективно наша бизнес на самом деле приблизительно то же самое поэтому все проблемы приступ write софтовые проблемы что про порождает сдвиг в сознании abs команда садиться за один стол вместе с продуктами и разговаривать с ним на равных про и фактически получается то что у нас разработчики становятся функциональными заказчиками мышка брешь я не очень то зачем этот отличается просто культура devops потому что длс они вместе работы для справедливо да здесь мы можем устроить глобальный холивар на тему разночтение к именно терминология предлагает виде не делать то есть ситуация такая что по факту до действительный abs описывает все все все на самом деле что подразумевается его сырые вас по сути но по факту у нас не происходит вот этому сдвигу но все равно есть некая изоляция команда нету понимания кто за что отвечает если мы идем в сторону и сергей и разделяем вот фундаментальный парадигмы скажем так и сырья когда у нас все у нас есть одна большая софтовой проблему загнал нас не будет разночтение кто за что отвечает но ok например я понял что у меня в команде если это проблема и я такой говорю давайте строить о сырье как это давайте давайте нам нужен человек с определенным административным рычагом который в принципе сможет вернуть эту историю который сможет объяснить зачем это делать и что изменится это во первых во вторых наверное нужно следовать хорошим культурным практикам по в плане создания именно в с реками нить из-за каких-то команд хотя на самом деле практике также применил в принципе к создание любых команд вы пятну большей части да это про культура про людей да я бы первым сказал то что провал это нормально ошибаться это это очень по человечески все мы люди и дело не в ошибке не в качестве ошибки не в масштабах это ошибки в том насколько мы поняли где мы ошиблись и что нужно делать чтобы ошибка не повторялось следующий момент наверное я предостерег гоняться за звездами в найме в моменте nike членов команды звезды я подразумеваю не просто одаренных и компетентных людей история когда определенный набор софт скилов двигает человек в вот именно в какую-то такую звездность болезнь когда он порождает какую-то информацию борьбу за власть или как вариант и или на самом деле мы своими руками нанимая звезду или звезд загоняем себя в рамках наши предприятия в частных случаев interlock а когда там один или несколько человек действительно понимает как работает та или иная систему ну вот про звезд я как предпринимаю когда слышу говорят вот проблема звезд это очень сильно технические специалисты которые низко не считаются с практиками справили объект просто очень так стараюсь деликатно эту тему как-то проговорить потому что это тоже холивар на тему с одной стороны до звезды позволяет очень быстро начать но звезда с с перспективы стороннего наблюдателя будет для нас аномалии потому что у нас такой глобальную всплеск компетенция как любой аномалия досрочно перспективой катастроф поэтому нужно отыскать какие-то такие середину счет и но очевидно вот как как вывод из этого быть абсолютно готовы вкладываться в развитие своей команды гоняться не за идеалом гоняться за потенциалом смотреть на софт текилы причем отсылки к войне не только в моменте то что парень хорошо умеет рассказывать какие смешные истории за то что он действительно понимает как как и что он делает в плане бизнеса чтобы он чувствовал бизнес на самом деле все звучит безумно прагматично но акцент живу в реальной жизни этого очень не хватает я думаю если об этом говорить может быть что-то изменится вопросы доверия вот например частности то есть очевидно то что команда способна сделать гораздо больше чем каждый из нас по отдельности вдова без без выстраивания доверия внутри команды без пропагандировали я вот так такого рода культурных практик но мало что получается на самом деле мало того должно быть доверие со стороны руководства потому что без доверия люди теряют способность принятие самостоятельных каких-то решений и мы его получаем как тут команда не очень сообразительных роботов что тоже нехорошо мы вроде на нем людей мы долго беседовали мы выдворили с их навыками но с другой стороны постоянным объем их рукам и не даем принимает 705 на решение лайки должна в моему маниоки должна быть такая к автоматике специалист ты берешь на себя ответственность ты делаешь эксперимент понимаешь получилось не получилось но объясняешь сопутствующие риски какие-то чем мы можем поплатится за это мы так или иначе у тебя есть свобода самостоятельно принимать решение но это требует очевидно вере мне кажется здесь немного по-другому эту проблему чаще слышала о том что доверие как раз очень мало при найме а уже после найма бросают вы как в воду учись плавать сам обычно впечатление складывается прямо моменте найма на моменте первое собеседование когда все жутко строгие и спрашиваю не всегда адекватные вещи и человек выходит на работу и продолжает жить в такой же парадигме то есть он боится как высунуть голову бы боится проявить инициативу возложи на самом деле повторюсь да звучит банально думаю к имени действительно wars вот наверно еще бы хотел рассказать про момент то что это вот классика окон source комьюнити быть не согласны мы следовать курсу это на самом деле то же вытекает вот из смелости из доверия из-за такой умеренной борьбы системы здесь как-то противоречиво звучит вот здесь мысль заключается в том то что кей для того чтобы развиваться нам нужно экспериментировать для того чтобы для того чтобы экспериментировать нам нужно какое-то направление для этих экспериментов потому что мы на очевидно не может быть комментирует во всех направлениях сразу быть несогласным это нормально и ничего ужасного нету но идея заключается в том то что раз мы приняли какое-то направление мы должны ему следовать до того момента когда мы поймем то что либо шаги в этом направлении либо направлении целиком ошибочно когда мы фактически в реальном времени меняем вот эту вот нашу направленность экспериментов ну в общем другими словами да мы должны избегать аналитический паралич иначе мы будем вечно натыкаться на одни и те же грабли до бесконечности причем такие серьезные глобальные грабли которые нам не позволяют действительно развиваться не просто какие-то мелкие штучки что-то там поколотили нас не получилось а именно таких концептуальный большие вещи но и как твои успехи вот в внедри нет культуры а это неизбежно происходит потому что так или иначе как вот с чего мы начали то что есть запроса и со стороны бизнеса и стороны разработчиков страны безопасности откуда угодно есть запросы на имплементацию вот каких-то практических вещей из культуры сырья так или иначе это нужно делать просто если это делать более и неосмысленное если понимать то что рано или поздно мы туда придем the data наверное жизни наши станет немножко попроще но какие-то проблемы сейчас основные на твоём пути моем пусть они сами проблемы лак в понимании наверное бизнеса и руководящего состава в в сознании проблематике то есть опять же вот это вот порочная практика то что пока пока у нас каптерке горит свет это буквально равно то что у нас все в порядке хотя на самом деле мы уже серьезно опоздали в нас уже есть большие какие-то комплексы проблемы то есть и чувство что сопротивление идет не от с персонала обычных разработчика фокусов и прочего а именно за руководство да но это не то что сопротивление это отсутствие такого осознанного понимания что происходит того что очевидно из-за своей роли людям тяжело вникнуть во все нюансы и пока не случится что одну секундочку о ололо раз трос добрый день очень рад вас всех видеть давайте начнем начну я с базу вардов в нашем деле без них никуда и 1 база word будет это дельта warehouse сам термин появился еще в прошлом веке после публикации статьи борей давлен а и пола морфи и в этой статье рассказывалась описывалось архитектурная модель для хранилища в которые стекают данные из разных источников вот такая вот в общем история так не туда нажал так вот что такое дтл house какого-то четкого определения этому термину я не нашел но если почитать различные книги статьи как вот например на сайте оракла то становится понятно что до этого или house хранилище данных служит для для централизации и консолидации данных из разных источников исторических данных особо хотел бы отметить и это слово исторических потому что именно про это я чуть позже начну рассказывать так опять не туда выглядит архитектура архитектура до этого олехаус примерно таким образом то есть есть какое-то количество разнообразных источников из этих источников данные по определенному процессу который называется этель что означает извлечение трансформация обработка и сохранения данных это все в какое-то большое хранилище попадать следующим уровнем над этим большим хранилищем стоят какие-то витрины данных и через который уже конечный пульт получает доступ к нужным ему данных цепью аналитики майнинга данных репортов и и так далее мне довелось поучаствовать в разработке надо это warehouse начиная с ядра инвестиционного бизнеса альфа-банка которой уже на холоде рассказывал владимир drinkin' поэтому тех кто интересуется направлю по ссылке посмотреть его доклад очень интересный и вся эта история она оформилась виде тарантул datagrid про который сейчас я не буду рассказывать скажу только что в процессе мы реализовали 2 2 типа вирусе а нирования данных сидя type 2 из сидит type 4 что это такое а что такое этой сиди если эту аббревиатуру расшифровать получается слова лечение джин дименшенс термин этот был введен насколько я знаю ральфом ким balam в своей книге которые уже там три переиздания по моему пережила дыры house тулкит что он означает этого собственно механизм для отслеживания изменений в данных причем даже не один механизм а несколько до в этом термине есть да такое слово слову ли то есть медленно какие-то изменяющиеся данные в самой книге я не нашел ответа на что такое слово ли четкий какие-то критериев нет поэтому будем считать что какие-то данные которые изменяются быстро например эта информация с какого то датчика это быстро изменяемые данные а например изменения адреса пользователей или изменения информации о состоянии сделки это слово ли то есть наша история типов среди всего встречается 8 причем базовых типов 5 а остальные являются комбинацией этих пяти типов причем на самом деле комбинаций может быть произвольное количество здесь можно отталкиваться собственно от своей задачи и реализовать с помощью базовых вот этих вот типов любую задачу самого правильного какого это единственно правильно лучшего типа нет потому что в одной и в одном сценарии тип может показывать им хорошо а в каком-то другом сценарии наоборот показывать все они очень хорошо начнем самого базового типа это сидит type-0 этот тип означает следующие данные не изменяются то есть если произошло какое-то событие или какой-то факт зафиксирован то все эти данные они остаются неизменными ну и соответственно тут никак не идет речи об отце отслеживание каких-то изменений следующий тип и тип 1 это то что мы видим суды общего назначения то что там а из коробки стратегия которая там есть то есть просто хранятся актуальные данные если мы делаем обновление каких-то данных то просто старые перри затираются новыми и таким образом мы всегда имеем лишь последний вариант какое-то актуальное состояние в терминах тарантула реализовывается это довольно тривиально то есть есть у нас формат таблицы создаем таблицу создаем первичный ключ и в общем-то используем функции такие как gt insert апдейт в общем-то код довольно очевиден наверное комментариев не требует единственное что хотел бы здесь отметить то что в таблице хранятся данные в плоском виде и для этого здесь есть такая функция как flat on и функция апдейт она на вход принимает список обновляемых полей дальше для других типов я реализую такие же функции с такой же семантикой подведем итог небольшой очень просто для реализации нет никакой избыточности никаких накладных расходов но в минус очевидно это то что не сохраняется история со вторым типом в плане и все хорошо то есть здесь мы имеем полную историю и достигается это тем что мы добавляем еще одну колонку с версией и каждое обновление данных это создание новой записи в в примере на экране вы соответственно видите что здесь изменился адрес и мы видим теперь две записи старую и новую с другой версией опять же на таран туле это рис реализовывается довольно просто так же у нас есть формат таблицы где мы видим что появилось еще одно поле вершин создается индекс единственный момент что индекс в первичный ключ кроме самого идентификатора мы добавляем еще версию тарантул позволяет это сделать и таким образом пара из идентификаторы и версии для нас решает проблему уникальность первичного ключа при обходе данных тарантул также позволяет не указывать полностью индекс поэтому мы можем указать только идентификатор и получить итераторы пройтись по всем записям которые имеют такой идентификатор то есть получить таким образом всю историю здесь в общем так вот тоже довольно мне кажется очевиден единственное что вот когда нам требуется получить всю историю мы по таблице перемещаемся как я уже сказал по индексу не указывая версии таким образом получаем все записи функции вставки и обновления выглядят также довольно просто единственное что мы здесь видим это то что мы обогащаем поле версия каким-то значением но в данном случае вот мы берем время не обязательно в качестве версии использовать время но я считаю что использование времени дает ряд преимуществ первый это исторические срезы мы можем посмотреть на то как база данных выглядела в какой то момент времени просто выбрав все записи у которых вверх впадает в нужный нам диапазон ну и таким образом увидеть как вот она выглядела на тот момент второй небольшой бонус но приятный это то что если им использовать время которое получаем на сервере то мы получаем какую-то устойчивость конфликтом репликацией при нормальном работе системы при нормальной работе системы у нас данные идут на мастер от мастера нее уже потом копируются на реплику таким образом происходит репликация если же вдруг в случае и какая ситуация может возникнуть в случае асинхронной репликации если у нас пропала мастер по каким-то причинам например кто-то споткнулся о кабель то возможна такая ситуация мастер получил данные успел их у себя сохранить но не успел их от реплицировать нарушилась связано с ним система понимает что пропал мастер выбирается новый мастер и на него приходят те же данные таким образом мы получаем и на мастере на реплики независимо друг от друга сохраненные данные после того как восстановится связь с мастером пойдет процесс обмена данных чтобы и мастер и реплика имели полный набор данных и вот здесь в такой ситуации мы можем получить и конфликт репликации которые потребуют вмешательства то есть придется приложить какие дополнительные усилия для того чтобы починить систему в случае если мы будем генерировать время на сервере использовать его как часть первичного ключа то у нас будут разные индексы мы такой с такой проблемой не столкнемся вероятность этого будет очень мало и можно будет пренебречь подведем итог по второму типу мы имеем полную историю метод довольно прост в реализации очевидно присутствует какая-то избыточность и самый большой для меня мир 2 типа это проблема с запросами которые не содержат первичный ключ здесь нам будет не достаточно пройтись просто по какому-то индексу и получить данные нам нужно будет проверять является ли эти данные последней версии из-за этого все такие запросы они достаточно низко производительные есть вариации в плане реализации второго типа например добавляет еще одна колонка которая указывает на той являются ли данные является ли эта запись актуальной или это какая-то к запись частично такой подход помогает решить ту проблему который озвучил с медленными запросами но при этом появляется другая проблема и теперь при обновлении версии нам приходится и делать вместо изменения одной строки нам приходится модифицирует две строки подход этот имеет тоже плюсы-минусы понятно плюс опять полная история минусы избыточность и теперь у нас уже страдает производительность при обновлении данных я встречал также в интернете упоминание о других способах реализации второго типа например вместо одной колонке с версией используются две колонки это начало времени жизни версии и конец времени жизни версии честно говоря мотивации мне не совсем понятна и объяснение не нашел зачем это делается единственно что могу предположить что для людей критически важно заодно чтение видеть время существования какой-то версии друг других общем я не могу придумать плюсов от этого также встречал варианты реализации где помимо start and у нас добавляется еще и колонка corinth ну здесь я могу придумать интересный бизнес кейс именно можно записав в corrente труд то есть показав что это актуальная версия таким образом завершить время жизни какой-то последовательности возможно в каких-то кейсах это будет важно соответственно плюсы можно завершать жизненный цикл серии изменения без удаления но и минусы понятно опять же нам нужно обновить не только запись версии но еще и предыдущую запись снять флажок о том что она была активной 3 возможно нам захочется избежать дублирования информации которая не изменяется допустим у нас меняются только одно два там три поля из какого-то большого количества полей здесь можно использовать третий тип он говорит о том что для изменяемых значений можно добавить еще одну колонку соответственно мы добавляем еще одну колонку например вот email old email и при обновлении версии соответственно мы записываем в колонку old предыдущее значение но и актуальные пишем уже в колонку без old на tarantul и опять же это реализуется довольно просто здесь мы видим что появилась еще одна колонка для того поля которая изменяется ну и в общем то все остальное довольно просто вот функции чтения данных становятся сложнее потому что нам теперь нужно скрыть детали реализации то у нас есть какие-то дополнительные колонки и вернуть пользователю просто обычные записи которые он ожидает видеть без каких-то служебных полей функции вставки в принципе довольно простые единственное что при обновлении какой-то записи мы должны переложить старые данные соответственно в историческую колонку плюсы-минусы довольно хорошо работает третий тип когда у нас каких-то полей изменяется немного и мы хотим избыточность птиц в этом случае хорошо работает минус это то что история ограничено конечно можно добавить не одну историческую колонку а вторую третью но принципиально это ситуацию никак не изменит от себя добавлю что по моему мнению данный тип очень хорошо работает с другими типами например если у нас есть какая-то система отслеживания задач и нам критично заодно чтение видеть предыдущий статус задачи и текущий или там текущие и будущие то мы можем историю например хранить в таблице которая реализует четвертый тип а как раз и использовать таблицу встретим типов для быстрых чтений четвертый тип он смысл в том что мы добавляем таблицу в которой будут храниться исторические данные таким образом изменения версии будет означать что мы запись перекладываем в историческую таблицу в базовой таблицы оставляем актуальное значение реализация натан здесь единственное что я хочу отметить то что да вот создается исторический историческая таблица и в этой исторической таблице у меня немного индекс отличается от базовой а именно я также версии создал первичный ключ и из пары идентификатора и версии для того чтобы иметь возможность простым обходом получать историю функции чтения довольно простые единственное что когда мне нужно получить всю историю я дополнительно делаю проход по историческому по исторической таблицы и получаю там всю историю функции записи вставки и обновления выглядят очень просто выглядят они очень просто по той причине что вся логика у меня вынесено в использовании триггеров в этом сценарии очень удобно позволяет всю логику поместить в одно место и значительно все упростить и значительно логику упростить других местах здесь я проверяю о том что старое значение не равно нил это значит что мы изменяем версию в таком случае я просто беру и эту запись перекладываем в исторический в историческую таблицу ну и в любом случае при вставке и при обновлении мы обогащаем ту запись которая будет сохраняться версией плюс и минус и плюс полная история от быстрый поиск по актуальным данным то есть у нас здесь нет никаких накладных расходов фактически здесь скорость будет такая же как в случае типа 1 где нет вообще versio нирования плюс в чем этот четвертый тип интересен тем что мы можем использовать как интересные стратегии например в исторический space складывать не полный набор колонок а только например если у нас изменяется только часть каких-то колона кто откладывать только их или например сохранять историю на в какое-то другое место в холодное хранилище диск там что угодно на этом плюсы закончились начались минус и минусы очевидно это избыточности второй минус это то что добавление новой версии требует записи в две таблицы подведу итог по базовым типом тип 0 оригинал не меняется тип 1 и хранятся актуальные значения тип 2 добавляется новая запись тип 3 добавляется колонка и тип 4 добавляется историческая таблица все остальные типы являются комбинацией базовых я уже упоминал что на самом деле и типов описано больше что это за типы на самом деле здесь есть определенная путаница хороший хорошо эту ситуацию показывает вот такой вот диалог нас так airflow человек пишет о том что он читал им было и так airflow и до сих пор не понял для чего нужны эти типы 5 7 и ему отвечают что это не беда потому что есть определенная путаница там с терминологии и в общем то надо отталкиваться от своей задачи тут невозможно не согласиться полно я все-таки попробую дать описание этих типов в силу своего понимания потому что на самом деле информация скудная довольно противоречиво тип 5 говорит о том что какие-то часто изменяемые данные можно вынести в отдельную таблицу как и в типе 4 изменять только ее при этом например в книге кем было он пишет о том что возможно по соображениям производительности вас не устроит такой подход тогда вы можете взять и встроить эту таблицу в базовую таблицу в чем тогда будет отличие от типа 1 мне в общем-то не понятно тип 6 он говорит о следующем что добавляется новая запись то есть каждый каждая новая версия это новая запись как в типе 2 при этом у нас появляется дополнительная колонка которая хранит актуальное значение тип 3 и при обновлении записи мы должны обновить вот это вот актуальное поле у всех предыдущих записей то есть видно что этот тип явно заточено то чтобы быстро получать актуальное значение вот в данном примере например здесь у нас джессика переехала из одного места в другое но при этом в исторической записи и есть и запись для историей и в то же время есть кучей ее адрес то есть возможно в каких-то случаях этот ти будет хорош когда нам нужно делать такие запросы на чтения + и полная история получение актуального значения очень эффективно но при этом добавлении новой версии требует обновления всех предыдущих версий вот что конечно не может не огорчать тип 7 это альтернатива шестому типу то есть он позволяет достичь тех же целей но при этом другими способами а именно мы выносим актуальные значения в отдельную таблицу и можем соответственно получен когда нам нужно обновить актуальное значение мы будем обновлять это в одном месте они в н мест до соответственно что у нас тут плюсы плюсы опять же полная версия плюс при обновлении версии нам не требуется менять n значение нам потребуется только 1 экстра запись вот что уже лучше я закончил на этом всем спасибо за внимание и если у вас будут вопросы я постараюсь на них ответить спасибо жался за доклад очень хороший понравился вопрос только в том где вы показывали пример и с датами там же получается но одно дело когда у тебя база смотрят за консистентной стью данных а другое дело когда ты сам начинаешь и тут может быть очень много подводных камнях особенно всяких репликаций краска зеленых транзакциях как здесь находить баланс получается здесь можно обсудить какие-то конкретные подводные камни я на самом деле просто сейчас для себя не совсем понимаю сценарий о каких подводных камнях может идти речь и в любом случае тот код который я показывал мы берем на себя до ответственность да давайте вернемся это у нас ну например там где две даты выберите непонятно как его для чего так делала я понял один из юз кейсов этого чтобы были запросы проще когда нужно найти интервал проблема заключается в том что допустим у классическая задача там типа комнаты и стулья что у нас один стул может оказаться одновременно в двух комнатах когда есть ошибка обновления когда н.д. допустим не совпадает со стор дейт и то есть получается одна и та же запись и бывают в двух разных местах и вот здесь получается не консистентной да тебе одно поле в базе то у тебя сама база не даст его создать хорошо в каких случаях может оказаться у нас в двух разных местах давайте пойдем с такого момента в каком случае у нас может оказаться в разных местах когда у нас использую какое-то шарди рование например часть данных у нас сохранится на одном шарди часть на другом шарди как мы можем избежать такой ситуации чтобы они оказались в разных местах мы берем и шар деру им по индексу по первичному ключу таким образом если мы откровенно там не накосячим с реализацию у нас все данные с таким вот индексом будут оказываться на одном шарди то есть на одной физической машине соответственно в рамках одной физической машин мы можем начать транзакцию прочитать старое значение обновить его потом на записать новое значение закрыть транзакцию то есть мы защитим ся от того что у нас разъедутся данные в общем так каких-то других проблем если все реализовано правильная в общем-то не вижу надеюсь ответил на вопрос потом можем поговорить о услышал меня отлично вячеслав гнивц а подскажите пожалуйста тут все кейсы были рассмотрены они были рассмотрены например обновление записи также было бы интересно стекла сказали примеры с именно с удалением записи когда происходит удаление в частности вот этот пример или меньше 2 типа очень хорошо обыгрывая данную ситуацию когда у нас именно две даты и вторая дата она служит одновременно и признаком удаления когда вы спрашивали не знаете кейса все а практике очень часто применяем когда запись именно закрывается то есть ул актуальной записи мы проставляем там бесконечность девятки тыс первое 12 99 9 тысяч 990 тг 2995 и удаленные записи мы проставляем актуальное значение тогда мы сразу видим когда запись перестала существовать и вот для меня это юзабельный кисть постоянно этим пользуемся очень полезно также встречали еще вот в этой же слове чем джим dimension использование именно флага когда просто добавляется флаг там enter the baby ride расскажите еще про удаление пожалуйста расскажу про удаление расскажу и как раз на примере тарантулы the grid как у нас реализовано там удаление с ночей мы пошли сначала следующим путём использовали отдельное поле которая говорила о том что данная запись удалена то есть там где летает равно true чем было у нас проблема при таком подходе у нас очень сильно страдали различные аналитические запросы нам нужно когда нам нужно было найти какие-то данные нам приходилось во-первых определять что это актуальное значение 1 а второе то что это не удаленное значение 2 поэтому набив тут определенные шишки мы потом перри перешли к другому способу а именно по аналогии с тем как хранятся версии в типе 4 в отдельные таблицы мы также удаленные стали перекладывать в отдельную таблицу для удаленных вот ну и соответственно вот такая вот у нас история мне кажется это довольно неплохой вариант поступать вот таким вот образом а здравствуйте и спасибо за доклад не здесь мне на самом деле два вопроса ну во первых я поддерживаю предыдущий вопрос принципе у нас тоже похож на схеме реализовано именно для случая в дальняк разбавляется дополнительное поле который говорит о том что существует ли запись или нет то есть получается что мы отмечаем не только даты существования этой записи но и дата ее не существования то есть может быть какой то промежуток времени да да строка была удалена а потом мы взяли восстановили ну то же самое там относится к истории сафди видами и с влогами активности и так далее вот вопрос у меня во второй части был другой вопрос если пойти в сторону вообще как унификации данных да ну как вообще изначально делать подход битриксе чтобы упростить работу да то есть мы обобщаем данные но в целом если мы говорим про таблицу что вот эта вся история соседи она на уровень выше чем физически таблицы на самом деле соответственно можем взять абстракцию такую что типа выделим отдельную таблицу ну если взять какой то да и успешный подход то сразу идея приходит а давайте ка сделаем отдельную таблицу в которой будет несколько полей которые говорят где находится эта запись физически одно поле текущее значение этой записей и там одно поле боковой колонке это запись вот такой подход не рассматривали еще но нет не рассматривали он даже звучит очень сложно сам по себе ну допустим вот нас там одна табличка мы хотим сделать от подход берем отдельную таблицу говорим history и в ней первое поле какая таблица название таблицы второе поле айди в этой таблице 3 поле название колонки и четвертое поле значение этой колонке так так так так и у вас да получается при обновлении вы будете обновлять только одно всегда значение то есть добавлять 1 sign cert в историю да ну естественно это больше 4 типа имею ввиду так когда мы отдельно от основной таблицы увидим историю тогда вас получается отдельно таблице вы в нее делаете вот отдельный insert один раз и вас не дублирование данных но херово история в том что типа получается это вообще данные по значению по разным значениям мы закладываем в одну ячейку и сисадмины вообще в ярость придут от такого решения сейчас я немножко запутался я правильно понял что вы решили хранить все пока ло ночь на это как ну то есть вот изобрели колон начну нет мы такое не используем я просто про этот метод не упоминали решил его упомянуть а я понял спасибо да он плохой получается с ваш страны но я его до конца не осознал косвенный признак того что наверно он не очень хороший если его нельзя стро понять ну окей пасибо можно потом поговорим я попытаюсь вникнуть глубже здравствуйте спасибо за доклад интересует такой сценарий когда у нас вместе с данными меняется еще и тип колонки можно ли ну как-то гибридное то здесь представить потому что на практике бывает истории когда нас допустим сначала это было скалярное значение видео e-mail до затем она начинает быть пассивом и клиенты очень часто хотят это прозрачный иметь на своей стороне чтобы система хранения как-то на техника выдалась начал там скаляр а потом массив то есть менты методологии каким-то образом можно отобразить в общем и история понятно нам нужно и змей измените формат таблицы ну в общем как это обычно решается решается миграциями то есть мы можем обычно это делается либо все останавливается накатывают скита альтеры запускаются скрипты которые перекладывают из одного места в другое ну и потом все запускается можно пойти более таким путем который позволяет сократить простой делать это на лету то есть как это вот сделано например в таран туда they agreed когда меняется формат таблицы мы создаем новую таблицу с новым форматом после чего фоновом режиме перекладываем данные из старой таблицы в новую используйте какую-то функции функцию трансформации чтобы вот ну например как если массив то соответственно значения это должно там лечь в первый элемент массива вот то есть нужна какая-то функция трансформаций ну и соответственно вот когда это заканчивается вот мы имеем возможность удалить старую таблиц и все вот как бы миграция завершена вот мне вот так такой вот способ известен еще вопросы спасибо максим за доклад была интересна тем что это еще кит вопросы появляются проходим кулуары и спрашиваю вы максим вы бьете пожалуйста лучший вопрос который он понравился больше всего мы подарим автор о вопросах целую книгу так сейчас я давай давай давайте я дим приз это так по которой рассказывала в своей схеме версия нервы не которая не понял вот им пообщаться вот да да да поздравляем буддизм и вынь да я ловлю дай его в туре вида санчес эра видную заслон из people feel канате ричарда i cannot так что конечно под стол был до ялты дай мегафон xd из connection штанга штанга пройти одно той was instantly be complete его одолевает мегафон мегафон успел прийти и тянет к ковру mouth and certainly нас к икрамова cc весь смысл со своим ваша цель интернету и был тыл ты ее 20 млн грн мегафон и тет-а-тет шанс и пофиг ведь это идти с смотри шанс мегафон особенно еще 2 знать или тянется в линза people ой был быть ума но очень не людмила путина мегафон и skylink ты читал bout где не привет я артем я экс редактор хабра и ведущий подкаста мы обречены рад познакомиться дашь приятно primator team ну рассказывай чем занимаешься ты во всем по чуть-чуть в госбанке насколько это возможно но насколько я знаю если ты работаешь государства банки тебе немножко сложнее настраивать все и выбирать инструменты и соответствовать другим требованиям надо безусловно да если говорить про какой-нибудь например стартап конечно у нас очень большая разница но если говорить про какие-нибудь мировые гиганты где потом например гугла фейсбука мне кажется у них тоже не так легко и быстро взлетают какие-то активности просто не про это давным-давно узнали и раньше как бы нас могут это все протестировать проверить в них там есть научные какие-то лаборатории исследовательские команды рэнди отделы там не знаю можно ли департамент который занимается у нас же это по сути ложится годовых drops of которые так скажем на чистом энтузиазме предлагают улучшить там текущие современные процессы там теми инструментами которые востребованы сейчас в мире в чем для тебя самая большая трудность и разница по сравнению с тем что делал раньше до того пришел в государственный банк я пришел банк меньше двух лет назад полтора два года назад вот пошёл к кнопке заниматься тем чтобы развиваться домов с направления да и как-то привносить какие-то современные стандарты как раз таки в нашу компанию вот и получилось так что там у нас уже была небольшая команда там порядка 10 человек и мы активно разрослись сейчас нас там порядка 50 мы очень сильно нарастили мощь как раз таки в автоматизации непосредственно потому что не буду скрывать раньше года там до 2017-го наверно псб да да это получается чем промсвязьбанк наши ребрендинге все эти учитывают ну вот в эти банки обновления были практически ручного характера да то есть инженер это ручками заходили на физический сервер а то подкладывали какие-то файлики ребута ли какие-то сервисы что с этим делать на вот потом это все начала активно как раз таки развиваться как раз тогда стало 20 это вся культура одна интересная прикольно да и все стали мне переключаться вот и как раз вот где-то там получается 19 году туда пришел я а вот меня позвали как бы эту всю историю начать усилять развивать вот и краски завод почти то погоды мне кажется мы сделали большой шаг к современному му так скажем 2 суда вот про что вот как бы довольстве называют а мы с точки зрения культуры с точки зрения технологического стыка из процессной составляющей то есть мы очень сильно выросли и если поначалу набирали людей чтобы тушить пожар и потому что систем было большое количество digital как бы очень растет сейчас да там добывай системы расширяются просто колоссально быстро количество разработчиков нас команды там росли просто с геометрической прогрессии какой-то и вот как раз дата последней наверное полгода у нас уже получается активно двигаться в сторону и рэнди то есть никак как раз таки развитие вас по ходу дела так скажем обходилась обходилась тем чем есть вот сейчас большое внимание уже выделяем как раз таки развитию и каким-то новым современным ведьм который мы хотим использовать поэтому потихоньку переходим на декоративные описание инфраструктуры там использования с подхода инфраструктуру как кот там для написания скриптов описаниями описания непосредственно там наших нашего окружения можешь помочь чуть конкретнее это пример написать например что ты не можешь использовать и чтобы ты хотел использовать от чего тебе приходится отказываться в таких условиях допустим появился какая новая фича на хотим и я тоже тоже естественно использовать мы начинаем это все там тировать у нас соответственно есть разные тестовый полигон и тандыр стенды тестовое окружения вот на которых мы можем там что-то проверять вот в случае если используется что-то вообще новое что то так скажем с вероятностью каких-нибудь уязвимости до взять ту же контейнеризации почему ее наука не секрет же да говорят что в контейнер и образы это вообще не про безопасность то есть это не очень secure штуки и ну понятно почему да то есть и вот мы как раз таких как госбанк глубоко анализируем эти вещи то есть мы не просто но будем работать с контейнерами да заходим docker hub скачали поехали нет мы просто прорабатываем звуки процессы как мы на проверяем там до круга реагируем campanula им создаем свои какие-то образы из каких-то базовых томов образовал да там и так далее то есть мы выстраиваем и цвет целый цельный комплексный процесс но вам же вы же не отказывайтесь вообще это 9 подхода контейнеризации просто как ты ее не конечно услышано вы используйте вот эти все докеры губер на этих и то что сейчас пишут в резюме devops это что надо знать мы к этому движемся то есть я не знаю там могу говорить не могу есть какие то такие вещи вот production у нас пока такого не то есть мы к этому как бы активно идем готовимся нарабатываем тоже мышечную массу вот экспертизу очень часто со беседовал народ и люди настолько привыкли работать с вот виртуализации контейнеризации совсем оберните с docker и так далее что забыли про уники вот прикладные уровне на что есть там железо которая как-то работает там ну и так далее уж пристом балансировщик аппаратный этом какие телефоны с которыми там нужно бывает который очень топорно там делят типа и пользовательские ну то есть много очень нюансов и как раз таки когда мы выстроим выстраиваем вот наши процессы это очень круто для наших специалистов потому что это заставляет и в первую очередь покачивается поле широко более глубоко также наверное сложно нанимать людей при таких условиях и какова же уровня люди должны приходить сюда чтобы ты их брал совершенно тот сложный вопрос тут на самом деле наверно нам очень везет потому что у нас очень крутая команда очень классные ребята очень сильной то есть на самом деле так чуваки они как бы и так скажем за приклад секу да то есть они знают как грубо говоря происходило там обновления там пять десять лет назад то есть на более вот таком низком опорном уровне и при этом они в них есть понимание как так скажем на современном уровне сейчас все происходят от с помощью где распределенных кластеров каких-то вот этих всех штук одобряли и ну тут очень сильно конечно мы стараемся значит уровень наших сотрудников подтягивать на регулярно проводим какие-то обучения отправляем на внешнее обучение зазываем спикером спикеров к нам банк чтобы приходили люди рассказывали нам что лучше вообще происходит в мире да какие есть современные штуки что все там давно в облаках что обернитесь и докера и самое главное как к этому прийти потому что понятно дело что ну не сложно поднять там настроить кластер да не сложно чтобы все это работало вот когда у тебя нет выхода там никакого в интернет вообще ниоткуда это сложно вот это становится сложнее вот здесь уже включается как раз таки креатив и интерес что как все должно работать а как все проверки должны обеспечиваться как у нас там трафик должен ходить клиенты подключаться как у нас там несколько прокси-серверов там и так далее то есть здесь уже встают интересный вопрос интересный кейс а что не так просто как бы работать как раз таки в сегменте который вообще не имеет доступа никуда вот он всегда мы банк который спрашивает гособоронзаказ мы обязаны так скажем придерживаться всех передовых и возможность критериев по защите и соответственно конечно у нас очень как бы но к этому относимся ответственно и безопасность у нас очень ответственно и поэтому этот момент дома не творится хорошо но естественно есть различные фронтовые системы сервис эквайринга там все прочь к которая конечно же в интернете там и так далее но к ним тоже повышенные требования безопасности которые мы обеспечиваю вот поэтому возвращаясь к вопросу значит провод как мы людей ищем то что как бы люди там эксперты по кубе рам и так далее это очень круто это очень востребована просто так получается что они не всегда с нами так скажем совместимы да то есть мы не совпадаем этим штукам потому что мы сейчас это все только то есть нам нужно люди вот они широкого формата до которые как бы знают а было как должно быть в будущем куда мы стремимся то есть вот так получается что мы вот на пересечении как раз таки сейчас вот этих двух эпоху да когда мы уходим от каких-то вот вещей таких постулатах вот в 10 15 годах его двигаемся в новый я тебе желаю успехов справляться с этим чтобы все было надежно и дальше но и чтобы вышли и чтобы все получалось сделать удобно и современно совмещайте спасибо большое спасибо пользуясь случаем а у нас есть пар вакансии если кому то интересно краски более глубоко изучать так скажем стандартные вещи этого пожалуйста просим которая внезапно против хай-лоу да тут мы расходимся так причем тут собрались давайте послушаем уважаемых спикеров подходите не стесняйтесь рожков denis и тарасов георгий поприветствую добрый день друзья приветствую на слышно и даже видно друзья ну откуда мы и откуда взялись на этой конференции слайда не видно ну наверное с опозданием как в некоторых залах сейчас тут появится те же люди но такой виде фотографии параллельная как раз начну говорить об этом собственно георгий единиц мы из компании газа form service и занимаемся продуктом штаба это суп на основе под грейс quelle один из форков со своими особенностями улучшениями так далее но мы не не про наш продукт друзья у нас презентация настолько сильно отстает слайды есть слайд есть тут нет а там все видно отлично и соответственно я занимаюсь организации работы самого продукта георгий у нас ведущий специалист и сегодня мы расскажем про некоторые аспекты по безопасности которые в нашей компании наиболее актуальны в тех проектов с которыми наша компания работает а что за компания собственно говоря мы отечественные интеграторы и вендор по программного из печенья области информационной безопасности в основном работаем с крупным отечественным сегментом то есть крупной корпорации где безопасность как правило на высоком уровне поэтому для нас это не теоретическая какая-то задача нам реально в наших проектах надо решать задачи которые ставят заказчик и в том числе регуляторы отечественной которые вы наверняка знакомы компания крупная но собственно говоря на слайдах в принципе вы видите о том что и филиалов много и сотрудников много поэтому процесс и не простые продукты делается надолго серьезно почему мы про безопасность буду говорить потому что в продукте этого как раз аспекты безопасности исторически сложить был или как раз проработаны в большей степени даже некоторое время назад мы на безопасности за тащились даже больше чем на перфоманс и некоторые вещи просто вы open source и отсутствуют они собственно даже в коммерческих версиях некоторых иностранных отсутствуют но на отечественном сегменте это просто жизнью необходимость в заказчика это должно быть реализовано какими способами какими средствами это как раз проблема разработчиков то есть наши и как раз вот мы прошли сертификацию стык на 5 воды и собственно говоря у нас собственная разработка то есть команда разработчиков как раз занимается тем что пилит свой продукт собственно вот уже переходим непосредственно зачем вообще этим проект проектом и зачем заниматься этими аспектами ну георгий тут наверное тебе как раз лучше говорить да добрый день уважаемые коллеги добрый день уважаемые коллеги ну и начнем наш доклад в общем там будет немножко технического от по сгрыз и основной вещь которую мы хотели в общем донести до и это устроить как бы такой своеобразный мо через докладе да у нас с одной стороны во всех проектах есть постоянное требование заказчиков что все должно быть быстро все должно быть надежно но в то же самое время мы почти всегда слышим такие вещи что все должно быть безопасно я сейчас использовал самое широкое как бы понятие этих терминов то есть все конечно детализируется и вот мы решили ну посчитать вообще основное как бы все прекрасно понимают что конечно все информационные системы и базы данных должны работать быстро и надежно но мы в докладе решили посчитать а чего стоит безопасность в хайло иди и вот придумали некий такой доклад некое такое ну может быть соревнования или определить вот долю каждого понятия да у нас есть хай лот у нас есть безопасность грубо кто выиграет да вот что важнее ну и что мы будем обсуждать вот у нас значит всем разрабатываем информационные системы до суда является сердцем любой информационной системы и дальше мы в докладе будем говорить только с ума дзд у нас мозга раз ну плюс наш продукт что там и как бы покажем из наших расширений когда строится в инфраструктуре какого-либо проекта субботы до у нас там есть пользователи вот мы даже нарисовали что у нас есть у нас есть как люди пользователи да так и какие то другие системы компьютерные программы которые там подключаются к свободы у нас есть сумма д как центральное звено обязательно должны быть какие-то реплики иначе там какая у нас там отказоустойчивость какая надежность и все это подвергается клонированию аудиту мониторинга то есть вся вот эта инфраструктура должна работать ну и наш план следующий дамы вот осветим четыре аспекта через призму highload против безопасности или безопасность против хайло вода у нас есть подключение к свободы их надо как-то защищать у нас есть много много данных которые находятся внутри субд и внутри баз данных этой субд и их тоже надо как-то защищать у нас есть реплики каналы между репликами ну между главным сервером и репликами и у нас есть аудит всего этого как бы который тоже добавляет сложностей нагрузки и вот собственно цель нашего доклада как сочетаются требования высокой нагрузке и безопасности наш матч до безопасность против холода счет пока 00 давайте приступим сразу хотел бы вот такую может быть в конце кто-то поднимет руку и скажет вот мы здесь выделили как бы 4 раунда у нас будет четыре раунда ну я не очень спортивный человек но в слежу за некоторыми спортивными соревнованиями и чаще всего сталкиваюсь с тем что там где-то 3 раунд где-то два раунда ну там хоккей футбол не знаю волейбол баскетбол бокс а вот как-то спорта с четырьмя раундами основного времени но не знаю да вот если кто-то поднимет руку и скажет что вот такой то спорт приз это просто развлечение итак приступим защита подключениях пользователи или какие-то программы и су б.д. ну прежде всего во всех проектах когда речь об этом заходит всегда начинается некое проектирование до выдвигается что у нас есть бизнес пользователь пользователь су б.д. часто это ну как бы в разные сущности да есть разные проекты разные требования но так или иначе этот вопрос должен задаваться субд и может представлять некоторые api виде хранимых процедур и да все зависит от того как построен проект субботы часто вот со всей инфраструктуры реплики там еще вспомогательные сервера да она выделяется как некий отдельный отдельная сетевая инфраструктура появляются всякие дополнительные слои буллинга прокси и так далее и вот из той простой как из той простой картинки которую я нарисовал в начале у нас появляется вот такой вот монстр да ну все зависит от грандиозности того что вы делаете то есть ну для маленьких проектов понятно может быть нужна простая схема когда у вас десятки серверов еще больше реплик тысячи пользователей то вот все это неизбежно приводит к тому что у нас появляются каскады кулеров внутренняя инфраструктура суббота и и реплик с различными механизмами управления отказоустойчивостью и в общем это уже появляется такая непростая вещь и здесь сразу появляется там ни одно 345 может быть 10 всяких сетевых взаимодействий сетевых конфигураций в которых тоже передаются чувствительные данные персональные данные не знаю банковские данные ну то есть все что угодно что представляет коммерческую ценность защищена различными там государственными регламентами и так далее должно быть защищено ну их что мы чаще всего видим да есть всякие кастомные решения кто-то ставит аппаратные вещи кто-то разрабатывает целые регламенты связанные с порочными политиками кто-то занимается там защитой каналов специальных там со специальным оборудованием но общепринятая практика да и она вот мы видим и в out in south sea и в открытых проектов и в закрытых проектах это в общем традиционный sl или его сейчас современное уже развитие этот лес и в принципе все облачные провайдеры да вот все что мы сталкиваемся и не только по фгос это с мтс в каком-то виде то есть все защищена ну и соответственно сразу возникает такой вопрос то есть если у нас вот такая большая инфраструктура кластера и нужно делать безопасные соединения а чего это будет стоит с точки зрения ну хайло да то есть у нас там большая нагрузка но вот все необходимо защищать там разными способами и как бы чего это будет стоить мы обратили свое внимание как бы решили вот померить assn вообще он ну насколько что он отбирает с точки зрения хайло вода что мы знаем про сны про эстель мы знаем что это некий такой стек протоколов чуть выше транспортного уровня он дает помимо того что у самого тисе пи есть да некоторые летом сито и он сам по себе дает некоторую в этом си потому что в начале происходит scher-khan шейк где та сторона сервера и клиента договариваются о ключах авто модифицирует и так далее и после этого когда все произошло сессия установлена значит происходит уже передача данных и собственно основная нагрузка ложится вот на нижележащий уровень который шифрует компрессируются расшифровывать ну в общем когда уже идет передача данных то вот значит нагрузка вот здесь опять же хан шейк тоже периодически возникает потому что ну можно там раз в час устраивать обмен ключами переназначения ключей и так далее и так далее то есть это ну весьма такой требовательный к ресурсам протокол ну и мы провели простые тесты сразу хочу сказать что вот у нас докладе будет разные тесты но вот чем глубже мы так сказать копали в этом направлении тем больше было понятно что тестов можно производить и больше и так сказать милион всяких нюансов возникает с разными конфигурациями поэтому в одном докладе все не осветить мы остановились вот на коротких тезисах ну в чем-то показательных вещах которые и хотим представить то есть у нас для тестирования в подгруппе мы все знаем да pg bench как бы там можно воспользоваться стандартным тестам можно написать свои скрипты и у нас здесь ссср и бсср и как бы некая нагрузка то же самое там с установлением соединения без установления соединения на каждую транзакцию ну тут вот некоторые результаты и наш результат общей сразу скажу что абсолютные цифры здесь не важны то есть мы не то чтобы не заботились о каком-то качественном там супер производительности нам было интересно именно в сравнительном соотношение то есть при одинаковых настройках при одинаковой конфигурации что будет стоить что мы включили сны выключили свет ну и оказалась весьма оптимистично в общем вот наш ссср вот здесь и наш нового состава здесь как видно ну чуть меньше цифры до когда если цель включен и чуть выше процессор на я нагрузка ну опять же там погрешности измерений и так далее то есть есть доля приближения в этих цифрах но тем не менее вот этот результат повторяемый и как бы в некоторой степени соотношение достоверно что мы получили в итоге что в общем чем больше мы защищаем кем у нас больше нагрузка на циpкa потому что надо шифровать надо расшифровывать все это математика инструкции ну тайминги понятно к сожалению да ссср это тяжелое соединение она там устанавливается куча запросов передается туда-сюда все это в общем ну негативно влияет на хайло то есть сколько база данных в состоянии переварить транзакции ну и отдельно вот поскольку у нас и так сказать много государственных заказчиков все они приходят с требованием что вы знаете а у нас там должна быть ну российская криптография не только эрсо аистом и все прочее иностранная ну в принципе вот в ссср это называется там enjoy да и можно есть соответствующий реализации где мы можем заменить движок который ну там конечные алгоритмы подставляют и в общем пользоваться российская криптография поэтому явно разницы в потере производительности но не было то есть что там математика что у нас везде одни и те же ну как бы один и тот же набор операции ну только разные алгоритмы соответствии с разными государственными стандартами им вот учитывая что у нас там получились проценты да то есть там не десятки процентов процент и мы вот сделали вывод что ну все-таки здесь highload побеждая да если так можно как бы выразиться да не нужно ограничивать себя вот смотрим в сторону хайло до добиваемся максимальной производительности максимальных нагрузок нужна безопасность возьмем и ссср если нужны там какие-то государственные стандарты ну возьмем там соответствующие средства которые нам это делают и безопасность ну точнее выполнение требований безопасности здесь ну не окажет такого прямо катастрофического снижение до значит вот работы нашей системе системы поэтому в части защиты подключений здесь бесспорно так сказать 10 и в общем я и здесь на докладах видел значит все спокойно пишут кто знает как это в подгрести настраивается доится стиль мода very five ул то есть полная проверка клиента сервером сервера клиентам и как бы все нормально пойдем дальше раунд 2 обратимся теперь что у нас есть внутри суббота да то есть пользователи к нам подключились присылают нам какие-то данные просит какие-то данные происходит обработка внутри су бды где-то это хранится на каких то значит система хранения что тут можно делать ну мы так несколько так значит примерно разделили на некие группы до на уровне данных то есть на уровне там таблиц ли на уровне доступа данных есть различные методы как можно значит скрывать ограничивать и так далее есть ряд специальных требований и хотелось бы вот несколько слов сказать по каждой группе и если возможно значит показать некоторые тесты того что мы значит успели померить тот результат который у нас получился опять же рассматриваем через призму того что мы хотим хайло да но есть безопасность и вот что чего нам это будет стоить начнем с самых банальных примеров да есть в по сброс уже очень много лет пиджи крипто ну там как бы зарубежная криптография но в общем пока это для целей нашего исследования не очень важно и можно написать такой очень простой пример ну там создали таблички засунули раз-два-три-четыре 10 миллионов записей засунули их в шифрованному виде и вот потом достали в расшифрованным виде и что у нас грубо получается то есть если мы вот там значит включим соответствующие запросы у нас здесь время одна миллисекунда когда все отключена и мы просто достаем данные которые там физический лежат а когда у нас так сказать мы вынуждены пользоваться какими-то функциями шифрования мы заставляем сервер до достать данные с диска расшифровать и отдать в сессию пользователя то почему то запрос и сразу вырастают там 40 50 раз вот примерно так сказать статистика да то есть у нас тут какая-то выборка опять же абсолютные цифры не очень важны вот главное воспроизводимость ситуации и точность того что мы делаем то есть есть обычные данные эта колонка а есть зашифрованные данные эта колонка b все лежит рядом как бы таблица записывалась последовательно нет там никаких шумов апдейтов и всего прочего вот мы сначала выбирали одну колонку шли sequences к нам по всем записям и доставали поле 1 а потом жалеют другим запросам тем же six senses к нам ну сбрасывали кэша ряд буферов чтобы был как бы более-менее честный тест что мы загрузили достали расшифровали отдали пользователя ну и вот вот такие вот данные что все таки вот такое шифрование до пиджи крипто конечно не самый лучший пример как бы то как нам так делать но тем не менее это очень серьезная нагрузка на базу и поэтому когда таких запросов придет десятки сотни ну мы сразу получим overload следующий пример вот в часть шифрования это ну много методов сокрытия данных да то есть как бы encryption а есть masking и тут много всяких методов да вот допустим стандартный по сгрыз предлагает некое сэмплирование таблиц то есть можно там за сэмпле можно там всякими апдейтами создать ну некую копию и там что-то замаскировать можно добавить там шумов случайных данных и так далее кто-то занимается перемешиванием и так далее ну вот для цели нашей нашего доклада нашей задаче это все таки не совсем честно потому что все таки вот такие вещи чаще используют для генерации тестовых наборов то есть когда нельзя что-то делать на реальных данных но это конфиденциальные данные пользователя их никто как бы не отдаст вам разработчикам том что допиливать что-то оптимизировать естественно как бы нужно это все как-то замаскировать поэтому вот в точки зрения нашего исследования highload против безопасности или безопасность против файла да это тот же самый результат что шифрование то есть это та же процессор на и время мы там что-то посчитали что заменили где-то там подменили поэтому вот сэмплинг здесь он в общем не играет какой-то серьезной роли следующий тест и пойдем дальше следующая группа у нас есть помимо того что данные хранятся где-то там внутри у нас есть и мы можем ограничить доступ чувствительным данным на уровне доступа данным и по сгрыз в этом смысле предлагая там широчайшие возможности есть там избирательная модель управления мандатная ну вот частный случай избирательной ролевая модель и мы придумали как бы вот такой тест то есть он ну в чем-то смешной эффективные мы создали 500 пользователей да мы создали табличку которая так сказать содержит 500 полей и каждому полю сказали что только один пользователь может читать это поле ну тут соответствующую тестовые функции написали вот она ниже перечислены и получился у нас тест что вот они результаты да мы 500 раз там точнее из 500 вызываем какой-то случайного какое-то случайное число это обозначает что так пользователь с номером таким-то будет читать такую-то колонку при этом возраст должен проверить все свои access-list и а вообще такой пользователь может иметь доступ вот к этому полю там на конкретную операцию чтения и соответственно нижней тест где все эти проверки выключены зная код возраста до мы как бы специально смотрели знакомились как это все устроено изучали что там так сказать кэшируется access-list и там соответствующий типы данных то есть сообществе очень серьезно отнеслись вот к проблеме быстродействия вот всей этой подсистемы проверки корректности доступа к данным но тем ни менее получилась вот такая вот ситуация то есть если мы делаем вот такие странные примеры до создаем большое количество access list of чтобы проверять доступ у нас вот там ну на тесте чтение получалось там 14 небольшим хвостиком тысячи транзакций а если простите если мы верхний случай еще раз это немножко ошибка на слайдах перемешалось вверх вниз верхний случай это у нас большое количество access листов в нижнем случае это мы просто напрямую как бы выбираем да не проверяя вот это все и забили access list of поэтому вот получилось примерно 3 процента а верхи да то есть заставляя по сгрыз вот напрягаться по части проверки сложных политик доступа это тоже делает серьезную нагрузку на базу данных и это несмотря на то что все таки все таки большие большая работа проведена по там кэшированию вот всех этих access листов и так далее следующая вещь вот защита на уровне файлов данных то есть у нас вся все данные хранятся в файлах в блоках но мы знаем как устроена в позе физическое хранение всех необходимых данных мы тоже вот значит ну разработали некое расширение это пока в определенном смысле им в пеники такой рабочий прототип но это тоже продиктовано требованием наших заказчиках то есть да это и трест то есть то что данные лежат где-то на хранилищах они должны быть зашифрованы если вдруг где-то там кто-то что-то украл или скопировал не знаю должно быть невозможно расшифровать ну и соответственно под газ позволяет начиная там с 11 12 12 точно появилась можно писать собственные access методы к таблицам соответственно мы сделали некую свою такую реализацию который умеет на лету шифровать и расшифровывать блоки и соответственно на диск уже кладется зашифрованное состоянии наружу пользователям отдается расшифрованы состоянии естественно это вся работа происходит но по мере того как происходит запросы к таблицам то есть естественно когда мы уже отдаем и секс с мет расшифрованная часть она кладется в shared баффер и там хранится ну до тех пор пока внутренний механизм возраста не решит ее о так сказать убрать оттуда и получается так что в общем но мы проигрывали вот здесь ну как бы некие данные показаны опять же абсолютные цифры не важны но при определенных как вот тестовых наборах у нас получалось мы не отключали кэширование мы там не устраивали sequins канав мы просто запустили вот как есть типе себе вот эту benchmark который встроен пока bench и смотрели ну что будет и как бы да вот оверхед есть то есть здесь конечно ну еще предстоит нам работа так сказать и вычистить вот всякие тесты чтобы более четко показывать абсолютные и относительные цифры но звоночек такой прозвенел что все не так просто и как бы вот это шифрование на лету эта проблема еще один момент на котором хотелось бы остановиться и и эта работа в подгрести начата на что там по моему если не ошибаюсь 2015 года во многих современных коммерческих зубы д ну как-то оракал сиквел сервер и так далее есть transparent data encryption то есть вот ты до еды и ну естественно значит ну как мы оставим по сбросу насчет без т.д. разное люди участвовали как бы создание этого прототипа там ну вот в частности значит мы попробовали реализацию от сайбер тех это иностранная компания ну вот они создали некий такой прототип и можно скачать сконфигурировать попробовать ну вот скомпилировать да то есть там мик мик мик то есть получить инсталляционный образ по сброса запустить его и гонять какие-то тесты значит суть реализации которую вот пытаются продвигать сообществе это два понятия да это transparent это encryption и кмс этакий management system эти вещи они получаются неотрывно чтобы нам что-то шифровать нам нужны ключи чтобы у нас появились ключи нам нужно к эта система хранения выдаче этих ключей контроля ключей то есть ну просто так не придешь и не скажешь вот я там в конфигурационный файл после сколь пропишу ключик да ну придет какой-нибудь там администратор котором мы не очень доверяет не очень доверяем и увидим что вот он видит ключ то есть в общем нужно прям вот почему эта фича пока идет вот ну как бы очень много всего сразу надо сделать чтобы это прямо появилась в открытом космосе ну потому что вот сама по себе задача непростая то есть нужно и ключи и шифрование обеспечить и как-то вот на стадии конфигурирование инициализации базы данных все это значит привести в единое соответствие еще значит встроить ну предложить комьюнити вот коллеги нашего рассказывали олег что у них и джейсоном тоже так сказать вот это все ну требует долгого кропотливого взаимодействия с комьюнити чтобы такого объема задач и встраивать в финальные версии по сгрыз а но тем не менее вот эту версию как бы можно просто для себя пощупать чтобы сделать какой-то вывод опять же с прицелом у нас есть база данных который должна работать быстро highload и у нас есть безопасность это вот такая тяжелая инфраструктурная вещь шифровать все на лету то есть можно собрать протестировать запустить увидеть что там мы is ready to accept connection ну вот предоставить некоторый способ передачи ключа внутрь да ну то есть чтобы соответствующие внутренние механизмы поняли каким ключом значит шифровать и ну соответственно вот результат ну следующие удалось запустить эту вещь удалось пощупать и но основные результаты сейчас я не могу показать ну потому что они у нас получились отрицательные то есть мы ну совсем как бы ушли вниз по производительности и мы поняли что надо глубже разбираться как бы вот именно в этой версии вот со всеми этими элементами но могу сказать что мы получили крайне отрицательный результат ну и в сообществе сейчас вот тоже пока что вот тут твите девятнадцатый год предлагали патч в один комент fest 2 3 4 и пока эта работа продолжается то есть по т.д. плюс k мест есть даже соответствующей страницы на сайте под grass да где там вот такой вот список туду что еще нужно сделать чтобы вот это все нормально заработало для обычных пользователей администраторов что все было безопасно чтобы нигде не было там проблем утечек и так далее вот но у нас очень эта тема интересует мы как бы вот изучаем исследуем значит как это все устроено ну и подводя итог раунду второму да вот я некоторые вещи перечислил у нас получился такой результат что вот очень большие нагрузки то есть чем больше мы вносим шифрование чем больше мы заставляем базу перемалывать значит данные тем это все сильнее сильнее отражается на нагрузке поэтому вот мы выставили такой результат что до highload есть он ну от него никуда не деться но безопасность не дает то есть всегда нужно придумывать какие-то вот сложные специальные вещи как обеспечить безопасность и не потерять highload в каждом конкретном проекте в каждой конкретной информационной системе что шифровать какой объем данных является открытым какой объем данных является закрытым кому открытым кому закрытым и так далее и так далее поэтому вот второй раунд ну счет 1 1 то есть там был 0 1 здесь 11 highload пока выигрывает 12 давайте пойдем чуть чуть дальше следующий следующий следующая часть архитектуры это у нас реплики да ну что здесь надо сказать здесь по репликам у нас не очень много здесь на наш взгляд но вот две основные вещи да в подгрести мы знаем что есть синхронно и асинхронно реплики которая отвечает там за разные ну предлагает разный уровень не согласованности данных и между ними мы можем настроить сны новый состав соединения между праймари и репликой но опять же цель мода very five ул не большая помойка ну и что получается то есть в принципе здесь в этой части ну как бы тоже небольшой оверхед то есть если sing синхронный реплики от асинхронных отстают ну значительно да мы заставляем реплику записать данные транзакции в реплике а потом уже отослать клиенту сообщение ну точнее не клиенту праймари сообщение о том что как бы все на реплики зафиксировано продолжай транзакцию там или завершает транзакцию поэтому естественно синхронные реплики это overheat но это опять же как бы плата все-таки за надежность ну а сам по себе безопасный канал между праймари реплика он ну на уровне того же что мы получали между пользователями и главной базой то есть цель это хорошо highload выигрывает вне всяких сомнений тот не может быть вопросов ну и последняя часть да это вот всего этого монстра нужно как-то мониторить беспокоиться о том чтобы собирались правильно и надежно логе хранились аудит вести ну кто куда чего ходит смотрит и так далее то есть ну все кто сталкивался с безопасниками да по информационной безопасности вот мы часто слышим как бы нам надо все и блокируйте все что только можно но опять же если так сравнивать с коммерческими субботы до у нас есть там урок алдана который мы все там как бы больно невольно сравниваем там значит масса всего разработана упал grass в открытом доступе есть расширение пиджи аудит кому-то это окажется достаточным опять же в сам postgres встроены различные там широкие возможности по лакирования и мы решили вот посмотреть то есть если у нас как бы база работает в продакшене в то же самое время нам надо все все все запросы все обращения к данным каким-то образом фиксировать чтобы это потом куда-то передавалась анализировалась ну и кто-то сделал вывод о том что вот как бы нет утечек нет проблем там того-сего в общем кто то за этим должен следить и беспокоиться ну и соответственно вот лог statement of ничего особенно не провели как бы просто попытаться на определенных нагрузках значит заставить блокировать все все обращения все запросы ну и сад но опять же погибнешь там соответствующий тест и в общем я не буду останавливаться на как бы деталь сама методика тестирования на общем обычная ну и получилось так вот если ну как бы здесь сухие цифры выдавать если прям сильно нагружать то у нас ну подскакивала secu потому что эти лаги копились они там буфере zero вались лог коллектор это все там куда-то записывал и так далее то есть это ну были вот была определенная нагрузка на вот эту вот виртуальную тестовую машину да то есть ряд тестов мы как бы на virtual как проводили ну и как результат то есть мы получили серьезный overheat по процессору напрягался и в то же самое время у нас там накопилось в два раза больше данных логов чем этого собственно лежала в базе данных то есть тоже такая ситуация как бы вроде данных там два гигабайта мы еще на генерировали там четыре с половиной гигабайта логов и кто-то должен это разбирать ну и получается вот ну часть я уже как бы сказал да когда сталкиваешься вот серьезными организациями где поставленная информационная безопасность ну так сказать выше чем может быть какие-то другие требования ну получается вот получается проблемы то есть логирование не дает хайло оду в полной мере так сказать вот не можем почувствовать highload в полной мере ну поэтому тоже 11 и вот у меня остался последний слайд для того чтобы подвести итоги ну что хочется сказать в заключение мы все делаем проекты направлены на то чтобы все работало быстро и надежно но в то же самое время вот такой даже беглый анализ да опять же повторюсь мы не углублялись прям вот тут можно тестов генерить ну бесконечное количество всяких разными всякие разные аспекты мы попытались пройтись по верхам получили вот такой результат да то есть мы все-таки хайло воду поставили четыре очка безопасности поставили два если эти цифры перевести но в некое такое некое проект на область да то когда мы проектируем систему получается что у нас примерно 30 процентов мы должны задумываться о том что у нас же еще будет безопасность там с какими-то повышенными требованиями этому сразу надо уделить внимание слава богу что вот ну по сгрыз да это максимально открытая система и в общем там можно сделать расширение как бы любого уровня функциональности то есть строится в любой аспект обработки данных там на стадии соединений обработки реплики всего остального спасибо огромное за внимание спасибо нет спасибо георгий за такой интерес у доклад спасибо вопросы да да сейчас покоритесь гости спасибо за доклад рассматривали ли вы возможность шифрование данных перед записью не в базе данных а на клиенте просто если использовать какой-то апиа сервер их может быть много их бы если шифрования там то она будет масштабироваться я понял вас но вы знаете здесь вот такая проблема перекладывание проблемы сервер на клиент может не очень хорошо быть воспринято на десктопе потому что ну что будет там где работает клиент не известно это может быть толстый клиент тонкий клиент заниматься вопросами шифрования и дешифрования на клиента когда эти данные туда пришли ну вот это опять же неоднозначная ситуация то есть кто то это позволит а кто-то скажет не извините мы не можем вот тут перемалывать как вот эти строчки там что-то расшифровывать вам а потом уже ну выдавать куда-то там значит раз шифрованную вещь сложно уже при толстом клиенте препон каму клиенту у тебя есть это сервер который это находится в вашем контуре уже и вы можете решать дешифровать либо на 5 сервере либо забодает я понял вопрос вы имеете ввиду что если люди там и какая-нибудь 3 звена я архитектура у нас есть субботы какой-то там applications сервер ну это допустимо но уже это не наша цель так лада то есть мы здесь application server все-таки опустили такое безусловно возможно но я вот тут тут надо добавить что у вас появляется еще один контур защиты то есть если вы часть безопасности вы носите еще на отдельный сервер которые скорее все физически будет другой то вам кроме базы данных надо будет защищать и ключей механизмы шифрования в другом месте так же и таким образом у вас два объекта защиты и защиту надо будет и там и там тоже организовывать со своими нюансами хранилище ключей например на веб-сервере и так там данные будут перемещаться если они больше прорваться к базе до этого но все равно как-то должно в защищенном виде да и средствами в базе обычно делается чуть быстрее и обычно проще защитить одно место где-то централизовано чем распределенное у вас будет не один веб-сервера несколько это будет ферма на ферме будет размазана вам причина оба синхронизовать между этими серверами инфраструктурный вопрос возникает который также надо защищать и пошло пошло пошло пошло у вас все будет сложнее хотя and ain't шифрования то есть управление ключами на клиенте на сервере конечно актуальная тема она сейчас в многих enterprise свершениях есть из коробки про индексы это все и так знают друзья еще хотели сказать что у нас стенд открыт и там есть лотерея беспроигрышно если вы подойдете обозначить то завтра в 15-20 есть шанс получить полезную вещь здравствуйте спасибо за доклад все очень интересно познавательно вопрос похоже может быть предыдущем оратором а по поводу аудита вот вы сказали что очень большой orchid при включении аудита на уровне sbd не смотрели на уже же есть лук вал с него снимать данной аудит и или puller например если все сильнее иду через puller писать блоги там не тащить это все из базы не нагружать базу я могу ошибиться насколько я помню вал не записываются перми шины и читая вал мы ну как бы увидим операцию видим что случилось данными но перми шины да не хранятся где-то в других таблицах системного каталога поэтому ну спасибо за вопрос я как бы обращу внимание но вот сейчас я как бы мне кажется не ошибаюсь в ответе что мы валах не прочитаем перми шины в общем случае это для аудита окажется бесполезной для интерпретации усложнения то есть это реализация допускается но если вам потом развернуть информацию нужно в читаемом виде то когда вы формируете лог все таки можно ну вот мы например делом и прям пишем все что необходимо для расследования и для вас на веранде к этому а если из голов разворачивать надо понимать уже в каком контексте данные использовались восстанавливать связи то есть вот этот айдишник какую учетной записи принадлежал и иногда это отдельная сложная история которую в некоторых случаях мы просто реверсе очень сложно проще писать на лету и потом как бы прозрачно отдал все им и там уже эту корреляцию упрощенном виде там ну понятно как обрабатывать а в файл и все мне отдашь и правила корреляции в системе выявления инцидентов уже будет сложно реализовывать по этого нет нам по силам мы обычно пологаемся свозим спасибо и да кстати есть open source опять же аудит хорошие расширение которое позволит более подробно получить информацию которая например ванильной версии с коробки нет рекомендуем друзья не стесняемся еще есть время задать вопросы еще еще вот справа слева спасибо за доклад собственно такой вопрос вы упоминали про российские алгоритмы шифрования насколько они крипто стойки по сравнению с зарубежными аналогами куча организация работает по требованиям стек фсб то есть тут в общем ну я как бы не специалист по из когда еда но в общем те регламентные документы которые читал знакомился то есть у нас вот в основном сегмент это все-таки связка нашего инструментария с имеющими средствами шифрования то есть несмотря на то что мы также занимаемся безопасностью разрабатывать алгоритмы шифрования проверяет на crypt устойчивость мы конечно этого стараемся избегать отдельная задача работа математики много есть хорошие продукты фреймворке которые ты решают поэтому в основном наша область сводится к интеграции имеющуюся ну например субд и механизмов с имеющимися механизмы шифрования то есть есть например а из окей используем ну для нас этот плагин что то что это засунули туда получили уже преобразованную информацию которую смело можно хранить поэтому оценка конкретного алгоритма но вот мы стараемся до этого не доходить потому что ну и специфической занятиям вот на уровне баз данных своих нюансов хватает вообще было бы странная ситуация если бы не доказали крипто сквозь стойкости это как бы обозвали государственным стандартам россии я думаю что тут серьезно подошли к вопросу о том что публиковать вот для ну так скажем российских информационных технологий для руками выглядел бы если бы мы давали оценку крипто устойчивости алгоритм в которой правоохранительные органы рекомендуют и говорят что необходимы студию использовать вопрос я надрезал центре пожалуйста добрый день такой еще вопрос вы не рассматривали вариант шифрации на уровне файловой системы то есть вы же говорили что там вы пробовали пишет я не помнит анталию движок самом деле распространённая идея я на первое приходит в голову file encryption и и да такие решения существуют да и они георгий насколько они влияют мы да мы написали то есть это пока вот опять же говорю им я питаюсь мы исследуем изучаем этот вопрос пока нам не удалось добиться как бы нормальной производительности хотя ну вот опять же есть зарубежные так скажем аналоги этой вещи и там показывают что даже еще быстрее чем ну стандартный пост раз работает то есть вот драйвер по сгрыз quelle я видел тесты вых блогах они показывают что как бы мы шифру и мы это еще быстрее чем не шифровать мне кажется здесь вопросы чуть был глубже и вот эта реализация это как раз шифрование при записи на файл но средствами под гриль когда вы своими конечно вы имеете желание сделать а взять шифрующую файловую систему под капотом есть такие реализации или точно медленнее будет это естественно также дает просадку по производительности нельзя сказать что это будет значительная просадка по моему учета порядка 10 15 процентов наших тестов было то есть но это файл disk file encryption в общей терминологии но по-моему нас сейчас тестах это отсутствуют мы сейчас рассматривали но как бы для разработчиков полос gresso для разработчиков это бы своего решения мы рассматриваем более интересную ситуацию когда у вас есть прям свой контролируемый механизм при записи файлов на любую файловую систему преобразования данных то есть это некая прослойка между самой судьбе и файлы и подсистемы то есть не смотря на то какая у вас файловая система вы уже храните данные зашифрованном виде вот как раз эту ситуацию мы рассматривали это как раз возможность 12 пузыри там плавал историк можно реализовывать стой функциональности как какая вам нужна что может быть и шифрование то может быть и компрессия может быть что-то другое для нас более интересный кейс хотя выдает да она тоже распространенное в линуксе чаще всего делают что первое что включить шифрование на уровне диска это хищение самого диска предотвратит даст вверх и порядка 10 15 процентов вот но с другой стороны если вы уже открыли под монтировали файловые системы кто-то имеет доступ к данным то свечение на уровне файла вы не предотвратить и году мы обязательно померяем и в багаж из своих тестов это сделаем чтобы шифрование прозрачные науку дают хорошие темами и расширения доклада и уважаемого докладчика был вопрос по поводу четырех раундов в виды спорта я один такой знаю какой как в андон по крайней мере для этих самых командных вариантов там именно 4 все мы знаем о новом ресурсе значит если у кого-то есть альтернативы предлагаете да вы подойдите пожалуйста на стенд мы вас ну визуально запомнил но все хорошо но это еще не все нужно выбрать еще один вопрос точно баскетбола все желающие вопросы задали есть уникальный шанс задать лучший вопрос лучше вопрос малышу зададим в кулуарах время поджимает тогда георги как ты считаешь какой но это всегда очень сложный выбор никого не хочется обидеть ну вот поскольку человек так сказать предложил тест но pdf да на уровне файловой системы пиджа до серьезный вопрос считаем что хорошая добавка к нашему докладу хороший темы на следующую сорвал лиза джек-пот джек-пот сорвал поздравил спасибо спасибо вам огромное да на стенде мы все доступные подходите мы расскажем про другие подробности которую доклад не влезли спасибо большое спасибо благодаря спасибо он эти вот все туда пересядем то что мы здесь что-то показывать оттуда будет не видно вот лучше в эту половину зала спасибо у нас на экранах ничего не будет поэтому вот ну что подходит концу наш день третий зал но стахановцы будем до конца до победного и и следующая тема это остро ликбез для айтишников выступают в а кости это иван ткаченко и олег бодунов поприветствуем но мы очень рады вас здесь видеть это хорошо что астрономия не безразлична такому количеству людей и даже она более интересно чем пиво это вообще совершенно удивительно вот это здорово вот но о чем мы будем говорить это остальных без то есть мы не будем говорить какие-то сложные заумные вещи будем стараться говорить о том что мы видим почти что каждый день и те вопросы которые мы слышим каждый день мы будем обсуждать вот ну а также любой вопрос который вы успеете нам задать мы тоже готовы обсудить вот но мы намеревались говорить о простом о том о чем спрашивают дети о том значит какой улаживаем иногда говорят в школе значит как это правильно исправлять вот ну и соответственно обычно что мы видим на небе луну там солнце камни red реже обычно луну и солнце вот но начать начнем нас тут есть заготовленный план значит самый больной вопрос это фаза луны вот почему луна иногда видно там наполовину светленькой наполовину тёмненькой иногда как-то по-другому год существует такое заблуждение что темная сторона луны это тень нашей земли вот есть люди которые думают нет отлично вот значит когда я учился в четвертом классе в школе я столкнулся с учительница географии на и природоведение которая рассказывала нам что когда луна входит в тень земли мы видим темную часть луны вот есть фаза луны пришлось и ее вразумить с тех пор я полюбил астрономию и стал астроном вот я очень рад что значит здесь не надо никого убеждать в том что на самом деле дело весь нефти и вот а дело в том что луна в этом положении частично освещается солнцем то есть мы видим вас какое там мячики покажем как это происходит хочу назвать вам некоторые издательства мы привыкли верить печатные книги то печатным книгам так вот некоторые издательство выпускает энциклопедии для детей которых находятся грубейшее hs органические ошибки и вот часто на конференция когда я спрашиваю 99 процентов отвечает вот по таким учебникам совершенно неправильно и вот недавно даже я на фейсбуке опубликовал пост вот издательство st выпустила энциклопедию по астрономии для детей там так далее которых были просто такие ляпы один из ляпов вот я вот посвятили на луну вот те кто видит сидят за лишь часть видеть луну фазе там первой или последней четверти то есть она на половинку освещена вот мячик слишком прозрачны да есть некоторые издержки вот можно считать что это пепельный свет знаете что такое пепельный свет луны значит землей да вот когда мы смотрим на луну и видим серпик узенький серпик вот вы смотрите видите серпик луны такой месяц а другая часть иногда вот можно усмотреть она тоже освещена но не потому что луна прозрачная как этот мячик а потому что там вот те кто там сидят они видят нашу землю в небе она очень яркая она ярче луны там десять раз и она освещает их и мы вот можем это усмотреть называется пепельный свет луны до профи пили цвет отдельная история дел то что пепельный свет было это на заметные а иногда незаметной заметили иногда это зависит от того что вот на этой стороне земли есть облака или нет то есть поэтому делал люди знающие говорят о пеппи ле сверх хорошо заметен через неделю у нас будут облака так обычно и бывает просто облачный покров он способствуют лучшему отражению вот так вот можно глядя на луну узнать какая погода больше 7 лет за очень просто наши я так думаю тоже так делают по простому и цвет по цвету как раз по цвету пепельного цвета люди узнали что мы голубая планета раньше как не было спутников никто не летал в космос никто не смотрел на землю да да надо сказать что людей не так быстро узнали какого цвета луна до какого цвета луна вы знаете черт а чернее сахарного на на самом деле черная да а вот изучая смотря наблюдая она пепельный свет на шичко кстати советские ли российские ученые до астроном ti hof он определил что наша земля на самом деле снаружи выглядит как голубой голубой планеты и цвет пепельный он голубой на самом деле и когда кто там voyager летел далеко-далеко вот знаете водишь который до сих пор не те где-то уже вышел за пределы слой системы ему дали задание повернуться посмотреть на землю и сделали вот заменитель снимок это маленькая . это наша земля она была именно такой голубой так ароматическая вот а когда значит тень земли падает на луну то тогда мы наблюдаем что мы наблюдаем затмение луны затмение слушается чем от меня землёй в земле и закрывает от солнца а когда луна закрывает солнце мы наблюдаем тогда солнечное затмение и нам на самом деле страшно повезло с тем что мы можем видеть такие красивые солнечное затмение здесь есть люди которые видели солнечное затмение о круто полной полный воды за да а полное солнечное затмение вот обязательно посмотрите полное солнечное затмение это отлично у меня это вызывает катарсис то есть я перерождаюсь потому что вы видите действительно такое явление природы которая вот вы можете смотреть картинки там и смотреть фильмы вам будут рассказывать но когда вы сами это увидите да это вызывает небольшие такие вот это влияние вот существенного планеты до планет и солнца она родом я лично много сайте вы видите горы на луне обставлять и вы можете глазами во время полного солнечного затмения увидеть горы на луне а потому что солнце солнечный луч из 8 эти горы вот ущелья в какой-то момент просто до вспыхивает называются чётки бейли когда луна отражается уже еще что он начинает открывать солнце в начале мы видим вот между горных пиков как она проглядывает солнце вот это чётки бейли называется и фактически мы видим горы назим на луне это доказывает что он есть горы можно увидеть невооруженным глазом больше никак а когда она вся закрывается вы вдруг увидеть из корону солнечная корона которая моментально вспыхивает том что я ну контраста cee'd то есть на этом фоне черного неба вдруг такая контраст является и вы видите безумное вот интересно и та же вещь солнечная корона которая окружает солнце она довольно большая как мы видим во время солнечное затмение вот ученые сообщают нам штанах жутко горячая там миллион градусов вот а почему что-то не светится на ярче чем солнце и мы не видим ее днем если она такая горячая кто-нибудь знает низкая пост на самом деле на прозрачная она очень горячая это практически вакуум и на самом деле солнечная корона достает аж до самой земли в каком-то смысле вот то есть вокруг нас солнечный ветер и за тоже материал солнечной короны который истекает его температура сотни тысяч градусов но тем ни менее космонавта не поджариваются потому что частиц которая носит за температуру их очень мало это вакуум вот хорошо значит наверное все встречали таких людей вот мы например с олегом однажды встретили таксиста который рассказывал нам что земля плоская вы когда не встречали плоско земель щиков днем здесь таких вот на их мало их мало крахмала на ютюбе миллионы просмотров да вот вопрос значит как можно убедиться проще всего наше время как можно увидеть уже земля такие круглые что для этого нужно подняться повыше но вам скажет то есть любые эффекты которые увидите с высоты при from что закруглённость это можно объяснить рефракции скажут что там вот из-за преломления в земной атмосфере вам кажется что земля загибается они так и говорят на самом деле нет этот способ не убедительны для них и там будет другое время но у пока вы будете лететь это близко это близко да там будет другое время но олег ты можешь наверх кстати забраться за тебя плохо видно да хороший вот значит чуть чуть еще пока вы летите в другое значит на самолете время действительно может измениться скажется вам это неубедительно вот на самом деле в наше время благодаря интернету воск значит почему дайте кликов остро ликбез потому что именно айти которая соединила регионы можем позвонить нашему другу в австралию и сказать спросить какое сейчас время суток вот и да есть такой момент до ног узкой значит позвонят нескольким друзьям вот короче говоря вот именно тот факт что мы можем сейчас позвонить важной точке земли и узнать о что происходит там вот ну или даже заслать туда своего доверенного агента с ssh нам ключом в кармане вот и он расскажет что вот у меня там ночь у кого-то утра и вот мы так обзвонив все места планеты можем на самом деле понять их ориентацию в пространстве из этих мест составить какую-то геометрическую фигуру очень важно что это будет шар но если на самом деле говорить не только о положение солнца в небе но и там луны или каких-то других ориентиров звезд ну самое простое это позвонить в австралию спросить тещи что день-ночь вот и все вот это уже плоскую землю опровергает достаточно сильно вот значит все заблуждения это времена года вот как вы думаете когда солнце дает земле больше энергии летом или зимой на всегда одинаково дано на самом деле когда земля чуть ближе к солнцу и это бывает не летом она дает чуть больше ну чуть-чуть там на 10 кажется процентов или даже меньше вот но насчет времена года это к тому что времена года меняются не от того что земля подходит ближе к солнцу как некоторые утверждают времена года меняются от того что земля подставляет солнцу свой северный или южный бог край полюс вот значит для этого есть простая демонстрация с мячиком который за 1 рассказывается о том что такое полярный день и почему день там зимой короче чем летом вот значит вот мы берем шарик и вот олег начинает на него светить только не слишком сильно чтобы была видна освещенная часть шарика это светишь вот значит но в принципе мы должны на шарике увидеть как он когда он изображал луну мы тоже видели там светлая часть и темную часть кстати все знак как называется линия разделяющую светлую и темную часть терминатор вот то есть если будете смотреть фильм про шварценеггера имейте ввиду что настоящий терминатор это вот эта штука значит мы видим что северный полюс нашего шарика освящен вот земля вертится на ней полярный день на северном полюсе южный полюс не освещен на нем соответственно полярная ночь значит вот этот вот часть земли которая постоянно освещена сейчас на севере это северный полярный круг вот досюда доходит свет вот эта штука вращается оно все время освещена значит сейчас здесь летнее солнцестояние потому что земля максимально повернута к солнцу вот этим своим полюсом то есть пусть наклонена прямо направлении солнца вот значит если мы возьмем области какие-то примыкающие к полярному кругу который все-таки заходит в область ночи превращение видно что они заходят ненадолго а здесь на солнечной стороне они прибывают долго вот это вот наши средней широты где находится в том числе и москвой мы сейчас сон сцене близко вот мы подходим носит вращается солнце при этом направлении оси как valtec гироскопом управление совесть и сохраняет вот соответственно если земля вращается ось смотрят все туда же и наступает равноденствия святитель на меня рак наступает равноденствие значит когда день равен ночи потому что вся земля освещена в течение половины суток а на северном полюсе в этот момент солнце ровно по горизонтали светит вот здесь мы видим что любая часть земли ровно половину периода вращения находится будучи освещенные солнце потом земля поворачивается другой стороной и мы видим противоположную ситуацию лето полярный день на южном полюсе вот но мячик прозрачность конечно немножко мешает нашей демонстрации но желающие могут дома найти деревянный мячик и попробовать на нем самое простое такое что такое хорошее объяснение да вот почему зимой холодно да там а летом жарко вот но я для своим дочкам объясняю это по-простому вот мы сидим на кухне завтра прямо примерно в одно и тоже время и смотрим как раз вот там где восток там до запад север и мы видим что зимой солнце вот-вот здесь порождается вот здесь и вот здесь падает а летом она все начинает ближе к лету она начинает все дальше и дальше появляться и все выше и выше и таким образом это обычно если вы будете наблюдать вы детям сразу скажи 6 вот тепло потому что больше энергии на нас падает и дольше это такие проявления наверно замечали так что значит вот вы сейчас сказали что такое полярный круг это те места где бывает на согревает полярный день где значит в каких-то ситуациях хотя бы раз в году солнце забывает ночью зайти за горизонт а что такое тропики все знают тропики что такое же тропики это а хотя бы когда-нибудь доходит до зенита зенит это не только футбольная команда но и направление ровно вверх то есть вот когда вам какой-нибудь писатель из южной руси пишет что солнце стояло в зените и степь наши вся была им испепели на на самом деле это вписать он съездил в африку вот потому что в россии нет тропиков и солнце в зените стоять не может вот а то что он имел ввиду называется останове верхняя кульминация самое высокое положение сама большая глава высота солнца относительно горизонта и любого тела называется верхняя кульминация слышали такое слово кульминация иногда искусствоведы тоже используется год хорошо следующая наша тема это приливы и соответственно отливы вот но наверное все слышали что они связаны с луной а знаете что они связаны не только с луной еще и солнцем вот о какой высоты прилив да зависит от места это хороший ответ значит фокус вот чем на самом деле если бы земля была покрыта просто океаном такой вязкая жидкость не океаном вот таким желе вареньем который не любит теча просто деформируется и все вот высота прилива от лунной было бы примерно 50 сантиметров и от солнца еще 25 и вот поднималась бы вот так вот значит когда луна и солнце примерно с одной стороны есть в полнолуние или новолуние тогда прилив максимальной высоты 75 сантиметров когда они под углом 90 градусов то тогда минимальной высоты тоже интересный момент именно 90 градусов они в разные стороны вот тогда всё 25 том что луна и солнце мешает друг другу и вот интересно а почему вообще прилив происходит два раза в сутки а не один ведь с двух сторон то есть на самом деле приливная волна и такой город эллипс такой вот который притянут в сторону солнца или луны там притягивающего тело давайте солнце пока на время отбросим игры за солнце выключи все будем говорить только луне значит луна притягивает а вот почему второй город первый год все скажут вам дал луна притягивает воду она к ней стремиться а вот второй горб отчего это это очень хороший ответ на самом деле да можно с помощью что есть про квадров вольный момент вот а на самом деле простое объяснение на пальцах такое значит вот есть центр земли который движется по орбите он притягивается и это притяжение нам же все равно движется земле вокруг луны или она вокруг земли мы все что он движется вокруг луны вот он движется по орбите и там значит все уравновешено если что-то ближе к луне там есть две силы центробежная сила за счет его вращения и притяжения центробежная сила меньше потому что на ближе притяжение больше потому что ближе вот в противоположность стороны наоборот притяжения месяца traper носил сильнее поэтому нам от оттягивает противоположную сторону это такое объяснение на пальцах значит на самом деле приливная сила это как раз производная от силы притяжения никуда не уходить вот это чтобы продемонстрировать силу притяжения можно здесь грохнуться да то есть на самом деле вот ровно на столько на сколько силы притяжения к луне меняется на плюс-минус радиус земли настолько вот это вот приливная волна и настолько и это есть уже определенная сила то есть приливная сила который притягивает это волной которое отталкивает сюда это разность между силы притяжения центра земли и притяжение в этой точке вот поэтому приливные силы они очень сильно зависит от расстояния если тело очень далеко как например действительно земли юпитер проливным образом на 10 действует на очень слабо потому что если гравитация падает как r-квадрат как учит нас ньютон то приливная сила падает как ярков что это производная от нее она еще слабее поэтому от дальних планет там никаких приливных сил в принципе даже нет но вот от солнца и от луны есть вот более того вот эти тут 50 сантиметров они еще на десять процентов плюс минус варьируется в зависимости от того ближе луна к земле или нет потому что орбита луны вокруг земли тоже эллиптическое и если она ближе то приливы большие наш самый большой прилив которые можно сделать на такой вот желейная вязка земле это сантиметров там 90 когда и солнце ближе всего луна ближе всего и они с одной стороны вот но приливная волна бывает до 20 метров это именно потому что она волна то есть вода по инерции катиться накатывается на берег и там все это происходит вот как работает приливы но это не все что делают нам приливы хорошего или плохого на самом деле приливы они отнимают энергию у вращение земли вот то есть приливы они нас тормозят на blu ну а blu но мы тормозимся вот и мощность этой штуки но вот как вы думаете какая колоссальная мощность на самом деле не такая уж и колоссально вот именно сколько на торможения энергии по год поглощается это это мегаватты и всего лишь навсего это всего лишь на все мегаватт и вот и масштабу земли вообще не что поэтому тормозится земля очень медленно по мере тапок земля тормозится луна удаляется от земли и луна удаляется от земли на четыре сантиметра в год скоро мы скоро мы не он видео об астрономической мошна не увидим солнечных затмений ну затмение будет кольцеобразные да солнечное затмение станут кольцеобразно вами то есть луна будет меньше на небе чем раньше и она уже не будет полностью закрывать солнечный диск для человечества это будет очень досадно вот это особенно объясняет почему сейчас все странность такой силы ломанулись на луну и почему начали говорить о лунных станциях потому что стоит большая инженерная задача как увеличивать диаметр луны с тем чтобы она могла закрывать солнце год рассматривается два основных варианта значит либо вскипятить поверхность луны с тем чтобы она значит пенилась и поднималась как вулканическая пемза и луна становилось больше вот и второй вариант он проще но требует большого транспорта с земли китайцы хотят это сделать это заливать в строительной пеной ну вы поняли да да вот значит про луну есть много всего прикольного но картинки такие рисуют когда есть серп луны и звездочка посередине этого серпа вот значит все знают что астрономически такая картинка невозможно на самом деле возможно это значит что просто вот эта звездочка это стоит на луне космонавт лазерами на вас светит если там несколько звездочек то значит там высадил сюжет ряд космонавтов к как да может быть и кто-нибудь там между землёй тоже и луной засел да хорошо серп луны вот если кто был на юге далеко он наверное видел что серп луны нею в бог смотрит вот так вот месяц а вот так или вообще вот так или с моряком юге да вот вопрос может ли быть так чтобы серп луны у горизонта vestel досмотрел рогами вниз а вот где и при каких условиях такой может произойти но если серб программе вниз наше солнце у нас где то там в принципе днем это значит днем происходит а то что рогами вниз значит что близко к экватору потому что орбита луны наклонена к орбите земли на 5 градусов орбиты земли к земной оси бокала вина на 23 с половиной градуса поэтому лежащую луну можно увидеть от экватора но от 28 до минус 28 широты там можно увидеть луну ровно горизонтально стоящую так или так вот но соответственно чем дальше пользу тем больше она может быть наклонность в наших краях тоже вот есть и ни о какой то диапазон плюс минус 28 градусов она может наклоняться вот если вам хоть нарисует луну вот так вот и скажет что это у нас здесь средних широтах нарисовано просто художник так видит вы будете точно знать что до художник так видит но нет реально это сейчас так публикуют фотографии в инстаграме то есть люди не понимают астрономии и рисую такие красивые вот у нас говорится вот здесь в москве и пил вот такую луну вот так вон какую луну да это следующий опрос а луна на закате или солнце на закате большая а вот 100 pret почему она нам кажется большой да да значит говорят умные вещи есть чем сравнить просто глаза есть за что зацепиться вот но существует ошибочное мнение что земной атмосферы действует как линза и увеличивает почему-то то что около горизонта вот на самом деле земной атмосферы действительно действует как линза но не так она не увеличивает то что горизонта а наоборот сплющиваю вот если кто видел за как лунный прямо в море тогда мы правильно как она в общем деформируется и она там уже не кругленькая такая вот сплюснутая на самом деле не видно на она при этом еще при приподнимается преломлением земной атмосфере приподнимается и поэтому закат что солнце что луны на самом деле происходит на несколько минут позже из-за того что лучи загибается за горизонт это называется естественно рефракция но самое интересное случая рефракция называется зеленый луч кто не видел зеленый луч о круто поздравляю удивительно большая редкость я тоже видел я тоже у меня есть фотография доносит его еще и сложно потому что ты grapher окном что это очень короткое время надо изловчиться и фотоаппарат должен быть быстрой чтобы успеть вот оказывается просто так глазом это не видим но на краю солнца или луны есть небольшая радуга очень маленькая толщиной шириной все в одну угловую минуту угловой диаметр солнца 30 минут полградуса вот но краешек у него радужный так просто это не увидеть особенного радужном становится когда это все низко над горизонтом как раз это из-за преломления света в атмосфере разные разный цвет преломляется по-разному вот и когда солнце погружается за горизонт тогда у нас только есть шанс и ты рад радужки кусочек увидеть вот зеленый свет как раз это вот из-за из-за этого дальше за ним еще идет начали солнце погружается красный желтый там мы и так видим они не различаем на краю солнце эти цвета она это красное вот но в зелёное мы видим хорошо все не теряются на фоне не в эфире вообще еле виден хотя иногда там кто то говорит что синий луч тоже удалось увидеть вот ну вот зеленый луч значит бывает многие люди вид один процент наверное я так думаю из наших москвичей зеленый лучше видели как правило это можно увидеть на океане должно быть большое там моря чистый воздух вот просто так если поехать куда из питера смотреть на финский залив не будет там зеленого луча интер видел норвежском море а ты в каком виде она океане океане на тихом да ну и павла дичь из каноническом тоже ничего да 6377 р-на или 80 километров нет на самом деле я все-таки земля твердое тело оно конечно дышит немножко немножко дышит в том числе из-за приливных сил она дышит то есть power твердо 1 земли тоже поднимается и опускается луна я точно также притягивает вот но все-таки и земля твердая и за время пока мы с вами живем ее радиус не меняется теория форма земли возможно то есть там вы знаете что земля не круглая это да имея нас полюс форму геоида как называют да вот недавно измерили высоту everest а вы знаете к и высота верил что она 8848 а сейчас она стала чуть чуть выше то есть потому что точность жюльен в другом месте где там под эверестом этот ноль залегает никто толком не знает но зависть это модель модель форма земли вот ну а так в принципе она да она сплюснута чуть-чуть там на 42 километров или насколько вот она сплюснута то есть такой вот имеет вот такую вот форму знаете да земля имеет форму чемодана и москвы на нем ручка году чего данном случае вот такой или на самом деле everest не является самой высокой самой удаленной точке а цен от центра то есть на самом деле в эквадоре существуют место которое максимально далеко от земли города мне жена она ближе к экватору и поэтому за счет того что земля там больше получается что загара выше эвереста вот еще про луну какая там бывает у на голубая голубая что такое голубая луна это вообще редкие просто что москве мы смотрим на луну не видим что она была голубая да вот но тем не менее такое выражение существует вот значит голубой называется очень редкое событие это примерно как после дождичка в четверг вот еще некоторые думать что в этом случае все бывает а бывает суперлуние люди не поняли про не место после дождика в четверг то есть вообще первый голубая луна да на самом деле просто американцы так говорят блюму да они означают именно редкое событие что на русский язык переводится после дождики четверг на суперлуния газеты пишут часто да иногда вот пишут такое что завтра будет суперлуние луна там будет о-го-го какая там на пол неба вот все срочно бежим там смотреть на луну она будет вот такущий иногда бывает супер марсия тоже пишут про то что марса будет вот такой вот луну завтра срочно все бегите смотреть вот но супер марсия понятно что не бывает то вы суперлуние ну тоже на самом деле не бывает то есть луна действительно на чуть-чуть там меняется в размере за счет того что она подходит ближе или дальше от земли на это пределах 10 процентов или даже меньше чуть-чуть меняется вот поэтому когда вам говорят что луна там будет особенно большой 10 процентов как там ни за что в каком-то зоопарке родился медвежонок на два сантиметра толще чем нашим ленинградском большое событие также с луной фотографы любят публиковать фотографии делать вот такая луна до идут такие люди на фоне ее там или там кидай дома вот это означает что либо это photoshop либо он отошел очень далеко и супер зумом таким объективом ржал пространство но если вы можете сделать обычные геометрические вычисления можете понять насколько это правда или неправда я когда вижу такие фотографии начинаю быстро считать насколько это возможно или невозможно но часто фотографы делают такие фрики красивые да ну собственно ночь ночь наступила астроном выходит на улицу вот может быть вы встречались таким что значит вас есть какой-нибудь знакомый который знает про звезды вы спросите какая-то звезда он говорит ну это там например юпитер вега вот вопрос как астроном так легко узнаю звезду если на небе еще только всего там три четыре звезды появилась обманывает может быть да на самом деле ярких звезд не так много поэтому зная сезон легко угадать вот летом например если посмотрим наверх скорее всего яркая звезда будет вега но мы все-таки про ночь говорим солнце до очень люди берут вот так и смотрит говорят программ программа такая stellarium например ну их но вода но таких много вот значит ярких звезд не так много если вы смотрите наверх ночью ну там ранней ночью летом скорее всего вега яркая звезда вот если вы смотрите зимой не очень высоко потом сириус сирию самая яркая звезда на небе но видно только зимой невысоко вот если где-то там на северо-востоке и северо-западе чего-то болтается это скорее всего арктур ну собственно вот основные звёзды и планеты самая яркая что на небе есть юпитер что сказал венера бывает до winner winner самый яркий ну и луна и солнце еще больше да да венера вот кстати сейчас можно увидеть меркурий с венерой на закате и на закате можно увидеть меркурий он сейчас достаточно хорошо виден на все меркурий трудно на нашем ярком небе значит особенно грязную московском его конечно увидеть трудно учат как раз если вы с помощью такой программы найдете вы будете молодцами в городе почти невозможно помогал дома сговор виден во первых он высоко не бывает то что он близко к солнцу во-вторых он виден на фоне вечерней зари то есть не на фоне темного неба это тоже поэтому вы сфотографируете потом на фотографии там копаетесь меркурий вас хорошо он виден где-нибудь в типе где у вас есть горизонт мне бы тёмное солнце зашло там и вот вы что-то видите я например меркурий первый раз увидел вообще из поезда ехал поезд через степь я смотрю елки-палки меркурий раньше никогда не видел очень круто венера и меркурий а это внутренней планеты поэтому они не отходят далеко от солнца поэтому вот венеру называется вечерняя и утренняя звезда они за солнцем идут и так оно происходит и вы это можете кого не спросить какие тела на небе вы можете можно увидеть в форме серпа от месяца как луна вот значит кроме серпа кроме луны можно увидеть такой форме на небе внутренние планеты меркурий и венеру это ну не вооруженным глазом вы не разберетесь конечном серпик но если вдруг телескоп попадется прекрасно это увидите вот но есть еще некоторые тела которые можно увидеть в форме серпа телескоп и это спутники юпитера если вдруг у вас будет телескоп чикой вы увидите спутники юпитера с хорошим увеличение вы увидите что там они тоже как луна точно так же могут быть частично освещены солнышком хорошо значит давайте дальше чуть чуть отойдем от земных этих тел а вот юпитер и других парад планет что это такое вообще бывает парад планет страшно сказать до парада планет не бывает все они в одну линию выстроится не могут потому что орбиты планет находится в разных плоскостях эти плоскости все они пересекаются в одной линии ну знаете две плоскости всегда пересекаются по одной линии либо параллельно либо совпадают вот но плоскостей много и они им не повезло пересечься по одной линии поэтому строго говоря парада планет не бывает но если там мы посмотрим какой то такой здоровый сектор ладно там бывают может так оказаться ну вот несет ли это какую-то опасность для человечества на самом деле человечество иногда поражает своей нестабильностью опасность может тогда принести что угодно вот любое малое возмущения разовьется не пойми во что вот ну хорошо парада планет не бывает и ничего страшного в этом нет а вот к месту например знаете видел кометы супер здорово вот но комета к сожалению редко бывает но иногда вот везет там раз в десять двадцать лет на небе появляется яркая комета мы можем видеть там строится длинный хвостик прям и невооружённым глазом вот на самом деле она далеко это комета далеко и хвост и и хотя он длиной в миллионы километров значит он кажется таким маленьким когда вам говорят что этот хвост в двадцать раз больше земли надо ли бояться а когда он говорят что и он из угарного газа состоит и другого всякого ядохимикаты вот боятся все равно не надо потому что это практически такой же вакуум как и просто в космосе чуть чуть больше этого газа и он светится будучи освещенным солнечными лучами значит он не страшный вот ну то есть такой здоровый хвост он по земле если ударит земля просто его не заметит а мы с вами заметен если земля пройдет через там хвост кометы или что нет типа этого хвоста лет и рядышком на самом деле мы с вами это заметим и мы часто замечаем это а да конечно потому что есть метеорные потоки которая связана с кометами вот как состоит из частиц которые когда-то с этих камер свалились и примерно по такой уже убить крутится вот есть много всяких метеорных потоков которые известны с какими кометами связаны так что мы это увидим но не страшно а я впрочем but does тический рассказ роман день триффидов в котором начал людям насмотрелись на какой-то метеорный дождь и потом все ослепли вот не бойтесь на самом деле так не бывает вот да да вот это более вероятно скорее всего так и было хорошо ладно а вот астероида а второй одна опасность есть ну вот хороший августа на самом деле есть но почти нет это это лучший ответ на самом деле вот когда вам к телевизору говорят что а строить там какой-нибудь приличного размера как 100 челябинских метеоритов проезжает на расстоянии 3 миллиона километров земли примерно вот насколько велика опасность как это оценить если он пролетает точно на расценить 3 миллиона километров он абсолютно не опасен вот хорошо и сам говоришь нарастание 3 миллиона километров каждый год пролезает такой астероид насколько это опасно ну вот смотрите значит земля это мишель диаметром примерно 10000 километров до ровного счета вот если здесь миллион километров вот что мы увидим виленкин и др 100 раз больше значит по площади в 10 тысяч раз значит раз в десять тысяч лет такая штука упадет на землю вот примерно так на теперь можно последить за сводками новостей насколько часто прилетают такие штуки и понять насколько часто они падают на землю все очень просто ночь выяснится довольно редко они падают на землю вот но тем не менее есть какие-то события на земле значит которые возможно связано с падением больших метеоритов точно это не известно но вот есть предположение что динозавры вымерли то есть какие-то массовые вымирания в истории земли которые возможно связаны с падением крупных метеоритов а может быть и нет с тем ещё они могут быть связаны вот эти массовые вымирания потепление потепления потепление похолодание вулканизм да то есть вот вариант ядерной зимы там подготовленную причине когда выбрасывается аэрозолью атмосфер до может привести к похолодание вот есть еще очень экзотическое гипотеза вот который высказывалась этом взрыв близко сверхновой звезды когда наших гамма-лучами землю прав оказалось что это лажа такой не может быть сверхновая звезда практически безопасны для человечества вот потому что гамма-излучения там длится недолго и погибать так половину земли до примерно так ладно олег давай почему остановились значит летим дальше входы вот там в астрале живот антипода слышали про таких высоцкий пел еще до про антиподов а почему они не падают и вообще куда из голову-то вверх ногами вниз головой вот моим под позвоним там спросим о чем это они вниз глава висят там если там и вниз головой да они также она сдуваются но это реальный вопрос в трудить и задают они рисуют землю так рисует детей и людей а потом говорят а как же это уже не падают до да и белорусов просто сказать что тебе стоит лишь на мы в астрале перевернуть картинку и спросить почему эти странные русской не подаю стартер и вот ну они не падают до высокого там было нужно вот если как вы думаете если просверлить до австралии колодец через центр земли и в него прыгнуть даритель за австралией расправишься не ну предположим нее не плавится так скажем да скафандре мы одели чумовой костюмы нам ничего не страшно мой прыгать туда-сюда нет период будет не 8 ну кстати близкой да вот но если там в центре земли на самом деле ответ такую там игру жидкое понимаете ни фига в этом не просверлите вы просверлите вот тут живет вот поэтому где-то там застрянете как опять же герой шварценеггера второй раз вспоминаем а сегодня утонете в расплавленном веществе вот тогда если вы сможете сюда обогнать трубу тогда будете летать туда-сюда с периодом порядка 90 минут да окей хорошо ладно с антиподами поехали дальше вот например говорит вам таксист кто вообще сказал что вселенная расширяется мы же видим что она стационарное однородно везде звезды везде одно и то же я путешествовал в болгаре вот вопрос как легко опровергнуть таксист сказать of ты ездил в вальгалле а а есть ездил в чехии она дальше там все по-другому нет красное смещение да но это хорошо но это все таки чуть сложнее технически надо померить его красное смещение таксист поймет дай ему можно рассказать про гаишников в приборах вот значит нет дела и можно проще здесь такая штука фотометрический парадокс слышали значит смотрите вот мы с олегом здесь ними на свете прожектора как вы думаете если бы например вся поверхность этого зала была бы покрыта прожекторами чтобы было с нами всеми не просто не только тени и вот ну представьте себе что вы там поехали на дачу вас там баня вы затопили печку открыв дверцу заглядывайте сюда вам тепло вот оттуда из это диверсия вам тепло да отлично вы представьте себе что значит вы открыли очень большую дверцу очень большой печки посмотри туда вам теплее тебе за все что печка вокруг вас ровно то же самое тут уж точно не замерзнете вот и даже чему вы костюм не поможет так вот смотрите значит если мы окружены звёд неважно какого размера печка интерес если мы все окружены звездами и вселенная бесконечна это значит в какую сторону я не направлю свой взгляд рано или поздно он упрется в звезду вот и получается что все небо на самом деле покрыта звезд нами она должна сиять все с одинаковой яркости и это яркость должна быть равна яркости поверхности солнца ну там средний звезды говоря вот и мы должны во время находиться в центре вот такой вот раскаленного шара такой печки вставляйте небо светилось более того на нас бы еще жарево ты вся вселенная была бы печка однородная одинаково нагретая вот ну в общем жилой вас такое вселенная плохо разом скажем но по крайней мере мы этого не видим и это уже говорит о том что вселенная бесконечна и неоднородная из этого правда еще не совсем следует что на расширяются можешь сказать что она конечно я и окружена там какой-нибудь стенкой на которой нарисованы галактики звезды мы видим а галактики нарисованы на стенке а как вы думаете мы окружены такой стенка или нет а существует способ узнать узнали увидели стенку вокруг нас видимая часть вселенной которая заканчивается очевидно чем а ну но конус есть такое слово у нас со слова есть до эллипс нет на самом деле кто-нибудь слышал о том что такое реликтовое излучение его конечно не вооруженным глазом не видно вот но его увидели в раде телескоп виктор излучение от излучения вот очень ранняя вселенная чем дальше мы смотрим значит тем раньше был этот свет и спущены принципе если мы смотрим все дальше дальше мы видим все более древняя древности какие-то звезды и галактики которые жили миллиарда лет назад вот ну и что это значит что когда-то мы увидим вот если вселенная существует не бесконечно далеко мы когда то увидим самую самую раннюю вселенную сама молодую так вот оказывается там посмотрим очень далеко мы увидим что там вот когда-то она была настолько плотно что газ заполняющую сирены был непрозрачен вот мы смотрим на солнце солнце непрозрачный газовый шар хотя здесь вроде газ прозрачен но так если газа много он тоже непрозрачен вот мы смотрим и видим что где-то на каком-то расстоянии вселенная становится непрозрачной и вот это очень далеко и она от нас удаляется со скоростью значит 0999 скорости света вот вселенная расширяется и там селена непрозрачной мы находимся господа извините центре постоянно расширяющегося по краям и так это видим постоянно расширяющегося непрозрачного шара температурой два и семь десятых кельвина голода очень да это вот холодное небо вот на самом деле там вот так тогда когда этот свет который мы видим как средств температуры 270 за кельвина был излучин меня была температура июня будет температура десятки тысяч градусов вот насчет красного смещения поскольку он нас удаляется к нам этот свет приходит уже сильно сильно покрасневшим даже я бы сказал по инфракрасным и даже по радио 2 мы увидим в раде телескоп микроволновые антенна как радар вот то есть на самом деле такие мы находимся в центре непрозрачного шара который кажется нам холодным потому что он расширяется нас один горячий это горячий значит газ ионизированный там плотный и горячий газ вот такая штука а дальше вот если представьте себе что мы например таких мы смогли каким-то образом через это непрозрачную сферу проткнуть можно сделать например если смотреть не в электромагнитных лучах а в nejtrino где-то там nejtrino она протекает через это теоретически их никто еще пока не видел весь реликтовой нить ирина которые родились давно знаешь nejtrino она проходит через земной шар и через солнце даже может проскочить вот можно заглянуть еще дальше и где-то там теоретически есть даже твердое сверхплотной а точнее вселенная то есть то сейчас там ее нет но мы ее видим там потому что свет от а значит когда-то был давно-давно из пущи вот поэтому когда вам рисует картинку значит что мы находимся в центре значит небесной тверди как считали древние мужик там башкой протыкает это твердь здесь все правдоподобно кроме того что во первых на тверди не нарисованы созвездия во вторых мужик пока до нее добежит она соответственно будешь все время удается его уже до туда не добежит вот а так в целом вот так как кажущееся такая картинка есть но вот поскольку между реальным и кажущемся не всегда есть четкая грань реликтовое излучение мы увидим она как бы есть но попробую под да беги данила ваня да мы же договорились говорить то что детей понимают какие реликтовое излучение и на это же так захватывает это захватывающее время тоже идет а у нас еще простые вопросы которые давай свое сердце него я спрашиваю тебя какой раз стенда созвездий о отличный вопрос это то что дети видят вот например какое расстояние до большой медведицы да это правильно для большой медведь не кварц станет потому что вы знаете как значит в монголии дорог нет есть только направление вот так же и созвездие значит это созвездие этом направлении вы все что находится там за большая медведица там малая медведица там лебедь там орион точно вот или пояс ориона до вот это лишь направлении трястись и звезды находятся на разных расстояниях просто нам повезло что они какие-то фигуры для нас складываются значит в чем польза созвездий с помощью них можно запоминать расположение звезд и такие мои магические картинки которые свои время придумали романтические древние но поскольку у них было дофига времени вместо того чтобы просто приписывать именно мира они придумывали романтические истории которые некоторые люди потом начали всерьез верить вот и поэтому уже да кстати про эти созвездия что люди увидят на другом полушарии антиподы антиподы как они видят в созвездии видят южный крест но южный колеса вот например ориону из австралии виден как вы думаете ну то есть созвездие такое среднего мира не совсем полярные а вот деньги экваториальной области вот или зодиака 5 жест пресловутых видно в другое время года а вот и нет в то же время года потому что земля то с той же стороны от солнца вот земля вот солнце а вот там созвездие вот что мы отсюда видим там со звеньев то мы отсюда видим то созвездие нет время года то же самое фокус том что мы видим созвездие перевернутым дастере он там вот как рисовали древние греки что это такой мужик с дубиной представьте в австралии и как это ребенка объяснить вот я на при объяснял так что вот ты идешь вот так вот иду иду вот он 1 орион и вот он и так все уходит уходит уходит и какой-то момент он переворачивается ну или можно опять же нарисовать картинку и перевернуть ребенка до можно перебьют антипод сделок антиподом и теперь эти вот да да так еще простой вопрос дело то что астрология почему она не наука дело за что мы же видим наша вся жизнь насыщена этим предсказаниями городского память люди люди прямо на полном серьезе вот айтишники нормальные начинают говорить что день сегодня плохой потому что я поэтому не пью до меркурий в кармане там у ориона и лежать и поэтов попал под дубинку ориона там большая медведица сожрала малика вот на самом деле ответ астрологии не наука он ищется на странице википедии под названием научный метод познания вот если вы прочитаете эту страницу вот и попробуйте приложить ее к так астрологии вы значит тем самым узнаете все стволы это не наука правда там из этого не следует астрология говорите правду но по крайней мере не правда говорят те кто говорит что эта наука это уже о чем то говорит вот макей значит как померили расстояние до звезд мы просрал я не кончили ведь они кончили давай конечно дел то что астрология она основана на том на этих домах на положение солнца да там где не знаю я тоже не знаю но я посмотрел а то есть как бы смотрят в каком доме находится солнце и делают выводы под конкретного человека в его день рождения отдела то что звезды они двигались планеты для каждой планеты планета да но так вот но астрономы знаете что звезды движутся и что там 10 тысяч лет назад например небо было другое и вообще ну то есть все это вилами на воде писано вот поэтому это как собственно и не имеет отношение к кого извлекатель на свете тоже на самом деле меняется да то есть она была другой совсем за счет того что земля земная ось при цитируется есть такое интересное время если выпускали волчок увидели что он вот так вот делает мы увидим по-другому точно также делает с периодом 26.000 лет они объявляют так не переворачивается халтек но и другое дело до на земле идеальный волчат вот на земле не переворачивается но вот она при цитирует пришлось земле сейчас смотрит на большую минут на малом медведь света на полярную звезду а через какие не 3000 лет вам слышно какая полярная звезда нет никакой полярной звезды вот потому что уже будет смотреть существенно другое место у земли за счет этого зодиакальное созвездие тоже смещается ну то есть вернее они на том же месте на уже нельзя сказать что солнце там в декабре находится созвездие прошел носорога еще одно практически то что дети спрашивают когда они видят нас узкие картинки или там красиво и так вы все видели какие красоты на небе а на самом деле конечно вы покупаете in телескоп они смотрят телескоп и ведет елки паука гита тусклые или видно и звезды значит размытой планеты вот зачем ты меня купил телескоп cut и получше так вот но почему почему вот не удается увидеть на самом деле глазом а ну вот на самом деле не только поэтому просто когда мы фотографируем мы накапливаем сигнал за большое время глазом мы так не умеем вот поэтому можем увидеть довольно таки не яркие элементы модели там даже цвета какие-то слабые которые просто чуть чувствительности глаза дар через телескоп не хватает если мы потому лица рисков приводя фотокамеру мы сможем вот если мы даже обычно фотоаппаратом с ним хорошая погода небо мы увидим да столько звезд сколько нам глаза мне снилось да не надо двигать за 10-20 секунд там ничего никуда не уползет вот дождешься уже будет море вот на самом деле глазом поэтому астрономы вот они и резко км отказом телескоп основном все что мы знаем о вселенной она там как минимум от фотографирования скорее от каких-то более хитрых сложных приборов я вот вторая fear'a я вижу черно-белую картинку просто я знаю что она в этом фильтры то есть длинные волны получая в трех фильтров картинку потом начинаю фотошопе 0 эффенди в программе складывать и начинаем подкручивать цвета так что было бы вода там для чего-то нужно чтобы там ну напечатать получить грант красиво зарабатывать деньги так далее вот ума насти на самом деле 2 очень трудно увидеть туманности на небе и на фотографиях они выглядит просто замечательно и ноту мало с ориона принципе можно монастыри она моя но все равно она будет не такой конечно на россию как на 100 грамм это связано вот с чем значит туманности во-первых они светят слабо во вторых они светят в узких спектральных линий а то есть значит не так как лампа накаливания так как солнце а так как лампочка газоразрядная узкой спектральной линии для того чтобы получить хорошую изображение туманности надо взять светофильтр который пропускает только это узкую курс курения ну или там несколько этих линий вот тогда вы можете получить яркое изображение туманности то есть весь паразитный свет он имеет широкий спектр и фильтр его будет убивать а туманность будет оставаться поэтому вот глазом через этот фильтр вы увидите черноту надо мало пропускает свет а значит надо копить но фотография будет замечательно вот кстати любительского класса такие фильтры есть специальные любительские телескопы для наблюдения солнца вот там такие фильтры используются в узких спектральных линий ах солнце выглядит совершенно не так вот может означать поискать там солнце в линии томаш альфа например как выглядит или каких других специальных линиях увидите что она вовсе даже не такое ваня не надо про шельфа давай возвращаемся к детям где эти то есть возвращаемся теперь к телескопам потому что самый частый вопрос который или спрашивает какой телескоп нам купить если вы на авито посмотрите телескоп ту вы видите тысячи телескопу которые товарищи купили и продают потому что ну как бы дикторы пишет что вообще посмотрели на 1 ничего не увидели и продаем вот возникает вопрос а люди спрашивают что нам купить вот давайте вот такой практический вопрос решить но мы не рекламируем ничего мы не занимаемся разработкой телескопов на на самом деле важно где смотреть до гораздо важнее где смотреть но мы живем в москве и обычно называется подоконника в астрономию ну то есть на подоконнике ставите и хотите что не посмотреть но вот обесточить москву хороший вариант да но но жестокий вот кто-то наверняка москва столь велика что от этого несколько человек погибнет точно поэтому делать нельзя вот на что можно сделать это можно смотреть на луну значит достаточно яркой достаточно интересно чтобы ее рассматривать с удовольствием и можно изучать поверхность луны все ли на графе называется значит там есть куча всяких объектов с именами очень красивыми которые давали тоже люди тогда когда у них было много времени вот значит фотоаппарат ну так просто фотоаппарат с коротким фокусом вы там ничего не увидите вот то есть вам нужен фотоаппарат с объективом стоимости около миллиона рублей поэтому лучше просто возьмите телескоп вот значит телескоп шкажи какие бывают виды телескопов значит и рисков доступно с большим увеличением и диаметром объектива там порядка 10 сантиметров до наблюдений луны вам будет достаточно вот их на рынке много бывает линзовые телескопы рефракторы и зеркальные рефлекторы но для луны практически разницы нет наверное рефрактор проще вот ну не знаю если вы выезжаете ну да в москве в этот же телескоп вы можете увидеть юпитер со спутниками значит с а кольца сатурна да особенно если вы на дачу выглядеть его где все таки чуть потемнее небо там значит полоски на юпитере увидите спутники на нем будут вот на марсе еще ничего не разглядите mgs мкс может увидеть и значит увидите венеру как вот такой вот серпик месяц вот ну и можете увидеть пятна на солнце тоже интересна не только не надо смотреть на них через телескоп глазом значит самое главное это не смотреть на солнце через телескоп глазом вот и не просто глазом вот нет ну что если взять закопченное стекло или там черный такой светофильтр вставить в окуляр когда на солнце смотреть глазом можно вот вот эта фигня а значит он будет такое говорить лучше отправьте этого человека подальше вот потому что есть еще инфракрасные лучи которая также прекрасно через сельского проходит вот и фильтр скорее всего для них прозрачно вот и они точно так же будут выжигать сетчатку поэтому нет не смотрите и всё галилей придумал как надо смотреть на солнце телескоп с помощью экрана вы ставите за окуляром листочек бумаги фокусируйте вы видите изображение на экране солнца и там прекрасно видны пятна если они есть группы пятен и если вы хотите увидеть на солнце что-либо кроме пятен какие-то другие там уже вам нужно действительно дорогой его телескоп про который я говорил с узким светофильтром все остальные явления на солнце видны только в узких светофильтров вот такие телескопы есть на и редки и дороги но некоторые любители тем не менее приобретает но очень чтобы вас было чтобы детям было интересно и я вот рекомендую вам просто купить телескоп и фотографическую камеру к ней сейчас уже продаются такие соседи матрицы которые накручиваешь прямо туда и вы можете накопить достаточное время до можете накопить и посмотреть красивые дольше чем несколько десятков секунд на минут ну да да давай скорее всего если вы хотите дольше вам нужно уже ставить введение как но бывают переходники на зеркалке то есть производитель телескопов обычно выпускают переходники на какие то там широко распространенные типы зеркалок значит москве видно плохо значит раньше устраивали docs видно эпоху устроили публичное показа не было вот у нас во мглу гаиш и вот сейчас я не знаю будет ли это мне сейчас пандемии точно не буду осенью его такое бывало сентябре делали много лет подряд кучи народа собиралась на потом народ привык уже собирается перестал может быть не скорость основа начнется в москве мы наблюдаем у нас стоит 70 миров телескоп за т2 и мы прекрасно наблюдаемся в новые звезды там да вполне себе нормально это не значит а глаза на него смотрит на весит прибор который что-то измеряй на вот еще один вопрос уже люди уже устали давай вот такой миф про можно ли увидеть звезду днем находясь в колодце зайти часто бывают такие вещи и я встречал питерцы они такие странные люди они говорят что у нас зайдешь во двор в колодец и можно увидеть как говорится звезду нет обычного если она солнце но в общем лучше там просто колодец ответ такой колодец просто очень глубокие пока у него спускался уже стемнело значит наступила номер и звезду стало видно вот но если кто не значит иметь такую практику погружение в колодце опускание колодцы то есть у кого есть глубокий колодец на даче можете попробовать вот только вентиляция пожалуйста обеспечте без интереса нельзя то будет запускаться вот и можете попробовать и скорее всего ничего не видит ни вы все равно такой же яркой яркость неба ровно такая же поэтому нет никаких причин чтобы эта звезда была там видно другое дело если вы там например находитесь высоко в горах вы пробка там про рыли колодец не бы черная там может быть во что ты увидеть а то вновь отличная идея отличный день нет ты про значит обсадную трубу связям охлаждение риска ядро поэтому нужно обсадная труба система охлаждения валя давай носит еще один вопрос зодиакальный свет кто видел зодиакальный свет вообще видели это ведь такая уникальная способ увидеть нечто космическое да вот 67 а также есть не только звёзды и планеты есть еще такая пылищи который летает прилетать нужно в плоскости орбит там всех планет приблизительно вот вот эта павича она иногда пытаюсь она подсвечивается солнцем ну понятно что это все довольно таки тусклые явления просто от москве не увидишь вот на черном небе глянец пустыне или в горах можно увидеть такой тореол такой вот это лек имеет дать эту фотографию дождь и я зажала не показывает сейчас но где-то ему удалось сфотографировать это ночью в гималайях такой зодиакальный свет вот то есть это воспринимается просто как такое сияние в городскому человеку кажется что там есть какая-то подсветка где-то там наверное поселок или город этом направлении подсвечивает небо на самом деле там ничего нет вот этот зодиакальный свет нет это не какой-то сыну то есть кольца сатурна это камня который довольно много вот зодиакальный свет это кольца солнце в каком-то смысле такая пыль и и мало она гораздо более размеренно чем кольца сатурна вот но она подсвечивается солнцем и и чуть-чуть видно так но я думаю что вот последнее на чем мы должны с чего бы хотели начинать на самом деле это астрономии и а идти о собственно где здесь сайте и астрономия цвете так далее то ты будешь говорить астрономия является наука звездах и она исторический является как бы мы работаем с данными с большими данными и в прямом смысле на самом деле то что мы здесь оказались вот это уже говорит потому что стран умеете как-то связаны да вот олег это живой пример астрономы который валялся базами данных там что они ему нужны были для странами знаете для чего я занялся вот я занимался сном и звездами и занимался поиском сверхновых звезд за искали мы сверхновой звезды так снимали пластинку 3030 на телескоп небольшом вот и сравнивали ее с тем же местом изображений того же места в другое время вот что такое означало это сравнительно было поставить пластинку слева поставить пластинку справа и от глазеть поставить там миллионы звезд надо вам нужно грубого ряд сделать jojen анти джо и двух пластинок глазом но скребок да не превращает ребенка прибора он перебрался просто перебрасывал но все равно ты должен двигать вот так и да и просматривать на это уходило 3 4 часа и жуткая головная боль я занимался этим делом все сосуде ческих пор то есть мы фотографировали за ночь до первых ну 8-10 пластинок делали потом мы их проявляли ставили сушку я шёл спать просыпался завтракал и начинал этим заниматься называется блин компаратор то есть занимался производства zeiss это была такая работа и очень не хотелось открыть сверхновую звезду потому что в те годы число свернул звезд была там несколько сотен и человек открывшим сверхновую звезду автоматически становился небожителем таким записаны в и и так далее я за свою жизнь и открыл 4 звезды но они получили название но какие простые там хода чего-то такое ну их называю сверхновая там какого-то года и дальше буквой а за это был очень тишине это с 99 а там 1029 б до этого была очень тяжелая работа и каждая сыпного давала такой уникальный материал для научных исследований по этому когда я начал заниматься я понял что когда появились сенсоры вот сенсоры а это совершили революцию вообще в астрономии и вообще в науке потому что но центру таких как у нас смартфонах в камерах да и так далее то есть получила мы получили возможность не только накапливать свет информацию мы получили возможность оцифровывать то есть небо сразу попадала в конце страдают рубля на фотопластинку это было революционно потому что можно было начать уже не глазом вы так вот сравню а делать это какими-то алгоритмами алгоритмами и сразу сверхновая начали открывать уже не по одной штучке сотнями тысяч имеет так далее да то есть получились уже машины которые автоматически снимают нос понимаете каждый пиксель вы можете ну специальная программка не очень сложный определить с координатой то есть грубо ряд пластинка вот это изображение неба она превращалась таблицу айди и координата и там альфа и дельта вот грубая табличка при этом у вас имелось другая табличка парный каталог всех известных объектов и вы просто в базе данных делать и joy или там есть ли наивным способом то это была бы очень много лет вот делать это дело и тут как раз мне захотелось попробовать вот делать индексы я прочитал про индексы и вот появились те яндексе которую сейчас вот и в адресе пользуется которые позволили делать это в течение секунды меньше чем секунды вот такая у нас история а айти астрономия это просто но сейчас расцветает просто очень махрова у нас сейчас запускается в большой телескоп у которого матрица на диких размеров 3 гигапикселя ну то есть у нас вот здесь мы пока работа мегапикселях да а тот матрица 3 гигапикселя и за ночь наблюдение она выдает десятки терабайт вот соответственно база это петабайт и ну и так далее а если взять радиотелескопы радиотелескопы за диких они верах размеров у нас есть там где-то в чили что ли да там пустыне там стоит радиотелескоп у него площадь 1 квадратный километр то есть вот он выдает петабайты и поэтому астрономы они полностью ощущает на себе что такое большие данные да вот как их передавать как добрались до на ее собственной астрономии даже преобразовали то что они говорит что вначале сверхновые открывали по одной и каждую из них там изучали вот когда все пошло сразу цифровом виде то появилась вы можете изучать их масса от кстати вы знаете с какой частотой видимой части вселенной вспыхивают сверхновые звёзды как вы знаете может предположить несколько раз вот олег открыл на призы свою жизнь глазом 4 сверхновой звезды вот а несколько раз секунду ну на самом деле умер 1 3 минуты вспыхивает сверхновая звезда видимой части вселенной года ну открывается конечно не все потому что астрономы не до сих пор не могут вот прям так непрерывно мониторить все потому что легче больше телескоп тем меньше поле зрения вот но тем не менее их уже оказалось достаточно чтобы вот именно исследование сверхновых звезд они позволили сделать вывозом как расширяется вселенная как вы расширяет сверхновой звезды от такие маркеры стандартные свечи известной мощности раскидано и значит где-то по вселенной взгляде на чит на каждый из них мы можем понять что там с какой скоростью она удаляется накамура стане находится и построить такую кинематическую кажутся как бы вселенная как она расширяется и вот все дальнейшей теории там тёмная материя и тёмная энергия все она сейчас строится так чтобы подогнать вот эта наблюдаемую картину расширение которое получили сверхновым звездам которая вот начинал начал изучать олег когда-то глазами а потом уже все поменялось я помню на компьютере на bsm 4-м это такой к толпами такой такую компьютер бывшим 4-м это 8 килобайт памяти олег даже я не помню да и у нас стояли ленты то есть у нас были не диски а ленты магнитные на которых руками размечал ее как блоки базы данных это они за слово база данных оказалось что это были баз данных писал свои маленькие чтобы построить зная каталог какой то сделать я писал программу для определения для поиска сверхновых звезд то есть как как сделать программу наблюдений чтобы захватить как можно больше областей небо с галактиками чтобы найти там когда мы вручную наблюдаете много времени уходит на то чтобы телескоп от повернув навести вести переложи ца а так что вот все по дельта или пальцами на двигаться оказывается галактики на небе не везде да сверхновые открывая другие галактика сейчас нашей галактике все таки редко вспыхивает поэтому просто говорит олег это сверхновой в других галактиках вот и соответственно что-то где много галактик но во первых есть скопления вот а вообще окажется галактики на небе вот как казалось бы дать вселенная однородна и там более-менее хоть расширяется любое направление куда ни ткни будет одинаково количество галактик вот нет оказывается не везде вот какая последняя сверкнула вспыхнула желали ркка и а они вас вынужден прервать реально на вы можете продолжать как дискуссию мы должны отпустить людей все поняли да посреди сверхновую нашей галактике взорвалась в 1000 1400 девятьсот восемьдесят седьмом году восьмом году этом догадаться сверхновая ричем она при тихо браге 404 сюда году но вот цех нового 7 схема чем она интересна тем что она была близка вот и мы видели ту звезду который стал осознавать зарывал вот что самое интересное но сейчас вот видели там читали опять же про бетельгейзе такая звезда которая типа вот-вот взорвется да да а там оказалось что нет но очень ждали ну посмотрим может еще зовется вот ладно спасибо за внимание может если когда-то вопросы есть лайв удовольствия ."
}