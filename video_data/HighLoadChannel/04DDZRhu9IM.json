{
  "video_id": "04DDZRhu9IM",
  "channel": "HighLoadChannel",
  "title": "Как мы в Mail.Ru запускали первый в России Kubernetes как сервис в облаке / Дмитрий Лазаренко",
  "views": 553,
  "duration": 2902,
  "published": "2019-05-15T02:40:04-07:00",
  "text": "мой доклад будет про немножко про тематику конференция и даже не тематику от святого конференция это сжатые сроки сжатые сроки сжатые доклады у нас есть сюда дедлайны и про то как запустить такой сложный продукт как uber нить из когда в тебе очень сжатые сроки хочется сделать хорошо немножко про нашу компанию это такое подразделением дримеру в mail.ru очень много железа дата-центров все знают про почту вконтакте одноклассники вот был внутренний облачный провайдер который перерос себя и год назад мы запустили продакшен публичное облако публичное облако я но это оказалось нам мало и марте марте этого года у нас была задача поставлена задача подними подписали запустить первыми в россии купер нить из как сервис это было очень амбициозная задача за счет того что мы хотели быть первыми в россии все знают про наших конкурентов и хоть и хотелось выделиться задача была непростой потому что во первых mail.ru очень любит импульс source и из другой и с другой стороны не покупает windows key решение поэтому просто купить какую-то коробку с к верните сам было невозможно и одновременно хотелось получить платформу сервис который отыгрывалось нашим openstack облаком это большой опыт так облака с севом гипервизора my сетями и так далее важно что мы хотели сделать удобное решение удобно и мое решение например кубер найти с который умеет обновляться купер нить из в котором существу и такое простое управление пользователями их правами и например star стоп для тех кто любит экономить такие такие действия ну и мониторим конечно ну и здесь главный фактор это минимальный темпе маркет но для нас это было полтора два месяца изначальном поставили себе полтора месяца запустить это было немного амбициозно и в итоге запустили чуть позже да как я уже говорил про open source решения ищи вам выбирали умело очень большой большая экспертиза в концерт в upon стеки конкретно в докере в том числе например одноклассников при этом по купер нить если мы смотрели на решение доступны в комьюнити были решения типа к пуску спрей кубан были определенные моменты почему мы это недели почему не выбрали их например часть решений не поддерживала multimaster или другие решения не были интервью у нас нашему окон стек облаком был еще вариант сделать вообще с помощью тира формы взять тира форум и pro-vision виртуальные машины сети и дальше уже каким-то образом ставить камеру тезис ну и одновременно с этим была другая другая сторона этого конспект ну что вот это комедия на большое она не так бы сразу вается как кубе райском линьки ну там история уже побольше это много лет разработки был один проект зунт который фактически представляет контейнеры как сервис нику вернитесь к xi руется контейнера как cyrus но нам он показался мне очень интересен потому что ну это просто примитивное управление одиночные контейнерами а клиенты хотели кубер не this murano это такая дочка мир антиса но так как miranti сошел и из россии как-то схлопнулся разработка и сам проект загнулся и мы решили не ввязываться в такой сервис каталог на базе murano хоть там уже был дистрибутив для купер не tissot и остановились на magnum это платформа которая позволяет создавать кластер повернитесь или например кластер и dockers вором но надо курсом решили не обращать внимание это было не нужно нашим клиентам да и почему все-таки подошли не подошли другие инструменты почему по подошел magnum не по не подошли другие инструменты такой самаре во многих инструментах нет интеграции с инфра стороны они проведут кластер на существующую инфраструктуру нужно как-то подготовить и они решают задачу кроме кокса который на тот момент умел работать только с амазона сложно было кастомизировать у нас большая экспертиза в питоне а вот большинству кубер нить из инструментов они написаны на гол и здесь возникла такая противоборство команд в итоге мы решили не ввязываться в голову продолжать работать с питоном да и в итоге там там артистом лучше про multimaster я сказал и последнее очень важно и что эти инструменты не позволяли сделать лайфхаков те самые обновления старт стоп и масштабирования не сделать пузырь не позволяй сделать управляемый lifecycle нам хотелось контролировать все итоге мы выявим magnum немножко про то что он дает magnum это open source компонент и он нам дал такой прям готовый фундамент для работы работы с к вернитесь быть было очень просто воспользоваться сдать кластер не всё так просто оказалось впоследствии из его особенностей то что он использует хит это аналог амазонского платформы шина практически один в один для того чтобы создавать ресурсы ресурсы которые связаны друг с друга например виртуальную сеть много виртуальных машин в ней балансировщика роутер и правила firewall а еще в нем поддерживалась ну-ка и как вот эта концепция life's a kill когда можно выполнять действия на к конкретным объектам померкла string обернитесь и краткая картинка как устроен хит как как устроен magnum то есть это такой сервер у которого есть api ой и отдельный компонент который называется magnum контактор который с помощью драйверов для конкретных типов кластеров умеет создавать plaster а как он создает он фактически формирует такой большой хитовые шаблон таяму файл и отправляет уже web instek создавать ресурсы на базе этого я вам файла и в итоге получается такая печка которая вытекает клубе ramdisk мастера и дальше уметь с ними что то делать а клиенты потребляет уже куплен без мастера с помощью стандартных средств типа куб это его до чем нам помог magnum тем что мы вышли production за два месяца с мы начали разработку где-то в середине марта вы вышли продакшен pressure лисы на нормальный запуск на стабильный продукт уже в мае и в итоге получилось такое решение которое позволяет прям накликать себе компоненты в конфигурацию кластера продакшен стайлинг или девелопмент выбрать дополнительные donna типа мониторинга или докер индустрии и получить класс течение какого то времени дальше с ними работать обслуживать останавливать удалять дьявол детали расскажу конкретно какие сложности мы решали на этом пути да и наша финальная культура которая доступна на данный момент здесь очень важный важны нижние части например тут есть такой большой кластер всех для стороны есть еще компьютер сервера этот все что нам на базе окон стека и мы поднимаем виртуальные машины upon встреченные сети маршрутизаторы балансировщик и и поверх всего этого работает купер не tires и есть такая компоновка стандартное более 120 пакеты cd корр dns каррика как не только провайдер и дополнительные компоненты например предустановленный ingress нам очень важно чтобы клиенты могли запускать свои приложения нормальным способом ничуть не через над порт либо же предоставляем мониторинг parameters in hawaii графа это архива на дай момент но мы прогрессировали на самом деле в начале получилось немножко не так в начале до 1 futura который мы сделали с помощью магнума она использовала qoros как базовой операционной система и ркт как контейнер runtime для запуска сервисов каберне this плюс у нас был было фланель как этот драйвер и трафик как ingress контроллер вот мы посмотрели показалось что тратить такой прикольный проект модный хипстерские решили попробовать оказалось не все так гладко казалось что в курьез особым образом работает клауда нет или не надо не работает например он не понимает мульти мультипарк в качестве ммм тайпа и наши лайфхак на котором планировали делать мы начали это заботой lifecycle и обновление кластер оказалось что она не работает со всем там и был такой выбор либо же как-то это фиксить karos это бы вообще какой-то космос либо же уйти на что-то более стандартное с этой экзотике и мы перешли на федора томик и заменили здесь ркт на раньше операция не дешевая это примерно полтора месяца работы команды на переписывание логике вот этих драйверов который ставит кластеру ск росно на федором следующая проблема это краста что трафик оказался тупиковым решением это принять начали неправильное решение взяли это нагрет контроллер получилось так что у него была проблема работа с сертификатами с encrypt например там все очень сложно так настраивалась и плюс комьюнити оказалось гораздо меньше для нас очень важно когда проект поддерживает в большой комменте вы того же не джеймса рецептов как его готовить под как это нужно нужды заказчика казалась гораздо больше и нам пришлось оказаться от трафика и другая проблема другая боль это то что мы используем фланель мод для там ту маркета решили взять уже готовый компонент фланель как-то не особо туда выбирали казалось что он плохо работает сводится в принципе и мы видели очень много ну и наши клиенты на самом деле видели такие проблемы когда в блогах фланели пишется что он потерял связь и т.д. а так как этот метр провайдер использует эту сеть ломалась но временно времена потому что мы использовали балансировщик и для связи фланели с классом это cd перед это cd стоял в такой внутри не было сверчек нагрузки и была особенность что соединения закрывались балансировщика балансировщик ничего не знал о том активную они или не активно его рвало кидал соединение рвал не только у нас в константину и в амазоне на самом деле это решилась в третьей версии the cd там появился специальный такой хоббит noob но фланель она не умеет работать с это cd по протоколу в 3 поэтому пришлось отказаться от панели совсем итоге мы перешли на нашу хорошую архитектуру уже было вот такое более взрослую архитектуру номер два она еще не совсем финальные там где мы пришли на федора томик перешли на каликам очень долго мучились а все-таки что выбрать в качестве network провайдера либо калики либо вив в итоге перевесил колликотт по ряду причин но в целом вид тоже популярен но нам он не подошел потому что мы хотели обеспечить метрополисе как и ingress таки такие gres да и когда мы рисовали такую архитектуру мы смогли делать lifecycle офиса к вот что такое аксакал например масштабирование plaster а больше или меньшую сторону это такое действие lifecycle над кластером то есть меняется количество миньонов или новой технологии not узлов либо же старт стоп то есть если масштабирование нужно было готово в версии морганом толстый or stop но пришлось делать самостоятельно почему клиентам важно star стоп например для хостинга тестовых сред очень многие компании использовались для тестирования и чтобы экономить они либо удаляют кастера как когда они уже не необходимы либо сжимает его до минимального размера до одного узла что тоже не не совсем экономя деньги а у нас они могут его остановить и заплатить только за жесткий диск во время остановки но его экономию порядка 50 70 процентов поэтому решили делать такой старт стоп но самая большая сложность была с обновление версий это было очень нетривиальная операция как научиться обновлять кубер найти стабильно с версии например 110 до версии 111 но я не могу править расскажу ну и последнее удаление ресурсов удаление кластера который вызывается за собой долине ресурсов тоже было хитрый операция потому что копился мусор и витоге нам пришлось делать такие определенные хаки чтобы реализовать эту операцию до немножко prolife сорта как это работает есть оркестре шины джин фактически это наш magnum сервер который управляет как мастерами и клиент говорит что хочу сделать что-то и например отмасштабировать кластер и виртуальная машина вне содержит специальный агент который забирает эту информацию из engine и начинает выполнять какое-то действие например случае масштабирования выглядит так что клиент приходит и говорит хочу добавить 10 10 минут magnum отправляется за 1000 сообщение хит говорит что теперь новое количество узлов стало десять и хит добавляет эти виртуальные машины да тут еще важно правая часть наверное на этом графике потому что виртуальные машины они должны тоже что-то сделать внутри то есть например зарегистрироваться где-то и в этом случае виртуальный агент работы с виртуальной машине собирает информацию из хита говорит что вот есть это новое состояние пример количество 010 либо версия куприн все равно 11 11 2 и сделать что-то обновить остановись ну тут в совершенно разные варианты концепция прикольная но она была они не идеально например в случае у конспектов лучше готовы компонентов как я уже говорил ранее это не работало скоро ios чтобы принципе победили были такие моменты когда мы обновили мы активно разрабатываем этот продукт и коммиты и выкатки происходят каждый день и вы кормите продавшим и когда мы обновляли версию драйвера которые создают кластер и клиенты которые масштабировались ранее созданные кластер и получали поломанные кластер в итоге потому что обновление драйвера вызывало техническое обновление всех ресурсов в в этом кластере певицы тической пири-пири создание этапа лечилась ну и на на самое такая сложная проблема была то что кит одеты надо повязал повисал и какой какая-то операция вместо того чтобы выполнится мгновенно она выполняла с несколько часов или отворилась по таймауту это все успешно лечатся если у вас есть к это экспертиза в питоне уп ацтеки ну и такая культурная проблема как синхронизировать эти процессы потому что машин много q-breaks кластер это такая сущность когда у вас есть минимум на три мастера для продакшена и сколько-то узлов 10 узлов для миньонов и вам нужно оркестре вать процесс обновления plaster а и вот эта операция в начале мы делали с помощью условных операторов когда мы пытались определить на каком узле выполняется операция в зависимость от этого узла или роли узла выполнялось как она или нет ну и потом мы пришли к решению так называемый сайт карт видим это когда запускается отдельный день а виртуальная машина с каким-то регистрирующим кодом который уже содержит себе бизнес-логику и это вроде очень хорошо зашло следующая проблема с которой мы столкнулись когда взяли готовый опыт царская планеты то долго создание кластера как как хотелось хотелось получить создание пять минут но я очень люблю кого клауд я прям приверженец его и там ты приходишь создаешь какой-то в ну либо виртуальной машины либо кластер и она создается ну виртуалка где за пару минут кластер мин минут за 5 лет хотелось приблизиться к укладу а начали мы за 40 50 минут и для клиента такой и секс передаст не дни не не очень хороший мы стали разбираться что что не так и оказалось что в начале есть очень много компонент например тот же самый уп instek его нужно правильно готовить и в определенных местах например в и мой сервис это сервис который хранит образы операционных систем там не работала кеширования она не работала и в результате каждый раз вы качался образ 10 гигабайтный и это занимало такое неопределённое количество времени от 2 до 15 минут в идеале это занимает секунд 30 новое время скакала птф успешно полечили а вот дальше такой интересная проблема с которой мы столкнулись как я уже говорил мы используем hide ip тетивы фактически описываете граф ресурсов ресурсы зависимости которые должны быть зарезал вины ну если вы и стихи это не знаком то например тира форм тира форме вы тоже описывайте какую конфигурацию вы хотите получить и кластер и который регатах готовились magna вам изначально они имели вот такую зависимость что сеть заправили нить private приватной сеть потом сделать мастер и и только потом готовить миньоны эти операции последовательны и здесь оказалась когда мы стали смотреть как много времени уходит на создание этого вот это первый первый этап создание мастеров он занимал 20-30 минут но это совсем такой космос и создание миньонов он тоже занимала 3 3 5 минут эта мелочь но хотелось ускорить что мы стали копать дальше оказалось что в те есть такой механизм software diplo мента фактически эта установка их то донов например установите cd при создании виртуальную машину после создания виртуальной машины установить кубовые сервисы но перста радж потом установить этот плагин и так далее так далее и все вот эти операции они выполнялись последовательно в последовательно в после создания виртуальной машины в миньонах миньон если тоже выполняли определенные операции по следам мертвым виртуальной машины например установка куплета к прокси и калека и это было неоптимальное что мы сделали что мы сделали первое что мы разрезали создание миньонов создание виртуалок с установкой в них аддонов и мы стали праве женить миньоны не мастер одновременно это сэкономило нам ну примерно три минуты что тоже хорошо когда бьешься за каждую минуту а второе мы раз проверили установку deployment of в внутри этого кита и теперь есть определенные дипломе ты которые делаются последовательной всего 4 и все остальные делаются проявление так там уже нет таких жестких зависимостей друг с друг от друга и это сэкономило 10 минут итоге мы приблизились к желаемой цифры не до конца сейчас это примерно 10-12 минут но уже уже уже не 40 и science такое очень-очень приятный у клиентов да что еще garbage collection вы об этом не задумывались когда у вас один кластер а вот когда вы большой облачный провайдер и вам каждый день приходит полезли которые создают кластер и удаляют кластер и есть такой подход в реальных пользователей которые просто пришли попробовать положили 300 рублей или воспользовались на нашем бонусом создали понравилось платят не понравилось удалили так вот проблема что часть ресурсов которые мы создавали они создавались open стеком а еще другая часть которая создавалась самим повернитесь и например по persist воли moist и праве жениться через явись и то в этот момент мы создавали воли ему нашему богу up in стеки и они их openstack конкретным magnum ничего не знал не знал о принадлежности воли move the конкретным кластером логично с балансировщика мид и так далее в итоге при большом количестве кластеров у нас образовалась очень много мусора от клиентов которые ушли и это achived это много ресурсов что нам пришлось сделать на пришлось building уберу не отец самостоятельно и билл детей контроля менеджер так чтобы размещать эти ресурсы которые создаются кавер нетесова пустяки специальными метаданными и потом уже обращаясь к этим метаданным чистить и делать провели гарбич collection да что ещё важно была такая не тривиальная проблема когда вы работаете с купюрница мире переходите на куприн dice вы ожидаете что это такая машина которая поддерживает работу вашего приложения вот 24 на 7 и что ни случись он перри балансирует создаст новые коды сделать риски during это не всегда правда и например наши клиенты столкнулись с проблемой что в случае пирсе сентаво war кладов то есть если вы используете присест волен клей мы на нормальном нас тораджи так упираетесь и ведет себя немножко непредсказуемо например слива останавливать виртуале машину одно поведение если вы удаляете и и другое поведение ну и последнее что когда вы производите аварию муллер уйти в аварии вы вообще вообще не сможете предсказать что как он себя поведет вот простой пример я уже рассказывал про него на одном из этапов ситуация в миниатюре клиент создают приложения это реплика set for прессом и базой данных мы сиквел и моих сиквел использует песен диск на на позитив и сись эндера все хорошо они живут на разных виртуальных машинах что вот это очень важно да что-то разные моды сочинения кубер найтись и и что мы делаем мы как-то убиваем эту виртуальную машину которое является фактически такое ху ху ху ху с машиной для база данных убиваем мы или востанавливаем либо удаляем либо и украшаем половинкой бред и мы ожидаем получить вот такое поведение что мой сиквел переедет на такую виртуале машину свободную и диск будет успешно перемонтирована к нему вот оказалось что все работает не так как мы ожидаем до при штаты основ к виртуальной машины вот эта операция занимает от 6 до 9 минут потому что есть определенные тайм-аут и и хардкот и в коде кубер нить из и вот есть например тот и консилер max white фон mount duration до 6 минут когда к убирайтесь будет просто тупить и не понимать что делать дальше с эти с этим кодом и из его маун там а еще удивительно что если вы останавливать виртуальную машину при работе с облаком например с amazon эмили сапун стеком то она исчезает из списка над кластер а вот это был сюрприз на пришлось его исправлять коммитить все в исходный код и и пушить делать полу request и но и до сих пор не приняли это такая специфика работы с комьюнити да что еще например а если вы удаляете виртуальные машины тут это перемонтирования происходит практически мгновенно но меньше 1 минуты потому что сын ли связь между виртуальной машиной и при отточенным диском она разрывается сами могу окон стеком а самое забавное самое неожиданное когда мы эмулировать когда клиент эмулировать остановку виртуальной машины и я ставку куплета он обнаружил что упираетесь ничего не делает с этим приложением и монти перемонтирования не происходит мы подумали что клиент не прав но вот так меня мягко мягко говоря но когда стали повторять обнаружилось что до 10 лет так и и ситуация очень просто воспроизводится вам нужно загасить куплет на который и при условии что если на этой ноги работала к это приложение с persist воли move the но там будет помечена как на трейде дальше кубер нить и сделать рыбе стандартные вещи он пытается поднять этот пот или под и на других модах которые здоровы и но при этом старый под он висит и он висит в статусе она и есть старый под одновременно в статусе а но и новые состоянии контейнер рейтинг и ничего не происходит потому что диски примонтирован и к старой ноги и купер нить из ничего не делает он ждет бесконечно долго нужно только вручную разорвать эту связь есть много и shews мы даже тоже один из них создали последний she но комьюнити не очень любят принимать почин нужно иметь такого контейнера в кармане чтобы это пушить влас нойман стрим повернитесь и в итоге на пришлось примете этот патч только внутри нашей сборки упирайтесь чтобы поведение было при аварийных ситуациях более предсказуемо следующая наша боль как казалось вроде бы издалека и и неожиданная боль это балансировка нагрузки например проблема заключалась в том что теряются хедер и теряются хедер и их свору did for при работе за балансировщика мы-то как мы ставим балансировщик для игр с контроллера то не работают из-за этого white list и в inglese очень много веб-сайтов ориентирована как бы рассчитывать на то что не получит пи адрес клиента для того чтобы сделать какую-то логику и терялись и дыры на уровне энгр с контроллера потому что на уровне балансировщика упал встреченного они еще были а вот в ingress контроллеры уже нет и у приложений естественно тоже нет все это фиксится более-менее просто вам нужно иметь балансировщик с поддержкой прокси протокола ну например х прокси имеет ирина черных сумеет и включить его одновременно на уровне этого балансировщика опустошенного и на уровне ingress контроллера и кажется что все просто но тот компонент балансировки которому мы использовали в нашем облаке он не поддерживал этот прокси протокол и нам пришлось глобально менять балансировщик выпустить ее перейти на области как-то я тоже мы тоже его на перевале но и на это ушло два месяца разработки до с одной стороны open source дает большое такое преимущество на старте с другой стороны вам приходится что-то дорабатывать и вникать очень детальный в эти процессы и фиксить руками тут баланс котором нужно всегда помнить и последнее да наша боль и наша боль и боль наших клиентов бывает обновление версий обновление это сложно потому что вам нужно обновлять очень много компонентов вам нужно ну в идеальном случае обновлять весь стек начиная с оправдана системы версий докера которая очень капризная например и т.д. купер найтись и ну и кубовые сервисы там кажется что все бук все более менее понятно но есть также еще сервисы выше например сетевой драйвер и корр dns или гринграсс контроллер и кубовые сервисы можно обновлять просто вот то есть такой процент простой рецепт вам нужно обновить все на мастерах просто заменить теги на мастерах и перестать сделать рестарт сервисом потом сделать что то похожее на миньонах и делать чтобы это было безопасно дело дрянь но такой простой способ которым является сам каберне this но есть конечно крайний случай когда у вас только один мастер только один миньон в этом случае будет дан time и вот этот способ он из его используется куба там этот подход к пачанга все знают что такое куб кубан и в нем был реализован такой подход обновление там есть планы обновлений мы пытались его подтянуть к себе сделать так чтобы кластер и которые создавались нами они умели обновляться с помощью кубот ну это не получилось сделать несколькими search и в итоге на пришлось двигаться своим путём но очень похоже да из плюсов этого подхода что его можно делать наборами то ли они него будете и он достаточно быстрый а из минусов то что нельзя обновить версию трассу на системы версий докера и вот откат он такой не совсем 3d тривиальный если что-то пошло не так вам приходится заморачиваться с откатом назад как уже сказал мы реализовали эту версию этот подход у себя без куба 1 но не оставались над этом оказалось что есть лучшее решение более элегантное как нам показалось который исповедует капс и это решение работать только в облаке мы так как у нас облака ну кажется мы на данном оно подошло и решение основано том что в коксе весь кластер каждая миньоны и мастернода помещается в авто с килем группу и вы можете сделать хак заменяя виртуальные машины из в of tax елин группе удаляя из of the sin группы дождаться пока будет заправили не на виртуальные машины уже с новым образом снова основа образом системы с докер демоном и уже соответствующими сервисами до плюс то что можно обновлять докер операционку а еще что можно делать очень быстро откат потому что откат фактически это вернуть удаленную виртуальную машину или помечены как удаленное из минусов то что это не работает на железках на набором это лев но для нас это не особо критично и из минусов что это работает рука в амазонии в укладе сопин стеком с ажуром все очень сложно ну и последний минус что это долго оказалось что это долго хоть и решение элегантные но если у вас большой plaster то обновление может занимать несколько суток вот ребята пишут это slacked скриншоты из лыка да потому что потому что ожидание того когда виртуальная машина будет добавлен of the screen группу она может занимать до 10 минут а еще есть многократный переезд кодов когда вы начинаете трейдить где приложение и вот есть картинка как который показывает почему это долго виртуальная машина вот желтенькие виртуальной машины оранжевый точнее это те которые обновляются и те которые мы отвечаем за авторские ленин группы и под и начинают переезжать ездить туда обратно туда обратно и все это занимает очень долго потому что один под может переехать на большой на разное количество нот и это происходит постоянно мы обнаружили хак как в облаке можно ускорить этот процесс сделать его чуть более дорогим ну сильно быстрее за счет того что можно удваивать количество миньонов временно напротив во время во время обновления и потом дело делать кордон старым нодом и массовый drain тоже для для старых not да и еще не забыть про при назначении танцев что часто вы цените свои приложил свои ноты для выполнять их тоджи вот например job of ресурсоёмких и вот картинка который демонстрирует что становится все быстрее значительно быстрее потому что вы добавляете фактически такой копию вашего кластера и кордоне ти левую часть это ваше старое миньон надо и начинаете массовые drain и переезду даже визуально что там скорости анимации занимает сильно-сильно быстрее экономия экономии в разы и мы пошли по этому пути и сейчас мы внедряем эту схему она не всем простая но мы как раз делаем по результат х3 плейсмента при при обновлениях и в том числе наши обновления будут теперь включать обновление верхнего слоя грессов калика и гордое наследие и подобных вещей в результате все будет более удобно ну и последняя часть про архитектуру я уже говорил что мы сменили архитектура один раз сейчас настало еще одна смена то есть мы слышим отзывы клиентов фидбэк и одни не стоит таких отзывов был то что клиенты они не хотят администрировать каберне this на многие клиенты вообще хотят получить контейнеры как сервис не купюрами this как сервис контейнеры как сервис при этом в текущей идеологии мы даем клиента полный состав на ноды с помощью которого они могут зайти что-то сделать и у нас нет ssh доступ вообще в кластер и когда происходит что-то страшное когда клиент за тепло и свое приложение у него это отказывает мониторинг он прибегает говорит почините мы говорим подложите наш ключик но вот они не очень удобная ситуация до поэтому что мы решили сделать мы решили это брать ssh у пользователей и право на тепло ивков куб систем для того чтобы обеспечить обновление как раз всех сервисы которые у нас работают куб системе типа ingress контроллера или корр dns и калека и сделать мы наш решение да и что мы сделали саша мы отобрали его у клиентов и у себя ну практически отобрали мы стояли перед выбором таки марки туром а как делать менеджер весы не имеют доступа к кластеру первый подход был в том что мы можно на каждый кластер генерировать новые ключевые пары и сохраните ключики в такой безопасное хранилище шифрованием его по статье есть этот компонент но наша безопасность она порно миндальная и но не получилось договориться с безопасники потому что все равно есть риск того что кто-то зловредный за владеет ключом клиента и зайдет и украдет эту информацию поэтому пошли по другому пути он заключает в том что мы маги динамический гирин ключевую пару если возникает нас нету клиенты клиент обращается в жире и мы подкладываем эту пару с помощью хит агента в все виртуальные машины в клиента все виртуальные машины мастера и ноды и уже решаем проблемы как только интенция закрывается и тот же агент удаляют эти ключевые пары и таким образом наши админы наша сенсов саппорт инженеры они не имеют доступа к кластеру клиента а весь доступа к и контролируемым урологи ромой и кажется что это очень прикольно и решение потому что снимаясь нас такую ответственность за доступ к данным и делает клиентов счастливыми да и последний слайд про вызовы прошло уже примерно 8 месяцев с того момента как мы запустили начали работать предоставляя купались как сервис 6 месяцев с продакшена есть много клиентов мода фидбэк ему и постамента трансформируемся и наши планы что что мы хотим сделать я уже говорил про обновление правильное обновление за счет прибыли placement of также мы движемся в сторону лучших менеджер сервисов и и здесь мы говорим про массовый починка кластеров когда выходит к этому видимость нам нужно сделать так чтобы клиенты были не запечены той этой этой проблемой и такая концепция как not pull и для того чтобы держать машины разного размера для ваших нужд и of those келлер так что вы кластер автоматически подстраивался под нагрузку под нагрузку который генерируется при приложениями сейчас работает с амазона мгу клаудом ажуром это не работает суп ацтека мы пишем у все эти компоненты самостоятельно так как на комьюнити надо сложно рассчитывать часто не дают какие-то хорошие концепции хороший код но так как у нас преследует там ты маркета приходится делать делайте самим иногда давать в комьюнити иногда не давать так как это ставится уже такой интеллектуальной собственностью ну и выводы наверное выводы нам нравится upon source нам нравится панстарс и здесь опыт source видео пластика и готовы компонентов он сильно помог вырываться на старте вот но всегда нужно помнить что и опыт source уже на год готовить нужно уметь готовить и в этом случае не не всякая компания можете себе это позволить компания масштабов mail.ru да и у нас у пинсер секунд стать очень хорошо прижился и мы в него будет дальше инвестировать у меня все спасибо вам есть надавать какой ты хочешь не работает но вы уже по факту но у нас беленького секундные поэтому это обновление обычно не занимает случае replacement of она не будет занимать там больше получаса ну то есть эта плата ложится на клиента но это более надежно также делает например клауд но там они создают только по одной виртуальной машине и все равно это долго мы хотим сделать быстрое обновление вот поэтому да это оплата ложится на клиента но это не большие деньги под штабеля по секундой нас только один микрофон и один человек и несколько рук в зале спасибо за доклад как вы клиентом логе доставляйте блоге кодов но они настраивают в любит и там уже вполне нормально мы часто идем в сторону сервиса чтобы это штука была из из коробки на сейчас приходится настраивать клумбе тарелка отдельно менеджмент самих кодов через дашборд или but still это это вот и есть ограниченный не ограничен доступ там есть интеграция с наши интенции правок провайдера мысленно говорю про большую компанию чтобы разделять доступным space м но ну да и это работает хорошо спасибо за доклад у меня вопрос про обновление и вот как раз про куба вы на бирме то ли не пробовали обновлять то есть если я запущу код кубок он обновляет одну одного мастера допустим миллион обновляет автоматически весь кластер не сразу захочет 1 он делает rolling апдейт он делать жулин контент и он может упасть новый сначала понравится мастера и поток потом но в этом то есть это он все делает типа в комплексе и нельзя поделить допустим сказать ему обновить там одну воду сначала потом следующую ноту но это нельзя вам приходится то есть на периметре безопаснее руками обновлять каждый компонент чаще это просто да проще если у вас свеклу что брдм это обычно это большие машины и машин не так много да и кажется это проще просто поменять версию в скриптах и перезапустить если вам не нужно заморачиваться с докером операционкой спасибо вот есть человек спасибо за доклад расскажите пожалуйста про интеграцию зал до пыли с сервисом active directory про безопасность и прочее жила с этим смотрите индекс солдатам она уже ложится на плечи клиентов есть очень много готовых таких провайдеров компонентов которые через выпуке позволяют интегрируется с этим директор и мы же даем прежде всего интеграцию с нашим кий стоном это keystone то оденьте провайдера пластики вот но вы также вы можете поднять если у вас есть свой дом сервер через выпуке поднять авторизацию через опыта или или в дашборде такая авторизация есть вакуум шахте но мы не используем у ван shift по разным причинам мы используем ванильный практически повернитесь и подсказывай клиента как настраивать окей были были ещё люди кто кто последний поднимается на давать один микрофон не работает вы же говорите что вы запрещаете деплоить в куб систем вот соответственно что вам сделать авторизацию пауку вам нужно бисера перед деплоить мы еще не запрещаем вот я бы так сказал что мы идем к этому да мы идем к запрету при это еще недоступной продакшене при этом для преданных клиентов можем открывать эти права если вы понимаете что хотите перевести в кластер is mainly in meiner то но такая опция есть не хочется выкручивать руки клиентам поэтому мы достаточно гибкий и постараемся в рот мапо мной в том числе идем на встречу клиентам только не китайцы микрофон добрый вечер спасибо за доклад большая из компания фланг мы в свое время тестировали вашу платформу была куча вопросов ну практически на все вы ответили что это было давно догадалась дрессировали мы уже все у меня просто пара вопросов осталось собираетесь ли вы делать возможность дипой одного кластера в несколько зон потому что в пластике так понимаю у вас есть возможность в разных зонах вы знаете это уже есть мы это уже сделали мы это мы это уже сделали есть возникает проблема с и т.д. потому что когда вы нужно на практике когда мы начали смотрите как себя ведет и cd таком gear сплю на дипломе тени очень хорошо поэтому большая часть кластеров она обсе в сингл зоне их можно перенести но такой герой спаленный кластер да он уже поддерживается и клиента есть выбор dehors пиленый кластер в себе и о них давайте defense здесь with a cd сам большая проблема и вопрос насчет были проблемы с 100 раджим что нестабильный нестабильная работа скорость скорость работы была стара джей и тогда обсуждали вопрос насчет квот сделали собираетесь кого ты еще нет но у нас появилась там как раз вы использовали итоге расправлены сев показы оказалась проблема нет ни тогда всплыла при этом у нас есть локальный сев у которых скорость работы лучше но и в целом и сильно затемнили сев суждений перформанса мы добавили более больше кэшируются metadata серверов и у нас хода дэш наш шеф выжимает час порядка 3 300 и чипсов создашь носитель на больше спасибо большое можно я сразу вопрос задам тоже флант меня сандре завод спасибо за доклад можете потянуть в контейнер интаймом пожалуйста у вас в начале brkt рамси до там разжился докер джокер джокер для клиентских приложений раньше вы прям bruns используйте не крио прям чистый ранцы да спасибо только хардкор кажется что все оно закончилось время до всем спасибо приходи наш стенд можем отдельной пообщаться по вашим вопросам"
}