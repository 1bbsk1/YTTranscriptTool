{
  "video_id": "qR1pr_rqbmw",
  "channel": "HighLoadChannel",
  "title": "Как пережить запуск онлайн-игры и справиться с мертвыми душами / Андрей Трифанов",
  "views": 1418,
  "duration": 3473,
  "published": "2018-08-16T04:59:18-07:00",
  "text": "я расскажу про свой опыт в геймдеве я более 10 лет запускаем онлайн игры игры в соц сетях игры для мобильных not сейчас соответственно больше труда игры для мобильных устройств делать то есть для ios и для android вот расскажу какие шишки мы набили надеюсь что вам это будет интересно интересно узнать и соответственно что-то примените в своей работе так ну мы рассмотрим во-первых му графики производительность чего на них стоит бояться вообще потом поговорим о том что нагрузочный тест у нас есть как инструмент исследования производительности вот как мы его применяли вот и расскажу про момент когда у нас нагрузочный тест разошелся с данной на груше теста показывали одно а в продакшене мы получили другую ситуацию вот и соответственно что мы делали в этот момент все оказалось не так страшно смотрите мне поможет программист пётр вот смотрите вот этот программист петр у него такие большие кулаки он вот он на самом деле для моего доклада нарисовал от руки кучу слайдов и настоял на том чтобы вот слайда появились я не стал ему перечить он сильный парень вот игра онлайн игра в соцсети что это такое да вот но вот как это вообще видно да вот это мы браузере да мы видим там в одноклассниках или на фейсбуке вот мы сидим в соцсети там обычно есть раздел игр и мы соответственно запускаем игру она как-то там вот за кулисами общается с сервером да вот и у нас появляется такая штука как сервер что общий такой сервер до сервер решает но некоторые вопросы ну вот он естественно он сохраняет прогресс игрока ну про прогресс ну в общем тоже понятно да тут мы везде где мы запускаем входим в соцсеть да мы хотим видеть свой прогресс приехали к маме у мамы за компьютером запустили соц сеть пока там мама играет с нашими там с внуками вот соцсети сидим вот играем хотим чтобы допустим в условной ферме в которую мы играем у нас были построены те же здания которые мы там видим у себя дома вот который мы видим на работе вот поэтому прогресс вот он вот-вот со всех устройств это вот там он через сервер транслируется вот так или иначе мы хотим чтобы игра с друзьями у нас было до ну то есть игра с друзьями что это мультиплеер pvp до случае соц сетей там это может быть простые сценарий мы можем заходить там вот ферме там к другому игроку что-то ему помогать делать может быть сложный сценарий мы в своих играх реализовывали в том числе и синхронная pvp когда там у нас есть ligne de france там две башни игроки одновременно запускает юнита они идут там сражаются применяются какие-то заклинания вот и потом вычисляет n времени идет вот сервер на себя берет игру с друзьями вот естественно сервер это вот проверка на честность если клиент можно хакнуть можно там простейшими там программами даже артмани попытаться там что-то сделать вот то сервером уже такая штука не проканает ну и платежи естественно платежи тоже проходит через сервер мы начисляем денежку там ну вот это сервер вот ну про технологический стек чтоб тоже было понятно то есть у нас есть пётр программировать на си плюс плюс его вот серверное приложение это linux приложение до многопоточная немного процессы на многопоточная вот она использует в качестве хранилища мускуле и соответственно обычно мы собираемся д пакетами доставляем собственно нашей новой версии сервера на продакшн сервера так вот смотрите схему сервер и нам ее пётр предоставил в центре сервера у нас вот обработчик команд вот эту вот часть да то есть там естественно у нас есть пул потоков вот в центре да у нас вот ой извините вот пул потоков пул соединений соединения спят как только по соединению прилетают данные нам поток просыпается берет state law а свободный вот обрабатывает соответственно команду которая пришла пишет или не пишет в базу данных вот и возвращает соответственно клиент какие-то данные вот у сервера есть еще но внутренний быстрый кэш есть кроны там это какие-то действия которые запускаются по таймеру вот но еще есть вот ну из того что стоит на что стоит обратить внимание есть внешне кэш в простейшем случае может быть моим кашель и там мы можем что-то из манго редис использовать что-то потяжелее но это если вы хотите и ну понимаете зачем вам это нужно вот есть еще одну система статистики система статистики тоже важная штука но она на производительность мало влияет то есть это как бы считается всегда внешняя вещью поэтому про не ем очень мало будем говорить вот а тот нас встречает маркетолог маша маша нам будет рассказывать что там соцсетях происходят вот я вот она нам перед запуском нашей игры она руководила запуском она нам рассказывать что вот-вот соцсети есть вот какое то вот огромное количество пользователей мы честно говоря не знали чего именно ожидать там разные цифры ходили говорили тома 100 тысяч их пользователей в день о миллионе пользователей в день томатом 5 10 миллионах в результате данные оказались несколько скромнее да то есть но там где-то на хороших проектах на наших было 500 до миллиона в день это то что мы видели вот они запускают игру и вот большая часть этих пользователей там зависимости от проекта там от 50 до 90 процентов они даже ни одного действия в игре не сделают вот это вот вот вот весь вот этот стек наш большой вот эти вот пользователи соответственно проходят вот начальный этап который называется этапом обучения в игре многие отваливаются на этом этапе они но игра не нравятся не то что они ожидали не нравятся art-nude то есть вот что то что то такое вот и вот ну там небольшое количество в преданных поклонников игры и соответственно тех кто нам платит деньги в результате конвертируется вот и машинам рассказала что вот реклама это тоже очень важно вот она очень похожа на попадание в каталог новых игр и вот потому что там тоже будет много пользователей но там будут подходящий пользователей да то есть вот но если вы с маркетологами общались вы знаете что на фейсбуке допустим когда вы закупаете рекламу вы говорите какую рекламу вы хотите купить то есть вы хотите купить допустим мужчин 25-40 лет которые платили в приложениях это стоит дорого и соответственно вы не хотите их потерять вы хотите чтобы вот когда идет реклама у вас все было вот прям вот хорошо ну то есть нельзя облажаться никак нельзя это живые деньги это пользователи которые теряются вот соответственно как мы готовились к первому запуску вот у нас петя что сделал он решил что во первых вот вот этот график да вот у нас есть график нагрузки не так важно что у нас по верхней шкале это могут быть количество команд это может быть тела количество соединений это в общем все все похожи на самом деле да то есть у нас вот утром народу практически не не играет днем соответственно вот там пользователя набираться так аккуратненько вечером играют максимальные вот ночью там потихонечку идут на спад вот и естественно вот пить и решил что вот вот она цель для теста вот сейчас могут протестируем вот этот верх графика то количество пользователей которые у нас из есть и в общем будем знать к чему мы готовы вообще вот купите был smart board то есть смотрите мы применяли т.д. тест реван development кто знает что такое то sdram девал тон-у-у отлично общем когда новая фича сначала пишется для нее тест потом соответственно оно реализуется на сервере и тест начинает работать но это если вот грубо а вот у нас очень отлично подходит для т.д. у петра был как раз smart бот который полностью закрывал полностью у меня общаться со всеми частями сервер он умел там вот ну там допустим для ферма условно он умел заходить в игру он умел с адресом строить здание он умел там покупать питомцев сажать морковку и так далее заходить к другим игрокам то есть он все умел делать вот и вот в принципе вот тест выглядело примерно таким образом то есть мы вот там на первой строчке заходили получали состояние игрока покупали здание да естественно проверяли что получили в ответ от сервера там окей всё классно вот проверяли состояние этого здания что общем здание которое получено у нас в результате покупки на предыдущем шаге а но вот прям хорошее правильное с теми параметрами которые мы ожидали вот соответственно дата что решил сделать вот ну если smart вот есть там и вот путем прикручивания к нему простейший стоит машины вот получаем нагрузочный тест но то есть что такое получается то есть вот там игрок заходит ну то есть smart board заходит в игру у нас до дальше он что делает он там смотрит ага я могу построить новое здание он он нет пункта бросает кубик там с десятью процентами вероятностей допустим строить новое здание там с двадцатью там сажать морковку а там еще с двадцатью заходит к другу там что-то будет делать вот но и соответственно вот такая стоит машина у нас получается там с вероятностями и со смены состояний вот и очень быстро петр за один день получил свой нагрузочный тест он вот ведь он такой ток был очень доволен вот но вот и какие задачи он себе поставил на нагрузочный тест на первый запуск да вот он конечно же хотел получить представление вот одновременно играющих пользователях да то есть это вот наверное одна из основных характеристик да сколько у нас онлайн будет там тысячи пять тысяч десять тысяч на вот на нашей конфигурации ну вот потом но соответственно по тюнить какие-то внутренние параметры посмотреть вот и вот вторым вот он считал очень важным смотрите проверить график производительности на плавность то есть если у нас есть плавный хороший график который вот при увеличении количества пользователей играющих он из тебя все еще предсказуемо плавно ведет то он с большой вероятностью будет и дальше масштабироваться плавно пока он вот тут во что-то не упрется сильное да вот то есть плавный графика это хорошо вот пётр так думалось соответственно он вот поставил одну из задач и как раз плавный график себе получить вот и вот он запустил первый раз нагрузочный тест там получились небольшие оптимизации сервера и вот на первом запуске мы мы выбрали базу данных ну то есть вот про выбор база данных я пожалуй не буду говорить потому что там стоит отдельного доклада у нас там кастомное общем схема когда мою базу данных в память положили мпф с вот решили все задачи которые там возникают это вот там backup восстановление из бекапа вот backup вариантами без прерывания собственно потока исполнении сервера вот в общем с базы данных мы решили вопрос свои на первом запуске на груше на тесто дальше становилось только лучше потому что бал данных видите у нас тут развивал архитектор нашей системы хранения данных женя вот смотрите вот такой вот суровый тут потому что любит на картинге ездить поэтому я вот поместил эту картиночку здесь вот видите тут нагрузка сервера в общем несравнимо получается загрузка базы данных вот поэтому общем но уже не слишком хорошо сделал свою работу и мы его больше не увидим в этом докладе извините для в общем пить и был доволен сервером который он получил теми графиками которые он получил и вот произошел запуск игры которые мы условно назовем версии 1 то есть 5 говорить давайте мне ваших пользователей сейчас мы зайдем в новые там все пользователи побегут к нам а мы будем себя хорошо чувствовать вот но что-то пошло не так ну вот в принципе первая версия работал достаточно хорошо вот но спустя некоторое время во первых стала видна проблема с мертвыми душами да то есть вот у нас на предыдущих слайдах вот был слайд когда вот много этих пользователей наших и там 80 процентов пользователей это собственно пользователи были первого второго уровня то есть они там больше половины в игре вообще ни одного действия не сделали а мы их хранили вот в базе и то есть вот начальное состояние которое мы соответственно создавали для пользователя то есть там несколько зданий там грядочки какие-то вот там питомцы начальные вот все это у нас висит в базе ну не то что нас это сильно расстроил но в общем если можно этого избежать и можно вопрос какими какой ценой в общем 5 себе поставил задачу вот эту штуку оптимизировать 80 процентов но плохо вот а собственно расстроена была сильно маша потому что появилось неожиданно и ограничение сервер себя хорошо чувствовал вот на новых когда там сто тысяч пользователей в день примерно добавлялось вот где-то на двухстах начинали появляться вот-вот пике вот и хотя мы все еще хорошо себя чувствовали вот по плану в общем было понятно что мы на грани то есть вот у нас вот у нас начинается расколбас есть реклама вот такая же ситуация была я вот графика нарисовал вам как только реклама включается от начинаются пики и они соответственно это уже там гладенько во графика у нас не остается вот и вот соответственно вот тепловую карту и вам показал вот обработчик команд на него основная конечно нагрузка тут легла и чуть-чуть на базу данных ну то есть база данных все еще это все еще выдерживает а вот обработчик команд по нему мы упремся скоро упремся вот нам на помощь опять приходит маша она напоминает смотрите вот у нас говорит ребят количество игроков да вот у нас по одной оси подругой прогресс игроков то есть вот эти вот восемьдесят процентов они тут остаются если они снова заходят вот они вот на этом начальном этапе крутится а у них но и и тут петю вот он понимает что у него на начальном этапе tutorial что такое tutorial это обучение и там плотность команд очень высокая вот то есть нам нам по хорошему надо вот tutorial куда-то задвинуть вот но петя что беспокоит что он в нагрузочном тесте это не увидел вот в своем первом на груз ну то есть он не увидел и он понял что вот он первый нагрузочный тест запускал вот тут вот то есть вот когда вот у нас 90 процентов старых пользователей играет немножко новых добавляется вот и соответственно он не видит не видит вот этой проблем вот этих вот там вот скачков вот и соответственно он что сделал он вот запустил тест поменяв вот эту цифру q это на самом деле один параметр стоит машины был и получил вот именно то поведение которое он увидел в продакшне и петь и сказал ура вот ну то есть мы вот те кто tdd заниматься они знают что собственно мы не начинаем ничего фиксить пока мы не воспроизвели соответствовать мы вот-вот вторым нагрузочным тестом мы воспроизвели нашу ситуацию что вот вот тут вот у нас возникли проблемы вот можно фиксить можно исправлять так вот теперь смотрите вот по времени что у нас происходит вот тут вот мы зашли соцсеть вот дальше у нас произошел логин логин получили состояние игрока дальше вот вот tutorial там вот на самом деле много команд запускается только потом запускается игра вот tutorial характеризуется тем о чем во-первых тем что тут много команд ну тут реально много команд потому что вот а кто в соцсети в игрушки играет скажите кто-нибудь играет о так мало человек играет но тогда чуть-чуть расскажу то есть там смысл в чем вот у нас есть там допустим один домик он производит ресурсы вот собрать ресурсы с домика одна команда вот обычно ресурсы накапливаются на начальном этапе пять минут вот чем дальше мы обновляем и улучшаем домик тем вот это вот время сбора она становится больше то есть там оно там 15 минут потом час потом 6 часов может быть вот то есть но если мы это время будем показывать игроку который только пришел он но он просто убежит от нас ему вы построили один домик пять минут подождите соберитесь него эти денежки нет убежит вот соответственно мы ему показываем там 15 секунд сбор он там дэш дэш кликает хорошо action вот соответственно поэтому в туториале у нас как раз количество команд на сервер отправляет сау очень большое этапе это первый момент который пейте понял второй момент который вам понял что вот вот тут вот на самом деле после tutorial все приходят к одному и тому же состоянию в таком случае не понятно зачем вот крутить сети кучу команд если мы вот на самом деле вот этот логин и состояние игрока можем перенести сюда а вот tutorial полностью реализовать силами клиента но тут в общем простое решение вот переносим сохранение за туториала 5 5 и вот такой вот летит вперед молодец вот в общем tuturial на клиенте чего нам это стоит смотрите получается что ну маленькая цена tutorial должен отправлять клиент должен отправлять систему статистики какие-то данные то есть вот за каждый шаг tutorial он говорит я прошел первый шаг 2 шаг третий шаг это вот так называемую воронку туториала создает и соответственно yo гейм-дизайнеры анализирует где у нас там в туториале отвал происходит и они с этими данными работу и мы и им этом важно поэтому нужно сохранить вот и второй момент это сохранение вот здесь вот прогресса вот отчасти это не проблема если у пользователя включены kookie cookie включены мы отлично сохраняем все локально вот как только cookies выключены что делать но нам помогает наш внешний кэш внешней кэш запись у него она очень быстро сервер не тормозит поэтому в общем записываем сквер внешней вот возвращаем по нашим прикидкам таких записей было примерно 10 процентов от всех пользователей вот это мы во внешнем кольце хранили наш оптимизатор во внешнем кольце мы хранили наше состояние пользователей у которых отключены cookies вот если пользователи большего количества начинает отключат скуки в принципе все равно то мне страшно потому что внешний кэш штука тоже очень быстро и хорошо оптимизируется в общем сохраняем и все забываем про это вот и вот единственное что вот сильно плохо мы на клиенте дублируем логику сервера но к сожалению вот это вот цена которую нам пришлось заплатить вот клиент начинает ну то есть клиент знает то есть если раньше помните вот там smart вот наш вот мы в июне тесте говорили проверить состояние здания но вот такой вот будет клиент ничего не знает про состояние зданий а знания здания клиент ничего не знает про сохранить состояние задания такое вот победили вот у нас версии 2 нашего сервера да мы разгрузили наш обработчик команд на самом деле мы мы с 4 или до как вы понимаете да мы вот проблему ты не решали мы ее вот мы поняли где она на самом деле у нас находится и мы ее убрали да вот мы ее обошли мы не неполезной на стену не стали там стену порушить мы ее обошли стена все еще остается вот и вот во внешней кэш мы там у нас уступил сюда тут нагрузка который раньше не было мы чуть-чуть по внешне кэш и складываем как раз этот прогресс игрока вот победа вот но тут к нам приходит маш основой говорит а теперь смотрите ребят есть такая штука бонус рекламы говорит мы вот когда о новых игроком парик новых игроков по рекламе зовём мы им обещаем дождитесь загрузки мы вам дадим подарок очень хороший подарок и мы действительно и водоем вот ну и тут у пейте возникают проблемы до 5 товсь с оптимизированным его вот в момент когда в tutorial заходит игрок еще ничего нет у него в базе нет записи да он же с оптимизировал да вот он у него только там малаги не в базу запишет он вот проблема вот он задумался а маша такая мечтательная она говорит о и петь а я еще хочу письма игрокам слать говорит вот смотрите вот у нас тут игроки зашли по рекламе не по рекламе вот и я хочу им письма отправить и переводить из одной категории в другую игроков письмами но это вот штука она очень похожа на ретаргетинг то есть маркетологи называют ретаргетинга madden одним из видов ретаргетинга вот штука на самом деле важно и вот ну окей маша же про деньги все про деньги поэтому петь и приходится ее пожелание исполнять прям вот ну непосредственном надо надо обязательно да это сделать вот а тут еще приходит смотрите вот такой хитрый персонаж мы про него вообще не говорили еще это наш ведущий гейм-дизайнер он вообще про него можно отдельную историю рассказывать про все его требования как он хотел изменить геймплей но в данном случае он смотрите он хочет абед с туториала проводить вот абед с туториала а у нас опять же у нас нет записи в базе данных и как абед с не можем раздать то есть у нас вот если когда мы заходим в игру у нас есть метки а бы тестов мы раздаём в бтс мы можем там разные цены показать игроку там все что угодно тестировать то что есть в игре то то тут у нас нет оба теста что делать приходится но от туториала на клиенте мы уже не откажемся слишком слишком хорошая выгода поэтому мы вот тут вот берем и ранние логин на сервер делаем то есть вот по раннему лагину мы как раз записываем все наши данные соцсети вот и раздаём оба тесты вот и вот ответ на этот ранний логин получает клиент и он может уже как раз у себя показатель один туториал другой tutorial вот дальше идет tutorial вот и и вот тут тут тут опять начинаются наши серверной команды вот отлично получилось вот у нас вот бизнес редакция версия 3 вот версия 3 нашего сервера вот опять петь победитель маша довольно она может любое количество рекламы наливать наш гейм-дизайнер мигель вот он может а вы тестировать все что угодно вот ну вот мы подошли к заключению к концу нашего доклада вот что было сделано хорошо вот на начальном этапе но мне кажется что хорошо был сделан нагрузочный тест то что мы его применили то что протестировали изначальный то что выбрали базу данных про базу данных у нас голова не болела потом вообще вот хороши быстрые итерации налог и в общем реакция на проблемы то есть вот но это наверно смесь это т.д. это la tribune development и соответственно итерации быстрой ну наверно немножко скрама да то есть у нас вот две недели это вот время спринта выливки постоянные вот и соответственно большая часть этих проблем было решено в общем она решалась очень быстро как только они были сформулированы в общем за две недели максимум за месяц там находились решения вот и вот что было хорошо но корреляция данных теста и production да вот когда у нас в какой-то момент мы увидели вот этот график на продакшене который у нас не воспроизводился на нашем тесте мы поняли в чем проблема соответственно и получили этот график вот а вот что можно было сделать лучше но пожалуй можно было вот сразу сделать адекватный нагрузочный тест пить и мог не пропускать вот этот кусок с большим количеством пользователей потому что часто кажется очевидным вот ну пожалуй так вопросы ох ты ли срок спасибо скажете вот здесь речь о гипотетической ситуации или реальном проекте это реальные проекты это то как мы запускали то есть в общей сложности запустили 10 проектов вот первые три это вот вот это вот ситуация была пенсии с этим такой вопрос а месси вы упомянули т.д. интересным концепции геймдева скажите какой процент покрытия и какие части вы не покрывают на какие не используйте tdd части системы tdd не использовалась ну то есть какие-то части были замотаны соответственно у нас в начальном варианте только кроны не были покрыты т.д. то есть потому что но было достаточно сложного ну то есть крон запускается и там стоит таймер который рандомный когда запустится крон то есть вот он запускается следующем минуту после старта сервера и плюс рандома там допустим от 10 до 30 да то есть вот и вот коран и там распределялись вот это чтобы они не все стартовали там вот 10 секунд следующей минуты до вот как-то ранда рандомный событий поэтому получал что крон очень сложно протестировать то есть там крон который допустим там чистит таблицу там рейтингов каких-нибудь но его вот прям сложно протестировать то есть нужно было писать какой-то внешней внешнее управление типа запусти крон да вот через там какую-то а фишечку вот и проверять тогда вот действие крона вот это 1 момент 2 момент но платежка была частично покрыта потому что ну там получается что это что но через мог в общем замок анны некоторые вызовы то есть где то можно допустим вот в соцсети mail.ru или в одноклассниках известен алгоритм генерации вот этого секретки и можно его проверить соответственно можно если клиент знает алгоритм генерации smart года он может его сгенерить и может отправить запрос на сервер типа пришел платеж и тогда мы можем соответственно полностью протестировать а вот на фейсбуке такого невозможно там по-другому немножко общается facebook говорит что платежка но общем платеж поступил и ну нельзя к сожалению андрей я правильно помню что ты планируешь один из докладов в своем цикле посвятить полностью системе тестирования ну если будет пожелания по этому поводу то я конечно могу это сделать да хорошо приходите к нам на митап пожалуйста спасибо за доклад у меня два вопроса вопрос первый вы упомянули то что логика туториала вы перенесли с сервера на клиент основную логику вы оставили на сервере населяли то почему но мне кажется что тот вариант который у нас был реализован он наиболее быстрый потому что клиент ну относительно тонкий получается ему сервер говорит что делать то есть клиент знает допустим сервером присылает события появилась здание с такими параметрами клиент не думает какие параметры зданию нужно вот под при это прописать вот он просто берет их был создает новое здание и вот эта структура это что мы были очень уверенны в сервере вот ну то есть ну сервер был нашей сильной стороной получается вот поэтому мы бы часть логике оставили на сервере потому что это очень быстрая разработка была вот отчасти и гибкая вот но для нас по крайней мере вот поэтому мы большую часть старались оставить на сервере ну ну проверка на честность она безусловно тоже есть но в общем не самое главное на мой взгляд то есть я бы сказал что вот причем первая версия сервера она вообще была написана на самом деле на сокете то есть такие соединения то есть там даже них и ттп запросы гуляли до и не собранный в пачке т.п. запроса именно вот socket и и когда собственная команда простая она очень просто пишется и там и там и за счет этого быстро и в развитии понятно и второй вопрос такой в ходе нагрузочного теста вы замеряли время отклика и как-то игрались с шириной канала или этого не делали это не нужно было время отклика заменяли замеряли с шириной канала не игрались нет понятно спасибо можно ни разу не вопрос а как очень технический вопрос а как было сделано интеграции си плюс плюс кода если пора ли тебя понял и ложь иной часть вот можно про этот монах 13 тега там 1 2 3 я но подожди смотри то есть у тебя есть pull a state of ты берешь вот ласты и свободный до под этим под ботоксом до их соответственно это правило state прописываешь параметры вот прокидывает штамм параметры команды соответственно передающему управление он там соответственно бизнес-логики прокручивается возвращается тебе назад и то есть никаких модных технологий полого бриджа про которые я не прав а зачем я давайте так я просто так делал пару раз и как бы их я могу там еще несколько людей может а команда говорит ну давайте немножко сахара сахара команда не права не я понимаю команды всегда ну-ка не так команда иногда право но как бы надо иногда выравнивать уровень разработки чтобы могли поддержите но все я прошу прощение спасибо за ответ площадь интерфейса между фишкой ложкой должна быть минимальная поэтому команда не должна страдать от того что так или иначе bedding сделан ну я готов это в кулуарах обсудить там есть много интересных нюансов это правда следующий вопрос вопрос касательно структуры в социальных играх когда доходит что надо ждать шесть часов несколько суток большая часть людей же уходит это играть но там смотрите какая штука получается когда доходит до 6 часов во-первых количество объектов повышается вот это первый момент на котором играют вот во вторых но у пользователя все-таки есть выбор зачастую то есть у тебя появляется допустим 20 объектов и ты можешь запустить их на час или на 12 часов и вот соответственно с этим они начинают играть то есть на 12 часов это на ночь вот они вот оставили его то у них там что-то производится на час это вот если они там вот за обедом там или к обеду запустили на обед зашли там собрали и вышли вот ну то есть вот так вот на шесть часов от неплохой цикл на самом деле ты когда с утреца пришел потом после работы пришел в обед еще посмотрел ну замечательно если у тебя ни один этот таймер на всю игру да ну то есть да таймеров просто становится больше как вы думаете изменится в дальнейшем структура социальных игр то есть монетизация перед течет в другую бога динамичную она меняется она меняется и сейчас например много многое делается на монетизации за счет рекламы то есть вот допустим еще 3-4 года назад этого не было вот сейчас на просмотре рекламы очень многие проекты делают большие деньги то есть постоянно что-то меняется при этом при сохранении микро платежей что и при этом до микроплатежи сохраняются до там и причем вот реклама она в том числе и на мобильных платформах то есть это вот это прям новый тренд она смысле уже не новый у нас наверное не конференция по маркетингу поэтому пардон спасибо за доклад а у меня вот такой вопрос по unit тестирование там я так понял и написали какого-то бота который ноет скорее тогда функциональной больше тестирование потому что тысячи тесты больше вот вопрос такой как подбирался один или несколько сценариев потому что например вот есть какие-то ряд серверных командам посадить морковку забрать морковку полить морковку построить задание ясно что если с отношением там грубо говоря один танк 1-ну равномерно запускать и промежутки между ними равномерно то получится какая-то нагрузка но она совершенно будет далекая то что который будет генерить пользователь потому что но вы сами говорите у вас дома время там увеличивается постройке зданий и там сбора морковкина я не знаю чего то есть как адекватность вот этого теста за счет чего он строится чтобы вот этот баттл вел себя вину как можно более адекватно имитировал именно реального игрока не какого-то абстрактного понят спасибо да немного кода по этому поводу было то есть например код на клиенте был который соответственно учитывал какое количество допустим здании есть по отношению к количеству морковок которые можно посадить и соответственно вот исходя из этого делал выбор то есть частота была как раз за счет это как когда количество зданий росло он начинал здание чаще тыркать соответственно и ну как показала соответственно там наши внутренние замеры мы очень часто бот оказывался в ситуации когда ему нечего было делать на своем участке то есть мы на самом деле есть вы черпали команды раньше чем в общем ну то есть он не простаивал сами вот эти сценарии это программисту так петру петру это гейм-дизайнеры давали ли вы проводили там например какие-то тесты на фокус-группах и потом с них снимали или какой-то еще 3 или программе самых придумал ну да время эвристик а это была его листика чистая от программист от программиста да ну то есть вот он посчитал гейм-дизайнер к сожалению пришел посмотрел сказал ну окей ты примерно правильно делаешь вот вот все что было в общем комментарии по правильности теста вот понятно спасибо следующий вопрос пожалуйста скажите пожалуйста вот на чем у вас написан клиент ну начальный клиент был написан на flash и соответственно потом это было flash плюс что у нас какой flash быстрый как быстро работа star elite stars подскажите господа на silverlight нет нет не silverlight это моя взыскал на быстром флэша ладно быстром флеша да ну то есть вот в какой-то момент flash стал поддерживать 3d ускорения вот за счет чего он стал поддерживать 3d ускорение нокий и соответственно последней версии были на итана и оси то есть это был одна из версий было это flash который был собран подаешь одна версия была на unity и там еще один движок был то есть вот три версии соответственно ос android она unity у вас был плагин или вы через html5 делали я просто говоря собственно к чему веду больше вопрос был secure то есть если вы раскрыли часть какой-то вот туториалы на клиенте то если вы делали допустим на html5 с джессом то выбора скрыли часть логике вот хотелось бы просто узнать если это был ваш канал 5 приложение буксировали ли вы это или нет это было не html5 приложением ну я честно говоря могу ответить в кулуарах вам на этот вопрос если интересно то ловек под индии не только через плечо можно сказать не она там ситуация такая unity вот именно если про unity говорить да то мы использовали unity на двух этапах то есть первое это был еще когда unity была вторая версия вот и у нас тогда было два клиента у нас был клиент на unity одновременный клиент на флеше то есть тогда ни у кого этого не было и компании zynga тогда в общем нас поймала даже на конференции сказал ребят вау очень круто мы вот только пробуем сделать а вы это уже сделали и правда она потом сказала что типа ребят извините мы поняли что это бесперспективно вы нам просто кучу денег сэкономили и соответственно тогда выходила третьей версии unity и мы от unity отказались в тот момент потому что на unity мы тогда слишком медленные лепили интерфейсы то есть у нас flash клиент быстро развивался и когда мы там unity клиент отстал на две недели они вот у нас можно было сразу переключиться из флэша в unity вот тогда от unity отказались а сейчас на unity но не html5 это билд на ios и билд на android вот то есть нам на unity к сожалению сказали что статистика facebook а по-моему говорит что в районе 20 процентов рекламы теряется просто за счет того что пользователь видит вот установить плагин то есть плагин не нативный до вместе с браузером идет а вот он видит эту вот кнопочку и вот как раз домохозяйки говорят ну извините и мы из-за этого как раз собственно в билд у нас не unity спасибо за доклад можете немного подробней рассказать про вот этот внешне кэш вы сказали что в туториале стоит и вы сохраняли в куках на соответственно если cookies отключены помогал внешней кэш а как вы при этом идентифицировали этого пользователя если у него cookies отключены если cookies отключены не но тут получается что это что у нас все-таки появляется запись в базе данных до 1 то есть у нас есть айди соцсети да и мы собственно и это та иди соцсети сохраняемый в основную базу его внешней кэш ну то есть и соответственно в таком случае мы ну то есть нет проблем куча извлечены на диске con логинимся соцсети получается любом случае не но он иначе не зайдёт в игру просто получается может у меня такой забавный вопрос насчет монетизации раз уж вы упомянули опробовали вы и клиентам они тебе такие вообще к это распространено это наболевшее нет не пробовали манил биточки то войне нет сервера да да сил чужие с клиентом вот он сейчас признаётся тебе ну молодая если бы я манил я бы конечно сказал я по дендритом все во все поняли не мое дело нам хорошие спасибо интересно вас как происходит то что одна игра один сервер или один сервер много играх как это обрабатывается и нужно ли вам масштабирования как в масштабы наплывы игроков сказываются на нагрузке вот распределенность система у нас есть сортирование мы можем соответственно причем совершенно разные конфигурации запускать то есть можно там в виде звездочки запускать когда собственно есть вот один центральный он отправляет на shard играть вот есть схема когда в общем ну там сложные схемы честно говоря опять же если будет интересно этому про это отдельный доклад можно сделать или да сделай сделай честно говоря ну вот надев конфетам вот чуть-чуть про это было вот в моем докладе надев конфи если помнишь там вот я как раз рисовал вот эти разные схемы там страшные вот это вот как раз про наши шарди рование было и про то как мы там прогнозировали нагрузку и пытались как раз там вот сделать систему в которой но вот то есть вот в нашей в этой системе но я думаю что где-то 10-15 тысяч онлайн вот в зависимости от игры мы можем держать на паре сервер базы данных вот а соответственно если задача стоит где-то 100 тысяч вот вот онлайн мы пытались ее как раз вот большим серверным блоком решитесь в несколько серверов и вот то есть есть поддерживается до это был практически мой вопрос продолжение а сервер вас не стоит лишь стыд full state а почему тогда вопрос не встретиться почему не стоит лишь же проще масштабировать прощай не всегда стоит лишь можно сделать то есть на какие-то сервера были стоит ли свод последние сервера которые на и оси а не стоит леса то есть там да там забрал из базы данных все что есть там обработала тапок команд записал базу данных все в сервере ничего нет сервер ну такой относительно простой прям реально существуют такие game дизайнерские какие-то задачи которые невозможно решить встретили это просто слишком сложно ее слишком муторно или что но когда все начиналось там какой момент был например если стоит full сервер то вот вот пришел пока команд я применил в памяти пришел еще пок пок команд я применил в памяти а сохрани поставил раз десять минут и вот меня вот там через десять минут отца сохранилась все это есть я так таким образом уменьшая количество ну вот вот между бы да и сервером трафик ну например то есть вот это изначально ну вот по крайней мере у нас вот ну вот когда мы начальный проектировали сервер вот была такая мысль ну тут мы сказали что у нас есть но относительно мало запросов то есть у нас вот тут вот но вот мы не миллионам запрос то есть я вот когда вот там я не знаю на 100 тысячах пользователей я вполне допускаю что мы можем там в общем базу данных общем убить прям серьезно убить но хорошо в общем причина притчи причина почему вот этот человек в шлеме и уезжает и не появлялся никогда в докладе потому что сервер state full просто проблема из одного места переложена в другое но даже всегда трейдов правда ну хорошо я просто думаю ну вот pvp да вот у нас если есть pvp ребят в ковка луары пожалуйста уже уже затянулась лет следующий вопрос пожалуйста спасибо за доклад скажите пожалуйста вы знакомый тем или иным образом с кухней запуска так называемых больших онлайн игр со своим лаунчером с десктопным клиентам и если да можно буквально парочку подводных камней специфичных именно для этой области к сожалению ну экспертизы не позволяет ответить на этот вопрос то есть я пришел из десктопных игр но это было уже вот но больше десяти лет в world of tanks разрабатывали тогда еще на сишарпе сервер был в общем и лаунчер как раз которую скачивался устанавливался но к сожалению я вот тогда еще столько людей нельзя было нагнать в общем за нормальный бюджет ну и там там была боль там windows server был соответственно там но 12 лет назад плохо было ну так у меня руки кончились коллеги кто хочет еще задать вот хорошо чтобы я отобрал микрофон у предыдущего вопрошающего задаем спасибо за доклад вопрос такое если вы сделали тестирование на автоматическая на сервере так понимаю правильно покрыли а клиент клиент нет а почему там есть много больших плюшек от этого да хорошо но не могу ничего так вышло а можно я теперь задам вопрос раз такое дело вот ты говорил там программист пейте маркетолог маша да вот сисадмин зрения а вот что-то делал когда тебе приходил менеджер саша и говорил или программисту пейте что он делал программе спеть а вот ты вот в два раза больше тратишь на разработку фич и потому что ты пишешь тесты давайте этого не будешь делать давай ты отменишь то д.д. но это эта ситуация могла бы возникнуть если бы мы писали медленно но у нас собственно мы писали быстро sage извини мы опережали клиент мы постоянно поставляли снаряды для клиента никогда не вот поэтому у них тестов для клиента не было ты понял клиент немножко норон клиент медленно катился по этому и не могли писать ответ из зала почему ты да да иногда нужно вообще си плюс плюс и без тестов вообще боль и же можно но не нужно так все без тестов боль ну как я сейчас стою у меня тестов нет мне больно без тестов не работает до работает отлично там статической типизации она она она если скомпилировалось уже правильно работает если ты правильно на плюсах блин пишешь а вот налог где у тебя грёбаный tac toy pink чтобы он был здоров извините вот вообще нет то что она формально компилируется это необходимо увольнять таких программистов нахрен который пишут на плюсах так что ему нужны тесты да-да-да ну не знаю не знаю как бы вине когда система разрастается без тестов но не больно боль и тестировать тесты я смотрю тут много тесту но вообще нет ну все равно тесту нужно лучше писать быстрее на плюсах быстрей на плюсах ну и потом вот смотри тебе ответ в данном случае тест он опять же ускоряет взаимодействие между клиентом и сервером потому что клиент получает готовую фичу она вот протестирована я я знаю но он по-другому скорее это меня прости если к тебе приходят программе с клиента и говорит у тебя бак ты его сразу разворачивающий посылаешь чинить свой год банда можно же ты уже доказал все тестами в этом плане да вот вот поэтому вы очень быстро работали программисты на клиенте а от рейсы у нас как бы у нас нет рейсов но потому что мы все это в тесте уже получили палубе так но давайте еще вопросы есть охо хо рошо хо-рошо пошла по масштабированию на кластере база данных она одна машина она не масштабируется или кластером масштабируется вместе с базами данных ну в смысле что у каждого инстанса игровой механики и всего остального на кластере будет своя базы данных или они делят одну базу данных могут одну делить могут это могут каждый на своей работать но все равно предполагалось но честно говоря что если если мы это контролируем то будет звездочка то есть будет вот одна в одном базы данных которые либо какая-то формула которая определяет пользователя на один из сортов базы данных соответственно но там там какой момент возникает там вот но для нас собственно основным вопросом было если несколько сортов появляется то как глобальный рейтинг строить то есть нам вот ногу рейтинг по друзьям если друзья по разным шар дам раскидано все-таки оказались да то нужно выбирать статистики с разных серверов получается ну если есть какие-то социальные связи них надо наверное бывая отдельной базе держатели бы как то но не ну мы и понять что мы держим как бы это но просто в любом случае нам как бы получается что выборка мы отдаем часть рейтинга потом добираем часть рейтинга с другого шарда и часть рейтинга за другого шарадой так пол получается целый рейтинг то есть вот у нас это было вот ну у нас есть это была камнем преткновения но мы это решили спасибо еще по поводу пдд и сервера и клиента поскольку за я так понимаю там две разные команды работают на серве новым клиентам то сервер просто не сделает например какая то командочка посадить морковку он ее не сделает пока не замок аид клиента это по сути но тест подставляя разные параметры в эту команду посадить морковку и тебе не нужно ждать и клиент который что-то реализует чтобы тебе проверить к вообще как она работает или работает ли вообще эта фича на сервере но у нас у нас же баттон полноценный клиент получается то есть вот он поднимается по в тесте поднимается полноценный сервер и бот конектится то есть он создает соответственно соединение начинает кидать туда команда прямо как но это клиент полноценный то есть мы в общем поэтому когда клиенту отдаем все я просто вопрос не совсем понимаю то есть мы могли замок ать но у вас он ботан написано на на чем нам на лан алоа то есть прямо на lua вот и вот соответственно но клиент не написано но при этом как мы выяснили только что то есть smart вот как я понимаю это альтернативная реализация клиента это не тоже самое что на замок ать на замок от клиента это вот еще один клиент который которым управляет не человек не игрок о котором управляет программный код ну а у вас есть часть теста в которые на си плюс плюс написаны есть чисто есть чисто на си плюс плюс но они да есть подожди а дождись лишь а на каком тогда не фромборке написано это просто же религиозный вопрос интересно слушай это такая давняя история а ноги ну давай так на своем не не не там фреймворк но он он в открытом доступе лежит но он не обновлялся уже там лет семь вот когда я последний раз на него смотрел поэтому в общем вряд ли ты ни был стресс нет нет нет не все модные да нет не модная до 5 минут осталось хорошо ребята у нас и следующий доклад здесь есть помоему нету uno уно у нас все у нас программа кончилось"
}