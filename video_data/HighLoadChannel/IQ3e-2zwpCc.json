{
  "video_id": "IQ3e-2zwpCc",
  "channel": "HighLoadChannel",
  "title": "Эксплуатация голоса в Марусе. С какими проблемами мы столкнулись и при чем тут GPU / Павел Алексеев",
  "views": 527,
  "duration": 2537,
  "published": "2023-04-28T06:19:52-07:00",
  "text": "Всем привет ещё раз меня вот уже объявили я Павел Я являюсь сырье в команде Маруся Ну еще я системный администратор занимает железками и вот будет большой упор именно в железную составляющую работу сгпу Маруся Это голосовой помощник мы есть на телефонах мы есть Вид версия главное есть вот в таких вот симпатичных капсулках за лучший вопрос я отдам вот такую коробочку у Маруси Можно спросить сколько сейчас времени можно попросить поставить музыку ВКонтакте А можно спросить как трубить слон и под капотом у всего этого ГПУ и мы используем очень большое количество GPU сейчас у нас больше 1000 GPU больше чем 200 серверах Как работает ГПУ Давайте вот разберемся это такая вот платочка которая вставляется в PSI у неё есть Центральная часть Вот она абсолютно Аналогично CPU за исключением что Там попроще ядры но их тысячи то есть там 4.000 ядер А мы вот очень быстренько перемножать матрицы приумножать вектора С матрицами перемножать вектора и вот как у CPU есть своя память у неё также как бы вот гпушки тоже есть своя память ГДР мы туда можем закидывать большое количество данных напрямую она может туда закидывать какие-то данные промежуточные вычисления Для более низкого уровнях вычислений у нее свои регистры тоже также как у также у нас есть интерфейси кислот для подключения непосредственно в PSI слот для подключения видеокарта друг к другу есть Слот под питание и дополнительные кислоты под вентиляторы в принципе это всё что нужно знать о том как работает ГПУ располагается она в pcies Лате там же где располагаются у нас диски сеть это очень важно Для нас будет потом запомните это дело пушечка вот у нас что-то считает там решила что нужно отрисовать графику закидывают данные для карты считает и выводит на экран все очень просто ну чем серверная Карта отличается от обычной которую вы используете в компьютерах но первое что бросается в глаза это размер Вот Нижняя это А2 серверная видеокарта А верхние 1080 мы видим она очень большая у него есть вентиляторы дополнительное охлаждение отсюда вытекает другое верхние карты потребления 250 ватт у нижней 60 Ватт это очень важно для даб центров что еще у нас разные архитектура То есть у нас более подходящие для вычислений процессов внутри гпушки также что у нас есть отсутствие дополнительного питания у нижней это тоже очень важно мы напрямую засовываем пися и не подаем никакого больше питания и самое последнее чем Нижняя Карта отличается от верхней Это цена Тесла Т4 например в 6 раз дороже чем 1080 как мы их используем первый пункт это распознавание голоса Мы спрашиваем колоночку Маруся о которой час во-первых нам нужно сначала понять что пользователь сказал Маруся это делает колонка после этого как она по Спектру нашла что-то похожее на Маруся она начинает передавать данные это вот нас первый вот розовым подчеркнуто После этого мы пытаемся понять что говорит пользователь пользователь спросил который и мы сразу понимаем он может спросить час может спросить год может спросить месяц это вот дополнительный слой предсказания чтобы сразу максимально быстро отдать пользователю правильный ответ После этого мы должны понять когда фраза закончилась это у нас третий этап распознавания голоса если пользователь говорит Маруся включи песню и задумался нам нужно подождать чтобы он сказал название песни а не включать любую рандомную когда мы все закончили вот эти вот промежуточные этапы srm и отправляем на основной этап распознавания голоса в котором уже у нас обученные модели на видеокартах и мы переводим голос в текстовую составляющую понятную с которым мы можем работать сервисами после этого задача отправляется в общий пул вообще тут нужно сказать сделать такой вот немножко ремарочку что само распознавание голоса тоже находится в общем пуля сервис распознавания голоса приходит и спрашивают А не нужно ли мне что-то распознать ему удается Задачка он считает на гпухе и переводит матрицу и отправляет обратно после этого следующий сервис Skill смотрит пришла задача распознанным голосом нужно что-то смочить что-то почитать подбросить монетку сказать гороскоп или что-то еще вычисляется каким-то магическим образом закидывает обратно в очередь задач и после этого происходит генерация голоса и на генерации голоса У нас тоже стоят видеокарты которые соответственно также берут из Пула задачи и после этого как-то считают и выдают пользователю ответ на его вопрос который час 12 часов помимо этого большее количество видеокарт которые мы используем в продакшене у нас на обучении варке моделей у нас большая команда датсенсистов которая использует разные типы видеокарт для разных задач в больших количествах как разработчики наши работают у них есть свои сервера они говорят Мне нужно 4 сервера объединить кластер отмечается в табличке и в докер контейнерах запускают все что необходимо Например нужно какой-нибудь дополнительный софт или дополнительные библиотеки или нужно разная версия куды приносить каждый раз вручную это было бы достаточно сложно но как бы если разработчики это делают сами удобно всем соответственно у них есть мини кластер права на заливку большое количество данных им доступно два рейда Это большой рейд на HD прямо очень объёмные там десятерые пятое это там на 8 дисков например и рейд первый ssd-шками для быстрого горячих данных которые вот нужно взять быстренько посчитать положить убрать Они рисуют свои дошборды мониторы и у них есть права на реку серверов и вы наверное думаете В смысле у разработчиков права на реку серверов это вообще зачем вот за Вот вот этим кто вообще знает что это такое никого класс я вам сейчас расскажу у вас видеокарта работает а потом исчезает и влогах вы видите вот вот это это айдишник вылета карты nvideoвский 79 бас все больше никакой информации идешь смотреть документацию в документации написано что это может быть проблема из-за перегрева или может быть проблемы с видеокартой или может быть проблемы с драйвером или может быть проблемы софтом или может быть проблемы с писяем в принципе все Разбирайся никакой информации первое когда мы с этим столкнулись Мы подумали А если какой-то временной паттерн вообще происходящего может быть какие-то выгодки влияют может быть разработчики как-то запускают и вот это один сервер его вылеты видеокарта крест никакого временного паттерна мы не смогли обнаружить и что мы думаем проблемам оборудования не может же NVIDIA делать драйверы которые некорректно работают с их видеокартами или наши разработчики пишут софт который убивает видеокарты поэтому мы репутаем сервера А карточка возвращается как будто ничего и не было всё замечательно мы меняем видеокарты местами между серверами меняем видеокарты внутри сервера и проблема никогда не уходит где-то она выходит где-то она не уходит а основная сложность всего этого дела заключалась вот в чём так как у нас нет временного паттерна и видеокарты вылетают рандомно всё происходило примерно так инженер идёт меняет карты местами в сервере мы запускаем обучение и смотрим видеокарта может вылететь через час может например не вылетать неделями и мы можем решить что мы все как бы придумали менять видеокарты между серверами помогая Давайте вот их сгребать в разные места а потом через 2 недели у нас снова начинаются вылеты вот таким образом мы проработали несколько месяцев не пришли Никаким результатам пришли к разработчикам и мы говорим это вывод Вот вот конкретно вы ломаете видеокарты Давайте разбираетесь мы попытались обновить ядра драйвера коду разработчики расчехлили там какую-то ггб Трейси ли выводы и ни к чему не пришли одинаковые кот на разных машинах может выбивать карты а может не выбивать карты наверняка кто работал с видеокартами знает что есть такие синтетические разные тесты стресс-тест куда gdb ментест и подобные разные штуки и в данном конкретном случае они не работают Почему куда ГБ берет загружает 90 процентов г ddr и начинают перемножать очень большие матрицы там 2.000 на 2000 параллельно на всех картах сервере Но это происходит только на самой видеокарте помимо этого в реальном использовании разработчики используют данные с дисков пишут синхронизируют данные между серверами и как бы проблема скроется где-то ещё на синтетических тестах у нас не вылетает карты в продакшене вылетают а-а занимает Посмотрите на эту картинку как бы в дополнение к этому мы столкнулись с этим ну девай свою фаунт наши разработчики располагаются на серверах в которых две карточки сетевые 10 гигабитные либо 25 гигабитные у них большой массив дисков очень объемные диски и они думают Зачем нам такие большие объемы если мы не можем их использовать давайте мы будем синкать в 100 потоков просто в 1000 потоков разные куски данных между серверами заполнять трафик полностью сетевой диски утилизировать полку и когда они это делают пися оказывается загружен и видеокарта просто исчезают из системы Они не пишут что они вылетели они как-то рапортуют ни о чём просто не видны в системе когда нагрузка спадает видеокарта возвращаются поэтому как бы Если натолкнетесь знаете у вас что-то где-то загружено После этого мы столкнулись со следующей проблемой разработчики берут сервер с четырьмя видеокартами начинают на них обучать какие-то эпохи между эпохами синхронизироваться и вот три карты заканчиваются а карта одна уходит в себя она перестает отвечать она не валится по тайм-ауту она что-то там внутри делает перекладывает данные между участками памяти но просто не видно чуть попозже я расскажу где мы еще столкнулись с этим просто вот знаете что бывает вот такое вообще помимо семьдесят девятого есть очень много кодов вылета и это вот те коды с которыми мы встречаемся наиболее часто по ней на семьдесят девятого семьдесят Девятые годы вылетов встречаются не знаю В девяносто пяти В девяносто девяти процентов и вот оставшиеся Там пять 1%, это вот эти коды в принципе по ним всё понятно по табличке по названию это проблема там с палить не коро- некорректные мы остановкой Что с этим делаем и вот здесь вот как раз к полу бёрн и кодами МТС работают замечательно на вот этих ошибках куда мин тест берет участки памяти заполняет их заставляет процесс читать эти участки памяти а потом их удаляют и смотрят как поведет себя процесс Либо наоборот закидывают в участке памяти какие-то данные убивает процесс и закидывают новый процесс на чтение участков данных Таким образом мы можем находить участки памяти на которых у нас проблемы GPU Burn позволяет стрессе очень сильно видеокарты и находить проблемы именно физического характера Когда у нас именно не с памятью проблемы а где-то среди карты внутри например перегрев также Если вы очень сильно загружаете карту закидываете туда какие-то большие данные начинаете просто килять процессы карта может этого не выдержать и вылететь вот поэтому корректно нужно останавливать обучение в рамках тестирования всего этого дела мы проводили очень много разных вещей в том числе со стороны инженерными собирали стенд располагали видеокарты и наживу их выдергивали и смотрели как себя будет вести софт вот такой вот ошибку которая предполагается что она софтовая мы встречали По большей части именно на некорректно работающих видеокартах например мы запускали софт на мертвых заранее зная что это мёртвая видеокарта мы запускаем софт и получаем такую ошибочку поэтому встреча такую ошибку в первую очередь Посмотрите желали ваша карта а не бегите там гуглить решение там искать ошибки в коде спустя некоторое время один из наших разработчиков написал с помощью resnet замечательный софт который выбивал карты по 79 вылету Ну собственно проблемные которые были это происходило от 10 до 50 минут что очень сильно ускорило тестирование разных теорий например когда мы меняем какие-нибудь участки внутри сервера мы можем запустить софт и посмотреть Будет ли он выбиваться или нет в какой-то момент мы заменили вендора платформы мы стали понимать что у нас местами не вытягиваются питание на видеокартах и меняли именно блоки питания самого сервера также платформы и мы стали использовать платформы не только на 4 видеокарты Но и на 8 видеокарт на картинке у нас корзинки вот которых располагаются видеокарточки Тесла заметьте у них нет никакого дополнительного питания про то что я говорил они вот напрямую а также мы стали использовать инвалинки и инвалинки это вообще такая технология которая позволяет объединить несколько видеокарт в одну и работать с ней как с одной видеокартой вообще для чего это нужно это нужно в первую очередь для того что я рассказывал что PCI он медленный его используют только не лень но вы можете делать так чтобы карты общались между собой напрямую через что очень сильно ускоряет работу но у нас стали карты уходить себя на инвалидках мы привлекли видео с коллегами очень плотно общались Они разводят руками и говорят Мы не знаем мы запускаем на такую операционной системе у нас всё замечательно работает как бы а вот конкретно нашей операционной системе она не работает мы поняли что здесь нужно делать что-то более глобальное и обновились третьего ядра сразу на пятое и проблема ушла раньше мы обновляли ядра внутри третьего ядра перепрыгнув сразу на 5 но пришлось нам немножко поработать пересобирать пакеты но все внезапно стало замечательно работать После этого мы очень плотно стали общаться с вендором производящим наши платформы ребятами с NVIDIA подключили тестовую лабораторию наших разработчиков очень сильно глобально сели там раз в четвертой заниматься этой проблемой и нашли несколько разных участков которыми вот я с вами поделюсь во-первых мы прошли BIOS на некоторых платформах и карта стали работать лучше именно на платформах нужно уточнение сделать есть параметры Он позволяет устройство в pcies неиспользуемые данные конкретный момент как бы выключать и не опрашивать их когда непосредственно нужно начинать прогревать оборудование и видеокарточки не очень хорошо с этим работают поэтому мой совет отключайте Обновили ядро на 5 и полечили кучу проблем и вылетов то есть мы сначала в тестовой среде для обучения поменяли на пятое ядро У нас очень много проблем решилась и мы перенесли это впрот и в проде Тоже замечательно все решилось соответственно Обновили на последние свежих драйвера еще кучу проблем ушло именно вот с пятым ядром и персистент мод это вот включается параметр виде СМИ минус pm1 Он позволяет не инициализировать карту на каких-то командах тоже расскажу про это вообще видео СМИ выглядит вот так У нас есть карты у нас есть нагрузка У нас есть нагрузка на память у нас есть температура вот основные ключевые параметры но эта команда очень плохая Каждый раз когда вы запускаете эту команду происходит инициализация карт заново это не быстрый процесс как бы это напряжный для видеокарт процесс поэтому персистан мод позволяет не инициализировать карты а запускать мониторинги сразу вот в таком виде минус L позволяет посмотреть что вообще у нас видеокарточки есть в каких слотах С какими айтишниками не нужно смотреть на вывод на температуру и прочее можно сразу посмотреть видеокарты можно задавать конкретные параметры Вот например наши мониторинге на утилизацию памяти на утилизацию видеокарты и на перегрев можно просто вот чиселке получать ничего не инициализируя Вот как-то вот через вывод NVIDIA СМИ минус Q После этого у нас снова вернулась проблема с перегревом карточки стали вылетать тут еще нужно сказать Вот что наша видеокарта которая там Тесла вроде работают замечательно они потребляют 60 Там 70 75 ватт Но более мощная видеокарта типа V100 потребляют 250 У нас 4 или 8 видеокарточки в сервере 8 видео 2 киловатта Это только видеокарты сам сервер тоже потребляет напряжение А вот стойка особенно у дата-центров которых мы арендуем место у них стойки от 7 до 9 киловатт стойки 42 Юнита сервера с видеокартами 4 Юнита соответственно сколько мы можем разместить серверов немного там 3-4-2 сервера и у нас очень много места пропадает что вообще с этим можно делать можно смириться и просто платить за место стойки которые мы не используем а можно строить свои дата-центры и там размещать стойки добавлять дополнительное питание как-то Но это дорого и долго можно подумать сторону охлаждения и немножечко других альтернативных вариантов с использованием питания мы это сделали мы стали охлаждать жидкостью такие вот карты Таким образом мы смогли употребление настойки вывести до 20-22 киловатт и утилизировать стойкое место более плотненько вот собственно Вот так это выглядит внутри сервера у нас охлаждение происходит водой такое количество потребления на охлаждение воздуха мы вытянуть никак не могли а вот супер вот так вот сделали вот так вот она стоечки все выглядит все замечательно Мы охлаждаем у нас больше нет проблем с перегревом но нет у нас но проблемы с вылетами карточки которые вылетали у нас там перестали вылетать карточки которые не вылетали начали вылетать это очень странно мы стали разбираться и здесь вот очень сильно пригодился выхлоп NVIDIA с Mini Moscow Также можно там про метаем например смотреть в принципе те самые параметры берет и рисуем графики у нас начался перегрев на некоторых серверах причем сервера в одной стойке например могли выдавать очень сильно разные цифры видеокарты капризный 80 градусов и они все уже не выдавайте не знаю Вам видно или нет На вот термоусадочках на жёлтых вот спереди если посмотреть есть такие вот утопления от элементов это что очень хорошо прижата вот эта вот система с охлаждением к видеокарте А вот на серых их нет термоусадках и соответственно у нас проходит здесь теплый воздух и видеокарточка грелась и у нас десант инженеров направился к серверам разбирал мазал заново видеокартой меняли термоусадочки возвращали и чудесным образом видеокарта стала работать на 40 градусов как сейчас вообще с этим живем потому что не очень хорошо сейчас можно получить мы используем видеокарты в контейнерах раньше мы использовали видеокарты следующим образом каждый процесс мог бы свои задачи запускать на видеокартах Он берет задачу запускает на видеокарте и отпускает И мы жили в парадигме что На одном сервере живет один сервис но не всегда ему нужно такое количество видеокарт засунув сервисы внутрь контейнеров прокинув в России видеокарты это делается просто несколько строчек можно вот очень сильно уплотнять работу на сервере кубер и также мы Тестируем разные варианты других альтернативных видеокарт есть очень интересные результаты пока не очень готовы делиться Но вот запускаем смотрим мои рекомендации посмотрим какой код вылета у видеокарты в Warlock Messenger обновляем по возможности ставим свежие драйвера ядра куду смотрим Все ли хорошо у нас видеокартой в целом смотрим вывод NVIDIA с Mi минус Q Для более полноценного дибага проблем не загружаем сервер помните там рассказывал не запускаем 100 потоков ничего там не загружаем все эти не загружаем карты Выключаем spm персистент и облегчение мониторингов и ваши видеокарточки будут работать замечательно на этом мой доклад окончен Всем спасибо за внимание готов поотвечать на ваши вопросики так поднимайте руки задавать вопросы Да пожалуйста давайте справа начнем серый футболки Я не очень хорошо вижу тут Да он светит За стойкой так я правильно понимаю не загружать сервер то есть надо следить за тем чтобы там не было сто процентов загрузки поставить просто не париться вообще по поводу этого если спускать все вот именно столько сколько нужно там в один поток там вот этого всего считать то в принципе никаких проблем нет вот проблемы начинаются когда вот вы начинаете прям вот очень сильно загружать прямо вот через чур вот диски диски в сотку это всё как бы видеокарты исчезают ясно Так пожалуйста Спасибо за доклад у меня такой вопрос Скажите пожалуйста на каком идея или платформе Вы писали под свои задачи и какой это был язык еще раз можно интересует платформа и язык на тему писали свои специфические задачи под видеокартой специфические задачи именно Продакшен который или для поиска проблемы чтобы у вас видеокарта как бы какие-то вычисления выполняли да побольше если мы питон используем это какие библиотеки то для питона Я не занимаюсь имэлем Поэтому чтобы не соврать не очень хочу вот вам вот именно врать поэтому Можете написать мне на почту и если интересно я спрошу своих разработчиков и отвечу Вам именно такие библиотеки То есть это ряд предполагает какая-то прослойка между скажем кодовой базы то что видеокарта работает и получается питон уже ну как бы поверх него пишется Ну вот разработчики используют откуда для неё пишут вот какие-то программы которые там как-то вот умножают матрицы по каким-то определенным вещам готовит к модели мы эти Модели там выкатываем в продакшн и там тоже код питончики как-то вот Их используют магическим образом и получает на выходе то что нужно Спасибо так понимаете руки у нас например есть призы отличные за лучший вопрос так давайте у кого микрофон Вставайте вот последний Павел Спасибо за доклад очень интересно немножко что-то умерло внутри от 79 ошибки когда вы упомянули Вопрос такой вы рассматривали какие-нибудь опции для того чтобы давать вашим дата-сантистам gpu-ресурсы не напрямую А через какую-нибудь вещь вроде кьюб или другие подобные какие-то системы именно для автоматизации разворачивания там докер-контейнеров с дата санклодом на вот каком-то пуле машин или это что-то самописное смотрите у нас очень достаточно такой либеральный подходству наверное не знаю как у многих других но я вот считаю что так если разработчики что-то говорят что им нужно мы идём и делаем для них конкретно мы не рассматриваем возможности там что-то каким-то там предлагать у нас там был один раз мы пришли к ним Говори давайте вы начнёте хоровод использовать они взяли потестировали хоровод сказали ну мы вот лучше руками сейчас напишем как бы у нас все лучше чем хоровод работает вот сейчас они там заезжают в клубе тоже там какие-то прослоечки свои пишут А если им что-то нужно мы им доносим а так они как бы сами вольны делать там замечательные специалисты сами знают лучше меня понятно То есть пока что это что-то плюс-минус своё ни какой-то один известных Ну я так понимаю у нас очень много своего Спасибо большое Мне кажется здесь программисты могут перезагружать сервак то в целом вопрос в отделение ресурсов Мы сначала сами перезагружали просто от количества вылетов мы устали и вот как бы дали ему такую ручку сами репутаете Там смотрите сами следите Все правильно делегирование Так пожалуйста Спасибо большое за доклад такой вопрос экономическую образность насилование видеокарты то есть что с точки зрения именно денег мы нагружаем видеокарту до отказа и она у нас вылетает но мы полностью утилизируем ресурсы Либо мы ее чуть-чуть не догружаем и она живет чуточку больше или больше совсем живет очень вопрос а для того чтобы на него ответить нужно понимать Для каких задач мы это используем для того чтобы работать в продакшене конечно нагружать видеокарточку Так что она там вылетает наверное не очень хочется поэтому у нас задачи выполняют конкретные там какие-то цели на конкретной видеокарте если мы говорим про обучение то наверное Конечно мы хотим загружать там по максимуму на 100 чтобы как можно быстрее посчитать Но процесс обучения не долгий он как бы вот то есть долгий он может быть там день может быть неделя там разработчики приходят там говорят Мы там типа неделю будем запускать пожалуйста нас ничего не трогайте и не перезагружайте поэтому вы случайно лучше загружать на 100%, Да дополнил вопрос в случае обучения когда вот процесс идёт долго неделю например да если он вылетит в середине где-нибудь то вот это время она может потрачено впустую вот как вы с этим вот боретесь никак но в первую очередь мы боролись с тем чтобы найти проблему Ну и вот нахождение проблем у нас заняло несколько лет чтобы вот конкретно вот решить все наши проблемы с этими вылетами это вот конечно в первую очередь Что нужно сделать как бы не городить какие-то велосипеды чтобы жить с этим видеокартами а именно чинить их но так как это заняло много лет пришлось городить какие-то велосипеды обрабатывать некорректные видеокарты например просто на Живую вправить конфиге чтобы не использовать эту видеокарту хорошо спасибо большое Мне кажется за этого вопроса можно сделать исследование отдельный доклад вот там парень первый Да да мы просто Давайте немножко в левую сторону переместимся сбалансируем наш залпова вопросам ответом третий ряд молодой человек черный футболке Добрый день Спасибо доклад такой вопрос на начальном слайде вы указывали что вас общей очереди для синтеза и распознавания то есть вас монореппо для инференса или вы используете какой-нибудь фреймворк Это для скидулингач на GPU То есть как у вас решено у нас в целом есть вот сначала мы использовали потом мы очень были недовольны обитыми перешли на редис стримы мы записываем туда общие задачи и дальше Вот есть специальные сервис который может раскидывать понимать что кому нужно закинуть кому нужно забрать сервисы сами идут и как бы забирают этот у нас общая точка которую подключены практически все наши сервисы которые идут и говорят Мне бы поделать что-нибудь и берут задач вопрос сразу вот эти вот сервис который разгребают это там тензор или это что-то самописное на куде Ну тут опять тоже смотря на каком участке Я так понимаю что у нас и самописные есть и вот мне кажется у нас в разных участках по-разному используются Тут нужно еще вот что сказать мне очень сложно отвечать на некоторые вопросы потому что я сам не занимаюсь разработкой сервисов Я занимаюсь эксплуатацией сервисов доноса допродакшена серверами и прочими и знаю примерно знаешь вот так вот ну как оно работает в целом как оно внутри Мне будет сложно сказать если прямо вот хочешь какой-то Вот конкретно получить ответ прямо вот можешь написать на почту Я обязательно отвечу Спасибо да Или подойти на стенд может быть да Так ладно еще вопросы поднимать руки первый ряд Так ты запоминаешь Да какой там лучше пойдем Михайлов в одном из слайдов И упомянули что у вас была тесная коллаборация с вендором и неизвестно ли вам если какая-то информация вот об этом кейсе Может быть рак или какой-то мануал или еще что-то вот связанное с этими ошибками как на ресурсе вендора или вы пока являетесь уникальным обладателем вот этого опыта и никто кроме вас там как бы этого не знает только вы можете этим поделиться то есть вендер как-то отразил вот всю проблему у себя или нет блин очень крутой вопрос понравился и он сразу напомнил мне о том что я забыл сказать презентации тоже очень важно как бы интересно сказать отличие видеокарта серверных от консьермерских если Вы придете К NVIDIA и скажите я вот запускаю обучение на 1080 у меня видеокарточка вылетает с таким кодом таким трейсом А что вообще мне делать они ответят использовать серверные видеокарты для обучения и закроют тренд возвращаясь к этому вопросу насколько я знаю они никак не отображали мы решали это вот напрямую как бы с людьми в том числе что люди приезжали к нам в этот центр Мы прям вот смотрели вместе с ними У нас есть тестовая лаборатория которая прямо вот разбирала вместе с ними прошивали смотрели вот именно вот со стороны сервера Возможно они там какие-то патчики внутри к себе утащили они вот предоставили нам BIOS прошитый поэтому Возможно они как-то это сделали Но вот я не знаю насколько они это афишировали наверное никак Так ладно давайте вот третий ряд человек или Давайте там Справа справа Да вот справа все рыб футболки еще раз второй вопрос да У тебя второй вопрос Когда в плане эксплуатации в докладе у вас рассказывалось про карты NVIDIA А как же альтернативный так скажем разработчики допустим видео сейчас Intel Выходит вы их вообще рассматриваете или только работать с одним блендером Да я вот на слайде предпоследнем по моему сказал что мы Тестируем разные альтернативные варианты с видеокартами разные видео карточки от разных виндаров и у нас есть какие-то результаты просто мы не готовы ими делиться рассказывать больше части у нас как бы стоит NVIDIA но у нас в том числе и карты есть просто NVIDIA у всех на слуху и как бы вот мы как бы готовы этим поделиться Что у нас там помимо NVIDIA мы наверное не очень готовы поделиться но они есть мы Тестируем разные варианты тогда что можно задавать вопросы в чат у нас как раз я сегодня вопрос из чата давай прочитаю А каким образом заменив воздух на водянку можно снизить потребление мощности видяхами без смены розетки Все очень просто у нас есть кулеры которые потребляют очень много питания и нам не нужно тратить питание на то чтобы вот раскручивать вот эти вот вентиляторы там два три и соответственно мы вот снижаем таким образом питание Когда у нас очень много серверов именно как вообще устроено охлаждение У нас есть холодный коридор есть горячий коридор посередине стоит сервера из Холодного коридора втягивают воздух охлаждают и горячей сзади выдают горячий коридор холодные коридоры там воздух подается здесь у нас заглушечки все как бы очень просто когда простые работают вообще нет никаких проблем когда начинают работать видеокарточки там 8 штук сервере мы уже мы можем нормально Вот вытягивать вот это вот нам нужно повышать мощности они не бесконечные и вот на это тоже требуется потребление питание мы не можем это все вытянуть Сколько потребляет кулер не могу сказать могу сказать что карточка там вот потребляет 250 и вот объем вот стойки вот 79 киловатт Так ладно Окей давайте у кого микрофон Давайте так есть кого-нибудь вот по центру мало человек у нас еще есть Спасибо за доклад Можно два вопроса Первый Почему именно водой охлаждать а второй если статистика между типами карты по надежности по поводу второго вопроса у нас слабо есть какие-то там результаты которые там вылетали карты и прочее мы наверное не можем сказать что вот конкретно вот эти карты работают более надежно я могу сказать что более надежно продавать центровские карты работают в центре если Как восстановить дата центр Там 10828 они будут очень надежны работать вот ну как бы сравнивать именно дата центровские карты я не могу там сказать что более надежно Если сравнивать именно консилерские карты и серверные карты тут однозначно можно сказать что серверные карты для работы центра работают лучше и меньше вылетают с ними меньше проблем первый можете Напомнить Почему именно водой охлаждать Да почему именно охлаждаем водой Ну как бы чем можно еще вот у нас есть воздух который антифризы Ну да это вот как бы тоже в ту сторону как бы у нас ребята смотрели тестовую лаборатории они привлекли специалистов совместно с ними разработали Решение вот для нас собрали вот тестовый варианты мы посмотрели поигрались нам понравилось мы заказали у них большую партию они приехали помогли Нам всё это восстановить сделать и результат в принципе получили замечательные мы там в том числе смотрели у них а-а варианты где вот именно прямо вот в воду кладётся оборудование очень зрелищно выглядит спасибо Так ладно думаю что еще один вопрос мы успеваем мало Человек слева Ага есть вопрос да давайте два вопроса Окей спасибо за доклад вот хотел уточнить по поводу того что видеокарты вылетали там не хватало количество линий PCI или пропускной способности очень много разных вариантов у нас нет там Серебряной пули которая позволяет нам типа Вот однозначно сказать что мы сделали вот это карты перестали вылетать я вот ждал именно такого вопроса мы вот это вот последовательность действий которые я рассказывал презентации мы какие-то вот участки потихоньку помаленьку исправляли и боролись с вылетами в каких для каких-то конкретных случаев помогло Вот это для каких-то конкретных случаев помогло вот это а для каких-то конкретных случаев могло Вот это просто есть же поддержка определённого количества линий Ну и процессора соответственно там видеокарта например жрёт это 16 по-моему да по умолчанию но можно X4 работать если я не буду снижение учитывается при конфигурации сервера просто чтобы максимальное число потребляемых линий не выходило за пределы того сколько это может система обработать в целом она хорошо вырабатывает он ты делал просто для продуктовых задач которые мы работаем в том числе для обучения Все работает замечательно проблем нет проблема вот именно начинаются когда ты начинаешь просто утилизировать больше чем ты можешь только тогда начинаются проблемы в целом всё замечательно работает да ещё не 3:0 наверное да наверное да спасибо Так ладно давайте последний вопрос молодой человек вот слева в черной рубашке Паша ты вспоминай лучше Добрый день спасибо за доклад но собственно меня вопрос достаточно простой получается что сервис не было обкатан да так как проблемы начались уже на рельсах когда он был продуктивней как бы работал и Ну как так вообще произошло то есть не было какого-то нагрузочного тестирования или что нагрузочное тестирование себя представляла в тестовую лаборатории синтетический тесты когда Ты запускаешь видеокарты на синтетических тестах Как я рассказывал ты проблем не Наблюдаешь лаборатории запускает ГПУ Burn смотрят видеокарта живая на ней можно работать все замечательно выдаёт в рот вроде она вот вылетает Нет я имею в виду сервисы которые действительно сейчас работают реальности уже были готовы просто под нагрузочным тестированием количество запросов пользователей и так далее а целиком системы Да ну как бы мы такое тоже производили и в принципе оно выдавала результаты по большей части такие что тоже ничего не вылетают вылеты происходили достаточно Рандомные Вот нагрузочным тестированием именно под прям конкретно тестированием вылетов По большей части не было но тут нужно сделать уточнение что у нас коллеги из юлы совместно с тестовой лаборатории подготовили стенды на которых скармливали большое количество картинок символы нужно обучение как бы понять что вот ну как бы на Маркете вот есть там например Это тапки какие-нибудь да Или халат Вот они закидывали вот эти вот картинки начинали считать картинки показали тестовые лаборатории как это всё считать и тестового лаборатории начала проверять видеокарточки на таком оборудовании и неплохо начал ловить вылеты вот тут нужно понимать Какие конкретно тестовые нагрузки вот эти вот ты делаешь когда мы просто наливали трафика для сервисов которые берут какую-то задачу читают на видеокарте там возвращают ответ мы не ловили проблем мы ловим проблемы именно на обучение по большей части я понял то есть вот насколько время в миллион запросов в секунду он не падал да Когда именно ты не нагружаешь вот то что спрашивал как бы целесообразность Когда ты не используешь много-много ресурсов когда ты просто берешь хочешь там картик даешь задачи берёшь задачу как бы ты всё равно не можешь вывалиться за лимит который тебе ну карточка будет возвращаться хоть и там тысячу пользователей навалишь какой-то там 3.000 пользователей они просто в очереди будут стоять Вот и поэтому мы не ловим а-а проблемы это просто поведение такой же продавая вот просто они в очереди скапливаются но когда ты на обучение считаешь ты как бы не идёшь вот так вот ты просто берёшь вот эту охапку и засовываешь видеокарту И вот тогда проблемы возникают как бы вот Спасибо но обучение соответственно не прот да то есть ну обучение это вот как бы обучение а прод этой инференции"
}