{
  "video_id": "ubiZV0B1KtU",
  "channel": "HighLoadChannel",
  "title": "Место row level security в высоконагруженном проекте / Александр Токарев (DataArt)",
  "views": 536,
  "duration": 2557,
  "published": "2019-05-14T14:58:59-07:00",
  "text": "всем привет меня за а до я в компании dataart занимаюсь вопросами связь в базу данных с архитектурой приложений все что около это во первых не очень приятно что вы пришли на мой доклад потому что в принципе возможно не пришел для него сам есть должно быть 2 офигенных доклада как ребята сделали из чего-то непонятного биллинг и как создать кайло трудность поэтому все вам спасибо так поехали сегодня мы будем разговаривать о роли вел security вообще что это такое зачем нам нужна безопасность на уровне строк в нашем приложении как есть подходы я расскажу про наш случай и какими все вынесли уроки казалось бы все это очень важно но на самом деле это все полная ерунда и нафиг никому не надо проблема роллы вел security в базах данных состоит в том что они окутаны абсолютно непредсказуемым наборов мифов слухов имеющих мало отношения к фактам что такое роллы вел security это в первую очередь контроль данных на уровне строк а не на уровне конкретных объектов как-то таблички в ухе что угодно в теории он должен облегчать разработку приложений за счет централизацию управления security и это позволяет делать то что программисты часть программистов пишет бизнес-логику другая часть занимается выполнением задач связи и безопасности в принципе например у нас направить отдельная когда и security есть группа их можно параллели с чего вообще всё это началось у нас было классно и веселое приложение в котором были очень сложные 3 безопасны показывать пользователям только свои данные мы отодвинули на какие-то далекие сроки это сложнейшую задачу стали пилить бизнес функционал нашего заказчика очень много офисов по всему миру поэтому внезапно пришёл джуди pr который привел к аудиту нашего приложения на джипе or соответствия это были из-за европейских офисов и одновременно мне решили что раз уж есть аудит как бы при pr на дачу делать аудит по сокс как результат у нас была обнаружена куча дыру в безопасности связанных с доступом поэтому нам срочно понадобилось пилить security какие были у нас требования нам требовалось минимально изменять приложение потому что очень рисково нам делая security нельзя было испортить производительность и необходимо было обеспечить ту самую централизацию о которой я уже говорил потому что одним из требований аудита как бы и являлось наличие отдельные как бы должность security офицер все приложения которые так или иначе работают с нашим базам данных должны быть под эти security почему то есть кажется что как бы в идеальном случае я серы приложение все ходит через него я вчера был на прекрасном докладе коллега завита даже они говорят иногда приходится нашей микро сервисной архитектуре и дать прямой доступ к базе данных другим командам ну и соответственно как всегда все должно быть сделано быстро ключевая проблема на состояла в том что все у нас делается на яве и нашей доблестной команды вести сказала а мы не будем ничего менять в яви как хотите так и выкручиваетесь рисково поэтому было принято решение использовать встроенный в oracle средства контроля безопасности на уровне строк birch он правит дтп с какие вообще есть варианты расположения rolls and security это само собой сервер приложение это сервер базы и некие смешанные гибриды что касается плетень сервером мы можем либо менять все запросы на уровне доу дополняя их нашими security предикатами мы можем протащить все нужные данные на сервер приложений и применить безопасность там плюсы и минусы понятно когда мы делаем все руками и фильтруем все очень быстро очень удобно но так как это делается руками обязательно в каком нить из классов кто-нибудь что-нибудь забудет когда мы фильтруем данной это тоже хорошо почему потому что есть полно фреймворков безопаснее джанга security spring security и в них очень много чего сделано но из-за этого очень увеличивать трафик между серверами и такие требовательные задачу как поиск по edjing они начинают тормозить сервер базы данных мы можем сделать безопасность на верхах сделать опять хранимых процедур воспользоваться встроенной роллы security когда мы делаю все хорошо все очень быстро но это все хорошо и здорово когда у нас очень простые правила безопасной потому что иначе нам придётся менять опять таки да у переписывать хранимой процедуры да всё классно быстро но это уже типа не модная роллы security plus и много мифов минусы много биф никто ничего не понимает ну и всякие смешанные варианты до их бесчисленное количество множество их перечислять все бесполезные самое простое берем просто раскидываем наших клиентов по базам данных исходя из этого можно сделать выводы плюс-минус каждых решений сервер приложений классно пишем безопасность на языке высокого уровня плохо что мы должны гарантировать что доступ идет только через веру приложений сервер базы данных все классно все быстро минус слишком много мифов смесь эти решения не обычно самые классные самые штабе раны самые быстрые ну из-за этого их сложно ожидаемо сделать я все время упоминаю мифы что это за мифы это плохая производительность это сложность реализации это возможности взлома нет взаимодействия с пользователем интерфейсом есть только в старых-старых унылых интер праздных базах данных ну и конечно же это все старое gender проситься только для съемки посмотрим на нашу архитектуры приложения казалось быть тоскливо enterprise немножко оракла немного in-memory грибов и что-то считается навесе что-то считается на своих серверах но есть бизнес просто смотрю систем от заказчиках которые в ряде случаев входит в нашу базу данных но гораздо более хуже то что есть целый пласт report снеговых систем у нас есть отчетность на и цели на локере на табло и конечно же у заказчики из виртуальное хранилище данных тип к которые тоже ходит в нашу базу данных все правила безопасности должны быть едины для любого приложения так как мы находимся в архитектуре крупную энтерпрайза когда нам что-то подключиться мы даже об этом не узнаю какие у нас существуют варианты доступа пользователь может смотреть свои данные пользователь может пошарить данные с кем угодно он может использовать какие осели листы access control когда его если какой-то разрешено список организаций чего угодно вообще их очень много их реально сейчас 20 может сейчас уже больше в чем еще проблемы нашей архитектуры кроме хаотичного набора как бы программных продуктов которые подключаются то что вся информация где находится безопасность она еще распределена вся безопасность сама она находится в другой базе данных это вообще не раковый базы данных а маппинге для всей системы безопасен находится active directory у нас есть около 300 тысяч правил безопасности который находится в security базе данных и все рулится active directory ролями на одного пользователя количество ролей может доходить до 300 штук обычно где-то 120 такой самый простой как бы пользователь давайте посмотрим как работает в виде у нас есть такое понятие контекст и такие в или сторож где мы будем хранить всякие значения чтобы высчитать нашу безопасность security объект это то что мы будем защищать он защищается через так называемый предикат предикат это то что база данных автоматически запишет без вашего участия в ваш любой sql-оператор его надо где-то сделать для этого мы используем ее полюсе функции ведь единственный кусочек в нашей системе которой написано при детской вся остальная бизнес логика у нас на серверах приложений и сама соответственно полюсе это тот слой метод данных который склеивает эти все объекты воедино как это работает с точки судьбы д у нас есть пользователь от него идёт какой-нибудь запрос любой запрос проверяется на наличие политик безопасности если они есть то вступать действуйте самые полисе функции формат который вычитывать наш предикат безопасный идет о и брать запроса ну а дальше все как всегда планировка доступ данным поехали создавать политику делаем контекст делаем контексте и говорим что и в этот контекст мы возьмем в него и поместим из нашего пользователя базы данных мы запишем в отдай узор там будет лежать наш пользователь active directory сделаем полисе функцию она говорит о чем мы возьмем значение из контекста и применим его для нашего пользователя то есть таким образом мы реализуем и предикат безопасности что пользователь видит только его записи проверим его запустим наш пакет и сделал выборку из нашей функции именно вот это условие будет дописана автоматически су бдк каждому вашему запросу этой таблице свяжем это воедино мы скажем создали таблице заказов мы используем функцию генерации предикаты и применять мы и будем только к операторам select здесь могут быть любые оператор апдейт insert делить ну что ж смотрим берем делаем просто select мы не вызываем ничего ничего нету и это очень крут когда за домом и шлэк заходит вашу базу данных смотрит там ничего нету мы вызываем security пакеты и мы уже видим наши нужные данные если мы посмотрим флан выполняет запрос мы видим что вот тот самый security предикат который мы тестировали который мы проверяли но при этом для конечного приложения запросы не меняются логика безопасности полностью отделена от бизнес-логики мы можем посмотреть и почему же не возвращается ничего когда не вызванный security пакет просто потому что вы имя пользователя передается знал это была самая простая политика рассмотрим политику основан на access control листах все access control list и нас собираются на основе совокупность информации они собираются на основе набора active directory групп потому что active directory группа они имеют определенную сигнатуру которая позволяет смочить их с той самой security базой данных и на основе их мы gedirem ян или экзист предиката есть вот примеры реальных как бы из продакшена security предикат когда тип подразделения у нас либо депозитарии либо архивное подразделение либо какой нибудь филиала или вот такой как бы access предикат когда когда надо делать какие мы чуть-чуть остановимся позже этот опрос пока что мы можем с джойане то есть прям от этих критиков мы можем делать join и мы можем делать просто что угодно обратите внимание есть некая разница между роковым под весом как у оракла сделано security оракла это дина по большому счету это динамикой мы формируем строчку упа сброса который мы вернемся ближе к концу security предикаты компилируются и это мне в нём нравится больше итак вы помните что мы упоминали список neff трехдверные приложения двухдверные и сашин юзеров это то что мы вытаскивали из пользователю базы данных но мы можем вытаскивать это и sqlite один tefal клонидин tefal это такая штука который может быть установлены сервером приложение снаружи при подключении то есть как это мы используем когда у нас вынимается connect из connection pool а на яве мы просто говоришь поставка на вот такой-то gitify катаре передаем нам туда имя active directory пользователя и все подали его получили нужную фильтрацию подали того которого нету ничего не вернули то есть минимальное изменение приложения то основная концепция подойдем от я бы вот табло до которая ходит нашу систему мы просто говорим что надо подать переменную таблоид а встроенный 3d до в которой хранится active directory users и надо подать его тот самый security контекст то же самое в джаве вся security делается тремя строчками кода так что все мифы начинают помаленьку разрушаться все было классно и хорошо мы пока этого не было как только мы это все сделали разработчики перестали видеть все данные тебе и перестали видеть все данные потому что ворог ли отличие от пола пирса нет понятия super user который игнорирует все настройки безопасности только в приложении можно было видеть данные наступила тотальной медитацией надо было что-то с этим делать почему это происходит потому что у нас нет никаких условий мы просто всегда применяем security предикат как мы это разрулили мы разрулили это anastatia continuous integration нашего pipeline а мы добавляем некую переменную режим режим этот прав или не прав и дженкинс нам ее если прот он подменяет что если один равно 1 как случае prada то тогда мы все без любых проверок мы применяем фильтрацию и напротив злоумышленник никогда не увидеть никаких данных для девелопмента мы всегда смотрим что если security параметры заполнены это значит мы из приложений тогда надо фильтровать а если нет то просто работал как всегда и можно работать была большая боль взаимодействие с внешними системами потому что нас запрещены деби линки и вроде бы как бы плохо ходите за ворот лава active directory поэтому попросили это или команду сделать job и security базу данных нужные к папеньке стали пробрасывать к нам от active directory роли стали пробрасывать через java как наборах входных параметров как вообще с этим всем работы отложи ваться можно увидеть security предикаты в планах исполнения а можно посмотреть специальную вьюшку в которой опять таки эти предикаты видны видно политики ведь на таблице но вот уже видите на самом деле вот перед вами классический пример дыры в безопасности мы видим значение security предиката если мы знаем зачем мы идем в базу данных это может дать очень хорошие как бы понимание что происходит к этому вернемся чуть позже гораздо более трагичной ситуации когда политика сломано как я уже сказал что ворог ли безопасность это набор строк она не компилируется вносим ошибку смотрим в execution план ничего нет потому что нельзя сделать план по запросу который кривой в 5 полисе ничего нету все запросы падают с ошибкой policy приди кейт сыр что вскрылась как или делать то непонятно тяжело оракла действие исфары обычно их надо и создание инициализировать вручную случай в пиди политик с файлы создаются сами асинхронно в хаотичный момент времени обычно происходит интервал от 1 до 5 минут но они внезапно появляются и файле видно абсолютно нормальную ошибку видно полный текст так мы научились отваживать у феди соответственно нет на самом деле сложность имплементации у нас сейчас специальные дети кейт команды джазистов реально сама пишет эти политики это очень удобно это очень просто производительность когда все делаешь по мануалу получаешь серьезные проблемы поэтому у нас увеличилось количество hour парсов три раза у нас увеличилось радикальное время получения информации из connection pool а время выполнения запросов сильно уменьшилась потому что было много контекст свечей мы разработали клад план как это все пофиксить мы решили убрать проблемы с полом потом подумать можно ли как-то оптимизировать наши предикаты как побороться с карт портами и были реально дикие какие-то сумасшедшие execution планы ну немножко добавили к шее само собой и подумали что если это не поможет чё-нить возьмём иди нормализирует и так пройдемся по каждой из боли как у нас работает получение информации из active directory мы берем джаве получаем active directory их там много как ты взяли отфильтровали а потом взяли все это oracle набором бог и начинается уже как бы магия сама вот растут p&g скрылся что 80 процентов получение информации из connection pool а почему то тратилась на передачу входного параметра ну да но вроде сто-двести ролей в целом не о чем но тем не менее на тормозило и мы сделали как бы то за что наверное как бы эксперты нас проклянут но мы подумали dfx не живой вот и мы стали ходить в active directory прямо из oracal но само собой как бы мы не стали делать кастомные java class как быть подцеплять у вора криворук есть прекрасный пакет который работает очень надежно очень быстро и у нас время подключения она реально у получение информации оно в четыре раза упала давайте вспомним наш путь выполнение в пиди политики один из этих этапов я утверждаю что он иногда лишнее как вы думаете что отсюда можно выкинуть можно выкинуть секи создание security предикатов потому что иногда уже понятно какой он будет по умолчанию но это такая вещь который находится глубоко в ядре и оракла есть кэш security предикатов таким образом их не всегда надо формировать ту самую полюсе функцию ее можно не вызывать это определяется в процессе создания политики есть динамические политики это когда пользу функции вызывается каждый раз есть тактическая политика тогда когда функция вызывается разово и один предикат почитался единожды важно что вот эта вся штука она как бы в рамках навыка над connection pool у нас connection to me to life где-то порядка ста пятидесяти минуту живет как анелька нашим пули поэтому это вообще великолепно и контексте в политиках то есть как бы политика может быть настроена таким образом что она смотрит в security контекст если что то там в нем поменялось то только тогда она вызовет функцию получения предиката когда надо использовать статические политики ну как я уже сказал тогда когда предикат не меняется например в случае с пользователь фильтрации что запись должна быть видимы только тем кто создался но она же реально будет всегда таким ну и что что каждый раз в active directory users будет разной часть вы не будет меняться не когда все сделать раз забыли когда надо использовать контексте в политике тогда когда мы собираем нашу строчку с условиями на основе данных из контекста то есть в данном случае в контексте может оказаться какие другие вещи и тогда мы просто перри вызываем функцию в опере собрался все классно все здорово то есть отец если это стачек мы говорим используйте статичной политики если динамика то мы говорим использую такой контекст и смотри в такие тополя то есть уровень как бы детализацию он очень большой это нам дало где-то 10 процентов по скорости что делать с карт пар сми вот видите пользователи много то есть у нас как бы по 5 по 10 тыс пользователя работает как бы в пике одновременно в принципе как бы от не так страшно работающую технологию оракла адаптив курсор sharing и прочие умные слова но все равно это плохо как вы думаете что надо поменять в политике чтобы от этого избавиться от просто как бы не собирать ее через конкатенацию зачем что-то конкатенировать если мы можем просто написать используясь из контекст и все а тут доставай таким образом план у нас на все будет одинаковой все замечательно мы убрали 50 процентов hard парсов дикие планы выполнения почему они у нас прилистники мы подумали у нас есть большие серия давайте мы не будем их как бы помещать в какие-то таблички давайте возьмем используем memory структура палец cavalli коллекция они будут быстрые потому что in memory и не надо будет никакого диска чтобы их куда-нибудь писать но как бы есть сурово реальность реальность говорит о том что происходит переключение по или сколь контекста вся производительность полетело к чертям но самое главное что для таких структуру уроков не встань и оценить кардинально и поэтому планы были хаотично ну и все такие вещи просто тяжело добавить по этому в принципе до того как бы как местам с этим бороться это выглядел так что выбери значение из нашей коллекции то есть мы просто берем коллекцию к струнам таблицы и все поэтому сделать то что мы должны были сделать раньше мы просто все наша цель для каждого цели мы создаем временную таблицу которая как раз вызывается при вызывай нашего ты растут на самом деле вся та более которые мы как бы боялись а когда мы реальные мере ли она оказалась мизер ввода-вывода де вообще никакого нету практически планы идеально потому что работает дай на миг сэмплинг и очень четко вычисляется кардинально и есть возможность индексации и это реально очень круто и самое главное так как мы все очень ленивая то нам практически не патриот менять сами политик мы просто выпилили слова people ну есть нюансы ну можно использовать не стандарты дети тут зависит от денег вот итогам и получили порядка производительности рост производительности и в три раза но мы пошли дальше мы изобрели новое слово а селин лайнинг у нас есть два типа access control list of большие access control list и здесь большие списки по ты ищи по 2 по 3001 ников это например какие организации разрешенные там и списке доступных банков а есть какие-нибудь iv например когда пользователи можно получать доступ например и только к документам только архивам и там очень маленькие вот эти access control list и ради 2 3 5 записи городить темпа вую таблицу не но это даже не смешно поэтому тут мы и сделали что мы как раз стали собирать эти значения вот именно в такие наборы предикатов которые я говорил то есть мы их просто как бы когда вызывается процедура security пакет мы просто берем собираемых на ходу это круто почему потому что это очень быстро нет ни таблиц не заполнение в план запрос очень быстро все это считает ну и не надо думать о каких-то мы дополнительных объектов базе данных ну что плохо ну появляются те самые hard парс и от которых мы не полностью избавились ну надо разочек написать как этого секту вин заполнять но на самом деле как бы мы все равно получили еще два раза скорость выполнения и наконец мы перешли где нормализации классический пример для нормализации которые у нас было это sharing и каких-нибудь документов предположим то есть либо мы развязываем отношении м can do либо мы берем и записываем все в одну строчку разделенных запятыми все должно быть классно не надевать и джонов ничего ну и соответственно же политика стала выглядеть как вот так и лайк какая проблема этого решения ну на самом деле как бы и это тоже ну на самом деле вся боль в том что все индексы как бы летят это все бесполезно поэтому мы мун и поэтому взяли сделали полнотекстовые индексы на этом и стали использовать контент боль полнотекстовых энди 40 ли она в том что сильно падает вставка требуется какой-то и дополнительным maintain on some потому что они тут прокомментируйте де фрагментируется но самое главное в хаотично момент времени они прут могут взять и упасть тогда политика целиком отваливается с той самой ошибкой поэтому work which гармонизация абсолютно у нас не взлетела ну какое решение как бы по высокой доступности без кэширования как я уже сказал что все пользователи у нас ходят в connection pool с указанием их username поэтому все каши у нас перевернуть нас есть некие объекты у нас есть узорным кэш и вот и здесь станет ульев мы копируем необходимость вызова самой как бы и функцией подключения мы каширу им active directory группы мы кашира moze листы и кэшированных не совсем честным и их каширу им 0 орда мы их не кучером что вот такая сел лист мы как бы нет мы так ашером либо все либо ничего и вот это как раз живет в тех самых по или сколь таблицах напрямую в запросах она не участвует поэтому это нормально у нас все это управляется данными то есть любой из к шее у нас может быть включен отключен выключен для него может быть задано время x полинга почему я на этом акцентирую внимание например когда на продакшне шла эксплуатации все работало параметр по x по рингу active directory групп он менялся как бы security офицерами заказчика порядка 8 раз поэтому кэш должен быть наличие крыши должно быть согласно у нас бизнесом вас за него могут не похвалить он должен быть обязательно дайте driving с точки зрения включения выключения и времени его протекания что у нас получилось в итоге с точки зрения производительности немножко осталось карт пальцев влияние на получение коннекта стала минимальным до запросы стали медленнее где-то в некоторых запрос поразили 20 процентов но даже если мы написали бы это в гибер нити или v-pay ну просил бы она окей на 19 процентов но как бы мы от это получили подругу кучу проблем ну и контекст switch ушли все замечательно таким образом даже с этим миф можно прекрасно работать ключевая особенность любого аудита если у вас работать профессионалы они попытаются взломать вашу систему и наш случай был само собой не было из этого исключением какие существуют способы аттаки нора уловил security секьюрити прилететь из низины это как раз то о чем я говорил изначала что смотря на значение security предикатов если человеку что-то надо достать он поймет что лежит в вашей системе fife username кол что это такое когда у вас ворует имя вашего суперпользователя котором applications сервер ходит базе данных и вызывают все вашей security функций получают тот самый доступ о котором мы боялись и хитрый запрос это самое страшное как бы зная особенности реализации роллы бла security каждый в суде в каждой на реализовано по разному можно написать запрос и так что их результаты или неверное выполнения даст вам очень четкое указание что у вас лежит в базе данных вы не получите явный ответ ну вы поймете вектор к этому мы тоже вернемся и так как бороться с посмотрим критика открыт самый простой закрыть доступ к в виде полисе закрыть доступ к файлам по возможности использовать только контекст и конечно же не пытаться сделать какие-то самодельные темповой таблицы потому что к другой сессии подключиться невозможно как это вообще выглядит все в живую берем подключаемся к базе данных украденным паролем и говорим я пользователь пирса увидели данные я пользователь петрова увидели данные плохо грустно но с этим можно работать как смотрите используются классические алгоритмы мы берем и при подключении нашего пользователя мы его подписываем подписываем каким-нибудь очень надежным скрытым секретом и при вызове нашего пакета мы перед ну него само собой как бы шифру им чем-нибудь нормальным и передаем его как вызов мы передаем наш user name и передаем подпись что нам это дает вообще как выглядит эта подпись то есть вот петров : и вот наш хэш от нашего я секрета связано с именем пользователя то есть когда мы это все задаем мы получаем нужен информацию если мы дали как и ожидаемую злоумышленнику не знал что надо подать хэш или он подал хэш не тот потому что он не знает нашего секретного слова то он как всегда не получит ничего как это работает внутри работает очень просто том самом нашему пакет на методе мы просто вы паршивым имя пользователя и применяем тот же самый хеш который мы применяли на стороне приложения дальше мы берем и просто сравниваем эти хэши то есть абсолютно делаем как бы ту же самую операцию и главное что здесь делать не надо валить пользователю исключения что ты что то неправильно сделал потому что до сном лишь нику знак что надо бы где-то покопать то есть мы подписываем пустой имя пользователя именно поэтому ему возвращается пустые данные какие есть риски у этого решения в чем дара этого решения почему оно плохое что давление секретов ну можно что-нибудь придумать нас дать я покажу смотрите у вас вы взяли с таким секретом получили поработали и получили какую-то информацию а потом кто-то у вас например из лога вашего приложения пошел вас классные ластик где вы все лагер уйти и просто стащил вот эту всю строчку обычно злоумышленники очень умные он подождал следующего дня и подключился с этим же секретом к базе данных и получил всю информацию красиво просто и гениально как с этим бороться не менее просто мы берем и добавляем дату дату мы используем текущую и в нашей подписи и в нашем передаваемые параметры что это дает как это меняет ситуацию мы подаем наши пользователя наш хэш дату украли эту строку из лаги рование прошла минута мы вызываем это же самым мы ничего не меняем а данных уже нет почему мы немножко поменяли нашу вещь мы добавили время и дату про дыхание возможность запроса вытащили эту дату и что мы делаем мы берем смотрим туда ту которая пришла к нам из запроса в качестве входного параметра с текущей датой сервера все очень просто и просто отходим назад если же пользователь такому потому я щас возьму и подставлю дату то какую на дно тон его подставил но она же участвует в алгоритме хэширования и все и тут же у него опять все развалилось все очень просто и так ручные запросы возьмем mssql в mssql когда работает ролла security в начале безрогого security отрабатывает получение полей отработать в и только после отработки секции в применяется уловил security предикат и поэтому в данном запросе если у пользователя нет доступа к некому оленю то все равно выскочит exception division by zero если у него будет значение количества транзакций 1000 или если мы возьмем как бы напишем более умный кот который будет оперироваться по списку клиентов и секция в написано таким образом что она вызовет ошибку преобразование типов но в это работает как бы здорово вывел security и в таком случае мы тоже получим exception то есть таким образом мы можем весьма просто прыгнул этот такой некий доз конечно и ну обычно можно все таки вещи провернуть на базе данных я попыталась повторить эти сценарии атаки ворот ли меня не вышло но я все равно его сломала итак мы собираем статистику по таблице на которой находится предикат безопасно которые под security а дальше мы берем просто декодируем значение ну так и как бы и всё и мы берем и видим что у нас значение такого поля находится в таком в таком интервале то есть играясь как бы с декодированием гистограмм статистики и прочее мы можем получить очень четкую информацию где что лежит то есть до взломать можно но нелегко фролло был security в базах данных чудно урок лишали мир сошел себе да нет конечно же в microsoft в mssql есть ролловым security в их главной базе данных озера искал дтп с которая чиста живет в облаке тоже есть ролл его секьюрити само собой у озона amazon например amazon quick сайт тоже есть роу global security ну и само собой пост с одним из гениальных планов нашу менеджмента полу приложений является само собой перевод 42 на пол вас есть такая традиция итак давайте посмотрим как что же это приведет мы реально воспроизвели всю систему безопасности на головы security нашего приложения на пастбище мы берем включаем уролога security на таблицах то есть это вот немножко отличается и говорим создай к нам политику что о чем я говорила что политики в позы грязь и компилируемый это очень круто это очень удобно это мне очень нравится и говорю использовать тот же самый security контекста есть идеи все абсолютно одинаковых только в отличие ворота не надо делать create secure контекст бла бла сюда можно написать мама . мыло . рама все будет работать вся магия это security политики состоит в слове труп что в нем важно потому что если этого true не будет когда мы попытаемся симитировать случай что у нас идет доступ к таблице когда не про нецензированная в контекст надо будет валиться exception что контекст не инициализируем как только мы написали то у нас все стало замечательно работу на стали выдаваться пустые таблицы злоумышленники стали печалиться соответственно поставили контекст и все данные стали возвращаться в плане выполнения стало видно стали видны наши фильтр вот видите здесь в 5-ке sniffing он не сработает потому что мы тоже работаем с контекстами замечательно access control list и как я уже говорил мне в подписи очень нравятся полнотекстовые индексы поэтому мы решили не использовать подход с разделенными запятыми списком access control list of a используем нативный тип под крыса массив и построили на нем текстовый яндекс и джин индекс ну а дальше мы очень удобно написали как бы что мы берем значение нашего security контекста и просто сравним их с этим массивом реально работает просто космос поставили все фильтруется идут прекрасные индекс can и ничего не разваливается реально очень круто да ди нормализация в подписи много выигрышный но у нас как бы и кроме вот таких вещей то есть понятное дело в чем фишка ролл игла security что запрос очень много и как бы разработчики не знают запросе реально сложные и в целом то есть мы привели перформанс тестирование именно в части безопасно потому что нас все обвешана тестами причем как бы у нас могут быть обвешанный теста есть у нас например для security есть отдельный набор тестов и мы получили деградацию производительности около 15 процентов ну в общем то практически по мифам то и все какие у нас есть и недостатки роллы бла security в базе данных ой то есть достоинство то что она работает сама и это очень круто требуются минимальные изменения кода приложения вы видели буквально три строчки на яве на x цели на табло на чем угодно всех правил обезопасьте абсолютно едины если это типовые сценарии а так их очень легко прикрыть ну и главное централизацию управления до программисты пишут бизнес-логику безопасники пишут безопасность какие недостатки недостатки виден она работает сама возникают проблемы с дэ богам ну который мы в принципе плюс-минус научились бороться до сложно сила действует внешними системами требуется знание sql хотя сейчас это вроде уже не считается как бы модным невозможно взаимодействовать с пользователем интерфейсом ну и если у вас нет continuous integration конечно будет сидеть заниматься опасном но я не знаю если у вас нет continues in ты грешен для баз данных что вы сделаете здесь на конференция итак вернемся к нашим мифом у нас произошло очень интересное явление я не смог сказать что какие-то мифы у нас были отвергнуты подтверждены у нас произошло от трансформации мифов например праха я производительность у нас превратилась я бы назвал это непредсказуемую иногда бывают нюансы сложность реализации она свелась к бане назовем это к нестандартному дебага ну и конечно же легкий взлом нет он не легкий таким образом эти мифы они более менее возможны единственный подтвержденный на сто процентов миф это невозможно надеть используем трофей сам но я не уверен что это плохо когда пользователи видеть надпись на экране особенно если злоумышленник у тебя к этому нет доступа это говорит о том что где-то проверка есть и надо попытаться ее взломать что касается таких вещей что security существует только в старый базах данных и годна только для двух известных приложений как мы это доказали это полностью все разрушается и так когда мы должны это все использовать когда нам быстренько надо решить проблему тех долго когда у нас есть разные приложения которые ходят напрямую базам данных ну это должны быть довольно свежий приложение на самом деле мы думали что у нас будет все ломать от этой security почему-то ничего не ломается она действительно работает если к вам пришли серьезные аудиторы из кучи аббревиатурах это очень серьезные ребята они очень много спрашивают они смотрят ваш сервер приложений они смотрят вашу сеть они смотрят атаки они смотрят везде когда не следует связывать с урологом security если вы можете гарантировать на сто процент что кроме доступ приложений никаких вариантов нет когда у вас очень сложно микро сервисной архитектуры и серии того что один микро сервис контролирует только одну таблицу ну что тут какой-то про уловил security невозможно если у вас очень старое приложение вы боитесь его добавить если у вас высокое нагруженный вал типтип потому что все равно overheat есть думаю пора закругляться уроки думаете о безопасности заранее хотя кажется что она не нужно если у вас есть каши они всегда должны вы даёте древен вы должны возможность месяц отключать включать рулить время протекания протух они их как угодно постарайтесь де нормализовать данные все-таки не надо делать политики по 2 и 3 и 4 страница кода все должно быть очень просто если вы думаете что вашу систему никто не будет взламывать просто поверьте вы абсолютно точно ошибаетесь и даже если вы думаете что с вашей системы это не проходит час возможно если вы зашли бы влоги ваш подключений вы бы удивились до уловил security работает прекрасно в базе данных и даже это если по сброс ну собственно спасибо за внимание да а можно микрофончик в первом ряду а в чем все-таки была сложность не сложность недостаток views там было упомянуто что потому что такая проблема очень простые есть это аксессуар написано яви в гипер нить есть модельки которые привязаны к таблицам если мы берем и делаем в юху обовью и например и стоит not exist то никакой insert в эту юг не пройдет надо костыль эти instead of триггер но это же пройдет ну смотря как очень много вариантов то есть у нас бы он точно работает почти всегда и даже не обязательно ты живое слово почти ну дай бывает варианта но тем не менее на простых случаях она работой ну я сам очень сильно удивился в свое время когда случайно совершенно обнаружил ну в общем у нас то есть конкретно были проблемы да то есть мы об этом подумали потому что таки чапек сделаем сейчас все будет круто прямо вот в них вот эти в с контекстными не пошла пошла кучи нюанс то есть это не просто так это вы страну кровью спасибо спасибо за доклад и я хоть и не оркристом было очень интересно вопрос такой а вот на получается при обращении к базе данных при выполнении запроса нужно установить security контекст и указать логин текущего пользователя и получается что мы с разных мест можем установить и security контекст и как бы мы считаем что злоумышленник не знает это секретные фразы что он не может правильно таким прописать но вопрос например если используя какой-нибудь кан система отчетности например даже тот же x или напрямую лазит базу данных нам же тоже там нужно станете курить и контекст и в итоге получается что мы должны знать этот алгоритм хэширования чтобы и волостных перед запросом ну я не могу просто здесь за индеек бы раскрыть и бы все детали это решаемо направлении можете ну вот цели есть макрос и получается что в самом excel и мы должны как-то это вставить это секретное слово то есть если злоумышленник украдет xl у него будет возможность это тоже решила то есть как бы есть технологии когда как бы из секретного слова в явном виде нету ну то есть как бы это нюанс связаный с криптографией это это все решаем то есть мы решили это в табло мы решили это в экселе в слой виртуализацию хорошо ладно спасибо"
}