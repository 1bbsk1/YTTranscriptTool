{
  "video_id": "DtvjO9TYulg",
  "channel": "HighLoadChannel",
  "title": "Мир Golang глазами C++-разработчика: так ли уж плох этот наш Go? / Никита Деревянко (Яндекс Маркет)",
  "views": 647,
  "duration": 2899,
  "published": "2025-01-17T02:28:33-08:00",
  "text": "Всем привет Меня зовут Никита деревянка надеюсь хорошо слышно и я действительно расскажу вам о том как я собственно смотрел Наго глазами разработчика потому что это именно я свою перспективу буду вам рассказывать Надеюсь понравится Кто же я такой чем я вообще занимаюсь я из Яндекс Маркета там я руковожу отделом логистической платформы Ещё я люблю играть в шахматы в бильярд по-прежнему люблю программировать и изучаю японский язык для того чтобы тренировать мозги Ну и конечно же аниме в оригинале смотреть э кому я буду брать А давайте про доменную область чем нам наша Логистическая платформа вообще занимается А можно поделить её примерно на две смысловых части первая часть - это процессинг заказа про неё мы почти не будем говорить но чтобы вы понимали это как мы будем вести посылочки чтобы все контрагенты сортировочные центры склады пункт выдачи заказа знали что вот этот заказ они должны ожидать должны потом будут выдать пользователю Ну и если что-то пошло не так чтобы сработали нужные триггеры чтобы ваш заказ всё-таки попытались вам доставить а но мы будем обсуждать сегодня вторую часть логистической платформы которую мы называем логистическим ранта баймонт наверное догадаться на слайде изображён как раз чекаут то есть логистический ран тайм отличает в том числе за то какие даты доставки Какие способы доставки вы видите у себя на экране чекаут и который вы можете выбрать Наша задача там Кажется Довольно простой проверить там габариты проверить горючая жидкость ещё что-то чтобы точно можно было доставить вам и пообещать вам дату доставки в которую мы потом реально сможем привести это тоже очень важно а что же под капотом этого всего происходит под капотом у нас довольно большой логистический Граф яндексмаркет - это маркетплейс поэтому к нам подключаются партнёры различные у нас там больше полумиллиона складов а 1.000 сортировочных центров сотни тысяч пунктов выдачи заказа А ну и вы можете понимать что там просто комбинаторное перемножение Т довольно ощутимое количество путей и здесь я ещё даже не нарисовал На слайде что когда-то На заре логистики у нас всё было просто ну условно в Москву есть доставка но она либо есть либо нет в Питер либо есть доставка либо нет сейчас всё сильно сложнее Москва там поделена на какие-то полигон Вообще не факт что выпуклые и в каждом полигоне могут быть свои даты доставки которые довольно сильно различаются Ну например доставка по клику если нету рядом лавки Ну её просто не будет окей и какой же там ПС Ну миллионы пользователей заходят на яндексмаркет соответственно нам нужно на выдаче нужно на корзине показывать им верные сроки доставки и это порядка 40.000 пса Ну вот в средний день в в пиковое время что немало кто же этим всем заведует заведует всем этим сервисом мы назвали его комбинатор потому что ну по сути он что берёт он берёт части пути комбинирует из них итоговый маршрут который с одной стороны быстрый чтобы пользователь был рад с другой стороны Ну конечно же мы пытаем масима этив и для на для мап пото денеж тоже хочет зарабатывать Ну и написано Поэтому собственно про него я и буду рассказывать внимательный слушатель спросит откуда вас там особенно если он знает как там в Яндексе в Яндекс Маркете дела обстоят откуда вас У вас одни плюсы будет совершенно неправ потому что у на не одни псы у нас ещ Ja там есть ном году наш тогдашний ре вопервых нам Нура развивается нам нужно доставку изд п Монолита вытаскивать отдельно в отдельный Сервис М как же мы это будем делать Ну конечно же ещё и на экспериментальном для Яндекс Маркета языке будем писать на го потому что можем Давайте попробуем я узнал об этом а когда был в отпуске Ну давайте мы проверим вообще мы мы могли вообще начать писать Наго или нет ну в репозитории уже го был поддержан А был поддержан клиент для Иса ауруса внутри Яндекса - это просто ить Open Source сейчас он вышел Обалденная штука по сути распределённая файловая система над которой можно модс гонять и различные вычисления Те кто не в курсе прям советую посмотреть это очень крутая штука Понятно поддержка jpc в го была всегда Ну и маленькая уютная коммьюнити которая Как вы можете догадаться например сборку и клиент для ауруса собственно и написал как я уже сказал я в отпуске узнал о том что буду писать Наго до этого Наго не писал особо даже не знал что язык и вот вы видите как я лежу и довольный там читаю книжку пого что же первое что бросается в глаза ну все про это говорят много рабо так ошибок Да да да да нет классов темплейт дженериков тогда тоже не было а поэтому Ну тоже Тоже непривычно интерфейс только но сразу заметно что довольно много удобных библиотек и по сути вот какие-то mvp сервисы которые вы хотели бы написать они почти всегда могут быть написаны просто на внутренних библиотеках языка что довольно круто и моя любимая часть не знаю почему но прям близко к сердцу это то что плы Поддержи на уровне языка то что Множественные ретур это прекрасно выглядит и я на самом деле это всё теперь переиспользовать но тем не менее это прямо меня сильно радует Ну и конечно рутины каналы concurrency Просто прекрасно а про простоту библиотек Ну давайте посмотрим это вот я взял библиотеку сй Go и попытался найти сложный сложный кусок кода там ну если посмотреть он на самом деле не такой уж и сложный Вот и с чем же слайс нам сравнить Ну наверное Давайте посмотрим на библиотеку вектор А здесь я не пытался искать сложный кусок Ну это если Видно там метод Рей в векторе Ну и пару-тройку четыре-пять темплейт их параметров каких-то ещё что-то ну то есть в принципе Если приглядеться то между нижними подчёркивания можно разглядеть даже что оно делает О'кей первый нам нужно написать который считает доставку Ну перед этим нам нужно подготовить данные собственно первая задача была написать сервис который подготавливать данные нам надо было ходить по сети тут вс все библиотеки есть парсить там всякие прекрасный машал мал всё из коробки написать тестики Ну и как я уже сказал пдж для работы см уже надо тарифы доставки нам надо пункты выдачи заказов распарсить нам надо Граф Собственно сам распарсить всё это хочется обновлять параллельно Ну и как бы как бы это вообще делать Ну на самом деле в Go всё просто ты такой читаешь мануал Окей пишешь функцию которая обрабатывает источник данных пишешь перед этой перед визо функцией Go неожиданно у тебя всё работает Можно потом конечно же и нужно добавить там примитивную синхронизацию но например чтобы у вас главная рутина не закончилась после того как вы все остальные запустили и радостно ожидайте что они будут работать но по сути всё так просто вот ты так сделал и оно работает И это для меня было настоящим открытием тогда а О'кей Какие же первые тормоза и баги у нас там были Ну на самом деле они были от того что я ногой не писал поэтому там были просто валенки но благодаря тому что есть попв что мы тесты бенчмарки раскатываем всё супер Ну в качестве бенчмарка именно такого где я понял почему что-то не так Я у меня был код который на плюсах собственно читает таблицу из ит и здесь у меня был код написанный уже на Go который эту же таблицу читает он почему-то в три раза тормозил вот я убрал валенок стал абсолютно сопоставим там по-моему даже различий никаких не было Ну и ещё раз про скорость Насколько быстро же получилось написать этот сервис на самом деле mvp сервиса я написал один за три недели что очень немного с учётом того что это прямо всё вместе с разбирательством о том какие данные откуда брать как их вообще парсить как понимать что там вообще в этих данных написано а и наверное самый сложный Челлендж Здесь был объяснить коллегам что я это сделал за 3 недели потому что на синки Я прямо помню вот уже эти 3 недели прошло мы на синьке хотим договориться о том как в дальнейшем интегрировать наш ранта со смежными сервисами и они такие Ну мы не будем Наверное это планировать потому что вам ещё 3 месяца как минимум подготовку данных писать там работать с этим и мы где-то 15 минут им объясняли что мы уже за 3 недели это сделали Ребята давайте уже Договариваться потому что нам уже пора писать ранта сервис А вот и реальная проблема с которой ты на го сталкиваешься в первое время на cep некогда выйти оно компилируется моментально и это так непривычно после c+ Plus что ну это просто Другой мир Ну самое главное что за счёт этого ты супер кайфуешь от процесса поэтому тут на самом деле даже я большой любитель кофе не сильно расстраивался первые проблемы начались где-то Ну наверное 9 может 10 месяцев после того как мы уже выехали в продакшн серьёзные проблемы Вот вы видите график CPU 9 процентиль видно что он хорошо так держится на уровне 80% Для нас это плохо потому что если наш сервис лежит Или там таймаут или ещё что-то это пользователи не могут оформить заказы что явно не нравится Ни нам пользователям Откуда же ли Ноги этой штуки на самом деле Дело было в указателях указателях которые на самом деле не нужны Один из таких ярких примеров - это опциональные поля Ну вот я говорил что мы вы выкладывали таблички и их читали там есть колоночки там есть опциональные значения Ну как опционально значение по умолчание будет ну указатель на тип но внимательный зритель увидит что в принципе у нас там типы какие там всякие и 64 стринги и что-то мне подсказывает у них есть дефолтные значения например нолик или пустая строчка мы подумали переписали просто весь код на то чтобы проверять вот эти дефолтные значения чуть-чуть возможно где-то что-то усложнилась но от указателей мы избавились а этих указателей там были реально миллионы и Garbage колектор по сути просто бегал по этим миллионам указателей Хотя по факту это было абсолютно бесполезно потому что данные у нас засчитываются поколениями то есть у тебя в один момент времени либо текущие данные валидные указатели все валидные либо в какой-то момент все указатели моментально инвалиди потому что мы уже перезаливы поколение и уже надо рабо на НМ то есть GB колектор всё это время проверяет Но на самом деле ему это не надо делать но это не единственное место где были указатели указатели у нас ещё были в том как мы хранили Граф Ну очень удобно у ноды в графе есть айдини Ну что берём мап айдини в указатель на ноду всё супер То же самое с атлетами прекрасно суперски работало указатели в Go умные из коробки как я это называю поэтому никаких проблем не было до тех пор пока мы не стали упираться в то что граф уже сильно разрастается а и этих же указателей также становится очень много а как же мы будем бороться с этим ну во-первых э Здесь у нас не нужна модификация как я уже сказал То есть мы зачитывание данных и потом мы его держим уже в памяти не модифицируем и следующая модификация произойдёт когда мы заново уже другое Новое поколение пере зачитаю А и нас не устраивает Здесь всё отн указателей Ну как Мы это сделаем Ну в плюсах не знаю как какой-то мне кажется довольно Комон подход взять Зарема ть просто индексы и положить все ноды в плоский огромный список мы ровно так и сделали А что это нам усложняет понятно это чуть сложнее чтения данных нельзя просто так легко модифицировать но нам это и не надо но зато в плане использования Ну Господи Мы там пару раз оберн а как раз не дадим доступа новым разработчикам чтобы они из коробки сразу не смогли пойти и по модифицировать данные и в принципе прекрасно живём избавились от огромного количества лишних указателей к чему же это вообще приводит ну вот видно график тот же самый девяносто девятый процентиль по CPU юдж и видно что вот там несколько ступенек которые приводят нас от 80% к 40% то есть мы по сути капасити сервиса увеличили в два раза просто избавившись от лишних указателей что довольно Круто А давайте посмотрим как вообще это можно находить А я уже говорил про попв это понятно здесь Нам пригодились бы в принципе все профили они нам и пригодились А в CPU профайлеры обычно в таком месте нужно смотреть на Collection Ну вот GB background worker вот в прошлом докладе там был Flame GRA там вот вот вот характерные короче колбаски связанные с Garbage коллек мем профа полезно смотреть как каут то есть количество локаций так и объёма локаций потому что это подсвечивает зачастую разные проблемы которые могут быть О'кей мы посмотрели но тут очень важно что профили Все нужно снимать с прода настолько важно что я решил это выделить в правила хорошей оптимизации во-первых Если вы профили не продакшн Почему вообще ожидаете что на тех данных которые не характерны для вашего приложения в ранта вы получите хорошие оптимизации обычно приводит Это к тому что либо ничего не происходит Либо вы иногда Можете даже ухудшить реализацию кода поэтому обязательно делайте профиль либо с пода который был под продовольчий конечно же не стоит пытаться оптимизировать Ничего если оно работает и у вас нету вот какого-то стимула это сделать оптимизировать Ну в нашем случае Стимул был простой мы уже подбирались к 90% по CPU там начинаются тротл тайм-ауты поэтому мы теряем заказы Ну у нас не было выбора Если у вас есть выбор и вы можете поделать какую-то бизнесов фичу лучше идите делайте бизнесов фичу и не надо заморачиваться над какими-то оптимизация пока они не нужны ну и второе правило это если вы катнули уже оптимизацию вы её сделали Всё нормально выкатили В продакшн ничего не поменялось Окей Ну во-первых давайте Толи работает точно ли у на тайминги правильно снимаются е что-то и лучше это сделать один раз поверьте если у вас данные на мониторах невалидные то это совсем плохо там уже не про оптимизацию надо думать Окей эту проблему мы порешали Давайте поищем бак в коде вот у меня был ровно такой же вот прям пример я придумал оптимизацию как на 30% ускорить расчёт путей чтобы ручка Укладывала вобще Все которые на нуж изменений сделал Выка про ничего не происходит О ну приборам Мы верим попросил ребят из команды посмотреть А где валино и нашли на самом деле валино просто ивчик который в продакшн всегда входит код у меня он был написан неверно Поэтому моя оптимизация не срабатывала для самого частотного сценария в продакшене поэтому Ну профита было но и тут самое важное что Ну вот я на это ваго пофиксили написали те супер на 30% улучшения было но если вдруг вы не видите Бага и улучшения нету то пожалуйста просто реверте комит правда это это тяжело сделать но лучше так сделать И желательно ещё в трекере у вас написать я сделал Вот это это попробовал это Это к сожалению не получилось и в идеале понять почему не получилось и это тоже написать потому что просто усложнять код когда это ни к чему не приводит полезному Но это явно плохая практика Окей что же там ещ есть у нас в конечно же слайсы мне кажется Сложно представить программу в которой вот не было бы слайсов они прекрасные в них наверное когда вот ты начинаешь только программировать на легко там сесть в лужу например с тем что ну что мы делаем структур в ней слайс ко структур помои её а потом получается что посылки у нас должны ехать от склада к пользователю а едут неожиданно от пользователя к складу Ну или что-нибудь ещ такое Но на самом деле эти штуки вы отлива примерно в первые там недели может месяцы потом вы уже привыкает Окей ну слайсы можно использовать очень круто например в ме сорте или как к в поиске в глубину потому что ну их можно нарезать на под слайсы и это супе удобно О'кей у нас слайсы в коде вообще везде Ну то есть путь по графу это слайс время обработки например Когда отсортировано следующий сор центр это всё тоже лежит в слайса а поис в глубину Это я уже сказал там у нас слайсы используются Ну соответственно Давайте посмотрим насколько их много э в среднем в запросе у нас обсчитывают примерно 10.000 путей Ну потому что на вход приходит большое количество складов нам нужно посчитать все пути для них ещё для разных типов доставки Потому что от типа иногда зависит сам путь Ну и получаем примерно 10.000 путей которые нам нужно обсчитать при 100 пса это уже получается порядка 50 млн слайсов в минуту на одном инстанс просто создаётся вот здесь пример сервис тайма - это собственно то что мы храним в слайс времён обработки там duration - это время сколько это занимает время и когда начинается в чём же проблема Ну проблема конечно же не в слайса а в том что нам нужно делать локации для того чтобы все эти штуки хранить и 50 млн - это много а ещё мы получается по сути принимаем запрос пользователя вот эти все слайсы выделяем потом отдаём ответ Ну и всё нам слайс на этом моменте не нужны Всё мы их выкидываем Я думаю все сразу же подумали про то что Ну давайте за используем л мы так и сделали в Go си пол прекрасная штука Тут что надо писать просто как выделять новую новый айтем Если вдруг в пуле ничего не оказалось и джентльменский договор Ну мы обычно приходим к тому что перед тем как положить в пул надо очистить Ну вот здесь вот видно что Мыса делаем к чему же это привело Ну давайте посмотрим Нама 10.000 запросов одной из наших продакшн ручек Видно что они отработали за 3 минуты в тотале 18 миллисекунд в среднем и вот Забавно видно статистика там примерно 10 млн локаций происходит О'кей включаем пул А те же 10.000 запросов уже за 2 минуты отрабатывает за 12,5 ми секунд в среднем и а локации стало на пять порядков меньше то есть там 1.000 локаций всего лишь новых объектов что Просто будоражит ты ты думаешь такой Ну неужели так можно Да действительно в тех местах где плы вам действительно нужны вот Будут вот такие обалденные значения но всё ли так прекрасно на самом деле могут быть подводные камни с пулами Я уже молчу про то что вы можете в пул положить два раза один и тот же объект это вот отдельная история можем в дискуссионной зале по обсуждать какие факапы у нас из-за этого были давайте мы тут поговорим про очистку вот что может быть не так с очисткой вот там написано что сервис Тай А что же если там будет указатель А ну может быть Вот такое Это уже график помери и видно что мы упирается в потолок по мемори довольно стабильно там потом пользователи garb колектор просто молодец он старается пытается нас спасти спасти спасти потом пользователи приходят Я не знаю там акция ещё что-то мы падаем по ому поднимаемся заново и картина повторяется из-за чего это происходит указатель действительно есть в Серви тайме есть указатель нанду в Ну а что же тут такого на самом деле у нас есть некоторые длинные пути которые сильно длиннее чем те пути которые мы в среднем встречаем и если вероятность встретить Такой путь у нас достигает некоторого порога происходит перенасыщение за счёт чего Ну по сути мы взяли длинный путь Вот это длинный слайс заре сайли положили в пул вероятность того что его переиспользовать другой длин путо эза перет вот этих толстых слайсов внутри Пула достигает большого значения и внутри этих хвостов длинных У нас очень много указателей на старые ноды из старых поколений которые нам давным-давно уже не нужны Но они валяются в памяти они жирные и вот они вызывают это перенасыщение и мы падаем по ому как это решать Ну когда я говорил очищать надо действительно очищать То есть ресайз просто недостаточно надо делать клир Ну в данном случае вот здесь было нам хватило просто обнуления указателя собственно это мы сделали Вуаля теперь у нас там пики максимально до 60% Мери юджа всё прекрасно Ну и мы понимаем что да в плюсах деструкторы когда люди придумывали это вот неспроста было короче Они что-то знали О'кей я ещё обмолвился что у нас jpc Давайте поговорим про него Ну понятно для чего мы его выбирали мы заранее знали что довольно большая нагрузка будет плюс мы привычные были к пробу и у нас там клиенты на разных языках там к нам и JV ходит и c+ Plus запрос нам шлёт О'кей jpc прекрасно для этого подходит А что по скорости Мы в принципе смотрели бенчмарки здесь курчик как раз на сайт с бенчмарка от jpc lib и по ним в принципе видно что сервер на c+ Plus и на Go они сопоставимы по тому Какую нагрузку они держат с точки зрения concurrency на самом деле го даже лучше потому что он больше коннекшн держит но есть проблемы с хвостовым таймингами тут сразу обмолвился тоже есть э просто мы говорим про jpc потому что именно на нём мы это всё отловили библиотека обалденная документация есть там наши любимые Маршал ан маршалы кодеки и она как то что мне нравится Она развивается И постепенно добавляется и становится лучше но есть и проблемы Помните я говорил что большое количество указателей нам не нравится вот в пробном генен най структуре из пробу вот можно увидеть огромное количество указателей они берутся ровно вот на самом простом месте Ну допустим мы берём тайм Stamp структуру которая вот стандартный таймстамп внутри протокол баффера это структура там и 64 и ин 32 и если вы её добавляете вы добавляете ещё и указатель на эту структуру к себе сразу же в запрос или в ответ А это может быть проблемой как её решать Ну например можно просто дедовским способами скажем у нас там есть интервалы доставки и они там условно кратно 15 минутам Ну давайте мы просто предпочитаем Короче все эти интервалы и будем просто их потом подставлять чтобы заново не аллоцировать где-то локально это может помочь и Это неплохой подход но лучше решать это радикально и радикально это свои Маршал ан маршалы писать которые генер структур в которых будет меньше указателей и вот здесь как раз ссылка на прекрасный доклад автора библиотеки гого бба который рассказывает о том как он воевал с Марша Маршала и как проиграл поэтому послушайте реально очень интересный доклад и интересный подход мы к себе это пытались прикрутить там был Профит даже порядка 15% но к сожалению там достаточно большие приседания были внутри нашей инфраструктуры поэтому мы поняли что в моменте это Оно того не стоило А теперь переходим кстовым таймингом про что же я вообще говорил когда говорил про стое тайминги Ну вот смотрим это наша ручка с продакшена девяносто пя процентиль 50 мсн девяносто Дея уже 80 больше чем в полтора раза выше большой разброс это в целом характерно для языков у которых Garbage Collection есть а ну для в плюсах Мы обычно такое не видим Ну понятно Это может как-то зависеть от реализации но тем не менее в среднем Это скорее в плюсах нехарактерно как же такое решать для этого придумали хж реквесты Давайте обсудим что это такое А есть опять же ссылка на на описание статью как Что такое реквесты нуно давайте мы на пальцах пытаемся объяснить а нам нужно уменьшить вероятность того что мы стай аути а как это можно сделать вот у вас есть один запрос Давайте попробуем 2Т может четыре в параллель запроса отправить ВС супер вероятность таймаута уменьшится Я думаю уменьшится но не факт потому что возможно энд в которой лежит путь вашего запроса ляжет от того что вы туда x4s налили и они явно будут недовольны в любом случае поэтому Давайте как-то попробуем умнее на пальцах пример нам нужно уложиться 100 миску предположим про 100 Пятая 50 миллисекунд О'кей те же вводные нужно уменьшить количество тайм-аутов в идеале ещё и нагрузку не сильно увеличить минутка математики у нас Альфа вероятность что 1% что мы с тайм аути вся за 100 миллисекунд потому что девяносто девятый процентиль А и Бета 5% что вероятность что мы не уложимся в 50 миллисекунд - это девяносто пятый процентиль что же мы делаем делаем очень простую штуку мы запускаем первый запрос ждём отсечки девяносто пятой процентили если до этого времени ваш запрос не вернулся то мы делаем параллельный подзапрос второй и вот здесь как раз пример где первый запрос не уложился в 100 миллисекунд ему не повезло Зато второй запрос отработал где-то Ну там 45 миллисекунд поэтому мы в целом довольны Мы уложились в общий тайминг Какая же вероятность в таком подходе Ну случайные величины хоть и зависимы Но для вероятности того когда они обе не ответят нам достаточно их действительно перемножить и мы видим что в 20 раз уменьшилась вероятность таймаута А кто может сразу сказать Насколько больше нагрузка стала да-да-да Ну я слышу там ребята говорят 5% действительно 5% потому что девяносто пятый процентиль то есть мы ждём девяносто пятый процентили и только в 5% случаев у нас будет дополнительный запрос Ну кажется обалденный трейдов в 20 раз меньше тайм-аутов и всего лишь на 5% больше нагрузки О'кей переходим к конкурентности про неё нельзя не сказать когда мы говорим про го но я сильно по древу растекаться не буду а горутины для людей написаны были Вот наверное это основной тезис который я выучил когда начал писать на ГО и го прекрасен тем что когда ты пишешь многопоточный там конкурентный код то о чём ты должен беспокоиться - это о сложности многопоточного и конкурентного кода и о том как правильно выстроить архитектуру Как правильно сделать синхронизацию а не думать Извините о том как вот чтобы с кодом побороться чтобы это ещё и это сильно сложнее Ну и Давайте в качестве примера рассмотрим те же хж запросы как бы мы их реализовывали на го в общем случае А у нас здесь ретрай Count Как вы видите это переменная потому что на самом деле можно подход обобщить и не два трая делать а там три-четыре а и больше ну тут надо смотреть в зависимости от того Какой характер у вас нагрузки А ну реализация довольно простая мы делаем буфер канал на количество трав запускаем сначала первую рутину потом фриком ожида сначала либо у нас проходит время до следующего трая либо Мы уже получили ответ от одной из рутин Ну и возвращаем его ну я немножко упростил код понятное дело там нужно добавить контекст проверку на дедлайн и так далее Ну просто чтобы не загромождать и было понятно что простые концепты и Красивые такие как requ их можно просто и красиво изобразить на языке и это прекрасно Окей переводим к выводам Ну во-первых мне кажется самое большое достижение что я по-прежнему обожаю писать на Go после вот этих 3 с по лет как я начал писать mvp сервисов на го пишется просто на одном дыхании и это обалденно и для бизнеса и для вас производительность в среднем сопоставимо c+ Plus я раскрою этот тезис не спешите помидорами кидаться и бизнес логика явно пишется быстрее это супер круто Ну итоговый код простой это вот прям все признают и я думаю Вы уже заметили Окей про скорость скорость в Go хороша во всех смыслах и тут скорее про общую метрику тату Маркета Потому что когда у вас простой код разработчику даже новому просто в нём разобраться и у него остаётся просто банально больше времени на том чтобы подумать А бизнес точно ли мне принёс правильную проблему Можно ли её как-то переформулировать возможно как-то немножко урезать скоп чтобы сделать более эффективное решение и быстро его сделать и А какие алгоритмы мне за использовать например чтобы это работало максимально эффективно к чему это приводит я помните говорил Вот мы там в два раза что-то на оптимизировали там на 30% уко на 10% что-то ускорили правильно применён алгоритм может ускорить вас там в разы в 10 в 100 раз И вот отсюда на самом деле настоящая скорость идёт а не от того что мы там где-то микросекунды поэ коно на более правильно написанном ан маршале Ну и я бы сказал ещё важная часть это самосбывающееся пророчество от того что команда мотивирована делать лучше то есть сама команда видит я быстро плю код быстро получается сде новые фичи это меня мотивирует делать ещё быстрее ещё круче и писать новые фичи ещё быстрее а поэтому это прям очень крутая часть Go Ну и Давайте скучный слайд для SEO C возможно которые здесь присутствуют или в трансляции нас слушают м про найм Go я бы сказал что го прекрасный такой для нас во всяком случае точно Как пример Мидл Гранда Где можно встретить c+ Plus разработчика и Java разработчика и они там договариваются без психоаналитика это просто прекрасное место мы ровно для этого го используем потому что весь поиск у нас в Маркете написан на плюсах вся логистика написана на Джаве А мы вот как раз вот здесь на перешейке на го пишем и радуемся жизни а ну и нанимать соответственно просто потому что мы можем нанимать не только го разработчиков ещё и c+ Plus разработчиков Java разработчиков и кстати ребята я скажу а я почти никогда не слышу от человека который пишет на c+ Plus или на Джаве когда я ему говорю а попробуешь у нас на Go писать вот мне по-моему ещё особо никто не ответил что типа не мне го не нравится я не буду на нём писать все обычно такой Да я слышал Блин надо попробовать в принципе прикольно А вот Давайте переходим к итоговым выводам чему чему же Нас учат языки Ну на самом деле как и естественные языки на которых мы разговариваем каждый язык нас чему-то учит вот для меня c+ нас учит заранее думать о том что мы будем писать питон нас например учит наоборот экспериментировать и там Fail Фаст вот такие подходы аго для меня - это язык который учит фокусу на результате и ци этого результата вот всё как с человеческими языками поэтому ребята Учите языки не только программирования перенимать от них подходы для решения проблем Ну и конечно же пишите и решайте эти проблемы на ГО и главное кайфуйте от процесса Спасибо огромное буду рад вашим вопросам и голосуйте Спасибо большое за доклад я Напоминаю что для того чтобы задать вопрос Можно воспользоваться чатом зала и задать вопрос туда и я его озвучу особенно если вы смотрите нас онлайн это идеальный способ а также для того чтобы задать вопросы зал тяните высоко руку для того чтобы к Вам подошли принесли вам микрофон говорите пожалуйста в микрофон Микрофон надо держать урта и только в этом случае мы вас услышим и мы сможем ответить на ваш вопрос правда у меня сразу есть вопросы зала и вот обычно вопросы Из зала я заты тебе его просто покажу ты потом как-нибудь Разберись с этим вопросом Ладно он на японском Я не могу это прочитать Но ты потом Зайди в чатик Пожалуйста ответь ладно Ну если если коротко там написано что-то про то что раст лучше на японском мы разберёмся Давайте спасибо а теперь вопросы зала Давайте есть у нас уже человек с микрофоном нет Хорошо тогда давайте подойдём на первый ряд и выдадим микрофон Никита Спасибо раз-раз о Никита Спасибо за доклад А у меня вопрос э когда мози на c+ Plus разрабатывали использовали ли вы - сервер и Какой навык ю серверу в Go можно найти Угу да Отличный вопрос А смотри в Маркете на тот момент ещё и сервер не использовался сейчас он уже довольно активно внедряется В c+ Plus сервисах и он действительно сильно ускоряет разработку на c+ Plus это правда я бы сказал так у меня возможно радикальные меры и наверное мой там cto не сильно наверное обрадуется тому что я сейчас скажу Вот но мне кажется что подобного фреймворка на Go Я не особо У меня нет потребности в этом фреймворке Ну то есть у меня нет проблемы чтобы написать хттп сервер на Go без использования фреймворков и мне кажется это вот как раз сильная сторона го что ты просто пиш оно работает и потом ещ и просто код читать Вот это такие очень важные момент как на мой взгляд Спасибо Давайте с левой половины зала тоже дадим возможность задать вопрос Привет Спасибо за доклад вопрос на самом деле такой вы не пробовали играться с рба коллектором Сколько его можно настраивать В какой момент он будет чистить вплоть до отключить и руками вызвать Да в какие-то моменты пробовали вы это Ну поскольку сервер у вас высоко нагруженный вот а второй такой уже мини вопрос А ну тебе как плюси суу я сам плюси как тебе вообще работается с иммутабельность ними приходится костыля какому-нибудь Fast http это выглядит ужасно Угу А давай по первой части вопроса Да мы можем в принципе в дискуссионной зоне ещё это подробнее обсудить действительно мы там разные тюни ну наверное спойлер такой Если вы хотите в garb колектор прямо отключить в го ну короче надо задуматься это вот что-то что-то не совсем то хотите Возможно на плюсах надо писать сразу вот а второй вопрос там ну со строками Я лично наверное не сильно страдал возможно Давай тогда тоже в дискуссионную зону раскроешь посильнее вот что конкретно тебя больше всего вымораживает в мутабельных строчках и попробуем обсудить это супер спасибо вопрос по центру зола Привет Я Дима из озона Спасибо большое за доклад очень интересно Скажи пожалуйста вот как c+ Plus разработчик Как ты относишься к тому что в следующей версии Go анонсировали итераторы Не ну итераторы как концепт довольно удобная штука Поэтому в принципе я рад что язык расширяется и будет больше возможностей ещ проще и понятнее писать код наме те же дженерики мы пока аккуратно используем в некоторых местах где они ну обусловлены скажем какие-нибудь хитрые сортировки которые ты раньше писал там для и 32 для и 64 там своий реализации с копированием Да сейчас ты можешь переписать на дженерики и мы даже там бенчмарка ли это условно там под 10 млрд у тебя должно быть айтемов в слайс чтобы ты начинал замечать разницу между реализация Вот поэтому я думаю итераторы это круто то что их добавят и в целом Ну я надеюсь что язык будет дальше но я бы аккуратно подходил к изменениям которые вот новые приходят не прям всё заново переписывать и усложнять код Спасибо Следующий вопрос из зала Никита привет на третий раз я всё-таки представлюсь Антон Ткаченко Яндекс а два вопросика комбинатор Раньше он с нуля Наго написано раньше не было комбинатора всё так да с нуля комбинатор написа хорошо первый вопрос пропустим а второй вопрос по алгоритмам а не смотрели ли вы такую такую такой алгоритм какой-то сортировки графа в слайс чтобы более оптимально использовать локальный кэш кэш линии процессора Угу А да смотри по поводу обхода в Граф у нас там на самом деле конкретно в обходе в Граф наверное не сильно большая нагрузка на большое количество слайсов потому что мы там делаем довольно много хитрых предпо поэтому вот как раз именно сам базовый поиск который наверное кор такой скелеты пути ищет мы их так называем он довольно хорошо ЗАО Зро то есть там в принципе мы со слайсами не сильно боремся Вот но подход подходы Кстати я бы я бы послушал Вот про алгоритм про который ты рассказываешь потому что в принципе интересно потому что ага ну это унесём в дискуссионную зону Точно Вот это интересная тема надо пообщаться Мне кажется там у нас есть время на ещё один вопрос насколько я понимаю вот с правой стороны зала Привет я Яндекс такси и ты говоришь что на го всё прекрасно за 3 недели написал сервис но как обстоит дела со всякой ко генерации штуками которые идут из коробки сервере например в том же м авторизация работа с конфигами или ку ушками угу да давайте для ребят которые возможно не знают там как ю сервер устроен действительно в Ю сервере предоставляется много кода генерации например там openup спека Вам генерис Вам возможность конфигов там генерить для приложений и так далее То есть там действительно много полезных штук есть а ну с точки зрения openup спеки у нас в принципе Такой проблемы не стояло потому что мы используем jpc и он собственно код генерацию и делает для нас поэтому здесь мы как раз не страдаем совершенно по поводу конфигов это вот наверное сильная страна в принципе вот этих фреймворков то есть то есть здесь я бы согласился что Да вот с точки зрения работы с конфигами удобней а но у нас Собственно как вы можете догадаться свой велосипед написан который этим занимается Спасибо А вы знаете что я вас обманула у нас ещё 10 минут есть на вопросы поэтому продолжайте тянуть руки мы к вам подойдём Давайте из левой стороны зала дадим возможность задать вопрос раз-раз Большое спасибо за доклад Я Никита тоже из Яндекса у меня такой вопрос в c+ Plus для доступа к полю по указателю используется оператор стрелочка в Go для этого используется тоже оператор точка Как и для доступа просто к полю структуры в связи с этим может быть разные проблемы например паника при разыменования Насколько часто вы сталкиваетесь с этой проблемой и делаете ли вы для что-нибудь для того чтобы отловить эту проблему до непосредственного запуска приложения может быть какие-то кой Time проверки или что или какие-нибудь нте Да хороший вопрос по поводу паники разыменования указателей литеры есть я вот сходу наверно не вспомню название то есть которые совсем базовые какие-то вещи отлавливают а их Конечно же полезно включить а с точки зрения отлова Ну понятно там во время тестов большая часть отлавливает и тут я там по-моему на слайде про jpc говорил что там есть интерсек торы которые поддержаны в gpc либи Ну вот мы решаем такие проблемы с точки зрения чтобы мы условно весь сервис не сложился у нас если вдруг какая-то паника всё-таки произойдёт потому что вероятность такого есть а мы добавили интерцептор который jpc паники перехватывает То есть у нас в принципе если паника будет в одном из хендлеров мы Не умрём вот поэтому тут скорее ещё и и активно и проактивно надо С этим бороться Я бы наверно так сказал спасибо большое за вопрос Давайте дадим возможность задать вопрос из первого ряда Спасибо за доклад Никита Вопрос такой по пулу Я так понял писали сами Да почему не использовались пакеты какие-то бенчмарки може делали а нене не мы пол использовали это как раз использование пример использование S Pool а просто тут как раз сайд эффекты всякие с пулом возникают например Когда вы его не совсем правильно используете или когда внутрь каких-то рутин как-то неявно утекают значения и потом вы можете в пул по два раза добавить одно и тоже например это приводит к забавным Сай эффектом вот так что не мы использовали действительно он очень удобный как инструмент но довольно опасный вот поэтому надо прямо аккуратно аккуратно его внедрять и знать когда это нужно спасибо большое Если ещё вопрос в зале Давайте подойдём в ту сторону Привет Андрей из азон теха ээ такой вопрос После перехода c+ Plus осталось ли какое-то послевкусие от утиной типизации а утиной типизации Ты про интерфейс сейчас а ну я бы не сказал что особо много мы где-то огребает того что у меня почти всегда goto в редакторе по коду работает вот так как я хочу а а не огребают там какие-то большое количество темплейт параметров функции то в c+ Plus ты вот прям не факт что у тебя go-to в целом запустится короче на твоей функции которые ты там хочеш поинтс вот поэтому тут мне кажется особо больших проблем нету ну и жалоб Я особо не припомню от своих ребят Спасибо вопрос по центру зала Привет Николай сбермаркет скажи вот как реализована из готин контроль с работой с какими-то общими данными это банально МКС используется ты так сейчас уточню про какое место где где Ты синхронизацию хошь Вот вы запускаете так понимаю много рутин то есть куча параллельных процессов Вот ты пример приводил там если за 50 миллисекунд не успела одна отработать запускаете параллельно вторую то есть работа с какими-то общими данными ведётся правильно и я надо её контролировать чтобы там две горутины три там 100 не записали что-то лишнее в какие-то данные где должна быть одна запись сдела всё так у нас на самом деле в этом плане сильно проще потому что вот непосредственно сервис комбинатор он stel то есть там в баску ничего хранить не надо а поэтому в этом месте у нас то есть сильно много проблем не будет действительно если какой-то й доступ нужен до общих шаленый данных то тут не обойтись Да без там кса или там какой-нибудь атомик использовать для специальных нужд но у нас это Ну скорее очень маленькое количество ручек которые непосредственно с этим требуются то есть в основном ручки мы действительно просто условно с копией контекстов запускаем и у них всё есть своё и и куша не просит условно Спасибо ещё вопрос из зала Антон Яндекс ещ раз Вот раньше работал с плюсами и да было очень сложно с потоками работать Но насколько я знаю в семнадцатых плюсах появились зелёные потоки Ну там точно видел что джоны можно делать А вот насколько сложнее теперь работать ну сравнить Гош горутины и плюсовые зелёные труды Да я бы сказал что ну плюсы действительно развиваются и это я бы сказал хорошо Мне кажется там ты сильно много страдаешь от leg всё-таки кода в том числе Ну например в Яндексе потому что очень много бы на Псах написано ещ на старых поэтому тут зачастую не всегда можешь Там прям взять и за использовать какие-то новые технологии К сожалению без переписывания огромного пласта кода Вот но в целом Да я видел что их добавили каюсь я вот почитал немножко спеку и вот прям вот вот прям сходу ты такой Читаешь Ну вроде вроде Понятно Ну вот ну не до конца Как это работает Я думаю думаю короче попробовать хотя бы вот те же интересно написать на плюсах вот на новых насколько это будет просто выглядеть как минимум Вот это хороший вопрос Спасибо Давайте дадим слово в центре зала Добрый день вопрос скорее экзистенциальный останется ли го приятным воспоминанием в логистике или будет расширять свою сферу влияния Да хороший вопрос У меня вообще чтобы вы понимали вот в отделе ребят которые пишут на Go порядка наверное 10-15 про и оставшаяся часть всё всё пишут на Джаве А да мы в принципе какую-то лёгкую экспансию пытаемся проводить аэ потому что Ну в целом и ребята которые пишут на Джаве они довольно часто хотят что-нибудь новое попробовать какие-нибудь новые сервисы поддерживать и в принципе им Наго нравится писать поэтому тут скорее потихонечку идём чтобы например какую-то потихонечку зону ответственности на го переписать и команда которая раньше писал только на Джаве она в том числе может поддерживать Это Гош код Так что да мы в принципе масштабируется себя С положительной стороны и это в том числе наши там C замечают потому что они знают что мы довольно быстро фичи реализуем благодаря тому что ного их переписываю супер Спасибо И у нас вот теперь действительно время на последний вопрос из зала Давайте дадим слово в центре Да привет Спасибо огромное за доклад такой вопро с учётом того что большинство джави сов э не было ли мысли от миграции в сторону котлина это обычно тот путь который все выбирают а да Ну я я не могу сказать что прямо миграция в сторону котлина для жава разработчика - это какая-то прямо супер смена парадигмы там ребята как будто бы та почти что в одно и то же озеро условно заходит в ту же воду А поэтому я бы не сказал что это какая-то большая проблема всё равно Ну в нашей большой компании там много по-прежнему сервисов на Джаве их всё равно надо Будет поддерживать и вряд ли хватит времени всё это переписать поэтому тут скорее речь идёт не про то чтобы прям от джавы отказаться и пусть они пишут только на го а скорее чтобы у них была возможность и на го пописать и на Джаве пописать и развивать там сервисы и свои навыки собственно на разных языках Спасибо большое спасибо большое за вопросы помните что если вы не смогли задать вопрос Сейчас вы можете всегда пройти в дискус зону которая находится сразу слева от входа докладчик отправится туда сразу после доклада как только мы снимем с него микрофон А сейчас какой тебе вопрос понравился больше всего да было много крутых вопросов в том числе от ребят товарищей из Яндекса давайте мне наверное больше всего ближе к сердцу был экзистенциальный вопрос Будем ли мы продолжать экспансию го поэтому я бы наградил за этот вопрос Спасибо большое мы дарим вам матрёшку от конференции можно создать себе Целую коллекцию этих матрёшек они все уникальные вас Я тоже хочу поблагодарить Спасибо большое что пришли Это было очень классно мне очень понравилось Спасибо больш О отлично"
}