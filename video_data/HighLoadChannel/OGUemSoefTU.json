{
  "video_id": "OGUemSoefTU",
  "channel": "HighLoadChannel",
  "title": "Построение аналитического хранилища на 100 петабайт / Александр Мазуров (Criteo)",
  "views": 1813,
  "duration": 2939,
  "published": "2019-05-15T05:27:28-07:00",
  "text": "александр мо чик в компании crytek где занимаюсь поддержкой аналитических баз данных таких как hyip верте capristo до этого 10 лет работал в европейском центре ядерных исследований в церне жене и где занимался разработкой программы анализом данных так что если вам интересно поговорить о том как все устроено в церне лед мы текущем докладе то пожалуйста потом после доклада пообщаемся мой доклад состоит из двух частей первой части я расскажу эволюции наши аналитические платформы как компания развивалась от маленького стартапа большие компании которые оперируется с таким огромным количеством данных и второй части главные части я расскажу об инструменте которые позволяют нам справляться с таким большим объемом данных архитектуры которые мы построили а хави и первый вопрос залог то из вас слышал о компании crytek не так много ну это и ожидаемо хотя критерий является большой по меркам европы business to business технологической компании в мире рекламы у который более 30 офисов по всему миру в том числе включаю москву 6 дата-центров 600 разработчиков 200 аналитиков и с главным офисом в в центре в центре парижа основным продуктом компании является персонализированный ретаргетинг то есть мы показываем рекламу наших клиентов в посетителям сайтов и мобильных устройств используя при этом историю их действия на других сайтах например если вы заходите на на отели на на сайте booking.com а потом видеть его но этот рекламу этого отеля на вашем любимом новостном сайте это скорее всего мы если сравнивать например с google adwords мы конечно проигран под по трафику но зато мы берем за счет тун их алгоритмов быстрых отчетов и вообще хорошего user experience какие же данные мы собираем основным источником данных являются нас конечно посетители вот сайтов и мобильных устройств у нас их 1 миллиард 200 миллионов уникальных в месяц они например заходят на продукты нашего клиента этот заход мы записываем к себе или как я уже сказал посетитель заходит на их любимый новостной сайт и за и наши алгоритмы выбирают соответственно как улучшить рекламу показать и только когда они например переходит на страницу продукта мы это записываем мы не берем деньги за показом мы берем только за клики и третий момент то что мы записываем это на записан так же факт покупки продукта это тоже идет к нам в базу и затем мы соответственно реагируем все это данные все эти логии показываем предоставляем клиенту отчет о том зачем почему они и сколько не должны нам заплатить почему к сколько вырос количество посетителей они соответственно платят нам деньги мы платим publisher тем же новостным сайтам и задача к компании становится оптимизировать прибыль мы должны так написать алгоритм и чтобы остались полюсе теперь теперь вы узнали вот приблизительно чем думаю вы узнали чем занимается компания тебе перейдем к первой части расскажу о том как мы настроили нашу аналитическую платформ прежде всего давайте договоримся что в принципе функции любой компании можно сократить до 1 то есть мы на вход выдается данные и на выход мы получаем какую-то прибыль и чтобы оптимизировать прибыли мы должны соответственно быстро принять данные их обработать вытащить и также быстро полезную информацию и потом найти на основе этой информации предоставить клиентам точно отчеты на основе которых они тоже сделают выводы заплатит нам деньги то есть в нашем случае входом являются логе то есть то что я показал на предыдущем сайте на выходе понятно итак представьте 2009 год наша компания начинает как небольшой стартап имеется небольшой бюджет и как и алгоритмы соответственно который мы хотим применить что мы делаем мы берем уже готовы баннера крутилку это известное опытный с прикручиваем к ней свои алгоритмы и все просто все это записывается в майской базу данных и соответственно отчет генерируется с помощью хранимых процедур все работает хорошо до тех пор пока все начинает работать очень хорошо то есть машины и алгоритмы начинают работать к вам вас растет пользовательская база данных пользуется количество пользователей и и очевидно проблемы с от архитектуры у нас как это конкуренция ввода-вывода между у тебя лопата есть мы пишем много данных в одну базу и одновременно пытаемся читать то есть соответственно начинается большие задержки самое простое решение это была номинально разделить цепи и лап с помощью простой процедуры то есть мы записываем все в мастер базу данных а потом через какое то время кому-то расписание просто backup restore номинальным и как бы разделили но на самом деле у нас все равно остается 1 мастер база данных и у нас растет количество посетителей надо строить новый дата-центр переходить в дата-центры данное решение нас совершенно не устраивает и соответственно как и всякая развивающаяся компания мы выбрались с очевидный путь это переписать и написать собственные инхаус решения которые планируют то же самое но уже который работает на большом масштабе соответственно у нас уже появился несколько дата-центров каждом дата центре у нас есть так называемый топлива при кришна те же баннер крутилки real time bidding это собственно и все они пишут обычные syslog на наших серверах трансформация происходит с помощью опять же к наших программ написанных на сишарпе до долгое время мы сидели на которую microsoft и теперь вместо mssql используется соответственно если сервер опять же это промежуточное решение то есть мы имеем классический тел разделили вот вывод и у нас уже есть несколько the center of the что у нас есть sharding в чем же недостаток этого решение недостаток у нас соответственно в наших программах потому что для каждого нового формата мы должны написать собственный алгоритм то есть что-то изменение мы должны модифицировать эти программы и встает вопрос масштабирования то есть у нас увеличивается поток данных нам надо как-то раз параллели вот эти программы а поддержка таких раз проект программ она занимает то есть на них а тратится очень много времени мы решили что это нас не устраивает и соответственно очевидное решение которым пришли и то почему бы нам не использовать большой большой файловый сторож куда мы можем просто складывать эти лаги а потом какой-то момент то есть трансформировать их сколько нам угодно 1 тем самым заменив наши сейчас программы соответственно очевидным решением было это использовать распределенный надежный также масштабирую правило систему hdr с то есть мы туда теперь заливаем эти наши влоги и соответственно с помощью hadoop ярнам и продюсер хай в и к скотинка то есть мы заменили на 6 к с помощью инструментов которые нам доступны из коробки из для отчета мы все равно использовали с крейсера какая же еще проблема осталась здесь проблема заключалась в том что когда вы если материал syslog у нас не позволял реплицировать между несколькими серверами то есть если мы теряли оденсе ссылку сервер суп восстановить данные с рейдов то есть требовал с него время он и мышцы нашей компании что мы быстро предоставляем отчет и нашим клиентам о том что что происходит и очевидным решением которые сейчас очень популярны это конечно использование карты то есть соответственно если мы теряем дата-центры у нас проблемы но если мы теперь теряем 1к can к серверам то есть у нас нет проблем потому что они реплицируются по нескольким серверам и данное решение уже у нас работает на 6 дата-центрах на данный момент мы добавили новый формат и поверх ходу по и также стали использовать такие более быстрые чем аналитические базы данных масштабируемый как верте capristo например на данный момент мы тестируем vertica на авто уже скоро будет продакшене на один петабайт изначально это решение было создано верьте к для фейсбука но они отказались от него так что мы теперь адаптируем это у себя и так же мы рассматриваем например вместо трёх точек смотрим на яндекс если вы хотите узнать более подробно о том как устроен нас hadoop завтра в десять утра в этом же зале мой коллега будет рассказывать о том как мы мониторим hadoop инструменты которые при этом используем если кратко по цифрам то есть мы в день обрабатываем около десяти петабайт информацией все это записываем 100 петабайт на и хранилища данных скажу по секрету этажа что мы скоро открываем новый дата-центр он стана the mind то есть мы вдвоем эти цифры то есть нас будет это дает 205 ii теперь что же мы храним в этих 100 петабайт так что вы понимали прежде всего это вот старые логе которые у нас хранятся json формате но сейчас мы постепенно переходим на такой формат как парке эти логе у нас хранятся в течение 30 дней затем эти логе соответственно трансформируется в данных для наших аналитиков данные для наших разработчиков наших алгоритмов и эти данные хранятся в течение 13 месяцев законодательств словари мы можем хранить сколько угодно времени также нас выделено местом до бреста и старые данные теперь и то есть вы увидели то есть первой части моей презентации вот как компания от стартапа в 2009 году со мной майский база данных при шаг к решению которое нас полностью устраивает она мази ходу теперь я хочу поговорить инструмент который позволяет нам то есть работать с лагами из аналитиков с такими объемами данных это hyip то есть я расскажу зачем hive то есть коротка к первой решение которые мы использовали и потом я расскажу в каком какой архитектуре мы конечном итоге пришли почему какие с каким проблемы там встретились зачем же hive как я уже говорил нас были сильно наши программы и соответственно мы хотели сделать инструмент универсальный инструмент который как бы заменимых и тут нам на помощь приходит из келий интерфейс к этим данным а сколько все его знают все с ним знакомы харриса стоит к можно разделить на 2 части и то хайд астор который отвечает за хранение схемы данных и также отображение этих данных hdr с каким-то storm может использоваться отдельно то есть к примеру если вы используете просто тоже аналитическую базу данных и нам из какой может использовать обед астор как свой источник для метаданных и второе это хай в complain интерфейс или хайсер server 2 это то есть это инструмент который у нас отвечает за разбор быстро не выполнение запросов на ходу так так же как и с майской мы начинали с маленьких шагов то есть мы использовать первый толстый клиент который назывался хай силой что очевидно хорьком light интерфейс изначально у нас существует для запуска нашего ходжа баф у нас есть используйте большие сервера которые там а за ними битвы с большим объемом оперативной памяти с большим объемом дисков наши аналитики соответственно сходили на серва запускает свои программы или у нас не которому следовал за писается запускается программа они соответственно выполняют то есть тут нет какой интерес только один через com онлайн интерфейсы сообщал выполняет выполняет команды хайла и нам более меньших серов у нас соответственно располагался me to start то есть если один метр споров падал то есть переключался на 2 и в качестве бэг-энда в качестве базы данных у нас использовались использовать майской до сих пор используется майские база данных объединенная в галера кластер плюсы этого решения то что она была на для нас самым легким то есть хай села это толстый клиент не надо было ничего больше устанавливать работает и работает какие же недостатки но первый недостаток это то что йога минут то есть в последние то галера кластер первый мой совет то есть не верьте рекламе соответственно мы брали галера из-за того что нам рекламировали что можем писать на любой майское серу то есть на любой измаильский серых то есть у нас в было multimaster архитектура соответственно потом изменение репетировали другим серверам но казалось после многочисленных репортов что на практике у нас не работает возникало много диалогов и соответственно мы даже выделили что у нас и чтение тоже не всегда синхронно то есть мы бились над этим долгое время кто-то говорю что мы мы не умеем просто готовить галера но это до сих пор у наших головная боль и соответственно на данный момент мы используем простой джитибиси fall back то есть если какой севера не работает москве севернее работы мы переключаемся на другой какие же остальные очевидные недостатки это прежде всего то что это complain интерфейсе ответственности предложения должны размещаться на том же сервере что из села эти приложения поддерживается несколькими командами все это у нас находится под управлением chef то есть установка настройка и так далее и соответственно вместе несколько команд поддерживают несколько рецептов то есть это то есть очень сложно зависимость управления зависимости и за это у нас происходил долги цикл для запуска нового релиза того же х его то есть это где-то официальный у нас было две недели чтобы например протестировать новую фичу а нам хотелось например в течение часа проверить некоторые особенности хави и соответственно сложно мониторить потому что у нас нет единой точки входа от каждый как онлайн то есть исполнялся в польском пространстве и весь и би си было решение тонна было бы очень сложно и сложно масштабировать я веду потому что если вдруг у нам надо какой-то момент audacity большое количество данных нам мое детство решения был установлен установить новый сервер что является универсальным используем ресурсов то что следующий момент она мне нужен из предыдущих проблем исследовал что так же у нас есть проблемы с тестированием как должны остановить новую версию хай вы как и протестировать у нас есть конечно припрут есть у нас стейджинг сервера на все равно выходила что мы работаем не в том январе менти что будет работать в реальности и соответственно мы задумались когда уже компания стал расти то есть у нас появилось больше финны бюджета то есть о переходе в облака хайтаны за месяц это наше облако то есть компания вложилось меня за собака то есть мы не ушли в amazon у нас например на данная центруется более 600 надо в под мясо и соответственно мы решили все проблемы которые были связаны с их силой прежде всего это вот мы избавились от chef каждое приложение выполняется в отдельном контейнере у нее простой конфигурационный файл теперь мы можем в течение даже нескольких минут менять конфигурацию и запустить hive решить проблему масштабирование соответственно тестирование несколько все хайфы и так и привез такая возможность что если кассир падает спускается новый инстанции и вместо толстого клиента у нас теперь используется консервных текстуры на основе х сервера то есть теперь доступ че с тонких клиентов и и за счет этому также получили централизованный мониторинг теперь расскажу об архитектуре в конечно итоге что мы получили у нас есть минус нами затем устанавливаем скудно сколько нам надо кассиров то есть и несколько инцестов с одной конфигурации также отдельно можно намазать установить on the storm и тут стоит вопрос а как будут общаться х севера смита с тором потому что мы имеем на месте динамическую структуру то есть me the storm может появляться и исчезать вот как и говорил автовосстановление упала поднялся а еще год назад х cerato позволял вам устанавливать статические адреса то есть хотели должен был знать точный адрес сервера и и тут на помощь нашим нам пришли наши разработчики которые разработали имплементировать углях а серые который позволял нам при открытии каждые пользовательской сессии обращаться консул и соответственно консул находил мид астор регистрировался в консул и х серы мог находить адрес mitas тура об этом решении чуть раз к расскажу позже но это основной вклад то есть это это решение было в конечном итоге за комичен основную ветку хави в качестве кендама используя все тот же галера кластер с теми же данными с теми же базы данных поскольку хоть силой решение нахаль смеси используют ту же самой базу данных у нас получилось сделать так что переход к силой на х сервер нас получился гладким то есть пользователи которые работали на high силой постепенно переписывали своей программы с используя х серого 2 соответственно не было такого резкого скачка теперь используйте например использовать их а я села и спросите харизма медуз и постепенно аналитики стали также переносить свои предложения на 1 месяц мясо китаев и также они искали хасси вернусь с помощью консул с помощью наших клиентов написаны клиентов шумит также поговорю позже как я уже говорил это также у нас появилась возможность то есть мы можем устанавливать и тестировать новая версия хайма и также мы оставили на для наших аналитиков доступ через com онлайн интерфейс который используется с помощью белой на которые установлен на те же кита вы их мы также постарались сделать и папочек билайн чтобы вывод из хостела и билайн был одинаков то есть если примеру аналитика партия то тут целая он должен получить тот же опыт с билайна теперь немножко консоли то есть конце у нас компании используется большой то есть большой кластер консула то есть и каждое приложение которое запускается на месте у нас автоматически регистрируется в консоли то есть разработчик не должен думать что и как ему зарегистрируйте у нас автоматически все порты и все адреса которые мы представляем с хайвэя не доступны нашим разработчикам и доступно оружие нашим разработчикам руки как и hive очень богат то есть на руки что такой фуке то есть вы можете настроить hive под нужды своей компании как и уже говорил то есть наша компания бизон хук релиз написан интерфейс и реализован этот интерфейс для поиска мета stora который как я уже сказал была закончена в основном ветку хайло например харрис существует огромное количество fuck off которые играют который устанавливать только с помощью конфигурационных файлов то есть вы написали свой хук запихнули в свой отдельный джар джар и соответственно подхватывается и в конфигурационном файле вы говорите что с этим хуком делать например нашей компании используется свой формат для лаков написаны на джейсоне и соответственно чтобы поддерживать был написан хук для х его которые стали завалы эти данные соответственно если ваши компании спорить со свой формат вы можете сделать так чтобы хайбол понимал или например еще одно использование пользователь могут писать и hive позволяет писать возрасте функции на на джаве или например на скале он может скомпилировать их и положить его в свой отдельный жара потом добавить им файл и использовать свои пользовательские функции и с помощью рук авторизации можете например разрешить ему делать это на природе и соответственно на вроде запретить это делать стресс может тестировать в свои функции в тестовом в аргентину на проводе он должен попросить соответствующих людей и еще один хук например это логирование запросов то есть любой запрос вы можете что-то с ним сделать соответственно у нас используется поскольку у нас есть кафка мы просто каждый запрос сейчас целой афк афк у их делали с ним что хотим то есть как итог и то есть я рекомендую если вы хотите использовать hive ты и рекомендуют вам посмотрите на эти стены хуков то есть если вас кито запрос от ваших разработчиков имитировать какую-то особенность то есть вашей компании то есть hive позволяют очень много сделала с помощью хуков и как пример соответственно просто когда вы запускаете х сервера то есть вы указывать адрес вашего консула и соответственно указываете какой круг использовать то есть и также играются остальных руки как я уже говорил то есть когда вы переходите на но над новой архитектуры вы даже должны предоставить вашим разработчикам вашим аналитикам инструменты по работе с которые позволяют работать вас в новой на ремонте вы соответственно то клиента к серым 2 соответственно простое решение то есть есть билайн а ну-ка онлайн это вес на он то ему опять же надо задавать адреса серверов насколько мы используем консулом и сделать простой wrapper который просто ему не надо указывать адрес она автоматически подключается к изволили мы из них и тем самым как-то еще решили и распределение нагрузки в нашей компании мы очень любим скала раньше любили всех а теперь люди сказал он у нас это примерно наш команде работает разработчик так популярна прямо кого мир мока на скале лифты the game board по любым вопросам паскаль мужем обращаясь к нему с этот скала клиентам очень быстро работает масле в протокол и два раза меньше чем джи би би си и все это в открытом доступе нас много программ в открытом доступе и библиотеку еще один момент конечно главное то есть вы не можете доверять вашей новой архитектуре вообще любому ваши решению пока вы не доверяете своему мониторингу она прежде чем обратимся к мониторингу как что же нам предоставляет какие инструменты нам представляет hive для мониторинга например он предоставляет то есть как я уже сказал посреди протокола вы можете выключить наших ран клиент это и соответственно дело запросу к его gym xtreme от протоколом и соответственно можем собирать метрики виртуальной машины java или например отправлять выделять только определенной метрики и отправлять их в прометей или например если вы хотите как мы поскольку мы разрабатываем своей версии свой frog хайлар и тестируемого часто то есть нам надо его отлаживать находить какие-то баги дтп протоколом мы позволяем подключиться любой java диета есть отлаживать смотреть что там происходит на самом деле и также не предоставляем какое-то для каждого отдельного incense выбывает то есть там можно посмотреть что происходит какие текущие сессии какая конкретная конфигурация в этого у этого инстанса теперь вот мониторинг то есть мы представляем так все эти порты которые на предыдущем слайде они зарегистрируются в консоли то есть мы знаем что по этому порту нас мы можем получить например gemix метрики мониторинг прежде всего смесь с разработки наших группа мерзость она позволяет любой страдал то есть это ее roses любого приложения которое не только highlight который закажи зарегистрированными зассе отправлять логина власти к сети с помощью web интерфейс икебана читать логе второй момент то есть если вы хотите то есть получать метрики мы используем такой полярные решение как кроме тейлз который опять же через консул находит куда он должен подключиться то есть приметы если вы хотите хранить метрики более долгое время мы их посылаем на в графит также в компании вы можете найти я тут не указал ссылку на сайте в репозитории гидробак рита вы можете найти такой плагин на который называется be графит который позволяет убыстряет работу с там сервис данными граффити и через web-интерфейс зелененький это у нас интерфейс для то есть как что пользователи наши разработчики видят которые используют в конечном итоге через графа на вы сможете соответственно строй своих наш гордый смотреть на метрики также очень важный инструмент который связан с интересом это лет менеджер то есть помощью простых текстовых файлов вы можете написать некоторые правила на понятном человеку языке например если в течение трех минут не могу достучаться с из билайна к серверу то есть посылает соответственно email-рассылок или звони на телефон и так же наша компания была разработок если вам примеру не утаят метрики из грамм планы то есть вы не разбираетесь то есть во всех этих графиках горбань это есть в нашем компании был разработан такой дашборд о которым я поговорю чуть больше на который называется слаб опять же написанная скажи которые позволяют все эти метрики сократить до нескольких состояний как хорошо плохо что-то пошло не так так далее я покажу это чуть тоже как пример то есть это наш дашборд из гapoны то есть так то переход давно нет соответственно как я уже говорил на у нас основная проблема это с нашей галерее мы следим в первую очередь галер land in sin то есть мы пытаемся с наших клиентов подсоединиться к галере то сделай от ролями и какие-то запросы эти метрики матом управляются с кратером принтера митяй перевод скрайбером из данные которые мы предоставляем с наших клиентов также мы следим например то что у нас сбить его его доступен тот же на сервер с помощью билайн интерфейса ноль значит как во всех linux шелах это значит имеем доступ один это значит какие-то были проблемы кроме галера лет инси например порой аналитики приходят почему все медленно перед всем и как ты уже говорил смотрим на галера лэнсе или например если смотрим что в этот момент происходит в гоби коллекцию на хотели а теперь ослабил вот это фотографии вот как выглядит наш офис и увидите вот эти вот большие мониторы и соответственно зеленые-зеленые значите хорошо как как обычно то есть зима это наш слаб дашборд который горит в надо мной что принципе все хорошо как же он работает дашборд он показывает зависимости между систем системами например в нашем случае high speed астор он использует галеру то есть соответственно мы показываем что у нас есть зависимость от метод галера кластера или например а серы у нас используют разные the storm то есть это та же логично им мы также то что сбитый показан что у нас билайн может случаться да я хотел если что-то пошло не так с чем я покажу позже как пример а то есть мы мы настроим какие-то 6 школ да например если у нас в kenshi больше какого-то числа то есть квадратик становится желтенькое есть как например данном примере ты показала warning и все рынки скажу что это такое например желтый цвет в данном случае нас показывать что пользователь ждет очень много запросов на я соответственно если вы видите что что-то медленно то есть возможно из-за того что большая нагрузка на на ходу мы придешь и так далее или например вот серенький означает что мы не получаем данные из прометея то есть мы не можем сказать хорошо все или плохо мы просто не получаемые из пирамид и данные также этот инструмент позволяет нам примеру вернуться back back in history то есть если тут будет отлично зеленого напряжет или красный то мы можем посмотреть щелкнуть туда и посмотреть какой был состояние этого даже борта на определенный момент времени все это в открытом доступе то есть опять же написано скала то есть это расширяемый формовка у нас написанные плагины для прометея для горожан и также для alert менеджера например истекает возникает alert то есть мы можем читать это в нашем даже городе делать принимать какие-то решения какими-то желтые красные то есть хорошо или плохо то с тем самым мы сократили все эти grafana метрики то есть мужская 3 состояния достижение новых версий как я уже говорил мы открываем новый дата-центр в амстердаме и мы бы хотели в этом но он дата-центре использовать новый hive и мы бы хотели чтобы переход аналитиков и наших программ был более гладким для этого мы должны тестировались протестируйте новую версию файла и соответственно основные задачи нам надо найти обратный несовместимости запросах то есть то что работает продакшене у нас сейчас и что не работает на но не будет работать на новой версии highway также мы должны понять изменилось ли что-то производительности нужно ли нам может вообще переходить на новый hover соответственно у нас было написано следующее решение то есть все запросы и слайго как обычно отправляется на ходу у нас есть такой проект метр метрологии который собирает все метрики с ходу по такая как история запросов использования же dfs например графика о том как мы используется наш hadoop кластер в диалоге где аналитика то есть это все построено на базе нашего проекта метро нет метрологи соответственно у нас есть история хай запросов которые которые три реальных запросов то есть не синтетических сгенерированы каким-то автоматом а реально запросы наших аналитиков и программ что такое котлы если вы знакомы с такими с которыми как луиджи или flow как я уже сказал мы любим скала мы написали сколько свой скидывали который называется катал что он делает он соответственно лидера этой тихой запросы базы выделяет только select statement on потому что мы не быть не хотим тестировать и он состоятельным ты то что они нам не интересны производительность не мериться ничего нового у них нет и одновременно отправляем эти запросы на продакшен сервер на новый сервер и за счет того что мы примеру раз ночью примерно то есть мы чтобы новый сервер работал с теми же данными что и продакшна серым и раздел делаем backup restore из и апгрейт скрипт то есть мы должны не только восстанавливать майский базу данных мы также выполнить апгрейт скрипт и соответственно у нас запросы которые мы отправляем они работают с одними и теми же данными насколько только select запросы мы ничего не меняем и соответственно эти запросы то есть мы опять же отправляется на ходу при опять же они попадают в историю запросов дальше котлы они не будут попадать потому что мы их можем отсеивать с помощью фильтров и соответственно и сметами метрологии мы получаем использование ммр и и с котлами пример можем получить такие данные как от как отработал скрипт то есть выполнить с ошибкой без ошибкой соответственно мы в конечном итоге мы генерируем отчеты то есть мы говорим вот эти вот функции не работают это вот работает нашли основные несовместимости то есть например основная несовместимость что у нас в новой версии хай в колонке с именами как зарезервируй минами как time stamp and do it юзер они их можно было использовать кэш колок в старой версии в продакшен версия на в новые это уже полностью deprecated их нельзя использовать и соответственно мы должны дать рекомендую определенным людям помощь и метрологии можно выделить те запросы которые используют эти запрещены твердые сказать команде пожалуйста исправьте это самый простой случай на самом деле их было очень много и второй момент изменений в производительности когда мы тестировали мы нашли например что новый hive использует на некоторые запросы в два раза больше памяти если вы настроить правильного сша hadoop то вы марта у вас настроены так что любые a lot of memory exception-ы они соответственно генерируют дампы эти дамб и доступно разработчикам с помощью опять же вашей любимой дает когда мы исследовали эти дамб и мы обнаружили некорректной работы таких важных функций и политики функции как каунт и сам то есть уже долгое время как два потреблял большое количество памяти никто это не замечал соответственно с помощью наших тестов мире или они увидели что это разница ощутимая и соответственно отправили запрос и все это был поправлен а в основном ветках а его то есть теперь мы спокойной душой можем использовать новые версии hive что то что касается si peu мы нашли что производительности то же самое в принципе по памяти тоже самое но за счет новых фичей то есть мы решили все таки но новых вещей в новых версиях а вы решили использовать и переходить на новую сверху его так также хочу заметить что у нас есть котлу то есть режим доступен нашим репозитории на данный момент мы также работаем на новым проектами то есть насколько я говорю что посетитель могут писать свои функции мы хотели сделать какое-то автоматическое тестирование бойтесь каких функций я уже говорил что мы предоставим хоть не доставляет вам интерфейс он потому что у нас творится на хайсер вином и хотел бы как бы улучшить интерфейс и сделать какой-то один единый дашборд для х серого кластера которые бы мониторил состояния всех инсты что там происходит в одном месте опять же с помощью например той же карте итак выводы самый очевидный вывод чего начинал что в компании начиналась она ума маленького майские серой потратила с компаниям которое обрабатывать уже скоро будет 200 петабайт а то есть может хранить 200 петабайт информация то есть не обязательно начинать ходу по но мы нашли что ходу по те решения то есть мы отказались от собственных решение с помощью сишарпа и hadoop нам решает из коробки большинств большинство задач которые нам требуется так как также сбу нас the hive используется уже очень долгое время то и как вы видите вот он позволяет нам справляться с таким объемом данных как и уже показывал то есть hive обладает богатой системы и хуков то есть если у вас есть какие-то потребности от вашей компании новые форматы новые security требования или опять же используя новых продуктов как кафка то есть вы можете настроить хайфа может и своей компании и то есть на своем примере мы показали что вот наше решение хайфы логике я думаю не знаю мне интересно кто из вас используют хайфы используют такой же маска динамическое решение когда вы можете добавлять новыми the stores удалять то есть наш у нас ждут лучшим нашли что это очень надежное решение можем его отлично мониторить тестировать новые версии причем все это происходит за считанные там в течение там минут спасибо вопрос и так дамы и господа теперь вы можете задать спикеру интересующий вас вопрос от микрофон можно просто а вот спасибо за доклад скажите у вас сырые данные джейсоне лежат или в каком виде вот у нас хранятся уже сонин мы сейчас постепенно переходим на парке и просто использование про табов то есть мы пинаем 4 конфликт использовать ну как бы стал уже стайка скобкой да скорее всего это все сережка сможешь ответить использовать confluence реестром схем вместо кастомных каких-то решений чтобы нормально мигрировать схемы и прочие вещи делать что-то сдует базу со 100 петабайт сильно вниз а микрофон может делать да ну вообще то это я буду немножко завтра рассказывает над и канал 9 часов вообще давно модельерами джейсона на новый формат стандартные средства которые вы говорите который предоставляет компания не слышал мы сделали свое решение которое нам помогло и могла ним завтра сказать пусть он расскажет завтра то есть производительности кто изменился на лед меня зовут алексей вовченко а много лет работаем с халком с файлом мы возникло несколько вопросов делается ки так хорош и интересные вещи но не всегда очевидно зачем например вот вы говорили что проблемы у hive сервера что клиенты заходят нужен тяжелый сервер поэтому засунули в облака но ведь сам хай сервер не грузит особо ница был не память все запросы уходит на кластер hadoop там в ярни выполняется мы следим за средами примеру количество следов нас много аналитиков клиентов соответственно нам надо масштабируется нагрузку сколько солидов открыто то есть просто очень много клиентов до дорогие а второй вопрос вот то что вы рассказываете hive нами зассе в облаке из коробки например кажется что сейчас хортон words представляет там можно сколько угодно me the star сколько угодно hive серверов развернуть и это прям небольшая проблема там единственные звуки пир используется чтобы найти нужный me the star ну то есть получается у вас костанае решение вот продакшене они нам тут вопросы на конечно можем использовать новых версиях ходу по но они появляются так часто меняется бы когда мы начинали это были не стабильной версии то есть постепенно у нас была уже решение когда мы начинали то есть стабильным был примеру только х силой эхо серый только начинался соответственно на какой-то плавный переход мы не могли резко перейти на пример вы говорите представляет он представляет уже с ходьба там уже начиная с каких-то windows server 2012 вполне себя ну так когда мы это имитировали то есть это было не совсем как это сказать нам доступно и последний вопрос несколько раз упоминали мы previews почему соответственно то есть у нас поскольку у нас есть парк от с но поскольку мы как предоставляем как инфраструктуру то есть мы придется вам менее требовательны к памяти от если мы не следим чтобы спускают наши пользователь с моей превью смене привередлив мы смотрим на тест и соответственно съесть лама раз он может каких-то запросов сотни раз медленнее работать с ну в общем то есть мы нашли что не надо для каждого запроса конфигурировать то есть эти кастом пример нам приходит какой-то аналитик то есть мы можем предоставить но это не основное решение то есть in general то есть мы должны предоставить что все это работало то все согласятся да еще не вопрос про джейсона вы его сжатым держите и флагов просто иначе и реально там можно раздуть базу вот как предыдущий вопрос был со 100 петабайт daddy стилях получать орг формат этот это завтра ну и сейчас можешь ответить уже хорошо спасибо большое здравствуйте александр спасибо за доклад вопрос такой вот вы используете кафку и льете данные hive чем влечь данных акков к той же тест разработка то есть какое-то внутреннее решение и влиять и джейсона получается сейчас я сейчас переходим сейчас приходится на про товар и парке понятно все спасибо как я уже сказал здравствуйте меня зовут александр вот вы сказали у вас архитектура построена на месте а можно ли вместо месяц использовать ходу пьян сомневаюсь они пробуют даже об этом не думали но я кажется то есть не подходит не для этого предназначены то есть это не совсем ublock если еще вопросе 20 минут владимир вопрос такой вы можете описать некую карту того как вы переходили вот начиная от mais quel через сиквел к ходу пу то есть какие объемы были нет ну являлись некими границами когда вы решали все пора но это мне кажется тема отдельного доклада то есть я хотел показать операция то есть сейчас сейчас я не могу с цифрами не готов ну там основной момент был когда соответственно потребуется с моей скрыль когда патриот уже новый дата-центр пост сама решения не поддерживает то есть на нас был шарден какой-то"
}