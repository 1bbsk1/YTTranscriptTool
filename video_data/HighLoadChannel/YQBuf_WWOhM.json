{
  "video_id": "YQBuf_WWOhM",
  "channel": "HighLoadChannel",
  "title": "Аналитика мобильного проекта — проверяй и доверяй / Александр Лукин (Yandex AppMetrica)",
  "views": 551,
  "duration": 1872,
  "published": "2017-06-01T23:33:21-07:00",
  "text": "у нас сейчас стартует предпоследний доклад александр расскажет вообще о том как они разрабатывали от метрику эта система аналитики от яндекса с какими проблемами столкнулись в чем вообще различия в сборе метрика в разных системах аналитики ну в общем взгляд с другой стороны привет всем спасибо на самом деле они не буду очень много рассказать про то как майк метрику делали у кого есть мобильный проект в продакшене ну вот значит все смотрят аналитику да и очень часто вы можете видеть что у вас во flare в аналитик сие в метрике разные числа именно об этом мы сегодня и поговорим но сначала к познакомимся я вас попрошу сказать не кто знает что такое от метрика отлично наш познакомимся нужно скотт мне почтенны все работать в отличнейшее команде который занимается разработкой full stack платформы мобильной аналитики трекинга от метрикам мы не просто решили сделать свой велосипед в вакууме что-то придумали и разрабатываем мы работаем плотно с нашими проектами командами которые занимаются нашими индекса вам приложениями стараемся собирать у них требования и задачи и постараться их оптимально решить так сложилось что у нас получилось достаточно хорошо и мы решили сделать из этого публичный продукт который мы запустили летом пятнадцатого года под именем от метрики общее общая задача любого мобильного проект можно условно разделить на три категории они все падают три разных функциональных домена 1 это 1 эта продуктовая аналитика там понятные задачи понятно чего она вам нужна здесь есть логотип кое-каких систем аналитики мы пользовались ими всеми постарались с каждой взять лучше учли опыт следующая задача это любой проект который занимается пифон с маркетингом он нуждается в платформе для треккинга треккинга источников трафика мы пользовались также в семье нет не пользовались тремя треки трекерами из приведенных здесь за исключением кача вы все они достаточно были дорогими ну и понятное совершенно задачи крыше паркинга мы конечно хотим следить за состоянием нашего приложений в продакшене быстро и воспроизводить проблема их чинить в итоге мы за время разработки смогли в одной платформе в одной системе объединить все три функциональных доменом у нас получилась такая вот intent платформа аналитики на самом деле только закончил разработку всех трех функциональных доменов мы поняли что у нас получился отличнейшая вещь которая позволяет нам избежать фрагментации данных между разными платформами очень частая ситуация когда вам необходимо построить кросс отчет допустим в с группировками в разрезе по источникам трафика какой-то продуктовый отчет данные для ваш продуктовый аналитик лежат ну скажем во flare данные по источникам трафика лежат ну к примеру в обстреле каким трекером вы пользуетесь для того чтобы получить требуемый отчет вам необходимо программировать и программировать вам необходимо только том случае если ваша система аналитики и трейдинга предоставляет требуемый api если его в принципе нет то и отсчет вы построите не сможете в некоторых случаях системы интегрируются между собой через публике как примеру слоя может отправить по сборке в миг спину но это опять же лишние сложности если говорить о каких-то преимуществах от нее такие и продавать особенно собираюсь я бы подчеркнул только то что она бесплатная и мы не накладывает никаких ограничений на объем данных которые вы можете к нам отправить и не на интенсивность ни на объем также очень интересный момент это то что мы предоставляем доступ к своим данным у нас есть api которая дает доступ к не агрегированном гранулярный данным вы можете вытянуть все к себе переехать на другую систему аналитики либо использовать эти данные для своих собственных агрегации в in-house аналитики или для ретаргетинга ну кстати это возможность доступ к своим данным она нам понадобится в конце доклада значит у нас есть из дикие под все основные платформы под unity x мари самарин ok у нас есть плагины которыми пользуются кто хочет заходить и льна от метрика индекс ком там есть дома не нужно интегрировать из детей чтобы получить первые отчеты с данными там есть дыма приложения в котором даны уже есть можно все потыкать посмотреть руками вернемся к собственно самому интересному к теме доклада проверяй но доверять ну собственно в чем проблем любой так или иначе серьезный мобильный проект занимается проектированием метрик и методология расчета заранее до запуска приложения в продакшен и вы понимаете как они будут рассчитываться на каких инструментах и на что вы будете ориентироваться разумеется никто не хочет остаться без приборов измерения когда вы уже летите поэтому часто принимается решение о том что мы поставим несколько аналитиков я видел случаи когда в одном приложении было шесть аналитических везде киев и достаточно интенсивные отправка событий если просто посмотреть фарш арки то они больше трафика генерировали чем сама бизнес-логика приложения зато видимо команда была уверена действительно уверена в том что не видит так вот мы с вами поставили несколько из детей аналитических платформ а вот на этот слайд привел нет не все что я знаю мне просто надоел копировать самом деле все больше вот вы можете выбрать любые перестановки вот из этих всех и получить свой analytics youth для приложения собственно постановка проблемы вот у вас есть две аналитики аналитика условная к и аналитика н вот наш квадратик это активные пользователи кажется такая простая метрика активная аудитория за период разбивки день недели месяц но мы с вами смотрим на два приборы на одном видим что у нас 100 пользователей другом 105 пользователей давайте рассмотрим конкретные кейсы это одно из индекса вых приложений не буду называть какое я изучала расхождение это был где-то наверное месяца три назад расхождение данных в от метрики его flare по графику он еще и со сглаженными построен наверное ничего не понятно но как видно расхождение есть поэтому я для удобства привел табличку и даже красным выделил самые плохие дни как вы видите расхождение у нас составляет до пяти процентов при этом расхождение у нас разно знаковые нет такого чтобы в одной аналитики нас всегда была аудитория больше другой был аудитории меньше нас ну во-первых расхождение такой может быть незначительным решать вам если вас это устраивает и вы просто смотрите на динамику и вас не волнует что у вас расхождение в пять процентов между меня системами аналитики окей просто забудьте про это 1 к 40 аналитиков из разных проектов заставили меня с этим разобраться так вот я немножко приведу последствия последствия очевидны и и не очень этого расхождения первые очевидное расхождение метриках может влиять на проектные решения ну то есть вы смотрите на вашу аудиторию и можете принимать решение о запуске эксперимента постановки и тестирования гипотез каких то тут все понятно следующее не такое очевидное это прогнозирование если вы делайте какие-то прогнозы каким самим самыми простыми способами экстраполяции то ошибка появившиеся здесь вначале она у вас ухудшится в вашем прогнозе это вдвойне плохо и следующие не очевидные последствия расхождение в исходных данных она повлияет на другие агрегатные метрики например на ride on she если у вас есть расхождение в активных пользователях то и примеру другая агрегатная метрика который строится на этой метрики а именно ритмично она будет с еще более усугублённый ошибкой я приведу пример чтобы не быть голословным здесь приведена расхождение летаешь на 2 недели из трех систем аналитики это мобилок tracking он же тьюн flare и от метрика значит ну кажется тут вообще все плохо значит подытожим по этому графику раз для значений у нас 20 процентов как вы видите у нас в во flare около 50 процентов колеблется в мате у нас 67 даже больше на порядка 17 процентов это не так плохо что действительно плохо мы видим разные тренды как нам объяснить разные тренды очевидно что методология подсчета на протяжении всего периода отчета поменяться не может значит разница у нас заключается только в исходных данных на которых рассчитывается рита нужно ну в общем ничего не понятно будем разбираться с расхождением в активных пользователей с чего начать но мы пойдем в документацию флорида вот и посмотрим на определение активных пользователей что это за метрика как она определена мы видим приблизительно ничего не значащие определение что пользователи это пользователь украине плохо у которого была хотя бы одна сессия за заданный период такие будем работать с этим мы здесь получили новую информацию а именно сессии теперь нам нужно разобраться с тем что такое сессии и расходитесь или они у нас приведем тот же самый график для того же самого приложения за тот же самый период видим расхождение в сессиях есть отлично ну кажется мы продвигаемся опять же график нам мало информативен при гульду табличку здесь в правой колонке в крайне правые приведена расхождение по аудитории и вторая справа и соответственно расхождение по сессии как мы видим расхождение у нас есть расхождение у нас разных знаковых нет однако мы видим что они разные примеру за 8 марта у нас расхождение в числе сессий порядка шести с половиной процентов расхождения в активной аудитории было всего лишь 3 процента значит ok будем разбираться с этим выводы первое число и продолжительность сессии они сами по себе хорошие продуктовые метрики вы можете считать число связей на пользователя средняя продолжительность там между сессиями в общем это хорошая оценка вовлеченности пользователей значит нужно разобраться с расхождением метрики сессии само по себе второе возвращаясь к нашей общей задачи определение почему же нас разное число активных пользователей у нас при большем числе сессии действительно одна система рассчитывать меньшее число пользователей очевидно что эти сессии генерируются разными множестве устройств ну мы применим подход также самым пойдем документацию там тоже много написано в общем сама важная подчеркнул сессия зависит от вашей реализации значит не буду тянуть дальше расскажу итог того как мы подошли к трейдингу сессии в от метрики значит первая сессия безусловно большинстве случаев 99 процентов случае должна быть привязана к жизненному циклу самого приложения когда нас пользователь заходит в приложении на запускается у нас там какие-то глубокие жизненные циклы вызываются там он там он он старт-стоп андроиде нам мы можем привязаться к этому и рассчитывать сессию на основе вызова этих методов однако есть вот такая проблема представьте что у вас пользователь работал в приложении затем его прервал входящий звонок который длился две минуты две минуты говорил по телефону затем он вернулся приложение что мы должны делать мы вызов дернули он старт у нас есть либо of the tracking сессии либо вернули наш метод onstart и мы сейчас должны либо стартануть новую сессию либо продолжить предыдущую вот как вы считаете кто за то чтобы стартануть новую сессию а предыдущие продолжить большинство на самом деле ни те ни другие как здесь правильной точки зрения очевидно не мы пришли к такому простому решению во флориде плотный тайм-аут сессии 10 секунд соответственно если пользователь вернулся это написано в их документацией если пользователю за 10 секунд вернулся приложения сессии предыдущая будет продолжена в от метрики вы можете настроить и тайм-аут и поставить его таким каким вы желаете ну-ка пример он там 60-секундных кажется с этим мы разобрались если у нас будет одинаковое число сессии и они будут одинаково трека ца то есть и от метрика будет считать что тайм-аут сессии там 60 секунд и flare будет читать также то вероятно в отчетах вы увидите одинаковое число сессий и как следствие одинаковое число активных пользователей я предоставляю право проверить это вам можете вернувшись к рабочему процессу взглянуть в код и посмотреть как сейчас вот вас-то сконфигурирована если и сконфигурирована либо вообще мы перейдём сейчас к другой более сложной проблеме это пользователей без сессии вот такое тоже бывает на самом деле как тут было ремарка по поводу получаса и так далее на самом деле давно пора отказаться от всех вот этих старых верных понятий о саре сеть так как мобильном зависит очень сложное понятие иначе мы везде сейчас не сидели ну а я стою так вот возьмем пример приложение яндекс диск у него очень много обыгранная активность как вы понимаете когда появилась вай-фая сетка она пытается синхронизировать файлы папки и там фотографии так далее представим что у нас есть событие кастомные которые мы настроили с вами для того чтобы анализировать пользовательскую активность и результаты этих операций у нас есть с вами вот такой условный timeline устройстве сейчас подключилась к wi-fi сети и синхронизирует файлы значит у нас приходит три события подряд файл sings access full условного ряд что-то у нас синхронизировалась какая-то папка у нас не за 7 класс и эта фотография также успешно синхронизировать мы хотим увидеть вот такой вот отчет где мы увидим процент пользователей процент событий достигших то есть процент пользователь достигших этого события кто вот в этой таблице в этой таблице кто видит подвох проблема здесь в том что мы с вами читаем процент от пользователей вопрос какой еще пользователь если у нас с вами была чисто богоравная активность и человек в приложении не заходил вообще три недели уже меня годится не заходило он него просто файла синхронизирует бы гранде так от хотьково от каких пользователей мы считаем этот процент н д 2 мы пришли к тому что пользователи и то на что вы смотрите в во flare попросту мостом 30 процентов пользователей из россии окей что за пользователи мы пришли потому что необходимо новые метрика это метрика у нас называется девайс с устройство устройство по сути является уникальное идентифицированным отправителем событий посчитать загримировать эту метрику очень просто если у нас есть хотя бы одно событие с этого уникального это дивой сойди с этого устройства то мы засчитываем его заданный временной период в итоге мы пришли к системе из трех метрик которые хорошо работает и полна непротиворечивые так далее значит подытожим девайс это у нас уникальные отправитель событий если у нас не было если нас есть хотя бы одно событие с этого устройства мы засчитываем и девайс не важно где она была в программной сессии в огромной сессии и так далее следующая сессия сессии у нас ну это некоторый сеанс взаимодействия пользователя с приложения которые определены вашими вызовами методов треккинга сессии в системе аналитики либо авто трекингом и вы сами сконфигурировали методологию подсчета при возвращении пользователя в сессию засыпав нам тайм-аут следующий очевидный тоже такой пользователь пользователь это просто девайс имеющий за период отчета хотя бы одну сессию кажется здесь все достаточно так понятно и последовательно ну если что-то не сходится меня очень интересно узнать к примеру у приложение яндекс диск расхождения во всех отчетах пользователей девайсов три раза за любой временной период как я и говорил у него много пользовать огромная активность значит что нам следует сделать для решения нашей задачи где мы с вами анализировали успешной синхронизации файлов папок нам нужно выбирать правильную метрику зависимости от бизнес-логики отчета если мы сейчас с вами понимаем что нам нужно посмотреть какую-то активность проанализируют какие-то события приходящие потенциально в огромные сессии на не нужно смотреть на процент от пользователей потому что пользователь у нас это именно непосредственное взаимодействие человека с вашим приложением каким-либо образом мы выберем с вами метрику девайс и получим корректный хороший отчет вот общем вот такая вот отличная система из трех метрик во многих гонках на некоторых аналитиках можно посмотреть и дивайсес и пользователей отдельно некоторых вроде flare нельзя однако я бы здесь не стоял если бы не было следующего слайда в общем есть даже такие ситуации когда эта система из трех метрик не работает давайте взглянем на вот такой вот не то чтобы вы рожденный и редкий случай мы с вами говорим про приложение яндекс музыка хотим проанализировать поведение пользователей мы его собираемся анализировать по нашим к основным событием которые приходят во время проигрывания треков носом с вами приходит события типтон tracks which там пауз play и так далее пока идет воспроизведение для меня это пользователя я хочу зачитать его как пользователя в своих отчетах вы прекрасно представляете что могут быть очень странный успеете здесь я могу взять iphone выдвинем шторку notification центра и нажать play у меня продолжить воспроизводиться музыка из-за приложение яндекс музыка при этом интерфейс я не заходил с приложением не взаимодействовала однако для меня как для продуктов условного продакт-менеджер яндекс музыке этот пользователь потому что из моего приложение сейчас играет музыка я хочу с этим пользователям работать как с полноценным пользователям его анализировать вот есть некий timeline на нем я думаю понятная ситуация у нас происходит нужно объяснять значит здесь мы с вами генерируем невероятное число сессий либо не генерируемых вообще в случае если к нам обратились через вот эту вот шторку условно да или просто воткнули наушник ну знаете данной оси стандартный день воткнули наушники и там последний этот провайдер медиа стрима запускается и вы можете продолжить воспроизведение из него не заходя в приложении мы генерируем совершенно непонятная сессии пользовательский при этом не позволяя покрыть такие кейсы когда пользователь не взаимодействовал самом вообще как это можно решить от метрика как и все другие аналитики для этого никакого решения не предоставляет это все ложится если вы действительно серьезно занялись аналитикой все ложится на ваши плечи есть предложение ну мы назвали его условно модели дискретных событий тоже хит bass подход он основывается на предположении кажется корректном что никто не знает контекстом в котором сейчас пользователи взаимодействуют с вашим приложением лучшего кода вашего собственного приложения мы отказываемся от понятия сессии как такового и просто разделяем все события на два типа первый тип это событие тип either on tracks понятно для чего не нужны они у нас будут считаться по-любому то есть события это присылается только когда пользователь непосредственно фары грамоте взаимодействия с приложением вы в коде приложения сами помечаете что это событие типа юзер interaction метрика active users будет агрегироваться по наличию хотя бы одного события типа юзер interaction с данного девайса иди следующий понятные уже дальше тип событий это события типа словно оба гранат activity это событие которое заведомо приходит из-за никого огромного состояния приложения которое опять же в своем природном коде знаете лучше любой система аналитики и помечаете отправляемые события этим типом в итоге мы с вами отказываемся от общего понятия сессии мы предоставим возможность самостоятельно определять начало и конец сессии вашему приложению для того чтобы мы все еще могли с вами измерять такие метрики как продолжительность сессии и там расстояние между сессиями число связей на пользователей и так далее и для того чтобы эти сессии разделять так как у нас больше у нас больше нет никакой глобальные сессии просто взаимодействие с приложением для того чтобы разделять эти сессии случае яндекс музыке эта сессия там прослушивание музыки сессию и взаимодействия мы дадим возможность сессии помечать текстовые метками в результате у нас получается вот такой примерно timeline на котором мы с вами четко помечаем все события происходящие непосредственно в при взаимодействие пользователя с интерфейсом приложение с типом юзеры interaction события происходящие заведомо в бэкграунде типом и гранат activity а для того чтобы посчитать продолжительность сессии мы с вами будем отправлять события начала и конца сессии костанае самостоятельно помещаю их в текстовый меткой условный там воспроизведение музыки между play в итоге мы с вами получим вот такой вот отчет в котором мы сможем посмотреть на агрегированные по событиям типа юзер interaction active users с агрегированные по любому типу событий бэкграунда активе телевизор интересный девайс с уже здесь интересно наличии хотя бы одного события этого девайса среди а для того чтобы посмотреть разбивку ну какую-то метрику по по данной сессии например продолжительность сессии или число таких связей на но за этот временной период скажем смотрим отчет за неделю с разбивкой по дням мы с вами просто добавим нашу про маркированную текстовые меткой сессию music play и будем смотреть именно не чтобы это не осталось каким-то совершенно непонятным абстрактным я немного расскажу о том как это можно сделать расскажу от метрики сделать можно в любой аналитики который это позволит как известно в любом событии можно заслать некие жизнь природы в нем мы можем в случае от метрики мы можем засылать до пяти уровней влажности различных атрибутов мы с вами помещаем все наши начале и конце сессии определенными событиями с текстовым метками затем от метрика здесь вам уже не поможет вам необходимо будет самим выполнить агрегацию благодаря названным в начале лог запишем у api для доступа к гранулярными данным не агрегированном данным вы можете вытащить большую плоскую таблицу к себе условного буквально сесилия птиц из наших табличек и в своей инфо us аналитики неважно где там в экселе в табло каким скриптам вы сможете сделать агрегацию для того чтобы получить этот самый отчет о котором мы с вами говорили и посмотреть на метрики по вашему маркированные текстовым метками сессии по агрегированном по вашей собственной лайки активным пользователем и по девайсам методологию агрегации для каждого из этих для каждой из этих трех метрик я предложил докладе можно будет потом где то вы уже можно к ним вернуться и пересмотреть мораль такова я ну понятно что вот это все программировать и так далее никто не бросится все сложено послушали забыли ушли но вы уже пользуетесь такими системами аналитик вернитесь исследуйте что вы видите в своих отчетах не нужно ставить от метрику не нужно менять систему аналитики просто поймите на что вы смотрели до этого проведите эксперимент и попробуйте подойти с двух сторон со статистической инженерный тогда возможно какие-то аномалии как который раньше вы видели но не обратили внимание просто пропустили мимо станут вам понятней однако если у вас достаточно энтузиазма и решимости точно понимать на что вы смотрите в отчетах и любому кто пользуются яндекс метрика и от метрикой xp на lanos говорить что вы в общем вы занимаетесь политикой на базовом уровне то попробуйте рисовать вот эту суку агрегацию собственно на своей стороне основанную на модели дискретных событий предложенную в докладе но этому у меня все содержит буду спасибо спасибо за доклад у twitter есть сервис тоже аналитики андерс и они предоставляют такую классную фишку как а один сын сайт ну то есть совместно с twitter они предоставляют данные демографии пользователи об интересах и так далее то есть что-то похожее у яндекса в метрике есть отчеты по соц-дему по возрасту и полу они строятся на основе определения этих профильных параметров для девайса иди помощью наши внутренние дмп крипто я думаю на известным тем кто занимался в этом отличие наши в том что мы у нас есть определенная доверительный интервал если в которой если у нас не попадает определение пола и возраста то мы замечаем на данный момент этот девайс айди как не определен поэтому у нас в отчетов в отличие от flare где определены все там сто процентов пользователя понять не имеют куда не создадим данные на россию к примеру однако они этом с уверенностью утверждать вот там 15 процентов это мужчина там 35-45 вот там 30 процентов это этом женщины 25-35 не знают куда них таких хороший даны такие отчеты у нас есть и в них мы помимо возрастных 6 возрастных диапазонов и пола milf имел показываем еще и ней для тех девайс айди для которых сейчас стребую с требуемой достоверностью неопределенно этот создам параметр такие отчеты нас есть интересно было больше на что интересов пользователей ввиду того что ну в метрике в одной вы знаете что там есть интересы по пользователями в от метрики пока что интересов нет потому что мы пока что не можем с достаточным качеством этого реализовать это лучше ничего чем как какие-то странные разбивки на проценты на который вы будете ориентироваться спасибо я вот не из мобильного пришла без неба и там я некоторое время всяким могут и стингом занимался и сейчас вот как дарит готовился здесь мы попытались то что мы бы кастинговые секцию собрать и был вопрос вот найти каких-то людей которые вот в мобильных хорошо этим занимаются могут счет прямо продвинутая рассказать на эту тему я стал ходить ну как тем своим знакомым которых я избегу знаю и они вот такую точку зрения высказывают что вебе все круто метрики подбирают четном такое делают вот в мобильных рамка бы предыдущая задачу еще решается якобы как просите не потерять данные и вот прыжка как данные собраны мне вопрос любопытно вот свое с точки зрения за все таки решено на то есть близка к ста процентам данных которые мы хотим собираются или на самом деле танки это проценты или десятки процентов куда-то проваливаются ну вот папа по собственным ощущениям как она говоря про от метрику из ее сравнении с другими схемами аналитик это это опять же можно то есть во первых мобильном понятный там другой кейс использование немного да то есть у нас есть оффлайновой работы и может быть много возьмем пример maps.me пользователь мог по симка тебе карты уехать на месяц саудовскую аравию и у него там на генерала событий на мирилась сессии потом он приехал они нам отправились или не отправились мы не расскажу про от метрику разумеется у нас все сохраняется вся оффлайновый работа сохраняется локально у нас есть ограничение в 7 дней в неделю на старость данных если клиент нам присылает данные которые произошли то есть события произошедшие на устройстве по времени устройств более чем семь дней назад там и эти данные пишем в отдельную табличку отчетов по ней не строим забрать их можно отчета по ней не строится при этом у нас есть специальная like корректировки серверного временем для того чтобы работать с устройствами на которых сбитые часы вот такой часто встречается это устройство только что купленные запущенную спасибо"
}