{
  "video_id": "8_hbxA4kx50",
  "channel": "HighLoadChannel",
  "title": "Moxy. Как правильно пользоваться? / Юрий Шмаков (Arello Mobile)",
  "views": 7223,
  "duration": 3360,
  "published": "2018-01-16T12:32:32-08:00",
  "text": "всем привет меня зовут юра я я расскажу вам про магси и именно про то какие пользоваться у меня несколько вопросов к вам кто у себя использует mvp вайпер кинг и тех чьи и пойдешь там архитектура популярная хорошо так как то есть пользует макси здорово значит вы узнаете но многие сегодня узнают для себя что-то интересное в будущем вы сможете либо решиться на использование мокси либо просто подчеркнуть себе of проект какие-нибудь идеи и реализовывать их уже самостоятельно для начала давайте определимся в принципе какой подход мы хотим использовать при решении задач что нам вообще нужно сделать в целом из нам нужно определить презентер который будет описывать поведение view нам нужно определить интерфейс view за счет чего презентер будет знать что в юха будет уметь делать затем нужно реализовать в.ю. и напоследок нужно будет сделать бизнес-логику уже вашего приложения это уже слой модели его мы в максе не касаемся ну соответственно ему в моем докладе модели тоже не будет так какие в целом требования у нас выдвигается ко всем решениям вообще нам хочется чтобы не было никого более plateau то есть чтобы юшка сама после пересоздания принимала требуемое состояние ожидаемые от нее то есть чтобы она продолжала отображает то что оно отображало до того как она перри создалась в тоже время мы хотим чтобы презентер сам правильно чтобы к activity к вьюшки подцепил ся правильный экземпляр презентер а после того как она перри создалась тоже время хочется чтобы это все реализован без бойлер plateau и чтобы не было всяких switch кейсов том айдишник of the sack то есть чтоб все было максимально просто давайте сперва посмотрим мельком на схему взаимодействия компонентов когда вы используете moxie мокси самый интересна эта прослойка которая встает между презентеров и реализации интерфейса view эта прослойка генерируется она точно процессором соответственно вам не нужно ее писать самостоятельно то есть достаточно будет добавить там пару аннотации и все будет делаться сама т.е. собственно view state и экземпляры команд которые уходят из презентеров а в юху они будут сгенерированы вам будет достаточно просто из презентер отправить какую-то команду воздуху и соответственно когда вы отправляете команду во вьюгу она сперва попадает во вью state который сохраняет ее в очередь команд и после чего применяет к в ухе ну и допустим пользователь использует ваше приложение после чего поворачивают устройства и в юха у него перед создается цепляется обратно к этому же презентер у соответственно к этому же в you stay to view стоит это замечает и говорит очереди команд чтобы оно применилось к этой в ухе и собственно таким образом в ухо обратного принимает то состояние которое мать не и ожидаем в принципе довольно просто теперь давайте непосредственно на примере посмотрим что нам придется для этого сделать то есть в принципе доклад такой будет довольно простой потому что код мы пишем каждый день я по я покажу максимально простой код чтобы увидели что в этом слое в этой связке view и презентер уже больше нет ничего сложного то есть дальше можно будет уже с сосредоточено сосредоточиться на слой модели там гораздо больше всего интересного давайте aspera разберем самую простую такую задачу то есть после запуска приложения нам нужно чтобы через одну секунду пользователю было показано какое-то сообщение соответственно сперва мы определим интерфейс в ухе собственно мы говорим и что в юха должна уметь показать какой-то месяц после чего мы определим презентер собственно в президенте ли прямо в конструкторе мы создадим айсинг тоску в ней собственно подождем секундочку после чего скажем в you stay то чтобы он собственно показал уже массаж пользователю вот стоит заметить что презентер отмечено that's a magic the state и типизированным тем самым интерфейсом в ухе за счет этого собственно annotation процессор сгенерирует класс view street а затем когда будет вызван дефолтный конструктор презентер а макси подставят правильный экземпляр views это в этот презентер после чего вы сразу прямо с конструкций канск прям с конструктором можете начинать работать с этим you stay там собственно что мы здесь и делаем его sing тоски он пост execute берем экземпляр вестей то и просто говорим о папа покажи message все мы не переживаем о том что у нас при атаке на какой от уха и не поят очено или что их там несколько нам в принципе без разницы мы знаем что у нас в юст точно есть все мы в него отправили командочка вот и в результате собственно мы получим то поведение которое мы ожидаем от этого презентер а у меня такой вопрос кого здесь смущает to sing тоска то есть никто не против осин to suck что анонимная sing тоска вот до в общем это asynctask а она анонимная соответственно она хранит ссылку на этот презентер вот но когда у нас будет перри создаваться activity этот презентер будет продолжать жить мы будущем будем именно с ним работать поэтому нам не страшно что sing тоска привязана к этому презентер у на контекст она не за весну потому что если бы она была бы в activity тогда да она бы так как она опять же анонимной она похоронила ссылку на activity соответственно на контексте утечка памяти здесь у нас птички памяти нет президенте мне утекает на презентер у нас продолжает жить все то есть как бы оно так и должно быть то есть я sing the sky презентер они вместе живут вот да здесь собственно есть 2 проблемы во первых у а sing to suck как известно в разных версиях android используются разные компьютеры там в каких-то версиях там используется пул экзекуторов скутер пул потоков где-то просто один поток на все sing тоски в общем это одно не красивое место 2 не красивое место правильно замечено сингари спас ability вообще как бы я синхронная работа не должна быть в президенте ли потому что презентер это просто про то как мы меняем вьюшку здесь мы больше никаких решений должны принимать здесь мы все навертели и и мухи и котлеты все в одном месте но это просто пример что вы видели что в президенте и как бы он оцеплено жизнь на цикла вьюшки и соответственно в нем в нем можно уже немножко расслабиться вот и дальше у нас остается последняя задача это собственно описать нашу activity в ней мы заводим fille du презентеры и отмечаемые аннотация magic презентер все в будущем когда у этой activity вызывается он creed с этого момента этот презентер будет проинициализирован и опять же можно с ним сразу начинает взаимодействовать не переживай что он там на он не нал вот moxie сама поставит правильный презентер в эту fille du соответственно если мы только зашли на этот экран то она создаст новый экземпляр презентер а если мы вертим устройству за activity перри создается то суда будет поставлен уже имеющийся презентер затем позже чем он кредит в он старте это activity будет при от очено вот и соответственно например можно из презентер они не беспокоятся о том когда эта связка произойдет вот и соответственно этот это activity implemented интерфейс духе которым типизированный типизированный собственно презентер за счет этого собственно происходит связка это вьюки с презентер ом и мы реализует интерфейс говорим как это activity должна показать message конкретно в этом примере я просто создаю новую текст юшку и добавляю ее в layout это тоже специальная так сделал потому что если вы в обычных условиях сделать такой код то после период создания activity соответственно layout заново нарисуется и никто эту вьюшку не не тег стрижку не добавит way out вот но мокси заново вызовет метод show massage после пересоздания activity и ваши stick сушка будет заново добавлено соответственно например визе белить и она тоже не само собой не переживает пересоздание activity соответственно если бы у нас уже было бы текст юшка в ялте описано но было бы связи билете гон то в шоу мисс уж мы бы переключили везде билете на билете и собственно message наш бы был показан пользователю вот ну и собственно вот можно увидеть то самое поведение то есть после пересоздания activity причем после пересоздания мы уже не ждем секунду чтоб показать пользователю массу потому что ну как бы для пользователей это один и тот же экран и как бы он не хочет заново ждать секундочку вот теперь немножко усложним задачу пока идет таймер мы должны показывать пользователю время которое ему осталось дождаться что получить массаж в этом случае собственному немножко усложним нашу наша asynctask у в ней мы в приказы кьюти скажем что юшка должна показать таймер после чего во время прогресса мы будем каждый раз показывать говорить вьюшки чтобы она показала новое значение таймера и в позы крикете мы с крой массаж и уже покажем и скроем таймер покажем message вот соответственно мы дополним интерфейс вьюшки чтобы были описаны вот эти новые методы показать скрыть таймер и показать его значения и соответственно в activity мы просто добавляем новые методы максимально простые то есть мы просто меняем визе билете некоторые вьюшки и значения текста этой вьюшки и в результате мы получаем ожидаемое значение причем заметьте что после пересоздания но как бы мы сразу показываем пользователю текущее значение потому что если бы даже мы asynctask у отцепили она бы жила отдельно то после поворота нам бы нужно было было бы дождаться пока тик не следующая секунда у нас же она работает сразу потому что как бы во вью стоите сразу хранится последнее значение таймера и когда в юшка притащиться к презентирует you stay то она сразу покажет последнее значение вот и ну заметьте нам по сути ничего особенного сделать мне пришлось мы просто описали как activity это показывает и когда из презентер а нужно что дернуть теперь еще немножко усложним нашу задачу допустим нам нужно будет массаж показывать видео лир диалога в чем особенности этой задачи дело в том что если вы показали alertdialog повернули устройство также как так же как и к основная добавленная юшка alertdialog пропадет вот но с макси собственно проблема нет просто когда приходит show massage мы просто показываем малер диалог вот от настолько требуется что сделать alertdialog его можно скрыть соответственно нам нужно это собр и события пользоваться интерфейса пробросить через презентер то есть когда происходит dismiss мы презентер уговорим что пользователь намерен скрыть allure диалог то есть мы все события проводим через презентер потому что именно он принимает решение как нам реагировать и соответственно когда презентер скажет что нужно скрыть мыслишь мы вопрос скрываем вот но здесь есть одна подстава одно очень неприятное место кто догадывается в чем он заключается нет все скажем так в чем проблема общая лир диалога если вы его показали повернули устройства и больше ничего не делали нет он как раз таки пропадет почти вот в общем короче android влоги на ругается что произошел винда улик вот соответственно что нам нужно сделать нам нужно вон ди строя просто скрыть этот alertdialog соответственно мы его скрыли active activity повернулась да у нас заново придет команда из презентер а что нужно показать нужно показать диалог вот но здесь опять спрятался на подстава так подумайте немножко то здесь не так получается что он произойдет когда у нас вызовется wallet диалога dismiss у него отработает он же смысле из них а вон ди смысле с ними мы написали что презентер мы хотим скрыть диалог соответственно президенте же такой а хотите но скрывайте значит вы устоите последняя команда будет хоть message вот неа почему он юшка не получит команду из презентер а но презентеров президента поймает вот эту команду вот соответственно нужно сделать еще одну хитрость нужно сказать и смесь весь вижу что все это уже у нас не логика пользоваться интерфейс это у нас уже просто касты для лир диалога вот но и это довольно часто проще написать вот такой метод он destroy чем и использовать фрагмент диалоги потому что все таки фрагменты они тяжелее чем aylar диалоги вот а ну и собственно в президенте ритмы на он здесь мест массаж просто green view стоит у чтобы он скрыл мышь так и в интерфейсе view him и соответственно добавляем новый message прах мой новый метод проход message вот и в результате мы имеем ожидаемое поведение то есть диалог показывался то он показывался если не показывался если мы его скрыли тонн соответственно уже пользователь не будет отображен так теперь давайте немного модифицируем задачи представим что у нас приезжал дизайнер говоришь что конечно ваш оля в диалоге красота неписаное но давай очень сделать другой там снэк-бар используем или еще курить кастомную вьюшку вот и здесь у нас как раз уже включается все прелести mvp то есть мы меняем логику отдельно отображения отдельно соответственно что от нас будет требоваться нам нужно будет изменить метод show massage в котором мы собственно там же не флэте вьюшку да и покажем ее и вот кстати у нас здесь определенным клик есть не на конкретную кнопку и вот по нажатию на эту кнопку мы в презентер говорим что мы захотим dismiss message вот и в результате как быть для презентер а ничего не изменилось вообще пофиг насмешишь показался вольер диалоги или в кастомные view he вот и в то же время когда из президенте ля придет хай message мы эту в юшку просто удалим узла ялта вот то есть это причем действительно так работает ну потому что дизайнеры все время хотя каких-то изменений но стороны логики как бы у нас ничего не меняется вот и действительно приходится делать такие небольшие изменения всегда вот и в результате у нас получается ожидаемое поведение теперь в принципе вот совью stay там это все то есть ну вот он ну так просто работает то есть вы просто описывайте по сути от вас требуется только описать интерфейс в ухе и отметить президенте ранда цией inject you state вот и все это будет работать само собой теперь рассмотрим несколько другую задачу у вас есть activity и в ней вы хотите показывать два фрагмента и в каждом фрагменте есть кнопочка плюсик вот и по нажатию на этот плюсик там в каждом фрагменте есть свой счетчик ну и значение счетчика должно увеличиваться вот этот пример привел чтоб показать особенность аннотации джек презентер просто дело в чем если бы мы для эффекта презентеров использовали бы dagger то нам бы пришлось попыхтеть чтобы вот у нас одновременно из два фрагмента но в них должны сами же катится разные президенте но после пересоздания в каждый фрагмент должен попасть старый презентер вот за дагером нужно было бы пописать много кода вот с moxie это просто антоциан джек презентер и все вот то есть мы берем activity в нее просто добавляем два фрагмента вот мы просто вот эти два фрагмента разными цветами разукрасим чтобы можно было отличить один от другого вот соответственно в презентеры мы в конструкторе сразу говорим что в you state покажи текущее значение счетчика как бы у нас уже в you stake есть потому что он еще в дефолтном конструкторе установился текущее значение счетчика 0 все на 2 фрагментах будет показан 0 и соответственно когда пользователь нажмет на плюсик мы увеличим каунтер его view стоит отправил новое значение на отображение соответственно в интерфейсе view he мы говорим что в юха должна уметь показать значение и собственно описываем интерфейс фрагмента соответственно мы в этот фрагмент за magic team презентер вот затем установим я вот этого фрагмента найдем там вот эту нашу кнопочку плюс и скажем что на плюс в презентер нужно сказать что презентер давая увеличивать на плюс и когда придет значение с презентер а мы просто его отобразим и в результате у нас получается ожидаемо проведение то есть тут опять заметьте нам не пришлось ну как-то напрягаться то есть она интуитивно работает вызовем жэк или презентер и вы не думаете у меня точно тот за инжектит а потому что у меня ж тут то еще такой фрагмент такого же класса в это же время находится то есть нет все связи они как бы один к одному спокойно живут вот вам об этом не приходится париться но есть довольно популярное довольно популярный вопрос а как мне быть если я хочу общаться например между двумя фрагментами или президенте раме между двумя activity view хами в общем ну давайте общения между различными компонентами интерфейса пользовательского вот тут у нас уже включается чистой архитектура то есть допустим мы хотим чтобы у нас были два фрагмента которые как бы разные вот но нажатии на один плюсик влияло на оба счетчика вот соответственно что нам нужно сделать нам нужно завести некий in трактор который мы например дагером за magic team в презентер вот ну и соответственно этот in трактор уже будет сингл тоном объявлен внутри дагера вот и нажатии на плюсик мы соответственно про бросим в этот interact or и в фонде строя презентер а мы просто отпишемся от этого in трактора то есть мы у нас же как там бы соответственно у нас в интерактиве будет сделан subject вот в котором в которой собственно будет всегда и метится новое значение счетчика и соответственно презентер прямо в конструкторе подписывается на вот этот и meter значение счетчика и просто отправлять во вью стоит новое значение и в результате мы получаем чистой архитектуры общения двух разных фрагментов никак не засоряя не сами фрагменты не презентеры то есть мы вводим это на слой модели вот это делается так довольно просто ну и соответственно то есть через антракта вы можете там массаже прогонять данные различные между 2-ым фрагментами делайте уже что хотите далее у нас идет следующая задача так а в общем ну допустим есть люди которые не любят фрагменты потому что у них жуткая api то есть там lifelike вот это все то есть они видят что там мокси работает можно не переживать за lifecycle но они всё равно не доверяю то есть хочется использовать какую-то кастомную view hу вот и соответственно перед нами встает задача как нам кастомную view ху превратить в виде view чтобы в нее тоже можно было так же легко написать inject презентер прапора пам и все и чтоб у нас все потому самоа тащилась де точило сью стыд наказывался вот давайте сперва посмотрим как мы activity превращаем в activity в общем мокси есть некий mvp делегат соответственно в его просто мы пробрасываем события что там activity создалось что она готова получать команда из уст и этого момента старта вот затем мы пробрасываем в этот делегат что activity сохраняет свой стоит соответственно в этот момент там moxie перестанет уже взаимодействует с этой activity вот соответственно нон-стоп она говорит делегату что все где-то чем это activity и ван де строй она говорит делегату случае если activity финиширует она говорит что все больше нет нужды в этом презентеры то есть в президенты рах которые при а то чины к этой activity потому что она уходит из bags т.к. и соответственно презентеры уже не нужны соответственно в этот момент мокси вызовет у презентеров он дестрой что вы могли там от субъектов отписаться вот и уберет этот презентеры и из презентер скоро вот и соответственно нам нужно теперь взять и кастомные view ху превратить в импе view соответственно мы у нее сделаем некий метод init в котором мы дернем соответственно метод oncreate и он attach соответственно в этот момент будет за injection презентеры в эту кастомную view ху и она будет придаточных презентеров вот и соответственно когда у в ухе будет вызван он detached from windows это значит что в ухо больше не видно пользователю значит нам нужно не получать командой из презентер а соответственно от нас требуется за detach идет в you had презентер а собственно мы это и говорим сделать вот тут есть одна особенность что мы вызываем он сейф incense стоит в этот момент просто причем не передавай никакого бангла в этот момент делегат возьмет родитесь ну как бы у нас это кастомное view х находится внутри activity соответственно когда когда в activity вызовет соуса iv и состоит она сможет у всех своих судов тоже вызвать он сафин стоит передав им вот бандл свой вот соответственно то делать вот так просто вот тут одна особенность собственно когда мы и не тим вебе делегат мы в него передаем айдишник вот этой нашей вьюшки чтобы и и собственно делегат вот этой зимой activity это нужно для того чтобы презентеры 1 вьюшки отличайся другой вьюшки вот вообще это ну типа самое сложное сейчас мокси в мозг самое сложное место в максе эти кастомные делегаты вот но с ними можно разобраться то есть посидеть чуть-чуть посмотреть когда какой метод вызывается что можно передать в парном делегат вот и все после этого можно хоть 10 презентеров задержитесь в эту кастомную view хуану как бы будет работать и никуда не денется и в результате собственно мы получаем то поведение которое ожидаем теперь еще пара задач первая задача предположим у нас есть экран со списком новостей у нас на этом экране кроме новостей должен быть свайп ту refresh и если произошла какая-то ошибка загрузки данных то мы хотим показать тост в чем особенность этой задачи во первых слайд ту refresh написан как-то очень непонятно то есть он весь асинхронный то есть допустим если вы покажете там вроде как там старт плотник старт-стоп loading вот то у вас мелькнет вот этот вот прогресс sick соответственно у нас какая задача но задача сделать так что если у нас прогресс не отображается то когда в yoohoo точится заново чтобы она не получала команду шоу прогресс она только хотела прогресс вот и соответственно с толстым какая особенность мы хотим чтобы тот показывался один раз ну потому что если пользователь после каждого поворота устройства будет видеть тасс но это будет не очень клево соответственно для решения этой задачи у нас включать механизм стоит встретить же так называемый то есть у нас можно определить как с какой стратегии каждая команда находится в очереди везти-то в очереди команд то есть когда команда отправляется во вью стыть она сперва вы выполняет стратегию be fair play затем когда команда применится капри отточенный в ухе она вызовет autoplay таким образом можно менять очередь команд прям вот в грантами вот и соответственно каждой команде можно указать стратегию через аннотацию с стоит строитель же type также эту аннотацию можно применить ко всему интерфейсу view то есть в таком случае эта стратегия будет времена к каждому методу у нас по умолчанию вот здесь указано указано стратегия этот сингл встретит же за счет этого в очереди команд будет храниться по одному экземпляру каждой команды вот то есть если мы два раза отправим show news feed the у нас только последняя команда будет находиться вот в очереди уст это вот но соответственно у нас есть еще команда show rh мы хотим чтобы она показалась один раз но обязательно показалось вот и больше не отображалась ответственным применим к этой команде стратегию one execution стоит 3 g за счет этого собственно эта команда в не так в общем когда выполнится стратегия be fair play эта команда спокойно ся просто будет добавлено в конец очереди команд вот но когда вызовется авто и play это значит что эта команда уже применилась какой-то вьюшки и значит большие и показывает не нужно и в этот момент это команду уйдет и в очереди команд то есть если на момент вы вызова команды shower ни одна вьюшки не было прятать на эту команду будет спокойно находиться в очереди но как только она применится соответственно отработает стратегия авто экзо пьют и эта команда покинет очередь вот и еще соответственно у нас остается две команды показать loading и скрыть loading нас какая задача хранится чтобы если то есть когда когда во вью стоит попадает одна из этих команд чтобы другая соответствующая пропадала например если у нас уже в очереди команд есть старт padding мы отправляем финиш логин нам нужно чтобы старт lading был удален из очереди команд вот для этого мы собственно сделаем свою кастомную стратегию и добавим на обе эти команды один общий так собственно внутри стратегии мы по по общему току будем вычислять что у нас уже есть такая команда и будем удалять вот ну и собственно дальше я приведу вот эту стратегию то есть в ней просто мы идем по очереди команд и как только мы нашли команду с таким же тегом мы ее удаляем из очереди команд после чего вот эту команду которая к нам пришла мы просто добавляем в конец очереди вот и в принципе все то есть таким образом получается ожидаемое поведение если два раза показать соответственно будет один раз показать ну то есть на самом деле там можно можно очень по-разному сделать например если бы у нас вот например мы бы могли даже на шоу р навесить так такой же тогда вот но он находится с такой стратегией то есть например у нас может быть 10 команд например с одним тегом в очереди команд и когда выполнится команда именно с этой стратегии то есть это стратегия начнет работать и она просто удалит все с таким тегом вот то есть макси есть несколько дефолтных таких стратегий их старцы можно посмотреть они ну очень простая то есть вот есть лист команд карен стоит это который описывает собрано ну текущую очередь команд и вот в метод by hoy play приходит вторым параметром собственно команда которую мы хотим применить вот ну и соответственно мы хотим применить хай clothing соответственно он бежит по очереди команд находит все команды шел adding и удаляет их вот ну и то есть можно такие делать кастомные стратегии на самом деле достаточно в 99 процентах случаев достаточно дефолтной стратегии типа есть стратегия не складывать в очередь команд сложить просто стеком то есть вот пришла команда просто добавить пришла пора добавить пришла добавить то есть по молчанию она работает и есть стратегия там добавить в единственном экземпляре то есть если у нас шоу хайд то допустим если еще раз придет шоу то у нас будет хоть шоу то есть первый шоу будет удален вот и последняя задача которая перед нами осталось это собственно показать например у нас есть экран с деталями новости соответственно нам нужно это сделать ну сперва мы конечно определим интерфейс в ухе что в юха у нас должна уметь показать новости затем мы определим презентер вот причем мы знаем что у нас это презентер для деталей новости соответственно мы хотим прямо в конструкторе сказать детали какой новости мы хотим грузить ну потому что это логично и просто вот но перед нами встаёт одна проблема которая заключается в том что раньше мы не управляли процессом создания презентеры то есть мы просто писали джек презентер магическим образом получали правильный презентер вот чтобы управлять процессом создания презентер есть аннотация прорвать презентер вы просто вешаете эту аннотацию на метод который у вас будет отвечать за создание презентеры и внутри этого метода создаете новый экземпляр презентеры пора пора по все то есть она уже работает причем этот метод будет вызван только в том случае если мокси посчитай что ей нужно создать новый экземпляр презентер а соответственно если вы activity перри создаете этот метод уже не вызывается мокси и вы себя из недр а где-то до станет правильным презентеры начнет с ним работать вот поэтому были курьезные случаи когда люди делали метод pro white презентеры и в будущем работали не свел дай презентер а с этим методом и у них поставил создавался новый презентеры и они не понимали о чем не очень очень работает вот в общем этот метод не используйте причем студия вам даже немножко поможет то есть когда вы этот метод только напишите он у вас должен быть как отмечен как неиспользуемый вот после того как вы первый раз запустить этот код то максис генерит код этот кот уже начнет ссылаться на этот метод и у вас все будет хорошо вот первая часть все у меня заканчивается время поэтому давайте сейчас по вопросам пройдем а дальше если останется время еще по жести пройдут можно на экран со стратегиями спасибо кстати за доклад из замечательная библиотеку спасибо вот это да нет нет раньше ща вот у нас света аннотация state street ii g type есть не только у интерфейсных полей до но и самого интерфейса и суд у него изменить стратегию на что это повлияет это повлияет на метод show news feed то есть если у метода не указано какая-то конкретная стратегия то у него просто работает стратегия интерфейс по умолчанию дефолтные бургас да да да но чаще всего то есть мы указываем стратегию всего интерфейса вот именно вот эту эту in single то есть иметь команду последнюю то есть если две пришли одинаковые только последнюю иметь в очереди команд вот ну и чаще всего там какой-то shower or используешь санок запиши на все остальные просто то есть последнюю храните все равно потом нормально приводится в сцене хорошо можно еще такой вопросик а можно для вот у нас был пример с двумя фрагментами а можно ли сделать один презент для двух view вообще как бы можно ну например через права от презентер предоставлять один и тот же экземпляра презентер вообще в максе я сперва не очень правильно понимал подход им в.п. вот и есть так называемые глобальные вик презентеры то есть мы в аннотации джек презентер можем указать ток но можем сказать что у нее тип глобальный презентер и определенный тег вот и если мы где-то еще будем инжектить тоже глобальный презентер с таким же тегом будет задержек чем этот же презентер и соответственно в you стоит тоже сразу на него на катится вот но этот подход все-таки неверные в плане чистоты архитектуры то есть правильно все-таки используют общие тракторов на одну вьюшку один презентер так будет чище правильный спасибо большое спасибо за доклад а у меня есть вопрос в момент смерти activity презенты где хранится вопреки шине но вообще презентеры хранятся кстати com api грубо говоря а это просто класс да да это просто класс который живет в сингл тони вот соответственно мы к нему обращаемся и покажу их процесса живет этом апа и мы получаем но собственно в бандле мы сохраняем айдишник делегата вот когда у нас вызывает song ритмы в делегат передаем бандоу он достает там свой едешь ник и генерирует уникальные техники для презентеров и идет вот в этот торт из него получает уже конкретный экземпляр презентеров в applications мы как-нибудь объявляем например когда нет ничего делать не нужно вот причем все это работает без рефлексий то есть она и без рефлексии и не нужно как в доберет этот компонент свою задавать вопрос еще про президента в какой момент освобождается из памяти и если мы в activity перейдем activity в xp key потом вернемся на новый презента создаст или старый если мы уйдем на зато потом опять вперед на зиму идем вперед а потом нажмем назад а старый тот презентер то есть он сейчас покажу то есть какой вообще жизненный цикл вот сейчас будет но вот собственно вон дестро и в делегат говорится он дестрой только в случае если activity финиширует это значит что только если она покидает back stack все и больше не увидим но значит тогда когда мы заново придем то это уже новый activity линии новый презентер а если мы идем побег стеку вперед и верхним устройство то соответственно из finish and falls делегат не уходит дестрой и соответственно он презентер оставлять в покое спасибо спасибо за доклад вот когда вы делали кастомные view вместо фрагментов там вы принято лизации как раз таких делегат передавали он вот он creaton attache и вот это вот может быть я что-то не понял вот этой функции и нет процедура она получается должна вызываться кем и откуда если из activity тут то есть ее то есть нам нужно в каждой activity прописывать эти и нет и или как да и он нужно вызвать и из activity просто вы должны передать каким-то образом вот этот родительский делегат потому что без него но не получится потому что мы не можем бизнес кастомной в ухе сказать отдай мне текущей активе но мы не можем например сказать в максе дай текущей делегат потому что прям может быть два фрагмента и какой тогда эти ли гадать помимо того чтобы эти вещи просто там разместить на экзамен кеном и хочу нужно все проинициализировать которые у нас это да странными способами мы все кастомные view я сильно не используем поэтому и не придумывали особого какого-то решения вот приседай вот предчувствуя вопрос с подвохом нет он простой на самом деле мне идея очень интересная в плане того что есть определенно очередь команд в августе эти вот и собственно вопрос про overhead вот я так понимаю что управление очередью происходит через аннотацию стоит strata джидда у вас вот а если у нас на вьюки получается необходимо выполнять очень много быстрых операций то получается без правильного управления у нас очереди команд будет достаточно много там будет и получается после поворота экрана у нас вся эта очередь будет применяться по очереди до правильно вот собственно у нас получается туда очень большой вверх это z весом и правильно как что не управляем даже если учесть не выстроим views this type ну а затем у него каждому стратегию там банально этот сингл то будет просто весь стек хранится и вот если вы там будете своей трифосфат refresh там миллион раз то это миллион раз потом при восстановлении стоит он типа скажет покажи прогресс покажи прогресс покажи прогресс вот я делал тест и я вот если 10000 раз отправить команду там show how high the нормально работает спасибо так а у нас время еще осталось или нет и не пойму меня здесь час прошел а там на часах все упал 5 а мышцы ранее запустили все я извиняюсь у меня просто здесь показываются что я уже час рассказываю а я же за заранее запустил презентацию значит у нас будет время немножко на жесть в общем я честно скажу что происходит внутри макси и когда вы например вообще запускаете ее то есть как происходит определение всех этих штучек спи рассмотрим принцип действия аннотации джек презентер сперва когда вы запускаете код annotation процессор проходит по всем полям отмеченным that's a magic презентер и генерирует некоторые классы презентер field вот затем когда у mvp делегата вызывается он creed он для каждого презентер хилдегард уникальный адэшника после чего он идет так называемый класс мокси рефлектор макси рефлектор это специальную классу чтобы избавиться от рефлексии вот он как бы сгенерируется и делегат пойдет в этот класс и получит список собственно уже готовый президент field of вот этих и затем вот в момент вызова oncreate у делегата некий процессор начинает идти по всем вот этим тренер feat объектом затем генерирует уже так вот этого конкрет конкретной хильды и затем пытается из презентер stora получить презентер по вот этому айдишник у вот и если он есть в этом история то соответственно у класса презентер field есть метод имеет и в этот метод init приходит собственно таргет объект ну то есть вот это наше activity например вот причем как в этот код сгенерирован и мы знаем в торги вот в этот объект таргет в которую в какую fille du нам нужно поставить презентер и собственно вот этот презентер который пришел и презентер сто раз собственно подставляется это нужно презентер иначе вызывается метод презентер филби правой презентер собственно в этот момент там просто написано реки минью там вот это наш презентер либо вызывается метод который у вас отмечу нотации правит презентер после чего вот этот презентер будет сохранён штор и уже с ним про и не china опять же то же самое таргет филда затем что делает аннотация magic you state она применяется к классу презентер а соответственно когда вы запускаете код annotation процессор генерирует класс views дейта после чего когда в презент или вызывается конструктор дефолтный внутри презентер а внутри класса презентер определен приватный класс биндер вот этот биндер собственно создает экземпляр view стэйта и складывает его fille du wirst это внутри этого презентеров вот соответственно чуть этого в момент вызова getview стоит вы всегда получаете актуальный estate так 3 это собственно как работает вообще view state то есть вы из презентер и отправляйте какую-то команду view state создает экземпляр соответственно соответствующего класса команды то есть для интерфейса на каждую команду генерируется некий класс который extended интерфейс вроде команды вот просто паттерн в общем команда затем создает стратегию для этой команды ну получив ее из аннотации вот соответственно после чего выполняют аннотацию be fair play то есть чтобы мы могли команду сложить в очередь команд после этого он проверяет если к этому презентер у ни одна в юшка не при а то china это значит что у нас не одна вьюшку не выполнит эту команду соответственно не нужно выполнять метод стратегии autoplay то есть на этом нужно закончить работает не одна фишка не при а точна если же она при а то china да если хотя бы одна вьюшку придаточном идет по всем придаточным ухом выполняет эту команду после чего у стратегий выполняет autoplay и каждый раз когда к этому презентеры цепляется какая-либо в юшка к ней применяется эта команда ну нет команда применяться вся очередь команд и у каждой команды после применения выполняется autoplay вот так довольно просто работает и смотреть так поверхностно вот теперь давайте проведем небольшие выборы в общем а кто использует макси один человек вот ну ладно может кто и там чем-нибудь понял тогда больше людей сможет проголосовать в общем у нас как аннотация magic презентер она в момент вызова oncreate создает экземпляров презентеры и подставляет la fille du а также она отдача teddy то что этот презентер вот и появилась идея сделать аннотациям жак ой attach презентер соответственно можно будет вон крите самому там как не дагером проинициализировать этот презентер вот мокси уже вон старт сама ну увидит что этот позитив нужно только a touch by touch вот уже сама будет а то чуде точить и вот этим вот всем заниматься поднимите руку кому нравится такая идея ну да да да просто сейчас нужно будет сделать метод правит презентер abs abs да вот и причем нужно еще и в методе oncreate перед супер так как проводить презентер вызывается в метод супер он крик нужно перед супер он греет сказать да гяру чтобы он сюда нам за их же kill вот а так ну про white презентер не нужен аннотация inject презентер не нужно то есть мы вызываем супер он клеит потом берем com говорим компоненте суда за inject вот и все то есть и на это фил дума вешаем аннотацию жкс дагера и attach презентер из мокси ним можно не dagger можно там и зло дира достать или там из синглтон этот презентер то есть мы мы главное что мы вон крий эти после он супер а можем спокойно проинициализировать а вон старте у нас уже все типа она прячется и спокойно пойдет я чуть ну да да не тут кстати в комп алтай не получится но мы только вон крите сможем по идее понять что iphone старте он старте mon0 при этом енп и я просто свалимся т.к. может инжектит не через дагера просто там с нормально но это нормально я не очень понял тем что нужно делать по white презентер просто если люди каменной начинают все это тестировать особенно какие не делают тесты интеграционные тесты когда делают им соответственно нужно мог презентер и соответственно даже их и у них все презентеры создаются через дефолтный конструктор им все равно нужно написать вот этот метод право it презентер то есть в тресну там нет просто мы так и так дагера magic team у нас аннотациями сжег навешано нужно еще и метод определите по вот мои джеки на самом деле можно его перед супером это но это некрасиво выглядит что уже все привыкли что сперва супер а потом уже пошли наш код писать можно вообще в конструкторе там когда в activity вызывается метод он дестрой и она будет из финиш young dan da da то все равно презентер продолжает жить затем вы ну есть такой кейс что типа android может не только процесс уничтожить чтоб сохранить память вот ходят байки что короче android может уничтожить именно прямо на компоненту activity вот и говорят такое было на android n 1 и 5 это реально замечали но сейчас вот какие я взял просто девайс какой-то древний там был android 2 и 3 нашел в офисе там поставил специальный прилож чтобы ему память забивалась но все равно такого не было чтобы android уничтожил только activity но даже если уничтожить только activity он вызовет он сейф инсцест и соответственно в банду сложится айдишник делегата и у нас как будто просто повернули устройство соответственно презентер старый возьмет при а то часа на качестве стоит все будет хорошо так и в результате что мы имеем мы вообще не беспокоимся жизненном цикле но до тех пор пока мы делаем свою кастомную вьюшку но самом деле этим довольно мало вроде к кто занимается вот что с conduct а мы нет как то нам и фрагментов activity хватает вообще за глаза вот но с кондуктором кто-то на гитхабе льда же вроде кидал гис то есть там там контроллер вроде есть какой-то там в контроллере и типа пару методов делегата подергайте тип все работает вот соответственно про жизненный цикл мы не беспокоимся если кастомное view жко мы только один раз поняли когда нам вызывать методы релинга ты все в то же время не к более в plateau но столько аннотации в то же время никакой рефлексии затем можно и жить несколько презентеров в одно activity то есть если у вас например сложный activity сложный фрагмент то вы спокойно делите его на разные презентеры который отвечает за конкретную логику например ос на одном экране есть и новости и комментарии к этой новости то вы делаете два презентеры и у вас получается как бы презентеры маленькие интерфейсе вьюг маленькие и вот сингла responsibility потом взяли опять же поделили этот экран новости и фрагментов новости и комментариев на разные фрагменты у вас уже президенте и готов интерфейсе в их готов то есть все готово просто разнести все вот и можно так вот и там легко перес пользуетесь все дела так ну и любой интерфейс можно любую штуку можно превратить в виде view то есть даже позже объекту из например у нас проекте реально есть такое место что у нас есть очень сложный list view вот или риса киры видом неважно в общем я просто превратил view holder в mvp в юху и прям holder легче презентер там просто пришлось реально попыхтеть над вызовом в виде легато и таким образом у меня позже объект стал в пивихае все я в него а точу презентер и сжечь презентер и все работает и не нужно вообще беспокоиться вот в принципе на этом все присоединяйтесь гитхаба у нас там довольно много тоску же повешен на люди делают pull request и библиотека живет то есть реальный плюс что люди делают pull request находят баги сообщают о них мы уже много через провели"
}