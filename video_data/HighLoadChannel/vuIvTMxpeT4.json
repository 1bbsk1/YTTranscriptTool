{
  "video_id": "vuIvTMxpeT4",
  "channel": "HighLoadChannel",
  "title": "Учет данных о поведении пользователя в метриках A/B-тестирования / Никита Поваров и Роман Поборчий",
  "views": 826,
  "duration": 2829,
  "published": "2018-11-20T12:10:08-08:00",
  "text": "а очень у вас здесь всех видеть на мне для для контроля четности поднимись просто руки те из вас кто у себя на работе имеет какое то отношение к проведению экспериментов над пользователями окей ну да у вас довольно много я надеюсь может быть что после после сегодняшнего доклада ваша жизнь уже никогда не будет прежней тут все очень просто немножко арифметики и там пара формул буквально будет но таких вот прям ну простых откуда все взялось мы с коллегой никита их работали несколько лет назад в яндексе вместе но потом наши профессиональные пути разошлись сейчас он в частности работает в jetbrains и там тоже проводят эксперименты над пользователями на представьте себя это еды я вы знаете на чем компания jibo не занимается но там проблема в том что над платящие пользователями нельзя проводить экспериментов эксперименты можно проводить только на теми кто явно за зал принялся явно поставил галочку я согласен что надо мной будут экспериментировать таких всегда очень мало кто из вас когда-нибудь явно соглашался на какие-то такие вещи редко вот поэтому у него в реально очень маленький выборки над которыми можно что-то сделать меньше тысячи человек в контроле меньше тысячи человек в эксперименте а и вот с применением техники о которой я сегодня хочу поговорить ему удается нормально получать значимые результаты даже там а вот и те из вас у кого случалось эксперименты проводить в рассказе ну бывают проблемы до что читают блин не хватает пользователь ищет не хватает но не не дает эксперимент результата значимого частая проблема хочется так к кому не хватает пользователей есть такие на хвост вот сейчас сейчас будем с этим бороться и что чего еще зависит хватает нам пользователи или нет получилось или нет там есть несколько вещей сейчас будет три вещи на но надо ее он всё рассказать чтобы дальше было понятно где бы первая вещь это величина эффекта который мы измеряем если мы сделали что-то очень хорошее или чаще что-то очень плохое плохое мыть чаще на очень плохое сделать гораздо легче чем у очень хорошие естественно что-то сломать то нам надо меньше данных чтобы у нас эффект проявился конечно же от величины эффекты зависит от дисперсии до того насколько те данные которые мы измеряем внутренней разбросанный сильно на если они хорошо сгруппированы вокруг своих средних то естественно все быстрее отработает и лучше будет ну и от количества данных которые мы насобирали количество данных но обычно это как раз вот те самые пользователи которых не хватает хотелось бы побольше но нам раз явную раза больше пользователя пользователи уже кончились что делать чем про величину эффекта мы сегодня больше не будем говорить потому что это зависит не от тех кто измеряет а тех кто делает ну и тут уж как как они сделают так и сделают мы немножко поговорим про то что делать вот с остальными двумя пунктами в первую очередь с дисперсией когда я простым каким-то своим знакомым даже и зайти но не имеющим отношения к по тестированию к экспериментам рассказывал что ну вот я про такие вещи рассказывал этом вот я этим занимался когда-то и где-то тут вообще может быть сложного допустил той группе одну эту игру подруга и кто лучше тот пошел в продакшен ну круто и я понял что у людей в голове вот у них какая-то вот такая вот картина как это все устроено вот такая вот им кажется что у нас есть версия а но допустим допустим это магазин да и и чеки на которые им кажется что вот у нас есть значит они вот какие-то такие есть бы они какие-то кен уит конечно же сразу понятно кто из них лучше кто из них победитель вот ты чо тут думать какая тут может быть сложность к это может быть наука давайте еще несколько слов почему это не так а еще вопрос кто из вас был год назад на моем докладе про этим драфт интер living здесь же по моему даже в этой же аудитория не никто не был окей а вот парочка были начинаете не пугайтесь я сейчас покажу ту же саму картинку это новая новый алгоритм которые не рассказывал еще новый доклад но картинка мне нужно то же самое потому что она иллюстрирует проблему хорошо эти пара слов да вот представим у нас есть вот такая клиентка у нее все нормально да она скорее всего довольно богатого никита винтажная машина она на берегу моря но тут не очень хорошо видно что она на берегу моря на проекторе но по факту она именно там вот все короче нормально и если она приходит допустим в наш магазин что-то покупать это верно не только для магазинов не только для метрик конверсии мы поговорим но важно то что она если попадет в плохую версию допустим контрольную а она похуже она оставит сколько ты денег если попадет версию б она оставит чуть больше денег потому что там ей может быть чуть чуть лучше предложат дополнительных товаров и чувством как-то получше и рекомендации сработает если у нас есть еще другая клиентка так тоже может быть может да и у нее вот как-то похуже все с деньгами видно да что как-то она страдает на эту тему то она придя к нам что-то покупать она вот оставят версия и быт уж там по-разному версия чуть меньше видно это здесь до здесь видно нормально но при этом богатая тетя которая попала в плохую версию все равно оставит у нас в магазине гораздо больше денег чем бедная тетя которая попала в хорошую версию а вот это это будет один из таких мощных источников дисперсии то что люди гораздо сильнее при прив скукота нормальном нашем сервисе люди гораздо сильнее зависят от своих внутренних привычек от своих внутренних свойств чем от качеств нашего сервиса ну кроме случаев когда мы что-то смертельно сломали но этом обычно быстро замечаем и поэтому да естественно картина получается какая-то не такая а какая то вот скорее такая да и вот поди тут разбились кто из них лучше можно их усреднить да и вот видно что один из них в среднем чуть чуть лучше чем другой но в общем если там пара каких-то еще богатых клиентов придет версию а например попадья на ее лучше будет если у нас него еще много данных тут трудно это все делать поэтому поэтому приходится наворачивает математику приходится наворачивается тесты ну вот это все приходится делать чуть чуть позже мы к этому вернемся из истории важно вот если посмотреть тут есть мы не знаем какая тут шкала может быть оно даже логарифмическая папа по размеру человека это может быть даже так у нас есть если заметить несколько очень богатых клиентов их там мало ну как и должно быть их немного но они есть и поскольку их совсем мало это они легко могут очень не равномерно распределиться между сторонами экспериментом и все у нас миллион людей и мы их ищет раскидываем ну там так сяк они нормально раз кидаются если среди них есть сотня которые создают нам не знаю половину трафика половину дохода половину чего-нибудь что вот эта сотня легко может расквитаться неравномерным это очень обидно и такой эффект с которым раньше начали бороться потому что ну вот как стали замечать что есть такая проблема вы стали бороться с помощью такой штуке которая называется стратификация для что это такое вот недоумении от художника я вам покажу термином стратификация вот как-то так как то так выразил коллеги кирилл это но если серьезно то техника там понятно какая мы пытаемся найти какие-то параметры которые не зависят от качестве нашего сервиса но которые влияют на поведение пользователей и попытаться посмотреть вот пользователи по этим параметрам равномерно или неравномерно разбились допустим вот интересная вещь что есть такая штука день попадания в эксперимент например если он нас эксперимент идет не делю на ту пользователь может впервые прийти в понедельник во вторник или там какой-то другой день может впервые прийти и там в последний день в субботу оказывается что это важно что люди которые приходят в субботу в среднем ведут себя не так как люди которые в первый раз пришли в понедельник и например можно посмотреть одинаковы ли у нас раскиданные по сторонам эксперименты люди которые в первый раз пришли в понедельник вторник и так далее если нет то можно перевесить да можно и если выясняется что те кто пришли в субботу в сторону а попали в два раза больше чем в сторону b если параметров много дату какой-то из них обязательно раз кидается неравномерно даже на большом числе пользователи понятное дело и можно нам в итоговый метрики это перри взвешивать на и вот люди пытались это все делать значит у них там час попадание в эксперимента там те кто приходят ночью там они оказываются другие чем те которые днем браузер очень классная штука люди которые пришли из хрома они совсем не такие как люди которые пришли из интернет эксплорер это же надо смотреть что они нормально раскиданы возраст пользователю в системе в общем одноразовые новые пользователи ведут себя не так же как те кого мы знаем давно вот и такая самая яростная ударная штука которая очень много давала это значение метрики за какой-то предыдущий периодом и что-то измеряем вот а если измерить это для этого же пользователя за предыдущий период а оказывается что те кто в прошлом периоде мало нагини rifle и нечего тут же их надо равномерно раскидывать этих кто много ноги не дел тоже надо раскидывать равномерно как оказалось вот с одной стороны то чем мы занимаемся это предельный случай и вот этой вот стратификации а с другой стороны вот если сюда посмотри на чё вообще говоря хотелось бы измерять вот хотелось бы измерять не вот этот большой черный столбик да потому что он у каждого свой хотелось бы измерять вот эту вот разницу да вот вот эту вот штуку хотелось бы на самом деле измерять чтобы понять пользователь от себя от нормального она от себя как бы в состоянии не экспериментальном в продакшене а он как отличается в ту или другую сторону потому что вот эти хвостики они во-первых более нормально распределены они могут быть вверх и вниз и они собственно не так сильно разбросаны вот собственно на кого пользователь больше всего похож каково вот взять такого с кем сравню пользователь больше похож на себя в прошлом собственно вокруг этого вся методика и строится она очень простая и прям арифметика что мы делаем вот допустим м юзер этого то метрика которую мы считаем до каждого пользователя за эксперимент кайта м.н. и что мы делаем мы берем того же самого юзера и какие-то данные из его прошлого если они есть вычитаем и это и есть наша новая метрика которую мы собираемся использовать в качестве основной теперь для любой метрики которую нам интересно считать можно строить вот такую производную метрику mb основанную на вычитание прошлого тут есть несколько тонкостей если у нас есть данные за один прошлый день а эксперимент мы держим например неделю то умножить этот день на 7 плохая идея потому что что потому что дни все разные в неделю они вообще друг на друга не похожи если у нас эксперимент происходит в четверг и пятницу например то совершенно не круто использовать в качестве предыдущего периода вторник и среду ну потому что понятно они отличаются логично либо неделями это все резать либо по крайней мере чтобы предыдущий период у нас был с такими же днями соответствующими вот можно брать одну неделю до из предыдущего опыта можно усреднять даже несколько опытов сша понятно там недели все разные когда-то у нас праздник может быть когда то еще что то когда то мало ли еще какие-то события происходят поэтому одна предыдущая неделя может не так хорошо представлять наш вы пользователя как усреднение его поведения за несколько предыдущих но это уже там всякие тонкости плитой и так и так работает если у нас есть хотя бы данные за прошлую неделю и эксперимент мы держим неделю то все к нам отлично будет и вот и ссылка потом можно будет и презентацию конечно скачать сайте конференция вот это основополагающая статье 2013 года от нескольких авторов из бинга по моему среди них урон кахаля в которой эта техника впервые описана есть пять лет прошло с тех пор как это произошло давайте вопрос вот то что я сейчас рассказываю вот этот прием кто-то его применяет слышал там для кого-то это не новость у огонь и смотрите это крутая штука it works пять лет важно в чем халява состоит реально выгоду от 100 процентов потому что мы гораздо чувствительнее ловим вот эти вот изменения в поведении в пользователя потому что мы еще раз мы ловим не сама поведения пользователя а его дельту по сравнению с нормальным по сравнению с ожидаемым а и это гораздо более более чувствительно вещь реально скорее всего вам будет надо для тех же результатов в два раза меньше пользователей примерно ну или вы на тех же пользователях сможете провести в два раза больше экспериментов с системой самым количеством успешных исходов вот значит запускают вообще никак не меняется ничего не делать в чем и как пользователю показываем так показан в систему запуска вот это вот в продакшен в бой ничего трогать не надо всё вот как жил о так живет матче мне кажется кушать статистические критерии можно использовать тот же более того это распределение будет гораздо больше похоже на нормальное поэтому если вы как некоторые не сознательные люди в качестве статистического критерии используете тест который требует на самом деле нормального распределения данных которые там в нем есть дата вот результаты у вас будут ближе к корректным если вы будете использовать или вот эта штука и единственная проблема состоит в том что надо дружить и бывая да вот логе результаты предыдущих всех данных они такие раз и причащаются ну потому что место же хранить там это все дорого железный сервера диски и короче надо хотя бы вот логе какие-то сохранится предыдущей недели или предыдущий период чтобы можно было туда сходить и перерасчитает эту метрику ну и надо провязать естественно своего текущего пользователя с тем что мы о нем знаем в прошлом то есть вот единственный проблемный пункт это последний но в общем он наверное у него очень сложно вот допустим вот мы и решили все это делать что нам надо обязательно проверить на прям вот жизненно необходимо проверить чтобы ничего у нас ну прям на лету не сломалась 1 1 вещь из нити это тоже тривиально но я это скажу надо проверить что выгода действительно получается значит нам надо иметь какой-то набор экспериментов на которые вернутся задним числом peri peri peri посчитать и увидеть что мы действительно можем принять больше решений или что на этом наборе экспериментов у нас там не знаю перелью меньше стало что что лучше все а ну короче надо иметь возможность убедиться что мы все таки не зря это все делаем потому что мало ли бывает так что мы например ошиблись в реализации у нас выгоды нет или еще что-то не то короче обязательно это надо проверять ну как в любом внедрение вот вторая вещь чуть-чуть сложнее надо проверять что мы не сломали ошибку первого рода сейчас поясню что это такое и тоже спрошу кто делает кто не делает смотрите вот допустим есть тоже обсудим вот вы если проводите эксперименты там обычно иска это отсечка по уровню значимости на ноутом большинство работают 95 кто-то из 99 кто-то больше нам девяносто девять и девять процентов и если вы эксперт мы заметил у кого 95 стандарт в компания окей у кого больше руководит 99 или еще мышат я понял кто просто не уверен какое у него число что все остальные люди которые проводят эксперименты они как бы как ну ладно окей короче допустим 95 скорее всего 95 ищет вот мы провели один раз а ну да все вот эти книжки такие статейки горят на проведите хотя бы один на тест на перед тем как еще что то делать чтобы убедиться что все не сломано вот мы провели тест какой у него должен быть результат какой должен быть исход в оао теста если мы его провели у нас вот со значимостью 95 процентов от и знает когда мы показываем одно и то же обеим группам на ее контрольной и экспериментальной мне традиции что что должно быть ну вот это не совсем точный результат не совсем точный ответ хотя я естественно я его жду но на самом деле смысл такой он в 95 процентах случаев вам скажу что разницы нет а в пяти процентах случаев в пяти процентах случаев скажи что разница есть есть он имеет вероятностную природу это такой как это кот шрёдингера на которой непонятно жив или нет и что он вот может и так сказать может отключить и вы провели а тест и он вам с одной попытки сказал что разница есть это еще не трагедия на это повод там перезапустить попробовать посмотреть но в принципе он ну там маленький процент случаев пять процентов в данном данной ситуации имеет право ошибаться имеет право так сказать ничего страшного в этом нет и вот эти какая беда с одного запуска как проверить что вот это распределение у нас именно такое то плохо да плохо если он совсем никогда не говорит потому что скорее всего если он всегда говорит что разницы нет на тесте он ее на нормальных экспериментах на всех тоже всегда будет говорить что разницы нет так так вот жизнь устроена так вот эти статистические тесты работают что он вот на тестах должен быть откалиброван таким образом как проверить с одного запуска но правильный ответ никак не правящей есть техника на которую я призываю всех использовать она опять бесплатно никак не вредит вашим юзерам все прям классно вот смотрите провели мы 1 a test ну вот в данном случае вот эти вот странные разноцветные геометрические фигуры это пользователя которая у нас одни попали в группу а другая группа а h3 вот мы его провели вот мы все эти данные куда-то записали себе в стороночку после этого на дизелями мы уже никак не издеваемся при этом втором очки они лежат ничто не мешает же нам пробежаться да папа пологом и скриптом перри разбить юзера случайно им поставить другую группировку между а я и и ostrich взяли и перри разбили по-другому армяк так и они по-другому уже лежат и можно опять посчитать результат эксперимента можно можно можно еще раз так сделать можно так сделать миллион раз ну или 10000 или ну короче насколько хватит вычислительных мощностей и фантазия и тогда вы сможете из одного эксперимента лучше не из одного конечно муж там из нескольких потому что мало ли один какой-то косячный получился ты так бывает ну там из парочки можно на генерить себе миллиона а тестов и ну где-то в офлайне ничего и не порти не тратя юзер на и время не как можно просто взять и посчитать и и убедиться что она сходится примерно туда куда надо я призываю вас по возможности при до к себе обратно на работу если у вас это еще не делается вот эту штуку провернуть и посмотреть куда сходятся ваши эксперименты а потому что в тех местах где люди об этом не задумывались а я с ними общался им не удавалось их убедить а у них часто какие-то и сметы были поломаны там бывает что метрика и не соответствует критерию например эти данные для этого критерия используют нельзя наоборот точнее да и поэтому она выдает не тот результат например да там много таких вот бывает косяков то есть часть метрик может нормально отрабатывать самое ужасное что я видел на десятки процентов должно быть пять процентов а получается там не знаю 20 на это значит в принципе из всех экспериментов 20 процентов просто случайный результат вам выдают но мы же этого не хотим это не надо даже короче вот такую штуку стоит сделать при внедрении вообще любой новые метрики ну и время от времени перья перепроверять пири-пири повторяюсь потому что это классная штука она хорошо работает и ничего не стоит окей почему еще может быть трудно и непонятно как внедряет вот эту вот штуку с вычитанием прошлого арифметика да именно реально есть такие такие сервисы у которых много новых юзеров очень хорошо вам когда вы например фейсбук на и на фейсбуке без регистрации можно посмотреть только страницу регистрации на и больше нечего посмотреть нельзя а поэтому все пользователи которые видят какой-то осмысленный новый функционал они всегда залогинены вы их однозначно знаете причем они даже чудесно залогинены с разных устройств то есть вы в принципе даже знаете когда этот пользователь к вам приходил не знаю из дома с работой с мобильного это счастье когда у вас такая ситуация но счастье доступно немногим к сожалению конечно у нас всегда есть пользователи которые ну если мы магазин дай-ка бы и мы попытаемся без регистрации ничего не продавать то мы разоримся моментально если мы не знаю если мой поиск и попробуем просить людей залогиниться чтобы ему что-то давать искать то не все уйдут к тем кто не просит ее очень со всех сторон обложили трудно поэтому есть много пользователей у которых что у которых нет кук например на которые не берут их просто есть ну понятно и есть много ботов да вот важно вот это все не про очистку данных от ботов естественно подашь я предполагаю что какая-то очистка данных от ботов у вас есть на предыдущем этапе понятно что в любом случае вся эта очистка работает не на 100 процентов понятно что какие-то боты все равно пролезают но вот на тех которые пролезают на наш уровень но я предлагаю все-таки уже закрыть глаза и считает что это неустранимая потери возможно там еще что то можно выловить но мой рассказ не про это сейчас вот что дело с новыми юзерами почему это проблема ну в самом деле смотрите вот допустим есть у нас юзер вася и мы считаем метрику для него но насчитали на сейчас там какое-то 17 я не знаю не важно что на -2 нормально ищет есть лена у нее вот тоже на эту неделю 14 на простую 13 нормально насчитали есть-пить а вот а потом раз и приходят к нам алены и она к нам пришла в этот раз ваще в первый раз и сразу попал в эксперимента мы ничего про нее не знаем никаких данных про прошлое в ней у них что ей писать в метрику потому что если мы напишем ей 12 то у нас вся мне только сместится в сторону аленой да это будет плохо но и в принципе если мы будем прямо полное значение новых юзеров писать в эксперимент в значении метрики будет обязательно плохо но все пири-пири косячите в этом месте предлагается усреднять данные всех остальных пользователей и сравнивать алену со средним пользователям за прошлый период экспериментом ну то есть данном случае этой 14 вот мы и можем написать -2 метрику при этом тоже что удобно что она работает вообще как не усредняем чего не делаем она работает в идеале усреднять вот если у нас есть контрольная экспериментальная группа если взять вот всех пользователей из них считая при этом и тех пользователей которые пах и шутам папа покупки должны были бы попасть но были только в прошлом периоде а в этот не пришли а вот вот даже тех вот их всех вот взять и сложить посчитать усреднить то это будет идеально но если например почему-то это трудно если почему-то вот это никак не делается то можно посчитать только по контрольной группе если даже это почему-то трудно то можно посчитать вообще по всем пользователям сервиса да если нам вот трудно их там как-то отдельного вычленяет плавно можно вообще усреднить по всему сервису и посчитать вот это средняя там ну они чуть-чуть разные результаты чуть-чуть разные но она и так и так и так все равно работает есть это короче такая штука которая все время работает хорошо вот что еще бывает бывает у нас вот такая неприятность когда у нас метрики на себя лоток что рассуждал про метрику которая выдает нам одно число на пользователя то есть и там не знаю какое количество денег которые он оставил раза эксперимент это количество заходов которые он совершил количество сессий количество дней в году участвовал но это не всегда так да иногда нам хочется считать какие-то другие метрики которые вот одним числом на юзеры не выражаются вот и до недавнего времени это было проблемой но вот в этом году уже опубликовали ребята из индекса классную статью в которой там короче очень много замороженной математике мы в нее вдаваться не будем я верю что это работает смотрите на примере поскольку это индекс то пример поисковый на соответственно для поиска в принципе интересно иногда смотреть на такой параметр как количество кликов на запрос то есть пользователь задал поисковый запрос ему выдались какие-то результаты и он ну на какие-то из них кликнул на какие то нет и в общем это бывает важно и некоторые как вот еще rambler когда давно был ну в смысле он и сейчас есть но поиска у них нет своего когда он еще был свой поиск они очень целились в то что должен быть вот один клик на запрос и если удается привести в среднем к одному клику на запросто типа это очень хорошо они вот целилась в число 1 я не уверен что это правильно но неважно ну и вот понятно как она считается это все клики делить на все запросы а если мы сначала внутри одного пользователя усредним а потом между пользователями будем усреднять то мы потеряем чувствительность очень сильно конечно будет плохо что с этой штукой делать вот можно обратить внимание чтобы что вот таких метрик это что-то поделить на что-то что-то от всех пользователей поделить на что-то другое от всех пользователей вот и техника которую предлагают на вот как-то так выглядит смотрите значит возьмем контрольную группу и по этой контрольной группе посчитаем вот это вот соотношения а вот мы его почти этой нет некой константы на по контрольной группе взяли посчитали круто теперь возьмем и для каждого юзера для каждого юзера чем мы хотим делать мы хотим сделать метрику которая по смыслу выражает вот примерно что то такое то есть это будет не то же самое число она но по по смыслу какая-то такая же но при этом считается для пользователя вот возьму каждого юзера и возьмем его запросам на который он совершил и вот так и перемножим на это вещество значит это значит что если вот этот юзер бы вдруг сделал столько запросов сколько сделал то сколько бы он накликал если бы он кликал как средний юзер в контроля но вот как то так да и если мы этапа суммируем по всем юзерам из контрольной группы то вот сумму всех q юзеров из контрольной группой току если мы просуммируем по всем вечерами снопами группа то это штука сократится там останется турция вот короче сколько бы он накликал а теперь сравним это с тем что он реально накликал жмяк так и будут сравним и назовем это собственно говоря вот наш новый метрикой на то что эта разница между тем что юзер накликал реально и тем что он накликал бы если бы он при таком количестве запросов да значит был средним юзерам из контроля что здесь удобной мы уже выяснили что если это просуммировать по всем юзерам из контроля то у нас здесь в правом слагаемом останется c при этом если это просуммировать по всем юзерам контроль это в нем слагаемом у нас тоже останется цепь потому что ему с ума кликов всех юзеров из контроля это c то есть для контрольной группы это метрика тождественно уходит в ноль всегда и это мега супер пупер удобно потому что мы сравниваем не два параметра с дисперсиями какими-то а мы сравниваем какой-то параметр с дисперсией между ли ум соответственно и у нас сразу мир становится легче у нас там меньшими ну короче фил фил все гораздо удобнее становятся тоже сравнивать с нулем удобнее чем сравнивать с каким-то тоже объектом с доверительным интервалом вот ну и вот это уже некое число которое примерно согласитесь выражает вот по смыслу количество кликов на запрос при этом считается для пользователя и мы можем эту метрику посчитать уже для пользователей и за предыдущий период тоже вот короче вот такая какая-то техника она короче я эту формулу для себя там раза четыре просматривал прежде чем она как-то у меня отложилось в голове она вроде бы простая но при этом требует каких-то не знаю перестановок в мозгу в общем вот есть такая статья к сожалению на осиновский сайт даю ссылку потому что прямой ссылке нет пока по которой ее можно было бы откуда-нибудь скачать но по именам и по названию статьи потом там можно найти место где оно качается просто прямой ссылке нет но в принципе вот ребята короче класную штуку сделаем вот так что вот и туда можно тоже двигаться это все тоже работает вот что еще бывает поговорим немножко про объем потому что не знаю кто из вас проводят эксперименты там иногда по длине иногда покороче вот не хватило на давайте но еще подержим недельку у кого такой случай бывает классно да ищет почему почему это не всегда хорошо мы на самом деле хотим конечно же до хотим чтобы вдруг да вдруг плохо да мы что-то плохое сделали для пользователей мы хотим чтобы пользователи эксперименту были подвержены как можно меньшим если плохо то мы хотим быстрее откатить а если хорошо то она все равно выкатиться в продакшен и они и так в нем останутся поэтому чем короче тем тем лучше кроме того вот с этой техникой на самом деле нам не надо резервировать предыдущую неделю и ничего с пользователями не делать можем их спокойно эксплуатировать все это время там в каких-то других местах на просто важно чтобы они целиком не переходили из одного эксперимента в другой всей группой мы их перемешивали каждый раз когда у нас новый эксперимент начинаются вот поэтому пропускная способность увеличивает свою сеть уменьшается но на всякий случай я дам вам еще один повод не держать эксперименты дольше смотрите надо сделать маленький экскурс ну как я это все представляют и я не из науки из какой-то взял это вот у меня в голове такая картина у интернет-сервисов у них есть две модели монетизации есть прямая это когда наш пользователи это те самые люди которые платят нам деньги то есть они пришли чтобы что-то купить магазине на стоке есть модель косвенная она выглядит так пользователи приходят к нам за каким-то условно-бесплатным контентом мы часть из этих пользователей ловим затаскивает в том и подвал там разбираем на органы органа продаем нельзя затаскивать в подвал сразу очень много пользователей потому что они это замечают и перестают ходить мне кажется что по этой модели работают ну поисковики развлекательный портал социальные сети короче все кто ну короче дают пользователю что-то одно зачем он приходит в нагрузку подсовывают рекламу например или какие-то такие вещи давайте тоже для контроля четности чтобы понять как мы следим за ходом рассказа есть к компания например как hunter какая у неё модель монетизации вот из этих двух вот если бы обида классно потому что действительно есть соискатели которые бесплатно приходят а но они приходят не за чем то они приходят ровно за тем чтобы на них поохотились то есть это такая площадка где они встречаются с охотниками ну и есть охотники которые уже платное вот ее с ними все по другому но я хочу чуть больше поговорить сейчас вот об этих вот ребятах проблема и в том что они не могут считать удобные конверсии и прочие денежные метрики им приходится считать какие-то метрики лояльности пользовательской базы понятно деньги считать надо но этого недостаточно если мы будем считать только деньги от нас люди разбегутся и деньги тоже начнут падать нам придется вешать больше рекламы и изучить люди будут разбегаться еще быстрее и мы будем как же же короче прям один в один вот а мы этого не хотим и почему эта проблема где здесь трудность давайте рассмотрим одну из нормальных таких метрик лояльности тут не сессии тут на самом деле дни в недели когда пользователь засветился на нашем сервисе дело это такая она не очень чувствительная там есть лучше ну просто она очень удобно отмечается крестиками в таблице поэтому я на ее примере буду рассказывать но что мы здесь видим у нас тут и скиту пользователи есть активные пользователи маша там вася новости петь и да и есть менее активны и есть ли да вот который один раз в среду к нам пришло и все ну и допустим нам этих данных не хватило мы хотим поддержать эксперимент подольше еще одну неделю и мы такие раз что у нас происходит маша по-прежнему очень активно на вася там петя примерно в своем темпе работают наташа куда-то слилось володя наоборот активизировался лида опять пришла в среду ровно один раз но кроме этого за эту неделю к нам пришли еще еще несколько людей так нам пришел к это антон может он в отпуске раньше был теперь активно фигачит и пришло еще они в конце они причем это нормальный юзер у нее есть аккаунт на нашем сервисе она каждый раз заходит через процедуру восстановления пароля конечно ну бывает бывает что заходит вот теперь смотрите что происходит вот за первую неделю у нас были какие-то люди и у них была там от 6 до 1 а за 2 недели мы вроде бы собрали больше данных но при этом разброс этих данных он тоже увеличился там от 13 до 1 и они все тоже разные вот почти все метрики пользовательской лояльности которые вокруг каких-то hour битов вокруг посещений пользователя они все подвержены этой проблеме если мы держим эксперимент дольше то внутри этих данных возрастает дисперсия мы одновременно растим дисперсию и объем данных и в итоге кто из них победит неизвестный не факт и еще такой вот интересный вывод предлагаю вам тоже вернувшись домой на работу мы просто для основных метрик которые вы смотрите посчитать как у них дисперсии если мы держим эксперимент неделю или если мы держим эксперимента растет она или нет вы можете открыть для себя что-то удивительное повторюсь это не со всеми метриками так некоторые метрики нормально действительно и держатся и у них дисперсии не так растет но некоторые вот подвержены этой проблеме и иногда бывает так что могут никак а вот собственно говоря дисперсия может расти до вместе с объемом данных это надо помнить только последняя секция осталась маленькая есть часто на я это где-то рассказывай расскажу всю эту арифметику key pred тривиальные вещи приходят лишь как лучше там 2018 год тут уже все в несколько слоев эксперименты накладывают каждый пользователь одновременно в нескольких экспериментов вот почему об этом не говорим давайте какие современные там техники еще что то вот то о чем я говорю сейчас она все в принципе и для нескольких слоев экспериментов тоже годится на трущиеся каждый пользователь участвует во многих экспериментах то это все равно работает точно так же ничего не меняется но давайте действительно вспомним что он у нас 2018 год и немного потопим за современная технология так капельку ну тут пробуждение не знаю машинное обучение вот если вдуматься имеет некий смысл смотреть и метрика наши на это текущее значение минус прошлое значение зачем нам надо прошлое знать и не надо чтобы предсказать нормальное поведение пользователя есть мы ожидаемое какое-то значение хотим взять и посчитать разницу с ним в качестве ожидаемого мы берем прошлые данные в принципе не что нам не мешает взять прошлые данные взять какие-то графики и годовой динамике годовой сезонности да потому что мы же можем посмотреть как в принципе у нас там как каждая неделя или каждый период в году отражается на и может быть там где то спад подъем это наложить график каких-нибудь геополитических событий праздников прогноз погоды никто не смеется такая шутка была на самом деле не шутка потому что ну прогноз погода погода это важная вещь на любой любой даже общероссийский какой-то крупный интернет-сервис такой как яндекс mailto mavi там прям зуб даю они очень хорошо по трафику видят когда в москве дождь а когда в москве солнечно но для контроля четности дак когда трафик больше когда дождь да и это реально очень видно так и есть очень ничто не мешает научит взять сделать какой из машин на обучать крутейший ну и сделать вот так зависит от места вот это сделать вот он ну и есть дествительно статья на эту тему в которой люди примерно это сделали если его почитать ее можно там по-разному интерпретировать моя интерпретация такая что мы получаем вот так там мы получаем немножко выгоды реально по сравнению с просто использованием прошлых данных мы там можем не на процентов 5 это значит если раньше у вас из 120 было результативных эксперимента теперь будет там 21 но с другой стороны да там где у вас раньше была простая арифметика теперь поселяется какая-то непонятная машина обученная хрень которая ну и и надо периодически переобучать повторяет нам собирать для нее какие-то сложные данные которые тоже там все эти сервисы отваливаются периодически что ты не дают я бы не стал короче то есть в чисто от и демичев кто на докладе артема гавриченко выбыл из куратора про quick и вот прав не важно короче там рассказывал что академики это на самом деле ругательное слово вот в этом вот чисто академическом смысле вы просите можете получить но в экономическом нет не будет никакого профита это короче мне кажется напрасным но технически можно что-то такое делать им может быть кому то это будет даже выгодно я не могу представить ну мало ли и того еще если применять эту технику то скорее всего вам для тех же результатов потребуется вдвое меньше юзеров реально это очень как бы резко бах и сокращает вам учить но первое время польшу когда система опять начинает стабильно работать там вам приходит все больше и больше разработчиков которые хотят что-то запускать в эксперимент польшу потом очередь опять растёт но там при при при внедрении разового очень бы круто получается внезапным для контроля нужно от с ты обязательно в том числе синтетические не забываем новые пользователи ключи надо их обрабатывать аккуратно вот и еще раз слышу призываю по возможности не держать другие эксперименты в чем вам эта техника собственно говоря и призвана помочь в том числе так вот это вот мы такие вот тут вот наши контакты на их потом тоже можно будет скачать поэтому я сейчас вот это все показал а потом на время когда мы будем обсуждать давайте верну выводом спасибо большое спасибо за интересную историю пара вопросов насколько лучше работают не абсолютная относительная разница как метрика это первый вопрос гарантия я не понял вопрос вы предлагаете в качестве метрики смотреть не на мой грубо говоря бизнес теперь но на дельту надо туда лютую есть ли смысл смотреть на относительную дельту просите относительно чего относительно среднего там за ту же самую прошлую неделю или там тоже пишите на вопрос понял давайте второй второй вопрос проверяете ли вы гипотезу что среднее не уплывает но то есть вся вот это все выводы делаются исходя из гипотезы что средний остается каким и было в эту гипотезу вы лидируете на своих экспериментах или нет сейчас на причине вы смотрите сначала про второй вопрос там среднее пересчитывается каждый раз на то есть это не какое-то средняя которое мы один раз посчитали а и значит она потом обычно причем это средний это тоже один из какой из каких-то важных бизнес-показателей то есть на него обычно настроен мониторинг и если она там как-то скакнула то ну то это повод пойти нужно проверять обязательно надо что с ним не случилось что-то странное потому что это бывает ну чуть чаще это не из-за бизнеса не из-за жизненных ситуаций а просто ну что-то сломалось обычно но конечно на это надо мониторить то есть а если она чуть-чуть плывет или если у него есть кое-то динамиком у на это надо смотреть и наверное это окей а если она вдруг улетела в небеса или провалилась подвал то это повод разобраться вот второе по поводу среднего смотрите мы же вот это среднее используем для новых юзеров для неизвестных юзеров поэтому но короче чувствительнее и сильнее для тех юзеров для которых у нас есть предыдущие данные использовать ровный их об атташе конечно лучше сравнивать юзеры нескольким то среднем а сравнивать его с самим собой потому что это дает нам гораздо точнее результат со средним и сравниваем только тех кого мы с самим собой сравнить по какой-то причине не можем всему мы пробовали да и короче самим собой лучшим мой первый вопрос был больше про то почему в дельтоне оставляете там в долларах визитах рублях кликах а не переводите в проценты да потому что потому что ну короче вот мы и мы из никиты очень любим использовать потом bootstrap в качестве 100 теста и короче bootstrap вот с абсолютными вот этими значениями он короче гораздо чувствительнее работает чем с ну короче просто мы пробовали это это и абсолютная просто просто больше результаты дают более 4-х 7 большая abba 32 как лучше действовать если например в предыдущем значение нет значения а привет предыдущем она есть то есть либо усреднять ведущие как вы предлагаете или тащить из позапрошлого перерождений если в привет предыдущем она есть что это значит что в предыдущем 0 то есть если мы этого пользователя знаем на и он у нас было раньше а потом он куда-то уходил потом он вернулся то тогда можно считать что он в предыдущем значение 0 но лучше лучше у среднего если у нас есть данные для многих пользователей за много периодов то усреднение работает надежно именно вот потому что думал ли он в отпуск уезжала ли еще чокобо зачем усреднять надежнее но в принципе если мы этого пользователя знаем при этом для всех пользователей на но для большинства у нас есть данные только за предыдущий период а у него предыдущем 0 но раньше он у нас был то можно то в этом случае можно считать 0 то есть не 0 только для тех пользователей при которых мы ничего не знаем они вообще в первый раз появились у нас в системе и сразу попали ну в эксперимента лев которое неважно вот для них надо брать средняя на них мало не надо брать слушайте спасибо тогда классная очередь очень интересный был скажите вот как раз для новых пользователей тоже если бы от средние и вот то что были две картинки там с богатой и не очень богатой девушкой получается как раз средние ну то есть можно получать очень большие дельты если ну новых пользователей довольно много не пытались ли как-то пытаться их вот мы понять что вот этот покупка новый пользователь да она там наверно больше вот эту сторону относится или начать новых пользователи очень мало и они не сильно оля на самом деле очень все по-разному потому что в разных сервисов порывы кстати ну у себя каждый кто знает сколько у вас одноразовых пользователей процент на то есть таких людей которые ну не берут cookies или еще что-то там пришли что-то сделали ушли и все их нет я часто бывает 50 процентов запросто бывают такие места где их 90 даже бывают бывают такие миры да поэтому нет но воспользоваться нельзя закладываться на то что новых пользователей мало вот там идея идея в том что для прошлого периоду мы тоже считаем вот усредняем в том числе и путем одноразовым пользователям которые были в прошлом периоде но попов и шутам должны были попасть на поэтому вроде как они должны быть примерно такие же и как-то усредняется я не утверждаю что это истина в последней инстанции то есть вот в этом месте может быть можно еще чего-то капать на самом деле может быть можно еще чего то там нарыть бы пока что пока что мы вот просто да действительно те новые пользователи у которых скажем значения нестандартные а сильно отличаются от среднего они действительно приносят нам большие дельты ну да привносит кажется что ломает как раз все вот эту идею смотреть дельты мнение ну просто для новых пользователей но мы считаем что в среднем они такие же как и как средние наташи мы предыдущих новых пользователей тоже всех считаем тех которые были новыми в предыдущем периоде на они вот в эту соединения попадают вот поэтому в целом они там примерно примерно туда же должны идти ну то есть короче копать здесь можно искать здесь можно в принципе вроде бы не ломаются ну то есть мы проверяли все вроде работает но вопрос да вопрос правильный до копать копать и копать в этом месте может быть стоит на большое спасибо за внимание до брат"
}