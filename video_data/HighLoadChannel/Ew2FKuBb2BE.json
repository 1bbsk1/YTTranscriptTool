{
  "video_id": "Ew2FKuBb2BE",
  "channel": "HighLoadChannel",
  "title": "Создание production-ready приложения на Tarantool/Игорь Латкин (KTS Studio)",
  "views": 2872,
  "duration": 2971,
  "published": "2018-07-19T13:24:22-07:00",
  "text": "спасибо большое меня зовут игорь и я понимаю то что все уже подустали к вечеру доклад будет не очень сложный он скорее будет ориентирован на практику такие best practice is которые выработались у меня у моих коллег за уже более чем почти четыре года работы с тарантулом мы накопилось очень много болячек косяков на которые мы натолкнулись и мне очень хочется поделиться с вами тем инструментарием который получился получилось разработать за все это время эти утилиты которые позволяют вам упростить жизнь с тарантулом писать быстрее приложение создавать быстрее новые в общем относилась к этому слайду создавать быстро новые приложения тепло этих быстро на сервера и короче чтобы разработка на тарантул не превращалась в какие-то сложные манипуляции не важно доход будет суть разделен на 2 части это будет описание проблем с которыми обычно сталкиваются начинающие разработчики может быть даже чуть более продвинуты и вторая часть это решение всех этих проблем так первая проблема с которой сталкивается почти каждый тарантул это сервер в приложении ну в моем понимании это прежде всего сервер приложений в которой встроена база данных очень быстро хорошая но во первых все тарантулов сервер приложений значит нам нужно уметь писать код на этом сервере то есть у нас получается что тарантул это по сути такое же приложение как ваш сервис на питоне ваш сервис нога просто он завёрнут вместе с базы данных и нам необходимо строить выстраивать структуру проекта таким образом чтобы нам во первых было удобно работать локально во вторых удобно было это тепло это сервер наивный подход который рассматривается в документации тарантула и очень не сразу понятно как из этого подхода уйти что-то более сложные и расширяем и так первый подход мы берем наше приложение мы выполняем наш бокс f и g и берем все наши хранимые процедуры которые у нас может быть есть в приложении и запихиваем это все файлики тисе и тарантул и так далее мая в . вова таким образом тарантул отель видит наш наш новый instance запускает его ну и в общем то все работает нет никаких проблем с этим это удобно когда хранимых процедур у вас либо нет либо их немного то есть вы описываете боксов игра стартует приложения и вы описали пару процедур там на select юзеров и на вставку нового юзера в целом это подход будет работать и ничего не нужно выдумывать дополнительную также это удобно как я уже сказал когда нет необходимости разделять код на какие-то под модули то есть у нас есть подсистема работающая с пользователем подсистема работающая с транзакциями допустим каких то пользователей у нас просто одна структура одна база данных с с очень прозрачной логикой и нет внешних зависимостей ну конечно не могут быть но об этом чуть позже какие могут быть минусы я это буду повторять и ни один раз наверное зависит от доклад то что конфигурация приложения хранится рядом самим кодом по сути это и есть сам код то есть на то что вызываете бокс f и g ну поднимите пожалуйста рука кто вообще как минимум писал хотя в одном приложении таранто выше понимать все супер бокс f и g вы вы вы вы вы вы его вызываете тем самым передавая туда какие-то параметры конфигурации вашей базы данных конфиг это не часть приложение конфликт должен быть отдельный конфликт должен быть конфликт должен должны быть какие-то атрибуты о которых я еще чуть позже поговорю которые не ложатся на вот такую структуру на такую схему приложение расширяем и сложно поддерживать модульный подход чуть-чуть увеличение улучшения вообще подхода к диплому приложения также описывается в документации тарантула все что вы делаете это вы кладете ваше приложение в какое-то место где тарантул сможет его найти например это юзер шер тарантул любой узел около шер тарантул вы кладете ваш велик и метлу а по сути это моя плоть здесь кладете его в одессе тарантул места счастливые и там уже делаете рекламу вашего приложения по сути проблема с модульностью решена до модуль на разделении кода поддерживать проще читать такое приложение гораздо проще понять не поддерживает легко минусы к сожалению остаются теми же конфигурация по-прежнему хранится в мае apple о которой лежит витязь и и зависимость от внешних модулей ложится на сторону системы то есть если вызове если ваше приложение зависит от нескольких модулей например вам нужно сходить в по сгрыз вам нужно сходить пах и ттп куда-то или либо поднять дтп сервер прям внутри тарантула то вам необходимо будет поставить систему модули либо через лоракс либо используя дпр pm пакеты и по тарантулах дтп или тарантул п.г. это первая проблема который мы с вами поговорили запомнили и чуть позже ещё к ним вернёмся рyлон в приложении очень часто свои свои четыре года когда работал с тарантул встречал проекта на которых люди по сути не пользуются ли лордом коды то есть все что не делал для того чтобы находить новую константу а не просто его restart я думаю нет нет смысла объяснять почему это плохо об этом тоже еще сегодня не раз говорилось ваша база данных может занимать гигабайты памяти ну так как мы работаем в основном текса но с винилом по сути те же могут быть проблемы база данных может занимать от большой объем памяти и когда базаре старте ца тарантулу необходимо поднять все снапшоты все снапшоты все их слоги после него для того чтобы положить их в память и этот процесс может занимать длительное время вплоть до нескольких десятков минут в чем суть или лорда приложения потому что у вас вот была версия какая-то версия 1 вашего приложения и все что вы на самом деле хотите сделать это просто взять новый код взять обновленные процедуры и заменить ими старые лежит две задачи нари lauder это выпуска загруженных модулей и накатывания нового кода по сути накатывание нового кода можно решить в банальным выполнением скрипта заново то есть выполнение вашего и нет вас самого начала про выгрузку что она предлагает документация тарантула это скриншот прямо оттуда она предлагает не очень красивый подход в том что вы по сути ориентируйтесь на самостоятельно табличку пошло вот у нас здесь в ней хранятся уже загруженной зависимости и загружаете присваивая нил в соответствующей секции погружая те модули от которых те модули которые вы хотите перезагрузить это совершенно не годится для того чтобы использовать такой подход на практике потому что в зависимости у вас может быть много и каждый раз прописывать конкретную зависимость можно сойти с ума естественно необходимо для того чтобы обобщить этот код необходимо выгружать все зависимости запомнили про эту проблему и так у нас проблема с организации коды проблема с голодом конфигурирование приложения еще раз конфиг это не часть приложения и там есть такой фразы до в конфиг на самом деле можно отнести такие две большие сущности это конфликт вашей базы данных это бокс и конфиг вашего приложения в конфликт вашего приложения может относиться все что угодно конфигурация внешней системы по сгрыз а и иди себе все конфигурация шарден гана можно ее отнести либо в бокс могли бы в конфликт приложений неважно главное то что есть не что что на самом деле configured ваше приложение то есть не само приложение сама себя создает а некоторая дополнительная сущность которая описывает но я думаю нет смысла это все подробно так объяснять он должен быть просто чтение в редактирование просто доставки на сервер вот примеры такого плохого конфига потому что не является конфигом поэтому в кавычках на самом деле не такой уж плохой просто вот этот бог sci-fi виктор выполняется сейчас на третьей строчке на самом деле мог выполняться в этом унесло на какой-нибудь 350 и строчки и для того чтобы администратору базы данных понять какие параметры передавались бокс f и g ему придётся долистать этот код посмотреть короче превращаются в полнейшую головную боль также здесь есть два конфига applications тут есть две версии api как бы и просто 2 конфига различна и так это третья проблема запомнили 1 проблем организация кода reload и конфигурирование четвертая проблема управления с пейсами это на самом деле большая проблема как мне кажется в tarantul и сейчас то что вот глядя вот например на такой код вообще непонятно какие есть space и и вообще какая в них структурами ну я вам сразу подскажу здесь есть три спейсайд английский узел спер у каждого из них есть прайм yandex и вот в последнем бог суонси был изменен на яндекс у юзера тем самым превратив его в уникальный ну короче для того чтобы вам понять как устроена схема хранения данных у вас еще стороны вам придется самостоятельно пройтись по этому коду и как-то осознать это все это совершенно не хорошо так скажем первое правило естественно всегда использовать формат формат и когда-то не был автором тулин когда-то он появился но никак не использовался самим тарантулом формат это по сути просто описание полей которые лежат space да я есть там один процент случаев когда вы не можете описать формат когда у вас staple и могут иметь динамическую длину и это считается валидным и вы не можете обозначить имя для каждой колонке можно так сказать но в девяносто девяти процентов случаев у вас данные имеют фиксированные фиксированную структуру и это больше похоже на реляционную какую-то структуру чем на но escape поэтому всегда когда можете использовать формат внешней зависимости допустим у нас есть два приложения aus db и txd b и они зависят от трех внешних модулей оба они зависят от и pg их и дтп например и ттп для того чтобы собирать метрики приметаю сам автор xd б у нас есть кью для обработки каких-то сложных задач его узды был нас есть expiration те которые скажем инвалиде рует сессии если вы попытаетесь поставить эти два приложения на один сервер то могут возникнуть проблемы с versio нирования в зависимости то есть но нет смысла я наверно этому особо заостряться все это прекрасно понимают то что зависимости должны быть независимы и для каждого приложения тарантул в данный момент нам предлагают устанавливать зависимости в систему ставить там тарантул дефис expiration да и по сути жить с этим все проблемы закончились и так у нас есть четыре основные проблемы или уже пять не помню это reload кода это организация кода это управление с пейсами и это управление зависимости пойдем и решать их в обратном порядке внешней зависимости самое простое решение самом деле получается самым лучшим смотрите и я сейчас могу рассказать немного о том как работает вообще загрузка модулей в tarantul имеет ли смысл то сейчас делать окей раз да тогда погнали что происходит когда делается рик флэр вашего модуля первым делом все что делает в ну и я сейчас буду говорить в основном только про во втором туре просто чуть-чуть сложнее когда делается рик war какого-то модуля проверяются хранение этого модуля в табличке подпишу аудит если он там есть она возвращает если его там нет то происходит следующая процедура всего есть так называемый таблица покачал outdoors в которой хранятся функции которые вызывают по порядку для того чтобы найти соответствующий моды и так только shallow берс первая функция которая находится в пока шло doors она ищет ищет загрузчик который называется package прелат то есть package привод это тоже важная таблица в которой по ключам вашего модуля можно положить функцию которая будет вызвана при попытке загрузки вашего модуля то есть можно переопределить сам процесс загрузки модуля и так это первым шагом если там не найдены ничего ищет модуль впк чп as-pp спас это набор шаблонов на следующем слайде будет пример набор шаблонов по которым поможет найти соответствующий модуль следующее если он все-таки него не смог найти ли не смогла не смог не смог найти модуль влажный то он пытается найти его в переменной прокачусь эпос только части пас это такой же абсолютно набор шаблонов только служит он для нам поиска бинарных библиотек собранных типа дрл со велит нам макасин если же он не нашёл и там то и вступает в игру так называемый сирот laughter его суть в том что ваш личный модуль может определять определять загрузчики модулей не только для рута не только ну например у вас есть модуль а . б . c и ваш модуль скажем для модуля а у вас внутри определяет загрузчик для собственно a b c таким образом мы используя модуль а загружаем еще и модуля . б . цен вот в tarantul этих laughter of в 2 раза больше они все находятся выше ну то есть начало идет прилов то потом еще четыре лоадера которые отвечают за поиска зависимости в папочке . рокс и второе зависимости влажная и session и и и второй отвечает за поиск их где-то еще не помню в общем это просто кастомизация поиска зависимости . рокс и еще какой-то локейшн возможно тоже . только powerarchiver итак наше решение будет достаточно простым здесь представлена дерево нашего проекта замылен а все что нам сейчас не нужно у нас есть и нет ло в котором прописана вот эти строчки которые все что делают это патч от пос и patch.exe паз для того чтобы тарантул мог найти зависимости папке . рокс вот этот шаблон и рокс шерл опять один вопросик лу это как раз есть и шаблона которых я говорил так как в лу-лу ориентирован на анти си в нем нету понятий директорий в нем нет понятий нет понятий файловой системы поэтому он не может находить самостоятельно пакеты модули по просто имени папки и вам необходимо явно указать куда подставлять имя модуля на пригнув я думаю понятно если вы пытаетесь загрузить рекламой модуль то он подставит мой модуль в каждой вопросик у здесь и попытается узнать если такой файл на диске и съесть он загружает делать духовные следующие хотелось ну смотрите у нас есть наше приложение мы хотим написать какие-то зависимости которые необходимы для его работы что нам нужно для этого сделать нам нужно где-то описать первый вариант который приходит в голову это взять рокс пеку ну все думаю видели рокс пеку это вы опять в котором есть несколько глобальных важных таблиц и здесь есть секции dependencies не видно эта штука есть секция depends которая указывает то он от каких пакетов зависит ваш ваш моды вы естественно можете указать здесь скажем hdcp как кажется себе модуль expiration да и он их поставит успешно только если у вас есть установку у вас в конфиге аракса прописано прописан репозиторий до репозитория прописано url то репозитория тарантулы the rocks . тарантул орг если ваня тулоне сам рок specs не сможет найти этот модуль это с одной стороны хорошо но есть более глобальная проблема в практике разработки приложения очень часто так случается что мы хотим просто сделать какой то модуль положить его скажем над гид хоп или ещё куда-то или на git лап и просто его поставить оттуда просто взять вот эту рокс пеку которая там не ждут и просто поставить не заводя специальных репозиториев для этого дела а просто поставить напрямую срок спеке лоракс он может поставить приложение срок спеке но рокс пеку нельзя поставить в этот dependencies то есть dependencies должен лежать обязательно должен стоять обязательно имя модуля путь пирог спеке там пути ты рок спеть там быть не может в лорак си в на гитхабе есть ишей по этому поводу но насколько я помню вопрос закрыли потому что они сказали то что не будут этого делать так родилась штука под названием diablo изначально написано на питоне это по сути такая ну и потом переписана нового попытка создать средств управления зависимостями под капотом там работает warlocks и тарантул коктейль рокс именно они вместе потому что они короче один из них не может справиться со всеми задачами которые стоят перед управления зависимостями для тарантул он позволяет описывать зависимости от рук спеке и вот как это выглядит выглядит может вы сейчас достаточно страшно но это просто пути до raw файлов на гитхабе первый модуль the config 2 там потише лотом спейсер еще всякая ерунда и здесь есть три секции dips тнт deep local дпс и вот здесь вот как раз сразу видна разница deep составе все пакеты из гипса ставятся с помощью лоракс все пакеты из tnt dead остается с помощью сторон толкатель rocks почему так случилось случилось это вот из-за этого модуля которая на 1 находится в нтд псы за мода белый шарф из за того что он зависит у него вот здесь вот dependencies здесь у него прописано тарантул и лоракс очень не знаешь что такое торонто он не понимает как с этим жить от арон толкатель рокс понимает и поэтому невозможно поставить в шар с помощью варакса только с помощью таран только ты игрок но в то же время нельзя все модули поставить с помощью тарантул катеров потому что таран толкатель рокс не умеет ходить другие репозитории кроме репозитория тарантул если вы зависите хотите поставить зависимость какой-то модуль важное не знаю он был для работы с временем 10f то вы его не поставите с помощью там долг отеле рокс до тех пор пока его нет в репозитории тарантул и вылакал dips это такое небольшое расширение которое позволяет вам создавать какие-то жареные модули для внутри ну между ваших между ваших проектов то есть например вот у нас есть две базы данных да они находятся скажем в одном репозитория узды бейкера xdd и у них всех есть какая-то жареная библиотека вот здесь ктс lips который есть уже готовые вещи для процессинга запроса проверки аргументов но и всякая такая ерунда которая просто является общей и вот local disk позволяет вам собирать модуль и ставить его в локальную папку . рокс с помощью лоракс итак мы с вами поговорили про внешние зависимости надеюсь понятно как это решается самом конце у нас будет демонстрация того как это реально работает я надеюсь это c'mon rip sconfig вот эти отсылки мун ribs свои штаны еще какой-то slash это все ссылки напитков вы можете зайти и начать пользоваться он lips конфиг это попытка описать конфиг вы удобно перевариваем так сказать в виде у нас есть все все что здесь есть это одна обязательно переменный бокс и произвольные остальные секции в секции бокса нас описывается все те параметры которые вы бы обычно передали в бокс tpg и дальше все что вы хотите об api один api 2 короче в ваши фантазии лишь ограничено что здесь писать но здесь самое важное увидеть то что решается все проблемы о которых я говорил раньше конфликт прост для чтения конфликт рост редактирование он поставляется отдельно от самого приложения то есть системный администратор может зайти и отредактировать там витязь и ваше приложение конфиг ло изменить там ли сам порт и перезапустить тарантул ними bo3 laudel и все ему не нет необходимости рыться в исходниках самого тарантул как это использовать использовать очень просто здесь надо обратить внимание на строчку local конф равняется рик флэр конфиг вы рекламируете конфликт и передаете вызывать его с путем где лежит ваш конфиг и все ваш конфиг подгружается с диска и вы можете использовать секции оттуда это конфиг отдельно от приложения то любимый родной в то есть вы можете писать любой на самом деле код там бокс цпг вызывается на измененные параметры то есть вы поменяете порт на котором вы слушаете а 3 ломтики тарантул все это автоматически подхватит и вызовется бокс с измененными параметрами а также в нем есть поддержка эти себе то есть вы можете подгружать ваш конфиг не только с файлик на диске но еще и явитесь и.д. следующая библиотека покашлял овод они сегодня уже говорил mance вспомнил как это выглядело у нас было описание зависимы описание модуля который мы хотим выгрузить напрямую через покачал аудит все это заменяется просто на на три строчки мы делаем рекламе пока chillout марик варим наше приложение регистрируем его и дальше делаем все что нужно самим приложением зачем нужна регистрация если внимательно посмотреть на этот код вот здесь вот под ифом находится функция оп оп стоп что она делает ваше приложение когда рила водится она может хранить какое-то локальное состояние состояние например connect какой-то базе данных скажем connect по сбросу либо у вас работает какой-то фоновый процесс и желательно вам его начать заново когда происходит ревут кода поэтому мы решили l'autre jester предполагает что у вашего ложный таблички об есть функция destroy и он просто на самом деле и вызовет когда будет выгружен модуль а если вам нет если у вас нет необходимости в таком в таком поведении то есть вызывать какую-то функцию при завершении при выгрузке кода вы можете просто не регистрировать и весь код сведется к трем строчка как теперь это 3 очень просто вы к натиск тарантулы вызываете пока штучка рилот и все у вас на качественно новая версия вы можете даже автоматизировать этот процесс например если у вас есть какой-то конфликт salto или конфиг ansi было все что вы делаете в накатывать и новую версию кода и просто дергаете пока chillout у конкретного инстанцию то есть этот весь процесс накатки нового кода можно полностью автоматизировать так управление с пейсами мы посмотрели вот на эту страшную схему где у нас было три space а не понятно с какими индексами непонятно как она все устроено ну и причем этот кусок кода на самом деле взятый за реального приложений которая видео немного измененные и там была space of гораздо больше там было что для 10-15 space of и все это все это было достаточно сложно читать есть решение не вставить мне вставить картинку с космосом есть решение трансу спейсер позволяет вам описать space и в некотором декоративном виде то есть вот этот вот весь подход который описано здесь это интерактивный подход мы говорим мы хотим создать space мы его создаём мы создаем яндекс и все это происходит в реальном времени что же происходит здесь мы всего лишь объявляем структуру нашего space и мы говорим пуска у нас будет space с именем purchases в нем будет формат с тремя полями в нем будет два индекса все поля абсолютно идентичны полям из документации тарантула что происходит после этого после этого на самом деле ничего не происходит у вас space не появляется но у вас появляется возможность генерировать миграцию для этого space а до очевидный плюс этого то что это единственный источник правда мы смотрим на код там скажем схемы ло или space и слова и понимаем что у нас есть во всех space и все что нам надо сделать например чтобы изменить уникальность какого-то индекса мы просто делаем министру создаем на в эмиграцию накатываем и все работает и так как же он работает все что он делает это вы можете вызвать спейсер . кредитный грешен мы мимо их не грешен и создается миграция состоящий из двух секций up и down секция обслужит для того чтобы накатить изменения в на тарантул то есть создать новый space' создать индекса в этом спейси вот например если мы посмотрим на эту картинку то при первом вызове у вас создаст будут написаны прям конструкции backspace бог схема create space purchases на этом спейси будет вызван клеит яндекс и на этом спейси будет вызван применение форматы а также будет создана down миграция которую можно вызвать для отката этой этой миграции то есть там будет сгенерировано строчка бокс по из purchases дробь что умеет спейсер спейсер умеет детектировать изменения в индексах формате удаления space а создания нового space и удаления индексов и самое важное то что есть вот втором туре такая проблема когда вы хотите добавить новое поле допустим вас есть форматы состоящий из трех полей как здесь и вы загрузили туда уже какое-то большое количество данных и вы хотите добавить поле скажем из дели то мы хотим знать удалён пользователей длина покупка или нет и вы не сможете сделать это в торонто или если вы просто вызовите : формат потому что как только вы попытаетесь создать формат с новым вызвать формат с новой новой схемой то с четырьмя полями с четырьмя полями тарантул проверит если действительно в в спейси действительно ли у всех то плав в этом спейси четыре поля то есть действительно ну короче вы поняли если втором туре если в этом спеси четыре поля их там не окажется потому что у нас всего три поля потому что во всех там миллионах запись у нас всего лишь три поля ok давайте пойдем по другому давайте мы добавим в каждый то по 4 поле и тогда мы накатим формат как только вы попытаетесь сделать апдейт табло и добавив ему 4 поле таранто mankind ошибку нельзя добавить 4 поле потому что формате 3 поле мы замкнулись в неразрешимый круг из которого можно выбраться лишь сбросив формат обновить все to play и применить новый формат и на этим занимается спейсер он как бы забирать на себя всю эту боль свои управлениями новыми полями новыми индексами то есть когда вы добавите сюда новое поле на самом деле сгенерируется тритон три конструкции 1 которое сбрасывает формат то есть теперь вашем спасении от формата 2 пробегается по всему space у и обновляет обновляет добавляет четвертое поле и следующая конструкция ставит новый формат да а также спейсер встроена упрощен упрощение работы с to'plami самих space of то есть там есть глобальные таблички f и t который позволяет вам обращаться по именам полей соответствующий space но есть если кому то интересно лучше потом расскажу следующая вещь про которых хочется рассказать это тарантул об ну вот за все эти за всё то время что приходилось разрабатывать приложение на таран дули в итоге получается так что все приложения почти одинаковые и была выработана структура такого приложения которое позволяет создать быстро приложение быстро его запустить а дальше просто добавлять саму бизнес-логику и причем вот все то о чем я до этого рассказал папе 4 лот конфиг все это должно быть уже встроена в самом приложении то есть это используется на каждом приложении и это но жизненно необходимые вещи что делает тарантулов тарантул об это ну можно не мог заглянуть в историю изначально было просто папочка на диске которая называлась project team plate или вич это такое и я просто копировал но это было еще во времена когда работал в облаке здесь просто копируем новую папку изменяем имя проекта на новое и вот у нас запущенный проект дальше появился тарантул об стартер лежал у меня на гитхабе который все что делает это создает эту структуру проекта просто используя уже шаблон тарантул об это еще больше настройка над всем этим которая позволяет создавать приложения по разным шаблоном и на данный момент он находится 4 шаблона первый шаблон и the basic шаблон которым мы дышим сейчас будем говорить это идеальная структура приложения которая была выработана но им он сам и еще несколькими людьми второй шаблон и третье это блоки это секрет который я взял просто из гитхаба тарантула не за наверно кого вы слышали про локи это сидит кто-то нет по сути это шаблон приложения не шаблон приложение это шаблон модули для луи шаблон модули для си которые рекомендованы команды тарантулы то есть то есть вы по сути это был достаточно неудобно там точно так это по сути было копирование вот этой папке мы копируем папку заменяем везде гриппом одно имя на другой и вот так это мы получаем модулем я просто взял и перенес locket и сидит сюда то есть теперь можно одной командой создать новый модуль отработанные структура проекта в а еще 4 шаблон про которая не сказал это шаблон для проекта на выше в шар чуть-чуть отличается тем как и нужно писать приложения на tarantul и потому что у нас появляются две различные сущности это роутер и сторож ну кто был на докладе сегодня утром слышали и поэтому немного становится сложным постоянно вот проводить вот эти вот рутинные действия потому как написать как организовать структуру папок фактически и как запускать это все дело локальная и на продакшн в тарантулов встроен нажим пакетов то есть вот тут модуль дед который я говорил он встроена в тарантулов и сейчас я наверное быстренько вам покажу на самом компьютере а также встроена поддержка конфиг а пока шло так если вы не против я быстро эдема покажу на самом деле все что вам нужно сделать для того чтобы начать пользоваться тарантула вам всего лишь нужно перейти на мандрик star on the lab и установить его он устанавливается очень просто в одну команду попробуйте крупнее и он устанавливается в систему потому что так просто проще как только он остановился на на слишком крупными как только он остановился у вас появляется возможность создать новое приложение и все что вы делаете вы пишете тарантул об create указываете имя приложения скажем мая apb1 нажимаете enter создается приложение мои apb1 в этом приложении уже есть организованная структура что она из себя представляет наверное ничего не видными вам видно вообще вот это я зря сделал быстро расскажу коротко о том что здесь к чему и нет вова точка входа в приложение это пропатченный пути это загруженный пока шрила вот это загруженный конфиг сейчас я в коде вам покажу мой apb1 лава это 7 линк на и netlogo нужно это для нужд тарантул коктейля конфликт которого также лежит на самом деле в этой папке сделаем вот он . тарантул кт и дальше con в . во-во конфиг вашего приложения в синтаксисе мун рифт со своей конфига что здесь еще интересно вами таяму описывает зависимости сейчас тоже открою покажу и есть папка оп оп это все ваше приложение дальше вы вольны делать все что все что хотите потому что здесь тарантула план ничего не диктует давайте посмотрим что там внутри хранится итак начнем с мета яму у нас есть просто 2 зависимости и эта зависимость на конфиг и к зависимость на пилот то есть она автоматом уже есть в этом модуле следующая вещь это и нет во как я говорил у нас здесь получится пути для того чтобы они искали для того что модули из колись . rocks но также еще модели ищется в директории об просто потому что так удобнее то есть вы описываете ваше само приложение в appy но вы не пишете рекламе об . что-то там вы просто пишете рекламе что-то там что дальше делается в этом неплохо проставляется strict загружается пока chillout загружается конфиг загружается приложение и делается и нет этого приложением то есть в этом инете вы можете сделать все что угодно вы можете под конектится к базе данных вы можете провести какую-то инициализацию вашего приложения и стартует консоль для удобства разработки то есть когда вы станете приложение вас сразу будет доступна консоль в котором можно убивать команды следующее давайте посмотрим на оп оп и нет лу здесь вообще нет никакого космоса и все предельно чистое понятно у нас есть наши openid которые на самом деле дергает такой же и нет для каждого модуля загруженных внутрь а по у нас есть из строя который вызывает также дестрой на каждом загружено модуля то есть здесь по сути есть это является шаблоном приложение уже с выработанной модульной структурой который легко использовать на своих проект вызывается покрошил от реджистер то есть мы регистрируем наше приложение в покачали ловади для того чтобы он вызывал дестрой и в глобальную переменную abs эти c этот модуль для того чтобы мы могли вызывать эти функции из извне вот и также у нас есть несколько моих команд первая из таких команд называется мои где все что она делает она вызывает тарантул об где и устанавливается зависимости описанные в мета яму в . роб как только это все поставилось у нас появилась папочка . рокс и как видите у нас здесь поставились наши модули для того чтобы запустить приложение вам достаточно выполнить мой экран и ваше приложение запущено самое главное то что вам для того чтобы его запустить потребовалось на не знаю секунд десять они давайте поставим еще какой-то модули они-то нападает давайте еще под и божим и попытаемся все-таки заз это пить проект нет проект уже заз это блин вам просто нужно указать его имя вот и доступно вот это глобальная переменная об которой есть об магазин и так далее давайте попробуем просто написать какую-то функцию чтобы продемонстрировать и таких надо что-то показать допустим нас есть функция в модуле 1 которая возвращает какой-то текст для того чтобы накатить новый код да вы можете от рестарте тарантул ну давайте мы его трилогию мы делаем по пещере вот и делаем об mod 1 х и у нас уже все работает вот я бы мог еще сейчас показать этот шаблон проекта для в шар danone в целом почти идентичен а разве что он отличается тем что вот здесь вот в там есть папочки и роутер и здоров и все и есть 2 2 entry point один для роутера один для стороже как это нажимать вот здесь в целом описано все тоже все то о чем я говорил что можно было потом почитать просто ставите себе это совершенно несложно и все шаблон автоматически ставится к вам на компьютер и это позволяет вам создавать приложения максимально быстро и просто и так давайте коротко поговорим о кратко расскажу что мы в итоге узнали за сегодня привод коды никогда не рестарте приложения если вам это не нужно когда нужно restart приложения раньше надо было рестарте приложение к и вы хотите расширить память занимаем и тарантулом даже сейчас это не нужно когда он нужно еще restart приложения ну наверно когда ему совсем плохо он ушел там сто процентов циpкa или что-то такое в основном вы должны все-таки рила удить код вы должны загружать новую версию коды поверх старой выгружай а старый загружая новое естественно как говорил чем он с своем докладе то что ваш код не обязан быть обязан дружить вот с этим lilou дом то есть не всегда код пишется так что его можно перезапускать несколько раз итак второй момент эта конфигурация конфликт это не часть приложения еще раз и да это их нужд есть уже готовые модули например mulib sconfig который может тянуть конфиг как с локальной папке с диска так и свитязь и.д. следующая вещь управление с пейсами я на самом деле не сильно призываю вас прямо берите и пользуйтесь этим модулем просто попробуйте посмотрите подходит он или под ваш под ваши нужды и если да то прекрасно если нет то всегда можно найти альтернативу альтернатива это может быть как ручное управление с пейсами как был на слайдах это может быть & tarantula вра и другие похожие средства шаблоны приложений зависимости этому lips тарантулов у меня все спасибо а как дела с тестами там было еще папка т который не сказал то есть автоматически генерируется еще папка т в которой уже есть шаблон для тест то есть вы просто пишете майк тесты и запускаются тесто из этой папки то есть уже продуманная и тестирование этого дела в том числе вот в тарантулов нету статического анализа изначально в шаблоне статической анализа кода нет просто я видел что есть статический фиксатор просто видел что есть статический анализатор код для лу а вот мне кажется было бы довольно удобно если бы он сразу был в шаблоне проекта можно ли а в тестах мы автоматически поднимаем таран туда досмотрите посмотреть как они так я видел там теста sage сгинь он но когда теста это не та тесты sage это на самом деле на там точно такой же починка путей и все что там делается запускается тарантул нас это считают он проходит по этой директории и запускает их по очереди в самом тесте самое важное наверное это вот тнт нет ло здесь просто делается бокс cfg то есть торцуется какой-то instance тарантула который хранит снапшоты экологии в временные какой-то директории и вот здесь вот тут нельзя открыть 01 basic все что делается это вызывается этот tantric варится делать снт cfg можете передать любые параметры по вектору хотите загружается ваш модуль он тут не загружается у него же и запускается тест все ну вот если запустить сейчас на iq тест у нас прошли все тест 1 ну до этого всегда использовались только centos для но и вообще не очень люблю debian пакета или очень сложно но если кто-то хочет добавить данные я буду только рад я конечно он собирался это сделать но мне очень хочется там он и а можешь сказать какие можно спецэффекты словить вот при использовании постоянно поощрил о да например в разработке ну спецэффекты 1 спецэффект который может возникнуть это если вы пишете код так что он не может быть заложен то есть например у вас есть бесконечный цикл какой-то который вы никак не останавливаете таким образом новый код не загрузится то есть если вы пишете скажем как это бесконечно цикл который все время просматривает space или ну допустим рассылает какие-то письма по проходить по списку то вам необходим и вы хотите что-то поменять внутри этого цикла то вам придется писать код таким образом чтобы можно было загрузить новую версию код это можно сделать либо скажем либо конце есть каким-то образом сам файбер который работает либо более мягкий способ это следить за за поколением загрузки с помощью переменной по пещере лодка und da подпиши lawton в данный момент оно равняется единице если мы перезагрузим оно будет равняться двум то есть мы всегда в нашем цикле можем написать во локальное поколение равняется так shallow ткань и тем самым цикл будет работать только до тех пор пока будет работать будет это поколение загрузки об этом еще мозг говорил сегодня а какие еще спецэффекты ну вот один спитцер который с словил но он на самом деле не очень связано с психологом хотя я думаю что связан ну там было просто рекурсивная загрузка мода или самого себя ну короче ладно не суть но если вспомню куда-нибудь напишу альфа-мед версии 19 были изменения с репликации там появился новый orphan мод в котором может оказаться instance насколько я помню покачали лот если вызывается в тот момент когда instance марафон моде то пока чурилово зависает омон сказал что не знаю что с этим делать я тоже не знаю ну надо смотреть как бы ну у меня конкретно такой ситуации не было еще у меня в самом везде сейчас 17 был 16 до 19 вот только начали обновлять может быть что нибудь всплывет игорь спасибо за доклад"
}