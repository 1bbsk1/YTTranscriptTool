{
  "video_id": "0ndWw1udpsA",
  "channel": "HighLoadChannel",
  "title": "Микросервисы в продакшн. Kubernetes / Елена Граховац, Игорь Должиков (Openprovider)",
  "views": 26537,
  "duration": 9480,
  "published": "2017-12-03T14:58:41-08:00",
  "text": "Давайте будем помаленьку начинать так как к сожалению у нас не очень много времени а успеть нам нужно очень много всего пока мы вводную часть рассказываем в принципе Вы ещё можете успеть всё необходимое сделать Итак начну с краткого рассказа о нас вот Игорь тут тоже к нам подходит А меня зовут Лена грахова я пишу микросервисы в компании Open provider ещё я являюсь ведущей подкаста Go Show и первая часть мастер-класса полуторачасовой она будет посвящена написанию сервисов на языке Go и её буду вести я тем не менее здесь со мной есть Мой коллега Игорь и если у Вас будут какие-то вопросы возникать если вы будете что-то не успевать будет что-то не получаться Пожалуйста поднимайте руку Игорь будет к вам подходить помогать разбираться в общем всем Чем только может Игорь Расскажи про себя микрофон нужен тебе только давайте я так погромче скажу Меня зовут Игорь должиков Я работаю в компании провайдер Инженер с настраиваю там систему помогаю микросервиса запуститься качественно и автоматизируем все эти процессы зачастую последнее время занимаюсь Игорь будет вести вторую часть мастер-класса которая как раз будет посвящена кубернетес и мы будем лизи приложение в уже развёрнутый кубернетес смотреть чтобы они заработали пробовать Там что-то новое что-то своё и Какая бы у Вас не получилась какой бы кусочек у вас не получился вы може также попробовать хотя бы сначала те инсталлировать Игорь обращай пожалуйста внимание на людей которые сейчас руки поднимают у них возможно будут какие-то вопросы Наша компания Open прова подготовила Некоторое количество подарков и призов тем кто пройдёт с нами мастер-класс от начала до конца Ну во-первых мы подготовили вот такие сертификаты для тех кто в минимальном Ви это мастеркласс выпот хотя бы минимальное приложение позит и для активных устни два пакета тоже со всякими подарками поэтому оставайтесь до конца Надеюсь это будет вам интересно и полезно пару слов о том Из чего наш мастер-класс будет состоять Итак в первой части мы занимаемся написанием микросервиса мы поговорим вообще о том что такое микросервисы и какие этапы нужно пройти для того чтобы их написать а во второй части мы займёмся подготовкой инфраструктуры для релиза этих микросервисов и собственно сами микросервисы Залия сть она в общем посвящена всем необходимым шагам или всем необходимым темам которые Неплохо бы пройти для того чтобы понять что вы хотите получить Когда вы занимаетесь написанием микросервисов Ну вот эти вот шаги мы с вами все вместе и пройдём и какой-то код вместе напишем прямо в течение ближайших полутора часов во второй части мы займёмся выполнением этих микросервисов в среде кубес и делать мы это будем всё с помощью подхода C нам это поможет пакетный мерх шаблона charts и в общем это наверное самая захватывающая интересная часть этого микросервиса этого мастер-класса потому что это вот вот Весь вот этот процесс какая-то магия какой-то автоматизация это всегда интересно Давайте начинать А кто установил то что нужно было в домашнем задании установить поднимите пожалуйста руку так не очень много у нас таких людей Ну ладно Давайте попробуем начать остальные подключайтесь в процессе Итак что нам понадобится для первой части это язык Go версия 1.7 или 1.8 а ID или редактор для кода который вы используете в обычной жизни который Вам удобен аккаунт на гитхабе инструмент для работы с git аккаунта достаточно бесплатного инструмент для работы с git подойдёт тот который Вам удобен и понадобится докер для того чтобы мы могли собрать контейнер когда мы вообще говорим о разработке чего-либо и пытаемся к этому чему-либо выдвинуть требовани необходимо всегда как какая-то точка отсчёта Мы за точку отсчёта в нашей компании решили взять двенадцати факторные приложения и методологию двенадцати факторов кто слышал про эту методологию Очень неплохо А кто её использует тоже хорошо я не буду подробно о ней сейчас рассказывать опять же потому что время у нас ограничено я привожу только здесь ссылку Но мы с вами будем проходить все шаги благодаря которым как раз наше приложение будет удовлетворять в том числе этим двенадцати факторам Ну и кое-чему ещё первая тема - это подготовка кодовой базы С чего начинается любое приложение оно начинается с репозитория где-либо в какой-либо системе контроля версии в нашем случае это репозиторий на гитхабе и Казалось бы всем очевидно что свой код нужно где-то хранить Но если вы работаете в команде очень важно договориться о том чтобы все члены команды использовали одну и ту же модель ранчес и Какие триггеры при этих событиях будут срабатывать и также я бы рекомендовала не игнорировать теги поскольку теги Дают возможность всегда откатиться до какого-то ожидаемого состояния пара слов о событиях Какие вообще события бывают Когда проходит код свой жизненный путь по написанию есть варианты что с кодом происходит с кодовой базой Ну это этапы релиза Да наверное так а вот именно при работе Ну вот комит первый Да сначала нужно в локальный свой репозиторий сделать комит потом он уходит куда-то в удалённый репозиторий потом в какой-то момент скорее всего возникает запрос на слияние веток и сам этот процесс слияния веток происходит при этом эти все события они как правило вызывают какие-либо триггеры и соответственно на каждой из этих событий должна быть какая-то меня мирабо риде можно делать можно запускать тесты по каким-то Пуша куда-то Например можно собирать приложение можно рели это приложение можно проверять стандарты можно оповещать свою команду о том что что-то произошло очень важно понять как с нашими событиями эти наши триггеры согласовать и если у вас будет оставаться время свободное это вот Тема которой вы можете подумать Если вы видите что в течение мастер-класса вы идёте впер то пожалуйста откройте в этой презентации странички и подумайте о том как к этим событиям эти триггеры можно поставить здесь очевидно есть несколько правильных вариантов и более того они зависят именно от вашего процесса разработки А мы начинаем работать с кодом и первый этап - это подготовка репозитория А собственно мы вам раздали презентации для того чтобы вам удобнее было проходить по этим ссылкам Надеюсь что ссылки будут работать но если в сокращённом виде Они не работают пожалуйста заходите на github называется наш наша организация Community и репозиторий с которым мы сейчас будем работать называется пба а начинаем мы с самого первого шага и для удобства Я здесь шаги разбила в разные релизы Нам сейчас нужен будет г 001 даже ре что у нас за код под этим тегом находится Да 001 берём А у меня есть только чистый репозиторий в git С чего он должен начаться но в случае если это какой-то рабочий код то он наверное может не начинаться с лицензии Но в нём скорее всего удобно сразу написать какой-то минимальный ми который будет хотя бы содержать информацию о том что это за сервис чтобы ваши коллеги поняли что там происходит А кроме этого я предпочитаю использовать митки которые вот у меня сразу проверяют тот код который я буду коммитить на соответствие стандартом Go и помогают мне выявить какие-то потенциальные проблемы я использую ook от компании ял но вы в принципе можете настроить такие проверки на ваш вкус Итак я настроила репозиторий я уверена в том что тот код который я в этот репозиторий буду пушить он будет Ну достаточно как минимум подходящий под стандарты следующий шаг после того как мы уверены что мы решили все вопросы с бранча с событиями с тем как мы будем проверять наш код это написание непосредственно какого-то Самого простого самого начального сервиса Из чего состоит самый простой сервис я ссылку тоже дам сразу но вот пока вас спрашиваю из чего сервис должен состоять что он делает Какие есть варианты так принимают запросы что он с ними делает Так а потом что делает да Совершенно верно и очевидно наш минимальный сервис должен уметь всё это делать мы пока опять чтобы сократить немножко время код писать не будем а только посмотрим а в Go минимальный сервис Ну фактически может Вот такой вот парочкой функций описываться да Нам нужно задать хендлер который будет на наши все запросы что-то обрабатывать и нужно задать непосредственно сам сервис через стандартную библиотеку го и мы слушаем соответственно на каком-то порту все наши соединения вот в этом хендлер их обрабатываем что же внутри хендлера Это просто функция которая в данном случае на каждый запрос выведет информацию о том что обрабатывается такой-то урл Ну в принципе для начала этого достаточно для того чтобы что-то попробовать А что-то запустить Давайте будем идти дальше И следующий шаг - это добавление тестов есть такой холивар вопрос В какой момент писать тесты вот есть ли кто-нибудь кто тесты предпочитает писать сразу пишет код сразу пишет тесты так не очень много таких людей а а кто сначала хочет написать вообще всё а потом только пишет тесты но тем не менее тесты пишет есть такие люди а кто вообще не пишет тесты тоже есть такие смельчаки а хорошо Я пришла к выводу для себя что в случае микросервисов часто полезно тесты писать сразу Особенно если это будет часть какая-то которая не изменится и следующая ссылка - Это пример как раз тестов на тот самый маленький веб-сервис который мы только что посмотрели на самом деле здесь тестировать особо нечего но можно протестировать хотя бы хендлер с которым мы имеем дело соответственно пишем какой-то тест который будет проверять выдаёт ли наш Лер то что мы хотим при этом чтобы протестировать работу самого сервера я пользуюсь специальной библиотекой http Test это стандартная библиотека Go которая позволяет в некотором роде симулировать работу сервера и таким образом я не делая настоящие запросы могу понять как мой хендлер отрабатывает Ну вот что-то такое следующий шаг Как вы думаете какой следующий шаг будет уже все заглянули наверно в презентацию Следуй шаг это довление роутера хорошо у нас уже есть веб-сервер который умеет принимать запросы но очень важно чтобы мы могли разные роуты уметь обрабатывать потому что скорее всего у нас будет какой-то API который должен содержать различные урл и мы должны там как-то это всё по-разному обрабатывать по-разному на эти урл реагировать следующий шаг добавляем роутер а кто знает какие в Go есть роутеры популярные так самые разные называют роутеры есть наверное на мой взгляд самый популярный - это роутер Джулиана шмитта который называется http роутер просто кто-нибудь пользуется им Наверное он не такой уж популярный раз только один человек руку поднял Ну хорошо А мы на самом деле пользуемся вообще даже своим роутером который кстати говоря написал Игорь А вообще вне зависимости от того какой вы роутер используете код наверное будет примерно одинаковый То есть вы где-то этот роутер инициализирует смотреть а смотреть основной Код Да вы где-то этот роутер как-то инициализируется потом регистрируйте те урл которые хотите обрабатывать и дальше говорите либо серверу либо роутеру если в нём есть какая-то настройка Что вы готовы слушать и принимать запросы Но в данном случае мы обрабатываем тот же самый Ур про Пока ничего не добавляем но тем не менее Вот здесь мы уже намели ограничение на то что мы только гет запросы обрабатываем следующий шаг это логирование А вообще если мы запустим наш код который есть на текущий момент в четвёртом теге мы увидим что у нас сервер запущен но ничего не происходит он ждёт соединения но информация о том пришёл ли ему запрос или вообще что-то там высчитывается никакой никуда не поступает поэтому очень важно добавить логирование и соответственно это нам уже уже поможет как-то реагировать на всевозможные события следующий тег Нам нужен тег номер пять добавляем роутер а добавляем лоер вообще в го есть стандартный лоер который просто называется Log но я предпочитаю пользоваться гером logrus вчера на гоме этапе я узнала что есть ещё несколько популярных Лоев которые тоже хороши по-своему поэтому тут наверное надо попробовать разные и выбрать тот который вам больше всего подходит Ну вот мне подходит L поэтому здесь я использую Именно его Да мы сейчас находимся вот по вот этой вот ссылке если она у вас открылась если нет то в репозитории KS Community Step by тег номер п на самом Деме этой здесь пока в общем-то нет ничего но вот здесь сам роутер умеет принимать на вход логгер и логировать те запросы которые происходят у нас а если вы отстаю не переживайте пожалуйста Потому что мы пока с вами только читали код но теперь наконец-то переходим к написанию кода и сейчас мы склони всё это с гитхаба А и будем уже дальше все вместе с этим всем работать Игорь говорит что у нас там слайды у всех открылись но я думаю что Игорь может быть нам тогда поможет а их на какую-нибудь другую флешку скопировать или с флешкой подойти в общем у кого есть какие-то вопросы проблемы поднимайте руку Игорь подойдёт Итак что мы делаем нам нужна вот эта вот ссылка на сам репозиторий давайте я ещё раз вот здесь вот крупно покажу как это всё пишется Вот Открывайте пожалуйста этот репозиторий и первое что надо будет с ним сделать сделать форк Я тоже всё это буду проделывать чтобы как-то вот примерно понять сколько времени на это уйдёт что вообще с этим делать РК у меня прошёл теперь я в своём UB аккаунте вижу этот же самый код и следующий наш этап это развёртывание самого этого кода здесь мы уже начинаем работать сде с переменной Go как знают те кто читали хотя бы парочку слов AG весь код который мы будем писать мы должны будем именно внутрь этого самого Go Pass положить при этом у нас путь вот этот должен повторять тот самый путь который у нас есть на гитхабе внутри папки src нам надо будет создать папку github.com дальше то наше имя пользователя в которое мы скопирую и куда-нибудь к себе разр А ссылка на презентацию Давайте ещё раз покажу у кого вопросы поднимайте пожалуйста руку не стесняйтесь Игорь следит прямая ссылка очень длинная Ох В общем поднимайте пожалуйста руку Игорь Да Скопируй или что-нибудь ещё Постарайся сделать Итак создаём директорию я меняю здесь имя пользователя на своё А дальше перехожу в эту директорию и могу клонировать сюда тот код который у меня на гитхабе ди Ну тем способом которым мне удобно Я вот работаю с консолью если у Вас какой-то другой способ работы с гитхаба то пожалуйста Работайте с ним м так не туда я пошла Можно где-нибудь сесть но на самом деле ой включилось Угу У меня тут что-то есть следующее что нам понадобится сделать нам надо будет а обязательно развернуть правильную нам ветку мы последнюю ветку с которой работали брали 05 Add loger Вот эту вот ветку нужно развернуть в самой презентации все эти шаги есть вот если есть вопросы то Пожалуйста поднимайте руку не забывайте об этом если не успеваете тоже пожалуйста Не огорчайтесь потому что в принципе ничего страшного в этом нет Итак мы делаем чекаут этой ветки Ча loger и от неё как-нибудь просто назвать чтобы тут что-то было А что нам нужно с этим кодом сделать Давайте сначала проверим что он работает тоже у кого получилось открыть презентацию идите пожалуйста по презентации у кого не получилось Можно вместе со мной здесь следить за всем происходящим как нам проверить что у нас вот этот код хотя бы запустится Build Run так Давайте начнём наверное с теста Да го Test я запущу его с флагом минус V чтобы посмотреть какой-то побольше информации выводе ну вот видно что у нас два теста запустили и прошли значит можно делать Go Build а Go Build тут на самом деле полезно перед этим задать переменное окружение вот такую чтобы у нас в ве бинарник который мы делаем попало вообще всё все зависимости которые намм будут нужны так Go Build сделали в результате у нас должен появиться бинарный файл и можно попробовать его запустить Да вот он запустился можно теперь что сделать можно теперь запрос сделать к этому сервису А он у нас запустился на парте 88.000 попробуем сделать запрос вот у меня тот самый ответ появился о том что я вот такой-то вот урл пытаюсь обработать Но на самом деле поскольку мы добавили роутер то другие пути у нас уже не обработают нам вернётся 404 страница а при этом к нам начал логировать все те запросы которые приходили и вот каким-то образом хотя бы минимальную какую-то информацию Мы начинаем получать о том что происходит А вопросы проблемы да Спасибо Давайте дальше пойдём зависимости про которые я забыла перед тем как начать работать Нам необходимо будет ещё зависимости поставить да давайте сейчас я про зависимости тогда расскажу в го есть такое одно место довольно узкое связанное с управлением зависимостями и опять же у нас нет времени очень много про это говорить но Давайте т некоторые проговори внутри проекта есть может быть некая директория vender и если пакет который является зависимостью находится внутри этой директории то он будет взять оттуда Если такого пакета нет то его поиск будет производиться всё в той же директории go src в данном случае у нас уже есть внешние зависимости это лоер и роутер и поэтому нам необходимо эти зависимости как-то обработать в принципе можно использовать просто Go Просто внутри Go это себе склонить и получить возможность с этим работать дальше но тогда возникнет проблема с тем что если мы хотим работать с разными версиями кода или если мы хотим работать с какой-то определённой версией библиотеки с каким-то определённым тегом например то нам придётся очень внимательно за этим всем следить И если мы отдадим например соседу такой код То как ему понять с какой версией библиотеки надо работать чтобы эти вопрос реша Поль ми пакетов ко как раз умеют создавать специальные Мета файлы в которых они хранят информацию о том какая зависимость используется в директорию vender они загружают всё необходимое для того чтобы эти все зависимости подключились и сработали Мы в нашем мастер-классе будем использовать й Но если вы уже пользуетесь каким-то другим менеджером пакетов Вы можете продолжать использовать его соответственно просто все места которые у нас как-то связаны с гм м надо будет заменить на использование вашего любимого менеджера пакетов первым делом этот самый установить и он тоже написан на Go соответственно можно установить его вот такой командой Go и дальше путь на гитхабе до Лайда а поднимите пожалуйста руку кто не успевает кому нужна помощь много у нас таких людей Давайте тогда давайте тогда немножко подом для те кто успевает вперёд есть у нас Некоторое количество вопросов я их наверное буду выписывать на стикеры и стикеры буду в каком-нибудь месте складывать А вы можете подходить на них отвечать и в конце тем кто возьмёт себе больше стикеров и ответит на эти вопросы Мы что-нибудь подарим Так давайте я тоже у себя попробую запустить эту команду посмотреть насколько работает github Ну Вот у меня скачалась минус у минус в Давайте возьмём 5 минут на то чтобы всем синхронизироваться дойти до вот этого места скачать эту зависимость а поднимайте руки кому нужна какая-то помощь Я буду пока писать задания на стикерах специальные Ребят вы не переживайте если кто-то не успевает на самом деле у нас части независимые и со второй части мы начнём опять сначала возьмём уже готовый написанный заранее сервис и будем его лизи можно сразу забрать Поэтому если кто-то совсем не ус Не расстраивайтесь ээ Мы со второй части начнём опять отвечать м сразу нет отвечать не сразу отвечать будем в конце в конце первой части у нас будет время когда мы По всем вопросам сможем пройтись А да давайте так да давайте подходите А можете пожалуйста вернуть презентацию А сейчас Извините что сделать с презентацией вот этот Давайте могу в принципе его же на презентации на самой открыть первый вопрос события в git На какие надо реагировать и почему Надеюсь у меня более или менее понятный почерк тот же самый вопрос да Давайте я вам его не буду писать Да вопрос тот же самый я вам просто стикер дам чтобы Вы как-то могли себя отметить что вы с ним работаете А давайте я наверное тоже буду подходить к тем кто что-нибудь не успевает поднимите руку кому помочь собственно фай Что делаете так вот тут есть интересное предположение вместо Гоби делать Go Run но когда мы го делаем и указываем название файла у нас скомпилировать то вам придётся либо оба этих файла указать но Я рекомендую лучше просто делать получать бинарник бинарник запускать порт на котором по умолчанию у нас там всё запущено 8.000 Давайте посмотрим код если что-то не работает да Давайте попробуем смотреть код что написано в самом коде приложение на каком порту приложение слушает запросы я Ну тут он Подцепил и вот пакет Я не знаю почему он его просит а а у вас слишком новыя м версия бранч У вас слишком новый переключитесь Кто ещё не переключился на бранч который начинается со слов фича 05 э loger 05 немножко немножко не так да есть на слайдах вот вот вот вот он просто если вы возьмёте девелоп то там очень много уже кода и в принципе писать уже будет особо нечего можно в принципе сделать так и посмотреть его Если хотите нос те попробовать пописать то лучше переключиться на бранч F 05 loger если это получилось Давайте идти дальше Игорь смотрит наверное помогает людям которые что-то не успевают А я буду помаленьку идти дальше а бранч называется вот так вот жирненький вот здесь вот название бранча после того как мы глайд установили Нам нужно будет внутри нашего репозитория с кодом с которым мы работаем выполнить команду glide Create у кого другая какая-то система управления пакетами выполняйте ту команду которая нужна ей для того чтобы все зависимости подтянуть glide Create нам как раз позволит узнать о том какие у нас зависимости есть и выведет в довольно интерактивном и удобном режиме всю информацию о них вот я сейчас тоже у себя это всё проделаем да вот она пошла информация о том какие он находит у меня в репозитории связанные с гладом вещи Он говорит что он не нашёл конфигурационный файл и хочет его записать и дальше он ищет зависимости в путях импорта И вот он начинает находить зависимость я выбираю там какие-то нужные мне варианты А здесь при этом гй очень в очень удобной форме предлагает информацию о том на какие изменения реагировать что будет если добавится какая-то минорная версия Что будет если добавится какой-то патч и следующая зависимость - это роутер вот как-то так две зависимости Я поставила м Если я сейчас посмотрю что у меня с этим кодом с точки зрения git происходит то видно что у меня появился файл glide yaml который в себе как раз содержит информацию о тех зависимостях которые есть а напомню Это мы выполняли команду glide Create следующая команда которая нам будет нужна - это glide install для того чтобы все эти зависимости установить зависимости подтянулись и теперь опять же если мы посмотрим на то что у нас здесь происходит Мы увидим что у нас во-первых появился файл GL Log во-вторых появилась директория vender Кто знает что в этих файлах может находиться или хотя бы предполагает так Это вы про Видимо да да в фа если мы посмотрим опять же мы увидим информацию о том какие конкретно коммиты этих библиотек у нас используются а как известно Люди бывают разные и в том числе разработчики Open Source бывают разные они могут по каким-то причинам например перетереть хэш или подменить информацию о том что находится в том или ином теге и в принципе вот информация о том какой конкретный комит мы использовали когда разворачивали эту версию библиотеки она может нам очень пригодиться зависимости поставили теперь после того как мы поставили зависимости Наши все го тесты наконец-то должны заработать пробуем ГОСТ мину V запустить и пробуем Build запустить всё должно собраться в результате должен появиться бинарный файл специфичный для вашей операционной системы и он тоже соответственно должен уметь запускаться и он запускается ждёт слушает соединения а мы сейчас Давайте здесь промежуточный результат посмотрим что мы сделали Мы форк репозиторий ответ вились ответки фича 05 loger запустили Ну поставили зависимости запустили тесты запустили сборку запустили сам сервис попробовали сделать к нему запрос а запрос можно сделать либо из браузера либо кулом я вот просто вот так кулом предпочитаю делать потому что больше информации приходит Ну можно то же самое всё в браузере набрать показать А gopass ну у меня gopass настроен на мою директорию домашнюю с Goo Да это не не то место где установлен Go это внутри вашей домашней директории какая-то вот может быть другая директория там А по умолчанию по-моему это домашняя директория slg так если я в браузере сделаю запрос то вот ту же самую строку Я в ответе получаю запускаю я при этом сервис на парте 8000 идём дальше Потому что опять же времени не очень много и следующая тема которая нам нужна - это конфигурирование А кто видел код Кто смотрел на код Как вы думаете что можно здесь сконфигурировать в этом ВМ вообще в сервисах Что обычно конфигурируется да здесь можно было видеть Что мы слушаем какой-то порт и вот этот порт Неплохо бы конфигурировать для того чтобы иметь возможность слушать на том порту на том портеро в данном окружении нам будет необходим поэтому полезно добавить код который нам позволит этот самый порт слушать давайте я попробую прямо тоже здесь эти изменения добавить соответственно нам понадобится наш файл где у нас всё лежит самое основное и вот здесь мы слушаем конкретный порт вместо этого нам нужно слушать специальный порт а опять же будем пользоваться стандартной библиотекой а команда OS функция OS Get позволит нам слушать некоторый порт который нам нужен будем в переменных окружения задавать конфигурацию вот каким-то таким образом и соответственно в какую-то переменную писать этот самый наш порт и на нём всё происходящее слушать При этом если вы пользуетесь какой-то ID то у вас импорты будут срабатывать автоматически Если вы пишете в каком-нибудь совсем простом блокноте вам нужно обязательно импортировать те библиотеки которые вы будете использовать в данном случае мы библиотеку OS используем стандартную как-то так должен наш код выглядеть кстати говоря вот здесь я написала Get это получение из переменных окружения и соответственно для того чтобы это всё заработало Нам нужно будет эту переменную передать сес по Ну допустим 88.000 А но сначала нужно перекомбинация Да как верно на самом деле сказали Я здесь забыла адрес потому что нам слушать нужно не только порт нам ещё нужно какой-то хост тоже слушать Ну можно просто вот так например сделать любой хост слушаем этот порт О заработало а снова пробуем сделать запрос запрос срабатывает наш Если что мы находимся сейчас на каком-то этапе снова и можно здесь по бранча в принципе ориентироваться бранч с которым мы сейчас работаем он называется конфигурация Это г 007 или вот этот вот бранч здесь в самом коде который Здесь представлен чуть больше вариантов проверка того что порт задан или нет И наверное в реальном приложении полезно проверять задан ли порт Ну вот примерно какой-то такой результат На этом этапе должен получиться тоже давайте пока пойдём дальше и в принципе у нас уже как-то приложение заработало у нас там есть возможность задавать разные Роу есть возможность даже немножко его конфигурировать Поэтому Давайте доке контейнер снова у нас наверно не будет большого количества времени на то чтобы поговорить о том что в этом докер контейнере должно быть Почему и для того чтобы докер контейнер собрать Нам нужен докер файл который нам задаст конфигурацию мы идём в следующий по счёту бранч который начинается с Цифры 08а кон самом деле совсем опять же немного строчек буквально девять в данном случае для данного сервиса нам даже операционная система не понадобится поэтому мы запускаем его с параметром From Scratch А из переменных которые мы конфигурируется уже скомпилированный скомпилированный бинарник поскольку в принципе нам от этого докер контейнера больше ничего в рамках тис не надо будет Вот соответственно откройте пожалуйста вот эту ветку которая начинается с фича 08 это наш восьмой шаг и восьмая Тема и вот этот догер файл нам понадобится там где мы пишем сервис я делаю всё тоже самое создаю здесь дор файл ничего особо не меня и теперь важный момент перед тем как этот файл запускать нам нужно сначала собрать сам бинарник и здесь у нас добавляется ещё одно переменное окружение goos поскольку мы работаем с докер контейнерами у нас там Linux нам нужно обязательно здесь в качестве указать Linux иначе у нас сборка не заработает Но если у вас Linux то наверно заработает Мура из очень таких популярных ч Go Крос компиляция которая позволяет вне зависимости от того в какой операционной системе вы сами работаете собрать вам бинарник для любой другой нужной операционной системы из тех что поддерживаются бинарник мы получили Теперь если я его попробую здесь запустить он у меня не заработает потому что он неправильный для этой операционной системы но зато В доке контейнер мы сможем его упаковать здесь следующая строка это как раз сборка контейнера и сборка имиджа и просто минимальные параметры которые нам нужны это какой-то тег который будет отвечать за наше приложение в данном случае у меня просто степ by СП и путь к доке к докер файлу который у нас в корне нашего репозитория находится тоже просто копирую пытаюсь собрать вот у меня пошла сборка все Шаги на экране перечислены в презентации тоже они есть прямо вот в таком вот виде где они работает на Windows с переменными окружения как-то может быть Угу как-то наверное так то есть да у меня примеры здесь все приведены для Linux подобных операционных систем если у Вас Windows то посмотрите пожалуйста как с переменными окружения работать чтобы все шаги компиляции пройти контейнер мы собрали Можно попробовать его запустить мы при этом у нас есть какой-то порт и нам нужно этот порт тоже пробросить наруже чтобы мы к запущенном контейнеру могли запросы делать А у кого возникают какие-то вопросы давайте наверное минутку возьмём чтобы всё пройти так Укажите пожалуйста так вот докер надо запустить да иначе он ничего не соберётся для того чтобы докер заработал его надо сначала запустить давайте я попробую следующую команду тоже всё-таки у себя выполнить запустится у меня контейнер или нет я правда порт по-моему какой-то другой слушаю наверное вот Давайте его и продолжать слушать а то возможно 8080 занят Ну что-то у меня запустило можно до PS команду выполнить посмотреть Да вот он мой контейнер в котором та самая команда и можно снова попробовать сделать кулом или браузером Запрос к тому пути по которому мы ожидаем что-то получить Да и запрос снова проходит Итак наш текущий шаг запустить докер контейнер и чтобы всё заработало чтобы можно было к этому докер контейнеру выполнить запрос А давайте кто не успевает догоняйте А я пока ещё каких-нибудь вопросов напишу Да придумала какие вопросы буду писать кто успевает вперёд подходите берите вопросы а а давайте помаленьку дальше будем двигаться Если вы не успеваете ничего страшного потому что следующий на шаг он в принципе не требует докер контейнера мы поговорим про версионирование мы получили какой-то бинарный файл мы получили докер контейнер который содержит этот бинарный файл И когда я где-то запускаю его в принципе мне неплохо бы знать какая у меня версия кода там находится чтобы понять Вообще какой-то комит например или какой-то тег и чем это отличается от от какого-нибудь предыдущего контейнера это бывает полезно при всевозможной дебаггинг и Вот соответственно такую версию нам надо будет дальше добавить А дальше мы будем всё время кохо смотреть чтобы не тратить на это много времени следующая ветка соответственно у нас 09 интернет похоже пропал совсем нет не совсем здесь я добавляю специальное специальную директорию version в которой соответственно будет пакет с таким же названием и в этом пакете У меня просто задано три константы Лиз репа и комит эти константы должны отвечать за версию релиза которая сейчас запущена за репозиторий с которого всё это запущено и за текущий комит здесь У меня пока они не заданы Но есть одна маленькая хитрость которая нам поможет во время компиляции это всё задать кто-нибудь знает какая как у мне во время компиляции сюда что-нибудь подсунуть а это файл который называется version Go он находится внутри директории version вот здесь вот путь можно к нему посмотреть а мы компилирует чтобы у нас статические были значения потому что у нас на бинарник Мы запускаем из какого-то конкретного кода там с каким-то конкретным коммитом например Ну да на самом деле здесь были варианты а сейчас пойдём дальше Да это всё увидим здесь были варианты которые отвечают на этот вопрос На текущий момент нам кроме этой директории ничего не нужно этого файла а можно прямо на гитхабе это всё посмотреть но ещё один важный момент то что нам эту самую версию нужно куда-то писать И вообще говоря Неплохо бы например завести под это какой-нибудь специальный хендлер в который можно в котором можно эту версию хранить или что-нибудь ещё ну то есть мне же нужно посмотреть по какому-то урлу какая у меня версия запущена пока это всё оставим где-то в коробочке пойдём дальше и поговорим как раз про то место в которое мы это всё будем добавлять хески кто-нибудь может сказать что такое Чек обычного сервиса так пожалуйста а ещё варианты жиз провер жиз так да проверка здоровья проверка жизни проверка того что сервис работает они бывают полезны если вам что-то надо поморить а или посмотреть вообще можно ли что-то развернуть А в кубернетес они полезны А ещё по нескольким причинам вообще кубернетес предполагает наличие двух видов таких хков это Liv про и rides PR и как следует из названий Liv prop связана как-то с жизнью она проверяет фли сервиса связана с готовностью она проверяет готов ли сервис принимать запросы а тоже код Давайте посмотрим В отдельной ветке вот я добавляю здесь специальных два хендлера один ИО а второй he и как раз эти два хендлера будут у меня отвечать за пробу и за пробу В общем случае эти хендлер отличаются потому что сервис может по какой-то причине быть живым но он только стартанул и он тогда ещё не готов слушать соединение но в очень многих случаях эти пробы будут одни и те же я здесь Для примера привела две разные и Вотс у меня самый простой он просто возвращает код 200 и пишет что всё хорошо в ответ этого в принципе достаточно А вот инфо он у меня как раз более хитрый вот здесь как раз те самые константы которые мы описали в пакете а version мы будем использовать Но вот здесь у меня Ир Pass от ково SMS Community на самом деле здесь у вас будет когда вы всё допишите ипор Pass содержать вашего пользователя а так три параметра у меня здесь передаётся это функция из Common handlers тоже специального пакета из репозитория k8s Community Давайте посмотрим на код вот этого пакета вот он один нужный нам хендлер он получает какую-то текущую информацию о том что здесь происходит он получает хоней он получает информацию о том сколько памяти сейчас использовано о том сколько рутин сейчас запущено и всю эту информацию он выводит в структуру специальную которая соответственно просто в J кодируется и на выходе получается ответ содержащий всю эту полезную информацию в том числе версию репозиторий комит Ну какую-то информацию ран тайма это сторонняя библиотека для моего сервиса она находится вот здесь 8S Community handlers из самого сервиса из десятой ветки можно её посмотреть вот здесь а нужно будет Вот это всё добавить да потом нужно в IDE по идее её добавить через glide get и вот этот ть по аналогии с готом GLS работает Если у вас она уже описана в GL потому что он именно обновляет те пакеты которые у вас уже перечислены в файле с описанием зависимостей А давайте мы всё это доделаем тоже в свободное время нам осталось буквально парочка шагов сдуй необходимый ша я его немножко пропущу но кратко о НМ упомяну Если вы пишете какой-то настоящий сервис то скорее всего Кроме того чтобы просто обрабатывать запросы от пользователей он может ещё что-то делать в фоне может быть обсчитывают своё состояние отдельный вопрос с точки зрения микросервисов должен он так делать или нет но в общем случае может он что-то в фоне ещё делать И вот если вы хотите этот сервис завершить то в случае если он у ва считать Неплохо бы сначала досчитать а потом завершить поэтому на сигналы операционной системы нужно тоже как-то реагировать уметь их правильно обрабатывать а Исходный код ссылка на Исходный код здесь мы её пока пропустим чтобы у нас побольше времени осталось на всё остальное и перейдём к следующей теме которая на самом деле последняя тема первой части это написание мейк файла кто сталкивался с мейк файлами в своей жизни почти все сталкивались А кто может сказать что такое makefile инструкци Да спасибо большое совершенно верный ответ makefile - Это набор инструкций для сборки для помощи в этой сборке в нашем случае makefile будет содержать в общем-то все те команды которые мы сегодня уже запускали Мы запускали ГОСТ мы запускали Go Build мы запускали doer Build и docker Run и вот эти все команды они нам понадобятся для того чтобы собрать приложение и потом в кубернетес его положить соответственно чтобы как-то это всё не приду Как писать Руками или как-то ещё мы это всё добавим в Make F код снова просто разберём это у нас ветка 12 ча 12 Make File и отсюда Нам нужен собственно только этот самый Make файл который опять же у нас находится на одном уровне с приложением Ну на самом деле тоже makefile он в случае работы с сервисами или там с cuber lgo Он наверное вырабатывается со временем здесь я не буду подробно очень по нему проходиться Я просто отмечу что у нас есть здесь все необходимые нам шаги запуск тестов установка зависимости в том числе и например проверки на то насколько код у нас соответствует стандартам Кроме этого здесь есть эта самая сборка докер контейнера и вот здесь есть то самое место про которое я говорила когда спрашивала вас как версию подключить вот с помощью специального флага которые у нас вот в этой строке мы во время компиляции подменяя наши константы на те которые нам нужны а нужны нам те которые на момент компиляции у нас есть текущий релиз который мы Ну например как-то сами задаём комит текущий и текущий репозиторий который можно получить с помощью вызова команд git Итак готовим который нам позволяет ВС запустить чеки и в принципе После этого мы можем считать что сервис наш готов для работы с куне Давайте быстренько по чек-листу пробежимся что мы должны получить а потом у нас ещё будет время чтобы всё закончить Итак первое мы должны если мы начинаем с пустого репозитория подготовить репозиторий настроить все нужные нам хуки на коммиты договориться о том Какими ветками мы будем оперировать и Как договориться об отношениях к команде Будем ли мы использовать например workflow или мы будем плоском виде использовать только одну ветку или как-то ещ После этого мы можем начать писать какой-то код получить минимальный нужный нам веб-сервер написать на него тест и запустить проверить что всё работает После этого мы можем добавить роутер нам обязательно понадобится логирование нам обязательно понадобится управление зависимости если мы говорим о коде который должен пойти в прок Нам нужно будет задавать конфигурации Нам нужно будет собрать до контейнер иметь какую-то информацию о сборках и полезно иметь чеки для того чтобы этот сервис проверить затем нам понадобится скорее всего graceful shutdown для того чтобы аккуратно схлопнуть сервис когда он будет завершаться и нам нужен будет make фай в котором мы сможем перечислить полезные команды которые мы затем будем выполнять а будет у нас время всё закончить давайте пока разберём вопросы их было не очень много дополнительные вопрос был про события кодовой базы на какие изменения кода или другие события нужно реагировать добавлять триггеры что должно срабатывать кто думал над этим вопросом какие у вас есть мысли это то что мы можем запустить со стороны клиента Да PR Push prit как-то проверить наш код ещё на Да и на стороне сервера нам предлагают запускать C мы на самом деле ещё и CD будем запускать на стороне сервера Вот я например устраиваю не только когда в мат но и когда в если работает с чтобы знать что вобще в этом коде жит оттого потом саме всё очень сильно зависит от того подхода который вы в вашей команде выбрали мы во второй части продемонстрируем пример подхода может быть не очень подходящего для продакшн но демонстрирующее хотя бы минимальный процесс работы с кодом включающий именно не только проверки но и доставку этого кодов прокш а следующие у меня были вопросы но на них никто не ответил поэтому давайте я их оставлю прямо вот совсем совсем а на свободное время они все есть в презентации это вопросы начинается со слайда 68 если у вас будет время сейчас в перерыве ответить на эти вопросы а пожалуйста отвечайте и после перерыва Можем по ним тоже пробежаться А на этом в принципе первая часть завершается у нас и мы можем сделать перерыв я думаю что двадцати тный лучше пятнадцати Наверное если вы хотите перекусить или подышать чем-то можете сходить подышать и перекусить Кто хочет закончить написание своей программы мы с Игорем будем к вам активно подходить помогать всё закончить У нас есть ещё Некоторое количество стикеров которые мы с удовольствием вам раздадим но пожалуйста оставайтесь здесь и во второй части мы будем заниматься доставкой сервиса в кубернетес При этом если вы не успели Дописать этот сервис ничего страшного потому что мы в качестве примера попробуем уже готовый написанный сервис доставить а потом ещё в оставшееся время довести вот этот наш сервис который есть у нас сейчас Спасибо и перерыв тогда 15 минут начинаем в 14:25 мы ограничены К сожалению по времени потому что к 4 часам мы должны будем аудиторию освободить но тем не менее вы пожалуйста не теряйтесь Мы где-нибудь в коридоре Найдём достаточное место там вместе все сядем Допиши всё что хотим раздадим сертификаты раздадим призы поэтому пожалуйста Не уходите далеко Если вы хотите продолжить с нами общение Здравствуйте дорогие коллеги вторая часть у нас будет связана с релизом сервисов кубернетес Ничего страшного Если кто-то чего-то не успел сделать в первой части потому что мы возьмём готовый уже вариант готовый шаблон сделаем из него форк сделаем небольшие изменения и пройдём Весь процесс CCD зарез данный сервис в кубернетес Сейчас минуточку я ещё немножко настрою пожалуйста аналогичным образом будем поступать если у вас что-то где-то не получается или возникают вопросы поднимайте руку Теперь я буду подходить и помогать ва так во второй части Значит мы пройдём вот все эти этапы а нам нужно будет скопировать наш сервис и я вам немножечко расскажу про CD процессы которые у нас будут здесь в мастер-классе Так давайте убедимся что тот инструментарий который нам нужен У вас он есть Вот то что отмечено галочкой это терминал ssh консольно git и github персональная учётная запись поскольку кто участвовал в первой части у всех это должно быть кто только что подошёл Вот это минимальные требования которые необходимы для того чтобы продолжить дальше скажите вот у кого-то нетто галочкой то есть либо github аккаунта либо git есть такие нет а терминал любой терминал Нет смотрите вот то что Галочка не отмечена мы с вами поставим если у кого-то нет из того что отмечено галочкой то Поднимите руки у всех всё есть да хорошо все наши материалы Исходный код лежит вот по этому адресу github.com k8s Community и всё что мы делаем любые значит инструменты которые мы используем они есть по этому адресу поэтому там можно будет всё найти даже после мастер-класса сделать это потом после на своём Google аккаунте создать рне и всё это зарезать все инструкции там будут Поэтому вот пожалуйста запомните этот адрес скопируйте но в первой части с ним работали поэтому я думаю не проблема Теперь давайте возьмём типичный сервис который у нас будет релиз в сду kubernetes сделаем Просто РК репозитория и э посмотрим что там внутри есть то есть Вам нужно зайти по адресу github.com k8s Community mpp и сделать там Fork в свой аккаунт после того как вы нажмёте РК у вас высветится просьба выбрать или если у вас один аккаунт то сразу на о аккаунтов вы выбираете тот с которым вы работали и делаете форк то есть всё довольно просто если кто-то не успевает поднимайте руку я буду Немножко там останавливаться фор у всех получилось сделать да У нас есть два файла которые влияют на сборку в первой части мы их немножко рассматривали это дофа в нём у нас он очень минималистичный он без операционной системы там Всё сделано всего лишь используется две одна переменная и используется сам бинарник то есть он довольно про сдуй компонент обязательно в него Вот так вот внимательно всматриваться изучать что там есть мы его используем шаблонно то есть нам здесь понадобится всего лишь изменить два параметра Потом я расскажу про них это uspace и мы просто сделаем следующий релиз и поменяем там номер версии Вот давайте познакомимся с самим процессом например набо нам а по просьбе Лены было заменено на девочку вот есть у нас разработчик который Как вы думаете делает что вот у него код готов что он с ним делает он начинает Ну как правило делать реквест или пуш куда-то в репозиторий удалённый Ну например это будет сдел туда зада ко для того чтобы процесс сам пошёл автоматизировано пошёл чтобы у нас на этот код была какая-то реакция Как вы думаете что нужно например на github Ну код мы туда залили и всё и дальше у нас дело не движется А мы хотим CCD организовать правильно к нам нужно сделать к например с помощью github Apps Ну раньше это был github integration если я не ошибаюсь вот поэтому мы с вами зарегистрируем github integration который нам сделает Event Event будет сделан в систему CD которая специально написана для этого мастер-класса поскольку она специально написано Вы понимаете что это не очень было сложно то есть мы сделали таким образом что не взяли Jin и не заставили людей скажем так изучать всё это настраивается Каким образом это делать тем более вы можете поставить всё это себе установить и настроить здесь простая Go утилита которая будет слушать Event на бранч некоторый и делать некоторые процессы Как вы думаете какие процессы запускает CD обычно Тест правильно А ещё какие сборка деплой Да всё верно И это всё может происходить Ну например на отдельной виртуальной машине также это может происходить в контейнере Например если у нас у CD есть некоторые агент который запускает процессы вот данные тесты деплой В контейнере то то же самое можно сделать и контейнере Но в данном случае будет некоторая Машина на которой Бут процессы выполня и вот тот сайфа в котором отражено как у нас происходит процесс теста то есть на самом деле вот фа в данном сервисе это фактически вся жизнь сервиса там отражена там и тесты там и деплой там он зарождается сервис жив не умирает плоди даже экх Если вы Спросите что такое CD то основная основной код у нас расположен в Make файле То есть все все компоненты Там они сосредоточены и поэтому CCD система - это всего лишь та утилита которая запускает команды Make Test Make deploy всё две команды и вот это у нас всё выполняется Когда у нас виртуальная машина собирает builded Image она куда его складывает Как вы думаете Dock registry Да идж попадает do Reg он там у нас хранится и вот этот процесс в файле Это всего лишь вот эта команда Push контейнер А дальше у нас есть пакетный менеджер HM куда у нас поступают тоже команды в данном случае команда деплоя их там несколько и собственно самм делает релиз внес как это выглядит в файле Вот вот эти вот четыре нет Три Три строчки первая строчка добавляет просто репозиторий который у вас будет для хелма специальный с чарта второй его обновляет а третий вот собственно его депт Поэтому вот поэтому с этим йк файлом Вы на самом деле можете в дальнейшем создавать свои собственные сервисы брать простейший CD неважно даже jenkins или вот та утилита которая у нас там есть и в дальнейшем тот же самый процесс CCD у себя организовать А дальше у нас э в куне всё уже довольно просто происходит активируется команды API которые создают деплоймент а Собственно сам под который и берётся имидж при этом для пода из Reg Как вы думаете Сколько может быть подов для сервиса их может быть больше чем один а сколько может быть контейнеров в поде Ну не тысячи на самом деле в поде обычно один контейнер зачастую Но их может быть больше одного и в пони по Ну вот например два контейнера всё на самом деле вот весь этот процесс всего лишь вот этот схем то есть сервис у нас загружен готов к работе и если он прошёл вот эти все этапы если тесты прошли если деплоймент не сломался то у нас он должен зази это примерно кратко как происходит процесс и вот сейчас мы с вами сделаем зарегистрируем github integration для того чтобы наш сервис попал за релиз для этого нужно зайти по адресу k8s Community по этой ссылке и нажать на пиктограмм Я подожду пока все синхронизируются пределах получается одной Ну одного железного Юнита есть на несколько машин знаете тут Наверное Давайте раскрою немножко Что такое пот с железом это никак не связано пот - это единица минимальная единица в кубернетес в котором располагается сервис в одном или более контейнеров под имеет адрес IP не контейнер как в докере а именно под и те контейнеры которые находятся в поде Они общаются по локал хосту А вот сам под он имеет адрес который важен для непосредственно Это адрес не мается на хост какой-то на железный может быть несколько подов на ноде на одной на второй на третьей нет такого невозможно Да пот на нескольких машинах не может быть появится Вот такая менюшка где предлагается выбрать аккаунт для авторизации Ну собственно если он один сейчас один просто нажимаете авторизовать и дальше лоцируется примерно такая картинка у кого не получилось Скажите То есть вы должны авторизоваться под своим аккаунтом и получить вот такой Файлик конфигурации вместо токена естественно какой-то реальный токен не иксы если у кого-то не получилось поднимите руку Лена вам поможет на пиктограмму нажимайте Если вы на первом этапе тут на самом деле сразу видно что Бендеры писали потому что кроме котика ничего нет И вот кликать надо именно на котика интернет Похоже у нас опять немножко притормаживает Судя по тому что редирект на гит о дол важный нужно авторизоваться поэтому подождём пока все кто хотели чтобы попали на эту страницу поднимайте пожалуйста руку кому нужна какая-то помощь не стесняйтесь поставим сейчас сейчас поста мы этому придём Да мы я вам расскажу как всё это поставить У кого есть вторая часть презентации можно в принципе её у себя открыть Если вы Если да если кто-то идёт вперёд Вы можете открыть на k8s Community там есть специальный репозиторий называется k8s Workshop ru и там есть 01 setup по-моему если я не ошибаюсь Или 02 02 часть 2 setup Ну оканчивается на setup мы к этому потом подойдём но кто-то забегает если вперёд можете установить Cu ctl и скажите у кого не получилось конфигурацию вот эту не э к себе у кого нет данной странички не вышло есть кто-то Ладно хорошо продолжим если Что заявите Лену с ну пару пару недель наверное мо так я немножко наверное смотрите дальше нам нужно выбрать внизу есть ссылочка называется Нана k8s integration нам нужно после авторизации зарегистрировать нашу интеграцию и вот там есть внизу ссылка на неё надо кликнуть у вас после того как нажмёте на эту ссылочку появится Примерно вот такой вот экран дальше Всё просто нажимаем просто configure Кто устанавливает первый раз у тех будет на кнопочки написано Install ничего страшного Да нажимаете Install Выбирайте аккаунт Ну если у вас один аккаунт то выбирать не надо то выбирать не надо Да тогда у вас вот появится Вот такая картинка там репозиторий значит нужно найти который вы форк до этого для этого нужно выбрать repositories нажать просто буковку и у вас будет список в котором вы найдёте то есть мы устанавливаем это приложение только для My длях Хри для не нужно только для вот ПП после того как вы его выбрали дальше вам возможно будет предложено подтвердить паролем что вы устанавливаете интеграцию если у кого-то стоит судо Mod на github то пароль не будет предложен Ну таких мало наверное Вот и в итоге в конечном у вас будет отображена Рани с параметрами интеграции к чему у вас интеграция получает доступ это в основном на чтение ничего страшного здесь не происходит Мы просто значит по вот по данной интеграции будем слушать что у нас происходит с Давайте немножко Познакомимся с кубес Кто был сегодня утром в 10 на самом деле ничего нового я не скажу но Кто не был немножко скажем так и в процессе ещё Мы настроим настройка Значит нужно перейти по ссылке github k8s Community Workshop и выбрать Разде там у вас будет очень поб инструкция как установить две консольных утилиты Cub ctl и helm и вот если у вас ничего не получается или что-то не получается вы можете поднять руку и мы вам поможем на самом деле пока чтобы тем кто уже всё сделал чтобы было не скучно Я наверно позадаю некоторые вопросы вот Представьте себе что это схема куртис и у нас есть некоторая нода мастер Как вы думаете достаточно ли всего вот этого для того чтобы у нас кубернетес работал и выполнял какую-то какие-то функции или что-то нужно ещё там вот подсказки небольшие Да они немножко достаточно для нашего мастер-класса достаточно будет три потому что мы будем релиза сервис который available и который будет находиться как минимум в трёх экземплярах по одному на каждой ноде Как вы думаете какие необходимые компоненты на ноде вот на Мастере есть cubed Cub Proxy APS Skill и контроллер менеджер Какие компоненты достаточно на ноде чтобы она заработала прокси и Дада если мастер упадёт будет плохо поэтому Как вы думаете что нужно чтобы мастер если упал и наша схема нашо работал да нужно добавить ещ пару мастеров они Да ноды продолжат работать но изменяться конфигурация не будет И вы не сможете ни залить никакой никакой сервис Да да да Всё правильно Всё правильно то есть мы не сможем не сделать ни деплоймент если у нас мастера нет И никаких изменений у нас не будет происходить но как правильно сказали что настолько Всё правильно хорошо устроено что даже без единого мастера у нас будет сервисы наши будут отдавать трафик они будут работать Что нужно для того чтобы сохранять информацию кто знает то есть где где сохраняет информацию про всё правильно и для того чтобы всё это работало нужно тоже как минимум например более одного инса чтобы это было зачастую их располагают обычно на мастерах то есть на Мастере оди на следующий масте другой но бывает и конфигурация с отдельными и вот в нашем мастер-классе Мы немножко схитрить а подготовим такую конфигурацию которая будет один Мастер и о itc Почему именно так это сделано для того чтобы вы смогли повторить Точно такую же конфигурацию в Google акаунт в бесплатном где ресурсы достаточно ограниченные и если ваш сервис не в продакшн то вам не обязательно нужно один более одного мастера и более одного tcd Хотя там есть настройка такая что вы можете создать три мастера и на нём три dcd и три ноды Но тогда ваши ноды будут немножко послабее по ресурсам то есть насколько я знаю например Google акаунт Он позволяет создавать виртуальные машины с цпу не более восьми То есть это максимальное значение для бесплатного аккаунта ещё у нас будет одна виртуальная машинка которая называется Ну в данном случае cdm это вот та виртуальная машинка на которой будет выполняться процесс CD не обязательно требуется именно такая конфигурация это просто вот в нашем воркшопе она сделана именно так это может происходить например где-нибудь в контейнере все процессы C могут как я уже говорил выполняться загруженном контейнере и с помою агентов создать сюе контех и так далее В данном случае это отдельный отдельный хост Вот и если у вас всё получилось настройка вы скачали то команда gets например При правильном настроено выдаст у вас некоторые вот ть не получилось настроиться и выполнить вот эту команду с настройками токен у вас должен высвечиваться на странице 8 Скажите пожалуйста руки я буду подходить кому нужна помощь да Вот его надо заменить на сначала вот сделайте команду а потом вот здесь по этому адресу его поменяете да да Когда будет релизинг Как раз вот те компоненты которые участвуют в CD токен - это гостевая авторизация для того чтобы можно было просматривать ресурсы вот таким вот образом То есть если Вы у себя в каталоге Home то Cube slc fig создали файл который вот тут у вас там высвечивался и внесли в него токен то Cub ctl у вас будет работать и реагировать вот на эти команды высвечиваться информацию по в данном случае по подам загружены вы имеете в виду сертификат токе если у кого-то не получилось ещё поднимайте руку смотрите вот здесь мы видим поды которые в дефолтном спейсе он так и называется дефолт э в нём у нас загружены как раз компоненты которые отвечают за CCD если мы хотим посмотреть что у нас находится в другом нейсе например namespace k8s тире Community то мы увидим что там загружена какая-то одна программка Вот как раз которую мы хотим загрузить Со своего аккаунта она называется mpp у вас должен быть Примерно вот такой вот вывод получиться то есть ключик N - это k8s Community и вот в этом спейсе совершенно другие поды не те которые были предыдущем дефолтном по про предыдущий немножко расскажу смотрите у каждого пода есть свой IP адрес это не IP обща к поду по этому адресу и вот у каждого сервиса Вот например се Chat в данном случае он в количестве ТХ экземпляров Согласно ГП он расположен на разных нода то есть там нода 010203 и мы с помощью сервиса есть такой специальный контроллер будем об эта команда нужна для того чтобы посмотреть контроллер деплоймент у нас внутри деплой описано как у нас создавать сервис количестве скольки экземпляров и вот если мы её выполним мы получим Примерно вот такой вывод у вас он будет конечно же скорее всего другой и будет сервисов плотов немножко побольше если опять же у кого-то не получается нормально потому что мастер-класс он у нас живой Как говорится мы создаём какие-то компоненты туда добавляем поэтому у вас может быть гораздо больше здесь деплоймент загружено чем вот показано на слайде Давайте посмотрим есть ли деплоймент у нас в спейсе какие 8S кони должен быть один скорее здесь разницы нет для примера Теперь смотрите Давайте посмотрим какие у нас есть сервисы сервис - это достаточно важный компонент потому что посредством сервиса общаются между собой все загруженные приложения внутри рне все загруженные сервис поэтому так и называется на самом дележе виртуальный то есть что это означает обращаясь к нему по этому адресу через ДНС по имени например через resing мы Обращаемся к трём инстанса например нашего сервиса вот chs мы видели на предыдущем слайде их было три экземпляра А как это происходит что мы Обращаемся к одному сервису А в результате идм на какие-то три и как это всё работает у сервиса есть витуаль и сервис с помощью селектора знает каким подом обращаться потому что у подов есть аналогичный селектор в данном случае вот это App равно и сервис по этому селектору просто по рону обращается каждому из исов и поэтому трафик можно сказать разделяем нав будет ходить на оставшиеся доступные поды также попробуем вывести если у нас сервис в k8s Community там тоже должен быть один сервис вот с одним IP адресом Теперь познакомимся Что такое helm и что такое шаблоны зачем они ему нужны если мы посмотрим на картинку то это вот как раз именно вот эта часть Когда у нас уже сделаны тесты у нас сделан Билд имиджа и дальше нам нужно задеплоить наш сервис например командами helm для того чтобы раскрыть как всё это происходит Мы сделаем с вами форк ещё одного репозитория который называется мы My charts он находится там же k8s Community Давайте тут небольшую паузу сделаем Кто не успел настроить config Cub ctl можете пока его бросить И вот очень важно Вот в этот момент обязательно форкнуть этот репозиторий всё что мы не успели Дона рои мы Ещё успеем но если мы вот это пропустим то это будет критично My charts My charts именно My charts Давайте на предыдущий вернусь так нет не сюда именно My Chat на самом деле нам ещё понадобится кроме Cub cdl ещё понадобится helm Поэтому вот там в настройках он у нас выполнит некоторые команды а необходимые то есть м консольная утилита которая если у кого-то что-то не получается поднимайте руку вот после того как мы форкнуть что там у нас в этом репозитории находится и сравнить это с тем что у нас есть в кубернетес если вы наберёте вот такую команду то у вас будет вывод который Вот его немножко сонный вариант это ранее мы делали команду вывести все сервисы А это именно конкретный Да ещ в формате Y и вот здесь мы сравним что у нас находится внутри самого сервиса внутри декларации для сервиса или манифесте и что у нас находится обычно в шаблоне chs То есть это Y фактически это Ну скажем так почти Зеркальная картинка Просто если мы вот эти вместо этих двойных скобок подставим значение слева то у нас получится что наш чарт просто будет загружен необходимыми параметрами чарт который справа Мы обычно не меняем или меняем очень редко то есть достаточно вот для всех сервисов или для большинства сервисов иметь вот такой вот файл с этими э скобками И после этого мы туда Просто не мы Вернее а будет туда подставлять значение и мы можем использовать Это для одного второго третьего сервиса и так далее Ну вот к примеру как это происходит из из метки значение попадает в темплейт далее из нейма название сервиса попадает оно в другой темплейт сю с сй попадает также происходит с селектором также происходит с портами И после этого у нас собственно полностью заполненный сервис значениями Вот для этого используются шаблоны chats и вот здесь мы можем увидеть что у нас есть специальный файл в том репозитории которого вы сделали Fork Называется он values yaml и вот именно в нём находятся те значения Которые наиболее часто меняются мы можем их заменить на любые другие а темплейты не менять и у нас зарез другой сервис Вот теперь давайте склони данный репозиторий который находится в нашем аккаунте к себе локально заменим урней на Имя вашего github аккаунта Ну сделать Это довольно просто кто-то не успевает Говорите затем мы переходим непосредственно в каталог склони сервиса и переходим на branch develop что угу То есть вы меняете там место username ставите имя своего github аккаунта потому что вы Fork делали на имя своего аккаунта далее У нас внутри данного данных charts тоже нужно сделать некоторые изменения поскольку ваш чарт сейчас смотрит на k8s Community а нужно чтобы его исходные части смотрели на конкретный ваш github аккаунт Вот это значение username надо будет поменять не знаю вот видно сейчас Да что поменять на имя своего аккаунта также есть там файл называется prep который запускает у нас команды helm и чтобы он правильно отработал то же самое Нужно вставить э вместо username имя своего github аккаунта если не успеваете Говорите Я просто немножко при торможу а затем мы сохраним эти изменения в бранше develop кто-то кто-то не успел Так давайте вернёмся вот в этом файле при psh нужно поменять username и вот в этом файле charts ял нужно тоже поменять username на имя своего аккаунта если кому-то помощь нужна поднимайте руку я буду подходить Н по-моему вот там поднимали руку а держите пожалуйста подольше Да нене не не надо иначе мы очень долго будем проводить кому помощь нужна если у кого-то ещё не получается поднимайте руку я подойду сохраняем данные изменения для этого делаем не обязательна такая надпись это комментарии изменения именно на ваши персональные данные Второй файл который находится в головной головном каталоге там для того чтобы нам у нас правильно выполнился мы делаем изменения в на самом деле там k8s Community то есть вот где k8s Community там меняем на имя github аккаунта что первый chs Y он внутри Temp находится Так давайте я немножко тогда опять вернусь Вот первый файл ВН находится какая ссылка Да пока пока там ничего нет но ровно следующим нашим шагом будет там Создать нечто что будет отвечать я расскажу как это сделать если уже проверил что там находится А вот в этом месте где https username github а то на самом деле пока сейчас там ничего не отвечает Вот давайте двинемся дальше у кого опять же что-то не получается э поднимайте руку Теперь мы сделаем как это нужно делать как это положено делать сделаем релиз наших э чартов просто Переключи на бранч вернее создадим новый бранч Лиз с версией 006 предыдущая у нас была 005 вот у вас будет такое сообщение Все успели да то есть делать это просто и откроем опять же тот же самый фай и поставим соответствие версию 006 для рты они могут меняться то есть какие-то там шаблоны могут добавляться удаляться изменяться для того чтобы у нас была реакция на правильную версию и мы могли в любой момент вернуться на любую из них нужно создавать релиз с определённой версией обычно в прок так и делается Вот после того как поменяли версию нам будет запустить эту кома на самом деле запускает package архив собирает и делает индекс этого архива Пока нет мы закоммитить потому что вот эта команда нам создаст немножко файлов в каталоге с чарта которые нам нужно будет закоммитить эти файлы они необходимы для того чтобы вот вот эта ссылка заработала правильно бы там был расположен ваш чарт который которую система CD будет находить вернее м и будет релизинг добавляем все не работает Это значит вы не скачали hmm там было helm init и две чёрточки Client Only Ну если без Client Only ничего страшного сделайте после этого при psh у всех получилось что ус хорошо отстали дальше добавляем Все изменения которые нам создал Хм мы его на Билд машине запустили Игорь я возьму маленькую паузу если у кого-то не получается поставить Хм не переживайте пожалуйста без него у нас тоже всё заработает мы Хм запустим на Билд машине Поэтому в крайнем случае можно этот этап пропустить Ну да по порядку по возможности конфигурации дальше сохраняем все эти изменения с комментарием например новае версия и переключаем на мастер Какой файл не может найти отработал А у вас появился файл с архивом то вы сделали git Если вы копировали Да всё правильно Если вы копировали с экрана то вот здесь видите кавычки такие круглые символ это код другой Замените на кавычки обычные всё сработало Да отлично переключаем На Мастер и делаем ч нашего релиза в Мастер почему такое F это данный ключик он предназначен для того чтобы сохранять не делать а сохранять отдельными котами сам чтобы там нам нужно будет поставить г последствий вот сли И последнее действие которое мым обычно в стандартных скажем так прок системах когда мы делаем релиз в последствии ставим тег чтобы потом на этот тег можно будет либо откатиться либо использовать его для каких-то целей Но в данном случае для того чтобы конкретно именно этот релиз использовать для Но это совершенно необязательно чисто для справки Что Лиз бранч который у нас был смн в Мастер он должен отразиться и в бран develop Потому что если мы будем продолжать работу то мы обычно делаем бранч из новый бранч из develop он должен при этом быть актуальным и после этого сохраняем все изменения на github то есть делаем git Push с тегами со всеми и у нас примерно такой должен быть так немножко я проскочил вот такой примерно вывод у всех всё получилось се успевает Ну тоже не обязательно пу сделать де на github он нам не понадобится Это для консистентность в бран А вот теперь мы сделаем не то чтобы магию но некоторый лайфхак который нам позволит наш сервис предоставить для системы в виде ртов для этого мы займ репозитория My charts на своём github аккаунте раздел settings и выберем там github pages оно фактически почти в самом низу находится и вот там есть раздел sce вместо N выбираем Master branch не Master branch который Doc Fold есть ещё и такой вариант а именно Master branch и нажимаем Save кто-то не успевает если я подожду кому-нибудь если помощь нужна по-прежнему поднимайте пожалуйста руку и по возможности подольше держите Потому что я не всегда успеваю подойти к сожалению результатом работы должно получиться Вот такая штука То есть если мы перейдём по той ссылке По которой кто-то уже попробовал получил 404 то мы получим уже не 404 а helms CH repository это тот репозиторий который у нас будет читать helm и если мы там добавим ещё в конце инкс yaml то мы увидим сгенерированный индекс по которому у нас helm будет читать что же ему релиз То есть вы должны вот в итоге получить примерно такую картинку если у кого-то не получается поднимайте руку потому что процесс зависит от этого давайте сделаем здесь на пару минут паузу чтобы все проверили что всё заработало ещё у кого не получается у всех Получилось Да Игорь давай 2 минутки подождём Я сейчас подойду тоже там всё всё всё там где у вас hel chats набираем просто индекс ял чтобы проверить Index всё кому ещё помочь поднимайте пожалуйста руку всех немножко подождём так mys индекс Давайте сначала мой чат Угу угу нету Давайте вернёмся на UB ваш аккаунта полностью Нет не будет у вас просто не активирован github pages github.com Имя вашего Да аккаунта mpp выбираем mychart Угу settings ниже ниже ниже Угу выбираем масте Угу Save теперь набирайте ту ссылку нажимайте теперь индекс Добавьте пожалуйста так если нет поднятых рук значит у всех Всё наверное Получилось Да А ещё ещё Давайте кому ещё помочь Кто думает что он безнадёжно отстал сейчас поможем не долетел давайте сделаем пуш так Давайте посмотрим на каком этапе мы остановились таква А Вы на самом деле все изменения можете сделать даже в Мастере и сделать Т Push Origin Master нет в так не страшно не страшно то есть у вас работает Вот это да делайте при psh угу он изменён всё выполняйте А заметил у вас кому помочь если бы вы запушить у вас бы отобразилась вот эта картинка даже больше ничего делать нужно в Мастер чтобы вот это попало и отобразилась вот эта картинка Продолжи так следующий у нас этап подготовка сервиса для релизов CCD Да хороший вопрос значит давайте я может быть вкратце сказал я сейчас более развёрнуто Обоснуй что это такое Это шаблоны для того чтобы у нас мм - это менеджер релизов чтобы у нас он их считал Вот по этому адресу который там Да да да но на самом деле когда в системе CD он обращается Именно по этому адресу и читает у нас манифесты для ртис то есть Нам нужно кубернетес сказать каким образом зарезать сервис какой у него будет деплоймент какой у него будет там Игрес или ещё что-то куча шаблонов и вот эта куча шаблонов для того чтобы у нас система автоматически где-то считала нам их нужно предоставить в виде Ну например сайта выложить Да после этого у нас система считает Вот эти шаблоны наполнит их значениями и залит наш сервис рне А удалённо вот по ссылке хму нужно найти где лежат ваши чарты где-то где-то допустим во внутренней вашей системе например для этого мы делаем чарт сервер Вот который вы видели Нет конечно Нет да это Это для мастер-класса где-то должна быть ссылка где-то внутри у вас там в системе или ещё где-то Да Да Даже не всему интернету на самом де не интернет но в интранет скажем внутренней вашей системе он должен быть просто доступен и вот сечас у нас э картинка то есть Каким образом у нас CD будет делать посылать команды для деплой то есть для Это для этого мы берём какой-то тоже уже готовый сервис вот до этого вы в первой части делали значит варианты сервиса который годился бы для выполнения вреде просто возьмём готовый и склони сделаем тоже в него минимальные изменения и попытаемся его зарезать вот с помощью тех charts если кто-то не успевает говорите то есть мы клонируем сервис переходим на бранч develop и будем делать изменения сейчас нам нужно сделать изменение внутри файла myp Go там стоит k8s Community вам нужно поменять на username на свой github аккаунт Не на usame а на github аккаунт который у вас был это мы делаем для того чтобы у нас сервис Правильно выполнялся Потому что он должен брать импортировать по правильному пути в клоне у нас путь другой А в вашем github аккаунте он будет другой поэтому должно быть github.com Имя вашего аккаунта mpp version и меняем userspace тоже самое на на ваш github аккаунт сейчас вернёмся назад то есть совсем небольшие изменения делаем Это Make F верхняя часть у него изменяемая зачастую А вот то что дальше там идёт это менять не приходится потому что всё работает по подстановка переменных Вот и третий файл в котором теже самые надо внести изменения это тоже на имя своего github аккаунта и для того чтобы всё проверить что у нас всё правильно просто делаем внутри в каталоге Где у нас находится наш сервис клонированный Make Test у нас результатом работы должно быть что все все тесты пройдены и на каждом пройденном тесте О'кей Дада это наверное интернет наверное интернет немножко да давайте если что прервётся на самом деле вы не дождались чуть-чуть совсем а вы уже всё сделали хорошо у кого ещё нет не работает интернет нет доступа поднимите руку всё всё зависимо Да у нас похоже опять отваливается интернет поэтому пока придётся паузу сделать Ну да Попробуйте выключить включить Угу Судя потому что ищет долго Дат не очень как Угу Так Go сделайте goget Сейчас минуточку линтер сможешь сй линтер а так кому кому кому помочь Угу рин А знаете Давайте зайдём в M фай Да просто у нас там есть одна зависимость которую мы не учли это linter а linter Go lint он не входит в стандартную библиотеку Go его надо будет скачать с гитхаба с помощью команды Давайте немножко по-другому Мы отредактируй наш M файл и удалим из команды Make Test lint если у вас не проходят тесты то есть два варианта либо поправить код либо зать закоментить тесты Вот мы сейчас грубо говоря закоментить всего лишь Линт уберём он нужен для того чтобы проверить значит насколько у вас код соответствует всем правилам которые нужны в Go то есть для этого да то есть ничего страшного от этого не произойдёт поэтому Стандарт он он не стандартный в том-то и проблема что он не входит в стандартный пакет да и это лежит в Open Source сама процедура лендинга стандартная да да на самом деле мы здесь предлагаем использовать отдельно использовать отдельно lint есть ещё одна хорошая библиотека называется goter она в себя включает вообще всё вот можно на досуге её посмотреть вместо этого например Поэтому чтобы не качать нте Мы можем сейчас зайти вфа и вот там где Make просто удалить в строчке lint оставить формат fmt vet удалить lint И тогда у вас всё пройдёт вот если всё получилось то сохраним изменения не Нет нет не обязательно где Make Test кому помочь вот здесь Линта просто убирайте вот тут Просто у нас время немножко ограничено Поэтому чтобы долго вот с этим не возиться с линде просто в файле его убираем и делаем тест и сохраняем изменения коммитом далее нам нужно создать бранч Лиз 0 1 если кто-то не успевает Я подожду подождём Угу Да вернёмся немножко назад У кого не выполнился тест выполнился вот у кого не выполнился тест что не получается Угу давайте зайдём вфа Угу ниже ниже ниже ещё ниже Make Test к тест вот здесь убираем Линт на гулин Да сейчас вот Должно всё пройти другая ошибка так угу н Где у вас находится сейчас pvd набить github My App Да всё верно листник сделайте Като Угу ver есть всё это есть Давайте зайдём в файл glide угу вот здесь не тама А ваш github аккаунт а извиняюсь Верните назад Это я уже ПП давайте выйдем отсюда Так где у нас там сейчас вспомню в May PPG Угу Да do Go вот здесь вот поправили мопи Всё верно Давайте выходим Давайте ещё раз запустим мой тест 112 кого се вы скате а вы добавили поправили ещё раз зайдём на IP Угу как это так есть Почему на Почему такой ть кому помочь ещё не в том файле далин Угу тест А тут тоже да Угу вместо кос Коти ваш А ну вот видите Угу глайд яма Верхняя Угу Угу апдейт Это что ещё Игорь у меня есть предложение двигаться дальше Потому что время у нас идёт к сожалению Давайте тогда у кого что-то не получается мы да я подойду и если что ничего страшного потому что мы всё можем после мастер-класса продолжить Но вот нам нужно как-то уложиться в оставшиеся 25 Если что мы можем потом перейти в другую аудиторию где мы поместимся или где-то в холе разместиться и может быть даже интернет там будет лучше и продолжить ничего страшного Значит вам нужно сохранить ваши изменения которые Э вы сделали и тест вот у кого прошёл тест можете сделать git comit И после этого вам нужно создать бранч на который у нас будет реагировать наша система CD Называется он именно так не как иначе а именно релиз и версия релиза то есть новый бранч релиз с01 вот после этого мы переходим на этот бранч и всего лишь меняем версию в том же самом файле делаем версию ставим вместо 0101 и делаем комит Ну на самом деле название комментарий там принципиально важен такой но мы просто здесь отражаем что Мы отмечаем всего лишь версию так это я назад вернулся сейчас А после того как мы всё это сделали А сделаем тег Но на самом деле сейчас система CD Реагирует даже если у вас тега нет но тем не менее он нужен для того чтобы в реальной жизни в реальной жизни это всё работало корректно опять же если кто-то не успевает поднимайте руку всё на этом этапе мы просто дальше активируем CD я сейчас скажу как раз про это э то есть мы с вами дошли Вот как раз до того что у нас собраны все компоненты и сейчас вот мы с помощью Пуша активируем весь процесс который у нас запустит CCD то есть делаем git Push с ключиком texe 011 и вот после этого наша система должна заработать то есть у нас должен сервис на гитхабе у нас должен сработать Event После этого у нас система CD подхватывает этот к и начинает запускать команды которые мы смотрели в Make файле для того чтобы залить этот сервис курне Да мы делали интеграцию в которой присутствует цию заходили на k8s Community и нажимали там на пиктограмм github Да поставили приложение это приложение оно умеет слушать события git И вот именно оно ловит хуки всевозможные именно оно придумывает на Какие события реагировать на самом деле это у нас такой CCD написанный на коленке состоящий из двух частей он умеет Не всё но мы его написали специально для мастер-класса чтобы минимальный вот этот путь продемонстрировать а Вы уже сделали пуш Да смотрите Вы можете после того как сделали вот этот пуш Вы можете зайти на Сен вернее зайти на внутри github зайти там на коммиты и посмотреть у вас должна галочка такая зенека о есть команда Cu cstl gets только добавите ключик N и Имя вашего аккаунта это будет mspace и вы увидите да где ваши тоже самое Cu ctl в спейсе Конечно getl можно сделать То есть L просто кидат Короче мы можем это посмотреть но мы пока решили всем не давать возможность Поэтому после после мастер-класса посмотрим это вот как раз то самое место где мы очень быстро написали CCD и поэтому не всё пробросить что в настоящей CD системе должно быть хорошо У кого не получилось что-то глобально прям с самого начала не получалось мы никого и потом продолжим ещё где-нибудь расскажем персонально каждому можем подойти и всё рассказать вот после того как вы сделали пуш Вы можете зайти на github в раздел comit то есть форк вашего репозитория в раздел commits и посмотреть у вас должна появиться Вот такая зелёненькая галочка она означает что ваш сервис прошёл все этапы и залился то есть Зелёная галочка означает что Make File Отработал и система CCD тоже отработала и всё это корректно про альтернативные варианты там может быть красный крестик Это значит что сборка упала или точка Это значит что ваша задача выстроилась в очередь но ждёт других сборок К сожалению мы не очень много информации выводим но в принципе это уже на самом деле завершающий этап если у вас что-то здесь пошло не так давайте опять оставим это на после шоу и всё вместе добьём до конца у вас на самом деле вот проверка работоспособности это вот эта вся часть у вас должен быть Вот примерно такой вывод если заели Да ну будем будем смотреть у вас должен быть Вот такой вот вывод по https Services MS кони Имя вашего аккаунта mpp появляется вот ваш сервис с такой-то версие но у вас может быть версия 011 А друзья у нас хорошие новости У нас есть ещё один час потому что эта аудитория будет свободна ещё в течение ближайшего часа давайте мы наверное до конца дойдём сейчас по слайдам которые есть у Игоря И после этого кто на каком этапе остался а и кому нужна какая-то помощь мы сможем прямо подробно сесть и с каждым всё дойти до конца подписать сертификаты тем кто всё прошёл вручить какие-нибудь там сюрпризы и всё такое Сюрпризов у нас на самом деле много поэтому кто дойдёт до конца обязательно будет какой-нибудь сюрприз что у вас просто крестик Да а вейтинг на самом деле смотрите сейчас мы Подождите если for если там точечка то Подождите если упа позже разберёмся посмотрим логи поймём Почему там что сейчас мы на самом деле пытаемся Что сделать пытаемся заддосить нашу Билд машину все запускают одновременно Make deploy она четырёхпроводной не там заддосить её наверное тяжело будет но тем не менее процессы стоят в очереди и CCD сейчас пытается одновременно например зарезать несколько таких приложений а он обрабатывает насколько я знаю по 10 Поэтому просто Да просто ожидание Игорь давай идти дальше Давай да и вернёмся ко всем красным крестиком и доделаем эту часть то есть Вот здесь понятно да в Коми можно посмотреть когда у вас всё получится и соответственно это означает что мы прошли Вот эту вот нижнюю часть То есть у нас тесты деплоймент имидж попал в Reg сделался там у нас создались вот на самом деле здесь пода а там у нас пода и наш сервис должен заработать и вы должны получить в итоге вот так минуточку немножко перескочил Вы должны получить Вот такой результат то есть ваш сервис должен заработать и как проверить то что он там находится внутри Бернес это набрать кото совпадает с вашим username в github и вы должны получить Вот именно такую картинку это ваш сервис в вашем персональном не спейсе когда Если кто-то захочет потом сделать всё это на своём Google допустим compute Engine там всё есть для того чтобы всё это организовать там есть PlayBook который ставит вам полностью тис именно с теми настройками с тем CD который у нас для простоты написан нами для этого мастер-класса и вы можете на своём Google аккаунте на своём тис выполнить все те же самые действия мало того Вы можете этот сервис который Вы самый простой туда выкатили в кубернетес каким-то образом развивать добавлять что-то туда экспериментировать и смотреть как всё это происходит в своём Google скажем в своём рне именно в построенном Google аккаунте Вы можете себе права естественно дать любые там админские и делать с этими компонентами всё что угодно то есть не только их просматривать но смотреть логи смотреть удалять допустим какие-то деплоймент создавать новые деплоймент и смотреть вообще что происходит в кубернетес Когда вы релиз этот сервис поскольку у нас всё в открытом источнике То есть вы можете все программы все C CD которые сервисы Вы можете их посмотреть как они работают там код достаточно простой и тут наверное будет понимание Вообще полностью процесса как это может происходить в упрощённом варианте Как происходят релизы кубернетес Тут ещё несколько команд Ну для тех у кого всё получилось или Потом получится слайды у нас будут в формате pdf мы их все выложим поэтому по ним можно всё это будет повторить по смотреть вот всё тоже самое что мы делали ранее с подами с деплоймент всё то же самое для вашего сервиса оно будет отображаться и вот последний компонент о котором хотелось бы сказать это Игрес это то что предоставляет наш сервис наружу в интернет То есть мы смотрим с помощью вот ну это скажем директива к ней вернёмся чуть-чуть попозже мы смотрим через хост сервис k8s Community через путь в котором Вот вместо рне ваш github аут mpp смотрим на ваш Сервис через восьмидесятый порт и вот в итоге что мы узнали в течение этого мастер-класса Игорь сейчас я тебя на минуточку рву у нас там есть некоторое количество пиццы Я сейчас за ней сбегаю не расходитесь а вы пока завершаете из немногих Сюрпризов Сюрпризов ещ много поэтому оставайтесь они в ожидании когда последовательно каж каждый сервис зарез в кубернетес если красный крестик значит чего-то не прошло уже Надо посмотреть в ЧМ проблема то есть у на можно кубернетес а под каждым подом под каждым аккаунтом и посмотреть через логи или другие средства что получилось Нет это не вы зайдёте поскольку мы не можем предоставить всем доступ Угу а теперь красный Угу А давайте узнаем у кого получилась у кого получилась Зелёная галочка по таймауту отвали по таймауту да А зачем зачем нуже зачем нужен м смотрите да давайте я объясню если бы у нас не было хелма что бы мы делали мы бы просто в P сложили все манифесты и их руками бы правили в каждой сервисе В каждый сервис бы копировали все эти манифесты то есть создаём сервис называем его как-нибудь Ну например копируем туда и начинаем вот эту работу которая могла бы быть автоматизирована в каждом месте изменять параметры делать менять версии менять название сервиса и редактировать вот эти все ялы поскольку это работа ручная и Она фактически повторяе мая есть резон это не делать есть резон просто менять те значения которые ну скажем только персональ для этого одинаковые у разных сервисов Они похожи друг на друга если разные то они всё равно могут быть одинаковые вот Представьте себе что у вас в компании система которая скажем отличается деплоймент у Вас например три экземпляра разных один из деплой использует 10 сервисов другой из деплоймент ещ 10 сервисов и третий ещ 10 вы не будете менять все 30 сервисов в каждом деплоймент Для этого вам нужно всего лишь три шаблона и они там же лежат в charts просто шаблон для одних сервисов будет один деплоймент для других второй и для третьих третий всего три не 30 Поэтому вот эта система Она очень хорошо помогает с тем чтобы не постоянно не делать изменения в каждом манифесте использовать просто шаблоны и наполнять их значениями Ну в этой системе которая автоматизирована всё равно придётся выполнять эти вещи то есть смотрите чтобы персонализировать в манифестах ваш сервис который лится всё равно нужно чтобы в манифестах проставлены были правильные знания Роме того что онмед он конфигуратор То есть он конфигурируется в ртис и у вас сервис лится другая какая-нибудь система Ну либо самописная может быть тоже может выполнять такой же функционал Но кто-то вот есть резон у кого-то кто-то использует самону систему кто-то обт нам кто-то сах в данное высоты мы используем просто Хм который уже есть на текущий момент без каких-то обёрток без каких-то изменений есть внеш Поня и у меня например кая ло Угу У ме есть такая желез которая вам имеет делает на Я хочу смотри проблема Это в принципе не такая чтобы большая проблема но в стандартных документация она не очень хорошо освещена Или вообще не освещена вариантов на самом деле масса один из вариантов это специфическим образом настроить оверлей ную сеть которая внутри куртис это может быть фланель и плюс Калика Калика - этова ещ использует bgp то есть bgp предоставляет возможность направить трафик я вот вал почему то есть она каке провайдера её нужно отдельно делать отдельно отде не хочется чтото по есть есть варианты всевозможных ингрессо То есть Игрес он не один один на базе eng кто-то вот если я память не изменяет есть Apps github и есть voer voer - это тот же и только на базе соответственно он умеет не только запрокидывать он умеет tcp запросы прокиды так бы вам в нсе пришлось бы приобретать например НС п+ чтобы tcp трафиком рулить А здесь в Proxy всё это делается тоже в открытом открытый Исходный код дадада Извините Можно громче чуть-чуть громче говорите настоящий очник кого если вам нужно именно в но там же есть тоже он как tcp обрабатывает так и п трафик на самом деле вариантов очень много настраивается ном конно Рив именно Ире и его скажем так аналогов очень много их даже вот сейчас не перечислить потому что система очень быстро развивается в том числе и который используется в Google comp Engine это именно тот Игрес который активирует стандартный балансер в Google comp и дёргает не уже Тамга истан пра и для Ра Знаете нет Почему ответ есть мы перед этим ставим самые обычный которые смотрит Нава Так давайте я вопросы буду с микрофоном подходить чтобы было всем слышно Это первый момент а второй момент давайте сейчас сделаем паузу отдохнём поедим пиццу потому что она и так уже остыла и совсем остынет и потом все вопросы кто всё сделал тем мы дадим сертификаты кто не сделал с тем мы поможем доделать для тех кто сюда сейчас приходит мы на всякий случай скажем что у нас ещё час будет мастер-класс по го кубернетес и мы уже в принципе сам мастер-класс закончили сейчас будем только вопросы обсуждать Поэтому если вы ждёте доклад который тут должен быть по расписанию то Наверное зря ня во я скажу честно не знаю но вот у меня такая информация пришла из космоса"
}