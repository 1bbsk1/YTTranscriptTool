{
  "video_id": "PzEMpGOz7eg",
  "channel": "HighLoadChannel",
  "title": "Как мы делали ядро инвестиционного бизнеса / Владимир Дрынкин (Альфа-Банк)",
  "views": 935,
  "duration": 2711,
  "published": "2020-04-27T12:20:43-07:00",
  "text": "коллеги всем добрый день и спасибо больше шли вот владимир drinkin' я раб это в альфа банке и всего скажу вам о том как мы делали ядро нефтяного бизнеса альфа банка на базе субботы тарантул для начала я скажу пару слов о себе я уже три года работы в альфа-банке за три года моей работы успел поучаствовать 6 проектах и на текущий момент я являюсь тех ли дом команды развития трансакционного ядра также я скажу пару слов о компании в которой работаю альфа-банк это крупнейший частный банк в россии он входит в топ-10 банков по размеру своих активов у банка всего в совокупности более 14 миллионов клиентов и альфа-банк является универсальным банком что я имею ввиду когда горе универсальный я имею то что альфа банк осуществляет на этот все или может быть практически все виды банковских операций какие только есть и одно из направлений бизнес альфа-банка это инвестиционная и дальше именно нем пойдет речь а что такое не сезонный бизнес внесенный бизнес это такой своего рода rapids банковском мире почему официальность да потому что у нас есть кредиты у нас есть займ у нас с депозита его нас есть по сути все то что есть в рознице еще сверху нас есть ценные бумаги валюта товары различные деривативы это фьючерсы и опционы слаб и и много много всего и также структурные продукты это недавно и недавно и появление на рынках это вот всякие сложно структурированные деривативы когда у вас в одной сделке очень много всего и очень много мест на условий исполнения сделки кроме продуктов мы оказываем также очень большое количество различных услуг это брокерские услуги для физических лиц это депозитарные услуги по хранению бумаг в депозит альфа-банка это доверительное управление капиталом состоятельных клиентов и это выпуска ценных бумаг для компании которые хотят выйти на биржу немного цифр про инвестиционный бизнес за день работы рынков которым подключены мы получаем более 3000 котировок в секунду более 300 тысяч сделок заключаются на от нашего лица и лица наших клиентов на различных торговых площадках как внутри так и снаружи и это все мы загружаем себе до 5000 исполнение ордеров в секунду происходит на площадках как внешних так внутренних площадках банка и для всех клиентов и как для внутренних клиентов наших трейдеров так и для внешних мы перечитываем позиции в режиме реального времени а собственно в чем наша проблема да я почему вообще начали что-то делать мы наблюдаем устойчив рост числа клиентов и их потребностей да почему это вообще почему то происходит появляются не так давно где-то несколько лет назад появились так называемые индивидуальные сезонные счета это счета который можно скрывать физлицам они могут торговать на финансовых рынках и не платить при этом налог с полученной прибыли также неуклонно растет финансовая грамотность населения все большая часть населения начинает увлекаться в торговле на рынках ценных бумаг различными продуктами границ между клиентами потихоньку стираются и клиенты они начинают торговать инструментами из различных направлений бизнеса и они все хотят управлять мульти продуктовым портфелем и как портфелем ценных бумаг так портфелем деривативов так портфелем валютном и конечно же все клиенты хотят видеть отчетность по всем своим продуктом который них есть и конечно в режиме реального времени кроме потребности клиентов у нас есть очень много потребности регуляторов и настолько много что вот я тут сейчас и даже все перечислять не буду это российской регулирование европейской регулирование различные нормативы контроля налогообложения и знаете что если вы будете открывать свой фен тех или свой банк госпожа набиуллина будет всегда пристально следить за вами за вашей деятельностью да значит в чем собственно проблема дальше исторически наши банки сложилось так что направление нашего на сцену бизнес они развивались друг к другу независимо было направление связано с биржевой торговли и брокерскими услугами направления торговли валютой и направление в ней биржевой торговли ценным бумагам и деривативами и эти направления не росли и развивались независимо на своего на своем с такие технологии к чему все это привело системы дублируют функции друг другая система являются по сути одними и теми же по своему значению то есть это фронтов офисной системы быковец не системы но их они в каждом бизнесе свои в каждое направление бизнеса свои они дублируют функции друг друга и мы не можем все это свести вот в в единое место чтобы учить cut & dino отчетность конечно же укажите системы свое модель данных хотя это все одни и те же данные то сделки котировки и прочее прочее все финансовые наши вещи каждый это функциональный к воде он развивался независимо своим на своем стеки своей команды разработчиков по этому нас на самом деле огромный собак технологий на текущий момент наша система не росли и где-то на этом сначала 2000 годов поэтому у нас на самом деле уже такая мощная броши и legacy кодом устаревающая кодовая база и связи с этим у нас случается порой случается медленный процесс разработки вот ну и конечно куда от этого деться это наверное есть у всех у всех есть проблемы с по заразительность и их legacy кода вот мы на это все взглянули что в общем-то решили делать мы решили что на самом деле для нашего бизнеса жизни необходимо трансформация технологическая если ее не сделает и мы просто перестанем поддерживать темп который мы набрали и не сможем предоставлять нашим клиентам те услуги эти продукты которые они хотят видеть и поэтому нам была поставлена задача собрать все данные бизнеса в одном быстром едином хранилище и при этом не просто собрать а собрать единой модели данных чтобы могли собрать эти данные и строить на этих данных единые клиентский сервис единую регулярную отчетность что могли оперировать одними и теми же сущностям на одном и том же языке обязательно должно быть versio нирване данных потому что сейчас у нас не во всех системах есть акционирования данных и это порой приносит свои проблемы в нашу деятельность поэтому сразу попросили vista не ранее данных и бизнес у нас его заказал и оно должно быть помимо прочего business hotel не просто какую-то новую там базу дано в который мы бы все свое собрали и там начали бы делать бизнес хотел именно получить платформу для решения каких-то бизнесов прикладных задач то есть это должно быть не просто чтобы д это должно быть а ночью можно делать приложение делать это быстро и делаете достаточно качественно кроме жевание нам конечно поставили условия вот и одним из условий первом условии это было то что решение наши должен быть уровень энтерпрайз что это значит это значит что на него должна быть поддержка обязательно и оно должно быть уже где-то опробована в каком-то крупном telekom или в крупном банке режим работы нашей системы должен быть мишин критику это накладывает серьезные ограничения по присутствию в различных дата-центрах мы должны быть развернуты одновременно в нескольких дата-центров чтобы выдерживать всякие падения сетевые и аварийное оборудование наша система должна уметь горизонтально масштабироваться потому что наши текущие системы они уметь его что вирус только вертикально и мы просто не сможем масштабироваться вертикально того момента когда поток клиентских запросов превысило наши возможности поэтому мы рассмотрели только горизонтальное масштабирование и ко всему проще мы сказали отдавать еще это будет дешево всего вот да ну в общем мы это все у нас внимательно записали отправились начал искать решение мы записали сформировали требования по нашей банковской процедуре мы пошли в закупке мы же большой enterprise мы пошли закупки сказали вот наши требования нам нужно примерно такая система дайте нам пожалуй список компаний которые признаны точки за не банка лидерами в этой области путь через список из 11 компаний встретились каждой компании рассказали каждая компания задача от 6 компании получили оценку решение который не готовлю на сделать мы в альфа банке носова в общем-то не верю никому поэтому обязательно усвоим прохождения конкурса нашего по закупкам это было прохождение нагрузочного тестирования поэтому сформировали небольшие но объективные тестовые задания по нагрузке три компании из шести которые были готовы сделать решение согласились сделать нам прототипы решение чтобы протестировать их нагрузочное за свою чего-то нет предложили нам сделать мы сказали он прекрасно вообще давайте попробуем потестируем мы их получили и протестировали под нагрузкой до я перейду заслуживает отдельного доклада то как мы это тестировали поэтому я перейду сразу к заключению и скажу что лучшую производительность показал в этих тестах прототип решения на базе таранд вот команда разработчиков mail.ru вот если вам будет интересно я после еще вам расскажу вот выхода что мы как мы тестировали чтобы лиза задания побежим дальше и мы начали реализацию нашего проекта следующей командой на сбор 4 разработчика от компании mail.ru три раза бочек с нашей страны 3 аналитика и стандартный такой и жарусски набор the solution архитектор продуктов и скрам мастер и дальше я вам расскажу как мы шаг за шагом строили нашу систему из кирпичиков она стоит какие решения мы принимали и почему вы их принимали в первую очередь да мы должны принимать объекты из наших систем мы посмотрели в общем нашему в основном общаются почти т.п. это либо сообщили защитить и либо это пересылка джейсона впишите поэтому собственно нашим выбором стал хиппи и мы сделали 2 степи адаптер который принимают различные форматы данных у нас порой спрашивают а вот что защитить пиво используйте встроенный странствующий типе или это там индекса прям какой то это встроенный странствующий теперь мы не используем модуль engine x-men используем up stream почему потому что две причины есть на самом деле большая часть людей используют таран плоский engine.exe вы яб стрим когда им нужно терменируйте с цель вот в нашем случае терменируйте сцене надо бы его потому что нас решение стоит внутри банка локальности банка но не торчит наружу вот на мне нужен тир минировать плюс вторая причина-это то что просто сделать это на трант у любого проще в tarantul есть хороший ищите серверы нам хватает его производительности поэтому в общем то вот с индексом у нас поэтому пока без него вот мы получили наш объект почти т.п. да и дальше как я сказал уже у нас единая модель данных нам нужно трансформировать эти объекты введены модель данных мы внутри себя когда выбирали язык для трансформирования объектов в эту единую модель эти долго спорили спорили как должно быть что-то декоративной должно быть что-то императивная декоративное заката хорошо декоративный язык удобный когда вам нужно просто переложить поля из одного значения одного поля объектов другое поле объекта но как только у вас появляется кейс и они обязательно появятся у нас не появились практически сразу когда вам нужно сделать какой-то чуть более сложную логику например там что-то обойти в цикле или какие-то условия или как-то чуть преобразовать значения toady квартирный язык на самом деле начинается боль и вот поэтому в общем там остались на оперативном языке вот в который стран туле достаточно хорошо подходит для этих целей в общем и мы начали использовать во вот и нам это нравиться использовать вот это что мы сделали мы назвали конверт конвейере трансакционный обработки конверт инструкцию на обработке у нас значит них загружается у а кот и не зря здесь нарисован некий зелёный прямоугольник утра называется sandbox сэндбокс это песочница это то что мы сделали для исполнения пользовательского wakodo что такое песочница это то место которое позволяет выполнять код и не переживать за то что так вот как-то порушит вам вашу систему то есть мы можем загружать принципе туда любой код и не переживать что что-то может пойти не так или что-то там заблокируется потому что в это песочницу мы пробрасывать только те безопасной функций которые мы можем отдать пользователь он и использования вот как как это работает в общем есть прекрасная функция волос string которая принимает просто стройках строчку вашего кода и возвращает указатель на функцию далее вы готовите себе окружение из тех функций которые считаете безопасными которые можно предоставить пользователю для использования и говорите что вот этой функции пожалуйста вот это окружение в котором он может запускаться и все вот вот она вот вся песочница да ну достаточно простая вещь но это позволили нам избежать больших проблем да вот мы получили объект но преобразовали дальше нужно таки варьировать а он совпадает с любой моделью это или нет мы только опять же внутри себя спорили что у нас будет за язык описания этой модели нашей целевой кто-то хотел свести кто-то хотел еще какие-то языки кто-то хотел свои языки и вообще на самом деле хотел счет простого потому что existe это хорошо есть немного где используется на existe для наших целей он слишком перри усложненный поддерживать всю семантикой cassidy нам казалось не имеет смысла поэтому мы выбрали abro abro достаточно простой язык вот с небольшим значит описанием он достаточно компактное и он описывает только вашу структуру данных и ничего кроме структуры данных и поэтому нам отлично подошел мы используем мавра вот мы загружаем модель мы сделали модель сразу эволюционируем и чтобы мы могли потихоньку шаг за шагом наращивать наши потребности и решать задачи при этом у нас и конвейере трансакционный обработки и модель поддерживает горячую замену то есть мы можем без остановки нашего приложения язык воя брата позволяет загружать новую модель загружать новый код наших pipeline of он мгновенно применяется и вот вы обновились как бы вас все хорошо всем и объект в лиге руль по целевой модели инвалидное теперь он сохранить сохранить у на надо отказываться чего вот поэтому мы сделали в общем то взяли wizard is использовали лишь арт с репликами вот размещается в низких дата-центров реплики то же в разных вот вещах позволяет им горизонтально масштабировать нашу платформу тем самым мы решаем сразу и вопрос о нахождении различных дата центрах и с горизонтальным масштабированием специфика нашей деятельности она такая даже и наш олега систему не такая специфика что на самом деле они шлют нам поток в основном данных это может быть поток котировок поток сделок и они не контролируют impress the canyon эти данные реплицируют они не контролируют доставку да и на самом деле все равно получили эти данные или нет но мы тем не менее даны это телят не должны поэтому вот так у нас появилось ремонтную очередь это то место хранения объектов для тех случаев когда что-то пошло не так когда может что-то пойти не так может например объект него лидировала по модели то есть на самом деле мы преобразовали что-то не то или как-то не так вот или что-то там в плане но стрельнул да и какой-то возник у исключение нам пришел тот странный объект и мы не знаю что с ним делать мы его к ним ремонт ночью чтобы потом оповестить администратора о том что администратор алярм алярм смотрите у нас есть какая-то проблема нужно это все его разрешить до сохранять это хорошо да ну вот мы там на сохраняем донат как доставать опять же мы долго спорили о том как мы будем доставать данные нам предлагали а давайте мы сделаем свой предмет на ориентированный язык запросов почему бы нет мы знаем наш предмет на область давайте его сделаем там свой язык где давайте нет потому что ну там сроки все сидела там и стандарты свой язык и такое же хорошо говорит что-нибудь еще давайте сиквел я почему сиквел ну дак везде сиквел давать ему тоже сиквел сделаем ну вот окинув не просто это будет сделать на определенном кластере полностью мальчик его поддержать тем более давайте вот просто возьмем посмотрим как вы используете ваших приложениях в текущих секунда как учел что вообще делаете ну начали смотреть и поняли что у нас достаточно стандартных архитектуру всех приложений носить frontend носить backend java в основном есть оракул вот ну его руки баркли сиквел обожал эту сразу же rm который вам исикава делает объект и мы говорим ну а зачем вам секрет что потом протекать в rn и доставать меня сразу сиквел на объекты давайте им он сразу будем отдавать объект да и сделаем язык внесем язык который позволит вам брать сразу те объекты которые вы хотите вот и поэтому нашим выбором стал граф quelle граф теперь позволяет доставать вам сразу объекты он позволяет вам доставать ровно только то что вы хотите спрашивайте поля какие вы хотите разработка фейсбука довольно динамично развиваются поэтому если вы еще не видели графики елисавета вам очень посмотреть очень удобная вещь плюс мы сразу с 1 телеграф кель с нашей моделью вот и когда мы загружаем модели мы генерируем для для графики или интроспекции вот и поэтому после загрузки моделям и сразу в нашем эпиграфе ель имеем сразу актуальной интроспекцией у всех все модели данных то есть api у нас получается самым документирован им вот не нужно отдельно ничего документировать смотреть вот просто надо брать и пользоваться да мы сразу поняли что у нас будут потребителей которые буду хотеть некие такие вычисляемые поля в объектах что это такое например нам вот идет поток котировок в котировках есть она биться на азс цена покупки цена продажи а потребителям нужно например не только эти две цены ощути на мид средняя цена котировки вот поэтому мы сделали функции это такие небольшие кусочки кода на о которые запускаются песочнице которые можно привязать полям объекта который служит для расчета каких-то там простых полей вычисляемых полей то есть когда нас клиент просит к список объектов эта функция применяется получает на вход объект применяется каждому объекту и вычислим и поле вставляет результаты и клиент даже не знают на самом деле что это поле хранитель она вычисляется то есть это для него там вскрыты за реализацией ну конечно мы же enterprise нас должно быть классифицирована любые все запросы поэтому сделали ты механизм аутентификации вот этот момент у нас это все не было кластером вот он уже пора на гавайи вы кластер поэтому у нас все так получилось фактически что у нас все наши компоненты не начали объединяться в некие роли вот что за роль и вот у нас есть роль например ti connect это вот слева крайне роль занимается обработкой входящих соединений она держит танки пылаев вот у нас есть ролей декор который занимается трансформация объектов то есть вот эти все конвейер обработки и функции все запускается там она развязана и у нас есть роли сторож этот роль только про хранения вот никакой циpкa нагрузки на эту роль нет в части и обработки трансформация объектов эту роль только хранит их это делает хорошо вот и мы это все разбили на эти роли да на ролике корм и и сзади по или выше роутеры на стороже выше раз торджи сзади поняли собственно ходе между декора мистер джимми с помощью высших дроу таком вот между кэти коннекта между входным контуром который держит соединения и эбби корм уходим с помощью над box connect да и теперь я кратко резюмирую то что так что рассказал значит мы получили синхронную записи трансакционного потока данных и ремонтную очередь оповещал куна для администратора мы сделали вакцинируем модель данных которые описываться языке apache вора сделали механизм запуску пользовательского кода песочница сделали горячие обновление данных и пользовательского кода и сделали конфигурирование кластер на базе ролик который позволяет там на самом деле выстраивать произвольной топологию кластера сделали репликации сортирование данных между центрами за имплементировать язык запросов на данном графике эль и что в итоге у нас это что на все это вот это все дает благодаря наличию ролей можно развернуть кластер любой топологии можно запустить один стран ту ноутбуке за дипой все три роли туда и начать пользоваться этим например что-то функционально тестировать можно даже что-то на груше тестировать вот а можно взять десяток серверов и развернуть класть в десятках серверов расправив роли по разным серверам зависимости от того какая у вас нагрузка и это очень удобна тем что это позволяет какие-то гипотезы иди и какие-то разработанные кусочки тестировать прям на ноутбуках разработчиков не нужно тепло и там огромный стенд для того чтобы разработчик смог что-нибудь у себя потестировать вот это очень удобно да ему очень рады что мы это сделали да роли 2 ролик который обработать занимается обработка входящих соединений и трансформации объектов не хранят состоянии поэтому можем их масштабировать пропорционально входящий нагрузки то есть если мы понимаем что мы начинаем где-то упираться в типе у то мы просто еще добавляем несколько этих ролей несколько сеансов с этими ролями и тем самым как меня и топологию кластера жим по разным менять и адаптироваться к разной нагрузки роли сторож и наоборот она как бы не циpкa bound она про память вот если мы видим что у нас начинают кончаться память вы просто добавляем и шарат новые стороны вот и это все масштабируется просто пропорционально загруженном объем данных да и граф кель позволяет вам организовать единую точку доступа к данным с предоставлением проспекте всей модели данных что в общем-то на самом деле очень удобно для всех ваших клиентов текущей наш production работает на достаточно там простых серверах у нас есть два сервера для ролей ti connect epicor это обычные и сервера hp сущность ядерными xy o нами для стара j мы используем два серверов которых просто больше памяти что у нас тестированием у нас только автоматическое тестирование почему потому что на своих предыдущих проектах мы достаточно много наелись того что у нас есть реальные проблемы с тестированием какие проблемы как мы это обычно делали всегда нам мы получаем поставку с неким новыми фичами тестируемые понимаю что не успеваем все протестировать все асуры протестировать регрессионной крестимся в уходе в продакшен обязательно что-то случается обязательно что-то случается расстраиваемся вот и следующим шагом нашей эволюции стало то что давайте писать автотесты давайте принесем конь фромборк там selenium cucumber вот это все занесем и будем писать автотесты уже существующей системы окей мы пишем пишем пишем пишем тесты система в это время пока мы пишем развивается мы понимаем что вот канал кажется шум только покрыли какой-то значимый куста функционала и тут же мы упираемся в то что система на самом деле же подросла и убежала вперед и вот мы играем в хиллиса черепаху мы пишем тест-систем убегает вперёд поэтому мы от этого стали решили все хватит давайте применять тест гривен диод лин мы пишем юнит-тесты навоз помощью from work тарантул tab напишем интеграционные тесты на поэтому с помощью грубого фреймворка пай тест и как я уже сказал пытаемся применяет из гривен 9 и как это выглядит да если мы хотим что-то новое мы сначала пишем этот тест а потом идем это реализовывать если мы находим какую-то ошибку мы сначала идем песчаный это тест и только потом идем это фиксить вот да это тяжело да и то по началу сложно да это будет саботировать со всеми участниками вот ну вот тут нужно переменить немножечко насилия немножечко терпения вот и на самом деле позитивный эффект заметен даже краткосрочной перспективе и по нашему женин до ответственным покрыта примерно там почти весь код и и у нас очень редко сейчас стреляет чтобы что-то там у нас на продакшене вылезло вот да мы любим все на грушин тестирую читаем что гуру финансирование она очень важно я еще расскажу как вот мы и тестировать нагружена наша система первый раз когда мы там уже начали готовиться к выходу production ну и взяли поставили на ноутбук разработчика обычно только ноутбук примерно как тот который стоит включили нагрузку по силе 4000 tps это прям вот в один из нас тарантула с тремя ролями мы подумали что 4000 ноутбуки там прекрасно вообще вот взяли поставили на станции нагрузки распределили по серверам включили нагрузку получили 3500 tps на самом деле в этот момент вот сказать что мы были такие грустные то ничего не сказать потому что мы не понимали вообще а почему так мы которые люди выросли мире java выросли мили в мире уроков для нас это была достаточно странным мы посмотрели утилизацию на серверах вот видим что сервер от на самом деле ничем не заняты вот то есть там утилизации вообще никакая вот мы звоним разработчики мы говорим ребят о чем в общем то проблема вот я не нам очередной раз напоминают то что не надо этого же говорили но мы это никак не могли осознать то что трант в однопоточный это ранд вы можете эффективно использует только одно ядро цпу и поэтому если вы хотите делать какое-то приложение даже в рамках одного сервера вы должны сразу думать о том чтобы он работу ни в одном из себя сразу на нескольких иначе вы не сможете эффективно утилизировать то что у вас есть на исправляемся заселяем просто тарантулами все сервера под самую крышечку включаем нагрузку и вот получаем там 14500 теперь вот здесь могут умерли в прошлый раз дальше продолжить повышать повышать и вот перейти как у нас времени отклика взлетели там наверх мы успели зафиксировать как раз 14500 tps да и так как вот у нас мы на все поделили на роли дате роли которые занимались обработка не утилизировали циpкa и почти не утилизировали память тироле которые занимались хранением данных они наоборот они вполне утилизировали почти и память них росла пропорционально объему загруженных данных да вот на этом остановились от рефлексировали и подумали что же мы будем делать дальше вот посмотрели то что мы сделали нам это принципе понравилось и мы начали строить дальнейшие планы идти просто по этим планом и потихонечку все это реализовывать да вернемся к тому что у нас уже была да мы спорили о том что надо пара божий и платформу делать не только вот мы сделали там сохранял q отдавал куда на ту же платформу развивать вот поэтому мы сделали функционал для тепло и сервису библиотек чем сервис отличается от функции отличается тем что сервис на самом деле довольно сложная вещь в отличие от функции функция то просто яблочный вещь которая там одну строчку да и какой-то вычислимое поле сервису он содержит себе какой сложной бизнес-логику и может пользоваться всеми этими данными которые лежат у нас нашем хранилище и по сути является таким как отдельным стендом приложение просто развернуто на этой платформе до библиотеки это вот просто то что объединяет себе какие-то перес пользование кусочки сервисов потому что если до этого мы писали функции понимали что функция маленькая и там переиспользовать между функций особо ничего не надо то сервисы достаточно вещи большие в них обязательно появятся те куски нос на сразу не начали появляться которые хотелось бы перес пользовать мы сделали библиотека библиотеки очень легко встроились то что нас уже было мы просто библиотеки точно также как наши безопасные функции добавляли к окружению код из наших библиотеки вот и с помощью с этого финнов добавляли вот песочницы и безопасной функции функции из этой библиотеки да нам нужно делать и наличку в частности расчет позиции для клиентов для трейдеров поэтому мы видим что у нас есть реплики стражей в принципе ничем не заняты вот и хорошо бы на них сделать что-то типа mapreduce чтобы считать какую-то аналитику по данному несложную которое позволяет проявиться наши шарды содержат семьи пересекающийся набор данных это все можно в опу хорошо отказ пролить да мы сделали возможности по и функции map функции редис нас тораджи на реплики сторожей и функции ready устное бикор да и как это работает каждый сторож он по-своему набора данных в цикле прокручивает объекты которые удовлетворят нам некому фильтру считает состояние и выполняет reviews получай на вход состоянии которым посчитал до этого и состояние которое у него было изначально и похожая вещь происходит в конце на декорах это мы обходим все стороны с каждого стороже забираем состояние и состояние начинаем review системы станем к туру нас было изначально так как у нас есть много legacy не всем опытным ходить пищи типе некоторые просто говорит присылайте нам пожалуйста вот то что у вас есть еще и не мучиться спор с вашими целями и всем что у вас там поэтому мы сделали компонент для репликации да как он работает объект сохраняется кризис триггер объект попадает в очередь обработки забирается на отдельную роль в этой отдельный роли нас также есть песочницей по обработке потому что нужно обычный трат объект как-то привести к той модели которые уже этой системе вот и также мы можем отправить это поищите формате xml джейсон да у нас есть также кучи систем которые хотели бы писать нам синхронно в обход ремонтной очереди получая на клиент ответ потом записались данные или нет до этого мы сделали графики или мутации это было логичным шагом развития нашего компонента граф цель это то что позволяет записывать синхронно то есть объект сразу проходит напрямую к аллигатору который пытается нам систему записать он там были дерутся если что-то пошло не так он там не соответствует целевой модели возвращается и ошибка на клиента при то вас в поле не заполненно запомните пожалуйста вот тем самым мы сделали там такую свару синхронную запись в отличие от наше предыдущее синхронный до также мы поняли что не все мы можем считать нашим определю сам которые мы сделали потому что у нас есть задач которые нужно записать периодически в конце дня там например в конце недели а ещё у нас есть задачи которые и могут блокировать поток исполнения до что это задача например это какой-нибудь расчет стоимости опциона методом монте-карло вот и мы не хотели бы чтобы нам какую-то роль до в частности например 100 раджи где можно было бы посчитать что-то блокировал потому что если это блокируется то это всем это ничего не можем описать поэтому вынесли задачи в отдельные роли мы сделали планировщик мы сделали исполнитель задач задача сохраняется отъезжает на наступает момент когда нужно запустить за этим следите дублер schedule a pas посылает сигнал ранжиру и рано начинает вспомнить сдачу который у нас для этого была предварительно сохранена почти сразу мы поняли что эти задачи и хорошо бы их развить но что-то большее потому что запускать по расписанию этого кей но бывает вот клиент приходит а вот мне нужно прямо сейчас отчет какой-нибудь этот счет по страниц facet занимает там некое долгое время там по сравнению с тем чтобы считать этого ну а не то есть например отчет строится на самом деле иска минут и поэтому мы сделали задачей это мы можем формировать задачу которая отправится на runners быть исполнено раннере из наших конвейеров обработки то есть приходит запрос в сервис мы все вещи говорим вот у нас новая задача пожалуйста иди обработай ся как только будет готова верни ответ из все это синхронно вот клиент просто потом приходит и говорит а вот поэтому дети которые у меня уже готово мои данные нет еще не готовы приходи через пару минут готово теперь готовы да готовы все забирай пожалуйста бери пользуйся да вот не все всегда сходится с вашими планами когда вы это пытаетесь делать порой не нужно хранить все версии как мы изначально думали все версии этих объектов да почему потому что например у вас есть поток котировок порток поток сырых котировок довольно большой поток и выяснил что никому не нужные в том сыром виде в котором они есть да и не нужно хранить годами эти котировки поэтому мы сделали механизм устаревания данных и the expiration где тоже тарантул ский модуль мы его аккуратно за имплементировать и к нам вот который просто умеет ходить и по определенным критериям вычищать устаревшие данные которые мы говорим что вот эта у нас на самом деле уже устаревшая да ну и тем не менее все равно память нерезиновой до мы у нас планах там за имплементировать там детского историй чтобы могли вытеснять какие-то холодный данные из памяти на диск до проселку эту осталось ещё много времени мне тут уже показывает которую раз табличку в итоге у нас получилось сделать мутации планировщик исполнитель процессов репликации во внешней системы платформу нас все-таки пущего сделали создание сервисов распределенные вычисления для какой-то простой аналитики который позволяет параллели с по данным механизм устаревание очистки данных и архивирование на самом деле хера не еще не получилось как бы это еще вот задача там ближайшего будущего но вот мы планируем либо на виниле либо может быть даже не на виниле посмотрим до заключения немного задачи которые мы решили до загрузка давно в единый модель это то что я говорил мы по примерного потратили три месяца на разработку этой модели единой у нас бывший систем поставщиков данных и в итоге у нас получилось около тридцати тысяч строк кода нового для очистки 30 формации этих данных единой модели и на самом деле большая часть работающих впереди потому что дачу очень сложная мы думали что на самом деле будет простая потому что мы вроде знаем все наши системы сейчас мы соберем все данные посмотрим на модели с компонуемы что-то получится мы это занесем скажем ну вот как вот мы так сделали показали бизнес и варим вот смотрите модель не говорит и не то что-то как-то вообще не модели что-то совсем не то вы сделали да мы пошли нам в другое направление бизнес green смотрите а вот мы вот собрать нашу систему данные сгруппировали этот модель крупнее вообще не модели вот ну в общем мы поняли что придется это решать кейс б кейс вот решать задачи задачами и вот так вот взять и сразу все собрать не получится лучше тейкер отивно дамы это был пример большой задачи вот задача которой маленький мы уже успели решить это вот например формирование предложения подмена валюта для клиентов банка для корпоративных клиентов да это сервис это сервис который пользуется данными нашей системы да это всего-то мог водную тысяч строк 1 и 3 недели разработки до перейдем к выводам как я уже сказал проектирование дины модели данных это не просто если перед вами стоит такая задача вот сделать прям вот окончании ваших проектов все сразу одно единое целое то время которое вы оцените вы все равно можете на 3 и from ему не хватит на самом деле поэтому да поэтому имейте это ввиду да и важно достаточно point это то что имеешь проблемы в бизнес-процессах и данных на самом деле невозможно решить помощью новых и б.д. пусть даже очень производительной почему этот вывод почему-то тезис попал выводы потому что по нашей не аккуратности у бизнеса нашего сажусь поначалу впечатление что вы сейчас мы новую базу мы притащим такой быстрой всю модную современную и заживем вот на самом деле нет на самом деле заживем но не сразу потому что нужно не просто перестраивать хранилище до или перестраивать систем нужно еще перестраивать процессы как правило потому что эти процессы идут часто не оптимальны часто есть какое-то дублирование функций и ролей вот и без перестройки процесса просто так взять и делать его красиво не получится так как я уже сказал разработка через тестирование может приносить боль на начальных этапах и все будут пытаться от этого отказаться или как тасс увильнуть или сползти вот но нужно применить немножко насилия немножко терпения и тогда положительный эффект будет заметен даже в самые краткосрочной перспективе не говоря уже о том что будет на горизонте там году или нескольких лет вот до крайне важно проводить нагрузочное тестирование мы считаем на всех этапах разработки потому что она поможет выявить вам какие-то просчеты небольшие в архитектуре вот которые могут впоследствии обрасти кодом и их будет трудно переделать языке программе программирование в нет ничего страшного вот потому что когда мы принесли вона сказали чуть-чуть такое чувство что за язык-то вообще ну да мы знаем java знаем все шаров что такое на самом деле нет ничего страшного вот смело можете приносить на нем учиться писать даже бизнес-аналитики даже дам продукт оунер и принципе язык простой изучение требует много времени и почему бы нет да вот сиквел это тот язык которому все привыкли да и отсутствие его вашей системе когда вы приходите рассказать людям о вашей системе вызывает на самом деле людей просто уже они не понимают вообще зачем вы сделали базу данных который не цыкнул на самом деле как бы мне всегда нужен вам нужно посмотреть на ваши кисти использовании система которую тебе несете да и возможно он это какой-то пережиток просто прошлого и возможно вам нужно что-то другое поэтому нужно детально анализировать то зачем вам нужен именно язык запросов данных какой именно вам нужен да и при использовании тарантул проектируйте свое решение так сразу придержите решение так чтобы могло работать параллельно в десятках инстансов тарантул иначе вы не сможете ефесину сверлить утилизирует всю вашу банду некоторую вас есть спасибо спасибо большое за доклад уважаемые слушатели задавайте вопросы пожалуйста спасибо за доклад вопросов много скажите когда прекратить их самый первый как происходит оптимизация запросов на граф quelle а то есть возможно у джиннов и так далее то чего в графу или понятно дел вообще нет особенно распределенный регионов особенно всякого такой радости смотрите ну join у нас есть они не то чтобы распределенные наверное стоит по этому поводу отдельного с вами поговорить по поводу того как это все происходит быстро передать не получится вот ну это эти же и найдет проще чем в сквере jojen и вот это не это не это не все возможные join и которые можно придумать и join и они эти связи которые можно прокинуть они описываются нас на самом деле на уровне модели из какого поле в какой можно сходить и как какому полю при joy нить объект и как будет выглядеть ваш граф который вы получаете в итоге рисков как получается сильно беднее чем ускорили вас возможным запросам да то есть но это не будет полноценный такой язык для аналитики и второй такой на сайт большой вопрос по поводу а а какие то мысли ментальные средства разработки на атомы т.е. методы подсчета покрытия тестами и вот это вот все хороший хороший большой вопрос смотрите ну инструментарий богатый но под плюс плюс 7 его god why ваш любимый вид и макс средства вот на самом деле пор многие пользуются intel и j с плагином его профилирование через там стратегические принты и третий вопрос еще по поводу таранова вот вы говорили что моделью как явно вас будет меняться если таки готовы инструментарий для обновления структур в tarantul и без остановки с контролем их санирования ну там аналоги борьбы с какого нибудь да есть у кого вот он модуля вра вра схема да он же там не меняется медана тоналка файла есть какой-нибудь а вы имеете ввиду миграции данных migrate мы делали отдельные миграции самостоятельно пока хватит у тарантула еще нет синхронных реплик как решали эту проблему до на самом деле не решали вот наши данные наша специфика позволяет используйте синхронной реплики асинхронные реплики использовать и как бы то что он объект доезжает до этой реплики за какое-то там конечное время не не мгновенно это принципе для наш кейс не критично вот спасибо большое за доклад мне вопрос такой после имплементации граф quelle они потеряли в горизонтальном масштабировании высота ладно из исходных требований нет не потеряли а почему должны были потерять или я такого эштон старается индекса на поисковых работах каждый индекс это нет графики или просто позволяет вам доставать ваши данные виде графа и собственно неважно там какой ширины у вас кластер вот вы знаете куда сходить за тем чтобы взять разные части данных и при этом как бы никто не мешает вам масштабироваться при вставке данных яндекса мешает вот я слышала что горизонтальным 7 теряется давайте мы с вами обсудим наш тонирование как мы это дело с помощью весь рот вот сейчас вот прям сразу после доклада на привет спасибо за доклад вот у меня такой вопрос какая у вас была там жесткая схема вообще данных до этого как сложное было мигрировать на трандл это первый и второй вопрос какое преимущество вообще дал вам тарантул но учитывая что у вас был там джавада например к этой экспертизы это реляционная база там да под ней и выберите у вас там был за порог технологии от которого хотели уйти и вот вы решаете зоопарк плюс вода там какое преимущество дает тарантул что вот смотрите давайте с конца с конца начну отвечать мы хотим уйти и не зоопарк plus vu oe потихоньку от зоопарка в итоге кому-нибудь продать его другому за покрасились животных по другим вольером да чтобы с неба зоопарк чтобы у нас был тарантул вот по поводу того насколько ты был тяжело делать такую системах ну тяжело потому что где-то орка где-то microsoft sql server где-то что-то более экзотичная дебит у про прогресс вот поэтому везде бо все по-разному и какие то системы наши внутренние разработка какие-то внешние венгерская разработка полностью и мы не можем сами даже нечего там делать поэтому где то это было очень долго и где-то бы очень было больно вот поэтому так как сейчас контролируем все это мои мы это можно менять на лету мы можем писать эти сервисы в принципе достаточно быстро поэтому для нас это большой общий прирост по всем фронтам еще вопросы поля понимаю что реально транзакции в системе не то что максимум атомарная запись о требовании требует сильно реальные транзакции там распределенного рензо распределенных ложном загрузки конкуренции так далее то есть нет распределенных транзакций нет я пойду на неопределенный просто там концепция acid или там только атомарная запись или только и наверное ваших терминах это атомарная записи объектов до их это вообще-то анзак 100 ced а если нет asio эдита это вещь это смысле атомарный за кредит транзакция ладно спасибо еще раз большое спасибо за доклад а вот еще последний вопрос спасибо за доклад такой вопрос а на какой конфигурации оборудования итоге это работает то есть x86 и сервера да это обычная comunity железо ну как обычно не просто промо ними китайская железо да мы не можем себе только швец занести это брендовый железо это их элит packard байды 460 c девятого поколения вот 4 будет сервера достаточно такие простые и недорогие вот относительно конечно там всяких и цитата и прочих шкафов вот такой вот мы и собственность сразу хотели чтобы запускалась на comunity железе что можно было взять на ноутбуке запустить или там каких-то простых серверах до в течение получаса докладчик будет заходить находиться в зоне для дискуссий и выберите самый интересный вопрос да вот пожалуйста молодому человеку от который там с краю сидит который задавал очень много вопросов которые сейчас будет меня больше мужчина и тут он"
}