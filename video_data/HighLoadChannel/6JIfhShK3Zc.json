{
  "video_id": "6JIfhShK3Zc",
  "channel": "HighLoadChannel",
  "title": "Поиск GPS-аномалий среди сотен тысяч водителей / Александр Царьков (Яндекс Go)",
  "views": 581,
  "duration": 2464,
  "published": "2023-01-19T05:55:16-08:00",
  "text": "всем привет меня зовут александр царьков и сегодня расскажу вам что мы узнали научившись детектировать gps аномалий среди сотен тысяч водителей и с какими проблемами при этом столкнулись какие технически чему же перед нами образовались но это начало чтобы понять какая аудитория передо мной а поднимите руки пожалуйста те кто работает или работал с геолокацией супер достаточно много людей ok поехали я работаю последние три года в яндекс дом здесь я руковожу группой разработки алгоритмов назначениям и наша команда занимается тем что мы разрабатываем микро сервисы на си плюс плюс с использованием асинхронного фреймворка и сервер наши внутренние разработки и наша команда занимается задачами назначения это большой спектр задач который включает в себя приоритезация фильтрацию кандидатов на заказа такси доставки еды лавки и так далее также мы решаем оптимизационной задачи в частности буферное назначения это микро сервис который складывая все созданные заказы в некоторых буфер позволяет нам минимизировать суммарное время подача во всем городе ну и для того чтобы назначать курьеров и водителей на заказы правильно необходимо знать точные координаты знаю точные координаты мы можем обеспечить быструю подачу кроме этого мы можем показать пользователю точное время когда его курьер или водитель приедет на точку заказу зная точные координаты мы можем построить лучший маршрут а значит поездка будет максимально короткой ну и если поездка происходит по счетчику то это означает что мы сможем посчитать справедливую стоимость а наши водители курьеры пользуются мобильным приложением индекс пром это приложение в котором они принимают заказы от меняют их управляют своим профилем и далее в своем докладе я буду говорить о водителях которые пользуются приложением кода android в наших системе сотни тысяч активных за водителей в моменте и примерно так выглядит типичная картинка в москве на наших радарах здесь красные точки это водители активным заказом которые не везут и зеленые точки это водители без активного заказу каждый из них регулярно передает накопленные позиции в наш backend и мы их складываем к себе для того чтобы назначать ближайших и куча проблема которой я хочу поговорить берет свое начало в 2018 году когда в россии проходил чемпионат мира по футболу 2018 и здесь на картинке стадион лужники этого московский стадион где проходила серия матчей и мы заметили что в один момент временем водители которые находятся вблизи этого стадиона пропали с радаров и телепортировались шереметьево все указывало на то что в этой зоне включился gps пусть давайте посмотрим что это такое как это работает в обычной ситуации когда пользователь вызвал такси он видит на своем экране телефона свою точку точку где находится водитель время подачи и все хорошо в одессе свою очередь видят свое местоположение видят куда ему ехать видит сколько ему ехать если в этой зоне включается gps буфер как правило это какой-то компьютер который подключён контейнер транслирующие на частотах глобальных навигационных спутниковых систем и это приводит к тому что gps привык приемника водителя начинает определять подменено и местоположение и например водитель может обнаружить себя в шереметьево и оказаться полностью дезориентированным пользователи видят что водитель который был недалеко внезапно оказался шереметьево время подачи увеличилось до получаса естественно он заказ отменяет кроме этого новой пользователя которые хотят создать новый заказ тоже не могу дождаться машины потому что мы не знаем какие машин находятся поблизости мы не можем никого назначить заказы с горя сгораю gps buffing эта проблема актуальна и для всех глобальных навигационных спутниковых систем и для американского gps и для российского глонасс и для китайского бей давай и для европейского гляди а потому что они все работают на схожих принципов spoofing сильно бьет по сервису такси потому что мы теряем заказам но кроме всего прочего spoofing это часть более общей проблемы она маленький писать где а позиционированием о которой я хочу рассказать сегодня папа true не самое главное это то что когда такие аномалии принимают массовый характер это парализует сервис давайте посмотрим какие есть источники координат в мобильном приложении индекс про во-первых google вставляется android из детей из google play services api несколько локейшн провайдер первый из них этот gps провайдер который используют те глобальные инновационные спутниковой системы приемники которых установлены устройстве не обязательно этот gps это может быть и клона с и так далее 2 лакиш провайдеры the first а он работает чуть умнее чем gps он умеет определять местоположение не только под gps но и по вайфай роутером и сотовым вышкам например если вы заходите в здание вас сигнал gps теряется он переключает вас на вай фай и вы можете видеть где вы находитесь внутри здания network провайдер не использует gps может требовать подключение к интернету для определения положения и полагается на те вайфай-роутер и сотовой вышки которые ваше устройство видят поблизости и 4 виртуальный локейшн провайдер android посев которые по сути не определяет местоположение просто возвращает последние определенное место положение предыдущими тремя логич провайдерами и я о нем больше говорить не буду яндекс не стоит на месте и наши разработчики мобильного приложения добавили в приложение про еще три локейшн провайдера основанных на локейшн бэст сервис и сервис яндекса который называется индекс локатор это yandex без jetsam вайфай и айпи давайте расскажу поподробнее про яндекс плакатов это публичные htp и 5 который каждый из вас может попробовать и возможно он пригодится вам вроде если вы перейдете по ссылке он определяет местоположение по данным о jetsam вышках вайфая роутерах и айпи адреса вы данным оператором он не требует gps и еще одно его преимущество то что в среднем по россии точность место положи точность гео-локации у него выше чем у провайдеров который предоставляет google чтобы им воспользоваться вам нужно отправить тебе post запрос в нашу ручку передав туда массив с данными о тех сотовых вышках которые вы видите идиш ник вышки сила сигнала и так далее аналогичный массив про вайфай-роутер и поблизости и айпи адрес который выдал вам и оператор каждый из этих параметров опциональные в целом вы можете передавать только то что на вашем устройстве есть если есть вай-фай передавать вай фай если есть жсм передавайте же сам в ответ локатор пришли оппозицию точность вычисленной позиции и тип данных по которым эта позиция была вычислена но в данном случае этот же сам геопозиционирование осложнена наличием аномалий и все аномалий можно разделить на три больших категории это зависание позициям когда пришла позиция но долгое время какое-то время не обновлялось и мы не знаем наверняка где мы находимся сейчас если наша приемник перемещается точность позиции может снижаться и это мы видим на карте как увеличение радиуса круга вокруг нашей точки кроме этого координаты могут прыгать по карте если они прыгают на короткие расстояния мы называем это джиттер если на большие тают называем это телепортами gps имеет специфичные аномалии первая из них это spoofing который приводит к телепортом 2 jamming заглушение сигнала белый шум это может приводить к зависанию позиции снижению точности кроме этого есть так называемое мультипасс аномалия которая заключается в том что сигнал спутника приходят более чем потому оптическому пути а например отражаясь от здание атмосфера на приемнике возникают эффекта интерференции взаимного заглушения сигнал друг другом из-за этого координата может скакать по карте может зависать может снижаться точность это аномалия особенно актуально в районах где многоэтажная застройка или особенно небоскреба ну и в конце концов gps сигнал может быть просто потерям подверженность разных локейшн провайдеров аномалиям зависит во многом от факторов среды например городе у нас довольно плотная застройка много оптических препятствий поэтому локейшн провайдер использующие дпс большей степени подвержены job.ru и иногда мы можем замечать как в городе точность gps координат падает при этом gps редко зависает редко телепортируется только тогда когда включается с пуппером кроме этого провайдеры таких как network jetsam и вай-фай тоже показывают хорошие результаты благодаря тому что в городе довольно плотное расположение сотовых вышек и вайфай-роутер of поэтому им удобно вычислять координаты по этим данным даже не использовать без но при этом у них точность конечно поменьше чем у gps они чаще дрожат чаще их точность может снижаться если же мы выедем за город тот же ps почувствует себя очень хорошо ну конечно если это не какая-нибудь многоэтажная застройка но при этом провайдеры над вор jetsam и вай-фай будут показывать плохие результатом за городом у нас меньшая плотность сотовых вышек если вайфай-роутер и и есть то и достаточно мала и полагаться на эти источники среднем не очень хороший дим давай типа сравниваем несколько локейшн провайдеров друг с другом например gps и над word посмотрим на левую картинку где написано москва там мы видим два трека одного и того же водители из продакшна фиолетовый это набор красный теперь мы видим что в районе садовой триумфальный улица gps-координат а за весла и какое-то время водитель не получал ее обновление при этом network определял местоположения более точно и хорошая идея была бы переключить здесь водителя на gps она network если мы посмотрим на правую картинку на одинцова то увидим что network в одинцово ведет себя как-то очень непредсказуемо он скачет на сотни метров дискретизация очень низкая и в целом полагаться здесь было бы на над work проблематичным сравним это с индексом без вай фай видим что в одинцово индекс албес вай фай показывает результаты получше координаты более точно отражают реальные места положения они ближе к треку gps ну и в москве в целом тоже индекс nps вай фай показывают неплохие результаты иногда мы видим дрожание координат ананта находится с одной стороны дороги труд то с другой ну и вот эта картинка в одинцово би для объясняется как раз тем что у яндекса больше база данных с wifi роутерами сотовыми вышками в россии чем угла теперь мы знаем что у нас есть аномалии у каждого из локейшн провайдеров нам нужно что то с этим сделать и для этого нужно научиться их детектировать для начала скажем что такое хороший лакиш провайдер который мы можем доверять ну во первых у него должна быть свежая последняя координата он не должен зависать во вторых координатами должны прыгать для этого мы можем определить промежуток временного окна в этом временном окне проходиться по точкам сравнивать каждые 2 соседней точке друг с другом вычислять скорость перемещения между этими точками и если она превышает какой-то порог скажем москве там 200 километров в час а мы считаем что произошел прыжок к сожалению это неочень устойчивый критерии и он подвержен на срабатывание при дрожании потому что если за 200 миллисекунд координата скакнула на 50 метров что в целом может происходить для лпс вайфая для android network то тогда мы зафиксируем прыжок поэтому здесь нужно ввести дополнительный параметр то джиттер трешхолд который будет задавать минимальную дельту времени между двумя соседними точками которые мы учитываем при детектировании прыжка и тогда вот такие ситуации мы сможем определить но как я сказал этот критерий неустойчивее потому что если нас телепортировал шереметьево и 10 минут мы получали корзина тысяч шереметьево то в какой то момент мы забудем о том что прыжок произошел и будем считать что в шереметьево мы находимся хотя на самом деле не так поэтому нам нужно дополнительно сравнивать с текущие координаты с reference to me источниками координат reference to me мы называем такие источники координат аномалии в которых не должны коррелировать с основным источником например gps мы можем сравнивать над work вай фай jetsam если мы видим что gps далеко от них то значит мы телепортировались ok мы допустим вызов детектировать и какую-то аномалию нам нужно решить на какой локейшн провайдер переключиться можно задать какой-то статический приоритет и например если дпс стал плохим переключаться на фьюз если всю стал плохим на вай фай и так далее но как я показал на примере с москва одинцово невозможно задать такой статический приоритет который везде будет хорошо работать поэтому лучше идея это выбирать локейшн провайдер по максимальной точности при этом стоит учитывать среднюю скорость движения и возраст позиции потому что если у нас источник движущейся то тогда мы можем не правильно определить точность учетом его движения можно пойти дальше и постараться увеличить точность координат посчитав нет по какой-то формуле средневзвешенную координату по нескольким локейшн им провайдером и в целом здесь возникает простор для фантазии можно предлагать другие стратегии другой способ вычисления хороших координат самое главное что если мы построим систему в которой мы сможем детектировать аномалии то с помощью экспериментов мы можем подобрать хорошую стратегию которая решает конкретно нашу задачу далее перед нами стал вопрос как это реализовывать и первый вариант это реализовать на клиенте некоторый фреймворк который инкапсулирует себе всю логику детектирование выбора хорошего источника и просто дает хорошую координату клиентскому году и у этого подхода есть плюсом во первых мы не зависим от интернета и водитель даже в панелях и где-то где не ловит gps может выбирать хороший лагерь провайдер у нас ниже задержки у нас больше точек а значит наши алгоритмы будут работать с большей точностью и быстрее ноутбуки надо тоже есть свои плюсом и первый из них это низкий танту market мы можем быстро выкатывать какие-то экспериментов прот смотреть на аналитику и не дожидаться того когда все водители обновятся его мобильное приложение что для яндекс было конечно довольно критично кроме этого на букинге у нас больше железа значит мы будем гонять более тяжелого горит мам кроме этого у нас больше контекстом мы видим всех водителей в окресности текущего и дальше я покажу как мы это используем мы остановились на гибридным подходим и он заключается в следующем и клиенты backend одновременно детектирует аномалии водителям вычисляют параметр стратегии backend присылает вычисленные параметры и стратегию на клиент а дальше клиент решает использовать ему стратегию с бэг-энда если она есть либо переключиться на локальная вычисленную стратегию если например у него интернет отвалился давайте посмотрим на архитектуру нашего решением индекс право каждые 35 секунд посылает пачку агрегированных позиций в наш backend он через api guide твой приходит сервис я ресивер gi ресивер решая задачу поставки данных для всех других микро сервисов которые хотят следят следить за текущими константный водителей для этого он складывает их в редис кластер пупсов канал если кто не знает родис кластера это сортированный инсталляция редиса с многими мастерами многими репликами и для нашей нагрузки в десятки тысяч записей в этот канал очень полезно иметь сортированных базу потому что поток записи довольно большой в этой инфраструктуре мы решили сделать новый метро сервис под названием корт control который подписывается на pops up канал ради с кластером детектирует аномалии для каждого водителя вычисляет параметр стратегии и складывает их в свой редис далее клиенту нужно их как-то дать наш клиент полет backend каждые пять-десять секунд и при этом api guide выходит наш микро сервис забирает все вычисленные параметры и отдает их на клиента в этой схеме есть одна проблема и эту нагрузкам дело в том что на уровне приложения перед нами стоит задача в реальном времени детектировать аномалии среди всех треков всех водителей и принимать при этом на входе сотни тысяч позиций в секунду это довольно циpкa интенсив задачам и если дублировать впечатление на каждом из инстансов то мы будем очень много ресурсов расходовать другой стороны на уровне база данных перед нами стоит задача охранить порядка 17 гигабайт быстро меняющихся данных если мы хотим пойти по классическому стрекоз подходу для этого при этом мы хотим посылать в сотни тысяч запросов в секунду суммарную с профилем нагрузки много записей и много чтений поэтому во первых нам здесь нужно было бы выбрать какую-то особенную инсталляцию база во вторых для этой базы потребовалось бы много железа и в целом такое решение выглядела дорого любой компании должен быть баланс между польза это решение и стоимостью разработки поддержания поэтому эта идея была отвергнута для его улучшение мы решили сделать два шага во-первых мы решили уменьшить объем данных с помощью прореживания треков для этого мы берем каждый трак водителям делим его на временные промежутки каждый промежуток лимитирован по количеству точек который мы хотим оставить и удаляем те точки которые содержат себе а меньше всего полезной информации например точки которые лежат близко к той точки которые мы сохраняем окей так мы сохраним сократили объем данных вторым шагом мы решили шарди равана хранить треки водителей в память самого приложения на каждом из n инстансов и обрабатывать их шарди раваном то есть не дублировать впечатление и так мы можем поступить в благодаря двум причинам во-первых позиции постоянно к нам приходят и даже если один из instance упадет там и быстро сможем наверстать упущенное буквально за пять-десять минут с другой стороны клиента в это время пока backend недоступен продолжаю детектировать ломали использование свои локальные логике поэтому какое-то время они без бэг-энда переживают и здесь чувак дьявол кроется в опросе как сортировать и если пойти от простого и просто взять их и шатайте водителя по модулю n где над число instance of the мы наткнемся на известную проблему допустим нас было 4 сша отойди водителей у нас было три инстанса так они были распределены между инстинктами и какой-то instance упал что произошло нас три четверти данных мигрировал между венцами то есть каждый из инстансов отказывается от накопленных данных в пользу данных которые хранил другой intense это плохо нам бы хотелось чтобы при выходе из строя одной иной части приложения материальны более иной части данных и для этого в индустрии есть два самых известных подходом мы решили выбрать консистентной хэширование кто знает как работает конкретно хэширование поднимите руки пожалуйста отлично смотрите идея консистентных широва не я вот в чем мы берем виртуального окружность так называемое кольцо берем хэши от айдишник of каждого инстанция по модулю 360 на этой окружности мы откладываем угол равны и полученному значению и в этой головой координате на окружности мы ставим ногу которое соответствует нашему инстинкту с этим идиш ником это мы повторяем для каждого инстанция получаем вот такое вот распределение совпа окружностям то же самое мы делаем для иди водителей и дальше мы говорим что каждый водитель обрабатывается и хранится на том инстансе который находится ближе всего к нему по часовой стрелке получается такое распределение оно более менее равномерно и и все хорошо работает до того момента когда один из истцов выходит из строя что получается по тому же правило у мы выбираем instance по часовой стрелке ближайший и вся освободившаяся нагрузка ложится на один-единственный incense возникает перекос с ним сложно работать и его сложно перри балансировать и для того чтобы эту проблему побороть необходимо ввести параметры необходимо ввести понятие виртуальных not смотрите на этого мы ставили на окружности для каждого инстанция только одну точку а что если мы будем доказываем ставить несколько точек на окружности как мы это можем делать ну можем пересчитать хэш например с помощью какой-то соли или используя другую хэш-функцию мы можем сделать это n 1 в данном случае 3 и мы например в качестве соли используем просто строковое представление номера виртуальные но да и теперь каждый из этих трех виртуальных not означает тот же самый инстинкт это мы повторяем для второго инстанса для третьего i'm open на этот круг водите по старому правила получаем вот такое распределение далее один из инстов выходит из строя после этого водители перераспределяются уже более равномерно соответственно чем больше у нас виртуальных но чем больше у нас данных объектов которые мы сортированы храним тем более равномерное распределение получится это классная механика которая позволяет автоматически и равномерно перри балансировать нагрузку без необходимости вмешательства путей для так как сделать чтобы intense узнавали друг о друге ну для этого мы просто складываем их доменные имена в сет редиса с некоторым теле и каждые пять секунд каждый из нас of их перечитывает мы делали этом мы смогли перри балансировать нагрузку и в целом это работало далее мы подумали а что еще мы можем делать на викенде чего нельзя на клиентам и одна из таких проблем и тут дикси рование массовых телепортов смотрите допустим в районе охотного ряда включился gps буфер и данном случае 7 водителей куда-то телепортировались мы зафиксировали у них аномалию и в сторону охотного ряда движутся зеленая . это какой-то водитель по которой пока еще не въехал в зону действия спуфер а но мы бы хотели ему сказать дружище смотрели в твоем радиусе многие испытывают проблемы и лучше тебе бы переключиться на хороший лакиш провайдер заранее чтобы не видеть как ты телепортируешься потом телепортируешься обратно для этого нам нужно найти ближайших водителей с проблемами в на плоскости и для этого нужен некоторый а индекс здесь я перечислил теги индексы которые в яндекс go мы используем чаще всего мы стали думать какой из них выбрать и сначала мы хотели выбрать к д 3 но потом мы вспомнили что у нас есть трэвис а в одессе есть gear хэш как-то работает есть первая команда это герб она добавляет в коллекцию jams айди водителя с привязкой координатам вторая команда гиа радиус возвращает все точки которые добавили в коллекцию в заданном радиусе некоторой окружности давайте посмотрим как gear хеш работает под капотом я хэш используют проекцию меркатора земной сферы на плоскость и эта проекция делится на 32 квадранта каждому квадрант уставится идентификатор из одного символа vbs 32 далее эта процедура повторяется рекурсивным и каждый квадрант мы делим на 32 под квадранта и каждому под квадрант у дописываем еще один символ по такому же самому правил и это повторяется ну с произвольной глубиной который задается там детали мем имплементации конкретного герша таким образом gear хэш позволяет строку из двух символов строкой из двух символов закодировать некоторый квадрант страной очень грубо 600 километров а строку из 10 символов закодировать квадрант площадью меньше квадратного метра как мы это используем допустим нас ехал некоторые водитель в сторону охотного ряда и вот в течение зеленого трека у него все было хорошо но на охотном ряду его gps куда-то и портировался на сотни метров мы понимаем что возникла аномалия при этом мы берем референсную координату и кладем ее в редис той точки где произошел скачок без почему when a reference на потому что как мы знаем референсные источники не испытывают аномалии одновременно с железными так мы их выбрали поэтому им мы можем доверять при определении реального местоположения это мы повторяем для всех водителей кто испытывает на малик и затем для каждого водителя в этой области мы проверяем в радиусе нет липко водители с телепортами и если есть то тогда предлагаемому переключиться на другой локейшн провайдер это разработка на самом деле а сложная нам было в части тестированием все дело в том что такие проблемы происходят достаточно редком и просто ждать продакшене когда в москве включится спуфер мы потеряем заказу но зато проверим как работают все чтобы закомитить за это время это плохая идея поэтому подумали что scooper нам надо уметь эмулировать но если эмулировать то как с 3g мгимо эмулировать их не можем потому что данные у нас не сильно репрезентативные а подставляясь данный из production of strings с позициями реальных десять лет плохая идея это дорого и архитектурно неправильно мы остановились на идея сделать эмулятор скутеров прямо в продакшене как это работает мы задаем некоторую область на карте и для каждого водителя который в эту область въезжает мы создаем виртуального двойника которого телепортирую в некоторую точку далее мы зафиксируем аномалии для этих самых двойников и с одной стороны мы получаем инструмент который помогает нам визуально проверить работу алгоритма на реальных данных релевантных и при этом водитель в продакшене не страдают и не испытывают никаких проблем из-за того что мы их переключили на другой лаки что провайдер который может быть менее точный что хотелось бы сказать в итоге борьба с аномалиями это сложная задача но при этом возможным идеальное решение зависит от многих факторов первый из них это какому классу объектов относятся ваши приемники gps или использующий какой другой локейшн провайдер являются ли они стационарными где движущимися насколько их много с каким объем какой поток передачи позиции на backend с другой стороны для того чтобы эта разработка приводило к поставленной цели необходимо много тестирования и аналитика которая должна в идеале проводиться параллельно с разработкой на каждом их из этапов это позволит следить за тем что действительно то что разработчики делают сходятся к исходной цели и мы не делаем работу в стол нашем случае мы выбрали в качестве ключевой метрике количества прыжков и зависаний который мы хотели снизить ну и пара технических советов напоследок во-первых если у вас большой поток данных которые регулярно обновляется который не жалко потерять и который нужно регулярно вычитывать для того чтобы прогонять на них какие-то алгоритмы то рассмотреть сортирование на уровне приложения для этого хорошо подойдет консистентной хэширование но работает быстро и позволяет равномерно при балансировать нагрузку ну кроме этого существуют еще ранда буксирования которое в целом точно также может решить проблему поэтому здесь выбор за вами на нашем опыте хорошо продемонстрировал себя редис первую очередь как шина для поставки координат водители к нам в метро сервис и во вторую очередь как я хеш который позволяет удобно работать с гиа пространственными данными но в то же время рейде стань единственное решение и было бы интересно узнать и какие инструменты есть вашем арсенале с помощью которых можно решать аналогичные задачу и на этом у меня все пишите мне в telegram я могу прислать вам презентацию и теперь готов ответить на ваши вопросы о пупок пупок вначале гетто или середине доклад тов ну что решение , в архитектуры она в принципе как бы сложно с учетом столь нагрузки с учетом того годом данных и ты упорно что вы использовали как получается тротлинг но прореживания координат и часть впечатления вы привезли стремный клиент вообще какие-то другие проучи вы использовали для уменьшения нагрузки но и для повышения фиктивности решения и ну какие то решения и изменилось ли архитектура после этого то есть или она осталась вот такой же какой ладно сойдите ну давай вернемся к этому слайду вообще мы рассматривали в самом начале много подходов мы думали где поставить этот микро сервис мы думали о том чтобы поставить его не после гиа ресивера перетопить гид в.м. после обидит вы и так далее на самом деле здесь нагрузка уменьшается на каждом из шагов во-первых клиент при до griger уют свои данные и увеличивает и уменьшает объем который передается на backend и во-вторых регио ресивер тоже умеет упаковывать их немножко прореживать ну и потом приходит наш микро сервис это же эти данные прореживают самом начале мы не про реже вали их и вот как раз объем данных привел нас к мысли что это стоит делать какие еще решения мы рассматривали но мы думали еще хранить это все треки в базе но от этого решения как раз отказались из-за того что это довольно большой объем данных которые нужно гонять между приложением и базой целом наверное есть еще одна идея которую можно было бы в будущем реализовать это все-таки унести хранение в базу и сделать какое-то инкрементальные обновление инвалида цию к шее который нас на клиенте чтобы мы не каждый раз ходили за полным треком из базы обновляли его по свежим точкам которые приходят но это усложнит эту архитектуру к сожалению я ответил на вопрос приветствую спасибо честных вардан nitricum все стран спрэдом например ну так вот я правее у меня пара мелких вопросов первое действие информация там больше аномалий gps происходит именно намеренных spoofing там в плохих целях или это случайное какие-то вещи естественные там вот как здание было сказано нам spoofing это очень редкая аномалия оно случается в москве раз в год или раз в полгода гораздо чаще и дпс просто зависает мы теряем сигнал или он на прыгает в районе москвы сити вот океаном они происходит чаще но spoofing а он хоть и редкий но он очень больно бьет потому что он пролезаю сразу многих водителей которые в зоне действия спуфер находится поэтому мы с ним тоже должна бороться я так понимаю больше случайных вещей чем намерен там и второй вопрос я не очень понял по поводу того чтобы определять себя локацию на клиенте там был плюс о том что не надо ходить по сети некуда но это же правильно что работает только для gps там для gsm buy for piano уже не применимо если есть не ходите по сети куда-нибудь не запрашивать информацию да все правильно то есть когда у нас мы теряем интернет мы не можем получать свежие координаты там по вайфаю через яндекс локатор и так далее но тем не менее у нас есть какая-то накопленная история в которой мы можем проверять были ли до этого прыжки или зависание утихла кеш провайдеров сравнивать с gps ом и приключаться то них даже если их позиция старая но находится в каком-то месте где водитель я не находился это лучше чем оставить gps который может телепортировать себя в шереметьево спасибо большое спасибо выставляли алексей зовут у меня вопрос по поводу намеренного gps спуфингом наверное это в районе кремля не зря были какие-то регуляторные требования не показывать гео-позицию в районе там запрещенных зон а если честно я такой информации не обладаю кажется что не было или если была под у меня не доходило спасибо быстро вы спасибо за доклад очень интересные два небольших вопросов первое планируется или может быть уже использовать эти технологии в яндекс навигатор яндекс картах и второе и второе 1 раз точно было второе то что от вас есть клиентская часть она выглядит дешевый с учетом того что такое массовое номоли возникают редко и правда ли что с точки зрения денег целесообразного держать поддерживает дорогой кластер там рейде сафу команды разработки и кучей серверов на то чтобы с другой стороны просто в редких случаях потерять часть заказов спасибо за вопрос в яндекс картах индекс навигаторе такой функциональности нет и или если есть то оно работает немножко по-другому это скорее вопрос нашим разработчикам карт одна из причин состоит в том что наши водители регулярно нам передает свое местоположение в отличие от пользователей которые пользоваться навигатором и картами поэтому там мы не можем нам низким просто сравнивать водителей пользователей карт и навигатора по поводу целесообразности такого бэг-энда до отличный вопрос на самом деле backend был необходим в фазе активной разработки когда мы проверяли много гипотез когда мы экспериментировали подкручивали параметры придумывали нового алгоритма в итоге конечно если остановиться на каком-то решение которое лучше всего работает то его можно оставить на клиенте и бы кант выключить но в целом все равно backend позволяет нам в какой-то момент прийти и что-то быстро подкрутить без необходимости ждать обновления клиента вот поэтому backend все еще нам болезнь так у меня привет спасибо за доклад на самом деле очень близкие вопрос которым то что задавали сложная архитектура сложный алгоритм и большой backend толстый и с точки зрения экономической целесообразности и такой ну понятно что это цифры да это мы не называем цифры но вот как оцениваешь настолько или большая была проблема чтобы решать сложные бэндом сложной архитектурой и она с точки зрения ли тических данных принесла ли то что ожидали сказали что до продукта лучше и мы его составляет до на самом деле мы тоже задавались этим вопросом и в итоге пришли к тому что польза была польза была достаточно заметная мы видели это в экспериментах нас прокрашивали метрики я думаю что все зависит от объема данных вот в нашей системе очень много водителей поэтому для нас это было полезно потому что проблема хоть и редко но умножались на сотни тысяч водителей мы получаем что-то довольно неприятно поэтому до для на 100 баллов экономически выгодно но не факт что в например где-нибудь где пользователи там сотни или тысячи нужно строить такой же космолет было сейчас как-то это работает сейчас там спасибо большое спасибо спасибо вот еще раз потом два и дальше посмотрим на часы пожалуйста привет спасибо за доклад у меня два вопроса во первых не думаете ли вы за ухо сеть клиентскую часть которая там вы выбираете между разными провайдерами и второй вопрос экспериментировали вы с использованием xiaomi то который стоит с телефон чтобы экстраполировать последний хорошую казино например в туннелях и так далее спасибо за вопрос залпом source таких мыслей пока что не было но может быть когда-нибудь мы к этому придем но я здесь обещать не могу по поводу акселерометра на ранних этапах наши разработчики мобильного приложения проводили исследования и выяснили что акселерометр очень зашумлен то есть например если телефон переносится на метр вправо потом на метр влево то как бы сумма этих двух перемещений не вернется в исходную точку поэтому полагаться на него это не очень хорошая идея ну и плюс ко всему это довольно сложно нужно постоянно вычислять нужно постоянно прошивать акселерометр вычислять вектора перемещения и вычисляется текущие координаты что наверное я думаю будет не очень энергоэффективно спасибо ну да еще сюда добавляется разговор о том что делать телефонами подешевле которых больше пожалуйста привет спасибо за доклад помогает ли это все против злонамеренных действий стороны водителя каких-то может быть модификация прошивки устройства или что то еще или вы используете дополнительных ощущениям для этого против модификации прошивки правильно ли я вас понял что имеется ввиду когда водитель модифицировал прошивку так что например gps-приемника там система возвращает какую-то подменено корзина . низкоуровневый fake gps и слышно поэтому она блокирует какие-то источники вроде вай-фая gps подделывали как ты еще да ну вообще в мобильном приложении есть система которая борется с fake gps мы такой целью не задавались но в целом если подумать наверное да это позволяет бороться например у нас есть яндекс локатор который возвращает местоположением вы член она бэг-энде и его даже модификации прошивки подменить не получится если пользователь даже на низком уровне подменяет gps мы все равно видим что он далеко от локации вычислены на нашем бренде поэтому можем такие гео-позицию откинуть спасибо так еще минуточку поговорим да у нас электронный очередь я бы хотел уточнить насколько жирный редис сколько конкретно там нот и как коррелирует рпс на ручку по здесь у нас как раз количеством нот в радости и динамические они или статические организованные как вот это все работает я не помню точно цифра сколько нот в одессе нас но примерно десятки кажется 1020 как-то так они статически задом и мы не можем их автоматически выводить новые в целом вот вторую часть вопрос можешь пожалуйста вторить про ручку позиция нагрузка на ручку подержаться она же плавает во времени она может быть больше и меньше как она коррелирует с количеством но то вы не как сделать это статический да все там хватает 20 нот на сотни тысяч рпс да да хватает во многом из-за того что у нас к в каждом запросе приходит уже пачках позиции при doggie раваной поэтому позицию на сотни тысяч а запрос приходит там десятки тысяч друзья это прекрасный разговор мы к сожалению должны по времени просто закончить поэтому вот кто не успел вопросы да задать подойдите пожалуйста и спасибо сцене поймаете спикера еще тепленького вот на ступеньках призы от конференции спасибо за выступление всем спасибо"
}