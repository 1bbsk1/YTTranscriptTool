{
  "video_id": "1pSHI_4ICbY",
  "channel": "HighLoadChannel",
  "title": "Серебряная пуля геораспределенных систем / Евгений Кузовлев (ECOMMPAY IT)",
  "views": 3366,
  "duration": 2531,
  "published": "2021-10-04T02:47:27-07:00",
  "text": "привет ребят начнем с простого кто мы такие почему я здесь чем мы сегодня будем говорить вообще какой я имею моральное право вам чего-то рассказывать и компы это международный финте холдинг который отвечает за то чтобы максимально безболезнено принимать деньги у населения мы процессе им достаточно большое количество транзакций в день краеугольным камнем ganas является надежность и один из показателей который позволил нам нашу надежность поднять это количество площадок которых на которых крутится нашей системы в итоге практически каждой нашей системы которые мы эксплуатируем является гиа распределенной еще хочешь сказать что мы вот такой хорошем смысле настоящий фильм тех что я в это вкладываю я вкладываю следующее понятие что практически каждую за крайне редким исключением систему который которую мы эксплуатируем и который мы зарабатываем деньги мы написали сами я привык к тому что у нас больше 50 процентов компании айтишников и об этом обо всем вот гиа распределенных системах том что потенциально giau распределенные системы могут повышать надежность мы поговорим зачастую как начинается история построения гиа распределенных систем к вам приходит руководство ваш бизнес и говорит а давайте мы сейчас нашу систему поставим в 2 дата центра если у нас даже один из дата-центров откажет то у нас есть 2 но бизнес не понимает он не должен понимать какая сложность стоит за этим понимаете это вы и об этом собственно мы и поговорим вообще давайте разберем ответ на вопрос а зачем строить в его распределенные системы конечно ну самое первое это обеспечение надежности но это не единственная причина по которой вы можете построить и захотеть построить giau распределенную систему кроме этого очевидно это может помочь приблизить вашей системы конечному пользователю для разного рода системы это может быть критически важно например если вы строите систему которая показывает рекламу на сайтах контекстную то для этой системы критически важна скорость ответа и в этом случае чем ближе ваша система находится к конечному пользователю тем быстрее вы покажете нужную рекламу тем быстрее она загрузится поэтому это очень важный показатель для определенного рода систем ну и не надо забывать что когда у вас есть несколько дата-центров то вы можете масштабировать нагрузку между этими дата центрами между установками ваших систем и тем самым обрабатывать большие количества пользователей большее количество запросов и зарабатывать больше денег о чем конкретно мы сегодня будем говорить чтобы конкретизировать скажем так наш спич по очень абстрактная обширной теме по гео распределенным системам настоящего мы с вами будем говорить о правилах как не выстрелить себе в ногу о базовых правилах построения гиу распределенных систем конкретно про две вещи мы сегодня будем разговаривать мы чуть-чуть поговорим в первой части нашего разговора про архитектуру дел распределенных систем и о том как данные связывать в разных установка как передавать и кроме этого во второй части мы с вами немножко поговорим про сеть про новые границы которые может открыть вам в сетевой составляющей построение гиа распределенных систем потому с чем вы можете столкнуться в рамках этого увлекательного процесса ну и кроме этого что вам готовят различные регуляторные органы очень кратенько если вы будете строить гиа распределенные системы в россии это носит свою изюминку у нас в стране и так начнём архитектура да когда мы строим гиу распределенные системы первым вопросом которую мы задаёмся заключается следующем а как нам синхронизировать данные между да по центрами есть совершенно замечательная такая называется на теорема не совсем это теорема принятого этично мере назвать теорема cup теорему кто про нее слышал практически весь зал это отличным это с теорема она формулирует три основных принципа надежность согласованности доступность из которых по факту гласит классическая интерпретация эта теорема очень утрированно что из трех можно выбрать только два по-настоящему это не совсем так там есть дополнительные отдельные рассуждению умных мужей о том что при определенных условиях мы можем выбрать все три но эти условия очень ограничены мы же рассмотрим очень примитивно этот вопрос и поговорим о вопросе синхронизации данных вопросе синхронизации данных у нас по-настоящему есть наверное три подхода первый подход это мы синхронизируем данные асинхронно то есть мы принимаем запрос в одном на одной площадке на другую площадку данными передаем после того как это запрос обработали альтернатива этому id асинхронная обработка запросов когда мы данным принимаем на любой из площадок сохраняем по всему skype всех наших установок после этого возвращаем данный клиенту ответ на наш запрос естественно этот две противоположные границы и обычно истина находится где-то посередине есть третий подход это гибридный подход когда часть данных но синхрона часть данных всем хроник записываем но для того чтобы разобраться какой подход хорош и какой по-хорошему надо бы использовать давайте начнем по порядку вот предположим мы хотим синхронизировать наши данные абсолютно синхронно обеспечивать полную консистентной наших данных для того чтобы понять хорошо это или плохо давайте посмотрим вот на такую картинку это картинка времени доступа с теолога от пользователя который находится примерно в москве примерно потому что сетевая топология она бывает иногда своеобразные вещи творит да вот конкретно наших точек присутствия в европе это несколько дата-центров которые расположены в различных европейских городах здесь мы видим что самая близкая . это томат условную . присутствует хельсинки до нее из москвы и сетевой лаг составляет примерно 40 миллисекунд если же мы строим систему которая будет синхронно сохранять данные то автоматически любой запрос у нас увеличится от 40 миллисекунд куда приходит запрос к ближайшей точки до 40 плюс какая-то дельта которая накладывается на то чтобы передать запрос между всеми дата-центре обычно это там ну вот в нашем случае если мы синхронно данные гоняем это примерно от 45 до 90 миллисекунд в зависимости от текущей задачи возникает сразу вопрос ну окей мы готовы этим пожертвовать а как это делать зачастую у вас у всех ваших системах есть какие-то классические реляционные базы данных вы хотите построить распределенную систему идете не знаю открываете google что делает разработчик сначала открывает google да и как построить распределенную систему если вы напишете в синхронной то вы можете найти вот такую прекрасную вещь которая называется галера кластере слышали про галер класс у кого есть галера кластер одна рука поднята две руки поднята прекрасно 2 галера кластера в зале вот такое можно прочитать это соответственно копия информации с сайта который посвящен галера кластеру и если это прочитать то выглядит что это просто серебряный пульт ну вот просто берём ставим и все круто у нас все сразу из коробки консистентная надежность так подумали наш с вами коллеги из одной транснациональной корпорации у них было три площадки лондон далласа сингапур для понимания сетевая задержка между лондоном и сингапуром составляет примерно 130 миллисекунд между лондоном и голосам примерно 95 миллисекунд ребята у них было распределенная система они получили в итоге commit time на одну транзакцию полсекунды если что-то случалось приключение клиента минимум за 10 секунд они попробовали так работать 2 2 месяца и у них ничего не получилось они откатились обратно к режиму когда у них один дата-центр активной и два других находятся в режиме горячего такого полу горячего резерва получается что ребята все-таки не серебряную пулю дали из галера кластера нет она решение рабочая его можно использовать надо понимать какое оно за собой несет логику и как эта логика ложится на ваше приложение ok предположим у нас три дата-центра который в разных локациях принципиально разных получается что мы не можем использовать синхронную репликацию давайте посмотрим в сторону асинхронной репликации асинхронной репликации это классическая в mais quel если делать это классический асинхронный multimaster как и multimaster а мастер мастер прошу прощения когда каждый дата центр является словом для другого дата центра и они синхронно воспринимает данные тоже самое попыталась сделать еще другая уже эти компании наш с вами коллеги тоже у которых был 20 в москве и питере изначально питерский тот был резервный московский основной они сделали асинхронный multimaster поставить туда синхронную репликацию завершили внедрили они этот проект пятницу вечером до понедельника они отмечали успешные заявляю завершение проекта а где-то в понедельник кладет все эти подняли по тревоге почему а потому что у финансистов в духов финансовых проводках оказались разные данные если кто то не знает то финансисты готова за это убить натуральном смысле слова потому что у них не может быть такого что в двух проводках может быть разные данные для них это подобно смерть в итоге за неделю все разобрали откатили и снова работают на одном активном судьи и одном неактивным получается странная история синхронная плохо асинхронная плохо чушь делать и вот чтобы понять что делать и как вообще жить и надо ли строить вообще гиа распределенные системы давайте рассмотрим пример из реальной жизни у нас стояла задача построить гиу распределенный биллинг что такое биллинг в нашем случае вот идет транзакция клиента например вы совершаете покупку в магазине то есть деньги от вас уходят в сторону магазина в этом смысле посередине мы стоим как эквайринг и мы условно живем на маленький маленький маленький процент там ноль ноль ноль один процент обычную от этой транзакции но мы должны посчитать этот процент потому что он от каждой транзакции разный вот задача биллинга родов у нас много 5 соответственно надо обеспечить реализацию этого биллинга с простыми условиями но взаимоисключающими должна быть максимальная скорость ответа и должен быть синхронный контроль баланс и условия вроде бы они взаимоисключающие тут нужно сесть в уголок плакать но мы не стали плакать мы пошли немножко вглубь и посмотрели а какие же у нас есть типа транзакции в вилен гиап типов транзакцию словно есть 2 1 тип транзакции эта транзакция по инн это когда вы деньги платите в этом случае вы передаете деньги и они идут как бы клиенту клиенту юридическому лицу к нашему клиенту второй тип транзакции эта транзакция payout это например типичная транзакция когда вам на карту несколько раз месяц или 1 1 месяц у падает зарплата то есть со счетов юридических лиц мы передаем деньги на счета физических лиц к примеру и посмотрев на эти два типа транзакции посмотрев на условия мы получили достаточно интересное наблюдение что не надо выполнять условия которые были изначально для всех типов транзакций а максимальная скорость ответа надо по-настоящему обеспечить только для пэйна для по java то как раз нужно синхронный контроль баланса сейчас объясню почему вот вы когда покупаете в магазине представьте себе что вы предложили карточкой к терминалу и на терминале слова обработка висит 5 минут вы нервничаете кассир тихо нажимает на кнопку рядом уже стоит охранник который готов достать что они там дубинкой тесак до такой такой нервозность я думаю что если у вас вот каждая транзакция будет проходить так то примерно через день задумаетесь о смене банка ну потому что ну не надо потому что вы привыкли приложили карточку и сразу же пошла транзакция поэтому здесь важна скорость но когда вы платите счет клиента он увеличивается всегда потому что мы деньги от вас переходит клиенту там не нужно в принципе баланс контролировать настолько а вот по инн как раз в payout транзакция когда за счет юридического лица идут в обратную сторону деньги там не принципиально скорость ведь когда вы например получаете зарплату вы даже не знаете в какой конкретный момент времени вы ее получите вы знаете что вы например получите 15 числа ого сколько в12 в 11 в час дня до вам не принципиально вы знаете что вы ее получите в этот день но в этом случае вам надо контролировать нам надо контролировать баланс чтобы не дать уйти в минус счёту с которого происходит списание денежных средств получается интересная история что для одного тип транзакции есть одно требование для другого тип транзакции есть другой требуем и родилось вот такая вот интересная структура на примере трех дата-центров мы разделили баланс на 3 часть то есть у каждого юридического лица его баланс поделен на 3 до на три части и каждая часть принадлежит своему дата центру и только конкретный дата-центр может ее изменять суммарный баланс каждого клиента состоит из трех балансов сумма балансов по всем дата-центром что это дает это дает следующее что когда нам надо изменить баланс на какой бы дата-центр к нам не пришел запрос мы в этом дата-центре локальный баланс и меняем если у нас локальный баланс увеличивается проблем нет вообще если у нас локальный баланс уменьшается то в рамках конкретного дата-центр мы просто контролируем уровень этого локального баланса для того чтобы он не ушел в отрицательные значения если в локальном дата-центре не хватает денежных средств идет широковещательные сообщение с фразой а ну-ка займи мне пожалуйста происходит внутренний перевод с одного дата-центром другой и если денежных средств на всех дата-центрах от хватает для проведения транзакций мы эту транзакцию проводим к чему я это рассказывал и это рассказывал к тому что мы пришли в итоге к следующей архитектуре по инн транзакции происходит в асинхронном режиме то есть транзакция всегда придёт на один дата-центр а потом данный когда-нибудь по принципу и венчал консистенции доедут до других дата центров по я вот транзакции в большинстве своем приходит в асинхронном режиме если хватает локальных балансов а если локального баланса не хватает этого происходит в синхронном режиме с задержкой времени проведения транзакций потому что для по java транзакции это допустимо какой вывод из этого можно сделать из этого можно сделать вывод что архитектуру синхронизации данных между удаленными площадками стоит строить исходя из той модели из той архитектуры системы и тех бизнес требований которые у вас есть если же у вас архитектура системы не позволяет реализовать это то надо подумать об изменении архитектуру системы это первая часть марлезонского балета про синхронизацию данных но дальше поднимаемся выше является ли синхронизация данных единственной проблем следующей проблемой которая являет которые есть у нас а синхронизация это не единственная проблема это проблема роутинга очень просто когда у вас стоит ли системы когда вы работаете с одним запросом у вас нет проблемы роутинга к вам приходит запрос любой из доступных дата-центров любая с доступных площадок отправляет ответ и забывает про пользовать у вас нет проблемы роутинга но вот у кого-нибудь есть stateless системы а стоит full практически весь зал стоит фу то есть по факту у вас всегда у вас всегда стоит full system и в зависимости от того куда придет запрос пользователя у вас по-разному меняется поведение системы какие варианты роутинга есть для пользователя если вы строите распределенные системы базовые варианты которые вам предоставляет любая технологическая платформа или вы сами их можете построить они примерно следующее это либо распределение на основании параметров в цод нагрузка количество серверов в лс либо сп распределение на основании клиентских параметров айпи адрес браузер устройство что-нибудь еще либо распределение на основе какую-нить математической функции например каждого первого каждого второго отправляем налево каждого первого отправляем на право хорошо ли это но все эти варианты зачастую они не работают не работают тогда когда у вас во время взаимодействия с клиентом более чем один запрос если у вас более чем один запросто у вас регулярно может возникать вот такая ситуация у вас два центра первый запрос пришел на один дата-центр 2 на другой там нет данных в туалете с ошибкой пользователь недоволен пользователю шел по факту получается что у нас есть дополнительные условия роутинга дополнительные условия роутинга заключается в том что роутинг надо осуществлять когда-то с привязкой пользовательской сессии а когда-то без привязки пользовательской сессии как это сделать если у нас стандартные инструменты принципе есть но стандартные инструменты вот те которые реализуются в рамках стандартных механизмом механизмов они ведут к определенным ограничениям эти ограничения они достаточно просты и первое ограничение что если мы например рауте на основании внутренних параметров запросе клиента то этот параметр должен присутствовать в каждом запросе не знаю у вас должен быть идентификатор совершаемой операции в каждом запросе от клиента не каждая по такой может сделать если же мы роутинг осуществляем на основании каких-то параметров клиента например ай пи адрес это может привести к тому что у вас routing пойдет с перекосом у вас появилось много пользователей за одной локации с одним а те печника мыле из одной подсети они все пойдут в один дата-центр кроме этого если вы учитесь на основании пи адреса то если вы вводите или выводите какую-то площадку в строй в этот момент у вас карта перестраиваются и соответственно люди они будут перекинута на другую площадку вас не сохранится сессия вы получите ошибки есть еще один вариант которым пользуется например большинство банков если вы вы заходите в онлайн банк например того же сбербанка то вас с адреса онлайн . там сбербанк точка ру redirected на адрес достаточно хитрый ноды там 01 . сбербанк . что-нибудь такое и такой вот во многих вариантах то есть происходит redirect при первом обращении на адрес конкретной площадке но с этим есть та же проблема это работает для браузерных клиентов если у вас есть клиенты которые обращаются к вам попей то не всегда можно такого клиента redirect 0 потому что зачастую элитные сообщение по этой содержит post запрос a post запрос redirect нуть для другого для другой машины другой системы практически не представляется возможным то же самое те же самые проблематика с куками cookies вы можете выставить только клиенту чушь делать то что же делать-то по-настоящему выбирать в зависимости от того какие у вас ситуации если у вас только клиенты вот мы браузерные как например в онлайн-банкинга вы можете redirect совершенно спокойно конкретную площадку что сделали мой у нас и браузерные интеграции и опять интеграции у нас первичный пост get запрос и у нас не осталось иного выбора кроме как реализовать схему которой в каждом запросе от пользователя есть одинаково идентификатор вернее для нас это пара уникальных идентификаторов это идентификатор проекта идентификатор клиента идентификатор платежа на основании этой пары мы определяем куда отправить запрос это все хорошо и она может работать в конкретном случае опять же какой здесь вывод что серебряной пули нет и мы это всё строим всегда исходя из того какие ваши системы но роутинг он может также применяться для того чтобы обеспечить приближение ваших процессинговых решений ваших систем конкретному пользователю и когда вы решаете вопрос приближение ваших решений конкретному пользователю минимизации время ответа скорее всего вы столкнетесь вот с таким словом это слово и не каст кто не слышал про unicast кто-то слышал отлично не к стати свой протокол который позволяет отдавать сетевые маршруты для одних и тех же систем для одних и тех же адресов dns который потом транслирует свои при адреса по разным то есть у вас есть несколько площадок и они могут отдавать разные маршруты и в зависимости от того какой маршрут является для клиента самым маленьким клиент попадают на ту площадку где соответственно наиболее быстрое время для него но и не каст реализовано основании протокола bgp а если мы используем by jack это автоматически мы приходим вот к этому понятию собственной автономная сеть кто знает что такое автономная сеть автономная сеть друзья мои не все просто знают это собственный набор айпи адресов хотели бы вы владеть своими ip-адресами лонгборды в у них не арендуете у кого-то а вы их покупаете они ваши но если вы примете решение о том что вам нужны собственное пи адреса вы будете похоже вот на такого котика почему самое первое айпи адреса закончились нет есть api вы 6 адреса но проблема заключается в том что еще не все работают по ipv6 если вы не хотите отрезать львиную долю клиентов то вы не можете взять api вы 6 адреса если вам нужно и пиво 4 адреса то вы подаете заявку на получение статуса лир local интернет регистратор это как раз и означает то что вы становитесь владельцем автономной системы и вам говорят о кей вас поставили в очередь чего плакать и страдать нет есть биржи где это можно купить есть другой путь интернет-адреса закончились в европе но они не закончились например у в африке в африке свой собственный своей собственной организация которая ведает распределением адресов можно подать туда и вам сразу выдадут заявку в африку айпи адрес который будет привязана к африке здесь есть проблема вы должны тогда вести бизнес в африке потому что если вы бизнес в африке не видете то айпи адрес скором времени у вас отберут и дадут по голове потому что так в последнее время стали делать очень многие тем которым не хватает айпи адресов в европе окей каким-то образом купили айпи адреса дальше начинаются куче других совершенно разных проблем с которым вы раньше не сталкивались на первое все эти веков нет но вы можете сказать что любых специалистов нет на рынке да но сетевики это отдельная категория людей которых и так очень мало и их действительно совсем почти нет на эти качественного статейка это прямо проблемы вы сразу сталкиваетесь что вам нужен резерв провайдер раньше вы об этом не задумывались вы работали либо в облаке либо вы работали в собственном оборудовании мы арендовали машиноместа там стойку и сеть у провайдера куда-то центра и дата-центр сам заботился о том что в случае нам какой-то аварии переключить вас на другой dc теперь это не работает внезапно магическим образом почему потому что вы сами управляете собственными api адресами вы сами управляете куда вы отдаете анонсы в какого провайдера и вам резко для вас резко открываются новые картины когда вам нужно несколько новых провайдеров и естественно для вас от открывается совершенно новый дивный мир это сетевые катаклизмы которые регулярно происходит вот последняя фраза провайдер накосячил flow speck эта фраза которая случилась примерно полгода назад есть такой крупный достаточно провайдер сейчас он называется уже люман случилось достаточно простое и это все магистральный провайдер который обслуживает примерно 30 процентов всего интернета там какой-то инженер проводил регулярные работы и случайно совершенно ошибся в протоколе в свой успех произошел что примерно 70 процентов всего мирового интернета пошло через одну маленькую стоечку где-то в минесоте стоечка не выдержу потери пакетов составляли примерно девяносто девять , 999 много если у вас собственная автономная система если у вас один провайдер для вас это может стать критичным ну потому что весь ваш трафик он пойдет через такую стоечку в случае аварии авария тогда длилась семь часов и крупняк спасался только тем что он переключался на других каких-то резервных провайдеров ну и последний нюанс который присутствует только в россии если у вас европейские рубиться если у вас бизнес европе это вас не касается это вы познакомитесь с аркаим team что такое ркн в россии это организация про которую мы все много шутим в нашей telegram канальчик ах про которую которую мы не любим который пыталась забанить telegram но потом сдала назад так вот если вдруг вы получите в россии автономную сеть то к вам придет арка м и 1 сток скажет передайте информацию о том что у вас есть автономная сеть вы передадите потом к вам придет снова и скажет так а теперь давайте еще полную конфигурацию оборудования полные конфиге вашего оборудования желательно распечатки желательно заверенной подписью вашего генерального директора и вот обновляйте их каждый раз когда вы их обновили но это еще не все скажите пожалуйста а кто нибудь слышал такую аббревиатуру нсд одна рука две-три это суверенный интернет господа он уже работает нсд и это национальная система доменных имен и если вы являетесь раньше это требование распространялась только на телекоммуникационных операторов а теперь она распространяется в том числе на владельцев автономных сетей если у вас есть собственная автономная сеть это значит что русского согласно требованию роскомнадзора вы обязаны в первую очередь использовать корневые на минные сервера которые поддерживаются роскомнадзором график работы этих серверов можно посмотреть специальном кабинете который работает в первый понедельник месяца высокосный год судя потому что никто не знает как они работают но они уже есть это дополнительный привет нам от государства которые которая хочет контролировать все соответственно это вот те проблемы которые мы с которыми вы можете столкнуться в том случае если вы хотите полностью управлять своим роутинга мм полностью хотите приближать клиента к себе и хотите организовывать информационные системы которые расположены в географически разнесенных дата-центрах какие выводы из этого всего мы можем сделать 1 про то что я уже говорил что типа организации данных и синхронизация этих данных между дата центрами зависит исключительно от внутренней логике эта архитектура ваших систем где-то может быть если у вас дата-центра близки вам подойдет синхронную ось синхронная передача данных но в большинстве случаев нужно думать как жить с асинхронной асинхронные приводит к тому что у вас увенчал консистенции что вы не можете по факту изменять одни и те же данные в одних и в разных дата-центрах и вам надо как то с этим бороться роутинга пользователи дополнительными ухищрениями еще как-то не ищите готовых серебряных пуль их нет любое про что вы прочтете в интернете что и вам что покажется что это классно оно не будет работать если вы четко не понимаете как вы хотите сделать вам сначала надо понять как вы хотите и как он будет работать в соответствии с вашими бизнес требованиями и потом под этом можно попробовать найти решение но как показывает практика решение не подойдет на сто процентов если вы хотите строить гиа распределенные системы то вы столкнетесь с проблемой роутинга пользователей эту проблему вам придется решать она нестандартное и если вы хотите приближать своей системы конечному пользователю вы столкнетесь с понятием автономной системы это абсолютно иной уровень проблем который вы можете получить каску с которым они до этого не сталкивались есть естественно облака облачные хостинге типа amazon и тип mail.ru клал solutions типа яндекс облака который часть проблем могут попробовать решить за вас но эта попытка решение проблем опять же надо четко отдавать себе отчет а как это работает есть современные вещи такие как amazon лямбда это исполнении какого-то кода на корневых на роутерах которые максимально приближены к пользователю за счет того что амазона есть достаточно большая собственная сеть этих edge и роутеров но можно ли их использовать да это приведет к тому что вы максимально близко подберете к пользователю но понимать что нам даст числе не я они не подходят для степу приложений в большинстве своем стоит full приложения должны иметь общение с базой данных а базы данных не может быть расположены на этот роутер и потому что эти хадж роутеров сотни они регулярно перезагружаются они не хранят состоянии но обо всем об этом наверно в маленький доклад уместить нельзя наверное на этом все мы с удовольствием продолжим дискуссию в кулуарах а сейчас вопросы спасибо большое девчонки но побежали у нас спасибо что оставил больше времени на вопросы мы можем сейчас поговорить плотнее и ребят и зон из онлайна если у вас есть вопросы пожалуйста нажмите соответствующий кнопочки мы выведем вас в эфир с удовольствием первый вопрос пожалуйста представляетесь и вперед она лишь константин россельхозбанк почему природе нга вы не рассматриваете грн с ндс можно рассматривать дело dns но опять же а что будет если у вас от к происходит отказ и у вас дела dns должен распределяться на другую дату центр получается вы теряете сессию точно также как потеряю с установкой ничуть не хуже анимирую гораздо меньше это решение если вы готовы терять эту сессию если отказ уже есть я ее уже потерял если вы ее уже потерял если вы если вы при этом пользователя если у вас нету скажем так процедуры перемещения сессий с одного дата-центра на другой дата-центр я один с может быть таким же решением как routing по айпи адресу это сравнимо и решение на мой взгляд ну и автономку хотел бы своего собственного опыта добавить не знаешь все сталкивались ли нет крупные провайдеры очень и не любит анонсировать маленькие автономки поэтому маленькой автономка это путь в никуда что есть маленькая автономка вашим вашем понятии ну скажем так я сталкивался что 128 мудрецов уже могут не анонсировал ну такие автономки практически не продаются ну то есть обычная ном к когда мы говорим про автономку про несколько локаций мы не можем анонсировать на локацию меньше чем слэш 24 до получать что ну стандартная условную мы берем автономки там слышь 22 хотя бы просто бывает люди горю виде слова автономка покупают минимальное возможно и получаются хочу собственную автономку класс спасибо вот здесь двое а там тоже до нам тут фонари светят очень хорошо девушки с микро в девушке молодцы микрофон так вот у нас есть уже вопрос да матче галёрка добрый день спасибо за доклад николая колосов сбербанка market бывший goods . у меня вопрос насчет я распределенных транзакций sale in south судя потому что вы рассказали я понял что вы разделили баланс клиента на количество дата-центров то есть там три дата-центра 3 баланса меня вопрос такой а что делать клиенту если он хочет узнать вот свой баланс в реальном времени с учетом тех транзакций которые проходят если насылают спасибо скажите мне пожалуйста хоть одну распределенную финансовую систему которая готова дать из села хотя бы четыре девятки на то что она покажет гарантированно правильный баланс клиента с учетом проходящих транзакций я не знаю таких систем то есть условно что делаем мы если мы говорим про отображения баланс и они про проведения транзакций то есть показать клиенту баланс мы показываем сумму балансов с того дата-центра куда пришел запрос она может поменяться через буквально доли секунды потому что данные там не знаю доезжают то есть транзакция прошла клиент еще видит старый баланс но через долю секунды он уже обновиться обычно я не встречал кейсов когда для клиента отображения баланса в моменте настолько важно что вот транзакция прошла и через сотые доли секунды он хочет увидеть обновление баланса ему нормально если этот баланс обновится через секунду в парадигме венчал консистенции когда все работает если у нас не произошел отказ дата-центра если у нас нет нарушения сетевой связанности то изменения баланса по факту происходит почти мгновенно я ответил на ваш вопрос спасибо вот пожалуйста здравствуйте спасибо большое за доклад был очень познавать наличие найденов компании atlas скажите пожалуйста каким образом вы проводите тестирование проводить или и учение в случае падения одного из узлов я распределенной системы как это происходит учение мы проводим в бою потому что как показывает практика у нас наверное не проходит месяца чтобы кто-то из операторов не отказал или не приехал экскаватор наказание который перегрызть сразу оба ввода кабеля в один дата-центр который должны лежать по разным сторонам на по совершенной случайности лежат в одной и той же трубе она происходит как бы само собой нескольким случаям некотором роде но по-настоящему у нас кроме этого есть внутренние регламенты которые говорят о том что если у нас ничего не произошло и мы что-то начали скучать там и минимум раз в месяц должны эмулировать вывод выход из строя одного из дата-центр соответственно мы теми или иными путями либо гасим со канал из нового канала связи либо мы гасим гипервизор и внутри дата центра ну то есть прямо по питанию берем и дергаем и смотрим что происходит ясно спасибо и еще один маленький вопрос извините пожалуйста если это некоммерческий там тайна расскажите пожалуйста какой силой вы обещаете по доступности вашим клиентам мы публично говорим про то что масса целей четыре девятки это публичная открытая информация если мы говорим про договорное силуэт вопрос скан каждого конкретного контракт на публичной силой который мы говорим и которые мы раскрываем мы рассказываем про каждый случай который у нас происходит сбоя это четыре девятки на данный момент вот например у нас с начала года 99 , 996 спасибо вот оттуда вопрос можно фонарь рукой за закрытие видно будет тогда пожалуйста спасибо за доклад меня три маленьких вопроса первый что вы делаете с этими привязанными к дата центру при проблемах на оном то есть дата центр пропал сессии привязаны по клиенту и проекту ну по вашей паре скажем вашим хожу что делается с этим у нас есть внутренняя система это первичная система первичный слой обработки которая понимает что у нас дата-центр вышел из строя соответственно у нас есть базовая карта распределения которые говорят что он сейчас в проект а идет направо проект бы идет налево но в том случае если налево или направо у нас это путь который не работает у нас происходит при распределении трафика в соответствии с резервными картами понял второй вопрос вы как тори балансируете баланс и поровну между тремя до центрами дабы нивелировать такой момент например опять же был дата-центр на котором были какие то там какая-то часть баланса он пропал и вдруг стало надо сделать много паутов и денег на 2 из 3 не хватает занять бы еще 3 дом в дауне что делаете вот на чтобы этого избежать и может быть перри балансируете как-то смотрите да у нас есть процедуры перебалансировки которые мы ни разу не запускали я честно признаюсь а то есть у нас мы у нас есть drp которая описывает соответственно этот случай про который вы рассказываете но реальной жизни показывает так что дата-центр если выходит из строя то на незначительное время то есть это максимум часы и за эти часы баланс не успевает полностью уйти в ноль на тех дата-центрах где соответственно происходит списание ну и плюс обычно обычно наши клиенты стандартно вообще в принципе для большинства клиентов стандартной стандартная карта трафика это много оплат и мало выплат поэтому обычно не происходит в ситуации когда нам надо резко взять и выплатить столько сколько нет на балансе это единичные ситуации которые обычно происходит опять же в то время когда у нас дата центр работает все до центра работают при этом в дырку такой ситуации есть честно сказать мы ее ни разу и не проверяли"
}