{
  "video_id": "KPl6quKgffo",
  "channel": "HighLoadChannel",
  "title": "Кошелек с нуля в 2020 году: технологии, вызовы, решения / Филипп Дельгядо (OpenWay Group)",
  "views": 8015,
  "duration": 2872,
  "published": "2021-10-04T02:47:02-07:00",
  "text": "привет меня зовут филип дельгадо я уже который год делаю цифровые кошельки и мне это наконец надоело поэтому когда мне предложили сделать кошелек как продукт я наконец согласился вообще сначала хотел вам здесь сказать как вообще делать современный кошелек на современных технологиях подходах там без реляционных баз данных и так далее потом понял что позволит никому не интересно я скорее буду рассказывать про то как можно думать про архитектуру сложных систем собственно и все это делаю компанию по новой мировой лидер в карточном процессинге вообще в процессинге леди рынка по оценке всех кого только можно там 24 офиса по разным странам 77 100 нами работают решения мы почти как драться каждого карточка чего-то раскачивайтесь в россии скорее всего используются решение об нвф процессинге этого пути жаль но карточки потихонечку сменяются во всем мире другими решениями и собственно возник вопрос необходимость делать кроме карточных процессинговых и процессе кошельков и что такое вообще цифровой кошелёк вот у нас есть какая-то finder компания который есть где то там далеко далеко человечек и где то есть куча каких-то внутренних сервисов там банковская система в crm выпуск карточек эквайринг коммуникаций спас там с какими центробанком коммуникации с платежными системами и люди отдельно регулировка все остальное отдельно и между ними как раз аккуратненько вписывается кошелькова и решение которое добавляет немножко больше человеколюбие вот весь этот тяжелый фильм тех позволяет людям решать собственные проблемы то есть фактически в кошелек это то где вы храните мы тоже самых что своей бумажном кошельке там карточки деньги и фотографии детей в общем все что вас туда помещается там обычно хранится в кошельки обычно не хранятся реальные деньги это как раздела там обрезки внутреннего процессинга но все остальное в кому нужны кошельке но чаще всего банком то есть у банка есть свои там расчетные счета есть карточки но ему нужен какой-нибудь интернет-представительство мобильной какой-нибудь из кошелек удобно людей автоматически нам onboard чтобы не нужно было как-то это дело операторов и прочее прочее прочее нужен национальным платежным системам которые не хотят платить свой процент международным нам визе mastercard и хотят разворачиваться и собственно систему типа как сбп вот нужен крупным торговым сетям потому что они хотят лояльных пользователей чтобы те там не знаю расплачиваться каком-нибудь абстрактном машине абсолютно самостоятельно без участия в таких больших платежных систем ну и всяким системам расчетов боли мне закрытого типа paypal yoon do you money webmoney и так далее вот вообще разница для пользователя ходить между банком и кошельком сейчас потихонечку размывается они все начинают выглядеть очень похоже если там лет 5 назад яндекс деньги это было одно а какой-нибудь сбербанк было совсем другое сейчас в общем то это примерно про одно и тоже какие у нас но мы делаем как продукт и клиент у нас мягко говоря разное во-первых бывают большие клиенту которых сотни миллионов клиента пользователей у них там 5000 пути же в секунду или больше хотят бывают маленький которых там но может быть будет миллион пользователей ну может быть они выйдут на 50 party же секунду бывают богатые которые готовы купить все что угодно со всей поддержкой еще хочется и будет бедный у которых нет денег даже нормального детей бывают клиенты из европы где же теперь где очень много регуляции где каждый шаг прописаны требует высокого там соответствии законом бывают третий миф где законы пишутся иногда под этого конкретного кошелек вот ну на ходу и бывает старые клиенты старые банки у которых свой сложившийся инфраструктура там много dc к счастью уже на не надо рассчитывать на то что у них будет стоит стоять-то какой-нибудь странный старый unix и хотя бы linux у них у всех стоит и новые которые даже не думали о том что нужно инфраструктура вот ну не в курсе поэтому нужна дешевая масштабируемая неприхотливое кастомизируемый решение вот реализовывать это всё как внутренний стартап маленькой компанией там вот на спам никогда не был больше чем 10 человек включая аналитиков менеджеров тестов и так далее вот зато у нас был доступ специалистом в компании с огромным личным опытом о том какие бывают клиенты какие будут кошельки какие бывают сложности и некоторые свободы выбора как технологии так и бизнес-процессов собственно теперь буду рассказывать почти cтул как бы все это делали поскольку в общем сделать в 10 метан моя карма делать тупиц этим с каким сложные финансовые техасские решения которые год этим занимаюсь поэтому там очень много практик turn есть прекрасная цитата альфа джонсона и и мартин фаулер цитирует у себя на сайте что архитектура это про все важное вот это про важно чтобы от он не было это прекрасное определение но она совершенно практически не приемлемо и поэтому пытаемся сделать давать им немножко большой практики что-то по архитектура архитектура в первую очередь это по выбор мы выбираем из нескольких вариантов которые делаем мы выбираемся которые не делаем мы принимаем решение что мы хотим выбрать сейчас а что мы хотим выбрать потом но такое самое любимое решение которое обычно возникает у тех of scam проекте в самом начале какую базу данных использовать ну сразу напомню что баз данных у нас бывает два принципиальных типа есть те которые про то как быстренько обработать платеж и надежно сохранить по нему всю информацию и ту который пользуется аналитики то есть о типе миф и all at me два разных мира они требуют разных решений о типе для начала случае нужна надежность ну понятно пенсиях надежность 1 сразу сплачивает насколько у вас все хорошо масштабируемость пушта одно дело это какой-нибудь бедный клиенту которого там миллион пользователей новые дела богатый клиент у которого 100 миллионов пользовались 5000 к тебе в секунды нужно как-то решать проблемы и того и другого бесплатно спорт опять-таки не все готовы платить там не знаю enterprise нового курса всеми его опциями на большое количество серверов простота эксплуатации по что опять-таки клиенты разные ну и наличие поддержки около дороговат postgres почему-то банки не очень любят вот непонятно его наверное сложно баба масштабировать на очень большие нагрузки но реально многие клиенты не любят позгалев про манга лучше даже помолчать потому что все никак не могут ей простить то чтобы у до версии 2.7 и до версии 3 поэтому фразам мангой банк лучше даже не произносить мы долго искали и нашли странное решение фонда хинди бит кто вообще слышал про базу фонда хинди be neat меня счет такое это кивали база данных open source сейчас она была куплена apple и вернули обратно во пан sex web ли очень много на нее крутится там 10 тысяч серверов там миллионы транзакций в секунду они не прокручивают то есть много используется в некоторых крупных компаниях вам snow flake тоже ее активно использует она просто в развертывании очень простая в сопровождении быстро и надежно и кто знает кто такой offer of the jackson тесты как только джексон тесты окей как-то мало в общем есть стандартные тесты на надежность распределенных систем джексон тест написано человеком с ником offer который свое время когда вы спросили почему ты не протестируй fondation тебе написал следующее что я бы протестировал на их внутренние тесты гораздо более выпендрёжный нефилима и вот это наверное лучше рекламы этой базы данных конечно джексон тесто тоже по гонялись команды фонда хинди мы конечно тоже и протестировали ну она действительно надежно работает насколько вообще можно работать и сети база в распределенной системе то есть она вот работает но при этом конечно хожу мы взяли надежное решение масштабируемое решение лев и легкой в поддержке но не может быть совсем без сложности и сложности разумеется много уходишь на тебе нет то платной поддержки то есть ты не можешь пойти какой небольшому богатый модель искать возьми деньги поддерживаю за меня у неё очень низкоуровневой и довольно сложная 5 и такие вылью база данных который работы в категориях взять байтики в качестве ключей положи туда еще ботинки в качестве значения все вот у нее нету никаких и правда ограничить по правам доступа нога польские система и у нее довольно слабо инструментарий платный поддержку мы построим при этом самостоятельно мы на вырастили специалистов наладили контакт разработчики научились делать такие pr и которые принимают его концов комьюнити vdb разбираемся в и коде поэтому мы можем спокойно ее сопровождать мы написали свою библиотеку с поддержкой асинхронного доступа с типизации сериализации всего потому что ты компактный чем у джейсона быстрее с поддержка housekeeping housekeeping это одна из самых важных на самый штук для больших финансовых систем что когда ваше количество транзакций приходится несколько терабайт вам очень хочется куда-нибудь отложить в нормальных кивали системах это не очень простая задача пришлось сделать некоторые маги вокруг ключей надеюсь у нас будет потом отдельный хардкорный так вот про то как готовить кендо the bass не сейчас не здесь может быть другом hail audi осени может быть как-нибудь вообще отдельно но очень хочется рассказать там еще много интересной магия добавили криптографию управление ключами это самый надежный способ ограничения доступа тут вообще уже никак ничего не подобраться но начали писать собственный инструментарий свой движок миграции который сильно более наворочен чем флаере то есть позволяет делать параллельно иммиграции сверх долгосрочной миграции асинхронной миграции и прочее прочее прочее итак для у тебя мы выбрали воды хэнди бен что же взять для авапа на самую вот если для faulty пищу какие то есть вариантов много чего можно было бы взять для oppo в общем сейчас вариант ровно 1 вот большое спасибо товарищ его виду ну потому что верьте к нам не подходит потому что долго . вот клика usb решает наша задача почти все разумеется это не все выборы которые мы сделали есть и другие важные выбор которые приходится принимать писать все на одном языке или писатель на разных языках писать на код нанести ущерб или джаве использовать флотах для react на этих какой вариант коммуникации брать и оставил 1 и 1 level 2 герпесе вообще знает родиться их даже ставил один раз level 2 прекрасно вот level 1 это про когда мы все , только постом и джейсоне a level 2 это то что в обычно считаете 1 том вот со всеми этими сложностями выбор были сделаны у нас маленькая команда давайте возьмем один язык потому что так будет проще мы берем котлин потому что у нас есть какая-то компетенция в компании про java она caitlyn проще находить разработчиков и к рутины очень сильно облегчает жизнь честно выбирал котлин радик аутен мы берем флаттер потому что это поинтереснее его перспективнее как нам кажется чем react на этих и мы берем лист 1 потому что раз-два и финн тех очень плохо совместим потому что постоянно то на летаешь на сложные транзакции но теперь на невозможность придавать там поиск по номеру телефона в get запросе и в общем много геморроя в этом проще взять и распаде мы пошли дальше дальше наши текстура можно смотреть как на язык язык и там вы описываете вашу систему потому названы таких языков накопилось войти довольно много лучший пример наверно design patterns ты можешь любому разработчику в мире сказать я хочу чтобы здесь бусин goalton здесь была стратегия он тебя поймет и сделает но к сожалению для архитектуры в общем таких языков мало один архетип че дает какой-то набор слов но очень нечеткий словами красивый со вообще потеряла какой бы-то ни было смысла фразы нами красивая не значит уже нечего поэтому мы взяли нашу все картиночку с кучей наших сервисов нас для маленького проекта сервисов много вот и подумали что надо их как-нибудь обозначить как нибудь не пытаться как-то раз думать а как для данного сервиса будет кастомизировать а какой авторизацию нужно здесь а как оно все будет описываться и свели все это множество к 5 простым типом то есть есть bff не обидит его именно bff кто не знает что такое bff окей это паттерн backend во front-end это когда вы для каждого воевал своего клиента делаете отдельные сервис который скрывается в общности от того что находится за ним то есть умеет собирать с разных сервисов данные параллельно как-то их преобразовывать и отдавать в том удобном виде с теми правами по проверкам прав доступа и так далее которые нужны конкретному клиенту там вы кофе сумма девочки порталу выпуском и так далее дальше пузо bff он у нас находится сервиса бизнеса логике которые занимаются только бизнес логикой ниже сервиса домены и которые хранят информацию по доменам и сбоку всякие агрегаторы при этом по этой схеме любая коммуникации может быть только сверху вниз вот ну и вообще говорить центр наружи кроме редких исключений шлюзов к платежных которые могут ходить немножко вглубь смогут ходить бизнес логики могут ходить доменным образом то есть когда вас такая картинка появляется вам сразу гораздо проще обсуждать вашу структуру обсуждать конкретный сервис просить написать новый сервис чтобы мне нужен еще один bf ok разработчики берет копировать существующей bff выкидывают лишь не пишет можно гораздо можно думать в одном языке про тестирование по авторизацию по кастомизации мы еще котэ картинки бы возвращаться дальше самый интересный конечно важно ну все программирование такое управление сложностью и архитектура тоже про управление сочностью когда вас маленькая команда когда вам нужно довольно быстро что-то делать сложно становится вашим самым главным врагом с которым приходится бороться какие самые интересные сложности с моей точки зрения физики бизнес сценарий а вот у нас есть on boarding он будет это пришел новый пользователь и хочет зарегистрироваться в системе его нужно зарегистрировать там его кредо ничего там системе управления и дентина его персональные данные системе хранения персональных данных ему надо создать счет в блеске нужно проверить в какой-нибудь государственной структуре а правильно ли у него паспорта вообще можно ли с ним работать или он не дай бог террорист в общем очень много спать систем очень много шагов все их нужно сделать всех нужно сделать надежно если где-то кто-то нам что-нибудь упала надо подумать что с этим делать платеж такая сложная система платеж сейчас это уже не просто взять и перевести денег с карточки там не знаю магазину это надо у тебя может быть одна карточка то другого банка дальше ты с нее должен снять деньги перья привет проверить снять нужной комиссии перевести остатки денег на paypal какие-то комиссии скинуть например на благотворительность сейчас процедур путь уже становится все более и более сложная потому что все больше интересного пользователь хочет от своего кошелька поэтому там тоже много шагов много под систем блокировки кивать и менеджмент все это требует довольно сложных распределенных бизнес-процессов который нужно делать быстро потому что их много и максимально надежно потому что это фен тех и пользователь не поймет если его деньги где-то застряли то есть вот платеж не пойдет чем вообще неизвестно что с этим происходит как обычно решаются такие такие задачи кто знает о вас ага вот на самом деле слово согрета примерно как микро сервиса на престол значит чтобы это не было вот но есть некоторые более менее нормально и определение и о есть оригинальная статья 86 прости господи года и собственно peace ивается что такое сага изначально понимание когда берем бизнес-процесс взбиваем его на куче шагов для каждого шага проектируем компенсацию то есть обратную операцию фиксируем список выполненных шагов и случае ошибки мы просто аккуратненько откатаем их получите там с конца в начало это очень популярное решение то есть каждый раз когда ты по это начинает говорить карту 8 саги вот примерно вот если на устах есть много проблем первое обычно нужно отменять не вини отменить процесс отдать его другим способом мне скорей нужны чтобы мы плачешь все-таки завершился может быть там если упал сбербанк сделать это через альфа-банк но как-нибудь пожалуйста завершить эмали оплата мобильного телефона потому что у меня вот позвонить надо компенсация не всегда возможно и да сейчас многие компании финте he знают что такое да патент ность знают что там любая транзакция должна быть двухфазной но очень много до сих пор банков предоставляют только однофазный интерфейс это заплатил и дальше она с этим что-то произошло и ты не знаешь она прошу или не прошел и как это конвертировать непонятно по интеграцию с госорганами в разных странах мира которые не такие развиты как наша я очень вообще промолчу компенсация часто нужна не для конкретная операция для процесса вообще потому что например один из вариантов компенсации то есть реакции проявленная ошибка это просто послать сообщение оператору тут фигня разберись руками пожалуйста для маленьких компаний это гораздо проще нежели выстраивает сложный процесс обратных проводок транзакции прочего оператор справится лучше ну и бизнес транзакция обычно есть довольно сложный бюджет транзакции то есть сколько времени можно не потратить сколько параллельных запросов каком-нибудь опять-таки внешнему сервисы можно в ее рамках сделать как только мы делаем компенсацию внутри конкретного flash ага мы сразу теряем это представление бюджете ну и на самом деле саги довольно сложным охоту приводят то есть я знаю очень многие любят вообще делать шаги через хореографию нам этот лучший способ сделать категорически не читаемый код уже буквально через полгода в котором не разберется никто но даже саги с регистрации выглядит довольно печальненько то есть там нужно думать о том какие события формирую что должны зарегистрировать каком-то обработчики обратной шаги и сам код операции становится расплывчатой и в общем то кроме как программисты никто не в состоянии его нормально читать я вообще давно мячу мучаюсь разными вопросами как именно делать сложные бизнес транзакции то есть где-то года два-три назад рассказывал по персистенции акторы как прекрасно решение этой ситуации но я наткнулся на паттерн warhol собственно наткнулся в описании не скинули ссылочку на описание системы каденс от опера в котором он реализован то есть это очень похожи по идее на сагу берем процесс как некоторый императивный простой код в достаточно тоже из кусочка шагов при выполнении каждого шага сохраняем его результат куда-нибудь persistent если счетом какая-то проблема пытаемся его как-нибудь повторить дожать до конца если у нас упал сервер выполняющий бизнес-процесс берем на долгом севере начинаем все вообще сначала но поскольку нас шаги сохраненные вы подкладываем их результаты чтобы лишний раз не на вид нагрузка не увеличивать а если вас произошла какая-то сын искусственные ситуации выдвинет тоже пишем workflow со стоящей за тех же самых шагов war for позволяет описывать бизнес процесс максимально понятным для потребителя для аналитика образом вот я вообще люблю простой тупой последовательный код без каких-либо сложностей пошли когда у тебя такой код используется твой системе ты легко можешь найти разработчика ты легко муж его протестировать и даже если это легко может учить его поправить можно вообще показать не знаю бизнеса на специалистам скажет да все нормально или нет у вас тут не совсем все корректно у каденс кстати есть open source на я версия там они люди которые делали каденс в убере организовали собственный стартап чик вот к сожалению но она не очень подходила потому что она довольно сложные в реализации поэтому мы написали свой велосипед библиотечка в честь великого композитора гайдна как создатели симфонической музыки оркестрация эта библиотека они сервис то есть мы подключаем в нужные сервисы где нам хочется делать сложный бизнес транзакции с максимально удобным д с элем dsm для нас это основной фокус в библиотеке то есть разработчики которые пишут конкретный сценарий пьесы в данном случае в рамках нога и дни постоянно нам дает обратно если мы стараемся модифицировать наш еще не так что было максимально удобно писать ну из поддержка примерно там сто тысяч одновременных сценариев примерно 20 тысяч шагов в секунду блогов он дышит тебе все это позволяет сделать и любовно все fondation биби и котлин котлин дает картины и удобный dois альфу дыши тебе дает масштабируемый pig systems как это выглядит вот очень простой как только пользоваться все-таки здесь ладно по видимо тут не работают указатель буду словами вот очень плотники сценариям вардинга то есть у нас набор для homo на вход берем некий набор данных начинаем пьесу сначала мы получаем там кот следующего пользователя создаем пользователь в рамках шага и потом возвращаем его код обратно если что-то произошло не то в случае ошибки мы сначала если пользоваться если был пользоваться удаляем его если был создан единстве удалим все очень просто вот здесь есть одна интересная штука а именно по идее фрагов ну и вообще говоря таких странах как дышат должен быть по идее и на потенцию так ли это на самом нет изначально до патент ность это свойство операции при повторном применении давать тот же лес так что и при первом на самом деле это избыточное свойства наставлю почти всегда достаточно чтобы при повторном применении операции было не очень не дело чего-нибудь плохого например взять следующий номер из последовательности это не еда патент на операция на безопасное и вот все шаги warhol должны быть повторяем и но не обязательно до патенты это сильно упрощает разработка потому что делать честно да патента довольно сложно делать повторяемость на порядок проще почти любой транзакцию можно любое создание сущности можно разбить на два сначала получить уникальный ключ а потом создать самую операцию это будет повторяем а не допотопным в рамках нашего пол гарантированно надежным на самом кроме то есть много других возможностей можно создать сделать до потребность для всей пьесы вот когда мы там указом уникальные ключ говорим что вот все сценарии которые будут этим уникальным ключом на 41 если пришел еще раз попытка его вызвать - а мы не будем ничего делать скажем знаешь мужик вот сейчас вот этот сценарий в процессе выполнения либо он уже был выполнен вот тебе его результат вот пока мы не делали асинхронные сообщение факт изменение стонали по что пока не нужно но прикрутить недолго можно указывать максимальное время исполнения сценарий после которого произойдет ангера и мы можем как-то его обработать это просто переменная который уже любой момент менять добавлять 10 секунд удалять 10 секунд как хотим вот можно указывать политику выполнения конкретных запросов например здесь указано что обращение к сервису проверки паспортных данных нельзя делать больше чем 10 раз в секунду на весь вовке потому что иначе смыв например не справится вот ну собственно можно выполнить сценарий как асинхронно так и дожидаться его результаты то есть говорится sing a weight это и можно подождать сигнал то есть подождать ответ от какого-то синхрон от какого-то внешнего сервисы что-то сделать почему когда мы ждем сигнал у нас вся пьеса выгружается из памяти не занимают никаких ресурсов всегда придет мы загрузим и продолжить выполнение сложного шага получается простой императивный код вся сложная sync раньше на откаты взаимодействие спрятаны какие еще всякие вещи о себе сделали веками заморозку можно спокойно сказать там делай на один месяц через месяц нарева становится когда пройдет вместе что-нибудь сделает там не знаю комиссии посчитает или отчет человека отправит легко реализовано все возможности риса эванса то есть только брокер лимиты там довольно большое количество функций библиотеки все мы поддерживаем мягко выставление при сбоях но вот была у нас не знаю там тревог кира на каждом из них там была довольно большая нагрузка один из серверов ну его выключили для того чтобы не знаю поменять версию когда мы его включили заново или сразу после выключения на оставшиеся два начинают поднимать со сценария который нужно поднять и при этом часто возникают ситуации что там сразу лавинообразно возрастает нагрузка все падает поэтому специально сделано что при сбоях при подъеме нового сервиса он не все нужные ему сценарии начинают выполнять а потихонечку чтобы не убить всю систему после лавинообразно восстановлением сложно обработка ошибок интеграция x кто там кто за что такое кто а к кто это в блок на код ли не который изо всех сил поддерживает его внутренние возможности делаем чуть бойцам и поддерживать этот бренд сама конструкция позволяет делать довольно простой веб-сервис весьма производительный и главное что он можно про многие вещи просто не думать они просто работают вот у нас он используется как стандарты наш сервис место спринга вместо каких-то сложных микро сервисами крафтов очень довольна кстати вот но метрики vogue рования как я уже показывал раньше вот у нас есть отчет как времени осталось именно нигде нету вот у нас есть очередь то есть у нас есть wi-fi сигнал в этом сигна предполагать что у нас есть какая-то очередь событий а без водителей сдан мы система производительность у нас примерно получается две тысячи шагов в секунду на один экземпляр базы данных но экземпляр смысле это вот можно поднимать много экземпляров на одном сервере это где вот когда вас 4000 iops of 1 ядро четыре байта памяти выдает 2000-х go в секунду если нам нужно 20 шагов поставим 10 таких нужно 50 тыс поставим 25 потому что он примерно горизонтальное масштабирование на самом деле fdb не самым оптимальным образом использует диск на выгоднее persistent своей очень сильно отделён от все остальные логике можно взять поставить какой-нибудь по отгрыз но окоянный машинки если вдруг будет нужно там получить там 15000 с одного сервера мощно наверно так на самом для для очередей есть много использований есть сигналы для warhol есть события отправляем их на клиент потому что очень хочется чтобы клиент получал информацию о том о том что у него платеж например произошел вот есть внутренние события там отправки sms зачету по расписанию есть пост вообще куча пользовательских задач таких учредить довольно много нужно в системе и до них есть специфические требования таки хочу не хочется много по 1 учиться на каждого пользователя по одной очереди на каждое событие которое на каждый платеж который ещё не завершён а таких может быть очень много одновременно потому что путь их иногда бывают по несколько недель был не могут завершиться если например это вывод на банковский счет при этом каждая очередь довольно маленькая ну в среднем в ней 0 событий обычно иногда одно редко редко бывает там 10100 ну максимум 1000 вот таких при этом событий в секунду всего в сумму у нас много и хочется иметь от лист vans exactly vans нафиг не надо вот от лист вам хочется беда в том что эти вроде бы простые требования из коробки никто не может реализовать у кафки до недавнего времени было вообще жесткое ограничение на количество партийцы то есть почти количество независимых от людей для которых сохраняется требования фифа в 200000 сейчас его сняли на все равно там миллион партийцев кафки не стоит делать это можно но будет очень тяжко можно делать на каком-нибудь подгрести где конечно нормально сделать хоть десять миллионов очередей я сам по моему два года назад рассказывал как но получить десять тысяч событий в секунду в нем уже будет сложно не к можно но это требует довольно слов effective тебе хороший сервер хорошей оптимизации не просто на репите большинства тысяч людей тоже делать не рекомендуется поэтому что мы сделали правильно написали свой велосипед вот совершенства двух частей фонда эффенди бен халид сами очереди то есть и запись в эта запись храниться все события связаны с этой очереди но если там в одну запись не влезли в тебе жесткий лимит на размер одной записи вот тогда мы используем несколько мы к этому придем стандартных housekeeping которые у нас есть кафка используется для 1 деление информации о том что у нас в какой-то очень для появилась новые события по всему вовке нам то есть эти маркеры подписаны на кафку читаются вообще не сказки идут в bebe забирает все очередь выполняю там 1 2 или 3 сколько там события накопилось которые еще они не обработали как-то изменяют очередь записывают обратно при этом если у нас не знаем и там добавили сообщение в кафку а при этом у нас отвалилась база данных но лишний раз почитают событие защитили вас нет что вам события никакой обрабатывать не надо пойдут дальше вот получается довольно производить достаточно надежно ну и наши производительные требует производительность вполне выполняет 1 кафки недостаточно на 1 фут эффенди by такое можно сделать но не очень хочется что пятки будет довольно срочно хотя на замле web ли у них там миллионы событий в секунду на чистым на в тебе живут на у них там тысячи кластеров и в тебе что в общем то же мы наверное себя не хотим делать дальше пойдем архитектура это кроме все почву множество viewpoint мы что точек зрения на вашу систему анимации нот вот наша картиночка на эту картиночку можно смотреть очень разных точек зрения например можно смотреть по конфигурация кастомизация у нас много разных клиентов у всех клиентов разумеется свое представление о том как должна работать платежной системы как должен работать кошелек и поэтому нам приходится используется много разных стратегии подготовки нашего решения под клиента можно просто делать форекс конфигурации где там не знаю написано сколько знака мест в банковском счете в к данной конкретной стране иногда мы должны сказать что типа вот этот метод наверно у нас будет по разному то есть метод блокировки пользователи у каждого клиента выглядеть вершенно по-разному у нас есть . расширения метод блокировки пользоваться где указано как он работает и на должны вообще . добавление новой функциональности в этом месте вообще клиент хочет какой-то свою собственную специфическую запрос от нас которым мы должны только под него реализовать больше никому не нужен но иногда надо поставить приписать весь код кастомизация какой сервиса сделать просто новые копия true сервиса под конкретного клиента вот при этом каждый раз думать каким именно конкретным способом для конкретного сервиса мы хотим обеспечивать потребности клиента это избыточно требует слишком много напряжение ума чем меньше напряжение ума в процессе разработки тем быстрее разработка идет тем меньше сложности поэтому можем посмотреть на все одно еще один вариант которые вы придумали это кот линда с целью подлинный язык на котором можно писать удобные ds или от живым позволяет взять код на код не из текста файлика во время исполнения скомпилировать использовать капли рваный код прямо во время работы и мы этим очень активно пользуемся чтобы получается быстро надежно типе зова на эффективно и дальше мы да собственно как от ндс и что до кликать вот под каждый к криту зачитывается свой собственный как бы маленький датчик во сколько просто храниться все в общем сервисе конфигурации компилируются представьте мы делаем какие-то инструментарий чтобы это было удобно пользоваться там и дае настроенную для тех кто это делает это делать не только программисты на и сотрудники до внедрения и даже клиенты могут это делать пока еще не делают но будут там скрипты сборки чтобы все это проверить подловить сразу в конфиг тировать дальше чтобы она работала на нем сделано много прекрасная задача описание процесса платежа на заливаю описание платежа платеж вот когда вы видите я заплатил там столько то рублей за paypal асаны вокруг за этой простой строчкой есть очень много магии потому что для вас два пути жалобно сам ли важно узнать разное то есть когда вы например снимаете с какой-то карточки на свой основной счет для вас главное что вы сняли деньги с этой карточке а если остались внешние карточки деньги и заплатили этим за телефон вам можно за что вы заплатили за телефон ассалям маги гораздо больше она очень специфично под каждого конкретного клиента тем более что клиент есть очень разность очень разным ограничениями и очень разные готовкой и например у некоторых странах имя пользователя в общении телефон пульс для нельзя описать нигде визуальных частях вот просто запрещено вот поэтому приходится делать очень специфический код который нокаута не пишите в пять строчек это гораздо лучше чем 25 страниц настроек всякие специфические сценарий тоже легко делаю так от ндс или там блокировку изменение документов для киева see the man boarding ну и павелко прав доступа тоже легко реализуется атрибут basic но поэта чуть попозже будем собственно дальше мы берем и говорим что вот у нас разные наши сервисы типа сервисов по разному кастомизируют прописывает какой из них как можете кастомизировать под не полная картинка там реально тех буковых и сокращение гораздо больше и по как детей 8 четко говорю что вот это описывается только конфигурации на преодолены я бы домены и сервиса меняются только через конфигурации больше никак а вот сценарные можно менять разнообразными способами потому что там гораздо больше нужно гибкости есть много других ли понтов можно посмотреть на систему 104 прав доступа авторизация то дефекации с точки не связанности безопасности доступности и интернационализации что для нас тема очень актуальна и очень очевидно обеспечение качества все это рассказывать не буду это можно только в этом утонуть на часа на два на три но расскажу немножко по авторизация аутентификацию у нас радостная задача у нас довольно много внешних пользователей у нас довольно много внутренних пользователя причем мы не знаем инфраструктур где эти внутренние пользовали живут у них может быть active directory может быть какой-нибудь density провайдер не известно вот при этом есть разные механизма подтверждения операции то есть кому то нужны какие-то платежные операции по творится с маской где-то через google hi-fi кейт а где-то через платежный пароль это точная важная часть аутентификации по которой очень авторизации запросов по которой почти все стандартные механизмы аутентификации забывают авторизации котейки confirmation мы разные модели доступ где-то ролевая где-то рода приз атрибуты где-то еще какая-то бродяга поэтому взять какой-нибудь как лоб развернуть его сказать вот все хорошо не получится поэтому пришлось писать собственный сервис ямсом почему удалось сделать модель в которой и я из ям это собственно и dance team management всем это can seem родить и менеджмент то есть для конечных пользователей у нас общее решение который поддержит много разных сценах аутентификации которыми можно подключать где-нибудь внешней я вам типа active directory того же кейк локеры вокального еще чего-нибудь котором можно настраивать ролевую модель через конфигурационные файлы и при необходимости атрибут bass через код ndsl то есть можно честно кто что если нас пользоваться там не знаю пришел запрос торговцу которого такой-то статус и название начинается с буквы бету тогда ему нечего давать нельзя 2 прекрасная задача и необходимость посмотреть на систему с этой точки зрения это про связность сервисов опять-таки у нас неизвестно чужие инфраструктура где может быть будут докеры но нет где точно не будет каберне this а вот почти точно где к счастью наверное можно рассчитывать что будет хотя бы linux какой то не знаю какой вот при этом нужно уметь там разворачиваться нужно все наши многоярусный структуру там как-то поддерживать реализовывать доступность вырисовывать balancing и живёте ли централизовано всем этим управлять опять-таки готовых решений под это дело нету то есть прекрасное стелла почти все что хорошее оно работает только под губер найти сам а все что работает не только с губернатором не очень хорошие что мы сделали сделали свой велосипед свой сервис мышь который реализует service locator балансировку heart beat скрипнула и так далее написано нэнси дает 13 тысяч запросов на ядро и до девушку где-то вот пример наполнились юмико суммарную задержку где то пол микросекунды реально именно его собственная задержка четверть микросекунды для наших целей абсолютно достаточно мы его при необходимости дописываем писал свою недолго вот и в качестве стоит кара напади для большого количества наших сервисов абсолютно нас устраивает по почему поинты бы поговорим попозже и того наши структур вот основные архитектурные заметные важные части мы используем язык котлин и базу данных удачи тебе еще сбоку crack house мы используем мы используем этот апекс 9 пи мы описываем не нас лагеря на плотине потому что это более удобно язык для описания api а из него уже делаем swagger у нас собственного fountain собственно сервис маешь мы активно используем котлин dsl но ему-то что библиотеки сервисом это максимально важный что можно сказать по решение которое позволило сделать довольно сложную кошлякова решения и внедрить его нескольким клиентам командой не более чем в десять человек примерно за два года момента начала разработки эта картинка профессионально технология почти все вот я ничего не говорю про клиенты где у нас используется плату что тоже не стандартно вот react но это можно отдельно в кланах выводы архитектуры это вообще говоря не по картинке архитектуры это про то самое важное самое важное что вы хотите сказать по систему что то какие то варианты думать почесть которую я успел записать какие-то остались на будущее потому что описывать все подходы карте которые можно бесконечно вопросы спасибо филипп а потом принимайте ротик вам подойдут сейчас нашим хелперы дадут микрофончик филипп тебе от нас подарок который за срывом ференци и можно поставить с трибуной что было проще отвечать на вопрос очень я наконец увидел часы смотря вниз очень информативный доклад спасибо не знал про арест ли я владел вот открыл для себя новое и так а у кого уже есть микрофон вставайте не задавайте вопрос да привет спасибо за доклад классным понравилось мне ты очень много сказал слова велосипед до нее такой вопрос а вы не думали открывать свой веломагазин платье зал консорты что-то или правда нас появилась смотри мы час как это думаем потому что открывать свой пункт это дорого взять и выложить то что сделано просто так но это никому не нужно а если это готовить это не просто это не дешево и требует ресурсов которых нас не очень много вот мы про это подумал если будет активный интерес к этому делу наверное это подстегнёт наше решение поэтому если у вас есть интерес то вы выдвигаете его в каком-то виде там пишите мне письма там не знаю голосуйте на улицах устраивайте пикеты передача сам спасибо спасибо за замечательный доклад у меня три вопроса первый вопрос а кем должен быть хороший архитекторы диктатором или демократам до второй вопрос насколько объективно понятие хороший архитектуре может ли один хороший архитектор оценить давай по одному и вот я забуду просто первый вопрос пока ты бы говорить 3 хороший архитектор да он должен выслушивать других нести ответственность за принятые решения поэтому обычно это выслушать чужое мнение подумать над ними сказать как она будет и желательно уговорить всех остальных как почему именно он принял именно это решение и почему она будет такое потому что если он будет просто создать сверху таскались он очень быстро потеряется собственных решениях будет делать ошибки какие-то и его не будут верить если он будет постоянно слушать других то непонятно за что несет ответственность и как он будет делать выбор поэтому приходится мешать и то и другое есть такая монархия в английском стиле вот то есть ежедневную консультацию их величество королева до которая объясняет как на самом деле надо работать спасибо второй вопрос насколько объективно понятие хороший архитектурой может ли один хороший архитектора оценить хорошо архитектуру другого наружу а рассматривать я тут специальности архитектура как непрерывный процесс архитектуры это не артефакт это непрерывная происходящее прямо здесь и сейчас события почему мне не нравятся эти методы описания архитектуры они все просто теку от имеет а динамика поэтому архитектуру может быть хорошей прямо здесь сейчас она решает ваши проблемы вашими ресурсами ваш архитектура сейчас может быть ужасный для valve через пять лет потому что вы выросли изменились и что-то изменилось поэтому для меня как бы нету критерии качества архитектуры кроме соответствие вашим текущим требованиям ну или потенциальным близким требованием никак мы не знаем как поток как изменится мир вокруг вот может быть там не знаю завтра джаву закроют или патентом не знаю уйдет в какой-нибудь будут санкции накоплен и высится что вся моя архитектура абсолютно ужасно потому что я даю переделывается но сейчас наши решение она реализует и поэтому она мне лично кажется хорошей спасибо и последний вопрос не слишком ли блин много велосипедов для команды с 10 человек ну к счастью некоторые велосипеды делали ним и а соседние команды то есть на самом деле и сервисных и библиотека работа с фондом шин zebeta делают соседних командах тоже очень небольших и тоже довольно дешево и просто то есть мы взвешивали бич реального взвешивать бюджетно как де велосипед то есть у нас всегда есть выбор взять существующие внедрить там потратить ресурсы чтобы вода перед для себя либо написать свое собственное мы смотрим думаю дело пуфов концепт если все нормально оки делали свое при этом у нас еще конечно проблемы что мы свои решение ставим клиентам и например на дома находятся три потребности на внедрение в несколько раз то есть таджики clock да я верю что если бы мы сделали как только для себя выставили мы научились бы его использовать там на 50 миллионов пользователей так далее научить многих клиентов его использовать строится гораздо дороже поэтому вот это вот постоянная мысль что у нас как бы и не свое решение или коробочка которые продали забыли вот этот средний числа как бы и не очень вот и производитель не то что в абсолютных high road но и забываясь про неё нельзя вот клиентов не то что очень много но и не 1235 и поэтому нужно по этот думать это очень будоражащий на самом деле опыт я за это очень люблю текущего свои места работы что-то очень интересно это очень нестандартно приходится делать вызовы которые больше нигде не встретиться вы сказали позвольте вход link dsl для общения специфических правил для до остались подростка к обеспечивается безопасность здесь получается что произвольный код может спускаться он не то что произвольный он может заполняться в тех местах где мы можно и он работает вообще были в песочницу то есть на самом деле там dsr это не мог там платеж совершить если у тебя там была цель метод который все что умеет делать иметь доступ только к методам который форматируют там описание строки с информация платежей ничего другого сделать не может вот но сам при этом код бюро cisco фигурой фан-сервиса который защищается то есть не то чтобы кто угодно может туда что-нибудь положить совершенно нет здравствуй михаил денисов системы архитектора спасибо большое за доклад очень круто согласен совсем у меня такой вопрос вы поставляете свое решение уже сейчас там вас уже соответственно номер клиента да ну несколько несколько то есть вы уже начали какая-либо и интересного да вот так скользко сказали что типа ну вот там максимум докер мы точно не кулер у клиента да у нас как бы нас ждут еще такие же проблемы абсолютно кавказ в одно из в области нашего продукта мне вот интересно и собственно как вы осуществляете поставку это какие-то пакеты как вы их собираете не знаю кучу как вы их поставляете сами ставите ли у вас скидки не страшен скорее всего все таки она и то вы идете к ним они идут к вам вот какая то на самом деле мы ставим обычно это просто герой маска библиотека но каждый сервис это полноценный giving совсем с вами зависимости сбор очками разворачивается все танцы было по-разному то есть у нас есть свое решение которое умеет запускать тому мониторить внутренние сервиса можем использовать стандартный там систем d при необходимости можем на самолете в катыни развернуть если клиент попросят то есть это очень сильно зависит от конкретного клиента вот но базовая все таки да пока используем on seba плюс у нас будет явно свое собственное решение бум допиливать который будет уметь делать аккуратные миграции выкладку без останова совершенно автоматически потому что клиентам это тяжело вы пока вы пока что не пришли к кому-то именно покинуть и по готовому даже немного клим с мониторингом вот тоже большой вопрос не мониторинг это понятно у нас каждый сервису метод давать метрики в формате промо если клиент хочет мы ему ставим памяти с настроенными дать бардами для графа на если он этого не хочет уж например у него собственный памяти us или zabbix то он может просто стандартным способом эти метрики получать то же самое с лоббированием у нас все логе делают их что структурно можно у нас стоит вектор которых собирает отправляет и другой вектор которых галецкий house буклет мускат ребята на свою власть и зачем я буду ставить ваш клик house и забирайте целый год на стандартном виде описанным из нужно его место клиенты разные вот кто-то вообще хочет чтобы все это разворачивали там знаю в прессе и мы тоже можем взять все это развернуть в офисе по нему кто и адаптируйте подход спасибо ja потому что клиенты разные при я здесь спасибо заступление очень интересно у меня скорее вопрос про фаундейшн тебе вот это послание указал что вас gres банки не любят а когда ты приходишь и говоришь fondation т.п. они такие эти проспав заходи давай понимаете фон дольше мы говорим что с воды сидибе разбираться будем мы вот мы рассказываем про то какой она надёжная после то становится их интересует на самом деле а дальше курим поддержка но вот кабы мы поддержку обеспечиваем а вы потом еще поддерживаете foundation деби ну мы все поддерживаем просто и по некоторые вещи мы говорим купите не мы являемся ключевым элементами в поддержке то есть вот клик house выберем вот есть там если вам нужно вот там есть прекрасная компания там которые мертвы организовать поддержку можете у нее программ приобретать fondation тебе приобретать мелкого берите у нас это всяко будешь и почему он понял а еще вопрос к цели получение пися диез с получали выписать из с на свою систему клиентов у нас для вас проблемы у нас каждые полгода или каждый год аудит попей д сссс для решений которые можно использовать в беседе с решениях то есть это для вендоров да конечно регулярно постоянно-непрерывно потому что как и без этого да да да то есть но там криптография своя то есть они спрашивал как мы выполняем ключами как происходит криптография данных внутри все остальное в общем никого не водит назар в текущих решениях мы не храним карточной данные там а скорее больше персональные данные интересуют и соответственно там же dp.ru какому нибудь там где они нужны но там криптографию да то есть все как всегда схемы камера хранения ключей распределение выдача или там в железные часы подключать там разные истории и все к сожалению приходится использовать"
}