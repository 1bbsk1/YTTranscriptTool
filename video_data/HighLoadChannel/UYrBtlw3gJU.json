{
  "video_id": "UYrBtlw3gJU",
  "channel": "HighLoadChannel",
  "title": "Пишем тестируемый код / Евгений Мацюк (Kaspersky Lab)",
  "views": 2104,
  "duration": 2981,
  "published": "2017-06-02T10:27:57-07:00",
  "text": "меня зовут евгений мацюк я являюсь android разработчикам команды сбербанк технологии и сегодня я бы хотел вам рассказать про тестируемый код android скажите пожалуйста а сколько среди нас android-разработчиков ребят поднимите руки пожалуйста отлично а кто вражеской веры ну а есеньке смысле у ребят как пуск много но я думаю на самом деле он тоже будет очень интересно потому что здесь мы касаемся вопросов архитектуры чистый архитектуры и у вас тоже нечто подобное есть насколько я знаю можете мне расскажете интересно итак начнем что такое тестируемый код в нашем понимании тестируем и код это какой это наверно код который покрыт тестами какой код мы можем покрыть тестами код который с хорошей нормальной архитектурой которую модуль на декомпозировать разделен вот который легко сопровождать расширять и так далее но в нашем мире андроид-разработке очень много препятствий очень много боли которым мы вынуждены к сожалению преодолевать вот что за боль какая она у нас есть свое время когда google выпустил первую версии sdk он дал нам sdk он дал нам инструмент сказал ребят делайте но при этом не сказал как делать какие архитектурные паттерны применять по каким примером по каким лекалам мне кажется и сам google не совсем представлял как именно делать и что она в итоге вулиця поэтому у нас не было никаких образцов что нам делать далее ошибочно пониманию роли activity фрагмент только через который я сам очень много проходил раньше бытовало мнение что если наша android приложение рассматривать как паттерн mvc the activity фрагмент это контроллер ну и со всеми вытекающими отсюда если контроллер да мы туда пи х в ей мы туда пихаем бизнес-логику я встречал где и там и работа с данными запросы сервера синхронизация и все это превращаться в тихий ужас как бы мы ни пытались аккуратно может быть писать код у нас рубеж в тысячу строчек мы переходили на ура сразу же и все это превращалось такое определенное мясо но даже если мы пытались как-то выделять какие-то вспомогательных хелперы менеджеры все равно мы получали жестко связанный код давно жестко связаны activity и на него жестко завязан а вот эти менеджеры хелперы другой разработчик которых будет править наш код что ему нужно будет все это читать во всем этом разбираться далее обработка жизненного цикла тоже известно боль в андроиде наши activity фрагменты они могут умирать они могут возрождаться но при этом мы не должны терять данные и такой момент что когда нам нужно какое-то запилить бизнес-логика для общего для нескольких экранов какой у нас был выход но только один выход синглтон и и в принципе синглтон и но вполне нормальное решение с одной стороны но с другой стороны они вносят неявные зависимости да не вносят то что ну по классу где пример синглтон на мне определить что там что-то внутри еще у синглтон узкая плюс они все таки жестко связывают наш код в синглтон и они у нас реализовались как там запихивай скука это бизнес логика ну и заодно мы можем туда состоянии до наверну почему бы нет и вот бизнес-логика состояния и получала ситуация да мы вроде делаем что-то в одном месте у нас выстреливать в другом нормальная ситуация была ну да и неявные зависимости далее работа с потоками работу в бэкграунде мы знаем что наш ей поток он крайне привередливый не надо в него ничего прям такого класть нужно все в бэкграунде потом это синхронизировать и в принципе да мы можем средствами джавы использовать executors фьючер и прочее но можем использовать средства которые предоставляют google это sing the skill удары но мы знаем о sing to ski не жизненный цикл не не потом lauder и они жизненным циклом нормально но если вам нужно строить какую то цепочку например у вызвали что ты сети потом обработали потом база данных то вы к сожалению ну тяжелого было с этим можно было свои какие-то фреймворке пилить какие-то библиотечки вот создавать вот эти колбы кахилл и все это было конечно ну может вам понятно будет вот придет другой разработчик ему нужно будет определенно довольно таки время чтобы разобраться во всем этом и отсутствие unit тестов я считаю это было очень долгое время такая вот прям боль и я считаю отсутствие дени тестов это было домики большой недостаток мы не могли писать тесты мы получаться не могли проверить это с кейсы нашей бизнес логики и вот теста нам дает очень важные преимущества до точнее они дают важный такой побочный эффект выпрямляет нашу архитектуру на activity либо фрагмент в несколько тысяч строчек мы в жизни не напишем тесты у нас ничего не получится и вот как вы истории жизни расскажу вам мы примерно год назад с команды пришли на новый проект проект уже был ну развивался но развивался он там какими-то непонятными ребятами вот они ушли пришли мы оставили нам они проект и у них вот все вот эти боли были то есть у них не было нормальной архитектуры не было вообще такого понимания что такая архитектура то есть в activity фрагментах а не пихали все что угодно много сингл тонов и все это у нас было такое чувство этот код был ужасный и примеру на починку бага у нас выходило наверное мы по неделям реальном и один бак какой-то минорный где-то там не отображается флажок неделю уходила и ладно если мы починим этот баг она могла выставить где то в другом месте внедрять какие-то новые фичи и прочее но было практически нереально мы двигались очень черепашками такими следами шашками но слова бога нам дали передышку дали временно редизайн и у нас появилась возможность как-то немножко переосмыслить попробовать внедрить новую архитектуру новый подход и сделать такой как бы базу вот эту архитектурную и на нее уже новые фичи внедрять при этом должна мы должны как-то умудриться поддерживать некоторые старые части ну и затем их переписывать и поэтому мы решили использовать такой технологический стэк это первое чисто архитектура mvp думаю видели все картинку девушка баба суть предельно простая здесь мы разделим наше приложение на определенные слои ей президента ри бизнес-логика и дата в 2014 году фернандо ситжес попробовал вот эту часть архитектуру и и на android приложить получился такая картинка где в презентацию нервы видите есть модуль view презентом реализуется поттер наверное поэтому нас пошло именно mvp ним в цен мне кажется далее dependency injection помним мы говорили про неявные зависимости пород синглтон и которые порождают эти все неявные зависимости что позволяет нам dependency injection до пенсии injection он делается наши зависимостей овны сам класс не создает какие-то там объекты не используют ему необходимо объекта предоставляются через конструктор и через поля через специальные методы одна из популярных реализаций но так съёмка то есть ответственность за создание объектов и проводник зависимости между ними лежит на специальных гектарах фабриках и так далее популярная реализации сейчас допустим джексона андраде это dagger 2 никто вам не запрещает конечно свои фабрики делать можно через mortar это наследник dagger 1 я даже видел через flowers rejection тоже вариант далее тест и вот прям капсул видел выделил тесты над же выемки у нас наконец появилась нормально июня тестирование тот же june 4 makita пор makita для падме наших объектов обычных и статических acer g для сравнения раба лекторы для эмуляции android узкого окружения зачем ей тестирование эспрессо был у нас инструменте infraworks глючный важный от гугла сейчас эспрессо но он тоже правда допускает флаке тесты и отдельно хотел бы выделить android студии даешь к которая позволяет нам писать и код и тесты и юнит-тесты все вместе сразу все это запускать все это удобно все это круто ну и рых джалла работа с потоками помним да вот составление цепочек зависимостей державу очень здорово выручает очень здорово в этом плане помогает вот такой вот мы использовали stack технологий и я хочу сказать что ну понятное дело мы не все прям сразу все скопом вот эти четыре вещи внедрили мы внедрили поэтапно постепенно некоторые вещи мы не совсем так понимали потом несколько переделали но за менее чем год скорость нашей разработки намного возросла она возрастает с помощью той же чисто архитектуры да вот когда мы внедряем какую-то новую фичу мы ее можем разбивать на определенные уровни и каждый уровень отдавать отдельному разработчику разработчикам достаточно просто договориться об отдельных интерфейсах и моделях данных все дальше они сами разрабатывают они покрывают эти свои модули тестами то есть они уже в принципе могут быть уверены что их модуль работает верно и в конце мы это все вместе соединяем запускаем на устройство пример что все нормально и отдаем тестирование вот скорость работки разработки возросла на растет легкость сопровождении легкость исправления ошибок то все ошибки которые у нас если появляться они все-таки локализованы а не в каком-то конкретном модули и если мы эту ошибку исправляем либо мы решили там на мне нравится модуль мы решили его переделать нам не надо затрагивать 10 других классов нет мы починили свой модуль подменили реализацию все то есть у нас получается приложение состоит из таких независимых кирпичиков где мы можем аккуратно вынуть один кирпичики подложить вместо него другой вот поэтому очень здорово и до богов естественно стало меньше у нас на крыше тексте крыш free users 99,9 процента ну то есть это все таки показатель что это помогает это действительно классная вещь вот я хотел бы спросить на самом деле вас у нас меня дальше будет код там много рек java кто-то и эзотерик жалоб так хорошо а кто юзает и и не тесты кашу без и решил это так ну хорошо но у меня будет там много и рэкс джавы но я буду пояснять если что мы будем представлять методы рис джавы как там калмыки так далее ладно продолжим что я хотел еще сказать все это здорово да вот этот стек технологий прикольный но когда мы начинали изучать все вот эти технологии особенно касательно чистой архитектуры с чем вы столкнулись с тем что такое ощущение каждая группа разработки она понимает уже 4 текстур из mvp по-разному вносится в какой-то свой смысл плюс появляются множество каких-то библиотек типа максим мозге виктор под android который решает нам проблему жизненного цикла да все здорово но когда вот разработчик который не привык к архитектуре до либо у которого было несколько иное представление он переходит на вот это дело ему конечно же тяжело и потом разработчик захочет ну хорошо оки посмотрю приложения чисто архитектура образец четыре с лишним тысячи звездочек на гитхабе ну круто же надо верить вот и смотрит он здесь в горе abs горе море абстракции всяких классов уровней и у него просто разрывается мозг от этого всего но это действительно тяжело и непонятно сначала поэтому своем докладе я бы хотел вам рассказать про то как вообще вот мыслить именно с помощью чистой архитектуры как вам нужно писать код ваш тестируемый понятный прямой код с используем чистой архитектуры mvp depense injection язык java с тестами то есть мы рассмотрим такой степ бай степ решение у нас на входе задача конкретная задача да и мы анализируем так на какие мои уровни разбивая распишем с вами каждый уровень на каком уровне какие там классы как они должны взаимодействуют друг с другом и я надеюсь что это будет полезно и подтолкнет вас к использование общей чистой архитектурой к написанию тестируемого кода хорошего качественного кода и так давайте рассмотрим с вами пример пример у нас довольно таки простой здесь у нас экран главное кстати да приложения лежит здесь на гитхабе может посмотрите потом обязательно вот есть у нас приложении есть у нас два экрана экран профиль и экран трансфер рассмотрим с вами экран профиль в чем суть данного экрана здесь у нас мы должны отобразить информацию о пользователях вот здесь она хоп загрузилась отобразилось и доступна кнопка апдейт для обновления баланса баланс у нас один тут 123 лиля и вот стал было с другой у нас вот собственно все теперь получили мой бизнес задачу как мы будем пилить и и вспоминаем картинку фернандо ситжеса да там три слоя и их немножко повернул и чуть-чуть переименовал вверху у нас будет не презентация а ей на презентацию презентом как немножко созвучно так и domain лир я переименовал в бизнес потому что мне ну по мне лично как-то domain верона не сильно о чем говорит вот поэтому бизнес как-то воле все понятно и внизу дата уровень просмотром пока что в общем что вообще в этих кубиках будет у нас ей это view и презентеры далее бизнес интер акторы и далее у нас дата тут пакеты не так db кэш и наверху репозиторий вот такая будет у нас общая схема пока что просто ее запечатлим покажу просто запомнил будем держать в голове кстати нормально видно вам всем репозиторий вот эти названия итак начнем с даты уровня что у нас задать уровень дата уровень это у нас работа с данными получения и сохранения и тут вы видите есть разделение на два уровня 1 уровень ниже это пакет и нэпу где содержатся классы для работы с непосредственно в данном случае с retrofit а далее там db этапа класса которая для работы с базой данных для получения излечения и примеру для работы с файловой системой да там файл-менеджер userpic вот тут у нас появляется первый уровень абстракции это репозитории зачем вообще здесь нужен вот репозитории этот для чего нужен этот абстрактный он нужен для того чтобы ваше бизнес-логика который будет получать сохранять данные чтобы она ничего не знала о том ну как она именно работа с данными то есть через сеть через базу данных и так далее она дергать вот эту abs абстракция и прав репозитории все как она реализуется внутри это уже задача дата уровня собственном и бизнес-логику освобождаем от забот и над тем какие там используются классы для роботы сейчас базы данных и вот у нас пример profile репозитории первый у нас четыре метода это они для получения данных по пользователю да там персональный аккаунт баланс эльфа и отделение и 2 у нас используется потом для обновления баланса так как я не успел примеру серую ночи запилить я сделал такой profile репозитории дыма здесь просто я подставляю фейковые значения с помощью рыкса вот когда ее примеру успею си серверную часть делать я поставлю другую уже реализацию потом профан репозитории сервер но при этом для бизнес логики для ее ничего не поменяется он как дергал эту абстракцию репозитории так и будет дергать и так что мы можем сказать по репозитории это первый абстрактный слой он ответственен за получение сохранения данных репозиторий не обрабатывать не какие ошибки не глушит он просто их пробрасывать наверх далее репозитории не занимается объединением каких-то там разных сущностей и репозиторию друг с другом непосредственно никак не взаимодействует они просто вот сохраняют получают данные если у вас приложение вообще просто только онлайн его вы ничего не сохраняйте в базе данных то получается репозиторию методы они будут повторять api вашего сервера но если потом подключается какая-то синхронизация с базой данных сохранения то вы просто можете потом другую реализацию подставить репозитория но для верхних уровней ничего не поменяется ну и по тестам если дал просто онлайновой приложение to the test это здесь никакие не нужно писать если же у вас идет работа с базой данных сетью до вам как-то надо кэшировать потом что-то доставать то да здесь уже вы можете использовать мог веб-сервер раба лек тарик я не стал здесь приводите сети тесты они на самом деле должны сейчас и я просто конце приведу ссылку где можно посмотреть хорошее решение посмотрели дату вот мы посмотрели дату теперь переходим к среднему звену бизнес-логика наша интер акторы я встречал разные реализации enter ну понимание интер акторов где-то интер акторы это каждый бизнес кейс это отдельный интер actor но тогда этих бизнес кейсов становятся такое большое множество зачем по мне удобнее когда или трактор это какая-то большая бизнес фича в данном случае это экран профиль вот и каждый публичный метод данного интер актара это конкретный бизнес-кейс у нас здесь сколько получается бизнес кейсов две штуки на данном экране то есть это получение информации и обновление баланса для тех кто не с рексом вот эти сингл видите представьте что это просто воет в аргументах вы просто пробрасывать укол бейки и если вот так вот понятно то здесь мы просто подставлю но если не rx использовать то мы бы в аргументы подставляли бы калмыки с которой получали результат итак посмотрим реализацию персонал дата получения персональной даты что здесь происходит давайте вот первые четыре метода вот внутри zippo вот г-н барсед person you forgot password персона каунт и так далее это мы дергаем это мы дергаем наш репозитории примеру пакет паркет person for аналитики нам говорят следующие ребят если у вас валится данный запрос там и пробрасываем наверх ошибку то есть получение информацию по пользователю все считать что это ошибка а по остальным вот get парсит персонал аккаунт баланс и так далее другая водное что если запрос и сломались сеть либо еще что то то мы просто подставляем модель данных с пустыми значениями вот пустая увидеть у нее персонал аккаунт module in this track and testing то есть какие-то значения по умолчанию то есть мы глушим ошибку еще таково дна вот методом конвертом вот эти четыре модели данных которым из репозитория получили с помощью метода конверт они объединяются в одну модель данных person of all data model и там еще такая вводная серверном не гарантирует что возвернутся корректные данные то есть нам могут вернуться в как просто ну так и в модели данных могут вернуться нулевые поля и такая вот абстрактная ситуация и получатся для данного метода у нас следующий тест кейс и это то что все успешно то что personal info сломалась потом то что и персонал в успешно но другие сломались это что все успешно но вернулись 0 и как вот будет выглядеть тесты gsl.ua секс с вот ну так как здесь уже много кто с тестом работы думают был просто с помощью makita мы подменяем возвращаемые значения от репозитории с разных методов потом мы тестов скрепер но это скажем такой фейковый какой-то callback если не рик джалла который мы подставляем в метод get про солдата интер актара и ждем выполнения с помощью вот вы терминал event и далее проверяем то что вот это наш метод выполнил нормально без ошибок новый rolls выполнился комплит это что на выходе мы получили персонал фонда тамаду которые все поля которые которые мы ожидаем увидеть ну и примеру персону в рош мы подменяем что репозитории результате выполнения метода репозитория до год pure sound возвращаться у нас ошибка и проверяем дам все ошибка возвращается нам profile in through the exception по обновлению баланса тоже все аналогично у нас получается единственного водно что если у нас метод выполнился репозиторий успешно навернулся ну то мы считаем это за ошибку и пробрасываем ее наверх таким образом у нас получается 3 тыс кейса вот errors access return ну и саксэс return он был то есть мы видим что когда мы реализуем вот это каждый бизнес кейс по отдельности вот конкретно бизнес-логику то когда мы ее реализовали мы смотрим на да на реализацию данного бизнес киса как вот некоторый потребитель как на некоторые такой черный ящик то знаем что на входе может быть такой это да какие то комбинацию назначений соответственно на выходе такие-то и зависимости от этого и получается у нас тесты какие выводы можем можем сделать интер actor это у нас 2 абстрактный слой и трактор большая бизнес фича где каждый публичный метод интер actor это конкретный бизнес-кейс далее по моделям данным модели данных которые у вас в дате и которого своя это должна быть разной модели данных то есть модель у которого вы получили в базе данных не нужно ее за использовать в я и элементарно потому что вы можете потом получать данные из базы данных от сети вот а во-вторых вряд ли вам что все понадобится в я а вдруг вам модельку которую я надо еще как-то дополнительно грузить вот интер actor у нас получается он преобразует одни модели данных другие то есть у нас было четыре модели данных которые мы получили с репозиториев преобразовали в одну модель данных и обязательно используйте аннотации если вы разделяете разработку между разными разработчиками вы договорись о чем об интерфейсах и о моделях данных и вот вы бизнес-логику реализовывайте вы свою вот эту модель данных персонал солдатам отдал ее отдаете тому кто пилит ей этот человек который пилит и и он должен знать что примеру он дергает какой-то get методом get info не что он там не получит ну либо может получить null поэтому применяйте ну а на null null и был но и дорогие аннотации android класса в интер actor тоже есть разные мнения на этот счет я слышал про то что по идее то бизнес же логика юнит-тесты поэтому но android классов как бы не должно быть но есть ситуации когда android классов не обойтись например контекст вот для получения локализованной строчки как нам ее по-другому получить но только через контекст либо можно наплодить методов но это не очень хорошо таким образом мы можем использовать контекст и для того чтобы подменить контекст в тестах используем раба лектор ну да будет у вас теста запускаться не 100 200 миллисекунд до 6 секунд но в этом ничего страшного нет по обработка муж и бак мы видели что интер actor некоторые ошибки пробрасывать наверх не которые глушат это его задача далее по внутренним состоянием и вот по взаимодействию между интер акторами тоже в чем в чем соль если у вас в результате выполнения одной бизнес одно ну в рамках одной интер актара у одного бизнес-кейс а вот там получилось в результате какое-то значение но какая-то моделька которую нужно для второго бизнес-кейс а то в принципе внутри трактор можете это сохранить как приватное поле использовать вот между бизнес кейсами но ситуация усложняется и становится более интересней когда вот пока что отвлечемся от нашего примера вот абстрактный немножко такие ситуации рассмотрим чтобы просто понять скажем есть у нас такой бизнес кейс получение онлайн контактов в какой-то конкретный момент времени есть у нас такой место чин трактор в задача которого состоит в том чтобы not сразу отображу задачу которого состоит в том чтобы отправить сообщение всем онлайн контактам да и таким образом через вот как мы видели явная зависимость да через конструктор мы передаем место чем трактору и contacts and interact or и мы можем спокойно брать использовать бизнес-кейс у икон токсин трактора получить вот эти онлайн контакты и отправить им сообщение вот второе возможен второй случай когда у вас есть какой-то интер атор занимающийся аутентификацией у неё есть есть соответствующий бизнес-кейс логин результате выполнения этого гена получается station айди который будет нужен всем остальным interact аром и собственно что нам делать с этим сейшен айди как нам его мы можем его кажется хранить в interact ари и потом обращаться там gcse найди но интер акторы у нас это бизнес логика за хранение и получение данных отвечать репозиторий поэтому мы через репозиторий сохраняем это цельсия найди и о примеру для получения операций мы с юзом этот репозиторий и получаем у него совершенно иди это абстракция а как релиз реализованного сохранения саша найди это уже дата это уже делала дату уровня вы можете его хоть в хеппи ход базе данных это не задача бизнес-логики посмотрели бизнес-логику остался последний рывок юлай еще немножко и так и и у нас ice view презент are of view может для кого-то будет тайно или нет но фрагменты activity это в юшка это на самом деле не должен быть контроллер вот это чистая в юшка то есть она заниматься чем отображением данных то есть она делает только том что ей говорит презента это первое второе она проводит действие пользователя презенту примеру нажатии на клавишу еще что то все две вещи больше превьюшка ничего не делает вот пример интерфейса вьюшки то есть показать прогресс скрыть также прогресс там показать ошибку ну и так далее презент по поводу превенторов встречал разной реализации разные подходы есть подход mvp где на президента у нас вешается бизнес-логика вот и президента получается он обращаться к данным да и управляют юшкой вроде бы вполне нормальный подход но по моему опыту это все к сожалению выливается тоже презента превращаться в год объект тысячу строчек легко перешагивать и если пишете тест это это еще дополнительный тысяч строчек и вам потом тяжело уже будет контролировать этого монстра потому что на президентом на самом деле помимо бизнес-логики какая у него будет ответственность у него будет ответственность управление в юшкой у него будет ответственна синхронизация жизненным циклом вьюшки и соответственно у него будет ответственность за кэширования данных так как он всех синхронизируется с юшкой по жизненному циклу поэтому вьюшку у нас отвечает только судя по методам за жизненный цикл видео nvidia nview и за то чтобы вызвать соответствующий бизнес соответствующий бизнес-логику это лот person for bad balance вот рассмотрим наш первый бизнес кейс это загрузка персональной информации здесь какой вот у нас получается кейс есть вот лот personal info и мы сначала проверяем что мы уже делали запрос или нет то есть за кашированного назначение ну у нас внутри в презента или же нет если запиши равана то мы его доставим и проставляем если же нет то идем вызываем метод интер акторы через год персону from data вот метод у нас лорд person from data самое главное здесь вызов метод интер актара и получается на выходе но кто не сырых джавой такой callback где два метода он саксэс и он error если он саксэс то мы все записывал в кэш записываем это показываем на вьюшки дам скрываем прогресс если не успех то сад показываем соответствующие предупреждение что произошла ошибка таким образом у нас тут логично вытекает из кейса это когда у нас не 0 кэш когда у нас кэш 0 но тогда мы делаем запросы у нас возвращаться саксэс либо когда 0 кэш но в результате загрузки ошибка и вот пример теста для секса слот и 0 кэша здесь мы сначала мокрым наш интер actor что он возвращает нам нормальное значение макаем что кэш у нас 0 далее bindview и дергаем наш метод лот personal info далее проверяем что метод interact а ради вернулся тогда мы действительно запросили данные и проверяем что новое значение которое пришло на заке широва лась вернулись в юшки нужном порядке и что шоу и рожа у нас не показалось но по обновлению баланса у нас по сути все то же самое да апдейт баланс вот мы дергаем метод интер актара и у нас либо успех вот мы показали дерна вернули кэше вьюшку но не успеха вообще никак не обрабатываем еще там не дело не показывай мне ошибку ну и все просто 20-ке сам успехи либо ошибка выводы какие можно выводы сделать пой презентую презента это у нас 3 абстрактный уровень в ее 4 страх на уровне то есть у нас получается четыре такие вот абстрактные уровня публичный методы в ее презент никаких гитар в типичном понимание что я имею ввиду вы во вьюшки примерно не можете сказать там презент or get in фон и или презент argued там аккаунт намбер также как и презентом не может у вьюшки запросить примеру вьюга там повышен такой-то публичные методы в ее президента ра они по сути являются командами друг другу то есть президент приказывает вьюшки там покажет а покажи то покажет а авдюшка на приказывают президенту от лица пользователя то есть нажата кнопка сделана такое-то действие получать что с презентом и бизнес-логику все вынесли вот президента room и оставили только то что вот именно кэшировать когда вот там жизненный цикл на сухом перевернулся экранчик затем обрабатывать жизненный цикл то есть вот такого рода робот ну и управление в юшкой и правой динка действий пользователя далее понятно президент внутреннее состояние кэш у президента там могут быть несколько интер акторов то есть может использовать не только один но я вам не рекомендую строить цепочки то есть вы вызвали у mid winter актара там один бизнес кейс как-то обработали этот результат потом вызвали в зависимости от а во второй интер actor нет это все бизнес-логика его лучше в контракт аромат нести иначе презент у вас будет выполнять ну нет а для чего вообще предназначен и так как у нас здесь жизненный цикл кэш то все дублирующие операторы if else и switch кейс выносить в отдельные классы но у нас могут быть там проверки что в юшка 0 кэш 0 вот такая примера ситуация да мы можем сделать вот так вот то что проверяет каждый раз запишем значение нет с помощью но сохранили нашу персонал солдата модули проверяем если не 0 то обновляем там значения либо мы можем вот так вот сделать то есть мы создали специальную обертку profile президента рк ешь и вот внутри вот это апдейт был забит к нам бортом уже идет проверка значение было закодировано если да то обновляем значение если ноль то ничего не делаем таким образом вы просто у президента ра выносим вот это дублирующий код и мы уменьшаем количество тестов то что иначе нам бы везде то есть бы добавлялся что если наш эта моделька было бы 0 рассмотрели ей с вами вот мы с вами рассмотрели ей бизнес и дата рассмотрели все вот эти четыре у нас слой в и презентер интер actor и репозиторий теперь бы я с вами хотел рассмотреть некоторые такие жизненные ситуации там немножко будет хардкор некий код вот но я просто не пытайтесь там во все вникнуть в принципе это не нужно я просто укажу основные моменты основные моменты где у разработчиков есть в глаза делай там по старинке но почему это не следует делать и как можно сделать ну как по хорошему и так вот это экран трансфер у нас будет первый такой тест кейс бизнес-кейс придумали дизайнеры не важно есть у нас поле organizational и и mount и если эти оба поля они не пустые то кнопка сын трансфер она будет выделена иначе она будет недоступна вот если они заполнены то кнопка сын трансфер будет доступный какой у нас здесь есть соблазн все запихнуть в фрагмента правильно иди текста повесить tex watcher и даттон повесить проверку что если пользователь что-то вайда проверим 2 иди текст ну и собственно делаем кнопку тогда доступны недоступной но на самом деле это не очень хороший подход во первых потому что фрагмент да это у нас чисто view так она получается будет принимать решения во вторых мы определились вами что вьюшку управляет презента а так получается что в юшкой управляет и презентом и сама мушка и когда мы тестируем президента ри ожидаем как бы одно поведение от вьюшки на практике может получиться что в юшку будьте повести по другому потому что молот размазали вот эту логику и получилась такая ситуация есть 2 как бы соблазн тоже я тоже сначала так делал презента использовать до дернуть у президента ра какие-то там два метода примеру сейф amounts of organizational и внутри президента ра сделает проверку и если там все хорошо то делаем доступную кнопку если нет то нет но это тоже мы вешаем лишнюю логику на презента место вот этой логики в бизнес логики этаже у нас ну бизнес-логика то у нас конкретный кейс да собственно он должен быть в интерактиве как это может выглядеть вот наш трансфер фрагмент вот у нас эти тексты work ними идти и month идти им его президента ра дергаем такой метод лисин feels и туда передаем туда передаем рик совские обертки над tix watcher а для тех кто не сорить джо вы скажем что мы туда передаем текст в очередь то есть такие же кубики просто это обертки ресурс кимани с ними более удобнее работать хорошо дернули поехали дальше что делает презента он делает ok хорошо я дергаю метод интер актара controls and bottom и передает туда вот эти но либо обсе углы либо скажем калмыки тех свотчей здесь российский код не обращайте внимание от главной вот эта строчка собственно здесь уже принимать решение что если оба метода оба поле у нас заполнены то собственно true иначе files и мы это дело можем спокойно протестировать давайте уже это делал проскочим это обязательно потом посмотрите в дема приложение это контрактор у нас работал и соответственно у нас он выдает interact у нас выдает либо тролли бы files и это у нас в подписке срабатывает соответственно дергаться метод в юшки если саксы струи любовь и лс и передается труфелс в во фрагмент где уже кнопка делается доступна либо недоступной то есть вот такая цепочка так но у меня чуть-чуть время есть и последний кейс скажем это сложный кейса тоже посмотрите дома если будет желание такой пример и жизни когда вам необходимо отправить платежку но данный бизнес кейс он состоит из нескольких этапов он состоит из этапов локальные валидация потом серверной валидации и потом только отправки платежа и тоже и примеру мы сначала локального люда сопроводили прям во фрагменте там проверяли но потом все это дело переделали потому что это тоже бизнес кейс он состоит из определенных этапов и место ему в интерактиве вот есть если какая-то валидации он а я ошибкам и и отображаем потом если все хорошо мы отправляем платеж и если все прошло успешно платежка отправлено показываем успех и как мы получается делаем мы в нас and transfer батон вершин кликни sinner и там передаем вызываем у презентер а метода сын трансфер куда передаем данные вот по этим всем полям виде строчек далее у нас презента дергает метод интер актара то есть передает все вот эти строчки туда дальше winter actor и здесь уже происходит у нас логика локальная валидация потом серверная валидация потом парсинг результатов северной валидации и потом отправка платежа вернулись и собственный интер actor нам выдает наружу либо успех либо неуспех но exception у нас может быть то что что-то валидация не прошло либо exception просто нет сети и таким образом у нас получается 3 тыс кейса для данного метода это когда секс с его людей террор либанова людей террор ну и это собственно отображается во фрагменте фрагменту мы говорим что делать и так что почитать посмотреть я прекрасно понимаю что тема особенно то что связано с архитектурой она ну далеко не простое в этом нужно вникнуть в этом нужно этим проникнуться я рекомендую вам еще раз просмотреть вместе с дома приложением посмотреть самим код пощупать его попробовать потом советую почитать дядюшку баба он по чистой архитектуре вам пишет блок фернандо ситжеса которую в начале упоминал он тоже много по архитектуре статьи пишет и примеров по поводу он мог веб-сервер по поводу раба лекция в начале говорил вот есть приложение к лисе motors его артем зиннатуллин сделал там он что мне нравится он все тесты пытаются но в андроиде он развивает вот эту тему тестов и он вводит как бы для android понятия функциональных тестов интеграционных unit тестов этом как раз он вводит тестирование как вот с помощью мог веб-сервер так далее посмотрите потом и android дев подкаст ребята наши разработчики интересные вещи рассказывают вот но и заключение верьте пишите тестируем код получайте удовольствие и все у вас будет хорошо вот мои контактам всем спасибо спасибо за доклад очень близкая тема все в общем правильно и хорошо изложена один вопрос вас не смущает то что в интерактиве по сути дела вам туда проникают вот эти объекты из view прям вот прям вот эти тексты винты то есть фактически потом ваши в you например изменится вместо textfield замените на какой там слайдеры ли еще что то и вам придется менять аж интер актор из за того что вы view поменяли на самом деле там ну может надо было другой немножко название вырвать там я протаскивание в юшку там я протаскиваю обертку над экс в очередь для textview вот то есть там не сама вещь катамино вот такая оберточка то что протаскиваю вещь которая связана с юшкой возможно может быть она не очень как бы так вот звучит но ему место именно там я считаю все таки бизнес ли это логика кнопку отключить вот хороший вопрос я тоже про это думал много я сначала реализован в презент арина поедешь в юшка дауд управление но все-таки я показал здесь как бы более такой тривиальный пример есть ну примеру с локальной валидации вот во втором поедешь это тоже управление вьюшку вы просто должны просмотр прогнать про вашим полям и посмотреть если там что-то не так то уж к должна выдать вам там здесь ошибка здесь ошибка но на самом деле это же все таки бизнес-логика это все-таки эта логика мы как бы я вначале сказал что презента не нужно его нагружать логикой и мы так будет тяжело спешим с обработкой жизненного цикла него будет своя боль пускаем трактор мучиться хотел добавить что я думаю многим разработчикам понять ну если библиотека да кстати для яичников здрасте спасибо за доклад я занимаюсь с разработкой но проблема на самом деле те же и очень похоже вот в начале доклада были несколько раз упомянутые ситуации когда есть какой-то уже готовый код какой-то проект и туда приходит вот новый разработчик может быть новый как для проекта и может быть новый как как разработчик принципе то есть junior какой-нибудь если вас какие то данные насчет того какой порог вхождения вот вот в эту архитектуру в этот подход потому что на на моем опыте это этого все здорово круто но когда есть какой-то viewcontroller написаны джуниором на тысячу на 2000 строк в котором длинные методы и императивно все понятно читаемы и я тоже видела проекты которые там все реактивно все распиленного по слоям там vim и прочие-прочие вещи которые просто абсолютно непонятно что где происходит и какой какой ваш опыт вот в в ситуации когда приходит человек не знакомы с этой архитектурой на такой проект спасибо за вопросы понял да на самом деле тут порог вхождения не такой что как пример с библиотечка пикассо да у нас было раньше проблема загрузкой изображений потом появилась библиотека пикассо где нужно было просто дернуть один метод и все просто все понятно у нас был такой опыт что у нас сделали ответственного человека который сначала все эти вопросы изучал который сначала пробовал на домашнем проекте потом пробовал пилить в рамках проекта отдельный модуль выбрали меня я это дело месяц-два вот так вот планомерно сам как бы занимался этим и потом так как у нас в команде как бы никто этим не пользовался никто не не работал с этим-то примеру новую фичу надо разработать да и все договоримся разрабатываем фичу по-новому разговариваем во-первых я ввожу в курс дела во вторых продумываем как должна выглядеть архитектура и потом плотный review код то есть первое время приходилось постоянно review и очень внимательно потому что люди ну понятно кто не работал с этим там совершать некоторые типичные ошибки нетипичные но через некоторое время мне кажется там довольно-таки быстро люди привыкают вот встраиваются в эту систему и потом все давно таки здорово а если какой-то вообще сторонний человек примеру junior пришел ну только плотный review код спасет то что но если мы видим что 2000 строк он написан описал все на ковер разбираться с ним сейчас за дела почему спасибо здрасте у меня несколько вопросов будет ну во первых у вас вот interact ora содержит несколько методов это несколько отличается от подхода которая вот общепринят но которое на android 10 тот реализован из-за этого вам приходится во многих местах писать кампус и надоедает повторять вот одна и та же кампус я применяю в этом же вы имеете ввиду а разных превенторов то есть там где низ президента ра ну да то есть в во множестве мест но статус соответственно если для каждого десткий собой свой интера ктара то это можно вынести в базовый трактор и в одном месте применять компоста есть переводить там сабскрайберов герман я согласен то что можно выносить этого абстракция и так далее но если бы я сейчас здесь бы применял абстракция тобою все было еще более запутанной тяжелее вайрон как вы именно делать я честно говоря это ну у меня прямо на меня не раздражает то что нужно компост и так далее по мне лучше может быть чуть чуть больше кода но больше понятности потому что когда вы начинаете наследование прочего ваш код по определению уже становится более сложно в понимании и может быть не таким как бы явным но здесь я могу на самом деле шабас а тут время покажет можете поменять свое мнение действительно потом привет приду к тому что да зачем лучше в один абстрактный класс вынести и тогда еще хотел бы ответить на предыдущий вопрос дело в том что когда я последнее время смотрю тестовое задание некоторых претендентов на там вакансия они пишут примерно то же самое поскольку в android разработке вот уже это почти штир стандарт вот единственное что за исключением там пара разных моментов вот и по-моему вы тут еще надо терять подписаны с подписке то есть за ними вот тоже как ты надо будет следить подписки вы имеете ввиду в президента ри но я просто от не показывал я потом когда он быстро view и это пробраться в президенты что типа он онлайн и там я отписываюсь просто-напросто от все вот и все ну все зависит от задачи здесь я по простому то есть как разрушаться вьюшку чем все грохот и все спасибо"
}