{
  "video_id": "rki5JbEZPgk",
  "channel": "HighLoadChannel",
  "title": "Архитектура программно-определяемого сервера / Роман Тимофеев (Selectel)",
  "views": 1318,
  "duration": 2360,
  "published": "2020-04-14T11:16:52-07:00",
  "text": "здравствуйте друзья я всех приветствую сегодня я буду рассказывать про архитектуру программно определяемого сервера зовут меня роман тимофеев и я архитектор наверное надо немного сказать о себе последние пять лет я работаю системным архитектором в отличных отличных интеграторов и последний год тружусь на благо отечественных облаков компании select л сегодня предлагаю немного окунуться в ностальгию тех времен когда виртуализация только вошла в обиход нашей жизни ну помните мне нужен новый сервер и не нужно покупать новую железку достаточно приятно и виртуализация сильно поменяла нашу жизнь то о чем я сегодня собираюсь рассказать потенциально сможет также улучшить нашу работу и информационные технологии в целом скажем так начну немного издалека буду пару раз капитанить так что не обессудьте здесь у меня график всем известного закона мура от которого мы последние лет последние несколько лет существенно отстаём нам не помогло даже добавление мульти по точности и единственное что не отстаёт от необходимо показатели этого то количество данных которые генерируются нашими системами и приложениями количество данных объем этих данных очень большой они лежат мертвым грузом никак не монетизируется и для того чтобы решить этот вопрос нам нужны кроме объемов хранение также нужны и существенные мощности при чем для того чтобы эффективно анализировать эти данные результаты этих анализов должны быть максимально оперативные потому что жизнь наши еще более динамично какие варианты решения этой проблемы у нас имеются ну первое что приходит в голову это под большую задачу взять инструмент побольше сделать компьютер побыстрее помощнее если есть деньги на суперкомпьютер то вообще супер сейчас вычисление memory например который требует огромного количества памяти достаточно эффективны в таких задачах но и стоимость такого решения она соответственно велика плюс зачастую чтобы внедрить подобную систему уходит существенный срок это доставки внедрение но и опять же все еще огромной стоимости что мы можем сделать еще еще мы можем поделить данные на куски и положить их на несколько узлов распараллелить эти вычисления для этого нам скорее всего понадобится какое-то специализированное программное обеспечение нужно время чтобы его написать это совсем не тривиальная задача это все еще не дешево и понятно что под разные под разные задачи может подойти один вариант или другой но сейчас я бы хотел сравнить эти решения чуть подробнее сравнение будет слегка в вакууме и понятно что везде есть нюансы но и все же скейла вот у нас горизонтально масштабируемой системы соответственно skill up вертикально начнем с нескольких узлов если у нас узлов несколько нам необходимо как-то балансировать нагрузку и у вас появляется балансировщик и несмотря на то что это в общем и целом интересные и классные системы но в данном случае это минус зато так как у нас несколько узлов мы имеем повышенную надежность отвалился узел нагрузку забрали остальные также несколько экземпляров данных дает нам потенциальной проблемой с консистентной стью ну и собственно все компоненты этой системы работают с через сеть которая накладывает свои задержки на разных уровнях и они существенны и если говорить про одну коробку сеть если говорить про одну коробку нам не нужен балансировщика на 1 но она же . отказа зато все консистентной что с масштабируемостью здесь мы упираемся либо в стоимость необходимых нам аппаратных обеспечений либо в общем то такие мощности еще попросту не разработали зато интер процент коммуникациям о каких задержках идет речь когда я сравнивал сеть и меж процессное взаимодействие у меня есть интересная картинка я уверен что все отлично знают разницу в миллисекундах микросекундах на на секундах но чтобы действительно прочувствовать так сказать какая какая разница в задержках я сделал масштаб к чему него человеческому думал сначала в деньги но остановился на секунду и что у нас получается один такт процессора 1 секунда что мы еще здесь видим все что на кристалле и рядом до оперативной памяти это достаточно сравнимые значение это секунды и минуты но как только дело доходит до устройств ввода-вывода даже наиболее актуальных и быстрых январе разнообразные flask массивы здесь просто пропасть минуты против недель а что если есть третий вариант решения задачи и сейчас я вам расскажу рассказывать буду про продукт совершенно конкретной компании я никакого отношения к ней не имею просто насколько я знаю они единственные кто такое делают так что здесь компании the wheel скейл и она придумала программно-определяемой сервер для простоты буду называть в сдс то бишь software define серым что в общем-то это такое представьте набор самых обыкновенных хвостов это стандартные сервера 2 socket мы или может быть 400 и стандартной архитектуры x86 связаны самые обыкновенные десяточный сетью на них установлен такой же относительно обычный гипервизор в данном случае называется гипер kernal и они называют его распределенным что делает обычная виртуализация она берет ресурсы физического сервера и разделяет на несколько логических флотов или пулов ресурсов мы знаем их как виртуальной машины в данном же случае мы берем все эти железки и их ресурсы объединяем в одну большую виртуальную машину с обычной операционной системой и с вашим приложениям причем что мы в итоге получаем десятки терабайт оперативной памяти за стоимость обычного серверного оборудования без изменения операционной системы без переписывания приложения с масштабированием когда это нужно ну скажем так гроуз угол вниз вы понимаете причем это технологии не какая-то на бумаге не где-то в лаборатории и и сейчас используют несколько крупных компаний за рубежом такие как general electrics имейте и техасский университет сша как вы видите на картинке у меня представлено несколько всем известных операционных систем можно даже windows на нее поставить как собственно все это дело работает как ни забавно но гипервизор виртуале зуют память и vertu рисует память и процессор чтобы они стали мобильными посреди узлов кластера таким образом чтобы виртуальному процессору где бы он ни находился на любом из узлах постоянно была доступна одно и то же представление виртуальной памяти при этом система гарантирует когерентность этой распределенной памятью вся сложность процесса прячется от операционной системы и приложения за инновационной разработкой компании это движок машинного обучения называется машин для lingvo р и от нас в общем то вся комплексность процессы спрятана за более полутора десятками патентов в общем и целом подобные системы которые решают похожие задачи они существу здесь можно вспомнить системы с распределенной памятью или ссмп архитектурами например альбом blue джин или историю с ремонт direct memory access с использованием infiniband но собственно что что нового привносят эти ребята здесь есть 2 инновации ну перед тем как о них рассказать я бы чуть-чуть хотел отвлечься на людей команду которая работает в в этой компании основателей технический директор ранее был вице-президентом и главным наушникам с научным сотрудником sap между прочим а вторую фамилию может быть она достаточно известна может быть вы ее знаете это главный наушник главный научный сотрудник уже той дал скейл зовут вот do we tried кто-нибудь знает про давида rida ну в общем он разработал протокол ю д п ну и существенно участвовал в разработке всего стыка цепи по поводу инновации ну значит первое это этот загадочный движок машинного обучения а второй это по большому счету идея обычно данные из памяти из оперативной памяти переносится к процессору для исполнения в нашем же случае система решает что выгоднее в данный момент перенести опять же данные к процессору или перевести виртуальные процесса к данным они у нас напомню виртуализованных поэтому поэтому они мобильны причем контекст процесса это всего несколько килобайт поэтом перенести их легко это данные из неск из нескольких регистров как происходит если вызов виртуального процессора гостевой операционной системы виртуальной машины обращается к данным не локальном хосте то видимо где то этот вызов перехватывается гипервизором и вызывается специальный хендлер как раз движка машинного обучения который свою очередь анализирует эту активность смотрит на предыдущие операции и решает каким образом лучше разместить datasette и памяти и контекст процесса виртуального процессора для достижения максимальной локальности этих ресурсов также он может решить что проще сделать миграцию сейчас то выгоднее если говорить о миграции но нам нужна нам нужна эта память пожалуйста она переехала то же самое с виртуальным процессором я бы хотел вернуться к таблички с задержками здесь я добавил пару строк они реализованы гипер керна вам это конечно же не те минуты которые обеспечивает оперативная память но напомню система пытается минимизировать количество миграция между хостами для того чтобы работать на скоростях оперативной памяти постоянно как физически выглядит подобная система это как я уже сказал набор абсолютно привычных ростов и все эти в 10 гигабит что мы тут умеем у нас несколько узлов у нас несколько узлов и один дополнительный сервер он административный с обеспечением называется wave runner собственно из сетей у нас interconnect для создания скажем так логично логической материнской платы для нашего сдс а и несколько других сетей корпоративная для связи с миром наш гостевой операционной системы внутри виртуальной машины и сеть для управления мониторинга хостами используются стандартной поймай или beyonce интерфейсы и сеть для загрузки гипервизора на сервер собственно по x я доступно несколько вариантов несколько опций по хранению которые могут подключаться сюда для небольшого объема можно в качестве хранилища использовать сам административный wave runner к нему можно подключить полку с дисками в зависимости от также можно использовать стандартный сын сети kit ef-s хранилища их же для повышения производительности можно подключать уже напрямую к хостам как со всем этим управляться есть командная строка есть api и май для автоматизации каких-то действий по администрированию что-то не и не альо секундочку есть также есть графический интерфейс все достаточно тривиально проста и как-то даже пугающе и понятно как только сервера узлов узлы оказываются в одной сети с административным сервером они появляются в консоли здесь мои например видим 20 узлов и общее количество доступной доступных ресурсов которые они предоставляют для создания сдс а мы можем выбрать как все доступные хасты так и какую-то часть из них дабы не разорятся скажем так что же нужно сделать чтобы создать сервер но в общем это примерно также легко как жениться согласен далее далее готова придумываем имя долго думаем над дискрипшн нам выбираем количество узлов образ операционной системы и ужасаемся количеству ресурсов которые будут доступны этой машине но собственно все загружаемся получаем обычную привычную операционную систему с нашими привычными не переписан ими приложениями где все это можно применять в общем то в основном это вполне очевидно большие данные разная аналитика может быть нужно какое-то высоко технологичное проектирование самолетов домов пароходов какой-нибудь retail с любимыми и рекомендациями что нам нужно купить в ашане системы принятия решения поддержки принятия решения на основании каких-то бизнес-показателей что-то про финансовую аналитику или разработки фармакологии может быть шифровка генома надо где-то marvel убрать новые сюжеты собственно проводился проводилась оценка производительности выполнялся тест организации тепихе конкретных быть benchmark h если в двух словах это про оценку систем поддержки принятия решений на больших данных выполнять запросы с повышенной степенью сложности и пам пум я думал так вот у нас в забеге я участвовал физический сервер который работал 500 гигабайт и благополучно провалил тест и также наш прогноз программно-определяемой сервер который смог сделать это существенно так в три раза побыстрее и ключевое здесь то что мы можем масштабироваться пока у нас есть данные которые мы хотим обработать у нас появились данные мы добавили еще коробку и мы на коне чуть-чуть по то что это не только работает но и имеет интересные финансовые показатели на данном графике мы имеем например 800 сервер и программно-определяемой сервер и где-нибудь в районе 10 терабайт оперативной памяти разница существенная что мне приходит в голову где это можно попользовать что первое мне приходит в голову это in-memory базы данных мы все лектер не только зарубежные товарищи проводят какие-то тесты мышц электрон с нашим партнерам тоже проводим некое тестирование у нас есть тестовый стенд он состоит из 4 узлов 4 головок серверов в каждом на борту по 3 терабайт оперативной памяти и по четыре золотых часа 240 от этого собственно тестируем и работу садханы это in memory база данных на которой двадцать пятом году будет работать вся экосистема саб на текущий момент идут на гоночные тестирование но функциональное тестирование скажем так оно пройдено она работает у меня дальше есть мелкий слайд но мне тут разрешили даже немножко немножко дыма и я попробую вам сейчас показать так ну тут совсем живая ну вот обратите внимание собственно 96 циpкa так между прочим и ну и почти восемь с половиной терабайт памяти обращу внимание что в свопе у нас нолик и как я уже сказал тестирование сейчас в процессе можно заметить что как раз процесса по сейчас молотит почем зря конечно у данного решение есть некоторые ограничения и скажем так проблемы я думаю они активно развиваются компания смысле этот этой технологии что сейчас имеем это ограничение до 128 остановить до ста двадцати восьми узлов и дождь из 64 терабайт оперативной памяти некоторых ближайших релизах обещают то поддержку оперативной памяти до вдумайтесь 1 петабайт а чего туда класть а также стоит отметить насчет надежности данной системы если но на текущий момент если хост один из хвостов кластера направляемого сервера падает то в общем то операционную систему гостевую придется перезагрузить все равно что общем-то планку дернуть что обещают разработчики они обещают что так как через один из интерфейсов к серверу через этот интерфейс можно получать данные о состоянии сервера они предлагают проактивно инструктировать движок машинного обучения для того чтобы он мигрировал оттуда как виртуальный процессор и так в общем то и так в общем то и понять ну на этом у меня все терзайте у меня пара зеленых за вопросы цели кто ыл если наш гостевой пойдет по большому счету мы прячем горизонтальное масштабирование получая результат вертикального который всем этим управляет не я думаю это примерно также как отвалившийся в центр в январе ну то есть он для управления для работы он не требуем если конечно через него не подключено хранилище но это такой не production вариант с моей точки зрения спасибо добрый день и спасибо за доклад викторинка сказано что если дисковое хранилище подключается там мастерноде насколько правильно услышал в таком случае же мастернода становится как раз вот узким местом я понял значит на самом деле можно в качестве хранилища отдать даже диск на одном из узлов кластера и понятно что это . отказано но если в конкретной ситуации last устраивает из вас такой недельные грубо говоря benchmark условно то вы можете себе позволить можно использовать как раз мастерхост который с административной который называл и его сделать хранилищем и это опять . отказа но также доступен вариант сын сетью которая подключается в каждый из узлов фаберже ну пожалуйста или нфс спасибо насколько насколько мне известно они сейчас не смотрят в эту сторону почему потому что это просто ещё один дополнительный инструмент то есть в какой момент начались все эти вычисления на gpu когда процессор совместно со своей памятью перестал устраивать добавили дополнительный инструмент который отлично работает для своих задач а здесь когда мы имеем вот столько всего я так понимаю под задачи которые это придумано это просто не нужно на текущий момент здрасте спасибо закладные интересное вот эти вопросы возникают очень похожие технологию которое использовалось hp в del серверах украсть несколько байтов спаивали словно вместе получилось такой мост moonshot который ну фоном огромный серости del там три четыре блюда вместе и просто нам архитектуре там на реально бывали проблемы с производительностью потому что передачу процесса между разными пострадали десятки ну на самом деле здесь как раз задумка в том что во первых мы имеем виртуализацию и виртуализованных циpкa иран есть этот движок машину обучения которое пытается сделать процессы которые будут в скором времени и те данные которые они будут обрабатывать он пытается их занести на один ход заранее то есть чтобы повысить локальность и минимизировать как раз переходы от узла к узлу и к тому же если уж счет что-то переносить то в основном переносится контекст процесса который вот такой относительно datasette а память который может понадобиться например виртуальном процессу надо ему зря то есть смысл в том что в данной системе количество обращений не к локальному хасту от процессора ну от процессорах памяти не к локальному хасту не на локальном хосте она старается быть минимальным и если такая необходимость все-таки появляется значит не звон goval правильно этот движок то переносится не память как обычно это делается как раз в том решение которым вы говорите а только контекст процесса и это совершенно разные собственно разные задержки я приводилось чтобы осуществить платформа от выхода из строя какой то сделать я думаю разница не получится но послушайте в любом случае даже если вы где-то в облаке запускаете instance виртуалке и у вас там работает операционная система падает хост на котором данный момент она крутится но она перезапускается здесь в общем-то абсолютно та же история если вам это бизнес критичная какая-то штука но поступайте с ней также как и обычно n + 1 + сколько там вам понадобится для того чтобы держать свой продакшн несколько тайтл скилов несколько этих кодов migration миграция но мы то говорим о аппаратном файле и он в любом случае вызовет у вас и чём варески который перезапустит машину низ мигрируют память-то упавшего has no осталось виртуальной машины нет вы не правы спасибо за доклад заинтересовал вопрос про движок этого машину обучения как бы кажется что то не очень нетипично задачи вообще для машина обучения есть какая-то информация как они очень вы сделали то будет откуда данные брали как обучали и вообще увы не подскажу один ты добрый день спасибо за доклад у меня два вопроса 1 насколько я понимаю вы уже экспериментируйте с тем чтобы в своей какой-то среде создавать подобные хосты показали ну да действительно это вполне вполне живой стенд мы select all даже из этого чего нибудь придумать хотим то есть уже придумали на у как бы дабы не не очень понял так как раз вот этот мой сдс это и есть виртуальная машина потому что в нее еще сверху еще а смысл условно говоря создать какой-то один большой чтобы на нем создать виртуальный машин полу ресурс ну мне больше видеться реалистичным вот на этой вот машине запускать кучу контейнеров ну да ну чтобы не менеджер этих например про виртуальную машину честно говоря у меня нет предположения железнова сервера и вот этого виртуального сервера железно сервер это было ebay морские майн фрейм или какой-то другой сервер нет я думаю это был такой себе стандартный x8 6 сервер ну мы конечно же не имеем в кармане мэйнфрейма возможно сравнивалось но опять же я повторюсь что есть решение рабочие их достаточно много подвигов вертикальное масштабирование если есть деньги пожалуйста и бьем овский мэйнфрейм это прекрасно если хочется заниматься какими-то горизонтальным масштабируем системы кластерами это тоже работает но в том случае это дорого а в этом случае это все таки сложно здесь предлагается не думать об этом обычной операционка и обычное приложение поддерживает она там распараллеливания не поддерживает другой вопрос точнее здесь он не стоит а в том случае об этом нужно думать может быть может быть но на самом деле у меня был там небольшой слайдик по поводу стоимости например 800 этого сервера и набора обычных серверов из которого мы собираем сдс и на 10 терабайт памяти там было 400 против 800 с хвостиком в нашу сторону а подскажите пожалуйста что произойдет с виртуальной машины если грубо говоря флоп лететь и насколько или критична задержка сигнала ну и верните но можно ли допустим географический разделять на главную ноту и ведома ну что произойдет я думаю зависимости от времени этой задержки ну грубо говоря там полторы две секунды ну условно операционная система большей своей частью скажем так работает на первом узле из этого кластера на тот узел при задержке пошел запрос на исполнение код процесса это будет я думаю провисание затрудняюсь точно сказать может быть и упадет для перезагрузки но я думаю это будет просто потери производительности вторую часть 2 можно ли географический разделить допустим главную и виду мой народ а зачем вдруг ну если это как бы здесь не обязательно чтобы она все стояла в одной стойке так сказать и вот этими стойками и так стать ими торговать они могут стоять в рамках этой комнаты как вам в соде удобно экспериментировали нет так не баловались спасибо в приведенном примере примере на вич mar beach марки вы говорили о том что база данных была у раков вопрос а oracle сертифицировать свою работу своей субботы он если вы заглянете к ним на сайт там будет сказано что как раз одни из целевых вариантов использования сертифицированных как раз работа с in memory oracle и sap hana это первое что они суют в глаза я думаю и как-то договорились как бы вопрос вопрос не по зарплате честно ну что давайте заканчивать можно посадить гипервизор это программно-определяемой какая-то сущность или это именно как операционная система запускается и невозможное и виртуализировать эмбер например ситуация есть дешевые spot ноды ну многих скажем так у многих может в арен выпуск дата но ты на них поднять вот это гипервизор объединить все эти ноты в один миг и кластер на дешевых нотах имейте ввиду виртуализации на виртуализацию затрудняюсь точно сказать с учетом того что там используются существенное количество актуальных технологий которые intel пан-пан о внедрял так свои процессоры я не знаю точно не скажу я думаю нет это будет плохая идея спасибо за доклад скажи проводились и кирпич марки сравнение каких распределенных алгоритмов и их нативные реализации в и диапазон системы то есть логично что к это вверх от на ну вот из используя по ценностям которые стол с использоваться с другими в этом сена ощущение срамота все должно быть похоже но ну а мы тем самым у нас понял там сравнение было запуском на одном сервере который просто не смог многом работать на самом деле на текущий момент у нас выполнено именно функциональное тестирование мы очень хотели тоже удостовериться что эта штука работает как принципе и сейчас вот я когда показывал свою небольшую дырку могли увидеть что там процесс охраны молотят ее в общем то ничем другим пока наш сервер не занимался поэтому таких данных и не могу вам дать спасибо есть еще у кого-то вопрос а если вопросов нет выберите лучший наиболее интересный черт побери вас был так много и oracle убежал поднимите руки кто вопросы задавал у нас еще есть гостинцы и кому вы еще от нас хотите вручить кружку был уже давайте вам спасибо за доклад"
}