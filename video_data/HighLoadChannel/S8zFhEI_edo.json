{
  "video_id": "S8zFhEI_edo",
  "channel": "HighLoadChannel",
  "title": "Face Pay / Михаил Волков (VisionLabs), Гусейн Римиханов (Московский метрополитен)",
  "views": 918,
  "duration": 1910,
  "published": "2023-04-28T06:10:46-07:00",
  "text": "просто всем я пока вышел один из Михаила у меня подменит уже после Сегодня мы расскажем вам как мы делали ФСП Мы наш немножко начнем с бизнесовой части такое с общего у того как это работает а потом Михаил уже поделиться всеми техническими тонкостями при этом проекте Давайте сначала к обновлению к оглавлению у нас будет Первое Зачем это все было Как это работает Что такое компьютерное зрение Особенно с алгоритма Vision labs основание и многое другое а ну вообще зачем мы запустили всю эту историю во-первых нам нужно было использовать меньше носителей чтобы оборот карточек был меньше Кроме того инфраструктура То есть у нас на каждом турнике до запуска проекта у нас уже были камеры Ну и Кроме того есть еще есть мировой опыт да то есть например успешный фило Шанхае подтвердил гипотезу что это можно продакшене использовать И что это реально работает Давайте скажу теперь как нас вообще работает весь процесс так он лёгкий уровень Да ну первым делом У нас есть приложение в котором мы сдаём фотку Вот мы и там проверяем на засветы Они закрыты ли глаза у них то есть такие базовые базовые проверки далее мы пытаемся извлечь дискриптор это уже на севере происходит естественно всё не на приложении Вот потому что самое главное чтобы из лица конкретно извлекся дискриптор для будущих сопоставлений на турнике вот если все окей то мы приложение тоже даем информацию человеку что биометрия отлично сдана и ему нужно привязать только лишь свою карточку чтобы с чего было списывать и попутно мы рассылаемся дискрипторы по всему метро по всем станциям каждые 15 минут теперь давайте рассмотрим как работает этот процесс с точки зрения того когда мы приходим уже человек пришел к турнике Ты что вообще происходит Как видно на слайде У нас есть два главных компонента Первое это камера второе это сам КЗП КЗП - это вот такая голова куда мы карточки прикладываем Вот это контроль как там не помню Называется он честно говоря Ну неважно дальше мы каждую секунду Да там каждый кадр мы получаем видеопоток на станции есть север так называемый мини-фейсп и который Что делает Во первых анализирует кадры То есть если человек там нет Там человека он сопоставляет вектора Допустим мы нашли лицо в кадре и вот как бы если вернуться назад Мы собирали все эти вектора и он ищет базе есть ли такие вектора сейчас момент также там настроил распознавание от Vision labs и Кроме того там хранятся локальные вектора чтобы быстро их распознавать их сопоставлять потому что здесь очень важна скорость Ну теперь я передам наверное слово Михаилу вот он расскажет дальше про техническую часть Всем привет Меня зовут Михаил Волков я представляю компанию Vision labs которая в общем-то все это сделала я сейчас построю свое выступление таким образом что буду немного говорить о теории и тут же о том о чем мы собственно сталкивались Какие сложности у нас были Может быть это кому-то поможет преодолевать нечто подобное в общем-то Наша компания занимается компьютерным зрением что касается не только лиц А вообще любых объектов которые интересны Ну в разных промышленных областях То есть это могут быть силуэты шинки какие-то различные ситуации например драки лежачие люди там поднятые руки как тревожная кнопка и тому подобное с этого в общем-то всё и начинается По сути чтобы научить компьютер видеть нужно иметь соответствующую нейронную сеть её нужно обучить в общем-то это ну не секрет ни для кого как это делается множество есть различных нейронных сетей которые могут это делать самая основная сложность при обучении это в общем-то набор размеченных дата сетов чем они разнообразнее тем лучше ваша сеть будет делать ту задачу которая на ней лежит по сути то есть что касается лиц это не просто лица там их набор это и различные повороты различные углы наклона это лицо с маской перекрытием например в шапке у человека он побрился это все очень важно помимо этого важно еще и различные скажем так засветы лица то есть в темное время суток в светлое время суток утром вечером зимой осенью все это очень сильно важно и чем больше у вас будет это сетов которые вы используете для обучения Вот именно вот таких тем лучше ваша сеть будет делать в общем то что чему Она предназначена Наша компания Очень много сил и средств тратит на то чтобы наши сети непрерывно есть такая штука называется nist это национальный институт стандартных этих стандартов технологий меня слышно В общем это международная международная компания можно ее так назвать где различные вендоры нейросети тестируются друг с другом по сути на закрытых дата сетов Ну и мы там стабильно в топ-5 входим мы международная компания мы Российская компания которая представлена на многих международных рынках в том числе в Сингапуре в Западной Европе и тому подобное и многие Наши партнеры скажем так или заказчики как раз смотрят на вот эти вот международные рейтинговые агентство скажем так и выбираю в том числе и поэтому признаку и почему у нас Почему наши алгоритм и выбрала в том числе компания метро Да потому что помимо того что мы очень быстро и быстрее всех распознаем у нас еще и очень качественный Life нас Life нас это штука которая позволяет отличить живого человека от фейка Ну то есть я подробнее немного расскажу об этом но это очень важно когда человек подходит турнике то и пытается пройти по другому лицу мы должны определить что это подлог то есть фейк и мы наш алгоритмы к этому очень сильно устойчивы В общем как сейчас все это происходит Ну и вообще расскажу о pyline распознавания В общем самого начала когда человек подходит к турникету начинаются вести его трек Ну и на самом деле ведутся три нескольких людей которые ближе всего в зоне контроля турникета находятся трек нужен для того чтобы не отправлять каждую секунду или условно настроенное время высот в систему дальше Как мы определяем например какой трек нужно Какой трек из какого трека нужно выдернуть бэдшот и отправить его на распознавание в общем-то куча настроек есть на самом деле по этому поводу но мы оперируем здесь главным образом размером лица понятно что лица могут быть разные у кого-то больше лицо у кого-то меньше Но в целом там 98 наверное процентов подходят под определенные размеры как только мы находим лицо нужного размера мы понимаем что это человек хочет пройти в общем-то по например собственно что происходит Дальше Дальше мы должны четко понимать что это живой человек это не подлог это не ну условно телефон который Вы пытаетесь там злоумышленник пытается сунуть на камеру или это распечатка какой-то картинки Пусть очень даже качественной Или это может быть маска с вырезанными глазами из вырезанным ртом все эти вещи Мы очень четко отслеживаем и наш алгоритмы позволяют определить фейк это или не Фейк Ну и на самом деле если говорить о лестнице то Существует несколько разновидностей этой вещи то есть кооперативные и не кооперативные кооперативные это когда вас просят повернуть голову сделать какое-то действие но при в данном проекте Мы конечно такие Life нас использовать не можем мы используем не кооперативную наши нейросети в том числе отслеживают соответствие фона соответствия геометрии головы там и плеч Head & Shoulders так называемый и еще несколько параметров в принципе на lightness мы тратим порядка менее десятой секунды То есть это очень быстрая операция но довольно важная собственно после того как мы за детектировали человека проверили его на life нас Мы нормализуем изображение чтобы Дальше он вошел в систему распознавания это тоже довольно быстрая операция Но для нас она важная далее из нормализованного изображения мы избегаем дескриптора как вот Гусейн уже говорил то есть дискриптор это Вектор многомерном пространстве признаков лица мы используем порядка 40 различных признаков и извлекаем Вектор который весит 512 байт по-моему То есть у нас один из самых легких векторов и далее он в общем-то направляется на матчинг то есть матчинг это сравнение вектора С другими векторами в системе довольно тоже быстрая на самом деле операция и в общем-то очень точно она зависит от различных настроек сетей в том числе В общем в нашем случае Конечно мы используем алгоритм идентификации когда мы получили лицо на камере мы пытаемся найти его в списке В списке которые лежит на локальном сервере я объясню дальше Почему мы так делали то есть на самом деле Одно из самых важных наверное вещей которые проекте сложились это различные условия на различных станциях метро в части освещения в части засветов вот там сейчас мы запустились на мцк там вообще все намного интереснее на самом деле Потому что некоторые станции находятся на улице и в общем-то когда яркое солнце получается засветы на камерах что мы в этом случае делали мы во-первых предоставили эксплуатирующие компании много различных настроек в том числе позволяющие регулировать там и размер лица и подхватывать раньше треки и отправлять раньше басоты и конечно же тут настройка идет на самих камерах это тоже очень важно Ну и также у нас сейчас идет тестирование не камергэбэшных а устройство планшетов с подсветкой то есть ну на наш взгляд это сильно очень поможет облегчить и ускорить все это дело потом что важно для пользователей этой системы Это в общем-то время прохода чего мы там тестировали с ребятами очень много времени и пришли к тому что на всю на весь наш paypeline компания Vision labs которая этим всем занимается отводится примерно 70 секунд То есть это от детекции до в общем-то мачинга который выдает результат то есть это очень жесткие условия на самом деле но очень важно чтобы людям было удобно пользоваться то есть человек подходит и в общем-то тут же открывается ему турникет Ну и наверное тоже было интересно решение это на каждом вестибюле стоит отдельный экземпляр системы целиком на самом деле почему это сделано потому что очень важно не допустить перерыва работы нашего сервиса с коллегами при например отключении интернета то есть где-то соде лежит большой сервер который собирает информацию с мобильных устройств для того чтобы рассылать списки дальше по станциям как вот Гусейн говорил раз 15 минут И на самом деле на каждом вестибюле стоит экземпляр нашего сервера с коллегами которые обслуживают конкретные вестибюль а то бишь сейчас это две миры которые находятся по углам прохода и по-моему одна камера на кассе где-то вот так соответственно есть планы по расширению на каждый турникет можно ставить систему ФСП ну и соответственно будут обновляться эти сервера Интересно как мы это запускали на самом деле запускали мы это долго Правда долго Почему Потому что ну для начала Мы протестировали конечно все у себя то есть мы себе купили такой же турникет который стоит в метро такую же камеру все у себя поставили в своей лаборатории и начали все проверять вот здесь вот я на кадре Жалко что без видео Я там как раз тестирую лайк в нашей лаборатории собственно дальше мы прежде чем пойти в метро мы протестировали все это в лаборатории метрополитена сделали все то же самое показали нашим уважаемым коллегам как это все работает вместе с ними длилось это порядка пары кварталов примерно Ну в том числе после того как мы убедились что и по времени и по засветам и по различным темным историям мы проходим и в том числе и отклик от банка и риск первой транзакции мы все понимаем далее мы пошли Выбрали с коллегами одну станцию метро где все это запустили и стали это тестировать на сотрудников метрополитена которые ходят бесплатно в метро и в общем-то обязали их ходить через все это тестировали на довольно нагруженные станции по-моему Проспект Мира Это был насколько я сейчас помню после этого на самом деле мы взяли целую ветку метро там все тестировали на этой ветке потом запустили все ветки метрополитена и все тестировали на сотрудниках то есть тестировали довольно долго потому что ну были нюансы как я говорю на каждой станции свои условия работы на самом деле Ну именно по освещению что очень важно как оказалось то есть здесь нужно обратить на это внимание ну а после того как мы вошли временные рамки после в тот пайплайн который был задан техническим заданием мы стали запускать обычных людей Вот они до сих пор пользуются Сейчас порядка мне не даст соврать 200 тысяч наверное пользователи метрополитена И как это все так это все и продолжает расти Ну и собственно наверное завершая свой разговор хочу что после метро Мы ушли на мцк потом будет мцд сейчас идут тесты на подвижных составах которые ездят на улице на поверхности Ну то есть это автобусы трамваи Витязь и все такое поэтому мы считаем что проект успешен имеет перспективы и продолжаем развиваться в этом направлении в том числе и на речных трамвайчиков которые анонсируют мэр Москвы недавно и так далее коллеги я наверное вкратце попытался вам рассказать как это все запускалось готов с гусейном ответить на какие-нибудь каверзные ваши вопросы Спасибо а-а Скажите пожалуйста есть какая-то статистика false Используйте Фрейда то есть Фолз негатив Понятно ты не прошёл и всё А вот фолпозитив это означает что кто-то потерял деньги собственно есть у вас какая-то статистика такая Спасибо но давайте я отвечу Да статистики такой у нас нет у нас всё немножко по-другому работает на самом деле Ну почему нет Я наверное попытаюсь объяснить потому что это в общем-то закрытый контур и к нам обращаются если есть какие-то проблемы скажем так да то есть к нам приходят заявки например да человек не прошел По лайфхак на конкретной станции нужно понять почему когда люди проходят и мы тестировали самое интересное мы тестировали потоковую очередь и в общем-то когда идет Час пик люди идут друг за другом прямо расстояние очень маленькое они должны быстро проходить и в общем эти все алгоритмы Мы тоже тестировали поэтому Ну отвечу на ваш вопрос скорее нет у нас такой статистики потому что ну это позитивный сценарий Это не проблема И поэтому нам об этом просто не сообщают а Можно нет А какие модельки под капотом используете для детекции людей Что значит модельки но не растевые модельки для определения подставок лица Вы имеете ввиду какие мы нейросети используем самое интересное у нас свои нейросети Мы свои модели используем мы не брали что-то бесплатно китайское в свое время а именно разработали свои нейросети у нас свои детекторы собственного производства и в общем мы даже их устройство на свои ставим тоже У нас есть устройство поэтому именно Наши нейросети все это делают а можно тогда в загонку вопрос А на каком железе все это работает железо но смотрите если мы говорим о вестибюле это три потока самая тяжелая операция это детекция То есть это работа с видео это наиболее сложная операция У нас внутри потока сейчас используется 16 виртуальных ядер 8 физических и 32 оперативы то есть вот так в том числе мы можем работать и на GPU CPU все что угодно поэтому мы тут гибкие в этом плане но цена цена качество как бы здесь в данном случае была задача И на самом деле железо это ну впритык на самом деле если мы говорим о детекторе это где-то ядронопоток и пол гига Но мы же сейчас говорим о целой системе которая стоит на этом же не только мы стоим там еще стоят сервисы которые отправляют информацию в банк в том числе информацию на турникет и вот такой вот железо Впритык Понятно спасибо пожалуйста я еще хотел спросить по поводу Фолз Позитив Настя вот если все-таки ваша тема другого человека списались деньги от того как-то отслеживаете эти случаи Ну у вас есть какая-то не знаю такие кейсы тут Наверное гусей Ну допустим у кого-то вашу систему там Близнец Пошёл Да допустим славный и другого человека списали здесь деньги то как бы я отвечу ответить да но я скажу я дополню как мы работаем с таким кейсами Близнецы это ну это прям проблема это проблема у всех почему Ну потому что нейросеть она работает как глаз по сути человека да то есть если человека можно обмануть Скорее всего вы нейросеть обманете то есть что касается близнеца Можно прийти в банк с паспортом своего брата-близнеца и получить кредит потому что ну это очень похожее люди Просто у нас если семья дети больше 95 значит человек мы его распознали проходим разница между близнецами 10 доли процентов то есть 90 там 998 очень сложно настроить таксистему поэтому Близнец К сожалению пройдет Да И теперь я скажу работаем с такой обращение к нам пришло во-первых мы не имеем доступ к самым лицам мы не можем это проверить с точки зрения именно физически посмотреть вот они же похожи там такого мы не делаем мы у нас четкая политика что мы возвращаем деньги сразу Какой самый курьезный кейс который за вашу практику вот внедрения случился смешное грустное просто любопытное есть грустная один Например у нас был два проекта они были связаны проект был про виртуальную тройку дать человека была тройка в телефоне и он сдал лицо еще одновременно Он подходит турникету прикладывает свою тройку и забыл выключить Face Pay То есть у него одновременно и там списалось а потом и такие потом стало много то есть они пишу Вы ребят UX Следующий вопрос Спасибо большое за доклад Вопрос такой частично мне уже ответили но тем не менее вы сказали что дискриптор состоит из 40 параметров правильно сорока измерений вот Какое минимальное количество из этих 40 измерений должно совпасть чтобы система выдала матч немного не так это работает поясню мы анализируем порядка 40 признаков лица То есть это пространство каждый признак это пространство сорокомерное пространство в нем строится Вектор вот как этот Вектор получается но это нейронная сеть должна сказать Она не ответит на этот вопрос Вот И чем ближе два вектора друг другу Тем более Тем больше вероятность что это одно и то же лицо скажем так чем дальше тем меньше Поэтому если человек одевает маску девает очки одевает шапку то Вектор строится дальше от исходного изображения вот в этом проблема на самом деле то есть я не отвечу на этот вопрос хорошо спасибо Следующий вопрос совсем недавно буквально полторы недели назад было новость о том что в Петербурге хотят тоже вести пользователи обычных людей были строго негативные потому что все беспокоятся о приватности своих данных соответственно два связанных с этим вопроса первое используете ли вы данные проходы людей которые действительно по ФСБ для до обучения модели и второй Как происходит защита данных людей которые не хотят им пользоваться но тоже проходят через эти турникеты либо рядом Спасибо данная людей ФСП для обучения мы не используем Ну это не имеет смысла там слишком маленькая мы использовали в свое время когда настраивали это все видео когда мы сами ходили записывали видосы и вот обучали именно не сеть А на стройку того как это должно работать сеть у нас ну смотрите мы компания которая опять же я про них говорил которая постоянно обучают сети если вы в какой-то момент Остановитесь Вы выпадаете из этого рейтинга Ну и становитесь не интересно на самом деле то есть если говорить о том что у нас сейчас стоит 56 сеть мы готовим обновить на 59 на самом деле у нас уже 61 обучается и внести это мы на втором месте находимся поэтому поводу но и смотрите что касается Московского Метрополитена Я не знаю тут какой-нибудь секрет открою нет у нас же помимо того что там facett стоит Мы же еще и ловим преступников то есть на каждом турнике висит вот эта вот камера Да которая отслеживает того кто прошёл соответственно отправляется без Шут из него строится дескриптор и по базам трехбуквенных товарищей МВД ФСБ и ФСО и так далее ищется о преступник или это да и всё то есть мы не собираем персональные данные пользователя то есть мы дескриптор как это фарш обратно в мясо не провернуть из дискриптора нельзя получить изображение лица это необратимая операция поэтому поэтому важно то что ищется То есть если в базе ФСБ МВД еще чего-то лежит интересное лицо оно будет искаться если его там нет ну собственно Значит ты никому не нужен и все Анатолий Скажите как у вас камеры работают да как у вас камера работают с детьми подростками и прочими мы пользоваться не достигнув 17 лет это что касается ФСБ а что касается распознавания нормально работают абсолютно я дополнил свой вопрос Окей бывают люди 18 лет но невысокие проблем нет У нас вот разные кейсы У меня даже в отделе есть люди там два чем-то и метр шестьдесят до проблем Нет единственное что им давать человека 2 метра приходится чуть-чуть присаживаться Но это таких людей мало спасибо Ну и на самом деле это регулируется все настройками то есть такие понятия как Рой дрои зона интереса в кадре и можно их там регулировать еще хотел спросить а по быстродействии системы насколько она работает быстрее чем обычная карточка допустим Если платить Ну то есть тройкой условной Ну давай я попробую давай ты я напомню что я пользуюсь и карточкой и ФСБ в метро чтобы мне достать карточку Мне нужно открыть мою сумочку портмоне из неё достать карточку предложить порядка нескольких десятых долей секунды всё открывается я прохожу по ФСБ я ну не достаю ничего подхожу и меньше секунды проходят прежде чем турнике открывается примерно одинаково Ну наверное вот если так если касается пластиковой карточкой то быстрее кольца почему-то не зашли А у меня вот есть на самом деле если посмотреть на вот мы показывали турнике Да есть он естественно все ридер который читает пластиковые тройки они естественно быстрее потому что первоначально история да то есть все настройки в виде ФСБ и банковских модули и потом поэтому ФСБ чуть медленнее но опять же могут коллегам предоставали жесткие требования У нас есть такой как бы бенчмарк бенчмарк то есть Нам нужно определенное время уложиться иначе в час пик будут большие пробки из людей и это будет плохой Для нас показатель вот я просто посмотрел во время доклада как эта система работает я видел что там с темы нужно встать то есть подождать пока когда ты проходишь вот когда ты скажешь не останавливаясь и сразу проходишь соответственно как будто бы оборот людей в таком случае выше не оставили карточки по времени примерно также получается потому что тоже своеобразная архитектура мы сейчас не будем в рамках этого да А если вы имеете прабанковскую мы сейчас говорим Да там своеобразно это уже история и мы очень долго боролись банками чтобы она работала быстро потому что любой банк хочет транзакции в онлайне было выбрано именно камера допустим не отпечаток пальца или что-нибудь ещё вот а потому что мы же в начале клада сказала у нас все турникеты уже заранее были оснащены камерой то есть Нам нужно как это сделать чтобы мы потратили меньше денег получили больше результата здесь просто вот Следующий вопрос из правой части зала прошу переворачиваете его со всеми людьми которые есть базе данных или же есть используется какой-то более оптимальный алгоритм для этого нет все правильно есть список людей которые зарегистрировались Ну там список интересов назовем его так Да и здесь идет один ко многим матчам то есть мы именно поэтому списку но он Естественно индексирован он естественно быстро и всё такое вот то есть операция довольно легкая на самом деле там на нее тратится наверное сотые доли секунды самое тяжелое как я говорил это уже это детектор понял спасибо еще дополнительно добавлю то что мы допустим человек только создает приложение своё лицо там еще дополнительно тоже продвигаемся по всей базе векторов и смотрим если дубль мы не пускаем плохие дескрипторы локальные сервера важно всего 40 признаков то есть 40 каждый признак это какое-то число Нет это пространство интереса пространство интересов то есть из этих 40 признаков вы зафигачить не можете из каждого отдельно А какой смысл Нет мы строим Вектор в этом многомерном пространстве которые вот есть в общем-то descript чтобы искать по индексу например вот сервисы которые детектит музыку они используют Вот какой-то fingerprints то есть они из музыкальной композиции выделяют какие-то признаки затем от всех этих признаков считают какое-то одно достаточно большое число и говорят что вот это вот число это псевдоникальные отпечаток Да и быстро его сравнивают вот я так понимаю когда вы ищете по базе вашего клиента или ещё кого-то вы немножко не так делаете вы всё-таки Мачете именно мешочек с признаками к мешочку признаков у каждого человека в базе мы сравниваем два вектора Вектор это и есть в общем-то уникальное изображение лица на всех этих там сорока плюс признаков то есть мы по сути мы делаем то же самое всем Бендеры делают все то же самое разница между нами на самом деле она кажется может быть и небольшой но важной это Кто быстрее Кто легче делает и кто качественная матч но при этом все равно база при ваших объемах делает это за долю миллисекунды то есть очень-очень быстрая операция и ну и причем уже говорил в банке Мы направляем в банк направляемую информацию параллельно с тем как открываем турнике то есть ну риск первой транзакции никуда не девается"
}