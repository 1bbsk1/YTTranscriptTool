{
  "video_id": "5iMatZVLUFE",
  "channel": "HighLoadChannel",
  "title": "Разминируем свой код чем искать уязвимости и дефекты безопасности / Илья Поляков (Angara Security)",
  "views": 86,
  "duration": 1934,
  "published": "2023-10-06T07:23:13-07:00",
  "text": "Добрый день Уважаемые коллеги действительно доклад посвящен разминированию кода конкретно PHP кода Меня зовут Илья Поляков Я работаю в компании Ангара Security это системная интегратор в области безопасности который предоставляет широкий спектр услуг аутсорсинговых в частности анализ исходного кода за который отвечаю я вот до этого я также внедрял безопасную разработку в таких компаниях как онлайн Technology как Промсвязьбанк и Аби Ну соответственно нажал какое-то количество сертификатов в области безопасности вот в частности по Джаве и по ажуру Microsoft of о чем мы все будем говорить Для начала Что такое мины Да в исходном коде то есть мины это некоторые не только уязвимости но и прочие дефекты безопасности которые так или иначе эффект безопасность в плохую сторону и ну ухудшают качество софта с точки зрения безопасности соответственно тоже разберемся Какими типовыми путями минеруется ваш код и какие собственно мины Какие типы самые популярные на более актуальны особенно в контексте веб-программирования и PHP ну и наконец чем собственно лучше разминировать код чем Какие уязвимости дефекты безопасности лучше находить максимально быстро и дешево значит Ну сразу оговорюсь о чем не будем говорить и наверное не имеет смысла большого задавать вопросы на эту тему То есть это прежде всего всячески динамический анализ то есть даст поезд там включая фазинг это сканирование контейнеров Несмотря на то что сейчас конечно все так или иначе уходит там клаудейцев и в контейнеры это не будем затрагивать это отдельная тема хотя и там уже в принципе сейчас есть вот собственно анализ кода в том смысле что инфраструктура сейчас более технологируется и уже сама превращается в кот который её развёртывает соответственно там тоже есть свои сканеры но мы их тоже не будем затрагивать ну и плюс есть еще различные runtime инструменты безопасности приложений типа weboplication Firewall и раз это тоже фактически глубокий такой фаервол тоже не будем их затрагивать и перейдем собственно к источникам проблем в исходном коде то есть вот у вас есть репозиторий с кодом Какие собственно источники источники Как ни странно это ваша команда разработки которая так или иначе помимо там Понятно хорошего большого объема хорошей работы иногда допускает там некие неточности и отгружает вход а-а Ну собственно уязвимости Да в вашем ходе именно в том коде который пишут разработчики кстати вот тоже чтобы понимать аудиторию просьба среди офлайн участников поднять руки Кто знает что такое SQL инъекция отлично А теперь кто знает что такое кросс-сайдскриптинг Тоже неплохо Ну хорошо Значит мы будем на одном языке говорить соответственно есть Да есть код уязвимый код плюс из хаба там гитла бы прочих источников подтягиваются ваши проекты различные посошные компоненты которые тоже содержат в себе уязвимости особенно устаревшие понятно там какие-то версии и как бы тут ещё ужас в том что о них знают более-менее все и соответственно могут их эксплуатировать Вот и также в код попадают кожаные секреты это вообще бич современной разработки Там не только PHP потому что ну понятно для скорости всегда проще за хардко ходить пароль или там apitalkin э и так далее а потом он даже если файл будет удалён в репозитории всё равно в истории коммитов у нас останется и э-э собственно будет доступен всем желающим кто имеет доступ к репозиторию Ну и как бы это отдельная проблема в том что иногда репозиторий с кодом еще уходят куда-нибудь на github публичные репозитории вольно или невольно и соответственно уже секреты становятся доступны вообще всему интернету вот ну и фактически Да вот собственно текстом тут прописано что Да есть секреты есть уязвимый код с потенциальными уязвимостями и уязвимые заимствования относительно Недавно вышел у вас топ тэн по уязвимостям Соответственно что тут можно видеть Ну во-первых они наконец-то додумались всё-таки объединить кровь стать скриптинг А в категорию инъекции его засунуть э Но несмотря на это инъекции с первого места упали на третье место то есть э видимо за счёт того что всё больше внедряется там ормки и там может быть растут популярности какие-то тоже там паттерны программирование которые в которых сложнее себе в этом смысле ногу отстрелить э то есть инъекции сейчас существенно упали Но это в среднем по больнице вот значит что касается вообще числа уязвимостей то есть есть статистика попытство бывшая компания White Source называется Сейчас mand она анализирует уязвимости в Open sarcia и видно что ну такая некая там намеки на сингулярность Да намечаются в количестве уязвимостей То есть за Двадцатый год резко их выросла там почти удвоилась количество именно вот он совсем не только PHP Ну Казалось бы наверное может так просто бодро растет поэтому и естественно уязвимости тоже растут Но если посмотреть на количество вот на правом на правой диаграмме количество активных проектов и количество активных пользователей Это столбики то видно что там ну как-то сингулярности не намечается более-менее линейный рост э красная линия - это Это количество событий то есть всякие там коммиты форки мерджи ну фактически как комменты все что угодно то есть видно что Ну наверное работа с гитхабом и прочими репозиторами интенсифицируется Но количество там проектов юзеров особо не растет а при этом уязвимости находят гораздо больше Вот и Если посмотреть разбивку по языкам потому что одни языки больше подвержены другие меньше видно что и сравнить вот за один год как раз 2019-2020 как у нас росли э количество уязвимости видно что печь перестал лидером по количеству уязвимости и Обогнал даже и причём динамика Ну довольно пугающая У меня на самом деле нет какой-то однозначного объяснения этого соответственно Если у вас есть как у профессионалов в PHP разработке просьба писать в комменты было бы интересно ознакомиться с гипотезами вот собственно на первом месте если посмотреть в разрезе типов уязвимостей которые встречаются в opensorsi тоже за 20 год статистика последнее что доступно соответственно первом месте это у нас кроссой скриптинг в принципе вот если заблюрить всякие хищные уязвимости типа там буфер Flow и так далее то видно что у печки на первом месте кросс-скриптинг На втором SQL инъекция на третьем там csrf-ке Вот соответственно видно что у HP инъекции по-прежнему стоят э-э фактически на первом месте особенно если сложить скриптинг и инъекция которая всего лишь на седьмом месте тоже ну там не очень объяснимо Может быть плохо внедряются фреймворки и там параметризованные запросы да э это что касается SQL инъекции Что касается кросса скриптинга У меня даже особых идей нету вот Ну тем не менее Вот статистика такая не очень хорошая значит что Что такое проблемы заимствованного кода то есть да это устаревшей версии с известными уязвимостями плюс еще усугубляется это тем что в принципе код открытый и там тоже могут быть Zero Day и целенаправленной атаки какого-нибудь высокопрофессиональной группировки они могут в принципе озаботиться поиском уязвимости сначала понять Какие консольские компоненты используются там вот такую нам проекте уже найти их Исходный код его там разобрать нам молекулы и найти там какую-нибудь Вот это тоже на самом деле проблема для крупных проектов помимо этого есть такая вещь как закладки в тех же там Понятно В библиотеках Там не только там более-менее условно патогенные до протестварь который там может какой-нибудь вывести сообщение но и там более какие-то серьезные могут быть уже сделаны дырки причем Для этого даже не надо что-то добавлять как бы закладка она воспринимается что мы что-то вот дописали в код не обязательно то есть вот у нас был на ангаратах дей мы демонстрацию делали как мы ломаем приложение соответственно Я готовил стенд для этого и взял хорошее приложение чуть-чуть его пофиксил грубо говоря испортил алгоритм сортизации юзерского энтута буквально там э-э несколько байт в одной строчке и всё и появилось уязвимость причём даже не находили я специально проверил коммерческие сканеры э-э со сканеры её Не находили и как бы размер кода не увеличился даже чуть уменьшился но пожалуйста вот у вас закладка значит Ну и есть еще тоже такая тема которая может уже менее актуальна на фоне всего остального это как лицензионный конфликт когда мы включаем какие-то посор с компоненты Оказывается там сразу Или потом что лицензия несовместима там с нашей коммерческой деятельностью что Мы обязаны там Исходный код тоже раскрывает раз мы их используем такое тоже бывает Значит проблема собственного кода Ну во-первых понятно Если вы как пишете каждую строчку кода как бы простор для того чтобы ошибиться и напортачить гораздо больше чем если вы там крупным узловую какую-то сборку делаете И так далее плюс проблема там если в пансорный у вас библиотека уязвимая Ну её Обновили версию обычно там есть обратная совместимость и она действительно работает и в этом смысле просто в своем коде уже там как бы вас своей кастомные кастомной уязвимости дефекты безопасности и их соответственно требуют кастомных исправлений и при отсутствии sla это часто может затянуться потому что ну как много у кого нет Slip по исправлению уязвимости и как бы в отсутствие при наличии политической воли руководства что давайте отгружать фич И скорей часто исправлению уязвимости отходит на второй план особенно там с аргументами такому кому нужны Это так просто не найдешь такую дорогу Ну и как ни странно когда уже уязвимость в проде это часто плохо влияет на скорость ее исправления потому что ну понятно провод всегда фиксить это дело такое довольно аккуратное и как бы возникают проблемы значит третий тип последний уязвимости это ну вернее дефектов безопасности это проблема зашиты вход секретов Просто я уже говорил отучить разработчиков не хардкодить секреты там во-первых не просто во-вторых мало просто сказать там не хардкоть пароли нужно предложить какую-то альтернативу которая включает в себя темы менеджмента секретов и это её внедрение это некая отдельная уже дело плюс вот эти там всякие паролик системным учеткам Они часто повторяются потому что у меня на одном из предыдущих мест работы как бы был голосование по выбору надписи на мерче и один из вариантов был Он правда не победил но был близок это наиболее часто встречающийся пароль для системных учёток То есть это уже некий цирк начинался с этим вот и у того же работодателя кстати был когда я только начал заниматься Секьюрити там обнаружил что у любого сотрудника есть там из нескольких тысяч был доступ к более там тысячи репозиториям исходного кода то есть любой мог полностью все гид репозитории скачать и там уже искать кожаный секреты вот ну и там встречались допустим секреты которые там по 9 лет актуальны системных учетах в том числе продавских вот Ну и как бы проблема еще в том что даже удаленный секрет он не исчезает из истории коммитов как я уже говорил его можно всегда найти И даже если вы допустим просканировали saast инструментов большинство из которых находит Захар кожаный секрет а он вам Скажет что все Окей значит ничего не нашел а в истории коммитов там можно легко найти соответствующими инструментами вот ну и да и плюс бывает утечки еще на github Когда у нас заход кожаный пароль утекает публичный репозитории и там есть даже на западе такой стартап называется Get gardian который как раз э-э 24/7 мониторит у своих для своих клиентов весь github смотрит Ну во-первых он определяет Какие репозитории имеет компании там по подменным всяким именам и так далее и смотрит не за хардкоженный не закомить или какой-то захардкоженный пароль и старается как можно быстрее об этом доложить но это не Панацея в том плане что вот у нас был инцидент когда один слава Богу там независимых белых хакеров доложил нам что вот у вас нашелся за хардкоженный секрет в гитхабе он сделал раньше вот этот самый гитхардиенгардиен То есть как бы ручная в этом смысле работа Она получилась эффективнее чем автоматизированный сервис вот компании которая занимается этим Ну собственно какие инструменты есть по разминированию типы инструментов в первую очередь ну понятно секретами наверно проще всего потому что это фактически там не программирование их нужно просто убирать из кода сначала находите в коде убирать и что может быть недостаточно сейчас внедряется это предотвращать их попадание в Исходный код для этого существует На самом деле инструменты которые довольно изящно встраиваются путем гитхуков собственно система хранения кодов и позволяют отпинывать коммиты с подозрениями на секреты Ну понятно там есть ложные срабатывания это можно там все whitel ре гексами и так далее Ну вот это из наиболее эффективных инструментов фактически значит Кроме того там те кастомной уязвимости которые разработчики прописывают в коде их против них фактически только есть инструменты статического анализа если мы говорим про статику Вот именно состы сканеры и наконец собственного композиция аналасис сканеры отвечают за поиск уязвимых компонентов причем включая там какие-нибудь транзитивные зависимости которые Вот у того же Lock for J они встречались там и на седьмом Да на седьмом уровне транзитивности то есть там нужно действительно копать глубоко Какие доступны актуальные Особенно для России для конкретно печь инструменты sast импортные фактически можно вычеркивать все единственное чек марксом не очень понятно То есть была информация что он вроде ушел Сейчас вроде уже другая информация что не ушел Ну там видимо нужно плотно общаться с вендером но опять же наверное есть какие-то риски что можно пролететь из отечественных фактически коммерческих решений только два инструмента которые работают именно с PH потому что там что касается сии плюсов Java их существенно больше но по PHP только получается позитивовский Application spector и саларовский абскринер Вот они кстати включают в себя на самом деле еще под капотом инструменты композиции то есть они и умеют вычислять уязвимые библиотеки версия библиотеки Ну и за пансорса вот всем греп начал недавно поддержку PHP он тоже что-то находит в принципе но э-э и ещё есть у вас АСТ который фактически только p.p умеет а сканировать не очень хороши тем что они с точки зрения безопасности с точки зрения разработчика они приятны тем что они быстрые Но это скорость она даётся не бесплатно а за счёт того что их анализ недостаточно глубоко то есть там в основном всякие реексы синтаксический анализ там нет межпроцедурного анализа Когда у вас там э дата Flow э раскидан по нескольким классам допустим и они это легко пропускают Соответственно по оси У нас есть опять же там импортные синапсе с блэкдак снык сны Как кстати есть в принципе если через VPN ходить то там есть опенсорная бесплатная версия которая позволяет сколько там порядка 100 сканирований в месяц сделать и сканировать неплохо соответственно для небольших проектов там для каких-то спин-оффов стартапов и так далее это может быть первоначальным решением которое nvp позволит собрать и просканировать довольно быстро Ну опять же есть чекмакс вроде бы из отечественных на данный момент наверное только вот скорин там есть ещё вроде некий фактор э пока он недостаточно активен На рынке но вот основной - это код скоринг и он работает конечно лучше чем классический потенциал собственные инструменты вот и больше там у него бац уязвимости и вообще это гораздо удобнее Ну и последний собственно типу уязвимости это это секреты за хардкоженные тут с одной стороны как бы дефект безопасности очень простой понятный Но с другой стороны устранять его не так-то просто То есть нужно Помимо того чтобы там вычищать постоянно код и секретов либо предотвращать их попадание Желательно это соответственно Нужны еще хранилище секретов чтобы дать разработчикам некую надежную альтернативу за хардкоживанию И это не там не какие-то костыли там не зашифрованный вроде бы секреты в там в каком-нибудь лабе Да там отдельно хранятся А более-менее уже такие интерпраздные продукты это прежде всего они у них есть государственной версии достаточно неплохие там для большинства проектов Но если там требуется какой-нибудь распределенные там системы уже действительно Там прям совсем-совсем хайло да то они скорее всего не подойдут их бесплатной версии а платные соответственно недоступна для России Вот и этом некоторая проблема на данный момент который в принципе можно решать уходом в облака прежде всего там видимо Яндекс из берклауд которые имеют собственные сервисы по управлению секретами и у них все хорошо Единственное что если вы будете мигрировать из одного Облака в другое вам придётся какую-то работу Проводить по по переделке потому что естественно фишки у них разные Ну и тоже вот мне нравится такая аналогия с антивирусами именно инструментов безопасности это Ну то есть статический анализ Он позволяет находить там Zero Day И неизвестную уязвимости это точно так же как эвристический анализ у антивирусов позволяет находить неизвестную ранее молварь Ну и в принципе этим инструментом наверное там можно да и секреты искать и даже сканировать опенсорсные библиотеки на предмет уязвимости Но это будет крайне неэффективно точно так же как Как именно Как с точки зрения detection Raid так и с точки зрения фолз-позитив Вот точно так же как антивирус бы на одной эвристике Он давно далеко не уехал вот поэтому есть такая вещь как компонентный анализ который аналогичен сигнатурному сигнатурному анализу уязвимости у антивирусов вот Ну и как бы это не анализ кода я уже говорил что мы только про анализ кода но тем не менее для полноты картины динамический анализ он фактически соответствует песочнице антивирусов вот плюс к этому естественно никто не отменяет ручной код review и он наверное самое такое лучшее средство против обнаружения закладок потому что компьютер обмануть и там статические анализаторы гораздо проще чем человека ему позволяет воздействовать на свой на заимствованный код плюс особенно рекомендуется для все-таки проведения анализа критических компонентов и потоков данных в частности там аутентификация восстановление пароля вот эти все вещи которые статические анализаторы потому что они не понимают бизнес логику Они часто очень пропускают уязвимости компоненты реально критические это дорого и человеческий фактор человек не выспался пропустил какой-то уязвимость в этом смысле это предсказуемый метод Ну и что касается вот часто аргумент который при статическом анализе возникает что нашли уязвимость даже показали Как можно про эксплуатировать Говорят это невозможно найти снаружи потому что нужно знать кото-код у нас там не оппонсорс никто не найдет вот буквально двухмесячный давности но новость про то как uber поломали и там как раз утек Исходный код соответственно все уязвимости которые действительно сложно было найти снаружи их уже можно найти имея код Ну и тоже проблемы там у сканера кода они естественно возникают не в процессе встраивания их там в конвейере разработки вся семья они возникают уже в процессе эксплуатации Потому что нельзя просто встроить сканеры pipeline там все как бы вроде наладить и расслабиться потому что они сгенерировать кучу срабатываний и нужен кто-то кто будет отделять вот эти крики постоянные волк волк со стороны сканеров от реальных Волков и там важно их не пропустить чтобы глаз не замылился Вот Ну вообще Безопасность это такой конкурс по компанию с одной стороны у нас есть там плохие ребята которые пытаются нарыть уязвимости и про эксплуатировать с другой стороны есть безопасники которые тоже копают и в этом смысле разница в квалификациях может стать легко критическим потому что Чем выше квалификация тем глубже Ты можешь копнуть и если противник копает глубже тебя Ну рано или поздно э-э этот дисбаланс он реализуется в виде инцидента Вот и Ну вот собственно инцидент Он часто служит триггером увеличение бюджетов безопасности которая там на данный момент является недешевым удовольствием естественно но ее отсутствие часто еще дороже Ну и собственно никакой уже не удовольствие на этом я хотел бы закончить соответственно мои контакты тут вопросы готов ответить на них Спасибо Спасибо большое так Мы готовы выслушать ваши вопросы просто Спасибо большое за доклад У меня два вопроса каких маленьких Дин Ну обычно с гитхабом Да в PHP с пакетами Мы работаем через компостер Вот вы знакомиться таким пакетом ролл Security 2dries Как еще раз ров Security 2 нет пакет который в конфликты ставит себе все известные пакеты которые попали в разные списки недопустимость при попытке обновить у себя композитор вы получаете просто отлуп что такую версию не берите она не подходит насколько на ваш взгляд вообще можно доверять вот таким пакетам которые помогают в безопасности или это наоборот еще больше туда кто-нибудь залезет и вам Ну это как описание выглядит немножко костыльным но в принципе наверное сам принцип такого сама идея Она имеет право на существование и при правильной реализации Мне кажется это вполне вполне неплохой инструмент Ну в последней версии composer уже интегрировали команду composer audit которая этот пакет уже можно не использовать она просто сверяется с базой и версии где которая CV Ешки содержит и ругаются на них Вот Ну а сам пакет Мне кажется он особо особых проблем не принесёт он же исключает просто версии и Хмм и и всё то есть у него Ничто на себя другой не берёт самое худшее Что может случиться это вы не поставите версию конкретную какого-то пакета но поставить другую Ну да ну кто из нас потом честно проверяет что там вендор положилось некоторую Ну как все в опенсорсе что-то известное то вероятность того что нет что-то эдакого она повыше чем если пакета Два контрибута 2 Да И вот второй был как раз там был график по поводу того что большой рост уязвимости в PHP а известно как собирались просто исходные данные для этого графика Ну фактически у каждой цв Ешки по сосу там есть ссылка на соответствующие репозиторий э и там даже накормит как правило которые фиксируют исправляет эту уязвимость поэтому грубо говоря из базы данных по cveшек в свшем эта информация берётся вот ну просто там как бы такая логичная гипотеза может быть что много пакетов рождается как бы без целей там для коммерческой разработки Да без изначального захода на безопасность и потом допиливаются PHP рождает большое количество достаточно вещей Они конечно поначалу именно уязвимые опять же ну заложить туда код с комментом что поменять потом это на NF как бы это нужно святое дело Я думаю Поэтому просто как гипотеза Спасибо большое Спасибо еще кого-то есть вопросы напоминаю зрителям трансляции что можно тоже задавать вопросы в чате Ну я тогда еще хотел спросить вот ты говорил тоже просто от анализ и слышал Нет про статическая анализатор псалом в печке нет слышал Да но я их даже на самом деле не стал включать рассмотрение потому что как и тот же э-э как его вот куэльсии нету по-моему да Ну просто они больше про качество кода С недавнего времени режим tint analis или который как раз проверяет Где протекает не валидированные данные Ну для этого требуется разметка ручная Я так понимаю да то есть там нужно где-то нужно подсветить Ну там встроенной функции все уже в нём внутри самом размещены да то есть сказано после них можно доверять нельзя данным вот ну и можно через плагин наверное тоже как-то модифицировать подход Ну да разметка потребуется Ты к тому что человеческий фактор который не исключает хорошо да Но все равно так думаю будет полезно посмотреть в эту сторону Жалко что правда псалом как-то в последнее время на мой взгляд не так динамически развивается из-за того что главный контрибутер его как будто бы выгорело он ушел с этого проекта Вот но пока все он еще актуален и вот тент анализ там можно попробовать союзать Ну что ж тогда все спасибо тебе большое за доклад тема безопасности всегда актуальная о ней надо напоминать как у Чехова да должен быть у каждого человека с молоточком кто-то стоять Ну вот про Безопасность это программирование то же самое нужно выбрать вопрос но у нас он один был поэтому очевидно Да спасибо вам большое за вопрос и тебе тоже подарок от конференции прошу вручить спасибо спасибо за доклад хорошего дня Ну что ж у нас с Вами через некоторое время будет tiktok о от мира платформ и потом доклад Дмитрия Мамонтова из магнита Так что приходите"
}