{
  "video_id": "a7A6y4AMHqQ",
  "channel": "HighLoadChannel",
  "title": "Глубокая аналитика скорости сайта / Николай Мациевский (Айри.рф)",
  "views": 126,
  "duration": 1629,
  "published": "2017-07-29T00:22:48-07:00",
  "text": "всем добрый день меня зовут николай мациевский я 8 лет занимаюсь скоростью доступностью сайтов мне сегодня доклад он продолжает доклад павла на тему скорости сайта я расскажу скажем так альтерн покажу альтернативный подход как вам понять что у сайта не так со скоростью и самое главное как понять что нужно сделать чтобы сайта все было так со скоростью что это вот самый сложный аспект то есть мы добились какого-то результата что нам делать дальше для начала у нас будет небольшой опрос небольшой опрос давайте по руки поднимаем те кто думаю что их сайта работают так что это за персонаж здесь как его звали ракета да вот персонаж ракет водку всех кто думаю что у сайт работает как ракета так давайте ну смелее но все мы в глубине души на это надеемся что наш сайт работают как ракета все хорошо быстро там одна секунда 2 секунды 3 неважным га ракета на самом деле реальность у нас немножко другая вот я есть грут вот вот примерно так и хорошо если он ходит вот он может не ходить он может только приплясывать на одном месте в браузере пользователя ситуация осложняется тем что времена скажем так медленного интернета они прошли и в принципе информация о том что нужно сделать сайтом чтобы он стал быстром чтобы он стал доступным а но они закончились у нас есть инструменты для анализа у нас есть большое количество инструментов для анализа у нас там есть аналитики счетчики там google поспи твой слову советы мы облажались томами этих книг мы выполнили все советы 100 и 100 результата нет но то есть он есть конечно какое-то там нажать и включена на сервере там еще что то там каширования там базовые вещи dns вроде хорошо отвечает вроде сервер быстрый никто не не сильно не ругается виджеты вроде как то под по тюнеры но sites равно отвечает очень медленно что мой доклад он призван ответить на вопрос что дальше что после того как у нас есть оценки 100 и 100 но до 1 секунды мы не добрались что мы можем сделать чтобы добраться до этой одной секунды повод метрикам баду или там по вашим метрикам до 2 секунд или или у нас будет не 2 секунд до 3 секунды можно вас тяжелое приложение и она вот быстрее не может отработать то есть что нужно сделать чтобы до этих метрик добраться но сначала мы да посмотрим на эту картинку и задумаемся что нам нужно сделать значит у инструменты у нас на самом деле уже есть как говорил роман в предыдущем докладе у нас есть поддержка api performance performance тайминг api который поддерживает на текущий момент порядка 80 браузер цифры немножко с потолка матом то растет попадает в целом большое количество браузеров что более важно поддерживают очень много мобильных браузеров то есть мы реально можем понять чем проблема пользователи которые сошли с мобильных сейчас я говорю про одностраничные приложение и про веб-сайт и я не говорю про мобильные приложения там у них они не браузер и если они не браузер это у них по-другому я сейчас больше больше про сайта что мы можем по поводу производительный сайтов понять с помощью этого api картинка это уже было я к сожалению знал но ничего страшного повторение мать учения хорошая красивая картинка можно на ней сидеть и медитировать значит в метрике которые мы можем собирать их достаточно много и в них можно запутаться то есть павел он очень хорошо привел несколько ключевых вещей на которые вы можете обращать внимание то есть у вас тут будет отвечать либо мне даже должен лазер работает но наверно не работает то есть у нас либо мы обрезаем по серверу по сети то есть у нас тут где-то здесь одна заканчивает отвечать сервер и у нас вот здесь вот такая большая метрика то есть все dns эти цепи все получение данных все время ответа сервера мы объединяем мы говорим что все на этому повлиять не можем это у нас там 04 06 секунд и меньше не сможем сделать если даже в каждый дом занесем свой сервер все равно нас будет 0 2 секунды в каждый дом но понятно что мы в каждом не заносим мой индекс тоже не заносит у него все равно это больше вот мы можем например все сжать еще сильнее или слабее там ограничиться только он low дом дом ради не брать в пример неважно метрик много они есть и есть большое количество инструментов которые их используют то есть в тот же яндекс метрики это все уже встроены все эти persantine том же google analytics это все встроена openstat год назад еще встроил new relic это использует pink дом это использует есть открытые пост решение будет хорошо если в них будете знать там бумеранг в частности от яха тоже использует импульс есть есть наши собственные решения тайри это все использует открытые данные от браузеров performance shoppe то есть те данные о скорости загрузки страницы или приложения которые которые прошли у пользователя то есть пользовательские данные они все доступны уже сейчас то есть они сейчас доступны есть большое колесо сервиса в которых используют картинка получается ну одна из картинок который получает это в частности плагин к браузеру недавно вадим блоге постил его он мне очень понравился агрегированный информация по загружены странице то есть эта информация чуть больше чем дает дает панели разработки но она к сожалению не полное чтобы принять решение что плохо то есть тот на самом деле там информации на 5 экранов то есть все времена тут там не знаю 12 метрик по временам данные по всем объектам которые на странице загружены по типу объектов по размер объектов и данные потом по сайтам то есть каких сайтов больше пришло данность каких меньше пришло в принципе такая классическая вас классический абсолютно подход там что мы берем запросы берем их анализируем цель моего доклада показать искать новый не классический подход который может вам по другому помочь взглянуть на проблему скорости проблему времени и поменять какие-то другие решения потому что все вот эта классика она там известно описано там эта диаграмма загрузки web с тестом это все вот все эти вопросы я думаю что если вы просто начинали работать со скоростью того обязательно задавались уже этими вопросами так или иначе на них отвечаю за сколько вам отвечает сервер за сколько у вас происходит событие там белый экран события дом ради в браузер чего загружается что можно отложить на ум но вот что нельзя отложить ноу но что происходит при переходе между разными страницами то есть на классические вопросы то есть не у вас есть вы с ними работаете это там ваше все просто дальше значит наваром естественно ответ на наш вопрос павел уже раскрыла значение термина реал и юзер мониторинг просто в россии он так или иначе не светился основан на западе светился но теперь я думаю сегодняшнего дня вы в курсе что это такое если у вас там попадётся статья на западных источник вы видите рам вы поймете что это не джонни дэпп с бокалом спиртного напитка это вполне нормальный метрики по скорости сайтом значит что мы можем по ним сказать но это там один из скриншотов там не яндекс метрика не google analytics мало значит видно что у нас основные проблемы это желтая зеленая часть немножко фиолетовая желтая часть это время ответа сервера зеленая часть это дом рейде то есть как минимум первый взгляд на вот на основные метрики по вашему сайту он сможет показать где может быть корень проблемы то есть для того чтобы например нам ускориться и два раза или там ну у тебя и у нас уже выполняет сердцем не вижу там полторы секунды или там чуть больше секунды то есть секунду нас выполняется на полный он молод но если мы захотели скорик баса и два раза основные моменты на которые мы обратили внимание что она загружается до событий одном рейде потому что но там порядка но 300 миллисекунд и почему у нас например так долго отвечает сервер может это основные блоки основные блоки задержек с которыми вы будете работать эту статистику вам даст любой любой из уже озвученных инструментов то просто там суммарно времена по по группам вы видите в какую группу попала больше всего секунд миллисекунд и значится именно с этой группы надо работать но вопрос как работать то есть что из методов оптимизации вам нужно сделал что вам нужно внедрить чтобы вы смогли добиться ваших китаев основной вопрос по поводу кипиа и в конце доклада павла был направлен но на это что вы сначала определяете кипиа и ваши то есть мы хотим чтобы страница была доступна для пользователей week загрузился интерфейс прогрузился за одну секунду отлично или за 2 секунды что мы должны сделать чтобы это произошло то есть у нас сейчас там сайт доступен через три секунды что нужно сделать чтобы стал доступен через две секунды потому что это ну повлияет на бизнес это там сверху спущенной метрика на важно вот что нужно для этого сделать там google pagespeed вам не даст на этот ответ он там скажется 100 и 100 вы молодец все хорошо но три секунды я не знаю ну вот прямо так основной вопрос что нужно нам сделать чтобы сайт стал быстрее у пользователей в реальных пользователей собрать по ним данные это может быть совершенно различные срезы как правило уже упомянул а то и по странным по браузером по устройствам по страницам о каком-то времени суток то есть у нас на пир утром там из какой-то страны может быть долго или у нас были случаи что там монтаж в районе шести вечера приседал канал и просто скорость скорость падала время загрузки возрастала это все хорошо видно будет помад тому мониторингу которую вы сможете настроить или будете использовать любое из там решение существующей сейчас на рынке значит мы можем для это для ответа на вопрос что конкретно нужно сделать чтобы сайт стал быстрее использовать функционал не юзер тайминг который повел очень хорошо озвучил но ресурс тайминг функционал ресурс тайминг частности функции get entries get entries она выдает данные по задержкам по каждому объекту вашему то есть по всем картинкам по всем стилям по всем скриптом по всем джейсон запросам и так далее так далее то есть все запросы которые были на странице все данные по нему до реальных пользователях можно получить их можно получить из браузера и листам с мобильного устройства если она использует браузер чтобы отобразить там ваше приложение затем их естественно griger им абсолютно классическая схема естественно затем отображаем в интерфейсе получаем какие-то картинки картинки чуть позже который можно получить я покажу то есть система понятна взяли получили результат какой результат мы можем из этого из этого извлечь значит первым мы можем посмотреть задержки по типам объектов то есть классический подход какой мы смотрим там не знаю у нас столько то количество такой-то файлов css или у них такой то размер но задержки которые эти css-файлы вызывают у пользователей за сколько времени не загружаются агрегированного всем пользователям из данной страны по данным страницам там данного в данное время суток браузер там сервисы классический вам не посчитает потому что бы это посчитать но может данные пользователей получив эти данные мы сможем сфокусировать наши усилия по ускорению сайтов на реальных проблемах то есть именно там где у нас просадка по скорости и что вот такой это диаграмма этой диаграммы задержки по типам по типам объектов то есть красная области то у нас что имидж значит у нас картинки загружается треть времени то есть если мы хотим сделать сайт быстрее мы либо должны с оптимизированным брожение но то есть как то что то там дожать может быть ухудшить качество может быть мы должны отложить изображение чтобы они так сильно не велели на лад или там если мы ничего с ним не можем сделать наши да мы говорим что вот на наш кипиа и по скорости сайта изображение это 30 процентов все остальное надо вот читать с ним уменьшать например еще 3 это у нас время ответа сервера время ответа север размер передаваемых данных значит это то на что он на чем мы фокусируем внимание или например 25 процентов это внешний виджеты то есть ниве дрифт этот инструмент частности мы увидели что виджет фейсбука ты дал там значительную часть 20 25 процентов времени у пользователя мы просто брали ускорили сайт там за две минуты там на 20 процентов просто убрали виджет фейсбука потому что он у он не давал дополнительный бизнес ценность он не жалкие технические задачи он просто нагружал пользователи данными и по времени мы это увидели что именно по времени он тормозил то есть он не по количеству объектов не потом по размеру то мне еще причем вопрос по времени то есть у пользователя он долго загружалось мы это увидели мы это убрали значит следующий полезный benefit которым мы из-за этого извлекаем абсолютно логично задержки по группам файлов то есть у нас есть какой-то например плагин мы знаем сколько времени файлы этого плагина загружается у пользователей нос там например на странице или наполеона группе страниц у нас есть набор картинок например фоновые картинки мы знаем сколько они будут загружаться у реальных пользователей или превьюшки наших товаров там каких-то объектов там карточек мы выделяем их в отдельную группу и смотрим насколько они вносят задержку на фиг данной группе тот плюс-минус одинаково распределилась но видно что основные там основные файл основные там css скрипты стиле скрипты они загружаются треть времени и естественно для того чтобы сайт хоть как-то ускорить нам нужно там сфокусировать внимание там на основных криптах если мы их уже максимально ускорили то есть там может быть их там объединить нам дополнительно там вложить в тело сделать одностраничные одностраничные приложения без внешних вызовов и так далее муж-то не носит существенную задержку вот больше всего мне очень нравится вот эта картинка она показывает использование кэша то есть чтобы узнать из загрузила ли ваш пользователь какие-то данные спеша ресурсы из кэша или же он их загрузил сервером у что вы страны серы вы не знаете вот вас там прошел серия запросов к серверу вы не знаете остальные запросы пользователей с крыши взял и илью про соединения оборвалась неизвестно это может только на стороне пользователя посмотреть там либо чем через api достаточно просто делать если время обращение к ресурсу очень маленькой но там 1 2 миллисекундам на щит из кэша fios просто потому что за одну две миллисекунды не ни один сетевой источник не отвечает ну там реально 15 20 миллисекунд чтобы просто индекс достучаться нос в принципе с любой точки вот и что важно что если использование кэша файлов в кэше у вас меньше то есть количество запросов из кэша и ответов из кэша браузера пользователя меньше чем количество постоянной аудитории то есть у вас там берни 42 процента заходит на сайт там ежедневно летом в чине кого-то времени возвращаются на него а заходит 60 а из кэша получает только 40 процентов объектов я знаешь что конечно используется неэффективно и одна из основных задач чтобы ускорить сайт состоит том чтобы с оптимизировать использование каши найти те ресурсы которые отдают сми макаши есть в тех случаях посмотреть по группам в первую очередь ресурсов которые носят существенную задержку они долго загружаются бы что пользователь и возможны как то дополнительно за кашира если вдруг это еще не сделать ну просто таки базовые вещи но бывают проблемы что мы что-то отдаем мимо кэша и сами не знаем о пользователе тормоза мы смотрим и бац нашли поправили у всем хорошо ему такие быстрые хиты быстрые быстро исправления по сайт и самое главное что мы можем сделать на основании сэмплирования данных или на основании реальных данных мы можем просчитать эффективность каждого метода по оптимизации здесь представлены какие-то там плюс минус тестовые данные но они очень сильно отражает реальную картину то есть мы можем просчитать что будет если мы внедрим например серверное кэширование для большинства запросов то есть вы прежде чем внедрять серверное каширования смотрите а это даст результат в реальной скоростью загрузки сайта или нет то есть вам стоит нам вкладывает два месяца человека там часов чтобы этом не знаем вам кажется положить ключи пересчитать каждый бросить и так далее или же это пустая трата времени по вашему текущему приложению это все считают на основании данных ваших пользователей и вы получили серверной задержки смотрите о и сразу видно вот здесь вот серверное кэширование что-то дает немножко но даёт первый приоритет может не попасть в 1 прилететь сюда попадает например включение изображений через до туре и то есть маленький фоновое изображение мы можем включить через там нет не только фоновые еще с шрифты мы можем включить через через протокол до туре до туре кто знает да давайте давайте просыпаемся на молодцы все знают хорошо ну там и svg файлы тогда гну свой план текст можно сказали можно внедрять вот тогда-то варево внедряете и смотрите хабом 15 процентов там по времени вы срезали у в целом у пользователь который был на ваш сайт заходит это важно или там например оптимизации изображения можно просчитать на сына сэмпле то есть вы не все изображение там в бэкграунде ваши там миллионы можете про оптимизировать обеде визировать или знаю тысячи изображений x оптимизировали потом смотрите нас выигрышном 10 процентов потом по размеру сколько нам вывешу 10 процентов по размеру даст в ускорении сайта то есть может быть это нам 10 процентов может быть 20 раз может быть 7 или 5 тоже в это опять-таки включайте модель и это диаграмма вам отвечает на вопрос что и в каком порядке вам нужно сделать чтобы сайт стал быстрее да достиг ваших кипиа iv то есть у вас есть теперь непрерывно секунда сейчас его сайт загружаются там две секунды вам нужно ускорить там в два раза на 50 процентов посмотрите каунасе нам нужно брать там раз два три 4 5 7 методов которые дадут там лучший результат и будут стоить нам меньше всего человеко-часов то чего опять таки на эту диаграмму накладываете стоимость внедрение стоимость разработки и получаете готовый план действий у это можно сделать только зная реальную ситуацию ваших пользователей может а без обратной связи от пользователи в этом вы будете слепой что там картинки оптимизировать скрипты сжимать и так далее то есть базовые вещи вы сделали а что дальше там у вас то может быть какой-то api яндекс карт долго загружается то есть вы думаете вас очень быстрый сайт он быстрый но яндекс карты тормозят и вы это увидите здесь что там например сложенную загрузкой яндекс карт позволит вам в игры там по 150 миллисекунд на каждом таком запросе это вам даст 10 процентов по скорости сайт все это там у вас станет третьим пунктом в плане действий по разработке что вам нужно внедрить чтобы вас все стало хорошо вот ну я еще раз повторю значит мы собираем аналитику и и заворачиваем извлекаем из ни одна мы просчитываем действия по оптимизации просчитываем там дополнительные метрики там эффективность каширования использование там задержки по типам объектов по группам объектов это все объединяем на основании этого составляем план действий доставляем пускаем в работу тест на получаем результат обратную связь и и так далее все достаточно просто на словах на на действие там но сесть надо поднимать аналитики либо использовать какие-либо сервисы если это реально бизнес-задачи что нам нужна скорость сайта привести к приемным показателям нужно собрать обратную связь и нас на ваньок внедрять какие-то меры и он а значит на десерт на десерт команда значит зомби не зомби как их зовут кто кто смотрел кто видел на экран внимание на экран как их зовут осьминоги так еще кто кто знает как их зовут так пирата карибском море ближе дну дэви джонс абсолютно верно пирожок от меня подойти после выступления дэви джонс вот есть значит группа товарищей которые крадут время ваших пользователей они конечно выглядит не так на серверном уровне это по-другому но суть том что ваш сайт он обычно не защищен от включение в него внешнего кода то есть вот соседнем зале буквально два часа назад рассказывали как этого избежать я буду я рад что вы там присутствуют если присутствовали но если нет я расскажу это внедрив данную систему увидит что порядка десяти процентов времени у пользователей отнимает внешне включение виджетов то есть эта внешняя реклама который мы не контролируем потому что она включилась ну то есть мы отдали кот без рекламы пользовались все стоит вирус у пользователя там он зашел в метро вай фай у него значит прокси он зашел еще куда то у нее все-таки это расширения браузера тот же от блок который ему в страницу впендюриваешь какие-нибудь скрипты это все тормозит это все реально тормозит носит спасению настолько такое content security полюсе честном мы внедрили то есть мы я но вслед за индексом гуглом там фейсбук и мы внедрили сложно сразу скоро сложно это я я вставила реальный пример он был небольшой у нас маленький сайт честно нас там всего пяток скриптов используются но мне попросили урезать код еще потом уже сказали что не не читаем никто не будет смотреть и так далее в общем это только где-то треть кода для небольшого сайта ну то есть там у нас что аналитика стоит она стоит api яндекс яндекс эти график смысле google графиков и google analytics у нас все у нас из сторонних виджетов ничего нету но вам нужно исполнять наш код нам нужно исполнить наш код в онлайне в его ли еще что то и чтобы вот все это запустилась там достаточно большой заголовок получается его может быть сложно поддерживать но это одна из вещей которые вам нужно будет сделать когда вы там начнете работать со скоростью сайта то есть если она за вас уже внедрена я вас поздравляю вы молодцы если не внедрена вот просто вот там первый или второй совет что вам нужно сделать обрезать все что к вам не относится что вы не контролируете обреза через content security policy тогда будет частям на этом у меня доклад заканчивается я очень рад вашему вниманию аплодисменты так и теперь у нас вопросу здравствуйте у меня пара вопросов сказали урезали аналитику а вы перестали собирать не смысле я вот отсюда вырезал потому что она это самое или вы имеете эту сайта брали я имею виду что это запрещает гугл аналитике работать или нет но мешает не мешает что конкретно ну то есть вы имеете ввиду что вы запрещаете выполнение внешних скульптура тогда вопрос аналитика работает после это вот чтобы оно работало нужно в этот заголовок добавить всех остыл из которых аналитика запрашивает данные вот в петле яндекс метрики тут наших 2-х т т т т т т ps еще что-то было для гугла нужно было пом 3 добавить чтобы он работал нормально то есть пришлось немножко пошаманить аналитика естественно завелась просто вопрос о том чтобы обрубить все кроме аналитики или там все кроме еще facebook и второй вопрос а в какой момент отправляйте данные на сервер сейчас мы но для веб-сайтов и одностраничников когда у нас есть окончания просмотра то есть страница закрывается или переход на другой странице отправляем по нло это на какой события вешай onload onload даже когда все закончилось мы отправляем она происходит в любом случае в любом случае для сайтов для остальных если у нас есть там внутри приложением у нас перегружаются как-то данные естественно по таймауту то есть той молодым и раз там 10 секунд агрегирует данные которые новую нас по ресурсам появились и новые давно отправляем на хер аналитике сейчас уточню то есть на анод отправляйте плюс еще каждые 10 секунд у нас два режима работала либо мы отправляем на лот всю пачку данных которые можем отправить либо мы раз десять секунд ну или там раз в секунду зависимость того как сколько сессия пользовательское какой у нас там точность нужны насколько можем загрузить сервер то есть для нас для наших приложений у нас нету там одностраничников мы отправляем панно там для клиентских сайтов катаем нам нужно внедрить и там достаточно долго пользователь работает раз десять секунд 1 секунду еще не было пока кейс понял спасибо николай спасибо за доклад очень хорошо у нас с вами получилось на разные темы акцентировали внимание у меня вопрос на самом деле про вот ресурс тайминг как вы отличаете допустим картинки и ajax вот вас было диаграмма по моим тайпом но не совсем по моим тайпом вот это все в дэви джонс сажал мой мозг отпустите нас если у нас есть картинка по углу там слышим испечь темы и а як сна url там слушая кс перед тем как их отличить ресурс тайминги значит смотрите много есть подходов я вот буквально два-три расскажу значит первое мы можем сделать но поскольку у нас подход он еще заключается в том что мы делаем пост оптимизацию там и на в ответ на моем тип ресурс который мы потом запрашиваем мы можем пометить эта картинка у нас или все-таки аякса и если а як что все хорошо это первый момент второй момент у самого ресурс тайминга у него там есть тип то есть он тип мы и вопрос не собираем но он передает еще тип ресурса который загрузился инициатора своего то есть инициатор мы по инициатором и не смотрели но можно по типу вот ресурса который на самой странице то есть можно просто нарезать сделать а можно real-time анализом но на странице посмотреть ну и соответственно можно наложить любые фильтры то есть если вы знаете структуру ваших урлов ну то есть вы про знает что вот это вот картинки вот это вот скрипт и то есть кому проблем больших нету это ну там делается один раз и аналитика она собирается обычно вы не перестраиваете структуру там раз в неделю чтобы она как тестом слетела но видимо все ошарашены или просто устали спасибо большое спасибо ватель"
}