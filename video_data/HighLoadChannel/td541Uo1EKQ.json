{
  "video_id": "td541Uo1EKQ",
  "channel": "HighLoadChannel",
  "title": "Мониторинг большого количества движущихся по карте объектов / Егор Маслов (big3.ru)",
  "views": 1383,
  "duration": 2970,
  "published": "2021-10-04T02:47:02-07:00",
  "text": "всем привет меня завут егор я работаю в компании большая тройка обойдемся без регалий и я бы хотел поговорить сегодня с вами про геопространственный мониторинг что такое геопространственный мониторинг это когда у вас есть какие-то события происходящие в реальном мире и вы хотите точно понимать где именно ездят автомобили летают самолеты курьеры доставляют еду а любые события подобного рода кому будет полезен этот доклад в первую очередь тем кто работает с гиа данными в реальном времени то есть когда вам нужно получать информацию о передвижении объектов или о состоянии статических объектов на карте непосредственно в реальном времени если вы работаете с дпс телеметрии также в не зна низкоуровневых протоколах если вы не контролируете клиентский терминал и их качество например у вас клиенты шлют информацию через собственные ретрансляторы и у вас нет на них никакого влияния и храните историю перемещений храните ее например с вариабельной точностью вам нужно точно понимать что было двадцать минут назад что было год назад какие изменения происходили за весь год в целом какие изменения происходили за день пока немножко поговорим про предметную область это мусоровоз мусоровоз приезжает к вам домой и забирает оттуда мусорный контейнер после этого он везет его на сортировочную станцию после этого следующий мусоровоз побольше берет то что осталось после того как сортировочная станция отобрала из мусора что-то полезное и отправляет это все на полигон на полигоне это все закапывают в землю каждая процедура платная водитель получает деньги за то что везет отходы от контейнера нам сортировочную станцию или сортировочной станции на полигон сортировка за то что она ищет нашему сори что то полезное а полигон за то что захара него и при чем тут геопространственный мониторинг на самом деле у него есть большая область применения здесь например при помощи геопространственного мониторинга мы можем выявлять не оптимальные маршруты и не оптимальное расположение объектов инфраструктуры например мы можем сказать что не оптимальна в двадцать третьем году строить мусороперерабатывающий завод в тюмени целесообразно построить его в другом месте другой мощности мы можем находить нелегальные свалки следить за тем чтобы не переполняли с легальные выявлять непокрытые маршруты не покрыты маршрутами района и населенные пункты разбираться в причинах не вывоза мусора например если у вас во вторник должны были вы не вывести мусорный контейнер со двора они вывезли мы знаем почему и выявлять недостаточность контейнерных площадок если опять же вам из сдачи или с жилого дома далеко вести мусор то или нести его в пакетах мы скорее всего тоже об этом знаем мониторить можно очистку контейнеров мониторить можно глобально потоки отходов внутри регионов и между регионами мы в компании большая тройка пять лет разрабатываем информационные системы в этой области в области экологии в области обращения с отходами например случайный факт что разработанной электронной модели по оптимизации потоков дали шесть миллиардов рублей экономии в год для операторов а поскольку вся эта сумма идет из нашего с вами кармана потому что она включена в коммунальные платежи то это явно повлияло на нас с вами 24 24 регионах рф мы снизили таким образом тариф уменьшить стоимость обращение с отходами как это работает современный мусоровоз оснащен довольно серьезным бортовым навигационным оборудованием него входит видеокамера него входит датчик глонасс или gps т.е. модуль считыватель радио меток которые приклеены к мусорным контейнером для того чтобы мусоровоз мог читать его в момент переворачивания у водителя есть мобильное приложение которым в котором он обогащает данными данные телеметрии и таким образом 40 тысяч машин по всей стране передают нам данные о посещении 8 миллионов контейнерных площадок но конечно это работает не везде части регионов это работает вот так какой-нибудь трактор который с 2008 года обязали прикрутить к нему gps-приемник умеют передавать данные глонасс по-плохому интернету потому что увозят он это из какой-нибудь деревне поэтому мы научились работать в условиях когда данные о gio пространственном перемещение объектов и их положения могут быть как богатыми так и бедными обрабатываем мы это довольно просто с машины передают данные по зоопарку протоколов далеко не всех можно обязать передавать данные по нужным нам в протоколом на тот же трактор могли установить бортовое навигационное оборудование 10 лет назад и с тех пор в принципе они не собираются его менять какие-то протоколы управляемые то есть мы можем отправлять в ответ какие-то данные какие-то протоколы неуправляемы какие-то протоколы поддерживают полноценную авторизацию какие-то протоколы могут не поддерживать или не хотеть поддерживать авторизацию совсем дальше все это капает система очередей и после этого система принятия решений как-то фильтрует эту информацию и отправляет ее на монитор пользователя в браузер где оператор видит вот такую картину на стороне входящий входящих соединений у нас какая-то базовой авторизация и базовой валидация данных на стороне бэг-энда у нас находится фильтрация проверка прав пользователя может ли он вообще смотреть то что он видит и фильтрация кроме этого информация маршрутах входящих складывается в кликов я коротко рассказал о нашей системе и о ее архитектуре теперь перейдем к конкретным прикладном решении что мы обсудим обсудим какие могут быть проблемы во входящем трафике телеметрии как пробрасывать информацию о передвижении до браузера клиента в случае большого ее объема как кристаллизовать объекты на карте если они у вас постоянно меняются во времени и создадим простую карту покрытие которое будет работать у нас на любом уровне масштаба карту фактического покрытия при этом будем стараться поменьше программировать двадцать первом году большую часть кода который можно придумать можно еще также найти поэтому будем стараться использовать готовое решение которые доступны по открытым лицензиям перейдем к проблемам входящего трафика какие проблемы появились у нас какими проблемами столкнулись мы первую очередь это дублирующиеся идентификатора каждая компания каждый автопарк как то называет свои автомобили после этого как-то передает это нам никакой уникальности в этом нет при этом они изначально использовали общее шлюзы которые объединяли их по регионам в этом случае мы получили большое количество дублирующих in дублирующихся автомобилей которые сливались в один у нас был транс континентальный практически вывоз мусора на карте с этим приходилось как-то бороться дальше устаревшие трансляции кто-то забыл что его автопарк транслирует нам информацию достучаться дозвониться до него уже нереально принимать мы по этому порту информацию обязанны соответственно очень много появились появилась мертвых душ который по сути две трети спустя два года работы две трети автомобили которые передавали нам информацию мы ничего о них не знали кроме того были потоки архивных данных это когда например какой то автопарк или например большой региональный оператор внезапно осознает что он месяц ничего нам не передавал а должен и начинает это передавать включает ретрансляцию и нам валится весь поток за весь этот период самое кратчайшее время в которое мы можем это принять соответственно это сильно забивает канал входящий телеметрии что мы сделали мы выделили больше портов а потом мы выделили еще больше портов конце концов портов у нас было очень много поскольку большая часть ретрансляторов навигационного оборудования поддерживает только айпи адрес и порт и транслирует данные по тисе пи или люди пип то этот выход показался нам самым оптимальным мы просто начали выдавать персональной диапазоны клиент забирает себе какой-нибудь диапазон портов если он хочет поиграться со своим тестовым бортовым навигационным комплексом он просто забирает себе очередной порт из пула если он хочет передавать данные по новому протоколу и половину автопарка хочет перевести на него он выделяет себе новый порт из пула все это маршруте зиру и ца через к прокси или трафик х прокси мы взяли из за того что он хорошо работает с балансировкой трафик теперь умеет в дипе раньше не них a proxy не трафик в youtube и не умели кроме того это помогло нам такой подход и такая ретрансляция помогла нам транслировать телеметрию надев среды дело в том что боевые кейсы тестировщиком очень неудобно решать на тестовые телеметрии потому что маршрутах которые по всей стране транслируют нам мусоровозы есть много очень неожиданных моментов которые никакой тестировщик не нарисует на карте руками через тестовую систему которую мы тоже естественно я пришла нам пришлось реализовать но реальный боевой трафик телеметрии на деф среды помог гораздо больше потому что кейс который мы видим на bayou мы также видим на 9 делается это довольно просто то есть у нас есть система управления сервис простейший который переписывает как-то конфиг х прокси х прокси имеет лазере лот на мы получаем практически возможность любой момент выключить кого-то из наших клиентов или какой-то порт который транслирует мусорные данные просто не прибегая ни к какому программирование главное потому что программировать мы не очень любим а здесь вот есть практически готовое решение как мы дальше пробрасываем информацию как лучше пробрасывать информацию о передвижении объектов от у вас есть какие-то точки какие-то маршруты люди бегают по городу либо машины ездят по стране что передает информацию на клиента клиент передает информацию какой-то backend этот backend вынужден в каждый момент времени решать какую информацию могу клиент передавать какую информацию мы на клиент не передавать же самое оптимальное это передавать только то на что клиент непосредственно смотрит это какие-то границы экрана зоны видимости постоянно отправляются на backend кроме того backend вынужден решать вопросы разделение прав фильтрации этого трафика и как-то еще в реальном времени обрабатывать данные выделяя события которые происходят на экране все это бэкон делает но может не делать мы подумали почему у нас фильтрацией по зоне видимости занимается backend если можно отправить это на очереди для того чтобы отправить это на очереди мне немножко нужно рассказать про теорию а именно праге аж кто не знает что такое geohot жена все знают что такое gi hd никто не знает что такое а вот человек знаешь килохэш это система позволяющая разбить карту на квадранты при помощи строки каждая каждому сегменту выделяется символ это может быть число или буква один из двадцати четырех символов после этого каждый сегмент делится еще на двадцать четыре квадранта и к каждому символу добавляется еще один в итоге я хэш размером 2 символа характеризует нам какую-то небольшую страну размером с норвегию ageac с размером 20 символов может характеризовать нам на карте сидение на стадионе например хорошая штука но в ней вот что-то не так они видят что с ней не так нет да да они разные вот эти штуки они вот я не знаю как это делать они разные дело в том что то на что мы с вами смотрим эта проекция меркатора которая используется во всех картах гугл и яндекс электронных на ней видите вот гренландия больше африке жители африки на это очень обижаются она искажает площади соответственно поскольку мы делим все таки сферу any sharp pro я не плоскость то здесь у нас как ватару естественный искаженной площади получается но пользователь елозит своим экраном по двухмерной карте поэтому работать с таким делах и шум нам естественно неудобно вторая проблема это слишком большой шаг когда пользователь нажимает или скроллер вперед для zuma на карте он уменьшает область просмотра в четыре раза эта штука уменьшает область просмотра нам для к с каждым новым символом в 24 раза мы написали свою простейшую реализацию которая просто изменяет этот гель хэш хватыш по квадратам превращает его в квад хэш разница в том что делим мы на четыре части получая более мягкую мягко и масштабирование и мы сразу делаем на меркатор и чтобы не получать разные вот эти вот размеры разные площади что мы с этим делаем дальше gh можно использовать как роутинг кей влепите rabbit умеет маршрутизацию маршрутизация идет по ключам ключ это строка строка во время the maximum 255 символов 20 символьный и афиш идеально подходит для этой задачи просто вычисляем diash уходящий точки любого события отправляем в rabbit сразу с определенным ключом клиент сообщает что он смотрит какую-то зону там например вот 3445 сервер подписывается на очередь с такой маской и на уровне очередей у нас в итоге происходит некое уменьшение трафика воронка сужается backend нагружен меньше бэнду приходится меньше обрабатывать мусорного трафика получается такой эффект наблюдателя при котором если вы не смотрите на эту зону в ней как будто бы ничего и не происходит какие проблемы есть пользователь когда он велось от экраном он попадает на границе крупных квадрантов в этом случае стандартная стандартный алгоритм уменьшает убирает полностью нам весь наш ключ и начинает транслировать туда в эту очередь всю карту целиком нам это не надо rabbit позволяет сделать несколько биндинг оф поэтому мы можем просто подписаться на несколько ключей и мы решить эту проблему не заморачиваясь про кластеризацию кластеризация эта штука повсеместно конечно применяющиеся но мы в данном случае класса рисуем объекты постоянно меняющиеся во времени у нас постоянно что-то происходит какое-то посещение кто-то выгрузил контейнер кто-то не выгрузил контейнеры об этом сообщил кто-то должен был за день выгрузить 15 а выгрузил 16 появилась на карте новая точка у нас меняется количество точек меняется расположение точек меняется статей статистика по этим точкам в общем меняется все стандартный алгоритм и кластеризации работают довольно ну довольно примитивно они используют перебор общего количества точек или части множество для того чтобы найти точки со средне квадратичным с минимальным средним каталитическом отклонением от полученного множество после того как расстояние положение точки меняется или после того как добавляется новая . они делают это все заново им приходится перебирать целиком множество или часть множество в зависимости от того какой сложности алгоритм но в любом случае тут довольно далеко все это вот м поэтому для нас случае когда у нас событие появляются довольно часто нам кластеризация динамических объектов показалась слишком ресурсы затратных поэтому мы от нее отказались и начали использовать классификацию классификация в отличие от кластеризации мы заранее знаем в какой кластер попадет наш объект правильно поэтому нам не нужно никаких делать вычислений но просто берем объект и отправляем его в нужное множеством классификацию мы делали тоже по гео пишу перед тем как начать работу мы в начале периода создаем кластеры для каждого уровня зума по квадратам там дальше также находим простейшим алгоритм уже точку в которой минимальные квадратичное отклонение от всех остальных выявляем центроид присвоим ему хэш сохраняем базу и для каждого нового события просто по гео шел отправляемого в 20 в нашем случае кластеров по 20 уровням зума это все происходит за и за за константу дашь какие проблемы первая проблема срединное деления когда множество у вас разделена квадрантами пополам хотя оно должно быть одним кластером она становится двумя кластерами на экране это выглядит не очень презентабельно point пользователь даже не видит что там во втором а вторая проблема это вот маленькие остатки что если у вас большая часть точек сосредоточено в одном квадранте и только небольшая их часть в остальных то пользователь получает вот такие вот лишнее кружки на карте которые мы не нужны потому что ему достаточно видеть общее множество решаем это на фронте там уже у нас совсем немножко объектов делается это с любой сложности логике довольно просто и более того мы можем выбирать данный формат классификации нам диктует сценарий при котором нам нужно объединить эти кластеры либо наоборот отдалить их если мы вместо ghn на каком-то на этапе решим классифицировать для определенного зума точки по регионам то нам наоборот выгоднее чуть отдалить эти кластера по линии на соединяющих их цен соединяющих центры для того чтобы показать пользователю подчеркнуть что они относятся к разным классам теперь про карту покрытия что такое карта покрытие это вот превращение вот левого левой части слайда вправо у нас есть примерно допустим три тысячи автомобилей которые ездят по мкад так или иначе за определенный период и нам нужно передать это все на клиент чтобы клиент увидел что автомобили ездят по мкад но при этом не передавать ему все десять тысяч маршрутов которые когда-то по нему были пройдены задача не очень тривиально стандартные алгоритмы упрощения сплайнов они довольно просты и но они упростят каждый сплайн по-своему в итоге у нас маршрут и без того чтобы объединиться они наоборот немножко разъедутся потому что сгладятся углы разгладятся в разные стороны и так далее поэтому здесь при подходе в лоб нам не обойтись без какого-то перебора хотя бы мы можем упрощать путем изменения размера окна этого перехода но в любом случае это перебор для нас карта покрытие это в первую очередь три вопроса для пользователя 1 если покрытие в данной зоне условно ездит ли там мусоровозы второе это где кончается маршрут это вопрос куда он в конце концов поехал часто помогает находить какие-то новые объекты на которые по стране свозят мусор и третий вопрос это если маршрут из зоны в зону условно возят ли у нас мусор из москвы в тулу спойлер нет не возит почему не использовать граф дорог ну самая простейшая это использовать граф дорог просто раскрашивая его по тем местам где у нас маршруты были но потому что из коробки когда мы начали использовать граф дорог он позволяет работать только с не самими дорогами а с маршрутами озером и мы получили такой сценарий при котором мусоровоз у нас разворачивается а наша система показывает что он развернулся через 30 километров потому что там было по правилам правильные или потому что движение было односторонний в общем какая-то получилась нехорошая история конечно немножко по программировал можно было это все исправить можно было самим работать с этим графом дорог не обязательно использовать маршруты но зачем программировать к может не программировать во вторых у нас есть катера который возит мусор с островов и ну там не очень с маршрутами вот вообще ну а есть трактора который прокладывает себе маршрут и сами но это уже отдельности можно просто отобразить маршруты вот у нас за период в несколько часов получается в 20 4 мегабайта на какой то на каком-то участке пользователь качает это себе бедный 25 секунд потом у него появляется маршруты можно заклеить закачивать упрощенные маршруты но как я уже сказала не тогда разъезжаются в разные стороны что можно сделать возьмем два сходящихся маршрута они у нас идут по очередной дороги после чего немножко расходятся в стороны мы знаем точки а неупорядоченного времени мы знаем транспортное средство его идентификатор и мы знаем hаши то есть квадрат и в которых эти точки у нас находится по любому уровню масштаба который нам нужен хранится это все клика усе таблица координаты время транспортное средство группируем по транспортному средству за сортируем по времени получаем набор линий первый вариант это взять и просто сгруппировать по гео хишам в отеле в зависимости от того какой уровень детализации нам нужен мы можем взять и сделать карту покрытия простой группировкой абсолютно простым запросом берем под строкой zoom level от пользователя получаем к нему что-то прибавляем или уменьшаем зависимости от того что нужно и вот получаем какую-то картину который отвечает нам вопрос на вопрос где автомобили были где автомобили не было в принципе на этот вопрос ответ довольно понятный но на остальные два мы ответа тут не получаем между точками маршрутов нет понять 2 это разных автомобилей или один нельзя непрерывные маршруты с точки в точке мы тоже не поймем из зоны в зону зато это быстро зато это мало данных зато ну вот это просто второй вариант это тоже самое но мы достаем ребрышки вместо точек вместо центра видов geohot шей который кстати оказалось нет не совсем тривиально рассчитывать в клика оси в запросе поскольку клика ус не очень хорошо умеет храним ки которые содержат цикла вот у нас так и не получилось если кто-то тут есть у кого получилось может быть после доклада расскажите ребра мы можем взять раньше клика ус не поддерживал оконные функции теперь он поддерживает какое-то их подобие например вот есть функция neighbor которая позволяет взять предыдущий следующий элемент из выборки мы сначала запрашиваем упорядоченные маршруты после чего мы создаем ребра после этого эти ребра мы группируем чтобы убирать пары лишних разделяем их по разным трекером по разным автомобилям чтобы у нас не было raider соединяющих два маршрута ну и получаем вот такую красивую картину на мне очень нравится которая очень похожа на микросхему немножко но прекрасно она немножко посложнее она чуть побольше весит все-таки ребра в два раза больше весят чем точки передавать их на клиент два раза дольше но по крайней мере они легко получаются и опять же довольно простым запросом единственное что центроид geohot шеи мы ищем уже либо на клиенте либо на бэг-энде в зависимости от того соответственно как мы это уже решим следующий вариант используем среднее координаты берем мы координатам точек маршрутов попавшие в quadrant и просто находим средне после этого тоже самое делаем с ребрами запрос получается это чуть-чуть сложнее у нас все таки нам необходимо объединить выборку с точками общими для всех транспортных средств а ребра получить только для одного конкретного транспортного средства не пересекает не пересекая его маршрут с другим получается это дольше получается это дороже получается эта красивей здесь вот у нас чуть-чуть уменьшена детализация помимо этого поэтому больше объем но в целом это уже довольно близко к тому как реально все происходило ну за какое-то небольшое время пользователь на уровне страны может видеть карту покрытия по городам спускаться в города видеть карту покрытия по конкретному городу спускаться до улицы видеть конкретные маршруты но есть конечно проблемы первая проблема это не закрытые петли группировка мешает нам последний участок маршрута закрыть вторая проблема это ложный ответ на маршрут из зоны в зону поскольку мы берем среднее здесь мы получаем соединение которого на самом деле нет между двумя маршрутами но мы можем раскрасить группы транспортную в разные цвета получив от них какие-то простые хэши и решить эту проблему и того в зависимости от того что вам нужно получить у вас есть три варианта простых как это решать при помощи geohot шей если вам нужен только покрытие вы можете использовать самый простой вариант если вам нужно учитывать непрерывные маршруты то вы можете использовать 3 варианта можно просто показывать все маршруты если у вас их не слишком 0 выглядит это вот примерно так спускаясь с самого максимального уровня пользователь может дойти до непосредственно конечной конечного уровня масштаба и посмотреть где этот автомобиль прямо сейчас находится это довольно удобно поскольку пользовать плюс пользователь видит на масштабе устрою условно страны в реальном времени как двигаются автомобили практически дальше вот только после этого после того как мы уже поработали с этим мы можем включить кашу кэшировать можно только тоже по квадратам кэшировать можно как на фронте так и на бекки если у вас есть geohot she вы можете тоже сделать их частью ключа конечно немножко про мониторинг про эксплуатацию что нужно мониторить если вы получаете большое количество трафика по телеметрии понятно что вы обязательно должны мониторить его объемы понятно что вы обязательно должны мониторить количество разобранных пакетов телеметрии независимо от протокола желательно конечно в разрезе протоколов обязательно количество ошибок валидации потому что вам очень много будут слать неправильных данных скорее всего и что еще очень может быть интересно это запаздывание пакетов запаздывание игнат в каждой телеметрию в каждом пакете телеметрия обязательно есть таймс темп и его отставание от текущего времени говорит вам о том сколько пакетов скопилось на стороне клиента сколько он вам еще должен отдать и как далеко в прошлое он сейчас отдает как далеко из прошлого он вам отдаёт сейчас информацию если у вас увеличивается этот показатель это повод посмотреть в сторону расширения канала или спросить у клиента почему он не может передавать все вовремя и и все что связанно с очередями но про мониторинг очередей тут уже рассказывали на одном из предыдущих докладов поэтому я здесь лишь едва этого к сносим подведем итоги если вы работаете с его данными в реальном времени по старайтесь выделять как можно больше портов считаете gh тогда когда событие приходит при записи в базу вы можете отдать маршрутизацию на уровень очередей если вы используете rabbit не пытайтесь использовать стандартный гиа хэши стандартную кластеризацию потому что с этим могут быть проблемы и используйте кликал с для хранения маршрутов он очень хорошо для этого подходит спасибо за внимание могу добавить что мы в компании большая тройка очень ждем людей которые могут и помогут нам все это дальше оптимизировать кому не безразлична экологии и спасибо спасибо большое давайте теперь ваши вопросы если еще у кого они остались такой поздний час то поднимайте руки можно их сдавать тут и также в онлайне тоже если кто-то еще на смотрит то задавайте их там либо можем вывести вас в эфир либо задавайте в чате мы это отобразим и егор обязательно запоминаем кто задает вопросы или хоть их формулировку что потом выбрать лучший вопрос поехали здравствуйте спасибо за доклад вот я из него понял что гиа хэш вам принес достаточное количество проблемы благодаря нему вы там ну условно впитывали какие-то костыли вот была ли возможность тогда у вас отказаться от него использовать либо стандартную широту и долготу либо насколько я помню по широте и долготе если как бы точности поиск важны можно построить когда дерево и использовать вот эти структуры да мы говорили она была то почему вы не воспользовались то чем вы говорите это округление широты и долготы или деление по модулю при поскольку широта и долгота у нас это координаты условно да мы можем также поделить квадрат с любой с любым уровнем дискретности это будет то же самое только логика работы с этими данными будет возложена не на уровень хранения она уровень обработки нашем случае мы просто вынесли это на уровень хранения и получили красивую картину с которым может работать любой backend это гораздо удобнее оказалось округлять координат конечно мы пробовали пробовали 1 часто приходят угол добрый вечер спасибо за доклад расскажите пожалуйста как вы боретесь статистическими выбросами которые генерируются gps джан мерами и общей неточностью дпс принципе с статистическими выбросами мы боремся путем сглаживания отрезков у нас есть определенная логика мы считаем что условно там автомобиль не может двигаться с со скоростью больше чем есть у нас в базе да то есть если у нас он не у него стоит максимальная определенная скорость если мы видим что алгоритм или маршрут по которым он двигается как-то с этим расходится мы такие точки сглаживаем в конце концов нам нужно общая картина точность мы можем уже дать после не точность gps в принципе это отдельная большая проблема она у нас мешает например определить точно посещение контейнера в условиях отсутствия дополнительной информации до как я уже сказал вначале у нас есть довольно большое количество оборудования которые данные передает и в конце мы можем остаться с одним маленьким gps трекером который конечно не точный в этом случае мы должны делать выводы на основании только маршрута объекта переданного по gps и мы это делаем для этого у нас реализуется отдельная реализуется отдельный программный модуль который постоянно пытается алгоритмически обработать то есть команда постоянно пытается его дописывать чтобы алгоритмически обрабатывать какие-то проблемы например у нас же бывает так что мусоровоз подъезжает к с нужной стороны к даже без вот без всякого без всякой неточности дпс мусоровоз подъезжает с нужной стороны контейнеру а там забор он вроде постоял рядом с ним вроде все хорошо но там было за бортом человек просто не человек не и мусоровоз нему что поэтому таких ситуаций очень много они все должны обрабатываться в итоге конечно же с нашей точки зрения алгоритмических поэтому программу модуль который это обрабатывать на довольно большой ну это по сути предсказание по на уровень на основе нечетких данных или неточных данных какого-то события спасибо за доклад и такой вопрос почему вы не использовали h3 индексы от компании убер который поддерживает клик хаос автоматически ваша америка не поддерживается ребята вчера рассказывали очень очень очень понравилось во-первых аж три yandex нужно строить самостоятельно gh мы сразу взяли потому что он уже построен то есть делаешь на самом деле стандарт и в принципе если вы используете там питонов скуки аж библиотеку вам не нужно самим делить карту вы можете просто использовать их и шум же будет вам будет понятно какой из ушей за какой квадрат отвечает вот а после этого мы просто его дописали переписали немножко h3 здесь просто даст нам возможность а какой он даст нам возможность у нас как экран квадратный а гекса гексагон который в основе ht и он 6 1 2 3 поправьте шестиугольный поскольку большие части вот того что я рассказывала она связана с бойцами то есть границами экрана до из тем как клиент влияет на то какую информацию он получать то нам больше интересны квадратные зоны и как я вот вначале показывал на слайде тут он идеально вписывается именно вот в такой хват хэш который делит карту на четыре части потому что сами по себе библиотеки они при зуме уменьшают карту в четыре раза при каждом шаге зума но это библиотеки лифлет там или кинь google яндекс карты клиентские библиотеки имеют ну как мы понимаем да краники его прощают проблему пересечения и границ между зонами а еще раз шестигранники x канальные упрощают проблему на границах зон то есть это не квадратный зоны становится а да но создают дополнена другие проблемы конечно ну и про проблемы с границами мы решаем использовать шестигранники только для того чтобы решить эту проблему кажется как-то избыточном нет все остальные это нас характеристики хэша устраивают обычные квадратной сетке почему в красной футболке дети уже г.с. добрый день спасибо большое за доклад подскажите пожалуйста а кластер а у вас extend а зависимые и как быть если центроид кластера находится за экспертом пользователя вы его на клиенте передвигаете или он рисуется за границами пользовательского экрана тут есть два варианта набрать маленькими кусочками либо увеличить до большего мы с первую очередь увеличиваем до большего если как я уже сказал если это слишком большой скачок тогда можно начинаем набирать кусочками здравствуйте подскажите пожалуйста что происходит с трактористом который случайно выехал за пределы покрытия сотовой связи он копит все данные и как только у него появляется связь он нам их в рандомном порядке начинает отдавать мы можем например получить сначала кусок маршрута за сейчас а потом за три часа назад поэтому вот как раз про систему предугадывания событий посещения да мы не можем всегда быть четко уверены потому что нам через день но через день вряд ли через несколько часов могут передать данные о перемещении в этой области о которых мы не знаем вопрос хотел задать аналогичный предыдущему вопросу как вы защищаетесь от мгновенных вбросов данных и еще один вопрос как у вас построена тестирование и журнале о на все вбросы есть протоколы и есть клиенты которые не хотят там серьезную авторизацию не хотят переходить серьезные протоколы есть кто бы отправляет по египет есть кто отправляется условно токен нам есть те кто отправляют без токина поэтому мы все равно хватаем все кроме того вот если говорить про тисе пи протоколы мы должны все таки сначала получить пакет авторизации а потом уже понять что это нам не надо маршрутизаторы все ретрансляторы они настроены как вот часто бывает там парня бывшая бросила и он ей название это название то она уже ему сбрасывает но он название пока вот не умрет и у них такая же история то есть если нет часто бывает так что на отбивка по авторизации у нас происходит reconnect и вот у нас постоянно висит большое количество сведений в этом случае как большое количество портов она вот так очень хорошо работает сглаживает на просто вот так вот кладем вот второе тестирование обязательно у нас ну покрайней мере практически покрытие там мы сейчас не меряем но субъективно стараемся поддерживать его на уровне 70 процентов по поводу ручного тестирования у нас есть игрушка в которой можно ездить машинками они будут имитировать в разных протоколах или трансляцию очень нравится тестировщиком разные сложные кейсы можно испытывать двигать машинками но это вообще такая тема тема очень интересная да и ручное тестирование обязательно тоже и я как раз говорил про то что боевую телеметрию хорошо бы пробрасывать на d в среды потому что много кейсов вот именно на больших объемах ловятся много кейсах ловится на каких-то маршрутах допустим долгих которые там за один день и обязательно обязательно нужно вот как можно больше реальных данных пробрасывать на девелоперские среды здравствуйте вопрос продолжения тракторист поэтому часто ли у вас бывает такое что gps прибор выходит устроена некоторое время и просто не собирает информацию сейчас ли у вас бы оторванной маршрута что вы с ними делаете а вторую часть не понял часто ли бывает что у вас рваные маршруты то есть есть начало потом чего-то нет потом где-то дальше еще непонятно что да если человек хочет вывозить мусор в лес например он выключает бортовую навигационную систему уезжает в лес вываливает туда мусор возвращается на дорогу включает получается рваный маршрут тут даже не в связи дело может быть конечно у нас они есть это всегда повод для разбора инцидента у нас автоматически формируется инцидент о том что маршрут рваные мы уже смотрим покрытие это не покрытие если это покрытие и эта зона мы можем это алгоритмизировать то мы можем эту зону пометить как какую-то которой нет покрытие если это было что-то самим навигационным комплексом то это повод его чинить если это было человеческий фактор то это повод куда-нибудь сообщить но то есть действительности вы помогаете до находить вот эти свалки это бесси это работает конечно дорогу спасибо за доклад будут вернуться чуть чуть позже про 1 текстуру вот можете по по точнее поподробнее может я прослушал 40 тысяч машин превращается в итоге в кластер с какой мощности сколько серверов на базе сколько серверов на бэк ин зе сколько веб-серверов то есть какие аппаратные мощности нужны для вот всей этой истории это первый вопрос и второй вопрос технологический стек по решению вот ваш как бы опыт почему выбрали именно crack house они там postgis timescape почему именно ребята не кафка почему вот именно это технологический стек вы использовали где-то было не буду можно большей части 40 тысяч машин это не совсем проблема под проблемы это то что они посещают 8 миллионов объектов и нужно в реальном времени об этом знать каждую минуту передаем то есть это это больше больше на стороне b к обработка сейчас у нас бег разделен по virtual com всего около 90 дир по оперативы сейчас к сожалению сказать не могу потому что ситуация может меняться но размеры примерно те же у нас небольшое на самом деле техническое небольшие технические мощности все это обрабатывают потому что мы стараемся как можно больше сначала оптимизировать потом уже закидывать железками второй вопрос по архитектуре был технологический стек стык к чему rabbit попала по технологическому стеку мы конечно же используем пост гис у нас на всех у нас мультисервисная архитектура сервисов разных много и на бизнес-стороне условно этих сервисов мы используем и по сгрыз мы используем postgis когда у нас словно есть время но вычисления когда мы можем когда у нас просто есть время на запросы с гиа пространственными индексами все это мы делаем клик house мы используем для того чтобы хранить маршруты поскольку он очень хорошо работает с группировками и нам часто нужно строить маршруты за какой-то конкретный день закрыты на какую-то конкретную минуту какого-то конкретного дня во всем во всех этих задачах клика us просто работает лучше мы можем мы работаем с более широким то есть там в подписи то же самое есть можно за время же выбрать там таблиц секционные пост гис в паз грейси ну то есть вы мерились подагра впал в подписи мы храним актуальные данные в кале к оси мы храним все все что касается маршрутов из включая исторические данные бенчи были да то есть обоснованы принимали решение на основе каких-то тестов и есть тесты и вы приняли решение что клика us в этом сценарии быстрее да да эти тесты были на наших клиентах они не без радости наверное узнали о том что что-то у них работает медленно что-то быстро и в конце концов вот мы к такому стыку пришли и последнем вопросе к а сколько клиентов с точки зрения людей которые смотрят одновременно на 40 тысяч машин клиентов операторов около тысячи операторов может смотреть спасибо у нас есть 100 регионов они могут смотреть как свои так и чужие регионы то есть размер людей может меняться"
}