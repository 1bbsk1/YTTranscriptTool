{
  "video_id": "ZTxOSGBCRec",
  "channel": "HighLoadChannel",
  "title": "Ликбез по Эльбрусу / Константин Трушкин (МЦСТ)",
  "views": 7623,
  "duration": 3307,
  "published": "2017-04-22T14:47:31-07:00",
  "text": "раб в компании мцст компания мцст - это наш разработчик вычислительных систем в первую очередь разработчик микропроцессоров во вторую очередь разработчик вычислительных комплексов и так получилось что если вы разрабатываете свою собственную архитектуру то Вы вынуждены делать фактически полный цикл лов поэтому неизбежно У нас есть скажем так а собственные компиляторы собственные порт линуса собственные билс А и собственная разработка вычислительных комплексов А на сегодня у нас имеется несколько несколько микропроцессоров несколько моделей их в принципе есть две линейки одна из них - это Spark последняя версия - это четырёхразрядного процессор порядка Он выполняет две инструкции в такт То есть это ну скажем так по производительности близко к инл атому другая линейка - это архитектура ИБС Она изначально затачивать на то чтобы скажем так давать максимально возможную производительность на вычислительных задачах и она сделана по другому принципу это не риск это широко командное слово при этом оно довольно гибкое Ну чуть попозже я вам расскажу подробнее про его возможности и вот в этой линейке У нас есть на сегодня два скажем так боевых микропроцессора один - это elb 2S + второй - это elb 4S Ну и ко всем этим процессором сейчас у нас есть свой собственный южный мост КПИ А вот самый так сказать младший процессор вообще в целом во всей во всей нашей линейке во всех продуктах Это r1000 здесь характеристики приведены в общем и целом можно сказать что это как бы атом который четырёхъядерный на 1 ГГц который можно объединять четырёх процессор систе при этом технология там 90 это не самые современные но тем не менее характеристики у него хорошие и употребляет порядка 15 То есть если бы его перенести на скажем так технологию 28 наме Да он вполне мог бы соревноваться с Арма и псами Рабочая лошад есть по возможностям работы с плавающей запятой он находится на том же уровне что и атом но в него добавлены ещ иче ядра ДСП Ну практика показала с ними не очень удобно работать поэтому вот все задачи которые решены на сегодня решаются на сегодня на этой системе в общем-то это они используют основные универсальные ядра и не использу Если Вы посмотрите значит здесь у нас получается 128 м к там Ну практически более чем в два раза больше Вот а если мы посмотрим на количество транзисторов на ядро то оно получается где-то в три раза больше чем по сравнению с спарм то есть ядро получается довольно толстое но по результатам производительности Посмотрим дальше наконец 4 знат потребляет он гдето 40 45т частота 800 МГц память память него развитая это канала работающих параллельно вот все эти процессоры могут объединяться Да каждом из этих процессов полагается южный мост ко всем этим моделям там не X8 а X4 но так сказать формально из Чипа выходит во иксов Да и мы стараемся на все платы ставить длинные разъёмы чтобы можно было любые карты расширения вставлять Ну то есть в общем-то набор интерфейсов скажем так это минимально необходимо на сегодня но с его помощью уже можно решать какие-то задачи практические многопроцессорность В общем как у взрослых людей да то есть это нума до четыр процессоров соединяется Точка Точка значит можно сказать так что наб 2+ и на r000 мы только начинали это делать У нас ещё не было Снуп фильтра А на эбс 4S на нём уже реализован Снуп фильтр Поэтому вот такая многопроцессорность она достаточно эффективно работает а и в общем и целом вот уже 4S можно рассматривать как Ну более-менее прокш процессор программное обеспечение ну здесь никого ничем не удивишь поэтому у нас здесь используется достаточно старый ядро 2633 оно стабильное и в общем оказалось что для таких наших текущих пользователей его хватает при этом вот что важно отметить что мы вносили изменения не только в архитектурно зависимую сть но при из вхите независимую сть м Я немножко попозже скажу наша команда ну сза работая с известными заказчиками вынуждено было также реализовать свою собственную поддержку ретай помимо патча стандартного Значит у нас есть ещё там собственный планировщик и много дополнительных ручек которые позволяют настраивать систему так как вы хотите Как явори работа и Ком сейчас поподробнее скажу А в остальном пользовательский софт - это ну скажем так попытка приблизиться к де Бену то есть мы сейчас сделали что-то похожее на пятый дебин в минимальной комплектации то есть там 4.000 примерно пакетов импортированы дальше Вы уже можете из них э собирать всё остальное уже из исходников какой-то набор программ от вот скажем для этого ядра Ден - это Пятая линии соответственно как бы те версии пакетов пользовательских Ну например там gice которые от нас хотят они просто уже не они не входят в в эту версию де Поэтому мы вынуждены какие-то версии пакета поднимать и добавлять туда вот наш собственный как бы набор набор дополнительных приложений Ну что интересно это то что у нас есть ещё и система поддержки совместимости с илом то есть мы можем запускать через слой программной эмуляции оптимизируя интеле ские коды в двух вариантах либо это может быть скажем так операционна мы полностью отдаём машину гостевой операционной системе тогда мы исполняем все коды привилегированные непривилегированные и оставляем бинарному компилятора только небольшой кусочек аппаратуры вот знат есть е вариант когда мы запускаем ком приложений это означает примерно следующее что мы са технологи трансляции бым трансляции Ставим на системный вызов и соответственно получается а ядро получается на родное но уже с её помощью можно запускать Wi можно запускать Firefox Ну мы не так много приложений Вот вот в этом режиме протестировали но польза уже есть всё-таки всё равно производительность ту получается ну скажем так заметно хуже чем нативном режиме поэтому это инструмент совместимости пока что я думаю да у нас не так много поэтому есть у нас под под Бинар есть два способа за Кобина единстве сес проб а вот наша собранная jav это отдельная работа у на бы она пока ди Ну то есть ваша имен грубо говоря оно пропа дам обрата там постоян работаем на тем чтобы добавить оп да А какая версия сейчас шестая то что вы сейчас делаете понятно а бинарная запускается Ну в принципе то есть любая Да вот как раз с бинарным компилятором да А если вот про производительность говорить то есть производилась какая-то вот оценка там насколько там она проседает по сравнению там с x86 архитектурой Java Я думаю что это разы Даже если мы посмотрим на скажем так производительность ВОМ скажем современный такой да посмотрим на то как работает Java Ну если говорить про см Ну то есть имеется в виду что если мультипро сорная конфигурация Да на брусах то Java там нормально параллели будет или там будут какие-то Вот я думаю Open по-моему пока мы ещё параллельность не сделали если вообще там параллельность была когда-то вот если мы говорим про Бинар там где профессионально значит там всё сложнее пока что у нас бинарка многопоточная находится в стадии там даже не бета а Альфа но она есть то есть есть для него поддержка вот в этом процессоре как раз 4S Вот видите у нас как бы здесь заявлена поддержка многопоточный трансляции в том числе естественно мы можем в этом режиме запускать когда это будет отложено пока что это всё е Аль какие-то тесты мы можем демонстрировать говорить про то что вот уже можно про финальной цифры производительности что Использовать можно в продакшене Нет пока я бы не стал пока это в это поточно режим а сборка там постгрес например она есть у вас да по есть Ну именно вот уже в вашим компилятором Да Дада версия 99 о по-моему 91 более свежую пока не поднимали Ну то есть Пока видимо не не было надобности я Скорее Скорее не было надобности то есть по большому счёту проблем с тем чтобы компилировать новые пакеты Ну мы практически уже не наблюдаем то есть компилятор достаточно стабильный а единственное что это нужно правильно сконфигурировать А ну пакет перед перед компиляции да то есть надо там подложить эти файлы акон соответствующие конфигурационные Ну понятно эти файлы тоже есть да то есть в общем в общем я думаю что там Любой человек грамотный он сможет сам скомпилировать более свежий подс Спасибо А ну теперь про архитектуру Эльбрус Ну я думаю что я что Многие знают это Но тем не менее повторюсь а по сути дела Что такое с точки зрения программиста это процессор который все кишки на вот есть компилятор имеет прямой доступ ко всем исполнительным устройствам Ну не ко всем но ко многим Да и вы можете оценивать производительность эффективность использования ресурсов просто Глядя на канал исполнительных устройств но в каждом из них скажем так там несколько конвейеров потому что на каждый канал подвешены разные функциональные устройства Ну например вот на нулевой канал подвешено целочисленное устройство устройство для работы с плавающей запятой и один канал для загрузки данных из памяти значит они неоднородна по про L Store значит здесь история такая Либо вы можете запускать два независимых Лота каждый так а то есть ну четыре скажем так четыре лода каждый так а Либо вы можете запускать два лода и один стор Либо вы можете запускать два стора а кроме того есть вспомогательное устройство очень важное это устройство так называемый array Access Unit устройство предварительной подкачки Это я бы сказал так програмно аппаратный причер программный потому что компилятор должен увидеть возможность фенга из памяти Ну в определённом цикле он работает только в клово режиме соответственно Вы можете вы можете подкачивать данные только когда процессор вот этим устройством когда он работает в цикле и важно ещ то что компилятор должен увидеть возможность подкачки из памя есть ожен догада ои см ЗАЗ работают Независимо с операциями сохранения Ну какие-то другие условия которые позволяют использовать этот Юнит он характерен тем что он напрямую работает с памятью в принципе он может даже именовать кэш и он напрямую пишет регистровый файл это устройство работает асинхронно но согласовано с как бы ну основным конвейером Да с основным циклом соответственно когда мы хотим использовать это устройство мы как бы заранее его программируем Да оно какое-то количество данных подкачивает и дальше ждёт Когда начнётся цикл цикл начинается он начинает выдавать данные регистровый файл и параллельно подкачивать по мере опустошения внутреннего буфера вот значит кроме регистров файла регистровый файл у нас большой 256 регистров есть ещё специальный файл для предикатов то есть для одно битных значений А ну давайте теперь нем подробнее расскажу про несколько скажем так приёмов которые по сути своей являются программной реализации того что в риск Ну в современных процессорах делаются аппарат Итак вот этот самый при значит вот ещё раз чит поясню чит как он работает да вот здесь видно что он программируется сначала так э программа фактически одет то Как расположены данные в памяти с каким шагом их Выбирать из каких адресов вот а дальше у нас есть бы основной набор устройств Вот и когда цикл запускается он вот этот вот цикл управляет работой этой программы соответственно программа может вычитывать данные напрямую из памяти может вычитывать их из из памяти может сохранять Их в кэш может э Гра Может это устройство может подкачивать до четыр как бы лодо за так соответственно если у нас идёт какой-то вычислительный цикл Да и сторо соответственно использовать соответственно если у нас есть какой-то вычислительный цикл то мы можем Ну практически полностью освободить каналы для вычислений все загрузки будут идти через него значит прич Вот вот у нас такой аналог програмно аппаратный про теперь про скажем так один ция циклов и у нас для этого есть аппаратная поддержка факти переименование регистров програм управляемое переименование регистров Ну Суть в ЧМ этой технологии когда программа начинает начинается выполнение цикла то мы одновременно запу ОВО итерации и первую операцию второй итерации дальше параллельно запускаем третью операцию первой итерации вторую второй и первый третий и так далее Всё это благодаря тому что мы можем за в одном такте Задать несколько команд инструкций процессору и опять-таки благодаря большому регистрон файлу То есть у нас хватает регист для того чтобы кориза или мы называем Нарут вот Ну поскольку начало цикла и конец цикла не особенные в плане планирования операций то соответствено есть аппаратная поддержка начало и конца в частности в частности для этого используется вот что знат може проводить операции которые могут давать невалидный результат и с этим невадм результатом Достаточно долго работать на регистрах это не будет вызвать вание и до момента сохранения результата Вы можете свободно отбросить Вот это некорректный результат может быть коррект некорректны неважно то что вы можете отбросить и прерывание возникнет только тогда когда вы попытаетесь его сохранить в память то есть это ф можем когда запускаем про делаем одни и те же инструкции понятно да набо тотже Но для первых итераций скажем частично маскируются Вот именно благодаря Эм предиката и благодаря воз спекулятивных вычислений поются нере условно говоря вот от пролог потом он нормально полноценно работает основное тело цикла потом он корректно отрабатывает улок Вот кроме работы в цикле вообще СВ вычисления не очень полезны для такой архитектуры потому что скажем Она очень не любит лений и поэтому есть такая возможность когда мы скажем одновременно две ветви хода под условия и под антис мы их одновременно выполняем и только в конце уже ког смпо условия принимаем рение какую нам взять то мы можем тем самым оттянуть момент принятия решения момент вычисления Иа вот Ну поскольку опять-таки Вот такая архитектура широкого командного слова она тяжёлая неповоротливый немножко то вот было принято такое решение которое в принципе используется ещё и ну в других архитектура скажем цифровых сигнальных процессорах это возможность сделать подготовленный переход означает что у вас нас в процессоре есть не только один основной конвейер вот он это основной конвейер но и несколько скажем так обрубов которые имеют в себе только несколько первых стадий конвейера до стадии execute А и вы можете на любом такте один из этих вот конвейеров как бы назначить ему адрес с которого он начинает готовиться и он тогда будет параллельно с основным конвейером так сказать декодировать инструкцию первое там несколько тактов у нас конкретно это шесть тактов Вот первый ше тактов он будет работать Дальше он становится пото что он бы сделает всё что мо Вот и подготовив такие вот три конвейера Вы можете в любой момент за один такт переключиться на с основного конвейера на вот эти подготовленные тем самым Если у вас есть возможность подготовки перехода то вы можете без потери тактов так сказать переключаться либо идти дальше либо переключаться Ну это опять-таки технология она в каком-то смысле Спорная где-то она хорошо работает где-то плохо Ну вот она есть можно пользоваться соответственно у нас не нужен предсказатель переход Вот в такой парадигме Ну теперь собственно хотелось бы объяснить Ту самую сакраментальный каналах у нас значит может быть выполнено одновременно за один Так До ми цех операций есть канат поно ои могут выполнить за один такт как бы двойную операцию двухэтажную называтся гумен операции аргумент вот также мы можем запустить в четырёх каналах до соответственно восьми плавающих операций То есть у нас все плавающие каналы позволяют делать двухэтажные операции один канато ление то есть такие тяжелые операции о раз два Так может запускать операции вот ну и наконец значит можем делать до чех лодо и до двух сторов естественно здесь всю указаны максимальные цифры то есть мы не можем одновременно выполнить там во интов и там не знаю 41 они конкурируют за каналы поэтому здесь максимальная цифра получается когда мы берём все загружаем канал пла операциями лако и е дов и вот мы Загрузи загрузили кое все конвейеров которые у нас имеются основных откуда берм Лоло берм из асинхронной загрузки работа мы можем доче чех значений загружать со нас прибавляется адрес за это так да то есть мы сдвигаем указатели по которы Мы выбираем это тоже надо учитывать вот ещ четыре операции как бы четыре адресных арифметики Вот кроме того каждый такт когда мы работаем в цикле мы добавляем счётчик ну и наконец мы можем в этот такт совершить переход да То есть в принципе максимальном случае мы совершаем переход и е добавляются логические операции то есть мы можем на а одно битным вот этими значениями над предикатами совершить какие-то операции до трёх операций в так а вот Ну а если мы не в цикле то мы можем ещё скажем в той же самой инструкции загрузить несколько констант вот загрузка литералов - это загрузка констант прямо из команды всё И тем самым вот максимальное значение получается в цикловой режиме это будет 23 операции в так есть синтетически естественно там циклы которые однотактный да то есть у нас вот в архитектуре возможен однотактный не тривиальный Цикл А вот и там получается 23 операции конечно это синтетика то есть в реальных программах всё-таки получается меньше операции Ну вот сейчас мы посмотрим сколько их может получиться Просто я примеры приведу А наша архитектура она невозможна Разумеется без хорошего мощного компилятора потому что вот все эти планирование операций накрутки слияние иов это всё очень тяж такая непростая компилятор ная работа Ну вот компилятор наш единственное что у не не наше - это frontend то есть собственно та часть которая декодирует а шный исходник и или ПЛЮСПЛЮС на исходник и превращает в некоторое промежуточное представление а он не наш и соответственно мы от него зависим Он поддерживает на сегодня стандарт вот такой c+ Plus 2003 с некоторыми элементами более свежих версий А ну там если это кому-то будет очень важно могу отдельно потом выяснить а там какие-то элементы не полностью поэтому я не пишу что поно пожи Эмен Поддержи от за пожи все его возможности Да что он нам Дат мы исполняем вот Поэтому вот мы стараемся быть то есть мы поддерживаем совместимость практически полную с gc на сегодня это уровень 44 Естественно С как бы С развитием фронтенда поддерживается новая конструкция соответственно поднимается версия с которой Мы совместим есть некоторые конструкции которые мы в принципе не поддерживаем из того что подержи там были какие-то проблемы сложными функциями Я просто нева не совсем полностью поддерживаем но они очень ограничены полиции дальше подержи 790 это значит фактически через конвертер есть есть конвертер из который там подставляет нужные комментарии подсказки компиляторы для того Маши у нас имеется в общем она стабильно работает но пока не очень быстро Вот и компилятор приложений опять про него я уже немножко сказал Вот я просто чтобы вы понимали масштаб бе да то есть компилятор у нас развивал более 10 лет и сейчас в нём Ну когда-то было даже 400 оптимизаций потом часть убрали Ну порядок 300 оптимизаций 300 эм слова сечас буду корова пото лекция и я не готов сес это комментировать но главное что поддерживается векторизация поддерживаются все особый оптимизации котора позволяет архитектуре ирус показывать себя хорошо есть в принципе авторалли на общей памяти Ну как у всех компиляторов оно работает через его пра инструкции вручную вот нас поддер вот в принципе есть даже общее распараллеливание на несколько машин Но это крайне ограничен случае поэтому их не стоит учитывать Ну вот как-то так вот теперь давайте я возьмём такой исходник реальный цифровой фильтр который сглаживает изображение по семи точкам А ну как видите у не есть маленький внутренний цикл семи итерационный Да дальше у нас есть большой Цикл А как бы который идёт по горизонтали и значит цикл которые ИТ по вертикали на изображении Э что сделал из этого компилятор вот значит смотрим Вот одна говорится типичная инструкция ру Да это всё одна инструкция она за один так убирается де кодируется и оставляется какой шири до 64 бай справляется процессорный Ну да справляется конечно смотрим Просто давайте сейчас разм что Т делается Вот они слогов вот 2 третий задействован четвёртый пятый то есть пять пять пять слогов Мы задействовали в этой команде значит они они занимаются вычислениями Да это значит сравнение вычитание это объединение полей под предикатом Как видите он стоит Да вот эти вот с проценти ками это вращающиеся регистры То есть те самые которые автоматически переименовывают вот это двухэтажная операция заметим да то есть это Shift и сложение сдвиг сложение Вот То есть фактически здесь у нас ше операций в пяти слогах дальше у нас есть три операции касающиеся это загрузки через устройство подкачки работает вот это операции которые работают с предикатами которые работают с предикатами А вот ну как то есть здесь получается смотрите шесть девять Ну это может быть служебная Но вот это точно логическая операция да то есть 10 операций 10 инструкций Ну и здесь тоже в общем-то одна какая-то существенная операция то есть 11 операций Мы в этой существенных операций в этой команде мы закодировали значит это не самый внутренний цикл точнее это самый внутренний цикл но он был развёрнуты То есть он был Ризван А дальше он был фиксированное количество итераций первое что делает компилятор когда он видит что итераций здесь мало он просто цикл лириз ну здесь вот семь итераций Ну в пределе понимаете это вопрос целесообразности да то есть я бы сказал так что если у нас в порядка нескольких десятков итерации то компилятор вероятно его развернёт А если у нас итерация там поря нескольких сотен то тут уже нет смысла его разворачивать частично развернуть сделать частичный так чтобы получилось как бы более нагружен основное тело цикла и будет меньше будет достаточно для того чтобы как бы это стало выгодно учитывая накладные расходы влоги эпилоги вот так есть ограничения Наско глубоко залезет Да насколько он компле понимаете компилятор работает по файно если ВС находится в одном файле то он может функции функции Ну до определённого предела собственно чем определяется этот предел он определяется объёмом процедуры то есть начиная с какого-то момента если код в процедуре слишком много по количеству инструкций Да в процедуре или обём просто Как оценивается я бы сказал по планированию То есть если компилятор может понять что вот самое вложенные процедуры Да он оценивает сколько А скажем Ну грубо говоря если там есть тяжёлый цикл Зачем иланит эту процедуру Угу она там по сравнению с Ну как бы выигрыш Илай будет минимальной по сравнению с временем Ну незаметен на фоне вообще времени исполнения основной процедуры правильно са самый вложенный Вот а если процедура маленьку он Может слать потом может ещё раз слать то есть здесь там есть некоторые стики которые просто не позволяют ходу слишком сильно разбиваться если мы начнём постоянно Илай процедуры то мы очень сильно раздуем на это Т это вот то что касается Лайна каких-то кусков да то что касается Вот таких вот Шаман которые здесь как раз представлены да то там тоже какие-то ограничения есть то есть они аналогичны Да понимаете это ограничение не принципиально это ограничение по эврике по эврике дари Ну вот у сейчас настроена так-то Если вы видите что у вас какой-то особый цикл и мы с этим сталкивались вы понимаете что нужно его сильнее развернуть да или что его нужно не знаю вот эту процедуру конкретно хотим про инить Несмотря на то что она тяжёлая то мы просто явным образом указа оп компилятора Понятно Вот то есть мы снимаем ограничения Дальше он начинает работать моя какой-то какую-то мето функцию указать прмо что что-то сделать да да на конкретный цикл Можно указать есть гмы то есть мы можем специально с помощью инструкции указывает что вот это скажем этот цикл ну скажем Несмотря на то что у него нету неизвестно количество операций что он у нас много итерационный да то есть компилятор копа тайме не знает сколько у него итераций и как-то оценивает это ну допустим неправильно да то есть он подумал что цикл мал итерационный на самом деле он тяжёлый Вот и тогда мы говорим ему гму что у него там типично количество вот такой начинает уже котироваться это всё актуально и для оси и для плюсов да да то есть там одинаковое всё да вот а давайте на следующую инструкцию посмотрим что тут Ну как видите это следующая инструкция здесь пожалуй ещё больше да у нас получается то есть здесь у нас опять получается шесть операций пять пять слотов и один двухэтажный а здесь уже четыре лода То есть это получается уже 10 Да здесь у нас получается один 11 это ещ один 12 так здесь уже два такта Ну в общем в целом вы видите Да что они достаточно получается плотно забиты эти слоты Вот и реально получается там ну вот 10 плюс-минус операций в такт так ну в общем тоже самое ВС Да вот Ну собственно вот и всё да вот цикл закончился вот вот это вот инструкция перехода Скажите пожалуйста переключение контекста между исполняемым процессами Какие данные соответственно выгружаются и загружаются на процессорные регистры процессор я понимаю здесь же должны выгружаться и загружаться не только сами регистры но в случае наличия Ино вот эти регистрах которые мы можем переименовывать у нас должны погружаться и выгружаться какие-то дополнительные данные которые соответствуют именовани именовани состояния регистра в каждом процессе правильно соответственно у нас достаточно много случае с эльбрусом накладных расходов при переключении контекста Да да это действительно так переключение контекста на Эльбрусе - Это довольно дорогое удовольствие конкретно это занимает сейчас порядка скажем тысячи тактов а в тех версиях линуса соответственно которые под вас оптимизировали вы что-то делали с моду который переключает контекст вы планировщик полностью переписали насколько я понимаю нет планиро переписали для лта У нас есть нета версия кото использ стандартный планировщик А какойто их много было изначально знаете Это я не могу сказать Да не настолько хорошо это знаю Я так понимаю что вот есть 2633 в НМ есть некоторый стандартный дефолтный планировщик Вот его используем вот важнее другое вы спросили про то как переключается контекст Ну там есть же архитектурно зависимая часть Да которая занимается Ну вот снять контекст с процессора Да вот мы её и дорабатываем Но вообще доработки я уже говорил в начале что в принципе доработки Пришлось сделать не только в архитектурно зависимой части но и в архитектурно независимой потому что скаже вещи связаны спекулятивний режимом это ВС как бы оказалось что какие-то куски архитектур независимого кода Ну вот плохо работает с этим вот теперь тот же самый алгоритм Да но уже програмно оптимизирована то есть мы тоже самое делаем тотже цифровой фильтр тоже сглаживание но только переписали его по-другому вот такой как бы длинный цикл смотрим Во что он превратился 2 3 всё то есть здесь можно сказать что вот если мы посмотрим да то здесь довольно много операций Да а то есть можно было предположить что у нас получится достаточно длинный цикл на выходе он оказался всего в три операций то есть компилятор смог разложить все эти операции ну скажем так может быть по одной итерации может быть часть из них он смог увидеть что они похожи Да и фактически как бы сделал рол То есть он наоборот как бы увеличивал количество итераций внешнего цикла и сэкономил код Ну вот это вам пара примеров и теперь посмотрим что получается с точки зрения производительности этого кода я сразу скажу что конечно это благоприятный для нас пример пример и пето но используется он честно то есть включены оптимизации разрядный режим используется Ну и вот мы видим соотношение Вот вот получается так то есть мы получается что архитектурно архитектурно выглядит совсем неплохо на фоне Ну вот достаточно достойного процессора конечно это это очень благоприятный случай Давайте посмотрим что бывает в случаях скажем не таких благоприятных вот набор тестов CPU Ну думаю что все все присутствующие про него знают и знают что по условиям тестирования запрещено менять исходные коды Ну кроме каких-то таких чисто синтаксических правок и вот на этих кодах Это целочисленные целочисленное подмножество здесь используется компилятор типа следу это компилятор это архиватор так это база данных это ещё один архиватор это and по-моему для печатных плат так это Л В общем это всё задачи достаточно ну скажем так тяжёлые в плане для исполнения их на вот такой архитектуре потому что в них много ветвлений мало итерационные циклы вычисление осном целочисленные поэтому называется ну и вот мы видим что на этих вычислениях вот здесь в качестве голубе процессора на гец Ну вот оказывается чтоб 4 на 800 Да он несколько обгоняет Пен на гец вот на таких задачах Ну как бы результат которым сложно очень так сильно хвалиться но тем не менее он приятный ВС равно заметим что это кий Вот это на теперь посмотрим что будет на плач то есть на другом подно того же теста в котором используется соответственно основном задачи из научных расчётов в которых много операций с плавающей запятой и там большие циклы ционные Вот и здесь мы видим что в среднем по больнице 4 смотрится неплохо уже на фоне другого конечно эти бы данные все можно поставить под сомнение да то есть сказать что вы использовали там профессиональный компилятор А это непонятно кто не понятно чем копировал но мы брали данные для вот этих процессоров для исх с официального сайта с надо думать туда так сказа Поли вс-таки хороший результат вот а для этого мы сами ском что вот Ну хорошо значит ещё раз особенность этого набора тестов это то что в нём запрещено менять Исходный код с одной стороны а с другой стороны что он настолько хорошо известен что многие компиляторы прямо буквально затачивали под него надо сказать наш компилятор он не исключение то есть мы тоже имеем некоторые специфические оптимизации например вот на этой задаче некоторое время часть компиляторов знала что там есть Мёртвый код и его просто выкидывал а часть не знала Но вот Со временем все подтянули соно в этой задаче получается фантастический результат по фрам именно потому что изначально как бы даже составите это набора тестов не знали что там есть просто там неиспользуемый результат и код который можно выкидывать вот со временем компилятор разобрались и все компиляторы стали этот тест значит максимально хорошо оптимизировать производительных вычислений у нас то есть если вы делаете какую-то систему то у вас будет э наша библиотека у которой есть функции соответственно матричных вычислений векторных обработка сигналов Ну это примерно аналог Intel mkl только он конечно более бедный там не так много функций здесь порядка Ну более тысячи функций Вот и для э суперкомпьютеров есть у нас также и MPI ну здесь кстати никаких особых чудес не было То есть мы просто взяли исходников скомпилировать всё скомпилировать заработали вот ну кратко значит про то что есть из аппаратуры значит из аппаратуры у нас ну скажем так вот для широкого сообщества моделей Немного это прежде всего Вот такая ска это сама доступная машинка которая произведена маленькой серией то есть физически есть на складе и при мо ознакомления СХИ длям п вот для это используют и ВМС Моть Рае место вот это то что мы только-только разрабатываем соответственно 4 будет тоже аналогичная машина пока её ещ нет физически Но вот плата под неё уже сделана первая Инженерная партия маленькая Вот её отладить Ну скажем так возможно можно продавать достаточно широко и она будет иметь какой-то спрос потому что это уже четыре ядра уже 800 МГц Вот и Плата сама по себе довольно богатая то есть здесь есть PCI Express и два слота PCI можно что ориентировочная цена очень сложный вопрос Если удастся выйти на партию порядка скажем так 10.000 штук вот в партии из 10.000 штук такая плата будет стоить ну если там не будет каких-то спецпроверка спецсу порядка там словно гово 500 долларов вот если очень постараться точно сказать не могу и сказать что это будет 500 Или там 800 не могу но вот вероятно что меньше тысячи это это будет это будет Вопрос вот по плате Ну и по вот этой и по предыдущей Да остальные компоненты например южный мост Да это вот он Ваш ваши разработки да то есть Честно не на плисов там да Ну вот смотрите вот процес вот южный мост он не на плис то есть настой нет на плис когда-то убрус был северный мост нап Точнее тогда был северный мост на плиса а Южный был инвс просто инский мост сейчас уже всё нормально да то есть это полный комплект Вот и следующая модель которая может быть опять-таки уже более-менее интересно широкому сообществу это вот сервер чех процессорный теже самых 4 в НМ будет два южных моста Вот вы видите прототип это скажем так та Машина на которой проходил испытания сам процес 4 ещ раз покажу для вновь прибывших Вот это процессор чит Он проходил испытани на такой вот материнки она не совсем приспособлена для скажем так серийного выпуска поэтому она будет перерабатывать и под неё будет СПУ одно а вот на имеющийся процессор Да есть сейчас сервера которые можно купить я бы сказал так что они есть но во-первых они довольно Ну как бы они не пропорционально дорогие то есть не было сделано дизай оптимизировано под нормальную цену то есть там использ дорогие модули памяти это раз вовторых они немножко не когда примерно А я думаю что мы как бы опытные образцы вот этого сервера получим протестируем отладить уже отлаженный дизайн в котором можно быть уверенным и можно будет его реплицировать ну то есть просто запускать серийное производство ещё важный момент что на этом сервере будет отдельный Слот вот здесь он так отмечен а в который можно будет вставлять Значит на который выведены непосредственно линки с двух процессоров оставшихся и туда можно будет составлять кастомные платы там скажем СГА или дополнительными южными мостами То есть это получается что вот такая модель серве она в чём-то расширяемая Это тоже для каких-то спец применений будет привлекательно ну и наконец наше ближайшее будущее вот оно это воде про если очень сильно Повет будет 1 и5 если не повез будет 1 и2 вот Вот примерно такой диапазон Да мы не можем сейчас так знаете схода сказать что будет потому что мы только-только вот его получили с фабрики это реальный образец сфотографированный их налаживаем Значит его особенности будут такие во-первых у него уже трёхуровневый Т дов е устройство для работы с плавающей запятой То есть у нас будет во всех ше каналах двухэтажные плавающее операции Ну понятно что это не так сильно поднимет производительность так вот в среднем по больнице Как хотелось бы но там где вы скажем не знаю гоняйте матрицу нажа фвы фильтры там это даст свой выигрыш вот памяти стало больше И самое главное по по 8 гиб в секунду в каждую сторону это уже достаточно хороший уровень он дуплексный естественно и к нему опять-таки уже физически у нас наличествует южный мост К2 в нём будет p 2 20 линий они сплету как значит группа 16 она СПТУ по д пово оставшиеся СПТУ угодно есть можно мово четв вот 3.0 во каналов будет USB 2.0 тоже 8 каналов Ну и потребляет это всё хозяйство Ну как мы оцениваем где-то 12-15 Вт то есть мы пока ещё не можем сказать экспериментально только расчёт есть вот при этом что важно что если это много то можно отключая какие-то блоки понижать энергопотребление и опять-таки в пятом году мы должны выпустить процессор физического Пока ещё нет это будет экономичный процессор Ну скажем так для построения терминальных решений То есть это будет процессор одноядерный со встроенным графическим ядром с поддержкой 3 ускорения вот выход на два монитора разрешение там Ну больше чем Full HD Я не могу сейчас на память сказать но больше чем H и он будет использовать тот же самый южный мост 2 Итак у нас получается Т Новое поколение наших чипов это п вот процес либо вот такой экономичный клиентский А можно вопрос по Да вот правильно я понял что L3 только здесь появился Как вы разливали обращение ОТП отц до этого когда два Агента сейчас сечас ещё раз как разрулить вощение ПБ Ну АБ - это в принципе тоже второго уровня кэш он должен как бы Независимо работать нет принад ядран если мы говорим про вот 8 сейчас где он вот он Да значит если мы говорим про то фактически - это некоторая часть внутренняя часть ядра которая имеет тот же самый выход на ш третьего уровня что и все остальные обращения из этого ядра это раз да и соответственно ЕС с просох поколений коре За из Вот и из ша вот поэтому там нет противоречий скорее противо друго это даже я бы не в принципе да я бы сказал так это когерентность Да вот как решается вопро я не удивлюсь ЕС сну идут и в самы это кстати не так сложно вать этой ситуа соблюдается естественно подумали как это реализовано вероятнее всего что с просто идут в и выбивает оттуда данные если чтото не так Так ну вот собственно Яг бы на этом закончить ем ещ есть можно вото Нет я думаю Расскажите про возможности виртуализации Нару виртуализация насе сейчас её нет она делается будет это значит виртуализация типа ксено да основное ядро гипер с приро операциями илие ядра для гостевых операционных систем Почему так потому что фактически У нас у машины есть одна нормальная операционная система Поэтому нам делать полную виртуализацию Ну пока нет смысла можно вять посмотре более-менее полно я бы сказал так что сейчас у нас нету возможности не то что нет желания нет возможности работать как бы с отдельными частными клиентами Да поэтому сейчас наш метод работы будет такой это по проектно То есть если у вас есть какой-то проект причём проект не знаете такой вот поставьте мне завтра как бы и гарантируете мне что всё будет работать да а Да вот на такие проекты мы можем пойти Вот потому что мы сами понимаем что всё-таки ну железо у нас не настолько хорошо отложенное и надо его всё-таки так сказать поддерживать в ходе внедрение Вот то есть один вариант - это проекты вот такие длительные и Ну там где понятно что мы нужны То есть это не просто так вот да с бухта Барак Давайте попробуем а там где Ясно ясны причины почему надо использовать либрус а второй тип проектов - это значит образовательные проекты То есть если скажем есть обращение от ВУЗа мы хотим там поработать с вашим железом мы хотим там обучить студентов хотим сделать учебный курс то мы так стараемся в этом смысле идти навстречу Так что наверное Вот вот как бы два типа вот обращения они будут успешны всё остальное там сложнее будет а"
}