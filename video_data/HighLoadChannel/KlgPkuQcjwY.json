{
  "video_id": "KlgPkuQcjwY",
  "channel": "HighLoadChannel",
  "title": "Как разобрать сетевой протокол и найти уязвимости в устройстве без использования прошивки/А.Дорфман",
  "views": 358,
  "duration": 2909,
  "published": "2023-10-06T07:14:35-07:00",
  "text": "Итак Доброе утро начнем прежде всего хочу немножечко рассказать о себе ну как было указано что я реверс инженер исследователь кандидат наук и ведущий специалист компании пользуется техноложусь являясь спикером заминочка являясь спикером на многих конференциях по безопасности а также находил уязвимости в различных промышленном оборудовании Ну и в качестве такой в одном из проектов написал модуль для процессора nios 2 для добро а также продемонстрировал такой был интересный кейс Как можно атаковать промышленный контроллеры с принтера на котором мы предварительно модифицировать прошивку Итак чем я занимаюсь более подробно тут есть в зале Те кто не знает что такое реверс Инжиниринг поднимите руки все знают Значит мы чуть-чуть пропустим и быстрее пробежим по этому слайду Вот я увлекаюсь прошивки с редкими архитектурными процессора Вот мое хобби такое есть автоматизация задач инженерингу Ну и в последние восемь лет я исследую различные встроенные устройства и и полка вот при для них я исследую протоколы нахожу уязвимости и делаю различные пруфов концепт для того чтобы это устройство работало не так как в нем заложено вот это как раз шелкода и различные импланты в прошивке Ну Используя инструментарии это дезасс эмблер вот если вы когда-то разрабатывали программы бинарные то вы их отлаживали в отладчике Это такая вещь которая позволяет смотреть не в динамике как в Атлантике в статике вот ну и мне встречается в работе различные архитектуры процессора Вот и жирным выделены этого то что достаточно часто встречается именно в моей деятельности вот по поводу прошивок первое что может сказать о том что внутри прошивки это какие-то вот отладочные и их наличие или отсутствие опять же жирным выделено то что чаще всего встречается в моей деятельности вот немножко про структуру доклада поговорим будет кратко вводная часть потом я проведу вас прямо вот как доклад происходил в жизни когда клад как исследование происходило в жизни Вот так прямо по нему и пройдем то есть был предварительный анализ потом некоторые исследования потом реверс Инжиниринг обсудим полученный результаты посмотрим какие уязвимости получились получилось найти и я продемонстрирую часть из них на предзаписанных видео Ну введение Я думаю все понимают что такое промышленный полк но чтобы не было путаницы потому что у людей иногда бывает заблуждение это такая разновидность вычислительной машины для систем реального времени применяется для различных автоматизации технологических процессов и основной момент чтобы она была автономно и такая отказоустойчивая вот и чтобы опять же люди не путали она отличается всё-таки от микроконтроллера и встраиваемости темы Ну и Если сравнивать с персональным компьютером то плк он как бы управляется входами и подаёт управляющее воздействие на выходы вот как бы такая схема и есть небольшая схема которая иллюстрирует то есть есть у нас входы с них какие-то датчики получаем с них данные обрабатываем и водоём управляющее воздействие вот современные ПК промышленные они достаточно мощные системы у них хорошие могут стоять внутри процессоры разных видов достаточное количество оперативной памяти набор каких-то внутренних периферийных устройств Вот и внутри развитые операционные системы как правило реального времени вот также там озабочены безопасностью то есть шифрование различные парольной защиты может поддерживает хороший сетевой стек то есть ну как хороший разнообразие протоколов Как общеизвестных там ethernetti Pip http FTP так и чисто промышленных modbass vpc и так далее и самая такая вещь которая в них есть интересная мне как исследователи встречающиеся в моей работе это некоторые проприетарные Протоколы которые вендоры реализуют своих продуктов вот где может стоять этот плк и как его в принципе можно атаковать Ну такая примерная схема приведена Типовая скажем схема сети слева идем это интернет потом корпоративная сеть и технологическая сеть она бывает трех уровней верхней средней нижние но в верхнем располагается различные управляющие рабочими 100 там операторов инженеров и так далее в среднем уровне располагается наша промышленный контроллеры Ну а в Нижнем различные датчики с которых он собирает устройства исполнительные устройства на котором подает управляющее воздействие и в принципе хакер может подсоединиться к любому сегменту этой сети только потому что есть люди которые могут принести куда-либо флешки для подключения к всякие USB модемы wi-fi где-то попытаться настроить и так далее в том числе он может всю эту цепочку пройти из внешнего внешней сети из интернета такие случаи тоже реальные на практике проект Это выполнялось вот какие последствия могут быть при Атаке на промышленным контроллер Ну все зависит от того от двух как бы моментов первый это где он установлен с одной стороны мы можем там что-то повлиять на производство булочек например с другой стороны что-то более серьезное и второй момент второй вопрос Это что может сделать злоумышленник с этим контроль контроллером и технологическим процессом на его основе То есть он может например остановить его заблокировать либо поменять какие-то воздействия управляющие входы изменить его параметры или настройки какие последствия при этом могут быть Ну тут тоже как бы можно логически так рассудить могут быть начиная от бракованных изделий различных аварий остановки предоставление разных ресурсов например воды тепла электричества газа до техногенных катастроф таких как взрывы проливы какие-то пожары что-то такое вот и ну чтобы привести это к реальности посмотрим такое слайд посвященный в реальном случае Атак слева приведены вредоносы для этой области вот все считается что все началось с червя с так 2010 года красным выделено что на что он воздействовал это червь он знал как работает протокол между Сименс семантикой и скады сименса и по разным высказывания таким косвенном он нарушил достаточно много наделал бед он нарушил работу тысячи центрифуг порядка и таким образом замедлил ядерную программу Ирана и если еще посмотреть вот приведены два вредоноса этой industroyer и Pipe Dream и видим что красным выделено что они поддерживают достаточно большое количество промышленных протоколов то есть они могут действовать в разных отраслях нашей жизни Вот и в 2022 году было проведено на рекордное количество Атак и они как мы видим затрагивают практически все области нашей жизни Вот это снабжение металлургии там топливной энергетический комплекс во многих из них Вы наверняка слышали из различных новостей это были разного вида атаки конечно большая часть из них связана с различными вымогательскими программами Однако Ну не стоит не стоять технологии на месте и скорее всего мы можем ожидать что будет уже атаковать на не только с помощью вымогательских программ А конкретно на производственный процесс Вот теперь немножко поговорим про сам бренд Mitsubishi который выпускает контроллеры собственно экземплярка контроллер которого к нам попал это достаточно крупный Бренд у него есть специализация Вот они приведена есть развитая линейка разного размера контроллеров начинает самых слабеньких до самых мощных и наиболее частые применение это различные насосные станции и такие редкие экзотичные которые встречались в проектах коллег на бывших работах это Например вагоно опрокидыватели какие-то системы для ТЭЦ и даже шлюзные водохранилища Итак вот Здесь представлен внешний вид этого плк мы видим в середине различные индикаторы которые отвечают там за его загрузку то что он включен в ошибочном состоянии он или нет работает в нем программы или нет сверху справа можем увидеть входы то есть индикаторы входов что на входах есть сигналы а справа снизу это сигналы что на что на выходах есть различные сигналы и была поставлена мне такая такие задачи это разобрать протокол научиться общаться с ним например с помощью скриптов и найти в нем уязвимость и первое что мне предоставили это частое явление в проектах это трафик Вот и Давайте посмотрим в этот трафик это tcp трафик tcp поток розовым выделены запросы таким сиреневым выделены ответы слева мы видим смещение пакетов этих байт посередине Дамп на вторичный и справа текстовые строки Мы все с вами обладаем таким очень хорошим инструментом выявления закономерности Давайте внимательно Посмотрите на этот трафик и вот для себя внутри Давайте отметим что мы там видим мне например в глаза бросается что у запросов в начале видите 5701 у обоих А в ответах d701 видно Да это означает что там какие-то постоянные байты используются причем У ответов просто старший установлен вот еще бросается глаза последовательность первых строчках и запросов и ответов что касается нули видим в середине Да вот и видим текст у строчку она конечно первая бросилась FX 5u32 МР То есть это означает что это какой-то идентификатор этого плк вот ну на базе такого анализа более такого немножечко подробного на большем количестве вариантов пакетов вот получили такую схемку то есть выделил Я просто те закономерности которые есть Можете тоже еще внимательно на них обратить обратить на них внимание посмотреть на них то есть у нас есть начали какие-то постоянные значения байт Вот это есть посредством ff-03 красным выделено есть с какого-то момента начинается область данных и вот если посмотреть нули то видно что нулей в ответах немножко больше Вот они выделены таким сиреневым после зеленой рамочки видите два Нолика это статус ответа то есть как плк обработал команду возвраща сам статус скорее всего ну и по другим пакетам было понятно что если ошибка то он там возвращал ошибку то есть мы примерно сейчас уже понимаем Как устроены протокол этот вот еще можно заметить если вот внимательно посмотреть даже на расположение этих данных Вот первый запрос и второй запрос насколько байт они отличаются если так вглядеться они отличаются на 3 байта правильно Вот и мы если поищем даже глазами то мы увидим во второй строчках запросов есть для первого запроса 20 для второго 23 То есть это размер каких-то данных внутри этого пакета то есть ну как бы логично все разбирается буквально в голове то есть мы все этим для этого не надо умений вот имеем такое описание первоначально решили поискать в Интернете Может быть кто-то делал Уже исследовал что мы будем напрягаться и нашли что в девятнадцатом году на одной конференции специалисты докладывали о протоколе то есть в части их исследования он назывался им протокол вот посмотрим его описание я вот его немножко выделил то есть в начале фиксированные значения есть размер данных запросы и ответы есть энт-код n-код это как раз вот этот статус операции подходит вроде Давайте камнем глубже решили копнуть глубже и сравнить этот м протокол с реальным трафиком вот я надеюсь видно реальный трафик справа немножко таким мелким шрифтом вот Ну тем не менее то есть команда есть такая ретрандом смотрим первые байты есть фиксирован но они не совсем совпадают ff03 и в том и в том случае есть то есть это хорошо но есть одна особенность в реальном трафике оно по-другому смещению То есть это что-то другое скорее всего и смотрим код у команды ретриэндом есть код такой 0304 вот если его поискать в этом дампе даже глазами мы его не найдем То есть это значит не совсем тот протокол какой-то другой Давайте сравним наш все-таки трафик теперь с мануалом все-таки полезем в то что мы не любим все делать читать мануалы сравниваем ff03 тоже есть ретрандом 03 040304 она разный порядок его нет в пакете Но мы уже увидели наверное закономерности оказалось что м протокол это по сути то что уже описано в мануале то есть они представили то что есть в мануале и достаточно хорошо описано вот при этом я вот специально выделил здесь такие вещи как девайс наймбер девайс-код это внутреннее устройство о них Поговорим позже и вот А8 прошу вот запомнить эту циферку она нам еще пригодится Итак мы на этом этапе получили некие предварительные результаты это скан с помощью утилиты Map то есть открытых портов мы имеем три типичных порта 11 типичный вот на основе анализа вот такого Как скажем глазного анализа пакетов были написаны скрипты набор скриптовне и мицу-класс по и он как раз делал следующую работу такую низкого уровня в виде класса он раз входящий пакеты и ну разбирал ответы и генерировал запросы по необходимости и три команды были ран стоп и пауз и Вот ребята прямо я взял из реального письма Потому что плк я в глаза не видел и часто я вообще не вижу я просто либо через сеть взаимодействовали либо на том этапе ещё я просто отправил ребятам они их запустили и оно работает то есть полка стартовал останавливался переходил в паузу Ну теперь нужно его копнуть поглубже и тут мы столкнулись с такой Темой которая до этого не встречалась вот оказалось что прошивки есть обновление прошивок они на сайте можно свободно скачать сколько угодно но они внутри зашифрованы и у нас есть очень хороший эксперт по практической именно прикладной криптографии он Вот его фразы приведены что внутри скорее всего ае-128 и две проверки целостности час соответственно нет он внутри самой прошивки то есть каждая прошивка ещё вот последующую Возможно даже ключи меняются пока не этого не знаем Вот пошли другим путём параллельно тоже есть у нас ребята которые с железками хорошо работают они выпали флеш-память там ничего нет запаяли обратно процессору напрямую прозвонили ножки подключились вот и он вернул то что наверное должен был вернуть что чип защищён аппарат производителем ну нужно вводить специальный код вот что делать обычно в работе нужна прошивка чтобы исследовать Вот ну как бы был вариант поставить на полочку чтобы контроллер стоял и пылился но решили всё-таки попробовать какими-то путями по крохам собрать Ну первый Кроха это опять же мануалы это то что я тоже редко делаю но здесь пришлось значит плк достаточно развитую систему имеет и у него есть такая особенность интересная называется они назвали это девайсес внутреннее устройство То есть это по сути вот входы-выходы какие-то счетчики таймер это все девайсы мы можем к ним обращаться то есть писать в них и читать это как бы стандартный функционал Просто у них он вот так реализован и если помните вот эту А8 вот красным как раз это оказывается дата регистра то есть тот код тот трафик обращался к дата регистра что-то с ним делал читал с него Вот поэтому помимо этого еще есть внутри развитые файловая система и мы можем там различные манипуляции даже копирование перемещение файлов удаление и так далее помимо стандартных чтения записи открытия и закрытия Вот и вся настройка выполняется через вот эти Малая то есть чтобы там запустилась как-то его настроить мы записываем туда через файлы настроек и сам проект туда закидываем и справа как раз окошечко вот Какие параметры там можно туда записать Вот это окошечко как раз из утилиты из такой системы которая называется GX Works это развитая система geeksworks 3 и опять же она тоже может дать некоторые крохи информации Вот она позволяет это система развита почему она развитая во-первых мы можем создавать программы и в то же время она является помимо среды разработки она еще является и некоторые инженерные утилиты то есть два в одном мы можем различные манипуляции с плк выполнять диагностировать и отлаживать код на нем вот и что можно из него получить выбирая различные пункты меню мы получаем трафик пункт Меню мы видим за что он отвечает в трафике команды какие-то коды имеют мы можем понять что за коды Что за команды используется второе там есть прекрасный такой монитор пакетного чтения запись в нем мы устройство в которое хотим например этот дата регистр а внутри видим Какие номера имеет это устройство для Именно этого проприетарного протокола который мы исследуем вот ну и через разницу в файлах помните Если вы застали игры времен там начала игр компьютерных мы могли нашего персонажа апгрейдить просто сравнив два файла у слабого усиленного персонажа и там что-то наворачивать здесь такой же принцип использовался такой старой школы что мы меняли параметр и файли настройки смотрели кибайты биты поменялись то есть по крупицам собирали одно из очень хороших интересных особенностей это система jxworks то что нам прям очень сильно помогло явился симулятор симулятор позволял позволяет программы запускать те которые на плк мы проекты мы можем их прям отлаживать и смотреть как они работают то есть там есть прям входы-выходы он прям даже индикацию поддерживает такую как в плк И что самое хорошее Что опять же помогло что трафик этого симулятора был идентичен трафик плк то есть один и тот же протокол что мы можем сделать мы можем этот симулятор преследовать как же он эту обрабатывает Вот и чтобы посмотреть такие бинари за него отвечают ну здесь стандартная такая утилита с интернета многие видели или работали процесс узнаем что за бинарь и Выяснилось что он обращается такой библиотеке FX 5 DLL и в ней две строчки одна из которых как раз нам возвращалась соответственно в этой библиотеке мы имеем как раз реализацию протокола вот также Мы научились запускать этот симулятор отдельно чтобы я ребятам каждый раз крипты не открывал я у себя на компьютере его запустил отдельно и прям к нему обращался тестирую различные команды Ну например был написан скрипт который бросил просто перебором Какие команды собственно в нем есть Ну в плк их 83 было выявлено в симуляторе 54 То есть он достаточно хорошо оказывается поддерживает протокол но тем не менее он не является все-таки самим ПВК Вот теперь перешли крио с инжинирингу опять столкнулся с такой ситуацией что символов нет в этой лодке минимум строк никаких подсказок никаких кодов ошибок Вот что может помочь На этом этапе Ну мы имеем документацию от какого-то протокола который похож на этот но все-таки другой в документации есть коды ошибок Это тоже может помочь Мы уже какое-то предварительное исследование провели и можем на нем опираться вот ну знаем Из мануалов как Все должно работать есть у нас еще скрипты вот эти результаты брутфорсы и самая такая классная штука которая прямо Вишенка на торте это симулятор можно исследовать как может Вот сейчас пойдет такой хардкор вот никто там еще в обморок не упал от чего-то такого сложного может быть Итак это уже прям я вам покажу как глазами реверс инжиниринга все это выглядит слева верхней частью мы нашли обработчик где происходит это интеловский код ассемблерный вот внутри дизайна и добро значит слева видим что там есть два обработчика Type 2 handler и Type 1 hender они внутри разные лезем в тайп 2 хендер и находим что там есть обработчики вот трех команд 0401 0403.0406 это в правой части сверху так 0403 что-то вроде напоминает Вроде мы уже встречали даже в докладе слайдах такую последовательность это как раз та команда девайс риттрендом и она обращается в такой процедуре с автоматически сгенерированным названием Саб 7192 76 30 Пока ничего не говорящее название и к этой же процедуре помимо вот этого Type 2 cmd 0403 обращается еще тайп один тмд 04 11 12 То есть можно сделать вывод что в мануале эта команда 043 в нашем протоколе эта команда 0411 уже некоторую ассоциацию мы сделали дальше как коды ошибок могут помочь то есть эти крупицы они есть везде если их правильно использовать может сложиться картинка как когда ошибок встречаем код вот с верхней части картинки смотрите следите внимательно здесь сравнение стековой переменой с каким-то значением если оно меньше или равно прыгаем куда-то если этого нет то код ошибки 413 заносим Ну в этот код статус операции Окей Что такое 413а смотрим в мануале Это означает что задаваемый размер файла превысил уже существующий размер файла то есть мы попытались файл записать как бы больше чем он может быть значит что за стыковые перемены размер файла и дальше по ссылочкам мы можем все отследить вот из интересных еще таких фишек которые были внутри при исследовании значит внутри симулятора он прям брал такие вот адреса они по выделены оранжевым 66 184 в кексе и 66000 и по этим адресам он как бы их проецировал на реальные адреса То есть он выяснял где они сейчас симуляторе расположены я собрал написал такой несколько скриптов которые собирали эти адреса потом их группировали и делали из них сегментики Вот и таким образом я мог перекрестным ссылкам находить куда все то есть обращается к 6000 я могу найти все обращения к этому 66000 и из этого найти что за код к ним обращается уже понять для чего это все происходит и Выяснилось что например 66000 это вот устройство входов даст проектировано устройство входы контроллера То есть каждый раз когда контроллер читает что-то оттуда он Бер кто-то из устройств каждый раз что он пытается что-то писать он что-то во входы пытается свои же писать Ну и было это все обозначено и мы имеем здесь следующую ситуацию что симулятор в своей работе достаточно четко моделирует работу плк что даже внутренние адресация совпадает Это очень хорошо Ну было получено полученные результаты это описание протокола здесь я привел как бы общую структуру сверху мы видим заголовки и в трафике выделены соответствующие поля для некоторых заголовков то есть мы имеем некоторые начальные заголовок низкоуровневый дальше мы имеем там есть внутренний маршрутизации интересные То есть он может через один плк обращаться к другим такая сквозная вот зеленым выделен размер данных для пакета есть также команда ее данные Ну и вот этот статус операции вот он красным код выделен он только в ответ помимо этого привезены вот результаты следующие по устройствам и командам конечно выборочно потому что мы помним что команд там было порядка 50 только в симуляторе плюс по косвенным признакам мы могли узнать какие-то которых нет в симуляторе но есть плк что-то такое найти Вот и значит по устройствам в левой части табличка помним а 8 то эту цифру это дата регистра для нашего протокола это 20h то есть теперь мы знаем Каждый раз когда он будет обращаться к 20 Сашу но обращается к дата регистр таким образом Ну можем понять что делает собственно трафик этот в этом протоколе что он делает спел кашкой Вот и справа если мы увидим то что мы уже ну как бы на реверском слайде Я немножко рассказал Это команда рядом Рид мануале 0403 у нас это 0411 вот Казалось бы имеем протокол Что может быть интересного скучная вещь какие-то таблички формулы и таблички какие-то описания но зная даже протокол мы можем сделать достаточно много и ребята Меня попросили такую интересную ситуацию смоделировать которую я сейчас покажу на Демона был такой интересный сериал старый Я честно скажу не видел до того как ребят может видел в детстве Рыцарь дорог назывался там герой у него была машина интеллектуальная называлась она кит и у нее впереди была такая как змейка Ну типа свидетель светодиодные лампочками она моргала и Ребята давайте моделируем к это все на Mitsubishi Пусть он выходами нам так делает с одной стороны мы покажем что мы можем манипулировать выходами напрямую просто посылая трафик а с другой стороны это будет как бы интересная демка Ой вот она что-то не запускается можно там как ты кликнуть Нет не запускается по кликеру Night Rider Kit момент придется вручную запускать попросим пультовую Но это ребята уже пошутили так видос то идет или нет а вот сейчас будет Сейчас выведут это ребята пошутили мою голову прирезали к этому герою так заминка прошу прощения вот сейчас да они даже тему наложили но пока что-то нету ну В общем он двигался так как нужно я специально сделал скриптик который гасил светодиодики и зажигал и это все вот так вот двигалось Давайте тогда дальше я надеюсь следующий Дима нам а Да он просто по сетке кидал пакет и все Так ну и перейдем к уязвимостям здесь так момент и те кнопки жму мы нашли ряд уязвимостей в целом в проекте был найдены 15 уязвимостей Вот такими косвенными путями исследованием Вот и мы в декабре отправили их вендеру в Mitsubishi они нам ответили достаточно быстро в январе сказали что вот 7 уязвимости 8 вернее которые в самом контроллере Мы за релизеем очень быстро а 7 который внутри Джейкс воркса мы их достаточно больше времени требуется чтобы их исправить и вы хотите отвайзеры вот ну то есть смотрите январь В марте они уже 6 первых за релизели и в мае 2 еще добавили и Обновили информацию вот в ноябре сейчас ждем когда информацию они нам покажут внизу ссылочки на двайзере на те которые уже есть ну по самим уязвимостям посмотрим значит их можно вот разделить на два типа первые уязвимости связанные с некоторыми защитами самого паилка и тем как у них ну все устроено поскольку у них устроено все ну как бы можно сказать неисправимо можно сказать то они просто выкатили мы рекомендации по этому поводу вот и здесь примечательно что мы-то исследовали FX 5u контроллер а этим уязвимости подвержены контроллеры других серий rql вот такой Хороший получился выход как бы исследователь и две уязвимости внизу самыми одна из них самым большим самое большое оценкой 86 это связанные с отказом в обслуживания Давайте их немножко подробно рассмотрим прям как они устроены значит 25 161 внутри есть процедурка Которая из смещения внутри устройства находит реальный адрес внутри плк а реальный адрес вот по очень простой формуле вычисляется он зависит от начального адреса устройства и смещение внутри устройств Все очень просто и плюс размер элементов здесь например возьмем два по два байта элемента у нас возьмем устройство с этим адресом 56000 и возьмем для него смещение вот оно красным выделено слева ffc d00 и если мы это все подставим в эту формулу то у нас реальный адрес получится нулевым давайте это немножко на заметку возьмем Вот этот смещение в устройстве оно проверяет друг мы за устройство захотим прочитать и записать Вот Но есть такая фишка что если реальный адрес равен нулю то это смещение не проверяется Поэтому передавая вот такие большие значения мы можем писать за пределы памяти который нам доступно для записи и читать оттуда то есть небольшие куски мы можем читать писать ниже у нас показан дальше должна быть демонстрация Я надеюсь может быть получится ее запустить Значит у нас есть нефте момент если мы эти уязвимости будем запускать на реальном оборудовании то это может привести к плачевным последствиям обычно в проектах в компаниях крупных у них есть специальные стенды где можно это все отладить вот и где можно поиграться с этими пруфов концептами различными и так далее было написано про концепт первый уязвимости отказа в обслуживания 25 161 и мы решили его проверить на стенде который моделировал работу некоторые нефтеперекачивающие станции там были насосы и задвижки и плк Mitsubishi реальный плк управлял этим насосами задвижками вот можем на картиночку посмотреть в серединке видим большой красивый экранчик это скада внизу наш контроллер сверху стенд где все двигается прям соответствие как в реальности слева ноутбук с которого будет запускаться Покров в конце вот видос опять не запускается Давайте Может быть я продолжу описать запустился отлично имеем насосную станцию здесь видим скада какие-то процессы регулировки под контроллер у нас теперь рука моего коллеги запускает мой скрипт вот красным все загорается у нас проблема Хьюстон вот серединки имеем что не скаты не подключается к плк сам плк в ошибочном режиме ходы-выходы потухли То есть он все можно сказать помер если вернуться вот к описанию то именно 25 161 чтобы ее когда она активизируется Единственное что мы можем сделать это перезагрузить железный этот полка других способов нет в таком завешенном состоянии вот еще была вторая уязвимость наверное дальше не будем еще рассмотреть вторая уязвимость 2562 она попроще Ну вернее не попроще у нее Импакт попроще значит внутри плк есть файлы своего формата у них есть заголочек и тело файла заголовочки красным выделено размер этого заголовочка и этот размер используется при закрытии файлов подсчитывается контрольная сумма этот размер используется для вычисления размера тела файла который зеленым выделено для подсчета контрольная сумма То есть если мы зададим этот размер достаточно большим как вот в примерчике где строчка хакер у нас имеется 43 4Б то размер файла всего 643 4b вернее 4b43 получаем большое число и подсчет контрольной суммы сваливается на невалидных адресах Вот здесь мы используем другой макет этого дозаборная станция там есть различные установки забор воды резервуары какие-то насосы опять же насосы А Мы помним что Mitsubishi часто управляет различными насосами вот ну и запускаем демку здесь так поехала значит видим здесь другой процесс немножко водичка льется другие на скаде показаны управления вот наш контроллер и слева опять ноутбук и рука коллеги запускает все становится красным индикация что все плохо но внизу сейчас ведет на плк Мы видим что здесь ситуация другая белка продолжает работать он не в этом ошибочном состоянии что же происходит Давайте сравним немножко эти два пока то есть 25 161 видите у него большая оценка 86 он делает практически скажем так убивает полка можно так сказать до перезагрузки а 256 и все собственно мы сделали такую апдейт просто скрипт соединяется по всем пор на котором можно соединиться вышибает скаду предварительно из кадры просто не может соединиться с этим полка то есть оператор не получает данные не может управлять ими вот таким образом получена такая Интересная ситуация В итоге протокол разобрали учились общаться уязвимости нашли все благодарю за внимание Антон как всегда очень супер интересно копаться в чужом неизвестном проприетарном коде Я думаю что большинство слушателей Если вы даже не работаете с прошивками Это явно знание о том что если вы что-то пишете на интерпретируемых либо компилируемых языках программирования и потом это достается вашим клиентам это лишь вопрос времени разобраться как это работает даже порой кода и самого доступа может К устройству не быть вот поэтому это мне просто пример как человек бы потратил время чтобы восстановить какие-то ваши внутренние вещи вот поэтому не застряйте внимание чисто на полка это можно делать Хоть с различными плагинами для браузеров и так далее Вот теперь у нас вопросов и ответов есть немножко времени поднимайте руки есть подарки непосредственно за лучший вопрос ты запоминай ребят Дайте пожалуйста микрофоны Добрый день Антон Спасибо за доклад у меня вот два вопроса Первый вопрос удивительно что прошивка зашифрована процессор от реверсинга защищен но при этом протокол обмена с устройствами нешифрованной не наводит ли это на Мысль о том что никто не собирался его ломать либо эти устройства раз э-э с ними происходит не шифрованное общение Э не должны стоять в тех местах где на них будете проведена должна быть атака И второй вопрос из этого вытекающей А чтобы вы делали если протокол всё-таки был зашифрован сам протокол обмена либо подписан То есть он не подписан ни зашифрован очевидно что это устройство не для какого-то критичного использования ну здесь по поводу использования Я только информацию от коллег как бы имею Я не особо-шник вот ну я вам пример привел пример что в реальности это используется в достаточно критичных областях Ну если рассматривать Вот в общем то по сути влияние на любую часть жизни нашей там допустим даже на систему кондиционирования в здании Казалось бы не особо критично Но может привести каким-то таким критическим последствиям что касается протокола если бы он был зашифрован Ну я не знаю Здесь что делать все-таки симулятор тоже есть и можно как-то по нему еще работать потому что да да но этот достаточно распространенное явление симулятора вообще то есть это не только у Mitsubishi А еще в некоторых как бы по мотивам этого проекта были еще проекты и в них были тоже симуляторы и благодаря вот как бы этому накопленному знанию полученному эксперту экспертизе получилась потом более просто легко решить другие задачи то есть там тоже есть эмуляторы и все тоже можно посмотреть а можно микрофон чтобы у нас и трансляция непосредственно слушала Но шифрованным протоколами честно скажу не сильно общался для этого у нас очень хороший специалист есть который их также может как и мы трафик глазами разбирали он их глазами практически просто сколько я в своей работе сталкиваюсь с промышленным оборудованием для которого мы Разбираем протоколы везде Абсолютно даже в самых простейших там деревообрабатывающих станках используются цифровые подписи Хотя бы даже без шифрования разобрал протокол но без цифровой подписи не что-то этому устройству не подсунешь то есть опять же я говорю делаю вывод что контроллер скорее всего предназначен не для каких-то ответственных областей супер критичных не на атомных станциях тоже точно Это скорее всего так Ну понятно вас личного опыта разбора шифрованных протоколов Нет вот интересно было послушать Что делают в этом случае если трафик всё-таки защищён у нас Я честно скажу я как бы занимаюсь прошивками больше а есть человек который занимается всем что связано с шифрованием Я думаю может быть слышали если в этой области есть Дмитрий Скляров такой вот он просто с этим разбирается вот так вот то есть коллаборация приходит к нему приносит А уже дальше анализирует я понял он вот буквально есть же часть посвящённая различным Крипто алгоритмами подписями внутри вот джейксфоркса вот он это вот разобрал там за день за полдня и даже дал скрипт который всё обратно То есть у них есть там самодельные всякие системы шифрования есть защиты для этого полка и он их разобрал очень быстро Спасибо так я видел еще кто-то поднимал руку есть вопрос Антон Спасибо за доклад есть такой вот вопрос Вы упоминали Джей так то что ваши специалисты подсоединялись к флеш-памяти Насколько я понял к самому процессору Откуда вы взяли регистры джитага То есть тут же тоже вопрос такой как бы это какая-то была у вас спецификация на них или Это какие-то стандартные используются там флеш или просто тот же какой-то здесь поясню здесь делали тоже отдельные ребята опять же коллаборация вот из того что я знаю что могу об этом рассказать то есть это не я делал не я э-э паял и распаял то есть флеш-память внешне они просто выпали причем Это bga был если в теме Ну так достаточно трудоемкая вещь и обратно в паяли что касается процессора они по ножкам нашли какую-то спецификацию Ну в смысле на что-то похожее или по маркировке и еще по прозванию конкретно ножки и дальше подсоединились как это у них устроено Честно не могу сказать я вот как бы за свою часть отвечаю Спасибо И еще такой вопрос небольшой по поводу реверс инжиниринга именно прошивки там где за сэмблер все дела используете ли какие-то тузы для нахождения повторных символов то есть каких-то ну грубо говоря вот сравнивать в этом упоминали что вопрос-ответ да в трафике и там есть какие-то повторные набор байтов Вот вы их находите просто глазами смотрите или какие-то тузы используете для этого Ну на самом деле тузы больше всего я использую какие-то самоописанные скрипты которые вот эти вот закономерности находят то есть есть набор но он так не универсальный он проект чуть-чуть подзатачивается и делает своё дело Спасибо так еще есть у кого-нибудь вопросы да вот Антон туда пожалуйста Антон Спасибо за доклад очень интересно А у меня такой короткий вопрос Вы курьез упомянули с принтером поподробнее можете рассказать что там случилось Как при помощи принтера атаку провели Я думаю это отдельный доклад даже посвящённый этому Но если вкратце на одном производстве каким-то образом рядом с каким-то большим манипулятором оказался принтер вот решили Давайте попробуем с него атаковать этот манипулятор Ну и собственно дали мне прошивочку от принтера я её взял для неё импланты закинул обратно и она атаковала а потом мы это все дело немножко масштабировали нашли принтер с вайфаем вот и через ну как бы тема была такая что через обновление мы новую прошивку ставим и через wi-fi управляемый а он плк уже воздействует наверняка в одной wi-fi сети не в одной водой Ethernet сети но Мы подъезжаем к заводу через ноутбук wi-fi подсоединяемся к принтеру даем ему команды для вот этой модифицированной прошивки она уже стреляет флк Спасибо Спасибо Так нам хочу еще также напомнить что у нас есть возле зала дискуссионная зона предлагаю с Антоном переместиться в дискуссионную зону и там поспрашивать оставшиеся вопросы нас уже готовится следующий спикер хочу еще раз Антон тебе поблагодарить за отличную доклад У нас есть для тебя подарок плюс тебя непосредственно Кто лучше вопрос задал чтобы мы могли подарить ну вот протоколы вот тогда молодому человеку тоже подарок всё ещё раз Аплодисменты у Антону и можно в дискуссионной зоне позадавать ему еще хоть сколько угодно вопрос Спасибо за вопрос"
}