{
  "video_id": "zb4Cpvx-HEE",
  "channel": "HighLoadChannel",
  "title": "Высокая нагрузка или/и низкая задержка / Максим Юнусов (IT One)",
  "views": 1108,
  "duration": 2924,
  "published": "2024-10-29T03:07:39-07:00",
  "text": "хочу пригласить на сцену следующего докладчика это Максим Юнусов из компании it он там ведущий Эксперт Ну и он расскажет нам про архитектуру изменения архитектуры одной очень достаточно популярной системы Да Добрый вечер дамы и господа добрый день Точнее Уте бы рассказано заж не методологи кото мы использовали при решении этой задачи но так как у нас собственно е будут высокие нагрузки соответственно высокие нагрузки и или низкие задержки Хотя опять же да что подозвать под высокими нагрузками есть такой хороший критерий Если система не справляется Да с нагрузкой то нагрузка автоматически считается высокой нено Отойду от общего плана широва некоторые реально существующий проект показать как на самом деле эти методологии работают на практике Да собственно в реальной системе конкретно система с которой я вас познакомлю Возможно вы с ней уже знакомы это система с система межведомственного электронного взаимодействия ини государственной власти собственно Ну и в частности предполагается что в дальнейшем к этой системе Бут подключены возможно и прое организации Да любой банк и так далее да любое частное лицо Возможно даже получит доступ когда-либо в эту систему что собой представляет Эта система Да пока ещё не архитектура Да вот поближе немножко к архитектурному представлению Дан изначально предлагался собственно модный достаточно то есть поставщики предоставляют свои данные клиенты к этим данным обращаются клиенты обращаются к определённым данным через некоторую подсистему котора называется Под система Транспортная Да фактически которая обеспечивает взаимодействие клиентов и поставщиков опять же предполагается возможность выпо далее и тому подобное то есть большой такой ассортимент услуг предоставляет Эта система соответственно вот по этой системе мы с вами и работаем система по удд Конкретно где я прикладывал свои усилия да Ну и что с ней у нас более детально на следующем слайде на этой диаграмм схема скажем так это всё-таки не архитектура некоторая схема схематическое представление системы подд что она собой представляла некоторый набор компонент связанных между собой да решающих задачи разные Да по доставке связанные с доставкой ну прежде всего ядро это планирование запросов на базе кальцит понятно что должно быть некоторые ограничение нагрузки чтобы нас не задо сили рано или поздно некоторые фасады позволяющие собственно входить выходить из системы Да собственно Ну и со всех сторон к нам подключены те самые участники взаимодействия потребители и поставщики Ну и понятно раз у нас есть и некоторые распределённые механизмы Да здесь ещ механизмы управления выполнения запросами транспорт который здесь у нас есть разнообразен был на первом этапе Да трансформации То есть это был Пульсар Это был ре это было ещё что-то Да собственно говоря в любом раскладе различные транспортные подсистемы организовывали взаимодействи сном собственно любой запрос приходящий к нам разбирался и планировался с помощью этого инструмента в дальнейшем собственно говоря по разобрано плану выполнялся гарантированность доставки обеспечивалась с помощью Пульсар пач Пульсар известный может быть многим механизм такая модная альтернатива Кафки собственно говоря позволяющая нам закидывать в частности все сообщения ие в сист на ди и ВМС где-то пропадает собственно с дисков их же поднимать Я думаю классическая схема не удивительна далее соответственно до трансформации мы могли поддержать 1.000 пользователей активных одновременных собственно работающий с нашей системой по времени отклика секунда собственно и мощность 5.000 запросов в секунду это собственно характеристики системы до трансформации с таким набором характеристик мы уходили впт собственно заказчику хотелось немножечко всё это улучшить что хотелось улучшить прежде всего Да собственно 25000 активных пользователей вместо тысячи получить мощность должна быть вместо 5000 30.000 соответственно да время отклика не более 0,5 секунд на 99% вот такие поставили перед нами задачи Понятно задачи задачами были е и ограничения ограничени была масса основные из них следующее всё это на имеющемся железе железом нельзя классическое решение всех задач производительности затопить железом Да и опять же ещ один момент в кратчайшие соки то есть надо было за квартал всё это сделать таким образом классическая Революционная архитектура кото очень многим нравится да когда что-то попробовал Получилось Не получилось переделал Да собственно говоря здесь не проходило здесь надо было сразу спроектировать и за оде Эрони та в дам не пришлось архитектуру менять аите надо было сразу предложить такую чтобы оно вопервых девой оказалась вовторых попадало в ожидаемые показатели Ну и собственно гово как мы этого добивались как на этапе проектирования решить эту задачу не выводя всё в железо Да собственно говоря давайте я Коротко вас с этой кухней познакомлю и любо систе высоко нагруженной является так называемая бутылочная рошка то есть тот самый та самая потребность тот самый ресурс который более всего грузится он собственно и замедляет нашу систему больше всего во всяком случае вот есть некоторые аппроксимирующих здесь показатели показывающие что выше чем собственно потребность на бутылочной шке Вы не прыгните у вас будет В любом случае не выше Да а пропускная способность меньше чем едини на потребность очень много учебников рекомендует начать оптимизацию с оптимизации с поиска и оптимизации бутылочного горшка найти тот ресурс который потребляет больше всего который загружен более всего собственно оптимизировать работу именно на нём притом Да понятное дело что оптимизация на этом ресурсе существенно лучший выигрыш даёт чем оптимизация любого другого участка вашего входа Ну то есть например если у вас там участок 80% от всего потребления ресурсо занимает собственно понятно что оптимизировать его в выгоднее чем оставшуюся часть в 10 классический рецепт принцип центрирования находим чное горшка собственно говоря да как я уже сказал предлагается многими учебниками дальше собственно работаем на НМ в нашем случае бутылочная игрушка даже собственно тестов запускать не надо было понятно находилась в области кальцита собственно обработчик наших запросов он собственно и тормозил больше всего систему потребляя ресурсы процес разбор планирования запроса на паль выявили Что делаем дальше сразу да привожу книжку по которой дальнейшие собственно некоторые тактики выва вливались да Обычно спрашивают обязательно какой-нибудь вопрос в конце выступления Назовите материалы источники я сразу попытался сюда их включить чтобы даль грамотно маленькими шагами выбираем тактики повышения производительности конкретно тактики улучшения вот этого самого показателя потребления Иисус тактик соответственно в книжках у нас много там за десяток уходит количество их Я здесь показываю короткий список достаточно что мы можем сделать Да вот выписали Это эти тактики последовательно начинаем их защищать первое оптимизация алгоритма хороший заход был бы Да собственно если бы кальцит писа писался нами конечно ВС что можно сделали отли своё почти Да собственно говоря решение но упёрлись в конце концов в некоторые основные там механизмы которые переписывать не иск нули таким образом оптимизация алгоритма Не наш вариант эффективность здесь не особо работает далее при использование ресурса результата второе решение Многие считают это первым да то есть чуть нужно уведите кэширование кэширование конечно хорошо в нашем случае не работает Почему Запросы уникальные соответственно хиты не какуе таким образом хеширование не даёт никакого эффекта следующий вариант уменьшение накладных расходов хороший вариант Когда у вас например там сеть всё прочее у вас очень много времени уходит на взаимодействие на всевозможные там перекладывание из одного места кодирование перекодирование и так далее и тому подобное здесь не работает ну в рамках кольц это что там у нас где накладных расходов Там просто нету И последнее Как вы понимаете Не зря оставлено последнее раннее связывание подход следующий А что если мы будем делать работу до того как мы выйдем на основной путь работы собственно говоря Ну давайте заранее всё проделаем а потом уже будем гонять эти самые запросы в данном случае чем облегчало для нас эта работа тем что большинство запросов регламентированы то есть иски ёлки заранее известны Да скажем Так банально что нам мешает заранее просчитать собственно говоря все эти планы а потом просто хватать их с диска простое решение банально убираем соответственно кальцид с основного пути теперь у нас как Особый случай в том случае когда у нас слка идёт неизвестно непонятный нам запрос Да идёт мы его погоним через кальци во всех остальных случаях возьмём готовый уже за кашированный план выполнения запроса сократили время выполнения существенно Ну то есть фактически в ноль Да ухом Однако возможно Вам известно это правило бутылочное горшка устранить нельзя его можно только передвинуть Да собственно говоря Вы можете собственно идти от одного бутылочного рошка к другому в нашем случае ищем следующее бутылочное рошко теперь да устранили кальцит куда упирается дальше дальше упёрлись криптопро ну здесь уж вообще оптимизировать алгоритм Да собственно то ещё Дело конечно можно но чтобы никто не узнал об этом да как-то так таким образом оптимизированы алгоритма не проходит при использование ресурса не проходит но как переиспользовать зашивать чтоли собственно говоря проверку сертификата Дани както нехорошо тоже уменьшение накладных расходов не работает раннее связывание Ну тоже заранее да проверить сертификаты и потом пускать тоже не работает ничего не работает тупик алгоритм поиска бутылочного горшка дальше даёт сбой мылись в очередное бутылочное гошко с которым ничего сделать не можем что получилось у нас на этом этапе на этом этапе собственно время отклика у нас Ну вот примерно здесь покинута Да собственно при том что там этот самый криптопро даёт нам 100 микросекунд собственно говоря на обработку простейшего запроса на самом деле Понятно в очереди придётся постоять там по экспоненте немножечко там посчитать 300 микросекунд мы имеем на основных наших сервисах понятно это не на всей системе ликом поми надо Ну и плюс к этому также акти польва навсего и пропускная способность нас тоже не удовлетворяет всего лишь 10.000 запросов в секунду а надо было 25 Что делаем дальше Ну как учит нас умный тыс если в системе не удаётся больше ничего улучшить Давайте выходить в надсистему выходим в надсистему Да собственно смотрим на систему целиком в совокупности уже то есть не точечно бьём Да по сервисам а по всей системе целиком смотрим Что здесь можно сделать вот здесь как раз можно справиться с накладными расходами обращаю Ваше внимание здесь появляется сетевое взаимодействие можно оптимизировать это самое сетевое взаимодействие как ну прежде всего Давайте посчитаем А сколько у нас тут взаимодействий на одном на пути одного запроса Ну шесть Да собственно говоря притом большинство из них это ач пульса уменьшаем накладные расходы за счёт чего ну прежде всего конечно за счёт снижения с количества этих самых взаимодействи ВТО пос сст их легче сами по себе и такое некоторое правило которым я пользуюсь в своей практике Да собственно микросервисы - это не про производительность Если вы хотите производительность Конечно вы можете баловаться микросервиса на микросервис это всё-таки о том как быстро вывести фичу на рынок таким образом Да собственно Если вы хотите избавиться от накладных расходов вст лучше чем куча маленьких собачек укрупнить уменьшили количество соединений выиграли да вам может быть кажется что немножко на спичках сэкономили Ну что там да там сетевые соединения в рамках цода Да собственно какие там копеечки Да собственно горя пойдут секундами микросекунда Да всё это пойдёт Но в любом раскладе конечно это копеечки Но с другой стороны помните что там е кодирование кодирование Т механизмы собственно эти те же самые запаковать плюс к этому да ко всему прочему ВС это нагрузка на сеть что не всегда приятно дополнительно да то есть у нас собственно говоря если на двух соединениях будет там 100 мегабит в секунду Да собственно то на ше это будет понятное дело уже 300 соединения сделать их легче обращаю Ваше внимание наш Пульсар каждое сообщение пишет Ну конечно Он в бэке его пишет но всё равно пишет на диск забиваю тем самым диск и делает он это конечно очень быстро и эффективно но чего он не умеет делать эффективно и быстро в силу свои особенности Да он не умеет быстро и эффективно стирать вычитает належать разным тенант Да собственно разным заказчикам таким образом собственно говоря наши диски под нагрузкой переполняли просто очень быстро отсюда и ограничение в количество активных пользователей выкинуть сохранение на диск Разумное решение убираем сохранение на диск Спасибо команде разработки подсказали замечательный используемый механизм Socket собственно говоря я вообще не особо люблю внедрять что-то неизвестное мне новое нотом в этом проекте познакомился собственно теперь он меня в арсенале сидит плотно Да я считаю достаточно интересно заменили Пульсар на и никаких дисков совсем брокер не получили Да в конце концов но брокер У нас остался но самописный лёгкий перегоняющий собственно говоря входные запросы от пользователя дальше нашим врм обрабатывающим задачу Да собственно потоковое взаимодействие Кстати да может сидеть поверх разных других взаимодействий А раз потоковое это означает мы соединение оди раз установили а потом опять же не тратим время на его становление фактически работаем с тем что есть следующий момент чего мы потеряли поставили ВС конечно хорошо А где же гарантированная доставка теперь собственно гово ВС гонится через память Всё конечно быстро да но собственно опять же при этой быстроте как обеспечить пять девяток обще на диск не является единственной схемой обеспечения гарантированной доставки была такая ещ Старая добрая схема Да прописанная в книжки по интеграционным корпоративным паттернам возможно читаемые многими схема с надёжным подписчиком то есть работаем по следующей схеме гоним все запросы через нас через память фактически Да но если вдруг кто-то на нашем пути почему-то запрос не забрал сообщение не взя на себя случае сбрасываем его на диск Куда сбрасываем сбрасываем в очень быструю схемку да Опять же K value да В данном случае использовали буккипер который остался у нас польс пульса таким образом всё идёт через память и в случае если доставки не произошло тогда только уходит на диск и поднимается оттуда когда Агент заново появляется Да и вычитывает свои сообщения существенно сократили работу диск больше не занимаем сеть больше не занимаем 30.000 активных участников держим без проблем эту задачу решили осталось Задачка собственно говоря третья последняя пропускная способность 10.000 криптопро упёрлись дольше же ничего делать нельзя Да собственно здесь как решаем эту задачу Я думаю ответ многим уже понятен Ну то есть когда собственно говор мы не можем выжить по одной цепочке уже больше ничего мы выходим на масштабирование сколько нам нужно элементов Да по масштабированию собственно говор С запасом Ну давайте посчитаем Многие считают очень просто умножают собственно количество Да запросов точнее на увеличение нагрузки коэффициент увеличения нагрузки то есть опять же если у вас сейчас держится 10 запросов вам надо 30 ну возьмём запасом 40 да Значит ин существенно ниже утилизацию по вашему каналу и существенно лучшую систему поэтому рекомендую Да использовать вот этот самый закон который здесь на экране выведен Да позволяющий вам рассчитать отношение обычно сервисов инстан сов Нужно всё-таки несколько меньше когда вы проектируемы в данном случае нам нужно 3,4 3,4 в нашем случае не принципиально всё рано В общем че понятно Когда у вас их сотнями да то конечно это принципиальный уже момент Итак че инстанса нужно ВС замечательно ставим инса ВС проблему масштабирования как будто бы решили ну как будто бы на самом деле в теории решили немножко забегая вперёд на практике она так не решается Почему Но потому что масштабирование - это к сожалению не только количество железа Да это ещё и например грамотная балансировка и несбалансированная работа в любом случае Марова убиват предположим ш балансиров запра все остальные стоят Ну всё собственно говоря стоим поэтому вам нужен грамотный хороший балансировщик который правильно распределяет задачи по инсам Да желательно используя понимание размеров этих задач веса этих задач так называемое умное планирование нужно в этом случае есть ли у нас умное планирование в коробке Ну к сожалению нет кубернетес не умеет по умному он умеет только по глупому соответственно Можно конечно его поть немножечко можно самим сделать нормальное решение мы остановились на втором варианте балансировку перетащили на клиента фактически наш брокер является клиентом наших ров собственно он же занимается балансировкой балансировка самая такая простая с точки зрения реализации по минимальной очереди кидает туда у кого сейчас очередь минимум да То есть фактически Ну балансировка конечно не идеальная не самое лучшее можно было придумать что-то более лучшее собственно в норов Дат лучшие показания пон по задержкам нашей системы но при всм при этом на самом деле си достаточно тяжела в изготовлении Что такое СИ это когда у нас есть отдельные инстансы работающие со сложными задачами с тяжёлыми и есть ИНН работающие с лёгкими задачами в этом случае у нас практически идеально при хорошем мосе зада времени пять тяжело это сделать опять же знать размер зада кам обм оценивать не все могут с этим справиться ещё один момент А как же законом дала да Сейчас красиву я вам формулу показал Я заметил некоторые даже сфотографировали Да там всё так линей ненько растёт добавляем инстансы собственно говоря у нас появляются новые мощности Да собственно говоря всё хорошо замечательно на самом деле конечно ничего подобного на самом деле есть такие вредные люди как Адал Да собственно кото всему этому написали ненужные законы Да показывающие что Всё может быть намного хуже приходит ко мне руководство говорит Ну замечательно чето мы выдержим Да собственно нагрузку на чех инстанса а На скольких ещ вот какова наша предельная мощность До скольки мы можем масштабироваться как ответить на этот интересный вопрос не вылезая за рамки опять же проектирования то есть не экспериментирую на железе вот точная модель процесса по которой всё можно посчитать известная может быть некоторым Ф С не буду Надеюсь Некоторые из вас возможно достаточно продвинутые чтобы собственно легко считать по этим коэффициентам онга Да собственно говоря Ну я считаю что это очень крокодилье что-то Да собственно говоря не уж Здесь математика бессильно и мы теперь должны уходить в железо и только там экспериментировать собственно го считать конкретно по тестам да на самом деле не факт кто сказал что у на только одна модель существует моде обслуживания да возможно знакома вам существуют и другие модели в частности универсальный Закон масштабирования и формул здесь намного проще намного легче Возможно вы её видели она конечно более приближённые такие варианты даёт аппроксимирующих Да не совсем точные по расчёту но в конце концов достаточные для при двоичного прикидався что с нами плохо Ну проще всего конечно всё-таки снять какие-то показатели на прототипа загнать их в систем Раньше я такие вещи делал с помощью Excel теперь нашёл для себя язык а а Да собственно гор жутко Мне нравится на самом деле Вот здесь результат расчёта и книжка по которой я руководствовался да для проведения подобных рабо Ну здесь же собственно очень мелким шрифтом показано как всё это сделано разглядывать собственно гово здесь конкретно по шагам ВС это да по коду вы сможете перейти там более подробно расписано как собственно всё это изготавливалось интерпретации результатов Что может пойти не так высокий штраф конкурентности Альфа не та первое если Альфа не та то мы выходим на Плато и дальше сколько мы мощность не увеличивали Да собственно го всё выигрыша производительности Нет этот самы закон нам дала упёрлись Это общий участок кода какой-то блокировка какая-то между нашими сервисами ещё хуже когда сервисы начинают активно взаимодействовать между собой болтать это штраф когерентности так называемой бета в этом случае мы получаем ещё более интересную картину мы увеличиваем количество инстан сов в нашей системе а производительность у нас падает И вообще вообще замечательный результат собственно по нашей схем производительность у нас падала где-то в районе 10 уже инв собственно г наш того негодяя того собственно недостойного участника нашего взаимодействия который рубил наши сервисы по взаимодействию это вот собственно сервис блокировки через которую все ходили наши сервисы который обеспечивал нам тот самый лимитер Да собственно но безлимите опять же в асинхронной системе никуда Как вы понимаете если отклика собственно мы дож каким-то образом контролировать поток слава Богу существуют разные механизмы контроля потока не только ограничение пропускной способности Ну в частности обратное давление которое идёт из коробки с тем самым сокетом о котором я уже говорил контроль длины очереди Да собственно контролируем длино очереди обратно дам наших агентов приемли таким образом собственно обеспечиваем работоспособность системы целиком это основной механизм хотя мы совсем не выкинули он остался у за предела основного контура Итак архитектура системы после трансформации Да сравнимая с той которая была до трансформа после трансформации показано собственно Горя сиреневым как я уже сказал 30.000 пользователей мощность подняли до 6 запросов в секунду на четырёх инстанциях время отклика Ну меньше чем 0,5м слу удовлетворяющая заказчика вот собственно результат нашей работы что сделано слабов занна система опп сообщени расчёт плана обработки сохранение сообщений только при невозможности их доставки опять же обратное давление Ну в общем здесь перечислены основные этапы нашей работы Казалось бы все эти шаги очевидные да Но даже больше наверное не про эти Шаги на которые вы можете выйти из своего опыта а проникаю методологию то есть это всё делалось в рамках пошаговой зачистки Да фактически и выйти на эти не выйти на эти шаги Мы просто не могли действуя по опреде что ещ можно сделать на этом слайде перечислены варианты Но прежде всего да Умный планировщик сделать его чуть умнее можно можно сделать собственно говоря опять же деление задач на кванты если мы выйдем в сторону вот той самой жидкости Да собственно говоря который обожают многие специалисты в области высоких производительных систем есть квантовая такая жидкость состоящая из минимальных по объёму задач тогда мы собственно сделаем производительную систему максимально производительную систему да Как кстати поделить задачу на кванты Да собственно самое простое решение использовать какие-нибудь механизмы на потоках Да собственно как в операционка сделано с вытесняющее многозадачных рутина Ну в общем в этом направление двигаться можно но как вы помните у нас кальцит и криптопро внут наме кто засунуть рутину будет сложно Надеюсь когда-нибудь появится такое решение Ну и собственно говоря можно даже собственно пойти вообще на хитрые системы типа вот абсолютного оптимизма к нам пришёл запрос а мы вообще не проверяем сертификат этого запроса перед тем как передаём его поставщику Пусть поставщик ответ Вер посмотрим да сертификат к этому моменту должен быть уже проверен по идее стоит его отдавать или не стоит Да теперь мы точно знаем кто у нас запросил Это ответ да с точки зрения н и производительности нашей системы - это идеальное решение с абсолютным оптимизмом Да но хорошо ли к этому отнесутся безопасники вопрос в это то есть есть ещё дальше куда улучшать слава Богу заказчику дальше улучшать не понадобилось на этом этапе мы достигли целевых показателей поэтому оставляем в уме Ну и на этом собственно говоря коллеги Спасибо за внимание заканчиваю Максим Большое спасибо за доклад Да Сейчас у нас вопросы я это самое Напоминаю что у нас четыре подарка И поэтому очень сложная у Максима задача выбрать четверых людей которые задают вопросы Давайте с вас начнём Максим Спасибо большое за доклад очень круто такой вопрос На входе в эту в эту историю Было ли у вас стопроцентное понимание что задача решаема ведь бывают нерешаемые задачи с условиям ограничений по ресурсам денег больше не дадут железа больше не дадут Да тут как раз очень оче сейчас я дополню и соответственно ложить что вы пошли в такую ситуацию как бы вы строили доказательства заказчику невозможности его запроса Да очень хороший правильный вопрос на самом деле математика Она ведь имеет два важных качества Да вот то самое математическое моделирование которое ча отчасти было продемонстрировано здесь Первое - это собственно предсказать показатели системы Да а второе собственно показать риски где система собственно Может просто не стрельнуть Да собственно не сработать но и собственно где вообще мы не можем выполнить повышенные требования зака опять же тотже самый математический аппарат позволил бы нам выявить этот иск максимально быстро мы бы сразу сообразили по аксима определённым Да что мы не выходим на правильные показатели и Ну в принципе Как доказать опять же математика сильно помогает Да вот я наверное сейчас несколько некорректно расскажу про один случай из моей практики надеюсь вы меня простите да математическую модель одной задачки Да собственно говоря одной проблемы чтобы доказать заказчику там определённые возможности невозможности системы Я накидал всё это оставил ушёл на обед меня на обеде вылавливает соответственно архитектор который просил меня этот расчёт сделать говорит срочно надо прямо сейчас бегу доказывать всё забирает и Ну я ему говорю Возьми у меня на столе лежит он убегает собственно прибегает через некоторое вре говорит всё хорошо прошло заказчик согласился с нашими выводами Я возвращаюсь к себе на рабочее место он не ту бумажку взял это о сили убеждения математики Да собственно Ну собственно опять же Да вот так и доказываю Давайте да вот здесь посерединке Привет Спасибо за доклад ты упомянул что у вас были проблемы с производительностью кто я в своей работе тоже часто с ним взаимодействую Скажи с чем вы столкнулись ограничение пропускной способности конкретно Да в мегабиты в секунду сколько она может вытянуть из себя А в каких операциях вот нам нужно было конкретно проверять ключи сертификаты точнее даже не ключи Да собственно говоря а подписанные данные сертификата попи Угу спасибо Вот там один вопрос да потом сюда Добрый день спасибо за доклад линде У меня вопрос собственно не думали ли вы вместо того чтобы склеивать в Монолит от масштабировать только криптопро Ну смотрите Да от масштабируемый конечно задачу по производительности на этом участке да то есть собственно говоря пропускную способность увеличим а сеть мы не грузим потому что у нас всё равно накладные расходы по сети идут при этом При всём Да собственно говоря и чем больше там будет сетевых взаимодействий тем соответственно будет неприятнее вся эта ситуация с учётом того что у нас всё-таки несколько дата-центров Да и так далее То есть у нас и сеть не всегда дешёвая Вот здесь Да вопрос Здравствуйте спасибо за доклад Очень интересно очень конструктивно Спасибо большое а вы рассказали о том что у вас были сложности с балансировщика и вы решили поставить там какой-то умный алгоритм вот а Что вас подвигло именно там продумывать этот самый умный алгоритм а не прийти к каким-то популярным решениям Потому что насколько я знаю есть например час Баро у которого есть который не смотрит на Он задал себе коннекто и оперирует уже именно этими коннекта Глядя на собственную статистику Да ну тут я сразу оговорюсь Да собственно заметили что у нас использовался Да в качестве собственно основного протокола взаимодействия То есть тут надо было ещё и приспособить это всё к нашему протоколу раз ИП к этому рение самом этоке она стоила недорого балансировка эта стоила достаточно дёшево для Работки и поэтому мы предпочли всё-таки не втаскивают преодолевать Да сделать своими силами И поддерживать проще и руководить всем этим проще Вот пошли этим путём Давайте там Да и потом из того кусочка СБО болье зак поте пожалуста Рава вы потеряли Надёжность системы а в итоге всё так и осталось То есть хранение в оперативной памяти Ну не особо надёжная штука Угу Нет мы не потеряли Надёжность системы система у нас абсолютно надёжна Да и Это подтверждено тестами то есть на самом деле мы просто переписали механизм поддержания надёжности Вот то самое изначально persist Мед да всех сообщений которые через нас проходит заменено собственно говоря на отложенный сохранение только тех сообщений которые не доставлены у нас между точками сохранения Да сообщение в любом случае будет либо сохранено опять же да В случае недоставки Ну если опять же готовы его принять оно будет пороше то есть есть несколько точек скажем в системе где оно наверняка сохраняется Это на Агенте поставщика на Агенте потребителя А по вот этому самому подд она сохраняется по случаю когда только недоступна доставка то есть Надёжность абсолютно не ученая Давайте вот с правой стороны ещ один вопрос да спасибо Максим Большое спасибо тут очень приятно как сказать видеть что то что я например про Андрей архитектор то что я делаю как это в своей работе оно имеет название правильное да то есть вот это что это практики мо сказать умные люди уже подумали вот а вы даже сделали очень приятно у меня смотрите какой вопрос вы сказали что за счёт применения Ну вот этих частных всех решений да то есть в конечном итоге смогли добиться там целевых показателей производительности и отклика да а безусловно за этим стоят как бы некоторые Как это называть трефы да то есть Правильно я понимаю что например вы для вот такой нагрузки да получили нужный отклик Да там на основные сценарии да А например как вы сказали есть тяжёлые запросы Да и тяжёлый запрос например может попасть в ошибку Да в этом случае он записывается вот надёжный доставщик Да и так далее И вот такие запросы уже могут не попадать в критерии верно Да всё так Окей То есть тут даже я бы да сказал дальнейшей оптимизации системы неплохой бы вариант был следующий выделить под эти тяжёлые запросы отдельный инстанс Да собственно говоря который бы обрабатывал только их таким образом основная масса наших запасов 9 и9 гоняли бы по быстрым Да соответственно снам тяжёлые запросы отрабатывались бы отдельно Ну а чтобы он не простава в случае когда собственно у него нет тяжёлых запросов Пусть в этом случае сам просит для себя дополнительную работу когда нету ничего такого что ему по специализации вообще было бы идеально но немножко дорого с точки зрения Работки У спасибо я пою что это одна из причин почему сито Да вы решили не применять в этом случае как бы у нас отдельный поток они выделяются супер спасибо большое Прежде всего это утилизация низкая да на самом деле Потому что тут очень сложно поставить те самые границы между размерами задач кото Бут обрабатываться на разными сервисами чтобы эти сервисы грамотно утилизировали А когда нужна высокая производительность Да с точки зрения пропускной способности утилизация очень существенна да Для нас так давайте с левой стороны теперь а потом конференции многие докладчики рассказывают о проектах в плане того что не было ограничения сделать сразу правильно хорошо из первого раза то есть ну попробовали не получилось попробовали по-другому не получилось у вас же такое ограничение сразу стоит и вот как-то резко выделяет ваш доклад среди остальных А вот скажите если бы этого ограничения не было итерация вы бы достигли этот результат быстрее или медленнее ну Да спасибо Хороший вопрос на самом деле я когда-то давным-давно был программным инженером Да До тех пор как пока не стал собственно ещё архитектором утраченное несколько такое понятие по мной инженери в наше время Да собственно даже по-моему в Беркли сейчас последний раз по-моему шесть там человек набрали Да собственно курс забытая область знаний то есть изначально нас учили так программных инженеров ты вле нарисуй код на бумажке атом соб пом толь Запусти сечас у нас ВС по-другому Да немножко работает ты вначале напиши код потом тестировщики тебе расскажут что там есть критическая Бага собственно гово со мной функционал не работает я вс-таки придерживаюсь тех самых навыков которые меня когда-то обучали Я бы с удовольствием конечно же я понимаю что это очень дорого Да изначально всё это просчитывать ну есть некоторые нюанс с зни за это есть некоторая экономия тут специалиста сложно ити на самом деле сейчас вам принесут микрофон Подождите начинающий вопрос Вы сейчас имели в виду поток вышки который по программно инженерии человек набирают Кошмар коне Спасибо большое Ну вы возможно слышали Вот это известные высказывания когда с нашего космодрома нового Восточного уке собственно говоря в силу того что там что-то не дотеров всё мертва по гавной инженери если русские ракеты уже летают по тестам как-то так так там справа Да ещё один вопрос у нас Добрый день спасибо за доклад Скажите сколько времени заняло проектирование вот вся реализация вы говорили 3 месяца Вот та часть которая была на вас а не на программных инженерах Угу Ну можно сказать что в все Т меся из-за него то есть мы фактически работали с разработкой проектирование вели в обе в оба потока Да собственно проектирование сверху проектирование снизу то есть Я предлагал решение разработчики с ними активно соглашались или наоборот активно не соглашались Да собственно предлагали свои какие-то и так до самого конца пока код уже не пошёл в прод С4 уже в проде Да С4 в проде да спасибо спасибо за доклад А вот ещё раз к вопросу о криптопро А почему всё-таки не выделили его отдельно ведь сейчас э тенденция такая что ФСБ предъявляет Требования по классу Ц3 или кс3 вот у вас сейчас там по кс1 кс2 для Явы КС 3 не существует в принципе вот и плюс То есть это нужно там вариант сейчас только это asinus Ну криптопро Linux и реализация на си на виртуальных машин Ну не обязательно си Почему любой язык Jaa Да ну на компилировать криптопро декларирует по-моему на длинных ключах 18800 операций в секунду на одно ядро Вот И там наверно бы с производительностью не было бы вопросов Тогда я согласен с Вами Да собственно говоря здесь есть у нас такое решение как раз да Ну мы на рапе и писали чем дело закончилось да с этим с этой реализацией Ну пока не скажу да Ну как сказать я вообще наверное не скажу я вообще сразу признаюсь я аутсорсер да это с одной стороны хорошо все время что-нибудь новенькое а с другой стороны всем рассказываю о тех проектах из которых я уже ушёл Да собственно говоря возможно сейчас это решение уже принято так переделано Да собственно во всяком случае когда я выходил было решение на Расте у нас вполне возможно она уже работает ну то есть ожидать э новых версий мы просто пользуемся Угу и соответственно ожидать новых версий не торопиться покупать криптопро под кс2 класс да получается ну не ну там всё равно Ж то же самое та же самая спецификация только что это не ну криптопро там другой То есть он там других денег стоит О другой АГ а нет для агентов то уже это всё реализовано то есть на сейчас cs1 cs2 просто и он там я так понимаю встроен на яве как раз Нет там для Агента уже Всё сделано по-человечески уже при мне это было сделано да странно отдельный сервис в который можно вытащить Ну а вот по поводу того что сразу А ну вы говорите что есть решение переделали на Расте и там соответственно наверное проблем с криптопро но с точки зрения производительности таких нет Ну как сказать оно всё равно бутылочным шком остаётся Ну чуть меньше горшка чуть точнее ше горшка получается но горшка всё равно есть угу понятно спасибо так и Давайте последний вопрос ещё Ну вот молодой человек да спасибо за доклад очень интересно я хотел концептуальный вопрос по поводу подхода задать Вот вы говорите что он не эволюционный то что вы сразу ну говор сразу делали Как хорошо да то есть без вот итераций А смотрите получается если вот вы сейчас отвечали на вопрос кому-то сказали что разработка именно вот концепции велась параллельно с разработкой кода то есть условно говоря Как это можно понять что вы разрабатываете Вот первую итерацию Да вы говорите что э там этот первый планировщик Да убрали получается условно А в это время инженеры это реализовывает приносят говорят вот мы убрали планировщик у нас стало лучше но не до конца там хорошо тогда мы ищем следующее узкое место следующее узкое место у нас там там балансиров там мы делаем там несколько инстан сов там делаем балансировщик да вот это следующий как бы виток эволюции Да скажем так то есть это в принципе Вполне себе вроде бы эволюционный подход как сейчас всё и работает в чём тогда концептуально была разница Ну смотрите вот и это эволюционный Ну да тут опять же насчёт итерации что считать итерации У нас конечно итерации кодирование были определённые спринты Да так называемые собственно говоря но без выхода всего этого впро до определённого момента да то есть собственно тут по большому её большая итерация с выходом в прот была одна да по этой задаче далее Да собственно насчёт того что если мы шли вот таким подходом пробовали получается немы бы просто не вну есть но доста бого вре если изначально на модели показать что это сработает и потом сделать это намного дешевле получается чем в начале это ВС закодировать Да проверить что это будет работать и только потом собственно го или не работает деть Да несколько раз опять же если это не заработает то есть итерационный подход вот таким эволюционным путём хорош когда морось Да и заказчик платит вам за тогда да тогда итерационный подход просто идеален Вы можете с заказчиком радоваться каждому новому успеху Да собственно как Маск ракеты пускает Ну не полетела Ну хорошо следующее полетит но немножко дороговато не все могут себе такое позволить а то есть чуть уточню получается что вы вот допустим первый этап когда там отказались планировщика То есть вы уже просчитали математически понимали что этого будет недостаточно Да поэтому сказали что Вот пока мы разрабатываем вот это а мы соответственно дальше сейчас додумывать следующий этап То есть это своего рода ионный подход тоже но именно в другую сторону без лишнего Да работы получается без про не делали например какие-то шаги влево вправо там не пробовали Да там не тестировали заказчиком да да ну Максим сейчас самая сложная часть этого самого выбрать четверых докладчиков и подарить им призы док ой всё извините да и заставите их докладывать Да всё уже че четырёх Да четырёх людей которые задавали вопрос Ну давайте попытаемся вспомнить да вместе коллеги Итак мне понравился Вопрос вот с этой стороны про криптопро глубокий был достаточно вопрос Да Далее собственно вопрос насчёт того Какая польза с точки зрения вот этих самых математических расчётов есть для предсказание того что это вообще не полетит вот с этой стороны был вопрос да последний вопрос А у кого был последний А вот молодой человек да так Дада и у нас ещё один подарок Да у нас ещё один подарок я говорю самая сложная часть твоего доклада ой коллеги Кто помнит Да провокационный вопрос в зал может быть залу тогда дать возможность выбрать какой интересный вопрос запомнили там был хороший вопрос Отлично Напомните пожалуйста о чём спрашивали хотя бы ко Хороший вопрос о чём-то интересном с левой стороны от пожалуйста операции лучше или хуже почему вы с Ну почему А точно Хороший вопрос соглашусь отдаём по-честному поблагодарим ещё раз Максима Спасибо большое спасибо"
}