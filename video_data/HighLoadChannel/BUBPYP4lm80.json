{
  "video_id": "BUBPYP4lm80",
  "channel": "HighLoadChannel",
  "title": "Строим Security Сenter для Kubernetes-платформы / Алексей Миртов (Yandex Cloud)",
  "views": 1294,
  "duration": 1777,
  "published": "2023-01-19T07:03:34-08:00",
  "text": "всем добрый день спасибо что пришли на этот доклад я надеюсь что сегодня вы узнаете что-то новое что то полезное кстати со многими мы уже встречались в на нашем замечательном стенде индекс облака приходите туда и после моего доклада с удовольствием с моими коллегами ответим на все ваши вопросы касательно нашего облака я хочу сегодня рассказать вам по про построения security центра для кобрина эти платформы давайте я представлюсь уже сказали меня зовут ментов алексей я являюсь архитектором экспертом по безопасности в яндекс облаке в свое время я выстраивал и из курите первичном центры и цикл безопасной разработки в достаточно больших командах разработчиков и имея опыт работы более 10 лет в сфере информационной безопасности доклад мы подготовили совместно своим коллегой на каком-то тевосян им большое ему спасибо здесь есть ссылка на наш youtube канал где можно ознакомиться с различными полезными материалами кому же будет полезен этот доклад в первую очередь наверно security & d псекупс но также будет полезен и под форменным командам и давос и всем тем кто столкнется с более чем одним кластерам каберне тельца в продакшн и мы поговорим о том как эксплуатировать парк безопасных куплено this кластеров о том как управлять платформенными инструментами инструментами безопасности правильно предоставим различные гайдлайн и материалы solution и в общем какие-то вещи которые позволят вам сэкономить время и нам поделиться экспертизой с вами мы не будем говорить про безопасность именно самих приложений про статический анализ кода динамический потому что про это есть отдельно много докладов и мы не будем говорить про софта белов материал про с оплачено таки просто потому что мне кажется в этом году все доклады по безопасности так или иначе затрагивает эту тему тема вообще горящая по безопасности кубера вот я поэтому призываю всех так сказать я просто делюсь своим мнением я не навязываю вот это открытая тема для обсуждения все делают по-разному итак начнем с ростом компании так или иначе все столкнуться с ростом повинность кластеров это может быть например как у нас в яндексе по одному кластеру на один business unit с независимым да вот сам либо по несколько кластеров на каждую бизнес команду как есть в ряде наших заказчиков клиентов не так давно я наткнулся на доклад коллег из университета сан-диего проект назывался наутилус там они рассказывают про то как они развернули огромный кластер можете видеть цифры производительности кластер для нужд разработки в общем для различных вычислений со стороны ученых студентов вот затем они вынуждены были собственные децентрализируем этих кластер и развернуть множество кластеров и у них была задача выделить например каждой команде один namespace чтобы они там варились то есть не дергали никак администратора были просто админами в этом на им спейси и что меня удивило в этом докладе что не было ни слова про безопасность и на самом деле даже если вы являетесь там только обменом своем namespace и кубер нить из вам ничто не мешает развернуть там привилегированный контейнер который может выйти за пределы ноды скомпрометировать весь кластер я и считаю что эта проблема вот поэтому мы обсудим сегодня эти моменты я расскажу про безопасный диплом кластеров про инструменты защиты про внедрения этих инструментов давайте начнем что же такое вообще безопасный кластер кубер нить из в моем понимании это кластер с безопасными настройками то есть там должны быть настройки например в соответствии с кем-нибудь кать лайнам там например цис benchmark или другими стандартами там должен быть тандем включена шифрование там включен аудит и и так далее и он должен находиться в безопасной среде например если у нас супер безопасный кластер но там дырявым образом взять заражение там настроена облачная среда любой может зайти удалить ваш кластер или там открыты все порты понятно что это тоже небезопасно и также должен быть минимально достаточно и необходимый набор инструментов по безопасности причем именно минимальные необходимые потому что у вас может быть например кластер вообще без выход в интернет и тогда у вас там какие-то угрозы не актуальны и вам там можно существенно например снизить количество инструментов по безопасности но это как пример если разложить процесс тепло эксплуатации кластеров то можно разделить на следующие блоки например нижняя часть это сервис получения кластеров допустим слова четра форма выше идут платформенные инструменты инструменты безопасности параллельно и сверху идет как бы само приложение то ради чего вообще кудрин эти в принципе используются если разложить все безопасный диплом кластеров то что мы хотим здесь мы хотим единую versio нервную базу данных настроек кабинете сплести raw и инструмент в безопасности хотим автоматику которая будет создавать обновлять эти кластеры да там например себя сиди система и автоматизированной security проверки на этапе как еда раскатки так и в ран t'aime давайте рассмотрим некоторые популярные схемы деплоя например time to market мод так называемый это гипс push модель когда мы что-то пушем в кластер вас здесь вы создаете например там pull request ваши соседи система там гид лап или дженкинс там его подхватывает реагирует и условно там например создает выполняет траффорд лай и устана создает кластер и для ваших команд это так называемый кластер pipeline и ниже у вас могут быть security pipeline и платформ pipeline уже с инструментами для этих нужд там соответственно тоже какое-то событие порождает реакцию сиди системы и она там уже делает хеллман стал или club stella play и устанавливает эти инструменты ваши несколько кластеров там один или больше здесь наверное из плюсов это то что такой популярный метод в катаной из минусов здесь может быть конфигурационный дрифт например кто-то руками зашел в купить кластер поменял настройки и у вас уже есть некая разница между этими настройками кластера и вашим там настройками в репозитории есть еще модель кабинете и топ-шмот так называемый пул модель когда мы уже не пушем что-то в кластер класс app как бы сам пуль от изменения например у вас есть управляющий кластер купленная tissot там с установленным аргусе де или например спинакер и собственно вы также кластер pipeline остается без изменений у вас кластер и раскатывать с помощью таро форма но там платформенные инструменты инструменты безопасности например у вас аргусе десантом раз в 3 секунды ходит и pulid и в соответствии с этим изменениями раскатывает здесь из преимуществ наверно то что есть некоторые единые тулс и для компании рядом это может быть дорогой сиди и есть enforce режим то есть если даже кто-то руками поправил что-то в кластере то ольгу сиди там сходит и приведет исходное состояние настройки таким образом можем следить за тем чтобы кто то что то не поменял несанкционированно из недостатков наверно также здесь есть риск при быстрого применения мисс конфигурации то есть у нас что-то быстро запылилась и там дальше это может породить какие ошибки в системе и нужно будет уже откатываться если пойти еще дальше то у нас мы можем отказаться от эра форма для диплом кластеров и использовать такой инструмент как раз plain здесь у нас как это работает мы в этот же управляющий кластер сорвусь иди устанавливаем том круз play например инструмент и описываем облачные объекты например купил эти кластеры как кастом ресурс до финиша надо как яма файлы и у нас уже аргусе де как бы и playa то эти файлики и кросс plain операторы подхватывает и создает облачные объекты это наверное схема является плюсом для тех кто хочет сидеть часть вынести поглубже вк обернитесь то есть в ряде случаев это бывает очень полезно если пойти еще дальше то существует такой инструмент как адмирал ти как раз этот инструмент использовали коллеги вот из сан-диего в своем докладе он позволяет вам просматривать несколько кластеров как один виртуальный кластер то есть это такой интеллектуальный мульти кластер scheduler и собственно из плюсов здесь то что там есть и централизованный контроль доступа и аудит логе есть и без безопасное управление кластерами по то что там агент ставится в кластер вам не нужно открывать входящий доступ например как убирайте сопи но наверно из минусов здесь то что существенно часть продукта этого является платной мы затронули тему таро форма и здесь я посвечу момент что например таро for манифесты можно тоже сканировать на предмет security мисс конфигураций таких как там например отсутствие security group и на нотах кластера там отсутствие в общем публичный bucket например или какие то другие мисс конфигурации облачные есть ряд инструментов например чеков который позволяет вам вот эти манифесты сканировать и выдавать ответы причем это можно внедрить даже на при комет хуки на ноутбуке разработчиков условно или же вся сиди система что привычнее мы сделали кантри бьют со стороны индекс облака в чаков и там теперь можно сканировать проформа нефесты индекс облака вот можно по ссылке там познакомиться с прямо реальным решением которое например реки туапсе сиди и позволяют вам это использовать также мы подготовили чек-лист по безопасности terra форма который содержит себе такие вещи как то что там необходимо правильно terra форм стоит использовать там был блэк стара джидда защищенном они ноутбуки разработчиков как правильно работать секретами это тоже наши клиенты часто нуждаются в этом облачный поэтому вот мы подготовили такой отсекли чтобы они могли им быстро пробежаться по этому и также мы подготовили гайд по безопасности кудрин эти со это на мой взгляд такая важная штука потому что если вам нужно соответствовать каком-то стандарту например 50 лице залив и со 152 будучи в облаке или если вы просто хотите безопасность вашей среде то вы можете прям по этому году пройтись там есть домен и сетевая безопасность шифрования отдельно там аутентификации прям досконально настроить по порядку все параметры также мы затронули тему соседи инструментов здесь важно отметить что вас могут атаковать ваши соседи систему и если вы получить доступ к вашей системе то скорее всего получит доступ везде потому что как правило с неё достаточно широкий доступ и вот поэтому на просторах интернета есть такая матрица а так на себя сиди систему здесь указано как можно получать доступ первоначальной все сиди систему как можно повышать привилегии в общем это очень полезная штука при построении модели угроз на ваш ваш инфраструктуру и также здесь хочется отметить плюсы мене что сервисов себя сиди например менеджер сходит лап который там в некоторых местах есть включая наше облако не так давно выходила множество вазе масти в дет лобби и мы обычно выпускаем увеличение безопасности на эту тему в нашем сайте там вышла такая тузи масть там эффекте таки этой версии там исправить вот так и если у кого-то управляющих управляемый service de club то там вообще не надо париться за обновление просто мы на следующий день обновляем эти инстанции и клиент в принципе может вообще не не переживать по этому поводу давайте перейдем к самому интересному инструменты защиты кластеров в чём вообще от них хотим мы хотим чтобы эти инструменты покрывали максимальное количество угроз до защищали растет максимально количеству гросс мы хотим чтобы они были интегрированы связи с сиим системы корпоративный с нашими платформенными инструментами и мы провели такой сравнительный анализ инструментов в безопасности open source и платных и разбили там тоже на домен и вот если посмотреть на доме направлении разве мастями здесь есть такие вещи как там сканирование образов сканирования самих но там континиус pentest можно сказать там и мы видим что наверное там платное решение естественно в лидерах то что они закрывают наибольшее количество функционала такие там как вы security физик вот но также мы видим что набор open source инструментов таких как ты верно там плюс starboard оператор гид лап позволяет вам тоже приблизиться к этому максимальному покрытию не выплачивая при этом день деньги и если там смотреть доминантой security это там анализ и сколов которые производятся из ваших контейнеров там различные анализ там пакетов установлен на ноды здесь тоже естественно в лидерах там платные решение но также есть и в сквере например бесплатное решение фольку крема в который тоже позволяют вам покрыть много чего на самом деле ну то есть можно с этой табличкой будет в оффлайне и ознакомиться с точки зрения network security здесь хочется отметить силе ум наверное селим хаббл который позволяет в принципе и флаги частично анализировать этом с оговорками и какую-то карту сети выстраивать сетевые политики строят расширенные вот но также есть естественные платные решения которые там в чем-то может быть поудобнее вот есть также еще такие функции как там построения карты сети построения зима и карты взаимодействия объектов здесь тоже вот до меня был доклад тоже в нашем блоке подписи курите здесь хочется отметить lan 3 продукт который является нашим да там русскими он в принципе покрывает много много чего в этой сфере вот но также есть и кьюби скан аргусе diy которые тоже позволяют вам в принципе получать какое-то абсолюте в вашем около ваших кластерах вот говоря об инструментах безопасности я хочу еще подсветить важность кубинец из аудит логов потому что мне известно что далеко не многие на самом деле реально анализируют если говорить про облака то обычно аудит логе делятся на два типа это админ activity выйдет логе это то что делается с облачным api например там создание кластера удаления но до или что-то еще и есть дата аудит логе от именно аудит логе который внутри кубрина с этом например создание пода значение привели ровных прав там и так далее и я подготовил такую схему как это обычно выглядит то есть у нас эти два типа логов попадают в клауд ложен в систему или клауд аудит систему дальше вы можете экспортировать например в с3 или вот этот стрим и после чего вам этом вы можете это экспортировать всем систему которая вас есть будь то это dogs планк там elastic или рк сайт не важно что вы используете сами по себе логе это хорошо но не понятно что у них анализировать поэтому мы подготовили из кейсы которые ну собственно не уже готовы вы можете просто посылки их найти там есть такие важные вещи как там например отслеживания событий и казаков контейнер или там подключение к капельнице кластеру из вне с публичных адресов или же там какие-то назначения привилегированных прав каких-то излишних да там какие то такие подозрительные действия и на которые хорошо бы реагировать что касается внедрения инструментов понятно что есть enterprise системой платный который достаточно легко внедряются они там все содержит в одной коробке и нативные интеграции содержит вот но у них естественно есть минус что за них нужно платить есть определенный цикл закупки через которые нужно пройти чтобы купить там это не всегда всем удобно поэтому если вы там хотите использовать бесплатное решение то это может выглядеть вот так примерно у вас есть ваши кластеры условно одинаковые вы установите что за фольку для runtime security key верную как отмечен контроллер например starboard оператор который содержит в себе этом trevi для скана образов и криббинс для сканирования ваших not также можно установить и сквере который будет опрашивать ноды на предмет на установленных пакетов наличия юзеров в определенных группах операционной системой и так далее и возникает задача все это отгружать всём систему потому что понятно что никто не будет анализировать срабатывание всех этих инструментов руками прям заходя в кластер смотрите этом сердечки и output и этих кодов поэтому если подходить в лоб к этой задачи анализа вот этих логов то это выглядит примерно так там каждый инструмент содержит еще один инструмент который позволяет отгружать эти лаги там например volkov имеет фольку сайдкик неверно полисе репортёр ustar барда вообще нет никакого инструмента чтобы отъезжать эти логе там чтобы логикой сквере смотреть вам нужно ставить еще там фильм детали бит чтобы из варлок папки там это все отгружать съем это выглядит не очень как бы элегантно скажем так поэтому есть такой продукт акте верна полюсе репортёр он изначально создавался для того чтобы красиво визуализировать срабатывания кивер ну да отмечен контроллера для тех кто не знает это обвешен контроллеры так ну то есть когда мы можем определить политики например там нельзя создавать привели ровный под у меня там в кластере или там нельзя например монтировать файловую систему но да и так далее вот и кибер на полюсе reporter также умеет отправлять сработки вот эти вот политик например в slack или в discord так далее и благодаря тому что мы там за кантри beauty ли в него он еще и поддерживать я на explo от с3 и после этого еще другие с три стороны же совместимы и он научился поддерживать также другие инструменты безопасности там три vefali cookies bench соответственно это работает и других облаках так как я уже сказал там есть поддержка других улик сторожев соответственно это все может выглядеть таким образом что вы окружаете все в полис reporter с этих инструментов и из него уже окружайте в обжиг сторож например а дальше из общих сторожева сгружайте это уже в ваш все ваши 7 системы все там в более-менее едином формате вам нужно там парсить дополнительных и так далее здесь есть нюанс что вот этот полюсе reporter он ничего не знает про другие кластер и и он взаимодействует только вот в рамках одного кластера и здесь возникают сложность что всем системе мы не сможем отслеживать с какого же кластера эти срабатывания то есть с какого какой clostridium они имеют и здесь есть такой лайфхак можно указывать префикс файликов в облик стороже да то есть название папки уже в сторожа указывать как кластера и вашего кластера при установке дали полюс репортёра и тогда у вас вы можете обогащать данные всем систему с помощью ну вот используя вот этот класс тратишь на мы подготовили готовое решение по вот установки с помощью таро форма фольку кивер но в и отгрузки всех этих логов вместе с аудит лагами в elastic search ну как как наверное из-за того что во первых у нас есть менеджер сервис свой ластик и потому что принципе ластик много кто использует это решение работает и на не только на менеджер сервисе вот и там же загружаются уже приготовлены дашборде вот как вы видите на скриншоте который содержит в себе там уже какие-то приготовленные вещи для анализа давайте я покажу дима там двухминутная как это примерно выглядит в итоге до что по сути что является технологической частью вашего там security центра условного вылет это так что у вас есть а вот пошла значит у нас есть готовый дашборд власти ксир чьи где у нас там есть разбивка и фильтры по кластера эдипа клауд айди вы как сидите таком security центре вы можете все фильтровать совсем наблюдать можно даже перейти прямо в консоли облачную кликнув на конкретный класс stride но это так больше для удобства вас есть он карта подключение где вы можете смотреть с каких стран там админы подключается вот кластер или там не админы например есть даже бортики где показана кита подозрительные действия сетевыми политиками с контейнерами сервисными аккаунтами есть отдельный дашборд который для срабатываний инструментов олька он прямо вот как timeline он показывает какие политики сработали для каких кодов вы можете здесь отслеживать все это смотреть в наглядной форме ниже есть в табличной форме указания того там с названием бадов с количеством срабатываний и там какая-то разбивка полным спайсом где тоже можно там если хотите dent произошел зайти посмотреть как вообще на это реагировать нормально ли это действие может быть от какой-то фолз позитив есть отдельный дашборд для policy in g надо для нашего каверну здесь тоже там есть какие-то срабатывания кто-то создал под который там излишней право имеет это немного отличается от вашего ожидания как безопасника поэтому некоторые вы видите срабатывания соответственно здесь уже есть табличной форме там все эти данные какой под нарушил правила они же есть прям streaming логов как собственно в сыром виде там можно посмотреть эти логе если вы там сделайте какой-то drill-down фильтр по какому-нибудь событию например выберем там для каверна конкретная прямо правила нарушение политики можно будет промотать вниз и смотреть старые логе вот именно расследовать именно вот эту конкретную ситуацию но мы все понимаем что целый день смотреть на ты тоже борт никто не будет жалко людей да нельзя просто взять посадить человека который будет целый день на это смотреть поэтому есть механизм allure тинга detection рузов обычно в любой 7 системе неважно власти кипра 100 тоже и то есть вот здесь уже приготовлены правило реагирования например там хочу реагировать на то что кто то в продакшн вдруг провалился мой контейнер я хочу чтобы у меня только сиди система могла что-то изменять и не хочу чтобы админ мог там руками зайти вдруг есть такое правило можно нажать там что я хочу реагировать получать в слой как например уведомления об этом и можно там обогатить это событие например ссылкой на пластик все же событие и после чего samuli ровать это действие например там вот рюкзак в контейнер можно там щетки ты действие зловредной сделать там установить что-то вручную там apt-get install там какие-то действия там на который мы реагируем и у вас в итоге в сладком поступает некоторые утомления если другие решения которые мы заготовили в нашей security solution лайбрери там например в сквере раскатывать как demons этом экспортировать в логе силе ума какие-то там заплатки на какие-нибудь сыроежки например тот которые представлены экране это все можно в оффлайне посмотреть сейчас не буду останавливаться на этом и у нас не так давно в к вернитесь и появился marketplace что может это полезно для вас нести вы можете быстро выбрать какой продукт о безопасности любой рукой продукты быстренько в пару кликов его потестить посмотреть плюс многие из этих инструментов они интегрированы уже с облаком точно 5 то можно при установке указать сервис аккаунта ключ и там он уже будет ходить в облака что-то делать там например в случаях и штурвал то там интеграция с сервисом нашим кей менеджмент вот и также можно все эти чарты скачать кастомизировать как ты использовать вот давайте подведем вывод и какие то итоги первые наверно что я хотел донести что рано или поздно все столкнуться с мульти кластер больше одного кластера мне кажется это неизбежно существует разные схемы диплом кластеров важно выбрать подходящую у вас есть набор там чек-листов материалов которыми я поделился которые можете использовать чтоб сэкономить время и есть также понимание сравнение инструментов в безопасности какие за что отвечают как можно достичь того или иного уровня и вам нужно просто выбрать правильный набор инструментов исходя из вашей модель угроз бесплатных платных может быть комбинацию из бесплатных и платных и почти готово у вас есть много alert of много логов все что вам осталось сделать от настроить реагирование на них потому что если они настроить реагирования то это просто файлики которые лежат на вашей файловой системе тратят ваши деньги и ну все это вообще зря если вы не реагируете на эти срабатывание это просто сделано для галочки приходите снова облака используйте наш security чат используйте форму связи с отделом продаж большое всем спасибо извините за заминку большое спасибо спасибо у нас есть время на один или может быть даже два вопроса и вот я увидел первый добрый день и спасибо за так вот она это то что касается кабинете к вике меня зовут статьям компания плеск я бы хотела спросить про сетевую безопасность совсем недавно в цилю фаербол перешел в стадию стимул к вот как вы рекомендуете для каждого блоки используют security group и либо наоборот уже использовать фаербол внутри собственно кубического ресурсов да спасибо за вопрос на самом деле здесь важно комбинация то есть вам нужно использовать и security group и и сетевые политики внутри кластера то есть простого firewall то есть мы используем security политик внутри класса внутри namespace он стоит ли отказаться от security group с ту сторону хост firewall самого целью ну а ну просто селим он не совсем хост firewall все-таки он просто сильным это по сути расширение сетевых политик то есть более продвинутой сетевой политики купер не tissot они позволяют строить там повод api вызовом там по доменам именно касается пункте has the firewall например я могу силе минуты что мне 22 порта идет о канаде милитари зону например да я думаю что если у тебя несколько облака например там яндекса в с и в виде приходится через телефон настраивайте крите группы я думаю что за х 100 вам firewall целовал все-таки будущее по что через заказ там ресурсы ты можешь настроить клаву так можете грубо кажется что барри металлом и либо облаке я понял а просто действительно можно с помощью сильным это делать вот но все-таки у вас все равно есть другие облачные объекты как правило там виртуальной машины stella блокировщики так или иначе вам не избежать применение security group 2 форме там и так далее вот поэтому я все-таки сторонник того чтобы для облачных элементов и хостов использовать security group и а для вот того что внутри кластера использовать сетевые политики кубер найтись потому что там можно уже точечных назначать на конкретные лиды сервисы спасибо и второй вопрос в том что с его но у нас уже на это не одна и не на товар policy стоит ли игр с использовать правило или только ограниченным графом стоит ли грейс используйте гроза ну это зависит от зрелости вашей безопасности вашей компании потому что ну конечно в идеале должен быть там дефолт иной и игр с и ingress но если вы там только начали ваш путь начните сначала хотя бы сын gresso откройте все весь исходящий доступ наружу как минимум но там dns точно и так далее вот а дальше уже потихонечку можно там какой-то карта сети построить как-то вот проанализировать и закручивать гайки уже сильнее"
}