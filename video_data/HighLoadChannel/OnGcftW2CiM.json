{
  "video_id": "OnGcftW2CiM",
  "channel": "HighLoadChannel",
  "title": "Как тестировать производительность гиперковергентных систем? / Роман Хмелевский (Nutanix)",
  "views": 797,
  "duration": 1560,
  "published": "2018-08-16T04:43:16-07:00",
  "text": "тема у меня сегодня как тестировать производительность гипер конвергентных систем и начать я бы хотел с того что что же такое гиперконвергентное системы чего не подходят собственно горят традиционные способы измерения производительности что такое и всем хайпер convert it infrastructure тема началась примерно в 2009 году когда компания нутаникс придумала новую идею строить инфраструктуру и где-то примерно с 11 года у нас появился продукт и сейчас если вы посмотрите если вы пропустили этот момент за последних два года на рынке стремительно вышло большое количество гипер конвергентных систем и это наверное сейчас настолько острая настолько горячая тема войти что наверное опять же я конечно в арей со всей этой кухне для меня это сравнимо с выходом наверное серверной виртуализации или появлением сын в девяносто первом году и это фактически новая архитектура которая очень потенциально очень перспективный почему я сейчас в нескольких словах скажу изначально это компании amd алекс одна из один из первых разработчиков подобной подобные архитектуры это объединение архитектурное объединение системы хранения сервера и сети передачи данных вне к единой единый модуль мы были первыми на этом рынке буквально за последних два полтора два года на рынке появилось огромное количество кипра конвергентных систем как раз что подтверждается идея мои о том что это сейчас очень важно технологический очень важен технологический прорыв мы были когда-то первыми потом появился потом появился весы потом появился продукт в x-trail на его базе сегодня практически у всех серверных вендоров есть что-нибудь и гиперконвергентное это произошло буквально за полтора года то есть если мы будет посмотрит на рынок это был это galaxy это наша им партнер lenovo или новые чипсы это тоже наша i'm a i'm партнер в excel это значит gypsy heart паккарда это simply витте плюс свои собственные продукты у кого еще заплыл cisco cisco hyperflex fashion club у huawei а и так далее то есть вот мой коллега который в америке хоть однажды посчитал утверждает что сегодня на рынке присутствуют 34 кипр конвергентных продукта и это произошло за полтора года а гиперконвергентное света как я уже сказал архитектура объединяющая в себе то есть вот классическая классическая ядро структура которая состоит из сервера система хранения и систем сети передачи данных такое медиа для передачи данных мы объединяем в неким модуль некий блок который объединяет себе сервер исходя из n некий такой кирпичек лего современного дата-центра удобства такой вот такой подход заключая в том что эта штука очень легко масштабировать вот подобных кирпичиков может добавлять поскольку они автономны и фактически сами по себе их можно соединять в кластер в большом количестве и нет никаких battle ников между между сервером и сыном между самого ценного схд так далее поверх этого всего по-прежнему стоит какой-то примеру гипервизор и приложение такие как вот они и как они есть у пользователя то есть это такая своеобразная об летишь на реддит архитектура гипервизор может быть встроена у нас есть свой собственный встроенный гипервизор на базе куда-куда квн если мы посмотрим на эту архитектуру acana сделана скажем так вот крупноблочный то это аппаратная железо с директа тотчас тораджи мы в него это важно потому что ну как вы знаете все у нас войти развивается по спирали циклически когда-то мы уходили от директа тотчас тораджей в сын а теперь мы возвращаемся назад от сын директор еще стоишь на новом на некое в новом этапе с новым подходом то есть это физическое железо поверх которого процесса память и жесткие диски поверх которых стоит примеру гипервизор какой-нибудь но в случае i'm the next это может быть и секса и наш собственники призрак оперы какой угодно и поверх этого всего работает виртуальная машина такой своеобразный виртуален виртуальный оплавиться в котором находится весь вся логика работы нутаникс а вся логика работает нашу гиперконвергентное кластера и через этот контроллер vin который является фактически таким своеобразным контроллер в виртуальной систем хранения работает пользовательский ввод вывод при этом что он получает да и иначе под подобная схема она очень легко масштабируется потому что на фактический монотонно расширяется сколь угодно далеко вот то что на 1 то что обведено dsf дистрибьюции стоишь фабрик это наша кластерная файловая система который раньше назывался нутаникс истребил системы ntfs и и вот подобные вот-вот минимальная конфигурация три ноты дальше можно наращивать по одной ноги любой конфигурации что это нам на самом деле дают какие в этом плюсы какие в этом преимущество слайд который я сдернул с чьей-то чужой презентации о том что долгое время вот когда в девяносто первом тесто втором году был придуман сын мы вынесли виртуале завали фактически жесткие диски из сервера по одно по сути по двум по двум основным причинам первое это нам потребовалось как-то совместно использовать какие-то ресурсы которые тогда были достаточно дорогостоящими совместно использовать ресурсы хранения от жестких дисков и второе это то что сейчас к гораздо более важно чем первое это возможность использовать совместно и совместно использовать хранилище для построений кластерной кластер на системы например для каких-нибудь вещей применений когда у вас есть два хвоста особых с обеих из которых есть доступ к сыну если мы теряем один из кустов приложение ри стартует на новом посте без потери своих данных которые лежат летом централизованное хранилище но когда-то идея которая стояла в основе сын заключалась в том что у нас есть жесткие диски каждый из которых дает там где-то там сто сто двадцать 150 и abs of и все и у нас есть толстый канал к этому к этому к этим диском который никогда не исчерпывается ну там 500 800000 руб софа персонал канал запросто можно снять сегодня это уже не так то есть ситуация когда у нас пришли на рынок когда на рынок вышли твердотельные диски сделала невозможно то есть вот вот эта ситуация когда у нас жесткие диски сравнительно мало мощные сравнительно мало производительные и толстый толстый канал сегодня это уже не так сегодняшние твердотельные диски даже вот те самые вот эти бытового уровня samsung и нарисованные здесь вот на на слайде вот пара таких дисков на 512 гигабайт это реально замерены и данные способны заполнить рандомным ретро этом 4 килобайта и блогами за способное полностью заполнить 12-битный канал счас и в общем все вот один терабайт забивает 12 га битный канал рандомную ретро это что делать дальше если мы сейчас посмотрим на на ситуацию с с тем как сегодня работают с флешем всякие передовые передовые компании типа пьюр они работают с лышем как фактически x локальной памятью они работают через hdmi и это по сути вот они работают с flash дисками как с локальной памяти так давайте ее просто сделаем локальными и как я уже сказал на счета наваром это фактически способен забить 40 г битный вернет а что дальше дальше у нас 3d кросс point о котором говорит intel и micron и первые самая первая версия которая называется int лап там уже вышло но надо понимать что это конечно очень сильная альфа это фактически практически пруфов концепт данной технологии и слайд которая сдернул просто с презентациями крон показывает где именно с точки зрения микрона должен располагаться вот это вот скоростная память она с точки зрения микрона быстрая память должна располагаться локально должна работать хранить данные там где они обрабатываются и это на мой взгляд очень важно потому что вот мой коллега из дел однажды привел классно пример который показан которых хорошо демонстрирует насколько сегодня сегодняшние процессоры могут работать быстрее в том случае если мы решим вот эту проблему с pir системной памятью которая будет находиться рядом с рядом с процессом представим себе современный процессор который там работает на частоте там 3 ггц к времен представим себе что процессор дам ей вот-вот этики и вот представим что это этот тег равен 1 секунде просто для простоты понимания вот процессор тикает исполняет там супер скалярный процессор исполняет больше чем одну инструкцию за тик одна секунда на секунду теперь смотрим что процессор обнаруживает что у него в кэше нет блока домах под ему за этим блоком данных надо сходить на внешнее хранилище угадайте сколько времени занимает от процессора ожидания получения блока с внешнего хранилища по внешней шине через через все вот эти вот интерфейс и около 3 месяцев три месяца это практически почта россии представляете насколько мы можем увеличить производительность уже имеющихся процессоров если мы сократим вот это время доступа к внешним данным сегодняшний процессоры могут работать гораздо быстрее чем они сейчас работают и вот быстрая память это очень важно потому что вот мы сегодня на конференции highload вот нам с моей точки зрения это очень важное преимущество гиперконвергентное потому что они хранят уже сейчас мы готовы к этому шагу мы уже сейчас сохраним данные локально ещё один хороший пример крупные серверные вендоры рассчитывают например какой нибудь говорит пока 3par считается садится из 1 из расчета примерно 3-4 тысячи iops of ssd один ssd вот этот ssd который стоят безумных денег на в сторону hewlett-packard вот он рассчитывается исходя из производительность порядка трех 4000 iops of там будем ся чуть поменьше hewlett-packard чуть побольше как вы думаете сколько придаст производительности в лоб сахновский диска если он если вынуть из top а вот тот же самый диск его можно вынуть и стороже поставить сервер вот-вот 65000 руб сафон дает по работая локально и нго и бешеный диски разумеется куда девается разница в лет инси вот это вот и есть вот и вот это вот есть длинный путь к данным и длин вы бы большой лет инси пути вот этого данных это очень-очень важно с точки зрения производительности и гиперконвергентное она как раз вот вот вот об этом то есть это очень короткий путь до нам это быстро работать с этими данными локальными и в принципе это то что позволяет и процессором и ssd современном развернуться и заработать все-таки на полную мощность именно поэтому но чем же нам не годится и метр на метр не годится по нескольким причинам во первых он ориентирован все-таки на только на измерение дисковой производительности а зачастую поскольку гипер конвергенция этой инфраструктурные арт архитектурой инфраструктуры куда входят и обработка данных и хранение данных и так далее измерять только-только производительность дисковой для нас не очень и очень эффективна она не показательна для нас поэтому ну и конечно же она измеряет только диски конечно же она из ориентирования метр достаточно старый продукт и он ориентирован на жесткие диски на и так далее много всяких многих эти моменты вкратце немножко о том какая сейчас ситуация с марками стоит на читаю основная 2 в мяч парка существует два основных ладдере один из них называется синтетика один называется так условно говоря life синтетика это понятно это вот всякие а метр и fila и так далее это система которая у них есть безусловно свои плюсы за ним понятно что происходит на уровне физики то есть понятно что он замеряет повторяемые результаты которые понятны минусы синтетики заключается в том что это как фонарик то есть если вы не знаете куда фонариком светить то вы не найдете причину проблемы то есть так какой нибудь сам и а метр измеряет произведено жестких дисков вы увеличили вы поработали по тени или какой-то там жесткие диски получили 30 процентное увеличение производительности дискового ввода-вывода вопрос это вам конечному приложения конечно приложение будет работать тридцать процентов быстрее не факт совсем необязательно не любое приложение зависит от своей производительности от произвести жестких дисков поэтому зачастую конечный результат может быть не совсем понятен в результате этого теста поэтому это фонарик если вы знаете куда светите вы посвятите но если вы не знаете куда светить он вам не поможет real life в этом смысле несколько более комплексные решения ну знаете real life system это которая там есть там все эти тесто типа запускают world заполняет его текста нажимать на кнопочки сгоришь тут какой-то отклик например увиденных идеальных приложений это гораздо сложнее это гораздо более комплексно с другой стороны тут есть тоже свои минусы не понятно что это не понятно как это меряется непонятно как-то переносить на другую инфраструктуру и так далее поэтому задача нутаникс а когда мы задумали при задумали сделать некий некий текст который бы показывал производительность вот наша комплексных инфраструктурных проектов мы придумали продукт который назвается x-ray года полтора моего использовали внутри себя сейчас вот в версии 20 моего выпустили в паблик он есть его можно использовать не только кстати сказать для гипер конвергенции но прежде всего для сюда он открытый он расширяемый легко масштабируется он подходит для печати ой а в том числе не только для леща и он измеряет real life какой-то real life нагрузку более ли менее real life нагрузку скажем так версия 20 это расширяемый пакет на нем значит есть какие-то готовые предоставлю предоставлять при инсталлирована и предустановленная система у него есть open внешней для управления для работы с ним сценарий это ямал есть предустановленные шаблоны для каких-нибудь в данном случае мы поставляем видео и велосипеде создана с точки зрения архитектуры это достаточно простая система физически эта виртуальная машина которую можно развернуть на на каком-то над минском над местом компьютере подключиться к нему с из этой виртуальной машины залогиниться в веб-интерфейс подключиться в какую-то внешне 100 внешнюю систему допустим кластер нутаникс или кластеров кластер виктрола и передать туда развернуть там виртуальной машины передать туда какое-то задание на исполнение харон это вот как раз основная часть нашего решения это собственно ядро ядро тестовые системы это интерпретация сценариев это api это такой своеобразный питон скрипт для собственно исполнения всего этого дела в имидж это собственно образ виртуальной машины с нашими агентами в качестве дискового ввода-вывода мы используем качестве зарплата используем фил достаточно такое хорошо понятный хорошо отлаженный генератор рабочей нагрузки виртуальной машины разворачивается множеств виртуальных машин разворачивается на кластере и дальше ее можно и можно управлять задавайте какие-то задания у нас есть какое-то количество при достанут при достали рованных war клонов ну да на данном случае это видя и этого ltps с базы данных бар клауда также мог как я уже говорил можно через конфиг можно писать описывать и нагружать этими задачами кластер кластер хостов существует некоторое количество предустановленных сценариев который готов уже в для использования это например видео симулятор видя симулятор это он разворачивает порядка сотни сотни в идеальных рабочих мест на хостел запускает их там на какое-то на исполнение загружает их which they work work flow это смешанная нагрузка это база данных + видео и частый частый случай для наших систем когда базы данных плюс какой-то посторонний дополнительно посторонний источник нагрузки то что называется вот частый частая проблема так называемый но синей пор то есть шумный сосед у вас есть база данных она работает она выполняет какие-то задачи и допустим вас пришли утром приходит в пользователи зовут запускать свой видя ее мяч вы кхл теперь базе вас добавляется большая секвентальная нагрузка вот загрузки рабочей станции как это все переживается симулятор о типе а также несколько сценариев показывающих отказоустойчивость например мы можем из нашего api дернуть ее за пиве сены кстати тоже мы поддерживаем себя висент и ближайшее время мы добавим говорил к этому всему мы можем держать черный хвост погасить хост поднять его на tfile.org это как раз ситуация отказа одного одного из нута кластера секунд полно тэйлор это когда у вас очень тяжелая в частности для весеннем и понятно дело что мы здесь конечно подбирали сценарий которые которых которые очень удачно показывают преимуществом тайникса перед допустим весы на сиг mental ног sailor это когда вас гасятся 1 но до потом она поднимается и гасятся следующая процесс синхронизации метаданных увезен очень-очень плохо работает поэтому вот как раз очень такой яркий яркий пример преимущество вариантов нутаникс реализации тему влияния snapshot of мы запускаем 4000 опусов и делаем каждый час в течение 12 часов делать 12 иным шатов последовательно демонстрируя наличие или отсутствие падения производительности результате и в итоге итог хочу подвести несколько без practice которые которыми я бы хотел чтобы реками вы руководствовались при тестировании во первых не выключайте голову потому что никакой самой правильно тесто не заменяет головы семена перепроверяйте результаты даже если эти результаты вам нравится это очень частый случай человек получает результат который подтверждает его личное убеждение и он не чит не критично к нему относится частый случай не доверять одно синтетики уже говорил это фонарик если вы не знаете куда светить вы не найдете все синтетическими тестами в чем собственно у вас проблемы и насколько у вас результат может быть лучшим в результате этого измеряете комплексную производительность не только одну лишь дисковой производительность диска и производительность зачастую не показательно если диски очень быстро и вы начинаете упираться в что-то еще если раньше для хдд основная проблема часто было именно диске то сегодня тоже сад не совсем так вы можете опираться на уровне процессора можете опираться на уровне там доступа к памяти к оперативной памяти ну и да конечно же нельзя доверять vendors ким штаб шо там даже нам хотя вот я здесь я написал что мне можно доверять и у нас расширяемой расширяем и открытый пакет его можно разобрать посмотреть посмотреть как это с питоном скрипт написан и дополнить его это тем чем чем вам нужно на сегодняшний день у нас есть несколько тестов измеряющий гиперконвергентное инфраструктура первый был в vr со своим текстом и диабет построены на базе виде бенчи с дополнительными скрипта вами штуками x-ray наш ну и вот пока я нарисовал эту презентацию буквально там пару недель назад я прочитал о том что не безвестный тепихе выпускает witch mark который 25 ведь вся и если он будет массам это будет очень здорово потому что это некий вендоры независимый beach park который мы безусловно будем поддерживать поэтому перепроверяйте данные не доверяйте гласит этики и не выключайте голову мыл мои на экране я пишу блог на русском языке посвященной технологии гипер конвергенции в частности он танец можно почитать его ну и тот продукт который мы сегодня рассказывал x-ray он доступен site on the necks свободно скачиваемый для тех людей которым интересно гипертонию риенци я бы тоже хотел напомнить что о нутаникс а есть свободный продукт который называется нутаникс комьюнити дижон это некая некий софт который музыку можно скачать и поставить на свое железо и покрутите посмотреть как нутаникс выглядит на своем железе единственное но там у нее есть несколько ограничений в частности там поддерживается только наши скопил визар не поддерживается например и сфера и ограничение 40 мы его не рекомендуем использовать на продакшн строк говорим его запрещаем использовать для продакшен думы это совершенно такая юридическая юридическая тонкость почему и мы сформулировали то именно так можно его взять скачать единственное что я попросил не тестировать на нем производительность не измерять не оценивать возможности он тайникса пункта анимация потому что для того чтобы он работал на произвольной платформе нам потребовалось сделать некий workaround по работе с дисками я не могу назвать точную цифру но по моим оценкам это где-то примерно 30-40 процентов производительности мы в результате этого теряем на цене по сравнению с большим коммерческим над алексом что касается большого коммерческого нутаникс а несколько цифр просто для то просто для затравки для для того чтобы заинтересовать 4 новая система с гибридными дисками с dvd с процессором типа 2680 в ветре дает порядка порядка 200 50000 чипсов на 4 нотах то есть для производительности 1 1 0 1 0 1 сервера 1 фактических а101 hasta виртуализация делите на 4 наша российская компания цфт центра финансовых технологий новосибирска в этом году тестировала наши новые она еще не вышла в релиз система на анваром дисках ноябре они получили около 2 миллионов и опусов s4 но да вова кластера то есть 4 на 4 х 100 х то есть порядка 500 тысяч чипсов рандомного гидрой то на с 1с 1 к 100 виртуализации вот вот именно вот именно по этим причинам нам нужен хороший хороший мяч марк мы его сделали все спасибо есть вопросы на конечно смотрели ли вы спецификацию вот этого нового тисе пи x и чище и чище а если как-то связан ли он с инструментами ловкач успел посмотреть то я то знаю что он уже есть я обратил внимание в кромке full member of happy систола фирма нутаникс вот то есть полгода назад все небо естественному мы будем вот поддерживать сложно подозрение что может быть взяли наверняка мы номер грамма тестирования будем публиковать да это в наших интересах условно раз уж до взял микрофон вот в тестер вы упомянули про нвм и накопители вот в тесте цфт и там 22 миллионов с нами там у них я так понимаю все таки там oracle data база ей ну как правило дает накопителей на smm собирает пробрасывать и там накопители и я не мог сажали отдавали в мдф с я не знаю подробности как они это делали но сколько помню они тестировали акрополь из осака по лесам мы работаем через через и сказать слова и серу на предлагали многопоточное искать это такой получается она где-то опубликован ну а не делаю небольшой отчет и его даже где-то в город блоге публиковал да вот можно посмотреть его там но подробности там не так много это был их внутренне тесто они там свои имена на совместимость со своим финансовым проделали это тесто спасибо"
}