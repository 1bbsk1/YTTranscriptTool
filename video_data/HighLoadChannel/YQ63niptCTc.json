{
  "video_id": "YQ63niptCTc",
  "channel": "HighLoadChannel",
  "title": "Выбираем систему репликации для PostgreSQL / Виктор Егоров (DataEgret)",
  "views": 12604,
  "duration": 2904,
  "published": "2019-05-15T04:54:48-07:00",
  "text": "здравствуйте не виктор егоров сегодня у рассказать вам о том как репликации для подрезки ел прежде всего почему такая тема казалось бы уже много сказано я просмотрел популярный форум на искье лору подраздел посвященный под русский элу сначала лето у нас возникла довольно много тем освещенные репликации что говорит о том что в принципе вопрос достаточно актуальна также фактически все клиенты которые к нам приходят один из вопросов которые они нам задают какую систему репликацию мы можем порекомендовать в их условиях для того чтобы лучше обеспечить работоспособность их бизнеса собственно поэтому мы сегодня с вами об этом будем говорить при чем мы продолжим я хотел бы сделать несколько ремарок репликация не заменяет бэкапы то есть если у вас есть система репликации это не значит что вам не нужно делать бэкапы пожалуйста вы копируете вашу базы данных и очень важным проверяйте бэкапы которые вы сделали чтобы вы могли из них восстановиться в случае чего нибудь репликация не решают проблем железом если у вас скажем так вы переросли то железо на котором у вас работает база то внедрение репликации не поможет решить проблему поэтому пожалуйста оцениваете правильно возможности вашего железа и старайтесь решить решать их вне зависимости от той системы репликация которого вы используете если вы использовать любую систему репликации однозначно это усложняется административная поддержка всего этого решения то есть вам тоже нужно отдавать в этом себе отчет чего мы ожидаем от системы репликации прежде всего это автоматическое применение изменений то есть изредка встречаются клиенты которые говорят а вот мы делаем 1 неделю по годам и разворачиваем его там настоящий вот у нас такая система репликации но это не совсем система репликации это можно скорее всего назвать тестированием бэкапов то есть при репликации мы ожидаем что все происходит автоматически зачастую мы хотим иметь контролируем отставание от источника то есть как правило это максимально близко к мастеру но иногда нам полезно иметь реплику которая отстает на какой-то заданный интервал времени и еще решение очень много к сожалению рассмотреть все в рамках презентации я не смогу поэтому я сфокусируюсь на определенную количество и о них мы сегодня будем говорить если у вас будут еще какие-то вопросы вы можете конечно же их задать после ну что же давайте выбирать какие задачи решаются репликации прежде всего резервирование потом идет балансировка обновление движение данных и распределения данных ну как бы они здесь у меня поставлены в порядке возрастания сложности ну скажем так несколько условно порядке начнем с резервирование самый первый кандидат от физической репликация которая встроена в подростки ел можно использовать любую другую но это будет очень сложно и зачем это делать если есть физическая аппликация давайте рассмотрим физическую реабилитацию просто удобно надежно существует уже примерно семь лет все детские болезни были решены поэтому пожалуйста пользуйтесь пользуйтесь для резервирования это самое лучшее что может быть однако нужно отдавать себе отчет о том что все равно есть определенные нюансы в любой системе репликации которые он сегодня будем рассматривать есть и плюсы и минусы самая первая физическая репликация реплицирует кластер целиком сейчас мы говорим о положительных моментов она может быть потоковой то есть это означает что реплика подключается напрямую к мастеру и получает изменение которое там происходит непрерывно скажем так не обязательно настраивать потоковую репликацию поскольку мастер хранит транзакционный лог-файл ах вы можете архивировать эти файлы и выставлять их на реплику каким-то иным способом это тоже будет считаться репликации но не потока существует каскадная существует синхронно до синхронной репликации вы можете настроить corum то есть это все стандартные технологии которая есть возрасте из коробки вам не надо ставить никакого дополнительного оборудования софта и так далее пользуйтесь физическая репликация основана на рейс это вот документ это он описывает систему обеспечения отказоустойчивости реляционных баз данных с помощью трансакционного logo это стандартная технология оно используется в ворог ли оно используется в мае соскин сервере оно используется в возрасте это технология встроенным в ведро то есть вы не можете ее выключить она там есть естественно очень актуально то что поскольку она там есть она уже как бы существует на не выключается мы ее немножечко развиваем получаем систему репликации система пишет транзакционный лог любые изменения которые происходят физически попадают в этот транзакционный лоб и соответственно всю эту цепочку изменений мы можем воспроизвести где то в другом месте что дает нам собственно репликацию работает из коробки в принципе это все что вам требуется вы можете пользоваться пожалуйста очень рекомендую говоря о негативных моментах реплицируется кластер целиком то есть если у вас один квартир это одна большая база данных это весь ваш проект как бы вам это подходит если у вас микро сервисная архитектура и у вас в классе ли существует энное количество баз данных при помощи физической репликации вы не сможете выделить только одну базу из всего этого набора вам придется тащить все ну как бы не всем это это подходит к сожалению реплицируются физически ошибки возникает какая-то неисправность на мастере и она не определяется внутренними механизмами она точно так же прилетает в неизменном виде на реплику недавно был клиент у которого был случай когда они положили свой кластер за счет того что у них на мастере возникла ошибка они понадеялись на реплику но она успешно успела подлететь и на реплику он короче все светло и они восстанавливаются и сбыта по есть такой нюанс возникает очень редко и нужно анализировать каждый случай индивидуально изменение применяется в один поток на реплики есть мастер на нем допустим шестьдесят четыре ядра допустим все они или хотя бы половина из них занято идет постоянный поток изменений от сессии это все сваливается в один транзакционный лоб он прилетает на реплику а там всего один процент это все накатывает то есть ну как бы вы можете упереться в производительность увы и ах и только в рамках одной мажорной версии тоже очень большое ограничение мы с утра разговаривали с коллегам с коллегой которые рассматривали возможность применения полюса в своем проекте и отказались из-за того что они не могут позволить себе существовать в рамках одной мажорной версии они хотели бы использовать репликацию для апгрейдов тоже в подрасе увы это невозможно помимо физической репликации существуют и другие и о том что они предлагают это будет по большому же большой учету оставшаяся часть моей презентации мы будем говорить о балансировке то есть это следующий этап применение репликации у нас может балансировать читающая нагрузка и пишущая нагрузка начнем с читающим здесь отлично подходит физическая репликация под поскольку реплики можно настроить в режиме ход санбой то есть они доступны для чтения и это то что мы предлагаем нашим клиентам в первую очередь за счет того что они могут себе позволить малой кровью просто внедрив дополнительные сервера и настроив там физическую репликацию начать балансировать читающую нагрузку как правило большинству и наших клиентов этого достаточно помимо этого у нас существует триггер на и логическое и кластерная репликация давайте смотреть на них по порядку триггерная не удивительно она работает на триггерах для того чтобы работала это репликация на каждом узле вашей системе появляется дополнительный демон то есть вам нужно обслуживать дополнительное программное обеспечение то есть там смотри залогами править конфиги и так далее вы только dml то есть при помощи триггерной репликации с реплицировать какие-либо изменения в схеме вас не получится соответственно это внедряется дополнительный уровень сложности в административно в администрировании всего проекта то что вам прилетает на мастер любые изменения вам нужно обеспечить чтобы точно такие же изменения прилетели и на ваши реплики иначе ну скажем то запись новая которая появилась на массе она не сможет применяется на реплики потому что там структуру не совпадает все вы репликация стран останавливается как правило она останавливается до того момента пока не придет админ и не применит эти изменения на реплики тоже тогда начинает накатывать лак который стоил на катится и устанавливается до обычного рабочего режима на данный момент существуют эти три системы склоне букардо и ланди ест они позволяют реплицировать на уровне логических объектов на уровне таблиц начнем со слонов в слоним это наверное самая первая система репликаций которая появилась для погрузки ела она до версии 7 3 3 1 официально поддерживаемые версии то есть это было достаточно давно у нее свой скриптовый язык для управления достаточно сложный его ну скажем так нужно подумать осознать и увы и ах там действительно приходится работать только через файлы либо через перенаправление ввода-вывода но в основном мы работаем в linux с этой системой вот ну то есть это представляет определенную сложность 2 момента нам дополнительно нагружает мастер потому что она сохраняет дельту в своих служебных таблицах которые расположены там же на мастере сейчас у нас можешь не сервера и создать все красиво тогда в районе 2000 года сервера были немножечко другие и дополнительная нагрузка которая создавалась от системы репликации многими рассматривалась как ну скажем так избыточная для того чтобы получить те бенефиты которые они от этого получали это собственно привело к тому что появились другие системы репликации после слоя она умеет из приятных фич и доставлять изменение файлами то есть вы можете настроить специальную ноду и сказать ей что вы хотите не применять изменения в базу а складывать их в набор файлов дальше в этот набор файлов можете там не знаю записать на дискеты положить в чемодан приехать куда-нибудь в удаленное место куда они эту прямого соединения и там применить эти изменения возможно это может быть полезно и она умеет серий сделать все реализацию транзакций во время доставки их на реплику это означает что репликам всегда находится в консистентной состоянии то есть транзакции применяются в том порядке в котором они происходили на мастере возможно вам как бы это не понадобится но есть определенные кейсы к сожалению которые я не могу упомянуть мы с этим не сталкивались но в обсуждениях мы говорили с людьми которым это крайне необходимое на них это ну скажем так как критическое условия для использования репликации физической репликации такой особенности нету физической или по рации там и накатывается все что читается из инновационного logo если у вас на мастере идет одна долгая транзакция которая допустим то меняет большую таблицу и пока она идёт произошло там десяток маленьких транзакций которые там изменили по одной строчки то вот эти маленькие транзакции прибегут на реплику первыми и станут видны и только после этого через какое-то время прилетит это большая транзакций то есть последовательность изменится ну и поддерживается каскадная репликация то есть до можно пользоваться вот их сайт они недавно выпить выпустили свежую версию то есть проект не мертвый у них ск1 это означает что реплика те изменения которые она получает слой не так устроена вначале получает изменения записывает к свои служебные таблицы и применяет на локальный узел и вместо того чтобы их удалить она может их сохранить и вы можете настроить следующую реплику которая подключиться к этой получит эту же дельту в себе они так дальше могут опрокидывать ну каскадом вопрос был о том что такое каскадная репликация по отношению к с флагом букардо проект написан на перле то есть если вы любите пожалуйста пользуйтесь если вы ненавидите то может быть вы не станете его пользовать используют ли соната фа интерфейс это один из немногих проектов которые знаю которая очень активно пользуется этим функциональностью ей требуется отдельная база для хранения своих метаданных то есть но нужно это учитывать понятно что также будут висеть дополнительные узлы которые обслуживают репликацию это для всех для всех систем триггерной репликации применимы вы не было релизов долгое время со августа 2016 но они подпортили мне картинку потому что вчера они выпустили новый релиз вот пришлось externa менять слайды то есть они в этом релизе и добавили поддержку 11 версии позврослел который тоже вот недавно вышел ну наверное это означает что проект не совсем потерян вот их сайт вопрос о том как используется лесу на тифа и в системе букардо это одна из двух систем которая заявляет поддержку мастер мастер репликации в подольск вели я думаю это используется для синхронизации в режиме работы мастер мастер то есть у них нету global protection менеджера они как бы синхронизм синхронизируют узлы между собой детально я не могу сказать потому что я исходники их не ковырял и следующая система это ланди ест она написана на питоне и разрабатывали ее в скайпе ну видимо как бы причины были те же самые потому что на момент когда существовал только склоне видимо их что-то не устраивало используют печатью печатью это очередь тоже написанное в скайпе очередь написанное давно они на этапе дизайна постарались применить все известные на тот момент проблемами и избежать их после этого она очень долго там больше десяти лет обкатывал ась на данный момент если вы хотите реализовать очередь в базе то не надо ее реализовывать пожалуйста используйте печатью это годами проверенный проект про продукт отлично работают нет никаких нареканий да кто не плюс функции в базе сожалению в связи с тем что skype недавно приобрели в microsoft на данный момент времени проект активно не развиваются и там я даю здесь ссылку на git хоп видно что идет какая-то работа но она больше такая организационная то есть компоненты системы немножечко разделяются на отдельные подпроекты возможно чтобы было проще с ними дальше работать но никаких активных функциональных изменений в проекте не наблюдаются тем не менее все три упомянутые системы триггерные репликации они присутствуют в официальных репозиториях если вы подключаете репозиторий вы можете вставить пакеты пользоваться дальше у нас идет логическая репликация эта новая штука она тоже основана на вал то есть основная идея в том что если мы весь поток изменений которая происходит в базе данных складываем вал то почему бы нам взять и не попытаться расспросить его обратно в набор скиллов statement of которые меняют наш данные но это как бы просто на словах но на деле получается не так просто для того чтобы у вас заработал логическая репликация вам нужно повысить уровень логирования то есть гораздо больше служебной информации начинают попадать транзакционный лак и соответственно все те особенности вот в частности сериализация транзакций невозможно стерилизация транзакции она также применимо и экологической репликации тоже только dml то есть на данный момент вы dml реплицирует только физическое репликации другие системы и прекрасные не умеют этого делать то есть это означает что если вы хотите завести логическую реплику вам нужно обеспечить создание необходимых таблиц куда вы будете реплицировать собственно сами данные и нельзя менять объекты схемы названия то есть вы не можете взять таблицу клиент и сделать логическую реплику с названием клиентском подчеркивание 2018 не прокатит вы не поддерживается пока и есть два варианта на данный момент из встроенная логическая репликация и есть расширение пищи логика у отца con квадрант встроенная логическая репликация появилась в десятой версии повзрослел это одна из ключевых фич не умеет транслировать dl не умеет транслировать ранкед не имеет транслировать large объекты не умеет транслировать последовательность почему они не добавили поддержку последовательности ну немножечко не понятно потому что тот же логика делать этого меньше то есть довольно много ограничений в том числе и репликация только один к одному если вы хотите например сделать апгрейт отлично классно зайдет если вы хотите использовать эту систему для того чтобы например делать частичную репликацию с какими-то переименованием и тому подобными вещами то возможно в вашем случае лучше использовать расширение тяжело g кого она работает для версий 94 выше то есть поддержка появилось раньше достаточно хорошие расширение не умеет ддл но у них есть специальная функция которая позволяет вам кинуть statement в транзакционный лоб и он будет проиграна репликах тоже то есть ну кого такой интерфейс предоставляется описаны у нас недавно один клиент с помощью этого расширения с мигрировали чтобы вам не соврать вам в 95 на 10 они прыгали все прошло отлично ну конечно у них база большая около восьми терабайт она очень нагружена они 2 миллиарда транзакций крутит примерно за неделю и ну как бы то есть простой им был крайне нежелателен поэтому они выбрали это решение тут следует упомянуть один нюанс когда вы добавляете новые таблицы в репликацию на момент начального синко то есть когда таблица перетаскивается целиком на реплику это занимает определенное время и все это время на мастере открыто долгая транзакция как вы знаете под рост не очень любит долгие транзакции за того что его модель конкурентного доступа приводит к тому что распухают таблицы и индексы ну как бы нужно это учитывать если у вас возникает такая ситуация то возможно вам стоит проанализировать список ваших таблиц например выделить там самую большую и реплицировать ее отдельно то есть минимизировать время вот этого длительной транзакции потом взять там парочку следующих по размеру реплицировать их вместе а потом все оставшиеся они уже будут занимать там 25 30 процентов от объема вашей базы добавим один большой сет и и реплицировать их на третьем куском то есть не пытаться перегнать весь объем данных одной большой транзакции это может быть более умеет делать фильтрацию записи то есть реплицировать не все табличку а только то что вы скажете умеет репетировать не все колонки вот сайт документация доступно можно скачать расширение пользоваться и кластеры кластер это уже даже наверное я бы сказал что это не совсем репликация потому что вам нужно до них вырасти я считаю что использовать класс 3 нужна в том случае когда объем ваших данных достиг такого размера когда физический один сервер не может потянуть всю эту нагрузку в случае если мы говорим о циpкa то когда один сервер или допустим а один мастера несколько физических реплик все равно не тянут на нагрузку которую вы на них даете то есть сложность администрирования кластерных систем возрастает неимоверно и вам нужно очень-очень сильно анализировать все за и против если вы принимаете решение о формировании вашей высоконагруженные базы то есть вот просто так потому что лучше не использовать ну-ка вы идите по пути чем проще тем лучше и надежнее две системы я могу рекомендовать их на самом деле больше cytus ip-адрес xl начнем с и туз это расширение то есть это возможно будет для вас плюсом то есть вы у вас есть существующая базар вы подключаете репозитории ставите пакет включаете в базу расширение понятно что база придется перезагрузить потому что там достаточно серьезные механизмы требуется перезагрузка и дальше вы можете начинать пользоваться вашим кластером поставляется в двух версиях комьюнити enterprise понятно что в enterprise версий очень много всяких приятных фишек которые могут быть полезными и это так вот удочка которая возможно заставит вас ну скажем так оформить подписку и получать и поддержку и пользоваться более богатым функционалом но комьюнити идишем доступен и в нем весь тот же функционал присутствует они собирают и отсылают стату они четко об этом говорят в документации они показывают как это можно выключить они показывают место в коде которым они собирают эту стату и которым они отсылает то есть но тут нет ничего такого скрытого но если это у вас служба безопасности или паранойя не позволяет использовать дефолтные настройки вы можете это выключить у них два типа узлов есть координатор есть рабочие рабочий в терминологии называются узлы ноут и в принципе тут важно понимать что в цитрусе есть два основных понятия есть шарды есть ноды шарды это те кусочки на которые вы делите свою таблицу то есть каждую таблицу выше ордер уйти индивидуально то есть у вас есть она таблица вы можете ее разбить по всему кластеру остальные таблице у вас есть два варианта либо оставить их локальными то есть они вообще не участвуют шарди либо сделать их реплицирует то есть идентичные копии разносится по всем узлам платили то есть количество shard это то сколько кусочков будет в этой таблице количество узлов это то сколько физических серверов на который эти кусочки размазывают размазываются то есть они не рекомендуют использовать меньше чем 32 шарда но эти 32 шарда вы можете размазать на два физических узла почему это важно количество узлов вы можете повышать достаточно безболезненно то есть вы внедряете новые сервера прописывайте в конфиг говорить говорить ребаланс и он размазывает эти кусочки по большему количеству серверов количество шар дав после того как вы осуществили шарди рование поменять нельзя ну как бы это ограничение поэтому рекомендуется заранее думать о том какое количество кусочек кусочков вам необходимо одна из рекомендаций там например учитывать что на одно ядро которой у вас присутствует во всем кластере должен быть один кусочек 1 шард если у вас там из 4 сервера по 32 ядра тут использовать 128 хардов это на она будет оптимально причем мы сейчас говорим о дополнительных серверах не о том сервере который является координатор тех серверах которые будут обслуживать ваш кластер они поддерживают также колоночный хранения если кому-то это актуально их расширение которое доступно в свободном доступе поддерживает колоночный хранения можете попробовать и вот их адрес адрес excel это отдельный продукт это означает что если вы хотите его использовать вы его внедряете и потом вам нужно с мигрировать туда ваши данные то есть это более длительный процесс три типа узлов координатор рабочие здесь все тоже самое появляются еще global transaction менеджер они заявляют поддержку lldp транзакций то есть для этого используется global transaction менеджер и он ну как бы обеспечивает целостность в рамках кластеров управляется вот такой вот утилитой j x style называется она так потому что когда-то давно было два продукта под 1 excel подрос и xiii они смирились в определенный этап своего развития названием 30 сохранилась но это означает что вам придется выучить как работать с этого утилита меня там тоже свой синтаксис и вот их сайт кстати продукт поддерживается тоже second one рандом вот такие у вас есть варианты для балансировки чтения балансировка записи тут есть два варианта мастер мастер репликацию и кластерная репликация мастер мастер репликация очень часто к нам приходят и говорят что в пользуюсь и появилась для мастер мастер репликации и в ответ на всегда говорим скажите пожалуйста какую задачу вы хотите решить это тот вопрос который вы должны задать себе какую задачу вы хотите этим решить потому что зачастую вы хотите приобрести себе достаточно сильную головную боль в администрировании всего этого дела и возможно что вы не получите тех бенефитов на которые вы рассчитываете любой узел является полной копией которая доступна для записи то есть вы делаете полное дубликаты всего вашего объемы данных очень высокая вероятность конфликтов сложность в администрирование и если это дело сковывается то его очень сложно потом восстанавливать то есть как бы эти три момента они как бы для меня как для администратора как красная тряпка что я не хочу туда лезть потому что я понимаю что это будет сложно долго нужно будет очень сильно думать над любым живым шагам которые я собираюсь сделать то есть мне страшно я не хочу я хочу чего-нибудь попроще на данный момент только два продукта и и поддерживают это букардо которой мы говорили и это pdr бдр это отдельная история в открытом доступе находится версия 107 а надуманно для версий пользуется 94 это последняя самая старая версия под раскрыла которое на данный момент поддерживается комьюнити и они сами за являются квадрант о том что в следующем году они поддержку этой версии 107 закрывает я не знаю я вот говорю я все продукты к сожалению не смогу рассказать ну то есть они в курсе всего что есть на рынке вот я пытался обратиться к ним то есть у них на сайте нет в открытом доступе не пакетов не документации у них есть форма ты ее заполняешь они с тобой связываются я заполнил не стало ли присылать спам но никто со мной не связался то есть я не могу вам сказать ничего хорошего ничего плохого но осадочек остался ну и вы можете пользоваться также кластерные репликации для балансировки записи то есть я только что про него рассказывал обновление начинаем с логической репликации когда-то если вы хотите хотели прыгнуть на новую версию мажорным под рускеала было доступно только триггерная сейчас лучше пользоваться логической на мой взгляд это лучший вариант меньше всего возможных нюансов с плывет по дороге ну и триггерная любая из этих систем если вы ею пользуетесь это очень сильно индикатор того что вам не нужно лезть куда-то в новую область чем пользуетесь темы пользователя то есть если у вас есть ли у вас какое-либо из этой системы ну как бы не ищите себе дополнительных проблем у вас там уже есть опыт используйте его мы пользуемся физической очень много слова не используются по историческим причинам у клиентов есть опыт в landis this book дым и не сталкивались логические репликации переводчика встроен и встроенная мы сами полноценно пока они использовали не было необходимости мы тестировали наших нашим клиентам когда они осуществляли апгрейды движение данных это вот если у вас есть несколько операционных баз и вам нужно свести информацию из них в единую reporting то есть возможно не всю информацию возможности частично свести эту информацию но это вот тот случай когда на мой взгляд лучше подойдет триггерная я начинаем с landis ты по той простой причине что он действует переименовывать таблицы то есть вы можете сделать это на лету я точно знаю что sony это не умеют за букардо не могу ручаться то есть мы сожалению с ней опыта большого не умеет потом идет логическая если вы реплицируется один к одному логическая вам подойдет лучше но только один к одному те же переводчиков они говорят что вы можете из нескольких операционных бас слить данные в одну для reporting но если у вас везде есть таблица клиент все записи и сам из 5 бас они попадут в одну таблицу и она будет содержать ну как бы 5 как бы копией то есть она будет одна большая таблица мы в случае с landesk предпочитаем другой подход мы репетируем там по регионам например клиент подчёркивание европа клиент подчёркивание америка и так далее потом строим позиционирования поверхность нам проще так поступать вот тут для движения данных лучше триггерная потом логическая ну и последнее это распределение кластеризация собственная про него фактически все рассказал еще раз вспоминаю что есть колодочные хранения cytus предоставляет и шарди рование и cytus и возраст excel это может делать но еще раз именно и о том что кластеризации это очень сложный процесс и вам нужно очень хорошо подумать прежде чем вы туда прыгнете по поводу выбора это все давайте завершать для резервирования лучше всего физическая репликация это идеальный вариант как бы пользуйтесь балансировка чтения в первую очередь физическая за счет своей простоты даче логическая тоже насчет своей простоты в третьей степени это уже пойдет триггерная репликация балансировка записи но я могу рекомендовать такой кластерную репликацию потому что строить мастер мастер репликацию я вообще не считаю целесообразным обновление в первую очередь логическое проще потом триггер на и в том случае если у вас она уже используется движение в начале триггерной а потому что у вас больше возможностей манипуляции таблицам и переименование потом логическая потому что там идет один к одному распределение но только кластер на других вариантов нет вот примерно так мы бы я бы мы в нашей компании расставляем приоритеты о том какую систему репликации для каких русский saw вам следует выбирать и еще будет два небольших момента есть такой pitbull мы не рекомендуем его использовать потому что это не совсем система репликации я бы сказал что это не долго который старается делать слишком много вещей и к сожалению из за этого он как бы не всегда надежны самая большая самая большая претензия к нему с нашей страны это в том что он пытается балансировать запросу между мастером и репликами в зависимости того читающие таза после пишущий запрос и вот сделать решение на основании текста запроса о том он читающей и пишущей это очень сложная задача особенно когда у вас появляются хранимые процедуры и как бы накосячу здесь дико просто и у нас были клиенты которые к сожалению на этом подарили и поэтому мы просто рекомендую не использовать по купону то есть вы можете это делать если вы умеете его готовить если вы уверены в своих внутренних процедурах и знаете что ваши разработчики внезапно не изобретёт какой-то новый подход о котором вы не слышали и это все может сложить вас кло ваш кластер пользуйтесь но как бы в целом мы не рекомендуем и бдр мы не рекомендуем потому что ну как бы есть мнение что это закрытый продукт потому что они не предоставляют актуальных версий в публичном доступе несмотря на то что он очень часто цитируется о нем часто говорят но доступ к нему получить не получилось ну возможность вы хотите стать их клиентам то у вас это получится но как бы я ничего не могу сказать на этом все спасибо за внимание если какие-то вопросы пожалуйста задавайте так добрый день виктор спасибо за доклад гнезда да вы рассказывали про физическую репликацию что одного из клиентов было настроено физической репликация и соответственно они что-то сделали с мастером и это перешло на реплику и положила соответственно можно ли был сделать так настроить на реплики настроить каскад во-первых из-за репликации и на одной из реплик сделать в рекавери комп указать параметр recovery мины плай delay по-моему до рва это можно и это то решение которому они пришли после этих двух инцидентов то есть они ввели еще одно реплику с отставанием в их случае в час для них этого достаточно для того чтобы избежать таких нюансов то есть у них вас складывается основной кластер у них есть реплика у котого которое уже получила эти транзакционные лог но она его еще не проиграла там идет задержка да и соответственно следующий вопрос поэтому а как в таком случае идет failover то есть переключение это какой то скрипт или какое-то то на это уже зависит от вашей организации от того как построенна ваша внутренняя архитектура работы приложения с базой данных из либо заходят напрямую в смысле приложение ходит напрямую в базу nokia надо бежать и перри конфигурировать все приложения если у вас используются какие-нибудь их апраксии там подобные вещи нам гораздо проще это сделать короче это открытый вопрос зависит от того как принято в организации конкретной спасибо спасибо за доклад я не очень хорошо разбираюсь в репликах поэтому все пришел но мне вопрос если я хочу распределить нагрузку на мой сервер приходит в голову идея сделать реплику с которой мои сервисы вы читали данные было бы эта балансировка чтения то есть у вас есть мастер который вы оставляете для в основном записи и для каких-то крайне критичных запросов которые должны получать самую актуальную информацию без за иржик а все что возможно пережить там несколько секунд там до минуты отставания вы отправляете на реплику и у нас есть клиент у которого вот такая установка мастера реплика они держат и там и там примерно подвес 20 тысячи транзакций в секунду то есть как бы у них хороший баланс держится и они отлично работают какую систему мне нужно выбрать и к физической репликации лучше всего просто потому что ее проще всего настроить и она служит двум целям это и балансировка чтения и одновременно резервация на случай если у вас сервер под мастером вылить конечно у вас будет деградация производительностью но по крайней мере вы сможете частично восстановить работоспособность сервера сервиса в достаточно короткое время спасибо виктор здравствуйте спасибо за доклад вот меня интересует вопрос балансировки ехали задача например из нескольких регионов получить скажем так консистентной доступа к одно и то же базы базе данных как это лучше сделать ну то есть я например из россии пытаюсь достучаться до базы и там допустим сша до той же базы и вот мне нужно чтобы и россияне и там без сша например увидели те же самые данные когда они будут производить его действия в 11 версии ну это возможно и раньше но в одиннадцатом было достаточно много улучшений вы можете сделать следующее подключить удаленные таблицы на удаленных серверах через форинт дата wrapper это означает что таблица у вас будет представлена в локальной базе но это на самом деле он скажем так ссылка на удаленную базу и вы можете включить такие таблицы в вашу систему парте цианирования вы можете например сделать таблицу с клиентами и тома 1 partition локальная однопартийцы там в сша на partition там в россии и так далее и научили экзекьютора работать таким образом что он прописывает довольно много оптимизационных вещей как всякие агрегаты и предикаты на удаленные сервера то есть не будет такой ситуации что будет при каждом запросе вычиталась целиком табличкой из удаленного intenso ну на локальный потом об считываться весь объем информации вместо этого максимально возможное количество условий прописывается туда там об считываются небольшая порция данных возвращается и здесь уже считается финальный результат то есть такая функциональность есть то есть это все в 11 posts когда это как бы федеративные базы данных это наверное не совсем репликация хотя уже сейчас слово понятие репликации начинает размываться в современных спасибо пожалуйста спасибо за доклад а вот хотелось бы подробнее про пластину репликацию такой новый термин для меня ну кластер сортирование оно как бы существует уже достаточно давно вот предыдущий доклад рассказывали о том что база это не один узел это набор узлов и это все одна база это означает что выход одного из узлов шире деревень это не совсем репликации размазывание данных бумаги узлов да ну как бы я и говорю я сделал оговорку что это уже не совсем репликация то есть это размазывание на но тем не менее я сюда вынес потому что очень часто возникают вопросы как разбалансировать пишущую нагрузку когда не тянет больше один сервер патроне для кого не рассмотрим от ронни патроне он для не для того патроним для того чтобы обеспечить автоматический failover то есть он это утилита немножечко другого назначения то есть он обслуживает кластер но он работает на физическое репликации это означает что у вас есть мастера несколько реплик идентичных реплик вы не можете там размазать данные к сожалению на троне здесь не подходит спасибо а там еще просто за доклад продолжают вопрос мастер мастер и это единственный вариант сейчас распределением записывающей нагрузки это ну да ну что это единственные но как бы логичные целесообразной вариант 2 тогда вопрос а шарди рования каким образом наставить всегда получается цветов или поздно сразу принципу разбиваются там таблицы а ну это уже вопрос это это как бы сложность этого подхода в том что вам нужно правильно выбрать колонки шарди рования для того чтобы обеспечить оптимальную производительность и скажем так не сделать ситуацию ещё хуже чем если бы это ваш ордер ого нее не было вообще и данные получится прозрачно на между родами цвету сад открыто пишет о том что они не держат несколько копий одной и той же даны если вы хотите получить отказоустойчивость вам для каждого узла нужно еще настраивать физическую репликацию средствами праздники получается в это некий прокси происходит там есть вот этот узел координатор который обеспечивает работу всего этого узла пассированный координатор спасибо архитектурный вопрос вот так прям сверху по вашему опыту если надо распределить на кластер много прям данных как хуже делать там поставить мастер и там 20 к нему реплик или к ним строить каскадные так сказать цепочки которые соответственно создавать будут это зависит от того что вы хотите реализовать в случае 20 реплик наверное все таки имеет смысл выстраивать каскад потому что это скажем снижет снизить потенциальную нагрузку на мастер то есть у нас есть клиенты которые у которых есть мастер одна реплика которой основное назначение которое это именно обслуживать каскад а дальше уже в системе каскада там есть ftp заточенные реплики заточенные на отчеты и так далее то есть там уже разная функциональность тут как бы вам как бы основная задача выстраивания репликации снизить нагрузку на мастером вы не хотите его перегружать а вот вопрос еще в догонку по стилям про cytus и ограниченное количество шагов один из таких кейсов применения шайнинга допустим вот у меня есть пользователи и яши ридеру их по диапазону один на каждом на каждой ноги крайне допустим миллион пользовать когда вам не появляется следующем ён я должен сделать новый шанс а если мне количество шагов ограничен это как поэтому соответственно вам нужно не парижем сортировать я похожу то есть в данном случае количество в данном вообще никак не прозрачное количество шарани выбирать выбирайте один раз вы занимаете в случае формирования использовать систему когда у вас там 10 узлов но вы вначале наполняете один потом второй потом 3 она немножечко ну неправильно вам нужно сразу же заниматься тем что равномерно размазывать эти данные по всему шар ду по всему кластеру чтобы у вас было обеспечено оптимальная производительность многие хорошо вот допустим у меня например sharding идет по географическому признаку допустим открывается новый филиал и мы хотим в этом сериале сделать очередной очередную но душа то есть вот чтобы к этому сериалу обращались по шарджа то есть в данном случае получается тоже вот такое ограничение да я согласен я не могу сходу ответить на так как решать географическое размазывание данных в рамках их кластер а то есть я не изучала этого вопроса потому что у нас пока ни одного клиента с такими требований к сожалению нету просто у нас есть направление сделать его распределенная база думают об этом но с этой точки зрения было бы возможно как бы делать несколько кластеров и между ними делать федерацию то есть подтаскивать какие-то общие данные через внешние таблицы возможно это будет каким-то интересы через какие продукты пользуйся вдовы это стандартные модули которые поставляют нас параметры да у меня такой вопрос полу замечаниям и vsa и время канале 5 шестую версию цитруса это на самом деле была такая штука как коэффициенты репликации по дефолту он правда стоит 0 но его можно менять как минимум при виде создание she возможно но в то же самое время они сами в своей документации говорят о том что если вы хотите получить нормальную систему резервирования то они рекомендуют пользоваться физической репликации ну возможно связанных здесь можно по связано с тем что можно на одной физической ноги поднять несколько инстансов они будут выступать подходы для мастера и если падать физическую узел полностью собой все окопе которые на него она и насколько мы поняли у них нету защиты от того что все шарды все купить шорты попадут на один и тот же физический узел сожалеть да есть такое вот а второй момент у них есть ещё вариант когда количество шерпов не задается сразу при определении сортируем таблицу шерпы сразу по мере необходимости но это такой ручной процесс он препод больше трудоемкости и в этом случае как раз они говорят что это хорошо подходит для случай когда у вас идентификатор джордан дефек столбец по которой идется ширди рование в нем значение монотонно на просто просто китаем серые какие то в этом случае можно вручную создать шар заполнить его до какого-то значения там никита настройка по объему как только вы достигаете он автоматически создает новый но в принципе можно вручную закрыть открыть новый возможно я не капало хопи детально но с моей точки зрения это немножечко да это немножко другая задачи начинает странно использование кластера то есть когда вы его наполняете постепенно то есть смысл в том что среди рование похожу хорошо подход тебя через а выходишь ников клиентов еще для каких-то сущности достаточно конечно когда идут какие-то данные потоком это событие допустим снимаем и пишем или хранения то то как раз таки вполне спины ну да я согласен ну конечно вопрос дискуссионный тут нужно смотреть детально на каждую конкретную систему"
}