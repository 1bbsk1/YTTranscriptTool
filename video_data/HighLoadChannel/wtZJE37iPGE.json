{
  "video_id": "wtZJE37iPGE",
  "channel": "HighLoadChannel",
  "title": "Учимся немного ранжировать / Андрей Аксенов (Sphinx)",
  "views": 3305,
  "duration": 3294,
  "published": "2019-01-14T00:10:32-08:00",
  "text": "вот значит это меня зовут андрей ax рисуюсь информационным поиском с грехи мои века написал полна тексту ему известны ли вам зубовой движок по кличке сфинкс на данный момент значит работаю la vita и работаю там неожиданно совершенно над поиском ха ха и в том самом и над тем самым движком по кличке сфинкс вот это значит как власть кто хуже ну или наоборот лучше вот нам как бы для тех кто в курсе арены поисковиков значит при этом рассказывать вот понятное дело не для сми не про сфинкс не про авито и даже не правило стика про значит а верхи верхи про то как правильно в полнотекстовом поиске ранжировать 0 наоборот неправильно а конечно же все эти ключевые слова не просто картинка для привлечения внимания вот например слова вид обязательно сказать потому что как бы нужно хайло де вот какое отношение то что я буду рассказывать михайлов да никакого можно в принципе на 3 псх ранжировать новый дом где с это сутки 3 запросов сутки невероятно но факт значит для тех из вас кто последний два года назад на это сама ведь не заходил там в один прекрасный момент год назад произошла гигантская революция раньше там у нас было поиск не было по большому счету то есть то что было там стран называть поиском это было скорее хороший термин мне очень понравилось когда его узнал фильтрация по ключевым словам вот сейчас значит но все перед перемалывается в сторону поиск то есть невероятно но факт ингрид год назад а вид научилась ранжировать хоть кое-как есть тех пор значит неуклонное не постоянно учиться лучше то есть если вы как если вы как я туда заходите раз в год могли не заметить это часто эффект вот со сфинксом интереснее он как последние лет шесть наверное лесе и умеет всякое более интересно ранжировать так не палиться то есть всякие сигналы ранжирование там уже черт знает когда прикрученным вот но это как бы из коробки просто так там в два притопа три прихлопа использовать тоже можно но через тоже вот поэтому что называется тема интересна никто не знает никто не делать вот ну и конечно же к несчастью материться мне запретили вот поэтому я буду всех унижать без использования матерных слов о циничными эфемизмы название понятное дело напечатанные в методичке этот циничный кликбэйт циничный кликбэйт как полагается и единственное слово которое верно в данном название это вот это вот слово я как ленин сейчас конечно не понятно куда показываю но это слово немного потому что и научимся мы немного и возможно почти ничему и ранжировать при этом на выходе из доклада тоже будем слегка ну зачем тогда все а а вот ключевые слова узнаем и самое главное что я хотел хоть раз продемонстрировать наконец на слайдах помимо ключевых слов от начала до конца прокатаем значит нехитрый процесс под названием как мне сделать мой первый шаг вот в это вот великое таинство евхаристии ранжирование поставить надо задачу перед тем как мы собственно начинаем что-то пытаться делать но ok ранжирования как бы а поконкретнее хорошо какую задачу в целом решают абстрагируюсь абстрагировать абстрагировавшись господи что за слово вообще от всего вот у нас есть она результатов какой-то какого-то поиск в одну и как-то нашли неважно как ура так называемой хорошей надо двигать вверх спасибо кэп 100 такое хорошее в рамках текущего доклада хорошими я буду считать просто текст опять-таки в рамках родной корпорации добра хорошие это уже не просто лишь текст нам между прочим не хочется показывать вам iphone который три месяца почему-то не продается и стоит в 17 раз дороже чем все остальное это неинтересно и выдача наверное с точки зрения никого вот в рамках вашей конкретной предметной области этот текст может быть а может быть что еще угол что может быть что угодно еще у вас всегда есть какая-то специфика обычно точнее есть всегда какая-то специфика которую с точки зрения ранжирования надо подмешать трико вот простой значит что такое хороший так сказать и релевантный в вашей предметной области этот хороший элегантные всегда какой-то уникальный и зачастую нередко это несколько более широкое понятие чем текстовая релевантность но это в жизни так бывает а для доклада конечно просто понятие текстовой релевантности типа более-менее текст документа отвечает на запрос ну а на сайт с наса идет дальше как поймем что победа ну окей вот все еще ставим задачу это по-моему в шаблоне слайдов так заставлять их делать и поставьте задачу там расскажите сколько у вас документов но и вот я конечно для разнообразия прочитал что написано как понять что все окей куда мы идем с этим нашим ранжирование типа как мы отличаем хорошее ранжирование и и плохой я всегда рассказываю здесь байку что ровно до 7 запросов и до 10 документов на запроса не будь я в принципе помещаются в твою тупую бошку но в мою по меньшей мере вашу возможно поместится 13 документов и соответственно 17 документов на запрос вот у меня она ломается где-то на отметке 7 на 10 там 200 авторов так документов она сломает свою вас нужны какие-то значительные числовые метрики и как бы важно понять куда идти вот здесь такой не смешной слайд как бы надо себя проассоциировать с кем-то либо от города с шагающим говорят с соколом либо соответственно с медведем при этом внутренний тент смысл этого слайда заключается то что скорее всего когда мы сделали про ассоциировать себя с кем-то и поняли куда идти в конечном итоге выясняется что эти на 2 sim туда вверх и немножечко влево не интуитивные могут оказаться метрики неинтуитивным вот мы хотим на каждый запрос показывать некую идеальную выдачу наша полная победа стопроцентно или даже 146 это не идеальная выдача базового это самое если рассматривать исключительно текстом и релевантность не просто с какими дополнительными штуками ну просто все значит отсортировано по это идеальный текст варим релевантность возможен градуированная не бинарная релевантно не то типа вообще никакой документ нормальная видом невероятно хороший вот так специфика ваша опять-таки лишний раз напоминаю это важный момент что в вашей предметной области обязательно будет специфика 1 и второй важный момент а по два важных момента на одном слайде косяк она может быть в свою очередь нисколько не интуитивно когда человек ищет просто iphone просто iphone он ну разве что ограничил свой поиск категории чехлы но если он поиск если он ищет просто iphone то он не ожидает наверно увидеть 720000 офигенно дешевых чехлов он наверно все таки саму железку трещин вот не интуитивно запомните этот вид и не важно с точки зрения доклада их и он не совсем про это но как бы надо было упомянуть мы хотим сами себя отмерить мы хотим придумать сами себе какие-то нет некоторые метрики вот значит наши победы там число по бедности условно говоря метрику качество определенную какие какие формулы форму я приводить не буду специально вы спешите их сами с википедия если дай бог 1-6 этим заняться их несколько штук n10 джипе found here are и так далее или просто так называемый при хижин вот этот п собака н декодируется капри сижу на глубине н натурально концентрация релевантных документов берем первые 10 20 30 это н считаем концентрацию релевантных среди них просто долю не важно на какой позиции они находятся вот ps абакан почему именно эти с них хорошо начинать у них есть два приятных свойства они просты как палка раз это я продемонстирую потом они нормированные в диапазоне от нуля до единицы и их очень легко объяснять бизнесу потому что они нормированные от нуля до единицы то есть лобанов теперь все записал но вот как ну текущее значение причем поэтому все что ты будешь делать после этого соответственно то его не ухудшит победу после этого можно определить как угодно единицы скорее всего никто не достигнет не когда-то там посмотреть на текущие чем там придумать какой произвольно взятой порог и назвать это своей победой где взять эту вашу идеальную выдачу слайд на это в принципе сразу отвечает для этого нужно разметка разметка разметка типа какой документ какому запросу или войти я все лишь к питанию как вещами as the тоже пойдет в нем нет а какого не пугайтесь разметка к несчастью делается вот так это во-первых обязательный котик а во-вторых причем он тут а это но вот так вот он делается это вид со стороны веб таймер 300 так лапками лапками берешь и кликаешь кликаешь помещаешь вот тут нолик тут единичка тут двоечка тут релевантно тут нет исключительно так к несчастью и никак иначе если бы где-нибудь в природе был бы какой-то идеальный алгоритм идеальный алгоритм который со 100 процентной уверенностью или хотя бы с 98 процентной уверенностью это тоже невероятно хороший показатель убил бы говорить что вот этот документ вот этому запросу стопудово релевантен я тут здесь мне стоял задача как бы было бы уже давно решена и и рассказывать про все эти сложности не было бы никакого смысла уже давно были бы как бы там библиотеки а летом залив подключил ран клип подключил чем в этом роде чит код заключается в том что вот эти вот лапки они не обязаны этого у меня лапки они не обязаны быть ваши собственные слава тебе господи мы много лет назад значит наши американские партнеры как в принц сейчас называть в современной политической ситуации придумали штука под названием my chemical чертом логотип крупные но и возможно видно вот но на час mechanical тёркам есть ровно одна проблема индусов там до этой самой как тут выразиться хорошо и индусов там до богини кали я вот английский язык испанский язык еще почему-то поддерживается как клевещут нам значит коллеги из индекса а больше никак то есть разметить что то что на русском языке там еще и не того как он типом украинском русском и и прочими имеющими хождение на территории постсоветского пространства но будет очень тяжело очень тяжело а вот хинди отлично так что если вы делаете поиск леонид русского рынка и к этому индийского но очень куда тут на в индиану то вот mechanical turk ваше все пока как бы мы не все еще переехали то у нас соответственно есть местное значит изобретение под названием яндекс толока которая решает ровно эта проблема там по-русски соответственно исполнители говорят и даже там по-турецки местами еще на разных всяких других языках и конечно же внутри россии существенно проще заплатить русскому юрлицу от русского юрлица платеж в my chemical тек через бухгалтерию можно проводить довольно тяжело я люблю халяву кто еще любит халяву я не хотел ни ни капли платить как бы при этом то есть я вот там клёвые вам production варианты как не своими руками размещать на слайде обозначил есть еще один вариант под названием не только лишь относительно дешево вот эти все сервис они там какие-то определенные копейки стоят там довольно большую разметку можно получить там за сотни и тысячи баксов максим вот своими руками дорога и медленно потому что это начинаешь натурально это имеет смысл причем иногда и на определенную базу но это реально дорого и медленно по сравнению со внешними сервисами сервиса медив ждешь вы быстро другое дело что относительно может получиться не качество это надо будет контролировать вот внезапно можно ли где-то бесплатно взять разметку какие гипотезы статистика но примерно до значит не будем затягивать от улиток закину бесплатно бесплатно какую-то разметку взять можно у вас всегда есть эти влоги доступа дескать вот google от аранжировал вот этот документ уже хорошо 2 всегда можно ее спереть google а вот таким вот методом или соответственно с индексом берешь свой собственный сайт там свой собственный корпус ни цинично давай по нему искать с оператором site : у тебя получается нечто с точки зрения гугла . достойная наверно цель коллеги из индекса соответственно они этот как раз коллеги из гугла должны индекс туда подставлять а вот коллеги из индекса соответственно должны представлять туда google бенгалии так далее тому подобное говорят иногда даже делать они могут и мы сможем берешь google яндекс bing что угодно еще подставляешь свой сайт вводишь запрос ура ура получаешь за получаешь какую-то разметку нечто что является релевантным с точки зрения большого толстого поискового движка ура я это тоже сделала рамках доклада она мне не очень помогло значит вот но помогло кстати она мне с экономику три часа примерно ожидании ща мы начнем наконец-то оранжево чё короче мясо будет ради чего я весь доклад то дел пока вообще несёт тут стоит 15 минут не чем еще не занимать разметка какой-то метрики война немцев выпить хочется уже вот но к несчастью задачу надо ставить перед тем как мы заняли занялись этим ранжируем вот эта вот штука вот эти вот глупая казалось бы танцы они являются вашим при реквизитом пока у вас там разметки нет раз и понимания какие метрики качества мы собираемся оптимизм 2 пуфну как бы можно и не начинать внезапно значит тут жалоба старого человека это как бы я сам себя ассоциирую тоже сюда насчет подготовки редактор жалоба звучит так примерно вот на место на слайде хотел отскочить на халяву до взять какой-нибудь простенький готовый корпус заботливыми руками академиков или там соответственно людей из поисковых машин подготовленный большой там клёвый с одной стороны чтобы ноутбук влазил с другой стороны чтобы мне там и логе запросов и разметочку что чему релевантно она она она она знает только как бы это сбивает все в пакет и машинного обучения и показывай хрен корпус внятный 1 википедия вы смотрели внутри этой википедии какая там википедий на я разметка она википедии на я вот с этим всем причем синтаксисом странными цитатами стран странными ссылками как это им там миллионам спецсил в часть из которых надо вырезать не было никакой человеческой возможность его вырезать ну пришлось взять в википедию с лагами запросов еще смешней достаточно больших интересных logo запросов такое ощущение в интернетах просто нет поэтому я конечно же подсмотрел их в истории своего собственного браузера но мне надо было то все десяточек поэтому хватило оценки релевантности но тоже на самом деле вот такие вот штуки в природе есть но их очень очень мало и данных там очень и очень мало поэтому к несчастью там большой круглый тест на гигантских разумных открытых данных ну вот сделать не удается тут как можно заплакать искатели учет дела ты в абстрактен доклад был дописан что ж вы все будет конкретно с примерами и значит от начала и до конца обещание свое несмотря на то что я собирался не сдержать это я сдержу странно но факт и правда сдержу его не на гигантском корпусе как блины индекс 10 лет строят а на корпусе которой я построил за там в 1 час в воскресенье ну то есть вот на такой синтетики коллекция с википедии лук богаты из 13 запросов оценок там несколько сотен штук казалось бы их 260 на самом деле получается больше погнали вот такие вот гениальные запросы они как бы просто рандомные совершенно я выбирал там английски и как это сказать чуть менее тривиальные чем навигационные запросы google вконтакте facebook и конечно же порно как упорно это важные запросы конечно же он сугубо навигационный значит выбрал вот такие вот запросы далее сделал неожиданный ход который как бы странной с одной стороны но мне немного помог с другой стороны я как раз решил для начала как ну и для разминки опять же разметить их гуглом ну то есть вот лапки раз и там сайт : на wikipedia.org и погнал свои запросы white вот натурально вот этими самыми так вёл копипаста вел копипаста копипаста вел тайтл и обработал там где многоточие написать идиотский совершенно процесс но слава богу поскольку все 13 запросом на него ушло довольно мало времени получилась вот такая вот например штука вот там вот пример запроса с которым все более менее понятно я его очистил соответствует до номера запроса , название странички в википедии даже уэллинг adding не чистил уже на втором запросе случилось смешное с точки зрения гугла то подчёркивание считается буковкой поэтому он ничего не нашел вот мелкая забавная штука что пришлось пробелы руками расставить гуглу ну еще поскольку он находит этот запрос в википедии очень мало бы википедия все-таки там не справочник по маску или попить буквально 5 запросов вот красиво можно объяснить на пальцах что значит за метрика п собака точность на глубине 1 из 1 документы с первого у нас или из одного первого документа он у нас весь релевантен то есть метрика п собака один единичка из первых двух документов у нас все еще один релевантен и так ну сколько-то ход насколько в википедии можно этим метрика 0 5 и так далее и тому подобное на глубине 5 больше там глубине нет глубины нет метрика п собак 5 престижен от файв равна вот соответственно 02 не очень хорошая ну вот так бывает иногда ну нету в этом корпусе нет в википедии вот значит мануала про php никто туда не влил пока я считают недоработка давайте вольём потом его редактора сотрут я не ждали зарплат получать еще один прикольный момент в википедии есть статья про вот эту вот странную непонятную книжку огогого не находит ну то есть может быть находит но ты там глубоко и широко при этом я то знаю что в этом есть и это бибера библиография этого автора именно в википедии читал внезапно с 3 а виноват с 5 запроса выяснился еще один интересный факт если будете размещать значит это не забывайте про так сказать экспертные оценки если будете не полагайтесь полностью на то что вам любой сторонний поисковик выдаст простите целый google в первых 20 плюс я там самом деле еще немножечко поглубже вроде прошел результатах не выдал мне единственный релевантный вариант единственный релевантный документ который я на самом деле искал который простите и в википедии точно есть и в индексе google а точно есть но и собственно вот эта вот штука это как бы мелочь с одной стороны ее там тонкость настройки поискового движка с другой стороны но поглядев на это стало заметно что как бы до того как я буду долго и нудно индексировать википедию она большая than 50 гигабайт данных теперь текстовых надо все-таки цинично по хачить директиву часа ты был в сфинксы сделал так чтобы вот это вот буква а у немецкая с запятыми или точечками на дне она нормализовалось до буквы u иначе я вообще ни черта не найду в ходе своих увлекательных экспериментах 02 google txt всего будет нам семь шагов поэтому конечно же раз семь шагов последний файл будет называться 08 что-то там txt и до 1 7 шагов 8 five логично все сходится в боевая на ошибки как бы программисты к ним склонны и что еще важно а до я да это текстовые файлы натурально скрипты на php и текстовый файл ничего интереснее nokia значит что через несколько часов когда не так с нас построился мы можем смело сделать наш поисковый запрос посмотреть чем находим нашим этим самым или резьбовым поисковиком потому что вы ластик я не то чтобы не умею но мне лень а в сумме существенно лучше я вот соответственно рассмотрел все сфинкс выглядит вот так на первом же допросе видим что ты проблема есть идеальный документ который нам хотелось бы поставить вверх он находится он на позиции номер пять новыми и там все остальные пять тоже как то более менее выглядят релевантными условно говоря на первый взгляд но хочется короче его на первое место явно есть простор для улучшений это хорошо и наконец-то к разметке дальше значит самый такой нудный этап но на самом деле несмотря на всю его нужность он занял минут двадцать-тридцать не больше 1 и пришлось как бы заметить что очень много редиректов в этой самой вашей википедии и обработать данные и папа поправить эти самые redirect а во-вторых ну то есть как бы он нас винкс который едва не сфинкс даже любой поисковик на самом деле результаты поиска по индексу википедии просто без обработки они вытягивают все документы из всего набор там 18 чем-то миллионов документов внезапно выясняется что ты смотришь на вы дачном 80 чем-то миллионов из них это redirect куда-то еще ну нормально вообще но я все-таки как бы redirect еще не саму страничку с редиректом там тебе туда но я все-таки еще конкретно и кончая кант концевые скажем так страничке вот redirect и значит пришлось отдельным этапам из индекса выбросить не повторяйте моих ошибок вот после этого переделав значит еще раз файлик но был там 03 сфинкс tx-nr соответственно у redirect txt я получил первые три колонки автоматом скриптом на пхб в 10 строк как полагается можно на питание было но прочим на php функций и начал доблестно руками все что вот красненькое то руками расставлять оценки 0 чё-то мусор какой-то вообще не то что я хотел один в принципе годится 2 а градуированные оценки троичная шкала два прямо то что доктор прописал и этот документ обязан быть на первом месте в крайнем случае на втором если их таких с оценкой 2 соответственно 2 по-моему он не было ну если трету соответственно 1 втором или третьем дальше внезапно мы можем посчитать эти самые метрики про которые я говорил формулы и 10 же википедии есть это же просто я как палка если значит у вас знак суммы не испугает первоначально то после этого все пойдет хорошо метрика получается подозрительно высоко и понятно почему сразу понятно почему и вот здесь у меня кстати как раз спасла выдаче гугла на которую я показал посмотрел глазами ну которую не использовал для автоматической разметки в принципе тоже бы мог но заменился выдаче гугла например по одному из запросов по 12 тут написано про сингапур сколько нынче времени в сингапуре я заметил что в имеющиеся выдачи какого-то черта в топ-20 самого главного документа там супер единственного супер релевантного про там time zone в сингапуре нету вообще ничего выдачи свингса выдаче гугла она соответственно нужный мне единственный документ был на первом месте добавляем его руками в разметку внезапный такой ход то есть я знаю что он там есть я его добавляю руками в данном случае мог бы помешать подмешать из выдачи гугла в случае с примером джин рамми не мог бы наоборот но кстати наоборот появился выдачи сфинкса иногда бывает что ни в одной вы даже ни одного поиск нет внезапно подмешал туда бук поскольку у меня база маленькая корпус маленький написав руками вот в этот файл на 206 на 206 строчек 380 буквально две строчки с важным не результатами я блин метрику провалил достаточно сильно даст ноль 85 до 0 79 и на самом деле это хорошо если у вас с первого выстрела метрика чё-то которая считается вот эти пять строк сильно большая и этом вам кажется что у вас качеству и так 10 это может значить только одно выглядят на оба жили и и или у вас плохие данные ну не может же так быть что как бы вас на самом деле все пуха по ощущениям на метры кобрин 10 и копье на dos оптимизировать в 10 так как не бывает вот тем не менее несмотря на это все нам кажется что бы и celine якобы довольно неплохо с одной стороны это эффект того что вот этот корпус на 10 внутри надо запросов слишком маленький разметки недостаточным местами есть гарантии что по остальным 13 запросам мы точно так же не пропустили какие-то супер релевантные документы которые в идеале надо ставить там на первое место да нет таких гарантий по одному запросу заметил добавил рукой внезапно метр и так бух с 085 до 08 но тем не менее как бы изначально кажется что все хорошо там начальная формула према божественна даёт нам результат 85 процентов the deal ну ладно в 79 и все что надо сделать она же тупая как палка это формула дефолтная конкретно в сфинксе включить помощи тупи и сразу хочется тряхнуть веса просто в тупой и у нас будет счастьем вот-вот хочется руки чешутся даже у меня хотя и знаю что делать так нельзя сейчас продемонстрируем почему так делать нельзя ну как бы всем стоять морда впал как бы работает омон научный вот руки прочь от клавиатуры всем восстановить компиляторы трогать только питона и соответственно строить красивые модели лучше на ней россия хотя нейросети здесь не очень применимым в итоге хочется прийти ни к тому что ты трясешь веса и трясешь их руками просто потому что вес у тебя это там один маленький пара в данном случае действуйте один маленький параметр в одной формуле хочется параметров в эту формулу ранжирования или более сложно еще в m-elle модель какую то ли существенно большее количество раз даже когда вас формул относительно простая вот строчка номер 2 на слайде или номер три на слайде там уже довольно много параметров и уже довольно много чисел об которые хочется трясти 2 руками опять же по опыту ну два нутри ну максимум 4 можно как-то тряхануть дальше у вас на счастье никакого не будет от того что вы руками это потрясете более можно попытаться как бы низколетящие фрукты посыпать вот эти вот шире лением весов но иногда даже это не работает ну ладно говорят наука давать науку значит самая простая наука которую мы знаем для того чтобы форму под результат подогнать вот нам как у вас какая-то формула дает какой-то веса на выходе у нас по большому счёту классификации на самом деле в класс 012 вот ну ок давайте зарегистрируем в тупую давайте построен просто значит линейную модель регрессии вдруг сработает вот внезапно тут противоречивые задачи сигналы ну не понравилось как на каком-то из предыдущих докладов рассказывали что так делать нельзя но но работает же в данном случае с линейной регрессии в задаче блин классификации так делать как бы абсолютно нельзя не делайте так никогда за исключением тех случаев когда нас она у вас работает я видел случаи в других кейсах правда когда но вот натуральные работает берешь регрессирует сразу получаешь какое-то небольшое улучшение на 1 0 тире 0 шаг она годится данные где взять опять же я умею в сфинкс говорят что вроде в лице elastico solara и так далее тоже наконец научились считать может быть не сами может быть посредством каких-то спец плагинов в случае solar помад блумберга какой то адский плагин есть очень реально страшно сфинкс такой функционал гейство он умеет считать некоторую пачку значит факторов выглядит довольно ужасно но поскольку все мы умеем форматировать же сам мы воспользуемся этим тайных знаний а ну слава богу хоть хоть кто-то умеет кого меня форматировать джейсон и поэтому заражал получается вот так а еще самое главное данных побольше выкинуть в любой непонятной ситуации когда вот такая вот стена той выкидывай как бы данные и все станет на свои места я вот выкинул и все встало на свои места видно что у нас есть какая-то горстка каких-то циферок про документы это вот они в самом начале есть какая-то горстка каких-то циферок про отдельные поля в этом документе и вот они соответственно в же слон массив ура ура и про ключевые слова все из них вот сфинкс умеет считать можно их воткнуть свою формулу с определенными ограничениями можно их воткнуть в свою девку смл моделью ура опять же у работу это практически весь скрипт которым я чудовищного или потому что php на питоне выглядел бы не менее чудовищно просто фигурных скобок не было читал еще хуже он на самом деле не сложно и там сложная часть в нем в кавычках это как максимум от этого ты сквозь запрос натурально делаю сколь за вопрос джейсон декады пару-тройку интересных не сигналов с планируя файл на кой черт я это делаю я выгружаю гигантскую табличку в которую для целей примера номер один выгружаю просто вот те самые два три сигнала которые в во встроенной дефолтной формуле собственно используется вот этот встроенная дефолтная формула сумму там lcs + lcd тут реально три числа суммируется вот так он настолько тупорылое дефолтное ранжирование там суммируются три числа lcs 0 с каким-то коэффициентом причем там коэффициент на самом деле как если бы двадцать пять тупым 15 ряда единиц этого не надо было делать вообще без коэффициентов lcs 0 + 1 + ура ура обоим 15 мороз так я эти три числа и выгрузил поскольку я хочу я говорю либо классификацию просто пристроить мне при этому еще пришлось приклеить разметку те самые оценки 012 которая руками в другой текстовый файл приписал nude сложнейшими задачами занимаюсь прям вот чувствуется мозг кипит как бы наука я прям чувствую m-elle мышца растет не здесь у меня и мышца явно ну вот так excel внезапно как бы как программе сервера под linux это дело конечно же под винду и и ну а где еще и люто бешено пользуюсь секса говорят в опен офисе тоже есть колд то есть в принципе тоже можно не знаю если в колке штука под названием лин ест ли nest эта штука которая считает тупо регрессию она вот плохонькая подсвечена курсором в колонках h2 по кей2 ее невозможно интерпретировать потому что не в том порядке и вот это вот кирпич снизу это как раз я экспериментально выясняла в каком порядке блин у меня параметр отойдут где что непонятно ни хрена документацию три раза прочитал все равно не понял я наверное единстве человек который последний за последнюю неделю документацию на вины сочетал в excel и вот но вот так я получил какие-то цифирки они мне дают там формулу 0 205 по-моему на lcs 1 и так далее а у отлично я записал никакой манит я записал эту one а вот выглядит вот так воткнул ее в ранжировании и получил ожидаемо мне не ожидаем и на самом деле как я говорила но иногда работает иногда можно вот вот настолько простыми движениями получить немножечко лучше результат чем изначально был в данном случае я абсолютно научным плюс автоматизированным образом они так что просто циферки покрутила не пойми что намерил получит какой-то отстой результат отстой я получил во первых научной автоматизировано это главное а во-вторых сработал еще один важный факт после того как я это сделал я извините сменил ранжирование у меня 45 документов из 200 плюс оказались не размечены я не знаю какая у них оценка я ношу другие какие-то 45 документов можно нерелевантные может они дико релевантные мост они вообще не рай ватные я не знаю что же делать как же быть окей берем и садимся до размечаем ну и лишний раз обращаю ваше внимание на вот эту звёздочку именно ее надо было на самом деле красным шрифтом и 70 вторым кедром стальной слайд собственно интересным контентом бани в лес поэтому вышло так как вышло так делать нельзя это задачи классификации что ты делаешь дебиил какая регрессе тем более в excel и возьми хотя бы а так делать нельзя но иногда можно иногда работает но помните что так делать нельзя я сделал до оценку добавил несколько значит строчек вот у меня файлик 05 05 мар kydex если что это вот те самые две строчки про сингапур штендер time добавленные руками не еще больше это вот 05 от 04 вот так отличается я добавил все вот эти 45 не размеченных и у меня опять же ожидаемым образом упал bass line то есть я добавил документов стало ясно что там на самом деле в базе то в корпусе побольше релевантных чем мы мне изначально казалось глядя на первые 20 документов в плохой выдачи и внезапно у меня вместо 0 793 bass line рухнул да ну не очень русском как мне так как доллар к рублю до 0 и 700 75 на самом деле это хорошо это вот означает что метрика более-менее выбрано правильно двигается куда-то вниз спасибо простор для улучшения увеличиваем вот легкий выигрыш не вы игрался и кстати к вопросу руками вот это вот не очень ожидаемое хотя если подумать ожидаемо вес я тоже покрутил он вставил два вставил cry вставил 10 перри мерил bass line побить не удалось то есть это довольно интуитивный результат up обычно удается обычно удается как ни странно именно поэтому я сделал в данном случае не удалось от того что я повысил вес тайтла в простенькой дефолтной формуле у меня метрики качества только блин поехали вниз anja джед вот это количество не различных документов к я как проконтролировал она там была в пределах 0 группу в этом 0 плюс минус 10 хорошо значит займемся фичер инжиниринга мна силен и вместо того чтобы делать все руками возьмем и сделаем значит опять же вещь которую никто не делать прочитаем документацию в данном случае на сфинкс выясним что там оказывать кроме дефолтного раване арантира apple а есть еще какие то и возьмем и один из них немедленно подключим это делается как бы ровно в одну строчку отставить в одну строчку это делается ровно в три слова общем ranker равно сыпуха 04 вот он php скрипте который мне чет там вот где-то экспортирую внезапно победа заметьте какая убедительная 0 780 и это несмотря на то что 13 документик of не размечены до оценили bass line еще немножечко упал результат ранки раз и паха 04 еще немножечко подрос то есть мы там из 077 внезапно сделали 079 наконец-то какая-то побед наконец-то какой-то прогресс почему мы добавили по факту потому что мы добавили новые и как выяснилось сколько-то влияющие на это самое неуловимое качество поиска фичи конкретно если залезть в формулу она там в документации тоже описано она тоже нехитрая в последней строчке на слайде вот там два буквально булевых флажка из старт и и зак зак хит считаются каким-то образом и подмешиваются в эту самую общую сумму работает она ровно вот так и внезапно дает эффект хорошо что же дальше чем мы видим вот из этого и между прочим из фейла регрессии которую делать нельзя которая вот по трём вещам значит мы построили и она как провальные результаты дала только всего худшего и но еще в наши попытки жалки крутить веса руками они тоже все ухудшили видим три основных на мой взгляд мега вывода порядок случайный то есть может быть на самом деле первым делом надо не фичи добавлять а именно там модели не так оптимизировать вместо линейной регрессии почитать логистическую регрессию еще пока без машинного обучения даже truevue и все равно все будет хорошо порядок неясен но для того чтобы было счастье видно что в принципе рано или поздно вот всеми этими тремя вещами пройдет заниматься раз добавлять фичи 2 модель оптимизировать как-то не так не просто лишь тупорылые регрессия например страшилы регрессии и конечно же в итоге модель хочется несколько усложнять потому что мы понимаем что линейный это и как его звать на линейной функции можно приблизить чуть менее чем все вот но тем не менее это не идеальная скажем так модель более сложная дает иногда лучший результат и тут внезапно вот эти вот наконец слова которые носят те из вас которые и так знает меня возненавидеть окончательно за это доклад ну простите он не для вас он для тех кто этот эти вот увлекательные слова и еще несколько типа там tensorflow or и так далее не знает он в 1 для дебилов как я я по всем перечисленным конкретно в немцы кудемское это большой майкрософтовский турки для машинного обучения там внутри есть какая-то чтобы под названием light гбн у которого логотипа нет поэтому вот так и еще есть много всяких других увлекательных tool kit af даже те которые деревяшки строя для ранжирование очень плохо работают деревяшки деревья принятии решений нейросети но туда сюда скорее для вечера инжиниринга меня для конечного оранжевая поэтому модней шива tensorflow тут нет и gtx 1080 ti для того чтобы в новый battlefield шпилить язь и без работы не пробил не пробил надо заняться классификацией картинок тогда конечно можно будет ставить в закупку выкидываем excel наконец сейчас дела то мы пришли по машинам обучение прослушайте научиться немного ранжировать даже в тот момент когда ты пользуюсь чёрным ящиком которые за тебя какие-то товарищи достаточно умны некоторые с бородами некоторые без изготовили и он как-то работает внезапно выясняется что этих черных ящиков вот такая просто не гигантских ручек и самое интересное что некоторые из этих ручек они примут начинаются на стадии номер 0 как бы не совсем понятно что у нас задача то там задать и как как лучше модель строить задача классификации под натурально даете вот такой тулкит немножко как баран на новые ворота там были такие задачи эти задачи random forest тут такая функция потери там такая вот такая функция этому числу господи помилуй голова мозгом взрывается там через уши все вытекает совсем непонятно что делать отставить на самом деле да все сложно но не сложно сложно сложно печей разнообразных не в смысле сигналов ранжирования функционала разного в пакетах машинного обучения до очень много зарыться в них можно навсегда астат очень простой и как бы сложно да но не совсем самая первая котбус модель строится проще бренд чем линейная регрессия и строится она за несколько секунд на ноутбуке при этом опять-таки специалисты по машинному обучению я не специалист по машинному обучению если что этим у нас в компании другие люди не знают про машинное обучение именно поэтому рассказываю про него я но как бы то чтобы зато всем понятно было то есть если мне понятно турин наверное сумме объяснить вот натурально вот таким вот нехитрым к нам на питоне строят построил я значит а первую нехитрую как boost модель сделать совершенно неправильно конечно построился на за несколько секунд а выгрузил я в нее и правда не те три фичи которые изначально были про там lcs 0 lcs один не 3 вот этих ничего не значащих циферки а все-таки побольше просто взял значит свальный грех гигантский все те сигналы текстовые которые сфинкс умеет считать про те соответствие текста запроса и вот все их значит и выгрузил после этого вычислил результаты вот на это у меня ушло еще вот четыре таких сложнейших строки особенно конечно последние 2 прим в шедевр сложности документацию пришлось считать долго сами понимаете переедем сказали все скреплены по хету парапету он что делать пришлось читать документацию дальше от чисто елене потому что было лень писать еще 10 строк на питоне проклеил результаты из одного текстового файла к другого текстовый файл к и 3 текстовый файлик она потом просто в excel и немножечко перри сортировал оставил тут 20 и так далее детали я как бы там либо выложу либо расскажем в кулуарах если кому интересно вот и получил наконец какой-то результат или например какой то результат ада небольшая ремарка все это можно было сделать командной строке но не получилось вот и вычисляем наконец результаты результаты просто вообще уровня бог индекс как бы наш рулевой и внезапно нас как пустом спас x by a boost возможно спас бы также но почему-то как бы мне под руками был котбус так значит сложилось а вот значит о файлик npc by php даже в момент когда у нас аж на 135 напоминаю размер этой долбанной базы максимум 260 да там 20 документов на 13 запросов на самом деле меньше потому что там есть запросы который мало что находит больше чем половины база вообще не размечена то что не размечена считается нерелевантным а то что считается нерелевантным она вот этот спор не увеличивает и внезапно удачи космический результат ноль 828 возникает вопрос а что будет после до оценки но наверное уже прочитали если я выбрал достаточно большой шрифт после до оценки результат еще более космически результат который показывает как бутовская модель вообще ноль 859 a bass line продолжает ехать вниз уверенные гневное вот падает в конечном итоге с очередной разметкой вот это вот по-моему там 400 уже пару за документ запрос был размеченную суммарно там соответственно за 20 минут за 30 мин до 0 700 33 ч нормально как бы к ним в продакшен было 073 стала 086 есть желающие покатить вот это в продакшен или все как бы чувствует крысу как бы и вот что этот вопрос такой с подвохом гигантским ага а вон ты же devops тыж а виновата юра значит devops поэтому знает что то что разработчик принес первым нельзя ходить в продакшен надо показать другому разработчик он обязательно скажет что все нельзя материться а кому не мат все надо все переписать сделать все не так после этого не по конкурируют и вот возможно вторую версию в продакшен захотеть так и может делать так нельзя специалисты по машинному обучению и даже специалиста по линейной регрессии в кавычках мне наверное уже это ненавидят каковы результаты на самом деле только выглядят неплохими на самом деле они являются терминаль на плохими по одной простой причине это абсолютно неверный подход к снаряду потому что модель которую мы построили как пустом большая в ней сто так называемых деревьях на самом деле это не деревья такие маленькие листики не важно до 100 деревьев принятии решений которые на нашей гигантской базе в 400 блин измерений просто запомнили по большому счету всю эту базу вот реально всю просмотр глазами это в основном подтверждает он ранда итоговой оранжевыми которая получается у этой модели чуть менее чем идеальное натурально ну видно что корпус кстати доблестно борется даже несмотря на то что обучающая выборка вот такая махонькой никаких спец фокусов для того чтобы train тесто разделить и так далее я не делал и как короче я сделал все для того чтобы модель зафейлилась она в принципе более бине зафейлилась но тем не менее значит показала хорошие результаты чтобы было видно что как бы можно получить хороший результат можно обучением невероятный такой вывод вот и как бы продемонстрирует а с другой стороны методичку по этому уровню 2 что надо де надо делить обучающую выборку на 3 ст на train'e это сделать какой-то холода он может подделать несколько how to validate в кросс валидацию и так далее вот как бы тоже продемонстрирует вроде как удалось время здесь уже должно подходить концу по моему хронометру осталось три минуты слава тебе господи у меня как бы как раз на 3 минуты наверное всего я осталась куда копать отсюда дальше мы все сделали неправильно мы посчитали какие-то безумные фичей мы никак их не нормализовали мы никак их не обработали мы не почитали никаких композитов у нас крохотное тестовая выборка должна быть я не знаю раз хотя бы в сто больше надо больше разметки на когда автоматизировать процесс надо блин первым делом в момент когда все таки эта машина обычная модель и алё хотя бы там на тест train разделить и сделать так что если мы тренируемся на какой-то сотки запросов там на соответственно 100 запросов нескольких тысячах оценок релевантности если мы это делаем то у нас какая-то друг какой-то другой набор запросов и оценка так далее набор который тестовый который машинная обучалка никогда в жизни не видела из-за тащиться под него и запомнить все что в нем написано не может чтобы он блин был это самое как бы главное чтобы совершить янгом вот гигантским побороться на предыдущем шаге но и в общем как бы больше больше больше больше всего как гласит известная мудрость не бывает плохих моделей в смысле машинного обучения так-то я надеюсь что в fashion индустрии бывают и надо больше данных больше данных больше запросов больше разметки больших вещей и больше бак фиксов на каждом этапе в каждом из этих моментов и немаловажная деталь вот это я проделал все на коленке вот так вот за там грубо говоря три часа чистому рабочего времени наверно или даже меньше в бою вам скорее всего хочется это запускать в некий бесконечный цикл зависимости от того насколько вы серьезно настроены либо этот бесконечный цикл будет постоянным либо его хотя бы хочется повторять там не знаю раз в 3 6 9 месяцев когда у вас там новых данных под наберется может быть или какая-то сезон исправить или еще что-то в этом роде наука это большая гигантское там внутри много тонкостей я вот это верх и абсолютно адские абсолютно очевидны и я вообще не из того отдела я пока что еще не знаю и гуманитарий компьютер не снимай но делать надо много всего там чинить набор запросов не репрезентативные среза здесь очевидно предельно мало данных для обучения даже когда вы наберете выборка натурально в висел в 1000 возможно в десятки тысяч и отчетов там все равно может случайно оказаться мало данных для обучения вы собрали офигенную орку размером 10 1000 оценок релевантности они все 0 и чего отличная машина обычная модель научат вам простая модель получится абсолютно уверенно будет предсказывать 0 всегда не очень хороша выборка для обучения получилось надо как перри балансировать немного могут быть определенные бестолковое выдача немаловажная деталь нет смысла ранжировать зовут в задаче поиска выпущу в которой 3 результата ты в каком порядке не пока не пока же user их наверно все таки прочитает ну разве что там через бойницу толпы у тебя интерфейса тип росту критично топовые результаты но я надеюсь что как бы люди которые через бойницу так это топовый поисковый результат показывают бойцу они как бы и без меня справятся потому что иначе как страшно становится вот ранжировать что-то в принципе надо когда у тебя результатов поиска там достаточно много хотя бы несколько десятков несколько сотен когда у тебя есть риск важные вот эти вот результаты которые ты по ключевым словам кое-как замочил пересылать плохим ранжированием в конец контролировать что-то еще довольно бестолковая штука надо чинить разметку даже когда-то ее делаешь усилиями кандидатов наук юридических соответственно для условного консультанты гаранта и так далее и они тратят на там каждый конкретный запрос и документ не знаю по два рабочих часов . зарплату осваивать надо все равно не смотря на это приготовьте большие эксперт это делают возможно даже внутри когда ты делаешь типа дорого и типа качеству просто честные ошибки нам надо считать надо переголосовать несколько раз если ты это аутсорс какой-то волшебные сервис тип mechanical сверкали толоки там блин ботов изрядное засилье некоторые из них говорят на хинди вот снаружи клики не глядя надо устраивать голосование надо проверять проглядывает глазами в общем целый отдельный большой труд в каждой конкретной как это сказать каждом контрольном будете если угодно с запросами зала с разметками и так далее самое интересное да надо придумывать больше вещей заниматься тем самым фичи инжиниринга и по каждой новые штуки которую ты придумал ты как бы в идеале в идеале должен крутить вот этот нехитрый бесконечный тоже цикл придумали новую фичу перестроили модель посчитали метрики может быть apts какой не запустили и лишний раз напоминаю что специфику никто не отменял одной лишь текстовой релевантности не отделаешься возможно в вашем конкретном случае какая-то другая там какой-то другой нехитрый атрибут вашего документа даст на самом деле наиболее термоядерный эффект для качества по сравнению со всем что угодно что он вы считаете по тексту так бывает иногда и конечно же просто делать больше итераций они так что один человек там взяла за три часа воскресим чет сделал формулу по хочу и потом конечно все это на 5 лет умерла через пять лет просто уже никто и вспомнить не может так что это был ну станок нуну море где тут минуту саморекламы если чувствуем все это умеет и умеет давно вот дефолтная формулу при этом что тифон встроенные точнее формула которые вот так вот по щелчку включаются они используют в одном случае по головам я считаю без умножения на количество полей тут неважно насколько у нас полей 2 или 30 у нас есть вот определенный сигнал там в поле под названием lcs от того что я умноженном на 30 как бы ничего кроме циферки не изменится считать он имеет больше сигналов используют во встроенных ран киров только парочку натирать четверочку может быть когда-нибудь пройдет еще шесть лет или десять лет и наконец появится рамках где будет ну видимо 6 то есть линейная регрессия показывает подсказывает что 6 наверное должно быть в следующем ранки или сигналов а умеем считать немножечко больше вот из коробочных вещей их вот столько некоторые из них тупые как палка некоторые из них вообще вредные возможно надо выкинуть и даже машинному обучению не показывать чтобы она так сказать не не пугалась не путалась и даже тем более линейной регрессии не показывать она запутывается еще сильнее но вот они есть их больше их можно использовать если вам вдруг их еще не хватает session эй компилятор в зубы и получить весь поток всех хитах вы из всех документов и посчитать такие вам угодно тестовые сигналы как бы тоже никто не запрещает но будем откровенны лично я писал подобный плагин если не один раз в жизни то 2 и оба эти раза были не для того чтобы посчитать текстовые сигналы для того чтобы какую-то особенную уличную магию сделать с match.com на самом деле потому что я там какие-то хитрости кодировала в позицию для клиента вот такая минутка рекламы я одновременно с этим часть ответа на вопросы типа а почему не власти cut в том числе поэтому и да вот та модель которую я строил ранее как пустого и она именно вот вот просто взял и все вот это вылил в эту капусту и модель просто вообще не глядя без обработки и так далее если сделать обработку почистить как ты нормализовать и люблю рисовать и так далее будет значит счастье получше вот этого чела нес иностранец учимся немного я обещал что ничему не научимся я обещание сдержи ничему мы не научились райкер а у нас получилось так себе идеальных результатов он не дал мы узнали несколько нового ключевых слов возможно основную массу этих ключевых слов мы знали заранее на кой черт я тут распинался и не уложился в бюджет распинался и не уложился в бюджет я для того чтобы вот по большому счету показать вот этот слайд обратите внимание 400 оценок руками 400 цифер прописанных в текстовый файл натурально в текстовом редакторе 01 2012 суммарно будет у меня ушло 20 30 минут именно эту часть все-все скриптовые обяз очки там которые что-то делают там экспортируют считают и так далее все суммарно заняли менее 200 строк 190 что ли там или 150 даже если у меня какой-то дубликат затесался и так далее на выходе и подлиза суммарно все эти развлечения за несколько часов на выходе я простите получил как ты повторяемые как то самое главное измеряемые результаты ну как бы общее понимание куда копать дальше и самое главное какие то вот измеряемой и доказуемое улучшения тоже получил мы понимаем другие что они кривые местами мы понимаем что ну там местами их неверно так сказать не то что посчитали посчитаем до 10 жимы верным и модель плохо построили мы ее перри потренировали тем не менее мы вот видим какие результаты дает перед тренированная модель там с перекачкой мышцой вот как то так а семь маленьких шажков я их выписывал на слайд мы вытянул вот но поэтому поверьте что их 7 всем маленьких шажков можно в против бренд проще чем у анонимных алкоголиков но там 12 шашков а тут всего 7 то есть как бы сложно да сложно местами какие-то непонятные блин формулы википедии пакеты обучения ничего не ясно но на самом деле мы опять же обратите внимание всем нехитрых шашков запусками как с как сводом бумаги и поверх цифра запусков запуск людей в космических пакетов и мы получаем такие результаты мы получаем их такие на коленке с палкой веревкой быстро и как ни странно еще небольшими дополнительными усилиями таки можно либо линейную модель подогнать хорошую либо машина обученную модель подогнать опять же достаточно годную которая вполне себе будет запуска провод и опять-таки опыт показывает разные всякие в разных местах что имя обычно именно 1 вот это итерация не важно как вы ее сделаете может быть вы какой то супер конвейер построить и которые сразу вам даст возможности там по клику заново там все гонять переобучать там новую пищу сделали переоценили и так далее а может быть вы руками это один раз про делаете и когда вам надо что-то будет поменять вы там опять руками в восьми местах и 20 скрипта ко всякой будете вынуждены и изменять но него вне зависимости от того как вы это сделаете вот первая итерация там в сколь угодно рут простая ручная и так далее обычно обычно дает ну прям самый термоядерный эффект про улучшения сшиваем те самые низколетящие фрукты вот на этом вроде все если вдруг кто то хочется скрипта и посмотреть данные а также не дай бог продолжать там разметить еще 13 запросов придумать свои 13 запросов и сделать 800 оценка не 400 вот пишите в почту я долго думал а витебскую корпоративную почту тут написать или нет но если чё я тому парню от фарма ржу как вы из левого в карманов правый карман не проблема вроде все у меня есть еще там три нычки ну это уже к вопросу о вопросах вопросы а какого есть опасно ни у кого что так же сложно сложно ну тогда кто захочет это захотела нет у меня сюда отлично вообще плохо за 1 цент здравствуйте в большой за доклад все таки вопрос почему не католита в продакшен от сразу надо было посмотреть померить стали лучше или нет и не проверять не смотреть там что завершить или моделью сам сразу выяснили такая ну вот подход вконтакте в принципе как это метаноле и посмотрели если что нам напишут дуров верни в стену в принципе на самом деле шутки шутками можно и так несмотря на то что задира мария вы попросил они обобщают все-таки это мое личное мнение в мне кажется так можно делать достаточно неплохо сохранился выяснить я только что хотел сказать на самом деле можно сделать и так даже если ты завершить эту модель никто не мешает нам покатить действительно мы не обязаны все это раскатывать на 200 процентов пользователь одновременно мы можем отдела покатить в прод на какой-то тест на какую-то тестовую группу посмотреть а вдруг у вас действительно сразу за графическая модель оказалась достаточно хорошо так что в этом плане совершенно прав можно так но в данном конкретном случае мы просто сразу понимаем натурально если там минимально приглядимся хоть чуть-чуть и натурально получим второе вредное мнение какое нибудь в данном случае мы сразу понимаем что модель за верфи china ее надо переобучить но тут сделано детская ошибка как бы там нет методичка не открыто вот поэтому на предмет детских ошибок как наверно хочется даже проверяться передам и тестами она вот про это еще вопросы будут сейчас нет тогда если пришло несложно да они появятся или если кто-то не хочется справиться здесь можно их задать на дискуссионной зоне снаружи сейчас у благодарим андрея за иван родилась бумажку спасибо"
}