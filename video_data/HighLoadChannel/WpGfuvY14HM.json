{
  "video_id": "WpGfuvY14HM",
  "channel": "HighLoadChannel",
  "title": "Проксирование HTTP-запросов web-акселератором / Александр Крижановский (Tempesta Technologies)",
  "views": 1045,
  "duration": 2994,
  "published": "2018-01-16T13:40:43-08:00",
  "text": "дадут и коллеги я хотел бы сначала представиться что мы делаем прежде всего мы занимаемся двумя вещами мы разрабатываем опыт соус гибрид уж тебя xezer & firewall это tempesta vw это так называемая при конечно деревья контроллер которых принципе можно говорить что это продвинутый в боксе готов больше общих нагрузки и средства защиты кликаешь на уровне и 2 вещь которую мы занимаемся это кастомное сатурна разработка в басе в области баз данных и высокопроизводительных приложений частности мы уже четыре года разрабатываем вов который упомянут в гарем и конзи beauty мари тебе и как он можно найти наши по чем вообще говоря мы никогда не планировали забацать вождь и биокси готов мы когда давно начали с разработки модуль машину обучение для защиты от сложных типов de dos атак и когда стали подбирать под форму на который может запуститься сказал что нет нюансы neoxe гад буду творящего по производительности для того чтобы из и запускать машин обучением давайте посмотрим какие есть как устроен наш тебе под силу ни какие у него есть проблема вообще как оно устроено внутри здесь на схемке показано простой пример как сажаем пойду не могу пользоваться у нас есть три клиента у них есть разные по такого они используют htp 10 ешьте p2p 11 соответственно почти должен принимать на вход все эти соединения в частности шифрованное соединение дальше у него есть ферма до конца веков между которыми он должен понимать запросы севера периодически падают вот как центральный сервер и сильва могут быть разными какие-то могут во-первых обрабатывать больше запросов другие меньше они могут запускать разные логику и так далее надо равномерно загружать ресурсы для того чтобы у нас какие-то ресурсы не поставив какие-то не оказались перегруженными какие здесь проблемы во первых на предыдущем слайде линки с играми были разные толщины это в принципе можно сказать что разное количество соединений то есть каждому серверу мы обычно держим достаточно много соединений параллельных и вопрос как много мы должны выбирать соединений когда их переустанавливать и так далее у нас ops 3 мы иногда резать от соединение сами иногда они падают то есть у разные-разные случаются проблемы надо с ними как-то бороться для того чтобы бороться этим проблем мы должны держать внутри очереди сообщение с этими очередями сообщений давай нетривиальной работа сами по себе алгоритмический и пока метки тоже потому что их на цифры и сделайте на чтобы это все будет свою работу проблема о том в том что если у нас какой-то up stream сбросил соединение либо вообще упал то что нам делать можно ли нам все запасы взять и период по вид на другой up stream либо же нам вообще надо взять ответить клиенту что ничего не получилось и вернуть ему ошибку у нас вообще говоря очень двигайте с очень дорогое по всему не и сама по себе и тело с долг не только потому что там дорогая криптографии но есть еще проблема которые привносится само по себе шифрованием и у нас появился недавно относительно недавно аж теперь два который тоже привносит свои проблемы кроме самого шифрованием я нем самом конце расскажу во первых давайте по connection поговорим у нас в целом в целом мы можем на каждый запрос которым мы по базам через прокси установить новое соединение с бантом установить соединение перебросили запросы и сакаи соединения так вообще не говоря никто не делает сейчас все вообще беда стараются или по меньшей мере имеют возможность если они делают это в дефолте держать приятно и соединение с сервером у нас например в яндексе есть пул свободных соединения мы можем сказать сколько соединяем максимально можно держать свободными и если они все занимаются индекс создает новые соединения и потом они вытесняются tempesta устанавливает и держит постоянное количество соединений я попозже пока покажу почему и если соединение сбрасывается сервером то мы тут же пытаемся постоянно видеть новое соединение чтобы удержать наше нужное количество соединений соединение у нас для того чтобы были постепенно и чтобы они долго жили они должны быть тёплой соединениями вот на второй строчке показано строить типичный хедер кипу айва 5 секунд я ж таки булаев либо по моим есть тысяч запросов вот поле макс это сколько запас может быть передан по этому соединению кстати по дефолту всегда довольно низкое значение имеют и поэтому резать соединений достаточно часто и пальцы есть она вязать мы уже писал переустанавливаем и если у нас все соединения заняты вот понятие заняты соединение нового силы вов разная то мы создаем новые соединения нам от никуда не уйти смысл удержания большого количества свободных соединений может быть показать что это совсем зазря но на самом деле если мы посмотрим что у нас произошел резкий наплыв посетителей либо к нам пришел diedas то время на установку большого количества новых соединений может пойти достаточно большая задержка и соответственно нам хорошо бы иметь никто по visiting ресурсов на сучье резко возросшей нагрузки здесь на графике показано миг-маг который мы делали у себя внутри здесь вот 27 тысяч разных вариантов плюс-минус engine.exe наше tempesta здесь интересно увидеть следующее что вот скачок team 1 как она падает по производительности с ростом количества соединений соедини здесь логарифмическая шкала у нас очень сильный скачок униженных сон более плавный но все равно между пиковые значения мы до него где-то там в июне вот 500 12 до 2 тысяч соединений и когда мы выходим на 30 тысяч соединений весов пике он 600 описав 600000 чипсов показывал то на 32 тысячах уже показывать 500 500 то есть где то 20 процентов производительности мы теряем если мы установим слишком много параллельных соединений соответственно если для того чтобы у нас наша фирма максимально быстрого acrobat у нас есть некоторые оптимальное количество соединений естественно поскольку сама по себе аж типичное соединение она передача запаса и получения ответ это синхронной операция у нас есть задержки в сети ей задержки в оба году не в совке то у нас есть ограничение контент то есть получается что если у нас например восьмиядерный машина то нам connection of нужно там и 8а намного больше то есть вот надо же на 4 ядах с восьмью хоббит ведами оптимально начиналось количество единение то там свыше сотни сходством количество дней здесь на графике показано количество и пасов но и очень сильно возрастает в этом сегодня си может на каждый запрос позависать вазы соответственно в зависимости от того что для вас для вашего а при кришна важнее в пенси либо попустить больше количество и пасов коли оптимальное количество connection of к вашему аккаунту она будет меняться что делать при connection газетах и при падении серверов ну во первых я уже сказал что по дефолту engine.exe hdd они очень часто рис эти конечно каждый столько стоит запросов будут переброшены насколько понимаю то достаточно старый ставлю на свете старых времен видимо это делалось для того чтобы бороться с с динамическими приложений которые текут по памяти там делали repack а чтобы до процессов и так далее сейчас нет причин для того что так часто резать соединения в того что если сервер произойти суде это нам достаточно просто взять и установить это соединение это будет опираться и легкое в принципе понятно поставим если сервер упал то у нас уже все не так плохо у нас появляется вопрос вообще что случилось сервер мы не знаем в каком состоянии он может быть вообще недоступен по тисе пи то есть например взял выключилась машина и все либо link попал север может быть само что птс сервер может упасть то есть не будет аж теперь запасов может само приложение сломаться она может теперь сервисы не найдет свой динамическом динамический контент то будет отправлять ошибки либо даже само приложение может не больна ответа выдавать генерировать соответственно у разных серверов в этот health check он разный то есть смысл в том что во первых мы понимаем но вмешиваю понимаем семантику приложения то есть не просто даем клиенту то что нам удалось получить пытаемся поанализировать и второе что если мы делаем с check the когда к нам приходят пользователи моего отец уже готовым уже свою очередь под упал вышедшего из строя segara то нам не нужно перепланировать запросы понимать о том что вот на самом деле сервер что-то не то вину и там что то делать нас приложение будет работать быстрее и запроса давать соответственно газа имеют разный механизм сыщика наверное hop hop я за я знаю то что сделано в комплексе что в джон exe к прокси точно есть поверка вплоть до валидации самого тела ответа в engine.exe не уверен но там есть в обоих есть точно поверхность и connection а проверка статуса ответы и так далее в темпике у нас сейчас пока мы работаем только на том что получили не получили аж тебе ответы и его статус косяки мы чуть позже сделаем больным был pipeline идей папа на заключается вот в том что показано на рисунке с его у нас вообще нету pipeline а то есть отправляем запрос получаем ответ ну вот в таком число нам режиме работы папа нам позволяет сразу отдать на север много запросов и подождать их ответ в принципе это хороший оптимизирующие техника она доступна нам ваш цепи и на самом деле фокси в основном и и не использовать то есть я знаю только от трех примерах которые используют squid полипа и мы тоже используем пойманы то есть насколько дженкс точно их не имеет хоп обще по моему тоже не знаю других вот из популярных в обсе лифтом типа по что фиксирует vanish и используя не попали по моему нет соответственно дальше чуть посмотрим что пай планы позволяют нам мультиплексе вы сообщения то есть сообщение от одного клиента может быть если они пришли нам pipeline amp очка не могут быть возложены по газам сивилла но наш вообще должен говорить что он соберет корректную последовательность ответов и от поэт это все вы последуете клиентам проблема с pipeline нами наверно почему большинство серверов его не реализует в том что у нас возникает ряд проблем 1 проблемы то что делать собственно с этими пайпа новыми сообщений можем ли мы их период править как понять вес у нас мы отправили тысячу запросов всех его как понять что случилось его мысли он упал на каком запасе он упал и все или ином запросу ему перри отправлять и бы не при отправлять есть проблемы с безопасностью ломаются никто типа оссификации и мы подвержены и ну нет нет нет не то что мы становимся подверженными но сон редактировать атаку теперь испанский think которая нацелена webcache джексон я не чуть позже расскажу еще одна интересная проблема что клиент на самом деле может нам вообще не говорить ничего о длине своего запас то есть он может нам позвать пост не написать ник они длиной этого поста не использовать какой-то шанс войн coding для того чтобы сказать чтобы мы могли как специфицировать его длину и просто закрыть соединение соответственно при pipe они мы не можем просто взять и вот как есть такой запрос придать потому что у нее не длины все что мы за пай по ним за ним будет читаться как тело этого запроса соответственно мы выходим и ситуацию тем что мы к таким запросам добавляем контент links и соответствие можем за папа не такие запросы а так response прийти к так вот сверху показан запрос там в самом начале есть все лев последовательность 0 до 0 i am по этой последовательности у нас параметрам гетто закодирован следующий запрос то есть мы в link передаем другой запрос и к декодируем его соответственно наш на север это все уходит он от все декодируют отдает нам 2 ответа а за этим запросам мы можем позвать еще один запрос например на яндекс хтмл и фокси у нас получит если она не в состоянии декодирует такой get она получит два запроса атакующий запросы нормальный запрос от клиента получит три ответа от сервера но если этот наш общак ешь его счета в центре соответствующую второму запросу индекс хтмл она положит то что получено на 2 закодированный запрос в поле links бороться с эти а так и не так сложно на в принципе достаточно просто редактировать вхождение sega лев йогой достаточно просто можно фильтровать поверять алфавит доступных символов в йога или это также полезно для других типов инъекции типы склеены акции когда мы запрещаем некоторых специальный си вон на стороне вообще мы всегда должны аккуратно мочить последовательность запросов и клиентов то здесь мы с точки зрения фокси получили два запроса от клиента 3 запор ответ от сервера соответственно в этом случае мы детективом что возможно было так а теперь response plaything проблема с папой она в том что если клиент там отправлять скажем пачку из тысячи запросов и в самый первый запрос он является такой атакующий то мы чокнемся о том что нас атаковали только спустя 999 запросов это очень поздно после этого мы паре за этим соединение но тетя имени у нас становится очень нетривиальные нетривиально лойко для того чтобы откатиться до до состояния откатить наш кэш достояния да да это я таки то есть принципе то же самое получается но мы и детективом намного позже это не очень здорово по проблем еще есть не до подобными запросами вот версию есть понятие определено понятие безопасных и до податных запросов и доп ответ на запрос это те которые меняют состоянии htpc например это может быть какой-то пост когда вы постите что-то в свой блог вас появляется на севере новый контент и соответственно если вы отправляете такой запрос дважды то у вас например могут появиться 2 постав боги одинаково хлеба вам первый пройдет второй не пойдет в общем у вас все поломать нельзя допустить чтобы не до потребность запасы вы отправлялись дважды их нельзя pipeline нить как павел не до патент на запор и до патентные запросы те кто безопасно тот гейтсхед из общего с когда мы просто что-то читаем севера ничего не кладем тем не менее в зависимости от приложения ну нам может встретиться какое-то приложение которое делает get зовет какой-то скрипты там на этом скрипте что-то параметрами меняет это место такое происходит это уже ответственность админа о том что он понимает что он делает и о том что в принципе если у него poxy который может pipe они что у него поломается все возможно это тоже причина почему люди на зарабатывающие paxil они используют pipeline и 2 что на самом деле пост тоже может быть безопасно то есть пусть сам по себе он просто отправляет немного в другом видео аргумент параметры на веб-сервер и в принципе он может быть безопасном ничто не мешает отправлять скажем запросы в поиска длинный методом после тоже при конечно специфик соответственно мы у нас есть специальная опция как в класс которые позволяют вам задать какие запросы у вас является до патент менее до пакетными и в зависимости от какого типа ресурсу то есть с мы можем анализировать и для различных ежели вы можете специфицировать какие запасы пакеты какие ней до понтент нам давайте посмотрим что происходит при pipe они с его у нас есть клиент три клиента они отправляют свои запросы первый клиент вторым запросам отпали от нее до пакетный запрос внутри htpc мы держим два типа череде и клиентская очередь тут там она используется для для ада ринга сообщений когда мы отправляем клиенту и в ней все лежит по в том порядке в котором пришел от клиента соответственно там же лежит ней до подобный запрос дальше у нас поворачивается логика бунтовщика нагрузки который определяет какие запросы куда отдать не обязательно что вот все запросов того клиенту ширина 17 они могут как то вес бросаться но когда они ложатся очередь мы ставим не до подобный запрос вместе с другими за запрос мы его по сути отправляем в pipeline то есть мы кладем его в очередь на отправке к северу но северу мы его не отправляем то здесь видно что последние отправленный на север и запад как раз наш ней до подобный запрос все остальные запросы которые пришли на это север поселком нагрузка были отданы они за ждут своей очереди там же могут находиться и дуги не до подобный запрос они тоже остановит трансмишн нам данный сервер в целом если совсем можешь не желатин пай panning в вашем приложении мы теперь позволяет указать длину вот этой очереди северного соединения она может бы быть использует до того чтобы побороть временную задержку ответа сервера то есть если у вас какой-то запрос достаточно тяжелый то чтобы другие запросы подождали чтобы не отправлять им ошибку и второе что это она собственно повляет пайпа нам сколько мы можем забанить если вы не хотите поймать если вы хотите чтобы все работало как в других foxy-woxy по джон x можно просто указать длину очереди яичку и по сути очередь не будет сразу все будет уходить на сером далее соединение в котором есть не до потребный запроса но в целом мы понимаем что очередь который стоит не до падает запас она двигается медленнее потому что там выше синхронность запросов ответов и теперь делает поворачивать сначала полировщик запасов так чтобы найти соединение без нее доплат этого запроса свободный максима у которых моя скорость отправки и если нынче не находит то она тогда уже добавляет в очередь с ними патентом запросам когда нужно перри отправить запрос и какие запросы мы отправляем во-первых если мы пытаемся период править если наш все выложиться мы должны период править наша очередь серверных запросов за за запросов на север и в принципе есть у нас один все вывозится за другим connection to такие запросы могут потухнуть или они могут очень долго лежать в очереди есть опции файтинга ограничивающие количество попыток ресин доу engine.exe у нас они тоже есть в принципе здесь войко ни у кого не отличается есть запросы которые могут убить север то есть если мы что-то забанили у нас один запрос убил севере даже мы не понимаем что делать то есть мы можем все и всю эту пачку переполняют на другой сервер но нам нужно быть осторожными то есть мы не мы хотим понять что происходит сервером поэтому соединение в котовка в которые пришли запросы на период плавку она больше не доступно для планировщик то есть новых запросов мы туда не ставим вот когда все когда мы все запросы отправим то тогда уже можно будет в эту очередь ставить новые запросы второй интересный момент что мы внутри различаем произошел ли connection reset целым единственно быстро переустановили соединения либо же у нас упал сервису по усеивают ум и я вам сразу период павку сообщений на другой сервер если вы папа воссоединение то мы делаем flowering соединение бы с персонажем его и оставляем запасов той же очереди перри отправляем их снова принципе не до патент на запросы и дженкс и мы умеем говорить о том что в принципе не до подобных запросу ничего страшного нету что их можно переставлять можно покрутить эту ручку если нужно проблема с павшими запасами то есть если мы представим что запрос пришел ней до подобный запрос он заполнен упала северное соединение или вообще сего мы в целом не можем сказать что произошло что что произошло соответственно патентный запас мы отправляем на него ответ с кодом ошибки и следующие за ним запросы могут быть отработаны epoxy вам и в основ установлена очередь часть сейчас нас очень слайде покажу схемку следующая проблема о том что вообще говоря если мы держим держим в очереди соединения и принимаем что вот сейчас мы его отправили но возможно нам нужно будет его период память то есть мы не можем просто взять сообщения отправить его и освободить из памяти мы должны выдержать до тех пор пока не придет ответ соответственно нас такой ситуации есть на уровне htp если мы используем pipeline и такая же ситуация на уровне ты себе то есть эти данные которые мы отправляем socket и пока они не пришел отсека от той стороны мы должны держать эти данные в памяти соответственно подобный сервера у них держится 2 копии данных одна копия сами можете посевом удержится 2 копию удержится спи стеком нари трансмишн мы должны эти данные удерживать при для рифовый юнгом это достаточно большой недостаток и как производительность от этого страдает если мы интегрируем like ваш т.п. прокси вместе с ok спс т.к. там и вообще говоря можем держать всего одну очередь и одну копию данных у нас сейчас стойка сделана не полностью есть мы стараемся это делать но вот до конца избежать двух копий нам еще мы ещё не сделали все очень релизе мы до этого дойдём эта картинка том что происходит вот сверху вариант изначальной снизу вариант когда у нас уже завалился нижней сервер и мы делаем рифовый ding сообщений соответственно дальше в очереди у нас стоял вот катенька сообщение 3 мы его перри отправляем потому что у нас есть еще место в очереди отправки ней до патенты запас мы не можем период править поэтому на него мы отправляем не валидный ответ ответ с кодом ошибкой клиенту сейчас у нас на отправку первым и сервис стоит два красных за пост соответственно 1 3 дан когда у нас произошел по зашел flowering мы только кладем в очередь на отправку наш ошибочный ответ то есть мы не делаем фактически отправки здесь у нас работает еще одна очередь отправки запросов то есть с у нас отвёз мы разбросали наши запросы от клиентов у разным серверам они к нам могут прийти в разной последовательности некоторые из этих запросов мы можем перри отправлять соответственно мы можем получать ответы на запросы клиентов в 1-ю очередь очередностью в том числе и ошибочный ответ и мы собираем последовательность ответов в отдельной очереди и когда у нас также по аналогии со ст и когда у нас собралась первая часть очереди мы ее отправляем пачкой клиенту и дальше когда приходит следующий ответ и мы их от поля даже клиенту дальше виды видно что вы там где период павлина сейчас соединения там мы ставим некоторые флажок о том что больше мы туда ничего не отправляем и соединение становится недоступна для отправки новых сообщений проблема с кейсом кроме криптографии нас проблема еще в том что нас больше нет узел копия api linux то есть linux уже давно нам вел интерфейс send file space который позволяет нам делать вывод без копирование можно сделать без копию не отправить файл можно без скорпионе отправить данные из визу space а теперь они нам с этим недоступны поскольку все данные которые нам нужно твое клиенту они должны быть сначала в случае файл мы должны сначала считать наш ответ с диска use space копьем данные из видов use space далее моего шифру им ключом клиента эти данные уникальные для каждого клиента мы их не можем никак закрашивать и дальше мы должны отправить их клиенту и снова копьем и и звезду space a видео то есть то что раньше у нас напрямую отправляюсь операционной системой с диска в socket теперь нам нужно 2 2 2 копирования в usa space и обратно соответственно ситуации это людям не нравится facebook red hat работают над реализации те веса в ядре . анри пользу нас появятся те уаз в ядре на уровне сокетов так называется f кейтель с вот есть ссылка на него суть там заключается в том что так же как в физике вся криптография работает в ядре у нас уже давно в ядре есть вся необходимо картография диаса сели за исключением установки соединения также как в физике мы восстанавливаем соединений визу спейси и отдаем это все на авеню сокета и данные уже могут появляться без без копирования netflix рисовал такой же функционально free bsd мы тоже работаем над лесом мы внесли в и 2 мгц с это очень легкая библиотека ее очень легко внести ведро и почему мы не стали использовать а я аиф кейтель с потому что у нас есть проблема diedas то есть изначально мы забрать проект что как устойчивый к проблеме adidas соответственно у нас есть хорошей кисельные хан шейки нам хочется их по оптимизировать много мало несут главное чтобы получить как можно больше производительности в экстремальных условиях соответственно мы хорошей ки вносим видовое сейчас дело malt нативную реализацию внизу есть ссылка на статью которая описывает реализацию . пешки ps стеком я понял чуть дальше еще расскажу следующая проблема проксирование это буферизация и streaming в принципе сейчас насколько знаю в основном пока буфере зуют все ответы и запросы то есть вам приходят большой ответ от серого вы его накапливайте у себя фаре вот на примере индексом и потом когда поняли что я его действительно вам все отдал все хорошо выделю эти 200 ответ клиенту другой стороны мы можем начать отправку клиенты уже сразу то есть как только нам плелись данные от себя мы можем выдать 200 ошибку клиенту и отправлять данные на самом деле понятно дело что наши степи может отвалиться раньше и вместо 206 ошибки по моему мы отправим 200 это неправильно то есть логика немножко ломается увд инженер это патч на версия дженкс реализовано версия который позволяет вам включить стриминговый режим эту сильно увеличивает производительность и для них а там им имеет смысл то есть иногда это такие вещи имеет смысл еще одна проблема о том что фокси себе во в принципе делают очень простую работу то есть они принимают сообщение передают на шею вот казалось бы по сравнению с аж теперь серверам которым может покачивать разную динамику она печки на чем угодно фокси viva очень простые устройства тем не менее нам совершенно точно нужно переписывать запросы и большинстве случаев когда мы принимаем запрос от клиента и отправляем его северу мы под создаем новое сообщение например нам вот в данный на данном рисунке у нас прибежала сообщение с уже x фаворитов а мы должны добавить наш текущий узел мы взяли создали новое сообщение сразу там все записали заголовка которые нам нужны и отправили северу ну здесь возникают копье нет не очень здорово дали если мы посмотрим на то что происходит все в мире как бы немножко глубже мы во-первых должны поднять наш запрос из океана успею за space мы высчитываем в некоторые буфер собираем дальше мы должны переписать это сообщение то есть выделить 2 buffy туда записать новый вариант и этот буфер снова мы к копьем в виду то есть получается три копии сообщения это не очень здорово во-первых проблема с копированием вторая проблема в том что на современном линуксе на современных картах можно видели что оптимальное количество единение это тысячи для серверов до десятки тысяч или ногах до тысячи десятки тысяч яде у нас не так много там пускай быть сто и один соответственно на каждый на как каждый с-сукин на каждое ядро сервера приходится много клиентских connection of много себе на connection of connection глазные соответственно для того чтобы просто спонсировать сообщение между северным connection ом и сильным connection мы клиентским конечному и обратно мы должны передать данные в пределах разных яде а если у нас одна по собственной машина это очень дешево 2 процесса на я в принципе немножко там коммуникаций между процессорами где то процентов на 10 15 дороже если мы говорим ваших машинах 4 процессорах то мы можем видеть что возница twins данных между рядами одного процесса и и разными процессами будет где то два с половиной раза то есть на больших машинах такие бог себя веду себя плохо что делаем мы в опек мы модифицируем теперь сообщение зил копию в ядре linux есть интерфейс сотенных буферов которые работают с позитивными данными в данном случае мы просто выделяем исходное сообщение на две части и добавляем говорим что первая часть это голова сообщения то есть изначально а вторая часть это будет второй фрагмент а пиво фрагментом будет то что нам нужно вставить и у нас получается мы представляем фрагменты но суть в том что у нас на сетевых адаптерах есть симметрично fading то есть вот такие данные на адаптеры может сам прожевывать и соответствием и адаптеру скала камнем напрямую падме тивные данные и решаем проблему копье не в usa фсб не вижу спасся на нашем прикладном уровне проблему в нашем случае поскольку мы живем внутри спят econom у нас нет копье не мы в принципе можем взять пакет от клиента вот его переписать таким образом без копье не просто сразу передать все одно соединение но у нас возникает проблема того что на самом деле у нас особенно с папой нами у нас получается дуплексное соединение то есть пока мы по ним сообщение sega она приходит от него ответы на огонь и и сообщений у нас получается полный дуплекс и ну во-первых будет может быть проблем адвоката в принципе устраняется достаточно легко но вообще как бы просто быть wog и качать данные между ядом процесса это не очень здорово соответственно мы это случилось с соответственно мы приходим к нашей версии стыка я сейчас хочу давайте неудачен порядок слайдов 9 того чтобы у нас не было такой такой передачи сообщений между ядом и процессора мы заводим быстрый транспорт между ядрами be a free and буфер который позволяет нам если мы должны отправить пакет на удар через на соке который живет у нас на другом ядре процессора мы ставим в очередь на это едва это и до самого сгребает эта очередь и отправляют то есть наша коммуникации между ядом и сведены пасок инкремент у одного качественного аккаунта соответственно снижается поскольку нас более быстрый транспорт между рядами у нас снижается айтюнсе запрос ответ ну и потому больше можем выпустить из себя данных я немного хочу сказать по саму идею того кого того как рисованный tempesta по большому счету она представляет собой подождите 5 стрелка то есть как у нас данные сопи у меня передается на цепи также они передаются наш тебе то есть ps является продолжением с такого по такого внутри ядра linux в ядре linux тпп живет над фильтр который собственно реализует логику и 5 basf его соответственно с одной стороны и мы достаточно быстро можем отвечать на запросы обрабатывать поскольку нас нету очередей нету копье они так далее другой стороны мы интегрируем сеансов и вольную инфраструктуру linux и просто добавляем еще один уровень фильтрации как у вас есть ситуация на 5 вот так вы добавляете еще уровень ситуация наш теперь то есть yandex может это делать далее то тут она чем мы сейчас работаем в следующем ревизию первое что эти пил в ядре linux есть коллектива все вайс для айпи пакетов очень теперь есть собственные требования по кольцу все вас в частности при защите adidas мы лучше нам не блокировать полностью клиенты по ip-адресам а пост придумывать их параметры цепи и второе что развитие языка такого аналогичного как до 5 бас для более гибкой ситуации по цепи два ну во первых нам пойманы сейчас уже не очень интересно ешьте pit-11 потому что появился штыб едва он уже несет в себе pipeline и и что хорошо выше теперь два что у него есть и дефекация сообщение и если мы представим что первый запрос в нашем папа не он оказался очень медленным то все другие запросы могут ждать будет стоять в очереди пока не отрабатываю не отработает первые это называется ходов while walking соответственно ваш типе поскольку он имеет и дефекации он может отвечать на запросы в произвольном порядке мы это можем собрать и такую задержку нас не будет то есть 2 3 запрос будет отработан раньше 1 это замечательно в степи 2 есть криптография в принципе там использовать же с целью что и ваш тебя 11 ваш теперь у него есть еще компрессия компрессии проблема в том что нет гарантий о том что компрессионные данные будут меньше изначальных данных соответственно мы в общем случае не можем сделать compression пояс и компрессия вызывает нам дает нам еще одно копирование то есть мы не можем в режиме easy окопе работать сообщениями hd2 пока мы сейчас htp 2 ч интегрируем мы уже заканчиваем его реализацию того как мы ждем реализацию мы еще будет настаиваться по оптимизации производительности его надо будет переосмыслить те окончании которой есть и может быть на настоящем году я расскажу по hd2 как можно сделать без копирование более оптимально отрабатываешь теперь но пока ощущение в том что для глобальной сети там где у нас основная проблема это сетевая задержка нам интересен наш теперь для того чтобы было синхронность для того чтобы мы максимально минимизировать затраты в сети в локальной сети если у вас акселератор стоит рядом с брендом htp едва может быть не так интересен потому что он накладывает достаточно много ограничений не позволяют избавиться от копирование почем поэтому он может быть медленнее чем масштабе 11 в локальной сети вот у меня все наш сайт он уже где-то год оторваться tempesta падения за этот год не было сейчас мы находимся в technical preview соответственно кач качайте пробуйте делайте фичи request и мы будем рады в боге в своем я часто пишу о решениях которые использую в team песен алгоритмах векторный векторного анализа степи и так далее вот но и буду рад любым контактам поймаю его все спасибо да добрый день спасибо за интересное содержание им вот то что упомянули что у вас стоит на собственном сайте об работаете за своим firewall какие-то может быть можете поделиться кто еще собирается вас использовать и есть он ждет что там что-то доделать прямо сейчас можете использовать ну вот какие то мысли о кто кто еще с вами планирует как тот использовать спасибо смотрите сейчас мы находимся в те кто preview это значит что у нас есть баги даже зайти на give up там будет кэш и в продакшен точно ставить совсем нельзя то есть эти можно поиграться поделать бич марки там тоже могут быть проблемы у нас есть на гитхабе опубликованы результаты биг мак и для того чтобы вы могли воспроизвести как собственно это сделать для того чтобы получить от 18 миллионов запросов секунду на каком железе как сконфигурировать это железо сейчас нас и делают те кто превью блеск смотрит tempesta для интеграции пифом из продукте клауд linux кому с linux то есть мы хотим попасть в дистрибутивы для хостов для таких систем для того чтобы предоставлять сервис общаемся с booking.com может быть в сентябре будем делать пилот ну как бы из главного наверное все спасибо до вакансиях на превью пока это еще даже не пилотные проекты пока техника прививка от упомянули cumulus speak вы разговаривали как то есть какие-то тупик 8 то есть некий дальше я не упомянул что после на дева в апреле мы там общались команды разработки и бпф и люди у людей есть стартап карта который делает твоего на контейнерах виртуальных то есть суть в том что если у вас два контейнера передают данные то есть потребность в ситуации этих данных частности они реализуют htp тоже внутри ядра и из соответственно тоже у них есть интерес в happy for massage т.п. и в ядре то есть там может быть это будет не те к привью может быть будет простое технологический партнер с этими людьми добрый день спасибо за доклад оон у меня вопрос не совсем потом песни ты сказал о том что keep-alive есть и он джинсы и в apache рецепт происходит каждые 100 запросов правильно понимаю придумать по дефолту это там конфигурируем поведение на захарова прокси как с этим делом там это молоко вот конкретно поп я не знаю как он нарезать и соединения возможные резать и то есть на сколько я понимаю что resort соединение будет сделан именно для htpc голов не для плаксий и был сделан для того что наверно может быть там в двух начала 2000 в 90-х когда вы запускает там скажем вот печки который там вам качался там бывал запрос или тек памятью то чтобы там например утечки памяти их там подбрасывать нам как бы в моем понимании это так то какой историческая ганчин который живет в дефолтном поведение но как бы потом лучше точность и убирать ну ну я чаще тогда то что если есть еще может быть проблема с тем что если ваше тело не в состоянии отрабатывать очень много типов соединений то есть у вас много клиентов они все живут skip уловил вам нужно резать эти соединения но это немножко как бы ну да ясно possible здравствуйте и спасибо очень интересный доклад вас там была картинка по обработке пост запросов которые модифицируют данные и там одна ситуация есть прям как a thing вот это да внизу когда запрос встал в очередь у вас отвалился какой-то backend и запрос не обработан в этом случае возвращаете клиент ошибку но очень часто ситуация бывает что запрос ушел в бэг-энд и в этот момент backend молился и у вас на прокси нет ответа от бэг-энда что тогда вы делаете потому что неизвестно может быть он прошел успешно листы какие-то методики для именно эти кейсов осина но но вообще говоря даже если мы синхронно отправляем запрос в очередь то есть всего один запросов поляна backend vacant у нас заваливать свой например отправлю отправляем туда пост который добавляет бог какой-то блокпост на наш иисус мы все она не знаем где завалился бэг-энда того как он успел добавить в контентом записать в базу этот пост или в самом начале пост закончился то есть у нас и она есть состоянии неопределенности что случилось с этим запросам пошел он не пошел по этому фокси данном случае может позвоночника ту ошибку а то что у нас завалилась но мы не знаем и здесь pipeline на мой взгляд не дает никаких худше ухудшений в этой ситуации то есть какой-то меньше по понимание ситуации он не дает и ответим на вопрос наверно да то есть клиент получит ошибку а можно ли делать ретро и на этот запрос это уже его личное дело но да то есть как бы смотрите вот вы пишете что-то на форум да потом газ и получаете не знаю мне бывает такое что я отвлеку то форму у меня там истекает время ожидания мне выдают ошибку но как бы что я делаю я иду снова на ресурс как бы захожу на ту же форму в принципе я вижу что у меня появилась мой контент или не появился и вы отправляете get смотрите состояние и потом уже фомича новый ответ но в любом случае это клиент сам должен определить что ему делать с таким типом запроса первое и второе что администрации сам должен иметь достаточно много ручек для того чтобы получить не эта потребность своих запросов какие он считает недоплаты там и какие-то патентами и так далее хорошо спасибо"
}