{
  "video_id": "c2gsID6MjaY",
  "channel": "HighLoadChannel",
  "title": "Слон желтого цвета и его друзья / Александр Чистяков (Высшая Инженерная Школа)",
  "views": 896,
  "duration": 2752,
  "published": "2017-04-07T15:28:48-07:00",
  "text": "анонсируют доклад от тёмной стороны силы на самом деле Да мы сейчас узнаем о том как работает скажем так как поддерживается один из сервисов нашей дорогой горячо любимой уважаемой Налоговой полиции Всё верно анонсировал Ну да практически Так и есть слово Здравствуйте коллеги Меня зовут Саша я расскажу вам про эксплуатацию дуб кластера Федеральной Налоговой Службы Я надеюсь что все в зале приличные граждане платят налоги Вы можете расслабиться Если вы не платите налоги я об этом даже не узнаю Потому что тот налог которым мы занимаемся называется налог на добавленную стоимость вы его не платить видимо не можете мы его платим когда что-нибудь покупаем в магазине я бы не сказал что она дорогая нормальная нормальная водка Да рабо Работаю я на должности главного специалиста чтобы это не значило это Это означает что я в тарифной сетке где-то там нахожусь да получаю какие-то деньги за это ну и соответственно этот слайд можно пропустить так Давайте с вами Теперь познакомимся среди вас Наверняка есть веб-разработчики один один есть а не один Больше я никогда не понимал а остальные Вот ладно больная тема не знаю Судя по всему Судя по тому что мы с вами находимся на конференции которая посвящена высоконагруженных система среди вас есть разработчики высоконагруженных систем поднимите пожалуйста руки всё тяже лица а вроде вас больше чем ве разработчиков Как так Возможно где-то есть высоконагруженные системы Да я знаю на pH пишите Аксёнов Опусти руки и наверное с тоже приходилось Да работать не стесняйтесь Ага А как же Да мо db с мо приходилось работать признавайтесь Давайте тащите всякую гадость наверное в документации так написано да вот ничего этого не делаем у себя вго по мне не стыдно перед вами нисколько картинка для привлечения внимания для того чтобы вы ощутили мощь тёмной стороны силы Вот видите я снимал это на телефон не скажу на какой Ну это не iPhone Да вы видите наверное что это не iPhone Да там запросы в секунду и внизу вот сколько их запросов в секунду там по милна мл запросов в секунду э картинка отражает погоду в Сахаре мы С такой скоростью считать не умеем это внутренние процессы кластера при перебан сиров они Вот идут С такой скоростью к счастью с точки зрения бизнес логики нам не тепло не холодно что вот они есть но они вот так вот могут Да хорошо когда у тебя есть кластер который может полтора миллиона запросов в секунду вливать хоть и бесполезно но тем не менее я вот похвастался перед вами Давайте я вам сечас расскажу сказочку хотите м скаку хотите Ага вот любой мой доклад это общем история из жизни такая знаете комическая с хорошей примесью трагедий вот здесь тот самый случай Да мы сейчас с вами увидим так сказать комедию и я буду плакать может быть даже ну или вы будете плакать я не знаю как всё началось я сидел дома и смотрел какой-то кинцо Мне позвонили и сказали что Необходимо ехать в Москву я сказал что в общем у меня нету планов далее того момента когда кинцо закончится поэтому кинцо закончился Я поехал в Москву Мы у нас было полторы бутылки Текилы и в общем до Москвы Мы доехали нормально Когда я переступил порог Московского филиала ФКУ на походном проезде вот среди вас есть москвичи москвичи Ага остались немного вы знаете где Походный проезд к несчастью Да вот такое интересное место там налоговый кластер там расположен причём в общем понимании слова кластер и в частном тоже там где-то в подвале говорят стоит стойка нашего железа и там вот как раз то самое что я эксплуатируют если пойдёт дождь достаточной силы и подвал затопит можно понять чтоэто Ну мне сказали когда я ступил порог в меня вцепились вот так вот твой хваткой скали у нас ВС плохо вообще ВС плохо Никто не знает что у нас плохо но плохо всё вот Судя по всему Но на самом деле Да тут картинка даже есть про то на картинке всё хорошо у нас всё было не так плохо Давайте я вам расскажу что же было во-первых было от полови долой ремни именно от компании сиска Ну на то есть причины они так это знаете не технические но тем не менее Вот видите я знал что вы поймёте Я знал что вы поймёте что приятно говорить с людьми которые так сказать в теме Да вот в России не технические причины Ага и все смеяться Начали Ну и что вы себе там придумали интересно деньги кончились поэтому от сиску закупили О'кей А да да вот правильно правильно он Аксёнов знает да да пожалуйста Заплатите налоги нам нужна новая машина и Не та машина о которой мы обычно разговариваем там уже стоял Enter Linux Шей версии потому чтоэто общем логичный выбор когда когда нечего делать ста за это ещ никого не увольняли там стоял я не знаю почему версии 5.2 дистрибутив дуп А кто из вас с клоде работал есть такие ваша боль близ камня и там была большая банда разработчиков с с единым единственным логином с правами Рута которые во-первых меняли всё под этим логином А во-вторых у них был веб-интерфейс Лаурой и они меняли настройки через веб-интерфейс в частности в частности это привело к тому что у них Одна из нот стала считать себя частью другого кластера какого-то второго из одной ноды и было как бы вот все ноды да и ещё одна которая в другом кластере зачем-то Никто не знает Зачем А как его вернуть тоже никто не знает но тем не менее люди решили что так будет лучше а нода Тоже решила что в общем Почему бы и нет продакшн тер Я думаю каждый из сталкивался схожей ситуа это укладывается описание этой ситуации укладывается в фразу всё очень плохо да ну и было собственно зачем всё это нужно-то было Зачем всё это предназначалось было приложение на языке Java и приложение на языке SC А кто из вас пишет на Java пишет или писал Ага есть такие люди а на Скала вот Да отлично есть тоже вот и эти два приложения они так это немножечко конкурирующими фирмами разрабатывались разными Да разными командами разработчиков поэтому Они использовали абсолютно раз те кто писал на Ja считали что правильно будет классическим использовать в качестве базы А те кто писал на считали что это всё прошлый век Хотя в прошлом веке не было никаких Юсов но тем не менее Они использовали спар и формат упаковки файлов под названием паркет Я не знаю я читал описание на паркет и не понял о чем это лучше-то может быть кто О да Зачем Каковы Каковы бизнес-цели Да вот этого всего Зачем всё это надо-то было Ну в налоговых декларациях вот насколько я знаю с этого года нужно подавать налоговые декларации электронно и там в торговых книгах расписывать что у вас за операции были и где вы там кому предв в торговых книгах в декларациях сравнивает и ищет неточности поскольку это достаточно длительный процесс он в последний раз у нас занял часов наверное сем или восемь Это после всех оптимизаций этот процесс происходит в кластере когда нету интерактивных пользователей поскольку у нас часовых поясов наверное штук девять я вот не могу я не знаю сколько в России часовых поясов Я думаю что люди которые работают в больших сервисах они это знают 11 было и два вроде от консли но тем не менее у нас на Рабочей неделе технологических окон не бывает у нас всё время кто-то сидит и что-то делает из интерактивных пользователей поэтому считаем Мы в ночь с пятницы на понедельник соответственно необходимо найденное несоответствие визуализировать Налоговый инспектор приходит на рабочее место и думает ну чем бы мне заняться чем бы мне заняться вот зарплата маленькая Жена дома пилит давайте-ка я найду какого-нибудь человека и сделаю ему плохо выставлю ему налоговое требование вот он идёт в нашу систему и совершает там Клик мышкой и в этот момент где-то Горько плачет разработчик потому что ему необходимо чтобы быстро всё отдавалось да а ПК такая штука которая не предназначена для исполнения интерактивных запросов Поэтому с ней нужно долго упорно биться и мы с ней долго и упорно бились и пока её не победили пока она побеждает нас Ну соответственно интерактивные запросы они должны делаться в рабочее время по понятным причинам То есть получается что у нас есть два режима кластера Да два режима работы кластера это интерактивный и его обслуживает как раз вот эта самая программа нала под спарм и не интерактивный который видимо приди Джов бегает в пятницу Ночью или Weekend ночью я вообще доклад рассказываю все devs Вот видите я такой на самом деле у меня есть даже свой собственный карманный митап в Петербурге для того чтобы как это митап для девопсом так и не пришло за всю историю существования приходят бородатые люди которые FreeBSD администрирование не меняем devs откликнись devops найтись есть в зале devops devs Ага есть девопс отлично Москва Москва хорошее место то есть постойте в зале всего полтора девопса а кто тогда ходит на московские митапы там 200 человек обычно собираются к инженеры Ага Ну вот есть такой акроним да cation это вот четыре кита или слона движени Давайте их обсудим применительно к кластеру Федеральной Налоговой кликер работай кликер Агату ф друг другу по имени отчеству вот так заведено Как видите вопрос культуры у нас закрыт автоматизация автоматизация буква Это потому что кроме нет больше ничего Кто из вас не пользуется не пользуетесь Господи точно Шеф Вы что в каком мы году да безопасность про безопасность надо сказать в самом начале потому что это важно у нас кластер абсолютно защищён от всех ти видов угроз он просто не подключен к интернету туда ничего нельзя внести ничего нельзя вынести Ну официально по крайней мере у нас есть специальные бутлегеры которые умеют как бы файлы туда-сюда качать если их попросить у меня с рабочего места мне мне даже флешку втыкать Бесполезно у меня она не не воспринимает у него списать но зато можно ночевать прямо в филиале я в ночь с пятницы на понедельник ровно так и делаю У меня есть спальник я к сожалению вот фото не приложил у меня есть комната размером со спальник и спальник который вот весь пол занимает и компьютер электрический нагреватель отличная жизнь Я очень отдыхаю там хорошо от всего Потому что когда нет инте всякой фигне Да ну собственно Слушайте а кликер как-то странно работает я не понимаю Вот сейчас ну как это у всех у вас же нет кликера он бы также работал да с НАТО кликер Ну смотрите вот я пришёл меня схватили и сказали делай я начал делать что я начал делать Ну во-первых рый я начал пользователе заводить какие-то конфиги раскладывать и надо сказать что у меня на тот момент опыт использова был года полтора ни разу раньше за полтора года я не использовал команды команда как это обяснить это по-русски будет это команды которые вы хотите выполнить вот здесь и сейчас они у вас одноразовые да однократные вот вообще говоря я ненавижу команды Потому что от них не остаётся никаких следов всё должно быть описано в виде лейбу и ролей но тем не менее здесь иначе было нельзя вот в этот момент я наверное заплакал бы но слёзы высохли уже дальше дальше когда так сказать при вя людям уже запрещено от Рута выполнять всё подряд как это административно запрещено Я пришёл и сказал кто исполнит что-нибудь от Рута будет иметь дело со мной и почему-то желающих не нашлось Ну там со мной Правда ещё один человек так сказать тоже встал и запретим это делать а тот второй человек Он пауэрлифтингом занимается и тоже с ним поспорить никто не захотел мы так образовали административную так сказать команду по запрещению использования Рута нам удалось даже не пришлось пароль менять У пользователя просто люди боялись выполнять чтобы то ни было без согласования с нами после того как мы немножечко зафиксировали ситуацию мы стали описывать ВС в виде пбв и ролей проблема оказалась в том что все накопленные мной до этого роли они не могли быть лся так очень культурно сейчас я Господи как этот кликер она примерно лаудера Вот вот такая вот штука у неё есть веб интерфейс который конфигурацию хранит в пост гресе Слава богу хоть какая-то отрада Да постгрес я очень люблю постгрес но когда его используют вот для такой вот не блогом не менее есть набор параметров которые где-то в базе хранятся в неизвестном нам формате где-то есть какие-то шаблоны которые тоже скорее всего где-то внутри постгрес на основании которых конфигурируется сервисы сервисами сервисами слава Богу задует Super Хотя я не очень люблю Super Потому что люди когда его начинали писать вообще не знали как должен работать супервизор Судя по всему и они это к концу третьей версии только поняли да и то не до конца а тот су который штатно идт в шесто хеле это боль ужасная боль Ну в Лауре идёт более Нови supervisor D Хотя боле от этого не меньше И вот что самое неприятное наверное в лаури это то что конфигурационные файлы генерируются каждый раз заново и имеют уникальный номер они во-первых чуть-чуть разные для всех сервисов а сервисов там огромная гора и один и тот же файл который одно и то же название имеет у него разные немножечко контент для разных сервисов Зачем так сделано я честно говоря не смог понять Ну для того чтобы нам было удобнее да зачем вам одинаковые ционные файлы найте вам пачку разных более того найте вам пачку разных при каждом старте разную в разных местах при этом если вы хотите что-нибудь настоящее такое продакшн сконфигурировать через интерфейс вы столкнетесь с тем что ве интерфейс умеет не всё А если вы даже то что он умеет попытаетесь сконфигурировать вы выясните что если вы вот в таком вот виде принятом мире попытаетесь задать мае количество памяти то споткнётся он скажет что я не могу это разобрать там буковка Ай мне больно у вас в конфиге ошибка и значение это надо задавать в байтах Сколько байт у нас помещается в Ир Кто знает Вот смотрите среди нас есть образованные люди приятно поговорить с образованными людьми так вот было бо 4Б отдать И в этот момент лауде настал конец Я просто понял что дальше откладывать нельзя я её выбросил но внимательный слушатель может спросить а зачем зачем этим людям больше 4 ГБ понадобилось в лаудере в настройках контейнерам ипре Дьюса вы знаете у меня нет у меня нет вежливого ответа на этот вопрос я как-то решил что devs культура Да как бы вот разработчики и они Друзья должны быть Да Все такие дружочки дружочки поэтому про разработчиков Я сегодня не буду говорить ничего вы сами себе всё можете представить Да вот по отдельным так сказать выделенным фрагментам в докладе вот зачем-то этим людям Нужно больше 4 гиб на контейнер Я не знаю Кроме того один из разработчиков мне сказал что ему нужно более 200.000 открытых файлов на одной машине я подпрыгнул на стуль Я сказал дружище Как бы как он сказал у нас в компании так принято у тех кто работает с клауде я молча просто пошёл и посчитал количество открытых файлов у меня даже деся набралось Я сказал что Извини дружище вот 200.000 не будет то есть я мог бы это не проблема всё равно столько не откроешь но мне просто за свой собственный мозг обидно немножечко и за тех людей которые возможно потом придут и прочитают эту настройку Они же назовут меня каким-нибудь культурным словом А я этого не хочу никуда поме Да ну в итоге как же мы так сказать в борьбе человека клаудер победил человек мы описали конфигурацию при помощи сказа что вот у нас есть уникальный номер 5378 Это означает что у нас конфиг на тот момент сгенерирован был 5378 раз в продакшн кластере Я не знаю они его насиловали наверное Зачем как вот тем не менее 5378 оказался последним я его зафиксировал залил после чего загасил ве интерфейс вообще чтобы не было у человека возможности ловли ручонками мы это называем накликать себе беду чтобы человек не мог накликать себе беду Вот И в этот момент Выяснилось что лаудера она такая знаете Касперский её должен определять как вирус Мне кажется потому что если веб-интерфейс оторвать то сервис клауде при старте берут и конфигурацию стирают вообще Ну потому что А зачем вам конфигурация без интерфейса очень удобно Я пожал плечами и сказал больше как бы с каталогами известными дела не иметь работать отдельно и знаете у меня получилось в этот момент как-то облегчённо вздохнул сува Я тоже выкинул и заменил его руй руй программой которая называется я её очень люблю знал Какой какая стоит машина у процессов когда они сервисами работают Какие состояния правильно должен сервис проходить Если бы эта штука ещё не на Руби была бы написана вообще был бы Космос А Руби Ну ру Да без Руби никуда Ну видите я как это грешным делом состою в церкви метрик среди вас есть е люди которые состоят в РК нету никого чтоли вот правильно есть е адепты найли у вас получаса чтобы поговорить о так сказать нашей Вере Да нужно будет с вами как-нибудь отдельно нас Правда мало адептов придётся какую-то боевую магию применить Ну какую боевую магию Мы обычно применяем я в первую же неделю работы через безопасни пронёс Конте ВМ когда это увидели они сказали Ого какой большой файл А когда пимки заносил они говорили слуша А что это у тебя такой тут логи Ну то есть я вам хочу сказать что безопасность на высоте вот на страже налоговой как бы стоят серьёзные ребята Как только я показываю человеку настроенную фану он моментально становится адептом chch of Matrix вот также было и в этот раз они её увидели и всё их было не оттащить за уши от графана да И в этот момент Мы помним Да что конференция называется Хало этот момент мы внезапно столкнулись с халом Дело в том что когда вы настраиваете дуб hdfs распределён ную файловую систему то в большой Толстой книге написано что удобно Удобнее всего дисковую подсистему организовывать так чтобы у вас дуб сам следил за дисками Не надо никаких рейд массивов делать не надо никаких контроллеров ставить Вот Отдайте сырые диски в ходу всё будет красиво и эту часть документации люди которые ставили ходу прочитали хорошо поэтому у меня было 11 дисков в машине один из которых был системным когда я принёс LX контейнер он естественно попал на системный диск когда туда полились метрики со всего кластера а в кластере у меня 16 узлов каждый из которых 40 ядер имеет и е у меня на большинстве узлов по 11 дисков полилось столько что это системный диск из Я не знаю это даже не красная зона Наверное это эта зона должна иметь Название но я его не буду произносить вслух 100% загрузки диска вот реально полочка 100% дис был занят всегда и ко мне стали приходить разработчики которые всё это безобразие видели И говорили у нас плохо работает кластер я говорил кто вам дал право голоса у нас хорошо работает кластер Вы что не видите что ли на считает же он считает Но оказалось что как бы я оказался дураком потому что Несмотря на то что hdfs лежал на своих замечательных дисках логи он писал на системный диск и он не успевал у меня один из узлов не успевал тупо из-за того что ему надо было логи писать он в таком помрачения вот хочу логи записать Но блин не получается у меня полторы секунды у меня на операцию запи долго поэтому поэтому не понимаю почему никто не запустил его в стену этот кликер поэтому мы взяли внедрили Open tsdb Open tsdb логичный выбор когда у вас уже есть hdfs у вас уже люди потрудились и кластер развернули и вы не хотите никакой второй кластер разворачивать рядом потому что вы уже устали вы лучше этот собственно говоря Open tsdb Что такое Open tsdb это проск такой на Java Серви который висит и по интерфейсу принимает нчи с метриками А дальше он умеет эти метрики заливать в hbase в базу данных всё прекрасно кроме одного графана умеет работать с Open db но когда человек который вот а вы кстати пользовались фано когда-нибудь Да вот Круто молодцы Используйте фану графана - это вообще вещь вот когда человек после того как он виписки Интерфейс Да гратовски в фане поиз учал там ВС классно ВС работает прекрасно там есть агрегаты полезные вообще всё хорошо когда ему показывают интерфейс для работы с Ну мне не изобразить то лицо которое бывает человек этот момент когда вот когда человеку дали сначала какую-нибудь игрушку Да вот ребёнку подарили а потом отобрали Вот это проб я не могу плакать все сы выпл но тем не менее Вот здесь я заплакал Да но сдерживая превозмогая боль я нарисовал графики очень было тяжело людям объяснять что же я нарисовал на графиках потому что график для памяти получился реверсивным у него занятая память отображалась сверху а свободная снизу четыре раза Повтори эмм сху занята память с не менее поскольку у нас культура в организации я и пятый раз тоже готов повторить А здесь бы нарисовали график загрузки процессора за последнюю неделю и что мы на этом графике видим Мы видим что у нас кластер то не догруз когда больше 50% процессора занято и это очень нехорошо потому что кластер должен считать но вот тем не менее как-то он у нас не очень считает Да вот мы тут видим что двенадцатичасовым какой-то период когда был счёт и видно что вот в момент счёта Ну там около 50% всего занято поэтому проблема производительности Она перед нами встала остро сейчас мы да время поговорить про жадность вот в той части книги большой Толстой про установку дупа до которой коллеги нета система дож сбалансировано в магазине диски пихать в одну машину у Вас как бы дисковая подсистема Ну не должна работать Да здесь видно что у меня диски практически никогда не заняты я не знаю видно или не видно Ну должно быть видно видно вам Поверьте мне на слово что больше 50% пиковых загрузок не бывает никогда причём 50% бывает на системных дисках А на дисках hdfs не бывает вообще ничего ког там Тила все ну пото что 11 дисков - это много вот я здесь нарисо боле бой риод и Да вид вот те вот всплески которые мы в нача там видим это как раз системны дис Они у таким зне цветом нарисова видите я не принимание о зап ну вобще ние о закупке очно техническими ми не принимается ска должности не положе поэтому вот вы так как вы с дисково сист нет после чего по идее проблем не должно быть ни с ЧМ с сетевой подсистемой проблем тоже не было никаких Почему Потому что у нас десяти гигабитная сеть Я даже графики рисовать не стал сетевой подсистемы А с чем же вы можете спросить а с чем же были проблемы Да это кстати тоже пока не проблема Это отказ диска Видите вот то о чём я говорил вот там на одной из нот месяца наверно полтора назад отказал диск Я не знаю какими буквами написать в техническую службу заявку на его замену Видимо очень большими потому что ну с другой стороны hdfs очень умная вещь он просто поснимали кация так сказать тройная репликация у меня на этом диске уже ничего живого не осталось его можно там вынуть и выбросить например но не знаю тем не менее с целью демонстрации того как устроена устроена дисковая подсистема мы этот диск не стали вынимать вот не знаю можем себе позволить Да у нас их много поэтому он в таком статусе будет ещё долго возвращаемся к разговор о производительности видите ли сува так замечательно настроен что он три раза пытается перезапустить сервис а потом отказывается это делать дальше Ну потому что зачем вам работающий сервис если так сказать три раза если не получилось должен прийти дяденька мантр и всё поправить дяденька матр пришёл через 2 недели после того как у нас вырубилась 11 регион серверов из 14 и всё работало на трх без потери производительности в этот момент внимательный человек должен понять что происходит вообще что-то не то когда у вас простите я не знаю 111 это наверное больше чем 23 даже да я не математик не могу поделить но тем не менее у вас большая часть кластера не работает а программе ВС равно Да время задуматься А что же происходит и мы начали задумываться мы обратились к разработчику Ну разработчик в ответ сказал что я пойду пооп зру поскольку нас в разработку не пускали сказав что ребят у нас и без вас проблем хватает вот у нас как бы одни одни как бы так сказать квалифицированы разработчики хватало ват Давайте экс решил посмотреть А что же я могу сделать на благо Федеральной Налоговой и есть такое понятие называется оно локальность данных это когда у вас вот на картинке я нарисовал Да что у меня вот она выражается числом от нуля до единицы Ну либо процентами Да от нуля до 100 вот у меня локальность данных здесь идеальная единица у нас она была равка в момент когда у вас регион сервера база Да часть базы стоит на том же узле на котором часть распределённой файловой системы hdfs Да hdf и это позволяет регион серверу читать деды не через сеть А через unet который в специальном каталоге открыт когда регио сервер видит что он вот с данным с данной локален он будет считать напрямую У меня локальность бы абсолютному нуно я полез разбираться и разбирался наверное неделю пока индеец зорки глаз не заметил что у меня по-разному называется сервера у меня в HD на дедах везде имена длинные Да а на регион серверах везде короткие символьные имена А как бы короткое имя оно длинному то не равно Да оно как это если наивно сравнивать через strcmp какой-нибудь или как его там вве А в это просто если Чере нифи поэтому я это обнаружил был очень горд собой сделал стар и после рестарта почему-то стали использоваться короткие имена Ну это магия какая-то Я не знаю я перезапустил у меня все имена пришли в норму невозможно объяснить можно только запомнить на самом деле просто не надо пользоваться длинными именами Когда вы они сделали по уму так сказать надо значит в внести имена они должны быть длинными конечно же зачем вот только непонятно После того как я перезапустил я ещ запустил comp всех таблиц результатом обычно является увеличение локально данных Отлично всё классно результат нулевой вообще одинаковость атно в Лах погрешности разница Я не знаю почему так я так сказать От отчаяния полез проверять А есть ли у меня нативные библиотеки через которые собственно говоря вот это вот локальное чтение делается через unet в библиотеке на месте но тем не менее оказывается нас обманывали все эти годы не нужна Вам никакая локальность данных если вас если вы сидите в кластере fns У вас есть сетка 10 Гбит но тем не менее Надо же что-то делать программа работает медленно Ну как бы знам много лет писал на jav и я знаю что в Джаве если процессу послать сигнал quit то процесс не выйдет Как вы могли бы подумать А напишет на стандартный вывод свой кдам просто вот все все потоки какие есть они свои трейс туда напишут Как работает вообще движок вы знаете Вы не поверите он работает примитив нейм образом он стартует огромное количество jav процессов ход подаёт им какие-то данные и со стандартного выхода забирает какие-то результаты ну либо процессы сами знают где что прочитать и что-то посчитать Да важно что этих процессов стартует огромное количество поэтому мне пришлось для того чтобы посылать этот сигнал написать скрипт на баш хотя и не люблю это делать я написал скрипт на баш и рассылал собственно Сигнальщики jav процессом у меня в логе падали эти сэмплы раз в секунду и я просто вручную очень быстро я нашл что у нас постоянно к метаданным идт обращение из нашего клиента который вот счёт делает А метаданные вообще говоря хорошо кэшируется у вас обычно регионы не переезжают туда-сюда по кластеру и можно с хорошей точностью Ну считать что вот регион остался там где его увидели н наза если он переехал м приви в кэш Я сказал людям так сделать они так сделали и стало быстрее но Быстрее стало Ну не знаю процентов на пять может быть на 10 после чего стало видно в сэмпла что проблемы где-то уже внутри алгоритма мы стали видеть на процессоре какой-то вот разработчики код уже не не обращение в HB ни какой-то сетевую работу не запись на диск А вот счёт ну как и должны Да мы должны были увидить счёт потому что мы занимаемся счётом у нас кластер считает в этот момент в этот момент опять-таки индеец зорки глаз предположил что вот когда мы говорим о параллельной работе У нас вот эти вот маленькие кусочки части алгоритма они должны работать за примерно одинаковое время так Вокруг среднего Да болтаться Это говорит о том что алгоритм хорошо параллели Да что он параллельно написан можно взять просто блокнотик и ручку и записывать из ве интерфейса ярно средние времена и максимальные только на основе этой информации можно сделать вывод о том а хорош ли алгоритм Хорошо ли он зади зайне да Хорошо ли он Сделан вот я здесь нарисовал тот кусок таблички который Ну пугающе просто выглядит видите у меня есть этап который в среднем длится 3 минуты 11 Секунд а Максимум 2 часа 41 минута 41 секунда Но это Победа конечно Тут против такого как бы эксплуатация бессильна что улучшить сказать вернуться в прошлое и заставить его учиться напарах в институте и или как Я не знаю как быть что можно предпринять но в общем так или иначе Вот на это место я разработчикам указал не знаю поняли они меня или нет Видимо я был может быть недостаточно культуре надо будет повторить пока пока Изменений нет пока вот у мерико переко ве Давайте повторю е ещ раз ваш алгоритм который вы запускаете параллельно на кластере он должен параллели он должен быть параллельным иначе вам не нужен никакой кластер и вот Это всё объясняет это объясняет Почему у меня умерло огромное количество узлов А я и не заметил да потому что работал только один всё равно фактически Да все стояли и ждали пока пройдут 2 часа ри почти часа Ну да я спал в мешке при этом да Ну редкий доклад редкий доклад в наше время обходится без упоминания докер как мы дошли до Докера вообще когда я пришёл вот есть куча машин и все они образуют продакшн тестово ничего нет то есть тестовых машин не было мне сказали надо сделать тестовую площадку единственный вариант сделать тестовую площадку и ничего не сломать это взять докер докер хорошо изолирует надёжно одни процессы от других вот в это я верю я решил что ну во-первых ногие считают что я евангелист докер хотя я вот в этом докладе это опровергать ну дойдёт до этого дела Ну вот почему-то мне приписывается любовь к докер Ну хорошо раз приписывается Значит надо любить докер я взял докер кликер кликер ай так я люблю тонкие контейнеры Я люблю когда у меня один процесс один контейнер так советуют от так в общем кажется наиболее правильным так работаем Мы если в тонкий контейнер рассадить наших зверьков из хадуп стека выясняется что стандартная докеров сеть Когда вы порты пробрасывается скажем той частью которая ярн ярн не понимает как это так когда у вас есть внешний какой-то IP адрес который пробро на вас когда ваше собственное имя мапи непонятно Во что и у вас как бы фактически по два IP адреса он просто не может образовать кластер в такой сети поэтому сеть Мы решили взять на базе open the Switch Open Switch написанный энтерпрайз людьми для энтерпрайз системы в Ной системе работает как как я не знаю как плохо работает вот он хорошо что он в предсказуемые моменты берёт И падает если бы он в Случайный моменты делал бы это я бы не знаю у нас бы не было никакого тестового стенда а он зависает только когда вы новую карту сетевую добавляете в Бридж я научился эти моменты детек и хочу сказать огромное спасибо специалистам Федерального казённого учреждения потому что из них прекрасные удалённые рабочие руки Вот они делают ровно то что им говорят делать быстро качественно и наверное не очень дорого то есть говоришь Уважаемый набери пожалуйста команду и человек пойдёт и наберёт команду вот ровно ту которую сказали и получит ровно тот результат который Ну не знаю Да нужно просто нельзя ему давать так сказать пищу для ума важно чтобы он не мог думать чтобы он вот ровно то делал что ему говорят у нас идеальный контакт с ними на эту тему Я научил людей вот чекать заниматься вот этим вот вот этим вот так сказать вот этой ручной работой да назовём это так пройти проверить как сеть работает в контейнерах Итого Зачем же мы вс-таки приспособили доке нам ВТО ши хотя мы просили их но вот было две сечас приехали е две но они пока стоят и курят и на этих двух тестовых машинах Я совершенно изолированно систему на базе докер контейнеров развернул главное на неё не дышать потому что как только люди пытаются что-то с ней сделать особенно если не по моей инструкции там такое начинает наступать у них сеть вообще отваливается продат из контейнеров какие-нибудь вот стеклянное нечто его очень тяжело в продакшн так сказать в продакшн какой какой Продакшен может быть когда у вас не работает сеть даже в тестовой конфигурации Оно такое очень фреджа Да его не наклонять не трогать ничего не менять Я хочу сказать что конечно докер немножечко разочаровал на у меди которые до того не знали доке те доке наступает Они говорят нет Докера нам не надо Ну и последняя буква в нашем км акронис шеринг с рингом всё отлично Я тренировал коллег из московского и Петербургского филиалов почему-то высшее руководство решило Что за п за 3 дня можно научить чему-то людей люди были в УЕ этого предположения рах 5 40 часов 4 часов я людям рассказывал к концу недели у них в голове была настоящая каша А я я я да я я смог разобраться сам как работает Я теперь знаю какие процессы внутри происходят Как зачем почему как он устроен во всём разобрался коллеги по-моему покидали здание Нифига себе он умный Хотя это сложно Хотя мне кажется что это наоборот очень просто но тем не менее Вот искусство донести до людей путём культурного общение знания о том что hbase - это просто мне недоступно я решил что я сделаю набор дистанционных лекций каких-то с практическими заданиями чтобы люди могли руку набивать на этом Да вот так сказать дёргаю по-разному это чбе хотя мы с ними вместе они у себя дома это видео просматривали это очень мотивированные коллеги надо сказать я се не представляю чтобы я какое-то видео дома просматривал без звука и пытался разобраться что на нём вообще А я ещё там знаете ошибаюсь буквы не те печатаю комментирую это как-то культурно Вот Но тем не менее тем не менее это состоялось и мне это очень понравилось потому что я видел фидбек Да вот Казалось бы государственная организация кто там может работать тем мене заинтересованы и в тот момент когда нужно было смотреть на меня трагически и кивать потому что я вот говорил что Ну вам же приходилось эксплуатировать Oracle и они так с болью в глазах кивают да да нам приходилось вот Ну я в общем-то готов сделать выводы Какие Я хочу сделать выводы федеральные проекты - это это круто Это очень неожиданно Да что в федеральных проектах есть жизнь что там есть кластер Слава Богу что ничего кроме дупа на рынке бесплатного софта для этого не бывает и они в общем не ошиблись с выбором софта потому что выбор из одного элемента он как бы как предопределённость потому что больше ВС равно ничего нет вот недавно залип надо будет посмотреть Ну и как как так сказать говорили наши друзья большевики знание и сила знание сила а что-то могила Окей я всё что хотел сказать вам сказал спасибо"
}