{
  "video_id": "h4VKMRE3m5g",
  "channel": "HighLoadChannel",
  "title": "Мир. Восход. Эльбрус. PostgreSQL / И.Космодемьянский (Data Egret), И.Чижевский (НИИ \"Восход\")",
  "views": 3040,
  "duration": 3758,
  "published": "2018-01-16T13:28:19-08:00",
  "text": "Всем привет Меня зовут Игорь Я представляю Восход Мы хотели бы рассказать об опыте миграции крупной государственной информационной системы на свободное программное обеспечение и на отечественное аппаратное обеспечение в частности на сервере на базе процессору помогать мне будет Илья космодемьян ком это крупного проекта скаже пару слов Спасибо Ир это такой на самом деле глубоко любимый мной жанр потому что пока мы рассказываем как мы помогаем клиентам сами Ну как-то степень доверия может быть не та когда мы так вот вместе рассказываем о том что происходило это конечно уже другом с и соответственно наш доклад сегодня будет из таких ТХ частей мы будем рассказывать про саму систему Игорь будет рассказывать Мы немножко поговорим об орсе вообще использовании его в регулируемой индустрии в госсекторе в крупном бизнесе и какие сходства различия с энтерпрайз в этом деле встречаются Ну и на самом деле будет рассказ про то как Open Source успешно был внедрен Какие проблемы с этим возникли какие вещи были непривычные по сравнению с и немножко расскажем что же мы по этому поводу всему думаем только вот немножко выдохнув после того как всё произошло Итак мы начинаем Да я немножко дополню тебя Илья речь пойдёт не только про внедрение Open Source но и про такое первое крупное внедрение отечественного аппаратного обеспечения в крупной достаточно р системе а для начала расскажу что такое система мир система мир - это система миграционного и регистрационного учёта или как ранее она называлась система оформления изготовления контроля паспортно визовых документов нового поколения так вот сложно э система которая призвана в первую очередь помогать и осуществлять оформление выпуск загранпаспортов и Других документов нового поколения а также осуществлять их пограничный контроль э значит В этой системе собственно мы буквально вот начиная с прошлого года проводили работы по то что сейчас модно называется импортозамещения и в общем-то успешно их провели То есть у нас вот с 15 мая система работает уже использованием отечественного аппаратного обеспечения и с использованием свободного по Open Source работает в общем вполне успешно значит о ЧМ расскажем расскажем сейчас кратко о том Из чего состоит система предысторию её некоторые особенности некоторые её ключевые значит моменты расскажем о том с чем нам пришлось столкнуться при миграции системы на свободное по и на иное аппаратное обеспечение очень непривычное расскажем о том Значит чего нам удалось добиться и расскажем про подрез который собственно мы использовали в этой системе на нестандартной аппаратной архитектуре для начала кратко о системе мир Если вы оформляете себе загра паспорт нового поколения с микросхемой с отпечатками пальцев Вы обязательно с этой системы столкнётся Когда вы придёте его получать подавать заявление Вот ваше заявление пройдёт через вот эту систему у Вас примут документы через эту систему изготовят паспорт и выдадут вам его на руки Система состоит из множества компонентов есть центр обработки данных который находится Ну физически на территории нашего предприятия не Восход есть территориальные объекты это объекты Министерства внутренних дел собственно которые принимают заявки у граждан и выдают паспорта и есть ещё ряд других компонентов сейчас я кратко про них расскажу Ну Наше предприятие занимается разработкой программного обеспечения и занимается эксплуатацией центра обработки данных основного В этой системе софт мы делаем как для центра обработки данных так и для территориальных объектов значит система как я уже сказал оформляет изготавливает и осуществляет разные другие операции с документами нового поколения которые содержат в себе микросхему планируется причём в ближайшем будущем также внедрить не только загранпаспорта нового поколения которые уже давно достаточно Работают но и другие документы нового поколения Ну здесь я так подробно сейчас я думаю не тема данной презентации Т как яже сза есть цент обработки данных который находится у нас на Восходе и вот в котором мы как раз провели Вот это пресловутого импортозамещение есть территориальные объекты есть собственный удостоверяющий центр есть центр персонализации располагающийся на госзнаки есть специальные объекты такие как российский проверяющий центр и орган криптозащиты связанные с информационной безопасностью чем примечательна система система развивается с 20056 года ну первый запуск был в 2006 году Вот первые боевый паспорта были выданы настоящие и от начала врем то есть вот с 2006 года система в территориальной своей части работает исключительно на линуксе причём Linux там установлен в том числе на рабочих местах и был установлен ещё в том самом 2006 году работает на Свободном по и по сей день и свободное по в ней его Объём увеличивается и увеличивается единственное где его изначально было вот недавно оно было заменено коммерческое ПО на свободно Это как раз был центр обработки данных также система примечательна тем что соблюдаются полностью требования высокие по информационной безопасности Ну поскольку это государственная система и она не простая система То есть она призвана оформлять паспорта выдавать их гражданам и проверять паспорта то требования к информационной безопасности высокие курируют нас в этой части две проверяющие организации два регулятора это ФСБ России и встк значит в системе также с 2006 года Это был такой достаточно новый в общем-то первый опыт применяется везде электронная подпись то есть любые действия операторов которые осуществляются Ну юридически значимый Да конечно если он там подвигался юридически значимые действия они все подписываются обязательно электронной подписью индивидуально каждого оператора Ну и теперь ещё система примечательна тем что впервые запущен в опытную эксплуатацию Пока ещё но настоящий центр обработки данных на Эльбруса на отечественных процессорах Ну кратко расскажу собственно что было у нас в центре обработки данных и что стало то есть что на что мы поменяли были у нас фреймы IBM System наймах работала классическая Да чит для функции баз данных работа для функции гарантированной доставки сообщений и для организации очередей внутри приложения и работала IBM тили для задач мониторинга для задач э организации работы службы технической поддержки и так далее Что стало как я уже сказал стало отечественное аппаратное обеспечение это серверы на базе эльбрусовна торы Это российские э межсетевое экранные средства обнаружения вторжений некоторые другие компоненты на этом оборудовании Мы запускаем в первую очередь постгрес и цеф как средство хранения данных ну постгрес для хранение тех данных которые необходимо индексировать и по которым необходимо осуществлять какие-то поиски значит Ну в общем для которых нужна собственно база данных и цеф для хранения двоичных данных по которым вот эти задачи поиска значит построение отчётов сортировок и так далее они неактуальны для функций гарантированной доставки сообщения используется Active MQ и ris используется для организации очередей внутри приложения обеспечивающие подсистемы мониторинг организация службы поддержки также были заменены на свободное по а именно на закс для целей мониторинга и на отрс для организации работы службы поддержки служба поддержки кстати тоже работает на нашем предприятии на Восходе работает также 24 на 7 Кратко скажу про наше прикладное по оно написано на Джаве Ну в общем что в общем также является Вполне себе свободной платформой в настоящее время в качестве контейнера более свободно Да в качестве контейнера сетов используется там ну и в некотором роде уже стандартный стек поверх него То есть это СН в качестве объек реляционного Маши для организации там некоторых некоторой логики приложений и так далее ну в общем стандартный jav Ну вот кратко Я изобразил на схеме здесь что у нас было до того как мы провели импортозамещение также Вот здесь можно отметить что есть ещё вот ленточный накопитель который нам доставлял очень много бо Потому что его необходимо было использовать для архивации прим для архивации баз данных и для архивации некоторых отдельных данных самого приложения но чный накопитель в исполнения IBM во всяком случае для фреймов - это такая очень очень-очень особая Вещь Вот и много разной боли она нам в общем доставила и доставляет э кратко расскажу про серверы архитектуры эбс э и про то что мы на них собственно запустили Эльбрус - это Ну пожалуй единственные в своём роде процессоры которые проектируются в России и которые годятся для того чтобы использовать их в качестве серверов у нас в России есть также другие разработки по микропроцессора но они больше подходит для различных встраиваемых систем там бортовых систем и так далее то есть действительно мощные процессора которые у нас есть это Эльбрус Ну вообще говоря удивительно в принципе что они у нас есть потому что процессоры которые год для работы в качестве серверов их вообще ну в мире делает там весьма ограниченное число компаний проектирует вот оказалось что у нас в России тоже такое есть значит архитектура процессоров собственная Ну как известно это вли То есть она схожа с архитектурой inum Ну Единственно Только inum свой в общем-то похоронили уже практически полностью раз промышленно они бывают однопроцентное от Intel AmDm и так далее ресурсов у компании производителя существенно меньше объём заказа естественно существенно меньше процессоры которые сейчас также промышленно выпускаются это четырёх ядерные в основном Также сейчас находится уже в опытной эксплуатации не у нас правда у производите пока восьми проекти шети ядерные процессоры значит если рассматривать сервер архитектуры то в общем-то это максимально возможное На текущий момент Вот импортозамещение да потому что когда говорят вот мы там поменяли Oracle на там пог Ну отлично работает он всё равно на x86 в лучшем случае да Значит производится этот процессор проектируется там известно где известно кем если говорить про информационную безопасность да то здесь тоже опять-таки вопрос очень много потому что ну всем известно что например используя там даже в выключенном состоянии некоторые особенности работы Южного моста в серверах архитектуры Intel можно значит Достучаться до там чуть ли не жёсткого диска там да до там каких-то кусков оперативной памяти и так далее Ну это тоже тема отдельной презентации и в общем-то отдельного разговора сечас не об этом ре производ проце сожалению потому что у нас нет производства 65 нмт которое вот достаточно для того чтобы производить вот настоящий серверный процессор производятся они в Тайване но в то же время системные платы которые на которых собственно работают Эльбрус производятся уже у нас в России на нескольких заводов причём даже А насколько я знаю значит э софт который мы запустили на брусах и собственно что там есть Ну там есть обычный Linux Debian по-моему седьмой Если не ошибаюсь естественно собраны под эту архитектуру с ум всех особенностей архитектуры А их там достаточно много там свой аем свой компилятор оптимизируются частью процессора в составе этого дистрибутива которые вот подб есть с всеми полагающихся Раде и отка устойчивое кото Мы также использовали Мы также использовали как я уже говорил для организации очередей использовали Баку для средств резервного копирования для мониторинга для организации связи с удалёнными объектами Ари для телефонии внутри системы и собственно для того для чего он предназначен рает на Эльбрусе его в принципе достаточно много и в общем-то собрать если оно не сильно завязано на аппаратную часть да или там на ядро Linux можно Ну практически любой софт это мы в общем-то сами в этом убеждались и неоднократно там всё собирали компилятор там Вполне себе там ДЦ совместимый когда мы переводили наше приложение и наш цот на Эльбрус Мы конечно же столкнулись с большим количеством сложностей и проблем Ну сейчас я попробую кратко про них рассказать с теми проблемами которые столкнулись и как мы их собственно решали приложение прикладное которое вот у нас работало наком суровом рке да то есть там оно использовало соответственно двухфазные транзакции так называемый протокол Но она очень сложная и очень Тяжеловес Да она интересная когда работает вот но как бы в принципе наме оно как-то работало Да вот с одной стороны с другой стороны она очень сложная и Тяжеловес и когда мы попробовали запустить это на постгрес а тем более на Эльбруса Да которые Ну пока ещё Конечно они медленнее чем Intel тут в общем-то чудес конечно же не бывает а поняли что это в общем-то путь в никуда и оставаться на этом Ну просто нельзя э причём на самом деле если говорить про двухфазные транзакции и говорить Вот про там хвалёный энтерпрайз там и хвал вот вендоров из там трх букв двух букв то вот например как раз в реализации двухфазных транзакций в ibq как-то мы нашли ошибку причём нашли Её Ну не специально А так получилось и из-за этой ошибки которая произошла на продакшн системе было напечатано онное количество лишних паспортов достаточно большое государству ущерб материальный вот и это было такое скандальное разбирательство ABM причём проблему эту признало Но как это бывает всегда в энтерпрайз ответственность они никакую не несут Да они выпустили там патч фикс через там месяца два или три вот а до этого ну Делайте что хотите Разбирайтесь сами полезно заметить что авя очередь она в корпоративном мире где очереди любят одна из самых лучших ещ Да она действи одна из самых лу менее значит проблемы там тоже есть ошибки тоже есть и значит ну уровень поддержки он хотя и там поддержка была закуплено у в общем-то достаточно высокая большая да но тем не менее В общем проявила она себя не могу сказать что с лучшей стороны вот двухфазная транзакция теряя поддержка вообще отдельная боль Мы про это ещё скажем это ещ скажем отдельно да потому что это большая боль значит двухфазная транзакция из приклада нам пришлось убирать Ну на что мы их меняли меняли естественно на свою собственную реализацию потому что собственно потребность в том чтобы брать данные из двух или там более транзакционных источников Да например Это база данных это хранение двоичных данных системы хранения цеф и это очередь Да и причём так чтобы это всё не разъезжал даже если вот как сегодня заметил иль я марван выдернула сервер из розетки Вот она всё равно остаётся поэтому это Пока ещё нет это когда в промышленную эксплуатацию будем вводить Да значит задача это остаётся и тем или иным способом решать её всё равно пришлось вторая задача которую мы решали с которой тоже столкнулись когда попытались значит Запустить вот приложение как есть без каких-либо изменений на постгрес и там с использованием всего остального свободного стека то что у бло Прим блов было достаточно много они были достаточно тяжелые это фотографии изображения отпечатков пальцев которые собственно получают от граждан изображение подписи и так далее как любая база данных в принципе блобы не любят пост их тоже не любит и причём как я уже сказал по их не любит особенно поэтому Блоу пришлось нам удалять и собственно для того чтобы их удалить Неда нам пришлось использовать ф Ну в общем-то мы об этом и не пожалели но тоже это был отдельный квест отдельная там большая длинная история ну и наконец самая скажем большая боль которую мы понесли из которой долго нам пришлось бороться это так называемые ситуации когда у нас происходит tion в базе данных Ну что имеется в виду предположим У нас есть некая транзакция в нашем прикладном приложении которая сначала обращается к данны что-то из неё допустим Читает потом допустим что-то пишет а потом что-то делает не связанное с базой данных Ну например как вот у нас было нарисовано обращается к криптосервер предположим чтобы верифицировать электронную подпись которая там есть в пришедшему сообщений очевидно что верификация электронной подписи э операция она Ну потенциально может быть длительной если у нас Особенно большое сообщение То есть например для больших сообщений она может занимать секунду особенно если там криптосервер или криптосервер они загружены в этот момент у нас получается э транзакция которая висит в базе данных занимает ресурсы баз данных и э занимает К тому же ещё и конек от базы данных ну ресурсы в широком понимании То есть это и память и значит Connection и там много чего ещё э когда Таких вот висящих hle and transaction становится там много Ну то есть там больше определённого порога ну вот или я скажу там например 20 там да если 20 - это уже Да это уже сильно плохо это уже даже когда одна висит долго это уже плохо Да даже когда одна висит долго это плохо когда их 20 то это совсем плохо и если IBM дебету на мейнфрейм она ещё как-то там такие ситуации прож проглатывал достаточно легко то постгрес на Эльбрусе такие ситуации уже проглатывать не может Ну тут Важно сказать что на самом деле корпоративный софт А mame - это такой самый главный корпоративный софт в этом мире и и хар на самом деле это железо тоже одновре техническое решение оно всё вме приб ленной экс бывает кода срочно Когда нужно реализовать что-то к лайну к очень суровому там другие дедлайны это несравнимо см Да мы говорим вот когда приходит в серьёзную эксплуатацию нуте те за паспорта выпустили и не так тут как бы такой соломки но просто тут вопрос такой чем лучше джип Чем дальше за трактором Да потому что до поры до времени можно вот это вот вещи перекладывать на дебету а на самом деле переписка на открытый Исходный код на Ja там по и так Дале она эти косяки находит и ребята Их оперативно исправляют на самом деле очень важный такой момент многие такие проблемы приложения они находятся за сч того что бы более требовательна система тому коду разработчики пишут Да собственно код поэтому пришлось переделывать как раз как Сказал Илья и как раз самое большой Объём работ был связан с переделкой вот этих вот историй с длительно висящими транзакциями их разбиение на отдельные маленькие кусочки которые как-то взаимосвязаны между собой ну с какими ещё проблемами столкнулись по это не2 черты по сравнению с db2 это Например в db2 для фрейма не было mvcc вообще вот просто то есть там Это суровый блокировок и вот значит делай с ним что хочешь по - это всё-таки полноценный версион с одной стороны это хорошо и позволяет там значит очень многие вещи в логике приложения упростить с другой стороны по ряд SQL команд рят Ну скажем так приёмов работы которые были допустимы в db2 Да он уже делать не позволяет и их тоже пришлось переделать определённым образом дальше с чем ещё пришлось столкнуться Оль брус - это всё-таки деби но он со своими приколами скажем так то есть иногда там обнаруживается что пакет собран например не так как в дене или там что у него там ини скрипты работают как-то по-другому или что у него там данные или там конфиги лежат не в том месте где обычно а где-то там в другом месте Ну и так далее просто По мере того как он внедряется в эти самые в крупные бизнесы в индустрию государственно нарастают всякие требования которые разработчики там реализуют и эти требования зачастую совершенно как бы могут быть нам непонятны Да почему там один юзер может такой процесс запустить а для запуска другого процессора процесса нужен другой тип юзера там такие вот вещи Ну тут проблема в том что Эльбрус со своей операционной системой там до определённого момента Ну собственно до нашего первого крупного внедрения он работал только ну скажем в Танках на него написали там одну программу вот эта одна программа одним человеком написана Вот она там свои полчаса отработала и ты больше её не трогай э как только мы запускаем полноценный цот который работает в режиме 24.7 естественно требования уже начинаются другие не просто как там к вычислительной системе А уже как к полноценному комплексу э в частности с чем мы ещё тоже очень долго воевали И нашли там много очень разных проблем это когда мы запускали цеф на Эльбрусе потому что цеф - это штука такая весьма высоко нагруженная и нагрузка идёт и на дисковый под систему и на процессор и на оперативную память и значит ядро операционной системы тоже активно участвует когда мы его запускали в ядре операционки было обнаружен ряд багов причём таких которые там завешивать систему перегружайте мы очень долго эти проблемы ловили но в итоге все выловили надеюсь и значит Ф В итоге у нас заработал как такой ну самый высоко нагруженный компонент собственно основной объём данных именно по количеству там байт прокачивается сейчас именно через цеф в системе также стоит сказать про аппаратное обеспечение Эльбрус - это там не то что оборудование там из двух там из трёх букв различных венро Да даже не другие отечественные производители которые на x86 тоже дела у нас немало железа эбс в том числе делает там свои корпуса делал там делает свои значит компоненты управления питанием внутри сервера и так далее да да Есть есть один прозрачный мы вот на одной из конференций его тоже привозили показывали Ну там свои приколы свои детские болезни например то что там у одного сервера красная лампочка означает что диск вставлен у другого красная лампочка означает что диск отказал Ну значит у одного провода питания с одной стороны у другого с другой стороны и так далее вот ну здесь стоит отдать должную производителю Что значит ошибки все эти признаются и по мере возможности производителям устраняются оперативно достаточно помимо эльбрусоид российские коммутаторы сетевые компании тех Прим там есть медные так и оптические коммутаторы в томс же не ВС глад пробле с прошивкой бывают и совместимость моду с самими коммутаторами и так далее но тем не менее Вот они есть и значит они работают значит импорта замещение Да настоящее то есть не так что вот на бумаге там Да действительно в реальности это в общем не так страшно жить с этим можно то как мы собственно работали с нашим прикладным приложением первая мысль которая у нас возникла у всех возникает что там давайте сейчас возьмём приложение переделаем его на микросервис архитектуру купим побольше Эль брусов значит пусть они там медленные Да там на них не очень быстро работает по сравнению с Ну ничего страшного значит сейчас всё переделаем всё хорошо Ну когда мы начали значит разбира и проектировать приложени в виде микросервисов поняли что так про значит легко выделять какие-то функции которые не используют базу данных Да это просто например там выделить компоненты взаимодействующие там с криптографией Да их просто взял там выделил поднял отдельный сервис и всё хорошо значит если же пытаться выделить какие-то сущности которые связаны через базу данных и связаны там сильно сложно со своей какой-то логикой то сделать это уже просто так не получается и оказывается что для того чтобы переделать какие-то компоненты нужны там ну просто человека год на их переработку плюс как я уже сказал как только мы начинаем делить приложение на какие-то части Ну вот на микросервисы Да которые взаимосвязаны и взаимодействуют как-то между собой то тут же вот эта проблема распределённых транзакций она начинает расти Ну практически экспоненциально потому что как только у нас там из одного компонента который просто работал там через данных себе там и своей части там как-то там они были внутри базы Внутри там одной транзакции как только мы их разносим на Там две отдельные сущности каждый со своей базы данных то эту проблему как их связать транзакции этих двух компонентов друг с другом тоже уже нужно решать придумывать какие-то собственные журналы этих транзакций придумывать схемы восстановления и так далее Плюс То что тоже внесло определённые сложности то что скажем исторически у нас по одной базе данных являтся илп и о то есть у нас была одна база данных и сейчас есть одна база данных по которой и ведётся онлайновые отчётов достаточно регулярное как только мы пытаемся разнести систему на микросервисы то слой надо выделять полноценно надо строить полноценно нормализованное хранилище туда перекладывать данные для построения ОТВ и так далее Что в общем тоже Ну достаточно долго дорого и в общем Ну просто да с микросервисами всегда есть такая проблема вот я как со стороны базы данных могу сказать если вы любите микросервисы и всё делаете на микросервисах это означает что вашу базу данных будет ходить кто угодно то есть надо Быть готовым к тому что вот сейчас это делает клёвая квалифицированная Команда А завтра кому-то придёт в голову внди отдел нанять ТХ студентов чтобы сделать что-то очень крутое но они неизбежно набивать шишки и будут ставить под угрозу всю вашу систему то есть здесь как бы плюсы от микросервисов имеют всегда такой как бы большой довесок Да вот схема которая показывает что у нас получилось то есть вот есть приложение там несколько баз данных Таких вот которые мы смогли легко выделить мы всё-таки выделили Ну хотя всё равно осталась одна большая основная база данных Где собственно весь основной ЛТП и Вот такая вот примерно получилась схема отдельного внимания заслуживает процедуру миграции данных которую мы реализовали в процессе перевода с дебиту на постгрес более подробно про саму процедуру миграции то как мы реализовали и там с чем столкнулись завтра расскажет мой коллегами ВМ же за получилась достаточно интересная сложное и вот во всяком случае на других конференциях которые вот мы значит посещали и когда мы пытались что-то подобное найти в интернетах ничего подобного вот мы не нашли Поэтому собственно и делали сами кратко я расскажу про те требования которые предъявлялись к разработке этой процедуре и которые вот нам в итоге пришлось реализовать требуется трансформация определённых данных при переносе Ну например там какие-то данные в дебету хранятся там одним Тим там да это называется там там Да в пос это называется там нен А по-другому ну и там ряд других вещей особенностей был дальше требуется перенос большой базы данных которая там занимает там д десятка терабайт без остановки процесса Ну потому что Нельзя просто так взять и там на месяц стать выдавать загранпаспорта и их проверять за это никто ВМ разрешит такого сделать Т между таблицами довольно-таки большие сложные там со своим графом причём там в том числе циклические зависимости и перенос данных необходимо делать в сжатые сроки Ну потому что проект тоже не бесконечный он там имеет определённый бюджет определённый срок значит когда это всё должно быть запущено и плюс поскольку Ну это перенос таких критических и важных данных Да государственной важности после того как мы их перенесли необходимо их верифицировать убедиться что у нас ничего не побило по дорог знат не было никаких электромагнитных наводок там не повлияла фаза Луны и прочее при этом значит когда идт перенос данных необходимо учитывать что система продолжает работать данные продолжают записываться продолжают обновляться и так далее и так далее и потери данных при переносе также недопустимы вот о том как э задача Да там уже будет много технических подробно доклад не вмест вот ну здесь стоит сказать что то что мы осуществили переход на Эльбрус и на постгрес это было довольно-таки такой сложный большой большим сложным мероприятием которое мы без помощников бы вряд ли бы осуществили просто так помогал нам в том числе Илья по части как раз-таки постс почасти его администрирования см у особенно рабо Нару и Вотс расскажет более подробно то что касается работы по именно на вот этой нестандартной аппаратной платформе Спасибо Игорь я расскажу На самом деле не только про Как таковой а просто ну как бы такой пример как орное решение кото мто участников нка в разных странах Как оно встречает вот такую вот задачу как очень закрытая система работающая с супер важными данными Какие опасения из этого иногда там возникали и как они были там решены как я уже говорил как Игорь говорил Наша компания занимается поддержкой поса но мы при этом не являемся его производителем то есть мы поддерживаем тот постгрес который делает сообщество накладывает некоторые некоторый отпечаток на нашу работу да то есть мы не можем гарантировать что мы там завтра исправим какой-нибудь патч он будет немедленно в сообществе и внедрен в мейнстрим постс И все кто такое гарантирует они на самом деле как правило немножко квят душой и нам нужно будет это объяснять заказчику который работает который До этого работал см с такими технологиями которые подразумевают нонно а на практике может быть не совсем так какие у нас как возникали опасения от такой задачи когда Ребята пришли к нам сказали ребята нам нужна помощь Мы там с ним мало работали нужно помочь во-первых эксплуатация Тем более что ну представляете да Когда вам говорят Наш отечественный компьютер Ну сразу какое-то такое недоверие Да возникает потому что все знают что там производителей серверного железа не очень много сразу в глазах что-то такое большой какой-то шкаф который где-то там в каком-то бункере стоит Вот и тут естественное опасение Ну хотя на самом деле там вроде как процессор такой более-менее общепринятый по архитектуре хоть и уникальный ну и вроде как работает но всё равно опасение возникают второй вопрос привык ли заказчик работать с Open Source с открытым исходным кодом мы довольно много работаем с разными самыми заказчиками И для нас Ну что греха тать Да мы не рассказываем на конференциях о каких-то наших неудачах Хотя как-нибудь может быть и стоит но очень часто бывает что ожидание у заказчика так скажем обмануты потому что у него в голове были свои ожидания мы чтото разъяснили да Потому что часто Ну например приходят люди и говорят Мы хотим поменять Oracle на pog или там db2 на постгрес бесплатно Это же бесплатное по Значит надо бесплатно поменять или например ожидание такое что может прийти какой-то вендер и в Open Source действительно вот вставить этот патч и он немедленно улучшится а на самом деле такого нет Да мы можем только как-то влиять на разработку этого софта но как бы вот просто взять и на завтра выпустить обновление ну мы просто подсади клиента на венло Да и он потом будет бегать с этим патчем с каждым новым обновлением гадать поднимется не поднимется Ну в общем по факту Так может произойти только замена одной компании из трёх букв на другую компанию там из чуть большего количества букв или наоборот некоторые ваши коллеги так и пытаются делать да на самом деле есть много компаний в мире которые так и делают И на самом деле тут мы всегда будем обманывать ожидания клиента Если будем пытаться такую вещь продать давать поэтому тут как бы нужно так аккуратно проговаривать много вещей что Ребята посмотрите Вот это работает так здесь отличия давайте как бы разбираться Ну и когда этот заказчик на самом деле госконтора или крупный просто бизнес какой-то все эти сомнения ещё больше удваиваются потому что ну исторически когда мы поддерживаем Open Source Несмотря на то что у нас там есть Клиенты самых разных областей всё равно кто уже что-то делает там с постгрес Ну скорее всего они немножко гибче да то есть там другая немножко бюрократия даже когда она есть другие вещи здесь как бы всегда будет опасение Что гораздо это будет сложнее тем не менее Почему первая часть опасений была да про те которые я говорил СУБД очень тесно завязана на внутренности операционной системы на внутренности железа даже да то есть если это платформа со своим ассемблера если у этой платформы маленькая база юзеров да то есть Понятное дело что у интела база юзеров больше чем у броса неизбежно возникают какие-то проблемы какие-то вещи не были пойманы и так далее Может быть там не знаю если это рабочее место оператора где он использует какой-то там веб-браузер с каким-то там интерфейсом это как-то ещё проскочит сфом уже возникли проблемы там уровня ядра Да которые пришлось исправлять с постгрес сом Да это Mission Critical система которую надо глаз до глаз да она плотно работает со всеми механизмами внутри операционной системы наверняка что-нибудь будет опять же Надёжность аппаратного обеспечения даже на том многообразие рынка который мы видим там жёстких дисков дисковых массивов которые присутствуют в мире Бывает плохое хорошее железо и под базу данных для такого критического проекта просто так поставить не лучшее железо это уже как бы источник волнений да то есть бывают плохие жёсткие диски сделанные много где там бывает плохая память сдела много где и даже за огромные деньги продаваемые тут как бы всё вообще неизвестно и мы этого не пробовали а опять же вопрос Насколько качественно работает поддержка платформы производителям да то есть у интела Там многие процессы автоматизированы да Потому что много клиентов Что будет с эльбрусом вот найдём мы там косяк Да за который мы вписались и сказали ребятам что вот мы его найдём мы посоветуем как его там исправлять протестируем и так далее вот мы его нашли кто его будет исправлять Будет Будет ли тот кто Да Будет ли тот кто скажет поправ Действительно ли поправит Сможет ли протестировать тут очень много вопросов на эту тему возникает А и такая вещь тоже с которой мы неоднократно сталкивались не будет ли команда заказчиков в этом месте вставлять нам палки в колёса потому что понятное дело решение принято высоко решение абсолютно чётко мотивировано Понятно зачем это делается ну вы представляете себе там грубо говоря там админа Который всю жизнь отменил дебету это я знаю много таких это очень специальные люди и они как бы естественно немножко недовольны да Ну у них там всё налажено всё работает приходят какие-то эти самые предлагают технологию которая на самом деле технологически чуть ниже да то есть ну как бы надо признать у коммерческих вендоров баз данных много ресурсов они в технику хорошо вкладываются они технологически очень крутые й вопрос Нужен ли этот технологический уровень для каждой задачи это уже отдельная история но тот админ который за этим следит он может быть недоволен да то есть он может как-то высказывать какие-то претензии и нам в этой ситуации нужно будет тратить больше наших ресурсов поддержки на вот эти вот объяснения на соответственно грубо говоря объяснения что вот здесь надо немножко перестроить свои процессы здесь надо там не применять те практики к которым вы привыкли но тут есть один важный нюанс который в данном проекте Мне как раз очень понравился состоит в том что если у заказчика уже есть какая-то культура Open Source или культура свободного по как Игорь предпочитает называть его по завету ричарду стол Да соответственно если есть такая культура то уже сильно проще да то есть в любом случае Хорошо если заказчик который принимает решение о переходе на свободное по уже какую-то подготовительную работу в внутри себя провёл и поэтому когда мы вот там первый раз начали встречаться там с ребятами Да смотрим все работают на линуксе э все в принципе как бы с энтузиазмом пробуют какие-то какую-то такую технику а разработки которые приняты не в корпоративном мире а там скорее в вебе Ну и это был уже хороший сигнал что на самом деле вот тут может быть интересно А первые впечатления были на самом деле гораздо лучше чем я думал да то есть ну как бы поддержка баз данных высокая ответственность мы скептики да В результате чего мы не с энтузиазмом не бегаем за любым нововведением чтобы поставить клиентов иначе бы уже не бегали То есть тут всё очень просто в целом Да Linux как Игорь уже говорил но как бы с одной стороны это хорошо потому что пог и Linux они очень хорошо дружат Да это одна из лучших операционных систем для работы постгрес с другой стороны есть свои особенности в деталях и как бы ну не всё работает Там прям супер хорошо при этом там совместимый компилятор значит как минимум уже можно там рубанком что-то что оно работало самый важный вопрос который тут интересует и технарей и бизнес это ну вот хорошо мы Давайте попробуем всё это вот взлететь с этим ребята там сделали какую-то там предварительную тестовую миграцию какие-то тестовые данные туда загрузили Давайте посмотрим Какую мы нагрузку сможем выдержать потому что все коммерческие базы данных Несмотря на то что они не раскрывают данные о том как у них там по тестам по бенчмарка дела обстоят знат что коммерческие база данных это Уго там на фрейме это огромные ящики они очень быстро работают Ну отчасти это правда там процессоры крутые софт очень давно пишется очень хороший поэтому как бы вот вопрос стоял главный такой и при первом же запуске мы на самом деле выявили много причин производительности То есть как бы был у нас технический доклад на Московской конференции по постгрес в этом году Там много этих прин было перечислено С тех пор там ещё кое-какие причины были и много разных проблем но приятно было что выяснить что во-первых под ИБС OS постгрес является мейнстримом мцст немножко переделан под их нужды Ну собственно говоря любой производитель процессора или Люди которые занимаются этой поддержкой в постгрес они это делают да то есть там есть Прямо такие блоки где какие-то низкоуровневые вещи зависимые от процессора Они под каждый процессор сделаны отдельно нет другого способа это сделать но это не такая вещь как полностью закрытый проприетарный код где половина всего переделана и на мой взгляд для работы с госпроект это такой в России очень большой Шаг вперёд да Потому что раньше метода была такая такое впечатление что за доработку для госпроект он сорса просто навес платили да чем больше строчек кода поправили тем соответственно лучше значит хорошую работу сделали после этого выходят люди которые работают в серьёзных учреждениях и говорят Ну ребята Знаете вы вот там Open Source внедряется А это всё напоминает паралимпийские игры да потому что оно выглядит точно так же как серьёзный софт а на самом деле как бы там там прихрамывает там окошко не так отрендерить и так далее вот здесь то что постгрес майстри серьёзно помогает таких вещей избежать Да потому что иначе бы было так что какой-то там производитель не очень большой он какие-то там под свои нужды правки сделал какой-то функционал привнёс после этого он один начинает поддерживать то что делает несколько тысяч человек активно каждый день во всём мире Да И вот на этом месте возникают проблемы что успеет ли он что-то исправить успеет ли он что-то новое что эти люди сделали внедрить постгрес под эльбрусом в данный момент лишён этой проблемы и это здорово на самом деле второй момент который меня очень порадовал это то что поставщик действительно как бы старается Ну то ли потому что это первый хороший цот но в принципе как бы видно что специалисты грамотные и они хотят действительно улучшить эту ситуацию понимают что у них не массовый продукт не может быть таким качественным как Intel но делают всё для того чтобы этот продукт работал действительно хорошо и это опять же очень хорошая вещь потому что процессы там работают достаточно быстро они пони выстраивать длинную цепочку вы нам сделаете заявку мы вам что-нибудь исправим через год на это време не у кого нет они это делают очень контактно да то есть вот вот специалист с этим специалистом можно обо всм Поговорить то есть нету как бы таких многих слоёв и в этом смысле я думаю что восходу тоже было приятно что см так накоротко общаться тоже нельзя да и то знат его допустит к тебе на расстояни там пушечного выстрела ИТ за это ещ надо будет заплатить там кучу каких-то денег страшных совершенно тут говоря вот о нашей повой поддержке Да которую мы оказывали это было прямо вот заметно да то есть приходят люди говорят Мы хотим поддержку А что у вас было до этого дебету Ну и дальше пони говорим на одном яке знаем она там более-менее номина да то есть это далеко от клиента чёрт знает когда ответит это не очень распространённая система очень много бюрократии в лучшем случае когда ты получаешь онсайт инженера к тебе приезжает Человек способный по телефону говорить со своим коллегой Да это тоже никого не особо не устраивает то есть на бумаге на самом деле написано очень жёсткие там если у вас что случится мы вам пач мы вам специалиста пришлём и так далее те Они ничего не должны И за что не отвечают там наиболее качественный это юридический отдел это правда вот а второй момент который мы опять же чувствовали как фидбек от ребят когда они обращались там и обращаются по вопросам какой-то поддержки это то что вот они спросили живым чатом Да мы можем себе позволить поскольку мы поддерживаем Open Source живой чат с которым там сотрудники говорят друг с другом спрашивают вопросы они видят что с той стороны тоже сидит грамотный человек потому что как бы он не уходит там в слоп на 20 минут чтобы выяснить по корпоративной системе ответ на элементарный вопрос Он сразу это отвечает и отношение совершенно как бы получается другое в этом смысле как бы такая вот поддержка действительно по-честному ориентированная на клиента она конечно там сильно импонирует Я уже не говорю о том что ну IBM большой Казалось бы критический проект загранпаспорта каждого там жителя России либо уже касается либо когда-нибудь коснётся а на самом деле IBM по-хорошему же как бы чувст ну относится к этому делу как к маленькому незначительному клиенту где-то просто потому что они большие Да в этом нет никакой вины это чистый бизнес поэтому на самом деле этот это сотрудничество показало насколько ценно для таких проектов переломить вот эту систему взаимоотношения с вендем и приблизить поддержку к тем людям которые непосредственно работают с системой это такие небольшие впечатления и последний СД своми Да значит э ну кратко расскажу про стоимость владения конечного решения которое наверное всех волнует С чего вообще началось вот импортозамещение в нашей системе и почему было принято решение в том числе использовать иль бруса Ну понятно что э брусы принято решение использовать потому что как я уже сказал это самое большое максимально возможное На текущий момент вообще в принципе импортозамещение которое вот возможно в России да то есть вот хочешь максимально отечественное там железо софт и так далее Вот это значит вам сюда и скажем поводом к тому чтобы начать эти работы было как раз счёт который выставил IBM за там техническую поддержку в 2014 году потому что ну после известных изменений экономических в части там курса валюты Да стоимость поддержки IBM стала не просто большой она стало неприлично большой То есть это там ну я там не готов сейчас называть цифры Но это там л руб за там поддержку фрейма Выяснилось что там купить там значит 130 Эль брусов Да это стенд плюс прокш там стенд у нас полнофункциональный полноразмерный это дешевле чем платить Там просто заплатить за год поддержки просто за поддержку железа там Ита и опять же о качестве этой поддержки качест этой поддержки примы на собственном опыте как я уже говорил там был прецедентный случай когда в общем-то говорить приходится о высоком качестве этой поддержки Ну в качестве результатов что можно отметить Значит уже больше 3х недель мы вот буквально недавно запустили эту историю в продакшн больше х недель цот на Эль брусах работает значит паспорта выдаются если пойдёте получать загранпаспорт он сейчас вот значит пройдёт через постгрес и через Эльбрус совершенно значит по-честному по-настоящему это первый такой опыт в России да То есть первый центр обработки данных на отечественных процессорах вот он поднят у нас он работает 24 на 7 обслуживается вполне успешно если говорить про стоимость значит администрирования стоимость поддержки оборудования Ну у нас вот есть там несколько админов Да там можно по пальцам одной руки пересчитать которые Ну вот в круглосуточном режиме значит поддерживают оборудование и основной софт который работает на Эльбруса Ну понятно есть чит работ своей стоимостью Ну в общем и целом стоимость именно с точки зрения обслуживания и администрирования она принципиально не увеличилось как это странным бы не казалось Ну что у нас в дальнейшем в планах в планах распространить импортозамещение пресловутые на другие компоненты и сегменты системы Ну тут конечно же зависит всё от нашего заказчика от минкомсвязи Ну знат желание такое оно озву Ну и конечно же Здорово распространить это решение на другие важные значит системы государственные в том числе возможное коммерческие в том числе внедрить брусы потому что ну это действительно настоящее применение российских технологий достаточно крупная и в общем-то успешная вот ну и у меня маленькое ещё дополнение в этих выводах на самом деле очень здорово что Выяснилось что гоз заказчики тоже любят умеют Open Source открытый продукт с открытым исходным кодом а то есть это как бы такой очень демонстрация очень хорошего понимание что люди посмотрели что тут немножко должна гора двинуться к Магомету и немножко двинулись и в результате все довольны и результаты соответствующие то есть вот это вещь которая на самом деле именно в рамках конференции webs IT На мой взгляд является очень ценной да то есть это очень крутой пример можете ловить Игоря в коридоре спрашивать как он это смог сделать Я сам до сих пор не очень понимаю вот а второй момент да Что да технологически зачастую коммерческие продукты круче когда это большие компании особенно Но это же играет дурную шутку и поддержка отдаляется от клиента особенно если этот клиент в другой стране и если этот клиент как бы очень требовательный и его большая компания не рассматривает как крупного клиента Ну у нас на этом всё И у нас наверное ещё есть время для пару вопросов Спасибо есть вопросы а привет У меня тоже есть Папочка такая зелёная с номером 094 видимо Видимо Вы уже 130 Эль брусов после после меня покупали У нас тоже есть в офисе Эльбрус купленный скажите а вот про про вопрос адаптации кода под под эту железку а он же влив поэтому насколько я знаю из вот из печальной истории того же умершего э таниути хорошо код работал хорошо бы чтобы программа была оптимизирована под него там перекомбинация исходя из-под совершенно Ну такую непривычную жю нам как бы обыч Артуру потому что мы запустили у нас пока с перформанс Ну работает но наверное можно лучше да давай я отвечу значит если говорить про jav Ну собственно наше приложение оно написано наве Java которую мы используем на абрус её поставляет нам Собственно сам производитель этих Русов насколько мне известно они привлекали для того чтобы Java заработала работала более-менее там хорошо на Эль брусах там специальную команду Это Новосибирский институт какой-то который собственно эту работу и проводил по тому чтобы Java адаптировать именно для вот этой архитектуры Ну потому что Java она в принципе если брать Там обычный хотс двм да ну стандартный клой он в общем-то имеет Ну если там исходники посмотреть Да очень много завязок на аппаратную часть и естественно их Пришлось все переделать доделать и значит с ум тектурмас говорить про наш код то поскольку Он написан на Джаве и в общем-то на джави и работает да его нам переделывать не пришлось то есть мы просто взяли ту двм которую нам дал производитель значит указали на узкие места в этой двм то есть там сделали ряд тестов и сказали вот нам ускорьте пожалуйста вот здесь вот здесь и вот там в основном это касалось там работы с кмм потому что там были очень большие проблемы э там через некоторое время производитель нам двм ускорил и всё стало в общем-то более-менее Ну не могу сказать что хорошо да Но приемлемо Ну значит надо понимать что процессор этот он всё-таки с тактовой частотой пока 7508 МГц те процессоры которые вот сейчас производятся промышленно Там те которые опытные образцы там уже 1,2 1,3 ГГц там и выше но тем не менее это там свои определённые значит накладывает особенности если говорить про постгрес то опять-таки вот как Илья сказал те места в постгрес которые там там написано на там ассемблере да потому что там вот есть например spinlock H файл открываешь там написано там если у тебя там значит Power IBM Power значит вот такую там инструкцию если у тебя значит x86 там или ARM там вот такую инструкцию Там и так далее такие места конечно же пришлось побс адаптировать там ещё в паре мест которые вот там с которыми не справлялся оптимизируют от мцст их тоже там Пришлось поменять руками именно в самом постс Но это с делал опять-таки производитель и таких мест было немного э то есть в принципе если вот брать Ну обычный код который просто хорошо написан Да и не завязан на аппаратную часть сильно то э ну по нашему опыту каких-то адаптаций особых не требуется потому что мы помимо вот нашего вот этого основного приложения запускали также ещё там приложения в том числе на c+ Plus написанные э там с интерфейсом пользователя с графическим Ну там они просто вот мы их собрали компилятором оно там заработало и заработало приемлемо по скорости Вот это если вот код написан Хорошо если код написан плохо да Ну значит надо переписать его и второй вопрос У вас восьмые или четвёртые там ц или че четв на четвёртых пока что да у вас Да ну восьмые Они пока не поставляют ещё промышленным я гол это пока опт образцы вопрос Давайте тогда последний вопрос и на это вынуждены Ну можем в коридор выйти Да и поспрашивайте добрый день Уважаемые коллеги Огромное спасибо за интересный доклад Если бы я был корреспондентом CNN Я бы интерпретировал успешный проект то что первой системой переведённый на Эльбрус и на покс была система выдачи заграничных паспортов они бы сказали наверняка Это сигнал того что Россия со своей стороны собирается опустить железный занавес мы знаем что это это всё всё не так скорее приподнять да наоборот чтобы загра паспорта выдавались чтобы нам не могли их стороны мне как человеку который 12 лет проработал в компании Oracle Sun я с вами потом отдельно поговорю про эту тему я отвечал в том числе за за Анти импортозамещение когда мне заказчики говорили про Open Source я отвечал за платформы СРК савски я им говорил всегда что Ну какой о Source Какое импортозамещение пото что в любом случае Вы будете крутить это на интела и всё равно если будут санкции вы попадёте так или иначе теперь мы лишаем этого это отмазки в том числе но вопрос мой такой Вы наверняка читали наверное с карандашом в руке знаменитый указ Владимира Владимировича его называет 17:30 или указ 203 от 9 мая этого года э ваши ожидание насколько это действительно даст импульс тому направлению которое вы сейчас развиваете которое тельно очень жно с государственной точки зрения Спасибо я к сожалению не слежу за указами Владимира Владимировича Да этом выполня е нета вы его выполняете дамы его не читаем мы его выполняем вс-таки Вы расскажите что это за указ чтоб я более точно смог ответить обязательно почитайте это указ говорит о том что во-первых а определены критические отрасли российской экономики не только которо сказано что преимущество отдавать очистным продуктам второе критическая зависимость от зарубежных объявлено нао национальной безопасности вот ну и про ГОСы в том числе также сказано что если зарубежные компании хотят работать в России они должны локализовать производство понимаем что не Oracle IBM локализовать свои закрытые продукты в России никогда не будет Я читал этот указ Я его просто по номеру не помню я понял Значит Ну ожидание Какое основное ожидание именно наше в том чтобы наш опыт работы с отечественным оборудованием и свободным по был востребован и чтобы те люди которые будут исполнять этот указ помимо нас они не наступали бы на те же грабли что и мы А значит использовали бы наш опыт наши знания наши наработки для того чтобы его реализовывать Ну и конечно поскольку у нас это получилось да как я уже сказал импортозамещение не так страшно это можно Т Да хотя раньше там считалось что Да нет никаких Эль брусов там ничего там не работает это всё там деньги распилили украли ничего не существует Да всё это там я могу тут только в двух словах дополнить что мы просто этот процесс наблюдаем Вот на этом проекте в том числе и тут Важно как бы не перегнуть палку да то есть то что это происходит вот уже видно конкретно насколько это помогает да то есть там в Восходе работают люди которые работают с осом это подст всю там на самом деле российскую экономи и в общем-то это развивает технологии здесь прямо у нас то что Эльбрус получили заказ это развивает технологию здесь у нас то есть тут как бы просто надо не переборщить с люци Мом Я бы так сказал потому что очень опасно превратиться в такую как бы страну чуч процессоров да то есть всё-таки нужно смотреть что происходит вокруг и некоторые иллюзии всё-таки стараться в себе давить и просто там делать там своё дело как Вот ребята его делают например как-то так я думаю что у нас время полностью истекло Давайте в коридоре если кто хочет что-то ещё спросить входите Спасибо да"
}