{
  "video_id": "EPvvJT1lRwQ",
  "channel": "HighLoadChannel",
  "title": "Мониторинг облачной CI-системы на примере Jenkins / Александр Акбашев (HERE Technologies)",
  "views": 686,
  "duration": 2756,
  "published": "2018-08-16T03:57:26-07:00",
  "text": "пока ты мой бы кто-то подтянется вот небольшая история что этот доклад в принципе я подавал еще на летний рид вот тогда там а судьба была не очень удачный доклад не был принц программу вот но зато докладчик с похожей темы докладов заболел и у меня была возможность выступить тестом до комиком и без подготовки этот доклад рассказать вот так что если вы вдруг заинтересуетесь пиратской версии этого доклада вот оно выложено на youtube и канале рид конференции его можно посмотреть как вот это все выглядело там летом этого года давайте начнем для начала вопрос кто собственно занимается так или иначе чаем и сиди в своей компании отлично отлично это очень хорошо для начала немного предметной области в которой я работаю я представляю компанию hell technologies это большая международная компания она хастич человек нас это наши основные владельца авто консорциума в 90 с их бмв головного офиса в амстердаме я представляю офиса берлине в общем мы делаем геолокационные данные так все так что так или иначе связано с картами вот и там у нас есть бэкон сервисы которые по полю сами не знаю фейсбука и amazon у нас есть продукты которые мы поставляем автомобилей у нас есть очень много всяких а ёити девайсов в общем достаточно широкий спектр продуктов которые обладают разными требованиями из этого вытекает вот такой вот я и контекст что у нас нет возможностью локального разработчиков протестировать изменения на всех возможных вариациях и поэтому у нас есть практика что каждое изменение в ходе но проходит предварительную пресса дни то есть перед тем как она попадает мастер проверку при этом у нас есть ну проверку на различных платформах при этом у нас есть требования что фидбэк time должен быть минимально затем соответственно фактом - равно зависит от платформы он варьируется от 15 до 40 минут как я уже сказал нас достаточно большая большой набор торги платформ то есть овес android linux windows queen рексаром так далее вот соответственно для всего этого есть разные тесты соответственно разные компиляторы это все вместе чтобы нам поддерживать нас 6 день кинс master of на самом толстом из них у нас сейчас где-то 185000 запусков в день различных там дробов проектов так далее там есть процентов из них не очень интересно но все остальное то прям настоящий тест и настоящая компиляция вот и где-то у нас 20 тысяч запусков этих компиляций тестов на самых маленьких инстанциях среднем в день и соответственно систем в то есть вот эти два требования то есть вот требования у нас каждый коммент проходит предварительную проверку и есть другое требование требования реальность того что нас очень проблем не проблема очень много запусков да то у нас часто возникает ситуация что что-то идет не так ну соответственно что может пойти не так в случае сиди то есть классическая проблема там компиляция сломалась там тесты не проходит 0 там какие-то проблемы сетью да то есть это более менее то есть чем встречаются все да но когда масштаб достигает там сотен серверов и сотен тысяч запуска в день список несколько увеличивается то есть он появляется очень очень очень много разных вариантов есть это начинает ходить и кликать каждую паши built to midi значение суток тебе приходит там 10 упавший билдов ты начинаешь смотреть причины понимаешь что вот собственно все все что ты все что могло случиться но случается это нормально как бы это обычные будни с кем не бывает вот ну соответственно нужно как-то понимать что делать до ситуации то есть не может постоянно жить там в стрессе того что там у тебя все сломано все билде красный нужно как-то понимать откуда растут ноги где ключевые проблемы и собственном и у нас все основано на дженкинс и как можно было догадаться из заголовка соответственно мы начали смотреть какой то мониторинг sings предоставляет из коробки мы забили в поисковый запрос о сочетании мониторинг дженкинс и вот поисковик су . нам выдал вот такой вот есть какая-то компания который держит хардварные решение и называется дженкинс ну мимо следующая официальная документация дженкинса да вот все еще есть пространство для роста ну и третий вариант это третья строчка выдачи было от мониторе и плагину за тоже не так плохо но обман турне плагин нужно сказать несколько слов тот мы начали думать о том что было бы клево иметь мониторинг который покрывает все наши проблемы в марте 2013 года вот такой был статус-кво его было очень легко установить очевидно то есть нужно там кликнуть кликнуть и вот у вас мониторе plugin не надо было ничего поддерживать том плане что никакой инфраструктура не требует он 2 себе но были некоторые проблемы например когда дженкинс тормозить или еще что-то у вас нет никакого мониторинга пуск на эту страничку еще прорваться надо соответственно моему мониторит он в основном там живем статистики и к тому же только 1 in schools а то есть если у вас не останется софа нужно как-то покликать там туда-сюда очень неудобно и я это решение не масштабируются то есть оно не масштабируется как внутри одного из носа так и в принципе потому что там этот плагин пытается быть вам очень дружелюбным он хранит историю там нескольких упав 30 по моему упавших последних билдов все exception-ы которые у вас есть там три реки все то есть дамп он пытается очень сильно помог помочь в плане мониторинга но он сам как бы является это очень часто причиной того что вам нужен мониторинг вот это было в состоянии март 2017 года вот на статус там нет несколько дней назад все уже чуть чуть получше у него появились внешний источник ок он научился кушать данные в стороннее базы данных то есть там в яндекс например вклад в очереди в графит и соответственно он теперь мониторить не только 1 инстанции можно в принципе получить какие-то данные но тем ни менее тяжело достаточно его поддерживать и масштабировать и не все данные можно вытащить общем в марте 2017 года мы решили ну а чё как бы давайте сделаем наш собственный мониторинг и первый вариант был простой как пробка то есть у нас есть дженкинс у нас есть питоновский скрипт который запускается небезызвестным кронам и собственно питон скрипт пушит в infix все все очень просто пишется зато я не знаю 20 минут делается импорт 2 библиотечка 1 до инфаркта другая для дженкинса мы берём данные из девяткин со по очереди там для каждого элемента в очереди например мы пустим данный в infix все как бы она есть она работает но как бы на этом доклад ли заканчивается вот это решение как я сказал что но очень простое как бы каждый может написать но работало без проблем 18 месяцев до там одного из последних обновлений дженкинса когда они добавили проверки security на это и то есть и теперь надо еще и авторизоваться ну и плюс ко всему у сложно до восьми нас месяц работал хорошо проблему от такого подхода в том что то полинг то есть во первых там сложно поле чаще да можно какие-то события случайно пропустить есть проблема в том что полинг создает внешнюю нагрузку то есть только начиная с последней версией дженкинс этом 285 который выше там две три недели назад а такие обращения к очереди не создают дополнительную нагрузку до этого любое обращение к серьги что изъято из 305 запускала полный пересчет самой очереди в общем с этим будем проблемы нужно было поддерживать очень много одного и того же кода то есть там различные ну то есть понятно что такая простая версия скрипта она очень длинная то есть мы начали добавлять там ретро и механизмы фабрики задержки различные для того чтобы данные не терять и соответственно это вот шло из криптор скрипт надо было ты все как-то копипастить либо выделять библиотеки ну и оказалось что не все эти данные которые нам интересны они в принципе доступность с помощью такого подхода ну и так как я уже отметил это все создает дополнительную нагрузку но мы просидели подумали и давайте сделаем and bass мониторинг как бы ведь если дженкинс как бы у них есть вот ивенты в нем есть эдисон и почему как бы никто тогда их не лагер uid и ведет мониторинг на их основе собственно открыли код дженкинса то есть там вот есть такой транзистор то есть все что может быть запущена дженкинса но как правило доступны через ранди сына кто и достаточно вам ну наследоваться от этого классика да и вы получаете данные вот к четырем видам ивентом это oh completo когда was a built завершился но его статус еще не финализирован он файн-лайн от когда уже все со статусом все очевидно он стартует но соответственно когда запустился бют ну и он долетит когда и во время его подошла концу и время его удалить из истории то есть например вон до лета то можете там подписаться и там я не знаю логе куда-то сохранить там или еще какие-то вещи сделать ну как бы в данном случае мы мониторим основном он финалист потому что как бы днем самые полезные данные для того чтобы сделать этот ивент без мониторинг начали искать если какие-то решений окна fish то есть от груди версию плагина вот в апреле 2012 года он уже умел нормально запускать любой брови код который вы захотите для абсолютно всех билдов которые у вас есть системе таким образом вот он подписывался на ранги станнер и можно было указать что-то я хочу подписаться на он финалист и все содействует groovy код будет исполнен для абсолютно всех билдов дженкинса в наши дни много поддерживать еще несколько или сонаров и то там алиса на которое отвечает за подключение отключения сливов создание удаления настройку так далее любой дроби папки любой сущностью denken sie икон также мониторит очередь соответственно мы его от масштабировались чтобы он работал на 180 тысяч загрузок в день 175000 выполнения этого groovy кода ну и соответственно сейчас позволяет нам и красный класс поста есть вы можете там хранить все они в настройках и дженкинса да то есть вы можете этот группе файл получить куда на диск и просто указать путь до этого группе файлов ну вот код который собственно это все делает то есть вот очень простой мы говорим что ты есть и наш ивент этого он fame lite его и тогда вот мы возьмем текущей build вытащим из него данные про очередь и вот запустим залакируем да сколько мы времени провели в очереди то есть это вот одна из ключевых метрик который отвечает за то я не знаю capacity planning например или за время обратной связи до пользователь то есть если время очереди растет значит системе что-то не так то есть там или ноды перестали подниматься на или там я не знаю кто-то указал неправильный лейбл очень полезной информации всего там четыре строчки кода ну хорошо то есть у нас тут есть какие-то события но как собственно дженкинса эти события пробросить в базу мы выбрали мы остановились на фланге флинн диета такой dispatcher эвентов блок блок блок стримов он позволяет обработать где-то 18 тысяч ивента в секунду на одном ядре что у нас более чем устраивало то есть нас нет больше он десятков миллионов в день то есть нормально он уже имеет в себе имплементацию retrieve буферов рутин гав то есть вы можете сказать что для кайтом хочу попытаться пять раз задержкой которой растет а вот одной секунды до 10 если меня ничего не получилось сбросить данные на диске если не получилось бросить на диск уничтожить их там я и хочу писать туда сюда он очень легко расширяем то есть кот очень простой то есть написать плагин для там единой кого-нибудь вашего к самого хранилища ли там например если вы хотите писать там я не знаю zabbix клик house influx графит тогда летом подобное просто садитесь и там наруби за пару дней пишите вот сам слинге тоже очень простой то есть там особо нечему разваливаться вот и в принципе он достаточно надежный то есть нас за все время не было с ним никаких там каких-то особых проблем но нужно отметить что да у него еще маленьким memory footprint но нужно отметить что он написан на ruby вот то есть я не знаю но что то был на докладе вчера от джова дома да то есть о том что руби там со своей со своей магии да то есть принципе для кого-то плюс для кого-то минус то есть нашем случае мы не получали никаких проблем от того что это руби но я слышал что там рубин может краситься и говорю в нашем случае все было нормально и в принципе можем рекомендовать фланге собственно как поменялось схема работы теперь нас дженкинс девиз он отправляет то есть теперь не так что нас питоновский код забирает данные дженкинса теперь дженкинсом отправляет свои данные френди fringilla же по обработав эти данные отправляют их infix infix показала себя не с очень хочу то есть это было еще до релизная версия до 10 я уж не помню 08 и 09 вот я показал не очень хорошо на большом объёме данных то есть там скажем так исторические данные да и для того чтобы там работать с историческими данными либо делать сложные запросы мы одни и те же данные пишем и в influx и в по отгрыз и делается с помощью одного простого там но ни одного там 5 строчек настроек да то есть а когда мы поняли что нам не хватает данных из дженкинса то есть нам потребовались логин феникса и longhi gm дженкинс ну собственно уф люди есть настройка там у него есть плагин который отвечает аменд этот плагин в качестве им плата можно указать axe услуги дженкинса и там разметить где у вас в access слой какого формата xyz логов тогда он автоматически будет разбивать access логина колоночки колоночки вкладывать графончик и адресочек переправлять дальше и то же самое работает для переживаем логов но вообще для любых для всего того что можно крепость в общем вот так выглядит конфиг который отправляет данные в infix например то есть ключевое слово что от вас когда вы пусть и данные вам нужно разметить каким-то тегом то есть данном случае так говорит то есть все то что содержит в себе в середине ключевое слово и flux пойдет у нас в infix все очень просто а когда она пойдет в fix она будет названо ровно так как у нас на зонтик то есть допустим у нас есть и было а . infix б то полное имя таблицы в яндексе будет а . и не фиг . b в принципе все автоматически очень удобно таким образом когда вы начинаете пусть какой-то новый формат данных френди вам не нужно менять эту настройку все автоматически будет пробрасывать дальше соответственно то еще одна штука которая все автоматизирует это авто tex то есть чтобы в яндексе делать запросы типа в ки равно какому-то значению это такие должно быть тегом в терминологии infix а это собственно делает сесть этом настройка делать все стринги собственно тегами ну и соответственно там минимальной настройке таймс темпов точность темпов так далее то есть собственно это вот реальный кусок конфигурационного файла который вот у нас отвечает за public них данных из friendee в infix хорошо у нас есть теперь винты мы знаем как и те винты донести до базы но вопрос как мы из дженкинса эти винты про бросим в собственных ли венге ну для этого мы написали friendee плагин для дженкинсом собственно он in-house он очень-очень простой суп особенно первой версии первая версия просто брала готовую библиотечку из кушала данные то есть предоставляла api для того чтобы поближе данный потом мы добавили дополнительные свойства то есть например сейчас мы там горит можем слушать автоматически в этом плагине то есть принципе есть дальнейшей денег какие данные добавить вот но соответственно это плагин поддерживает формат но если его путать из груди кода он поддерживает шахмат если пушить пост билда то он поддерживает jison для чего нам нужен был пост бил надеюсь что видно по сбил нам нужен для того чтобы у нас есть это кастомные метрику каких-то команда то есть там команда хочет на этом не пойму 3 размер своих бинарник of или команда хочет знать там за сколько прошли тест или там еще какие то такие маленькие метрики которые характерны для всей совокупности билда в системе а у только для одной конкретной команды и соответственно добавляет этот пост build экшен и в этом пост buildex они она говорит вот такой тотек я хочу запушить в базу такой-то файлик ну и соответственно как бык нужно добавить какие-то метрики от дженкинс и вот их можно сделать из extend отлично у нас есть данные теперь нужно разобраться в тоже с этими данными делать например у нас есть ошибки инфраструктуры то есть то о чем я говорил с самого начала то есть когда у нас очень много всего происходит системе нужно как-то разбираться какие ошибки в каком количестве какие какой приоритет наиболее важен для этого мы используем built on a light on a loser плагин этот плагин у нас позволяет он позволяет задавать регулярные выражения в данном случае у нас там я боюсь что не видно дальше там внизу строчка которая говорит что там докер йеру там ошибка старта контейнера докера в общем там просто регулярное выражение и мы говорим что это вот в случае если ты влоги видишь такие данные то это вот категория инфра почему мы делаем именно так почему мы например не парсинг и это все логе стороннем хранилище потому что нам обязательно нужно посетить налитого 1 чтобы обеспечивать real-time аналитику во-вторых потому что мы производим где-то от 6 до 8 терабайта флагов в день и когда мы пытались и как-то там я не знаю хранители буду отдавать ему с планку на processing это все было очень дорого как как по времени так и по деньгам вот ну и соответственно основная фича лазера это то что она будет подсвечивать так красненьким красиво для пользователей собственно где у тебя ошибка и людям не нужно будет читать блоги у руками клик и так далее это вот код который собственно в груве вытаскивает данный билд failure на разило она лазера и как бы пустит их в фрунзе то есть очень просто у нас тут есть action который хранит данные у нас есть просто цикл for который проходит по этим данным создает карту в которую мы будем записывать данные собственно пушки данные то есть данном конкретном случае мы записываем там где случилась ошибка какой номер билда какая причина ошибки категория время когда это произошло ну и соответственно но да потому что нам очень важно понимать то есть эта ошибка самим бил дом или это собственно у нас например сервера как какого-то определенного типа перестали нормально работать ну и соответственно последние самую строчкам и это все запихиваем fringilla gear который мы до этого положили в текст и вот это позволяет нам делать вот такие вот такой вот например графе чик то есть конкретно на этом графике внизу мы видим распределение всех упавших билдов к блюдам которую пориза ошибок инфраструктуры то есть видно что ты желтенькое то общее суммарное количество маленькие зелененькие это ошибки инфраструктуры то есть в правом верхнем углу это собственно все ошибки инфраструктуры за ним то есть видно когда там дневная активность выше ошибок больше ну это как бы просто из-за того что еще и большие запусков естественно графе который наверно похуже видно вам верхнем углу то разные типы ошибок то есть я надеюсь что там вот всеми синенький видно то что синьки преобладает это вот собственно из за того что ну вот это какой-то тип ошибок на который нужно обратить внимание потому что во первых более-менее постоянный во-вторых он уходит вверх то есть если сейчас что-то там идет не так вот это именно та проблема на которую нужно обратить внимание следующий например очень полезная штука была как я рассказывал у нас тут есть возможность отправлять кастомные статистики и мы начали прыгать статистики по компиляции массу была проблема что несмотря на наши требования нас теперь времени обратной связи как можно меньше то есть там 15 20 минут у нас время компиляции в среднем было уже достаточно большим то есть вот оранжевая полоса не это она очерчивает 10 минут то есть build у нас по хорошим должен проходить быстрее чем 10 минут и видно что очень многие годы в это время не укладывались это происходит из-за того что мы работаем в облаке соответственно нас очень много холодных нот и когда у нас начинается рабочий день до очень много комментов мы поднимаем ногу на ней нет ни кэша компиляции ничего и нам надо надо все это скачать вот и видно вот внизу это графика кэш миссов видно что как там 45 тысяч каш миссов то есть все время нужно было что-то компилировать мы нашли решение этой проблемы но то что я рассказал мы нашли решение этой проблемы что секрет есть там патч для сикоша доступна на гитхабе и вот мы его за год его используют продакшене если у вас есть делаете распределенный кэш и в качестве бэг-энда воспользоваться нам как то есть каждый конкретный юнит каждый каждого исходного кода вы компилируете всего один раз а все остальные ноты получает этот юнит за бесплатно но тут тоже есть такая особенность если каким-то магическим образом вам удалось за фак опять ваши кэш то есть там записать него видны и данные то он бесплатно достается всему кластеру вот соответственно 1 год но у нас по статистике так вот сколько там год с небольшим пользуемся вот у нас 1 год по статистике один раз у нас целый кластер на вернулся из за того что а у нас произошла коллизия каша и соответственно неправильный объект читался и все собственно пришлось вайп кэш ну и соответственно результат да то есть это абсолютно та же самая оранжевая линия то есть она также отвечает за 10 минут и видно уже что почти все точки находятся ниже если посмотреть на график и шми софт my soft он в принципе очень маленький то есть там я не помню как значения если до этого на среднем было 1000 до порядок то теперь порядок там 10 кэш миссов то есть в принципе мы сильно ускорили компиляцию мы стали тратить сильно меньше ресурсов на то чтобы прогнать все это делать соответственно мы смогли уменьшить парк not который мы используем и соответственно сэкономили деньги вот так же нас была проблема с утилизации not то есть мы используем облака дата сейфе tool и вот в этом облаке у нас весь балансировщик и в этом балансировщик у нас следующая проблема то есть у нас ну как завещают нам amazon да то есть если у нас есть какое-то облака то у нас должны быть спайки да когда надо не используется они должны выходить выключаться то есть на этом графике показано что как у нас используется ноты или левый нижний угол это полночь правый там с полночь следующего дня видно что даже в период ночью нас почему то есть там 10 используемых ну да к примеру ну и в принципе спайки достаточно широкий до скажем мы начали исследовать эту проблему и оказалось что балансировщик который используется дженкинс и по умолчанию он оптимизирован для ситуаций как раз локальный кэш он то есть если у вас немного билдов до того вы всегда попадаете на ту же старую ноту на которой до этого запускался данный проект соответственно вы используете весь локальный кэш то есть включает там кэш факт файловой системы но в нашей ситуации это не очень подходит потому что у нас там во первых очень много то есть мы локальный кэш никогда не попадаем во вторых там есть какие-то крон злобы которые там делают всякие специальные настройки эти крон труба приводит к тому что у нас конкретная крон слабо пенится конкретно закрепляется за конкретные ноды то есть грубо говоря у нас настройка того что мы можем выключить надо через 1 час ну и соответственно если чтобы выполняется раз в минуту один час смысле бездействия если джабба выполняется там раз в час 1 минуту та ну вот каждый раз эту ноту грубо говоря про для им то есть очень эффективно ну и соответственно мы не можем остановить ничего и таких вот вот у нас очень много то есть мы рассчитали там порядка 100 not который вот таким образом таким образом остаются на лету соответственно мы написали свой очень простенький плагин который называется secured not load balancer он собственно делать достаточно простую вещь он все билды маппет наиболее старой свободной ноги то есть таким образом получается максимально компактно компактная упаковка агентов соответственно если там у нас были там в пике вот видно что он стал более агрессивный планировщик работать то есть если там в пике у нас было 40 то сейчас пике стало чуть побольше пусто очередь в какой-то момент растет но зато видно что он там ночь ему стали уходить в ноль например радость в принципе билде этой группы не используем потому что те крон 2 бы которые там ночи за задерживали эти билды им в принципе подходили те агенты которые у нас есть из другой группы ну и видно что в принципе как бы площадь этого графика сильно уменьшилась но соответственно уменьшение площади это графика это означает уменьшение ресурсов которые используются на который мы арендуем амазона соответственно мы экономим денежку ну и собственно одна из самых один из самых важных из кейсов у нас то есть как наверное многим известно то есть не не отдельную программный продукт и не является безупречным то есть везде есть какие-то баги и нужно как-то месяц этими богами и жить особенно если вы не можете никак повлиять на их количеством вот соответственно нужно каким-то образом минимизировать влияние этих багов на живую среду то есть у нас была проблема в торгах время от времени мы наблюдали вот такую ситуацию что у нас какой-то java class не может быть найден либо джалла классно сидишь кадырова класса не совпадает с ожидаемой собственное как правило это джорфел am назвали собственно как правило это поведение было достаточно пагубным для системы потому что агент на котором эта ошибка случалось он собственно но очень долгое время но ошибка проявляется в том что на там занимает 10 миллисекунд для того чтобы заселить бил то есть только build назначается на эту ноту 10 миллисекунд он красный и это очень ускоряет среднее время фидбэка но с другой стороны получается так что там 1 2 минуты промедления вас уже там 100 красный билдов собственно начали изучать что это за проблема казалось что это баг в достаточно низком уровне 1 7 kingpin мы туда они не могли подлезть потому что мы использовать там более старую версию дженкинса чем бак минимальная версия для который был fix вот так собственно установили что впервые то есть нельзя заранее предсказать что надо будет плохой то есть любые проверки которые мы устраивали в стартап скрипты ноды они нам показывали что все хорошо да то есть а потом то есть мы чек или там класс своих jar так далее тому подобное но просто как дженкинс тянет зависимости последовательно да то есть как только нужно первое использование от класса только тогда класс будет скачен нашей проверки никак не помогали и соответственно как бы такая проблема случалось только в случае есть там первый билд был прерван в момент вот как раз копированию этого класса то есть в принципе там вероятность не очень большая и и это никогда не устанавливать 107 синодом сломано то оно сломано при этом как я рассказал огромный impact потому что всего лишь несколько миллисекунд build красным соответственно чем больше времени проходит тем больше всего красникова ну и вот в тот groovy скрипт который мы использовали изначально исключительно для мониторинга мы вот так же начали использовать для так скажем рекавери или там минимизации импакта да то есть мы добавим следующий код если у нас ошибка по которой упал build a содержит у нас словосочетания джорфел да если ее имя совпадает с зеркалом тогда мы берем ноту на которой эта ошибка случилась и мы меняем лейбл на дизайн but фаджр hell таким образом только те билды которые сконфигурированы запускаются на нотах dior hellam смогут запускаться это нам очень помогло собственно проблема перестала иметь такой большой импакт то есть она осталась на месте то есть всего лишь workaround в последних версий дженкинса мы в принципе не столкнемся с этой проблемы то есть и вот у нас есть какой показывал график инфраструктурных ошибок и вот график инфраструктурных ошибок dear fellow после этого он там но тон стабильный на старом дженкинс мастере но при этом это один два случая в день не более ну и как бы к чему все это у нас есть много дашбордов да то есть мы сделали вот такой деле дашборд так как мы занимаемся часть ну как мы предоставляем серию соседи внутри компании то есть мы там говорю очень много белков то есть там сумме там где-то 250 тысяч в день и нам нужно понимать flow как у нас все идет и вот сделали себе такой дашборд то есть мы знаем сколько у нас сейчас разработчики за камень законе за к метели изменений то есть сколько у нас сколько у нас сейчас в очереди сколько у нас прошло у нас есть статистике площади самого дженкинса мы знаем сколько у нас сейчас активных экзекуторов то есть у нас число экзекуторов маленькой значит что а очередь большая значки ты проблем у нас с поднятием но казаки ударов если компьютеров очень много очередь сам но большая может быть высота процессить не можем а может быть у нас просто дженкинс умер ну соответственно мы меряем сколько у нас прошло сколько у нас ошибок сколько у нас катку было замёрзнув изменений ну и соответственно водку breakdown то есть мы разбиваем очередь на наиболее интересные лейбл с точки зрения бизнес требований и вот вы внизу там на слайде есть три таблички например это какие но самой горячей ошибки инфраструктуры прямо здесь и сейчас то есть там конкретно светится раньше внутри при кация готовая репликация то есть у нас есть это не то очередь это ожидание китовый репликации соответственно есть графика инфраструктурных ошибок ну табличка то есть если мы видим что там что-то выходит за зеленый нормальный трешхолд то есть как и говорил то есть он в принципе ошибки от нормально то есть когда идет оперирование огромная система ошибки будут так или иначе просто определённый транс холл должен делать то лед или еще что-то ну и соответственно свой список самых горячих сломанных но то есть если мы видим что список загорелся там начали появляться новые новые ноги то значит что все дело плохо нужно срочно куда-то там смотреть и с помощью того что у нас данные все хранятся там в яндексе теперь в graph они не в дженкинс это там у нас и продукт оунер и различные команды они делают свои дэш барды ну и вместо заключения список ресурсов собственно так как слайды будут доступны для публикации то есть они будут опубликованы я думаю жена чернецкая после конференции можно покликать это собственно первая секция то плагины для френди то есть фрунзик поддерживает очень много плагинов то есть как на вход так и на выход то есть можно забирать данные откуда угодно и практически куда угодно и доставлять я не знаю если для cliff house of но для любого другого восторга который был представлен на этой конференции плагины точно есть ну и соответственно для самого дженкинса плагина я уже все озвучивал если вдруг кто-то еще как им и используйте си плюс плюс свои разработки то есть отличный патч pull request для сикорским кэшем то есть он полезен как для разработчиков на локальных машинах так он полезен и вся и кластере то есть нашем случае boost был просто невероятный ну и in free by все знают но на всякий случай я привести у тоже ссылочку на слайде спасибо вопросы да вот вас ваша задача сводится к простому парсинга логов да почему вы не использовали ел каста жалел к стек то есть ну она не совсем сводится то есть как я говорил мы у нас очень много event of the самого дженкинса идет то есть мы эти винты пробрасываем dolphin де френ держат там как dispatcher нам их раскидывает то есть мы сравнивали накладные расходы принципе lk стыка и flinging линги была сильно меньше но и в принципе fliegen грубо говоря там можно было бы для этого использовать и apache кафку в принципе то есть на просто для примера да да да то есть примерно нашем случае но не надо то есть люди ты кому я не знаю одну строчку прописал настраивать ничего не надо но работает из коробки более-менее для всех ну да семена он подкупил своей простотой с точки зрения перформанса требования стабильности но сравнивали как рассылка стеков то есть они все были на одном уровне то есть все были хорошие рекомендации . энди использует google так далее все с не было ни одной причем от него отказываться но посмотрели исходный код исходный код которых хотя никто не пишет у нас команде но рубину исходный код там хилинге плагинов то реально то мере на 20 точек кода и очень просто их писать если нам нужно пусть но у нас есть там my house например статистика да то есть нам нужно путать туда мы просто напишем это плагин чик за там полдня и все но с учетом того что у вас разработчики свои помогли написать и для lk плагин ну нас как бы разработчики то свои есть просто их раз-два-три описать надо много фото нет на параметре тогда еще параметре мы сейчас смотрим прометея батов секс мат один из плюсов людей ног я думаю в котором оси планах скрестить с прометеем правильно угадал ну у нас в клинике как бы в чем его фишка то есть мы можем сказать что ты мы хотим этот ивент стать там в in the influx в тот influx еще в параметре и в под грез и соответственно это всего лишь там четыре строчки там четыре блока конфига да и мы все да мы будем пусть разные места то есть прометеем мы хотим использовать как раз для того чтобы ну то есть вот для ближайших там двух недель да то есть если нам двух недель недостаточно мы там идем в infix смотрим там за три месяца а если мы хотим например делать сложную аналитику мы идем в под брестом месяц войны чуть побольше данных то есть собственно каждому инструменту свое использование отличная задумка спасибо повезут евгений aizawa за доклад вам вопрос такой а как вы боретесь со смертью дженкинс и у меня вот проблема конечно у меня меньше билдов в десятки тысяч вот но проблема такая что дженкинс периодически умирает причем с процесса все нормально то есть он работает но он отдает 500 но украины и непонятные и носите помогают юристах банальный то есть ну что приходит на ум там в крон засунуть там ночью но это подходит если например ну какое-то локализовано например мы разрабатываем только в россии мы можем в часов утра стартовать а если мы разрабатываем не только в россии в разных странах с разными time зонами то это уже проблема то есть мы можем стрелять я понял да то есть ну ладно мы мы мы мы разум то есть мы используем janty мы предоставляем внутри компании ся и как сервис на уровне дженкинса и у нас как бы команда сильно ну то есть компания распределенной то есть там мумбай так далее 18 стартовать не вариант вот соответственно на год назад и делать доклад портал как ну собственно дошли до жизни такой же у нас там 140000 билдов там за 100000 билдов он не падает собственно основная проблема дженкинса это аллокации то есть вот то что вот ваш случай то есть ошибка 500 . всего 2 кенсу мира it в логах фу фу dressy то что называется стоп зе ворлд паузы об этом докладывал по моему как раз здесь же от рогозина я забыл имя из дочь банка вот про особенности эксплуатации джи эм ну и собственно опять вот флинте мы использовали почему то есть флинн гель-лак uplander да он позволяет подключиться колодам живым и записать данные собственно почему тормозит дженкинс то есть ты просто во влогах линги видишь что вот у меня сейчас начались top savor паузы и вот у меня начались в логах in феникса который тоже парсинге ты видишь что у тебя начались отдаваться пятисотке ну и соответственно и соединяющего эти факты делаешь вывод что у тебя проблемы там с памятью надо памяти побольше дать или коим дурацкий плагин выключить такие варианты спасибо большое да ну да тинейджерам кантри beautiful pink видно клей то есть тут все зависит от количества стали скажите пожалуйста а вот такое количество билдов сколько команд разработки их порождает и какой состав команды которая на стороне команда которая отвечает за дженкинс сколько человек в ней нас немного то есть если брать грубо говорят людей которые пишут код и то есть один человек держит держит всю инфраструктуру код тихо трое человек то есть остальные люди они занимаются там сборником новых команд там поддержка легаси так далее то есть ядро у нас четверо команд которые пользуются ну сложно мере в командах пуша сейчас там эти сети скрама джейл и короче там черт ногу сломит вот но соотношение наверно 1 к 2 стан где-то так ну 200 человек на одного человека по другой раз спасибо за доклад расскажите немножко inside а вот эти ваши мастера они тоже все вкладах это мне испытываете никаких проблем или мастера у вас внешне не но вообще у нас все в claude так или иначе то есть грубо говоря один вот самый толстый дженкинс мастер атанаса версии 16 чего-то там самый старый до двух потому что 2 началась очень сильно деградация по перфоманса поэтому не менее его низ мигрировали то есть два мы сейчас заплатили чтобы он нормально работала на 10 20 тысяч билдах вот ну смысле это все уже доступна как я сказал уже то есть версии до 85 от нас работает двадцать тридцать сорок тысяч годов день вот тут версии дженкинса 2 там с 27 см и начали внутри докера запускать есть планы переместить вот сам дженкинс мастеров клауд но смысле в конце там я не знаю обернитесь еще куда оттуда вот носом и сами слои в этой железке все крутится в claude проблемы есть тем что например как-то раз но у нас там компания с немецкими корнями например и 11 разработчик закормить стрим гус умолял этом for file names умолял там amazon нам нас подвел и о них почему-то все ноды поднимались без поддержки а utf-8 локали нас просто весь кластер умер она два дня мы жили просто в кровище и при этом как бы найти то что это все случилось из-за файлик раз умолял этом за него какое-то время вот но кроме этого все будет более менее нормально так еще небольшой вопросик судя потому что дженкинс старыми вот обычные тоски используете никаких проблем не испытывали с новыми pipeline ими которые джинки во втором не но у меня на больших объемах production ready стоит на мой взгляд достигнут был несколько месяцев назад то есть ну полгода назад может быть то есть мы начали эволюционно когда они всем старое название был не pipeline 2 power флафф дроп но они там петли и проблема более грузите аксамит рубрике клево чем короче мы не больше пищи могли выжить вот сейчас проблема такая что чекаут например у нас не работает то есть мы не смогли завести чеканов мысли когда ты из там где то делов 4 pipeline файла поэтому файлы мы все храним тупо надень на на мастере то есть мы там кронам чека этим чтобы был у нас один раз шоколад и собственно из по плану то есть из лога мы enter тима эти файлы да то есть там есть файл из 7 плагин такой который представляется схемам на самом деле читает диск а то есть это нам дало сильный boost то есть мысли стали тратить время на чекаут на стороне мастера то есть разгрузили сильно мастер точно fuji си прекратился вот и было еще проблема с тем что каждый раз нужно компилировать то есть но мы еще пока не решили но я думаю если мы ее решим мы перейдем на газ 20 40 тысяч до там 80 тысяч потому что сейчас по дефолту дженкинс каждый раз компилирует ваш скрипт для того чтобы его запустить то есть мы хотим вернуть гузик аж который был выпилен год назад вот добрый день спасибо за доклад есть вопрос если вас когда лифтинг но это еще и на этом наш что конкретно ну вот вы мониторить все есть у смысле нанана упавшие билды например там есть допустим у к panda security да то есть у них есть не например вот через этот же механизм флинн где у нас есть подписка что когда у нас приходит такой to build с такими by ногами мы им делаем allure для того чтобы они могли сделать секьюрити чек то есть там нет ли каких-то уязвимости в бинарники да то есть есть оливок ник на нашей стороне то есть там месте диск переполняется ли еще что то есть allure то есть например там но какие-то важные билды начали падать то есть разные разные лет в общем по четыре слова или что-то круглое ну slug можно было бы сделать но почту то есть мы в принципе flew люди я говорю то есть это кухонный комбайн там насадок миллион просто можно флаг у нас почту второй вопрос чем умеет жить инфраструктуру в облаке вас amazon это понимаю так как я говорю нас вот есть один человек который отвечает инфраструктуру вот им именно менеджер ну то есть как бы плагина для дженкинса которая ситу плагин нас три плагин они в принципе но просто установил там право раздали оно все работает то есть у нас тира форма в таком экспериментальном состоянии да то есть тира формы какие-то базовые вещи раздаём на в принципе очень много мам ведь нам не надо в амазоне то есть все так сказать сказать шаблонную еще образ и тогда большое спасибо александр за хороший доклад"
}