{
  "video_id": "IgQi4BpNgRQ",
  "channel": "HighLoadChannel",
  "title": "Что нового в MySQL 8.0? / Дмитрий Ленев (Oracle)",
  "views": 3902,
  "duration": 3128,
  "published": "2018-01-16T12:19:29-08:00",
  "text": "компания орков я один из людей которые занимаются разработчикам разработкой моя сколь сервер и сегодня я хочу поговорить о том что нового появилось в ветке майской которая называется 80 и которая на данный момент является веткой которую мы активно разрабатываем прежде всего я вам должен показать вот такой слайд забавный который говорит о том что oracle несет никакой ответственности за то что о чем я собираюсь говорить пожалуйста не покупайте продукты oracle основывать на моей презентации иначе американские финансовые власти нам скажет ой ой ой давайте начнем с того что пройдемся о том какие сейчас есть актуальной версии майской ну во первых есть 57 это стабильная ветка mais quel самая последняя версия это 57 18 которая вышла в апреле ее можно загрузить с сайта сестер в общем-то логично и и использовать продакшене в ней происходит только баг фиксы никакой активной разработки в ней не происходит дальше есть ветка 80 в которой ведется вся активная разработка она ещё не готова к исполнению продакшене регулярно выпускается называемый development мастон релизы то есть это не совсем release candidate и но тем не менее достаточно хорошие лиза который мы считаем что интересно просто будет попробуйте тестировать последние делают астон релиз это 801 который тоже вышел в апреле ну я думаю что очередной следующий more stories тоже не за горами в принципе 9 мастон релизы вы можете трубить точно там же на том же сайте дальше есть так называемый еще labs версии с учетом что иногда мы какие-то те или иные возможности не успеваем доделывать асторре визу и тогда нам приходится ждать отзывов пользователей до того момента когда они войдут следующий demar релиз пользой начнут попробуйте что-то нам скажет но ждать столько не хочется особенно если это произошло в начале цикла поэтому делать называемый labs лис в которой мы выкладываем какой-то версию который считается качеством как бы похуже чем david and most анализ для нее меньше q&a происходит но те имея которую пользователи могут попробовать и такие релизы доступны на labs поскольку наконец еще такая вещь как rapid плагины здесь идея такая что иногда хочется иметь какие-то совершенно новые фичи в 57 потому что ну когда там еще 80 100 нестабильный пользователь его начнут использовать продакшене а с другой стороны люди любят экспериментировать да и тогда им хочется в продаж не принять какую-то фичу которая и без того чтобы ждать долгого выпуска релиза идея очень простая мы вынесем эта функциональность плагина и выпустим такой плагин в стабильной ветки при этом и где очень просто если вы плагином не пользуетесь она на общую стабильность сервера не должна влиять если вы плагин им пользуется дата мог быть какие-то проблемы но опять же в теории быть не должно потому что для того же серого для j сервер для стабильной ветки мы делаем полный кайф гораздо более серьезные чем для demar релизов ну два примера таких плагинов это x плагин который доступен с версии 57 12 который предлагает пользователям новый протокол взаимодействия с mais quel но и сколь интерфейс это все что сейчас люди так любят можно попробовать посмотреть опять же для этого вы он идет в стандартный стабильный 57 просто нужно включить и он вам доступен если у вас стоит тот 7 второй пример такого rapid плагина это групп репликация которая доступна с версии 5 717 это мастер мастер репликация на это то на чем основана и на тебе кластера котором константин в предыдущей презентации немного упоминал ну вот вкратце об актуальных версиях майской значит давайте быстро поговорим чуть-чуть о том о чем а собственного буду рассказывать в данном докладе ну понятно что все новые возможности в которые появились 80 в рамках данного доклада светить нельзя потому что там их много разных я выбрал то что мне кажется наиболее важно мы будем говорить про новый словарь данных и поддержку атомарного ддл а про новые возможности оптимизатора и выполнение запросов это табличные выражение оконные функции убывающей невидимые индексы мы помимо об улучшениях поддержки никода более гибкий работы с блокировками про роль и другие улучшения при беге и поговорим про пару улучшений в аппликации чтобы вы понимали почему я как о чем-то буду говорить очень кратко ну вот просто улучшению аппликации это отдельный доклад на 45 минут если все улучшение репликации обсуждать которые есть 80 соответственно понятно что мы охватить их не можем давайте начнем со словаря данных если мы смотрим на словарь данных до 80 то мы видим такую картину что метаданные до версии 80 57 хранятся в разных местах что-то хранится файл вот данная таблицах они хранятся так называемых frm файлах печально известных то есть файлы на файловой системе для триггеры хранятся в trg файлах данные о базах данных хранятся в опыт файлов в базе данных что хранится таблицах данные о пользователях хранится в таблицах оба ивентах о процедурах при этом это мой зам таблице какие то данные хранятся вы надели таблицах транзакционных хранилище например внутренней системные метаданные на тебе хранятся вы надели таблицах которые даже не видны пользователям со всем этим есть нет несколько проблем во первых реализация информация схема по версии у этого получается медленный чуть попозже мы посмотрим почему во вторых возникают иногда конфликты за интернационала хранения метаданных ну типичный пример что сервер упал в процессе выполнения ддл данные вы надели например таблицах мы уже успели обновить а вот frm не записался ой он тебе начинает ругаться на не согласованность данных и другое количество индексов в и no debe таблички построению с тем что есть в форме ну иногда возникают просто конфликты метаданных между и недели и в ядре севера принципе тот же самый пример но здесь они еще просто могут возникать на поверну баги бывает у всех поскольку источник источников правда несколько это и ефрем файлы и данные на тебе естественно возникает иногда из-за багов проблемы и вы получаете опять же те же самые ошибки verlag с которым что приходится делать все это на основании вот этих ефремов хранения данных в файлах хранения виде часть данных хранится в табличках myisam где часть данных хранится в и no debe табличках трудно ли завывать поддержку атомарного и дальше традиционного д д ля например для того чтобы сделать это more д-д-д-для партий шимко таблица пришлось накрутить целую под систему со своим собственным ряду логом которая в общем то вы функция дублирует в некоторой степени функциональность обычного логов той же найди by неприятно и сложном разработки есть некие проблемы с репликации не атомарного ддл я его сложно инфицировать это сложно поддерживать не атомарной семантику это скорее вопрос к семантике не вопрос безопасности случай падения а то что когда вы скажем удаляйте ряд таблиц да вот вы напишете drop us a b c если вас таблички ценету таблички а и б вас равно дропнуться вот такую семантику достаточно сложно сангли на своей поддерживать в сложных случаях но вдруг ты ибо соваться это все просто а вот эти штамбе сложнее происходит уже начинаются проблемы ну и наконец для нас для разработчиков серверы проблема большая что все это сложно и расширять добавление какого-то нового поля формат еще это приключение неприятно замедляет разработку так далее соответственно в 80 мы сделали новый словарь данных это один из проектов в котором в том числе занимаюсь я поэтому я про него рассказывать немножко подробнее чем по другие вещи которые появились новые значит идея очень простая мы получаем единое хранилище для всех метаданных этой таблице причем это и no debe таблицы ну или в более общем случае просто транзакционные таблицы и информация схемы в частности реализуется как просто view представление над этими таблицами если кто читал сколь стандарт то вы скажете стандарте есть такая забавная часть который описывает информацию схема таблици и вот они там тоже описаны на самом деле в терминах таблица словаря данных понятно что если наш реализация в какой-то степени повторяет эту идею там просто лиза проще рисовать информация схема помимо этого новый словарь данных это единая пий для всех частей сервера или ядра сервера для storage engine of для плагинов которые можно пользоваться упрощения разработки единообразная 5 разных объектов то есть у вас не то чтобы одинаковой опять скажем для хранимых процедур и таблицы ясно что она не будет одинаковым но по-крайней мере в проектировании 25 использованы различные подходы и поэтому если вы знаете как работа с таблицами ну как разработчик сервера то с процедурами вы тоже научитесь легко быстро работать для пользователя это значит очень простую вещь что мы быстрее можем рисовать полезной для вас фича ну и наконец мы подумали над расширяемость you подумали что будет происходить при апгрейде между версиями как мы будем поддерживать плагины последняя вещь также продумана поддержка деза стар и кавери я скажу в данным вот на данном слайде про это дальше говорить не буду идея очень простая вас есть сервер до сына деви табличками там много разных ты был space of произошел крах сервер главный 3d space куда ты исчез потеряна часть ефремов чтобы хоть как-то какие-то данные за эту серую вытащить нужно было раньше вытащить ты был space нужно было откуда достать ефрем сделать импорт на другой сервер все это сложно не очень удобно здесь водится такое понятие как сера лайзы date информация это представление данных и таблицы которые хранится sound и был спейси дублируются то есть авторитетный источник данных по-прежнему даты dictionary да то есть вот эти таблицы транзакционные в которой хранятся основные данные но помимо этого мы мы там те же самые данные дублируем в самом-то ибо спейси поэтому есть вас произошел clock крах вам достаточно вытащить это 13 был space и потом его за ним за импортируете какой-то другой instance что сильно упрощают жизнь ну и это также упрощает импорт-экспорт понятное дело что вас только один файл который нужно перемещать ее только один фазы которым надо следить давайте поговорим почему же информацию схема сколько 7 такая медленная ну вот здесь мы посмотрим как выполняется типичный запрос информацию схема в 57 запрос приходит и клиент он приходит на сервер и и начинается все с того что мы создаем временные таблички для того чтобы матери завывать слепок информацию схема еще да и то по оптимизации происходит очень рано в процессе вот создаем эти временные таблички дальше работает оптимизатор какой то вы пирог выпороть по запросам и дальше переходим к выполнению плана запроса в процессе выполнения мы будем заполнять эти временные таблички по данным файловой системы исм аль-азам таблицы лизы найди by там применяются ники эвристики чтобы ускорить весь процесс но по факту если вы скажем делайте за запрос из информация схема ты без таблички единстве индекс который вам доступен это яндекс по имени таблички имени базы данных все вот эти все эвристики этого проекта есть некий эвристики чтобы не лезть лишний раз storage engine когда читаются динамические данные но это как бы один разговор они убыстряет конечно процесс но не кардинально заполняется содержимое временных таблиц и дальше уже происходит обычное выполнение как обычного запроса считаются данный из этих временных таблиц и отправляются пользователю если мы посмотрим на картинку 80 где информация схемы это представление power to the dictionary то картинка радикально проще ну вот это такая сложная общая картинка в 57 а 80 лет выглядит все так запрос приходит на север обрабатывается оптимизаторам начинает своего выполнения в процессе которого мы считаем строки из таблицы словаря данных и возвращаем данные клиенту но то есть что здесь важно пример временных таблиц в принципе по умолчанию не создается если у вас запрос такой что он может быть в принципе выполнена без времени cablista мне какой-то сложной агрегации еще чего-нибудь такого сложного то он выполнится без времени как и что в моей точки зрения прекрасно работает гораздо быстрее то есть что это нам дает результате запросы могут быть нормально оптимизироваться выше скорость вот здесь на этом слайде видно ускорение в типич некие запросах это наш внутренний тест в котором мы гоняем некий запросы конформация схема синенькое то во время выполнения в 57 красненькое время выполнения 80 видно что во многие запросов ситуация сильно лучше часто скорость повышается до 30 раз иногда до 100 раз ну понятно если у вас раньше был запрос чтобы выбрать скажем все колонки какого-то видов которые находятся вы на геби табличках да тут давать его поскольку пойду по типу storage engine у нас нет индексов 57 у нас есть только по имени и по по имени базы данных до по имени таблички базы данных яндекс нам приходилось для этого просканировать все таблички и вот эти данные все вытащить из всех ефремов это очень дорого а здесь по типу старушенция есть уже яндекс словаре данных соответственно мы пользуемся обычным индексом выборка совершенно с другой время происходит все гораздо быстрее происходит проще ли зация будем надеяться что будет меньше багов при этом надо понимать что здесь есть некий компромисс и в частности есть так называемые динамические данные которые мы ну вот типичный пример это в табличке информацию схемы the bells rock out da количество строк таблички вот версии 57 берет самое самое свежее значение storage engine а понятно что если мы к за каждую за каждым таким запросам едем storage engine то это получается дорого достаточно и это плохо ей может быть не нужно для пользы на самом деле почти всегда когда пользы пользовать такой запрос он по недомыслию такой запрос пишет обычно ему это не нужно так вот в 80 решили эту проблему следующим образом есть 2 режима работы информацию схема один из каширование когда эти данные кэшируются в неких дополнительных табличках и мы на каждый чих не лезем storage engine а другой без каширования режим совместимости по молчанию включен режим а без каширования это решение потому что это то что мы верим полезно большинство пользователей но если вам вдруг нужно старое поведение в этим пользуется то можно включить обратный режим совместимости и все будет прекрасно хотя вы конечно пару лет ведь часть производительности перейдем к следующему пункту связанном с новым и словарем данных это атомарной del в чем проблема здесь на самом деле есть два аспекта проблема первых атамана с точки зрения пользователя во первых когда польские приходит из других базах данных для них это звучит дико что тут есть drop the bells он вроде как бы один statement он может провалиться и при этом у него не будут какие-то сайт эффекты да то есть вот мы пробы вроде дропаем там 34 таблички adr опыт столько 3 ну как бы это не привычные странные плохо как я уже сказал это сложно реплицировать в него многих случаях соответственно 80 мы стараемся перейти к семантике все ли ничего при ошибках то есть если у вас есть этот друг тейлз который дропают несколько табличек то мы либо его полностью выполним либо не выполним из него ничего мы считаем что это лучше с точки зрения ожидании пользователя особенно это приобретает свою важность скажем когда вы дропайте не несколько таблички вы еще можете разобраться а скажем в дропайте базу данных из 57 вас могло произойти так что вот в ее начале тропы дроп никакое количество табличка потом у вас произошла ошибка вы остановились так вот в 80 такого не будет вас либо банан баз данных со дропнется либо нет ну и это проще репетировать значит кроме того есть 2 спирту всей этой истории это так называемая устойчивость крышам и вопрос согласованности информации в разных местах при падении севера достаточно редко такое бывает что сервера мог упасть процессе выполнения del ну есть баги в сервере есть проблемы с диском есть проблемы с памятью что угодно выдернули вилку из питания и если он пойдет в очень удачный момент у нас может быть возникнуть несогласованность между словарем данных и storage and shine еще binary логом к тому же и тогда вы получали проблему в лучшем случае от какие-то ошибки в логе были с которым приходилось как-то разбираться какую-то брать откуда доставать старый фильм или наоборот приводить соответствие фрейм с ожиданием и не тебе целая проблема и так вот в 80 эта проблема решается за счет атомарного д д ля где бы пакуем все обновление метаданных обновления данных сторож энджи ней и в бинаре лог в одну атомарной транзакцию которая устойчиво крыши тут нужно понимать что ли всего этого счастья для дома насти нужна поддержка в тора шеньчженя myisam это поддерживать не будет будет подержите на тебе и тебе вот и все собственно пасовать данных давайте перейдем к улучшениях в возможностях выполнения запроса запросов в оптимизаторе ввп в выполнить или запросов давайте поговорим о том как мы выполняли роль как мы работали с иерархическими данными в 5-7 ну как бы такой простой пример какой-то отдел с начальниками у каждой модели есть свой ай ди есть ольги начальника это так называемая модель списка соседей все это вот отражается в такой таблички какие проблемы у такого представления графических данных есть проблема очень простая проблема с высотой дерево если вы наперед знаете высоту вашего дерева вы выпишете какое-то количество электронов и все прекрасно вы можете выбрать полный путь до например да листов а если высоту дерево не знаете ли она не фиксированного сразу возникают проблемы приходится либо слишком делать много лишних джонов либо приходится писать процедуры которые последуют на обходит вот эти элементы сложно вторая модель которые традиционно использовали работы с российскими данными до 80 и как называем модели вложенных множеств и и лучше показывать не на идее не на картинке с отделами а на картинке разными электронное устройство от нас есть вообще электронные устройства у них есть среди них есть телевизор и игровые консоли среди телевизоров есть сиди есть плазма мы говорю о том что lcd входит во множество телевизоров а множество телевизор сходится во множество электроники соответственно то есть мы говорим что у нас есть ложное множество а теперь давайте мы это дерево ложных мышц спроектируем на час спроецируем на числовую прямую мы назначим для каждой из этих множеств левую и правую границы и за счет вот такого вложенного назначение границ мы потом будем работать с этими вложенными множеств ну то есть понятно чтобы выбрать всех весь путь от например от листа до корня электроники достаточно сделать запрос которым будет сказано что все кто все элементы с левой границей меньше равные тройки и все элементы справа границы больше разные четверки выбрать и это нам даст полный путь к корню такая классическая вещи если кому то интересно про это побольше почитать есть книжки ссылка большие толстые там все это прекрасно описано на счету это тоже есть кое-какие проблемы ну во-первых лизации нетривиальная то есть вот так на все это так посмотрите вылет не очень просто особенно случае есть вас к это сложная система все это уложить гора ведь тяжело дорогие ставка удаления но представьте что вы нам нужно вставить еще тип элт телевизоров обычных наших кинескопных так это нам нужно выделить новые элементы белта и телевизоров новые числа лево и право обновить тиви обновить электронику и может быть обновить консоли и так далее ну дорого целая проблема вот это то что у нас есть до 80 эти два варианта что стала доступна версия с графическими данными в для работы с эротическим данной версии 0 появились поддержка рекурсивных табличных выражений мы можем написать рекурсивное выражение которое нам оставаясь в той же самой модели соседей списка соседей который у нас здесь было чуть раньше ну вот вот вот эта картинка до записать запрос который нам выдаст скажем всех все элементы всех менеджеров дага или и вы ну вот давайте перейдем что мы делаем мы сначала объявляем нашу табличное выражение объявляем табличку говорим что у него будет колонка единый миловал дальше мы первой части рекурсивного то обычно выражение задаем начальное значение для этой табличке в данном случае мы выбираем ну вот этим значениям и выбираем корень дерева нашего то есть нашу алису то что у него менеджер айди и знал да и следующем этапе мы сдаем правила по которым мы будем счастлив следующую итерацию рекурсивно выражение продуцировать да это запрос на основании предыдущих элементов вы выбрать всех подчиненных с предыдущего этап менеджер из предыдущего этапа и добавить еще один уровень вот таким запросам мы выбираем строим иерархию выдаем наша иерархию с уровнями и в количестве в конце все это дело сортир делаем какую-то еще добавить ну выборку и сортируем по уровню ну выглядеть может быть сложно но с точки зрения запроса самого на практике работать с этим проще кроме того рекурсивные ну дело не ограничивается забили только рекурсии табличные выражение способны приносить пользу и в других ситуациях допустим у нас есть вот такой запрос который выбирает данные на самом деле поставщики максимальный максимальным доходом в данном случае но чтобы хорошо только вот этот табличка revenue на самом деле не не табличка review а некое представление и это представление не просто представления такое представление которое вот и заданной clause ее невозможно выполнить в mais quel и при помощи стратегии мерз дату она не может вас в верхней запрос а вы из материализуете и потом она будет выполняться запрос будет волосах поверх временной таблицы так вот проблема в том что вот этот revenue используя здесь два раза соответственно табличка будет интересоваться два раза и что конечно плохо вот этот you будет монтируется два раза как это как эту проблему можно решить с табличными выражениями очень просто мы заменяем вот это наш первый запрос верхней да на обычное выражение фактически мы даем описание того же самого view видит обычного выражения и переписываем дальше наш второй запрос неизменном виде чем хорошо табличное выражение вычисляется один раз экономия на вычисление обычного же нее два раза прекрасно перейдем к следующей теме я следующей темы это оконная функция про них я буду рассказывать мне очень долго значит в отличие от всего о чем я рассказывал до этого момента кроме может быть атомарного dd их еще нет ни в одном да и мари но я думаю что полы появится либо следующем да и мари либо в labs ализе в чем проблема до версии 80 сложно а иногда и невозможно считать агрегатные функции от групп из текущей связанные с не вдруг только если мы если мы при этом не готовы группировать всех строки ну вот какой бы скользящие средние сложно считать до то есть грубо им посчитать агрегатные функции легко а вот если windows и грубая не устраивать на вроде бы группировка нужно но другой стороны и нужно для каждой строки что-то посчитать проблема решение стандартные так он ее функции их поддержка должна скоро появится в морской в дымах или в labs релизе ну вот такой пример что у нас есть данные данные о сотрудниках есть департаменты и мы хотим данные в каждом отделе рассортировать сотрудников по зарплате и выдайте как бран сотрудников по зарплате для этого напишем вот такое оконное выражения которые что вот каким образом мы группируем наши наших сотрудников по номеру отдела как мы их там сортируем и что функцию ранжированием использования функцию ранка задаем таким образом колонку и получаем стать и вот такую табличку причем обратите внимание что но в принципе вот если так прикинуть можно было бы написать некий грубой с ордер buy который приблизительно так же что такие данные выдает но там не было бы ранга там было просто упорядочение а вот здесь у нас есть в отделе б ингрид и себастиан который получают одинаковую зарплату и соответственно имеют одинаковый ранг загружаем вы так не сделаете ну или сделайте но вам придется извращаться со юзер v-ray была мечта как бы сложно а какие вещи вы просто так не сможете сделать москве или сделайте но это будет очень дорого следующий вещь убывающей индексы до 80 убывающей индексы поддерживаться только синтаксически то есть синтез поддержка но при этом создается обычный возрастающей индекс в чем проблема сканирование в обратном порядке индекс дороже из-за детали реализации кроме того такие индексы нельзя использовать в ситуации когда нужно у вас есть яндекс несколькими колонками и нужно разное упорядоченное и направление обхода по разным колонкам индекса у вас все равно создавалась индекс возрастающей по всем колонкам ясно что он не подходит для всех планов теперь таки индексы поддерживается в и на тебе оптимизаторов умеет их правильно использовать есть некие ограничения на оптимизации ну вот пример как раз то о чем я говорю раз второй пункт мы с яндекс из двух колонок где 1 колонку он будет возрастающей по первой колонке убывающей по 2 колонки тогда такой селектор герба им по возрастающей по первой колонке и по убывающей по 2 колонки он будет выполняться без фар сорт хорошо следующий интересный вещи связанные с индексами это невидимые индексы что это такое-то индекса который невидимый для оптимизатора зачем это нужно они не видами для оптимизатор но при этом каждый дымарь statement их по-прежнему обновляется до в мазями были такие disabled именно которые можно было отключить но как только вы их отключали они представляли обновляться и для того чтобы включить вам переходил из перестраивать обратный индекс зачем это нужно ответ очень простой такое мягкое неинвазивное удаление вы мгновенно восстановления плюс еще есть вариант с пошаговому добавлением индексов тоже иногда бывает полезно когда вы не хотите сразу индексы выкладывать на продакшн вы хотите сначала как бы добавить на невидимые сделать для оптимизатора посмотреть как это влияет на ваши дмс загрузку а потом какой-то момент согласованы все индексы включить ну давайте посмотрим пример вот у нас есть пример мы думаем что у нас какой-то индекс не используется в стране в табличке страны мы его делаем невидимым он по-прежнему консистентной продолжает обновляться но при этом тебе завтра перестает использовать объясняется что нужен ли какого-то запросы все плохо а по мы его сразу восстанавливает назад операция мгновенно происходит насколько это возможно проблем нет это не то же самое что перестроение индекса окей мы убедили что индекс реально никто не использует погоняли в таком режиме с недельку никакие там недельные отчеты у нас от этого не испортились все прекрасно мы просто удаляем индекс хорошо перейдем к следующему пункту на этом все с оптимизатором и выполнением программа поддержки юникода значит то что у нас пилось 80 счастью не кодом у нас час , 8mb 4 то есть 4 байт восемь стал черным по умолчанию вместо найти на один с видишь бла-бла-бла ура чем хорошо multiband на 4 байта unicode это значит и моджи прекрасно то есть даже если вы раньше использовали трубы от нее не код там пробыли были проблемы с ранением и маджио сейчас по умолчанию мы храним и больше появил появилась поддержка более нового свежего стандартной у nikon d90 появилось много новых от сенситив excel сенситив collection of в 57 тоже есть поддержка utf-8 mp4 но она не по умолчанию не включен по умолчанию чин но это нечестно по умолчанию там по-прежнему латина один по умолчанию и нет многих из этих средств найти в кости в collection of появилось много конечно специфичных для разных языков в том числе для японского кому-то это очень нужно купить японские пользователи очень рады чтобы это сделать и было на самом деле правильно большая работа в частности чтобы сделать и t8 в 4:00 этом по умолчанию нужно было сделать много-много разных оптимизацией были оптимизации самореализации это vouchers это главным образом функция которая делает сравнение решили в не так далее это брачный лупан роль быстрый путь для osd и символов там есть разница по тону упадка лишена и вот за счет этих оптимизации мы получаем ускорение при работе с данным collection вырос в десять и были оптимизация на уровне оптимизатора в частности поддержка сортировки ключей переменной длины что что это нам дает на практике ну мы гонялись из бенчи тест сравнивают и 8б 480 и в 5-7 вот в тесте лтп росы сердечек получали до 300 процентов выигрыш в производительности в rv чуть поменьше стой стой 70200 но тоже очень хорошо а в тесте который очень было оказался чувствителен к реализации сейчас это и всех этих collection of мы получили даже такие безумные цифры как полторы тысячи 1800 процентов это select distinct rangers как раз там играет роли сортировка в оптимизаторе и сравнения вот такая работа проделана для сравнения с ю т 8 b3 она правомерно какие-то оптимизации будут оптимизации теперь с переменными ключами переменной длины может быть для него и применимы но не все оптимизации связанные с внутренней лизации применимы ли ты 8-м mp3 поэтому там получается чуть меньше разница по строю чем scp-457 но все равно вполне приличный то есть там порядка там двести пятьдесят двести семьдесят процентов в первом тесте равно порядок существенно огромный это все что я хочу сказать при ней год дальше следующая возможность которая появилась 80 это более гибкая работа с блокировками типичная проблема хочется пропускать запланированные строки ну сценарий выборки из таблицы задание резервирования ресурса тайм-аутом плохо потому что он делает тайм-аут и не пропускает решение это использование clause is key плохо то есть теперь вы можете написать select in her in шермот skip лоб и пропустить заблокированные строки может используется совместно с for апдейт пушер фужеры это новый вариант за писания локон шермот на самом деле вы должны написать когда вы пишете select если вы хотите поиски плохо то вы должны писать фужер skyblock вместо локон шермот ну и соответственно каким-то не термином образом заблокированные строки у вас будет при варке тебе таблички пропускаться поддержка ролей 80 роли и тайники и именованные коллекции привилегий которые могут включать другие роли чем это хорошо они упрощают управление привилегиями пользователей можно не выдавать конкретной религии конкретным пользу я выдавать привилегия ролям и отзывать добавлять роли пользователям можно активировать и деактивировать роли для сессии это хорошо тем что в каждый момент ваши приложения будет иметь минимальный привилегии когда наработать базу данных при этом если вам это неудобно можно назначать несколько активных ролей в том числе по умолчанию для пользователей сказать что вот он может быть одновременные админы мы и девелопером и читателям и так далее ну и наконец можно смотреть все эти данные в виде графа дальше я следующий пример пропущу потому что у нас уже нет времени появилась поддержка динамических привилегий для пользователя это полезно тем что супер привилегии которая сейчас чрезвычайно перегружено она нужна и для бэкапы для управления соединениями так далее я была разбита на несколько разных привилегий появились кучка разные привлечь и более специфичной которую вы можете давать пользователям и таким образом избегать до давать им опасный и страшный супер перейдем к улучшениям в репликации тут я поговорю про два больших улучшения на самом деле улучшений там сильно больше но вот я выбрала эти два во-первых улучшена взаимодействие между потоком его потоком в репликации который скачивает данный с мастера и вскоре потоком ну типичный проблем что аппликация стает или у нее очень эффективно использовать железо вот решение этой проблемы эта оптимизация которая выносит запись и чтение зрелые логов из критических секций и или знавали 80 получили получили что мы меньше держим блокировки потоки меньше ждут доступ акрила ногу в результате выше производительность давайте посмотрим насколько выше ну вот это график сравнения 80 где есть это где нету этой реализации 800 оптимизации и оптимизации версии 801 где-то оптимизация есть видно что для 6 4 потоков мы получаем весьма неплохое улучшение в производительности просто включая просто за счет оптимизации кода то есть не нужно не включать никакие дополнительных опций тот же самый график для не your был на 2 любим logo значит что мы не считаем это севинч опять же применение транзакции на реплики в rbr следующее улучшение в репликации которая появилась это признано на основе использование врать эта проблема та же самая репликация стает или не эффективна при этом премии репликация может не помогать по крайней эта который просто построена на основе логических временных меток почему потому что нас на мастер либо малое число соединений или вообще одно соединение или вообще к не будь у нас сложный по алгебре picasa и так получается что это сложно и топология уменьшает процессе работы параллелизм в нашем потоке ивентов и у нас он теряется решение в пользу евросеть перлит что такое в райсовет врач все транзакции это ну грубо говоря это множество строк измененных данной транзакции это понятие используется в частности в лизации области ит applications were зации на тебе кластера и вот мы его начали использовать и 80 для улучшения параллелизма в обычные репликации асинхронные значит по сути дела мы используем wrapped как средство обнару обнаружить в зависимость утверждению чем простое что если транзакции иметь не пересекающиеся в ракеты то их можно применять параллельно на слове как это все работает мы достали расширяем механизм логических временных меток которые у нас уже есть за счет использования ракет мы считаем в россии транзакций на мастере и придумываем для наших транзакций ники искусные временные метки и представляемых на исходя из этих из этих врать цветов а не исходя счетчика как это использовала диалогических временных меток меток как я уже сказал зависимости определяется на мастере выражаясь при помощи логических временных меток за счет этого в частности это эту фичу можно использовать на 80 мастере но применять к 57 славу 57 реплики то есть вот такой интересный момент ускорение в обратную сторону тоже ну давайте быстренько посмотрим как всё это работает насовсем осталось немного времени вот у нас как работает при лизма на основе логических временных меток у нас есть поколения каждой стран за акции относится какому-то поколению транзакции идут в разных сессиях вот по вертикали это на самом деле в райцентре если врать это не пересекаются перекрытие нету ну вот раньше бы транзакции в разных поколениях при логической квалификации на основе логических временных меток применялись бы параллельно да хорошо некий призме есть но могло бы быть и получше что делает врач серба испарились он все эти транзакции группируют в меньшее число поколений соответственно произносили возрастает здесь есть некая такая проблема не очевидная ну вот видно что транзакция т2 и т3 и себя выполняются параллельно в этом случае транзакции 3 можно вершится раньше что не всегда есть хорошо поэтому придумали щетку промежуточный режим где поддерживается упорядочивание в рамках одной сессии помимо этого призма меньше конечно но все равно чуть-чуть ситуация получше что это дает на практике опять же здесь быть апдейт яндексе применение транзакции на реплики красненькая это врачей prism синенькое это признано основе логических рыбных меток видно что призма на основе логических меток работает не очень хорошо если клиентов на мастере мало работает хорошо когда клиентов на мастере много а вот когда клиентов на мастере мало нас туризма на основе врать сетов спасайте ну собственно говоря это все если есть какие-то специфические вопросы вы можете задать их в перерыве а сейчас можно просто задать вопрос я думаю что пять минут нас есть спасибо спасибо скажите пожалуйста но выступать включать себя процедуры триггера да как это работает совместно с не тебе кластером тебе кластер мать работает об этом есть некий pr за счет которого эти данные передаются в инди be close to районных как-то распределяет это достаточно одному москве сервере допустим этой процедуры она автоматически по всем сером платье разойдется идея такая но тут нужно вот какой понимать вещи я то что у глостера свой шедевр релизов и они только сейчас начинают интегрируйте это все в их дерево я знаю что раньше у них например было возможности иметь процедуру в индии табличках по-моему я думаю что они могут выбрать какой-то другой подход к вообще к лизации этой проблемы но идея такая что мы мы нить мужчин взаимодействием с кластером для того чтобы он мог распределять эти данные по всем новым кластера спасибо и чем они изменились ли требования к аппаратному обеспечению из-за восьмерки там поменялось кучу дефолтов но в принципе каких-то таких кардинальных изменений что вот обязательно использовать что-то это этому следует нам планировать облетели ров и внутри ходить ну я бы дождался во первых когда он станет объявлен будет 80 стабильным во вторых бы где-нибудь в уголочке сначала потестировал бы потому что там достаточно будет много изменений в default ах может быть во что-то сломается вот изменения в семантике друг ты был stay'd она может потенциально сломать репликацию с этим ничего не сделаешь что-то приходится всегда платить за прогресс вперед меня вопрос у меня я здесь до сего добрый день спасибо за доклад а мне интересно и правильно понял да дэвид р транзакционному будет то есть нет ни транзакционный пока он будет атомарный хотя бы если будет крыш мы сможем состоится в этом внутри транзакции его нельзя все еще просто сказали что он будет делать внутри транзакция не понял там будет транзакций оно будет состоять из вдоволь стоит мента вот этого проблема в том что транзакционный del требует достаточно требовательны к инфраструктуре внутри сервера там нужно поддерживать мульти versions и каши если мы хотим поддерживать мульти version ность как бы мы пока на него мы потенциально его к вы планируем в какой-то нет меню замахнемся но пока мы решили сделать это more настьку чтобы она хотя бы на надежно работала и решить проблемы с репликации ясно пасибо а еще мне вопрос по 5-7 больше вы сказали что будут введены новые даст индексы чтобы ну типа обратно индусы то есть если у нас допустим индекс стоит мы хотим сортировалось ну сортировку делать и рыба и там ask у нас по индексу dear диск на свою сорт в 57 это как сейчас работать оказать диск как какой то или иное вы работать вообще нет у вы можете указать диск но зато страну возрастающей индекс он будет используется для запросов для некоторых взять его которые не мути колоночный до запрос он будет использовать или запроса просто будет обходиться в обратном порядке это не совсем очевидно но вот обход индекса в обратном порядке вы на дебит дороже просто за счет детали реализации там процентов 10 разница получает но уже будет не files of the уже будете папа индусов да вот этот пример который с мультика логичным приняла индексом там будет как раз фалфорд потому что там мультика логичный яндекс и части колонок в одном направлении часть другому возрастающей выдоха вы так мне обойдете то есть и принципе если у меня если у меня используется там vr какие-то условия ту меня тоже это торба я уже будет не будет работать по обратную сторону или нет есть из меня но типа какой-то составной индекс используется допустим по кроме там не знаю имени пользователя и составным индексом нужно смотреть на запрос есть и краткий ответ у такой лучше посмотреть на запрос лучше посмотреть на запрос какие там индексы используются как да я по сложно понять как это работает типовым в любому в любых условиях будет работать или не в любых каких-то там не на просто нужно принять что это возрастающей всегда и даже если вы ему сказали 57 что добывающей что это будет она возрастающим спасибо здесь еще был вопрос быстрый вопрос про совместимость насколько быстро и безболезненно можно туда обратно совместимость вот я в курсе про деревья везде ели мы немножко совместимы сравняем instructables но опять же надо понимать что далеко не факт что это у вас сломается может быть вы что-то пишете что вас таких проблем нету ну то есть понятно что какие-то таких крайних случаях но в целом как бы она будет вас дела в целом идея такая что будет совместимость если не будет совместимость то мы пишем об это большими и большими буквами стараемся свет есть вопрос давайте вот тут вот мужчина хотел задать можно я дополню потому что мне кажется что вот она задала про совместимость про туда-обратно это про то как переехать 57 на 80 из лучше вернуться обратно и совершенно другая вещь и придется вам делать там прилов мне не прожить и давайте это мы с вами отдельно обсудим потому что с апгрейдом там будут сильно другая история что мы создаем даты dictionary эта вот отдельная большая песня будут какие-то изменения в 80 с типом таблицы in memory с мемори которые то есть там просто доклад ну до этого докладчик соседнем кабинете на говорю что ее лучше не использовать принципе потому что выигрыш и собственно никакого не получается но мы как при обновлении там блокируется все таблица да там есть такие проблемы я скажу только что мы работаем над этим будет ли что-то в этом 800 я не могу сказать потому что даже вот на такой стадии чтобы вот она была в lab солис или куда-то в demar ближайший на сколько знаю сейчас пока ничего не готово еще вопрос а давайте последний вопрос и потом все остальные вопросы если я маленький филосовский вопрос вот по поводу табличных выражений и вот пример с иерархией да да не воры где есть чудесные ловил выражения почему их не сделали мозге стандарте стандарте есть табличные выражение то есть решили пойти все таки по стандарту да и это это такая то что это покрывает там говори семьи с потребностями процентов потребности всех людей которые используют эти хранилища ромашки делать фигурки да да как бы это такая принципиальная позиция что мы стараемся теперь когда я здесь есть возможность идти по стандарту мы стараемся идти по стандарту это общий тренд"
}