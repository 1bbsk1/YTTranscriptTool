{
  "video_id": "iOfR0YtaWMc",
  "channel": "HighLoadChannel",
  "title": "Микросервисы: жизнь после. Невыдуманные истории, о которых невозможно молчать/Иван Матвеев (Vi Tech)",
  "views": 641,
  "duration": 3141,
  "published": "2025-01-17T02:29:25-08:00",
  "text": "Всем привет Сейчас секундочку приготовиться посмотреть кликер проверить Да работает не работает да всё супер А меня зовут Иван на самом деле это видно Наверное по моей футболке по названию доклада в принципе следующий слайд тоже будет обо мне видно Я себя очень сильно люблю давайте а немножечко чтобы развеяться сначала первоначальный вот этот мандраж убрать расскажу немножечко про доклад микросервисы жизнь после невыдуманные истории о которых невозможно молчать так как нам завещал Андрей Малахов Да а на самом деле когда я готовил доклад у меня был довольно большой список тезисов прям Ну не знаю на несколько листов в Google доках и не Всё попало из этого списка тезисов в конечную версию доклада всё что касается процессов А это наверное даже большая часть оно ушло куда-нибудь на какой-нибудь Team lcf и тому подобные вот э наверное Давайте приступим посмотрим что же осталось А если что вопросы по процессом можем обсудить В кулуарах после доклада или же можно будет Вот на в конце на на куске вопросов ответов пообсуждали очень много интересных истории Итак А вот слайд тот самый обо мне Я не буду идти по пунктам по каким-то рассказывать кто я чем я занимался Мне кажется это не очень интересно в рамках конкретно этого доклада самый главный пункт здесь это то что я руковожу разработкой в командах кор в техе и команда Core - это такая довольно интересная команда которая вроде как платформенная но не платформенная в общем чем мы занимаемся а занимаемся мы распилом Монолита и пилим этот Монолит мы успешно долго нудно и не видно ещё конца и края этому распилу Вот Кто же такие тех Почему мы вообще получилось что мы нам нужно пилить этот здоровый Монолит дальше классический слайд о компании тоже довольно много различных пунктов по которым я не буду проходиться рассказывать главное что мы та самая команда инженеров который делает все it продукты для всех инструментов то есть тех - это вот руки всех инструментов шные руки Вот и один из ключевых моментов который будет ещё в этом докладе на который хочу сакцентировать сейчас Внимание это что у нас четыре кластера кубес Итак вот мы команда которая пилит монолиты а почему так так хоп Да есть почему же мы решили пили-то Монолит этот на самом деле классическая история Я думаю у многих из вас такая же подобная история случалась Если вы вдруг пилите монолиты то это всегда развитие бизнеса как это происходило в общем приходит какой-то высокий топ-менеджер вот этот вот Конкретно этот слайд это с страт сессии э несколько лет назад Ну ладно не несколько там 2000 Q1 2023 написан вот э слайд на стратегической сессии я тут убрал неважные для нас цифры но э суть такая что к 2027 году нужно заработать много денег очень много денег и для того чтобы заработать эти очень много денег нужно чтобы у нас было X7 от пользователей которые посещают наш сайт в течение дня а X4 от заказов в день и в 10 раз больше различной различной информации по товарам по техническим характеристикам вот всё-всё-всё что наполняет акции транзакции и тому подобное Вот то есть бизнес пришёл такой вот такую вот как Ленин на броневике сказал нам нужно двигаться в светлое будущее мы посидели С инженерами и поняли что ну как бы вроде как не получается Не получается с текущим решением двигаться в это светлое будущее Мы решили пилить Монолит то есть одна из основных причин это у нас есть план по развитию и мы понимаем что мы с текущими нашим текущим состоянием кода с текущим состоянием инфраструктуры но мы просто дальше не поедем никак Вот у нас был момент переезда в три дата-центра тоже где-то пару лет назад в этом промежутке времени и был изначально изначально конен бы Дант потом когда было это бы про мен поняли что так двигаться дальше нельзя переехали в три дата центра у нас получился кворум После этого мы начали распределять нагрузку между тремя дата-центра и Казалось бы ну всё Всё окей можно дальше слиться хоть сколько и мы вот эти планы бизнеса успешно воплотим в жизнь да но оказывается тоже даже живя в трёх дата центрах не всегда всё хорошо получается у нас были лимиты по электричеству из одного из дата-центров нам реально пришлось переезжать потому что ну всё больше больше новых стоек поставить нельзя мало того что свободное место под стойки заканчивается так ещё и вот входной э входной провод с электричеством весь дата-центр он его не хватало А ну и Кроме этого соответственно это Монолит Я думаю Э те кто работал с большими крупными Монолита понимают что это очень долгие циклы А деплоя это очень большие проблемы с тем что там проходной двор Все толкаются локтями и в целом У нас у нас до сих пор если что Монолит живёт он от него куски отпили Но даже сейчас у нас был 3 часа на деплой времени и вот за за эти 3 часа мы не всегда успевали сейчас мы его сократили до 2 часов и там есть основной выкладываю есть основной тестировщик которые всё проверяют все автотесты и куча куча куча ребят из разных команд которые что-то там Дону в это вот релиз глобальный то есть ну большие ресурсы тратятся не оптимально Ну это всё лирика В общем самая основная всегда причина это развитие бизнеса Мы понимали что нужно дальше расти начали думать как же мы будем его пилить Ну классическая история как все всегда делают во всех Вы можете посмотреть другие доклады там будет плюс-минус где-то вот вот примерно такая же такая же картинка и история успеха Как Мы молодцы мы распилили то есть что мы начали делать конечно начали собрались с архитекторами с бизнесом помолились на синюю книжку эванса и начали рисовать картинки того как у нас наши доменные области где находятся в этот котек Map bounded контексты всё это нарисовали красота дальше что обычно делают Когда у нас вот это вот сложилась уже картинка но у нас есть Монолит дальше нужно нам выделить бандлы внутри Монолита То есть как-то это инкапсулировать эту логику под той карте которую мы нарисовали после того как всё это получилось Ну то есть мы план составили по бандла может быть даже уже их выделили каким-то образом дальше мы начинаем молиться На кап теорему Почему Потому что мы понимаем что сейчас мы сделали бандлы в будущем эти бандлы мы будем вытаскивать в микросервисы убирать и нам нужно понять что у нас что нам важнее консистентность или доступность вот это вот самая кап теорема где у на cons или avab мы выбираем выбрали и Начинаем потихоньку по этой логике выносить и дальше Вы прекрасны Всё хорошо да Но теория не всегда работает вот вот это вот самая теория которую и статьи есть и доклады есть и вроде всё красиво в теории но оно не работает в нашем случае вашем может быть получится Всё да что пошло у нас не так сложность проекта изначально вот этот вот Монолит и компания Все инструменты он разрабатывался с 2006 года и там было очень много разных подходов был разный уровень разработчиков которые участвовали в написании кода А многие менеджеры уже уволились многие разработчики уже уволились проект остался сложный и к чему мы приходим А тут неспроста используется keep it Simple Stupid kys У нас очень много так называемых простых элементов в нашем монолите один из классических примеров Simple вот этот Simple Collection очень простой очень простая коллекция на 7300 строк кода рядышком с ним лежит такой же очень простой пер Simple на 2500 строк кода всё это наследуется Simple Collection от Кона кон наследуется от бейза и вот дальше я там на слайди накидал это просто я поиском пробежался по классическим стандартным названиям каким-то и это вот всё вот просто только в одном маленьком простом участке кода объекте классе да Simple Collection да и Ну надо же как-то это вот выносить эти всё в бандл это всё резать он не один такой да Вот его пример конструктора это весь конструктор ещё не в лез Я не стал весь его запихивать распивать на несколько слайдов Вот то есть что тут есть у нас там есть какие-то Action прок сервисы какие-то есть резен сервисы есть продукт сервисы есть листинг атест сервис Ну в общем Image storage и так далее вот и это всё вот этот вот здоровый здоровый кусок какого там Монолита он просто неразбиваемый он Ну вот он он такой Big B of M А дальше что мы получается пытаемся сделать мы пытаемся это всё вынести в бандлы вот ну про про Тоту самою вот историю что мы в теории же Сначала мы делаем бандлы какие-то рисуем и да бандлы то мы сделали потратили там чуть больше чем полгода на то чтобы в бандлы это всё вынести но бандлы получились у нас как фасад а внутри этого фасада Simple Collection используется то есть по сути у нас появилась иллюзия что мы нарисовали вот это вот котек наш сделали вынесли эти бандлы сделали модульный Монолит но по факту там внутри вот та же самая обвязка те же самые вызовы инициализация этого Simple Collection и так далее Вот первая проблема сложность проекта дальше сложность коммуникации и тут в сложности коммуникации я знаете сделал такую Шутку с тройным дном есть три проблемы у нас коммуникационные вот первая проблема Какая может быть с коммуникациями ну классное именование сервисов знаете как говорят ютуберы ставьте лайки если у вас всё ещё тоже Ребята соревнуются в именовании сервисов вашей компании У нас есть сервис друзь У нас есть сервис Скрудж Да это первая проблема коммуникации такая Ладно шуйка сервис друзь сервис Скрудж друзь отвечает за доставки за де пример про который я хочу поговорить сейчас рассказать вынести на всеобщее обозрение он Про Сервис Скрудж Про Сервис дру но я буду говорить Про Сервис сру так как у друзья довольно сложная предметная область и мне кажется будет Ну просто много времени потратим на то чтобы вас погружать в эту предметную область почему не получается с ним нормально работать так вот какая проблема с следущая коммуникационная проблема Проблема взаимодействия по сети коммуникации карточка товара должна отвечать за 900 миллисекунд Это обусловлено бизнесом чем быстрее мы отдаём информацию о товаре тем больше конверсия Ну это давным-давно ещё по-моему Walmart или Amazon делали исследование на эту тему В общем у нас есть определённые коммиты наш вот наша карточка товара должна отдаваться за 900 мсн в 9 сама она формируется на ФФ backend for frontend собирается из 16 сервисов что-то мы уже вынесли в отдельные микросервисы что-то в макросе но всё ещё есть походы в Монолит мы там что-то пытаемся прикручиваем выкручиваем оптимизируем Делаем всё возможное И невозможное чтобы добиться этих 900 миллисекунд но всё упирается в тот самый сервис сру он отвечает за 500 мсн и мы приходим команде которая отвечает за сервис Круж говорим ребят Ну нам вот нужно довольно быстро отвечать а скажите А у вас какие нефункциональные требования по вашему сервису и дальше Вот происходит то что видите на картинке Да какие нефункциональные требования Ребята у нас свои планы мы пилим свой сервис Он никак на вашу предметную область не завязан мы занимаемся сейчас у нас все планы расписаны на год вперёд на квартал на несколько лет так что если вам нужно чтобы мы отвечали быстрее Ну приходите через годик там разберёмся вот следующая проблема с коммуникацией Да с коммуникация с отделом А всё выхода особо нет начинаем думать а что же делать-то можно Можно конечно налепить всякие кэши можно Ну есть масса разных пэттер но основная проблема как раз в нашей вот этой вот кап теореме что у нас консистентность важна это цены цены меняются 10.000 номенклатур меняется в час у нас цены для разных регионов цены для разных типов пользователей там к Юрик цены там с персональными всякими скидками есть понятно что промоакции они должны находиться отдельно но то есть тут столько всякой логики намешано и на один товар может быть до 20 до 30 разных цен которые могут довольно часто меняться мы не можем просто взять В тупую зашивать эти запросы и думать что у нас всё будет классно всё пройдёт Вот соответственно начинаем что делать классическая проблема начинаем в наш сервис по карточке товара у нас есть прокт info отдельный начинаем потихонечку эту логику затаскивать к себе дальше Какая ещё может быть проблема Почему теория не работает то есть вот была сложность проекта проблемы с коммуникацией у нас начинаются видите начинают предметные области просачиваться друг в друга начинается какая-то сложная логика внутри у нас вот эт вот идеальная картинка с нашими контекст мми уже перестаёт работать в какой-то момент так ещ и начинаются проблемы с ограниченным контекстом представляю Вашему вниманию шильдик - это такая вот маленькая Зелёная штучка на карточке товара с надписью новинка Ну когда у нас был план по распилу Мы сели подумали что пора бы выносить шильдики они довольно много тоже занимают времени при формировании Да и в принципе вроде логика несложная вынести его в отдельный микросервис и будет в всё классно но мы начали разбираться где-то мы полгода наверно делали аналитику с этим шильдиком Где где мастер система Кто кто должен забрать этот микросервис шильдиков к себе оказывается ПДМ система управления данными говорит Ну мы как бы можем Но у нас вот всего там новинка не новинка Какие состояния Есть Ну там ещё там может парочка каких-то мы такие Окей Ну наверное тогда маркетинг приходим в маркетинг там акции промо тому подобные всякие розари Какие вот там акции и промы и тому подобные приходим в команду ценообразования говорим Ну ребята Ну вам-то точно это же ваше вас же это вот лучшая цена они такие Нет ну остальные вот с остальными ребятами Вы поговорили к чему это относится в итоге что у нас получается у нас получается сервис который мы не знаем куда ткнуть то есть мы на карте нарисовали его мы понимаем что он где-то отдельно находится но теперь его надо куда-то запихать ну или в какую-то команду или вынести Ну то есть если мы его даже вынесем сделаем у нас получается будет сбор из нескольких мастер систем и кто конечный ответственный за то как это всё будет работать вот основные проблемы с которыми мы сталкивались вот эта вот теория Почему у нас вот это вот вся наша система начинает сваливать порой как Карточный домик из из-за вот этих вот основных проблем сложный проект тяжело коммуницировать с другими отделами Да и в целом не всегда наши ограниченные контексты бьются к чему это приводит приводит к тому что у нас вот этот вот модульный Монолит превращается в распределённый это не наш полностью случай Но вот эти вот кусочки этих проблем они присутствуют в финальной картине к которой мы сейчас на данный момент пришли у нас не микросервисы у нас скорее какая-то сервис онд архитектура версии 2 у нас большие макросе которые в себе довольно много логики и не всегда даже из своей предметной области Ну опять же изза проблем с из сло проек и так далее И иногда Монолит может переехать просто в другой Монолит то есть наша сейчас разросся и там прям очень-очень такая развесистая логика много-много всего мы начали потихонечку его разбивать на пакеты и как финал У нас есть оден это эта циферка ещ повторится у на 21% инцидентов связанных с какой-то сложностью нетеро кода и тому подобными проблемами то есть из-за того что мы вот этот вот ну Монолит как-то криво порезали куски Ну ладно с бандла мы разобрались вот мы как-то нарезали как-то начали потихонечку жить дальше помните вот это вот все эти слайды которые я показывал про этапы как мы Режем вот катере мы продумали всю нашу логику где у нас будет кон где и мы таки понимаем Ну да Окей У нас есть сеть У нас есть взаимодействие по сети микросервисы всегда общаются Ну то есть когда у нас появляются микросервисы у нас появляются сеть Но мы же покрыли сеть ка теоремы на это же про сеть хбм нежно с этим мы не подумали про latency Куда latency в кап теореме относится куда вот эта вот железная часть уходит пример product Review А сервис микросервис который хранит в себе отзывы информацию об отзывах отвечает сделан на пых мы сейчас сейчас пишем в основном на Гош Но это один из таких первых блинов его ещё делали на пых он отвечает за 70 миллисекунд можно было бы быстрее но его довольно тяжело там тоже спми В общем 70 миллисекунд в 99,9 НТИ отвечает ну вроде бы в целом неплохо Да всё э везде в в нефункциональных требованиях у него написано что он там меньше 100 мсн должен отвечать всё хорошо мы их покрываем с лихвой то есть э сервис отличный клиент подключает сервис вот с той же вот с того же бфф например который Кэн по фнн нам нужно вот при формировании карточки товара какую-то информацию из отзывов вывести клиент отваливается по тайм-аут поставили тайм-аут в 100 миллисекунд так как нефункциональные требования всё а отваливается почему-то начинаем расследование и тут прям целая эпопея с этим расследованием Довольно интересно забавный случай приходим к сетевикам говорим Ну ребят смотрите наш сервис-то отвечает 70 миллисекунд всё правильно всё нормально значит где-то в сети проблема сетевики такие Ладно Ребята давайте и будем тестировать проверять И вообще на самом деле сетевики это просто мною любимые самые Уважаемые отличные люди если тут есть сетевики Ребята вы красавчики просто потому вот мы организовали рабочую группу которая у нас наверное полгода длилось каждую неделю мы приходили делились результатами исследований всего что происходит и ребята сетевики Я прихожу я Ну как модель ато знаю Ну нормально хна Но то что там сетевики рассказывали Я половину слов у меня так это в одно ухо влетает вылетает какая-то Пони и радуга восхищаюсь севика не понимаю на каком языке они разговаривают это высшая когорта самые лучшие люди вот разбираемся с сетевика вот у нас вот эта эпопея длится в течение полугода проверяют между физическими тачками между дата-центра между нодами внутри кубера между разными подами внутри кубер в общем ребята Всё проверили что можно говорят Да нет проблемы в сети всё хорошо но смотрите вот всё вот в рамках того что ну как бы ожидается всё всё правильно работает ищите что у вас А как А что может быть у нас Мы же просто по сети клиентам забрали данные отдали Как искать эту проблему вот ну в итоге спустя какой-то определённое время мы пришли догадались В чём пришли к причине догадались что же происходило а происходило вот что у нас исторически так сложилось что трафик от сервисов идёт через основной балансер то есть у нас есть основной балансер на H прокси он балансирует на 3dc по раунд рону иногда по стики S Но в основном по раун рону дальше прилетели в куб куб через Игрес отдаёт в сервис и вот на вот этих вот всех хох мы и теряем наше время наши вот эти вот 30 миллисекунд Да оно вот вот настолько оно бывает тяжело работает Зато у нас есть балансировка и C Breaker и мы можем вывести оди сот в Maine то есть мы на просто переключили сказали чтобы туда трафик больше не балансиром на одном Ду дальше проводить ною когда поменьше трафика Мы в два дата-центра пустили трафик один вывели и можем и нагрузочные проводить разные то есть сценариев масса Это довольно важная штука особенно когда мы в нескольких дата центрах живём чтобы можно было где-то выводить выводить дата-центры Да и приложения в но как же мы тогда э фи на сервис нейма в кубе то есть вместо того чтобы идти вот через вот эту всю цепочку через пси 3dc кубы ингресс мы просто напрямую в одном и том же дата-центре прямо напрямую постучались в сервис и видите Ну время выросло просто в разы в разы пр стало намного лучше Окей но что происходит-то мы получается Discovery делаем через у нас отваливается так как у нас все напрямую теперь ходят мы не можем просто выключить какой-то один сервис у нас нету балансировки Если вдруг какой-то трафик пойдёт мы теряем Ну много что теряем Да какое же решение ИЗО всего этого отдельного слайда про это не будет решение сервис ш мы на него переезжаем переехали большинство сервисов уже переехали в целом всё хорошо и скорости сопоставимые с временем время ответа скорость сопоставима с временем того как мы работаем по сервис всё супер Вот Но кроме этого кроме сервис меша как ещё можно оптимизировать Мы ещё нашли несколько способов и один из этих способов на самом деле оказался наверное и прозаичный довольно но неожиданный всё что мы делали на самом всё что мы делали описано в статье тут есть ссылка на статью она правда внизу наверное не всем видно но на хабре Можете просто вот загуглить вбить в Google как в вос раз количество ДНС запросов в Гош вот мы пошли По этому же пути там на самом деле в ЧМ прикол ушке свой DNS резольвер и Гошка ходит по ipv6 там как ты отключай не отключай она всё равно старается по ipv6 долбануть ipv6 Ну тормозе то есть нам нам нужно было по ipv4 пустить трафик и в итоге как мы к этому пришли мы не смогли просто взять и в контейнере отрубить иначе контейнеру надо давать это тоже оден пробле Ну это priv это как бы довольно безопасники бы не пропустили это вот мы начали просто писать везде пакеты и отключать прямо вот на уровне нашего приложения Да приложение не до конца это знает так как мы вынесли логику в пакеты но тем не менее получается на уровню приложения Мы весь трафик в ipv6 подключали как http клиентов так и jpc клиентов то есть прям ну какой-то базовый пакет все клиенты к ресу к поре к мулу вот это вот всё Мы везде подключали и стало лучше Вот график по отключению ipv6 вот было опять же стало и кажется что у нас просто вот вот тут вот такая лесенка лесенка лесенка идёт и потом Бах просто трафик перестал но нет там там внизу такой маленький маленький маленький график насколько стало лучше То есть получается было стало Да кроме этого к сетевикам мы пришли и говорим ребят Вот у нас вот какая-то проблема тоже с сетью нам сказали слушайте вы у вас образ на апай Вот пока у вас образ на апай Вы к нам даже не приходите мы переехали на Debian не знаю говорю абсолютно какая-то чёрная Уличная магия переехали на Debian стало вот так то есть тоже Э не настолько критично как с IP в с ipv6 на ipv4 отключение ipv6 но тем не менее Вот стало прямо намного намного лучше два слайды на эту тему где второй вот он вот тоже да видно где-то в 1515 Вот вот этот вот вот и дальше после 15 да что получилось Ну кроме этого когда работаете с сетью не стоит забывать что нужно всегда оставлять ядро одно на сеть И как я уже говорил сетевики абсолютно просто уникальные безумны мной любимые люди на хабре есть классная статья про то как тюнить куб для того чтобы там вот вот отдельно проц выделялся на сервис отдельно про нать выделялся этому пришли мы эту статью прочитали очень классная ничего не понятно но просто не забывайте что ядро у вас всё-таки должно на сетку выделяться иначе начнутся проблемы с трот и тому подобными штуками и ну по сети у вас начнёт н скакать особенно в высоких перцентиль Ладно lency мы починили Всё у нас стало всё хорошо но вдруг у нас есть один из очень таких нагруженных сервисов проо заводится инцидент званию дежурных время выросло ответа в два раза начинаем ковырять смотреть что там происходит начинаем смотреть логи видим база стала отвечать в два раза медленнее обычные вроде селекты стандартные что происходит непонятно ответы все начинают Ну то есть по цепочке всё это начинает складываться и там э доходит до пользователя начинаются даже до пяти соток на уровне пользователя а всё из-за того что сервис стал отвечать продукт инфо больше 100 миллисекунд В девяносто девятом пенти опять наши те самые нефункциональные требования Ну что что идём идём к сити викам опять спрашиваем ребят что происходит давайте давайте как-то починим что у нас что что у нас не так а у нас на самом деле всё так сетевики посмотрели сказали но у вас выросло на сетевом диске latency но в рамках погрешности всё нормально было видите совсем ну там больше меньше э од миллисекунды стало 4 миллисекунды но прямая цитата 4 миллисекунды на виртуальном диске - Это хороший показатель мы такие а ну хороший показатель ладно то есть ничего не делаем они такие да нет ничего не делаете Это у вас приложение просто так плохо написано мы начинаем что подкручивать приложение подкрутили вроде всё хорошо замели под ковёр Ну нормально что-то Вдруг у нарез вдг вырос потом упа Ничего страшного бывает дано вот червь сомнения он как бы продолжал грызть душу по чуть-чуть и тут Наверное нужен слайд на что было дальше какое-то так что было дальше Ну конечно мы снова упали и намного сильнее потому что мы так и не поняли Почему у нас резко вырос н и спустя как после того как мы пролежали хорошенько и провели нормальное исследование в чём была проблема оказалось с боил на диске сборщик кликхаус вот Казалось бы Ну в общем такой вот такой вот интересный тоже инцидент Так что тут Если вдруг что-то ведёт себя как-то странно и неожиданно то лучше всё-таки дожимает намного больнее что ещё может произойти что у нас не так с кап теоремой когда мы говорим только про cons да на самом деле у нас может произойти взрывной рост трафика тоже У нас был такой забавный инцидент с этим связанный сайт переехал только-только в 3dc и у нас вот тот самый друзь который картинку показывал с Александром друзём в него пошёл трафик и все кто за ними тоже Он там довольно много делает по цепочке запросов тоже во все тдц в общем большое количество трафика побежало а Егерь находился только в одном дата-центре и не было настроено Никакое сэмплирование и получается Весь вот этот вал Трей сов повалил в один дата-центр в один канал и мы положили просто весь весь канал сложился всё один оди сот просто вылетел довольно мощный инцидент был так что не стоит забывать что что-то может ваша когда вот особенно распределённая система у вас несколько дата-центров что-то может пустить такой довольно большой объёмный жирный трафик что может вполне отрубить целый цот у нас даже подобное происходило сравнительно недавно когда бухгалтерия тоже что-то там решило какой-то Дамп из одного дата-центра перекачать в другой а там здоровый хороший жирненький Дамп и как-то они там в много потоков так ухитрились запустить Что опять же нам сеть положили Казалось бы у нас ну 25 Гигабит д плюс два канала то есть суммарно 50 Гбит но такое тоже возможно Да итак про инциденты вот первое ошибки в коде 21% это когда сложная логика и что-то происходит не так и у нас контемп плохо нарезали и мы там не можем Теперь нормально протестировать наше приложение и повышенная нагрузка на сеть то есть на железо на наше 13% это за последние полгода то есть ну самый топ первые топ Две позиции Итого теория и практика на самом деле по микросервиса в теории да ба Конте и вот этот вот мы сделаем идеально у нас не будет пересечения каких-то каких-то доменных областей у нас будет ВС вот контек Будут ограничены Полностью мы не не будем брать чужую логику это редко бывает на самом деле не всегда получается и ну причина сам по себе проект в котором мы живём мы живём не в каком-то теоретическом вакууме А мы контактируя с другими сервисами с другими командами и с бизнесом вот катере избыточная ВС описва ВС хороо но она не описывает наше железо и иногда это нам довольно больно стреляет в ногу Ну и самый такой забавный интересный миф который наверно который наверное можно было бы потратить чуть больше времени чуть интереснее его рассказать что расходы снижаются Ну раз у нас становятся микросервис они такие все оптимальные Нужно меньше снится рады самра Работать со всем этим намного сложнее чем просто с маленьким Уют монолитом Спасибо Давайте зададим вопросы но сначала друзья возьмите пожалуйста мобильные телефоны соска Неру ите пожалуйста - кодик который левее програмному комитету потому что даже когда кого-то дрюш нужно дрючить от души и по делу можете быть уверены со спикерами это происходит их сначала хвалят потом собственно Мы работаем И потом снова хвалят вот принцип бутерброда обратная связь Вот это всё вот да это запомните этот день это доклад в которым спикер со сцены сказал что кликхаус тормозит ой Упс Да ну погнали Можно пожалуйста вот сюда микрофон задаём вопросы друзья из интернетов тоже пишите пожалуйста Здравствуйте спасибо большое за доклад очень интересно Меня зовут Яна Tech У меня вопрос такой Если бы вы оказались в волшебной ситуации когда у вас есть возможность написать всё это с нуля при этом бизнес-требования кейсы фры и фры насколько бы вам было легче то есть а если перефразировать то вопрос такой М насколько ну сложность предметной области влияет на то возможно ли использование микросервисов или это не подходит интересный вопрос помни что это вопрос от безопасника Окей на самом деле я вот я вот соображаю да Можно что в другом Что что в одном что в другом использовать микросервисы Они то есть Основная это причина для микросервиса всё же у нас связана с с ростом бизнеса опять же и с бизнес требованиями насколько легче не легче по предметной области часто бывает даже знаешь проблема не в том что предметная область сложная и не сложная А проблема в том что Особенно это касается монолитов с долгой историей в том что люди которые знают как какой-то кусок работает их уже давно нет или никогда не было и вроде бы и кусок Тото несложный но туда отправляется Вот на этот на этот маленький один кусочек отправляется аналитик аналитик что-то нашёл а оказывается не Всё нашёл То есть это прямо Ну вот вот Реальные истории когда мы прям усиленно анали какую-то предметную область набираем данные у нас по оформлению заказа Вот пример микросервиса оформления заказа где у нас Была проведена прям отличнейший аналитика Мы целый квартал делали аналитику там люди разбирались в коде и потом когда начали писать оказалось ещё столько ворах Таких кейсов вот коллега Кири Нест соврать что вроде бы Ну на самом деле Ну то есть что там оформить заказ Ну это же не сложно Ну какая тут предметная область а оказывается нет сложно и Отвечая на вопрос Наверное я скажу что да Если у вас всё отлично супер у вас идеальный мир у вас всё супер Отлично расписано и прямо вот всё идеально есть функциональные требования не функциональные требования бизнес-требования всё отлично Да скорее всего у вас легко пойдёт микросервис Но не это не Точно Отлично Да Здравствуйте Игорь компания акод про de и вы уже сказали что чёрная дыра непонятно что это а вот как сетевики аргументировать переход от ipv6 к ipv4 я не очень понял в чём была проблема а Да тут Ну не совсем сетевики это мы уже дальше там сами раскопали Дело в том что там вот это вот Боже мой э статья про то как уменьшит количество запросов в восемь раз Дело в том что Гош DNS resolver он всё равно всегда долбит по ipv6 А ну то есть пытается зарез Вить и по ipv6 и по ipv4 и это всё как бы ну даёт дополнительные дополнительный лаг он сначала в ipv6 долбит потом в в ipv4 после того как заревел дальше Идёт уже запрос вот Ну и по ipv6 сам по себе resolve дольше происходит Ну так сетевики аргументировать да будь добры Да Иван Спасибо за доклад такая тема монолитов и микросервисов вечная для Хайда я не очень понял два момента первое Почему вообще полезли Ну в распил Монолита потому что ну вот бизнес Поставил какую-то цель роста Да и интересна мотивация и второе Раз уж это уже происходит какой выхлоп то есть Есть ли уже наблюдаемый результат что там стало лучше или стало хуже или Да конечно конечно да ну основная причина опять же рост бизнеса и Мы понимали что мы дополнительно не можем даже масштабироваться в рамках одного цода то есть доки ды какие-то ресурсы так как упёрлись в количество места в стойках и в объём электричества который может обслужить сот Это был первый момент Ну то есть Мы понимали что нам дальше нужно расти мы проводили нагрузочное тестирование и понимали что ну у нас происходит постепенно то есть от квартала к квартала мы видели замедление ответа карточки товара листингов Мы понимали что дальше такими же темпами у нас там совсем просят эта Метрика по времени ответа и по нашим подсчётам там было у нас была был запас X 15 X2 от нагрузки на тот момент когда мы вот ещё не начали пилить усиленно Монолит вот Карточка у нас отвечала за по-моему полторы секунды карточка товара Вот чего мы добились тем что кое-что полили кое-что подорова самую наверное сложную логику даже не логику а са большое количество объём данных мы вынесли вот в прок info Где вся основная информация по товару которая отвечает Толи за 10 то ли за 20 миллисекунд вот мы добились 900 меньше секунды Ладно 900 миллисекунд у нас на следующий квартал стоит цель мы добились одно секунды меньше оно секунды время ответа по карточке товара это благодаря этому распилу и по текущим по текущему нагрузочному тестированию на x22 с по3 даже иногда порой получается зависит от профиля у нас несколько разных профилей нагрузочного тестирования Вот но то есть уже уже прям есть то есть мы сняли разблокировали для роста бизнеса возможности то есть мы можем расти дальше если бы мы не начали распиливать это всё Мы просто наверное уже сейчас бы мы падали и лежали особенно когда приход УВО пишите мне я могу предоставить у нас Мы сейчас разблокировали функционал фидо можно спокойно Забирать икки там основная информация по товарам всё есть пишите мне я вам предоставлю доступы хватит нас долбать ботами пожалуйста Да Георгий группа У меня два маленьких вопроса Первый вопрос какие у вас были с до того как обща с сетевика и какими они у вас стали Это первый вопрос а второй а какие вы рекомендации дадите как общаться правильно с сетевика Какую информацию им выдавать потому что у нас тоже такая же проблема с ними и вечно приходится доказывать что ты не Осёл причём смотри тебе этот вопрос задаёт человек который на зарядку телефон прямо в щиток поставил ме пром пожалуйста Так по первому вопросу с чем мы приходили к сетевикам на самом деле вот с кучей куче графиков из афа показывали коннекты D Ревы пря много-много всего то есть весь профиль который можно снять с клиента мы снимали показывали нам для доклада А такое на будущее о том как общаться с соседними командами А в частности С командами сре devops сетевика да А тут нет Серебряной пули на самом деле вот не знаю наверное наверное сейчас лишнего под запись скажу но во всех компаниях где я работал довольно тяжело приходилось у меня вот общение С командами инфраструктуры как-либо ровно это научило Ивана улыбаться да что туже самую фу когда Говори С улыбкой вообще по-другому воспринимается поэтому смайлики начали ставить чтобы все не думали что ты издеваешься когда пишешь текст да да самое Я отвечу на вопрос наверное лучше не переписываться а вытаскивать на звонок потому что ребята тяжело когда вот когда начинается какой-то конфликт самый начальный лучше сразу вытаскивать на звонок и разговаривать Иначе в сла кажется что ты ВС время кого-то подь я пытался вспомнить по очень хорошее слово в деловой переписке я однажды начал писать фразу читай пожалуйста моё письмо представляя что я улыбаюсь и говорю это добрым тоном так вот иногда это воз се намерите на заметку это правда потому что текст Человек читает в максимальном негативе потому что большинство из банк а чуть-чуть уточню предыдущий вопрос про какую же проблему вы конкретно решали распилом у вас проблема была всё-таки там Независимый деплой в команд там баунд контекстов или скорости то что ты вроде начал отвечать скорость ответов то что масштабирование и Вот потому что лично в моём понимании если про скорость про нагрузку то микросервис - это наверное не столько вот прямо хорошее решение которое тебе даст именно бусты это можно ведь там позей нарезать А сервис один оставить и реплицировать его Ну Да можно нарезать но у нас Simple Collection вот тот самый про который рассказывал проблема обычно комплексная То есть у нас всё всё вместе было и команды толкающие се локтями и скорость и конкретно в нашем случае то есть вот этот вот весь здоровый здоровый Монолит а его тяжело было масштабировать и он был написан на пых было принято решение уходить в Гош и переписывать на гошкевича и как бы мы выиграем тут скорость сэкономим ресурсы на на железе вот а Поэтому решили переезжать на Гош не будем же мы весь Монолит вот со всеми этим симпл коллек перевозить на Гош то есть ну было логично что мы как-то двинемся в сторону современно молодёжно в сторону микросервиса объединили или переписывали объединили объединили переписывание и да объединили переписывание и вынос микросервиса да Да всё верно Да переход на Гош Да наверное стоило об этом тоже упомянуть хорошее название для доклада Гош дом Да пожалуйста здравствуйте по опыту те же самые люди пишут тот же самый код и делают те же самые ошибки новый лад была ошибка стала распределённая ошибка как вы работали с кадрами в плане прокачивай свежей кровью обучали и так далее спасибо да спасибо классный вопрос у нас даже как бы есть такая вот команда платформенная и прокачивай мы тем что набирали очень крутых гошко к себе во-первых для того чтобы Ну в целом у нас по-другому мы не могли как раз вот благодаря ответу на прошлый вопрос мы по-другому не могли двигаться так как у нас Ну ребята на пых пишут гошко не было Мы переезжаем на Гош поэтому что делаем И правильно мы каких-то пых еров обучаем Да набирали ребят крутых гошко и обучали тех кто хочет развиваться в гошко А это обычно Ну ребята с амбициями Кто хочет развиваться и расти и в целом У нас сейчас очень Вот это наша платформенная Вот мои ребятки вот это вот кор команда они прямо очень сильный Костяк собрался и у меня не продуктовые команды мы именно мы делаем такие микросервисы под ключ нам мы приходим с если не хватает бизнес-аналитики мы отправляем проводить бизнес аналитику дополнительную своих аналитиков системных Solution Архитекторов системных Архитекторов отправляем проводим описываем ТЗ описываем тнф и начинаем уже разработку под ключ причём крутым костяком крутых специалистов которые уже вот ну и в гошкевича ПХП ники которые немножечко понимают предметную область Блин я забрал кого-то слово Да всё нормально просто Минута и три человека сидят уже 7 минут ждут Давайте 2 3 и потом посмотрим что делать Да Иван Добрый день спасибо за доклад Сергей Кунцевич соответственно мы проходили всю эту историю тоже с кровью потом переписывали наш Монолит ловы на микросервис много лет и вот хотел тебя спросить у меня есть какой-то опыт и опыт Все инструменты тоже очень интересен Сейчас Какие бы ты микросервисы первые Ну какой функционал бы носил микросервисы в первую очередь именно Корсо а бы ты вообще не трогал Ставил бы монолите и почему А на самом деле э у нас часть останется в монолите скорее всего не факт что мы вообще когда-то Его распилили Ну экономическая целесообразность какие-то куски это меня кстати даже я этот вопрос задаю на собеседованиях похожий про рефакторинг Да берём в первую очередь распиливаем всегда самые критично важные куски которые подвержены изменениям которые Ну в силу высокого тех долга в силу величины тех долга занимает очень большое количество времени на разработку то есть ну какой-то функционал долить то есть критичные для бизнеса вещи в первую очередь и для скорости наверное да для скорости разработки для скорости ответа вытаскиваются А в принципе в монолите можно оставить всё что осталось некритично Что редко Ну то есть тупо экономическая целесообразность Спасибо был как Car у вас и После перехода на серве Smash Почему также остался prox почему тогда се брейкеры потерялись и второе не смотрели переход на и в котором собственно в уже ибры есть и DNS resing и i46 можно Ну отключать Да но у нас ребята тестировали и и Link это есть у моего коллеги замечательны доклад я хотел его даже включить Вот про про переезд в три дата-центра и там про и сервис МШ был кусок а Наверное я может быть в чате его в комментариях закину на него на на этот доклад там да да да И давай жирную точку и потом уйдём в кулуары Да спасибо Иван Спасибо за доклат смотри два вопроса Первый - это я очень переживал за судьбу карточки товара которая не могла найти себе судьбу нашли куда её пристроить а шильдики Ну шик Да мы его вынесли в пакет хорошо и Следующий вопрос я вот Слушая доклад у меня создалось ощущение что вы делали это как инфраструктур ную задачу была ли поддержка бизнеса и попытка перейти или использовать как-то ддд то есть domain D Design Чтобы бизнес построился точнее сам бизнес сначала определился как у них будет предметной области делиться и потом вы уже на них ориентировались а тут наверное проблема да Отличный вопрос кстати бы да спасибо с пошёл навстречу сказал да ребята распиливать Монолит всё А подстроиться ну как бы это это это слишком много было чтобы ожидать что там будут переформатировать как-то отделы по-другому что-то ребята сказали Да мы и так вот вам даём время на то чтобы что-то распиливать ресурсы пожалуйста что вам ещё от нас нужно ну а там ддд подходы хотя бы верхнеуровнево да ддд подходы верхнеуровнево Я же про это и говорил что с архитектора системный архитектор предприятия всё это нарисовал всю эту у нас структуру по ддд У нас есть Прямо здоровый контекст Map где вот это всё выделено но как я уже объяснял оно не работает из-за того что Ну тупо пришли в другую команду попросили побыстрее отдавать данные не получается пришлось к себе затаскивать сервис один из примеров Ну то есть как говорят в Ростове Баста дальше только в кулуарах друзья Извините я очень хотел но время махни рукой все кто задали вопросы Сейчас Значит надо отдать матрёшку тому кто своим вопросам сделал вклад в сообщество потому что это коллекционный сувенир который из конференции в конференцию будет новый Так так я думаю что девушка Вот замечательна я вот по именим ой безопасника безопасника и сетевикам да да и ТС Digital кому дарит Подарок Ещё раз махни кто задавал вопрос пожалуйста Так а вот коллега Да да да который сказал что все врут и никто не умеет писать да да Что Что нужно нужно набирать людей тебе тоже памятный памятный мерч конференции Спасибо бам Это было великолепно друзья забирайте спикера Ведите его в кулуары"
}