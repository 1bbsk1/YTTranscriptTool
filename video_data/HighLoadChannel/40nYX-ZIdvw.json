{
  "video_id": "40nYX-ZIdvw",
  "channel": "HighLoadChannel",
  "title": "Раскрытие секретов Group Replication в MySQL / Vittorio Cioe (Oracle - MySQL)",
  "views": 535,
  "duration": 1966,
  "published": "2020-04-14T10:47:31-07:00",
  "text": "все обожаем так что я я очень рад здесь вас видеть 2 года подряд некоторых лиц я узнаю спрос я стал них добра прага надеемся что мы графом будет работать так что времени мало информации который я хочу вам как говорится погнали кто я вообще кто я я черт пользователь с 2 тысячи шестом году и пользователям остался пока пришел в 2 тысяч пользователей как вы а як чуть больше знающий моя скилл она и раньше делал разные вещей безопасность цифровая трансформация это ли для тебя катар меня ещё не знают я из италии в варшаве стараюсь говорить на русском языке тут который наверно вы были так что мы сегодня будем говорить о внутри игру прибыли вечером они распевали мы примерно все знаем что такая групп реплей шину наверное не все из нас знают как она работает так что он следующий вещей что такое групп рипли кешен как групп реплики шим управляет транзакции и будем говорить о концепте как такие как optimistic looking уровне consistent насти фрагментация сообщения flow control так то что мы знаем о групп рипли кешен групп реплики сша что ним мы знаем группы облигаций эта технология которая стоит под система вызова и доступности так называемые и на дыбе кластер это сердце и на дыбе кластера и она обеспечивает автоматический failover и автоматически решаю автоматическое решение конфликтов и это было то что я вам более-менее говорил год назад для тех которые были моего спичка про и на дыбе кластер но именно что давай игру привлекающим это сердце и no debe кластера а точнее а точнее это плагин для базы для сервер баз данных аскиан которым внедряет теория которая называется да да да и стоит машине внедряют алгоритм который называется paxus так что групп реплики шин позволяет писать на всех но ты-то с multimaster без без риск чтобы репликацию сама ломалось и она обеспечивает автоматическое аварийное переключение автоматические решение конфликтов работает в двух режим single праймари и мульти праймари пожалуйста вспоминаем что она работает режим a single праймари мульти праймари потому что следующий слайдов этот концепт будет пригодится и это было примерно все что мы знали о группе рипли кеша несли знали больше это хорошо так что как плагин как она создана она создана с 2 слоев и пьян и пья и через которые компонент рада ими сервера связывается с плагина репликации и апиа из которой плагина репликации связываются со всеми остальными узлами пару слов о групп коммуникации system test это внедряет так называемый маски алекс коммуникацию приехал xcom протокол который для пользователи mdb кластер это тот самый протокол который пользуется москвин кластер менеджер и задача простая доставка сообщение для все для все сервировка для всех узлов кластера но сейчас будем посмотреть как это делается чтобы узнать как это делается нам нужно еще иметь знания про 2 концепте что такое в райцентре что такое bright в раритета простая вещь в райт это просто данные который записываются в базу то есть переменные которые записываются в базу а в райт сеты это более слов my концепт который действует под капотом и обычно не видно это хаш прайма реки которые идентифицируют строках где эти изменения будут происходить поэтому из-за этого слова в райт сет примере как она выглядит в рай ты является ты примерно таким способом это bright это событие в берлоге является ты age is primary key ещё другой пример и древня течет идем дальше как групп репликацию управляют транзакции это чтоб волшебно с какая-то магия или нет это не мы это не магия это полу синхронно это полу синхронный механизм который обеспечивает в тон большинство у слив в кластере сертифицировали транзакции до того когда комитет эту транзакцию секундах то я рассказал то что что вижу по лицу тест здесь объяснения со словами не такое хорошее на столько сколько объяснения с изображениями так что у нас съест транзакция когда приходит этот 3 это набор групп реплики шин который состоит из трех узлов она может состоять из нечетные количество т-35 79 дальше придет транзакция на узел номер один тест бегин всякий там запросе и комменты и после того когда транзакция пришла идет репликация и идет сертификация ну что это обычно я покажу такие вещи ну что под этим блоком и при репликации скрывается что тут скрывается тут скрывается коммуникация между узлами доест первый год отправляет информации остальными нотами это делается через обещание бродкаст важный момент не сетевой бродкаст а сообщение всем нодом который можно назвать бродкаст и получает от теста ок от самого себя и ок от еще один узел и в этом моменты мы достигли информацию что у нас съест а как большинство родов так что в этот момент у нас оставим плюс один большинство транзакция может сертифицироваться потому что большинство нодов сказали ответ или что да у меня это транзакция езд и можно уже дальше ты потом и потом прийдет тоже aquis 3 года так что когда транзакция сертифицирована она идет влоги данного узла и как и как мы видим эта транзакция не сертифицируется одновременно когда большинство сертифицировался она идет влоги 2 масла и уже на первом тест на not который я получил идет commit а то что случается 3 это случается уже потом тест после того когда транзакция ost блоги большинство у слов она кормилица и ответ выдается и остальные ноты потом себя обрабатывают транзакции скамьи комментируют так что такое сертификация сертификация это процесс который отвечает на следующий вопрос и можно данную транзакцию к метит и это базирует основаться на транзакциях которые еще не комментировали сейчас посмотрим как это работает так что сертификация работает следующим механизмом тест существует очередь транзакции и узел получит сообщение из очереди сертифицирует транзакцию и потом отличается на вопрос транзакция локально если до отправляется результат поток поток который отвечает за светит за клиентское соединение и одновременно выдается ответ если нет сертификация прошла позитивно тест эту транзакцию можно комментировать не от конфликты и так далее транзакция добавить добавляется влогах и одновременно случаются 2 вещи первая вещь которая случается транзакция выполняется и вторая вещь которая случается идет об layan дальше это то что я показал было с одной транзакции но мы знаем что в моей астральная я снова стоп mazda базальном уложу получить одновременно множество транзакций как это работает это работает на основании get a и d по которым мы уже слышали в предыдущем доклады тоже и но в групп реплики шенги 3d выдаются двумя способа автомате автоматическим тест они автоматически прицепляются к существующую транзакцию во время commit a и тоже пользователь может вручную выдавать гтд через перемен на сет через команды set гтд next так что как это работает чтобы была полная доставка транзакцию это примерно 5 на 5 узлов так что 1 31 узел делает кормить транзакции и соответственно отправляется сообщение бродкаст самого себя и остальным потом и другой узел делает тоже commit транзакции и отправлять сообщение идут аки из большинство узлов и kak tolko a key получены транзакция добавляются в очереди и так далее и транзакции идут в очереди из которые остальные узлы могут себе этой транзакции почитать это прям окна так работает и сертификации как мы увидели состоит именно состоит именно этом взят транзакцию из очереди и делать все проверки которые мы смотрели и дальше дальше так что этот пример не совсем соответствует реальностью по делу когда когда brighter поставить блок с джи кей и есть детстве возможностей est возможности когда это записывается в сингл праймари и из возможности когда это записывается в мульте праймер мульти праймари все в райдере будут воспользоваться гетто и ддт де который находится в их их место в очереди так что что случается после кабмин после commit a синхронная репликация случается в то механизм такой транзакция выполняют транзакция упс выполняется идет в берлоге из берлоги реплицируется синхронную репликацию реплицируется когда-то неважно когда когда когда остальные серверах себе почитают спи логе потом идет commit и совершенно независимо сервер мастер будет от будет выдавать ответу полу синхронно репликации что случается то транзакция выполняется идет берлоге записываются в или и логе и когда когда идут аки на мастера она делает commit и выдает ответ и что случается вдруг в группе рипли кеша стран как мы видели транзакция выполняется потом и идет тот процесс который мы видели где набирается консенсусом и пока консенсус не набирается мастер ждет первичный сервер ждет и только после того когда хаки про больше строим когда aquis информации который был шестую кто большинство сардар и получили транзакцию имеют ее блоге выдается коммент что это значит что мы сможем иметь какой-то удаленный узел и он может себе с комитете отвечать потом когда он хочет нет потому что все равно система выделение консенсус требует чтобы после связались по сети между собой и именно ожидание если мы будем иметь удаленный но тест гиа распределенный кластер именно когда первый первоначальный процесс пойдет мы будем получить задержки так что консенсус кантор винсе мест окно транзакции который групп рипли кешен может одновременно записать 1 транзакция пошла и окей под он идет набор транзакции и пока все не запись пока с я не и пока не пройдёт сертификация 7 новые транзакции встают в очереди и даже дальше optimistic локинг то есть оптимистические лакирование что это такое это очень простой концепт тест это используется в мульте праймари чтобы решать конфликты это очень простой концепт тест вся сервера который получат транзакций стараются их комментировать есть вы их выполняют и только в момент a commit обнаруживаются если есть ошибки если езд конфликты или нет тест традиционные локинге это то что мы всех знаем и оптимисты оптимистические локинге работают следующим способ транзакции асд-2 услышал имя транзакциям неодинаковые тест конфликт не они от больше чем одинаковый и 1 старается комментировать и 2 старается комментировать и здесь конфликт решается как конфликт решается вы помните про great set и вот когда в рай 10 получен не каждый из них имеет серене номер тест гарсия у кого версия меньше тот побеждает и кто не кто проигрывает по выдает ошибку tst злым использую мульти masters приложения которые которые возможно может создавать большое количество конфликты прилагаем должен знать как управлять эти ошибки что с ними диалог просто это процесс который я объявляю этот процесс который я объяснил и consistent нас уровень consistent нас тест этот этот концепт похожи по моему мнению на транзак шина изоляция только применяется всем применяется к целую группу так что есть некоторые равнее consistent нас на который можно настроить первый называется его на тест по умолчанию нет синхронизация между нодами когда транзакции приходят и когда мы когда мы отправим на запись на ноды она даст она будет вы по она будет выполнится без информации если другие ноги получили точно такой же потом идет уровень консистентной be for и до того когда запускать транзакцию все но без синхронизируют информацию про то что они получили и идет after the east все ноги синхронизируют информацию момента commit и идет даже before астер вот before автор этого очень интересно потому что тогда кластер действует как одна большая но да но важный момент только для пользовательских соединений а то я столько для пользовательский поток раз потоков репликации это не применяется к потоков репликации а то то что получилось бы это больно это было бы полностью с реализованы юар клод и производительности пострадала бы фрагментация сообщение что случается когда сообщение балчи они фрагментируется тест выходящие можно фрагментировать выходящие сообщений и можно фрагментировать приходящие сообщение тест еще момент если выходившие сообщение больше чем то что пользователь позволяет она фрагментируется и узел который фрагментировать сообщение отправить все фрагменты ко всем остальным услад группе дальше когда сообщение полученный они тест получают по очереди по очереди сабирова они собираются по очереди и к с каждый каждый узел почитает себе из x комната есть из группа коммуникации первый фрагмент и по очереди собирает собирает целого сообщения и подставить тоже собирает в конце последний фрагмент flow control что можно услугам тралик поговорит это очень большой описание что зависимо от ситуации нагрузка каждый not решая каждый год решает немного замесами замедляться но это то что это может хочешь сказать можно этой этой картине очень хорошо посмотреть потому что как по предыдущему примеру очень много то есть некоторые изображение всегда лучше чем очень много слов дальше начинаем транзакция выполняется потом идут набираем информации повара и цвету и требуется тратил да и если до идет опоздание до следующего flow control перед если нет сообщений отправляются в групп коммуне кешен систем и групп коммуникации идет сертификация результат сертификации и ожидания и тест ожидается результат сертификации от трат сертификации сертификация прошла успешно да как и нет ромбик и это то что случится на всех узлов это очень похоже на то что мы раньше видели test run' отправляются сообщения со статистикой в группе найдутся узлы с очень большую очереди не от очереди на всех у слов нету трата активный ясли да мы отпускаем этот strata постепенно а если нет считаем квота то есть минимальное о минимальная емкости на количество в рай ты и это случается то и если целую если но если я страдал на все узлы на некоторый на несколько углы дальше что я хотел чтобы вы вспомнили от этого всего очень много конца тем очень много идей но в основном я хотел чтобы вы вспомнили как групп как игру при плетешь им управляет одна транзакция потому что то что случается со многими транзакциями о котором мы кратко говорили это автоматически механизме контроля как вы видели но я хочу чтобы вы вспомнили эту картину тест транзакт он идет и да и транзакция раз привет отправляется всем узлам если когда большинство отвечает что получили я с ним формате а больше 100 болшие большинстве в группе достижимо и выдается commit вопросе вопросы да и графон я повторю вы все слышали хорошо так что если вопрос было если узел очень большая очереди транзакции которые стоят в очереди будут в измене сразу или после того когда о череду magic хороший вопрос так что в этой случае лакан нет ран за тест локальные транзакции будут выполнены будут выполнены потом будут выполнены потом зависит когда тест транзит транзакций в группе а не комментируются в определенном порядке тест если есть транзакцию что уже в очереди который ждут с других узлов локальные транзакции будут выполнить commit выдается потом но это не мешает процесс сертификации уже начинаться другие вопросе чашка никто не хочет хорошо так что если будут дальнейшего просека мне пожалуста может можно можно поймать меня в стенд моя скилов который стоит здесь за углом у нас единственный вопрос побеждает соответственно как лучше вопрос спасибо вам за присутствием спасибо вам"
}