{
  "video_id": "XMEhLToZ7H0",
  "channel": "HighLoadChannel",
  "title": "Граф связности служб как навигатор по архитектуре систем компании / А. Максимов (Электронный город)",
  "views": 640,
  "duration": 2035,
  "published": "2019-12-05T13:08:50-08:00",
  "text": "собственно начну я с того что расскажу что такой электронный город электронный город это больше чем интернет-провайдер это просто провайдер связей у которого достаточно широкий спектр услуг и продуктов которые вы видите на слайде и это не все продукты тут есть и интернет домофона охрана видеоконтроль мои счета умный дом недавно появился и нужно понимать что вот эти все услуги и продукты они создают большое количество бизнес процессов которые нужно решать и решают достаточно быстро поэтому в электронного города есть сайте подразделение которые условно можно разделить на две такие группы это продуктовые команды которые нацелены на конкретный какой-то продукты и там например команда и сылка личного кабинета они решают задачу связаны с личным кабинетом и есть сервисные команды которые делают какой-то сервис и потом этот сервис и используется в различных там переиспользовать другие команды это сервис и например в одной из таких групп нахожусь я это группа сетевых разработок у нашей группы всего лишь древесными задачей это учет ресурсов и топологии сети оборудования а также автоматическая конфигурация и настройка сетевого оборудования вот собственно как это все происходит сейчас я пишу небольшой такой кейс чтобы вам было понятно есть у нас клиенты которые иногда они уходят по балансу в минус и понятно дело что услуга для них там приостанавливается либо как-то ограничивается группа моей сэр она нам как-то сигнализирует об этом мы изучили де читаем сообщения такие понимаем что нам нужно с ним делать у нас есть сервис сот который собственно берет эти данные и собственно он служит для того чтобы ограничить доступ абоненты либо наоборот открыть доступ абоненту и он идет в базу данных получает оттуда какую-то информацию и затем идет к драйверы это другой наш сервис который принимает на вход унифицированные какие-то данные или и команды и потом уже он знает как работать с конкретным видам тут не секрет то что у каждого вендора может быть своя какая-то особенность и свои какие-то методы спецификой работы и более того даже у некоторых моделей там коммутаторов бывает разная api поэтому драйвер определяет что это за winder что это за модель и уже работает с этим коммутатором далее у нас есть сетевой админка в который там оператор может зайти посмотреть как только он нажал там посмотреть идет в сервис сетевых ресурсов сервис сетевых ресурсов идет в базу данных сети далее он еще идет в глазу где есть какие-то ресурсы дополнительные все это выводит и в чем собственно проблема проблема в том что у нас по наследству досталась такая архитектура где есть у одной базы несколько так сервисов то есть там в данном кейсе у нас два сервиса используют одну базу и какие собственно проблемы отсюда возникает то что и когда приходит задачи мигрировать данные с одной table в базы данных на другую потому что в данном случае это у нас со быть который сейчас почти никак не поддерживается и в данном кейсе я хочу рассмотреть то что мне пришло задача убрать из таблицы ресурс какие-то поля и что я делаю я беру во-первых смотрю на базу данных смотрю какие есть пользователи по этим пользователям понимаю что это какой-то сервис в данном случае сот использует эту базу данных я смотрю логику этого сервиса и понимаю что эта логика завязано еще и на драйвере окей дальше я смотрю еще один сервис по грантам по пользователям и вижу что еще один сервис используют этот же базу данных там для отображения собственно такой клубок можно распускать долго и если у вас там не один сервис завязан большое количество на одном глазу это вызывает некую проблему вот собственно что хотелось бы видеть хотелось бы видеть вот такой вот граф под графом мы понимаем что у нас есть узлы узлы это наши какие-то сервисы либо базы данных либо какие-то сторонние сервисы а связи это ребра который нам также помечают данными то что там по какому протоколу взаимодействуют или еще что то такое но мне-то какая то информация и по такому графу ну могли бы быстренько ориентироваться и понимать кто с кем взаимодействует и как тоже распутывать собственно о чем сегодня мы будем говорить о том как о том о том что затем еще нужен нам такой граф но это нет не единственный кейс который я вам только что рассказал таких кейсов много далее разберём эволюцию как наш граф там прошел разные этапы там от самого простого до были мини сложно далее увидим как граф связанности и решил нашу проблему ну и подведем итоги собственно а зачем вообще такой граф может нам пригодиться граф связности нам может пригодиться когда приходит новый сотрудник что мы делаем мы говорим там вот у нас есть такая система рисуем на 6 разные сервисы как они взаимодействуют с друг с другом то же самое собственно и делает графон просто это показывает есть мы могли бы сэкономить время и погрузить ново сотрудника гораздо быстрее чем просто вспоминать разработчик должен прийти вспомнить как у нее это все связано показать это лишний проблем далее для бизнеса когда бизнес приходят к нам с какой-то новый бизнес идеи лишь бизнес процессам в принципе он может на первых этапах хотя бы посмотреть на нашу схему на нашу архитектуру и из этих компонентов как-то составить какой-то там первый прототип чик и это тоже нам может помочь граф далее для тестировщиков тут кейс то что регресс проще выявлять то есть когда у вас сервис зависит от большого количества сервисов других то мы это видим на графе и можем идти данные использовать также тестировщики сказали вот было бы круто сейчас мы там для того чтобы поднять тот же сот мы в конфигах указываем он зависит от этого от этого от другого там как он сервисом от драйвера допустим а если у нас есть гров связанности эти данные мы можем потянуть спокойно с графом и все поднять быстро собственно далее для разработчика это тот кейс который я писал так же такая же проблема может возникнуть ну покрайней мере у нас возникло когда мы работали с очередью и нам нужно одно сообщение было подправить и посмотреть кто уже сообщение использует собственное едем дальше для эксплуатации то что когда вы знаете свою архитектуру знаете что у вас есть там в конце где-то база данных и если есть становится очень плохо то вы можете спрогнозировать на что это собственно сыграет и какие сервисы у вас могут отказать а если у вас отказывают какие-то сервисы то вы можете сказать какие продукты у вас могут там сыр грызть далее да ладно далее вот такое талон я себе обозначил и мы сегодня к этому эталоны будем стремиться что это эталона есть вот у нас есть собственно узлы есть некоторые информации о том какие методы используются например это пинг и конфигурация и такой к этому эталону мы сегодня будем стремиться чтобы наглядно показать как это все работает мы будем постепенно проходить по этапам которые у нас были в компании собственно далее начинали мы с ручного контроля то есть у нас был просто регламент этот регламент придумали еще до моего прихода это больше чем три года назад просто идея была заключалась в том что у нас есть какой-то файлик и либо еще какое-то хранилище в нашем случае был просто файл где мы брали разработчики и когда создавали какой-то series говорили что я создал такой то сервисы у него есть средством с другим сервисам и тем самым мы рисовали нашу архитектуру вот и талон которому мы стремились но тогда мы о нем не знали а вот что у нас получилось на первом этапе изначально мы отказались от каких-то деталей то есть мы просто фиксировали что есть у нас связь между двумя узлами и говорили что работает там по такому-то протоколу и все и в принципе это идея была очень хороший она нам помогала на каких-то архитектурных встречах понять как у нас все это работает когда он сам сервис очень много это помогает далее собственно ну прошли какие-то годы добавились команды и по факту нас граф там немного пострадал потому что какие-то команды забывали о регламенте плюс то что команд становилась всё больше и больше надо было каждой команде гарри что у нас есть регламент ребята вот вы внедрились подождали норрис зашли файлик поправили его это было муторно и и мы поняли что идея сама хорошая но она не особо работает когда у вас там камани большое количество людей собственно вот так выглядел наш монстр здесь отображены не все кстати команды некоторые продуктовых команд здесь нету вот вы видите что с таким монстрам же работать очень сложно тут целое искусство как добавить новый узел и при этом соединить с другими узлами и при этом как бы поменьше связи и кто-то просто потом уже в общем говорил ладно я нарисую какую-нибудь стрелочку чтобы она была лишь бы и все раньше было это все аккуратно а потом превратился вот такой клубочек где распутывать было сложно уже далее мы сделали какие то выводы для себя конечно это просто реализация она давала свой профит но и были минус это что вся рутина ушла на разработчиков то что они должны держать в голове во время переносить эту информацию на какой-то наш носитель в виде файла ну и плюс тут человеческий ресурс и он стрелял то что не все вспоминали об этом ну и плюс отказывались от такого инструмента потому что с ним тяжело было работать далее мы начали работать думать над этим что мы можем сделать и тут первая идея который было это мы могли бы взять сборщик проекта например джаве есть три сборщика проекта ну таких самых популярных граду movin' on и понятно дело что каждый сервис он там имеет какие-то библиотеки сам по себе голы сервис не стартует обычно мы используем библиотеки и эти библиотеки нам могут подсказать что собственно в этом сервисе есть вот пример конфигурации я вырезал все лишнее стоял такой зависимости по этим зависимостям мы в принципе можем их по ключевым словам отфильтровать и понять что здесь у нас используется база данных здесь используется какой-то клиент и таким образом мы получим вот какую то такую картину далее когда мы получили такую картинку мы можем собрать все эти данные с наших проектов со всех так как они находятся в репозитории эта задача достаточно тривиально просто скачиваем все фильтруем и строим наш граф вот такой графон хотели получить ну по крайней мере сегодня мы его получим то а вот что мы получили на первых этапах то есть гров конечно не то что не полный и связи у него почти нету плюс возникли какие то проблемы то что у нас сервис может использовать несколько баз данных с одним драйвером и просто некоторые информация не хватало но с другой стороны здесь есть плюс можно сказать в том что это уже какая-то automitive автоматизация и рутина потихоньку уходила далее мы сделали как всегда выводы для себя какие то то что конечно реализации простая все минус почти сохранились ушла только рутина частично но и в режиме реального времени и там никакой информации мы собственно не могли получить потому что данный это были статичны шли дальше дальше у нас был подход мы брали наши конфигурационные файлы которые у каждого проекта есть у нас стоит отметить был к тому времени регламент на создание этих каких-то ключей то есть там базы именуются так там с префиксом деби что-то еще и то есть достаточно легко по этим данным построить тот же граф то есть мы берем ключевые слова для себя определяем фильтруем по ним классифицируем что это такое и строим граф связанность но я думаю здесь все просто вот italon вот что мы построили в принципе уже на этом этапе есть все узлы которые нас интересуют есть все связи только вот информация о том что конкретно использует один сервис у другого мы здесь получить не смогли к сожалению но с другой стороны это уже что-то тот же та же рутина которая была раньше далее мы сделали как всегда выводы то что здесь опять же реализация просто инфраструктуры нам не нужно мы все берем с репозиториев скачиваем фильтруем но тут еще выяснился такой нюанс то что все же были такие сервисы которые были написаны до регламента и они начали стрелять то есть связь не появлялась мы парились все к общему виду благодаря этого графу далее собственно мы поняли что унификация конфигов дает свои плоды и детализации у нас была такая грудь связь есть и все этого нам стал не хватать нам нужно больше когда мы посмотрели что есть идея посмотреть просто логии добавить что-то в дебаг и пологом уже построить грамм связанность принципе идея была не плохая на первый взгляд мы попробовали это вообще реализовать насколько это живучий вариант по подняли в тесте наши службы до более какие-то классы в дебаг понимаю поняли что в принципе построить сервис можно также под фильтровали некую информацию стоит отметить что вот это это эталон к чему мы стремились и вот то что мы получили мы получили то что собственно к стриме к чему мы стремились все данные в принципе встали все есть плюс временной интервал у нас появились на сказать что у нас достаточно жесткий регламент как логом был нужно было писать и это нам помогло то что мы смогли построить такую игра в связности достаточно безболезненно но пришлось выводить информацию какую-то избыточную влоги что собственно и стало критичным для нас мы просто не смогли позволить себе такую роскошь и от этого варианта мы отказались но сделали собственно вывода что вариант принципе рабочий но нагружает систему и плюс лишние логе это не очень хорошо тогда мы подумали от рейсинге собственно вопрос в зал а кто вообще у себя использует tracing ладно такой вопрос а кто хотя бы слышал из этих систем каких-нибудь ладно я просто ожидал побольше ноланом собственно есть такие вот системы которые помогают нам я немного расскажу тогда не входило мои планы много на то что в чем заключается 3 sing то что мы какую-то мета информацию том как там выполняется в сервисе там метод вызвался внутри один потом второй потом вызвалась база всю эту информацию мы как бы параллельно ведем следы такие делаем и потом отправляем куда-то в хранилище эти данные агрегируются потом вместе и строится ну как ну граф связанностью нашем случае собственно для нас было важно получать информацию с базы данных так как у нас оба из нас интересует по крайней мере мы поняли что для саба и зам мы ничего не можем найти лучше чем просто проксю спаял нас уже давно использовался мы просто ночь по дружили можно сказать так спай чтобы он отправлял метаданные в жидкин таким образом вот эталон а вот то что мы получили мы получили все что хотели в принцип плюс без проблем с логированием то есть у нас здесь один только плюс вот примерно как выглядит игра в связанности в zip тени я выбрал правда личные связи или какие-то отдельные сервисы просто показать как это выглядит и плюс показать то что какое количество связей сервисов с базой данных так так так так вот здесь так вот этого ради база данных у нас и так вот это да ну вот здесь этот ряд базы данных и и не знаю видно нет то что у одной из баз данных у нас очень большое количество соединений то что все сервисы к ней конектится это собственно наша архитектура такая вот досталось и мы от нее отходили уходим вот собственно как это выглядит зыбки не то есть с какой проблемой мы столкнулись я сделал такой небольшой примерчик чтобы показать вам какая проблема у нас возникло это то что дамы данные отправили в zip кен а теперь как нам эти данные собственных как с ними работать то есть у нас есть тех где написано из кель и как бы сам ейске ельник теперь мы хотели бы эту информацию получить ее желательно быстро но не тут то было чтобы эту информацию получить я должен вести полностью ключи полностью значение и мы надеялись что мы ведем допустим там звездочка но какой-то regex типа звездочка этом название таблицы звездочкой и выведем есть список где использовалась эта таблица но вы мы этого не получили визитки не так же пришлось бы нам заходить каждый раз в такие следы смотреть где конкретно используется этот иск ельник запрос наш это было очень неудобно тогда мы пошли в сторону кабаны посмотрели что в киба не и добавив index и немного пошаманить мы добились такой цели то что мы вводим просто звездочка там название таблицы звездочка и находим все все упоминания где она использовалась а дальше дело техники у нас так вот здесь есть название наших систем и когда мне приходит теперь задача такая дата что нужно например там что-то сделать светит и табличкой то я смотрю какие сервисы эту табличку используют и уже принимая решение что с ним делать то есть пересекается вообще запрос или нет почему нельзя просто было поставить ну там пробежаться открыть все проекты и пробежаться по всем проектам потому что есть рамки который явно от вы не задаете запросы а там пишите какой то не тот а он уже там интерпретируется с запрос поэтому нам нужно было смотреть именно какие реальные запросы есть далее вот талон вот к чему пришли то что как бы это конечно хорошо но иногда есть какие-то скрипты которые собственно в которой добавлять трассировку ну наверно бессмысленно но для полноты графа связанности и было бы неплохо их видеть там админа допустим используют какой-то скрипта нам нужно отобразить чтобы понимать кто использует еще имеет доступ как например к коммутатору таким образом мы могли взяли сделать небольшой прототип чик сейчас это это сервис который у которой есть какое-то и хранилище он из этого хранилища берет данные и добавляет zippy тем самым у нас появляется полная картина нашего графа плюс мы планируем что сделать добавляйте какую-то эта информация которая нам необходима в этот граф и тем самым граф будет расширяться вот плюс надо понимать что такие узлы мы помечаем как искусственный чтобы потом можно было отфильтровать и понять где была где граф построился автоматом а где собственно вручную и какие собственно у сдам стоит верить а какие могли просто устареть вот собственно подведем итоги так и такой ток узнали собственно зачем нам нужен граф связанности какие кейсы он может нам помочь решить рассмотрели по эволюцию нашего графа связанности как он там от самого простого решения там ручного перешел в более-менее автоматизированное построение далее посмотрели как граф связанности нам помог это вот в частности когда мы искали табличку в которой все есть используются два сервиса раньше это занимало там кило часы когда мы ходили по всем сервисам их открывали смотрели код анализировали то сейчас это проще просто зашел в киба ну там сделал пару кликов нажал enter и вывел весь список потом дальше фильтруешь что тебе не интересует и все решение достаточно простой и экономия времени ну и плюс разработчика не не надо грузить такой рутинной собственно так собственно все спасибо за доклад спасибо андрей давайте ваши вопросы поднимайте руки есть вопросы к андрею так есть рука у нас есть рука здравствуйте андрей спасибо за доклад возможно слушал очень внимательно но не пропустил момент относительно того почему все-таки взяли зыбким они того же егеря потому что егерь поддерживает большее количество языков и посмотреть на перспективу то он выглядит более предпочтительны самом деле я вам могу сказать такой открыть секрет что у нас соседняя команда использует егеря и сейчас мы просто сравниваем что лучше и на самом деле игре есть тоже ряд недостатков мы сегодня я на работе тут приезжал и обменялся мнением то есть там не всё так гладко то есть в практике как показала что все же мы будем скорее всего использовать zip кен мы то есть мне сказали что там есть нюансы и некоторые проблемы поэтому пока я не могу сказать почему именно липкин мы просто решили попробовать что для нас зайдет мы пока не знаем просто опыт время покажет есть две группы которые используют один вариант композит кино другая большая команда использует егерь и а там уже время покажет плюс подружить то можно и то и другое не бойтесь зоопарка технологий там еще новый волокон тристен как бы позволяет тебе использовать разную реализацию и объединять еще последний вопрос а у вас код написан на каком языке в нашей группе написано яви есть и другие языки тут в основу все жизнь я вода спасибо еще вопрос около думаем не обратный отсчет начинать так но можно я тогда задам вопрос довольно подожди вы есть вопрос из зала привет спасибо за доклад такой вопрос если я правильно понял ваш граф помогает синхронизироваться с другими командами на когда вы менять какой-то функционал вы знаете на кого он повлияет пологом и с ними как-то договаривайтесь а если одновременно с вами какая-то команда пилит новый функционал который влогах не засветился в них проблемы правильно эту проблему как планируете решение трите у нас есть прежде чем мы какое-то решение выкидываем на бой у нас есть тестовые какое-то окружение где мы собственно берем все пакеты ставим и поднимаем все это окружение и смотрим как это работает нельзя просто взять и какой-то сервис там сделать и как-то его отдать в бой у нас начало в тесте построиться граф такой тестовый мы уже можем посмотреть и уже с 3 сориентироваться также тут есть такая идея то что мы можем смотреть тестовый наш граф и боевой и если например в бою у нас больше узлов то это означает то что тесты наши ну просто нет каких-то кейсов и мы их просто не осветили мы смотрим почему в бою такое есть допустим д в тесте нету смотрим что какой-то кисть мы просто не учли каким-то образом чудесным и просто это нам дает понимание стрелок ничего нету как бы эту команду и не смотрите на тот сервису до кей еще есть да есть пошли плюс на сказать что когда другая команда видит вашу архитектуру вам проще договориться они как бы понимают что у вас происходит и почему вы не хотите согласиться на их вариант то есть у нас такое бывает то что 2 команды каких какой-то конфликт и мы не можем решить его тогда мы смотрим архитектуру одной команды 2 и чтобы не играть на пальцах мы просто показываем вот такой град и так проще договариваться это нужно тоже понимать привет спасибо за доклад подскажи пожалуйста вы трассировки использовать и только для построения этого графа связанности или на основе информации стиралок считаете какие-то метрики аналитику может the leading вас на это настроен но на самом деле и до трассировку мы используем не только для построения графа еще и в других целях чтобы размотать например проблему потому что иногда бывает такое то что там с базой проблема выскочила она только там в конечном каком-то сервисе и чтобы это размотать трассировка нам помогать тоже я думаю что без такой трассировки просто если у вас большое количество рейсов вам будет проблематично жить привет у меня такой вопрос про сэмплирования какой у вас процент сэмплирования трейдинга как вы собираете или и собираете ли вообще ошибочные trace и как вы хакер уйти смотрите процент вибрирования все зависит от на самом деле от системой и что мы хотим получить то есть есть сейчас для нас важно посмотреть информацию о select ах ну или каких-то эскель запросов базе данных мы настраиваем так чтобы у нас например те узлы были за синтезированы а если для нас ну пока не важна эта информация например там сейчас очереди уровень все в порядке мы там стояли на минимум потому что зачем нам этот избыточной информации нужно то есть на самом деле все надо динамически настраивать и зависимости от того что вы хотите получить то есть в тесте да мы можем поставить полностью все сэмплировать и проблем у нас нету мы три месяца живем в тесте и проблем там с памяти у нас не возникает в бою нет так нельзя делать хотела все же динамик приветствуем спасибо за доклад ого просто по version насти ну то есть тигров от графа каждый день может отличаться вот как это вы смотрите сравниваете может быть какие-то лишние узлы добавляются принимаете какие-то меры version нас как version ность вы же можете задать рамки с какого по какой брать данные чтобы построить граф связанность у вас есть какая-то не знаю версия 1 она боевая нет у нас идея конечно есть сохранять графы связанности но вот кейса такого чтобы как-то это нам пригодилось собой нету всегда мы можем в тесте по поставить наши какие-то прошлые версии воспроизвести ту ситуацию но в принципе проблем нету можно как брать конкретный день и этот граф просто сохранять уже ну и ставить версия но мы такого не делали туда хорошо спасибо рук пока нет андрей ты что-то хотел спросить да я хотел спросить а собственно так а сколько у вас вообще сервисов тому кого больше там 200 есть так есть так у кого больше 300 но тогда вопрос вот как вы с этим живете есть у вас нет 3 стинга во мне кажется как вообще распутываете клубки то что у вас там сломалась здесь я стреляет там в другом сервисе как вы это все соединять и если это у вас не монолиту достаточно даешь калоша думается да падет от racing есть вот тогда встречи команда проблем не должно так хорошо давайте еще раз пробежимся поймем есть у нас еще в зале вопросы как обычно даю обратный отсчет 321 андрей тебе надо выбрать вопрос который я понравился больше всего я бы отметил тут вопрос к versio нирования с versio нирования окей хорошо тогда ответ вручаем задавшего вопрос versio нирования книжку мою любимую замечательно она прекрасно там там там вообще каждое слово на вес золота спасибо андрею за доклад уже небольшой презент от конференции вот"
}