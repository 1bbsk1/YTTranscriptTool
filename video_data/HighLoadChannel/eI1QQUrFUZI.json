{
  "video_id": "eI1QQUrFUZI",
  "channel": "HighLoadChannel",
  "title": "Микросервисы с нуля / Семен Катаев (Авито)",
  "views": 41979,
  "duration": 2490,
  "published": "2021-10-04T02:22:53-07:00",
  "text": "всем привет меня зовут семён я работа в компании авито над процессом перехода от монолитной архитектуры к микро сервисом вообще реализациями красе разная культура занимается несколько команд нам пришлось поменять процесса разработки сделать реворк в компании начать использовать новый для нас паттерны проектирования и новые инструменты сейчас я дам краткий обзор того с чем вам придется столкнуться если вы только задумались над созданием надежных масштабируемых распределенных приложений и так что вообще есть до микро сервисов что у нас в авито было до того как мы начали задуматься microsoft не архитектуры у нас было классическое web серверное приложение весь пользователь трафик встречают серия лот балансиров которые решают задачи l3 и l4 по модели осей и у вас может быть несколько уровней балансировки например его вид а мы сделали два уровня балансировки когда applications where или лрн по модели оси oy мы вынесли на отдельный пул серверов за которыми находилась приложение приложение формирующий ответ для пользователя запрос за приложению конечно же базы данных вот и мы горизонтально масштабировались у нас одно приложение не могло обслуживать весь пользу ский трафик запускали несколько лот балансиров затем запускали несколько инстансов приложения то есть это те сервера куда делись наши монолитное приложение и вот отсюда мы начали двигаться в микро сервисы почему мы это сделали бизнес развивается появляются новой точки роста нанимаем новых инженеров в какой-то момент настал a400 инженеров компании авито то есть 400 людей которые ежедневно пишут код делать это фича запускает процессы соседи и мы увидели что с ростом сложности проекта bass complexity отображено по оси x продуктивность отдельно взятого инженера отображён а по вертикальной оси будет падать то есть с ростом компании тенту market отдельно взятого инженера продуктивность отдельно взятого инженера будет падать что делать самый популярный ответ сейчас отойти в микро сервисы микро сервисный архитектура это модульный подход к разработке программного обеспечения основанный на использовании слабо зацеплен их распределенных модулей которые взаимодействуют между собой по какому-то либо протокола вообще микро сервиса ты не не единственный путь и для развития теперь заработала вообще мега сервис это не единственный путь до развития вашей компании то есть со монолитные архитектуры можно тоже хорошо работать при условии осознанное и осознанного контроля тех долго но вот мы решили идти в микро сервисы как и говорил то модульный подход к разработке программного обеспечения когда наше приложение дробится на много независимых слабо связанных модулей микро сервисов нет единого правила или критерии до какой степени гранулярный steam и дорогим наше приложение например у нас есть монолитное приложение которое работает с разными инструментами по взгляд свенсен джинсы reddy's манга дебит и новые фичи мы делаем в микро сервисных например когда стояла задача сделать messenger к примеру вы можете сразу делать его как отдельный микро сервис который реализует api для мессенджера на всех платформах desktop опять мобильных приложений бэк-офис у этого микро сервиса будет своя база данных своя команда инженеров свой тех долг свой тех лиц свой backlog свои cup свой capacity planning и у этого микро сервиса будет свой план развития дальше например вы делаете мега сервис доставки микро сервис доставки тоже будет со своей базы данных своих кроны демона тут максимально независимым для нас эти сервисы это как микро стартапы внутри одной большой компании и вообще изначально messenger был в монолите находился на php и только потом когда мы начали распиливать монолит у нас отдельная команда вынесла месенджер в отдельное приложение скорее всего вам понадобятся какие-то фундаментальные сущности для работы для комфортной работы для комфортно обслуживания пользоваться трафика например вам может понадобится сервис пользователей который будет себя инкапсулировать все персональные данные по пользователям телефон и email авторизации историй авторизации там будет как урон и демоны например крон сброса паролей отправка и-мэйлов вот это все будет связано использовать в одном микро сервисе вы сделать его максимально надежным масштабируемым у него тоже может быть своя команда инженеров как у нас во вид а у нас во vita укоры service as есть своя команда инженеров которых развивает и поддерживать и предоставляет стабильно и опять для всех команд вроде бы все очень просто то есть ну вообще посмотреть на схему вроде дело отдельные микро приложение и вот тебе микро сервисной архитектура но на самом деле там все гораздо сложнее и прежде чем смотреть какие сложности будут у вас возникать процессе распила монолита давайте посмотрим на масштабы микро сервисной архитектуры у нас сейчас во vita больше тысячи микро сервисов на самом деле там тысячи полторы микро сервисов у нас просто есть парочка сотен микро сервисов который мы не знаем кому принадлежат не знаем кто их сделал и никто не хочет ими заниматься около 200 с микро сервисов помечены как критичные две с половиной тысячи баз данных то есть представьте две с половиной тысячи инстансов баз данных и до 200 дипломов каждый день 3000 git репозиториев вот новый человек приходит в компанию и смотрят 3000 git репозитория в проекте но мы сидим на стыке атласе на технологий относительно продуктов и набит пакете в общем один из вызовов микро сервисные архитектуры это сделать так чтоб не потерять комфортность разработки на таких масштабах сделать так чтобы объем тех долго не рос экспоненциально и объем краст грязная работа держался на одном уровне под грязная работа я подразумеваю задачи типа ну представьте в гол and версии 115 выше лба гну нашли кoгдa use масть в galant версии 115 и мы такие о по нам надо 500 микро сервисов обновить или wav в четырехстах микро сервис как надо поменять sdk для сбора логов это все грязная работа ее нужно как-то автоматизировать этот один из вызовов микро сервисной архитектуры а ещё у нас домик раз сервисов было одно монолитное приложение с одним профилем на гру спи которым мы запускали на 70 серверах 70 инстансов одного приложения это очень легко управляется сейчас десятки тысяч микро приложений вот откуда цифра десять тысяч взялась вот на прошлом слайде было 1000 микро сервисов то есть у нас все микро сервиса запускаются горизонтально мою стелется горизонтально для слабо нагруженных сервиса фото минимум трин солнца для высоконагруженных микро сервисов такие как поиск рекомендации там от сервис пользователей там может быть до 100 инстансов то есть в среднем примерно 10 инстансов на микро сервис и это 10000 микро приложений а еще у них есть вспомогательные компоненты то есть у каждого микро сервиса может быть свой пк bouncer 100 sd демон х прокси twin плаксин воин джинс для полноценной надежной работы микро сервиса и вот эта цифра к может спокойно подняться до десятков тысяч микро приложений нужно как-то их запускать вот раньше было сервиса серверов а теперь надо 10 тысяч приложений есть похожая алгоритмическая задача задача наполнения рюкзака по условию вас есть рюкзак и груза и надо рюкзак заданной вместимости и грузы которые надо уложить этот рюкзак максимально эффективно вот рюкзаке это наши сервера их тысячи а груза это наша микро сервиса их десятки тысяч и нужно их так разгрузить по всем рюкзакам чтобы не было переполненных рюкзаков чтобы они все были примерно данном уровне загруженности а еще эта задача усложняется разными правилами типа к примеру в каждый рюкзак нельзя ложить больше чем два зеленых либо в каждый рюкзак к одному синему добавлять оранжевый или например в каждом рюкзаке должен быть обязательно один серой эти правила называется политики affinity анти affinity то есть эти правила даются это делать эту задачу практически не реально решаемой вручную вообще она решается перебором и есть оптимизация динамического программирования вот когда мы только начали тип микро сервиса самой нашей первой микро сервиса когда у нас было всего лишь на 5 10 микро сервисов la vita не 1000 эта задача для fox и пытались решать вручную мы ставили задачи довольство типа вот микро сервиса у него скорее всего будет такой профиль нагрузки мы надеемся он не поменяется придумайте куда его за деплоить и devops и вручную подбирали сервера куда бы его положить чтобы не решать эту задачу вручную есть целая группа инструментов оркестрация dallinga вообще если вы только хотите в микро сервисы обратите внимание на фон клоуна этих компьютер fondation у него кстати буквально неделю назад была конференция формате онлайн это независимый фонд который ставит своей целью развития технологии контейнеризации контейнеризации приложения он был анонсирован в 2015 году вместе с коберна this 10 и поддерживаться разными крупными компаниями которые я не буду сейчас рекламировать в общем участники фонда развивают группы инструментов для построения надежных масштабируемых распределенных приложений и первая группа это инструмент оркестрация dallinga купер нить из а точнее его подсистема scheduler решает на каких серверах какие сервисы запустить купер notice это не единственный инструмент из этой группы есть еще месяц написаны на си плюс плюс есть еще и dockers вором написанные на коленке в общем вы можете себе подобрать как подходящий момент я сейчас не буду приводить сравнение чем они отличаются и какая у них архитектура я только скажу верхние уровни во что все они примерно одинаковые и у них есть они состоят из энного количества серверов на которых запускаются вашей микро сервисы например в авито у нас около тысячи серверов в кластере купер на тесс и есть несколько мастеров которые управляют этим кластерам у мастеров есть свой сторож который дистрибьюторский values to watch это отдельная тема для тема дистрибьютор киева или сторож в купер найти все по умолчанию используется дети сиди и мастера предоставляют опять для работы комнат light интерфейс утилит и ей дашбордов и мастер кубер на тесс решает на каких на каких но дах запустить ваш и микро сервисы и ноды могут постоянно появляться и исчезать то есть вы можете вводить и выводить эксплуатации нового сервера сервисы меняться новый сервис apple отца купер ныть из-за вас решают эту задачу в общем купер notice решают я какие сервисы запустить но у вас получается так что на одном сервере сотни приложений вот до этого все ресурсы сервера принадлежали одному монолитным приложение сейчас сотни независимых приложений на одном сервере и нужно как-то делить ресурсы сервера между ними сделать так чтобы не было плохих соседей плохой сосед это когда один микро сервис начинает утилизировать все а циpкa сервера или забивают всю весь network и либо всю память и не дает работать другим микро сервисом чтобы это избежать вам нужно контейнере zerowatt приложение контейнеризации это метод виртуализации когда приложение запускается в изолированном пространстве пользователя в изолированных пространствах пользователей и она дает нам accounting ресурсов мы можем для каждого микро сервиса указать сколько ресурсов циpкa сети памяти он может использовать если сервис пытается использовать больше циpкa чем ему доступно то начинается тротлинг микро сервиса и дается процессор на и время для работы других микро сервисов опять же вклад на эти в компьютер есть множество инструментов из контейнера нe тайма и все они заменяемые этот фонд пропагандирует модульный подход делать так чтобы каждый компонент тег можно было заменить тот контейнер здесь это тоже не единственное решение из контейнер on time есть еще кривой roccat они верхние уровни тоже в принципе похоже работают и предоставляет одинаковый окей есть контейнер runtime интерфейс по сути вот контейнера time интерфейс это по сути набор живописи вызовов типа запустить остановить получить состоянии доки роберта запущенного контейнера и куперу notice через эти джер писи вызова говорит какие приложения запустить на каких серверах в общем вот у нас есть инструмент оркестрация scheduling а есть контейнер runtime и давайте посмотрим из чего состоит микро сервис микро сервис это может быть нет это не только одно запущенное приложение это может быть например бинарник собранный бинарный голдинг либо pitch пфм демон также в инстанс микро сервиса может ходить и james h прокси для high availability до внешних ресурсов pg bouncer и джинкс редис как кей values to reach до каждого инстанса микро сервиса тоже можно так делать расти слог для сбора логов и вот это все вот эти все 6 контейнеров это один instance приложение и мы инстанции приложение с гелем горизонтально запуская много одинаковых инстансов и равномерно распыляет трафик по ним помните игру в начале 3 микро сервиса для 3 инстанция для слабо нагруженных сервисов и до 90 100 для нагруженных микро сервисов так мы масштабируем наши микро сервис и опять же микро сервисы это по сути то к контейнеры контейнеры то запущенное приложение на базе какого-то образа поэтому вам нужно где-то хранить образы собранный образы приложений опять же вы можете использовать dota реджис 3 а вот docker hub примера либо ставить свои правят реджис ты для на своей инфраструктуре у себя в компании мы выбрали харбор и опять же они все взаимозаменяемые вы можете подобрать любой docker и джесс 3 себе с каким будет комфортно работать харбор для нас это клоуна эти freddys 3 у него есть ролевая модель доступа есть политики репликации есть restful api есть даже борт есть бэкапы достаточно мощное решение опять же берите готовые кубики из фонда клонов компьютер вот начали делать микро сервисы сделали например два микро сервиса продукт пэйдж и messenger у каждого своя база данных своя команда и свой backlog вот как как говорил все вот идеально но пользователи не знают какие у нас есть micro сервисы пользователи приходят во vita приходят на наш сайт и вводят в урне а в в авито ру слышать фон 11 и его вид русло штамп profile manager примеру нужно как-то научиться рауте трафик на конкретный микро сервис приземлять пользоваться кий запрос на конкретный микро сервис эту задачу решает о пике твой опять же api guide в это не единственная задача роутинг то не единственная задача для беги давай туда же можно положить а плетей шин firewall red limit own дефекация метрики мониторинг блокированием сср терминация сектор брейкеры кэширования ретро и и так далее есть сотни инфраструктурных задач которые можно положить в побеге twain я пообщался с несколькими компаниями почему-то большинство компаний делают свои аппетитные и мы тоже в себя начали изобретать своя беги твоим они стали изобретать убрать коробочное решение возможно потому что не знали что они есть если зайти на фонд ло отметив то там есть пул обидит wave open source ных проектов которые все это уже умеют делать вы можете себе подобрать опеки твой на любом стеки технологий которые вам нравятся например взять kong битвой на engine смыслу и где лу запускается на worker of engine со через окон расти вы можете взять send in all написанные на джаве кракен где написаны на коленке либо амбассадор тайланд python смесь и из коробки вы получаете сотни возможности для ваших аппетитов посмотрим что имеет конге твой в себе конки твой это платформа независимо битвой есть готовые сборки для кубер-педи садати раствором месяц есть его можно запускать на обычных серверах в нем есть динамический алгоритма балансировки трафика есть встроенный секир брекера hell в чеке активный-пассивный мониторинг об стримов есть интеграции с разными ford party dns резон время таких как консулы встроенный af20 и всякий механизма авторизации пользователя тот животе токенов до обычной сессионной cookies и он плавал вы на гитхабе можете найти много плагинов которые и будут расширять его возможности у нас свой сам описано пике твой мы просто начали делать очень давно примерно в одно время когда конки твои начал появляться и какие задачи у нас обидит его решает вот видите три микро сервиса внизу они могут быть написаны на разных языках на питоне на коленке на php и к примеру им всем нужно модификация пользователя то есть нужно понять по пользовательскому запроса кто к ним пришёл разобраться сезонную куку сходить с этой куклой хоккайдо сторож проверить активность пользователя проверить не заблокирован ли пользователь в общем мы можем по идее копипастить эту логику портировать а на разные языки а можем сделать так что пики твой это будет делать самостоятельно опеки твой в нижестоящий сервисы подмешивает заголовок юзера иди и ниже стоящем положении ему доверяют конечно же api китая фильтрует те заголовки который пользователь не может поставить сам в общем вам понадобится опеки твой и не пробуйте изобретать свои пики твой вы никогда не догоните эти готовые решения перейти что-нибудь из фонда клауд на этих компьютер fondation идем дальше у нас помимо прямого пользоваться кого трафика есть много межсервисный взаимодействий я помню ты говорил что нас тысячи микро сервисов вот на один пользоваться и запрос в среднем по рождается примерно 5 10 каскадных запросов у нас есть такие тяжелые странице типа страница карточка объявления либо страница подачи объявления где для полноценной отрисовки странице задействовано 50 микро сервисов то есть один пользоваться кий запрос породил 50 каскадных микро вызовов микро сервисов и поэтому межсервисные взаимодействий выходит на первое место сразу договоритесь о протоколе взаимодействия между микро сервисами договоритесь о том как делать подписи запросов договоритесь о том как делать sdk клиенток микро сервисом то есть не делайте прямых cool запросов из кода вашего приложения делайте все через готовый sdk клиенты к вашими к сервисам про говорите про коды ошибок a9 ошибки сетевого уровня от ошибок доменов а у микро сервисов опять же если я хочу начать работать с каким-то микро сервисом например вот и самого призма моего микро сервис я хочу делать запросы в ой там композиция 1 на примере я делаю через пакетный менеджер composer install пакета клиента к этому микро сервиса случае с головы гогот вообще мы сейчас идём в кода генерации могу стали делать клиенты каждого микро сервиса вручную на каждый надо на разных языках и мы сделали кода генерации когда одной командой мы генерируем клиенты в проект для тех микро сервиса с которыми хотим работать в общем межсервисные за moist и выходит на первое место по важности и если вы вы вы выберете какой-то протокол общения между микро сервисами вот у нас 1000 микро сервисов протокол в дальнейшем вы уже поменять не сможете скорее всего у вас не хватит сил поменять протокол для межсервисный взаимодействий поэтому зайдите на фон клоун этим и посмотрите уже готовые рпц фреймворке с поддержкой разных языков программирования вы из коробки получите поддержку java си плюс плюс scaling python и других языков обратите внимание на gr5 либо надо бы это хорошее рпц фромборке вас будут из коробки механизмы для тестирования отладки фолд injection of мониторинга сбора trace of вы все это из коробки получите в общем вот мы выбрали какой-то протокол общение до между серб между микро сервисами у нас вот есть два микро сервиса к примеру который взаимодействует по выбранному нами опять первыми красиво сделать запрос другой микро сервис конечно мы можем обо всем договориться и надеяться что все инженеры будут соблюдать заданные договоренности то есть они будут к примеру честно прокидывать trace айди честно покрывать метриками мониторинга мимир сервисных взаимодействия честно настраивать alert и на межсервисные взаимодействия по факту когда нас 400 инженеров все эти договоренности быстро забываются теряются ломаются еще их невозможно обновлять и менять то есть если мы хотим что-то поменять на их протоколах на приходится вносить изменения в 1000 микро сервисов это дорого и долго вас мыть посмотрите на паттерн сервис прокси сервис прокси то паттерн когда у каждого инстанция микро сервиса поднимается сайт корр прокси и через не twitter операционной системой linux это то что управляется че , balls утилиту весь страте крутится через это прокси это распространенный паттерн то есть январь то есть сервис прокси становится еще одним контейнером ваших запущенных приложениях помните парочку саладин за ты показываешь нас 10000 запущенных приложений вот волита 10000 запущенных проксей десятки тысяч проксей которые между собой взаимодействовать опять же не изобретайте свои решения как сервис прокси посмотрите на клоуна тиф и увидите готовые сервис прокси которые легко встраиваются в любую инфраструктуру которую вы все выберите будь так оберните smashes либо dockers вором мне больше всего нравится и двое и traffic in двое на си плюс плюс и трафик написанные на коленке это самое правильное место для выполнения retrieve самое правильное место для выполнения секир брокеров tracing сборы метрик и мониторингов то есть у каждого инстанция сервис этот сайт корр прокси локально собирает информацию агрегирует ее по межсервисный взаимодействие и централизовано сбрасывает в какой-нибудь хранилище например централизовано у каждого сервиса собирает все trace и межсервисный взаимодействий и скидывает ее в систему хранения trace of по up and racing протокола вот так кстати вылет рейса в мир сервисных взаимодействий в микро сервисах это рейсинге можно расширять то есть мы можем не только по request найти восстановить хронологию какие сервисы были задействованы а у нас примерно карточки объявления 50 микро сервисов но эти trace и можно еще расширять из приложения то есть можно из самого кода приложения дополнять рейсы например обернуть запрос в базу данных таймингом и отправит рейса де либо во внешнее походы во внешние ресурсы либо просто какие-то тяжелые задачи оборачивать а миром и помечать их как помечать их request айди и отправлять в систему хранить рейтинга и главное что это все легко между собак интегрируется берите инструменты для треккинга например мы у себя взяли я гири она просто из коробки подключилась к сервис прокси из коробки зашло в купер нить из это такие готовые кирпичики как из которых можно построить вашими красивую архитектуру и фон клоунов компьютер fondation пропагандирует модульный подход когда один компонент можно заменить другим компонентом если идти дальше у нас вот на первое место выходят межсервисные взаимодействия то мы можем конечно же договориться что в каждом из тысячи микро сервисов люди делают сервис прокси не забывают добавить и раз прокси и еще все используют одну сервис прокси конечно можно договориться и надеяться что инженеры будут это делать но можно зайти дальше и есть пул инструментов называется сервис мышь когда мы централизовано архыз террором всеми проксиме то есть 10000 проксей и мы из командной строки можем управлять всеми процессами в 7 их всех сервисов мы можем например сказать что окей вот в этот микро сервис никто не может ходить кроме вот этого микро сервиса либо вот либо централизовано управлять расположение микро сервисов делать так чтобы допустим у нас есть десятки микро сервисов и мне надо сделать запрос в какой-то из них я могу сделать а п тесты между микро сервисами могу делать конри релизы для миксеров этот централизованный пульт управления для всех проксей если идти дальше то есть мы посмотрели множество инструментов для построения микро сервисной архитектуры мы можем всех инженеров обучать по идее и говорить им что использовать и как использовать но мы пошли дальше и у нас во вид и начали использоваться шаблона микро сервисов мы сделали шаблон и на php голлинг и ноги джесс основных языках из стека наших из из нашего techradar а мы их сделали максимально платформа независимыми в коде шаблона микро сервис ни слова нету по кубер нить из ни слова нету просвет с прокси ни слова нету про сервис мышь есть только optimal описание микро сервиса в котором есть название микро сервиса по которому определяется контроль доступа и вообще это все идет в метрике в мониторинг есть engine у сервиса где описывается наш там сердце на каком языке сервис написан и размер микро сервисы например сколько ему типу или памяти выделять мы сделали коробку из стандартной коробочки типа большой маленький средний сервис и команда выбирает сколько ресурсов нужно для этого микро сервиса автоматизировали создание баз данных то есть можно записать секцию окей под газ и в продакшне автоматически поднимается база данных также как и в деве в стейджинг окружениях в общем над этим пассам у нас работает целая отдельная команда и есть более подробный доклад про наш платовым а затерлась который рассказывает саша лукьянченко вы можете поискать на в интернете и видео где подробно рассказывается про наш пас помимо этого помимо этого чтобы построить надежную распределенную масштабируемой архитектура вам понадобится еще и инструменты для стриминга и messenger га то есть в микро сервисах вы теряете инструменты для консистентной данных вам придется идти в ван шел консистенции и без стриминга и мессенджера вы не сможете построить надежное решение надежное приложение у себя мы используем кафку и пульсар есть готовые сборки или готовы инсталляции по базам данных для построения надежных распределенных масштабируемых решений есть коробочные паз и например heroku все вы тоже можете найти в этом фонде есть клоуна эти в стороны например с 3 cf менее есть инструменты для лакирования которые тоже из коробки легко встраиваются в экосистему легко интегрируется со всеми остальными инструментами и есть еще многое другое в общем микро сервиса такая дорогая технология и если вы хотите найти вам придется начать использовать множество групп инструментов это хороший вызов для ваших drops of и архитекторов и я бы советовал вам несколько раз подумать прежде чем вы будете те микро сервиса у меня все спасибо а твой приск тебе бежит и это я понимаешь что тебе своей классная was also with a ti но будет ещё одна спасибо да именно я рамка ребята поднимайте пожалуйста руки у кого есть вопросы вау круто но давайте первый ряд сначала до в онлайн не возникает вопросов что нет звука в самом начале когда мы переключаемся в технических толков наших спонсоров на зал а я здесь это такое говорю ребята нормальная развлекая зал пока у нас техническая пауза для того чтобы вы могли нас видеть со сцены и так у нас есть первый вопрос спасибо за доклад такой вопрос вырулим рассказали про кирпичики по все как-то здорово и вы тронули до у вас сервис мышь lavita внедрен или вы просто набрали кирпичик вы построили из них лекцию свое у нас есть отдельная команда которая занимается развитием платформа для микро сервисов вот кстати начали для немного неправильно представили я не развивают не разработаю платформу и у нас да есть самописные решение на базе navigator ну сам описано решение которое занимается контролем доступа какие микро сервисы где находятся то есть это централизованное управление всеми процессами всех микро сервисов она называется с навигатор сам описано решение вы сказали что на один запрос пользователя может возникать до 50 меж меж сервисных запросов уже ваши инфраструктуре какой процент времени исполнения запроса пользователя лена уходит на вот это общение между микро сервисами ну мы пытаемся делать асинхронный запросы то есть так чтобы пришел польски запас мы сразу сформировали 5050 запросов разными когда сервисы и по сути время ответа для пользовать это время самого долгого микро сервис ответа самого долгого микро сервиса это требует большого рефакторинга реально большого рефакторинга и осознанно работать над тег долгом семён спасибо за доклад у меня вот такой вопрос вы сказали микро сервиса есть свой тех лиц отвесно технические решения принимаются отдельно внутри каждой команды и с одной стороны это наверное хорошо что каждая команда может выбрать там тот стек тот прибор которым больше подходит но с другой это может привести к тому особенность у вас тысячи микро сервисов что у вас будет огромное разнообразие самых разных технологий для того чтобы все это поддерживает нужно будет универе на печи специалистов самых разных компетенций вот как вы с этим справляетесь есть такая проблема помните вначале был что есть парочка сотен микро сервисов которые непонятно кому принадлежат и и кто их делает ее нужно их оставить живыми и либо удалить как раз платформа за сервис этот подход который есть отдельный доклад у саши лукьянченко из нашей компании он держит в рамках наш стек технологий у нас есть всего лишь 4 4 шаблон сервисов и вы не можете и инженеры не могут сделать какой-то сервис не на базе этих шаблонов то есть в микро сервисах есть ни слова нету про вернитесь ни слова нету про сервис прокси промеж и инженер паста с нуля написав на расти он не сможет его сзади плоть production этим мы как-то пытаемся ограничить techradar тексты и этим мы автоматизируем обновления микро сервисов если мы захотим переехать примеру из кубер notice of что-то другое вообще никому не надо ничего делать мы все сервис автоматически перенесет другой кластер либо в другой инструмент регистрации менеджмента либо поставим новый но либо переедем на новый сервис мышь это все максимально платформа независимо но и как раз разработчики не могут писать какие-то сервисы на других языках все на готовых шаблонах он спасибо у нас есть человек с микрофоном потом будет первый ряд вот здесь вот на первый ряд сюда принеси пожалуйста а дальше в пятом ряду просто кое-как управляете хранением данных то есть каким то микро сервисом нужно хранить там десяток гигабайт каким-то нужно терабайтами хранить пример сервис который занимается хранением пользователей или страницами объявления у нас самый толстый пользователь это сервис объявлений там сортированная база данных что-то около тридцати двух терабайт вроде на каждую шарды в общем там гигантские объемы данных и когда команда решает что ей нужен микро сервис некоторые базы данных автоматически создаются то есть когда человек создает микро сервис прямо в пасе come on line интерфейс utility говорит что king над создать микро сервис и а утилита спрашивать там какие базы данных нужны редис и по сгрыз и окей а настой традиции возраста есть там скажет какие объемы данных какие нагрузки ожидаемые все это автоматизируется нашей команды по складкам и за сервис есть разные сервисы есть конечно сервис из сервис-листа есть они с костей класть которые вообще нету хранилище бы не хранилище данных есть в разные как бы то есть вас есть какой-то один-единственный сервис баз данных они или нет нет нет конечно не поднимается один контейнер то есть след ли у каждого сервиса может быть своя база данных один из паттернов проектирования для микро сервисов сделать так чтобы сервисах pussy расы были свои базы данных и никаких от типа общая база данных на всех это общение нельзя так делать это нестабильное не эффективно работать у каждого сервиса своя база данных причем разные команды предпочитают кому-то удобно с манга тебе работать кому он потому что им не нужно набирать транзакционных кому-то нужно нужен позарез например в биллинге я говорил вначале вы помните был слайд две с половиной тысячи баз данных то есть ну вот ответ для span 1000 баз данных у разных сервисов своей базы данных супер сейчас вопросы с первую рядом и потом у нас тут около камеры есть вопрос а дальше совсем у задней стены и в какой-то момент все онлайн семен добрый день игорь борисов softline у меня несколько вопросов модератор разрешит пачку спасибо начнем надо сперва вы когда выбирали докер был ли выбор он осознаны или это просто hyip тренд скорее всего это был hyip есть проблема в докере на самом деле мы команда джобсов насколько разная пыталась перейти на другие инструменты когда контейнером темой я меня не вот формации чем это закончилось сейчас у нас контейнер и используются продажи их тогда второй вопрос если можно прокомментируйте как вы решаете но хотя бы две наиболее массовые и известные проблемы которые связаны с а и в том числе с микро сервисной архитектурой это распределенная транзакция и сложности в отладке в дебаггер ну распределенных транзакций у нас нету мы их не используем это тоже не очень я бы не советовал строить распределенной транзакциям мы делаем все в парадигме ивент шёл консистенция шина данных событий до им события что нужно какое-то какое-то действие поменять текущий момент времени у нас нет консистентной sti когда все события шины данных обрабатываться мы приходим к концу концы снят на мусор я не да иван шел consistency мы используем помните говорил есть пул инструментов для иван шов для стриминга и массаж для у себя мы используем кафку и сейчас переходим на пульсар а второй вопрос был про от типа к отладку как решается проблема отладки ну есть инструменты для трейдинга мы ну вообще если их использовать правильно паттерны проектирования то у вас должна быть низкая связано с между микро сервисами то есть нужно можно четко понять в каком микро серво вся проблема при если у вас не получается распределенный монолит хорошо изолированной микро сервисы редко когда приходится тестировать вам интеграцию 10 микро сервисов ну начинаем все с рейтинга straight по три сайте можно понять вообще какие микро сервисы были задеты какие запросы отправлялись и там уже как-то локализовать в каком microserver вся проблема подключить у команду которая владеет этими к сервисам я успею зачитать пару вопрос из онлайна у нас есть уже два человек с микрофоном в центре зала и в самом конце зала и на этом мы просто во времени уже не успеваем даче зовут кулуарах можно будет продолжить они смысле реальные тоже просто у вас там вместе с вами те люди которые им онлайн а ты выбираешь ты выбираешь вопросов я думаю еще рано еще еще еще еще не все выпуск году спокойно хороша на претендент есть я понял вот был вопрос маленький сказали что около тысячи базу данных как раз по длине и как взаимодействует и рассказал что у каждого своя база да конечно келли а вот такое по поводу использование микро сервисов с кластером сетевых интерфейсов примеру hype дикий под linux работали ли вы с ними и можно ли их подружить вообще на этот ответ 3 она рыданья не смогу ответить вы найдите докладчик в чате побеседуйте если вам интересно его мнение хорошо и из центра зала вопрос и дальше их антонова да добрый день семён спасибо за доклад вот хотелось бы вам такой вопрос задать у меня зовут валерий компании accenture технологический центр города ростов-на-дону вы как-то деликатно обошли тему несогласованности модели данных то есть я поясню вот вы говорите две с половиной тысячи баз данных понятно что все микро сервис и обмениваются друг с другом какими-то структурированными сообщениями то есть это может быть джейсон это может быть xml и вот люди составляют маппинге вот как вы уходите от проблемы того что чем больше вас становится микро сервисов тем больше этих мо пингов приходится делать вот сталкивались ли вы с этим и если сталкивались как какие инструменты решения вот вы посоветуете использовать что вы сказали мэппинг да но мы используем стандартный у нас стандартизировано формат сообщение для шины данных то есть и мы делаем сообщения в них данных максимально простыми максимально тонкими то есть пытаемся не дополнять их кем-то широким приводом в шине данных кидается событий типа создана объявление вот его язычник и дальше уже кто получает это событие поэтому адэшника получают нужную информацию поэтому объявление то есть события шине данных максимально тонкий и мы используем единый протоколы я вначале тоже говорил помните что тысячами красиво хотя не будет все работать на разных протоколах это будет от в отладке они все у нас работает на едином протоколе и ну как бы ни даже не встает вопрос а вопрос мэппинга сообщений кстати а я кстати понял ваш вопрос да у нас есть реестр всех событий то есть и реестр всех событий описывается как каждое событие шине данных а описывается к контрактам и когда сервис хочет начать работать с каким-то событием подписываться на к это событие вот серво из кода ген ему генерирует мэп и mapping модели для этого события и ну и события разворачиваются в эти модели посетил больше и последний вопрос у нас есть да а вопрос был снят если вдруг последняя рука есть вот есть центре зала сейчас мы успеем ребята он в онлайн чате пожалуйста подключитесь потом цифровые кулуары тоже я вижу что вы писали вопросы просто мы уже не успеваем нам важно дезинфицировать зал подключитесь цифровые кулуара вы сможете задать вопрос туда палочку там спасибо семён доклад алекс работает простить центр коллега компания x нас хотела спросить такие блиц-вопрос сколько в команде платформу вас человек работает у нас целый кластер платформой там работает 50 по моему инженеров 50100 и нет больше ста инженеров в платформе вот что сектор занимается развитием пас распила монолита базами данных из взамен замечательного расставлять небольшой проект который стартует его им говорите а берите вот эти кирпичики и хорошие они все сразу вам дают и надо быть экспертом в этих кирпичиков и как с этим бороться когда у вас не 50 человека например 3 я слышал вопрос когда у вас не 50 человек платформенных инженеров всего лишь 3 и они шарятся еще на все команды как вот как вот такой пул стек сервис мышь и так далее все что вы предлагали использовать как как найти таких специалистов которые будут экспертами в такой широкой область а зачем вообще нужны эти кирпичики когда во всего три человека вам не нужны микро сервиса то есть micro сервис это сделать так чтобы комфортно работать было 400 500 ом инженером к примеру сделать так чтобы мини команды были максимально независимо если вас всего три человека вам микро сервиса вообще не нужен но не соглашусь нашей компании например платформенной команда составляет всего 5 на этом на этом я как модератор просто попрошу закуси на вы сможете дискуссию продолжают цифровых кулуарах ребята нам важно дезинфицировать зал и а ты выбираешь лучший вопрос даже если он из онлайна люди получат свою книгу ко мне больше собрался опрос про 50 каскадных запросов потому что это реальная тема болит про 50 каскадных запросов подойди пожалуйста дак сцене чтобы наша ассистента смогли тебе вручить спасибо огромное"
}