{
  "video_id": "VGMeBYagIag",
  "channel": "HighLoadChannel",
  "title": "Обзор архитектуры и подсистем деплоя и мониторинга / Константин Никифоров (Mail.Ru)",
  "views": 456,
  "duration": 2722,
  "published": "2017-07-30T00:47:31-07:00",
  "text": "клёво и давайте приступим классному докладу из mail.ru константин никифоров будет рассказывать про всякие секретные не очень штуки которые такая большая компания mail.ru используют мониторинге и для тепло и и для управления конфигурации тоже так понимаю вот поприветствуем константина не слышно так слышно нормально все отлично добрый день меня зовут неких константин я являюсь руководителем группы стенах администраторов компании mail.ru наша группа занимается обслуживанием проектов таргет майком теперь рекламной системную mail.ru и проекта топ mail.ru наш проект достаточно специфичный все три проекта потому что мы не обладаем никаким юзер контентом мы в основном паразитируем на вас как пользователях и особенность нашего заключается в том что у нас очень большие попы на фронтах что не у многих проектов есть ну то есть таких проект как одноклассники как вконтакте это понятно потому что они просто огромны и у более мелких проектов такого нет а мы размещаемся на всех вышеперечисленных и на всех станицу mail.ru поэтому наш ps еще больше чем проект и сегодня мы поговорим о том как мы диплом код от момента когда разработчики нам его отдают до момента когда он появляется в продакшене пользователь видит эффект от его а изменения ну что начнем пожалуй сейчас я попробую пощелкать где где где где где где кудо кудо кудо кудо кудо кудо простите пожалуйста ага массе большого извините я не очень опытный докладчику я снова не способен быстро сориентироваться в такими вещами так ну окей наш мой доклад будет разделен на три части первой части мы поговорим как раз и тепло и во второй части мы поговорим о графика способ реализации работы проекты а третьей части мы поговорим как мы объединяем собственно наш график нашу систему диплом в данном случае паппет и наш систему мониторинга соответственно сначала в организации хранения манифестов по 5 почему выбрали папе побед мы выбрали по одной причине потому что это является практически противно стандартам компании mail.ru все отделы всех проектов используют для монтэйн конфигурации побед любая система конфигурации бесполезны без контроля версий потому что если ты не можешь посмотреть что-то изменил в проекте смысла в этом никакого нет естественно сейчас очень большое количество различных систем контроля версий мы используем на и бульварное на данный момент это гид соответственно вот как организована сам процесс по питон то есть как организована окружении папе то мы разделяем всех наших пользователей на январь менты то есть каждый пользователь заведенный рутом на сервере является обладателем одного инварианта который соответственно именованный для него ну то есть например у меня это никифор до моих планах это и фамилию и 1 января мент production который является текущей конфигурации production system и соответственно все сервера должны быть синхронизированы именно с январем там production для тестирования для разработки новых манифестов для разработки модулей для разработки может быть тестирование каких-то новых фич или каких новых подходов мы используем только январь менты дабы не сломать production system еще одно условное такое условие при которой мы выполняем всегда она связана с тем что чем я расскажу далее все наши проект но все наши сервера юношу проектор без исключения управляются папе сто процентов серверов нету ни одной выкладки которую мы делали без комента но чтобы организовать правильно разные версии софта на разных серверах разными тестовые разные экспериментальные варианты системы для этого мы используем некоторые соглашения которые нам позволяют это делать наиболее гибкой наиболее удобна для нас одной из таких соглашений это модуль bass которую мы пишем кросс все сервера то есть у нас не может подняться сервер без этого модуля то есть это считается что пустой фото define ноды это класс bass : для чего это сделано ну понятно что это накатывает на всевозможные систем там им и всякие баши там все слоги конфиги для доступа на сервера ldap и sage конфиге там подобные вещи но ключевая вещь в этом классе b это этот класс bass хранит вот эту вещь роль роль сервера вот сейчас видите треугольник который показывает структуру нашей сферы применения изменения наших переменных в общем с верхнего уровня понятно дефолтная переменные которые мы используем по умолчанию дальше перезаписывает одеваться относительно ос и сильно площадка цветы на роль она сильно х 100 из этих 5 вещей две вещи достаточно служебной то есть например осы площадка почему вас она нужна только для того чтобы немного отредактировать класс без потому что все таки по набору saw the system например centos 76 которую мы используем они отличаются и чтобы это дело синхронизируете нивелировать мы использовать этот промежуточный наш ер который мы выравниваем дефолтное значение площадка соответственно побольше надлежит к тому классу чтобы сделать локализацию трафика внутри площадке например глупо ходить с одной площадки в доп сервера на другой площадке это совершенно никому не нужные случае отвала площадке приходишь вообще так деструктивно действия поэтому в данном случае мы это использую тоже более служебных целях у нас есть такая сумка называется она фюжн рад этой которая делает такую вещь мы передаем например ldap сервера у нас есть 12 штук мы их запихиваем в один массив и говорим типу 3 доп сервера накатить на все сервера но нашивки dn rotate он умный он берет весь этот массив выгребает из этого массива сервера которые являются соседними для этого сервера перемешивает их чтобы распределить немного нагрузку кладёт их в начало списка чтобы использовать их приоритет на остальные перемешивать дальше соответственно вы понимаете что происходит небольшая энтропия как перемешивание внутри площадке так происходит на тропе меж они в до площадкой и на разных площадках естественно это все ротируется это помогает нам не думать о том как надо прописать что вот здесь нам на такой порядок держать здесь нам надо такой порядок держать и так далее поэтому площадку мы используем как правило для основных функций собственно папито которые мы пишем чтобы уменьшить включение мозга в момент разработки новых манифестов и ключевая вещь роль роль это переменная в классе bass почему ну понятно что роль это разделяет серво логически да там допустим фронтэнда допустим такие будете vga и маска или тарантула и так далее но почему мы включаем эту вещь потому что это позволяет нам эту роль переопределять если вы будете прибивать например ну в киеве какую переменную будете прибивать вам придется всегда следить за тем что вы будете сьерры всегда переопределять какую тур недопустимо написали там в host эту роль frontend но вы будете обязаны в каждую ноту написать что эта роль frontend вам не будет достаточно взять еще один сервер сказать типа вот такой класс интернет вам нужно будет пойти фиеры прописать снова frontend данном случае мы можем эту bass ролл переопределять то есть допустим мы можем поставить сервер сервер будет без роли потом моему назначаем роль какую-нибудь mais quel а потом и переназначение в каком другом у них есть и в другой части это мы можем сделать и это позволяет нам более гибко общаться обращаться с этими ролями ну и нижний уровень соответственно это host то есть по факту мы получаем только три уровня как я говорил уже осы площадка это служебные уровне которую мы используем постольку поскольку так как бы не используем в момент разработки манифестов мы используем три уровня общие переменные роли хост как показала практика три уровня вполне достаточно для того чтобы гибким образом настроить все переменные окружения знаешь сервера и состав как таковых есть конечно неудобства некоторые допустим у нас есть роль каких-нибудь там не знаю джон иксов и там на 15 engine иксах из 38 нам нужно выходить какую-то конкретную версию тут конечно придется определять все это в каждом посте к сожалению но такого софта в нашем проекте проектов не так много есть таких всего лишь один в котором мы активно меня версии и все остальные мы просто распределили по ролям разделили и как бы этого знаков казалось достаточно тогда честно я не помогу нас был слайд теперь поговорим о том как мы пишем манифесты мы поскольку у нас я не один нас несколько человек эти несколько человек должны каким-то образом синхронизироваться мы не можем писать каждый модуль как мы хотим потому что как бы тогда получается у нас пользователь останется один этого модуля или каждому модулю надо будет писать огромную документацию как им пользоваться поэтому у нас есть некоторые соглашения которые мы всегда придерживаемся эти соглашения в общем не очень сложные они укладываются вот эти три понятия обнови не спали расскажи означает это следующее что версию мы храним всегда в вере почему всегда в вере потому что мы должны иметь возможность переопределять ее в любой момент времени на любом сервере если мы будем прививать hard койке эти вещи то это превратиться просто в очень сложную вот про массу просто очень сложно будет сидел поддерживать нужно будет делать большое количество изменений в итоге версия всегда должна храниться в тьери пароле пароле мы храним достаточно хитрым образом я честно говоря не знаю кто нибудь использует ли такую же систему дело в том что мы стараемся сделать нашу систему прозрачны для нашей разработки это очень важно потому что разработка это то ради чего собственно живет проект благодаря чему живет проект мы все-таки такая вспомогательная служба которая помогает этому всему жить поэтому разработки надо предоставить большое количество информации и мы разработки отдаем все манифесты все модули поскольку программисты все-таки они более способны к программированию как таковому и надеяться на то что службы эксплуатации программирует лучше чем службы разработки это глупо поэтому во-первых мы отдаем все наши манифесты но мы не можем отдать пароли что же делать с этим есть очень простое решение которое мы придумали мы отделяем все пароли в отдельный файл pp который мы храним вне нашего репозитория внутри репозитория мы делаем seeming на этот файл этот файл независимым образом бэкапе мы независимым образом соответственно следим за версиями завершенности греха таить это просто рц с на самом деле вот но это позволяет нам разделить все весь код проекта от паролей таким образом мы можем отдать все наши модули всем отделом в компании конечно же мы не можем выложить их в open source по той простой причине что конечно будет видна структура архитектуру проекта что собственно само по себе достаточно секретная информация но тем не менее мы можем это отдать всем нашим коллегам которые могут воспользоваться нашим опытом а могут и поправить наши ошибки это очень важно ну и третье расскажи всем если у нас система мониторинга которую просил меня саша не рассказывать о своих потому что она кладет source и мы стараемся поменьше об этом говорить на этом докладе но смысл заключается в том что у нас есть некий ресурс которым мы можем экспорте прямо из пакета роль в мониторинг то есть можно например сказать что на этом сервере мы установили mais quel накатили манифест и в этот же момент у нас мы интернете появляются здесь мутной римской соответственно определить такую роль определить такую вещь мы можем любую не обязательно это должен быть модуль но хорошим тоном является написал модуль накатил на какой-то сервер и мы должны знать что мы этот модуль туда накатили ну например купить новый софт но такими ролями могут быть такими ушами значит наш мониторинг могут быть например различные конфигурации front end of могут быть например различные шодэ например мы можем поднять допустим 8 тарантулов которые являются шар даме одной сущности одних данных и - что можно увидеть что восстановлен тарантул эта информация в общем-то ничего не даёт ну тарантул тарантул с помощью этой штуки можем экспортировать непосредственно шодэ прямо у нас есть допустим класс который определяет sharding грубо говоря да мы знаем точно какой тарантул как он шар дом является и эту же информацию можем запушить прямо в описании хостов мониторинг это помогает очень быстро искать нужные сущности в нашем проекте перейдем к диплом концепция красной кнопки есть у нас такая концепция которая на наш взгляд является наиболее верный очень многие вешают хуки на различные системы контроля версий по которому код выезжают production мы отказались от этой вещи потому что в компании много рук принято такое там соглашение того что админ который выкатывает код несет ответственность за все неважно что в этом коде написали поэтому если ты выкатил какую-нибудь неверную программу скажем так ты должен это починить разработчик не несет данном случае конечно же он не соответствует перед работник и перед своей совести но тем не менее придут к тебе и ты будешь и все дела исправлять поэтому у нас есть концепция красной кнопки тепло и sage это обычный ваш скрипт который умеет делать очень простую вещь он умеет выкатывать из мастера гита в январе мент production то есть все что он делает он берет из мастера и кладет в январе на продаж у него есть некоторые опции это выкатить масти на какую дату то есть если можно сказать что выкатить на вчера на 9 утра и он соответственно идёт commit который был актуален на 9 утра и выкатит тот камина или непосредственно передать камень дополнительная опция ко всему этому делу является log бывают такие случаи когда ломается что-то о чем мы не знаем в этом случае непонятно что делать потому что непонятно etymology происхождение этой проблемы как правило в таких случаев все начинают давайте откатывать что накатывали катим зад в этот момент понимаете на возникает некая паника потому что всегда когда проект приходит нерабочее состояние возникает паника в головах не только админов а это частая админов возникает паника но как правило разработки и они начинают всеми возможными средствами и способами как-то подействует на сидел поэтому такая ситуация когда одна часть разработки пинает 1 админа 2 2 а третий начиная значит по могучий соседний отдел очень нередко в этот момент должен быть один единственный ответственный человек который донышко это парни хватит как правило это парни хватит сопоставляется откатки года нашем случае с от кадкой манифестов поэтому мы откатываемся 100 используя вторую или третью опцию и о чем этот диплом таким образом когда админ приходит и пытается выкатить продакшен что-нибудь новое что ему разработчик так что при совету сказал что сейчас все починиться он нападает на ту ситуацию когда ему говорят нет вот такой-то человек залочим и больше мы ничего не выкатываем это позволяет сделать такой стопор который не позволяет ломать проект дальше ну за последние три года честно говоря такой функционал нам пригодился один раз может 21 помню точно 2 наверное придумал и в этот момент я ни капли не пожалел о в таком принятом решении но это опять же все на ваше усмотрение кто-то очень уверен в своих коментах я не уверен и ни в одном комиссии не уверен в нашем манифесте поэтому должна быть еще и система которая следит за тем что мы не только накатили одну группу серверов но и не сломали другую группу серверов а вот об этом и поговорим дальше сейчас мы поговорим о том как у нас выкатывается cat's production вообще целиком и полностью полный цикл полностью к очень простой мы делаем брать от мастера дальше редактируем свой брать дальше это можно заниматься может быть день может 2 может быть неделю поэтому мы в течение редактирования своего бранча конечно же рибозим saab мастер чтобы иметь шанс потом вообще понежиться и с ним дальше соответственно тестируем все там зависят hasta от группы и так далее в нужных позициях своего января и перед высадкой в продакшен соответственно держим это мастер тепло и sage погнали по всем ну и соответственно при неудачном мир же всего возвращается зацикливаться и цикл повторяется несколько раз и если это необходимо этот слайд я случайно сюда воткнул скажу честно ну на самом деле идея была такая что я рассказал о том что папе достаточно гибкая система которую можно масштабировать июля но общем как бы любой человек который понимал в проект понимает что никакая система масштабирование очень простая и может быть поэтому я считаю что пропустим слайдик единство могу сказать что мы используем одно dns именно который выписываем сертификат это dns имя у нас является синей поэтому копирую сертификаты и копируя пересом мы можем просто носить вместе с сертификатами на любые машины паппет поднимать и хоть 200 штук вот поэтому а все остальное в общем стандартный масштабируем приложением а вот теперь об альтернативе попытки помните я говорил что нам нужно знать актуальна ли наша система в целом когда мы изменили один единственный кусочек вот попить была такая штуковина попытки которая не выпирало было очень страшно я честно говоря очень не удобная и очень некрасивая но она позволялось мастернод значит сделать выход куда по всем проект потом они поменяли это на марио нет но достаточно ко мне кажется микроскопом по воробьям потому что все таки ну как бы можно с таким же успехом не зна используй как он повел и саши просто патоген вэба hotel там из кроны то есть достаточно сомнительная штука поэтому нам пришлось не пришлось мы сделали свою систему клиент серверную систему попить агентом и назвали попытки по причине того что на серве на части нас работают scheduler и там очередь задание которое накатывается на наш продакшен мы можем регулировать одновременную накладку на группу то есть пределы группы не катить больше чем 2 сервер одновременно или там три можем регулировать накатку по всем серверам до можем регулировать ну машин стандартная задача scheduler ада в чем плюс плюс заключается в том что эта штука умеет хранить вот такие вот вещи она умеет хранить соответственные методы она умеет хранить статус последний команды она соответственно имеют хранить время последнего чек и время последнего апдейта время пас него коннекта то есть если у нас папито гент машина оторвется от нашего пациента на будет ну и соответственно kycok это служебные части неважно чем плюс плюс заключается в том что на scheduler это веб-приложение то есть по факту я могу выкатить код на весь продакшн не заходя на сервер вообще выглядит следующим образом я открываю гид соответственно прохожу все круги ада дтп с которым я писал предыдущем слайде дальше просто мышка выделяю в интерфейсе ки нажимаю на кате теперь вопрос как я узнаю что все не сломалась ну помимо мониторинга понятное дело есть 3 статуса эта штука умеет не только показывать эти статься она еще показывает последний урок папито поэтому у нас есть цветовая дифференциация наших серверов которая имеет три цвета зеленый желтый и красный зеленый понятно это значит что система актуально желтый понятно что система умеет какое-то обновление но они не накачаны и соответственно красная говорит о том что манифесты сломаны на этой ноте то есть каталог для этой ноты не строятся данная штука запускает паппет чек ну ну в тот момент если им не пользуюсь больше чем четыре часа то есть если мы видим в нашей простыне все зелененькие квадратики мы знаем что четыре часа назад у нас была актуальной конфигураций конечно это время можно варьировать но просто итерация выкладки и это рация размножение куда она занимает немного продолжительное время потому что вы сами понимаете что бывают не то что выкатить версии бывает выкатить версию обновить мускул переставьте все знают о моем каши еще что не такой вот но тем не менее благодаря этой штуке мы точно знаем а не сломали ли мы четыре часа назад где-нибудь наш иммунитет строится ли каталог для всех not a b состоянии текущая но тут соответственно плюс минус 4 часа и c мы имеем интерфейсе для накатывания конфигурации и слежением за этим в реал тайме то есть прямо не моргают этот чек этот апдейт этот обратился этот чек очень круто выглядит к сожалению я хотел вам показать в демонстрации всего этого дела но мы не успели подготовить стенд нас был очень сложная неделя прошла и и целей просто физически не успел оп оп оп оп оп так надо ускоряться потому что я читаю растекся мыслью по древу вторая часть система который мы используем это графе это тупо собственно решение которое очень многие из вас наверняка используют который умеет понятно всего лишь две вещи это хронически привязаны к мисс темпл и показывать эти чисел и больше она не имеет ничего чем она на мой взгляд прекрасно базируется на трех китах это соответственно простите это соответственно демон принимающий и два пакета карбон это баз данных весь мир сейчас это цистерна не знаю как это правильно произнести которая позволяет динамически раздвигать и они как коротышка оценить видео а вот и соответственно графит в об этом ортез всем плюс данного продукта дело в том что все 3 части мы можем заменить все эти три части имеют альтернативы ну например в случае в качестве бэг-энда мы можем использовать такие вещи как неправильно flux db в качестве графит вы бы есть огромное количество морт которую мы можем использовать яндексе я знаю вот использует нестандартную мы используем стандартный но ключевой момент в этой всей это карбон потому что это именно та часть которую мы для своего проекта модифицировали но сначала пугаем чем какие грядки мы храним ну понятно стандартной всякие циpкa и вы это и тому подобные вещи которые хранят все рисуют все метрики приложений благодаря тому что графит используют не только тисе пи поклонную эдипе можем из приложения не блокирующим режиме посылать любые метрики которые нас интересуют ну например в нашим рекламным сервере таргета ребята доходит до такого маразма что они шлют просто по уму все перемены какие у них есть свои темы ну то есть например у нас есть график версии пакета с версии у них зашита binary являясь как график выглядя прямая атака на три дня еще прямая на четыре дня и дать и дачное считались тогда конечно низ идет ну совершенно бесполезная штука ну да храним например время взлета демона тоже очень полезно залетаем и прямая все поехали вот но нам это не сложно нам это не дорого поэтому нам все равно какие метрики они рисую чем больше метрик тем лучше это помогает дальнейшее анализе ситуации когда ситуация выходит из-под контроля ну и сложно получаем метрики эта метрика которые мы считаем и статических данных но это в основном задачи бизнеса понятное дело ну что теперь перейдем к той вещи которые наверное я постараюсь вам продать некоторые вещи и стандартные и не стандартные метрики приложения становятся стандартными один из таких примеров графит engine x модуль это модуль для индекса который позволяет ссылать различные метрики perla кейша то есть например мы можем независимо в одном engine.exe отсылать рпц на всех локейшнах отдельно я не знаю ни одного способа это сделать нибудь знает давай серега а да да а есть просто sd мы сейчас тоже поговорим еще можно парсить ноги и через луг ставляет найдем деревьев я ждал этого ответа спасибо вам огромное спасибо огромное значит так рассказываю про парсинг логом ситуация заключается в том что количество запросов к нашему проекту такого что если мы будем писать логе наш сервис не будет работать одна вещь в которой мы пишем логин который мы не можем отказаться к сожалению потому что нужно для дебага потому что чтобы расследовать инциденты нам нужно непосредственно логе эта штуковина пишут логов на один сервер 1 терабайт в сутки это мало это мало а теперь умножьте это вот хоть и посети удачи спасибо за вопрос я читаю книжку надо отдать sage sage достойно книжки однозначно я просто думал зададут не зададут спасибо молодой человек вот соответственно продолжим о нашем безобразии у графита есть очевидные проблемы которые известны по большому счету всем то есть очень многие используют графика чем образом то есть берут 100 т.д. как говорил сергей ставят стад sd из приложения шлют какие мотивам ты там я не знаю клик по баннеру например ну эту грубую мы конечно предел от шлют начнет пакетик пакетики эти агрегируются то т.д. агрегированный статистику шлет соответственно в наш график это собственно решают эту проблему что если мы будем платить непосредственно в графит наш график может просто загнуться погодите но при этом если мы будем спать на стад де огромное количество этих людей пакет у нас все равно будет предел но это решается понятное дело классическим паз со сми масштабирования там различными динамической маршрутизации мы так далее ну об этом я не буду разгорались всем и системные администраторы все мы понимаем как это делается вторая проблема это просто ре зация с какой-то версии графита он научился собирать из нескольких карбона в графике в одну морду это очень удобная штука но имеющие ряд неудобств первый ряд неудобстве единственная на самом большое которой есть это если вы пошлете в 2 карбона одинаковые метрики то он выберет любую не знаю как мне интересно потому что это совершенно не изобильна по этой причине масштабирование штука достаточно сложная в текущей реализации карбона но мы пошли немного другим путем вместо масштабирования мы использовали другой карбон вот у меня тут черепашка на медленным карбоном нарисована мы из этой черепашки сделали вот такую черепашку соответственно стандартный карбон в его текущей резаться еще надо учесть что первая версия карбона было немного пошустрее перед тем как они переписали на о.п. там было потерь производителей где-то процентов 15 и к сожалению архитектурная штука и даже разработчики сами признавали что ну дам зато мы сделали красивый кот вот поэтому мы и очень долго жили на новый морде графит и очень долго жили на старом карбоне когда наши метрики на один сервер приходили уже в миллион миллион двести циpкa на сервер стал заканчиваться совсем это потеря метрик эта потеря данных в нашем случае нас не так много метрик то есть у нас сейчас где-то текущем потому что проводим ревизию чистку плохой мертвые метрики которые мы шлём допустим мы шлём там много нулей да там сто тысяч раз такие вещи мы умеем находить периодически подчищаем но тем не менее у нас не такие большие нагрузки у нас метрик посылается где-то там провели миллионы там под миллион большие проблемы это для нашей службы инфраструктуры где молчанову у них потому что эта цифра превышает нашу раза в 3 и вот тут приходит на выручку наш блог карбон это имплементации карбона на языке по неожиданно просто замена карбона дает boost где-то раза три-четыре по нашим расчетам притом вот на этом железе я повторяюсь мы просто совали где-то простите где-то примерно 1 и 2 миллиона расчетные данные говорят о том что мы текущем же сервере только заменив один карбон можем прокачивать уже спасибо до восьми миллионов метрик и теперь поговорим быстренько о том что все это объединяет объединяет это наша система мониторинга у нас своя клиент-серверная steam и это ринга я обещал об этом говорить совсем чуть-чуть но к сожалению это связующее звено которое связывает паппет которая связывает графит и которая связывает нас с разработчиками ну и монитор ник естественно тоже конечно же штука это делает следующая вещь и она собирает метрики ждет графит она собирает формация хостеле ну там всякие сколько у нас свободны в планы сколько у нас дисков сколько объемы стандартные вещи как собирают все и собственно push сообщение ментуре поскольку мы все равно рисую метрики мы эти метрики можем и мониторить что логично это делать там же где мы их собираем поэтому не буду распространяться опять же поскольку это него cursors мы используем именно это решение для мониторинга наших сервисов в основном тут надо отдать должное что она имеет такую особенность он не важно нет я могу рассказать просто это не очень интересно дело в том что у нас разработчики как правило ну как мониторить приложение никто не знает как работать и пришло новое приложение трам-пам-пам пам-пам т надо запустить запускаешь еще ну а о чем они только ну шепну что не упал ну здорово ну реально эта проблема каждой страны страт арбузе основы и сущность новый из точно не понят чуть не делать а вот и в данном у нас в этом случае мы договорились с разработчиками что они все наши логе стандартизируем нас все логе в одинаковом формате ну там типа таймс темп уровень и дальше ошибочка все демоны делают это одинаково поэтому а наша штука вот она умеет перец и лук и в случае error of info и так далее это экспорте прям в мониторинг то есть базовую настройку этого сервера мы мониторим очень просто мы говорим мониторим его лоб если он в лоб шлет что-то плохое мы об этом всегда узнаю ну об этом я не хотелось бы ну и соответственно еще имеется экспорт конечно ошибок большой мониторинг но это понятно что не будет по нашим отдельном мониторингу работать большая служба 9 админов которые обзванивают там and проектов поэтому конечно же у нас есть агрегация мониторингов которую смотрят непосредственно дежурный администратор и круглосуточные система оповещает фмс и все сопутствующие вещь вот соответственно что мы делаем для разработки я считаю что мы с нашей разработки и дружим мы в общем достаточно хорошо взаимодействуем и мы отдаем всю информацию какую только можем отдать им потому что важно чтобы разработчик понимал что происходит с проектом важно чтобы он понимал где что работает важно даже чтобы он понимал на каком сервере работают и усов я между железо чем больше информации мы отдаем тем меньше вопросов мы получаем а чем меньше вопроса мы получаем тем больше у нас времени сделать что-то хорошее для всего проекта поэтому тут небольшой список того что мы даем это собственно манифесты модем как же говорю потому что прячем наш наш маши пароль и соответственно весь софт какой работает мы говорили а штуки которая написана ресурс который imported прямо из попили из манифеста в нашем риторика список наших а стоп машина свободны тоже отдельный на механизме этого ресурса сделано штука там точно знаем сколько у нас свободных машин каждую минуту времени дальше конфигурации серверов истории метрик соответственно история alert of истории изменений production окружением все это естественные бонус которым получаем ну и в качестве ты сказать конца вещи которых я говорила модуль engine.exe go карбон это опыт собственные продукты теперь спасибо большое собственно саши быку мешки речонки рон ломоносову которая все написали которые вышли наше пожелание исправили то что надо так что можете использовать можете писать фидбэки чем больше будет отзывов team думаю качестве не будет продукт если он вам будет необходим на этом спасибо за внимание надеюсь я вас очень вогнал в уныние если кому то интересно и к сожалению не написал в презентации очень торопился не написал свои контакты повторюсь что зовут меня никифоров константин мой корпоративный mail к . никифоров собака кор . mail.ru все готов слушать вопросам здравствуйте и спасибо за доклад я коллю denis компания 2гис у меня такой вопрос а вот системный администратор он несет ответственность полную за то что он выкатывает в продакшн а у вас получается существует какой-то контракт или договоренность разработкой что вот программист приходит и он дает же не просто кот оон подтверждает нибудь зелеными тестами что все работает или как ну во первых во первых у нас есть договоренность нашим техническим директором который говорит о том что мы несем ответственность за все что выкатываю и вариантов как вы понимаете у нас не остается а с точки зрения тестирования кода конечно же у нас обложены различными тестами но это не мой доклад это доклад наших юань наших разработчиков которые здесь присутствуют можете узнать вот саша быка где-то здесь должен быть саша ты нет нет тебя да ну там девочки носит девочки тут просят малый человек спереди вот очень да я слышал добрый день меня зовут роман компания буду у меня вопрос про вашу систему растят плохо слышу на про вашу систему отката система манифестов к определенному состоянию это же не значит что мы применим например все манифесты за вчера это не значит что система вернется состояний в котором она была вчера нужно пройтись и сделать везде а там anger абсентом i'm sorry муфты так далее каким образом вы с этим боретесь и все если у вас конвенция там по написанию манифестов которые бы вот этот момент отслеживала да я хороший вопрос понятно дело мало того что есть injury абсента что это все одно дело другое дело что любая выкладка может сопровождаться еще побочными действиями которые естественно никаким образом манифесты не входит да то есть ну например там переключения мастера москве не festa сложно очень вписать такую штуку чтобы это была бездомной мог конечно же это делается как правило руками у нас как я уже говорил есть концепция красной кнопки именно концепция красной кнопки по называют тот факт что человек который откатывает берет ответственность за то что он проверил все такие случаи то есть не то что он жмет кнопку и ка давай катимся все взад такого нет я говорю что у нас ответственность всегда несет человек никакого технически автоматизации в данном процессе меня сложно представить я сомневаюсь что кто-то сделал такую штуку вас связного активно используется попе подобное я думаю что вы вопросы задаете по той простой причине что у вас такая же более вы не знаете что с этим делать может быть знаете удачны делал последнюю удачную конфигурацию потом приходит смотрит и все это руками нет как правило ты сделал как водитель а сегодня как человек который следит за всеми изменениями получает все комменты и так далее все понятно посуда конечно же я не буду это есть здравствуйте меня зовут юрий богданов компания grammar ли по поводу город был карбоном понятно красавчики с 68 миллионов метры в секунду в минуту сколько у вас это место занимает на диске whisper ну не так много мы же видели вот как выбить мистером масштабе выражалось интересно признаем количестве не как я же говорю сколько у вас скажем накапливается данных вот вот видите последний бочку последнюю строчку ведь это десятикратный запас ну круто то есть вы 16 на 512 за три года все храните да да но у нас структура я расскажу почему вас возможно это немного удивляет схема следующее мы храним месяц минутные графики и дальше мы храним десятиминутный но потому что реально график на год назад поминутно практически не нужно ну нам ни разу не понадобился именно ваня метрикам там более-менее сгорит я вас материал где вы ее я все здесь именованием метрика ну то есть там у вас метрики типа более-менее одинаковые по имени сервера все такое то есть безымянных метре которые пацаны появляются не туда появляются всегда метрики я же говорю что у нас из приложения непосредственно шлют метрики на сто лет насколько я помню вв спрятан файл занимается сам даже без метрик 5 мегабайт если их так много в зависимости от с кем еще раз я же вам повторяю whisper за ним во первых я вам говорил что есть некоторые разные бренды не только веспер есть например c 1 который сейчас активно они продвигают который занимает непосредственно ниаза лоцируют все места он растет согласно росту данных это раз во вторых еще раз повторю что мы храним минутные метрики всего лишь за месяц больше чем месяц мы считаем метрики минутные уже бесполезным sti минут на вполне достаточно там уже масштабы другие поэтому этого вполне хватает а да еще забыл сказать что конечно же если вот вы будете пользоваться то у нас есть механизм репликации карбона то есть нас графит в2 и соответственно карбон когда принимает он пересылает еще метрики в соседней карбон таким образом получаем две сущности которые совершенно идентичны но в карбоне данные механизм сейчас нереализованный если вы будете использовать можете написать роман наверное нам поможет это сейчас последний вопрос будет свой агент потому что вы можете не отпускать phd слышит хотим здесь просто вас свой один потому что у вас им коллекции почему-то не устроил свой агентством если городки для пакта я расскажу почему потому что им коллектив это из разряда как мы посчитали микроскопом забивать гвозди функционал нашего попытки кира он очень простой он имеет всего лишь две вещи делать он умеет делать по 5 гент минус t папитто гент минус ты нуб и урок в reporter все на этому функционал заканчивается вся остальная часть у нас реализовано в schedule ире уже scheduler ему говорит когда ему делать что ему делать и соответственно праве schedule управе серверную часть мы управляем нашим соответственно всем парка мы тихонечко и второй вопрос как вы тестируете вашим невеста автоматически еще корзину то есть кроме траск откуда у кого кроме очевидных вещей штифты выкатил манифест и соответственно проверила на синтаксис минут благо такой механизм существует штатно но мы конечно сделан вручную грамотно то какие-то виртуальные машины окружении где вот и стюарт какие-то виртуально машину у нас есть разное окружении у нас есть тестовое окружения то есть мы накатываем у нас продакшн это единая система которая всегда отдается его аффекте пользователя да у нас есть огромный президент например у нас разработчика и среда есть разрабы среди свой пакет и внимание наши разработчики используют точно такую же схему но в данном случае админами являются они вот такая вот история села большая константин отличный доклад василенко"
}