{
  "video_id": "G-AiDkZLOIs",
  "channel": "HighLoadChannel",
  "title": "Как мы поддерживаем 100 разных версий клиентов в Badoo / Ярослав Голуб (Badoo)",
  "views": 3507,
  "duration": 3036,
  "published": "2017-12-11T01:21:38-08:00",
  "text": "здравствуйте меня зовут ярослав я разработчик на php работая в компании bodum я из команды которая занимается разработкой и развитием api для всех наших клиентов на стороне бэг-энда и традиционно начале доклада пара слов о компания баду это крупнейший сервис знакомств мира у нас почти 400 миллионов зарегистрированных пользователей 350 миллионов сообщений в день и один след разработки львиная доля из которых была отдана разработки api и мы накопили большой опыт в этом деле как вы можете помнить раньше разработка бэг-энда сладилось тому что мы генерировать html отправляем браузер но теперь времена поменялись api это быка backend этого api для множества клиента в том числе клиентов нативных таких как и ос android который в отличие от браузера по f5 не обновить и так возникает проблема поддержки старых клиентов а когда мы разработчики что-то даем людям люди к этому быстро привыкают а когда мы это забираем пользователь испытывают боль поэтому мы в воду щепетильно относимся проблеме поддержки старых клиентов я расскажу как мы это делаем если взять какую хорошую книжку по протезированию опием либо открыть документацию какому-нибудь популярному фреймворком ну типа симфонии то можно найти один совет о том что хорошая ты должен быть fierce они rowan и в тот момент когда нам нужно нарушить обратную совместимость просто добавляете номер версии к вашему api и это хороший способ fierce они ровать api он много где работает он много где еще заработает я уверен что я буду применять еще долгое время нам в году он подходит мало из-за нескольких наших особенностей первое мы делаем не публичный api это значит что вы не просто предоставляем доступ к каким-то данным оставляя на утку клиенту все конечно реализацию нет мы одна команда мы сделаем общий api и команду и клиентской разработки это наша же коллеги которых мы видим каждый день и если какие-то бизнес задачи требуют того чтобы бэкон полностью подстроился под клиента мы обязательно это сделаем клиенты у нас есть под все основные четыре с половиной платформы и the web мобильный веб и ос android и windows windows половинкой потому что данный момент разработка уже заморожено но тем ни менее старой версии присутствуют и мы их поддерживаем жизнь в версии нативного клиента около года этот строй связан с тем что один год от приматов срок когда пользователь найдет кнопочку обновить в своем история либо поменяет телефон и обновить с ним наше приложение одновременно работающих версию на может до 30 на каждую нативную платформу ну еще стоит добавить что у нас помимо нашего буду еще пара несколько проектов поменьше которые также работают на нашем api вторая особенность у нас очень большая скорость разработки несмотря на то что нам почти уже 11 лет мы сохранили дух стартапа выкатываем новую рациональность очень быстро пытаемся что-то постоянно оптимизировать что-то улучшить и так далее и это приводит к тому что backend у нас рядиться два раза в день кроме пятницы когда мой обидимся один раз утром жизненный цикл в клиентов он длиннее связано это с тем что каждый клиент нативный клиент должен проходить около review и модерации в сторону и просто сам цикл немножко длиннее он занимает среднем одну-две недели и вот эта разница между резину циклом бэг-энда и резным циклом клиентов на самом деле приводит к проблемам проблему следующего рода вот смотрите у нас на воду весь чат есть видео чат и в тот момент когда вам кто-то позвонит по видеочату каким-то причинам до вас дозвониться мы вам сейчас начнем сообщение обычное сообщение текстом о том что такой то такой то тогда то тогда то до вас не дозвонился но потом мы решили это улучшить как вы можете видеть на слайде мы добавили туда иконку мы давали кнопочку перезвонить прямо из чатов удобно и самое главное мы стали отдавать сообщение не просто текстом html естественно для этого нам пришлось немножко поменять структуру нашего протокола чтобы отдавать это новое сообщение и что произойдет если клиент получит это сообщение в новом формате он может просто крашнутся это в худшем случае в лучшем случае таких как наши клиенты наших приложений он поймет что это новый текст приходят в новом формате и начнет его отображать но проблема в том что мы начали присылать html а это значит что пользователю себя в чате увидит html теги а пользователь на самом деле не очень любит rangers time или у себя в голове поэтому чтобы если бы мы следовать этому совету о котором я говорил ранее вы просто сделали новый релиз инкрементировать ли бы версию нашего api добавили вы туда в этот релиз наше новое сообщение видят что-то сделали опять этого давления с этими сообщениями и сделали бы новый релиз но так как мы релизимся очень часто то вполне возможно что на следующий день мы снова бы сломали обратную совместимость ну например поменяв профиль пользователя добавив удалив как там какие-то поля но мы знаем тот совет мы знаем кто подход выпускного сделали новый релиз инкрементировать версию и решили вы добавить в этот рис еще какую-нибудь функциональность например двойники и такой функционал о нашем сайте где вы можете загрузить фотку понравишься человека и система она идет всех зарегистрированных пользователей у нас который визуально похожа на того человека который изображённой там функциональности отличная функциональность невера сети все работает девочки еще мальчиков похожих на брэда питта начиная с ними общаться активность растет метрики растут надо выливать и вот представьте глава разработки какого-нибудь нативного клиента у нас воду решает что включить следующий релиз с бизнес точки зрения ответ очевиден двойники это отличная функциональность которая заходит которую нужно вывесить но так как они делают версию своего клиента под новую версию api который мы сейчас сделаем в этом релизе возникает парадоксальная с точки зрения бизнеса ситуация о том чтобы сделать двойников нужно сделать те самые новые сообщения видеочат о которых и говорил ранее ну да потому что новой версии api включает изменение всего сети изменения других других версий которые бы сделали и мы помним что нельзя не сделать эти изменения иначе пользователи будут видишь там или у себя в часть и это первая проблема которая возникает из-за наших особенностей но том что переходя на новую версию api нужно сделать всю поддержку полностью вторая проблема заключается в том что на самом деле видеочат как таковой актуален для всех клиентов ну например пользователи не очень любят добрая давать доступ к камере в браузер и поэтому видеочат для них не очень актуальна для всех наших приложений которые работают с браузера какой веб и мобильный веб для нативно клиентов у пользователя нет в этом проблем они спокойно дают доступ к мире спокойно звонят по видеосвязи и этот функционал для нативные клиентах крайне актуален это вторая проблема не всем клиентам нужен один и тот же функционал и третья наша особенность мы очень любим тестировать у нас огромное количество б тестов на данный момент и правильно густо тут вообще на слайде изначально было точное число на так как количество бы тестов нас постоянно меняется какие-то появляются новые какие-то закрываются я устал переписывать этот слайд и поэтому сейчас у нас около 200 оба тестов на данный момент и это на самом деле нормальная практика если оба тест это отдельная какой-то несовместимые изменение протокол на слайде вы можете видеть скриншоты одного и того же приложения одну и ту же платформу но для пользователя который попадает в бы то есть в контрольную группу и в тесту и критерии по которым пользователь попадает в контрольную или тестовую группу они определяли на столе серра это может быть страна это может быть возраст это может быть пол и все эти критерии могут меняться пример по пользователя в таиланде вещь мне такая стабильная как нам бы хотелось и вот эти проблемы которые возникают при том подходят которыми говорил раньше о том что у нас возникает блокирующая функциональность когда нам месте с двойниками нужно вливать какие-то и сообщение видеочат а вторая проблема о том что для всех клиентам нужен разный функционал не везде видеочат актуален и протокол зависит не от версии клиента или от версии api от пост от каких-то внутренних настроек случая бы тест требует от нас решения решение какой-то универсальный api который бы с каждым клиентом разговаривал бы на его языке которых клиентов понимает и мы в аду так собственные дела чтобы не ломать старых ну для того чтобы не ломать старых клиентов мы решаем парочку проблем поменьше 1 то что меня и протокол совместимо и вторая проблема том что нужно понимать что каждый клиент поддерживать каждый момент времени но прежде чем бы поговорить о том как мы меняем протокол совместимо расскажу немножко нашим фотоколле мы используем протокол основанный на google протирал батерс это дает нам массу плюшек во первых там схема валидации из коробки это значит то что не клиент не сервер уж совершенно откровенно чепуху друг друга не пришлют ну или по-крайней мере это чепуха будет описано в строгих рамках протокола вторая штука он бинарный что здорово нам экономит трафик по сравнению например секс мэром он типизированный что очень удобно когда вы ведет разработку на динамический типизированный языки для клиентов которые разрабатываются на языке со статической типизации ну и разум бинарный обычно возникает вопрос а по отладке у нас давно эта проблема решена у нас есть специальная tool за которая может дать пять все пакеты которые ходят между клиентом и сервером через сом и поэтому отладка не сложнее чем отлаживать а як запросы в каком-нибудь хроме в инструментах разработчикам на сайте вы можете видеть парочку примеров которые у нас описано в протоколе на том как клиент запрашивает чат и как сервер нему отвечает но самая главная фишка не в этом фишка в том что google у брата бафом есть такой общий про то файл где описываются все сообщения протокола и это просто файл общие для клиента и для сера это что-то ночью для клиента и для сиро несколько и видоизменяет наш workflow он выглядит примерно так бизнес задача сначала трансформируется в требовании изменения протокола а потом вот эта задача изменение протокола формулируется в техническое задание на изменение клиентов то есть задача сделать новые красивые сообщение видеочипа это бизнес задача формулируется в задачу изменения протокола о том что давайте сообщение видеочаты о том что какой-то кто-то кому-то не дозвонился будем добавлять туда новое поле где будет иконка новое поле показывать кнопку перезвоните нее перезвонить и собственно текстовое сообщение которое уже будет нести html и это задача уже на самом деле для разработчиков как бы канта и клиента становится общей только дабы кенди это нужно просто взять это сообщение заполнить его данными а для клиента соответственно правильно его отобразить и вот то что нам нужно поддерживать обратную совместимость то что наш протокол он находится в центре нашего workflow приводит нам следующим принципам того как и протокол меняем первый принцип это универсальность мы стараемся каждое сообщение в нашем патоку ли менять так чтобы оно было перри использована простой пример вот нам на клиенте нужно отобразить какое-то окошечко с кнопкой и мы сразу редко когда проектируем протокол понимаем что этих кнопок может быть больше чем 1 и соответственно количество кнопок которые мы передаём серрано клиент должно быть изменяемым поэтому оно должно пихать в массиве второе мы даем данное непредставление простой пример то что мы придаем нет дату 7 ноября 2017 года а сразу tmp это позволяет нам случае какого-то редизайна либо изменения формата даты не менять и протокол не backend это просто может произойти на клиенте второй третий принцип это унификация есть как один способ получить какие-то данные потому что у нас просто файл общий для всех клиенты для серого неудобно если какие-то клиенты уходят за данными по одному методу а какие то клиенты по-другому и также означает то что если мы что-то сделали новое то надо удалить старое четвертый принцип старые поляне удаляются потому что у нас есть старые клиенты которые ждут которые их любят поэтому мы никогда не удаляем старые поля так как у нас потапов для нас это дешево потому что если мы не заполняем поле она просто не перейдет к клиенту добавление новых полей должны никак отображаться новых клиентов аналогично это тоже фишка потапов а потому что те классы для а кодируем декодирования они годятся на тот момент когда все из поля и если клиент винил их до того как появилось это поле он просто ничего не знает об этих новых полей и соответственно никаким образом себя нарушить помощи их не может и 6 максимум водите на сервер но это понятно у нас один backhand и множество клиентов и если мы часть логике переносим реализацию на клиентов назначенную просто увеличим количество реализаций что с точки зрения бизнеса не очень оптимально на все эти принципы на самом деле не отвечает на тот вопрос а что же на самом деле данный момент поддерживать клиент какой формат сообщения ему нужно отдать его для того чтобы узнать что поддерживает клиент когда мы только начинали еще разрабатывать api это еще в начале десятых когда уже тренд на то что мобильность и так далее будет актуально но количество пользователя еще было недостаточно для того чтобы приносить весь функционал в этот момент еще с нашего сайта мы придумали один подход и ум до поры до времени работу базировался на одной простой идеи о том что при каждом обращении кассира пьян сообщал кто он в какой он версии какой платформы простой пример как эта работа на сайте вы можете видеть картинку анонс это если вы поставите наше приложение зайдете в него первый раз мы обычно покажем что нового мы сделали в последнем релизе вот эту картинку вы могли видеть тогда когда мы запускали видеочат казалось бы причем здесь марсиане рование улыбаешься девушка все хорошо но на картинке изображен телефон и почему-то телефон iphone и очень хорошо пользователям android показывать то что мы на айфоне запустили видеочат может возникнуть кому не нужны холивар поэтому нам нужно как-то разделять эти картинки и мы создаем специальные класс который у нас называется вершин менеджер на самом деле это просто класс который мыс instance которого мы создаем под каждую платформу и соответственно делаем там методы которые возвращают нам путь к правильной картинки и таким образом если клиент обращается и он android он получает свою версию картинки которую мы нужно отобразить таким образом и разрулим платформа зависимые вещи несовместимые сообщений видеочаты решалась быть точно таким же образом мы бы сделали метров которые в случае присылаемые версии начал да или нет если он в больше какой-то версии мы знаем что в этой версии реализована поддержка новых сообщений видеочат а возвращали в новом формате если нет то star это хороший метод который работал до поры до времени . так как мы водили постоянного функциональность мы постоянно что-то тестировали этот версию менеджер рос с учетом того что он делался под каждую платформу под каждый проект и так далее так далее так далее функциональность она постоянно росла возникал такой супер объект в котором реализованы все связи которые связаны у нас version ностью между сервером и клиентом и это первая проблема вторая проблема тяжело синхронизировать дело в том что например клиент готовит бьют готовить его к релизу его проявляя специальная команда на тестировали и в какой-то момент получается то что какая-то задача в этом билде имеет какой-то фатальный недостаток ну и естественно чтобы не портить есть белки порт есть released эта задача просто выпивается до следующего раза готовится билд и выкатывается но серверу обольщены об этом никто не говорит и поэтому нужно было постоянно синхронизация между клиентом и сервером о том чтоб понимать что ну вот этот функционал запустили и он должен работать должен был включён на сервер это было крайне удобно потому что зависит от человеческого фактора на так как проектов много клиентов много и так далее так далее приводило к проблемам поэтому пришлось подумать искать какой-то новый способ я как оказалось этот способ уже на тот момент у нас был вот смотрите versio не раване и она сама по себе не pro версии не только давать номера эти версиям и так далее это же про изоляцию нам нужно изолировать новое сообщение видеочат а от функционала показа их на старых клиентов т.е. старом клиента пыталась старые сообщение новое новым и точно также размещается проблема о том что нет видеочат не везде актуален нам нужно изолировать часть клиентов от этого функционала и на самом деле даже большинства из нас сталкивались такой же ситуации когда нужно изолировать их функционала другого ну например по тому признаку авторизован пользователь или нет давайте ему функционал для авторизованного пользователя peter доступ личный кабинет или нет но то что вы видите на слайде это случится с вами если вы попытаетесь настоящего до попытаться пообщаться с какой-нибудь красивой девушкой но не имея фотографии на самом деле вы на подумала что можете сделать без фотографий а потому что но это достаточно глупо быть на сервисе знакомств без фотографии и так как у нас фотографии зависит на много в том числе чат видеочат возможность того чтобы полайкать и кого-нибудь или нет то этот механизм у нас был унифицирован идея его была следующая что когда клиент в первый раз конектится к г-ну он получает на старте список фич которые у него могут быть включены или выключен и у на сайте например он сейчас получает пищу о том что у него недоступные видео-звонки они выключены и он не должен показываетесь на кнопку видео чатах на стороне сервера была специальная сущностью который был метод который каким-то признакам определял должна быть у пользователя включена эта функциональность или нет ну например потому что пользователь есть фотографии и так как у нас есть уже сущность по которой мы можем определять работает этот функционал или нет мы можем точно так же в коде что-то с этим делать ну например не отправлять push пользователю который не поддерживает видеочат о том что кто то ему попытался каким-то образом позвонить и если что-то поменялось например пользователь так и загрузят фотографию и у него возникнет возможность с кем-нибудь пообщаться по видеочату севера разошлет клиенту сообщения о том что да вот эта фича она включена и например придать какие-то дополнительные данные ну например в тестер воробья чада который нужно коннектится при совершении звонка и теперь следите за руками возникает идея а пусть состояние вот этой фиче при которой мы включаем и выключаем функционал на клиенте зависит от того прислал ли на старте клиент флаг а то что он ее поддерживает то есть возникает примерно такая схема клиентов присылает серов а потому что я поддерживаю данную функциональность сервер проверяет о том что да ты можешь этот я поддерживает такую функциональность у него есть возможность у нее есть фотографии у него есть еще еще еще еще какие-нибудь условия если да то он придет его сообщили до включая показывая кнопочка видеочатов пускай они пообщаются это на самом деле очень крутая идея потому что она даёт массу плюсов но первое то что мы перестаем ломать старых клиентов старые клиенты ничего не знают о новой функциональность а так как мы весь код покрываем вот этими самыми печами и раз клиента не присылают флаг то они никаким образом данную функциональностью добраться не могут мы можем раз проверить разработку каждый клиент каждой платформы может как в магазине набирать ту функциональность которую хочет в этот релиз и запускать июне ни о чем не спрашивая сервер 3 контроль неиспользованного кода так как у нас есть кот закрыты этими вещами а клиент их присылают на старте можем собрать статистику если какая-то пища уже клиентами не используется то мы можем этот старый кот просто взять и удалить и 4 очень крутой плюс это прекрасно ложится в оба тестировали смотрите пусть доступность в фичи зависит от того попадает ли этот пользователь в одну группу или в другую приобрести и таким образом мы можем включить функционал например того же видеочат а для определенных пользователя определенной страны для определенного пола и вообще всех мыслимых критерий которые мы можем придумать и 5 на самом деле по моему самая коронная фишка этого подхода учитывать то что у нас очень быстрая скорость разработки мы можем делать быстрые против прототипирования и проверять его на реальных пользователях ну например вы делаете какую-то сложную выборку для какого-то нового списка которую вы хотите показать на нашем приложении и по хорошему так как это сложная выборка нас агрегация с какими там мега условиями вам нужно создавать индекс как вы знаете у нас много баз много шахт и гоняет и создание но у яндекса занимает время требуют дискового пространства и так далее но можно сделать маленький прототип так как мы можем ограничивать количество пользователей которые пользуются нашим функционалом мы можем например запускать сделать простой прототип сделать простые запросы собрать это прям на бы пензе отсортировать среагировать так как нам нужна и отдать не создавая индекс на базе потому что мы не боимся какого-то холода мы ограничили количество пользователей и проверили на реальных событиях и если он это функционально взлетает метрики растут все хорошо и нужно запускать мы сделаем это оптимальный правильно если же нет мы сэкономили кучу времени и вместо не создавая индекс на нашей базе данных ну как вы и любых 0 подхода есть плюсы есть минус сейчас немножко минус 1 это избыточно дело в том что если вы помните про наше сообщение видеочат а то есть ли клиент присылает флаг поддержки о том что он до поддерживает вот эту новую функциональность то на самом деле эта фича всегда будет включена просто по факту того чтобы клиенты и прислал нам не нужна отдельная сущность нам не нужно ответное сообщение вы просто должны взять и перед прислать ему эти новые сообщения видеочат а потому что не согласитесь новое сообщение видеочат а красивее чем те были раньше и возникает такая схема клиент присылает что он до может новое сообщение видеочат а примерно в такой структуре с целый массивчик с огромным набором сообщение видеочата что он поддерживает гифки в чате и так далее и сервер настои из своей стороне проверяет примерно так что до clean прислал вот эту фичу значит отдаем в новом формате нет отдаем сторм вторая проблема которая возникает после длительного использования то что количество fitch стремится расти я расскажу как мы эту проблему решаем вот смотрите это профиль незнакомым вам человеком как вы видите размер экранов на клиенте и на в браузере он немножко отличается и в браузер помещается несколько больше информации чем на клиенте и если мы покрывали это вот все вещами элементарными фичами то количество фичей для разных клиентов для разных платформ поросло бы в геометрической прогрессии потому что каждое изменение поля требовало бы от нас новые фичи поэтому было решила что нужно это обходить тем что давать возможность клиенту запрашивать те данные которые ему нужны в конкретных случаях например случае профиля клиент просто запрашивает список полей которые ему нужны для этого ревана выражением а сервер соответственно создает ответ уже с учётом этих полей второе решение количество фич это удалять неиспользуемые пищу то есть если все клиенты реализовали функционал и не требуется никакого разграничения на включен у всех их можно удалить ну и последний способ как это можно решить это использует forts апдейт некоторые хотя нам и дешево поддерживать старых клиентов так как там количество пользователей уже становится слишком мало их можно отправить например на новую версию и тем самым тоже не используйте фича которые там есть и третья проблема которая возникает так как клиент обладают свойством о том что фарш невозможно провернуть назад бывает такая ситуация что клиент заявляет о том что он поддерживает какой-то функционал а на деле не очень либо по каким-то бизнесом требованием нужно форсированно его отключить то мы можем ориентируясь на платформу на версию точно также отключить какой-то функционал и так гладко и самое для того что я тут говорил мы не версия неру и mapi потому что у нас есть проблема если бы экранирование тем способом которым я озвучил ранее а просто in комментировали версию api у нас бы возникало блокирующая функциональность все то что при этом нужно разный функционал это что мы любим пировать поэтому у нас один api на всех мы меняем протокол совместимо и используем флаги с функциональности фича и минорная фича и если вы какой-то стартапы вам нужно быстро разработка вы можете использовать подход мы перестанет ломать старых клиентов может раз продеть разработку будете контролировать ход тестировать и самое главное быстро протестировать спасибо вопросам лично вопрос следующего вас входе там нету ада из ветвлений в итоге ну кажется что если каждую из 500 fitch начать где-то выпуске кодировать то в коде будет на самом деле архитектурная проблема то что все фичи должны быть изолированы друг от друга иначе мы точно так же вернемся к под проблема блокирующая функциональность и это вопрос проектирование и так как нам легче разнести код по по частям нежели каким-то образом смешивать и то что я вот показывал на слайдах это я просто- показывал на слайдах там как бы то что насколько она сложнее потому что используются конечно бендеры которые основываются на этих флагах и уже готовят сразу готовый объект тому чтобы отправить его клиенту то что условия но мне показалось это просто проще 23 билдера видимо но видимо от изготовления в таком случае внутри builder он занимаетесь какой конкретной штук не меняем хорошо да возможно будет но этого вопрос именно архитектурного проектирования и самого подхода то есть насколько сложно это вот вот главный то вопрос да насколько сложно это поддерживать с точки зрения там не запутаться где там какой iv стоит но обычно как бы есть старый подход есть новый подход и новый подход обычно лучше чем старый поэтому уровня ветвления 2 не должно быть по и действовать так используйте ну если как и бизнес задачи требуют того что нам нужно сделать для скифов ну мы наверное это сделаем здравствуй спасибо за как я тут вопрос по поводу безопасности правильно понимаю что на старте приложения клиент отправляет сервер запрос на то что какие фичу можно допустим посмотреть профиль кого-то и так далее что нужно добавить фотографии так далее если я ручками отправлю запрос на то что я уже могу просматривать чужие профиль это сервер не ответит уж такие как вы приходите ну во-первых если мы ограничиваем какой-то функциональность например тот же чат от фотографии мы не будем ориентироваться на то что таков пользуется пишу флаг это должны быть какие-то другие условия например в то что он прислал фотографию или так далее если вы с клиенты дизассемблер уйти его и пришлете какой-то флаг по наверно вы получите сообщение в новом формате он только что это вам даст с html теги я в этом клиенте ну то есть вы сломаете себе клинит нового я уверен то что де сабле ради сломаете еще лучше чем запрашивает сервер за какой-то чепухой но теоретически может быть такое что кто-то забудет и допустим там подтверждение ps этому словно логин ой какой в любые данные от пользователя нужно проверять не важно что он присылает он присылает логин и пароль и либо на набор фич то есть в любом случае им доверять нельзя такие спасибо пожалуйста сверху да добрый день власти а если вы встанете мы вас покажем тем кто трансляцию смотрит добрый день спасибо вася вопрос такое вы говорили что вас есть за просто пассивно юзера и мы можем спросить определенный набор полей для каких-то версий швы не смотрели в сторону графики ел либо войти а я тебе говорил на клик хаусе слайды не делать идея в том что граф к вере ли это на самом деле не просто про набор полей это все-таки язык запросов второе том что это мы используем этот подход как вы видели и мы из у него есть некоторые ограничения проблема в том что при каждом так как каждый клиент может запрашивать поля независимо ты доставать мы откуда ты должник тоже независимо потому что мы не знаем конечный набор и возникает такая проблема n + 1 запроса этот тоже самое если вы прм будете использовать лазила и вот представьте такая ситуация мы запрашиваем объект пользователя и за прошиванию 100 полей это в общем то дает нам на каждого пользователя 100 запросов в базу ну потому что в общем случае эти запросы должны быть отдельный эти за каждым пользу полем отдельно и когда вы запрашиваете список из 100 пользователей у которых есть 100 полей 10 тысяч запросов базу это не то что вам нужно это конечно хорошо то что устраиваете highload просто на одном пользователя на одном запросе но не оптимально поэтому-то возник нужно делать агрегацию понимать о том что вот эти поля нужно взять оттуда а то что у нас много скоро же это значит что мы должны понимать о том что в этом столь же нужно взять данное в этом столь же не нужная и каким-то они де нормализованным то есть возникает такая большая логическая прослойка о том чтобы эти поля хэшировать понимает что клиент засылает и так и к нему оптимальным образом их достать и так как мы не публичный api и работаем с клиентами в одной связке для оптимальные просто договориться с клиентом что он запрашивает и отдавать его то что нужно и подготовить для этого все споры же которые хранят наши данные что подавать это максимально быстро потому что но нет смысла увеличивается логику на сервере увеличивает логику на клиенте который должен понимать какие поля куда запрашивает и таким образом вы просто этим решаем проблему количество фич собственно преимущество которое дает граф и это на самом деле крутая штука очень круто я думаю что она убьет рез в конце концов но она имеет вот такие вот ограничения я надеюсь все понятно спасибо большое за доклад я слева от вас расскажите пожалуйста вот у вас проект он там работает год-два-три у вас на разных платформах копится разные версии клиентов одновременно потому что пользователям lenovo обновляться у вас появляются разные фичи я думаю они еще и разных версий как вы это трека и и пытаетесь ли потому что на мобильные разработчики по моему опыту они не очень любят писать что у нас в билде а номер таком-то вот такой список api используется чтобы понять что под такой топи уже можно вырубить в какой-то момент или но как все там типа вырубили в смотрели упала не упала до ну они же присылают этом запросе мы соответственно мужем это залакировать построить график использование че и просто у нас есть список вещей и список клиентов которые поддерживают табличка легко и просто посмотреть что вот эта фича как это поддерживали подержит вообще то есть вы ведете табличку они по запросам каха ттп какие конца дергают как данные попадают в эту табличку не попадает в конечность запросов меня запрашивает передай этому эти данные мы кладем в табличку я понял спасибо галёрка пожалуйста расскажите просто право накладные расходы вот с учетом такого фича toggling подхода именно по времени разработки то есть у вас наверно похожая функциональность есть которую приходится поддерживать но интересно по времени на сколько дороже мне кажется это наоборот облегчение потому что и я не представляю как бы это взлетело бы на традиционное гарсиа не рование как она есть именно на самом деле то что мы использовать такой подход флага функциональность это следствие того что нам нужно разрабатывать очень-очень быстро и чем меньше мы согласуем это с клиентами чем меньше у нас какой-то конфликтующей функциональность этого собственно мы и даем то есть как бы вот такой подход эволюционная которое возникает вследствие того что мы сервис знакомств нам нужно быстро быстро быстро спасибо за доклад у меня один вопрос я с правого кто это вот здесь вот вопрос больше организационные так понимаю у вас вначале не было вот этой чудо схемы была какая-то старая своя за какое время вы смогли перевести конечные клиенты да вот текущего состояния и смогли ли вообще перевести да и все клиенты переведены эту схему это отдельная история подходите к нам стойке есть коллеги которые скажут как происходило open фикации в.в. а еще на самом деле на ютюбе есть прекрасный доклад помада бушем а потом эволюции вот мобильной разработки у него все очень хорошо рассказывай мне у меня лучше не получится а по срокам кратко ну полгода-год 2 долго-долго это итерационный эволюционным процессом нет какого-то конкретного момент но я на самом деле не застал этот процесс по этому подходить настойку мы найдем старичков они вам ответят понял спасибо сейчас кончу второй ряд ярослав спасибо за доклад подскажите что вы делаете если у вас меняется бизнес-логика в рамках одной фич и бывает ли у вас такое у нас бывают это постоянно и мы и меняем но version насти нарушается но если это изменение протокол понимаете фича это несколько это в том числе и то это и продуцирование бизнес каких-то задач но если нам нужно разделить именно в рамках изменение фича но мы вернем либо видел минорную фичу либо после сделаем третью фич и таким образом разрулим то есть идея в том что нам нужно когда защитить вот этим необратимые изменения и мы можем сделать это при помощи фичи и папа думать вообще ну на самом деле пытаемся проектировать по так вот таким образом что таких ситуаций не возникало слева здравствуйте спасибо за доклад хотел такие вопросы спросить как сочетаются фичи с запросом полей нарезка ресурсы соответственно но когда-то показывал слайд обращаешься на ресурс передаешь допрашиваешь поля мне папа пользователи такие тополя когда но и если какое-то из этих полей при ну там присутствует фичи и там не знают о фичу же выключена как это согласуется вот запрос полей и фича the bling они работают совместно например на профиле некоторых случаях можно запросить оля о том что показывать кнопку видеочаты или нет и этот как бы поле зависит от того включена эта фича у пользователя нет на самом деле мы как бы использую миг всех этих подходов для того чтобы максимально быстрая и оптимально рулить тем кто какой функционал в данный момент нужно пользоваться конфликты какого-нибудь что на сервере выключили там какую-то фичу которая пройдет какое-то поле в пользователи и клиенту его запрашивает что нуб упали вернет то что ничего нет ничего нет еще такой вопрос при запросе полей если там каждое поле это какая-то вычисляемой а величина и как вы вот в коде организуете как-то вот если вас к движок для того чтобы процессе запрашиваем поля там по отдельности группировок да да там такая достаточно сложная система о том что как присылается набор пользователи вычисляется топ примерно по хранилищ этот набор хранилище откуда максимально эффективно доставать эти данные проверяются о том что в кашах они в кашах и так далее на самом деле это такая больше организационная задача понимать о том что вот это поле тяжелая и как-то договариваться с клиентами чтобы они не слишком часто это запрашиваю либо начинать это оптимизировать и так далее ну то есть да у нас есть умная прослойка которая понимает о том что какие данные оптимальным образом отдать или она достаточно сложно все спасибо спасибо 2 лет спасибо за доклад я хотел спросить как вы таблицы фичи которые нужны нескольким юзерам например видеочат да я обновил клиент я его вижу я хочу позвонить там своей подруге которая не обновила клиенту не покажете в списке контактов либо она там на планшете обновила на телефоне не обновилась такие вещи которые функциональность кросс на несколько юзеров как я понимаю вопрос наверно побольше про нескольких клиентов то что у нас 13 поддерживать не поддерживает все фичи флаги которые присылают клиент сохраняются пользователь сессию под того клиента с которого он работает и то есть мы даже если пользователь у нас не авторизован поднимаю его сессию мы можем понять что если я вам звоню а вы не онлайн ними и мы поднимем просто как бы знаем что вот вы были там онлай там три дня у вас есть такая-то сессия вы прислали поддержку флагов то есть у вас есть поддержка видеочата да есть смысл заслать вам пусть о том что вас показался кнопка взять трубочку от меня то есть в этом плане есть вот четвертый ряд пожалуйста добрый день спасибо за доклад для такой вопрос каким образом вас происходит согласование флагов между бэг-энда мои клиентами и были ли факап и наименованием тех же самых флагов для разводного разнообразных вещей но тут видеть у нас протокол на самом деле находится в центре workflow этим занимается отдельная команда и у них и так как так как это единственный один profile один список всех этих фич то финчу с одинаковым именем вы просто не сможете вставить то есть клиент торчит а этот просто файлы и соответственно дары и спорта файлы сделаю генерируются классы для того чтобы кодировать по такому понятно спасибо пожалуйста наверху спасибо за доклад а у меня вот такой вопрос тут уже казались отключаем их речей гости она была на старой версии на новое решение что она почему-то не нужно можно с помощью этого механизма отключить и на старых клиентах каким-то образом фичу ну то есть мы поняли что она как-то аналитики поняли что это фича как как плохо влияет на пользователи не нравится им да мы можем это вообще такой подход на самом деле то что мы можем делать приложение при помощи этих вещей персонально то есть на самом деле и если взять какой-нибудь супер популярную девочку на основном сайте то вид того как она выглядит предложение а у него просто большая активность списке контактов там не бывают 1000 человек может написать чад не нужно каким-то образом группировать сортировать его для этой девочки благодаря этим вещам приложение немножко менять вид она цитирует из да если спрашивать потому что можем выключать какой традиционалист да мы можем вообще делать и персонально под каждого пользователя новый функционал включать или выключать фичу понятно спасибо вот слева здравствуйте спасибо за доклад иван волков ты стоит его как вы одну и ту же фичу показываете на разных клиентов нам на айфоне на андроиде и так далее то есть это разные фичи или это одна фича которая как-то сгруппировано принцип вот это унифицированных да то есть мы считаем что одна фича должна реализовываться но исходя из простой логики если эта фича хорошая она взлетает то почему бы не сделать нет я я спрашиваю про то как вы отображаете там разные картинки на приобрели за разная логика на дроиде и на айфоне разные фичи или это или коктейль на другом делать спасибо нет это не различает одна фича потому что я конечно я реализация она на клиенте чтобы мы отдаем клиенту просто от сообщение протокол о том что сделаю вот плата покажи кнопочка видеочат том с какими сердечками он рисовать с красным или там зелеными так далее это определяются уже на стороне клиента исходя из каких-то там бизнес-задачи спасибо за так вот прямо по центру наверху до этого drive как вы фиксить и баги на старых клиентов то есть бага это для вас будет новая фича для старых клиентов или что что вы имеете ввиду фиксить богуна новом приятеле совсем полета он же не ешь фарш невозможно провернуть назад если клиент как-то работает невозможно но мы можем выключить фичу я правильно понял не ты и не надо выключать но вот именно на старых клиентах вы обнаружили могу его мы ее надо выкатить только со старым клиентам но вам не надо ну как бы я я не могу залезть вам в телефон и поменять вам версию приложения если вы про это а по протоколу на сапе я но всегда последнюю версию для всех если у нас какая-то бага для конкретного клиента но нас есть механизм как бы понять то что этого клиента такой-то версии с такой-то платформы есть такая табага и если мы можем что-то сделать на стороне бэг-энда секса ну да мы сделаем напишем условие о том что если тренд такой версии нет или да зависимости от а что начинай силы вас за доклад все клиенты я так понял разрабатываются вашей компании все клиенты разрабатываются в компании году да список fitch зашит в код клиента наверняка а не возникало таких ситуаций когда клиент в целях разработки например хочет форсировать включение какой-либо фичи сервера как решали такой вопрос ну если он хочет форсировать он присылает то есть он просто запишу в коде хочу его эту фичу отправляю ну да в чем проблема но вопрос безопасности если вы через механизм fitch можете решать какие-то вопросы не фичи это не про безопасность в любом случае к те данные которые приходят серые любые данные они могут быть подделаны они будут переправлены и сервер не должен доверять это все равно что многие нельзя доверять всем данным который прислал клиентами если вам логин и пароль прислали если вам прислали логин то вам нужен пароль чтобы удостовериться том что это пользуется фича это не флаг сикер насти это в том плане что он сможет включить у себе этот функционал подделав это но мы входе в любом случае проедем что те условия которые нужны для этого функционала например наличие фотографии она будет зависеть и от фича она будет зависеть от наличия фотография и это будет у нас храниться в базе и никаким образом извне и писать нам какой-то флаг но не появится фотография назад он пасёт фотографию но то есть вы ответили на вопрос что неправомерных использование fitch со стороны клиента невозможно не она возможно вы можете прислать любой набор фич но если вы пришлете какой-то не правильный набор фич интерпретировать ему данную нам все равно и затем потому что мы на стороне бэкенда твоем а то что вы пришлете не поддерживаем протоколы клиент у вас упадет потому что вы решили представим сервис фичами но это ваше веселье спасибо спасибо спасибо за доклад у меня два вопроса первый вопрос в вашем случае выбор потапов это обязательно и решение то есть например случае ricoh уже мы не сможем да то есть данных будет она больше гоняться но почему про табов или это никак не связано и начнем с того что про табов у нас используется не только протоколе связи с клиентами вообще с взаимодействие со всеми серыми во многих во всяком случае во вторых почему говорю про табов приходите к нужному туда там мы найдем всех людей которые помнят еще те времена 10 лет тому назад к дому это как у поднимали ну и мы вам расскажем понятно спасибо и второй вопрос по поводу данном случае все клиент как уже упоминался они как бы приватные да то есть это все внутри компания а случай публичного и 5 такая схема же работа не будет до или есть какие-то рекомендации как это возможно потому что именно за счет шаринга до вот этого api и который про добавки не ряда меж всеми компонентами ну эта проблема с нами да хорошо спасибо я не думаю что как бы вот использование вот этих флагов функциональности на самом деле зависит потакала просто протокол такой мы используем фичи они идея была в том что протокол меняется ввести масштаб можно в одном потакали был отсылать и старые и новые сообщения чтобы они не конфликтовали для этого не надо удалить там старые поля новые поля это первое то есть протокол муж быть любой второе фича не ищу ни наверно на публичном api это заведется мое мнение что заведется но я не знаю что кто-то это использована публичный api ну потому что по большому счету от флаг версии при стандартном подходе он этот уже флаг только там функциональности под этим флагом скрывается гораздо больше на целый resist новая и новая версия это тоже флаг это работает ну тут то что можно набирать эти фичи параллельно но это просто задача архитектора так что party fitch не пересекались с а почти к моему и моему мнению это на публичном api заведется но если кто-то сделает напишите мне и я посмотрю спасибо справа смотреть до 200 спасибо очень интересно сразу возникли мысли как бы это такой подход использовать без привязки к протокола а можно тогда немножко чуть-чуть поподробнее не раскрывая корпоративных секретов вот на стороне backup понятно что там фичи реализуется не через iv и вот чуть-чуть там дизайн какого плана вот ты говорил builder там используется и в чем заключается в последствии удаления печи то есть но условно как будто бы мы удалили iv и у нас теперь эта функциональность жестко связан смотрите тут как бы понимаете вот я из команды фич мы занимаемся протокол боль наша заключается в том что вот я сегодня неделю писал отличный код вкладывался в него и все в таком духе а через неделю приходит prada говорит слушай не взлетела удаляй то есть да можно много кодов писать сделать это оптимально обойтись без рывков и все в таком духе но когда у вас есть ощущение о том что как бы вот вы делаете прототип и не завязаться на рифмы нет никакого смысла если вам удобно запишитесь на их если вам нужно какую-то другую схему сделается другую схему это как бы не вопрос именно фич и не вопрос условия вопрос того чтоб клиент присылает тот набор функционала который поддерживать каким образом от реализовать это в общем-то не него в не вопрос именно вот этот подходы версия мировая точно также как вы не зависит от того как вы будете обрабатывать номер присылаем версии при стандартном подходит почти скуку через кадр и так далее так далее это вопрос реализации как вам удобнее но здесь вот реализация табуретов builder какой то есть это именно как поттер дизайна то есть есть некая функциональность которая порождает они builder я оба фабрику передаешь параметры там точно также условия но выдает тебя объекты не и соответственно удаление фичи я так понимаю именно удаление когда она устаканилось условно все клиенты перешли уже на нее удаление происходит в том плане что она перестает быть условной и она становится просто железная именно так спасибо здравствуйте спасибо за доклад интересует такой момент а как вы контролируете с точки зрения документации вот все фичи то есть я так полагаю что есть несколько мест где эти фичи реализуются это backend frontend потом протокол все это дело надо связать воедино и где-то держать под контролем и каким-то образом все эти вещи нужно между собой синхронизировать потому что у фичи тоже есть версии тоже есть патчи это все движется плывет и просто как-то сделать срез системы и понять в каком состоянии сейчас она вот ну в этот момент находилась и тоже определенный труд то есть нужно как бы там если пришла какая-то бага нужно понять откуда куда и как она вообще заведет то есть как вы эту проблему решает до документация пишется на этапе изменения протокола у нас есть специальная команда которая помимо изменения протокола обязательно напишет под эту документацию о том что куда про происходит эта документация в общем виде она доступна для всех и все концы в общем этой документации потому что вокруг протокола строится вся разработка вокруг по такого строится документация двор каких-то бизнес-процессов нам тоже пицунда опцию все это есть и да это тру туда спасибо и росла в самое время поклониться в пол спасибо да спасибо большая"
}