{
  "video_id": "UMcYe5GstBo",
  "channel": "HighLoadChannel",
  "title": "Beyond WHERE and GROUP BY / Сергей Голубчик (MariaDB Corporation)",
  "views": 1805,
  "duration": 2654,
  "published": "2018-08-16T04:58:39-07:00",
  "text": "вкратце обо мне о чем переключается страну ну так вот у меня зовут сергей лучики работаю mary 2 к порошенко кочев а катя к моей деви и работают но исходниками миску с 98 года и защитят аномалиями проблема я могу говорит слишком быстро поэтому не стеснять исключать с места чтобы я наговорю помедленнее так вот что знают все и вся чем все пользуются это сказал 86 это всем знакомый select from heaven грубой а любой еще если метну нестандартным все работает хорошо бизнес работает клиенты приходят деньги там куда-то копают но блин это же 8 6 год это год таких не знаю когда были такие крутые технологии как sql фортран и quick basic вот у меня даже tagged на пиджаке и литров технологий только 2 дожили до этого доклада греки буду еще только прогну это с тех пор придумано было много черного родилось много присутствующих здесь присутствует телей так что переходим сразу к светлому будущему это девяносто второй год в стандарте 92 года появились уже групповые операции то есть там сообразили в комитете что результат selecta это просто множество множество строк что кстати означает что нужно всегда использовать позже buy если нужен какой-то конкретный порядок же множество на неупорядоченные роста множество значит можно рисовать кружки можно пересекать диаграммы венна чем мы делать не будем и взрослые людям сразу перейдем к снег там вот пример есть две таблицы в одной значение 123 во второй 111 21 union существовать маска уже давно и он это объединение множества то есть сестрой который присутствует или в одном солдат или во втором то есть 1 2 3 1 из 21 очевидно и другие операции были мало кому нужны поэтому поэтому их сделает только сейчас они присмотрели 53 это intersect пересечении множество то есть найти те строчки который присутствует в обоих собак так сразу то есть один данном случае и except вычитание множеств те строчки присутствовать первой таблице но не присутствует во второй то есть 2 и 3 скрыл 99 это был гораздо более значительный шаг вперед появились обращенные табличное выражение команды были экспресс что это такое вот энгус начала пример с под запросам in from class это то что существовала и до искал 99 точен синтаксисе таким тенденции я надеюсь знакомы знаком пользоваться то есть данном случае здесь таблица anglais мы из нее выделяем только инженеров через окулус репаро но инженеры и вот оттуда выбираем те кто что-то понимать optimizer и с помощью в общинных от обычных выражений то же самое можно сформулировать почти так же на немножко по другому то есть назначали пишем под запрос а потом пишем салат это можно себе представить как одноразовый такой view который создается включим слова виз действует до конца станут еще раз для сравнения вот наверху это под запрос в поле from и внизу это обобщенное табличное выражение то есть фактически это такой синтаксический сахар чтобы можно было немножко по-другому записывать уже давно работающие штуки разница есть на на минимально то есть повышается читаемость как вот и особенно если вклад строят вложенные подзапросы то здесь мы из этих инженеров кто понимает optimizely ночи выбираем те кто говорит по-русски и это в принципе даже поместилось сколько там четыре пять строчек но представьте себе что каждый под запросом на две страницы и больше бывает продакшене легко и тогда это становится уже совершенно не читаем с помощью вообще нас табличных выражений это читать гораздо легче просто задается как бы первый такой view ну в личное выражение из ниже статься 2 которой входит 1 в конце идет основной запрос это гораздо обозрение и можно переваривать по кускам второй пример если нам нужно использовать один и тот же под запрос два раза тут становится все совсем плохо опять же сделаем мысленные усилия представим что каждый запрос мне в пол строчки она 2 страницы тогда даже не видно что неодинаковое здесь он определяется только один раз и сразу видно что это один запрос используемый два раза в основном запросе то есть опять же улучшается читаемость не нужно два раза писать одно и то же как такие запросы будут выполняться внутри сервера внутри optimizer а самый лучший вариант это как вот когда из пальца метод слияния то есть way умер это и в этом случае optimizer он берет запросы под как макрос подставлять у вас в основной запрос то есть видно если посмотреть на select который под стрелкой там нету никаких сетей вообще никаких view а просто джон из двух таблиц т1 само собой и условия в а больше пяти она перекочевала в оплот основного запроса получается очень простой запрос просто делаем джон из нескольких таблиц какими-то условиями оптимальный знает как такое делать он может посмотреть статистику выбрать ком порядке делать ее там какой тип джона и все такое то очень удобно сожалению такое счастье бывает не всегда в этом примере дописан наверху грубой и после такие запросы между тоже нельзя после этого единственное что optimizer остается сделать это выполнить запрос сохранить говоря временную таблицу и потом выпал весной запрос это временные таблицы да это конечно условно на самом деле никого creed empire это был не выполняется внутренняя временная таблица но смысл в том же самый видно что это явно не оптимально то есть двора создаются одна и та же таблица только потому что она хочет два раза основан в основном запросе есть разные методы этого решения и разных реализациях выбрали соответственно разные пути решения такого вопроса в миску л 80 и в после раз используется метод используется теккерею с то есть повторное использование временных таблиц и она создается только один раз потом она используется два раза в основном запросе что конечно хорошо таблицы дается только один раз в мария биби и в microsoft и скрылся этот метод не используется вместо этого используется сам кондишен page down когда условия из внешнего запроса вот этом есть b в 2 b равна 7 и 1 b равно 10 если посмотрите внимательным взглядом на кто как ставится временные таблицы внизу из вас насадок и это в этих условиях же нет они как бы проткнул подтолкнуть его внутрь условие временной таблицы и они применяются так рано как только можно в процессе создания временной таблицы это под вот это то что делает на lady by из конфет это потенциально гораздо более сильной оптимизация потому что b равно 10 способна отфильтровать и собственно почти всю таблицу т1 и соответственно бы синтез гораздо меньше строк пишется во временную таблицу но другой стороны она делает эти два запроса для времена таблицы неодинаковые поэтому их вы же нельзя использовать повторно то есть фактически эти эти два запроса эти две оптимизации они противоречат друг другу бывает обычно или только одна или только 2 или мы проталкиваем слой времени таблица инстанция не одинаковыми и мы делаем одну одну временную таблицу на всех и потом мы повторно используем тогда она может получиться очень большая но как-то нехорошо хорошо читается все такое тем не менее это я не стал это достаточная причина это придумали нового синтаксиса я думаю что это все сети наворотили стандарт для того чтобы делать рекурсивный сетей в том же ключевого слова рекурсия а это уже совсем как бы другая штука намного более мощное чем просто изменения синтаксиса вот пример с рекурсивным запросам мы создаем используем ключевое слово рекордов и создаем запрос нужный он создаст предки который среди двух частей начале идет select обыкновенный select под потом идет обязательны union all и потом идет второй сайт который использует этот самый сети внутри себя то есть как бы сети определяется сам через себя поэтому она называется рекурсивный как это будет выполняться внутри сервера представимся скакать таблица мы начинаем заполнять результатами вначале мы выполняем первый запрос находим столице fox где имя равно я собственно вставляем строчку со мной в таблице результат а потому выполняем 2 судак to join forces ii ancesters где в качестве and stars первое имеется только первая строчка со мной находим соответственно моих родителей эти две строчки добавляются в результат потому опять выполняем 2 select используя предыдущий на гены и строчки в качестве как бы входных данных находим еще четыре строчки с родителями моих родителей выполняем этот запрос еще раз находим еще восемь строчек и так далее пока таблицы фокс не кончится таким образом можно пройти древовидную структуру данных то есть дети родитель родители кроме геологическая него и одним запросом не сказал что раньше до появления рекурсивных вообще на вторичных поражений было вообще невозможно то есть это не другой способ как то же самое а это страшно принципиальная новая штука которая раньше высказал за 99 года не было и их очень и спорт удобно использовать для генерации данных вот например числа фибоначчи и факториал это как мы ногах и логово в мире в курсе вчера показывал факториал сегодня числа фибоначчи дым для audi курсивный запросто но фибоначчи в число фибоначчи каждый число завист от двух предыдущих поэтому будем в каждом субъекте создатель два последних числа из сгенерированной последовательности начинаем с того что до последних числа равно 11 как до встречи на запросе предпоследний это предыдущие последняя новая последние то сумма соответственно 2 предпоследних ну и получаем знакомы детства после отдельности 11235 8 13 21 и хочет то есть сети очень удобно использовать для генерации данных а что важно каких нибудь отчетах например не знаете как таблица посещаемостью кого-нибудь сотрудника например мы хотим посмотреть какие дни он не приходил нужно сроки не joy нитью с таблицей всех рабочих дней за данный год эту таблицу можно конечно и сохранить мы можем сгенерировать на ходу с помощью сети как здесь а генерирую выходные просто для разнообразия вот так вот можно ниже можно посчитать все выходные дни 2020 году начинаем с 1 января и каждая следующая строчка это предыдущая плюс один день и повторяем этот а тех пор пока мы всё ещё стоим за 2020 году и в конце салаг то мы выбираем выходные и где считается 0 то есть 5 6 1 суббота воскресенье очень очень удобно использовать для генерации таких данных которые вычисляются алгоритмически не надо предварительно их забивать в таблицу или генерит на печь фильтр на прости воспалены его скрипте вот теперь возьмем несколько более сложный пример такую микро социальную сеть зашкал на на социальную сеть у нас его восемь человек 8 человек у них есть имена номера и табличка френдс показывайся кто с кем дружит и допустим мы хотим найти цепочку друзей чтобы познакомить джейсона и крис начинаем опять же рекурсивный писать рекурсивный запрос начинаем с крис и от ее имени будем строить цепочку друзей которые в конце концов может познакомить для там и каждого и купили курсе на каждого очередного друга мы находим путем join с таблицей фрэнк то есть они должны быть в одной строчке нужно иди быть соответствует строчки таблицы france и при этом каждый мы не хотим циклов поэтому каждый новый друг он не должен быть в списке уже найдены друзей и после этого его имя дописываем к пути просто через запятую и сделала все это мы выбираем цепочку который заканчивается на 4 то есть это джейсон броском и начинались крест и вот так вот это будет выглядеть то есть мы получим всевозможные цепочка начинающий из крис и заканчивающийся джейсон этот запрос можно было бы сделать более сложным так чтобы он останавливался допустим после первой самой короткой цепочке cydia работает так что это поиск ширину той самой короткой цепочке валюта наверху и поэтому можно было и на использовать усложнить запрос так чтобы остановился сразу но тогда он вполне возможно не поместился бы на слайде таким вот образом можно найти путь в графе то есть видно что если не знаю мишель мишель пригласить джейсона имена день рождения ими притащит собой кресту это можно совершенно случайно познакомить с планет вот итак выводы обращенные табличные выражения не рекурсивные обращенные табличные выражения не заменяют собой под запросы from но они лучше читаются и в некоторых случаях они лучше оптимизируются в мария-де-белен оптимизируется не лучше то есть на все оптимизации которые применимы к сети и мы рябить также применимо и к view их под вопросом но в мае сказал это используется оптимизация серию с когда под запросы плавится только один раз используя несколько раз его невозможно использовать к запросам через уже сравнишь выбиться неодинаковые он чтобы подзапрос помянуть два раза поэтому в москву они лучше оптимизируются чем в чем подзапросы рекурсивное же табличное выражение это совсем другое дело то есть они позволяют проходить работы с графами и разными иерархических структур данных типа деревьев там начальник подчиненный можно спорить для генерации данных для разных отчетов это вот насколько знаю не делайте скалкой полным по тьюрингу то есть можно делать совершенно сложные штуки если вам нечем заняться долгими длинными зимними вечерами можно делать я видел сети и запрос легко можно легко нагуглить который решает судоку виден татар brain факт на одном сети то есть и ищем занят ну и конечно если вы хотите узнать по подробнее про ради курсивный обращенные ты лично рождения можете прийти на мой доклад в четыре часа в аудитории пекин шанхай это было рекурсия так вот следует следующий стандарты сказал об оконное функция 2000 появились 2003 году опять же английской песни что это такое обычная функция высказал они не срослись таблице мы применяем к нику обычную функцию типа синуса или concat она вычитается для каждой строчки этой таблице и выжать опять же получается от одно новое значение на каждую строчку если таблица была не знаю 1000 строк мы применили функцию получай основой таблиц из тысячи значений групповые функции работают не так они в работу вычисляются 11 раз на каждую группу в группу строк и выжидать и будет столько значений сколько было разных групп то есть у нас было 1000 строк и по 10 строк в группе то на выходе будет всего 100 значений оконные функция это нечто среднее они вызываются для каждой строки то есть нас было 1000 строк она срок останется но значение оконной функций зависит от целой группы строк они от одной текущей что-нибудь они как бы смотрят на строку и видят несколько строк вокруг нее так как принимать группу зависит от каждой конкретной оконные функции это у как вы напишете этот запрос вот например запросе по нахождению скользящего среднего группа окно определяется как две строки для предыдущей строки прежде последующих строки здесь мы усредняем шум вычисляет среднее для каждой строки с учетом 5 строк вокруг неё вперед 2 назад и от носа это типичный очень способу соединения разных шумов а практически это может быть из того что может попасть таблицу например график акций или посещаемость какого нибудь сайта вы хотите обратить случайные колебания чтобы вычислить и нибудь тенденциям вот теперь рассмотрим пример с выселением промежуточных итогов у нас есть кое-то условный банк и не из таблицы с транзакциями каждом зале есть номер есть номер клиента который транзакцию произвел и соответственно сколько денег он снял или закинул насчет вот он вот эта табличка и мы хотим считать сколько осталось на счету этого клиента после операции то есть что-то хотим получить что-то такое того как первый клиент снял 50 каких-то единиц тугриков у него стало -50 этих самых трудников на счету у нас банк очень добрый позволяет уходить в минус 2 потом третий клиент закинул 50 вне стола плюс 52 закинул стол нюхало плюс 101 положил 950 у нее было -50 стала минус 50 лет 950 s 900 ну и так далее как можно такое вот число посчитать это его можно почитать помощью под запрос а то есть мы считаем мы хотим посчитать сумму для среди всех транзакций для транзакций только того же карта мира и с номерами которые забыли про то с номерами меньшими или равными текущему номеру им образом мы можем почитать в самую сумму блюдо получается вполне правильно и все как бы хорошо работает минусы что это несколько сложноват и все таки не очень сложно достаточно сложноватый под запрос и не очень просто понять что он хочет что он делает потому что нужно на него смотреть как бы пытаться так сумм надо и потом пока не осенит что это на самом деле мы считаем промежуточный итог с помощью оконных функций то что можно написать несколько проще если не короче здесь мы пишем что мы ups es напишем что мы считаем разбиваем все строки все транзакции на группы для каждого каста мира отдельно из сортируем их в порядке возрастания номеров и потом просто суммируем от сам и получается та же самый промежуточный итог то что он только что было это можно было раскрыл написать явно записать окно что она присоединен bounded between присоединен bound and control то есть от самого начала группы до текущей строки это можно не писать поэтому нужно получить гораздо более короткое выражение для оконной функции плюс кроме того что это короче просто приятнее писать и легче читать еще такое преимущество в этом варианте для каждой строки и сказал сервер должен пробежать по всем строкам чтобы посчитать сумму для каждой строки он пробегать за нам по всей таблице получается квадратичная сложность если мы 2 увеличим количество здесь весит 1 время выполнения бросать примерно в 100 раз здесь же серы такого не делает потому что он ну что мы вы не просим продвигать прокате таблице мы просто говорим что нам нужно нужно промежуточный том сам придумать как его считать и он считает так то есть когда он видит следующую строчку фактически она считает вот так вот то есть когда он видит предыдущюю строчку следующую строчку для какого-то клиента он просто прибавляет предыдущий промышленном только текущей строки то есть он держит аккумулятор увидел 50 привожу 50 тут 100 вычел что и каждый раз он не пробегает сначала он делается за один проход таблица получается линейная сложность увеличим 10 раз конечно строк 10 раз будет дольше выполняется запрос какой-то образ следующий пример вот и если параде если посмотреть какой-нибудь выполняться под запрос он выполняется сажина негуманное время то есть он быстро доходит до 3 часов и еле дождался пока он выполнится если построить хороший индекс такой которая идеально соответствует данному конкретному под запросу все работает гораздо быстрее время все равно растет нелинейно а скорее квадратично но уже полторы минуты это можно дотерпеть хотя это тоже довольно таки неприятно но тоже время как данная функция надо стоит гораздо медленнее то есть если мы будем ждать дальше добавлять строки даже и даже иных перестанет помогать оконные фунт копыт расти практически линейно и всегда-всегда то есть практически прибыл значение она мид работает быстрее чем под запрос даже с индексом 2 примерно той же самой таблице мы хотим для каждого пользователя найти три его самые большие транзакции это тоже делается с помощью под запрос а то есть это вполне реально сделать помощью под запроса мы их считаем сколько транзакций для данного пользователя с суммой которая больше суммы данной транзакции то есть понятно что самая большая транзакция должно не должно быть ни одной транзакцией с ума и больше чем ней инсталляция 2 сначала там нужно быть такой одна транзакция больше его за мы считаем сколько транзакций больше имеет про были пройдены на большую сумму чем данные и таких стандарты должно быть меньше 3 фунта в конце условия меньше трех таким образом отбираем три самые большие транзакции для данного пользователя вот там как раз есть жабой по байка stomach and mount уменьшая мы получаем какой-то результат более менее правильный с точки с оконными функциями это можно сделать тоже все несколько проще то есть опять же мы разбиваем все строки но такие кучки пока стены и ради по номер лидера и каждой кучки упорядочиваем их уменьшает по уменьшающейся сумме после то мы применяем оконный функцию ранг которая просто нумеруют строки то есть как бы столкнуть их отсортировать к хотим не просто нумеруем 1 2 3 4 и так далее берем первые три номера очень просто отвечай на вопрос провода buy вот здесь вот есть ордер buy внутри определение оконной функция ода bike mount диск и есть рыбой в конце запроса данном случае это очень удобно данном случае optimizer заметишь это один и тот же фактически ховербайк не будет два рассортировать он сортирует один раз и после от сортировки учит высчитать функций за один проход ограничивая опять же берет три первых строчки по рангу и остальные отбрасывая если он рыбой будут разные ну про сортировать два раза можно еще встать было несколько разных а клонов функций которые спорт тот же самый врубай опять же это будет только один нормальный запрос 1 сортировка один france арт и опять же не удивительно что такое будет работать гораздо быстрее вот тут опять же времена считалось под запросам из индексом в итоге окуная функция выполняется гораздо быстрее чем чем под запрос даже с индексом подводя итог про оконные функции умные функции позволяют избегать медленных под запросов и сила воинов то есть некоторые из тех под запросов наверно можно было передать как случайно не пробовал нулю случайно делим под запросы лишь анджей нас будет получаться квадратичная сложности оконной функции по за этого избежать делается за один проход держать читаемость и оптимизируем ась в том смысле что не придумывая сложный джон и лиза подзапрос а прямо говоря optimizer что мы хотим получить и optimizer понимать что вам что нужно и он может сам придумать как это добиться если вы придумываете навороченный запрос ему фактически говорите что дед делай вот это вот и у меня нет никого выборка кроме сделать то что что вы просите даже если не самый оптимальный способ оптимизировать том что ему проще понять что собственно вы от него хотите и они часто работают гораздо быстрее чем под запросы is a journey хотя конечно не всегда наверняка можно придумать что-то где они не будут быстрее дальше на машине времени 2000 по 2011 год появилась такая классная штука как систем вершине что это такое и их реализация решает ну пока медиумы видами несколько совершенно разных задач не знаю было не с кем нибудь такое начать писать запрос случайно промахнетесь мимо какой-то клавиши подайте enter со мной бывало только не не рассказал про кино бывает довольно регулярно ведь размен хочется побыстрее отменить ошибочной команды и собственно восстановить все потерянные данные потом полезно бывать посмотреть на исторические данные вот например как вниз демография наших пользователей за год или там что они стали больше покупателей все такое и еще бывает такое когда нас сломали и причем этот прыжок нам задом и до сих пор не заметили потом начинаем поднимать ноги и смотреть что же тогда произошло как это произошло и главное каким данным они так как нехорошие люди получили доступ и стоил тысяч одиннадцатом году продать фича кто решает эти задачи это versio не рованные таблицы ну поскольку я сказал это не карл совсем даже наоборот и очень-очень там на не любит добавят разные ключевые слова синтаксис что где-то vice-versa не раваны писать нужно так вот наша таблица с данными потом мы добавляем два столбца тип a time stamp 6 можно сомнений другие но искал фундатор разрешает только таймс than 6 использовать они генерирование старцы но вместо выражение там такие условные слова что первый старт второй генератор область озеро and какие-то магические заклинания но это еще не все после то нужно добавить в таблицу перед использованием этих двух столбцов имена столбцов могут быть любые перед for system time должно быть так как написано и это еще не все в конце нужно добавить увесистым вишну после этого стали то становится версия таблица будет системы берсани раваной таблица ну а мы на этими подумаешь слишком много поэтому это все не обязательно можно так просто вести машину и додумается остальное потому что тут все стандартно после того как мы создали таблицу расистами брошенным полным способом неполным смотрим сокращенном как угодно но мы случае можно делать такую волшебную штуку настолько нравится что оставили то нужно записать в том сколько пунктов побольше можно создать из таблицы и после имени таблицы указать for system time is of какое-то время и результат будет вернуть те данные которые были в таблицу в то время которое вы указали то есть если например вы нечайно стерлись а данные в таблице можно просто сделать insert в нее задать им из нее же то что было в ней 5 минут назад помоги пчелы седан его становятся обратно если мы хотим делать аналитику по историческим данным можно сделать join этой таблице самой с собой в прошлом году и посмотреть ну не знаю для таких строчек и mount чтобы это не было мы в прошлом году больше чем в этом соответственно если нас известное время нашли пологом когда нас все-таки взломали можно посмотреть какие конкретные данные были в каждой конкретной придет именно в этот момент времени опять же понять что утекло или game пользу и мушка их пользу и нужно просить пароли круто вы моей деби есть расширение со стандартом и на тебе какая-то транзакционный движок и время когда строчка он добавлено и или удалена но ничего не решает потому что я могла быть внутри 3-часовой транзакция потому что важно это время контент акция была закончена поэтому и на гибель как вариант предыдущего синтаксиса можно создавать вот эти вот поля не как than 100 мб и а как bigint и тогда у них будет запоминаться транзакций и где который это делал и опять же к ширине синтаксиса можно смотреть время не не указывает им там показывая канзаши надели будет интересной транзакциям теперь переходим к опять же следующий ну the finger прошлый год в стрелы леска вконтакте прошлого года появилась появился много функций для работы с джейсоном и особенно подробнее про джейсон рассказывать не буду потому что значит такое джейсон поэтому только вкратце расскажу какие функции есть мы скоро стандарте есть четыре функций для работы с джейсоном это джейсон экзист джефф бриджес синквейн джейсон ты был в рязани примерно так вот как внизу исключением джейсон тайбл которая пока что не поддерживается не в мария-де-белен сказал но есть конечно плана и и поддерживать и такая функция которая джейсон прижаться таблице можно использовать в chrome поля то есть select что-то там from jason pebble и она прощать же сон столица которую можно сколотить пока что это не какое-то здесь стандартно этого нет ни у нас не умея сказал но надеюсь скоро будет видно что живите он довольно что стандарт довольно аскетичный последнем туре сонного поэтому в москва и наряде бедра или кучу других функций которые нужно делать который добавляет значение меняют значение удаляют значение еще джейсону смотрят там не знаю глубину или проверяют правильность этот последние три функции функции которые все эти функции кроме трех последних есть и в москве улыбнули тебе последний 3 столько в мария тебе они и форматируют джейсон как же без пробела с пробелами или с красивыми отступами по-разному защита разные варианты что можно делать джейсоном которых нет стандарте больше по джейсон не говорю тебе я говорю про агрегатных они функция этой штуки в стандарте нету ну возможно когда-нибудь появится сейчас она есть она ест после со скромной сварог ли у нас сейчас есть . скрыл хотя они и не точно знаю что это такое но магнитом нагуглил и теперь это есть теперь то есть ну или масках будет следующем релизе моря ними как синтаксис во всех разные он же нестандартную я буду рассказать под синтаксис который мы видели и откуда он берется рассмотрим пример это не агрегатная функция это обычно у стандартная ускоренная хранимая функция которая считает сумму квадратов всех значений столбца кол-кол из таблицы т1 начали там определяем на аккумулятор какие-то промежуточные переменные создаем курсор открываем курсор делаем цикл по всем строчкам читаем прибавляем когда таблицы заканчиваться он там срабатывать хамбер phone not found и мы возвращаем накопленную сумму такой стандартный со стандартным все из quelle на пока что все хорошо на этом принципе построена синтаксис агрегатных функций в мария де беф он выглядит вот так вот то есть очень похоже разница в чем добавлен ключевое слово агрегате и x переменной она описывается в определении функции они в середине где переменные наши сестры и нет курсора который нужно явно открывать вместо присутствует магическое заклинание печи крупных строго вместо печь курсор который тут есть основной работой точно так же то есть создается хендлер функция вызывается как бы но всю группу этим речь проходит по всем строчкам группы прибавляем квадрат икса к аккумулятору когда группа заканчивается срабатывать хендерсон от found мы возвращаемся соком и этом или вот другой пример средне геометрическая в принципе тоже самое только аккумулятор у нас дабл и дефолт значения у него один потому что умножать мной как-то не очень интересно это так то же самое счетчик потом hinder found который возвращает корень он той степени из накопленного аккумулятора и в цикле мы читаем значение умножаем когда надо считаем строчки счетчик finder срабатывает возвращаем корень из произведения все считается средней геометрической а то есть помощью этих юзер ских агрегатных функций можно писать разные сложные агрегатные функции которых или нет или не планируются можно например сделать медиану или можно сделать групп конко тоже есть на можно срезать и значение записать джейсон к на внутри группы мы вкладываемся значениям джейсон и возвращаем массив или объект джейсон или что нибудь такое можно делать разные интересные штуки ну собственно это было все про новые фичи высказал стандарту и не стандарт и вопроса здравствуйте вопрос по versio неровным таблицам с версиями скажи пожалуйста а вот как это будет устроен тренированная это будет отдельная таблица с историей и там можно будет делать отдельные индексы на нет нет он не совсем просто в мск или сделано тогда этом это отдельно это видится с историей там на нем можно своей индекса навести если нужны какие-то кейсы вот да и в разных базах из разные реализации но поскольку теперь это в стандарте то со временем все сделают ему такой синтаксис какая реализация в марио тебе в нами мария гибель на самом деле там действительно добавляются такие вот колонки и не зрительно записываются timestamp и или transaction эти операции чтобы это не замедляла основную работу потому что предполагается что больше времени все-таки работать с актуальными данными не с историческими опять же есть расширение которым я здесь на слайдах не показал можно сделать практичном похитили и сделать так чтобы вся история складывалась в отдельным пропишем и тогда это фактически будет как бы две таблицы одна таблица с историей одна таблица актуальными данными и история не будет замедлять работу так данными данным так это они все в одной таблице можно делать можно делать все в одно можно сделать разных всем спасибо а можно по поводу джейсона вопрос так получилось что тут много чего узнал что не видел мы просим соску или мне так часто общаюсь но конкретно женщинам недавно сталкивался и мы gioielli там нам надо повыбирать значений и собирать их массив внутри джейсона и там какое-то ограничение по моему на длину есть или я что то путаю на количество вот этих данных которые можно собрать да нет не должны быть там джейсон внутри хранится как он к текста с 4 гигабайтами у меня не джейсон хранится я формировал джейсон на выходе у меня хранились цифры я их пытался объединить джейсон массив string и через групп concat грушанка то есть это есть настраиваемые ограничение точно по умолчанию не помню слова но 4 может но это можно поменять настраиваем настраиваемые ограничение сколько групп им крат хранит магнус такое результатов спасибо спасибо за talk at a вопрос про первые функции которого показывали sweet расскажите как там будет explain выглядеть и что можно будет из него понять это мне таких флага на такого нет поэтому показать я никогда на на пальцах это будет довольно сложно могут видеть примерно также как explain для под запросов по ли фронта есть будет строчка для написано derive будет написано там mystim pure and elbow соответственно вот в в этом случае темплейты был не будет в этом случае будет там проверьте был там написано теракте в этом случае должно быть даже не задирает в этом случае быть удирать и там будет видно номера и ведьмака хоть х единицу это самое будет литражу некую to perform схема фламандским а не уверен но вот кстати да если сделать explay explay информацией сон-то очень хорошо будет видно что идет дополнительную там будет объект джейсоне для темпами тайбл и будет видно что вот условия b равно 10 например она внутри джейсона для внутренней таблице они внутри джейсон и для основного запроса то есть вот это вот оптимизация потолка не слове очень хорошо видно на экспо информатор но джейсон скажите пожалуйста правильно ли я понимаю что введение нового стандарта про джейсона она избавит нас от зоопарка разных synthesis of как будет там остались индекс искрит кол им который это постепенно плавно переедет на эту схему или это две разные это внутри они хранятся по разному но вообще да я была бы очень желательно если все будут пользоваться джейсоном не кто-нибудь только клей на голом не интересует именно мария табак реет калом и вот эти новые функции джейсон это одно и то же будет это не это не одно и то же для разные фичи и стать исторически просто мой аккаунт они были раньше много из того что это не никто не будь пользоваться данным их наверно уберем если и когда будет они особо не мешают и сразу тогда в догонку в 3-комн планируется ли поддерживать не скалярное значение внутри планирует задач на даче такая есть запросы были то есть это просто пока не сделано но на планировать спасибо за докладу очень интересно наверно он накупил нам поездку на эту конференцию вот вопрос следующий когда уже завезут полноценное регулярное выражение что можно было выбирать под строки описанные регулярными то есть не просто мочить там соответствует строка регулярному выражению или нет а то что там в большинстве языков программирования есть возможность выбрать под строки если бы это было только сейчас посмотрел на имел я практически уверен что это поддерживается в тех пор как мы стали столь пещере то есть десять ноль на верное спасибо у меня вопрос еще по поводу весь уже здесь и они рваных таблиц я правильно понимаю что эти столбцы которые dt started and или что-то в таком духе они являются с точки зрения работы с таблицы обычными столбцами в том числе их можно силе птиц использовать в и тогда практически то есть если синтаксиса как указать полностью то не являются обычными столбцами их можно создать их нельзя менять если же использовать сокращенный синтаксис то они как бы невидимые то есть они как бы есть ну и как бы нету и вся невиновным таблицам данные из них вообще когда-нибудь можно удаляются они как-то очищаются и этого не есть этого сказать даже никак не прописано но мы ввели командую что такие патрон к in history которая позволяет это делать скажите а можно ли таблицу со versio неровную altri ее altered можно то есть по стандарту притом вся история пропадать только очень как про создаются заново у нас есть еще некоторые разногласий тему того что должно быть он происходить то есть просто выбрасывает всю историю это конечно стандартно но несмотря ни что не всем понравится поэтому в общем что-то будет хорошая происходить спасибо хорошие это хорошо скажите такого вопроса работают versio не рованные таблицы с репликации ну то есть опять же с оговорками то есть вот так вот такая вот таблица должна работать репликация без проблем если использовать и на типичную таблицу то я не точно не знаю то есть я подозреваю что смыть проблем что на загсу найди на другой и нитями будут другие как то это будет работать но не готов к и на дебильными таблицами она работает только через transaction аиде состоим с темпами нельзя это длина тебе использовать да сейчас снова работать только стандарт шнелле должна работать . им память тоже но не уверен сейчас уже работает и еще хотел про versio неравная таблица уточнить а сколько места это занимает там каждый раз на целую строчку создается срез какой-то всей строки или там все за оптимизирована изменяется сохранится конкретное значение и так далее нет это просто обычная . можно использовать сжатии внутри недели или то есть если у нас очень много столбцов изменилось значение только в одном из них да во первых доця новая строчка но во вторых опять же есть наше нестандартно и расширение на случай если у вас таблица и для каждого пальца какой-то счетчик например не хочется каждый раз хранить историю каждый раз когда вы увеличиваете нужно счетчик посещений например можно отметить отдельные столбцы как не versio не рамы тогда они будут игнорироваться окей тогда еще про версии немножко а как индекса себя с такими таблицами ведут когда я в историю заглядываю нормально виду то есть там просто то есть у вас и индексы тоже как-то версия не нравится или как это происходит вне в некотором роде то есть то есть вверх время тот танец танка например они просто становятся частью индексов например часть прайма реки и поэтому в разное время можно иметь разные строчки с одним этим значениям прайма лики то есть меня просто про америки до больше станет меня да я думаю что не насколько потому что дамп этих конечно можно но 3 стоит означает что восстанов можно писать произвольную историю это нельзя на как бы где смысл убивает в них нельзя вставлять в дистанцию то есть когда если сделать если сделать sql дамп а потом пытаться сделать insert с какими столбцами кто не должны просто ставится на нашем пути можно . гитлер если чтоб чтобы забэкапить восстановить ту же самую историю которая была тогда нужно бэкапить в бинарном виде кого-нибудь используя extra баков и ли там что-нибудь в этом роде да можно можно возможность нет можно сделать так чтобы это чтобы копилось но при восстановлении будет потеряно истории это сделать можно это это если вот эти вот если эти поля не указывать которые серые то они будут как бы невидимые и тогда их не будет дамки и и все восстановится обратно все будет работать но при создании таблицы заново вся история будет свежая"
}