{
  "video_id": "jJDG3LT6DPY",
  "channel": "HighLoadChannel",
  "title": "Есть ли жизнь без Kubernetes? / Николай Устинов (MFMS)",
  "views": 999,
  "duration": 3159,
  "published": "2020-04-14T11:15:45-07:00",
  "text": "я работаю архитектором в компании m&ms и расскажу вам о нашем опыте построения систем и оркестрация контейнеров и эксплуатации вместе с нашими промышленными сервисами доклад может помочь тем кто решит пойти по нашему пути или уже пошел по нашему пути и начал использовать apache месяц может быть будет полезен они кому-то еще кто интересуется системную регистрации и хочет понимать действительно ли только cabernet и съест miranti или есть что-то еще в первым делом хотел бы уточнить знает ли кто-нибудь что такое патч месяц может быть как тот как он устроен поднимите пожалуйста руки кто вообще слышал даже кто то есть это радует многое о себе я в прошлом руководи бей вообще-то с большим опытом с опытом ведения бизнеса в этом направлении и разработчики нас кого не только на скалы есть какой-то опыт решения дата сайт задач понимание machine learning deep learning при применении их бизнес задачам ну вот из жизнь как-то занесла и в инфраструктуру компаниям фмс это лидер на рынке услуг информирования 250 больше двухсот 50 клиентов преимущество с финансовые сектор и большинство крупных банков являются нашими клиентами ну например с вредности 80 процентов ваше сообщение о транзакциях доставленные нами эсэмэс и push-уведомления мы являемся оператором связи и это налагает на нас это ограничение условий например мы пользуемся только нашим собственным оборудованием в дата-центрах и не используем публично яблоко вот ну что было понятно примерно 5000 сообщений в секунду через нас проходит в дневные часы довольно много оборудования в нескольких дата-центрах все это генерируют например вот больше четырех терабайтов несжатых логов в сутки и все вот это вот нам мы хотели бы как-то artistry ровать для нас очень важна надежность ну сами понимаете вот вам не пришел одноразовый пароль и очень расстроитесь наши клиенты банки это понимают еще лучше поэтому у нас зачастую очень сложные условия контракта с силой в общем сто процентов аптайм для нас прям нужен иначе будут очень финансовые штрафы большие немножко расскажу историческую перспективу это довольно важно потому что ну как бы ландшафт меняется в 2015 году я пришел в компанию фмс в компании я пришел вообще-то строить сервис скоринга скоринга заемщиков для банков компании было 2 dc поменьше 100 серверов и все они работали на солярис x86 целей раз десятом это была довольно забавная быстро понял что общем построить сервис мне не получится существующей инфраструктуре и стенд существующим количеством администраторов их очень мало бы они были перегружены поэтому параллельно с построением сервиса занялся анализом того вообще ну вот на линуксе как можно с мигрировать существующей инфраструктуры как можно выстроить свой сервис со всеми его компонентами чтобы это было удобно управляемый прочим вот и где-то к 17 м году в конце семнадцатого года мы получили пробную инсталляцию восемнадцатом году вывели в пород и сервис скоринга и и нашу инфраструктуру подниму и ряд внутренних сервисов критичных для компаний тоже на нем например мониторинга их сбор налогов и на сейчас то что мы построили вот эта вот система регистрация на базе apache мизес это целевая платформа для компании все новые сервисы пишутся под нею ну когда мы начинали строить вообще когда что-то собираемся делать всегда задаемся главным вопросом в жизни так а извините главным вопросом жизни вообще чем мы хотим то получите какими свойствами это должна обладать и над этим вопросы можно очень долго думать и мы пытая попытались сформулировать ну мы хотим конечно чтобы вся наша инфраструктура все наши компоненты приложений многосоставной я по ним попозже пройдусь чтобы они были запускаем ее в нашей инфраструктуре запускаем и удобно и удобно это означает чтобы нагрузка на системных администраторов снизилась чтобы администрировать было просто чтобы конфигурировать было просто чтобы было просто можно было взглянуть в одну там контрольную панель и понять почему работает не работает если не работать там быстро зайти в логе посмотреть чем проблема короче стандартных житейские нужды любого человека от эксплуатации для нас важным критерием была еще эффективное управление ресурсами я напомню что у нас свои собственные сервера в дата-центрах и это налагает некоторые обязательства ну денег это стоит довольно много и утилизировать их хочется хорошо и нагрузку нас общем смешано то есть у нас есть сервиса есть и какие-то batch processing и нужно чтобы это работало вместе и для нас очень важна надежность я уже объяснил почему свои и свои у нас жесткие мы исповедуем принцип this поэтому просто то архитектуры тоже было критериям мы верим что у сложную архитектуру можно вообще сложной катить систему можно сделать качественно на это уйдет больше времени чем проще тем вообще-то по нашему так лучше мы рассмотрели кандидатов на тот момент на планету в шестнадцать и семнадцатый год это оказались cabernet с нам от apache месяц ну были еще разные другие экстравагантные варианты был еще одессе с на тот момент коммерческий потом мы к нему возвращались когда он с того концертным и на мото мили по причине того что по функциональности показалось что не хватит и коллеги из других организаций пожаловались что в общем приходится с ним переходить к берната с нам показался откровенно сказать на тот момент сыроватым вот think критерий по надежности для нас прям очень важны были и поэтому мизеса были и остаются референсы на использование в крупных дацик крупных людей таких как twitter twitter amazon насколько помню ну в общем довольно много и к крупных инсталляций вот и мы подумали но ей хорошо мы попробуем почве за что это такое и с чем его едят давайте разберемся ну вкратце то вообще что такое почти за сообще optimize the scheduler ресурсов для некой распределенные системы он состоит из мастеров мастера сводятся выбирают лидера через закипит он состоит из агентов ну агент наверное близко аналогии для вас эта служба докер вот немножко похоже только она работает в паре с мастером она отдает мастера данные о хосте сколько памяти сколько циpкa сколько какие диски сконфигурированы для использования контейнерами и данные о там можно сконфигурировать дополнительные атрибуты hasta это будет приниматься во внимание при выборе места где деплоить приложения вот так же агенты это историческое место низовская штука они могут работать со своими собственными где кьютер ом и со службы докера собственно экзекьютора у них изначально конечно образа докера не поддерживал на не очень быстро встроили поддержку и назвали это universidad de cutter и к слову сказать мы его и используем он нам нравится и на тот момент было у докера такая проблема с ли в restart ну например вы перезапускаете службу докер она за собой бац и и утягивает все контейнеры сейчас это проблема пофикшены насколько я знаю и в centos были определенные почти ядра по этому поводу в свежих ядрах вот но вот у меня за 100 таких проблем не возникло это сам не состоится то что долю ресурсов мастера собирают данные с агентов как ним поступает запрос на какие-то ресурсы у геном запустить 10 приложений там по которым нужно каждому по 4 циpкa каждому поскольку памяти и и - говорит ну вот такие варианты такие офферы вот пожалуйста мейсон вообще двухуровневый способ принятия решения о том где запускать приложение об этом сейчас не буду подробно рассказывать потому что это уже будет тогда доклад непосредственно про патч месяца я бы хотел рассказать про систему в совокупности которая у нас получилась вот но 1 apache метод для того чтобы с ним работать вот чтобы было удобно просто быстро и вот это все вам не хватит и нам не хватило ему еще нужно нужны какие-то фреймворке у них это называется фромборке и фигурки могут быть как общего назначения например марафон это то что вот они поставляют мне в составе dcs эта штука которая позволяет собственного определять приложению виде там джейсон файлика и определять constraint и на его запуск там по каким хостом с какими атрибутами ограничить там например сколько им нужно ресурсов одних других третьих ноты и следить за тем , мурат он кстати не единственный прибор который занимается этим я попозже о них расскажу перечислено есть специализированные флора горки например apache spark почти spring они fling они могут использовать месяц как scheduler ресурсов например там интересный проект от кук от ту сигма и the scheduler матч боевых задач ну-ка сама компания мезосфера мезосфера она предлагает используйте марафоны cronos и будет у вас что-то вроде систем где и крона но только для всего кластера и мы не пошли и пошли такие именно этим путём у пошли вообще-то и это не единственный путь и я тоже об этом еще немножко упомянул чуть подальше ну возвращаясь немножко к постановке задачи ну вот я привел пример архитектуры нашего сервиса скоренко который вот был первый запущена наша инфраструктуре в нем есть некоторые типы приложений некоторые типы приложения которые мы хотим конечно хотели конечно же запускает на наши вот это вот новый модный на нашим новым модным месяц на тот момент какие типы приложения сейчас они уже вам всем знакомы и вот это вот классификация тогда это было менее очевидно это собственное приложение на то что пишем мы сами то что пишем на сами мы можем написать как хоть и вообще это может быть они могут использовать конфигурации из разных мест они могут там удержать локальные данные линии держать они вообще могут быть любыми интегрироваться чем угодно это сторонние приложения и они как правило в архитектуре сервисов тоже есть у нас это был стандартный big data стек виде кафка ходу папочек bass балансировщика вот если делить приложение по типа много сейчас уже очевидно stay close приложение и мы свои собственные приложения конечно пытаемся описать как стоит нас и стоит в приложении которые до сих пор на всех докладах возникают вызывают массу вопросов и до сих пор идут доклады вообще надо ли запускать вот предыдущий докладчик кажется упоминал надо ли запускаете стоит в приложении в квартире не надо доклада этом посвящается вопроса не такой очевидный вот но есть свои подходы к тому как это можно сделать и в месяц и отдельно еще я бы выделил точки входа потому что ну как бы вот это вот все все предыдущие это бы внутренней the back точки входа надо ли их размещать непосредственно в инфраструктуре кластер или если сервисов компании немного ну если это не хостинг-провайдера вот как мы просто нас есть там порядка десяти сервиса в котором мы предоставляем клиентам но вот может нам просто имеет смысл точки в ходе вынести за пределы нашего artistry раваном кластеры все поэтому их отдельно водил но они и по не только мы их выделен в отдельную сущность и в кубе и в диси с это тоже отдельный тип приложений мы в общем подумали и решили что до artistry ровать мы хотим все этом потому что оборудование нам жалко оборудование дорогое используйте надо эффективно обменов у нас тоже нет в общем очень хотим чтобы было все все здорово поэтому мы будем все оркестре ровать плюсы для нас были очевидны до единообразие но конфигурирование да это сетевой изоляция можно запускать без проблем много приложений одного типа с одинаковыми конфигами и изменяя только имя приложение условно говоря да это управление ресурсами но когда мы начали собственно разворачивать все наши приложения и все наши инфраструктуры в контейнер и контейнере заводь мы поняли что он может быть все таки это перебор и какое что вынесли за предела кое-что оставили немножко про наш стек bigdata потому что это большая часть того сервиса который будет первый запущен кому-то может быть интересным мы в итоге решили что х dfs нам не нужно загонять в регистрируем среду потому что ну как бы это приложение с конфигурации сильно привязаны к 1 тонну вот вас вам же нужно пробрасывать действие ему нужно у каждого hasta может быть там свой набор дисков + есть такая штука который называется штык творит для эффективного общения между pdf с клиентами их и dfs собственное файл весь как файловой системой и там если включать сетевую изоляцию там просто проблема она не понимает что она расположен на одном и том же посте и мы добирались до места в коде где это есть и в принципе можно было пропатчить там хдс клиент но зачем вот мы подумали решили что а те их и dfs уже есть понятные количество ресурсов и мы будем его деплоить просто на земле просто на техас ты там где он должен быть кластер месяц будет на тех же х 100 х и на некоторых других а вот например здесь мы завернули в контейнер и в целом не пожалели но его пришлось все равно запускаете в без сетевой изоляции но единообразие конфигурирование и консоль администрирования и прочего это все-таки имеет свои плюсы есть стандартные проблемы они уже тоже многими описано там по кафке то что на то что мы натыкались она уже вынесено в официальную документацию про то что на больших объемах у нас через кафку там например вот вот эти самые четыре терабайта logo вы гений проходят через одну из к faq надо you лимиты там выставлять на файлы надо там на хостах configure memory mapped файла количество вот в общем это все вещи довольно широко известная могу потом отдельно рассказать если кому-то надо и еще отдельная вещь ну big data стек он тянет за собой много за кипера то есть у нас есть за кипер основное в котором сводится мастерами за марафон и и любые за как бы мы поняли что у нас довольно много к фак у нас есть там инсталляция клик хауса у нас там есть еще что-то и всему этому нужен за теперь поэтому контейнер или завале за кипер хотя это было очень болезненная история тяжелые и сложные опять-таки могу рассказать отдельно в кулуарах делали несколько подходов к этой штанги но сейчас это да у нас нормальный сервис копируем к описание приложения указываем количество месяцев запускаем получаем работающий за кипер какие есть особенности у месяц агента которая ну вот для нас более не очевидно я полагаю для любого человека кто с ним начнет работать будут не очевидные я вот их хотел бы подсветить от поведения агента и контейнеров при сбое агента ну вот у вас например сломалась сломался сам агент у нас такого не бывало но теоретически может быть или рыбу ткнулся хвост или про по утрам сетевое соединение что при этом что при этом будет происходить на самом деле это определяется несколькими настройками которые на которые нужно обратить внимание важная настройка реконфигурация полисе она по умолчанию стоит выкрал ее по-хорошему нужно ставить водить тиф водитель это означает что это начать что если у вас меняется конфигурация hasta например вы добавили новые атрибуты в в описании h100 ну например сказали что у вас теперь этот ход может использоваться не только для запуска к фактах и dfs но еще и для запуска там и хауса дополнительные действительно подключили или там изменили конфигурацию железа жилищную вот так вот при configure шампуре определяет как себя поведет как себя поведут контейнеры при перезапуске мизес агента при если не засадят подумает что конфигурация хоста изменилась и ресурсы которые у нее есть изменились вот приквел он потушить все контейнеры и потом за пусть френ горки ну там соответственно марафон запустят их заново при настройке адити фон оставят в живых то что запущены и в общем это может иметь значение для штук которые восстанавливаются долго или запускается долго вот еще в довольно важная вещь это recover агента ну например у вас пропало сетевая связанность на больше чем на 15 минут точнее даже не сетевая связанности один потерял соединения с мастерами контейнер это живут работают и сеть у них есть ну такое такой у нас был бывало по не связанным с неизвестным причинам и тут надо понимать что если агент не может достучаться до мастера в течение 15 минут по умолчанию это можно регулировать вот эта настройка recovery тайм-аут то он контейнера все положат то есть вот этот срок сколько у вас есть времени на починку если у вас работает контейнера но что-то произошло со службой нет с его на него нужно обращать внимание скажем так это довольно важно чтобы не было неприятных сюрпризов но в целом это поведение логично то есть если начинает задумываться как бы сделал ты сам в самом деле если агент это основная служба новостей и потерял доступ к кластеру это за разновидность сенсинга значит надо все положить и нужно просто время выделить в течение которого но есть шанс на восстановление то же самое с рекой фигура чем полисе если у вас почему-то почему-либо отвалился отвалились диски дисковые ресурсы стали недоступны вероятно контейнеры нужно перекусить а с другой стороны если вы просто добавили атрибут это логично было бы хасту логичный было бы агент перезапустить на чтобы контейнер и продолжили жить ну вот мы как я уже сказал для собственного управления приложениями используя марафон и у него есть понятные хороший плюс у него есть юлай и это здорово скриншота не прилагаю они в интернетах есть дерево приложения можно зайти можно потыкать в приложении дойти до его логов можно там убить приложением все здорово у него я довольно удобно и джейсон описание приложения ничего лишнего то есть видела губернаторские confidea не как ты на ощутимо более гарбуз более многословные то есть сколько ресурсов какая сеть какие ресурсы пробрасывать hasta там еще несколько настроек марафона есть также растопи и и его можно использовать для автоматизации собственное поведение этого марафона и возможность подписаться он предоставляет шину событий то есть можно писать свои собственные автоматизирующих приложения которые там будут реагировать на перезапуск каких-либо task-ов инстансов приложений и и мы то вы на самом деле используем это полезно и у него есть плагины но есть и минусы минусы в том что мезосфера она продвигает и сего стал конечно бесплатным но компании нужно как-то зарабатывать и да есть функциональность которая в коммерческой версии лучше вот у них марафон внутри немножко другую и разрабатывается немножко лучше хотя очень похож есть стандартные body которую там живут в марафоне уже годами мы к ним привыкли все никак не собираемся пофиксить например при патч есть когда вы хотите изменить описание приложения туда нужно положить полный джейсон иначе настройки которые вы не положили сбросится к дефолту ну например банально вы меняете там увеличиваете приложению количество того же господа пустим его цепова а заодно у вас меняется контейнер райзер сми за сына docker и он просто не стартует к этому быстро привыкаешь можно пофиксить но в общем особенности есть ну есть нюанс например невозможно невозможно изменить параметр persistent storage без пересоздания приложения пересоздания приложения ведет к дроп этих самых перстень стоишь вот ну есть еще скажем так это даже больше такие нюансы которым привыкаешь есть свои особенности о которых могу рассказать это победить точно так же поведение приложений случае если что но вот я смотрю времени на самом деле время то потихоньку идет я если нужно кому-то потом пояснил что есть вкратце это про проведение апгрейдов то есть порядок перезапуска мы можем запустить сначала больше экземпляров а потом старые-старые замочить а можем сначала установить часть существующих потом запустить новые это касается важно для стоит фум например приложений они как правило прибитых астана как правило нужно сначала потушить а потом запустить вот ну интересно также вещь там от грейс-период на убить ее контейнеры сколько времени пройдёт между русик термы с активом вот apache midas марафонов классно но это опять таки не закрывает все вопросы которые у вас возникают если вы строите систему регистрации как конструктор есть ещё несколько вещей и следующие вещи они идут связки это конфигурирования контейнеров как доставлять конфигурацию внутри контейнера и сервис discovery здесь мы честно сказать изобрели свой велосипед мысли конфигурирования а для сирот discovery используем консул месяц dns посмотрели нам в общем консулу нам оказался ближе он от части решает нам задач с помощью на части на помогает из конфигурированием и выступает как service desk аверин надежный у нас мы его использовали и вне инфраструктуры собачьими заставим с другими приложениями почему нам нравится вот и еще отдельно упомяну жизненный цикл внутри контейнера ну вот вы запуск как бы все горят вот контейнер приложение до конца не рисую запускаем класс что внутри то происходит внутри на самом деле может происходить разные вроде как считается из парадигмы один контейнер одно приложение так надо делать даже в этом случае есть нюансы а как приложение будет останавливаться если останавливается контейнер если какая то возможно сделать там грейс shutdown ему или что то еще или что-то еще и вот мы посмотрели как вообще люди делают и нам очень понравился контейнер пайлот разработчиков компании joint он вот очень классно организует жизненный цикл контейнера там сейчас мы до этого доберемся ну и так запуск контейнера есть агент он получает команду от мастера запускает какой-то контейнер на таком-то хотя дальше мы говорим о кей готовим confidea готовим конфи дико конфиге у нас лежат в консула в консул они попадают у нас из китая в на предыдущем слайде пробежал не сказал в консул они попадают избита то есть в детей аня от ранжированы по идентификатору приложения но другая по дереву в марафоне то есть тут какой марафоне дерево приложении есть такое же дерево конфигов и в детей изменяем конфетки teka метим мы видим историю изменений видим там привязку к версии все классно с помощью de tu con su вот маленькой прибыл один а не наших разработки попадает в консул sing a и c а контейнер при старте из конского вычитывает с помощью фасту консул так мы делаем для приложений сторонних то есть как бы есть тут свои-то приложения мы можем написать чтобы они напрямую с конусом работали если вы запускаете все что угодно остальное что кому нужны конфиг на диске то этот конфликт на диске нужно как-то получить и зашивать ее в контейнер неудобно конфигурировать переменными окружения но честно сказать забодаешься там переменное окружение подо все организовывать поэтому мы вот пошли таким образом что конфиге у нас лежат отдельно они не лежат в контейнере и мы придумали схему которая в контейнер их кладет при запуске контейнера и она надежна и потому что консул довольно надежен зависимость только от него при старте контейнера и он все равно должен быть потому что rs discovery ну вот отрабатывает наш скрипт который затягивает контейнер в контейнер конфи дисконтного раскладывает их там как надо и стартует контейнер по и вот конфиге раскладываются темпа в том числе контейнер павел это рассказывается по разным папкам срабатывают там всевозможные вами substitution все проще все прочее и окей запускает открыть пример конфига контейнер по его так ну никого живого этому кафку так для блогов запускаем и сейчас отдельно про жизненный цикл приложения которой который нам предоставлять контейнер пайлот вот здесь можно обратить внимание на то что есть сил чеки то что есть рестарты то что джебов вообще говоря может быть несколько вот и на тоже на переменное окружение в которой подставляются вот этим стандартным горлом template синтаксис анти поэтов такой страшная картинка да вот как как взаимодействует между собой концов контейнер пайлот и наше конкретное приложение контейнер по вот запускает приложение приложение запускается контейнер поет начинают любить hill чеками параллельно регистрируют в консоли задавая ему никита трель напомню что мы консула спаджи на для серых discovered это или это важно то есть если контейнер поет не обновит регистрацию в конце лета консул выменять этот из своего dns и сервис пропадет instant сервисы попадет отдельная вещь это касается остановки этом упоминал прогресс в шаблон в контейнер палате есть возможность повесить обработчик носить терм там хук при стоп пост стоп то есть можно что то сделать перед после передачи собственного сигнала приложению чтобы корректно его зашить давний ну и такого плюсы того решения которые у нас получилось мы считаем это универсальное решение потому что в консул может использоваться для конфигурирования как сторонних приложений и тогда вот все то что я вам показала работать так и приложений которые пишем массами и тогда они сами идут за своими ключами в консулу и его использовать универсальные сервис discovery ну как бы service desk говорили ddns это как в общее место со всеми общими хорошо известными проблемами которые также всем известны ну понятно что существуют каши dns понятно что есть не все приложения не всегда обновляют заново rizzoli один из мина и каждый раз когда мы засовы на что-то новое в контейнер поскольку у нас всех здесь говорит через dns мы это как бы для себя просчитываем как это себя будет вести вот примеры вот заки первый баг это вот мы как раз в тех местах где у нас нужно сослаться на какой-нибудь закипит мы ему указываем доменное имя на что-то вроде там мой закипел . сервис . консул классно заки первые клиенты недавний версии там имел проблему он не делал повторный резуль в днс имени то есть если экземпляр ozaki применяли и пишите кто в какой-то момент приложения оказывалось без работающих connect оказать опера могло оказаться это пофиксили но надо следить за версии я кстати забыл указать с какой версии этого пофиксили недавно и сетевая оркестрация конфигурирования сей раз discovery класс осталось сетевой артист рации с того что вот чтобы замкнуть как бы цикл то есть мы умеем тоски schedule и запускать мы умеем их конфигурировать мы умеем делать так что приложение друг о друге о себе знали нужно как-то что-то еще сделать сетью меня оргкомитета отдельно просил упомянуть про нашу боль сети в ираке стресса и и бы и было но я на самом деле при подготовке к докладу посмотрела сейчас довольно много появилось хороших сравнения обзоров там с цифрами так что я сильно много времени этому не буду уделять скажу что ну как бы все знают есть разные типы сетевых интерфейсов танбридж в икстлан лан west end up и на базе вот этих существующих интерфейсов но чтобы выйти из-за namespace а контейнера и войти в сеть каким-либо из способов на базе вот этих вот этих сетевых интерфейсов строят система регистрации система регистрации но есть стандарте иной как бы место сам он поддерживается соответственно любая система регистрации которая по держится иной ну скорее всего можно использовать смены со сми за сам вот мы посмотрели почитали поняли что bridge его x-man нет у нас как бы есть довольно много трафика бегает на мы не хотим терять там производительность на а бриджах поэтому окей макмиллан веса лишь миг там или что-то в этом роде вот на практике там повыбирали в это выбирали подумали и остановились на голякова как на никому этими оптим уме он реализован как вес пара плюс proxy arp для выхода из контейнера вес пара в хвосте не на чем в какой брешь не включена она просто есть и дальше хост маршрутизировать но грубые от туда куда надо туда куда надо определяется pgp в состав к легко входят bird стандартный который поддерживается единения с другими точками там вместо по воде или сыр с рефлектором если они если они есть у нас рефлекторы плюс к лику это гибкость и политики то есть можно зарубить из какой сети в какую можно ходить с какой сети в какой нельзя ходить и это удобно но я думаю что многие его используют то что в cabernet если он хорошо живет распространен но он к нам заодно притащил еще еще одной системы еще один consisting товаров и ткд то есть у нас уже были за keepers у нас уже был консул теперь у нас появился еще и дкд вот но с нагрузками небольшими поэтому нормально работает есть проблемка что разработчики калика говорят нот в 26 но и поддерживаем а дальше мы не знаем и не тестировали вот мы протестировали современной версии карликового отлично работают сделали даже по request на функционал чтобы запускать контейнер со статическим с фиксированным айпи адресом калико это умеет для губернатора для не застанет вот pr пока не приняли потому что за одну немножко 3 factory легко ну мы сделаем вторую попытку если кому интересно вот мы сначала пошли по сложному пути то есть мы на хостах у нас на хостах были несколько сетевых интерфейсов у нас был секс бы есть роутинг и зависти к лякова в условиях службы строго think было общим отдельный болью мы мы это сделали и вот это пример настроек с которыми это работает а потом решили что нафиг как бы стандартный один дефолт твоей один шлюз один интерфейс нам достаточно спустя где-то годик какие вообще есть проблема в связке меня за сценой они есть чуть-чуть главное это то что тот месяц отличная классная система которая там растает в крутую крутых товарищей она на нужды средних товарищи она вот за ними не очень то ли успевает и мне очень хочется их поддерживать сильная поддерживаться версия 01 ночью этого для всех достаточно сейчас правда 03 04 и у нас как бы наша головная боль это вот нужно иногда что-то в нем спаси контейнера связанная с сетью выставлять и приходится это делать скриптами грубый аккуратно там запускать контейнера тут а вместо того чтобы запускать его там от от конкретного пользователя но я пообщался разработчиками заз и они горят ночью допиши там писать в общем дивов ничего и сыном pr сделаешь ну в общем мы может быть все время когда-нибудь так и сделаем когда доберемся пока просто обошли в 03 04 просто есть поддержка ченнинг очень-очень инга всесильная плагинов и можно было бы тогда запускать плагин к лику а потом по члену запускать там плагин который выставляет нужные вам параметрах оставьте вы и еще один нюанс такой да вот окей в стандартном сиеной вы остановили контейнер у вас отработал синай плагин там сказал сена и дел и голякова заметила класс этот ай-пи-адрес больше он свободен его можно вернуть в пул адресов можно заново использовать а если у вас допустим ребутнуть host the о том что пи адрес освободился никто не узнала и для губернатора у них есть отдельный сервис который регулярно ходит в кубке сверяет что в реальности запущенные какие api адреса выделены для мисс с этого нет ну и здесь но у нас мы пока от этого не сильно страдали но в общем виде мы делаем сделаем обвязку себе которое будет это делать ручками это вот как бы минус то есть месяц довольно простой хорошо работает но есть есть такие вот проблемы не все не все есть не все сделано вкратце совсем вкратце про логирования безопасность нет реки ну начну с безопасности и все главный ответ здесь ну и же коммерчески beko fse и там есть безопасность вы используете там месяце конструируйте мной конструируйте дальше в принципе не проблемы есть плагина для марафону марафона хороший плагин ная система которая в том числе там по интегрированию допы и прочее есть также пример интеграциями высота h паркс корпус кимвал там вот а про лакирование ну товарищи и не пошли по пути докера они сказали но they вот у вас inbox контейнера на каждом посте вот мы туда кладем ноги вот вы можете их оттуда забирать ну окей вот мы тут недавно добавили logo rotate то есть мы вы можете там старой воде чистить забирать ну стандартные способы файл бит можно там использовать такой проект текке есть вот экстерном контейнер лагерь позволяет перенаправлять и страдают контейнера внешнему по дополнительным процесса но у нас на самом деле в планах на этот квартал написать свой лагерь для низа сокета которые будут отправлять вырасти слог этом роде задача там на одну страничку кода и вроде как выделим ресурсы уже вот в этом году по поводу метро к не просто есть они с ними все хорошо там есть и экспортеров прометей и его можно использовать ну и что касается что касаемо нашей инфраструктуры что хотелось бы сказать да есть куда развиваться нам хочется чтобы была чтобы лучше работали rolling апгрейды чтобы хоть и мтс интегрироваться с вал там потому что их хранить секреты так как мы храним их сейчас не очень правильно на самом деле с секретами отдельная история там вообще там передачу паролей через nvr мент конечно неизбежное зло хочется сделать это минимально возможном количестве случаев и для нас еще важная история мы хотим посмотреть получше стороны овербукинг over subscription это что такое на например восход не загружен то есть формально ресурс выделю на ход не загружен и вы играете ну а давайте мы чуем быть об считаем и такая забористая и начинаем обсчитывать а потом сервис нормальные сервисы с нормальным приоритетом им приходит нагрузкой и тут надо как-то им ресурсы вернуть вот это бизнес и называется your bookings открывшим тема довольно не исследования формально она поддерживается в apache аврора и это кстати еще одну следующую вещь которую мы хотим пощупать это другие это аналоги марафона вот аврора она развивается врач сейчас уже не очень но выглядит таким зрелым решением а еще когда при подготовке доклада обратила внимание что есть такой проект singularity тоже она вот марафон и вот его смотрел пару лет назад там был какой-то треш и угар овна оказаться живет развивается там стабильный релиз выкатили там каждый квартал обновляют даже интересно ну и наверное попробуем запустить губернатор сми за себя почему бы нет ежжи пакет есть есть к людей cabernet из есть и у нас будет но вот так в общем выводы какие комитет попросил ответить на вопрос есть ли жизнь с контейнерами если жизнь риску бернетт из а имеет ли смысл мегас 1019 жизнь есть бизнес имеет смысл если у вас есть железки если железок много если же лески в разных dc если вам нужно хорошо утилизировать хорошо в смысле эффективно вот стандартный вывод что серебряные пули бывают только в кино hyip относительно cabernet ас имеет смысл мы видим что там большинство проектов двигается туда и иногда к нам приходят и чара говорит но слушать очень как новом сотрудников то искать там у всех cabernet а сам к тебе не раз нужен игры мне чего был бы человек хороший дальше обучим ничего страшного нет вот в целом нам нравится мы пока не хотим уходить потому что минус продолжает развиваться фреймворке вокруг него тоже продолжает развиваться до они это делают немножко в другом направлении чем куб по-прежнему развивается фреймворке как касающихся вот именно смешивания нагрузки batch и и не batch и плюс в том что меня создает некоторую свободу ну то есть вам хотите марафон пожалуйста хотите аврора запускаете рядом это всего лишь еще один фреймворк он просто тоже участвует в выделении ресурсов здесь нет или или можно запустить и одно и другое из парк рядом и все будет работать немножко ссылок не очень существенных и отдельное спасибо моим коллегам кто с кем мы все это делали кто помогал павел кириллович is love митрофанов без них ничего бы этого не случилось вот ну и отдельное сообщение от дела which are да нам нужны людям приходить и у нас хорошо на этом все доклад закончен я слушаю вопросы если они есть можно сюда конечно спасибо за доклад будьте добры если машину времени до от какие-то 15 года так ли были бы ваши радужные отзывы от месяц и не было ли то есть зная что будет девятнадцатом году в пятнадцатом году не склонились бы вы сторону кубер не tissot это первый вопрос так я хочу слушать вы хорошо не смотрите ответ никакой как вы хотите ожидать история же она не знает сослагательного наклонения я ответил на вопрос кому сейчас нужен имеет смысл выбирать месяц вот мы его выбрали и считаю правильно потому что у нас парк серверов сейчас там расширился ближе там цифре 200 стал вот нам в общем актуально по-прежнему я ещё касаемо dat то есть довольно долгий проект процесс довольно долгий проект у нас маленькая команда и помимо этого еще какие-то продуктового вещи делали-делали поэтому все не очень быстро вот надеюсь что и я бы ответил да также нельзя не отметить что конечно cabernet с он становится мотором и сейчас он везде и он наверное немножко ближе к промышленным стандартом согласитесь здесь вопрос у всех промышленных стандарты разные мелкие средние до крупных своей истории мы не относимся к крупным но у нас довольно много железа поэтому мы в пограничной ситуации и еще один вопрос если позволите вот скорость была команде сказано вы не расскажете немножко не поделитесь какой это объем людей сколько там кода они вываливают и трудно ли было их найти для смотрите мы не искали специальные людей именно для этого проекта мы обошлись тем что есть в целом за ну у всех есть была параллельна какая то нагрузка то есть у коллег системам у системного администратора но потом jenner эксплуатацию не верь с текущие что у меня это мой сервис скоринга и там ответственость за него и много чего еще понимаю мониторинг внедрял новый коллега коллеге занимающих занимавшегося там тоже скоринга мы там базами данных своя параллельный нагрузка поэтому но вот возможно вам не нужны дополнительные люди а по коду ну конечно нужны нужно чтобы люди хорошо чтобы люди умели читать код и писать марафон написан на скале но туда особо лазить не надо месяц написано оси п.п. если кто-то умеет считать класс хотя бы читать писать не обязательно совершенно но если не умеет тоже в принципе взлетит на самом деле из практики нам сейчас больше нужны ой нужны люди с гор потому что go везде и для для автоматизации инфраструктуры мы его тоже используем то есть вот новые примочки которые мы пишем там который вешается на сцены событий или в мониторинге там везде г вот а конкретно для пачки нас зависит наверное все таки от конкретных сроков которые цели которые вы ставите но условно там это сделали сезон полутора человека до спасибо большое за доклад вы себя показали как как сказать те кто не в мейнстриме то есть вы используете никаких классические подходы свои и хотел спросить рассматриваете ли вы что-нибудь помимо хэш карпа какие-то альтернатива нам очень нравится нет просто вы не ощущаем совершенно необходимостью в конце у нас работает стабильно один стоит на каждом х стену там по их классической топологии деборы там мастера там сколько наших там 5 что ль мастеров нам хватает нам нравится пока мы не сталкивались с проблемами не видим смысла вот у нас только мы провели с ним какие-то эксперименты там год назад а сейчас к нему в рамках цели на усиление безопасности мы еще с кем мы возвращаемся поэтому пока преждевременно говорить с вами хотим понять как бы да или нет добрый день владимир мирза sap флаер у меня такой вопрос ну во-первых мы тоже используем месяц я ваш соратник в этом плане какой вопрос нас волнует мы тоже думаем вернее не тоже просто мы думаем на том стоит ли нам переходить на примерно каберне this и нашли для себя что довольно мало аргументов чтобы сделать это но один аргумент довольно сильно это то что чем больше мы мелем тем быстрее выше цена вот эта миграция дан пример потому что тем больше появляется обвязок и разных внутренних тузов которые мы используем как что вы думаете об этом аргументе это первый вопрос да и второй вопрос вот например мы используем marathon а поверх marathon а мы написали там еще какой-то framework свой для чего чтобы как девелопер он просто тыкнул кнопочку и получил результат используйте вы что-то такое или есть какое-то готовое решение до такого рода задачи например хороший вопрос смотрите по поводу миграции регулярно подходит тут менеджмент и спрашивает ночью будем на кубе ранеток что уходить один ладно пока не надо нормально пока я по моим ощущениям ну больше обвязок в самом деле у нас обвязок пока немного мы на самом деле не много то есть у нас есть там подписчикам то машину событию марафоне но канадский скрипты там которые использовать его rest api но опыт немного тоже специальная настройки сверху над марафоном нет но у нас соседи вас мы видим все сети видимо получше разве чем у нас вот до разрыв нарастает вот для нас сейчас я не вижу это проблема есть на самом деле мы можем там по-быстрому при наличии там людей которые варили губернатор в продакшене мы можем перекатиться прям быстро просто не хотим очень специфично то есть у вас видимо другая боль хотелось бы посмотреть на ней а второй вопрос напомните день ну тогда так спасибо за доклад где можно пропустил а как шить улице ресурсы то есть железо бывает разное процессор бывают разные и допустим мое приложение очень треугольных циклу как я могу вот запилить его на определенные группы хостов смотрите ответ вопрос отвечу развернуто к сожалению или к счастью как бы сильнее сторонами нас это как расшибёшься души время ресурсов пришит или ресурсов у него двухступенчатое управления ресурсами то есть сначала там не за сформирует пакет сам месяц мастер свернуть на брокеров потом отправляет from горку на рассмотрение конечно раз на решение принимает фреймворк какие офферы принять фреймворк данном случае будет марафон или какой-то другой исходя из каких случаях но исходя из каких критериев определяется принять или не принять исходя из циpкa но тут иметь это именно ядра там без учета без учета гигагерц iv циpкa память диск и атрибуты атрибутами можно сделать очень много атрибута что такое это просто файлики витязь и slave там эти семь это слив а трибьют там можно указать например х и очень быстрый из типу сервер равно 1 и записать это в constraint и приложения то есть приложение должно быть запущено там где флаг очень быстро и сыпью по равно 1 да да да это работает и все это просто этого то есть я бы посоветовал сделать с помощью constraint of вот и если нужно именно что здесь циpкa и др есть но он медленно здесь циpкa я даже если он быстрый прежде чем мы объявим самый лучший вопрос хочу передать небольшую информацию 18-30 в конгресс-холле начнется премия желательно прийти посмотреть кто выиграл до и после премии начнется чемпионат по ks go в том же конгресс-холле ждем вас всех и так кто же у нас сегодня задал самый интересный вопрос самое интересное вопросы задают соратники и коллеги встаньте пожалуйста потому что конечно же предметная специфика поздравляем вы получили приз за самый интересный вопрос спасибо можно поаплодировать ну что ж вам большая благодарность за труды за все что вы для нас сделали спасибо"
}