{
  "video_id": "X-kTC4u_Ev0",
  "channel": "HighLoadChannel",
  "title": "Трансляция HighLoad++ 24.11.2022. Зал h1: Главный зал",
  "views": 5305,
  "duration": 35593,
  "published": "2022-11-29T17:06:17-08:00",
  "text": "Ладно Мне очень нравится эта мелодия Мне очень нравится это музыка она написана музыка написана группой Piano guys за это все время банят на YouTube Когда мы впускаем это случайно в трансляцию а слова мы написали в 2014 году с буквально за ночь прям с летом и ну как бы они Они же про нас вот эти вот ребята которые которые там играют они Настолько настолько в процессе Они настолько вовлечены Они настолько любят свое дело что эта фраза про то что мы сами что мы делаем Блин мы на кнопки даем а в результате работают банкоматы ездят поезда льется сталь не знаю люди заказывают ездят курьеры работают все что мы с вами делаем вот Просто берем свой Разум и волю и воплощаем ее в чем-то в каком-то физическом мире и вот это мне кажется очень круто поэтому этот прям бессменный клип с 14 года прямо гимн так Ну что поехали представляю Вам Марию Мария организатор этой конференции и вперед сейчас мы вам расскажем немножечко о том как ею пользоваться погнали Ну это понятно первое И самое главное Мы уважаем друг друга Мы внимательно слушаем доклады Прошу вас выключить звук на телефонах Давайте не отвлекаться от нашего прекрасного контента и погружаться в него полностью здесь понятно Да конечно программный комитет Олег тебе программный комитет программный комитет хайлоуида традиционно самое большое это порядка 50 человек а в этот раз него добавилась еще человек 10 из программного комитета PHP огромное количество людей работают над тем чтобы сделать пока щелкой щелкой сделать актуальнейший срез того что происходит на рынке и еще по моему один слайд нас очень много Спасибо большое программному комитету без этих людей мы бы мы бы не справлялись они просеивают сотни заявок они ходят к тысячам людей выбирая самый-самый сок самый самый лучший нет нет туда направлять но переключить на следующий слайд ребят на следующий Давайте Живи Отлично так конференция огромная несмотря ни на что На мое было очень сложно собрать Наверное это самое сложное по сбору конференция и тем не менее она собралась нас здесь больше двух тысяч человек огромная выставка огромное количество стендов мы посчитали мы заморочились порядка 100 тысяч мерча приготовлено вам для вас вон в том зале Я не знаю как это все унесете но тем не менее 3 тематические секции отдельные отдельные Яндекс трек целиком и полностью посвященный базам данных 22 экспертные зоны Мы про них еще подробно расскажем 8 этапов отдельном зале мы его придумали на лету он расположен прямо в фойе называется интерактивная сетевой площадка для технических директоров Ну и огромное количество событий развлечений и всего тому подобное это Несмотря на то что вокруг нас творится творится творится тяжёлая ситуация - Это небольшой но всё-таки праздник и дальше И следующий слайд программа я не буду подробно рассказывать про программу Она реально большая Она реально огромная программа меняется программа подстраивается под актуально историю к счастью к сожалению не знаю у нас по-моему 8 или 12 в этом году докладов по безопасности Ну какое время такие собственно говоря такие доклады смотрите изучаете На что обратить внимание много в этот раз докладов про архитектуру и не просто в архитектуру А про архитектуру в контексте роста даже первый доклад будет именно про это Но как смолоду планирует архитектуру чтобы потом не приходилось приходить как мы обычно любим ну здесь нужно все переписать или всё переделать вот чтобы не было такого дальше расписание расписание мы как обычно для вашего удобства расположили на бейджах на брошюре и на входе в каждый зал Обратите внимание что перед перед названием доклада вы увидите цифру Цифра это номер страницы доклада в брошюре то есть чтобы вы видели все в режиме онлайн максимально для вас пожалуйста Пользуйтесь брошюры подробное описание естественно и дальше схема площадки схема площадки залы называются очень просто я надеюсь вы уже разгадали нашу комбинацию H означает P означает PHP два зала p7 и p8 спички программой впрочем эта программа подобрана так чтобы доклады могли быть интересны и другим языком другим вероисповеданием не только не только ПК понятное дело хайлоут H1 главный зал Мы в нем сейчас с вами находимся Да важный момент ребят сразу отвечаю на вопрос который вы зарядите еще сто раз видеозаписи докладов будут у всех Ура хорошо кстати обратили внимание на выставку там нет прямых углов мы старались вас запутать там надоело Вот этот квадратный гнездовая история о том что все так ходишь по этой как по Питеру и мы решили построить какое-нибудь Я не знаю Суздаль вот что типа такого а то есть все все улочки там не знаю можно бродить общего века понятно но все равно да то есть как бы хочешь ходишь чтобы было интересно Чтобы было не скучно так несколько служебных помещений если они вам потребуется комната докладчиков рядом с входом штаб багаж бухгалтерия туалеты за пределами главного за пределами за пределами всей нашей площадки выходишь и слева и справа от регистрации мы Разместили карту зала рядом со входом если у вас какие-то вопросы или вы теряетесь вы всегда можете обратиться к нашим помощникам Help Team в красных поло они знают ответы на все вопросы и расположение всех залов всех помещений обращайтесь Ну и собственно говоря точно такая же схема Итак дальше экспертные зоны еще один элемент программы который мы недавно опробовали и он зашел ребят мы сюда приходим поработать мы сюда приходим отвлечься развлечься но и поработать В первую очередь Если у вас есть какие-то вопросы у нас действует на площадке 16 по моему или 22 я не помню короче приличное количество экспертных зон подходите и спрашиваете у каждой экспертной зоны есть своя тематика есть своя тема там работают отобранные нами эксперты вот эти 50 человек программного комитета про собеседовали каждого и подписались под то что этот чувак реально знает свою тему подходите задаете свой вопрос вы решайте Используйте конференцию мы собрали вам огромное количество здесь 200 300 самых лучших профессионалов страны Используйте задавайте вопросы Я хочу добавить экспертные зоны обозначены праздничным образом красными шарами Так что красный шар это Эксперт спорное решение для айтишников Но вот таких красные шарики гелевые праздничное настроение Давай дальше это все экспертные зоны опять же по моему описаны вас есть в брошюрах на ощупь ищите спрашивайте про интерактивную площадку еще что-то скажем Да интерактивность и тепло площадка для технических директоров мы попробовали отобрать Некоторое количество докладов выступлений которые подойдут и будут интересны в первую очередь техническим директорам Она расположена вот такой оказывает Стрелка начало первое выступление в 11 часов с литой которая у нас затемлит крайне затем лет конференция и это будут доклады именно для топ levella ребят там соответственно будет соответствующий язык соответствующий темы и соответствующие боли решаться А если интересно подключайтесь все 2 дня она будет работать расписание мы выведем вот оно здесь и мы выведем его опять же рядом с самой площадкой будет постоянно действовать расписание Давай дальше автор по автопати будет по всей площадке Но есть одна специальная часть у этого автопати на стенде ВК на всех стендах экосистемы ПК их много можно будет получать различные фишки которые вечером дадут вам право поиграть в покер еще что-то Ну то есть Нам короче прикольные игры это будет в соседнем зале вот буквально через стенку то есть набираете набираете вот входные билетики меняйте их на место за карточным столом но за другими словами Начало начало автопати вот от ВКонтакте мы с вами начнем уже сразу после последнего поступления в районе 19 часов сразу по выходу Вечеринка будет везде по всей площадке игры соседям приходить Ну хочешь там будет мне обещали покер будет а с крупье Да скорее всего должен быть на деньги нет деньги нельзя только внутренняя валюта Ну ладно мы там договоримся с игроками так только только это про деньги Тихо Да мы сделали несколько зон зон отдыха Они расположены видите по схеме да Опять же у вас бежит схема есть там можно все что угодно в том числе и полежать послушать музыку вырубиться поспать зарядиться Ну если там подобное Как обычно я хочу добавить пару слов про зону отдыха онтика это специальная зона зарядки Где вы можете зарядить не только свой телефон но и ура ура ноутбук Поэтому если если нужно обращайтесь Специально для вас Мы подготовили столики розетки все для того чтобы работать и подзаряжаться большая просьба к вам ребят мы ориентируемся на ваши оценки каждая оценка разбирается каждый доклад разбирается Неудачники отправляются в топку да то есть в школу на самом деле в школу докладчиков я серьезно то есть мы все внимательно Читаем после каждого выступления будет Вот такой вот qr-код будет такой слайдикс вот таким qr-кодом пожалуйста голосуйте Да я хочу немножко добавить после каждого выступления мы будем выводить qr-код на экран очень просим Вас наводить телефон потому что даже расскажу что мы придумали нового можно текстом писать еще что-то да то есть любые комментарии докладчики все это читают мы все это Передаем Мы немножко фильтроем фильтруем Да Простите Вот и Передаем фильтруем Передаем и в этот раз мы упростили момент авторизации те кто был с нами раньше наверное помнит сейчас важный момент на детали про это рассказывать не надо просто упростили погнали дальше так вопросы вход на платформу теперь можно сделать по бейджику это то к чему я хотела перейти теперь не нужно вспоминать логин и пароль можно просто ввести код который указан у вас на бейдже Посмотрите пожалуйста над вашим именем есть код и у нас появилась функция авторизация по коду бейджа это упрощает вам доступ в личный кабинет один раз Вы можете зайти и все 2 дня заходить без препятственно дальше очень рекомендую сделать Посмотрите Ну Пользуйтесь или кстати тоже байка у нас раньше была проблема с авторизацией То есть как бы авторизация слетала что мы только не делали мы 2 года искали этот подземный стук не нашли она прошла сама собой может быть попробуем Ну ладно погнали дальше вернули телеграм-бот мы вернули телеграм-бот по просьбам Трудящихся Я хочу сделать здесь акцент на классную картинку она мне очень нравится Мне кажется она повышает настроение в чем штука очень очень рекомендую подключиться навести телефоны на qr-код и прям вот попасть него что есть прикольного здесь есть такие кнопочки обратить внимание расписание мое расписание Когда вы кликаете на них вы автоматически попадаете в расписание можете поставить себе звездочки И в моем расписании у вас будет подгружаться список интересных докладов интересных для вас специальных более того за 5 минут до начала доклада вот будет сообщать вам что ку-ку через пять минут интересно и Тебе доклад происходит вот там часто задаваемые вопросы трансляции оценка докладов вы уже знаете библиотека материалов это тоже прикольно новая Прикольная штука совместные поездки Обратите внимание мы это сделали изначально для того чтобы Вы могли кооперироваться То есть если кому-то нужно в аэропорт на вокзал и так далее и тому подобное там вы можете найти себе попутчика и пошире такси Мне кажется это удобно Наверное всем кажется что это удобно пользуетесь Специально для вас прикольно посмотрим давай так обеды у нас с вами то есть кофе проект постоянной ищите их много точек кофе есть заваренные заранее есть кофемашинки и так далее они работают всегда с утра до вечера обеды на втором этаже прямо под нами то есть спускаетесь на лифте или на экскаваторе на второй этаж выходите из лифта поворачиваете направо и идете до обедов обеды у вас по талончиком К сожалению нам нужно Это для того чтобы балансировать нагрузку их можно поменять в любой момент на стойке ресепшн если время время которое вам досталось неудобное Выбирайте любое другое подходите просить вам поменять еще Крокус обещал включить синабон сегодня в нашей зоне Если что хорошо так но и хэштег традиционно традиционно мерч конференции Мы раздаем за любое упоминание конференции с хэштегом лучше всего Больше всего мы любим различного рода эссе про доклада Я послушал вот такой-то доклад очень классный доклад нифига не понятно и нифига не применимо ну то есть вот какие-то такие да публикуйте приходите показываете получаете что-нибудь приятное от нас стентончика рядом сидя площадкой и самой большой ледникитеринга его очень просто найти приходите мы вас там очень ждем информационные каналы опять же подключайтесь там публикуются все новости что происходит и так далее и важный слайд без которого Нам сейчас было бы очень очень тяжело а вам не так было бы интересно большое спасибо всем нашим партнерам низкий поклон вы помогаете нам делать эту конференцию вы помогаете нам собираться здесь в крокусе это единственная площадка на самом деле в Москве Куда мы врезаем и она просто-напросто страшно дорогая и вот благодаря партнерам мы можем себе это позволить мы можем Провести конференцию вообще в принципе и Я хочу пригласить на сцену главного нашего партнера его представят Сергей Нуралиев это необычно для нас но это очень очень интересно Итак Сергей компания 1С раз Всем привет ну главное Здорово Что есть такая конференция лет 15 я не упаду лет 10-15 назад проекты были Ну скажем то ли экзотикой то ли такой редко редкостью но постепенно время шло и hellout проекты стали проникать в реальную экономику в реальную работу предприятий и сейчас уже от таких больших проектов зависит критически зависит работа критичных для людей для страны предприятия Поэтому это стало уже не просто вот эту мысль говорил Я тоже хотел подчеркнуть потому что Для нас это очень важно реально зависит жизнь людей от нашей с вами работы в области и Поэтому это стало очень важно для наших клиентов для наших партнеров Ну и конечно Для нас вот в том числе поэтому мы стали генеральным это замечательная конференции поэтому я всем желаю хорошего дня хороших докладов и самое главное хороших обсуждений Все спасибо спасибо Сергей а ну что наверное все мы все рассказали всем остальным партнерам тоже Огромное спасибо Мы к сожалению не можем позвать вас всех потому что в этом случае нас пол первого дня будет представление вас и слова благодарности Итак рак объявить конференцию для разработчиков из окна окруженных систем хайлоу 20-22 открытый Всем удачи и продуктивной работы а я передаю слово бессменному нашему ведущему Алексею образцу Алексей ребята Спасибо большое Спасибо что потестировали для нас цену Олег остается главным тестировщиком тоже друзья всем хорошего дня следите за расписанием в каком зале вам нужно быть помните что если вдруг понял что ошибся залом или поняла не стыдно встать и поменять залы сейчас микро пауза для того чтобы мы подготовились к выходу первого докладчика всем хорошего дня и можно потрепать соседа за щекой если руки антисептиком обработали первый день хайлоуда начинается и сейчас оффлайн аплодирует онлайну ребята все кто смотрит нас онлайн вам привет и здесь мы оффлайн нас прямо много То есть если бы я был интровертом я бы сейчас наверное убежал со сцены и сказал спасибо большое извините пожалуйста вот но поехали Меня зовут Алексей образец в этом полете общение я буду вашей стюардессой кофе уже подали поэтому полетим хорошо за открытый трек главного зала Большое спасибо 1С Можно немножко пошуметь этот трек доступен бесплатно благодаря нашему генеральному партнёру 1С технологический Лидер в автоматизации бизнеса Вы знаете что в основе В основе работы 1С лоукод платформа один из предприятие Давайте Пошумим Пошумим Пошумим ей много лет которая позволяет любой компании технологически сложный или не сложные развернуть highload проекты под свой бизнес на стенде 1С можно поговорить об этом подробнее и еще раз друзья Спасибо за открытый трек Это всегда приятно сейчас на эту сцену Выходит человек который всегда открывает всегда открывает долго всегда долго запрягает и потом быстро летит технический директор ВКонтакте Александр тоболе Опять опять будешь выступать 57 минут и 30 секунд Да 32 это человек которому вопросы можно задать в кулуарах потому что он не оставляет нам на них времени я давно хотел спросить вот ты когда не на сцене ты что делаешь вообще опаздываю на Следующую встречу слышал эти встречные вопросы в лас-вегасе Да а когда можно было путешест знаешь я наоборот не расстраиваюсь Я два раза был в лас-вегасе один раз вот лет 12 назад где-то в лас-вегасе была второй раз сегодня утром когда заходил на нашу выставку у меня прям было ощущение такое просто как будто бы вот лас-вегас пришел сюда вот собирайте фишечки аплодисменты Ну и в Вегасе очень легко потеряться Но главное чтобы друзья все из этого Вегаса вернулись на работу да Главное что здесь не оставить всё хорошо доставить Ты готов меня я готов конечно погнали так и Всем привет Меня зовут Александр Я технический директор ВКонтакте и еще вот перечисленных ниже сервисов Давайте немножко для разминки такой опрос легкий кто гордится своим умением выходить из трудной ситуации вот там вот сегодня опоздал на метро там такси что-то еще в общем все не так Да я тоже вот общем мы очень горжусь считаю что это в общем-то Мой основной скилл сначала попасть в трудную ситуацию потом не очень долго выбираться Вот и сегодня решил посетить свой доклад тому как действительно не попадать в эти ситуации а давайте начнем немножко буквально пару слайдов так я представляю социальную сеть ВКонтакте у нас там дневная аудитория там порядка уже больше 50 миллионов в России это 85 процентов аудитории рунета нам уже там приближаемся к пределу нашего роста с точки зрения аудитории продолжаем расти по времени продолжаем расти по времени которое у нас проводят пользователи и мы один из самых высоконагруженных э-э проектов рунете наши пользователи потребляют реально просматривают больше 10 млрд постов в сутки и наш например там количество запросов к нашему API 2 или 2 млн секунд и всё Мы это хостим в 20.000 серверов в трёхдц немножко про меня Я всегда рассказываю про себя какие-нибудь три ярких факта чтобы познакомиться призер сиэмовских студенческих международных олимпиад 20 лет уже в разработке и на самом деле 17 раз выступаю на конференции highload это Да действительно аплодисментов Спасибо даже посчитал ради этого мероприятия И за все эти 17 раз я никогда не рассказывал чем я занимаюсь я объясню почему Вы наверное знаете всех этих прекрасных людей И когда вы там смотрите на классное выступление публичное котором рассказано что надо бросить учебу пойти медитировать стать супер классным или не знаю начать паять компьютер в гараже если мы все начнем сейчас паять компьютер в гараже то мы можем оказаться например где-то Здесь тоже так сказать бросить учебу начать медитировать поедете компьютера вот если простым языком говорить то это на самом деле такая история называется ошибка выжившего эта ситуация вот она на дельфинах очень некрасивая но представьте себе Мы всегда говорим что дельфины спасают людей которые тонут совершенно не знаем что было с людьми которые утонули и еще в Древней Греции люди стали замечать И вообще задавались вопросом а Действительно ли мольбы во время шторма вам помогают То есть вы на всегда не знаете про каких-то далеких людей и поэтому сегодня всегда когда вы будете их вообще ходить на конференции помните что если вам со сценой в том числе я рассказываю что стоит внедрить техническую стратегию облако микросервиса и вот эти все вот эти классные модные технологии то помните что Кроме тех кто внедрил действительно получил от них Профит стоящий на сцене есть еще огромное количество людей которые все это внедрили и не получили какого-либо результата и успеха поэтому на самом деле фейловый опыт опыт ошибок он гораздо более ценный чем э-э что-либо услышаны но сегодня я предлагаю послушать и конечно же всегда включать свой критический ум о том что вам рассказывают о том что действительно к вам применимо а вообще на самом деле изначально мой доклад был больше технический про архитектуру если кто меня знает я очень часто рассказываю про технологии Ну в этот раз меня Довольно интересно попросили в очередной раз или 100 лентов ВКонтакте я увидел что в рекламе ребята просят меня рассказать о своей работе и действительно Я понял что с точки зрения там опросов некоторого nps и в целом всем интересно что делает технический директор Поэтому я решил ответить на этот вопрос я за все 17 раз Никогда не отвечал на это я всегда помню про ошибку выжившего если делать все то что делал я не факт что получится примерно такой же результат но на самом деле попробуем поэтому наш сегодняшний план поговорить о том что делает сетевого технологических компаниях о том вообще что такое стратегия посмотреть в первую очередь на провальные стратегии и уже более успешные посмотреть на самом деле паттерны стратегирование и здесь мы будем использовать паттерны крупнейших на самом деле консалтинговых компаний которые многим помогают сделать крутую технологическую стратегию Но скажу честно в этом месте мы будем использовать то что мы реально используем на практике без вот какой-то истории там вот сейчас называть любые три буквы там ampcg там еще что-нибудь вы всегда получите какой-то стратегический от консалтинговой компании мы сегодня рассмотрим их минимум на те которые действительно применимы и посмотрим технологическую стратегию ВКонтакте мы этого никогда не делали конечно Все не расскажу но будет интересно Давайте расскажу вообще вопрос Что делать сетево на самом деле все зависит от того что такое В какой стадии жизни находится сейчас сетевом если сетевой стартапа какой-то небольшой команды порядка там 30 человек 50% времени уделяете написанию кода и при этом у вас в голове есть техническая стратегия бизнес-стратегия вы её доносите людям управляете процессами принимайте решение в целом 11 посовещался с командой которую можно собрать в одной комнате если вас становится больше вам требуется уже написание кода вообще отходит на второй план вы начинаете масштабироваться синхронизировать команды вы управлять руководителем руководителем и дальше у вас есть развилка вы либо как сетево занимаетесь архитектурой либо занимаетесь процессами Да ну или пытаетесь усидеть на двух стульях и если вы становитесь его крупного бизнеса то вообще честно страшные вещи такие как бюджет задачи какие-то тайм-ту-маркет вообще ничего не кодируете и вот мой жизненный путь он выглядел примерно так порядка десяти лет я начинал в Одноклассниках сразу заработки сервиса видео бэкграунд тимлид разработчик 50 процентов то больше написания кода наша вообще стратегия выглядела примерно так У вас есть команда 23 человека вы собираетесь штормите и Говорите Так мы выбрали Вот это направление вот эта фича классная давайте сделаем все как бы это примерный формат Если вы начинаете расти на рынке у вас классно везет вы масштабируетесь вас становится уже порядка сотни у вас появляются какие-то процессы смежные проекты задачи вам требуется ресурсы Вам приходится объяснять зачем вам требуется эти ресурсы Вот и на самом деле стратегии у вас уже есть какие-то бюджеты первые там смежные проекты еще что-то и с точки зрения если вы занимаетесь каким-то крупным бизнесом например ВКонтакте или другими какими-то сервисами то кроме вот всего что написано там People менеджмента скорость разработки ваша Главная задача это техническая стратегия и когда я три года пришел ВКонтакте буквально на первой неделе текущий SEO ВКонтакте сказал Александр Слушай у нас нет технической стратегии Напиши пожалуйста наверное целый такой Это был серьезный Челлендж я попробовал погуглить эту историю Вот это было сложно и на самом деле всем тем чем мы занимаемся и тем чем занимаюсь я последние несколько лет я сегодня вам и расскажу а если говорить про сетевом Как я рассказывал вы Растете Растете вместе с командой вы можете быть архитектором Тим ли дом там операционным еще кем-то архитектором не важно кем Но если у вас есть стратегия стратегия правильно приносящая результат вы Растете вместе с командой Растете дальше и начинаете управлять какими-то большими серьезными проектами Давайте поговорим Я понимаю что кажется что стратегия понятно но очень трудно отличить стратегию от тактики вообще в целом это определение У меня на самом деле первый вопрос вообще кто писал технологическую стратегию там для своего Юнита ещё что-нибудь по работе Ну раз два три и еще преимущественно сотрудники ВКонтакте хорошо А кто видел стратегию компании примерно понимает куда компания движется Ну процентов 30 Как ни странно действительно крупнейшая консалтинговая компания гартер который как раз помогает делать стратегии стратегия это такой знаете набор красивых картинок паттерна всего вот этого она говорит что 30 процентов есть стратегия 54 кто-то знает что-то слышал и 13 вообще говорит это ерунда она нам не надо и в общем и хорошо если мы начнем смотреть определение Мы в основном посмотрим на каких-то бизнес-стратегистов которые говорят что это там способ реакции на внешнюю угрозы какой-то комплексный план конкурентные преимущества мне конечно больше нравится определение чендлера по поводу там установления долгосрочных целей компании там еще что-то но на самом деле для нас с вами Особенно для технических людей чтобы простым языком объяснить давайте начнем с антипатарно Когда у вас нет стратегии Если вы помните Алиса подходит через чеширскому который спрашивает слушайте скажите куда мне идти если вам главный вопрос Куда ты хочешь попасть Если ты не знаешь куда Хочешь попасть кстати абсолютно всё равно идти да как нас невозможно сбить с пути нам всё равно куда идти вот в этом случае у вас нет стратегии во всех остальных случаях она у вас есть она у вас может в голове ещё где-то её можно нужно формализовать И вот про это формализацию мы сегодня именно и поговорим Теперь если говорить просто стратегию на понятном э в Стратегии есть Первое это точка А Вы точно понимаете где вы находитесь с точки зрения метрик э с точки зрения там конкурентов всего остального вы понимаете Когда вы хотите прийти с точки зрения тех же метрик и всего это какая-то измеримая конечная точка это стратегия распределена во времени это путь того как из этой точки А в точке прийти в точку б самое важное что сама стратегия она создаёт э ценность всем стейк холдерам всем там участникам это и бизнесу и продукту и пользователям разработчикам то есть на самом деле И вам должно быть интересно и бизнесу полезно и в результате вы получаете некоторые успех вообще зачем Когда вы можете потребоваться стратегия а предположим рынок Стал быть высококонкурентным то есть у вас it каждый год росло X2 вы могли делать все что угодно вы росли дальше Вы смотрите компании вокруг стали уже сокращать сотрудников вам пора что-то делать возможно как раз самое время начать заниматься технической стратегией вы поняли что рынок изменился и перестала само получаться то есть много вред делали так как делали Было классно но перестало получаться Ну и на самом деле вам стало казаться что технологии вообще Вокруг всё слишком непредсказуемо быстро меняется сегодня то завтра другое вообще работать невозможно вы находитесь в такой ситуации скорее всего вам тоже нужна стратегия нужно понимать что технологическая стратегия это не что-то в абстракте Это история очень связанная с продуктом с целями продукта и как раз рода определяется не только запросами типа завтра нужно вот это это всё определяется когда это завтра и почему оно такое именно технологиями которые определяет вы а если посмотреть на формирование Это сложный процесс какие-то диагностика там формирование всего остального Давайте не будет Вот первое предложение Зачем нам вообще нужна тех стратегия Давайте забирать все технологии которые есть у каких-нибудь крупных ребят Вот они друг за другом повторяли они такие типа как можно ладно нормально Вот но понять что может получиться Кто знает что это буквально процентов 10 Да это на самом деле культ это так сказать где-то в меланезии есть племена которые считают что все богатства были нечестно распределены между жителями планеты им они достаются Но если делать то что делают европейцы это вот такие телефоны самолёты все остальное то эти все блага к вам спустятся Поэтому если вы остается за лидером и начинаете внедрять там не знаю какие-то технологии которые Вот классно сейчас на слуху всегда под челленджи типа смотрите чтобы вот не получиться в такой ситуации когда вам это не требовалось А вы это внедрили если говорить коротко то про технологическую стратегию мы поняли что это некоторые пути за б где мы очень точно понимаем поднимите то что у нас упало не роняете больше Спасибо когда мы точно понимаем что из точки А в точку б мы хотим прийти мы знаем где мы находимся все метрики у нас есть мы поддерживаем продукт это всем полезно это И вам полезный продукт в целом если рынок у вас это высококонкурентной такой например сейчас it Ну и самое главное что не стоит верить историям успеха если вам рассказали что вот это Супер Классно вы просто берете начинаете паять компьютер в гараже ничего не получается Кстати кто паял Спектру вот Отлично вот сейчас не надо это делать А тогда это было супер полезно Это нам с вами помогло Хорошо давайте посмотрим на как раз файл истории про пример не самых удачных стратегий если помните ноки это топовые кнопочные телефоны топовая доля рынка и в какой-то момент Знаете вы приходите к своим ребятам Говорите мы делали все правильно но проиграли такое случается когда у вас некоторые формат индукционного мышления на самом деле ошибка топового сервиса нам честно говоря в России тоже очень трудно как ВКонтакте это индукционное мышление вы все время делали то что всегда делаете и потом вы уже вот знаете являетесь некоторым индюком каждый день У вас делать одно и то же уже ножи точит уже день благодарения рядом вы все делаете делаете Делаете вот здесь Главная задача правильно инвестировать в r&d смотреть рынки вокруг и не оказаться в ситуации когда у вас кнопочный телефон Стив Джобс рассказывает про тач смартфоны Вот это всё и вы начинаете инвестировать в свою операционную систему кстати про свою систему про стратегия следования за лидером все верно знают winmobile если кто-то трогал его то была классная операционная система всего через два года после iOS Android стала доступна она была по всем правителям лучше Она реально подзывчивости там скорости работы она была классная если кто-то писал под вин Мобайл тоже поднимите руку я просто знаю несколько людей лично спасибо Вот она реально была крутая то есть с точки зрения технологии все было прям топ но уже рынок был занят очень было трудно привлечь создатели приложения еще к третьей операционной системы и вот ребят следовали за лидером Microsoft точно знает как делать операционные системы но пришлось закрыть круто что они там вовремя закрыли И следующий пример это выхода на конкурентные рынки я вот именно взял Cisco Cisco пытался выйти на рынок устройств Ребята в 2006 году купили Флип видео это некая камера это когда телефоны камеры были разделены устройствами Они сказали что есть простая камера сэмпл тушот сэмпл душе снял поделился это новый рынок И когда вы находитесь на своем рынке вы находитесь на выходите на другой он всегда кажется что ваши идея супер классная и прорывная и вот 70 процентов провалов это выхода на соседние рынки где вам кажется что вы придумали за всех участников этого рынка то что нужно делать Поэтому вот в этих ситуациях будете очень внимательны И следующий наверно супер топовый провал наверное не все про него знают Это Motorola Ребята в 90-е придумали Starlink они увидели что в 90-е годы сотовые операторы не очень распространены что есть роуминг и сложность соединения операторов искали Окей мы на всю планету запустим спутники и будем всех соединять это было супертопление но проект делался порядка там 11 лет телефоны выглядели вот так вот с антенками за это время сотовые операторы проникли уже внутрь качества покрытия качества связи улучшилось телефоны стали моднее если бы они это запустили на 5 лет раньше возможно мы бы сейчас с вами не пользовались услугами наземных операторов а пользовались именно спутниковой связью Но вот так не успев упустив момент ребята не смогли на него выйти и каждый раз для вас самое главное момент это крутилась из-за этого проекта рассказал прям совсем вот для вас самое важное понять в какой-то момент что вам пора прекратить инвестировать очередной проект или в ту или иную технологию вот здесь нам приходит на помощь консалтинг который говорит что такая самая стандартная консалтинговая Матрица вот Бостон консалтинг групп и все говорят bcg вы берете свой проект понимаете У вас у него темпы роста и долю рынка Если вы на долю рынка занимаете какую-то серьезную позицию У вас есть серьезный рост то вы Суперзвезда например и это значит классный проект Все здорово но если у вас доля рынка например низкая у вас темпы роста низкие вам нужно поставить какой-то дедлайн Скай Так ребят если мы три года там лет не знаю там один год не выбираемся из вот угла где собака нарисована есть собаки Есть проекты под вопросом есть звёзды дойные коровы то вам пора вас отстреливать простите вот когда вы начинаете круто расти за вами Нужно следить Если вы стали звездой заняли долю рынка и Растете Это здорово если Вы перестали расти на рынке но у вас супер доля вы такая дойная корова из которой Пора начинать инвестировать в новые проекты вот довольно классная история которую можно поиспользовать если вы делаете технологию Вы тоже можете понять что эта технология вам принесла все уже необходимо и внедрение этой технологии в компании остается пора инвестировать например в Новую технологию и посмотреть что это такое стоит отметить что все сервисы ошибаются и даже крупные компании типа Google очень много закрывают классных сервисов и свою социальные сети видеозвонки там мессенджеры все что угодно остановимся на техническом провале Google стадия ребята его закрыли буквально за три года я думаю у них были маркеры что пора перестать мучиться кажется классная история Клауд гейминг давайте мы просто красиво продам Представьте вы запускаете игру Один раз её пишете она доступна на смартфонах телефонах телевизорах супер дешевых приставках и это всё работает проблема единственный оказалось что для игроков и вот эта версия там задержки отвода до реакции системы Супер Классно у вас оптимальное железо электричество вам не нужно думать вам не нужно покупать новый PlayStation Xbox постоянно кажется все круто но и за проблем именно технических с тем что ребята не решили эту проблему вейтансе Вот она реально текущая вот пришлось в целом закрыть целый проект и они главное это сделали быстро буквально за три года приняли решение что все на самом деле лидеры часто повторяют за лидером и вот крупнейшая запрещенные территории Российской Федерации повторяла за Gmail Club хаосом биткоином своими классными проектами в этом нет ничего зазорного Главное вовремя понять когда вы остановиться и мы как ВКонтакте тоже И повторяли тут нельзя знаете все плохие Мы хорошие А у нас были проекты которые если появились в Instagram это было бы супер круто мы исследовали за лидером и выходили на смежные рынок мобильных устройств ой мобильных операторов и делали дополнительные оператор где мы не могли добавить ценности пользователю Мы работали поверх уже имеющихся рынка и в целом как бы только позволяли заработать каким-то оператором Итого Все ошибаются важно вовремя остановиться важны причины и стоимость этого провала и причины которые вам могут позволить быстро понять что она остановиться что у вас есть какая-то проблема Вам нужно искать ее среди индукционного мышления карга культа выхода на смежный рынок которым мы не разбираетесь Ну и на самом деле если у вас есть какая-то технически нерешаемая задача вам нужно принять на себя сказать Вот эта формулировка задача не решается нужно закрывать проект а теперь давайте посмотрим про удачные примеры это не очень интересно Главное понимать с которым мы вот хотим сделать это про связь Удачного примера с продуктом Если вы в своей тех стратегии поддерживаете продукт скорее всего вас ждет успех у вас будет расти команды вы пройдете весь путь сетевого от небольшой команды до какого-то проектов тысячи сотрудников например рассмотрим Spotify у ребят была в общем-то с тенденция по музыкальному прослушиванию везде супер персональная и некоторое время Модель которая позволяет послушать и они ребята на самом деле это первое придумали вот технически команда очень круто это поддержала если Посмотреть например систему рекомендаций там огромное количество мэли НЛП всего остального чего на самом деле в обычном музыкальном сервисе многие не делают вот При этом они изначально продаст работали доступность доступности над всеми устройствами и пришли к некоторым успеху на самом деле ещё более интересный пример это airbnb Кто бы думал что это очень эмаль компания если посмотреть на бизнес вообще аренды квартиры съемки самое главное это чтобы первое вам не разбомбили квартиру второе вы не получили разбомбленную квартиру Вот они поняли что главный фокус на данных они собирали максимум данных они построили некоторые метрики которые говорят об Успехе того или иного эксперимента и результата и позволили всем командам внутри просто творить и оценивать результаты по этим метрикам В итоге получилось очень клево они собрали данные построили сложную систему AB и инвестировали в eml и у них даже есть антипатии проекты которые говорят что внутри вашей квартиры никто не устроит какой-то партии вечеринку Потому что люди слишком молодые они собираются давайте подселим к ним кого-нибудь еще если у вас многокомнатные и так далее В общем супер классные проекты Именно поэтому airbnb так занимал такую популярность что вам не разбивали квартиру и вы получали всегда качественное жилье которое ближе всего ко мне с точки зрения видео netflix ребята начали запускаться поняли что у них есть проблемы с масштабированием с тем что они хотят заниматься поддержкой железа перешли на и вес потом началась масштабная экспансия не подключили все возможные сидены это сети доставки контента чтобы все могли смотреть видео быстро и классно потом поняли что cdn это вообще их уникальное предложение они перешли на него и потом заняв весь рынок так они первыми стартовали и получили огромное преимущество они его стали удерживать внедрением технологии машинного обучения самое главное что они очень быстро поняли буквально там в 13-14 что тренд за Эмилем за рекомендациями и очень быстро туда включились и удержали рынок и сейчас просто ищут новые точки знаете стратегия роста вы сначала растёте снизу потом у вас быстрый рост потом рост прекращается его удерживаете рынок и начинаете искать новые точки роста вот ну если здесь посмотреть действительно три явных перехода это из серии масштабирование Это не наша история пусть будет и вес доставка Контент это наша История это фокус и машинное обучение сейчас тренд удержание рынка ребята все делали правильно если посмотреть на эти все стратегии стоит отметить что стратегия вам не гарантирует успех но она действительно определяет развитие компании ее стоит написать как минимум Если вы провалитесь вам будет что потом анализировать и сравнить в целом анализ провалов гораздо более полезен с учетом парадокса выжившего того что гораздо интереснее смотреть на провалы поэтому смотрите на них Вот и если вы тех стратегия не поддерживаете продукт наверное у вас есть проблемы вряд ли вам это поможет теперь поговорим про паттерны И на самом деле про именно не все консалтинговые стратегии которые есть а именно про то что мы действительно использовали Просто ракетирование у нас есть варианты стратегирования партеррианства ресурсные стратегия некто Портер в свое время там основоположник стратегий предложил вариант того что когда вы анализируете надо смотреть рынки тренды анализы посчитать издержки выйти куда-то такие дети войти компании там посмотрели завтра там вот поэтому что это не работает и есть вариант ресурсные стратегии это Джей Барни его предложил говорит что у вас есть всегда команда даже если вы стартап У вас есть команда заинтересованных людей которым нравится блокчейн который программирует ногой еще что-то логично что вам нужно расти вот в этом направлении Вы смотрите где может быть полезно по факту на самом деле ничего не работает И вот сегодня буду всё смотреть на Вики клипс это сервис коротких видео и мы посмотрим на базе него того что как строится тех стратегия И самое главное что обычно успешный сценарий срабатывают Так у вас есть с одной стороны весь ресурс команда технологии еще что-то с другой стороны есть тренд вы к нему подключились Ну если вы конечно не создатель какого-то инновационного направления типа Club House но у вас здесь может ждать и поражение на практике все стратегии 90% любых стратегий имеет уже команду компанию продукт технологической истории мы именно с этим будем работать структура Я понимаю что это очень сложно но если вы захотите написать текст стратегию обосновать ресурсы для вообще в целом для компании для чего для чего Вам нужны деньги для чего Вам нужны ставки Ну и вообще ответить на вопрос чем я занимаюсь вам придется вот позаниматься такой историей главное что у вас есть предпосылки Где вы анализируете рынок анализируйте свои сильные слабые стороны Выбирайте направление Куда вы хотите инвестировать смотрите если там конкуренты и что вы можете сделать дальше в декомпозируете продукт по направлениям выделяете туда определяете метрики этих направлений это очень важно и уже в рамках этих метрик поставить в себе цели запрашивать Какие Вам нужны ресурсы для достижения этих целей чтобы опередить конкурентов действительно пока звучит сложно Давайте посмотрим как можно анализировать рынок за крупнейшие консалтинговая компания которая всем позволяет в мире строить Стратегии в России она правда больше не позволяет строить стратегии Вот но сложный график но можно то посмотреть это график технологий он по оси X говорит интерес к технологии это то насколько популярна технология только часто есть запросы на её внедрение насколько интересно запросов в поиске и новейшен ребята оценят по количеству патентов и размер кружка это объем инвестиций прямо в Космических миллиардах долларов и цвет кружка это adoption если он голубой то адоб шаннистки если синий то реально где-то используется здесь технологии в которой Простите все инвестируют но они нигде не используются Давайте остановимся буквально на паре из них на маккенте Здесь вы сами Посмотрите искусственный интеллект буквально там за последние три года вырос феерично по патентом все его используют интерес некоторые средний Технология 3 полное отсутствие патентов и каких-то историй то есть очень простая технология понятная наверное многим вокруг нее много хайпа и есть некоторые рост инвестиций много история про которую мы здесь говорили про код и тут уже как раз нам рассказывали что 1С очень много занимается кодом видно что технология на самом деле растет внедрение очень низкий но при этом есть интерес к этим инвестициям например квантовые технологии Кто из вас хоть раз интересовался квантовым компьютером Ох ничего себе буквально 30 Спасибо вот на самом деле действительно мы все верим в некоторых квантовый прорыв и Ну например мы для себя верим потому что мы знаем что Луз сервис лучше рекомендации лучше чем больше у вас вычислительных ресурсов единицу мощности это кажется классная история адоб шину этой технологии вообще нулевой еще никто не использует но при этом уже есть серьезные инвестиции и крупные корпорации в это инвестировать но с учетом количество поднятых рук наверное быстро пробегусь на самом деле Почему Мы с вами уже достигли Пика предела вычислительной мощности мы не можем единицу времени получить больше мощностей помните закон Мура про удвоение транзисторов чистоты всего остального 4 ГГц процессор уже в 2000 годах был Ну понятно все остальные истории до сих пор ещё до ваших ноутбуков не дошёл Вот это на самом деле наш пределы она не растёт Потом мы стали растить количество ядров в системе упёрлись законом дала в том что наш параллелизм в системе он ограничен там выполнение самого критического пути и сколько там ядер не добавляю примерно вы начинаете упираться уже в сам алгоритм не все раз параллеливается вот и единственный на самом деле механизм позволяющий совершить скачок это квантовый компьютер Вот и здесь действительно крупные корпорации в это инвестируют Это интересное направление вот ну а мы на самом деле смотрим на все имеющиеся технологии смотрим Что может быть полезно искусственный интеллектом есть у всех у него на самом деле сложности внедрения довольно дорогостоящие технологии Если вы распознаете голос речь еще что-то Поэтому мы всегда начинаем в эти истории с nvp мы пробуем Production если это полетело то мы начинаем дальше это активно развивать есть технологии легкие типы 3 которые нужно просто брать и внедрять есть квантовые технологии которые понимают Вы можете использовать только в случае огромных возможностей инвестиций огромной корпорации Вот и например какой-нибудь код на Generation Software Когда у вас есть автокод Complete ml-тесты еще что-то на самом деле очень круто часть кода он до вас дополняет вы предлагаете что-то У вас есть эмэль автотесты вам не надо их писать машинные там искусственный интеллект сам напишет На самом деле это может быть прорывом с точки зрения Time to Market Мы за этой историей тоже прослеживаем Ну и когда выбрали какую-то технологию вам нужно на самом деле взвесить не надо думать что все технологии Можно бесконечно внедрять надо чего-то отказываться Вот время от времени мы смотрим каким-то критериям От чего нужно отказаться если к Вам пришел руководитель говорит надо помочь сделать вот этот проект очень часто на самом деле связано с тем что сервис не в приоритете есть более важные стратегические направления нужно просто помочь подключиться иногда это непонятно Но вот по каким-то системам и сдержек и оценкам вы поняли что этого нужно инвестировать если мы говорим про тех стратегию мы должны понимать а вообще продуктовую Стратегию и Обычно она там установлена по Smart она там конкретно измерима и так далее Для чего надо Ну вот мы ВКонтакте растём там ну по нагрузке там 20% в год для нас дикта был рост и в целом допустим инвестировать какие-то там Технологии скалирования космического роста у нас сейчас нет необходимости но мы готовы к этому росту Мы готовы использовать механизмы деградации для этого роста Да качество сервиса чтобы мы там могли подстроить оборудование еще чего-то но мы у нас все предиктовым и поэтому этот продукт понимаете водные например про клипы там ребята хочу вырасти в два-три раза в год Для нас это супер критично и там до конца двадцать третьего планируют эти вещи вот анализ Кто из вас в институте на каком-нибудь менеджменте чего-нибудь в Техническом программистском вообще занимался Вот анализом раз два три на самом деле с точки зрения стратегии Это один из самых недооценённых механизмов просто его все не умеют правильно готовить У вас есть некоторые он в общем состоит из чего у вас есть внутренние факторы знаете вот по барани стратегирование У вас есть команда там ресурсы аудитория ВКонтакте ещё что-то на это там есть Внешние факторы там люди любят Дофамин знаете быстро посмотрел контент раньше быстро текст посмотрел потом текст стал не популярен картинки смотреть короткие видео смотрят еще что-то Дофамин Окей это возможности угрозы Понятно есть конкурентам дофаминовом рынке Когда вы все составляете вот например какой-то по клипам иллюстративный того что есть самое главное вам делать некоторые чек смотреть Какие ваши сильные слабые стороны коррелирует с рынком и если у вас вот это получается скорее всего вы свой анализ провели правильно Вы теперь знаете какими слабыми сторонами нужно работать Какие сильные прокачивать Но если вы уходите На рынок у вас наверное есть конкуренты всегда можно посмотреть на их продуктовые фичи А самое интересное на технически в общем-то Никто не запрещает по реверс инжинирить конкурентов сравнить вас и понять где вы находитесь что у вас лучше что у вас хуже чем вам нужно это конечно иллюстративный пример и вы понимаете что вам нужно дорабатывать и если посмотреть в тот когда вы поняли что нужно делать вы поняли свою позицию на рынке вы сравнили с конкурентами поняли Куда нужно двигаться решили что это инвестируете вам нужно декомпозировать ваш продукт берете в руки Любое приложение выводе композируете на модуле в которых есть какие-то основные метрики которые соответственно командам вот и это некоторые паттерны Месси который или Мессия как его называют в консалтинге это патрон взаимого исключения он говорит что если вы декомпозируете что-то то все блоки должны быть не пересекающимися и желательно чтобы они были всеобъемлющими То есть вы накрыли весь продукт Если вы правильно вы базируете продуктовую историю поймете про что например плохой пример наверное клап Хаус ребята декомпозировали поняли что там продуктовая история голосовых чатов классная крутая мне уделили внимание рекомендациям вы приходите в сервис нет ничего интересного взлетели хайп спал И там сервис сейчас пытается что-то с этим починить поэтому главное что Если вы правильно декомпозировали историю например то вы понимаете что например сервис коротких видео это про стриминг про рекомендации про поиск про продуктовую историю в которой вы там удобно их скорость работы Про некоторые слэй сервисы которые подтверждают ваши пользователи покажем направлении вы строите метрики это вот примерно реальные метрики которые мы смотрим и у вас есть определенные команды у которых цель растить продукт По этим направлениям и там не знаю Вы понимаете что в поиске самое важное что пользователи глубоко смотрели подписывались на авторов в рекомендациях вам важен досмотр видео и время которое пользователи вообще проводят в рекомендациях в целом в любых сервисах так вот очень похоже Ну и Самый наверное интересная история с технической Мы про нее чуть позже поговорим но если вы технический директор Вам всегда вот знакома эта табличка с пинелями кому она здесь знакома вот Да действительно в принципе если вам это знакомо можно сразу же вы либо технический директор либо готовы уже им стать Если вы даже вас называть тех лидом это неважно Вы на самом деле контролируете оборудование железа фото и так далее участвуйте в каких-то бизнес-историях компании и того если вам нужна стратегия вам нужно проанализировать тренды вам нужно проанализировать продукт куда вы решили выйти сравниться с конкурентами правильно его композировать выставить метрики и уже по этим метрикам работать предлагать какие-то креативные решения по улучшению этих метрик все было бы очень классно просто ну знаете как всех должен быть свой соус кто-то медитирует А кто-то ещё что-то делает у нас он тоже есть по крайней мере у меня Кто знает кто это тишина в зале на самом деле это Генри хальшуллер это Российская теория решение ждать их задач я ее прослушал на самом деле некоторые курсы в Петрозаводске лет 20 назад он нас или последнее время жил в Петрозаводске у него было много последователей что интересно Многие считают что это некоторые такой популизм кто-то считает что крутая теория что он сделал он проанализировал все патенты в области физики получилось что там тысячи патентов сводятся буквально к 100 с каким-то уникальным решением которое все применяют Ну вы наверное знаете да Там типа плату перевернул и уже там на IBM в суд подал вот эти вот технологии буквально которые переворачивания этих вот каких-то физических явлений и их порядка 100 их патентуют на тысячи патентов Вот И эта теория решения задач Твист на самом деле можете погуглить она например активно принимается применяется в Самсунге это топ-1 бренд на самом деле по инновациям в мире я вам попробую привести простой пример решение такое изобретательской задачи и того что вам нужно использовать для того чтобы усилить ваш продукт представьте себе мы с вами строим самый быстрый катер Что такое быстрый катер это с одной стороны мощный двигатель с другой стороны низкое сопротивление в воде что мы делаем в лоб Вот вместо катера у нас получается гоночный болид один водитель реактивный двигатель минимальная погружная часть это решение в лоб решение не влог мы увидели противоречие Нам нужен мощный двигатель нам нужно у него есть вес и это погружная часть одной из примеров решений там больше сотни это решение во времени решение времени говорит что на самом деле в один момент времени вам нужно действительно держать весь вес судна это когда вы паркуетесь это когда у вас там не знаю шторм на воде ещё что-то должно быть безопасно с другой стороны во время движения Вы можете использовать другие механизмы чтобы и там одним из самых быстрых катеров Да это вот советское время являлось наши Метеора кометок Кто живет в Питере меня понял Действительно это решение вот на уровне того что нам не нужно вытеснять всю воду мы можем использовать подъемную силу воды и нам не надо вот это противоречие решать У нас есть супер элегантное решение если его совсем продолжать И креативить можно получить не продукты жизнеспособные решения но идеальное решение вообще не соприкосновение с водой это экраноплан он отличался тем что он очень быстрый супертяжелый вот все с ним фотографируются Да но это вот продукт такого решения когда мы хотим быстро двигаться по воде вы вообще с ней не соприкасаемся и при этом когда мы паркуемся у нас все хорошо мы корабль когда мы летим и летим другой вопрос применимости этого всего поэтому на самом деле могу сказать что достаточно просто растить метки когда вырастите метрики конкуренты делают то же самое время от времени нужно находить противоречия в вашей системе которая говорит что нельзя решать и в это противоречие постоянно решаете решать решать Если вы его решили Вы будете инноватором и супер крутым продуктом и мы поговорим про эти противоречия которые вам позволяют стать супер уникальными и создать супер невероятное решение Давайте таких из простых противоречий начнем все знают качество время ресурсы очень простое противоречие Давайте порешаем рекомендательной системе тоже самое сервиса клипов У нас есть десятки миллионов клипов Чем больше мы их отранжировали персонально для вас чем сложнее функция тем лучше реком понятно что мы можем слишком долго ждать Мы хотим качественные рекомендации они готовятся там минуту хорошо по законам дал параллели все не получилось до конца проверить все равно долго по ресурсам по закону мура уже Чистота не растет делать нечего что вы начинаете все делать правильно заниматься предвычислениями при рамками нечетным нечетким поиском кэшированием и так далее И вот например в решении клипов Мы из десятков миллионов роликов которые платформе выбираем разные стратегии выбора кандидатов для того чтобы четко ранжировать одних из них например там не знаю кн поиск ближайшего соседом мы знаем интересы Вот последняя Ласт Позитив клипов которые вам были Здорово интересны мы строим Вектор этих интересов смотрим Какие клипы в пространстве тоже интересны с некоторой точностью для вас их тоже рекомендую при этом учитываем подписки друзей трендов популярности и так далее Это нам позволяет снизить решение задачи там отсечением ветвей границ все это делали хорошо есть более интересное противоречия так как занимаюсь еще звонками скажу что например Мы хотим с вами общаться на минимальной задержке нас ограничивает скорость света и там между Москвой Хабаровском в одну сторону у нас задержка там 50 миллисекунд на самом деле кажется что вы идеально можете это делать вы отправляете пакеты при голосовой связи из Москвы в Хабаровск Они прекрасно доходят если у вас что-то случается вы его потеряли вам нужно восстановить пакет и приостановление нужно сделать окно там негативного как-то tcp его чинит как это выглядит вы говорите у меня нет этого пакета или Я не получил этот и просите его повторить соответственно с задержки в 50 секунд мы сразу получили 150 и это уже как бы нам немножко портит ощущение и вот это наше основное противоречие которое мы всегда решаем в сервисе звонков и у нас есть огромная классная команда которая использует целый набор алгоритмов решения этих проблем и вот Можно например посмотреть завтра если вы доживете до конца конференции посмотреть то как эти противоречия решаются это Например основное противоречие наше уникальное решение которое мы используем для того чтобы наш сервис был лучше Классно очень противоречием этой Вселенной знаете звонки примерно задержка там 150 гейминг надо клаудейминг 570 Если вы сервер пользователя не придвинули играть в принципе невозможно Мета вёрст говорит что им надо 20 вот Facebook сдался на Клауд гейминге В 570 я напомню поэтому стоит сказать да метод запрещён на территории Российской Федерации но ребята делают активный Челлендж и вот мы сейчас видим они инвестируют в кодеке Почему они сидят в кодеки потому что они хотят делать лэйтенсе дублировать все данные чинить Вот то про то что вы можете посмотреть завтра вечером но что для нас интересно Мета попросила увеличить количество аиксов в стране В первую очередь конечно в Америке что такое AX это interxchange некоторые дата-центры в которых один разные операторы очень часто если например вы пытаетесь пообщаться или соединиться с пользователем в Хабаровске в разных операторах вас может измениться ситуация что вы как через какое-нибудь дата-центр в Москве с точки зрения сетей будете гонять пакеты с одной стороны можно увеличить количество таких интерактивных сервисов Мы ждем пока их будет больше в Америке там порядка 15 говорят что их нужно сотня это просит вот мы на самом деле ставим например свои сегмент сервисы в каждых регионах и всех наших пользователей присоединение при звонках коннектим именно через ближайшие сервер который нам доступен но При всем при этом у нас будет масса проблем с точки зрения доставок Починок и доста на скорости вот скорости света то есть по сути вы ограничены скоростью света Нужно решать эту задачу и если посмотреть то Google и Apple Ой Господи Apple Facebook рекомендую используют инвестируют в ML кодеки которые позволяют супер круто сжимать аудио видео для того чтобы делать ретрансмиты этих пакетов исправлять ошибки и никогда не пользоваться стандартными инструментами например tcp поэтому всё будет работать на edp с исправлением ошибок Ну и есть такая ещё история с тем что если у вас сеть перегружена у вас или начнётся задержки или дропываются пакеты и вы это тоже можете определить через РПТ как с потерей пакета если пакет дошёл дольше наверное его перегрузились или он пропал Вот И здесь тоже Мета просит а прокинуть от операторов информацию Выше до уровня для того чтобы действительно метавер стал доступен а в целом вот интересная история То есть как бы один крупный игрок сдался сказал что там 570 МС для клаудейн для недоступна а другие ребята пытаются сделать 10-20 Посмотрим это очень интересная противоречие мы решаем противоречие чуть попроще представьте себе стандартная история вы загружаете видео куда-то на видеохостинг который с разным качеством еще чем-то вы ждете с тем чтобы поделиться им с друзьями и вот мы понимаем что мы можем сжать его лучше и более эффективно раздавать использовать меньше трафика нам надо там люди смогут лучше смотреть или вы будете долго ждать многих на самом деле это потому что все сервисы развивайте 15 минутное видео там 6 минут ждете У вас есть противоречие с одной стороны вы хотите хорошие сжатие чтобы все смогли ваши друзья посмотреть в высоком качестве или в том который в адаптивном качестве под вашу сеть с другой стороны хотите смотреть сразу решение в лоб которые мы используем обычно сама предьюстон какие-нибудь мы там Режем все на куски и решаем решение которое мы например использовали Мы полностью отказались от истории Мы заметили вообще транскодирование Мы заметили что занимает время меньше чем время просмотра поэтому делаем это на лету и поэтому например внутри ВКонтакте если вы заливаете видео вам доступно сразу же вас нет Вообще процесс его нарезки или еще чего-то Это пример таких решений противоречий есть более креативные подходы например на вы все любите смотреть видео высоком качестве если померить просить пользователи они будут жаловаться что качество не очень хорошее но не у всех видео есть хорошее качество мы здесь поняли что у нас есть технологии которые нам позволяет запускать нейросети параллельно на большом количестве устройств с другой стороны мы инвестировали быстро вычислительные типа топологии и например научились увеличивать качество видео для наших пользователей у нас уже миллиарды просмотров видео повышенного качества и там миллионы пользователей воспользовались функцией причем У нас галочка доступна только на вебе выбранным пользователям и реально миллионы пользователей доверяют нам говорят лучше моё видео вот еще интересное про короче писать контентный сервис Если вы звезда и там всем известно то все на вас смотрят подписываются так далее вы начинаете А вы просто некто например Александр который снимает клипа никому не интересно вам хочется набирать вы не в равных условиях против там Егора Крида мы на самом деле здесь предложили тоже решение первый вариант конечно начать набирать популярность инвестировать свою популярность второй вариант сгенерировать У вас есть классная идея Вы хотите чтобы вас лучше смотрели заменить свое лицо и третий вариант вот сегодня мы со всеми нашими пользователями поделились поделились тем что теперь вы сможете снимать клипы и в этих клипах Вы можете применить на самом деле технологии о которых много Все говорят но не все знают как попробовать вот а теперь доступно абсолютно в массовом масштабе и мы оценили что порядка 200.000 видео в день мы сможем вам обработать это на самом деле разработчик клипов это не Егор Крид в целом если для того чтобы вам стартовать ваш проект и так далее может быть Довольно интересно здесь и Мы периодически решаем такие противоречия наших пользователей если говорить про В итоге решение каких-то задач вам нужно определить противоречие вашей системе То есть вы там больше ресурсов памяти меньше там не знаю CPU еще что-то и начать креативно решать и мы все с вами знаем кучу механизмов этого креативного решения самое главное сформулировать Это противоречие для вашего продукта Ну что секретный соус мы узнали который использую я это не значит что он вас приведет к успеху Но вам точно стоит прочитать про трисс попробовать Если вы видите задачи которые не решается почитайте про три примените методики Вы не поверите оно иногда решается А теперь поговорим про самое интересное про то что в общем-то нигде нельзя увидеть порядка там трех лет назад я начал заниматься стратегиями и понял что вам либо могут помочь Либо вы ничего не можете нагуглить потому что никто не светит свою стратегию это прям супер секрет Вот и есть какие-то вот консалтинские приёмы которые используют это супер консалтерский слайд который я попросил отрисовать наших консалтеров у нас есть целая команда До этого что могу сказать У нас есть некоторые цели по компании Мы хотим заменить интернет чтобы выходили в интернет вся аудитория сто процентов были в сети вы всё время проводили и были при этом еще НДС по поговорим что это ваш индекс счастья вы были еще от этого И счастливы и мы разрабатываем различные продукты понятно дело что есть ВКонтакте мы пробуем во всех направлениях которые вы видите и в новых и наши технологические платформы должна обеспечивать некоторые успех этого направления этих направлений поэтому это выглядит примерно так Наш текст стратегия выглядит из того что мы на самом деле перфоманс вынесли на первое место потому что считаем Это супер важным я расскажу почему потом расскажу про отказ устойчивость какие-то еще истории связанные с тем Почему так классно это разрабатываем давайте вам скажу что после того как декомпозировали ваш продукт вам нужно выбрать метрики вы выбираете метрики вашего продукта такие там Скорость ответа качество рекомендация еще что-то проверяйте Влияет ли именно продукт все говорите Я хочу там не знаю внедрить микросервисы потому что что-то что изменится в продукте Ну например ответ ничего вот вы фиксируете эти цели сравниваете с конкурентами понимаете как вам добиваться этих метрик проверяйте влияют как проверять метод киберфомса обратно на б Вы отвечаете за одну секунду пробовать ответить за две смотрите что получилось мониторите все эти метрики и строите уже конкретный план если посмотреть про наш метрики У нас их сотни но по каждому направлению мы смотрим буквально пару-тройку метрик которые говорят там например Через сколько мы там fcp там First контент Фил Пейн да Когда у вас отрисован контент в мобилке не знаю на вебе и так далее и мы контролируем все эти метрики смотрим что у нас происходит интересно если мы попробуем сказать Важно ли пользователя Через сколько при открытии приложения при переходом и так далее доступен контент вот есть рекомендация Google все пиво Вот кто веб-разработчик они вот эти цифры желтые красные зеленые все знают рекомендации того Через какое время вы должны ответить да Если вы это делаете через 1,8 секунд Google говорит что вы теряете аудиторию мы посчитали танец фэнт нашей аудитории поняли что если мы за 1,2 секунды не отвечаем тут падает люди у которых классный Интернет они больше или там быстро отвечает сервис они с тем лучше работать все остальное Везет к потере аудитории Мы за мониторили по нашим сервисам поняли где у нас проблемы поставили себе простые понятные цели Пошли их решать еще вообще состоит ваш ответ ваш ответ состоит из некоторого РТТ сколько выступали до контента ответа сервера Когда в санкт-петербурге это выглядит супер быстро и все у вас на бэкенде в петропавловске-камчатском у вас может быть ситуация когда вы большую часть времени проводите просто в том чтобы доступиться до этого контента или ответы бэка Конечно мы меряем средние цифры и у нас сейчас очень хорошие соотношение там где-то 25 на 75 того что мы очень классно проинвестировали скорость вообще доставки контента и всего остального и там занимаемся сейчас ускорением если вам интересно про ускорение сети мы как мы что внедряли есть вот ссылочка на Хабар там все прописано про внедрение кликов того как мы отказались от gpega Zippo и Джейсона и прочих историй из интересного скажу что эрли-хинз Кто это знает что это Боже мой недавно в браузере Ну в Хроме появилась некоторое время назад поддержка того что вы можете не сразу http respon отвечать ответить сначала 103 эрлихинз например прислать там ЦСС не знаю шрифты ещё что-то что нужно для отрисовки а потом уже отравить контент и эта штука на самом деле Одна из основных прорывов которая нам позволил ускорить метрику доставки контента для пользователей это вот последняя история которую мы внедряли поэтому Кто не знает просто Just Google идти а так и как улучшить время ответа бэкенда мы на самом деле добавили парализом в наш язык и PHP который совместим с PHP но имеет куча классных доработок и добавили дополнительный уровень кэшера и так далее сейчас работаем над тем чтобы локализовать все данные пользователя внутри дата-центра внутри вообще одной стойки для того чтобы максимально быстро ходить за данными пользователя Потому что всегда решая эмаль задачу задача рекомендацию нужно с одной стороны очень много данных с другой стороны много ресурсов следующий важный фактор над которым мы работаем конечно отказоустойчивости к качеству продукта здесь еще сотни метрик над которыми мы следим Ну наверное понятно почему следим завтра ему Потому что если вы вот ВКонтакте приляжет на 10 минут то вы получите новости во всех возможных СМИ всегда нужно проверять метрики Если говорить я там сделал что-то быстрее нужно понять а стало ли лучше продукта и мы чекали мы увеличивали например нагрузку начать на 50 процентов и у нас падала Дауна То есть если у вас есть возможность сэкономить два раза на самом деле какие-то новые кодеки сжать и все остальные вам экономит Вы можете себе очень легко подрастить аудиторию на конкурентном рынке за счет технологии Именно поэтому там Мета Google 7 инвестируют какие-то протоколы сжатия и так далее недавно у нас были проблемы с потреблением батареи мы увидели куча жалоб с тем что пользователем жалуются действительно на то что в нашей приложении стало определять больше батарейки а как вообще улучшать метрики первая задача Если у вас есть огромный набор метрик это их не ухудшать вам нужно устроить мониторинг азербайберите системы и на самом деле вообще процессы работы с этими метриками мы активно мониторим свой портал смотрим наш uptime У нас есть определенные по нему цели всегда смотрим внешний мониторинг аналоги Down Detector внутри у нас есть огромное количество метрик за которыми мы присылаем вам СМСки пуши какие-то истории Ну и на самом деле ВКонтакте отслеживаем порядка 350 миллионов метрик в одну секунду Если вы что-то катите ломаете У вас есть ситуации через одну секунду вы узнаете что у вас есть проблема на продакшене и вы уменьшили время ответа какого-нибудь сервис запроса ответов друзья для того чтобы вам во всём этом узнать вам требуется довольно сложная система и вот можно сходить на доклад посмотреть Григория Петросяна завтра о том как это устроено как поверх Клик Хауса решение для того чтобы мы могли все это контролировать но если смотреть дальше для нас очень важен вообще инструменты вообще разбора инцидентов то есть нас что-то происходит то мы конечно собираемся садимся смотрим Можно ли было быстрее починить то проблема инцидент вообще-то там Интересная ситуация там у вас не работает не знаю кнопка отправки сообщений у вас ничего не легло на для вас супер инцидент у вас все пользователи расстроится Вот и даже здесь мы придумали некоторые метрики в случае каких-то серьезных проблем Мы делаем откаты и для того чтобы контролировать наш процесс работает мы занимаемся тем что контролируем эту метрику нас ВКонтакте действительно есть большое количество багов но мы для себя приняли некоторые тренд того что на баги не должны жаловаться пользователи поэтому для всех продуктовых команд мы треки жалобы с поддержки например на эти Баги и говорим некоторые дедлайн для их устранения Ну и для того чтобы наш сервис работал стабильно и вы не читали в в контакте лег тьфу-ть каргапульт сегодня собственно говоря сегодня вы можете посмотреть в этом же зале буквально через час доклад о том как мы работаем с огромным количеством наших баз данных кластеров и тем как мы динамически адаптируемся под нагрузку и тем чтобы всегда отвечать за константное время мы очень перенесли интересный алгоритмы с алгоритмов сетей из алгоритмов операторов работ с перегрузками сетевых на наш бэкенд Мы всегда помним про скорость разработки на самом деле чем быстрее ваш Time to Market чем быстрее команда девелопед Тем вы более конкурентоспособны это в общем прям супер история и мы всегда это маркетинг никогда разработчик быстро пишет код это когда его быстро прибью или он быстро оказался на продакшене Вы его запустили и померяли по одной метрикам здесь мы очень сильно в это инвестировали у нас например сейчас доступен раз полчаса напомню что ВКонтакте написан на PHP но работаем на kphp это некоторые компилятор PHP нарник и мы его используем только мы его открыли его Pen Source уже многие компании попробовали наш язык с точки зрения того что он работает наш компилятор того что он работает быстрее быстрее работать десятки раз и он с одной стороны вам позволяет не писать продукт на c++ и на самом деле писать на высоких уровнях Но с другой стороны быстро работать но Мы помним про тайм тумаркет что мы хотим очень быстро разрабатывать наши продукты ВКонтакте это там миллионы строк кода и у нас есть уникальное решение для распределенной сборки которая нам позволяет буквально за пару минут собрать весь ВКонтакте и выложить его на пруд и все это нам позволяет например делать диплои раз 30 минут это значит что вы вчера пришли работать ВКонтакте прошли он бортинг сегодня вы начали писать код вы поняли что хотите направить на продакшн вы через полчаса уже оказывается против запускаете об эксперимент завтра утром вы знаете вообще полезная или не очень а мы постоянно развиваем наш язык в целом Если вы используете PHP может быть вам стоит перейти на кирпич пи есть на самом деле много статей Как успешно Как это сделано поэтому вам стоит сходить и про то как мы добавляли модульность наверное самое важное еще про рекомендации все помнят там супер тренд в маккенди консалтинговых компаниях про внедрение рекомендации знаете НПС есть такая Метрика счастье пользователи вот ваши пользователи используют ваш сервис и говорит Окей мне он нравится стоит оценку от 1 до 10 известно что пользователи которые вас хейтят которые стали ушли там психанули еще что-то их гораздо больше они вам поставят более плохую оценку поэтому PS рассчитывается как все пользователи которые посредством с одного до шести минус то оценку с 9 до 10 на самом деле все продуктологи используют эту метку Вот Мы заметили корреляцию таймс пента НПС И рекомендации Чем больше мы растили рекомендации чем классно мы делали наши предметный сервис нас родственники Как проверить вообще пользу от ваших рекомендаций Возьмите Верните Рандом в ответе в обратную историю если ваш Рандом показывает что при этом nps timespent-аудитории падает ваша рекомендации полезны Если нет то у вас не дата сентисты а дата сатанисты которые придумывают что-то хорошо цели по блокам Я немножко рассказал что у нас перформансы оптимизация действительно на первом месте рассказал про отказы устойчивость про метрики не расскажу вам про eml потому что мы очень много классных решений делаем Это наши так сказать секретный соус и про наши технологии работа с рисками потому что там очень много чего неизвестного и того что мы не хотим вам распространять Ну а сегодня наши результаты мы продолжаем стабильно расти год году и внедрение нашей технологической стратегии нас ускорила в этих направлениях но наверное главный ответ на вопрос что делать технический директор формирую техническую стратегию экзотически если говорить крупному посмотрели что тех стратегий это пункты за вбей вам нужно обязательно измерить мы посмотрели на основные причины провалов нельзя мыслить индукционно поставить критерии закрытия проекта Вы очень долго что-то внедряете делать и поняли что нет не произошло и за основу вам вы можете изменять стратегию ВКонтакте по крайней мере первую половину поэтому Посмотрите на стратегию компании если у вас нет предложите ее внедрить Попробуйте ее построить обсудить куда вы двигаетесь поищите противоречие Если у вас есть реально противоречие вы его нашли У вас есть шанс его креативно решить как минимум получить патент с точки зрения патентов вообще классно вы решаете противоречие 100 способов решения противоречий десятки тысяч патентов и если вам вообще всё лень делать вообще лень то все рассказано Может вам помочь ответить на вопрос А почему к вам приходит говорит Давайте поможем в этом проекте нужно всё бросить вы понимаете Почему те или иные технические решения принимаются в команде Ну наверное дисплеймер самое главное что результат внедрения вообще тех стратегий ваш проект они зависят от профиля рынка времени вообще клиентов конкурентов всего остального Все рассказано выше его применение в продакшене на ваш страх и риск Чтобы построить стратегию вам может потребоваться пользоваться помощь консультантов поэтому Большое спасибо Будем ВКонтакте если хотите со мной подружиться У вас есть такая возможность переходить ко мне Ну и фидбэк не забудьте оставляйте Если вам понравилось или не понравилось nps Мы про него помним обязательно его измерим Лёша Я занял всё время Но не все время мира хорошо у нас еще есть чем поработаем может быть не так страшно как вы под заняли рынок но во всем остальном Всем удачи Спасибо Александр тобольд памятные призы от конференции и мы продолжаем друзья спасибо спасибо я на самом деле будут доступен через час на стенде Можно прийти задать вопросы друзья утро Первый день хорошо всегда такое Саш спасибо А мы немножко задерживаемся но мы это время гоним дальше будем идти по программе сейчас на экранах те кто будем говорить как не грохнуть Аппе сервер кубера и через 10 минут на этой сцене спикеры за 1С программа продолжается следите за ней Хорошего дня друзья Всем привет Мы на конференции хайлот с вами Григорий дебриэл в компании euron и Дмитрий из сбермаркета Дмитрий Расскажи пожалуйста немножко о себе где работаешь Чем занимаетесь вот это вот вся история Да Всем привет Я Дима Крапивин Я работаю в компании сбермаркет это самые крупные в России по доставке продуктов Я думаю все уже сталкивались с этим Вот я этим летом команды инфраструктуры живем Мы в облаках и в основном используем cubernet для кручения наших сервисов это сервисы как клиентские в которых клиенты непосредственно делают заказы это мобилка это веб- часть и там все бэкенды части для сборщиков доставщиков и а для всего персонала которого у нас тоже довольно много как и наших клиентов Вот и сегодня я бы хотел рассказать немного о том как мы боремся с высокими нагрузками как мы боремся со сбором метрик с наших приложений и Поговорим немного об этом кубы Это самый девапс который не человека а практика смотри нагрузки в кубах Там могут быть очень разные нагрузки это могут быть русские на приложении это могут быть нагрузки на хранилище ходят слухи что кого-то даже нагрузки на теплой случаются Вот Но мы сегодня хотим поговорить про нагрузки на систему сборы метрик потому что это необычно Ну система сбора Метрика это что-то там сбоку приклеена прометеос графану посмотреть Казалось бы Откуда Там могут быть нагрузки откуда-то могут быть нагрузки а могут быть когда у тебя огромное количество приложений которые запущены в кубе когда у тебя огромное количество нот которые в этом же самом cubernetics запущены так как с каждой нотой с каждого приложения мы собираем огромное количество метрик в моменте цифры доходят примерно до 40 миллионов мы собираем этих метрик Вот соответственно это крайне негативно сказывается как на пещерле самого так и на прометее которые уже стал скажем так отраслевым стандартом для мониторинга самого cubernetis и для мониторинга которые приложений которые там запущены собственно начиналось все с малого но разрасталась разрасталась в какой-то момент мы дошли до того что у нас стало 128 в конфигурации там половина примерно 48 CPU 250 раунд половина 96 CPU 596 У нас сейчас в одном из наших кластеров которых у нас 10 но самый жирный кластер у нас это порядка 10 тысяч кодов 1000 неймспейсов примерно 3000 дипломатов Ну и как я уже говорил выше 128 нот вот под такое количество меток сам Прометей потребляет порядка 300 ГБ оперативной памяти и порядка 50 CPU При этом когда у тебя такое количество на импспейсов такое количество кодов Что делает Прометей он через cubernet конфиг опрашивает а фишку чтобы получить актуальный поинты для сбора метрик вот хоть у оси сервера есть и кэширование и другие различные хищении чтобы с него снять нагрузку но это не особо помогает когда у тебя такой огромное количество кодов особенно всё начинает лагать когда идут какие-то диплои то есть самые крупные наши они могут скелиться до порядка 300 подходов когда у тебя идет передиплоид 300 подходов одновременно Это утилизирует ресурсы IP сервера в два-три раза больше чем спокойном состоянии соответственно мы ловили очень много инцидентов связанных с тем что мы просто душили один описервер в одной зоне доступности так как он падал мы переключались на другую зону Он падал следом и так мы теряли последовательно той зоны по сути получали распределенный отказ а здесь поначалу мы боролись с этим путем того что у нас было вертикальное масштабирование в итоге мы дошли до самой максимальной конфигурации которую можем себе позволить это опять же 96 CPU и 596 грамм но это тоже оказалось не совсем скажем так панацеей дальше надо было коллегироваться горизонтально мы пошли немного другим путем в губернатисе двадцатой версии появился механизм паевой фермерс который позволяет распределять запросы к описанию по различным категориям и выделять квот на эти категории соответственно мы как только этот механизм появился мы его очень ждали и сразу же начали соответственно использовать то есть мы выделили отдельно критически важные запросы такие например как вопросы от администраторов самого кластера это запросы как раз таки от системы мониторинга и там самыми низкая приоритетными являются запросы от аккаунтов разработчиков которые хотят что-то посмотреть как их приложение работает то есть мы пытались с помощью этого механизма соблюсти баланс между тем чтобы никто не ловил отказы Никого мы не ставили в очередь чтобы никому не пришлось слишком долго ждать чтобы никто не получал ошибки но в то же время чтобы описать чувствовал себя хорошо и критически важные компоненты соответственно запускались вовремя и нам приходилось ждать появление меток например там до 5 минут как это случалось раньше мы провели тестирование и на всех наших кластерах это дело настроили но это тоже время не решает нашу проблему сбора самих метрик потому что В общем в какой-то момент просто метаки у нас растут в геометрической прогрессии у нас появляется Каждый день новые приложения которые из коробки уже поддерживают огромное количество меток соответственно мы просто упремся в какой-то момент что мы просто не сможем справляться с таким потоком потому что у нас не будет машинки нужного размера Ты наверняка помнишь этот комикс где огромный даже борт и один человек показывает другому что смотреть у нас такие такие метрики А что это у вас маленькая в углу где график вниз идёт Ну это Метрика того насколько хорошо мы понимаем все эти метки А прежде чем мы немножко поговорим про ваши планы на будущее Скажи вот когда ты упомянул 40 миллионов метрик это секунду в минуту в час в день Это 40 млн метрик - это в моменте то есть мы скрепим в основном каждые 15 секунд Вот и в моменте получаем такое количество метрик некоторые не особо критичной метрики мы можем скрепить там каждые 5 секунд каждую секунду вот здесь точных цифр нет Какое количество этих меток но тем не менее как бы Прометей все это держит в памяти говорю в микрофон последние два часа вот Собственно как мы решили с этим бороться в то же время на рынке появилось довольно много ошейник которые предоставляют распределенных хранения метрик которые позволяют строить отказы устойчивый кластер Да кстати забыл упомянуть что Прометей К сожалению он не отказывая устойчивый То есть у него нет никакой схемы соответственно если у нас например запустилась нода под прометеем то есть запускается сам Прометей то При таком количестве меток его Старт занимает порядка 20-25 минут 25 минут ты просто сидишь без мониторинга и приятно и не знаю что у тебя происходит в этот момент произойти может все что угодно соответственно мы пошли в сторону решений которые начали появляться на рынке это cortex это Танос и Виктория метрикс проводили сравнительный анализ и больше всего Нам понравилось Виктория метрикс с ней скажем так познакомились наверное года три назад но в полную силу начали использовать примерно месяцев 8 и как впечатление впечатление прекрасные замечательный продукт мы смогли расставить во-первых распределенного ставить агентов во всех зонах доступности соответственно даже если у нас отваливается целиком зона там остальные зоны мы получаем по ним метрике мы сейчас находимся еще в переходном процессе То есть у нас есть и Прометей и Виктория метриксы они работают параллель друг другу Так как наши пас диплои завязаны в том числе на пивку Прометея мы не можем с нее так просто соскочить и над этим сейчас активно работаем вот но то есть мы получили отказы устойчивую схему и у нас есть сразу из коробки аппликация во все зоны доступности То есть даже если мы теряем целиком зона у нас остаются исторические данные в прометее мы раньше могли хранить метрики максимум 60-90 дней в зависимости от нагруженности кластера сейчас мы храним метрики три года и планируем увеличить этот срок до 10 лет вот по ресурсам там все крайне экономично с таким объемом метрик и например с фактором аппликации 2 а у нас появляются всего лишь триноды каждая из которых там по 10 цпу и примерно 150 ГБ памяти Слушай ну вот сетап про который ты рассказал это такой золотой стандарт как сейчас смотреть заметками бизнес и А я думаю гость конференции с удовольствием обсудит это с тобой а на стенде а Напоминаю что мы оба прямо сейчас на той же конференции что и Вы на стенде в супермаркета на стенде и еврооон так что Приходите к нам чтобы поговорить о том что сейчас происходит в it Ну что мы Прощаемся с вами из прошлого и встречаемся настоящим друзьям и продолжаем продолжаем работать в зале один все кто стоял и не стеснялся зайти заходите Вот можете на входе поцеловать голодного это очень ценно очень смотрите он с микрофоном это значит что он свой зал Уже открыл и пришел сюда обниматься Вот это прям прекрасно Друзья всем кто смотрит нас онлайн привет напоминаю что сегодня мы задаем вопросы спикером через чатик через чат-бота подключитесь заходите и задавайте вопрос а мы этот вопрос мы ваши вопросы будем транслировать продолжаем друзья и я на эту сцену приглашаю человека который в разработке больше 30 лет а кому меньше тридцатника Магните рукой Вот это всегда очень приятно всю твою жизнь человек строит строит большие системы для бизнеса Чтобы бизнес чувствовал себя хорошо а Итак друзья под Ваши аплодисменты Сергей Нуралиев Всем привет Так мне уже сказали не стоять у края чтобы не упасть а Тема сегодня hellout и лоукод единственная борьба противоположностей главное мысль которую хотел донести сегодня это то что вы можете использовать подход лоукод в ваших проектах здесь важно понимать что мы будем сегодня говорить про подход лоукод а не про какой-то какие-то готовые технологии наши технологии чью-то еще то есть как вы можете использовать и создавать свой Лог от подход А зачем вообще нужен подход прежде всего конечно повысить скорость создания приложения конечно снизить стоимость создания приложений понизить сложность владения я здесь не оговорился именно сложность владения а не стоимость владения потому что сложность она дает много плохих эффектов не только большой стоимость и защита от проблем при смене команды разработчиков это может быть это очень важно для бизнеса быть защищенными от того что в какой-то момент часть команды меняется нужно брать новых нужно привлечь новых и так далее вот подход существенно снижает по освобождение в уже существующий проект для новых членов команды а Многие считают что хэйлоуит и лоукод это вообще разные вселенные они где-то находятся там в параллельных или перпендикулярных вселенных я постараюсь своем докладе сказать что во-первых это не так во-вторых когда это не так И главное зачем это не так какой в этом смысл чтобы это было не так а опять же Многие думают что лоукод это в основном про такие маленькие полезные приложения что-то типа перехода с экселя что-то для прототипирования что-то для небольших каких-то уровня проектов приложении и Да это есть это сейчас очень модная тема про этого наверняка читали много статей это замечательное направление очень хорошее интересное полезное но существует и другой лоукод существует в кавычках скажем большой уход и это для крупных проектов и для облаков И на самом деле такого кода в мире немного он есть у нас в наших продуктах он есть и в других продуктах например он более менее развит в некоторых erp системах смысле развит в некоторых герпес системах в некоторых сильно в некоторых менее сильно CRM системах есть еще в геймдиве в cms системах но пока почему-то не везде а когда подход вообще нужен это уже вот как бы к вам адресовано Когда стоит вообще как нам кажется Обратите внимание код подход ваших проектах во-первых когда много прикладной функциональности то есть никаких рачительных технологических задач они тоже есть но у вас еще есть много прикладного кода когда допустим много форм много бизнес логики и много разработчиков которые делают При этом они должны использовать более-менее однотипные технологические подходы и создавать вот эту разнообразное бизнес желательно быстро желательно надежно и так далее И главное когда вы хотите получить от лоукода подход те бонусы Те бенефиты про которые я только что говорил тогда Посмотрите в сторону лоукода Как совместить лоукод и хэйлоут вот собственно У нас есть такой опыт и мы постараемся сейчас про него рассказать постараюсь поделиться им а немного нас совсем нет чуть-чуть Значит кто не знает платформы 1С предприятие То на чем написано все продукты предприятия это лоукод платформа для быстрой разработки бизнес-приложений от самых маленьких до самых больших и важно что она включает все буквально все что нужно прикладному разработчику для того чтобы создать бизнес-приложение То есть это такой большой фреймворк причем весь комплексный все интегрировано который все дает необходимые возможности для создания бизнес-приложений а как шли к хайловоду клиенты хотели от нас больше то есть мы делали продукты для малого рынка для среднего рынка они успешно использовались но клиентам нравился наш подход нравилось вот эти бонусы которые дают лоукод но клиент росли естественный процесс нашим технологиям нужно было расти вместе с ними и с другой стороны крупные клиенты стали понемножку использовать тоже наши технологии сначала для каких-то второстепенных задач потом они сказали Ну давайте мои большие задачи свои тоже перенесем на вот эту платформу и поэтому как бы сам рынок наш тянул туда нам нужно было соответствовать здесь образно Я примерно показываю рост нагрузки То есть если когда-то когда Мы начинали восьмую версию продавать нас было там проекты там по 80 пользователей то сейчас у нас там допустим до 10 тысяч канкарен сиюзерсы в онлайне Это для oltp задач это очень много если кто-то вот допустим не брать интернет сервиса именно OTP задача это очень много собственно дальше мы постоянно получали рост требований по масштабированности И сейчас мы уже по сути говорим о самых крупных компаниях в нашей стране которые используют 1С или сейчас вот хотят использовать 1С и поэтому тоже ставят свои можно сказать условия требования пожелания формулировать можно по-разному и по сути нам Нужна постоянная последовательная борьба за хайлоу это не то что взяли сели сделали все у нас highland это постоянная огромная работа а И мы поставили себе амбициозную цель достичь хайлоу не отходя от лоукод лоукод нам Нельзя терять не мы решили что нам Нельзя терять локоть ни при каких обстоятельствах потому что это основная ценность которую мы даем в своих технологиях разработчикам и пользователям приложении то есть возможность быстро разработки возможность быстро адаптации и так далее и поэтому нам нужно было это как бы совмещать А у вас ваших проектах может быть обратная ситуация что у вас есть уже такой крутой холод но вы можете привнести в него код а нам часто говорили говорят И говорили ну вообще вам лучше разделить вот Зря вы делаете одну технологию для маленьких и для больших вы сделаете две одну хорошую для маленьких одну хорошую для больших очень такое как это простое решение совет смысле простой но мы подумали и так не сделали и я считаю что мы правильно Так не сделали на то есть много объяснений И кстати есть естественно Вы хорошо знаете продукты других уважаемых компаний в мире которые тоже делают одно одну технологию которая масштабируется от мобильных телефонов персональных компьютеров до огромных корпоративных задач например в области баз данных есть такие примеры И хорошо что мы это не сделали и Например одно из следствие чем это было хорошо то что когда у нас возникла потребность наша для наших маленьких пользователей сделать масштабирование облако мы использовали наши технологии тоже helload и смогли построить облако Вот потому что по сути в Облаке тоже хайлоу после Да там может самое предприятие в Облаке небольшие Но их очень много а надо понимать что идеал не всегда достижим то есть не все задачи helload можно решить совсем без усложнения разработки иногда не получается вот это сделать потому что нельзя скрыть природу вещей Я потом покажу это на примере но важно что нужно в любом случае стараться сделать нужно как не сдаваться до последнего Если Вы выбрали в какой-то области своего проекта парадигму лоукод вам нужно придерживаться ее стараться всегда ее сохранить а приведу несколько примеров о том как мы собственно боролись за хайлоут вот с сохранением А где-то и приумножением лоукод сначала такая самая распространенная задача колод это балансировка нагрузки тут важный момент что в бизнес-приложениях ltp приложениях в отличие от существенной части других приложений очень разнородная нагрузка по объему вызов от вызова отличается не просто в разы А на порядок и даже на порядки если например сравнить Там просто получение какой-то суммы на форму и допустим Расчет расчет производства вертолета это 180 тысяч примерно детали а соответственно нагрузка идет разная на CPU и на ё и на dbms на дисковую систему и вот в нашем случае нужно было строить систему которая бы учитывала этот важный Аспект и при этом сохраняла парадигму лоукод вообще одну тайну маленькую скажу никому пожалуйста не говорите мне это одна из любимых задач на собеседования когда мы собеседуем разработчиков и Архитекторов то я говорю прошу Просто вот спроектируйте пожалуйста балансировщик нагрузки вот так вот просто в ходе разговора Обычно начинают Рандом или раунд Робин вот бизнес приложениях это не работает по описанной причине а потом обычно предлагают разметить запросы ввести веса запросов тяжелые запросы легкие запросы это учитывать опять же для каких-то когда человек так называет это нормально это хорошая идея Наверное мы не пробовали но в каких-то может приложениях это работает Вот таких приложениях как которые мы делаем бизнес-приложениях Это не работает Не работает Если это совмещать с парадигмой лоукод принцип это может работать но если совмещать слоу-код это не работает потому что мы не можем прикладному разработчику который делает решает задачи бизнеса говорить а ты еще давай пометить свои запросы вот это вот тяжелый это очень тяжелый это уже никакой не лоукод соответственно нам нужно было построить такую машину которая бы автоматически смотрела на загрузку серверов по разным параметрам как там у них делала какие-то тестовые запросы к ним мерила какие-то метрики и балансировал нагрузку автоматически чтобы не нагружать с одной стороны чтобы это работало с другой не нагружать разработчиками а следующее отказоустойчивость например понятно что много задач делается для откозоустойчивости например автоматически перезапуск рабочих процессов то есть здесь Как говорится быстро поднято не считается упавшим если что-то пошло не так с оборудованием с инфраструктурой или даже самим кодом нужно сделать так чтобы пользователь вообще ничего не заметили там что-то перезапускается но это классическая задача важно с точки зрения лоукода что мы таким образом не только защищаемся от каких-то проблем с железом инфраструктурой но и мы разработчика приложения где-то защищаем от его ошибок недоработок и так далее И это хорошо потому что он может уже там спокойном режиме понять почему у него там какие-то проблемы происходят что-то улучшить оптимизировать и так далее вот а пользователи при этом ничего не замечают а управляемая блокировки здесь речь идет транзакционные блокировки Сначала мы использовали механизмы предоставляемые базами данных и довольно быстро разочаровались в этом потому что они для нас работают Плохо они у них там свои соображения они работают хорошо на относительно маленьких задачах на больших проектах они работают для нас работают плохо для наших для нашего профиля задача скорее особое безобразие это эскалация когда база данных Сама решает что я пошла не тем планам запроса выполнять и заблокирую всю таблицу а мы сделали свое решение свой механизм а потом мы его переделали потому что первая реализация была тоже У нас ограничена мы там учли опыт и его еще раз переделали собственно наш механизм это Halo Service кластера который определяет пересечение помещение ожидания отслеживать детлоки отстреливает те кто попал там влог допустим важно его Аспект что его задача сделать параллельность Везде где это можно Кроме тех случаев когда это с логической точки зрения неправильно то есть задача бизнес-логики которые наоборот требует блокировок Когда нужно чтобы например допустим когда там два продавца продают один и тот же товар чтобы они случайно не продали больше чем есть на складе нужно действительно ровно по этому товару ровно поэтому складу на время транзакции на короткое время заблокировать и вот здесь мы Передаем разработчику приложения инструмент который тоже сделан в модели лоукод там все просто нужно просто указать что ты хочешь логически заблокировать никаких технологических деталей но он должен сказать что он хочет заблокировать и вот здесь как раз тот пример про который говорил когда мы не можем скрыть Вот эту подробность потому что ему разработчика это нужно понимать если он этого не понимает он не может хорошо сделать вот здесь действительно где-то приходится ту часть которая вот семантически важна выносить на уровень прикладного разработчика Но желательно тоже в модели лоукод следующий пример тогда такселератор у заказчиков растут потребности в аналитике нужно обрабатывать миллионы записей за долю секунды хочется все это делать живьем быстро переключать разные там отборы фильтры и так далее мы сделали свою базу данных называется дата акселератор внутреннее название fimo db fasting Memory Access база данных а ее отличие от других решений в том что она очень реляционная она поддерживает такой мощный диалект из quel и по сути она по диалекту совпадает с в нужном нам объеме с классическими базами данных Так что разработчику приложений не нужно ни в коем образом переписывать свои запросы учитывать особенности этой базы данных то есть здесь даже не лук вот а зеркало потому что мы никаких усилий от разработчика не требуем просто подсовываем автоматически администратор включает акселератор у него запросы начинают работать быстрее а это вот пример когда можно оптимизировать систему не трогая приложения следующий механизм копии баз данных он призван распараллельно читающую нагрузку то есть ну у нас рабочие сервера которые собственно обрабатывают данные масштабируются горизонтально вот база данных до этого момента была некоторым узким местом и собственно этот механизм позволяет автоматически читающую нагрузку распараллелить на какое-то количество зеркал базы данных причем они могут быть выборочные то есть не все данные лежать там можно как-то там управлять тоже это делается в парадигме лоукод потому что опять же мы ничего не требуем от разработчика приложения то есть администратор включает настраивает и опять же какие-то запросы автоматически уходят в другие инстансы базы данных это может быть и наш дата акселератора могут быть классически промышленные сбд здесь у нас пока еще идет борьба за скорость заливки довольно сложная задача оказалась Как быстро переливать огромные объемы когда стартует копия еще как быстро доливать при больших изменениях например пересчитываются какие-то сотни тысяч записей и нужно их тоже туда переливать Но мы уже сделали два подхода к оптимизации еще будем заниматься этим вопросом она уже приемлемо работает но клиенты хотят еще быстрее Ну чуть-чуть разбавлю текст Примерно вот так вот выглядят у нас это вот конструкция то здесь наш кластер серверов базы данных механизм копии дата акселераторы другие sbd и так далее а у нас еще есть много механизмов Я про всех рассказывать не буду они тоже вот делались для того чтобы обеспечить Halo с учетом лоукод или лоукод с учетом холод чуть-чуть может быть остановлюсь на механизме фоновых заданий и регламентных заданий почему он интересен предполагает все-таки относительно простую быструю надежную разработку одной хорошо знаете разработчики которые хорошо владеют многопоточные разработкой они Ну круче с точки именно системной разработчики прикладные разработчики должны концентрироваться на вопросах бизнеса Вот и мы хотели не с одной стороны нужно было обеспечить параллельную работу приложением какими-то задачами распараллеливания вычислений с другой стороны не перегружать систему значит тонкостями многопоточной работы вот собственно наш механизм задания Он позволяет сделать это в более лоу код парадигмы более простыми и надежными способами в том числе позволяет распределять вычисления между разными машинами а это вот я показал несколько примеров которые показывают как мы собственно боролись за хайлоут в нашей Лок от платформе теперь я просто вот таким общими словами дам рекомендации вот если вы будете строить какие-то свои лоукод механизмы в своих проектах то есть на что стоит обратить внимание по нашему опыту естественно прежде всего нужно думать о высокоуровне модели то есть нужно построить некоторые слои абстракции это может быть абстракция для работы с данными абстракция для работы с польскими интерфейсами для работы с правами не обязательно все сразу покрывать моделью но очень важно иметь высокоуровне абстракцию это потом многое дает а дальше важно понять что здесь лоукод это не то что может быть вы читали в статьях про программирование мышкой то есть здесь важно что лоукод это именно повышение уровня абстракции это оно может быть выражено и в каких-то dsl-ах и где-то может редактироваться через графическую аннотацию где-то может быть через опять же там текстовый режим но в декларативной модели где-то это может быть даже императивный код но в более простой парадигме в более простых и Вот это здесь понимается под лоукодом и это помогает реализовать ddd которая кажется очень привлекательным И это собственно обеспечивает семантику предметной области Когда вы часть кода сложного помещаете в какие-то абстракции которые соответствуют семантике вашей предметной области а Итак если мы делаем свой Лог от слой есть плохая новость плохая новость в том что если вы его хорошо сделали то вы для тех кто разрабатывает конкретные решения часть приемов оптимизации которые приняты в системной разработке вы убираете потому что они перестают работать есть хорошая новость Вы можете оптимизировать сам движок не трогая приложение сами приложение будут ускоряться за счет оптимизации того слоя абстракции который вы реализации того слова абстракции которые вы сделали и если скажем эффект хороший новости вас превышает этот плохой новости вы получаете собственно Профит а следующий совет Если вы построили какой-то свой слой абстракции то не ковыряйте дырочек а к вам будут приходить люди говорить Пожалуйста сделайте вот нам здесь дырочку здесь дырочку что принимается под дырочку это какой-то способ обойти какой-то контракт обойти слово абстракции куда-то там влезть и так далее очень большая рекомендация не ведитесь на уговоры потом может случиться плохое Например если у вас есть абстракция работы с данными далее кому-то там где-то понемножку проходить мимо этого слоя абстракции потом у вас будут проблемы с тем что это не поддерживается в ваших новых версиях это не работает с какими-то вашими оптимизациями потом это просто не работает Старайтесь все-таки удерживаться от этого а также Hello тоже бывают разные нужно учитывать профили нагрузки например в нашем случае у вас может быть другая картина есть два основных профиля нагрузки это корпоративное приложение когда большое предприятие много пользователей concarency высокая и облачная когда там еще больше пользователей но они работают в разных нодах с Мальте тенденции и так далее очень существенная часть механизмов обеспечиваешь холод очень похоже но все-таки профиль нагрузки разные требования разные Поэтому нужно учитывать и мы тоже у себя учитываем вот эти два профиля нагрузки опять же в вашем случае могут быть один профиль Может быть там два или три Ну надо учитывать что мы все-таки делаем систему которая работает как в облаках так и он примес то есть мы должны учитывать и эти две модели а следующий что лоу не только желательно не только код помимо простой разработки еще важно обеспечить простой администрирование причем включая развертывание сопровождение и так далее У нас нет красивого названия мы сами иногда это называем зеро-администрирование во многих примерах которые приводил Мы добивались не только простой разработки но и существенного снижения порога на администрирование Но это скажем наверное актуально для тех кто делает решение которое тиражируется в модели он премиус потому что если это ваше облако но там наверное вы сами как-то с вашим с вашими администраторами договоритесь Если вы поставляете технологию которые должны использовать другие люди простой администрирование супер важная вещь а безопасность безопасность сегодня многие говорили о том что это очень важно Тем и становится еще более важно закладывать в модель вопросы безопасности сразу тоже именно в модель low-code Если вы делаете слой лоукод потому что это защита не только от каких-то пользователей или они хороших пользователей это еще защита от разработчиков которые могут что-то где-то не так сделать И имея вот хороший слой абстракции можно больше защититься от каких-то ошибок и пробоев в безопасности не экономьте на инструментах это очевидный тезис долго не буду Нужно больше мониторинга больше логирования больше диагностики И последнее в этом в этих тезисах не упускайте бонус потому что ваш бонус Это не просто вот само локоть сделать но и постоянно оптимизировать систему за счет оптимизации того слоя который вы сделали то есть вы можете смотреть диагностировать и не меняя приложения заниматься его оптимизацией это очень дорогого стоит а Ну просто чтобы показать не то что мы там все сделали мы всегда находимся вот как бы в этой борьбе И у нас есть много чего что нам еще предстоит сделать что мы там не до конца сделали что еще нужно сделать просто приведу там примеры например очередь задания у нас есть довольно простая нам нужно бы сделать более сложную с балансировкой нагрузки пока это делается на прикладном уровне у нас а хочется сделать более системно скорость работы языка она у нас вполне приемлема для большинства подавляющее большинство задач потому что в нашем случае сам язык программирования он является только некоторым клеем то есть на нём не делаются сложные вычисления сложные вычисления уходят в саму технологию но тем не менее его там ускорить тоже может быть не лишнее а роллы Security - это защита данных на уровне записи у нас она есть Она работает её хочется сделать более э эффективной вот мы в нашей э Ну относительно новой технологии один из предприятий элемент уже включили новую модель Секьюрити Но вот тоже как одно из направлений развития буквально в конце чуть-чуть цифр у нас платформе более 16 миллионов строк кода в приложениях которые на ней написаны в крупных наиболее например 1С erp 12 миллионов строк и по нашей оценке если бы мы не используем код там было бы не 12 а 30 или 50 миллионов это естественно экспертная оценка никто не прыгнул из нас не пробовал написать такое без Лок от платформы количество пользователей в наших внедрениях достигает 150 тысяч и например 10 тысяч конкурентных в одном инстансе объемы данных это могут быть и десятки терабайт Например у нас есть проекты по 36 терабаев и всего разработчиков на вот этой платформе сейчас работает более 300 тысяч Ну просто чтобы чуть-чуть показать примеры например внедрение в почте России это 150 тысяч рабочих мест трансмашхолдинг Это ведущее предприятие по производству локомотивов и других железнодорожных другой железнодорожной техники государственная корпорация ростех 30 тысяч пользователей в онлайн 7000 пользователей 36 терабайт это я просто показал для примеров что реально вот это вот модель код может работать на очень серьезных корпоративных внедрениях с достаточно серьезным все Большое спасибо я все что заготовил рассказал вот если есть вопросы могу постараться ответить Сергей спасибо большое первый вопрос 30 лет назад вы поняли что нужно автоматизировать бизнес и начать Делать им вот цифровой инструмент Вот если бы сегодня вы с нуля начинали Вы бы в какой сферу бизнеса пошли в интернете Я думаю туда же куда пошел в смысле или не понял вопроса то есть чем бы я занимался 30 лет назад Чем вы занимались бы сейчас если бы сейчас был 30 лет назад Ну вот мне кажется что тем чем я занимался Я этому учился в институте это делал на работе и это интересно это полезно для людей полезно для общества как это у нас хорошая команда Я бы этим занимался Вы эффективно спасаете леса Карелии то что бумаги стало меньше нужно это надо продолжать вопрос Вы хотели задать Да друзья вопрос еще можно в чатик задать через Telegram Бота с хэштегом вопрос Да пожалуйста Добрый день спасибо за доклад интересный если позволите два вопроса во-первых вот эта база данных fimo она только на чтение И второй вопрос сбалансировщиком нагрузки с разным профилем Как же вы сделали все таки что информация о профиле нагрузке балансирочка не узнает информация о конкретной запрашиваемых ресурсах об объеме Так значит Да база данных которая мы показывали на сейчас только на чтение и в основном она используется для аналитических задач дальше будем смотреть развивать этот механизм дальше про Как работает балансировщик нагрузки там есть несколько технологий Ну например он пытается делать пробные запросы разного вида которые оценивают Как реагирует сервер чтобы как бы померить его текущую текущую способность выполнять запросы то есть мы как бы все время засовываем некоторые щуп в сервера и смотрим в каком они состоянии и на основании там разных алгоритмов которые уже анализируют результаты этих измерений мы соответственно перераспределяем нагрузку там Понятно учитываются всякие особенности что там с какого момента стоит перебрасывать сеанс на другой сервер если там понятно что при небольшой разнице нет смысла потому что уже там каши все подняты прогреты под конкретного там допустим пользователя его не стоит болтать туда-сюда там есть много особенностей основной мы пытаемся оценить именно на текущий момент что этот сервер способен никакого мощности вообще не сколько на нем сейчас запросов А вот именно что он сейчас может сделать вот Спасибо второй вопрос быстро Добрый день Сергей компания Vision У меня два вопроса тоже не более организационного толка первый вопрос такой вот вы рассказывали прошу in Memory базу данных про переливку данных между базами по идее это достаточно типовые задачи для них есть типовые и вполне интерпраздные решения для мемори там на ум приходит Тарантул для прививки данных там всякие Кафка стримы Кафка коннектор все прочее насколько подход Что вы делаете Все это сами свои решения экономические оправда и второй вопрос по поводу вообще лоукоут и платформенного такого подхода очевидно что если эта платформа от нее зависит огромное количество компонентов прикладных существуют большой риск сломать всех сразу Как вы этого избегаете Какие подходы к тестированию Какие подходы к контролю качества выпускаемого новых версий спасибо спасибо за вопрос кажется Когда вы начинали Все думали что Кафка это писатель наверное Так значит первый вопрос был про зачем мы делаем свою базу данных и зачем мы делаем свою машину переливки смотрите во-первых вот я пытался сказать может быть я быстро говорю что мы используем не только вот с точки зрения механизма копий Мы работаем Не только со своей базы данных но и с промышленным СПД Пожалуйста можете поставить там сервер позже и он тоже будет работать копией причем Даже Независимо например основная база данных Может быть там на по воскресе копия может быть акселератор или сервере Почему мы пишем свой номер движок тут ключевой момент в том что мы его оптимизируем под ту модель реляционных запросов которые принято в OTP приложениях и собственно в наших приложениях и нам нужно чтобы он мы не можем заставить во-первых такие приложения пишутся достаточно серьезным использованием возможности SQL часто и в нашем случае тоже то есть сложные запросы там джойн там вложенные запросы временные таблицы то есть ну это довольно частый подход для ltp приложения именно который управляет бизнесом в этом секторе такое серьезное использование SQL и вот мы делали вот так чтобы именно эти запросы хорошо работали но очень важно что они должны работать Вот точно так же как наши другие с БДС на самом деле вообще технологии которые работают с разными СПД их множество но очень мало технологий не буду говорить совсем нет но очень мало которые обеспечивают практически полную переносимость приложений не надо ничего в приложении менять можно просто перелезть на другое и так далее мы это поддерживаем по отношению к промышленным и нам нужно было Точно так же чтобы наши базы данных автоматически работала с нашими всеми запросами чтобы не было ничего переписывать Ну еще есть вопрос Zero администрирования то есть чтобы мы наших пользователей наших клиентов не хотим нагружать какими-то там сложными там вы поставьте Вот это поставьте Вот это поставьте вот эту Ну как в классическом подходе к разработке там будет там 10 разных сторожей каждый нужен администрировать диплоить и так далее вот мы здесь тоже об этом заботимся примерно такие аргументы естественно Если вы никогда не найдете однозначного ответа что правильно что неправильно мы можем объяснить почему мы идем в эту сторону зачем мы идем Какие аргументы считали важными конечно никто не может доказать что его там выбор правильный Тем более что редко же удается полностью пройти две дорожки а второй вопрос был по контроль качества Да ну смотрите понятно что контроль качества для таких задач это такая скажем очень масштабная работа которая не решается одним каким-то гениальным подходом это много-много разных решений То есть у нас есть там и такое тестирование такое нагрузочный функциональное естественно мы имеем некоторый скажем такой процесс постепенно вывода новых решений на рынок сначала там Тестируем сами потом внедряем себя у себя в компании потом у нас есть пилотные внедрения потом тестовые версии раскатка идет постепенно Кроме того У нас у нас есть хороший Как скажем хороший бонус У нас есть много приложений в которых миллионы строк кода и мы используем тесты этих приложений для того чтобы тестировать саму технологию автоматизированные то есть мы берем огромный объем тестов допустим европей системы фиксируем его и прогоняем на сборках технологии не поменялось главное конечно регрессии или там падение производительности Но это некоторые подходы есть и другие подходы но могу подробнее рассказать Нет это утверждение Да конечно конечно но если может еще вопросы есть вообще нет но для Вас всегда есть он после того что творит Тополь вообще можно как бы выступать полтора часа но можно подробнее конечно и есть еще вопрос один точно Давайте еще один вопрос Ну или тогда подробнее можно на стенде можно подойти спросить мы там все расскажем нас тут желтенький стенд есть пожалуйста Спасибо большое за доклад я правильно понимаю что это платформа для языка 1С А вот у вас же есть другие языки в компании вы используете других стеков собственно такой вопрос Спасибо сейчас я попробую смотрите вот у нас платформа она не для языка 1С она платформа является целостным фреймворком для разработки бизнес-приложений там в том числе есть свой язык но язык это одна из частей то есть там есть и машина работы с юаем машина работы с базой данных язык запросов и язык программирования Причем он одинаковый на сервере на клиенте веб-клиенте в мобильном клиенте там десятки фреймворков которые очень тесно интегрированы по сути образуют единый большой фреймвор язык программирования язык 1С это вот одна из его частей Понятно важная Но одна из а значит Java это ec++ Это технология которую мы сами используем для разработки этой технологии то есть мы на c++ на Джаве разрабатываем платформу на которую уже пишется приложение не знаю сейчас смог ответить Сергей у нас еще одна задача надо из троих молодых людей которые задали вопрос вызвать выбрать кому идет приз за лучший вопрос Ну давайте Вот первый который вопрос был первый Отлично вот махните барышня пожалуйста Сергей спасибо большое за рассказ Вам спасибо друзья все более глубокие вопросы да на стенде Сергей памятный приз от конференции кайлоу Спасибо большое друзья через несколько минут на сцене записанные тех ток с разработчиком мира платформ А мы с вами вернулись в тайминг и в 12-20 следующий доклад здесь следите за расписанием хорошего продолжения дня друзья 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений для быстрой разработки облачных десктопных и мобильных бизнес-приложений Всем привет Мы на Хэллоу 2022 Меня зовут Андрей Смирнов из Эксперт тех и подкастов фронтат Weekend И в гостях у меня Кирилл Вахрушев начальник отдела сопровождения в компании мир платформ Кирилл привет Всем привет Расскажи для начала вообще что задел сопровождение чем-то в компании занимаешься Чуть более подробно компания Я являюсь руководителем мы занимаемся сопровождением различного рода продуктов разработанных и предоставляем также свою экспертизу и в иных областях не всегда в технических в том числе бывает и в организационно Кирилл наверняка так как ты начальник сопровождения у тебя как бы в твоем как раз владении можно так сказать довольно большое количество лекций систем и наверняка у вас какая-то особая тактика потому как вы с ними работаете Как вы их переписываете нужно понимать кто мы и чем мы занимаемся мир платформ это критичная инфраструктура это сервисы высокая степенью отказа устойчивости высокой степенью доступности и здесь для нас наличие Legacy систем в Техническом плане устаревающих она для нас в принципе недопустимо и мы постоянно осознавая ответственность которую мы несем и осознавая то какую задачу мы решаем мы постоянно находимся в условиях такого постоянного технического факторинга чтобы не допустить саму вероятность появления устаревающих в Техническом отношении систем для нас важна та ценность которую поставляем А как вы понимаете что система Вот устарела что она устаревала устаревала и вот все ее точно надо рефакторить критериев на самом деле очень много их можно перечислять до бесконечности но на мой взгляд самый важный и критичный это когда имеющий технологическая платформа технологическая база системы она не позволяет привносить саму систему новую функциональность или иначе говоря доработки такой системы для добавления какой-то ценности они становятся для вас все дороже и дороже Вот это на мой взгляд один из самых важных стоит учитывать А что делать если все-таки вот нужно заносить изменения в такой систему здесь можно выделить скажем так несколько возможных вариантов то есть для начала определить С какой системы Мы работаем первый случай например это может быть система которая работает и привносит какую-то ценность но при этом всех все устраивает то есть на самом деле самой потребности в том чтобы менять такую систему ее может и быть да Старый кто-то может сказать что давайте поменяем если сама ценность удовлетворяет заданным условием если пользователи довольны лучшее что можно сделать с этой системой это оставить ее в покое либо ее время придет Либо сама ценность поставляет она потеряется вот а второй вариант работы с такими системами это пожалуй если количество пользователей в системе невелико или система не обладает какими-то такими жесткими ограничивающими механизмами которые необходимо соблюсти то есть этими механизмы можно вообще пренебречь тут можно смело писать новый продукт под замену смело разрабатывать продукт и просто двигается своими пользователями что пользователь мы меняем систему это у тебя была старая система Вот теперь пользуйся пожалуйста новой системой но это если можно договориться с нашими пользователями А вот когда уже можно приступить к разработке разработке прежде чем разработки нужно понимать на какую технологическую платформу Какие рельсы мы поставим наш измененный продукт но и даже прежде чем приступить к такому архитектурному исследованию Необходимо взять обязательства продуктового что изменения в текущий продукт носить вы не будете это нужно для того чтобы Вы могли сосредоточить свои ресурсы свое внимание на разработку нового продукта новой системой и не столкнуться с той ситуации что вы ведете два продукта и на выхлопе на выходе вы получаете два фактически одинаковые функционал продукта но при этом обязательно Это значительно большее количество ресурсов А как этот технологическую платформа вообще определить и снова привлекаете экспертов но при этом здесь важно понимать что лучшая враг хорошего а ваша задача как продуктовая это не проводить исследования технологических решений которые там сейчас в тренде на рынке здесь важно соблюсти помнить здесь важно помнить что для любого продукта важна прежде всего поставка ценности Чем быстрее вы сможете обеспечить поставку ценности на новые технологическом решении тем быстрее вы решите свою проблему избавитесь боли и здесь нужно при выборе технологической платформы необходимо оперировать теми вещами и знаниями которые вы знаете которая с которыми ваша команда разработки умеет работать либо на худой конец Вы можете привлечь какого каких-то внешних экспертов которые помогут вам максимально удобно максимально безболезненно как раз таки встать на ту технологическую платформу которая решит вашу проблему Окей с учетом того что ты сказал что решение вообще всех таких вещах принимают владельцы продукта как это все продается бизнесу то есть Каким образом бизнесу дать понять что вот эта система точно уже нужно менять на новую выступая в роли продуктов продуктового вы есть бизнес здесь У вас есть заказчик есть пользователь есть заказчик и ваша задача как раз таки инициируя такие изменения это заказчиком определить все возможные риски то есть опять-таки прийти к соглашению того что да мы в эту историю идем и мы принимаем вот такие решения А если вот если мы как раз говорим про заказчика Как продать это заказчику Если вы находитесь такой ситуации что ваш продукт имеет какое-то пространство для маневра то есть что-то там со слипом как-то можно дотащить и при этом сам заказчик не видит необходимости он может даже не понимать что это ваша задача такой связующее звено между заказчиком команды разработки это донести до ваши заказчиков понятно понятно им языке Что вы хотите сделать что вы имеете ввиду Соберите статистику о своем продукте Покажите вашим заказчикам Как ваш продукт работал там какой-то период назад Например год с тем количеством пользователей которые был в тот период и покажите как это работает сейчас с росла нагрузка можете показать на основе продуктовой истории опыта продукта можете показать Сколь дорого вам обходится каждая итерация при добавлении это новый функциональности доработках вашего продукта Сколько времени займет сам насколько ускориться после ставка ценностей Можете даже на самом деле попытаться заглянуть в будущее и показать заказчику на каком-то промежутке Когда ваша система за счет постоянного добавления нового наращивания самой системы она просто схлопнется под свалившейся на нее объемом здесь важно быть со своими заказчиками искренними как я ранее говорил это разговаривать с ними на понятном языке и в таком случае я более чем уверен что продуктовые со своими заказчиками достигнет компромиссного решения Кирилл Спасибо большое было очень интересно тема про Legacy всегда очень сложная болезненная для многих уверен многие возьмут очень много и своего рассказа мы все еще на highland 2022 С вами был Андрей Смирнов 5 тех и подкастов фронтен викенд с нами был Кирилл Вахрушев руководитель отдела сопровождения в компании мир платформ увидимся До новых встреч пока пока Андрей Смирнов из X5 это человек который всю жизнь занимался разработкой а последнее время становится потихонечку телезвездой и как стать телезвездой когда-то айтишник значит Ты соглашаешься на то что ты выходишь на сцену а потом Ты соглашаешься учиться новой маленькой профессии становиться ведущим разговаривать с людьми это очень не трудно потому что осмыслив матчасть потом просто начинаешь ее реализовывать А это гораздо легче чем писать красивый работоспособный код Друзья поехали дальше московское время почти 12-20 и я приглашаю на эту сцену нашего следующего спикера человек который уже отволновался свое на сцене а сейчас просто выступит готов Я да И тогда отсюда ребят Всем привет превращается во что-то невероятное А здесь знакомых лиц Мне кажется больше чем в офисе а можно попросить поднимите пожалуйста руки те кто на хайлоуиде впервые ого ого круто очень а теперь ребят небольшой усложнение Поднимите руки те кто когда-нибудь разрабатывал базы данных серьезно OK Хорошо тогда я расскажу о чем я буду рассказывать прежде всего мы поговорим о том где мы храним данные данные ВКонтакте с какими проблемами мы встречаемся расскажу несколько баек а потом расскажу может быть что-то еще прикольное что вам понравится Итак сразу хочу сказать что мне как бы доклад не нравился Я хочу понимать когда он закончится так вот будет небольшое интро и потом 6 глав Когда скажу что заметки для хозяйки считайте что мы финалим окей Тогда погнали да о себе Меня зовут Щербак ли я родился учился чему-то научился где-то работал сейчас я работаю ВКонтакте руководителем разработки баз данных и инфраструктуры Наверное это самое интересное обо мне а теперь о команде команда баз данных инфраструктуры что это такое но но мы любим сложные задачи мы любим проекты которые горят умеем их делать умеем и делать срок также с командой нам Иногда приходится чинить падение прода из бара когда вся команда находится в баре об этой истории тоже сегодня Расскажу чуть позже а вообще вот эти герои часть ребят находится в зале часть смотрят онлайн ребят очень круто работать с вами я на самом деле горжусь очень крутая команда Теперь давайте поговорим чем же мы занимаемся Саша добрый рассказывал про технический Вектор команды у нас кроме метрик как скорость разработки поддержка продукта утилизация ресурсов есть две главные фичи это отказоустойчивость и быстродействие на них мы фокусируемся Почему Но потому что ВКонтакте становится все более и более информационным и коммуникационным ресурсам поэтому мы не хотим чтобы пользователь видел 500 на своей странице быстродействие Да потому что это напрямую влияет на потребление контента насколько пользователь может посмотреть клипов может посмотреть видео может посмотреть полезное ему информации Итак чтобы поговорить о том как хранятся данные Давайте сначала рассмотрим общую архитектуру ВКонтакте выглядит она выглядит она примерно так же как любой интернет-магазин который продает Но что надо то и продает а фронтен сервера занимается терминацией htps трафика у нас это enginex кстати у нас есть отдельная команда команде инфраструктуры которая занимается разработкой Джинкс Почему так получилось в какой-то момент админы поняли что они хотят дополнительные функции и мы подумали а не купить ли enginex Plus посчитали количество серверов количество дополнительных лицензий и поняли что проще Как купить команду Игоря Сысоева и мы с Игорем так как поступить не могли даем вряд ли бы согласился поэтому мы начали разрабатывать сами и сейчас это выросло в команду cdn инфраструкцию Андрей привет которая занимается разработкой Quick протоколов разработка дополнительных модулей сейчас работаем над антидедосом на самом деле это не топик сегодняшних сегодняшнего разговора Но я не мог обойти этой стороной а что происходит Дальше http запрос идет на backend где срабатывает логика и происходит некоторая магия и мы забираем данные из наших баз данных вот наша база данных называются движки о них мы поговорим дальше Давайте сначала начнем с цифр всего движкам обращений 250 миллионов в секунду это я не посчитал внутреннее общение между движками Но потому что это сложно и сложно потому что у нас 720 кластеров кластер это отдельный стап какого-то движка для продуктовые задачи Окей сколько нас движков у нас 53 вида базы данных Но на самом деле это не обычные базы данных Их бы не было 53 Наверное это какая-то специализированная база данных которая решает определенную бизнес логику Окей какую часть мы рассматриваем мы рассматриваем ту синюю часть которая не серая Что делают движки Отвечая на этот вопрос самое правильно ответить что они хранят все данные пользователей То есть это фото аудио аудиосообщение сообщения комментарии лайки все подряд они хранят то чтобы вы не запустили на сайт также они занимаются контролем кэширующего слоя занимается распространением служебной информации есть движки которые занимаются тем что определяют сетевую модель и подсказывают пользователи Откуда лучше забрать некоторый трав что напрямую влияет на cdn и на раздачу трафика Окей сразу задается вопрос зачем разрабатываем движки есть технология XS технология Y есть технология K мы Соединяем и все Казалось бы работает прежде всего мы начинаем говорить про гомогенность эксплуатации что это такое для нас движки выглядят одинаково а для админа тем более движок сообщений не отличается от киеверия сторожа движок таргетной рекламы не отличается от движка лайков они все одинаково индексируются они все одинаково ведут они себя показывают и мониторят одинаково это супер важное устройство второе пожалуй конкурирующая с этим свойство Я считаю это экспертность в разработке когда все идет хорошо это скучно надо чтобы ушло плохо Обязательно все пойдет плохо А когда все идет плохо Мы не хотим терять данные пользователей Мы хотим быстро ответить на вопрос как подкастылить что убрать или Что добавить чтобы восстановить работоспособность как я уже говорил мы часто с командой занимаемся тем что восстанавливаем ВКонтакте от сбоев и прочее немаловажным фактором в плане быстродействия является знание о том как мы храним и какие храним и данные Это позволяет нам эффективно кэшировать эффективно хранить и эффективно запрашивать эти данные отдельным аспектом стоит отметить что у нас общая кодовая база можно сказать это фреймворк на котором строится все движки то есть улучшая сетевой слой вы улучшаете сетевой слой для всех движков Это довольно хорошее свойство Итак как выглядит типовой движок на самом деле он не отличим От любой базы данных У нас есть входящий запрос есть какой-то клуб который занимается его обработкой после срабатывания некоторых таймеров у нас попадает событие в бизнес логику бизнес логики если это овраят события мы записываем начинаем записывать Лог ивенты так называемые мы обновляем состояние мы обновляем состояние метафайлов которые совпадают снапшотом Что такое бинлок белок это классический writellock только он бесконечный То есть он существует сначала времен если других базовых данных он ротируется то у нас нет у нас он просто режется складывается где-то на бэкап и но мы можем тем не менее его проиграть чтобы Представлять что такое белок стоит обратиться к следующему слайду У нас есть табличка здесь есть операции здесь есть User и здесь есть value допустим это движок который хранит голоса и мы хотим знать сколько всего голосов у юзера мы можем каждый раз ходить и просчитывать общее количество смотреть Сколько было добавлено Сколько было отнято и потом вводить сумму но хранить Это довольно избыточно поэтому периодически мы делаем snapshot и мы делаем просто суммирование и получаем общее число значений голосов которое у нас есть и можем его потом забрать процесс это называется индексацией Окей с этим разобрались на самом деле я писал первый пункт Как выглядят движки они выглядят чуть сложнее там чуть больше функциональности и чуть сложнее логика Но базово это выглядит все так и этого хватает для нашего дальнейшего обсуждения особенности движков они у нас однопоточные и Это скорее Плюс То есть это структуры данных многопоточные они сильно проигрывают однопоточным поэтому мы стараемся делать таким образом чтобы у нас все шло шортировано по треду процессора все прибивается на тред и на нем работает мы умеем хорошо делать решат поэтому Для нас это не страшно далее да здесь стоит отметить что оно со звездочкой Почему Потому что когда нам нужно сделать какую-то сложную операцию распараллелить мы это естественно все Делаем дальше расскажу Каким образом также мы можем асинхронно записывать на диске делать разные штуки Но логика именно прокручивается точно данные и бизнес логика находится рядом это очень важно поэтому они называются движки нам не нужно никуда ходить чтобы понять кто есть в чате нам не нужно никуда ходить Чтобы понять какая Какая логика будет дальше у этого события дальше стоит отметить что особенности социальной сети в том что чтение больше чем записей люди больше просматривают И это экстраполируется также на движке индексируется У нас все в отдельном потоке то есть делается Fork мы опираемся на копию on Write и дальше пошел у нас индекс и мы параллельно читаем и пишем запросы здесь все отлично также стоит отметить что у нас данные все персистентные но они в основном Почему Да потому что юзер в основном просматривают свежие данные никто не будет смотреть старые фотки никто не будет смотреть старые посты поэтому все скорее находится в памяти и здесь играет роль то что я ссылался на знание о том как у нас хранятся данные охраняться они специфично для каждого кейса поэтому можем за кэшировать наиболее эффективно и зафиксировать даже именно изменения которые Нас интересуют ещё один момент движков в том что скорость важнее консистентности что это значит но консистентность на чтения у нас все реплики асинхронные они отстающие неважно если пользователь поставил лайк не так важно если другой пользователь его увидеть чуть позже есть примитивы синхронизации такие как барьеры которые позволяют сделать так чтобы мы все-таки получили этот синхронный момент Но это сразу будет замедлять бэкен замедлять нашу систему что нам не интересно OK с движками разобрались следующим компонентом у нас является rpc Proxy что это такое Дело в том что backend как бы кэнд общается с движками он с ними не общается вообще Он общается через rpc Proxy которая выполняет функции по сути маршрутизатора Да прокси знает о топологии связи она знает о таргетах она знает шардировании она стоит локально к бэкенду и занимает всего один хоп для того чтобы быть Достучаться до движка к примеру если меняется топология меняется топология прокси если меняется шергирование меняется шодирование прокси но про это ничего не знает только про актер Окей в чем здесь проблема Проблема в том что каждый ходит в каждого и у нас все бэкэнды неотличимы что это значит Значит что если начинает тупить один кластер то у нас начинают тупить все бэкенды почему но предположим время ответа кластера лайков было две миллисекунды потом он начал проседать у нас начали случаться тайм-ауты и начали случается они 200 миллисекунд Что это значит Это значит время работы воркеров бэкэнда также увеличилось поскольку оно у нас не бесконечно нам приходит предел и бэкенды просто все заняты engines начинает 500 пользователей получает 500 не могут пробиться каши охлаждаются сайт умирает мы все возвращаем начинается рестарт но пользователь не могут опять зайти почему Ну потому что каши холодные на холодных кашах мы не работаем Окей что с этим делать примерно происходит такая история когда мы взяли и залили все трафом И у нас все полилось надо это как-то контролировать Каким образом у нас возникла идея где-то год назад мы сидели с товарищем За обедом и обсуждали Квик И что там есть Flow Control и канзашим контролы и прочие штуки и возникла мысль А давай с транспортного уровня мы кондшем контроль поднимем на Application level Поднимите руки пожалуйста те кто знает что такое кондшн-контрол Ага не так чтобы много Окей это супер простая вещь Представьте трубу и туда идет вода Если вы будете подавать воду мало то соответственно вы эффективно используете трубу если будете подавать воды много вы затопите соседей и вероятно платите им ремонт что тоже не круто поэтому ваша задача лить столько сколько туда может пролиться в этом основана вся идея контроля и не переполнение буферов а что мы делаем мы внедрили на rpc прокси механизм когда если у нас сервер становится недоступен мы превентивно отвечаем дропам без ожидания тайм-аута То есть как это выглядит вот У нас есть User это запрос Q4 он пришел в модели conshen Controller для него есть место он отправляет запрос запрос помещается в очередь это очень перемещается в Network очередь и уходит дальше в движки приходит другой юзер и видит что очередь уже занята он делает sent А ему возвращается сразу дескарт в этом отличается базовая модель поведения то есть мы разделили модуль контроля на две части на кандишн-контроль и на сетевую сетевую занимается отправкой и так далее Контрол только контролирует окно Итак мы переходим к понятию окна а как выглядит диаграмма бкнд в данном случае клиент шлет запрос этот запрос транслируется с rpc Proxy на Engine Engine его processic и отправляет ответ вот время между тем как rpc прокси послала запрос и получил ответ называется дилея Мы берем этот дилей и смотрим насколько он соответствует Таргет дилею мы для каждого сервера можем для каждого кластера можем посчитать желаемой Таргет дилей и Смотреть насколько Если дилей меньше чем Таргет то мы окно соответственно сужаем если наоборот то окно будет расширяться базовая идея кондёршн-контроля Итак выглядит примерно так если очередь свободно мы пропускаем если очередь забита мы делаем discard Окей что еще мы получили благодаря контролю Мы также получили Application level баланс балансинг То есть это балансировка без знания разделяемого состояния мы на прокси можем оценить Какое у нас размер окна и в отстающую прокси реплику отправить запрос Итак что мы видим У нас есть одна реплика в которую забили запросы что мы делаем мы следующим движением Просто перекидываем их на другую реплику поскольку окно увеличилось мы это взяли информацию и постепенно все прокси это приняли и без разделения состояния о том что происходит они просто начали слать больше на вторую прокси и это равномерно все раскидывается Итак Каким был учили результаты при стопроцентной нагрузке CPU мы получили утилизацию и утилизация канала серверов мы получили процент отбитых пакетов и процент успешных пакетов но с нужной нам letones это очень важно при замедлении реплики Мы также получаем перекидывание с одной реплики отстающий на другую соответственно менее нагруженную как это выглядит на графиках если раньше мы видели вот эти пилы когда мы врубались в летнсе И она начала начинала просто скакать То сейчас мы видим довольно гладкую картинку то есть мы повышаем повышаем повышаем порог сервер уже перегружен но он выходит на пик и просто обслуживает то что может обслужить Окей с этим думаю Понятно А скажите пожалуйста а кто знает что такое мем кэш Поднимите руки пожалуйста Окей будем считать практически все но можно сделать вывод о том что мы написали свой мим кэш и научили его некоторым прикольным трюкам но например беатрический до умело выбираться из могил Им конечно же тоже умеет что мы сделали Мы туда накрутили жареную память и теперь при оме мы не получаем холодного старта минкаша холодный старт мелкаша возможен при нескольких случаях если произошла внутренняя ошибка если пришел ом Киллер если произошло что-то еще если пришел админ если произошел рестарт и так далее если память осталась консистентной на этого на целостность мы ее также проверяем то рестарт будет успешен файле как это выглядит мы написали небольшой локатор сразу скажу что здесь шарит Memory она не совсем шарит она эксклюзивно принадлежит одному процессу поэтому мы не получаем никаких Пенальти на производительность и как выглядит локатор это по сути слаб локатор где у нас есть таблица сайз классов и мы бинарным поиском ищем Какой нам класс подходит бинарный поиск Здесь нам не страшно потому что все в кш дальше у нас есть указатель указатель на Пейдж Как выглядит Пейдж Пейдж выглядит как префикс 512 бит это префик выглядит следующим образом это 512 бит которые забиты единичками есть специальная процессорная инструкция с помощью которой мы можем вычислять Какая единичка ближайшая и отдавать нужные офсет тем самым формируя смещение то есть мы узнаем page мы знаем офсет умеем вот туда адресоваться имеем уже туда записываться а дальше Пейдж может оставаться на другой Пейдж тем самым мы увеличиваем к оплате число этих пейджей у нас вычисляется при старте и основывается на статистике в итоге мы получили примерно такую картинку И что здесь важно здесь у каждого оставить класса есть свой лру то Здесь мы получаем фернанс по размеру если мы считаем что больших ключей должно быть много они будут вытесняться быстрее чем маленькие в стандартном что такого нет Итак общее правило что разделять хорошо и жаренная память нам здесь помогает или Старт Мы переживаем и это большой выигрыш я расскажу еще потом дальше почему это важно Окей что еще мы сделали мимикшом мы его научились реплицировать помните говорил про две задачи задача отказа устойчивости задача производительности так вот это решение которое отвечает обоим задачам мы умеем с одной стороны при падении дата-центра переключаться на другой на геты нас это конечно тоже вот что как это происходит разберем идею с гетами Мы берем для каждого rpc прокси и вычисляем ближайшее расстояние до минкаша статистики для каждого дата-центра после того как мы его вычислили мы начинаем туда ходить с большой очень вероятностью как только он выпадает мы начинаем ходить в другой мим кэш в другой этот центр с гэтом если понятно то как реализованы сеты с этой реализованы на механизме часов то есть мы когда Хотим засветить мы шлем везде И после этого вычисляем локально на нем каше Было ли Ключ уже с предыдущим клоком если новый клок больше чем старый то мы перезаписываем если меньше то дисгардим идея простая Окей Почему мем кэша приедет это важно с точки зрения производительности Ну потому что было вот так когда каждый дата центр ходил в каждом кэш стало вот так я не знаю флаг какой-то страны получился но стало в общем лучше то есть мы видим что красный цвет это локальный зеленый это ближайший к нему и синий Это тот который находится дальше всех Окей дальше хочется поговорить о том что бывало у нас подакшне бывало разная обычно причина такая с точки зрения разработки первый случай Я думаю здесь нужно объяснять что такое becon atation но мы получили примерно следующее Дело в том что лист сайз по идее в одиннадцатом стандарте должен всегда выдавать от единицы но не всегда Если старый гцц то он не будет ломать abi и будет честно считаться за отн А у нас есть проблема есть сборки которые используют старый Linux Джесси и там старая как мамонта Гц В общем он это использовал на графиках мы это сразу увидели сначала понятно что мы это как-то закачивали в коде А сейчас мы перешли на решение когда подкладываем Новый клипси к старому и указываем нашим функциям С какими лучше линковаться понятно что решение костыльное но контейнеров у нас нет с другой стороны админы обещают гомогенность нам в окружении в этом году и будет везде новый Linux это не может не радовать вторая второй инцидент это когда я обещал рассказать историю как мы пошли в бар Я честно говорю что мы только пришли хотели написать друг другу Кто где есть и поняли что ВКонтакте не работает а дело оказалось в том что один человек не пошел в бар Привет в этом была проблема И он в этот момент решил поэкспериментировать все бы ничего но получилось так что он послал форме пакет Ну это норма но дело в том что в тот момент в нем кэш закрылся бак который там существовал некоторое время И в этот момент пакет стал пакетом убийцей и он положил весь мем кэш у нас ложится мем кэш у нас холодный старт сделать мы ничего не можем Но Окей потихоньку останавливаемся потихоньку встаем Окей а какие были как это произошло Дело в том что Бага не существовало никогда потом в какой-то момент он появился и в этот же момент короткий произошла выкатка мелкаяша народ зачем-то и потом про него все забыли бак уже починен мем кэш не обновлен И тут решаемся на этот эксперимент идет мой форменный пакет падает То есть это большое стечение обстоятельств которое произошло что-то было дальше дальше нам дали с бочку естественно поменяли процесс тестирования и выкатки на продакшн и мы начали думать что нам можно сделать мы профазировали сеть Обновили везде критические компоненты и помните мелкая шарит мемори Вот блин не просто так он появился Окей хозяйки на заметку о чем стоит помнить Когда вы разрабатываете высоко нагруженная система а компактность объекта влияет роль не только на сколько памяти вы занимаете Но и на использование кэша процессора он дорогой и быстрый его жалко поэтому не забывайте выравнивать объекты сортировка по типу и следить за падингом далее avx-инструкции часто могут дать выигрыш несколько раз Для нас это показало например яргон 2 что он чувствительный к использованию avx 512f и выигрыш идет порядка трех раз также avx используется при текстовых операциях текстовых партингах В общем его использовать можно довольно активно на хэллоуиде было много докладов про эту историю а еще момент что переходы по указателям не бесплатны также как и локации если про локации никому не надо объяснять то в свою очередь мы заменили СТД на b-дерево и это дало нам выигрыш x 10 раз по этой рации локальность обращения очень важна одно дело когда мы прыгаем по указателям в рендом Access другое дело когда мы бегаем по массивам и работает да дерево место мы умудрились все вершины все информацию служебного вершины сложить в 8 байт А у нас есть некоторые ограничения под дерево но она у нас скорее устраивает Если сравнивать с сетом то мы видим что при б Факторе 32 у нас один страница 48 байта ассет например 40 байт опять вспоминаем про кэш и быстродействие Окей используем устройство указателей указатель у нас 64 Бита про это знают все но используется 48 А что делать 16 А еще есть смещение это можно использовать для тагирирования еще есть Помните у нас бы дерево вершина занимала 8 байт 8 Прошу прощения ее можно тоже туда запихать вот дальше если вы говорите О дата-центрах то Стоит подумать про UTP протокол сейчас есть масса вариантов например Квик который реализует надежную доска в как tcp но при этом он не живет буферы и лучше в плане had of line blooking растущего хвосталлы интенси важная история у нас например реализован кастомная версия UTP протокола которая Надеюсь скоро будет переработана но это было сделано только потому что раньше не было сейчас Клик есть если у вас много соединений на один сервер подумайте об этом когда записи много Стоит подумать про Россию немного конечно это если мы говорим уже про многопоточку я упоминал что у нас есть сервисы которые используют распараллеливание И в чем идея rsu это когда мы у нас есть структура и я Все читают но когда нам нужны изменения Мы сначала копируем потом апдейтим а потом меняем ею вершины через каспираторы там есть ряд проблем Мы свою очередь решили отказавшись от счётчиков ссылок для сущностей Но об этом будет в другом докладе сейчас вместо заключения мне хотелось бы дать какие-то пару Советов первый этап бенчмарк бенчмарк бенчмарк в жопу всех экспертов доверяйте никому если вы хотите писать на черный код Используйте фазеры и проперти по тестирование Будьте аккуратны с продакшна ошибаются все главное сделать правильные выводы а еще Берегите здоровье Всем удачи Спасибо просто красавец Спасибо большое спасибо еще и время сэкономил друзья время вопросов ручки в небо а пока вопросик из чатика Почему вы не используете какой-то альтернативу для доступа к базе пока прогревается кэш и если такая возможность вообще какой альтернативу Уточните пожалуйста в Telegram Боте Какую именно альтернативу вот друзья вопросы задаем Дайте пожалуйста микрофон вот юноша и потом вот потом справа от прохода Привет Спасибо за доклад скажи пожалуйста вы для выравнивания трафика использовали как же Control вам не помогли два предыдущих фокуса это и бюджета но бюджет redrive здесь скорее не причем здесь происходит следующее что у нас когда затупливает одна реплика мы просто встаем просто время начинает увеличиваться то здесь не дело в том что Мы удалим ритм Дело в том что у нас среднее время начинает расти Спасибо вот прям рядом с вами Да добрый день спасибо за докат два вопроса Первый totalocker который вы сделали памяти вы его прямо заменили системный и молодцы только данные персистентные Нет мы используем его только для локатора и только для так и второй вопрос Я правильно понял что у вас все все запросы внутри одного шарда и кроме шардовых вообще нету да вот бежит смотри класс раз Приходите сюда вот нам пожалуйста Вопрос У тебя в докладе было сказано что движке работают на сто процентов же это не опасно В случае если будет какой-то скачок по запросу Нет это возможность Окей это не баг старик так у кого микрофон махните рукой вот справа и там же был вопрос где-то Ладно Привет Спасибо за доклад вот вопрос про движки их 53 ты сказал но при этом какая-то очень большая часть общей когда база А нельзя сказать что это как бы ну одно решение с разными настройками они прям чем-то существенно между собой отличается они отличаются внутренним хранением и внутренним представлением объектов У тебя есть разница хранишь Ты пост или хранишь ты лайк хранишь ты фотку или хранишь ты аудиозапись Ну и так далее получается тоже там хранить то есть видео контент тоже в этих движках отчасти видео хранится сейчас другой платформе платформе Одноклассников это платформа единого видео аудио и фото хранятся здесь да видишь вот это худи это значит человек имеет отношение когда у него логотип хайлоу во всю грудь это значит наш человек вот справа Добрый день продвижки можете чуть подробнее под капотом это полностью ваш или там какие-то субдд движки Используйте Нет это полностью наше решение оно тянется с 2010 года поэтому Да полностью наш Захаров Алексей который спросил про альтернативы написал еще одно сообщение если без ход узнал о возможных альтернативах я бы не задал вопрос возможно есть более медленные подходы прямого доступа к базе Пусть медленно но хоть что-то Ну наверное нет я не знаю такого подхода наверное ещё один каши Но это хороший ответ из серии мы пока не нашли достойного решения это правда вот еще вопрос можно ближе микрофон а то мы не слышим Спасибо за доклад очень интересно собственно на Application level и ты рассказывал про конгошина Control а явно ссылаясь на Квик на транспорт соответственно вопрос Вы в сети есть какие-то оптимизации особенно в шифровании трафика поскольку как бы DP накладывать некоторые ограничения А ещё ограничения от вашего соответственно э решения для того чтобы снизить в то время как-то ЛС антонс достаточно много его добавляет Спасибо Да ограничение я правильно услышал что шифрование VP шифрования vdp есть у нас весь трафик ходит шифрованный со звездочкой Вот и второй вопрос OK OK у нас не Квик вот такой ответ Он знаешь он как бы намекает что должен прийти на стенд и вы Поговорите поподробнее вот на картинке с архитектора движка данные хранятся прямо движки вы сказали что он никуда не ходит вы на данных вас много вы используете какой-то шарнирование балансировщик знает каким именно движка можно обратиться чтобы достать нужные данные Да здесь Наверное момент который я не явно проговорил этим занимается всем rpc Proxy Proxy знает про шардирование когда ты посылаешь запрос запрос У тебя есть какой-то ключ и по типу запроса RP прокси может определить какой-то ключ то ли это будет пара User idpress примеру то ли это можно будет взять какой-то хэш от строки и зашарировать его каким-то образом в общем этим всем занимается и прокси чатик продолжает смотри Петр Минаков Фоменко спрашивает каким механизмы используются для прогрева кэша перезаполнение или по факту данными из запросов Но для проблем для прогрева кэша У нас есть Cold Start То есть когда я просто запускается часть пользователей и эти части пользователей прогревают кэш то есть такие партизаны Спасибо И вот финальный вопрос Давайте зададим большое за доклад вопрос Следующий Я так понимаю у вас есть что-то типа балансировки трафика и в любом механизме для балансировки всегда есть обычный мастер тот станет мастером после смерти мастера у вас реализован какой-то механизм Лидер selection Это хороший вопрос наверное эта тема будет следующего доклада сейчас это происходит переключение вручную то есть админ умеет команды от слопа имеет команды Смена мастера Но это происходит по команде админа сейчас разрабатывается система по автоматической детекции и переключения в консенсусе о том Кто является мастер Спасибо И теперь к тебе вопрос последний кому подарим то что ты принес А что у девушки есть смотри а это значит Ну вот вот ты принес у девушек значит нету у девушек подарок для тебя за какой вопрос отдаем игрушечку кажется самое классный вопрос был про автоматическое Приключение потому что это тема следующего доклада Я думаю его стоит ждать если можно Подойдите пожалуйста к спикеру и Возьмите игрушечку из его рук Да я не вижу просто нам светит два фонаря один отсюда второй отсюда третий это видимо бэкап и поэтому мы очень плохо видим зал тебе спасибо большое памятные призы Илья Спасибо красавица вот Забирай железки замечательно друзья у нас с вами порядка 15 минут технический перерыв потом в 13:20 на сцене разговор про то почему продукт продуктовые команды неэффективны в Enterprise об этом будет говорить спикер из Газпромбанка и в 13:30 доклад Яндекса следите за программой определяйте в каком зале вам нужно быть на следующем шаге Хорошего дня друзья и подойти к спикеру и сказать ему Спасибо лично тоже хороший ход 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений ман я из Подкасты с нами Виктор Михайлов из Газпромбанка Виктор Расскажи пожалуйста чем ты занимаешься Привет но я являюсь экспертом по архитектуре занимаюсь я Solution архитектурой в стриме Премиум соответственно у меня есть несколько команд с которыми я работаю и мы создаем новые продукты в рамках проектов хорошо расскажи о чем мы хотим сегодня пообщаться какая тема нашего разговора тема разговора на самом деле достаточно простая классическая продуктовая команда не является эффективной в Enterprise разработке это базовый тезис Да если раскрывать глубже эту тему да то какое-то время назад там не знаю 5 там может быть 10 лет назад к нам в Россию пришел Джоэл пришли гибкие методологии разработки соответственно все тут же побежали делать что-то новое вот буквально подход к проектной деятельности казался долгим невыгодным Time to Market слишком большой Вот и все думали что вот у нас есть значит такой Святой Грааль видя джайла с крама канбана и мы его внедрим и будете работать действительно В небольших компаниях особенно Digital компаниях которые стоят какие-то продукты Ну как правило мы сейчас говорим про Digital интернет какие-то небольшие стартапы небольшие да где там не знаю 5-10 человек включая силу сети и в общем команда разработки Да это действительно работает получается быстро можно достаточно за короткий срок выкатить работающий продукт и дальше и традиционно его дорабатывать но этот подход в интерпразе не совсем работает по ряду причин Да там одна из основных это то что Ну например в банке Очень много в принципе систем очень много зависимости и сам по себе бизнес он очень тесно связан с друг другом да то есть вот если мы говорим погоди То есть у нас есть большое количество разноплановых отдельных команд Правильно я понимаю да есть большое количество разноплановых команд которые предполагается что будут кроссфункциональные и соответственно будут вести разработку продукта если это можно так назвать Вот Но они являются продуктовом но не овнером всего процесса Правильно я понимаю в зависимости Наверное от направления но в общем наверное да В общем наверное можно и так сказать то есть у каждой группы есть свой продукт Да хорошо а внутри группы Работают ли эти стандартные практики но они начинают ломаться правду жизни в том что есть годовое планирование бюджетов Есть конкретные сроки Джал с этим как бы не очень хорошо работает да есть как правило конкретный бизнес показатели да то есть какое-то количество там например новых клиентов либо какое-то количество денег необходимо заработать с помощью этой фичи Вот и тут уже вот эта итерационный подход он начинает давать бой все равно подключается некий менеджер проекта руководитель проекта у которого есть бюджет ресурсы время цель Вот и проекты эти как правило если мы говорим про банки они все-таки больше как проекты в том смысле что у них нет смысла развивать постоянно Да вот если говорить например какую-нибудь crm-систему для Премиум менеджеров то понятно что у них будет CRM система там будут какие-то функции и все Дальше этот продукт он Ну как сказать может быть развит уже какой-то небольшой группой людей это не будет продуктовая разработка да то есть это будет Вот какие-то доработки каких-то дополнительных дополнительных Да там новый отчет например сделать или еще что-то оно не несет какой-то бизнес ценности да то есть мы с помощью этого уже не выстрелим как бы вперед но они уже ли все эти внутренние продукты они не заставляют бизнес работать лучше и получать тем самым больше денег отчасти Да конечно Просто стоит ли того да то есть вот если взять там Стоимость it команды Например полноценный И сколько там она стоит Да там в портал например И сколько принесет нам новый отчёт какой-нибудь скорее всего не сопоставимо Ну наверное очень можно посчитать какую пользу принесет бизнесу именно этот новый отчет то есть это какие-то софт-эффекты может быть лояльность сотрудников внутри организации за счет того что они работают с более удобным инструментом какие-то такие вещи а какие еще проблемы есть у классических продуктовых команд Ну основная проблема наверное в том но это даже не проблема Это как бы ее свойства потому что она должна быть кроссфункциональная то есть в команде участники должны иметь возможность самостоятельно не привлекая внешних команд или специалистов разработать то что они разрабатывают также все стартапы так живут стартапы так не получится потому что начинаются вопросы безопасности Да там про банки говорить Это один из самых высоких требований безопасности Потому что работа с чужими деньгами вот эта репутация поэтому тут явно появляется какой-то надзорный орган который за всем этим тщательно следит проверяет там каждую до у каждую фичу например того как бы насколько это вообще secura появляется за счет того что банка достаточно большая организация и много команд таких Да там их сотни Наверное если посчитать Ну некие архитектурный должен быть надзор Потому что если каждый начнет пилить так как Им удобно так как они считают нужным получится хаос совершенно Неуправляемый Когда кто взаимодействует между архитектурой и безопасностью И вообще как этот процесс устроен вообще вот если с точки зрения разработки то Вот как раз таки Solution архитектор один из тех участников команды который взаимодействует осуществляет как раз с точки зрения архитектурного контроля с точки зрения контроля безопасности а менеджер проектов он Я так понимаю привлекает специалистов для решения той или иной задачи Да все верно он скорее как такой связующее звено да то есть если там конкретно архитектор не нашел там конкретного специалиста из безопасности который сможет ему помочь либо же нужна какая-то эскалация потому что ну слишком медленно решается вопрос и нужно там принять какое-то решение Да он Понятно А какие у вас есть механизмы поощрения или условно наказание тех или иных процессов и команд есть квартальный kpi который спускаются на команду в зависимости от того какие бизнес цели эта команда преследует соответственно там Вполне себе измеримые метрики да то есть какая-то фича должна быть там установлена в Промышленной эксплуатацию до конца квартал обычно это все квартально вот есть какая-то супер важная функциональность там может быть более короткий срок но и соответственно мотивация тоже можно тоже У нас есть уже получается тоже отличие от стандартных маленьких продукто команд то что у них очень часто kpi Как такового нету то есть ты пилишь с утра и до тех пор пока не допилишь пока мы это не сделаем Да здесь тоже верно но здесь несколько другая история Мы же говорим что все-таки вот мы же не совсем продукты делаем да то есть Вот например если говорить про банковский продукт это Например кредит наличными Да там или кредитная карта или дебетовая карта Вот это продукт Но вот в рамках этого продукта Существует множество it команд которые разрабатывают различные инструменты для того чтобы бизнес-процесс стал более дешевый более удобный для клиента более там Digital более умный канальный да то есть вот такие вещи они не всегда могут быть точно измерены Вот как стартапе в денежном эквиваленте да то есть как бы стартапе мы запустили продукт и все у нас появились клиенты мы начали зарабатывать соответственно команда в плюсе если мы запустили продукт плохой Да там плохая обратная связь Он не работает глючит не знаю там данные утекают куда-то в третьи руки соответственно отрицательные показатели денег нет Вот здесь же Ну да здесь за счет того что есть жесткие временные рамки и жесткие условия по качеству опять же Да потому что это тоже достаточно серьезно контролируется получается что примерно равные в этом смысле хотелось бы подытожить наш разговор то есть рассказать о том что же ждет разработчика в интерпразе и какие есть плюсы работы именно у вас на прошлом хайлоуде который проходил в Питере в конце сентября одна из первых презентаций по-моему от ВКонтакте она была у них вот прям первый слайд первый тезис архитекторы не нужны вот Ну и дальше Эта мысль как бы раскрывается в том что действительно старый подход к архитектуре Он больше не работает И тем более в таких высоконагруженных сервисах как ВКонтакте например банк как бы на еще более высокой нагруженный сервис но тем не менее в чем можно согласиться в том что классический подход вот к проработке архитектуре он несколько устарел Да сейчас все более гибко все более динамично соответственно есть как бы два основных архитектурных департамента Да это департамент интерпретайзер архитектуры и департаменты Solution архитектуры вот мы стараемся максимально Там тесно взаимодействовать с минимумом бюрократии то есть Enterprise задают общую цель Solution уже там на кусочки это все применяют к текущим бизнес требованиям вот поэтому гибкость наше все ten to Market Forever Понятно так с вами был I lot 2022 Меня зовут Козлов Роман и с нами был Виктор Михайлов эксперт по архитектуре Спасибо Спасибо 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений друзья мы продолжаем тут хороший хороший сейчас у нас разговор Когда выходишь на сцену и если стоит 1000 стульев там 800 стульев 500 стульев и сидит например 100 человек зал всегда кажется пустым это так интересно и вот это формирование внутреннего ощущения когда ты спикер А еще у тебя полмиллиона там по ту сторону интернет Хотя смотрит друзья Приготовьте ручки я приглашаю на сцену следующего спикера или я кучуму Готовьте вопросы задавайте их через чатик и живем погнали начинать Меня зовут Илья Я из Яндекса И сегодня я буду рассказывать какие алгоритмы изучения структурированных данных мы используем в поиске человек я не самый публичный поэтому давайте начнем со слайдика про меня Я работаю в поиске Яндекса и руковожу отделом который занимается разработкой товарного поиска мы занимаемся задачами как получением данных индексации их так и ранжированием улучшением качества ранжирования и различными интеграциями товаров на Большой поиск Яндекса до того как руководить товарным поиском я занимался качеством поиска лавки и руководил разработкой турбо-страниц сегодняшний мой кейс будет построен вокруг практического кейса запуска товарного поиска поэтому Давайте кратенько про него расскажу что такое чтобы сейчас не заморачиваться про различные интеграции с поиском проще всего смотреть на товарный поиск как отдельную вкладку На этой картинке видеокарты вот так есть и товары вот это вот эта вкладочка сам товарный поиск выглядит как все поиски в интернет-магазинах У нас есть Товарная строка У нас есть фильтры и у нас есть карточки товаров на выдаче внутри карточки товара вы можете зайти туда и до уточнить параметры товара который Вас интересует например там цвета гигабайты и увидеть цены на интернет-магазины во всем интернете и это есть наша Ключевая задача которую мы будем сегодня обсуждать именно вот в этом блоке цен у нас должны быть все предложения в интернете как на маленькие магазины которые вообще невозможно найти без поиска так и на крупные marketplace типа Wildberries озона или яндекс.маркета и вот эту базу товаров нам надо собирать Сегодня мы будем про неё говорить а соответственно про что доклад про построение базы цен но вы скажете блин афише-то обещали что будет про парсинг всего интернета вообще А тут что-то только про цены собираются рассказывать как-то что-то не то на самом деле все подходы которые я буду сегодня рассказывать они работают на всех остальных срезах и в конце я расскажу про другие удачные примеры где у нас получилось применить эти алгоритмы Но почему цены потому что у цен есть два очень важных свойства первое с точки зрения товарного поиска ценность вещей Ключевая функциональность они прям везде поэтому алгоритмы должны быть Ну очень хорошего качества иначе невозможно сделать качественный продукт у которого слишком много ошибок второе цены вообще меняются в отличие от многих других полей то есть самое время частенько цены меняются дважды день на товары А в районе каких-нибудь мероприятий вроде Черная пятница которая идет сейчас у нас за день обновляется пол балла и соответственно это свойство которое накладывает довольно много ограничений на решение и мой доклад будет построен следующим образом я вкратце расскажу как выглядит наш архитектура какие там основные блоки и подробно расскажу про две самые интересные компоненты про парсинг и скачивания Ну а также в конце расскажу про удачные применение парсинга но Давайте поймем масштабы вообще какие у нас масштабы задачи всего по нашим оценкам в интернете порядка 20 миллиардов товаров которые цены которые мы хотим получать примерно полутора миллионов интернет-магазинов также очень важная характеристика по нашим оценкам примерно каждые 24 часа 11 процентов товаров меня свою цену то есть вот если вы взяли базу посчитали на нее цены сутки с ней ничего не делали через сутки у вас будет в ней 11 процентов товаров с неправильной ценой с протухшей и еще раз Напоминаю что Ошибка цены это очень плохо а поэтому выбора у нас в архитектуре Нет надо максимально все насквозь потоковой архитектуре пробивать от начала до конца делать у нас нечего и первая компонента в нашей архитектуре это Крауля он отвечает за две самые важные задачи в начале это про планирование Какие документы качать собственно проскачивание их и на каком-то срезе где это необходимо он занимается отрисовкой Java скрипта А ну в случае если там есть какие-то ленивые загрузки и подобные всякие проблемы JavaScript дальше всё это дело идёт потоково в контент системы Яндекс робота на неё можно смотреть как это огромная система в которой есть много маленьких микросервисов которые под точно обрабатывают документы и один из этих микросервисов это наш парсера он соответственно вход получает HTML Q и возвращают какие-то структурированные данные в частности там лежит наша цена все это дальше идет опять же насквозь не задерживаясь в хранилище в котором копятся офферы и выкладывается индекс и вот в этой схеме все хорошо поточно Вот кроме вот этого полного индекса который выкладывается раз несколько часов что мы с этим сделали я расскажу чуть попозже в конце там тоже есть на это как но всё остальное насквозь пролетает Хорошо давайте переходить собственно к задаче парсинга как она выглядит Вот это типичная страница интернет-магазина там много какой-то информации все очень красиво но нас на самом деле интересует какой-то набор данных с этой страницы в частности нас интересует например там блочок цветов или блочок цен Ну вот он там 28.99 руб нас интересует и вот Глядя на такую страницу можно сказать на что-то просто же алгоритм придумать Давайте возьмём просто первую строку которая рубли содержат отлично метод кажется а но не всё так просто и вот один из миллионов примеров которые там ломает и надо там какие-то эвристики писать Например такой А вот у нас есть цена 32.99 руб Но вот повыше положили баннер на акцию которая ещё не началась и там 19.990 руб на э-э Ну будет через несколько дней Но сейчас вот не столько и алгоритм должен не обмануться и извлечь правильную цену Ну соответственно не всё так просто Поэтому нам надо формулировать задачу и пробовать и решать Ну соответственно задача берём html-ку получаем же сончик со структурированными данными отправляем его дальше потребителям но всё-таки не отпускает вопрос а можно ли как-то просто вот охота нет вот и думать неохота обучает никакой Давайте как-нибудь простенько Вот и первое просто компания это микро разметка Это отличный подход почти и структурированная информация есть публичная документация например на схему.org прям в медь и в ктмэлле размечено например наличие валюта цена вот эта информация лежит все круто быстро реализовывать даете разработчику задачу Или сами делаете за недельку делается очень круто веб-мастера напрямую влияют можете прямо в документацию написать мы извлекаем эти данные Если хотите попадать товарный поиск указывать такие данные вот вот список но есть нюансы полнота не такая большая К сожалению она хорошая но для того чтобы сказать мы покрываем все интернет э-э в интернете все магазины недостаточно и вторая важная проблема мы никак не можем влиять на качество со своей стороны К сожалению При таком подходе если условно партнёр забыл обновить плагин который генерирует вот эту микроразметку на сайте у него всё хорошо а на поиски все плохо К сожалению плоховато Ну и на самом деле из последнего недостатка выходит следующее решение в каком-то виде Мы за использовали идею похожую на блокировщики рекламы Если вы когда-то блокировали рекламу вы такие о Понятно Вот этот блок у него СССР селектор Давайте блокировать условно всегда элемент с таким классом и у меня на сайте не будут на этом рекламы и то же самое идея Мы за использовали для парсинга цен на конкретном сайте Мы можем выбрать селектор сказать бери Вот с таким селектором первый элемент это будет цена на этом сайте и на самом деле это Рабочая идея для которой мы сделали специальный плагин в котором можно выбирать что я хочу на этом сайте создать партию для цены найти его на странице кликнуть туда плагин предложит селекторы которые он видит и можно выбрать самый удачный из этих селекторов и собственно положить такое правило парсинга для этого сайта и в какой-то момент мы даже Слишком поверили в эту идею когда занимались задачи обогащения сниппетов на поиски Ну вот это какой-нибудь там один из миллиона сниппетов который у нас есть на поиске он выглядит так там какая-то информация иногда охота классико дополнительную информацию например процент мы посмотрели на график распределения показов и увидели очень интересную закономерность это кстати не сильно зависит от среза так почти всегда распределен трафик что Примерно 100 самых крупных сайтов дают Примерно там 60 даже чуть больше процентов показывать а это значит что берем накликиваем 100 парсеров и условно там почти решаем задачу собственно Так мы попробовали сделать мы взяли нашу группу разработки заказали пиццы заказали напитки забронировали переговорку договорились сейчас мы будем два часа кликать не отвлекаясь и на кликаем 100 парсеров не получалось накликали 80 пока доделывали верстку запускали эксперимент 10 успела сломаться пока там до разбирались там с приемкой и докаткой в продакшн И еще есть сломалась и Эйфория немного прошла как-то оказалось что подход прикольный но есть недостатки и резюмируя на самом деле про этот подход мы можем влиять на парсинг со своей стороны быстро можем распарсить какой-то конкретный сайт запустить эксперимент проверить Как это работает но к сожалению к задаче парсинга например для товарного поиска это вообще не работает там для того чтобы создать полтора миллиона сайтов даже если вы будете невероятно быстро накликивать по 10 минут на сайт надо потратить 130 лет и они еще разламываются разработчиков это дёргает но отсюда на самом деле вытекает вполне логичное предложение А зачем это делать самому Зачем это делать разработчиками Это же вполне Понятно рутинное задание и ровно так мы модернизировали этот метод мы сказали а давайте создавать эти стартеры это локерами мы берём сайт отдаём этот сайт того кем локер в этом же плагине накликивает сектор дальше мы отдаем этот сэмпл другим талокерам они проверяют что Первый сделал все хорошо если все хорошо добавляем этот парсер стоит парсера Ну и всё как бы задача выполнена но опять же возникает вопрос А почему это не идеальное решение Все можно презентацию тогда заканчивать к огромному сожалению Все эти парсеры они независимые то есть соответственно создавая Один парсер он никак не влияет на другие их также надо создавать и также надо поддерживать а это значит что на создание полутора миллионов парсеров Ну надо миллион долларов что потратить при расчёте там примерно 0,75 долларов за штуку Ну это была бы не самая главная проблема например там размазать на год бюджетом СКК срезать и так далее если бы эти парсеры не ломались И к сожалению ломаются не очень часто по нашим оценкам примерно 30 процентов за месяц это сломаются и для того чтобы в адекватном качестве поддерживать парсер раз в неделю надо переходить эти парсеры раз в неделю это на самом деле оценка сверху если они ломаются пробовать их пересоздавать и соответственно на эту Будет уходить порядка 750 тысяч долларов а вот это уже хороший бюджет и вторая главная проблема даже если там говорить и выбить такой держать на любые другие задачи этот бюджет не переиспользоваться то есть нельзя вложиться там словно в разработку и потом везде это применять А тут надо везде насыпать этот бюджет поэтому к сожалению к нашей задаче это не подошло Но какие-то более локальные задачи где условно 100 сайтов или 1000 сайтов они подходят отлично это супер метод Ну и резюмирую сказано о простых методов словно извлекать первую строку с рублями мы не придумали микроразметка отличный подход круто запускать достаточно селекторы можно разгонять покрытие особенно в небольших задачах но к сожалению дорого поддерживать и мы пошли дальше мы сформулировали задачу в терминах классификация вершин дом дерева Если посмотрим на какой-то пример цены на сайте видно что у нас вот там есть какое-то много всякой информации и есть отдельная вершина которая содержится например 499 рублей и мы хотим обучить такую классификатор который говорит что вот здесь содержатся цена А во всех остальных вершинах как бы не были похожи цены нет то есть например на 599 это прайс равно false это Не цена Ну и Разумеется там на скидка по акции либо минус тысяч рублей тоже надо сказать Фолз не это не цена и делали мы это обучение модели градиентного бусинга которая есть три основные группы факторов первая группа она самая логичная это текстовый фактор на самом деле даже вот если сейчас не про что не рассказывать и посмотреть только вот на этот СНиП цена вам не надо вообще никакую часть страницы вы скажете Ну это цена на какой-то товар но цена Возможно там из блока рекомендаций Но это цена и как он работает мы говорим что мы предсказываем для вершины 499 рублей мы смотрим на контент вершины которая стоит слева от нас мы смотрим на контент вершине которая стоит нас мы смотрим на класс вершины в которой лежим мы и мы смотрим на контент вершины которые справа от нас континируем все это в одну строку через разделители и обучаем сетку которая говорит цена ли здесь или нет И на самом деле это очень сильный фактор Ну то есть одного его хватает уже очень много К сожалению есть недостатки надо их немного подполировать и вторая группа факторов под полировка ручными факторами А давайте посмотрим что рядом посмотрим на теги вершин нашего родителя дедушки и так далее мы знаем какие-нибудь значимые элементы у родителей дедушки и так далее например ссылки картинки посмотрим вообще насколько мы Уникальны в дереве Сколько еще таких же вершин Ну и посмотрим там какие вообще в среднем размеры Это продолжение идеи с текстовым фактором Но немного подполировать другие статистики но опять же этого мало потому что может быть несколько похожих блок цен и непонятно Какую выбрать здесь на помощь приходит на самом деле позиция в дереве А давайте вот посмотрим на все дерево целиком и поймем Где мы находимся Где мы находимся можно считать в двух терминах во-первых посчитаем от начала дерева до конца дерева различные расстояния например в терминах сколько слов от начала документа сколько символов сколько вершин сколько картинок это будет первый набор факторов расстояний второй набор факторов расстояний А сколько такие же вершин по Пациенту по классу перед нами и после нас например для вот этой выделенной вершины с ценой будет известно что по контенту Она находится где-то в первой трети и это первая вершина с ценой больше таких не было а вторая вершина это уже известно что она где-то там в конце где-то 80 процентов текста перед ней и есть какая-то вершина С таким же контентом ценой перед ней и группирую все эти три группы факторов вместе мы получаем отличную Модель которая умеет предсказывать цену по html-ке огромному сожалению мы все еще на вход получаем весь поток Яндекс робота и это сотни тысяч РПС как бы мы не старались как бы там лучше олимпиадники которые у нас есть не пытались это оптимизировать При таком потоке меньше чем десятки тысяч FPS в лоб с оптимизировать у нас не получилось Поэтому мы начали думать а что же можно сделать чтобы ну хотя бы сузить немного этот поток Как можно под оптимизировать и первая логичное действие А зачем нам парсить весь поток Давайте парсить какую-то его часть потому что Яндекс же скачивает еще кучу других страниц там есть новостники Википедия обзоры Ну страницы с фильмами и там нет никаких цен они не интересно для нашего товарного поиска и Давайте обучим просто классификатор который по Орлу и так будет говорить А вообще здесь есть товар или нет причем важно что нам не так страшно сильно ошибиться назвав кого-то товаром Ну партия разберётся он скажет нет Там нет ничего страшного и такое подход позволил нам сотни тысяч рфпс превратить десятки тысяч PS нагрузки на партию при этом сама моделька она очень лёгкая она берёт только урла и тайтл он даже не лезет там никуда в дерево и это лёгкое которая относительно там парсинга почти не потребляет ресурсы но надо идти дальше все еще многовато посмотрим вообще как выглядит снова страница Ну вот на какой-то произвольной странице можно глянуть Ну цена здесь а если глянуть на какую-то другую страницу этого сайта то опять мы скажем Ну цена здесь почему мы на каждой странице заново запускаем какую-то сложную машинерию Хотя все страницы одного сайта похожи Кроме того Мы недавно разговаривали что можно генерировать селекторы селекторы работают целиком на весь сайт А тут мы снова парсим Одну страницу и комбинируя на самом деле знание о том что у нас есть клёвая модель и Известно что в целом парсинг на Хосте выглядит одинаково то возникает логичная отдавайте селекторы генерировать модели действительно же она есть и ровно так и решили мы сделать мы взяли конкретный сайт для него на генерили Канди поверхность селектора Это от вершины поднялись вверх До корня и выписали так и его класса ID моделью проверили что такой селектор Это хороший селектор там почти всегда лежит цена Если это так то все положили его в стейт для парсинга будем его использовать что важно Это маленький Файлик просто записями хостес селектор в нем единицы миллионов записей копейки и его можно регулярно перестраивать вообще без всякого краунда раз день легко и что очень важно Это подход экономит примерно 60 процентов вызовов тяжелого парсинга то есть нам 60 процентов случаев достаточно просто глянуть в этот Файлик проверить если такой селектор и если есть О круто Все не надо ничего запускать вот ответ и соответственно давайте резюмируем как у нас режется поток на вход у нас приходит сотни тысяч РПС классификатором мы срезаем до десятков РПС потом не забыли про микроразметку все-таки Это отличный метод зачем мы выкидывать и потом еще посмотрели на если у нас предпочитано такое класс эквивалентности и срезали еще 60 процентов Ну и вот эти единицы 1000р которые остались Ну можно уже и распался дальше Давайте перейдем снова к следующей задаче к актуальности цен напомню почему она вообще важна Как выглядит страница Как выглядит страница товарного поиска у нас цены используются везде То есть это и выбор сортировки это и фильтр по цене это и товары и цены на товары и соответственно мало распарсить качественно постоянно эти ценное держать актуальными первая логичная идея приходит точно так же не ну все просто Яндекс у нас куча железа обходите базу раз в день и будет как бы все хорошо и ровно это мы собственно когда запускали товарный поезд Точно также и подумали мы написали парсер интегрировали в контент-систему Яндекс поиска начали заниматься задачами индексациями и качество ранжирования и в один прекрасный день прошлой осенью такие Ну всё Давайте тестировать выкладываем базу смотри что уже получается На полной базе и неожиданно мы выяснили что каждый второй товар имеет ошибку в цене Ну мы не растерялись мы сказали Окей никаких проблем просто актуальностью не занимались Давайте переобудем Ну просто возьмем и сотни миллионов товаров которые у нас есть закажем в переобход и все актуализируем будем так делать регулярно Но к огромному сожалению так не работает потому что переобход всей базы занимает единицы недели там почти месяц и пока мы переходим документы в хвосте этого списка документы в начале уже успели протухнуть иногда дважды иногда трижды иногда вообще закончится и снятся с продажи и происходит это из-за того что у нас есть по хостовые лимиты мы не можем с определенного сайта качать слишком много как бы нам не хотелось Потому что если например надо переходить 10 миллионов товаров с одного сайта кажется немного то это больше Стар ПС нагрузки на и это много больше иногда обычно продуктовой нагрузки нам никто такую нагрузку техническую конечно же не простить поэтому надо думать дальше и надо думать А как вообще тогда скачивать если по кругу не получается нужны какие-то ивристики и эвристики такие Ну первое самое понятноевристика но если мы документы показываем в поиске в товарном либо на Большом поиске ну их надо переходить на самом деле показов относительно всей базы немного поэтому тут никаких проблем все популярные товары мы будем поддерживать актуальными что делать с хвостом и оказалось что цены на товары меняются на самом деле неравномерно есть товары которые меняют цены гораздо чаще есть гораздо реже и в целом у нас получилось это обобщить глядя просто на тайтл на категорию товара и на время когда он последний раз переходили оффер и вот по такому этапу можно научиться предсказывать вероятность изменения один из последнего переобхода и просто в планировании переобходить самые вероятные изменившиеся документы в момент когда вот этот классификатор у нас работал не очень хорошо нам приходилось делать фильтр по возрасту документа ну и соответственно можно таким интерсколдом подсекать документы которые Ну вероятно уже не успеваем По Кого там перейти Ну и финализируя схему она выглядит следующим образом у нас есть краулер который смотрит на стейт товаров смотрит налоги поиска товарного и большого поиска приоритизировать документы скачивает иногда запускает JavaScript отправляет дальше в контент систему Яндекс робота которая фильтрует поток по классификатору дальше отправляет все это дело в парсер который смотрит на оффлайн процесс построения классов эквивалентности дальше этот поток идет в хранилище и в хранилища и индекс выкладывается под runtime но во всей вот этой схеме как я обещал в начале есть маленький нюансик это выкладка полного индекса она долгая единицы часов нас такая скорость не устраивает поэтому мы подумали и поняли а давайте сделаем отдельный быстрый контур выкладки под runtime который сбоку от основного индекса в котором мы будем выкладывать только цены и наличие это на самом деле очень маленький объем данных относительно всего индекса условно единицы процентов и можно прямо на шортиках поднять сторож в памяти который почти за бесплатно Будет поддерживать максимально актуальные цены наличие просто будем заглядывать вот в этот киви сторож помимо основного индекса и вся такая схема целиком с этим быстрым контуром позволяет документы от начала до конца от скачивания до показывая его пользователю пробрасывать за единицу минут что уже звучит почти круто мы решили задачу а и Давайте посмотрим на другие примеры использования как я обещал мы используем точно такие же подходы парсинга для извлечения данных например про онлайн-курсы вот так выглядит обогащенный ответ мы умеем извлекать начало профессию длительной стоимость мы умеем точно такими же алгоритмами парсить достаточно сложные характеристики вроде не знаю материала сезона размеров цветов и так далее И на самом деле много других задач Ну про которые тоже там можно чуть ли не отдельный доклад рассказывать А как можно применить алгоритм парсинга Ну и резюмирую сегодня мы обсудили несколько подходов парсингу структурированных данных мы обсудили какие есть эвристики поддерживания актуальности мы посмотрели на архитектуру база товарного поиска и посмотрели на различные другие сферы применения алгоритмов парсинга Спасибо Давайте переходить к вопросам абонент вот здесь есть начале вопросик кто микрофон выдает а он микрофон бежит вот я далек немного от этого всего Вот Но у меня такой вопрос просто ради интереса а можно вот поиск товаров осуществлять по анализу изображения не по разметке а просто по изображению Как как скан документ работает Да допустим анализ скана Вот и перевод в цифровую А вот то же самое с сайтами делать какие-нибудь модели которые могут видеть отличать цифры от букв там цену поля примерно запоминать В каком углу находится поле с ценой И там распознавание делать или это нецелесообразно И вообще бессмысленно сравнение с разметкой Да спасибо за вопрос на самом деле это второй альтернативный способ парсинга по самому изображению и попытки извлечь с него Ну у него самое главное К сожалению огромный недостаток то что зачастую это требует кучу видеокарт то есть сразу когда переходишь к анализу изображений для хорошего качества надо поднимать отдельный контур высоко нагруженный у нас было несколько экспериментов в самом начале с извлечением но они как-то себя не оправдали в терминах вычислительных ресурсов и в литературе каких-то супер удачных применений мы не нашли и поэтому отказались в пользу более текстовых подходов но мы не нашли прямо где-то работает прям драматически лучше потому что есть подход более простой в если запустить JavaScript и прямо дарить вот эту страницу вот в подходе который рассказывал я можно добраться до факторов на самом деле про позиции элементов и вот уже в таком подходе можно расширять подход который я рассказал уже гораздо проще органичнее там прямо есть локация что вот это элемент занимает пиксели отсюда досюда и можно их дотаскивать уже смотреть структуру и контент который надо извлекать без картинки он уже здесь текст и лежит то есть на самом деле гораздо проще вот визуальный обманывать с помощью трендерить браузере посмотреть на координаты Да Микрофон отобрали чтобы это такой задел на кулуара да такой вопрос а бывает что специально вот скажем сайты магазинов меняют позицию цены меняют вот разметку чтобы их вот так не агрегировали или это неинтересно специально делает вам хуже Мы же поиск мы ведем на них трафик понятно но как изголяются магазины чтобы их правильно парсели это отдельный отдельный круглый стол наверное на 3 часа тогда они должны вам помогать в этом поиске получается и как правило вот эти вот разметки делать так чтобы у вас не было каких-то там сложных моделей для поиска но до всех не доберешься до кого добираемся они нам помогают для тех кто считает рассылки К сожалению приходится так вот хитро до них доходить и извлекать данные смотри аж трижды опубликован Вопрос в чатике какие инструменты вы используете для обхода Мы же прям явно говорим что мы Яндекс робот Яндекс бот 3.0 и вот если нам показывают captcha это очень плохо влияет на позиции в поиске то есть у тебя с удостоверением да да подход такой да тук-тук-тук именем королевы Откройте Да есть ли у вас проблемы с ханни-путами И как вы ее обходите не ну проблема Сохрани потами Конечно есть мы делаем примерно следующим образом команда разработки алгоритма авто парсинга во время дежурства занимается кастомная разметкой и поддерживает их то есть дежурный должен начале недели разметить 10 страничек по его мнению мы складываем их в ханипоты и используем мы сошлись в итоге Спасибо пожалуйста вопрос А сколько времени занимает выполнение всего пай плайнов понимаем на надо обновить цену сколько момента Сколько времени пройдет с момента осознания Вот это необходимости Почему задаю вопрос потому что почему нельзя обновлять цену в тот момент показывается товар пользователь он сделан первый запрос Почему нельзя в этот момент взять актуализировать цену и кэшировать например то есть это какое-то временное ограничение Мы тоже думали про такой подход Ну во-первых он нашел в каком-то виде отражение в реализации если мы показали этот товар то мы как можно быстрее пытаемся его заново скачать но Весь вот этот плане занимает единиц И к сожалению там как-то гарантировать что мы это сделали не знаю там за секунду или там меньше тем более невозможно потому что Интернет огромный Ну многие сайты отвечают за единицы секунды то есть там Пока запустится пока не знаю запустим паркеры такое невозможно к сожалению угу Там тебя снимают на видео надо помахать Будьте вопрос Да добрый день Вопрос такой а не пробовали в дополнение еще к этим методом добавить некий свой стандартный Яндекс может быть метаданные чтобы создатели сайтов просто напрямую сбрасывали эту информацию такой подход тоже есть конечно же у нас товарный поезд точно также можно этим заниматься не У нас конечно же есть API для загрузки сети всех этих цен но к сожалению опять же полтора миллиона сайтов кому-то дорого вот эту разработку делать кому-то Просто они там не догадываются лень Ну часть сайтов конечно отправляет нам напрямую цены это правда А все остальные нужно парсить друзья пока вы готовите вопросы читаю вопрос из чатика парсер с моделью будет когда-нибудь вулпенсорсе смайлик не на самом деле мы сейчас совместно с ребятами США до ресерчем более академические подходы и я думаю они имеют шанс опубликоваться на гитхабе или в виде статейки когда я думаю это весна наверное срок такие порядки Да есть имейл где можно подписаться мой Telegram можно Напомнить к весне Я с удовольствием отвечу и поделюсь новостями да Никита вьюшков Это ответ для вас друзья есть еще вопросы вот пожалуйста Или я Спасибо за интересную доклад У меня два маленьких вопроса махните Отлично так вон там видишь где-то на границе миров да Вопрос с границы миров Как вы понимаете что цены которые вы распарсили они действительно актуальны ведь это же их уже много не пройдёшь все не проверишь а второй вопрос всё-таки я не понял чего вы делаете с картинкой Вот ты показывал пример где э объявляется какая-то акция Да в конкретные даты и на картинке цена вот что с этим делать Да спасибо за вопрос правильность парсинга определяется стандартным подходом давай возьмём ровное распределённые sample Ну там пропорционально тому как мы показываем документы условно тысячу или там несколько тысяч документов дадим их талокерам И попросим проверить и мы получим на самом деле чиселку оценки правильности наших данных в среднем по базе Ну там с какого-нибудь минимальной дисперсией там в 1%, что Ну достаточно точно отражает реальное состояние дел про картинку которая с ценой на акции её вполне легко переваривать текстовый фактор он видит что прямо в ноги для которым мы сейчас сделаем предсказание Есть информация что это цена по акции там почти любая текстовая модель в том числе наша она вполне понимает информационно не похоже товара это не надо извлекать Спасибо Следующий вопрос Добрый день скажите пожалуйста пару слов о том что вы используете в качестве и какова его архитектуры Я еще просто в конце вашего доклада то что вот эти горячие данные которые в итоге кладете в Киеве или storage значение что вы используете архитектуру мы используем на самом деле стандартную индексовую штуку соски Это внутренняя индексовая технология это просто сторож который можно потоково наливать данные и ходить просто сказать запросами я думаю там на каком-нибудь хабре про архитектуру написали не раз если интересно можно написать на телеграмме найду статейку как она устроена вполне хорошо описывается Как работает и как это работает Быстро Илья быстрый ответ какой-то запускается кластер ровно у нас Сиреневый пожалуйста Да да у меня интересный вопрос Спасибо большое за доклад пасть от ли вас хотелось бы узнать и возможно боретесь ли вы с этим или нет А я имею ввиду продукты Яндекса Спасибо Не на самом деле мы знаем что парсят нас смысле партит ли их Сбер ты имеешь ты или как мы знаем кто нас парсит Мы даже общаемся с этими людьми там знаем они ходят парся товарную Вертикаль там много полезных данных товарный поиске ну здесь есть преимущество они иногда нам Багги репортятся взаимовыгодное сотрудничество Ну на это сложно влиять то есть мы не можем запретить обход роботов в том числе потому что индексация Google хорошо когда ты приходишь ты говоришь что ты Яндекс и тебе там капчи не показывает и сразу все данные отдают А вот когда Эти люди К тебе приходится им устраиваешь У нас тоже проиндексируется Привет я Спасибо за доклад у меня такой вопрос Например если какой-то владелец магазина против того чтобы вы их парсили как вы это обходите И вообще если такие случаи что они не хотят чтобы вы их партии может быть есть какие-то не знаю в этом заключаете договора но понятно что магазинов такое количество множеств такого огромное количество что всех наверное не обойти как-то с ними наверное со всеми нельзя договориться тут есть стандартное решение Как у всех сервисов Яндекс для индексации есть тег но индекс совершения которые можно указать блоку с ценой или вообще на весь документ мы туда не заглядываем и не используем нигде в нашей планах эти данные а что это за магазинные вот которые не хотят чтобы их парсили вот Озон например хочешь чтобы его парсели с твоей точки зрения не надо от лица озонтеха отвечать с точки зрения озона не получает много трафика с поиска выгодно Точно также и есть еще вопросы друзья махните рукой Давай тогда финальный вопрос из чатика и мы тебя отпустим можно всегда спикеры найти у него на стенде там Яндекс очередной раз построил целую улицу вот на этой улице собирается весь интернет есть ли какой-то фильтр чтобы отсеивать фейковый интернет-магазины и мошеннические сайты Вот это кстати уже интересная задача Ну это прям отдельный доклад на самом деле про то как мы контролируем мошенников ну вся Служба контроля качества со всеми ручными и полуавтоматическими проверками Да мы делаем активно боремся с мошенниками активно боремся с пессимизацией магазинов которые там показывают товары но не доставляют их идеально правда полчаса рассказывать как мы это делаем я понял ну автор вопроса Константин Пронин Константин просто вот тележку Илья Напишите он вам там полчаса будет писать чтобы фильтровать кому кому подарим за лучший вопрос игрушечку давайте мне кажется первому вопросу кто спросил про картинки и про дополнительные подход парсинга обойди отлично игрушечка можно с ней обниматься когда когда ложишься спать да Илья тебе спасибо большое памятные призы от конференции красавец друзья спикера всегда можно найти в кулуарах Далее по программе в 14:30 на экране тех ток про Биг дату в МТСе и про импортозамещение в бигдате и в 14:40 продолжаем 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений на уровне bigdata Прежде чем говорить как и предметы Расскажите Какой у вас тег bigdata в МТС стек bigdata в МТС он вообще достаточно такой обширный то есть поскольку в целом работа с данными это очень-очень много Шашков от там загрузки данных до потребления там до аналитики и так далее То стек соответственно тоже очень большой в основном он основан на Open Source решениях могу назвать например такие вещи дата Лейк на ходуперизитационный слой если в основном на спарке плюс стандартный такой Big Data стек на Open Source Вот Но у нас в том числе есть еще ряд вендорских решений которые Ну естественно тянутся там с достаточно таких незапамятных времен вот тоже например могу назвать у нас достаточно популярно табло как инструмент для Bi и в общем-то весь там биостроился на табло вот еще из такого как бы наверное того с чего она там с чего надо будет съехать это etl на сасе Он всё ещё у нас там немножечко присутствует вот это как раз та вещь с которой наверное вся индустрия уже давно борется и давно съезжает кто-то там в большей степени успешно кто-то в меньшей мы благо не полностью с самого начала были на него завязаны Вот Но нам нужно будет теперь по понятным причинам а-а окончательно от него избавиться всё то что можно взять опенсорсное как аналог брать Open Source и дорабатывать всё то что можно Ну что она не подходит opensort а-а разрабатывать самому и только возможно Ну некоторые критичные вещи которые вот прямо здесь и сейчас нужно заменить возможно Для этого посмотреть российских вендоров Вот но в целом мы как бы Идём в сторону Независимости от вендеров вообще не только от иностранных Мы давно уже как бы для себя думали что было бы здорово в общем-то от вендоров отказываться Мы про это думали ещё на самом деле и до скажем так этого года и там в двадцать первом году но это практически всегда бизнес не очень хорошо на это смотрел но ровно потому что тебе нужно вложить денег э-э там и вообще человеческих ресурсов намного больше или там сопоставимо как минимум с тем чтобы просто заплатить вендору но при этом у тебя ещё здесь появляется очень много головняка оно плохо работает потому что тебе нужно проводить вот эти самые миграции тебе нужно с мигрировать одни процессы там со старых систем на новые и это правда так и поэтому раньше бизнес на это не особо охотно шёл Даже со всеми Ну скажем так попытками там импортозамещения в целом такого как бы концептуального бизнес не очень хорошо На этот шёл когда у тебя как бы продаётся готовая вендорское решение на котором у тебя в принципе всё так или иначе работает даже если оно дорогое сейчас тебе в любом случае придется съезжать с чем пришлось бороться или сражаться или справляться вашим разработчикам в вашей команде Bi Ну я это наверное только как один из примеров с которым пришлось сражаться Но на самом деле то есть у нас текущие там лицензии которые вот позволяют использовать там скажем так вендорские решения Вот они будут работать еще не очень долго и поэтому сейчас Короткие сроки нужно доработать о консорсное решение чтобы перевести там часть как минимум часть пользователей как раз на эту планшетное решение Понятное дело что для где-то наверное процентов 80 пользователей Там и так у них были Ну даже барды скажем так не очень сложные они такие как бы просто там таблица с минимальными графиками Они во многом уже ложатся можно сказать как и поэтому там доработки нужны минимальные то есть нужно встроить обычного bandstore решение во всякие интерпрайс системы то есть подключить к какой-нибудь в аутентификации к логированию там безопасников к там системе которая выдает доступы вот к этому всему подключить вообще вот минимальная интеграции провести и уже в общем-то можно пользоваться дальше начинается история с тем что и вот это то до чего мы объективно как бы пока еще не дошли что оставшиеся 20 процентов хотят строить уже сложные даже барды реально там у них со всякими даунами они там всякие сложные вещи делают И тут уже просто функционал Open Source решения им не хватает И вот здесь вот основной вызов за относительно короткие промежуток времени Ну то есть под короткими что имею в виду это скажем так там годы да то есть вот эти вот там годы на которые там закуплены лицензии И сколько времени оно там ещё будет работать годы там типа от одного до трёх в зависимости там от разных решений Вот за это время как бы доработать импортозамещенный Open Source до состояния чтобы вот оставшиеся 20 процентов могли им пользоваться Окей хорошо но вот есть вендоры которые предоставляет коробочные решения которые вы берете инхаусу себя там на серверах разворачиваете есть те которые представляют Облачное решение то есть вы как бы к облакам подключаетесь забираете у вас были такие которые располагает свои данные это за пределами вашей инфраструктуры вот вообще хороший в целом вопрос у нас никогда не было никаких облачных решений ровно потому что на самом деле это примерно одинаковая история для многих индустрии которые работают с чувствительными данными но самые хорошие примеры как раз Телеком И там банки например то есть они не могут просто взять и хранить свои данные в облаках потому что у них есть ограничения законодательные на то где они могут хранить свои данные вот и поэтому все те вендорские решения которые у нас например были развернуты они были развёрнуты полностью в наших собственных конторах на наших железе у нас большинство железа оно было коммунити Ну то есть просто отдельно закуплены железо на который был поставленский софт в принципе дальше действительно использовались и вендорские решения как Пак программно-аппаратный комплекс который вместе с железом поставлялся и который ну без этого железа фактически не работает гипотетически наверное его там можно за реверс инжинирить и как-то там заиспользовать но это понятно там это не интерпрайз путь вот сейчас почти все железо к модети и там на нем можно развернуть скажем так Open Source решения или нашинхаус решение но опять же тут как бы правильно заметил что есть проблемы например с самим железом что как бы те же самые другие виндора это тоже были виндара они поставляли железо и вот это вот железо сейчас тоже закупить это не самая тривиальная задача у нас оно как бы есть но чтобы там закупить там в будущем для этого нужно будет что-то делать я так сказал уточняющий вопрос правильно я понял то что были некоторые вендора которые давали не только софт но они еще представляют железо Да но это разные виндара составляют железо другие винора поставляют софт а окей Я думал то что есть те кто делают софт и сразу под него железо то есть такие были но у нас уже таких нет в принципе наверное с прошлого года окей Да не на вопросы замечания на уровне железа Это вопрос уже другой сферы Там абсолютно точно Хотя он в общем-то напрямую коррелирует в принципе с любыми эти решениями Вот ну как бы я знаю что в России эта история прорабатывается но пока объективно что там до решений каких-нибудь там HP dela и вообще всего чего только угодно там далековато Скажи что приводить вот так вот на первый взгляд я к чему спрашиваю Просто люди которые сейчас скорее всего будут сталкиваться с теми же проблемы им возможно будет полезно знать о том что будет тяжелее всего давай так объективно нет такого что вот что-то было легко перевести А что-то сложно перевести здесь скорее больше это объема бизнес-процессов или различных какие-то задач которые решались с помощью там того или иного технологического решения то есть Понятно Если у тебя там в табло один дашборд но его легко перевести на что бы кто угодно не было идти просто делаешь это заново там один дашборд все легко если у тебя там тысячи этих даже бордов как у нас Хотя в любом случае переезд сложный то есть нет какого-то магического конвертатора там который позволяет там тебе переехать там с одной базы на другую или с там одного Bi решения на другое на самом деле нет это в любом случае миграция которая почти всегда заставляет тебя практически заново создавать там вот твой процесс который у тебя был на новом технологическом решении поэтому давай так давай объективно Все сложно и двх перевозить сложно и Bi перевозить сложно и etl перевозить сложно Я бы сказал одинаково сложно но это надо делать то есть это сейчас нет собственно никакого другого выхода кроме Как перевозить пожалуйста скажи какие есть положительные моменты во всем этом процессе Ну смотри то есть понятно что сейчас и скорее всего ближайший там год все это достаточно серьезно и технологический вызов учитывая и сложность технологической реализации и потерю кадров которые мы сейчас там все на самом деле будут иметь вот там ближайший год-два это прям вызов серьезный достаточно но суть в том что если мы этот вызов пройдем если мы действительно сможем избавиться от вендорских решений в пользу собственных это на самом деле означает что у нас на рынке будут появляться Ну я надеюсь я в целом в это верю что у нас могут начать появляться достойные аналоги венгерских решений Причем возможно как это было например что такое можно привести из понятное вообще всем не знаю как в сфере банкингов какого-нибудь да то есть там Европа вот она на самом деле достаточно как бы консерватив это все сокращается до месяцев или годов Да ровно так понял спасибо здорово Это собственно хорошо спасибо большое тебе Максим Спасибо большое вам наши зрителей Я ваша С вами был Антон Морев мы находимся на холоде 1022 мы поговорили с Максимом бартеневым о миграции импортозамещении Big Data в МТС Максим спасибо спасибо Антон Спасибо всем Дайте Пошумим друзья просто замечательно я Антона говорю пойдем пошутим про инженекс он говорит Не знаю что шутить про инженексы не пошел Вот Но это нормально Ну да но в общем твоя задача до следующего хайлоуна найти шутки про инженекс друзья Идем дальше Напоминаю что вопросы можно задать либо в микрофон либо через чат-бота и многие наши интернет и зрители этим пользуются вот предыдущему докладчику прилетели Прямо даже неудобные вопросы это было очень приятно представляю следующих спикеров друзья Иван Валентин прошу на сцену мы с вами когда-то работали у него есть супер черта он может взять своего друга Бармена вырвать от ведерко оторвать от ведерка со льдом и превратить его фронтейндера но доклад по моему не про это в кулуарах да еще Аплодисменты друзья погнали здравствуйте Спасибо что пришли Меня зовут Иван полуянов и я сооснователь и директор по продукту веб-сервера Энджи Спасибо Лёша Для начала я расскажу о нас Кто мы такие команда Энджи На текущий момент 10 человек и я считаю что у нас действительно звездная команда потому что все 10 человек выходцы из компании инжирных Некоторые из нас работали в компании инжинекс с 2011 года у нас сложился уникальный опыт разработки инженерных с поддержке Engine X благодаря тому что мы во жены все занимались совершенно разными вещами мы писали инженекси Юнит разрабатывали реализации протоколов http2spd реализовывали систему мониторинга amplify и система управления контроллер оказывали услуги коммерческой технической поддержки нашим пользователям И разумеется мы еще писали инженекс если сложить весь наш опыт разработки и поддержки инжиникс получится 60 лет Я считаю что это действительно очень крутая цифра не секрет что в начале года по понятным причинам компания Five networks закрыла российский Московский офис разработки и поддержки инженекс но нам посчастливилось оставить нашу команду России собрать склеить ее заново и Мы приняли решение основать новую компанию наша цель развивать свой собственный форк инжинекс но привнести туда все то что так не хватало нашим пользователям в оригинальной версии Итак секунду кликер просто глючит Итак en же наш Work мы назвали Энджи и первая версия вышла 27 октября месяц назад возможно кто-то из вас читал о нас в СМИ название Энджи придумал наш звездный руководитель разработки Валентин бартенев в общем-то мне оно тоже сразу понравилось увидеть Вы сможете после моего выступления Почему Энджи спросите вы ну во-первых NG же это самая популярная песня группы Rolling Stones А созвучность с инженекс Энджи инжинекс говорит о нашей преемственности жены лично Мне всегда нравилось группа Rolling Stones Я голосовал за это название и теперь каждый раз когда вы услышите по радио может быть в баре эту песню вы всегда будете вспоминать о нашем веб-сервере это драп Ын реплейсмент инженекс он обратно совместим с инженекс 1232 также он распространяется по Open Source лицензией бсд также как оригинал я этого не делал Извините также он распространяется по Open Source лицей лицензия также как и оригинал но содержит новые фичи форкая Энджи мы для себя решили что мы будем Как можно дольше поддерживать обратную совместимость конфигурационных файлов и популярных модулей с ngnx то же касается и обратного мержа из-за мы будем делать это настолько долго насколько это будет возможно Для нас а Итак первое что вы так давно ждали от инженец но получите от Engine это будут расширенные возможности мониторинга и статистики вашего веб-сервера о них подробнее расскажут Валентин после моей секции А пока о платформах highload пока платформах на текущий момент у нас доступны пакеты для Debian 10 11 для ubunt и 20 и 22 последние три версии Alpine Разумеется докер у нас свой докер register для этого пока у нас не готов рпм Но вот вот он появится рпм будет длятся центо Стрим что касается импортозамещения мы Тестируем сборки под Астру и Alt в перспективы наверное Родос в общем-то это те три линкса которые зарубленными цифрами да кликер живёт своей жизнью так Прошу прощения техника пока вы можете попробовать прям Может на конфе на своих лэптопах скачать Наш новый веб-сервер с ng.software вопросы по конфигурации разработки фичери Квеста Вы можете задавать как на нашем гитхабе так и на нашем форуме на нашем сайте у нас открытое комьюнити и в общем-то если у вас завалялся какой-то патч может быть на ревью его захотите присылать присылайте Мы с удовольствием его посмотрим Мы в общем-то открыты и рады взаимодействовать с пользователями инженекс Да спасибо собственно ссылочки Вот видите здесь за семья удаляюсь я вернусь в конце доклада расскажу коротенько о наших планах что мы собираемся сделать И зачем мы собираемся это делать а пока я приглашаю Валентина и Валентин расскажет детально про новые фичи Спасибо Добрый день Я очень рад вас всех приветствовать и я подробнее расскажу о функционале статистике и мониторинга который мы реализовали Но сперва Давайте поговорим о тех инструментах которые уже сейчас доступны в джинсы и об их недостатках Для чего в принципе нужно статистика мониторинг Я думаю подробно рассказывать не нужно Все вы прекрасно Это представляете Если речь идет о каком-то высоко нагруженном проекте где веб-сервер или прокси сервер выполняет ключевую роль в инфраструктуре и своевременно реагировать на какие-то нештатные ситуации выявлять узкие места оптимизировать вашу конфигурацию под пиковые нагрузки так кликер опять живет своей жизнью все это критически важно для функционирования вашего веб-сервиса и соответственно функционирование бизнеса и когда мы говорим про инженекс то первое с чем мы сталкиваемся в этом контексте это его став статус модуль следующий слайд Да это его статус модуль и функциональность этого модуля крайне ограничена он отвечает своему названию То есть это затычка статуса и предоставляется его порядка пяти глобальных счетчиков соответственно никакой детальной информации о функционировании веб-сервера из него вы не получите Поэтому в итоге большинство из вас прибегает к парсингу логов ngx но у данного метода также есть свои недостатки и это как и накладные расходы причем опять что-то происходит пардон Да в случае парсингологов у вас есть накладные расходы как на генерацию логов и их последующий разбор так и если вы пишете их на диск вы загружаете дисковую подсистему вашего сервера Если вы отправляете логи по сети то вы загружаете сетевую подсистему сервера и на пиковых нагрузках объем генерируемых логов достаточно велик и лучше бы сэкономить эти ресурсы для обслуживания дополнительных запросов от клиентов а другой недостаток логов это их ограниченность в плане конфигурации вы заранее должны задать в конфигурации формат логов используя для этого те переменные которые доступны вам в инженекс тот ограниченный набор переменных и второе это то что вы фактически имея дело с логами Вы имеете дело уже с прошедшей истории поскольку логи в инженексики пишутся по завершению обработки запроса либо случае Стрим модуля по завершению сессии то есть из блогов и в принципе не видите что в настоящий момент в реальном времени происходит с вашим сервером Некоторые из вас применяют сторонние модули но особенность заключается в том что некоторые полезные метрики в принципе невозможно реализовать в рамках стороннего модуля у инженекса для этого не соответствующих хуков и интерфейсов и тут получается та же проблема что из парсингом логов в плане ограниченности возможностей таких метрик плюс многие модули не отличаются своей стабильностью и не всегда авторы поспевают за обновлениями в результате многие из вас пишут какие-то свои велосипеды на базе луа модуля и недостатки этого подхода это начиная от того что вам необходимо поддерживать свой велосипед плюс те же самые недостатки что и у сторонних модулей Вот например последние последний релиз луа модуля он в принципе не совместим с последней веткой 123 который уже появилась где-то полгода назад и то что вам остается в итоге это проприетарная платная версия инженекс плюс а которая в настоящий момент просто недоступна в России ну и не каждый готов использовать какой-то проприетарное решение на своем сервисе Но если так следующий слайд Надеюсь переключится Да если вы Установите Engine то вы получите доступ к очень удобному очень гибкому интерфейсу с огромным количеством метрик в формате json и настоящий момент мы первым форматом реализовали json но в последующем мы думаем также добавить поддержку других форматов например актуален прометейл с возможно добавим xml gson выбран был потому что во-первых это такой мейнстрим формат веб-среде и вы можете работать с Джейсон практически в любом языке программирования Вы можете работать здесь он нативно прямо в браузере То есть добавить какие-то Циферки какие-то метрики а себя на веб-сайт или на веб- панель управления вашим сервером Ну и Кроме того еще одно достоинство Джейсона Это то что он в принципе человека читаем То есть нормально отформатированный Джейсон можно читать прямо в консоли плюс это также формат структурированный То есть когда у нас огромное количество метрик мы имеем дело с большим количеством данных то лучше бы как-то чтобы они были хорошо структурированы и разложены по отдельным под объектам дает доступ к огромному количеству метрик это и метрики по DNS resolve ru по кэшу по tls соединениям шейком по http как виртуальным сервером так и локейшеном по зонам разделяемой памяти Я чуть подробнее про них расскажу дальше также мы в ближайшей версии которая скорее всего выйдет До конца года добавим метрики по обстрелу как все это выглядит в динамике вы сейчас увидите на следующем слайде это вот полный полная выдача всего Джейсона с одного из серверов то есть метрик очень много сейчас мы по ним подробнее пройдемся Ну а вот так вот наша команда поддержки умеет это настраивать вживую красиво графически Итак первая информация которая вам доступна через этот Интерфейс это базовая информация о вашем экземпляре сервера То есть это его версия в данном случае версии NG 1.00 я подчеркиваю что это стабильная версия стабильный релиз То есть вы можете прямо сейчас его скачивать ставить продакшн вам доступен ip-адрес время загрузки конфигурации и Generation это поколение То есть каждый раз когда вы делаете reload конфигурации у вас этот счётчик увеличивается на единичку таким образом вы можете отслеживать изменения вашей конфигурации произошли они не произошли и так далее прискочила Прошу прощения Итак следующий набор метрик это глобальные счетчики соединений тут вы видите количество принятых соединений количество соединений которые были отклонены по причине исчерпания на вашем сервере доступных серверу дескрипторов либо если вы уперлись в лимит worker connections то есть рост этого счетчика явно говорит о том что вам что-то нужно поправить в конфигурации также у вас количество активных соединений это те соединения в которых есть обрабатываются какие-то запросы и неактивных айдол соединение - это те соединения то есть в случае с p1-11 - это типа Live соединение в случае с ep2 это будут соединение в которых просто настоящий момент нет активных запросов Да следующий набор метрик это подробная информация по зонам разделяемой памяти зоны разделяемой памяти в конфигурации используется во многих директивах и часто встает вопрос А как собственным правильно выбирать ему размер Правильно ли подобран размер Если вы укажетесь слишком большой объем у вас будут напрасно расходоваться там ресурсы Если вы укажетесь слишком маленький то будут разные неприятные эффекты и вот данная статистика позволяет вам видеть насколько вообще расходуется память с конфигурированные зоне разделяемой памяти то есть сколько страничек задействовано а также каждая страничка делится на отдельные сегменты и даётся подробная информация о том как собственно задействованы эти сегменты То есть вы можете видеть фактически фрагментацию вашей памяти следующий набор метрик касается DNS resolvera То есть вы можете видеть Сколько было запросов на разрешение доменных имен Сколько было обратно DNS запросов на преобразование IP адресов доменное имя и ответы вашего DNS сервера То есть если у вас какие-то проблемы с сервером то вы это сможете сразу оперативно увидеть и принять какие-то меры то есть проблема с коннективите Либо вы что-то где-то ошиблись в конфигурации указали не то домены имя и у вас будет расти счётчик следующий набор метрик он касается http То есть вы можете собирать метрики как по отдельному виртуальным серверам так и в том числе по локейшинам и вы видите метрики по tls соединениям если у вас данные виртуальный сервер обслуживает https соединение То есть вы видите количество хэшейков которые произошло Вы можете видеть насколько эффективно работает ваш тсессии или когда происходит полноценный хэшей Когда происходит а рею сессии Также вы можете видеть какие-то проблемы типа тайм-аутов или а ошибок хэшейка далее если хэшейк уже произошел успешно вы видите опять же метрики по запросам как общее количество запросов так и количество запросов которые обрабатываются в данной конкретной зоне виртуальных серверов или Ну или Location of и вы можете видеть количество запросов которые были отклонены это происходит в том случае если ответ клиенту еще не было отправлен когда ответ клиенту уже был отправлен то вы можете видеть детальную информацию по годам ответа и также фиксировать какие-то допустим аномалии или проблемы если у вас начинает неожиданно расти количество ошибок там 403 404 или не дай Бог каких-то 500 то вы это сразу сможете заметить Ну и также информация по количеству принятых и отправленных байт в данный конкретной зоне точно такой же похожий набор метрик только уже касается Стрим модуля в данном случае мы уже оперируем не соединение не реквестами А сессиями стрима и тоже все очень похоже То есть вы видите как количество обработанных настоящий момент сессии так и итоги их обработки статуса их завершения Ну и количество также отправленных принятых байт всё это настраивается гибко отдельный сервер в стриме также подробно подробная статистика по кэшу ищете пи ответов Вы можете видеть насколько ваш кэш используется в данном случае видно что он не используется занятый размер и количество обслуженных запросов с тем или иным статусом то есть сколько запросов было отдано из США Сколько прошло мимо каша Сколько было запросов на обновление кэша и та же самая информация только уже в байтах плюс информация Сколько было записано собственно на диск тоже с разными статусами а следующий набор метрик касается у нас всяких лимитов то есть модули лимит клоны лимитрияк который используется для ограничения либо количества частоты запросов либо их одновременного количества и встает задача Как правильно подобрать эти ограничения и данной метрики опять же вам помогут потому что вы можете наблюдать в реальном времени сколько у вас запросов прошло Через ограничения Сколько было пропущено либо отклонено задержано либо вот счётчик экзорцев показывает когда зона разделяемая памяти которая используется для данного данной директивы лимитрия лимиткон заполнилось и просто нету больше места и тогда эти запросы отклоняются по причине это коротенечко все по метрикам и их огромное количество и естественно мы предусмотрели возможность запрашивать их гранулярно то есть интерфейс очень гибкий Вот как я уже говорил что Джейсон имеет структуру это структура в виде дерева и вы можете запросами ходить по этому дереву точно так же как по файловой системе То есть вы можете запросить Все метрики вы можете запросить метрики только по отдельным виртуальному серверу как экземплкон в данном случае Либо вы можете запросить даже просто одну циферку это число один счетчик 404 запросов в данном сервере всё это интуитивно понятно и запросы составляются просто Глядя на общий json поскольку интерфейс повторяет его структура а структура json повторяет интерфейс как это все выглядит в динамике вот на следующем слайде мы запросили полный объем статистики дальше мы запросим конкретно так почему-то гифка обрезалась и не воспроизводится дальше извините так что не получится показать Ну ладно пойдем дальше Итак как все это сконфигурировать простейший конфигурация выглядит действительно просто указываете директиву API влакишине в этом локейшене У Вас получается полный доступ ко всему интерфейсу но в этом интерфейсе У нас сейчас есть секция статус которая отвечает за статистику за метрики но в будущем Мы также планируем добавлять разные дополнительные интерфейсы в том числе управления поэтому мы заранее уже предусмотрели возможность ограничения доступа гранулярного доступа к этому интерфейсу и вот следующий пример уже более сложные конфигурации в данном случае у нас разрешен доступ ко всем метрикам с Local Hasta и в то же время вот администратор этого сервера почему-то решил дать отдельно доступ к метрикам по своему блогу и защитил его также простейший аутентификации Но это еще не все кому этого мало вот есть еще более крутая конфигурация То есть когда вам нужно вообще Вас не устраивает по какой-то причине те пути тот интерфейс который мы предоставляем вы хотите его как-то перезаписать то есть делать рерайт переопределить э-э Вы можете для этого использовать locations регулярными выражениями и переменные внутри директивы API А собственно директивы опиано указывает уже путь который будет Вот внутри дерева нашего апель выше этого путя подняться нельзя То есть вы лимитируете доступ в данный секции а что касается метрик по отдельным виртуальным серверам и локейшеном то конфигурация они очень просто То есть вы можете собирать метрики сразу с нескольких виртуальных серверов в одни и те же счетчики То есть вы Для этого просто указываете директиву статус зон с одним названием в некоторых в нескольких виртуальных серверах или в нескольких локейшинах если вы с нескольких локейшиных хотите одни и те же счетчики а считать либо Если вы хотите считать сервера или локейшие отдельно вы указываете придумаете для них разные названия всё это можно как группировать так и считать отдельно Как Вам угодно итак так перескочили Если вы заинтересовались Я думаю что вы заинтересовались и Хотите попробовать Энже как уже Иван говорил это Drop in replaceman То есть он будет работать с той конфигурацией которая у вас есть но поскольку пути установки отличаются То вам придется скопировать вашу конфигурацию сделано это в том числе для того чтобы Вы могли параллельно поставить инженец и Энджи и они друг друга не мешали и пробовать А переезжать также так перескочила также если естественно если у вас настроен какой-то мониторинг и он смотрит например на заголовок сервер или настроен сислок то нужно учитывать что заголовок сервер теперь отличается и слог тег по умолчанию тоже отличается Да что ж такое-то оно листается в противоположную сторону Хотя я нажимаю нажат О вот отлично И последнее Что нужно учитывать это то что мы отказались от дальнейшей поддержки нативного Win32 API И тут какая ситуация сейчас объясню Дело в том что в женексе есть нативная поддержка им 32p и она пребывает перманентной бета-версии то есть с ограничением как по производительности так и по функциональности и это связано с архитектурными особенностями Джин икса чтобы преодолеть эти ограничения нужно на самом деле приписать многие внутренние механизмы в то же время в современных версиях Windows есть такая штука Как Windows со всей симфора Linux вот и она прекрасно работает Она позволяет вам запускать сборки по длину на Windows и такие сборки работают гораздо лучше чем вот эта нативная версия инжинекса поэтому мы решили что нет смысла продолжать дальше пинать эту мёртвую лошадь Да поддерживать эту нативную сборку лучше потратить ресурсы на реализацию новой функциональности а пользователи Windows будут использовать vsl2 и прекрасно себя чувствовать без каких-либо ограничений бета-версии нативной поддержки и на этом У меня всё я приглашаю Ивана чтобы Он кратенько рассказал о некоторых из наших планов так работать относительно Окей хорошо Ну и за кликеров никакой интриги уже к сожалению в общем разрабатывая NG же Мы двигаемся короткими итерациями поэтому я не буду заглядывать слишком глубоко в backlock А вот планы на ближайшие пару итераций расскажу собственно то что так давно ждали это динамический обстримы необходимость в этой фиче назрела уже очень давно поскольку мы живем во времена всяких серых с мышей Прости Господи докеров и прочего прочего соответственно нужно какой-то способ динамического управления обстримами мы это реализовали самое прикольное то что не так давно я встречал ребят которые используют полузаброшенные форк инженекс Engine только из-за того что там есть динамический обстрелы собственно это функциональность позволит налету реконфигурировать пиры в обстрим-группах управлять весами в общем-то делать все то что можно делать в конфигурационном файле инженекса но динамически через rest интерфейспресс-интерфейс соответственно там реализована персистенции то есть меняя конфигурацию вам не надо думать о том что А что если ваш сервер упадет С какой конфигурации вы подниметесь вы всегда поднимитесь со своей последней конфигурации которая будет предварительно сдамлена на диск Ну фича в общем-то достаточно понятная и релиз будет в декабре соответственно где-то концу декабря мы эту фичу зарелизм асинхронность его юринк ну вообще тема io-ринга в контекстежиных заслуживает вообще отдельного доклада и исследования глубокого быстро так расскажу это новый способ не блокирующей работы с файловыми дискрипторами разработанных компаний Facebook достаточно модные популярные сейчас штука И могу только сказать что мы активно на него смотрим И будем его реализовывать как альтернативу на котором общем-то крутится жены своей синтаксический сахар в конфигах вообще планов много расскажу о наболевшем но самый популярный такой кейс который мы хотим пофиксить это когда у вас есть несколько Location of и они все имеют одинаковую конфигурацию когда конфигурация сводится к директиве Алия срут и еще что-то там в принципе как можно копипастить ничего плохого в этом нет но как только у вас конфигурация каждого Location превращается в простоню вот эта вся копипаста может доставить много болей вы что-то начнёте терять упускать не консистентность и в общем все станет Плохо Ну как бы вот из ближайшего мы вот сделаем такой синтаксис который явно не в ряде случаев облегчат ваши конфиги теперь самый наболевшее Ну и смешное на самом деле и в конфигурации уверен что многие из вас знают либо натыкались что их в конфигурации женыкса работает не так как хотелось бы и не так как языках программирования каждый год на хаббре появляется какой-нибудь блокпост где еще один человек рассказывает как и в конфигурация работает и как это плохо и так далее на садик на стадия кстати привел пару примеров с нашего запуска это реальный комментарий людей из блокпостов которые куда кто Вот кто это сделал пустые руки это реальные комментарии людей в блокпостов когда они реально вот заливают свою боль что вот If Извините в инженец плохой Он не работает К сожалению и в пофиксить просто не можем Ну по архитектурным соображениям но будем искать ему какую-то альтернативу для ряда кейсов мы что-нибудь придумаем с этим по крайней мере есть идеи в планах это есть обратите кстати внимание Вот меня порадовал Как работает и выраженных во всем мире знает человек 10 и вы не явно не в их числе это правдиво лишь отчасти на самом деле Я считаю что в мире знает как работает If Engine x20 человек но 10 из них работают у нас завершение Хочу снова попросить пожалуйста заходите ставьте заходите на github оставляйте свои вопросы по request и там фичери квесты также заходите на наш форум задавайте вопросы Мы оперативно отвечаем на них И вот в общем-то наверное все спасибо что послушали пришли сюда мы готовы к вашим вопросам Ты знаешь да что произошло вчера мы поставили кликеры на ночь заряжаться а потом мне уже рассказали сторож уходя вырубил свет такой нормально сразу из чатика вопрос друзья Готовьте вопросы пожалуйста насколько Энджи готов в качестве куберетесь ингрис контроллер планы есть но он в принципе тот ингресс-контроллер который есть он раз раз контроллер который есть с инженексом но можно его там допилить можно допилить когда когда Ну асап асап если запрос есть Значит мы динамично развивающиеся компании Алексей Смирнов ждет вот фотография это оно естественно это персонифицированный запрос красивый мужчина подходите Сейчас секунду у кого микрофон сейчас будем передавать да девушка с микрофоном проходит мимо махните Добрый день Спасибо большое интересный доклад обязательно возьмем на тестирование посмотрим как все работает один маленький вопрос в конфигурации проходила outbace Планируется ли внедрение там спамовской системы безопасность чтобы интеграция была или там с чем-то ещё Ну смотрите вот на данный момент конкретные таких каких-то конкретных планов нет но мы э естественно рассматриваем разные варианты и э хорошая хорошая идея будет прийти к нам и оставить квест чтобы э соответственно мы могли как-то этот трекать в том числе интерес к комьюнити кто или иной фиче спасибо Вот будь собой Спасибо за доклад у меня такой вопрос насколько вы проводили бенчмарки насколько сильно сбор статистики начинает влиять на перфоманс абсолютно не влияет он на самом деле использует те же самые структуры которые так есть и такой вопрос Вы сейчас как бы отпоркнулись и все Или у Вас планируется дальше поддерживать Я вроде сказал изначально докладывать что мы будем мержить в себя и затаскивать себя оригинальную так долго насколько мы просто это всё переварим ну потому что мы можем сильно разъехаться и соответственно уже не сможем это дальше делать Обычно такие фразы заканчиваются Если ты готов нам помочь вот моя визитка Да Пожалуйста Спасибо ребят доклад очень интересно А можно чуть-чуть и про технику вот женился экономика Понятно есть комьюнити версия есть платный плюс Как вы планируете то есть поддержка или у вас будет там свой там не знаю плюс или что-то ещё то есть как планируется мы сейчас прорабатываем разные модели э на самом деле после запуска интерес совершенно с от разных компаний к нам и всем на самом деле нужна разная модель кому-то нужен условный условный плюс да э с каким-то с фичами которые там не знаю не нужны там другим людям а кому-то нужен там типа такой опенсорс и он готов там финансировать это тот сорс чтобы это всё было у папы то есть ну если Наша компания всего 3 месяца и мы сейчас на этапе как раз становление нашей бизнес-модели Спасибо Удачи вам ребята это прямо Здорово спасибо Вот слева будь добры здрасьте а у меня такой вопрос А будет ли реализованные активные Health чеки вообще планируется это или нет так вот такой пункт влоги есть это отлично Спасибо да да и Help чеки надо тоже делать всем Это нервы пожалуйста Добрый день спасибо за доклад на гитхабе существует Fork комьюнити версии которые используют не ядерный стек апедики смотрели ту сторону и планируете ли развиваться Спасибо наверное пока мы не готовы к всяким таким кардинальным экспериментом я больше скажу что есть я слышал про которого вместо rb3 используется ордер Map плюсовой и он быстрее Но это опять же это серия как бы каких-то на мой взгляд либо узких либо достаточно непроверенных решений То есть у нас пока просто физически нет на это сил но мы Кругозор расширять Да да у вас есть такой же на с перламутровыми что-то вроде от Олега вопрос Вы будете не Бунина вы будете делиться своими наработками с F5 Ну проект соответственно лицензия такая же bsd и все Что разрешено лицензии то разрешено лицензии Мы как-то специально слатим патчи не планируем А так если они что-то возьму значит Они возьмут на условиях этой лицензии Ну я я от себя добавлю что если действительно как бы всё будет хорошо и мы в каких-то местах будем что-то Open Source и нам будет проще это затащить его жена чтобы дальше высасывать инженекс и мир жить к себе и если же X продолжит развеваться в принципе да там в течение ближайших нескольких лет то да Наверное мы будем чем-то делиться вот так вот типа Нате Возьмите но не факт что они будут принимать отлично всем в процессе успехов если метрики Энджи сразу в формате на самом деле у нас есть такая фича именно на оси но у нас на следующей неделе будет пост на хаббре где будет описание того как с помощью ngs написать handler который конвертирует в прометеос буквально Там две строчки в конфиге и все заработает но в перспективе Мы конечно же сделаем этот транспортным прям докладе что мы рассматриваем разные форматы поддержку то есть будем расширять сейчас это json но возможно также добавим Прометей может быть xml может быть что-то еще посмотрим какие будут запросы какие будут хотелки Спасибо и финальный на сегодня а нет предфинальный вопрос Да пожалуйста Добрый день У меня такой вопрос Вы говорите что у вас очень много в блоги есть а можно ли его увидеть А еще лучше на него как-то влиять и приоритизировать комьюнити сообщество скриншот backlock есть в тележке где-то переслать это солнце это вообще тема злая на самом деле но я повторюсь Наша компания вообще проекты вот три месяца мы за 3 месяца полностью формулировался ещё успели туда что-то Дописать и в процессе становления нас как какого-то большого чего-то такого Open Source но там Всероссийского Всемирного Да мы конечно будем прорабатывать модель Когда наши кастомеры и лекарствами просто члены комьюнити смогут там условно заходить голосовалку в какой-нибудь и говорить я это хочу но как бы покажешь я не вижу как бы необходимости в этом Потому что и так можно как бы скинуть свои фичери квест Да и скорее всего этот фичери квест есть в нашем здоровенном идеи листья с идеями и в итоге тем не менее Заходите на сайт на заходите на github оставляйте ваши пожелания Да мы их все безусловно учитываем записываем и пока молодой человек задает финальный вопрос Вы думаете кому подарить игрушку за последний за лучший вопрос вот Ну может быть это будет лучший Да пожалуйста Здравствуйте спасибо за доклад вопрос совсем простое То есть вы говорите что у вас будет кодовая совместимость джинксом до какого-то времени но у вас уже есть какие-то небольшие расхождения и я так понимаю они будут копиться со временем Как вы планируете поступать с плагинами джинса То есть вы планируете их форкать или чтобы авторы дорабатывали чтобы с этим смотрите сейчас по большей части расхождений которые как-то бы влияли существенно на сторонние модули у нас нет то есть большинство сторонних модулей спокойно как собирались ониксом так они будут собираться сэнджа и по возможности мы естественно будем Как можно дольше это поддерживать с одной стороны с другой стороны в идеале Да лучше если мы будем двигаться в том направлении Когда вам в принципе не нужны будут сторонние модули все будет уже из коробки Я думаю что такая модель она будет наиболее интересный плюс Скоро у нас в репозитории также появится сборки сторонних модулей поднджи То есть вы сможете их ставить к своему вебинару в бинарном виде инсталляции они уже будут собраны вам не нужно будет что-то сами не собирать собранный протестированный то есть будут будут все модули в репозитории Как вы догадываетесь у ребят спустя три месяца работы пока нет стенда Фая поэтому сейчас мы закончим Вы спокойно к ним подходите и кулуарите просто вот на все деньги потому что до следующего доклада еще достаточно времени ребята Спасибо большое за выступление за все что вы делаете Красавцы от конференции и скажите кому подарим вот этого зверя за лучший вопрос за F5 отлично Это значит что мы должны найти этого человека который через интернет задался вопрос либо если вы задали этот вопрос про F5 Сидя в зале Подойдите пожалуйста к волонтеру со своей тележкой отлично Друзья поехали дальше Спасибо всем и вот сидят наши коллеги тоже пожалуйста Встаньте подходите к ним задавайте вопросы е что происходит Дальше А дальше в 15:40 через 13 минут здесь тех ток Россельхозбанка и 1550 коллега из Билайна будет рассказывать про повышение точности работы сотового оператора 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений 1С предприятие лоукод платформа для быстрой разработки облачных десктопных и мобильных бизнес-приложений Всем привет Это Hello 2022 Меня зовут Андрей Смирнов из Эксперт тех и подкастов от Weekend и у меня в гостях Роман бодреев начальник отдела сопровождения систем дистанционного банковского обслуживания для физических лиц Рома привет Всем привет собственно очень длинная должность можешь чуть вот более понятным для наших зрителей языком рассказать вообще что такое дистанционное банковское обслуживание Что ты делаешь Чем занимаешься в компании Ну вообще наш отдел занимается поддержкой и мониторингом системы debo вот дебло физических лиц то есть мы обслуживаем только физиков системы которая позволяет получать информацию обо всех операциях клиента банка выполнять платежные операции Ну и различного рода другие операции Причем возможно выполнять эти операции независимо от местоположения клиент может находиться Как в России так и за рубежом В нашем банке система представлена то есть есть доступ через два канала это интернет-банк и мобильное приложение интернет-банк у нас доступен через браузеры в которой можно зайти через десктопы мобильные телефоны планшеты и также мобильное приложение которое доступно для скачивания в различных маркетах AppStore Google Play Market и другие наш отдел занимается поддержкой этой системы Какие вообще этапы развития были вот у вашей ДБО то есть что-то там появилось сначала Как вы делаете ваш банк актуальным и соответствующим запросу пользователей в России на текущий момент примерно 3-4 года назад заметив тенденцию просто активности и заинтересованности клиентов ГБО также высокие темпы развития именно мобильного банка пересмотрели немного подходы разработали именно свою стратегию развития самой системы первое что мы сделали пересмотрели кардинально архитектуру системы вот на текущий момент система у нас расположена в двух дата-центрах которые работают в режиме Active Active также в работе ДБО мы применили паттерн под названием циркут брейкер и это позволило нам добиться сохранить доступность клиентов а также ряда функций для клиентов Когда у нас возникают проблемы на ядре банка на бэкэнде это некие блокировщик запросов То есть когда у нас система смежная перестает отвечать какая-то идет деградация недоступной системы включается блокировка и система wfl не направляет запросы и не ждет ответов достаточно Долгих в случае недоступности мы просто включаем этот барьер и позволяем клиентам получать немного ограниченный функционал то есть хотя бы зайти в дбок посмотреть из кэша информацию необходимую там актуальные остатки вот после применения этого паттерна мы еще дополнительно разработали функцию которая позволяет выполнять опять же ряд транзакций в случае недоступности То есть первый этап это мы включаем блокировку вот а дальше мы позволили клиентам не только заходить в дебуи смотреть информацию по своим счетам продуктам но и позволили выполнить ряд транзакций то есть именно в момент сбоя бывают такие сбои кратковременные пятиминутные либо регламентные работы на смежных системах и в эти периоды как раз мы клиентов полностью не ограничиваем использование То есть получается раньше когда был какой-то техническое обслуживание то клиент в принципе не мог попасть в свой там личный кабинет посмотреть ничего сейчас у него просто ограничивается какой-то доступ к определенным функционалу Да ограничивается доступ к функционалу То есть он может посмотреть список своих продуктов какой последней актуальный остаток у него был на момент последнего момент последний авторизации системы и также мы позволяем выполнить ряд транзакций то есть в основном это популярные переводы между своими счетами переводы карты наиболее востребованы при этом эти сбои они по каким причинам могут случаться и насколько вообще проще написать Вот такую штуку как написали Вы или лучше потратить время на снижение количества таких сбоев наша команда работают во всех направлениях то есть мы снижаем количество таких сбоев и снижа зависимость между систем для того чтобы исключить подобную ситуацию Вот и с каждым годом все реже и реже мы сталкиваемся как раз с такими глобальными проблемами а как вас происходит именно вот какой-то внедрение новых фич то есть грубо говоря там продуктовано придумал какую-то штуку которую нужно добавить в ДБО соответственно ее нужно сделать для мобильных приложений там на iOS Android и нужно сделать для банка в браузере как это делают там параллельно разные команды или вы как-то пытаетесь придумать входные пути или делать это в разных порядках не делает это одна команда единственное есть различия разработчиков то есть есть разработчики которые разрабатывают именно серверную часть которая отвечает за интернет-банк А есть выделенные мобильные разработчик все занимается твоя команда нет здесь задействовано много команд то есть отде надо тестирования функционального отдельная команда именно разработчиков внедрения отдельная команда регрессионного тестирования отдельная командагрузочного тестирования вот мы отвечаем за внедрение уже на предпромышленную среду промышленную среду вот так же раза публикацию мобильных приложений в маркетах кстати про публикацию приложений в маркеты сейчас с учетом всей ситуации в мире кажется появляются какие-то проблемы с выкладыванием некоторых приложений сторы Особенно это связано с айосом Как вы пытаетесь предугадать ситуацию и понять коснется ли это вас пытается ли вы придумать Возможно на этот случай какие-то заранее тоже фишки и что такое Но мы с самого начала когда началась данная ситуация начали думать Каким образом нам закрыть все риски и исключить потенциальные проблемы в случае если наше мобильное приложение заблокирует зарубежных маркетах и если с Андроидом Мы в принципе достаточно быстро нашли решение и у нас наверное параллельно появились наши российские Маркет это наша сторону вот Android приложение мы уже Разместили в российских маркетах Вот и на данный момент наши клиенты уже активно используют то есть устанавливают используют мобильное приложение что касается iOS Да здесь возникли некие трудности потому что Apple запрещает официально устанавливать приложения не из источника AppStore вот поэтому нашей командой был разработан некий модуль это адаптированная версия мобильного приложения и данный модуль позволяет сохранить возможность для клиентов использовать привычный интерфейс мобильного приложения но только не через иконку приложения как обычно А через браузер на телефоне данный модуль У нас сейчас проходит уже завершающие этапы тестирования Ну и надеюсь то что в ближайшее время мы разместим это на всех клиентов получается что в целом вот опять же вы уже клиентов вы полностью готовы к каким-то плохим последствиям которые могут произойти до готова То есть у нас сейчас получается открытая достаточно много каналов это Маркет AppStore Google Play Market наш store.ru Store плюс Huawei gallary и скором времени появится адаптированная версия через браузер а насколько вообще у вас высоко нагружены ДБО то есть насколько там огромное количество пользователей на мобильных приложениях на браузере На текущий момент по статистике у нас количество зарегистрированных пользователей в ДБО уже более 5 миллионов ежедневно выполняется порядка 230-250 тысяч операций в процентном соотношении в части распределения пользователей интернет-банка и мобильного приложения Это примерно 90 на 10 то есть 90 процентов мобильное приложение 10 процентов интернет-банка Ну и также по операциям то есть больше операция выполняется мобильном приложении А вот по поводу этой статистики 90 на 10 насколько вы отслеживали как она менялась за вот последние пять лет что появился у вас ДБО если еще не путаете Сколько было в начале например было 11 процентов мобильного приложения 70 интернет постепенно набирали популярность Как вы думаете можно ли будет в какой-то момент вообще отказаться от браузера и просто полностью делать только опять же там мобильные приложения mobilefies приложение именно от десктопного в широкоформатного вот этого представления банка уйти с учетом распределения пользователей я думаю останется часть клиентов которым все равно привычно заходить в интернет-банк через браузер поэтому полностью отказаться мы не планируем Спасибо большое Роман за интервью Да был очень интересно мы на холоде 2022 С вами был Андрей Смирнов из X5 тихо подкастов от Weekend До новых встреч пока пока Привет друзья едем дальше издалека кажется что на моей футболке флаг но нет это бекон так вот страна которая популяризировала бекон славилась тем что в ней запустилась первая первая такое uber такси и Однажды когда еще можно было путешествовать Я разговаривал с водителем в нью-йорке и он говорит Слушай терпеть не могу забирать пассажиров на Манхэттене Почему Потому что очень часто система ошибается Где я стою куда я подъехал Где стоит клиент откуда он подъехал это он еще не знал о том как в Москве можно остановиться на 5 секунд за 3000 рублей потому что все в камерах Я не уверен что Артём будет рассказывать ровно об этом но Встречайте следующего спикера погнали дальше Здравствуйте коллеги я рад что вы пришли на мой доклад накануне Я думал как его начать и вспомнил что почти в этих же числах ровно год назад Я выступал на другой конференции она тоже была пройти но там больше было дата Санса собственно я именно оттуда и я сегодня представляю секцию алгоритмов и на главной сцене и в целом на хэллоуиде Я рад что в этом году мы уже выступаем в оффлайне и все мероприятия уже возвращаются в зал и мы можем пообщаться потом встретиться поговорить и обсудить то чем мы занимаемся Кстати меня зовут Коллегин Артем я уже пять лет в анализе данных сейчас я работаю в Билайне раньше эта компания называлась вымпелком сейчас Билайн но в целом цвета остаются И мы продолжаем расти Если говорить о себе Я закончил в МК МГУ и также прошел первый набор академии больших данных Mate помимо опыта в телекомах Я работал геоданные в банках делал сервисы для такси курьеров и работал естественно стартапе Привет сегодня мы поговорим про довольно насущную для бизнесов И в частности телекомов тему это анализ передвижения пользователей сегодня компании собирающие подобные геоданные могут решать не только типовые операционные задачи но и создавать социально и жизненно значимые сервисы помогающие в решении задач как планирование сетей дорог так и в поиске спасения людей план сегодняшнего доклада представлен на слайде фундаментальные задачи для использования подобных данных является поиск местоположения пользователя заданной точностью первый логичный вопрос Зачем нам вообще решать эту задачу В первую очередь это поиск абонентов на территории эти данные нам помогают оптимизировать радио сеть и строить новые базовые станции другой широко распространенный кейс это агрегация данных для поиска точек притяжение где абоненты проводят максимальное время довольно известная История это витрина дом работа собственно Где мы находимся в дневные часы и ночные такая информация нам помогает оптимальнее планировать размещение наружной рекламы и офисов продаж мы можем выделить топ локации абонентов нужный нам аудитории также для домашнего интернета Мы можем анализировать Новые дома и принимать решение где много наших абонентов и проводить туда сеть шпд Если говорить о внешнем монетизации то для наших любимых B2B клиентов Мы также изучаем тренды поведения Конечно сначала мы эти данные обезличиваем Я агрегируем до уровня исследуемой территории ничего от нас никуда не уходит также у нас есть открытое решение которое вы можете попробовать у себя в работе первые две недели это даже бесплатно это Билайн геоаналитика в целом как у любого большого бизнеса который работает с геоданными мы предоставляем эти услуги на внешних подрядчиков помимо внутреннего бизнеса мы решаем и социальные задачи для гео основной является поиск местоположения пропавших людей мы это делаем Уже довольно давно где-то с 2012 года нашим основным партнером является поисково-спасательный отряд Лиза Аллен и за последние несколько лет мы нашли более 100 человек с помощью нашей нейросети которая отсматривает фотографии и помогает в этой рутинной работе помимо этого мы также внедрили платформу Билайн поиск который отправляет смс-сообщение людям которые были свидетелем пропажи человека то есть если вы недавно с этим человеком коммуницировали или пересекались мы вам отправим сообщение и скажем что твой друг Вася или Петя пропал Может быть ты знаешь где он также в этом году был запущен Пилот с X5 в частности на экранах магазинах Пятерочка в Москве выводится ориентировки пропавших людей если эти люди пропали в этом районе на самом деле если вы не видите каких-то ноток пересечения с вашим бизнесом это не значит что пора уже вставать и уходить с моего доклада вроде никто не ушел в любом крупном и среднем бизнесе есть подобные геоданные даже если они не генерятся в реальном времени если говорить ритейлерах или маркетплейсах это заказов конкретные пункты выдачи и посещение магазинов эти данные вы можете использовать для каннибализации анализа конкуренции аудитории объекта если говорить про банки это входы в мобильные приложения и покупки на пост терминалах мы видим транзакционную активность точнее банки видят и по ним могут сегментировать клиентов выделять высокодоходные места также для бизнеса такси и курьеров есть информация о местах подачи заказов то куда люди направляются эту информацию они также используют для того чтобы рассчитывать коэффициенты повышенного спроса и для анализа числа Паши которые нужно выводить на линию как я сказал до этого у нас тоже нет доступа к GPS данным но у нас есть базовые станции на самом деле базовая станция простыми словами это комплекс антенн который принимает и передает сигналы телефона к телефону они раскиданы на каждом углу Но если быть точнее на каждом столбе у них есть два основных параметра это высота крепления для того чтобы охватывать наиболее эффективную зону покрытия чтобы вы даже находясь на трассе или сидя у себя дома могли серфить в интернете или звонить своим друзьям коллегам и родственникам и конечно базовых станций должно быть много чтобы крупных мегаполисах никто не жаловался на скорость передачи информации Поэтому нам нужна высокая пропускная способность Если какие базовые станции вообще бывают они бывают трех типов если как я сказал говорить о каких-то высокоскоростных трассах нам нужны макросоты которые закрывают десятки километров событий также они ставятся на Дачной и загородной местности чтобы у всех тоже был Интернет если говорить про внутренние помещения когда же Крокус здесь установлены фемто соты которые являются своеобразным передатчиком или маршрутизатором сети ваших звонков на основные базовые станции если разбирать конкретную базовую станцию есть несколько параметров которые нам также понадобятся позже лак это логическое объединение группы сот Если вы хотите кому-то позвонить Тем более если хотят позвонить Вам базовые станции даже в своей на более верхнем уровне должны знать где вы примерно находитесь чтобы сигнал до вас прошел также каждая базовая станция делится на ячейки или соты это отдельные сектора базовых станций которые направлены в определенную зону То есть у них есть своя зона свечения и также радиус покрытия и из-за преломления и перенагрузок можно выделить как теоретическое покрытие базовой станции так и фактически для того чтобы для того чем мы все здесь сегодня занимаемся нам нужна валидация GPS треки GPS треков по абонентов у нас нету но у нас есть свои GPS треки по нашим внутренним сотрудникам и по Drive тестом драйв тесты это такие машинки которые ездят по разным городам и оценивают постоянный генератор трафик и оценивают насколько хорошее у нас покрытие сети на самом деле пока мы не перешли к основной части хочется сказать что гео сегодня это действительно круто почти любой большой и средний бизнес сегодня пытается получить дополнительный вылью именно из геоданных из их объема из-за того что они частично открыты и их деперсонализированности и агрегационной способности мы пытаемся анализировать тренды перейдем к решению Наверняка вы слышали такой термин как триангуляция Когда происходит звонок или другой любое действие у нас абонент получает связь связь А мы на базовой станции получаем набор событий лак SL как было сказано Ранее по лаку и соло У нас есть какая-то зона покрытия то есть мы уже знаем что он находится в окрестности этой базовой станции если он находится в окрестности базовой станции ТО в динамике мы можем знать несколько базовых станций или воспользоваться каким-нибудь справочником соседства тогда мы уже для уточнения местоположения можем использовать не просто радиус свечения а Симплекс нескольких базовых станций то есть ту самую триангуляцию Казалось бы вот Готовое решение Зачем я здесь вышел что-то рассказываю взяли несколько базовых станций в динамике соединили получили треугольничек взяли центр всё готово расходимся на самом деле это не так есть несколько вопросов на которые мы сегодня не ответим но вы можете подумать о них на досуге является ли расстояние от базовой станции до телефона кратчайший если кто замеряет это расстояние аппарат или Базовая станция Какова точность полученных данных действительно при совершении действия Базовая станция замеряет расстояние чтобы понять где устройство находится и максимально эффективно с ним обмениваться Но кто говорит что это расстояние кратчайшее из-за отражений преломлений время считается фактическое а на деле абонент может находиться совершенно в другом месте также у нас просто может быть высокая погрешность из-за того что мы не видим какие именно абоненты находятся на подконтрольной территории мы это видим только на уровень выше ещё раз повторим какие у нас есть данные и зададимся вопросом как бы вы решали эту задачу У нас сейчас будет небольшой интерактивчик можете навести свои устройства на экран у вас откроется наша табличка Где вы можете что-то нам написать а я это прочитаю или мы сразу пойдем дальше кто придумает самое оригинальное или наоборот интересное решение Мы конечно конечно же вас поощрим в конце нашего доклада Кто смотрит онлайн Я думаю вы тоже видите слайд и можете открыть нашу доку буквально у нас пара минут на эту активность и мы пойдем дальше пока вижу что никто ничего не пишет но надеюсь что ссылка то или у нас все сломалось опять же у нас тут как я понимаю камерная Атмосфера Если кто-то хочет сказать голосом поднимайте руку я думаю вас тоже услышат либо просто повторю за вами вашу идею Ну либо не повторю Если ей не будет вижу что кто-то в табличку зашел значит ссылка Рабочая нам нужно более точно позиционировать абонента То есть у нас есть информация с базовых станций Я вот сейчас вернусь на прошлый слайд у нас есть вот эти данные и вопрос в том как определить где собственно абонент находится Как улучшить то местоположение коллеги предлагают сделать еще больше базовых станций чтобы они висели уже не на каждом столбе А по паре и дублировались в каждом помещении с 10 до Спасибо я продублирую тех кто не слышал Есть предложение выбрать якорные объекты например банкоматы и рядом с ним или прямо внутри поставить небольшую фемто 100 чтобы мы знали кто из коллег вместо того чтобы работать ходят а как сделать данный принимается еще в таблице нам написали что брать wi-fi это хорошая идея кластеризация точек тоже супер Сегодня мы об этом поговорим комментарий Ильи про добавить разметку я не очень понял но думаю еще услышим дальнейшие комментарии какой да Но мы же не всегда знаем как именно он распространяется то есть для этого нужны замеры как раз мы используем фактически перемещения Так у нас время К сожалению ограничено мы сможем это обсудить позднее поэтому я расскажу Собственно как мы решали эту задачу Всем спасибо за ваши идеи на слайде представлен пример реального трека нашей машинки и базовых станции на которых она отобразилась первая простейшее решение которое мы можем сделать это взять каждую координату базовой станции как итоговую локацию абонента кажется что При таком подходе мы уверены что расстояние фактического расположения пользователя до прогнозируемой точки не может превышать радиус действия базовой станции но как даже видно на слайде из хаотических переключений между базовыми станциями мы можем получить довольно большую ошибку по расстоянию поэтому для того чтобы работать не с моментальными событиями мы переходим мы дискретизируем пространство и начинаем работать с окнами 3 5 и 10 минут перед тем как пойти дальше мы ведем то как считаем метрики Здесь тоже не стоит надолго останавливаться мы просто берем прогнозируемую координату в этом окне и сравниваем с усредненной или медианной GPS нашей машинке или разъездного сотрудника и сравниваем эти два значения по ховерсинусу довольно стандартный для геопространственной аналитики формуле тоже простой подход возьмем и усредним координаты базовых станций которые у нас есть в заданном окне основная проблема которую мы сталкиваемся это конечно выброс о них мы поговорим позднее но видим что решение Вполне себе нормально работает на этом слайде и дальше мы будем подсвечивать конкретные методы которые мы описываем то есть зелененьким сейчас появились координаты усреднения координат дальше мы примем значение метрики этого метода за быдлайн и посмотрим как другие методы смогут его улучшить Конечно мы можем брать информацию по времени чем позже случилось событие тем в рамках окна оно нам интереснее поэтому мы можем добавить либо эмпирические веса вида один на Т либо логарифм либо отдать на откуп линейным моделям Можно оптимизироваться как по евклиду так и по ховерсинусу разницу мы большую не получили видим что в ряде методов этот подход также работает лучше все это конечно Здорово Но все равно остаются моменты Где ошибка далека точнее она далека от идеала но близка к тем базовым станциям которые мы смотрим по абоненту мы можем добавить количественный фактор как позапрошлом методе то есть считать сколько раз это Базовая станция засветилась в рамках нашего окна Либо мы можем считать время которое абонент провел на этой базовой станции кардинально другой подход это метод чем-то похожий на витрину дом работа если в той витрине мы пытаемся определить базовые станции и их наборы по частоте пребывания то здесь мы выбираем базовую станцию которая наименее удалена от других базовых станций и берем ее координату за итоговый прогноз видим что в части методов это также работает неплохо при небольшом окне мы можем также бороться с запаздыванием То есть у нас данные на базовой станции могут приходить либо раньше либо позже на GPS треке мы их видим с другой погрешностью поэтому можем брать прошлое значение и следующее по окнам и натравливать линейные модели уже на них также мы пробовали обучать бустинги Но для такого типа данных и линейные модели себя не очень хорошо показывают что говорить о более сложных закономерностях на слайде приведено сравнение этих базовых методов Да мы пока не учитываем выбросы и это действительно сказывается на этих значениях об этом мы тоже поговорим чуть позднее из тех данных которые мы используем но не подсветили в прошлом разделе это свечение как было сказано ранее освещение это то куда собственно светит наша Базовая станция где абонент может находиться теоретически или фактически в первом подходе мы просто смотрим свечение базовых станций и пытаемся их пересечь видим что результат может быть Не удовлетворителен эта зона будет слишком маленькая особенно если машинка передвигается и в рамках даже минут она может засветиться на десятке базовых станций поэтому Идем дальше проверенные старые методы из прошлого подхода Просто берем центроиды разных геометрии которые мы брали теоретических и фактических и усредняем эти значения видим что в ряде методов это также хорошо работает и неплохо себя показывает для топовой базовой станции пока мы не занимались чем-то сверхъестественным будем считать это за наши бэйзлайны едем дальше у нас Мы работаем с геоданными У нас есть дорожные графы дорожные графы это как и гео очень круто во-первых они есть открытые мы используем подложку Hero также сравниваем с мм и обогащаем внутренними данными с нужной нам информацией кто-то использует данные из графопера сейчас Это не так важно основная идея в том что мы можем брать под множество дорожной сетки и проецировать ноды базовые станции на ноды и выделять либо центральную ноду в этом куске графа либо пытаться восстанавливать маршруты маршруты это то к чему Мы пытаемся прийти Особенно для перемещающихся абонентов здесь мы тоже предлагаем довольно очевидное решение мы просто проецируем свечение и базовые станции на вершины графа и по ребрам пытаемся жадно найти нужную нам дорогу То есть если у нас есть вершины вершины которые Базовая станция 1 2 и 3 который мы спроецировали на наш дорожный Граф Мы видим что из Один в два путь короче чем в 3 поэтому идем так четвертая Базовая станция у нас находится где-то через водоем и мы его игнорируем и сразу идем в пятую вершину причем такой подход действительно себя показывает лучше лучше он показывает себя по той же метрике но теперь мы сравниваем маршруты и используем меру джакарда то есть там где у нас маршруты идеально совпал мы это засчитываем и ставим себе плюсик в карму где у нас не совпало считаем опять же окно усредняем значение и сравниваем с оригинальным в этом окне получается значение лучше но все равно далеко от идеала дальше мы поговорим про то как бороться с выбросами потому что все это конечно Здорово Но от ошибок мы не застрахованы первая проблема с которой мы сталкиваемся это сам GPS трек Когда вы едете по трешке или по Садовому у вас наверняка бывают моменты когда вы куда-то перелетаете или пропадаете навигатор начинает ругаться показывает что вы летите со скоростью света и сейчас оштрафует и больше на машине не поездите тут довольно простое решение берем предыдущее следующее значение и усредняя либо берем фильтр калмана старая но довольно надежное решение если говорить про сдвиги то в рамках одного маршрута абонент может Как запаздывать так и опережать конечно в первую очередь это проблема самой синхронизацией то есть если сверху мы видим опережение и часть очень круто относятся к следующему участку то в Нижней картинке у нас наоборот часть зоны отображается только на следующем окне из-за этого у нас опять же сбиваются и метрики и веса нужно что-то с этим делать но пока мы поговорим про выбросы на самом деле их можно разделить на два типа очевидные и неочевидные когда мы едем например по МКАДу Мы видим что нас засветилась базовая станция в середине Москвы и Абонент на нее перепрыгивает И мы ее просто Можем отсечь даже никуда не обращаясь когда Базовая станция засвечивается где-то рядом в окрестности местоположения абонента Так мы сделать не можем Но мы же у нас же есть много других данных поэтому мы можем составить справочник соседства базовых станций опять же мы можем составить просто по воздуху посмотреть для каждой базовой станции соседней сказать что наверное на эти он может переключиться просто потому что они находятся рядом Либо мы можем взять наши данные по конкретной базовой станции посмотреть динамики куда собственно люди перемещаются или они пропадают если они пропадают то мы тоже можем брать возможные следующие интервалы времени смотреть где они снова возникают также можем работать по методу аналогичному топу базовой станции и отсекать уже не одно BS а N базовых станций и работать с ними но возникает логичный вопрос как это число базовых станций подобрать либо экспертно Либо мы можем снова сослаться на данные и посмотреть что у нас есть вообще в городе то есть в каждом районе мы знаем примерно ошибку где-то у нас высокоскоростные трассы где-то у нас Сити откуда люди перелетают в аэропорт и зная эту ошибку мы можем отсечь нужные нам значения и сказать что здесь мы берем 5 базовых станций там 10 либо берем те базовые станции которые находятся на расстоянии не больше чем N для остальных базовых станций также Более сложный дорогой подход это построение изохрона то есть мы берем какую-то центральную локацию которую мы спрогнозировали ранее предложенными методами и из нее строим изохрану по нашему дорожному графу если у нас например окно 5 минут мы берем 7 минут смотрим До куда вообще машинка могла доехать и отсекаем эту зону и рассматриваем ее как потенциальную для местонахождения абонента дальше мы поговорим чуть подробнее про графовые методы потому что они у нас показали себя лучше всего но при этом они немного дороги для масштабирования если у нас десятки миллионов абонентов каждый каждую секунду что-то происходит каждая Базовая станция все время обслуживает десятки сотни тысяч абонентов и генерит данные поэтому графы мы в Production засунуть не можем на самом деле у каждого абонента есть вполне конкретные места где он проводит время это дом его работа по выходным или по вечерам он ездит к своим друзьям либо к родственникам обычно поэтому абонента можно выделить точки притяжения которые имеют два две основных характеристики это регулярность нахождения в ней и продолжительность нахождения ее окрестности на самом деле из этих предположений мы можем выделить у каждого абонента два состояния ты и мув если в первом абонент находится в состоянии покоя Да он может переключаться между соседними базовыми станциями то в состоянии движения он как ни странно перемещается но Цель этого перемещения достичь следующую точку притяжения понятно что некоторые точки притяжения могут быть разными Как получить новый паспорт съездить в другой город там пойти погулять в новой для себя локации но все равно из динамики мы можем найти основные точки притяжения для каждого абонента и работать уже с ними первый логичный вопрос как определить на чем абонент перемещается конечно в простейшем подходе мы можем в рамках окна взять две крайние наиболее удаленные друг от друга базовые станции и посмотреть сколько времени нужно чтобы добраться из первой зоны во вторую если перемещение быстрое конечно не гарантирует что это именно автомобиль Особенно с московскими И не только московскими пробками но в то же время мы можем использовать и другую информацию например мы знаем какие базовые станции стоят в метро и если абонент светится на базовых на этих базовых станциях мы знаем что эту часть маршрута он перемещался именно на этом виде транспорта также в отсечении автомобилей и другого транспорта нам может помочь сегментация базовых станций это и эндор базовые свечения и макро базовые станции которые стоят на больших трассах и информация с самих Best как часто они переключаются наиболее сложным вопросом который мы столкнулись и пока не решили Это отделение маршрутов общественного транспорта и личного авто Но кажется здесь нам как раз пригодятся маршруты сода и других общественных предприятий что на самом деле происходит с перемещениями если про стей мы не скажем ничего нового по аналогии с прошлым разделом то в Move дела обстоят намного интереснее если мы рассматриваем абонента который едет из области в город с утра в будни наверное все-таки перемещается на свою любимую или не очень работу и мы знаем где находится его точка Б точка Пункт назначения его точка притяжения и мы можем восстанавливать этот маршрут либо анализировать едет он действительно туда или у него есть новая промежуточная точка Куда он начал заезжать может быть в детский сад начал ребенка водить наступила осень также за счет справочника соседства мы можем на самом деле предсказывать следующие базовые станции и прогнозировать куда собственно абонент переключается перемещается и переключается по базовым станциям то есть мы можем использовать Марковские цепи и прогнозировать но это не тема сегодняшнего доклада главный мысль этой части в том что у каждого местоположения пользователей и точки на карте есть степени Свободы куда он может перемещаться и обычно эти точки совпадают с его центрами притяжения Вернемся графам как я сказал ранее графы для нас слишком дорого у нас слишком много данных и мы не можем с ними нормально работать но нам не так важно в каком именно месте человек находится нам важно анализировать тренды и человека в потоке поэтому мы можем упростить структуру графа дорожный Граф из себя Что представляет вершины И ребра ребра обычно ломаные изогнутые не пойми какие как показано на картинке нам важно как В целом он перемещается поэтому мы можем перейти от вот этой красной ломаной к центроидам гексагонов и восстанавливать маршрут уже по ним что мы Для этого делаем если мы определились с тем на чем перемещается Абонент в нашем случае на авто мы можем отсечь все гексагоны которые не являются дорожными на самом деле мы можем смотреть и не все дороги каждый подъезд к дому нам не очень-то и интересен берем основные автомагистрали и центральные улицы дальше рассматриваем свечение базовых станций это нам поможет и для течения неинтересных зон и для восстановления нашего подграфа с которой мы будем работать в рамках этого окна основной плюс в том что этот подграб мы можем где-то сохранить для заданных комбинации базовой базовых станций и работать уже с ним При таком подходе у нас в рамках одного окна остается порядка 10-20 вершин А в рамках района такое число насчитывает не больше 100 опять же Это зависит от той сетки с которой вы будете работать мы проецируем дорожные вершины графа на центроиды гексов и Соединяем соседние гексы если они являются дорожными Это в самом простейшем случае поговорим чуть Подробнее Как это работает схематично У нас есть дорожный Граф он отмечен синим цветом у нас есть гексагончики которые замещают нашу плоскость подсветим два из них и посмотрим как мы их можем соединить понятно что если у нас есть дорожные кексы мы их можем просто соединить каждый с каждым пройдясь по окрестности для этого тоже есть стандартные методы библиотеки от убера мы можем смотреть и на дорожный Граф и уже отсекать Некоторые из ребер как красный с нижним черным более сложном варианте мы можем построить ориентированный Взвешенный граф об этом мы поговорим чуть подробнее соответственно у нас есть конкретная конкретно гексагончик в нем Может быть как одна вершинка так и несколько мы рассматриваем все вершины этого гексагона берем соседний если в нем вершины есть все хорошо взяли под Граф из этих двух вершин И посчитали все возможные пути усреднили получили какую-то метрику по которой мы можем итерироваться уже между двумя соседними вершинами с каким-то весом то здесь мы уже можем использовать конкретную захрону если часто так бывает что и всм и в других графах соседней вершине в соседнем гексе вершин нету для этого мы тоже используем стандартные методы создаем промежуточные точки и оперируемся по ним и получаем новую структуру то есть сверху наверное все таки мелко но показано Как выглядит оригинальный Граф и снизу справа показаны более простое приближение где мы Соединяем каждый гексагон с соседними просто по центроидом а слева конкретный Московский район который у нас пересчитан и уже можно использовать время здесь ошибка считается по-другому если раньше мы использовали просто ховерсинус по окну или меру джакарда то здесь мы работаем Почти по точечно если быть точным по гексагонально если гексагона совпали все хорошо ошибка порядка 70-100 метров зависит от того Какую сетку вы используете если у нас произошло какое-то какой-то выброс либо вспышка на другой базовой станции мы пошли не в ту степь то мы считаем насколько гексагонов мы отдалились и домножаем это число на ту же константу получаем итоговое значение то есть этот подход работает ощутимо быстрее чем обычные графы и мы добились нашей поставленной цели мы примерно знаем куда он двигается наш любимый абонент знаем его точки притяжения и можем анализировать наши транспортные человека потоки У нас есть мы не останавливаемся на достигнутом эта задача продолжать свое течение Я надеюсь что когда-нибудь мы расскажем и про то как эти данные собираются как они у нас обрабатываются сейчас над этим тоже идет активная работа получаем новые источники но всех тайн раскрывать не будем мы хотим более детально учитывать информацию самих базовых станций куда они светят куда собственно люди перемещаются также подтянем в ременные факторы потому что дорожные картины мира с утра днём и вечером это абсолютно разные вещи также мы продолжаем эту историю оптимизировать сейчас эту историю у нас бегает в Реал тайме с пятиминутным окном и в целом парк справляется но мы понимаем что можно лучше и быстрее что мы использовали стек у нас довольно стандартный питон на котором мы пробовали и графовые эвристики и начальные безлайны потом Автоматизированная версия бегает нас парке мы используем кастомный udeft и либо от H3 для визуализации используем фолиум usm и smx у меня минута мы как раз уложились коротко пробежимся о чем мы говорили эти полчаса то как работать нерегулярными событиями что в любом бизнесе крупным или средним такие Данные есть это вспышка в нашем случае это вспышки базовых станций дальше мы поговорили Как из этих данных удалять выбросы и выделять основную информацию как строить маршруты по таким цепочкам почему это дорого и бывает неэффективно как Мы это можем оптимизировать улучшить и куда-нибудь запихнуть Спасибо Буду рад ответить на ваши вопросы и заодно посмотрю может быть в доке кто-то еще что-то написал но видимо нет Артем Спасибо большое друзья Задайте вопросы поднимите ручки вот Раз два три Вот первый вопрос пожалуйста Привет Спасибо за доклад было очень интересно у меня в голове Такой вопрос родился то есть применяли модель шестигранальную правильно Почему именно шестигранник Почему не треугольник или что-то другое чтобы за фигура чтобы запастись Спасибо на самом деле мы пробовали разные сетки То есть у нас есть обычный прямоугольная Она работает неплохо но гексагонок как-то исторически сложилось Нам нравится больше во-первых Потому что почему вообще гексагона хорошая история потому что каждый гексагон Да любого соседнего равно удален и нет такой проблемы как с теми же прямоугольниками что мы можем пойти по диагонали и тогда у нас расстояние уже начнут меняться и метрику нужно будет точечно рассчитывать для каждого значения также из-за того что есть встроенные и Спарк и питон либо тувера которая в целом хорошо работает и масштабируется ответил Так у нас В центральной части есть да и у нас как минимум три приза мы должны отдать Да привет У меня наверное два вопроса Первый такой общий Какая конечная цель вот этой аналитики по вычислению наших траекторий И второй вопрос Ну наверное опять же предположим восстановили траекторию пользователя неважно с миллиметровой точности чем это нам полезно да Вопрос понял По моему это было самом начале Может быть вы к нам чуть позже подключились но Первое это оптимизация сети то есть мы хотим знать где нам надо развивать нашу сеть потому что там не хватает базовых станций Следующая история это как раз анализ точки притяжения абонентов потому что ну простым примером является витрина дом работа по которой мы как раз ориентируемся в каких местах абонентов много в каких мало И соответственно как-то это монетизируем ну простой пример это сеть шпд если сейчас новый тарифы Кто знает У нас идут сразу пакетные то есть там есть и домашний интернет если ваш дом подключен к шпд то он вам доступен бесплатно в рамках пакета то есть мы знаем что в этом доме много наших абонентов либо в этом районе мы начинаем там проводить сеть нового доступа нового уровня и по B2B историям тоже вполне понятная История это топ концентрация целевой аудитории то есть мы знаем что где-то находится условные собачники и будем там рекомендовать какому-то магазину открыть свою точку Спасибо за доклад Никита так мне тоже наверное два вопросика первый вопрос Это вы проверяете модельки своей только с помощью машинок которые с GPS ездят или ещё как-то точность моделей больше ничего не Используйте нет используем второй вопрос сразу или нет такого у нас нет У нас есть разъездные сотрудники То есть те же Кто устанавливает базовые станции еще есть приложение по которым ездят те же шпдшники подключают интернет чтобы контролировать то что они работают они отлынивают у нас есть эта информация плюс еще сотрудники свои да да то есть сотрудников много валидирующих пешеходы которые Ну да да то есть мы рассказали более подробно про машинки но в то же время у нас есть и другие вспышки в частности внутренние сотрудники у которых есть нужные нам приложения И этого достаточно для проверки модели но пока мы работаем с тем что есть дальше Надеемся будут какие-то коллаборации например со службами курьерской доставки Приходите к нам Мы готовы с вами общаться И второй вопрос по поводу разделения личной автотранспорт либо общественный транспорт вы не смотрели в сторону одновременно перемещающихся точек Ну то есть машине может ехать допустим там четыре человека от точки А точку б а в автобусе там допустим 40 человек было бы отлично если бы у нас была такая идеальная точность но мы все-таки работаем с другим порядком измерений и мы можем в целом смотреть динамику что вот на этой базовой станции X абонентов Сколько из них переключилось по направлению например в центр из этой массы Какая часть у нас находится в каком-то плавающем состоянии между несколькими базовыми станциями которые являются состоянием покоя и мы скорее можем восстановить примерное распределение того как они едут как люди эти переключаются то есть до конкретной машины сколько там Человек сидит Это уже следующий точки абонента но все равно я говорю это То есть это погрешность там 10-30 метров у нас она всё-таки за 100 Спасибо классная Но это нам нужны навигаторские данные вот как пользователь Яндекс навигатора Например я знаю что очень часто по дороге в аэропорт есть пробка Но это нифига не пробка это просто таксисты чилит где-то у кафешки просто с включенными навигаторами Да система думает что там пробочка образовалась вот пожалуйста Да да спасибо большое за доклад Но все-таки вот про точность интересно Вы наверное все-таки Ну смотрели отдельно по каким-то там абонентам движению Какая у вас ориентировочная точность нахождение получается там в зоне плотной застройки Ну и где-то там за городом Ну хотя бы ориентировочные у меня была красивая картинка я предлагаю всем как в качестве домашнего задания восстановить наш хедер этой картинки Чтобы понять какая у нас примерная погрешность К сожалению мне не разрешили Циферки называть прямой поэтому мы все вот так вот закодировали так это чуть дальше идет ну То есть это и не километр но и не 10 метров назовем это так это Если в целом смотреть если по районам то я говорю можно раскодировать вот эту картинку либо обсудить В кулуарах это просто молодой человек из МТС что это коллеги Да добрый день спасибо за доклад подскажите а касательно самих абонентов что-то какие-то инсайты появились то есть по их передвижениям понятий например пол или возраст не знаю там дети студенты доход или вы только прогнозировали потоки как бы пока мы больше фундаментальной истории занимаемся потому что у нас есть и новые данные старые с помощью которых мы это делаем понятно что соцсем как и у телекомов и банков можно выделить немножко из другого из другой информации Ну как минимум если Симка оформлена мы знаем На кого она оформлена это но часто бывает что это другой человек само собой но все равно мы можем опять же по локациям понять я могу сослаться на две истории которые я слышал от коллег не внутри Билайна у ВТБ есть велобайки которые показывали как они перемещаются там был наглядный кейс как люди Берут у станции метро Университет и едут в МГУ понятно кто эти люди А по поводу того кто Где обитает тоже недавно не скажу у кого но можно при желании найти вышла статья Что есть женские улицы в Москве есть мужские и они детально разбирают Кто где более активно перемещается можно посмотреть тоже интересно хорошо Спасибо но историю с данными можно развивать вечно То есть например Зачем с беру самокат Да чтобы знать где сколько людей какие у них средние ценники на там условно насколько плюс 20 рублей человек может покупать белый хлебушек хорошо вон там вдалеке Давайте финальный вопрос и пока раздача слонов и пауза Спасибо большое Скажи пожалуйста ты сказал что в итоге Линейная модель не зашла с учетом координат И какой финальное решение если все-таки использовать ML как какая модель вопрос понял Смотри эмаль пока является просто голосовалкой то есть Я показывал много разных методов каждый из них где-то работает лучше вопрос Какой Выбирать из этих методов в конкретном районе здесь мы уже как раз а я об этом сегодня не говорил но здесь мы уже конкретно подключаем eml и решаем мульти класс То есть если просто брать голосовалку и усреднение между этими методами Это где-то хорошо где-то плохо но лучше это работает с запаздыванием то есть мы сглаживаем за прошлое следующее окно вот эти три значения кормим линейки она нам говорит и получаем устойчивое решение а для следующего этапа мы уже используем голосование которое уже накладываем на H3 сетку по которой восстанавливаем маршруты если абонент двигается То есть если в двух словах итоговые решения определяем координату как можно лучше если покой останавливаемся если движение берем динамику восстанавливаем маршрут да скажи мне как дата сайнтисты дата сайнтисту да У тебя eml есть кому кому подарим Нам нужно три три ваших приза вручить или даже местами приза Я думаю надо отдать коллегам однозначно коллегам по цеху так раз последний вопрос мне понравился последний вопрос а хитро 2 это просто коллегу надо отметить Да есть коллеги по отрасли коллеги по оружию Да и наверное историю про навигатор и сколько человек в машине и автобусе Не уходите да это на втором ряду то есть вот коллега там да всем спасибо за вопросы Да тебе спасибо за выступление тебе тоже полагается памятный приз спасибо от хайлу Да спасибо большое великолепно кулачок друзья дальше по программе через 8 минут здесь тех ток заранее записанный коллегой из Газпромбанка будет рассказывать про аварии и как себя вести во время аварии и в 17:00 Миша Жилин из пост Грис Professional будет продолжать разговор про нагрузки хорошего продолжения дня друзья привет С вами хайлот 2022 Меня зовут Козлов роман Я из лент миап и с нами Павел Кузнецов главный архитектор автоматизированных систем управления развития кредитной платформы Газпромбанка Привет Павел о чем мы сегодня будем разговаривать вообще хотелось поговорить о том как у нас происходит информационных системах аварии как их устранять скажем так самым простым способом не будем вдаваться технические подробности больше поговорим о том со стороны сотрудника со стороны руководителя Какие есть способы приема чтобы минимизировать такие аварии А насколько важно чтобы у нас принимал вот этот инцидент тот человек который будет заниматься инцидентом или же нужен какой-то фильтр который будет изначально фильтровать все инциденты только часть из них передавать Ну там более опытному инженеру и как будет происходить это вам ты говоришь про оленей поддержки да В данном случае желательно разбивать линии поддержки Там на первую которая там принимает большинство запросов и уже там пытается их либо устранить либо помочь пользователю понимает что это более сложных проблем передает на следующий уровень эскалации верно там на вторую линию поддержки Там под конкретным информационным системам Да если там у них не получается Они передают дальше на третий уровень это может быть и к вендру если это совсем там не в рамках этой поддержки проблема в любом случае конечно нужно чтобы такое организация таких приемов таких обращений была И это должны быть скажем так первый уровень который защитит дорогих и ценных инженеров от массовых всяких проблем которые Да которые можно было бы устранить там за просто поговорив с человеком хорошо Допустим мы решили этот инцидент у нас все стало хорошо Какие действия мы должны предпринять дальше и Должны ли первое мы должны предпринять это написать отчет если там кто читал книжки про там знаешь что это постморта мы оформляет Google Да можно что-то оформить свое не суть самое главное писать что было как устраняли и попытаться найти ключевую проблему Ничего все произошло Потому что если не найти ваша ситуация опять повторится и это будет еще хуже потому что потому что как же так у вас все время падает Либо вы нам доложили что все починили И все Больше так не произойдет ровно это происходит через два дня это как это закон подлости Да а что делать если подчинилась само Это самый худший вариант когда само починилось потому что здесь никто не знает почему она сломалась и в данном случае надо очень сильно наблюдать всем за тем что происходит Дальше потому что скорее всего это опять произойдет хорошо Ну допустим мы описали нашу проблему Мы закончили инцидент Мы вроде как решили тот инцидент из-за которого все это дело произошло А как в будущем нам в случае возникновения подобного инцидента пользоваться накопленными вот этими вот артефактами для того чтобы у нас в будущем происходило решение инцидента гораздо быстрее все знания вообще которые накапливаются при таких проблемах они хранятся в глазах специалистов которые вас работают и те кто дольше все проработал у них самая максимальная скажем так опыт решения этих проблем в большинстве своем они могут большинство проблем устранить просто там выслушав рассказ что происходит это только опыт дает такие возможности Какой должен быть Процесс получения этих за только вообще есть ли например вот в твоей практике в твоем опыте ограничения каких-то групп пользователей от того чтобы они не генерировали кучу заявок или есть ли какой-то опыт например что у тебя заявки подают только там вот директор подразделения Там и так далее руководитель нет тут лучше всего чтобы была возможность продать заявка конечно заявки конечно Всем Единственное что наверное улучшил бы ситуацию это единая форма подачи заявки то есть Звонок по телефону это там Крайняя штучка у тебя компьютер не работает вообще там больше нет все остальное только там через портал чтобы это можно было быстрее проще классифицировать Да наверное так можно сделать и так нужно делать большинство конечно говорят нам надо чтобы пользователи либо им способом донесли нам заявку там через Telegram WhatsApp там почту и прочее А насколько удобно потом аккумулировать все эти заявки в единую систему но практика показывает что не очень удобно в большинстве своем эти заявки дублируются и это просто скорее всего по моей практике это неудобно хорошо у нас есть несколько инженеров которые накопили собственные компетенции эти инженеры очень ценны как инженеры технической поддержки а как нам растить инженеров Ну понятное дело что при современно развивающемся АйТи это достаточно сложно и у нас должны быть какие-то механизмы и опыт который мы можем передать нашим инженерам но Первое это постоянная практика то есть инженеры должны реально устранять проблема учиться на этом работать с вами коллегами вообще инженер должен если он хочет расти этой области то он должен обладать не только скиллами Да там знаний продуктов операционных систем и прочего но еще и скажем так софт скиллами Да он первый должен быть очень коммуникабельным общаться без общения вообще ничего не получится потому что во всех таких ситуациях требуется общение с коллегами с другими подразделениями командами которые тебе помогают устранить твои проблемы Ты как специалист должен уметь в такой стрессовой ситуации контролировать себя ты не должен бояться просить помощи это вообще если там не получается течение там разумного срока там полчаса что-то решить сразу обращаться к коллегам просить поддержки потому что дальше это будет погружение и все придет босс и будет негодовать Каким образом происходит рост специалиста и Бывают ли такие специалисты которые приходят не вот в кузницу кадров на первую линию технической поддержки а сразу приходит нам куда-то на очень высокие должности и так далее в какой-то мере должны погрузиться вот в эту часть но в большинстве своем Все погружаются в какой-то мере в первую линию в любом случае какой бы сфере они начинали плюс-минус равно общается с пользователем в начале потом уже там прокачивать переходит на следующие этапы Если вы там нанимаете нового сотрудника то в любом случае уже какой-то есть бэкграунд и можно понять готов он или нет но он все равно будет какое-то время погружаться в вашу инфраструктуру ваши там информационной системы и с первых минут он все равно тоже так не сможет начать работать как вы от него хотите Как же все-таки сделать чтобы у нас аварии было меньше практика показывает что лучше всего первое любые работы выполнять утром когда ты съешь я понимаю что там пользователь работает и прочее перенести на выходной день когда их меньше всего но не делать это вечером пятница особенно в 13 число Это первое Второе такое любые такие работы они должны готовиться Составьте план проговорить его с коллегами если там подозревает что будет взаимодействие там с другими отделами предупредить их Посоветуйте с ними Подготовьте план отката хотя бы просто в голове не надо Там прям все расписывать хотя бы понимаешь что там у нас есть бэкап там восстановим откатим конфиги сидела подумать про это с вами был хайлот 2022 Меня зовут Козлов Роман и с нами был Кузнецов Павел Всем пока До встречи на конференции Как настроение друзья а Живые люди и вот сейчас смотришь Живые люди Вот теперь Так Подождите а я любил живых людей или не очень любил живых людей нормально но конечно одно дело когда задаешь вопрос в Зуме спикеру или там уже думаешь А может ну его а можно задать вопрос спикеру глядя в глаза и это прямо прекрасно а традиционно день мы заканчиваем завершаем битвами баз данных и приглашаем следующего спикера Михаил пожалуйста можно постоять подышать улыбнуться бороду и погнали Всем привет Меня зовут Михаил Жилин Я из компаний после профессиональной и сегодня мы поговорим об аномальных случаях высокой нагрузки в возрасте что это вообще такое у нас база данных всем известно как хорошо работающая под высокими нагрузками выполняющие четко свои задачи и иногда бывает так что вроде все должно уйти как по маслу но неожиданно наши ожидания К сожалению рушится Вот как раз это и есть Аномалия которых мы сейчас и поговорим немножко о себе во-первых Меня зовут Михаил Жилин Я инженер по производительности Также люблю иногда по контрибьютить в Open Source различные как суббоды операционной системы Java приложение все что угодно Все это нравится вот и сегодняшний доклад я буду конечно строить в первую очередь а реальных случаях когда нагрузка явно просто пробивает возраст себя начинает вести плохо Мы лезем туда со всякими инструментариями гвоздями ножами и так далее Разбираем этот случай вскрываем его анализируем находим проблему пытаемся понять как бы эту проблему решить снова погружаемся снова находим прекрасное решение и выдаем В итоге в некоторые там решения наружу иногда не выдает увы начнем мы в первую очередь инструментарием чем же мы все-таки пытаемся как бы вот эту всю нашу проблему проанализировать база данных потребляет два основных ресурса это процессор и диск процессор это такой чёрненький ящик который стоит где-то там на материнке в серверной в дата-центре далеко от нас и чтобы понять что происходит в нем внутри К сожалению на микроскопа недостаточно нам нужны инструменты профилирования самым известным инструментом профилирования является в linuxpr он доступен во всех инструментах дистрибутивах но есть еще другие БПФ более продвинутые старые и так далее прекрасный инструмент перв умеет профилировать все что нам нужно Но единственное с ним вещь то что это все-таки инструмент себе он минимален он выдает наружу много текстовой информации которая может быть даже десятки мегабайт которые просто так глазками просмотреть и понять Ага вот она проблема вот здесь указать нее невозможно И тут на помощь нам приходит система такого вот она анализа и визуализации инструмент Flame Граф написанный брендоном грехом лет 10 назад и он умеет генерить вот такие вот красивые картинки как показано на слайде справа если кому интересно погрузиться в тему профилирования именно после современными инструментами есть прекрасный доклад Дмитрия Долгова конференции этого года пиджакон Юра 2022 ссылочка вот по qr-коду есть Кстати я забыл сказать что в конце у вас будет ссылка на эти же слайды поэтому не обязательно их там фотографировать все у вас будет сразу же Итак едем дальше перв прекрасный инструмент сразу можно запрофилировать любую операционную систему набрав два слова perf пробел топ и сразу же видим какие функции занимают Больше всего времени в ядре процесса в процессоре и можно уже какие-то первые выводы сделать иногда нельзя сделать потому что причина проблемы находится в функциях которые вызывает данные функции и они скрыты сами по себе и Нам нужен полный стек вызовов и сэмплировать его с некоторой частотой например 99 Герц в этом случае помогает такая вот маленькая шпаргалка которая представлена данном слайде который выводит уже мегабайты данных которые мы отправляем slamgrap и получаем прекрасный результат виде вот тех свг картинок как был на предыдущем слайде но здесь надо сразу сказать два момента первый момент чтобы получить качественный результат профилирования по адреса нам нужны Пакеты дебаг-инфо дефолтные пакеты содержат обрезанную информацию об функциях хищных функциях фосгорится И когда вы запрофилировать вы ничего не получите По сути никакой информации поэтому первое ставим дополнительно пакеты дебаг-инфо второе это то чтобы получить качественный стек вызова хищных функций из бинарного стека лучше всего использовать библиотеку либо онлайн это прям библиотека который то единственное его сейчас в Open Source который лучше всего строит стеки зачастую Бывает так что дефолтный перв который предоставляется пакетом дистрибутива собран без библиотеки без поддержки это либо онлайн и надо будет вручную пересобирать перв хорошо клёво инструмент у нас есть Давайте посмотрим а какие на примере чего мы можем вообще с ним с помощью него сделать вот здесь на картинке сразу показано Ну что мы здесь видим свг внизу видим метр функцию Getz nevshot Data интересно что-то непонятное но мы знаем что она потребляет Больше всего времени судя по этой картинке она вызывается из другой функции г- транзакшнэпшот А там уже вызывается из экзеквал символ экспресса Хмм интересно Ладно берем идем в Google вбиваем Вот этот экзайку Simple Expression и понимаем что это функция выполняет некоторые простое выражение не в самом погребе а дополнительным экстеншине который называется plpg SQL хорошо читаем дальше в Google нам в помощь Что такое простое выражение в пыль поди это Например I = +1 Что такое Неужели простые выражения так долго выполняются особенно какие-то вот это снапшот дата вызывает читаем дальше И выясняем что оказывается до 13 после любой вот такой вот простое выражение требовало генерацию с нимка о снимок что-то новенькое вот Давайте теперь про снимки почитать лезем в документацию И что же мы там видим что снимки нам нужны для того чтобы организовать изоляцию транзакций чтобы мы как работающие с базы данных не видели тех людей клиентов которые тоже подключились к СУБД и нам мешают тоже там что-то меняют данные и так далее то есть для режима транзакционной изоляции Ну ладно хорошо это не так интересно что же вообще-то снимок что это такое Оказывается можно на него даже взглянуть это есть специальная функция ПГ Коран снэпшот который нам возвращают что x-min минимальное значение активной транзакции x-max это будущее транзакция которая только-только вот сейчас генерится и список активных транзакций список всех активных транзакций в системе Вообще легко его собрать вообще вот этот список всех транзакций интересный вопрос Ну что же мы еще узнаем Из документации что генерация данных снимков зависит от того какой режим работы с базой данных мы выбрали по умолчанию это ритметит и снимок генерится на каждый запрос Ну можно сказать репетита был Рид и тогда снимок будет генериться только раз в начале транзакции если у нас очень длинная транзакция которая делает там десятки сотни вызовов то мы можем получить экономию на генерации снимков просто переключив сессию нашу в репетабарит Ну ладно хорошо давайте Вернемся все-таки вот к сложности построение вот этого снимка раз он уже занимает много времени процесс процессоре Ну блин узнаём что до четырнадцатой версии чтобы получить вот этот снимочек нам нужно было перепройти по всем подключенным клиентам и посмотреть у них статус а клиентов Сколько может быть Ну десятки тысяч подключений к базе данных легко это активных транзакций Ну бывает даже на два порядка меньше то есть ну там десятки сотни и узнаем что в 14 версии сделали оптимизацию которая позволяет не обходить всех под все подключения а только посмотреть список активных транзакций его выделили в отдельный массивчик и с помощью него теперь генерится другая проблема пока мы генерируем совершать мы получаем так называемый блокировку что мы читаем данные об активных транзакциях и другие транзакции к сожалению они могут добавить в этот массив получается немножко ограничиваем масштабирование так вот что же нам сделать делать Ну во-первых если мы видим у себя в результате профилирования данный метод Data то смело бежим обновляемся до 14 послеза там все уже хорошо А если не помогло Ну не помогло конечно не очень хорошо Давайте попробуем тогда уменьшим частоту генерации этих снапшотов с помощью там например опять же того же самого репетита был Рид Ладно транзакции транзакции на транзакции тут транзакций там но оказывается выясняется иногда что в подлизе существует не только транзакции А еще такие называемые под транзакции многие о них даже вообще не подозревают что они существуют пока в один прекрасный день они с ними не столкнутся например во время какой-нибудь инцидента Когда в продуктовом контуре неожиданно производительность всех запросов читающих пишущих резко просаживается в разы и что делают Ну как у нас же есть прекрасное представление вьюха ПГ стат-активити там же написано что чем занимаются процессы Давайте посмотрим в неё там есть колонка Ожидание и видим там может быть с Автотранс Control может быть просто саптранс может быть саптранс и сел рулок что-то их очень много развелось последнее время этих локов Ну вообще-то все гораздо проще просто до 13 версии были вот эти разные Локи а в 13 версии их заменили только одни саптрансы с рулоком что это такое снова идём в документацию и видим там что сам транзакции нужны для того чтобы организовать выполнение или же в каком-нибудь языке программирования типа PL или SQL или PL Java или PL V8 или перл реализовать механизм трайкач Забавно А что же вообще такая по транзакции чем она отличается от обычной транзакций она по сути та же самая транзакция то есть точки зрения инвестиций снимков так далее это обычная обычная транзакция Только у нее есть еще родитель Кстати этот родитель может быть тоже под транзакцией это получается у нас такая целая цепочка дерево этих под транзакций А как проверить статус транзакции транзакция закомить или нет но наверное надо проверить свой статус и наверное самый статус родителя вот показ родительская транзакция не закатится вот транзакции нет тоже не заметить и не откатилась усложняется получается статус проверки нашей транзакции Ну ладно давайте подумаем вообще что там у нас как она и вообще работает в постгрейси вшаренной памяти есть такое прекрасный массивчик называется prog RL в нем Выдели на 64 элемента под под транзакции для каждого подключения дальше эти 64 по транзакции собираются в одно снимок и в снимке уже используются для того чтобы проверить транзакция заканчилась или не заканчилась информация очень все хорошо Ну окей Ну тут стоит вопрос А что если у меня в подключении шестьдесят Пятая под транзакция человек получу ошибку нет нет мы можем посмотреть на конечно же на диске в папочку ПГС там вот сохранится вся информация родительских транзакций для каждой транзакции Ну она конечно хранится не всё время там не за всю историю база данных как вакуум например почищать старые строчки так и чекпоинт подчиняет информацию с ПГС Ну хорошо Блин она каждый раз ходить на диск это же блин вообще расточительство блин читать с диском Давайте нет введём какой-нибудь кэш велик кэш l.u выделили 32 буфера по 8 килобайт на под транзакции Ну получается туда вмещается 65.000 транзакций уже с одной стороны хорошо а с другой стороны Подождите ну 65.000 транзакций бывает так что за секунду пробегает на высокой нагруженном контуре и в наш кэш вообще попадёт совсем маленькая часть того чекпоинта который зачистил эту таблицу вот вам домашнее задание Попробуйте на своем каком-нибудь самом боевом контуре посмотреть сколько у вас транзакций в этой папочке Но что же нам делать вообще Что за проблема у нас вообще встречаются Ну кроме маленького размера slruksha есть еще и вторая проблема чтобы найти вот этот Блок из 32 нужный нам нам надо к сожалению перебрать все и посмотреть внутрь каждого это наш блок похоже не наш следующий так далее так далее так далее и на это тратится очень много процессорного времени если честно такая проблема со всеми силукашами не только для пол транзакции но еще для мультитракции и тому подобное и проседания в результате вот такого вот постоянного хождения в кэш на диск И конечно мисов может достигать просто в разы Ну хорошо давайте подумаем теперь что же нам делать Ну самый простой вариант который интуитивный понятный не использовать больше чем 64 под транзакций в рамках одной транзакции тогда мы не будем уходить в эти каши и диски и так далее Все будет хорошо Но если не получается то решили как-то все-таки решить проблему с рук Иша вот те как раз две проблемы его маленький размер и линейный поиск для этого предложили пальчик в мае двадцатого года Андрей Бородин отправил его в ПГ хакерс который позволяет администратору базы данных самому сказать сколько нужно кэшировать с помощью параметра если кейл а также улучшил поиск вот этих буферов в SLR с линейного на бинарный Ну хорошо пиши к ишами Погоняем мы это Мы все знаем А Какие еще бывают клише Ну примеру есть кэш системного каталога системный каталог это просто наш набор табличек индексов информация о колонках их размерах и так далее используется этот каталог в первую очередь для чего для того чтобы выполнять запросы по их парсить разбирать и планировать вот так иногда оказывается что наше планирование оно выполняется довольно таки долго появляется это в первую очередь например когда вы заглядываете в топ и видите что ваши все основные процессы занимаются выполнением никаких то есть команд А команды Вот либо же заглянуть в ПГС от statements и там есть отдельная колонка называется Total planning там для каждого запроса и вы можете понять сколько же запрос планировался Сколько реально выполнялось Ну ладно хорошо системный каталог кэш системного каталога Зачем он нам Наверное чтобы быстро планировать и разработчики по адреса вместо того чтобы каждый раз ходить на диск они занесли информацию об этом системном каталоге даже не в шареную память а сразу в локальную память отдельных процессов каждого подключения И если нам Ну когда подключение только создается кэш пустой мы зачитали с диска сохранили в кш и эту информацию держим у себя долго в памяти но иногда приходят какие-нибудь другие подключения говорят Альтер тейбл Эд колум и нам надо информацию о табличке которая хранится в нашем клише поменять это так называемый сделать инвалидацию кыша инвалидация бывает два типа первая по табличная как я вот сказал там колонку и надо Вот сбросить информацию только по колонке бывает глобальные Ну когда надо сбросить весь кэш Ну и все такие инвалидации они генерации в результате выполнения DD или dml и усилите команд Ну мы же все знаем что в постггасе ddl транзакционный значит если кто-то выполняет altertable at Calling то не надо бросаться сразу рассылать всем инвалидацию кэша другим процессам А надо подождать конец транзакции вдруг наш транзакция откатиться и ничего не надо валидировать поскольку Это вся природа такого вот инвалидации США носит такой бродказ характер потому что нам надо всем сразу разослать то разработчики по адреса придумали отсылать так называемые сообщения через шареную память и хранят эту информацию в циклическом виде циклического буфера из 4.096 сообщений когда другие процессы выполняя начинают выполнять запросы или там открывают relation то есть периодически заглядывают в этот циклический буфер и смотрит нет ли новых сообщений для него и Если есть то выполняют то или иное действие но бывает так что процесс немножко Там потупил подвис и так далее а тут за это время уже 4.000 сообщений сделали Круг и старые сообщения начали перетираться то для таких процессов оставляется специальный флажок Типа все Извини парень ты отстал сбрасывай свой кэш который ты там накопил гигабайт информации и перечитывай заново это так называемый ой печаль заключается в том что такие запросы начинают такие подсоединения начинают резко тормозить как раз таки на планировании и нам что же делать в первую очередь уменьшать количество ddl команд постгры с прекрасная база данных для того чтобы сравняться с ltp нагрузкой вставлять запись удалять и так далее Она изначально не предполагалась для того что еще бы еще каждую секунду создавать и удалять тысячи таблиц Поэтому если вам нужна временная табличка создать ее в начале сеанса подключение и Используйте сколько вам нужно 5 10 100.000 не надо их в каждой транзакции удалять создавать по тысяче Ну и вторая проблема здесь которую я хотел бы подсветить то что в ванильном возрасте К сожалению нету механизма мне неизвестно как вообще мониторить эти валидации есть единственный способ который я знаю это вот расширение ПГС ПГ простат который входит в состав ПГП про стандартный Enterprise которая содержит информацию о том как часто разные стейтменты генерят вот эти сообщения инвалидации и как часто происходят эти рецепты то есть мы можем вообще контролировать наконец-то и мониторить это механизмы на валидации кэшей Но кроме этого есть еще так называемый антитюнинг антитюнинг заключается в следующем что заглядываешь иногда параметры и Видишь там выставлены параметр Ford параллело мод равняется он считаешь документацию и видишь этот параметр заставит все запросы выполняться параллельно звучит очень хорошо клёво всё станет Работать быстрее наверное Ну вообще Надо подумать А если запросы маленькие мелкие то есть каждое подключение будет пытаться выполнять его параллельно создавать дополнительных параллел воркеров эти параллеловокеры Будешь ждать пока они выполняться параллель воркер должен форкнуться подгрузить информацию о системном каталоге выполнить спланировать что-то выполнится В общем начинает дико все тормозить второй антипат антитюнинг это параметр debug discard cash который просто говорит не используя системный кэш оба этих параметра относятся к так называемым параметрам для разработчика ни в коем случае не стоит их использовать в промышленном контуре потому что разработчики создали для себя для того чтобы сформулировать ту или иную нагрузку для цели разработки девелопмента Так ладно Идем дальше пиши к ишами процессоры греются и бывает так нам приходят случаи когда CPU в сто процентов лоу тэвордж почти уже сотня при этом Как видно по топу больше всего времени мы проводим в так называемом kernel Space то есть в пространстве ядра на сервере ничего не крутится кроме постгрыса никакие другие процессы не могли На это повлиять Значит сам подсказ находится постоянно в пространстве ядра вот здесь видно что 88 процентов времени мы проводим в системе Ну что поделать вспоминаем правило надо заглянуть в процессор это черный ящик а для него есть перв а для перфа есть два слова perf топ Ну вот запускаем наш команду 1 и видим что видим да много методов в пространстве кернов и называются эти функции азишные аудит подчеркивания что-то там заглядываем в документацию ядра линукса и видим что это некоторый функционал для того чтобы мониторить системные вызовы и их куда-нибудь логировать можно в сеть можно на диск можно еще как-то Ну и первая наша рекомендация Попробуйте пожалуйста отключить этот мониторинг вызовите команду Control минус и 0 хорошо проходит полчаса и проблема Как не бывало юзер тайм вырос с 10 до 17 System упал 8 раз и как оказалось по проверили правила вот этого самого настройки аудит системы и выяснили что Видимо безопасники просто немножко накосячили написали немножко неправильно правила безопасности и выкатили на данный сервер тем самым испортили производительность вот сразу помог выяснить Кто кто виноват но бывает так что админы очень бдительные следят за своим продакшеном внимательно и постоянно смотрят как раз таки вот в это представление ПГС от Activity и заглядывают в него и смотрят там что происходит Все ли нормально всё ничего ли плохого не происходит и тут неожиданно выявляют выясняют что все активные подключения начали ждать ожидание клайнтри И бегут к нам говорят слушайте У нас тут какой-то клайнтрит вроде системы себя ведет нормально TPS хороший все хорошо наш мониторинг не ругается но при этом мы же видим что вот есть какое-то ожидание непонятное клайнтрит на активный запросах странно как так что это такое Мы вроде как бы выполняем запросы с другой стороны Мы вроде читаем клиента Ладно документацию смотрим все вроде ничего не такого не описано как бы за странность такая документации нету лезем в кот а в коде выясняем что данные ожидания выставляется и внутри библиотеки и говорит о том что мы сейчас отдыхаем наш процесс ничего не выполняет и мы ждем когда сокет Читающий станет доступным когда клиент отправит к нам какие-то бантики Ну например запрос или вызов комит или еще что-то а мы просто Сидим и ждем как только ожидание Ну сокет станет доступным мы никуда не убираем хорошо Может быть тогда статус неактивный запросы может быть просто криво отображается но смотрим когда выставляется активный статус проверили в начале любого нормального действия он выставляется А как только мы доходим до метода securite он перед этим сбрасывается То есть получается Согласно коду мы не можем быть одновременно и активными и читающими клиентовские пакетики Так что ж тут тогда не так может быть наше представление тогда неправильное ПГС это Activity мы заглядываем внутрь а как оно вообще работает а вот и видим что ПГС тактилити собирает информацию не из одного места а из двух массивчиков первый массивчик называется Back and status Ray и хранить себе информацию А какой запрос выполняется В каком статусе сейчас выполнение Какие ip-адреса подключения время начала транзакции тому подобное то есть такая медленно меняющаяся информация и быстро меняющаяся информация из массивчика про кэрэй и там хранится как раз информация об ожидании То есть он из двух этих массивчиков слепливает представление и выдаёт наружу но Беда в том что он слепливает это информацию не одновременно и может быть так получиться что у вас новые релиз они ребята всё потемнели всё постарались запросики начали выполняться быстро и они выполняются настолько быстро что статус остается по-прежнему активным а через некоторое время мы читаем из прокара информация она там уже оказывается ожидание клиента в результате погасло Activity вот так вот немножко криво показывает нам информацию про пачек мы уже отправили получили фидбэк сейчас его перерабатываем отправим снова пачек в комьюнити Надеюсь что 16 версии или там семнадцатой примут И это всё исправит Так ну это все хорошо давайте перейдем в вкусному а вкусно нас индекс вот самое вкусное в космосе это конечно индекс и первое а-а проблема которая сегодня хочу рассказать это индекс onlyscan вообще это операция позволяющая читать из данные из базы данных не заходя при этом в табличку то есть обычный индекс что делать находит по ключу Где находится данный в табличке потом идёт в табличку и выбираю выбирает нужные данные а индекс он говорит о том всё что просили меня достать из базы данных ну в селекте все эти Колонки есть в индексе нам не нужно лезть в таблицу Давай сэкономим себе заход все есть в индексе и вот как бы получается Он быстрее чем просто обычный индекс can но тут есть беда в постгрессе как мы знаем в индексах не хранится информация о транзакции то есть x-min X Max те самые которые нам нужны для снимков чтобы проверить что строчки все видны Ну Ответ простой Давайте сходим в табличку там же хранится информация Так подожди Зачем нам ходить в табличку в индексуальной скании если мы вот как раз хотим чтобы он был все-таки индекс поняли сканом и мы не ходили в табличку блин Что же делать придумали такой вот оптимизацию под названием визибилитимат в этой это очень компактное представление об информации об транзакциях для которой выделен один Бит 2 бита на блок один из бит которых говорит о том что вот в этом блоке все строчки хорошей не нужно проверять x-minx Max они уже все готовенькие забирая их они все видны Ну прекрасно Да вот поняли что два битабильте Map на один блок таблицы на 8 килобайт это же прямо сжатие прямо в разы а один блок везде берите Maps 8 КБ соответствует 256 Мб таблицы но тут есть маленькая беда индекс выяснилось умеет работать одномоментно только с одним блоком а что это означает вот если мы захотим выбрать из индекса скажем 100 строчек для очень большой таблички в терабайт вот мы выбрали 100 строчек и начинаем смотреть первая строчка а для ней вот тут везде билеты mapblock А для второй строчки одни из другое место и так далее То есть нам приходится перескакивать с одного блока на другой индекс от этого не очень хорошо мы придумали патчик отправили его в комменте сейчас я не буду вдаваться в детали а просто покажу результат результат покажу на простом тесте создал табличку из одной колонки ID просто численная колонка туда залил 60 млн строчек и хочу Выбирать из этого Из этой таблички все строчки в упорядоченном порядке то есть по возрастанию написал простой запрос ордер бай ID из таблички тест и запустил что я вижу прошел за 60 миллионов строк за 18 секунд отличный результат всё равно всё прекрасно 18 секунд туда еще может быть лучше а применяем наш патчик и время резко падает в два раза до 9 секунд Профит Профит все хорошо ну как бы все бывает прекрасно в нашем мире все хорошо но бывает такое что некоторые проблемы мы еще не смогли решить но мы о них уже знаем мы их нашли и Одна из таких проблем называется индекс во внешней части настит лупа все знают вот такие простые слова индекс внешней части есть тепло во всё хорошо Ну как бы исходный запрос я не здесь не буду показывать он очень сложный непонятный Там и так далее но есть простая способ Как симулировать эту ситуацию сгенерить и так чтобы он заходил на создаём маленькую табличку я её специально назвал Вот который там содержит условно там 10-20 записей по ней индекс просто по данной колонке И вот так вот с помощью генерить Series и нескольких отключенных инструкций захожу в этот в эту табличку 5 миллионов раз Ну проверяю план вроде хороший nested loop есть индекс во внешней части есть Loops проверяю сколько раз зашел я в этот индекс тоже 5 миллионов и время отличное смотрите время-то две секунды все шикарно Что еще можно желать лучше 5 миллионов за 2 секунды Ну прям прекрасно Ну подождите это же я зашел вот выполнил запрос только в своём подключении А что если таких как я сотни Ну представить да Ну ладно давай запускаем бенчмарк и видим что время начинает линейное расти запросы То есть если я один выполнял запрос это было 2 секунды А если таких уже 10 то это уже 30 секунд Ого то есть время растет Линейная система не масштабируется то есть я ожидал бы что вот я выполняю запросики и все они параллельно отдают одно и то же время Подождите У тебя мало ядер нифига у меня здесь самый современный скей третьего поколения 24-ядерные и все весь процессор просто начинает больше и больше больше кушаться от того что я добавляю больше воркера все больше больше греется процессоров Ну и второе подтверждение проблемы это вот график А сколько раз в секунду мы смогли Во всей системе зайти в этот индекс а график даже начинает немножко падать То есть он не должен был расти масштабирование должно быть линейное а никакого линейного масштабирования нет вот на одном запросе уже нет масштабирования Ну к сожалению вот такие бывают проблемы в заключении Я хотел бы отметить что позглиз SQL база данных которая постоянно развивается как функционально в ней добавляются новые фичи команда мерши сон и тому подобное так и по производительности Как вы видите вот с 12 до 14 версии очень много было введено новых изменений и будет так продолжать дальше жизнь перформанс инженер вообще очень удивительно Мы сначала берем черный ящик потом Делаем его белым потом понимаем что он сломан потом его чиним очень долго и упорно и получаем огромный когда он начинает работать хорошо и завершить наверное доклад хотелось бы короны фразы Олега бортунова нужны слайды Вот как раз тот qr-код который я обещал вот это ссылка на те слайды звали Меня зовут Меня Михаил Жилин Прошу вас достать свои телефончики и голосовать вот помощью вот этого qr-кода заданный доклад если он вам понравился то лайк не понравился дизлайк любой фидбэк Спасибо вам огромное Спасибо большое Рука уже поднята Кто быстрее Ну ладно ты быстрее я бы на таких ножках тоже бегал но у меня другие пожалуйста Спасибо за интересный доклад не значит ли вот от работы вокруг индекса что в воздухе пора сделать индексные организованная таблица как это кое-где есть а может быть но лучше решать конкретную проблему и ускорять конкретно ее потому что ну как бы вот запрос есть и от него уже никуда не деться он где-нибудь еще наверное выстрелит поэтому лучше исправить его тоже пожалуйста Спасибо большое за интересный доклад возник вопрос по субтранзакции затронули больную тему и хочется спросить вот это вот пачка который Владимир отправился общество Он уже вышел и анализировали какой прирост производительности он дает то есть Он решает проблему или все-таки транзакции надо отказываться патч он уже есть его идет обсуждение он дает прирост однозначно он улучшает sl.ru кэш позволяет но идут по параллельной дискуссии например Давайте избавимся вообще перенесем все shad batis и пока комьюнити не придет к некоторому горизонту Согласие он не будет принят То есть он помогает Вот ждем когда все придут к единому мнению сложная но интересная так следующий спасибо Вот Будешь добрый Михаил Спасибо за доклад сейчас Российские компании начинают Ближе ближе микрофон Российские компании начинают смотреть на риск файф платформу вот Занимаются ли постгры с Professional с портированием постгарса на рисква и в том числе оптимизация Вот давайте кулуаров обсудим Вопрос хороший но Ну пожалуйста еще Сейчас я посмотрю что там в чате даже можно в чате вопросы задавать вы пока Подумайте друзья о чем спросить еще три два один и наш супер просто приз уходит автору вопроса про под транзакции Да а Магните рукой пожалуйста вот сейчас наши коллеги вас найдут тебе тоже памятные призы от ручкой лоуда Спасибо мне друзья 18:00 здесь будем продолжать танец вокруг баз данных на этот раз уже с Яндексом но кто-то приходите послушать кто-то потроллить В общем все будут счастливы в конечном итоге однозначно Я кстати придумал как перед поездкой в Ереван можно говорить Может говорить спасибо спасибо друзья готовьтесь к автопати поговаривают Чтобы участвовать в автопати нужно ВКонтакте раздобыть фишечки для игры Сделайте это Потому что пирпонг сам себя не обыграет и тоже чтобы играть в покер нужно к этому готовиться следующее выступление 1800 всегда хотел сказать как комментатор хоккея перерыв вот отлично друзья под ваши бурные нескончаемые Аплодисменты мы подошли к докладу который финализирует первый день дальше только автопати на автопати помните две вещи первое чтобы поучаствовать в вечеринке ВК нужны фишечки и второе завтрашний доклад по-прежнему в 10 утра Берегите себя кто не на зоже особенно Берегите себя а кто нас уже увидимся завтра в 10 Итак вы аплодируете А я представляю вай вай вай деби выходит на эту сцену Денис и Кирилл это парный доклад парном докладе очень важно сделать что если твой коллега говорит долго ты в это время сидишь в зале они стоишь на сцене и не думаешь куда себя деть ребята сцена ваша Готовьте вопросы Да всем привет Очень классно видеть Столько людей я честно говоря удивлен что столько людей дожило до конца потому что я бы не Дожил последний доклад короче Молодцы Сейчас тогда быстро скажу чем мы Кто такие Что делаем попытаюсь короче без Булл что все будет через по делу Итак давайте тогда начнем вот горизонтальная масштабирование постсквель что это такое Кто такой мы вот в Облаке сделали такую штуку чтобы начать масштабировать но перед этим небольшой дисклеймер Да и мы об этом собственно хотим рассказать передать небольшой дисклеймер что в этом докладе будет три лжи то что мы сделали не то чтобы не до конца работает оно работает но не то чтобы выкачено куда-то но не выключено То есть она уже прошло вот эту стадию когда Это вроде бы прототип но это уже точно не прототип но еще не пришло в стадию хоть сколько-нибудь где-то работающего проекта вот так вот скажем Так кто такие мы мы себя скромно называем Open Source rdbms-девелопмент Тим в Яндекс облаке ложь номер раз это далеко не все люди которые тут есть да чем мы занимаемся Мы контрибьютим в постгры с Green Plan мы к интервью тем ним в LG разных кластера совершенно разные ресурсами И в основном это highwalability кластера то есть кластера в которых несколько хостов Итак зачем мы хотим научиться масштабировать постскрискуэль Ну просто типа ну потому что хотим мы этого очень давно хотим это наше давняя мечта чтобы в нашем сервисе была такая кнопка и ты нажимаешь ее и у тебя как бы кластер он как бы разъезжается на несколько кластеров это такая как бы наши давняя мечта Итак что мы хотим от шортирования Примерно вот так выглядит типичный постгрискольф кластер там есть мастер там есть реплики на реплики читающие запросы приходят на мастер пишущий Читающий куда-то как-то уходит в вал в хранилище Как там бэкапа в общем как-то так а вот так мы видим типичное приложение наших пользователей что есть несколько бэкентов и они каким-то образом подключаются к нашему кластеру так вот мы думали вот было бы круто короче сделать какую-то штуку чтобы она вклинивалась между ними и каким-то образом сейчас переключится слайд каким-то образом Решала куда надо перенаправить запросы при этом совершенно понятно что в нашей ситуации У шардов могут быть разные ресурсы Вот и так а теперь что мы попробовали для того чтобы сделать так Ну во-первых да что мы попробовали что мы хотели сейчас переключится слайди Ну вот на этом слайде Ладно пофиг что мы пробовали Ну во-первых давайте вот обговорим Что именно Мы хотим получить в итоге Какую именно Какой именно сервис какой именно приложение что он сейчас значит что как мы видим вот наше решение наше решение заключается в том что есть какое-то количество кластеров разгресс они как-то там настроены есть клиент который хочет выполнить на них запрос есть наша нечто которое мы называем Вот на этом слайде роутер который может взять запрос и понять на каком шарде нужно выполнить этот запрос для того чтобы он выполнился успешно при этом подразумевается что данные которые хранятся во всех этих шортах Ну они как-то шортированы по какому-либо признаку по каким-то правилам и эти правила они контролируются как-то на роутере это в общих словах То есть есть клиент он отправляет нам запрос вот на слайде здесь написан Select здесь есть very Close там Y равно 3 мы допустим можем посмотреть на это запрос и понять что ну по какой-то причине мы поселили все значит данные у которых Y равно 3 на первый шар Давайте отправим этот запрос на первый шаг вот если у Вас если там как буквент примерно такая загрузка то мы вот можем его как-то шантировать что мы пробовали для того чтобы написать решение значит первый подход был очень простой сейчас слайд переключится Ну первый подход заключался в том что в возрасте уже написано очень много решений различных например есть инфраструктура extensional Fishing из инфраструктуры внешних таблиц они работают Почему просто не использовать внешние таблицы то есть что мы можем сделать от ВДВ это форунды то есть в воскресе есть способ объявить таблицу внешней и также есть способы вы видите как бы нечто Что называется сервер который занимается тем что доставляет данные из этой таблицы которая внешне Ну мы ровно это сделали мы написали свой фонд рэпер который работает очень просто он берет запрос соответствии с какими-то правилами понимает что он должен был Должен быть выполнен на там допустим первом или втором шарле отправляет туда этот запрос получает данные отправляет их клиенту Все очень просто всё должно работать какие здесь проблемы первая проблема заключается вот ровно в этом запасе который написано слайде значит если такая достаточно умная база данных каком-то смысле вот если у вас insert происходит какие-то данных которых есть какие-то волатильные функции например на Вот именно функции то после не сделает один вызов к ВДВ партиру он сделает два вызова первый Вызов будет Вот insert как на слайде второе Вызов будет апдейт при этом здесь есть вот неприятная колонка стит это идентификатор table и проблема в том что это невозможно заработать это просто когда ты байтов на диске это не то мы можем взять и сказать что вот у нас есть табличка у нее есть колонка Давайте все ключи меньше 10 живут на Первом что тебя все ключи больше 10 живут на втором шаге для стидов такое сделать невозможно ну эту проблему Конечно можно решить например переписав там очень много входа в возрасте но мы решили так не делать мы шли попробовать другое решение оно в целом немного подсмотрено вот у ситуса сделано примерно также мы можем просто взять и попробовать выполнить просто самим спланировать и самим выполнять для этого нужно взять хук способ переопределить как бы хук для планировщиков и просто выполнять все самим То есть можно взять запрос распарсить его вставить до свои как бы ноты потом их выполнять это в целом тоже работало это показывала какие-то в целом неплохие результаты то есть был посос который снова просто партии запрос отправляется значит результаты на шарт и там получается результат выполнения судах и возвращает данный клиенту вот здесь написано что мы смогли выжать из этого 5000 ТПС на тесте Что такое 5000 PS это 5000 транзакций в секунду ну мы целились цифру 2 миллиона секунд что нам помешало вот вырасти еще больше вот нам буквально в пять раз нужно увеличиться Чтобы достичь цифры 2 миллиона TPS помешало то что позга с этой базы данных То есть как бы вот мы пишем extension да он выполняет внутри базы данных но он не выполняется отдельно как бы мы не контролируем очень многие вещи например пост перед тем как выполнить запрос он проверяет что этот запрос он обращается к таблице которая Действительно существует там в этой таблице есть какие-то запросе У вас есть какие-то колонки эти колонки реально существуют они относятся к этой таблице у них там везде правильные типа данных это все очень большое количество проверок которые мы не хотим делать потому что Ну это конечно круто что вот какая-то штука которая выполняется просто вот будет Вот это всё делать но это будет сделано второй раз уже нашли поэтому это вообще не нужен соответственно нужно от всего от этого избавиться то есть большое количество обращений к значит к каталогу поисковому это как бы место которое наступит здесь возникает большой Лог антенн мы не можем значит из-за этого вот из-за всего выжимать какие-то большие числа из нашего решения Мы хотим большие числа Ну получается что еще проблема была в том что он написанности писать на себе больно типа долго Поэтому мы решили написать там быстро просто можно буквы точнее перемены называть одной буквой вообще все отлично значит мы написали нечто Что называется стоит роутер значит он не стоит сразу скажу он имеет какое-то отношение к возрасту правильные слова как он работает он слушает значит какое-то порт и общается по по протоколу passgress а то есть мы принимаем к роутеру к нему можно подключиться просто поисковили отправить какие-то сообщения по протоколу прогрессу он вам ответят типа в целом если вы не знаете что вы общаетесь с роутером вы будете думать что вообще эти базы данных Но на самом деле что будет происходить так этому будем брать ваш запрос просто парсить его вот на запросе на слайде мы взяли insert нам даже пофиг какой таблицу на обращается это очень важно мы просто взяли и посмотрели то что вот есть иди ее значение 14 Ну по каким-то заранее сконфигурированным сконфигурированным правилом мы поняли что ключ 14 лет поэтому мы туда его и отправим этот вопрос выполним в нем результаты клиента вот insert 01 это просто ровно то сообщение которое вышло шаверму его прикинули обратно отлично типа есть какая-то программа на Go которая умеет вот это делать сейчас переключится слайд ладно значит пока слайс переключается короче есть в целом два способа раскидать свои данные по шардам Если хотите пошутили свою инсталляцию как бы оба они очень простые Вы можете либо взять сказать то что вот у меня есть данные Давайте часть из них лежит на Первом что тебе просто подряд вот типа там у меня есть таблица в ней есть какие-то ключи это числа целые Давайте все числа меньше 10 на Первом шаге все числа больше 10 но меньше 20 что где и так далее ну типа мы называем это шодирование по диапазону ключей точнее все называют это по диапазону ключей есть второй способ сделать то же самое Это шодировать Не сами ключи а просто хэши от них мы используем во всех своих тестах во всех своих значит инфляциях первый способ второй способ наверное тоже интересный можно использовать но мы так не делаем в целом ничего сложного в этом нет хорошо получается что вот Ну что мы получили написав роутер ногу мы получили что у нас есть какая-то программа которая принимает значит клиентские коннекты обрабатывает их как-то и отправляет на шарды получается у нас есть вот какая-то одна точка отказа это очень плохо типа наши там распределенной системы одной точки отказа быть не должно из этого следует простой вывод мы должны вот сделать много роутеров у нас особо Выбора нет мы должны там гарантировать какую-то отказу устойчивость хорошо два роутера когда вот вот мы пришли от одного роутера к двум у нас получилось следующая проблема Если бы у нас были какие-то фиксированные правила шортирования которые никогда в своей жизни меняются то он типа все было бы просто взяли роутер сказал фигурировали в один раз в самом начале и типа жили бы спокойно но к сожалению возникает необходимость значит привозить какие-то данные между шардами это такая практическая необходимость реально существует поэтому сразу решили тоже с этим вопросом а что мы сделали для того чтобы значит это сделать у нас есть сервис-скриминаторы зачем он нужен значит это данные на роутерах они не одинаковые могут быть то есть значит правило по которому роутер решает на какой шар отправить Ну какой-то конкретный запрос они меняются во времени потому что мы хотим перевозить это мы хотим гарантировать следующее вариант если к нам приходит клиент и просто типа пытается выполнить запрос том то вне зависимости от того на какой роутер он пришел он получился один и тот же результат там неважно перевозим сейчас какие-то ключи не перевозим сейчас какие-то ключи может быть роутер упал Ну тогда всё просто приятность может выполнить запрос вообще идеальный случай значит хорошо Ну понятно что также что с точки зрения клиента вот то что роутеров много это вообще не проблема типа там выходили там в один and Point нужно ходить в 2 Ну позже в подписи через запятую дописывать еще один хвост в конечностинг Типа все продолжает работать Проблема в том что мы должны Как бы на роутерах какую-то логику реализовывать То есть если сейчас у нас есть какой-то ключ который мы привозим между нашими то наверное к нему не надо обращаться на запись и вот всем вот этим вот занимается координатор он сообщает ротором Ну какие вообще можно запросы обрабатывать Сейчас Какие вопросы обрабатывать нельзя и своими данные то есть какие есть ключи какие есть правила шарнирования там где они все живут в чем то что называется Коди би а ну db это Database Q это буква которая мне нравится и y уже была занята поэтому кудиби бодибил нельзя Можно кудибил получается отлично так вот пример для этого нужен координатор то есть когда-то занимается одну он на самом деле нужно для того чтобы понять Ровно одну задачу хорошо перевести ключ между шардами Ну вот еще здесь написано что он занимается менеджментом ключей шодирования и Recovery Ну то есть если у вас выключился роутер то потом он поднимается у него могут быть старый метаданные нельзя разрешать сразу ему выполнять запрос он должен Подождать там актуальных данных и всё такое то есть Recovery тоже делает с помощью Отлично Теперь Чуть более значит детально про то что такое перевести ключ Ну вот есть значит нагрузка какая-нибудь Ну у вас есть какой-нибудь шагирование Например ключи от 1 до 10 и вы как-то часто допустим начинаете обращаться к ключу номер один ключ номер один ключ номер два прям настолько часто что Sharp на котором живут эти данные Ну на нем уже заканчивается все ресурсы которые на нем есть там память что для этого ну что в этом случае логично сделать логично взять ключ один и перевести на другой шар чтобы размазать нагрузку более равномерно Ну ровно это мы сделаем с помощью каллятора Мы возьмем Значит все роутеры заблокируем на них какой-то ну там возьмем какой-то диапазон ключей распилим его на маленькие кусочки и начнем перетаскивать на другие шорты то есть вот не так как на этом слайде когда мы перетаскиваем половину данных а вот как на этом слайде чтобы как можно меньше для Ну пока мы перевозим ключ с одного что-то на другой нельзя к нему обращаться не начни на запись поэтому мы не будем перевозить половину данных данным маленькими кусочками что для этого Сделано для этого у нас есть специально обученный разработчик который умеет тоже писать экшена и он написал extension который называется PG comments сейчас переключится слайд Ну в общем смысл этого extention заключается в том что мы можем агрегировать вот да есть значит extension который может ну который решает очень простую задачу он может сгруппировать запросы по каким-либо правилам так чтобы оценить вот значит Каким можно использовать для того чтобы понять какие диапазоны ключей больше всего загружены там по памяти по диску и соответственно с этим принять решение о том куда их перевозить отлично так пока переключается слайд не знаю даже что сказать Ну вот такой extension Ладно неважно В общем Какая идея у всего этого ну нам типа не нужен какой-то продукт который бы решал очень большое количество очень сложных задач Нам нужен продукт который у которого есть там одна оригинальная идея оригинальный заключается в том что давайте просто будем выполнять наши новые запрос и какое-то количество костылей вокруг для того чтобы жить Ну не была настолько сложно то есть там какое-то количество встреч чтобы можно было как-то пользоваться Поэтому вот Обычно Обычно мы запрещаем запросы которые обращаются сразу несколько дам то есть на роутер прямо код написан который там случае если вы хотите по джоннить данный из двух шагов то есть вас запрещаем это клиент получится ошибку но некоторые вещи запрещать неудобно например создать таблицу через роутер Было бы очень удобно неудобно там братья на каждый шаг заходить прогонять какой-нибудь прогонять какой-нибудь миграцию чтобы создалась табличка для тестов гораздо удобнее делать так чтобы ну вот можно было какие-то простые запросы выполнять через роутер даже если не будет там какие-то очень плохие никакие снятные там не двухфазные транзакции вот допустим клей телом мы разрешаем мы делаем его с помощью best of То есть это какая нефазная транзакции Просто берем и отправляем вашу просто все шарды если выполнить то он выполняется если он упадет где-то на каком-то шаге то но это будет очень грустно но это не контролируем значит это не для Production или какого это просто если хочется что-то потестить то вот это удобно использовать также то что мы разрешаем это мы разрешаем Селект Star То есть если вы хотите поселить все Ключи из какой-то таблицы то Ну вы получите не сидят на результат но Мы это сделаем потому что это тоже удобно так вот здесь вот видно что creat able отправилась на все ширды вот здесь видно что себя Стар работает то есть у нас есть допустим табличка с которой есть просто две записи первая запись живет на первом что тебе вторая запись живет на втором шаге здесь видно что запрос выполнялся Хотя Казалось бы он не роботится взяли его отправили и поджог или результаты там у нас есть специальное место где написано специальный код который говорит что типа если здесь пришёл до второго и здесь пришёл то вот ну попробуем их как-то совместить если они разные то всё плохо если они одинаковые там попробуем что-то ответить клиенту это все это не кассетный листинг допустим его можно использовать только для блага какого-то для настоящих типа вот если бы прямо хотим хороший трудовые запросы как ты выполняется но мы хотим наверное то нужно делать то мы будем использовать другой подход так Это я уже говорил короче сейчас как мы все-таки хотим выполнять судовые запросы Ну на самом деле то есть сейчас мы допустим это как-то не поддерживаем Но вот в будущем в будущем будет такая штука роутер он хорошо делает одну вещь он хорошо выполняет запрос если он может выполняться на одном шаге Иначе мы хотим просто делать на некоторые некоторые нечто Что называется Волжский Что умеет собрать какой-то консистентное представление данных как-то атамарно выполнить в них какую-то операцию или как-то данные с разных шаров для этого мы смотрим сторону ситуса на самом деле то есть Было бы отлично если бы могли использовать ситус для этой задачи но также есть вариант делать Не ситус а для кого-то на самом деле потому что в нем уже есть планировщик орка который очень модуль на него можно переиспользовать можно для этой задачи Вот использовать ситус или Green Club мы пока еще не знаю чем мы хотим из этого использовать но это не наши сна кейс на самом деле не волнует очень хорошо так и дальше Денис расскажет про бенчмарки и про всякие другие интересные вещи не работает можешь мой поговорить чё все работает все спасибо большое Так я вернулся на сцену собственно ребята из пост вы видите какую-то табличку тут какие-то чистилки ребята из позже померили наш роутер в сравнении с другими решениями другие решения и сам POS и в целом и можно не считать В целом вывод такой что это как-то работает и вроде даже хорошо работает А верхает в сравнении с ванильным возрастом Не такой уж большой но нам нужны были пруфы самим хотя бы что это точно хоть сколько-нибудь работает я погонял бенчмарки с бенчем провел несколько тестов и нам нужно было проверить что да При добавлении новых чертов говорил это не увеличивается это так давление наших шардов не добавляет времени выполнения запроса второе нам хотелось померить все-таки какой оверхед на добавление на использование роутера и в моих тестах У меня получилось примерно от 8 процентов до 20 процентов не знаю насколько можно доверять этим результатам просто типа это факт теперь для тех кто не понял как этим пользоваться Это нормально Короче было много слов сказано но непонятно как этим пользоваться вот сейчас для вас будет демо Надеюсь все прояснится Ладно подождем суть в чем немного забудем пресс-пауэр Представьте есть такое приложение которое как будто бы как бы агрегирует новости называется агрегатор новостей News Demo оно состоит из двух штук Это буквально сервер который вот эти на партии статики отдает внутри этого приложения на самом деле вот лежит такая простая табличка артикул который там есть и описание и внутри этого приложения используется когда запроса Select Star из таблицы и вставка какой-то статьи в таблицу при этом заметьте мы вставляем не просто так мы вставляем Хеш от урла вот этот хешек он как бы строку Маппет в какую-то чиселку чтобы это это очень странное предположение что у статьи будет один и тот же URL Но вот это так работает Просто URL преобразуется в какую-то чистилку Итак чтобы запустить это приложение нужно буквально сделать Make там два бинаря запускаешь 2 бинаря указываешь как подключаться к базе В общем ничего сложного и как начать шортировать такое приложение первым этапом это первым тобой является собрать из исходников запустите Polar настроить шортирование настроить эти вот правила шодирования которых говорили раньше и запустить приложение Итак spacolar эта штука выложена на гитаре всегда было выложена на хобби И будет выложен хабе и всю разработку мы ведем ведем там можно Кстати если чего зайти поставить звездочку нам будет приятно мы собрали Мы зашли короче поставили звездочку собрали роутер запустили роутер вот запустить роутер следующий этап у роутера есть конфликт в котором указано какие-то общие дефолтные настройки типа уровня логирования или показывать или вот эти сообщения или еще что-нибудь там указано правило как подключаться к роутеру там указаны глобальные правила как подключаться к шардам у имя пользователя название базы И там список шардов это весь этот текстовый конфиг роутера также у роутера есть административная консоль Да представьте спукуар уже запущен к нему можно подключиться по двум портам один порт это штука которая вот эти вот запросы обрабатывает другой порт который ты подключаешься чтобы вот эти правила шардирования сконфигурировать то есть буквально что-то происходит берем подключаем все консоли мы делаем шоу sharks Да видно что есть вот такие шарды прям как в конфиге и добавляем shardin.ru название по такой-то колонке ID все видим что шардин рулл добавился теперь добавляем кейнжи то есть с какого по какой айтишники на какой шар отправлять его тут буквально написано что айтишники с одного по X отправляя на shard 1 айтишники с X по 2x отправляй на Sharp 2 тут Это буквально написано можно кстати не читать Теперь мы можем действительно посмотреть Что добавилось такое правило шортирования добавился такой же и можно Подключиться к роутеру Да роутер начинает эти правила использовать но суть в том что там дальше может было бы написано что мы делаем запросник который Ну допустим Select в ID равно 1 и мы точно знаем что этот запрос заведомо должен попадать на первый шарт и о чудо это происходит или запрос запросит типа Select в очень много а вот так вот Окей был нормально начинаем скорее Table вот мы видим тут что Create был отправить на оба шарда потом мы пытаемся делать селекции видим что они действительно попадают на один шард на первый шаг на второй шарт В общем Суть в том что наше приложение Ну вот так вот начинаем шортировать то есть ничего даже в самом коде приложения менять не пришлось Окей в принципе да это тоже чем я говорил в принципе я уже сказал да Раньше у нас открытый процесс разработки У нас есть репозиторий Можно нам помогать И мы бы были бы очень рады если б нам кто-нибудь помог и попытался запустить эту штуку то есть буквально спланировать репозиторий и сделать мой экран у нас есть Telegram чатик в котором можно задавать вопросы Мы были бы очень рады если бы кто-то когда-нибудь нам когда-нибудь кто-нибудь попробовал и нашел кинь баги пришла прислал нам фичери квесты это было бы очень полезно Также можно запустить этот демо-приложение оно живет в соседнем репозитории всё на этом все спасибо про лучший вопрос еще давай так мы ждем вопросы и за лучший вопрос будет какой-то подарок но я его не вижу Если честно вопросы погнали первый даю свой Всем привет Спасибо за доклад Скажите как вы боретесь с коллизиями например Когда шардирование происходит по кругу то есть там с первого по 10 в одном и так далее Это понятно но сами данные могут прийти могут быть по-другому настроены В итоге данные перетекает из-за того что там другой И если они перетекает ещё не совсем удачно то сами данные могут остаться на двух сортах и в итоге когда мы пойдём отпрашивать через роутер вашей схеме по всем шарам то мы получим одни и те же данные и как вы группированы когда мы будем на роутере спрашивать там всех Стар допустим он просто не сможет получить эти данные которые ещё не до конца приехали потому что мы заблокировали ключики Там есть ну такой достаточно простой который блокирует какие-то ключи вот там есть тебе все вот это дело когда поддерживает такие варианты что вне зависимости от того В какой момент ты выполняешь Вопрос на каком роутере ты всегда получаешь данные как будто Роутер 1 А если роутер один то понятно Каким образом ты гарантируешь А вот extensional который вы говорили который перетекает из одного шанда в другой он берет сколько не совсем немного данных чтобы шарт грубо говоря там секунду только был заблокированный Просто какой-то маленькое количество да Ну время не могу сказать но смысл в том чтобы переезды Были очень маленькие следующее когда берётся через как рассчитывается вот эти вот сейчас могу сказать что никак не рассчитывается просто данный приезжает подряд Наверное это может записать да Спасибо большое вопрос из чатика Как вы обеспечиваете консистентное состояние метаданных в нескольких роутерах полученных от координатора Могут ли два последовательных запроса в разные роутеры уйти по ошибке на разные шарды Ну нет то есть значит как мы гарантируем кастетность Ну вот у нас есть код который ты гарантирует я даже не знаю как это рассказать это долго Ну мы занимаемся тем что вот допустим у нас есть какая-то система из двух роутеров у них есть какие-то данные значит если мы ничего не меняем все хорошо если мы хотим перевести какой-то ключ с одного Шара на другой то мы занимаемся следующему блокируем этот ключ на Первом что ли блокируем потом перевозим данный физически после этого меняем метаданные так чтобы вот они указывали на другой шарт после этого разблокирован значит оба роутера разблокируем эти диапазон ключей и всем этим занимается Ну если это ответ на вопрос я не знаю точно ответил если не ответил Напишите в чате поругайтесь Следующий вопрос Добрый вечер Меня зовут Николай Я хотел спросить вопрос Чем отличается вот подход выглядит так как будто бы процитирование Но делает примерно те же задачи или вы хотите просто контролировать именно то на каких шардах то Что располагается для более точного контроля Так мы контролируем на каких шардах Что располагается Green Plan для для аналитики У нас oltp вот разница с перформа сидел Ну окей нужен для лоб нагрузки там есть просто соответственно тоже может задать куда она распределяется распределяется на разные соответственно Ну ладно хорошо Если попробовать использовать гримплант волчки нагрузки там получится очень плохие числа если Ну то есть Спасибо Спасибо что с транзакциями если на них планы вообще и второй если это Вроде это еще в конце Какой первый вопрос что с транзакциями что с транзакциями если их ещё нету Какие планы на них не ну транзакции то есть значит в роутере написан прям код который занимается тем что он поддерживает состояние сессии То есть если ты сказал Беги то мы запомнили у себя в мозгах что у тебя сейчас если ты ну отправили следственный беги на тот шарф на котором ты будешь выполнять свой запрос потом ты присылаешь свой там первый Селект мы его отправляем у тебя на шаг где транзакции открыто ты выполняешь seart мы отправляем всё что там тоже открыто транзакции если ты отключаешься то мы тебя лба если ты сам решил запомнить то мы прислали только МИД в этот шаг то привязано Можно я попробовал по-другому ответить А те запросы которые выполняются на одном шахте консистенты те запросы которые наполняются на всех не консистентны всё там даже если вам транзак да попросили э-э да да да да это мы делаем мульти шар запросы просто для того что бы я не знаю как просто принять нашу наилучшие усилия вот так вот типа условно вот cree Table если бы вот не было вот этого мультишар запроса как cretable пришлось бы заходить на все шарды и всё равно создавать таблички как-то не консистент мы можем написать транзакции в роутелем просто это не делаем хорошо Ну транзакцион работает Это садовый запрос Ну скорее вопрос в том и планировать точно нет И второй вопрос тогда сразу повторю а вроде это уже где-то есть используется У нас есть доктора но у них пока Спасибо Отлично вот с этой стороны еще есть вопросы параллельно смотри qdb тоже должна масштабироваться не должна масштабироваться там метаданных буквально на там реально очень мало да то есть на мегабайты это не нужно мегабайт это даже много для кутипи хорошо У кого микрофон у меня А вот пожалуйста я правильно понимаю что координатор это Battle nake всего этого решения что с его надежностью и так далее Потому что но он типа да это одна тачка но нету никакой проблемы там сделать тоже какой-нибудь такая штука которая администраторы грубо говоря запускает чтобы перевести там не очень-то и нужна какая-то устойчивость То есть тебе нужно чтобы запросы просто работали вот роутеры просто работают для заранее скопированных правил Если ты хочешь понять ты используешь координатор Ну если правила типа подними и второй вопрос говорили насчет транзакций Что будет если блокируется набор если у нас открылась транзакция а затем у нас начал перетекать с одного шадана Другой у нас откатывается вся транзакция короче если ты начал выполнять транзакцию и при этом привозят ключи да да Ну если ты начал выполнять транзакцию то на роутере на котором ты выполняешь Мы возьмем блок на тот диапазон ключей который он сейчас использует координатор который захочет привести ключи попробовать взять Лок на каждом роутере и не сможет взять лоб на том роутере который сейчас общается с этим ключей то есть будет ждать пока транзакции закончится спасибо Вот 18-28 под конец уже прилетел прилетел вопрос какое-нибудь Значение вот такой СПб для каких задач она предназначена в которых все другие не подходят в которых все другие не подходят другие сободэ видимо Ну вот часть про которых все другие не подходят это очень сложно но в целом Если у вас есть какая-нибудь сервис который может допустим хорошо шодироваться типа по юзерам или по каким-нибудь там баке там неважно типа то вы можете использовать это практически то же самое что у нас используется других сервисах для шортирования просто обобщенное решение можно маску в Twitter предложить пожалуйста ребят Спасибо за доклад зовут Дмитрий есть такой кейс существует база данных и авторы база данных которые любят хранить таблицы которые нужно шортировать и таблицы которые не нужно шардировать одно и той же схеме и любит там например посадить джабу которая будет раз 15 минут ходить в локализацию собирать свежую локализацию дизайнеров заливать базу потому что удобный способ интегрировались Зачем завозить Расскажите поддерживается ли Будет ли работать Я слышал Утверждение что ЛТП там всякие запрещены запросы в несколько шардов запрещены если это не Селект звездочка Вот это не бьется с этим кейсом и если планы я понял вопрос я попробую на него ответить или не попробую Я короче думал об этом и чисто мои мысли Мы конечно это пока еще не обсуждались ребятами но очевидно это еще зависит от того что это за таблицы вот эти таблицы которые не шортируются Они часто изменяются или не часто изменяются если не часто изменяются то у меня есть решение Ну может глупая еще зависит от того Большая таблица спрашиваешь хотим ли мы делать трудовые запросы в будущем В смысле у тебя есть табличка которая хорошо жердируется Но рядом сервисе еще таблицы которые ты бы не хотел шортировать и для которых ты хотел стать они должны где жить таблицы которые не только не хочу шокировать я хочу их иметь одинаковыми Да у нас есть такие случаи мы это короче вот я не знаю насколько рабочие Кстати да вот если ты не хочешь шортировать Возможно всё-таки ты можешь её шортировать если ты шортировать но вот если вынести все эти таблицы какой-то отдельный кластер и подключаться шардов ВДВ короче к этим к этому кластеру Вот будет ли это работать я не знаю но я хочу писать запросы с джойонами на эти да и Каждый кластер должен выдавать результате там с айдишником моего там условно кастоммера или там мои там конференции и её локализованным именем из документика который залили дизайнеры Короче давай так у тебя есть ответ на этот вопрос У меня есть предположительный ответ на этот вопрос я короче понять не имею Будет ли это работать обязательно следующий раз когда придем что-то рассказывать вспомним и расскажем об этом типа мы по-любому короче это решим Спасибо Надеюсь кейс был полезен вот эта фишка парного доклада У меня есть друзья там на вечеринках все время жена задает вопросы а муж на них отвечает и короче всем остальным участвовать в дискуссии нельзя Будьте добры вот три раза мы вам не давали задать сейчас Добрый вечер подскажите пожалуйста основная задача горизонтально масштабирование есть какое-то количество максимального шортов Жалко что я вот изначально в тысячи шардов но к сожалению у меня не хватило квоты чтобы создать тысячу шортов я запускал тесты Ну вот я говорил что я проверял Действительно ли что при добавлении шортов не увеличивается Здравствуйте я смог создать запустить роутер с двумя четырьмя восьмью 1632 64 и на 90 у меня закончилась квота я не смог протестить это Но вообще мы целимся в это и как будто бы действительно сможет 1000 шардов держать роутер то есть один Ну два роутера как будто бы вот ну вот на 80 точно типа 890 держит Следующий вопрос Нужно ли будет увеличивать количество роутеров зависимости от того Какое количество шаров Ну то есть какая-то зависимость будет Или настолько два месяца вот все Ну типа если один роутер не вывозит давай рядом второй поставим в целом логика была такая Окей спасибо спасибо Андрей выставлю Здравствуйте продолжим тему мигрирующих шардов смысле мигрирующих данных между шардами пошел запрос запрос отработан роутером в запросе в данной конкретный момент указываются те данные которые поехали шарда Шарм Как выглядит процедура отработки этого запроса со стороны клиента ожидания ты ждёшь Локи Да понятно Значит данные уехали это как бы Спасибо первым на первый вопрос Это так было значит Вопрос номер два данные Поехали Да ну ехали на другой шарт перед этим данные брали с первого шарда ошибка да да ошибка ошибка Но типа откатывается то есть пока вот в данном варианте это все в продакшене чрезвычайно К сожалению но неизвестно сколько часто Вот именно этот Иисус призывается Так что просто если данные меняются постоянно если данный перевозят постоянно данный перевозится если данный переводятся постоянно Значит мы что-то делаем не так К сожалению это вопрос объёмами то есть если там где запрещается у нас идея перевода заключается вопрос Вообще специалист по перевозу данных У нас вот во втором ряду сидит Да жалко что он не вышел не выходит в этот раз на сцену но я думаю можно к нему подойти потом поспрашивать как это могло выработать у меня ощущение что это Объединенная экзаменационная комиссия сейчас накинулась ребята вдвоём считают диплом Да будь добры отсюда потом здесь по традиции два вопроса Первый вопрос вы показывали такое SQL интерфейс А вы правила шарнирования Где в постере сохраните нет правила шарнирования и также в специальной базе данных которые на стадии называлась Куди то есть типа ты создаешь вот как на слайде было написано это для простоты типа когда у нас один роутер мы можем просто у него в памяти менять правила на самом деле правила создаются через координатор гранатору сначала записывает какую-то база данных потом рассказывает всем роутером какие у них теперь правила А это база данных она отдельно ее нужно отдельно поднимать чтобы все это работало это база данных она в ней там полтора мегабайта короче хранится даже если очень много правил То есть это не должно быть проблемы и второй вопрос У вас же на голову есть библиотека которая умеет делать вызов в эсор и возвращать Там просто структуры То есть это очень удобно не надо делать после этого ну определяете в какую шарту Да он возвращает просто дерево вот прямо как структура данных вот в возрасте описаны все вот эти вот я к файлы вот прямо вот этими с лишними структурами только ну аналогами в год вот такая штука возвращается Спасибо но ты начинал Ты завершай Да спасибо есть такая часть скажите еще созрел Вопрос такой что если мы представим совсем высоко нагруженный проект и там миллиарды запросов секунды к одной таблице которую нам нужно перевести и у нас меняется ключ мы начинаем перекликать данные из одного в другое и вы сказали что у нас становится Лог на на вот этот объём данных если этот запрос требует Ну перебора всех шардов то получится на все э-э данные шорты и соответственно пока нагрузка не спадёт она может вообще не спасти то и мы не наполним там новый шар и она просто данный не будет критикать или будет наоборот очень очень много ожидания от базы данных от роутера что соответственно тоже может привести к печальным последствиям на нагрузках вопрос в том что будет если данный долго приезжает правильно вопрос в том что есть я могу представить как вот эта схема работает на ненагруженных проектах То есть у нас база данных сидит ничего не делают у него появилось время и данные поплыли при перетекать А если Ну там сильный сильный лоуд на на роутер то тогда у вас не будет времени на перетекание данных и соответственно вся эта схема ломается Короче я не понял просто я тоже не понял сейчас давайте в куларах и отлично Да я понял вопрос я отвечу вы сейчас суть такая что у тебя очередь блокировок общая у клиентской нагрузки и у сущности которая перевозит отлично Все друзья у нас с вами 7 минут еще до второго ужина Давайте ответим еще в интернет Здесь был вот такой вот такой вопрос вот здесь смысле речь идет про гринплам Что будет если утро потеряет связь координатором если не смог отправить команду на блокировку Ну клят они перестанет работать роутер если потеряет связь с координатором старые правила и типа он мог не отпустит допустим то есть а теперь анекдот Кому мы подарим приз за лучшие вопросы да кому-то можно задать Я думаю можно еще вопрос задать Да конечно Вот вы говорили про то что у вас кросс-шардовых нет запросов а мульти шардовые возможно но например сделать из селекта то есть оно на каждый шард раскидывается и там локально это делается Такое возможно но мы не хотим поддерживать традиционность всего этого дела поэтому делаем так интеллектом Ну я запишу в голове у себя я запомнил ты еще наш подарок это были русские хакеры они отобрали у волонтёра микрофона и задали вопрос Когда уже нормально А сколько у вас призов Да мы хотели подарить его тому джентльмену и сейчас мы его только найдем он был тут Кирилл Денис вам памятные призы от хайлу за выступления друзья Ну что ж это было прекрасно и завершение первого дня спасибо большое Вы шикарное экзаменационная комиссия Уважаемые члены экзаменационной комиссии в 19:00 вас ждет предостопадная еда Ведите себя хорошо в 19:30 автопати VK для этого у вас должны быть фишечки на этом первый день работы главного зала я завершаю и объявляю закрытым А завтра в 10 мы откроем его снова меня зовут Алексей бравец Поехали дальше это хайлу 20-22 живем"
}