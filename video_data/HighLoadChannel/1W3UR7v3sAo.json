{
  "video_id": "1W3UR7v3sAo",
  "channel": "HighLoadChannel",
  "title": "Школа магии PHP / Александр Лисаченко (Альпари)",
  "views": 14361,
  "duration": 2771,
  "published": "2019-06-06T12:21:02-07:00",
  "text": "tags всем привет а как меня зовут александр исаченко и я заявляю к водителям веб-разработки в компании альпари вот programmer мне уже довольно давно сталкиваюсь из семи лет и мне очень нравится копаться во всевозможных enterprises решениях придумать какие-то необычные решения вот и как уже роман сказал на я являюсь автором аспект на и темно фреймворка голову л.п. вот который в принципе является тоже одной из магическая штука сегодня мы на не обязательно глянем вот я также но она часто на меня могли заметить на user group of хоть потянуть руки кто меня вообще видел знал встречала где-нибудь на кстати нормально нормально не ленись и не все видеть так что не примелькался итак поехали для своего доклада я выбрал очень интересную тему касательно магию . есть хороший фильм иллюзия обмана то есть чем ближе вы будете сидеть и меньше на самом деле увидеть и эта штука как трюк магический трюк который позволяет проворачивать какие-то необычные вещи вот внутри всего на сон для того чтобы вас обмануть то есть если мы возьмем печки попытаемся ним что написать магическое скорее всего я вас обманул проверю какой не трюк и вы будете долго гадать почему так происходит вот а потому что hp довольно таки известный своими необычными штуками фреймворк язык программирования но мои думаю познакомимся и так что нам потребуется из магического снаряжения наверное это всем знакомые до боли какие-то методы констракте строкам это кол-кол static и to get what i stepped on set it as литвой cup парочка еще других методов и отдельному я отметил метод debug info с ним отдельные волшебные штуки можно проворачивать но на самом деле это не все потому что есть дик vortex узнать что это делает он пару человек знает и зал отлично не баг баг trace это наш спутник для того чтобы понять dimm обходимся в текущем коде посмотреть кто нас вызвал зачем нас вызвал с какими аргументами и мы можем принять решение не выполняют свою логику да такое тоже бывает есть конструкции такие как nct set вроде бы ничего такого особенно данный первый взгляд но тем не менее они скрывают много трюков который мы еще посмотрим и стоит отдельно упомянуть передачу по ссылкам потому что когда мы передаем какой-то объект или примерно по ссылке то стоит ожидать что с вами неизбежно произойдет какая-нибудь магия если вы знаете про замыкание и знаете что они могут биться это отдельный плюс потому что на этом можно построить добыл половину трюков которые известны и отдельно упомяну reflection и 5 потому что без него невозможный fuck некоторые штуки и стрим райпо итак поехали собственно кто знает первое правило маги из этого фильма не припоминаете я подскажу быть самым умным в этой комната круто но начнем с некоторого трюка которые называю мне возможность сравнения посмотрите внимательно данный код и подумать вообще может как-то такое произойти в печке да здесь мы имеем какую-то переменную объявляем ей значения а потом бабах и она сама себе не равна прикольно есть такая штука как ноты на амбар и удивительно особенность этого значения в том что на саму себя не равно вот такая волшебная штука то есть это первый наш трюк использовать это значение для того чтобы озадачить вашего соседа товарища дать ему коцка а чего смотри как можно написать но на самом деле решение для этой задачи не один а их несколько давайте глянем дальше есть конечно классический добрый вариант который был допустим раньше и в принципе существует сейчас называется он использование constant и фишка использовать констант том что мы можем спокойно для namespace а объявить floss как true и сравнить магер этого прикола в том что незадачливые разработчики долго будет гадать почему собственно там троне fast но оставим это на его совесть следующий трюк это уже артиллерия помощнее то есть у нас бы уже два варианта рассмотрим как работает данный вариант базируется он на такой штуке как тип фанкшн и как я уже упоминал adicolor tix как это все работает из коробки сперва мы объявляем некоторую функцию и эта функция как вы видите принимает параметр is magic по reference и дальше пытается поменять это значение натру вот что происходит востока к мы объявили дик верть x1 начиная с этого момента интерпретатор печке после каждой элементарной операции которую нас происходит называю начинает вызывать нашу регистра тег function callback и соответственно находясь в этом калмыки мы можем взять это значение которое было раньше фолз поменять внимание на труп и таким образом во всех трех случаях мы получим наши лет стартовом magic давайте передём к следующему трюку есть маленький пример в котором мы объявляем две переменные одна из них соответственно фолз другая true и делаем из блэк айз white и вардан прям результат давайте проголосуем за то какой будет результат кто голосует за то что будет true есть есть сеть кто голосует за то что будет фолз так а не понял стальные воздержались до ответ фолз все почему все потому что в печке есть такое понятие как приоритета операторов и удивительным образом оператор логического о имеет меньший приоритет чем операция присваивания поэтому по факту нас происходит просто присваивание falls а из ваты то так ну там может быть любой другой expression который выполнится если первая часть не отработает едем дальше я подготовил некоторый код так чтобы было удобнее видеть сейчас его разум не у нас есть некоторый класс который содержит конструктор и есть некоторые фабрика код который пока не показываю но что интересно обратить внимание на последнюю строчку кто понимает вообще что здесь происходит давайте дам небольшую паузу там на пару секунд поразмышлять из нас есть конструкция new а дальше факт rebuild фу класс это как ну давайте вот посмотрим сейчас у нас есть наше выражение вариант 1 factory будет использована как имя класс кто за этот вариант очевидно желающих не очень не подходит будет ошибка парсинга но видимо это было бы слишком просто я бы тут не расколол а маги третье у нас будет использоваться вызов factory билд и значение которое вернет нам эта функция но будет результате new кто за этот вариант есть и четвертый вариант будет использована значение свойства факт rebuild для того чтобы сконструировать класс кто за этот вариант вам чуть о должно подсказывать этаж маги ребята давайте проверим эту идею в классе factory мы объявим ряд магических функций который будет просто писать что мы на самом деле дергаем вызываем ли мы свойства обращаемся минут методу либо пытаемся вообще zion волк эти весь объект и ответ а мы на самом деле дергаем свойства не просто так не метод не что-то еще это свойство и то что находится после факта rebuild это на самом деле параметры для конструктор который мы передадим в этот класс вот такая маги в печке и кстати на этом у меня в форме борки реализовано фишка называется перехват создание новых объектов то есть можно замок а тет эту конструкцию продолжаем наши магические изыскания следующий пример касается сама печки парсера кто пробовал когда-нибудь внутри фигурных скобочках по вызывать функции и по присваивать переменные вот оказывается можно и этот трюк где-то мне попался в твиттере он работает крайне нестандартная даже написал как ему работать что вам было понятно сперва переменная с названием подчеркивание мы присваиваем значение выражения вот потом мы пытаемся то есть у нас уже есть переменная вот и мы пытаемся ее значение теперь логически инвертировать и получаем соответственно фолз потому что строка кастуется как бы к true а дальше мы это склеиваем все в название переменной через которому потом обращаемся уже внутри фигурных скобочек пользуйтесь пусть сосед страдает так что такое все-таки магия это развлечение которое позволяет нам почувствовать себя в душе у лена необычно сказать блин а так можно было и давайте попробую на минуточку стать не знаю там магом попробуйте запомнить следующую карту которая будет пролетать на экране и запомнить одну нельзя запомнили я конечно плохой маг но все-таки решите дайте мне попробовать у кого совпало not bad что мне нравится в печке то что можно ломать те правила которые все создают и все пытаются быть супер защищенными и есть конструкция под названием запечатанный классу которую конструктор приватный не ваша задача как там учеников магии создать instance этого класс вот кто знает прям как сейчас создать instance этого класс раз два три 4 5 шесть подтягивается всю мою семью к десяточку вон там набралось соответственно я предполагаю что это те люди которые знают как минимум решение кто знает два решения так уже оделась стало три четыре пять кто знает три решения о 12 до немного по кто знает больше чем 3 стоит попрактиковаться на печке это действительно магический язык давайте рассмотрим первых три варианта ответственно первый путь он наиболее очевидный в принципе должен быть знаком каждому из разработчиков потому что это стандартный опека то нам предлагает язык называется эта конструкция не уинстон связал конструктор то есть мы обходим ограничение языкам то что конструктор приватный и создаем instance в обход вообще всех наших объявлений приватного конструктор вариант рабочий простой не требует какого-то пояснения в 2 называется замыкание и требует уже побольше внимания побольше умение суть в чём тут мы создаем на не мной функцию это анонимная функция затем бен дится к skype to go класс соответственно мы находимся как бы внутри этого класса и можно спокойно вызывать приватные методы чем мы соответственно и пользуемся и вызывая ни у static и из контекста нашего класс вариант 3 на мой взгляд advanced очень-очень advanced и использует он специальную конструкцию называется hacks ansi реализации если в определенном формате написать определенную строчку подставить туда определенные значения бабам то у нас получится наш класс то есть после онсена лайза мы получим наши instance едем дальше 3 4 я ставлю это на ваше изучение кто найдет можете мне сообщить я скажут вода это или нет ну и так как вы любая магия часто становится документирован им так сказать фреймворком либо библиотекой то здесь не исключение есть библиотека под названием доктрин instantiate а где это все для вас реализовано вы можете создавать любые объекты с любым кодом едем дальше следующий трюк мы видим что тучи тут совсем сгущаются класс секретный свойства приватная конструктор приватный и еще колбы какой-то и наша задача как волшебников каким-то образом вызвать вот этот кал бег кто знает как до него добраться вообще немного поехали самое первое естественно надо добавить щепоточку маги для то что все заработало и эта щепу . магию магически guitar пусть он там будет но пока что он просто вызывает функцию то есть пока что ничего страшного не произошло следующим этапом мы воспользуемся нашим предыдущим магическим трюком и создадим instance этого объекта во вход приватного конструктор все же пробрались чуть-чуть но нам надо каким-то образом дернуть наш call back как это можно сделать мы возьмем создадим замыканием и внутри этого замыкания находящимися в скайпе того класса возьмем и сделаем on set этой переменной недаром я говорю что нас эта штука довольно волшебно потому что она позволяет эту перемену временно исключить тем самым позволить вызываться нашим магическому методу get и добавляем щепоточку соли так как у нас есть приватный конструктор который выводит эхо то мы можем просто достать этот конструктор сделать его доступным вай нот и просто его вызвать соответственно пабам наш секретный класса рассыпался вообще просто в пух и прах мы получили сообщение о том что во первых мы перехватили автор их еще чего-то вернулись совершенно другое любая магия уже вся документированное уже существует есть пакет с названием альтер-эго который как раз прикидывается вашим компонентом то есть вы можете создать один свой объект при нему прицепите 2 items on проводить какие-то изменения объекта он будет изменяться послушно и выполнять все ваши пожелания кто думает что его в php есть ими то был объекты есть такие есть а кто считает что их нет и нам бы вообще пора вот позвать никиту на помощь дмитрия на помощь и все-таки сделать наконец им это был объект я думаю их позовём но давайте пока поразвлекаемся этаж магия собственно как раз то что хотел спросить собственно ему то был объекта в 5 существует и существует они оказаться очень очень давно только получать их надо очень интересным образом интересность этого способа в том что мы создаем массив у которого есть специальный ключ обратите внимание что он начинается с такой вот конструкция так оттуда где-то здесь мы видим что свойств начинается на слеш 0 это 0 байт символ и после секрета мы тоже видим слышь 0 данная конструкция используется печки для того чтобы объявить приватные свойства на 3 класс то есть если мы попытаемся как стонать какой-то объект масел мы увидим те же самые ключики так вот данном случае у нас появится нечто иное как std класс содержащий в себе приватное свойства из класса секрет который равно тест как тебе такой вот маска ну вот единственная незадача и достать его потом тут вообще никак нельзя то есть она создается но и даже достать его оттуда потом будет невозможно я подумал что это довольно-таки неудобно потому что нас есть ему то был объекты вроде как но использовать их нельзя и решил что пора бы запилить свое решение используя все мои знания маги которая имеется в печке для того чтобы создать конструкцию нам базе всех наших магических штук начнем с простого создадим дату ложку и попытаемся в этой до точки перехватить все свойств смотрите трюк предыдущий затем а те значения которые мы оттуда захватим мы сохранив каком-нибудь надежном месте недоступном любому программисту не рефлекс что нам не замыканиями не какой-нибудь еще маги и предоставим опять-таки логический метод для того чтобы можно было это значение прочитать вот с первым все хорошо мы это умеем делать вот со вторым пока непонятно то есть где такое место в печке существует ли она которое бы позволяло нам гарантируем сохранять какие-то нашей перемены так чтобы то никакое хитрый юный программист вообще не добрался но с третьим вроде как понятно у нас есть магические геттеры магические методы и сет и тому подобные которые позволяют принципе придаст а теперь есть началось интересные моменты это поиск а вот этого сик черного места соответственно global variable отметается потому что понятно любой желающий может их поменять public properties точно соответственно подходит protected ну так себе потому что дочерний класс проберется как правило тут тоже доверие нет потому что его через замыкание через reflection можно поменять может быть правят static попробовать но тоже нет ломается на ура reflection нам и казалось бы тут должно быть отчаяние потому что даже запрятать собственное значение переменных но нашлась волшебная штука называется она в переменной находящийся внутри ваших функций и она самая северная я пробовал спросить на специальном канале чат с такой ушло у никиты попова у край джо и живот кинется можно ли вообще каким-то образом изменить вот это то есть мы имеем функцию внутри эта функция объявлена какая-то статичная перемена и можно ли из нее сне как-то достать поменять ответ нет нельзя соответственно мы нашли нашу маленькую лазейку в потусторонний мир защищенных переменных и мы хотим использовать эту штуку использовать я ее буду немножко нестандартно я буду использовать ее как свойство объекте ну для того чтоб ее передавать так как я не могу использовать свой я буду использовать классические добрую передачу значение по ссылкам соответственно что у нас получается у нас есть класс в котором есть магический метод там call static в нем есть переменная статика объявленная и в любой вызов какой-то функции мы значения из этой и минута был отдых с переменной передаем посылки вовсе наши вложенные методы тем самым как бы предоставляем контекст давайте посмотрим как мы сохраняем стоит то здесь все довольно просто мы для переданного объекта пользуемся функция спел обжиг тайги который нам возвращает для каждого instance отдельно гифи катар и просто под state который мы уже награбили из объекта мы пытаемся сохранить туда то есть ничего такого особенного вот это то как мы пытаемся собственно это выдрать здесь как вы уже видите есть опять-таки конструкция передачи значение посылки и есть on set свойства то есть мы он с этим все текущие свойства предварительно их сохранив нашу переменную стоит и устанавливаем этот контекст для объекта то и больше объект не содержит никаких свойств он содержит только свой delphi катар который объявляется с помощью успел обжиг то иди и он привязан к этому объекту пока он живет но дальше все просто на магический геттер мы достаем этот контекст и достаем из него наша свойств тем самым никто не ничто не может поменять нашего значения по 100 как мы подключаем вот этот рейд немножечко маги но в принципе тут все есть то есть как как дедушка ленин завещал все волшебные методы переопределены и реализует все то чтобы нам правильно направлен на то чтобы этот объект не был изменяем ну как уже это положено все это оформляется сразу библиотечку и готовы к использованию то есть если кто то хочет использовать выглядит она довольно просто то есть мы подключаем нашу библиотеку и создаем наш какой-то класс у которого есть неважно какие свойства приватные protected но я предполагаю что паблик и подключаем то ему то был трэйд после этого мы можем инициировать один раз этот объект вот посмотреть его значение она действительно там сохраняется все хорошо даже выглядит как настоящая девушка в принципе не отличается от нее но если мы попытаемся и вдруг поменять вот каким то таким вот способом то тут же сразу получаем fatal эксепшен о том что вы не можете изменять свойства ну потому что моему того как же так и если уж совсем как бы сделать интересный челлендж если вы попытаетесь ее начать либо жить она вас будет останавливать это отдельно подарочек от меня то есть как только вы шторме попытайтесь провалиться внутрь этого класса он моментально остановить выполнение вашего команда не хочу чтобы вы копались в этом коде слишком он опасный ну и как бы он будет предупреждать что тут как бы делать нечего а едем дальше я хотел бы еще рассказать о такой интересные вещи как обработка потоков кто что-то знает а вот такой конструкции кто может поднять руки единиц что делать данная конструкция во-первых мы видим что тут какая-то волшебная конструкция печки фильтра рид чего-то там и в конце самое что понятно подключать какой-то файлик magic печки вроде как но фишка в том что вот наш magic печки файлик выглядит довольно просто то есть мы выводим hello word причем регистр заметьте он разные то есть мы не выводим все это верхнем регистре однако если мы за including нашу наш файлик вот таким вот образом то получим вот так то есть что произошло в этот момент использование так назад использование конструкция печки фильтр в included позволяет вам подключить любой фильтр в том числе ваш для анализа исходного кода вы получаете управление над тем что в этом исходном коде сейчас находится и соответственно тут приходит на ум такие штуки как убрать файлов из классов убрать войну из методов сделать там свойства публичными в общем все то что вам голову придет на самом деле можно через эту штуку проворачивать и как раз таки на этом базируется часть моего воспитанного фреймворка то есть по факту что он дед когда подключается ваш класс какой то он его анализирует значит попозже покажу и на самом деле трансформирует в то что будет выполняться из коробки в печке есть уже на самом деле целая пачка готовых фильтров который позволяет вам загребать какой-то контент сделать его привести верхний регистр нижний регистр парочка еще вот в принципе основные трюки которые хотел показать они подошли к концу а теперь перейдем к тому что в принципе является quad quit эссенции всего того что я умею этот аспект на ветерана программирования посмотрите на этот код и скажите хороший он или плохой вот с вашей точки зрения как вот читаете давайте вот чуть за зум и как нами получим будет для задних рядов данный код вроде как на вид вполне себе адекватно то есть проявлять какие-то права доступа выполняет какие-то там логирование для того чтобы можно было потом логов поискать что-то создает нашего юзерам перси стид и пытается отловить exception вдруг там доктрина упала и ли у нас что-то не работает и на самом-то деле если мы посмотрим на всю эту лапшу она это лапша повторяется в каждом нашем методе и на самом деле ценного здесь только то что помечены зеленым а все остальное так называемые secondary content как их правильно называть или кросс картинка insurance это сквозная функциональность обычный язык программирования объектно-ориентированный котором вещь появляется не дает нам возможности все-таки конструкции взять скапе постам убрать и куда-то вынести поэтому это плохо потому что нам приходится повторять хотелось бы чтобы наш код выглядел вот таким вот образом довольно чисто аккуратненько и не содержал логирование пусть но как-то само применяется не содержал security вот который вот ты помола так проверяем то чтобы вот это все включая вот там логирование включая проверку безопасности она делала сама еда это так и возможно и возможно это следующим способом у нас есть такая штука как называется аспект я здесь привожу при простой пример который просто проверяет права доступа что он делает во-первых мы вы можете видеть некоторую аннотацию и который почему то еще подсвечивается благодаря плагину для пахоты шторма она объявляет так называемый там искал выражение или expression каким точкам в коде применять данное условие и мы видим что мы хотим для всех публичных методов из класса user сервис применить нашу замыкания замыкание мы получаем метод иного кеш на это наша метод то есть как какой метод мы выполняем по факту это будет некоторая over к поверх его и friction метода содержащие еще аргументы и дальше мы в этом калмыки для каждого метода можем проверить необходимые права доступа это называется от вас то есть мы как бы говорим языку уважаемые печки пожалуйста прими не вот этот метод перед каждым перед каждым вызовом публичного методы из класса user сервис всего лишь одна строчка а много полезного чтобы было проще понимать я решил сделать сравнение аспекта с event list or а потому что я думаю многие из вас работают sinfonie и знают что такое м dispatch вода есть мальчики кто знает иван dispatcher здорово и выглядят они очень похожи в том плане что мы передаем какой-то какую-то зависимость например авторизацию checker мы имеем объявление куда применять в данном случае случились нора это subscribing на ивент под названием usa create a в случае аспектам и подписываемся на все вызовы публичного публичных методов из юзер сервис и у нас примерно одинаковый контент наполнения самого обработчика call back off то есть мы просто чего-то проверяем и соответственно реагируем давайте рассмотрим как это все работает под капотом то есть первый этап который требует аспект ный фреймворк для то что все это заработало это регистрация от этих аспектов как только мы все зарегистрируем мы дальше будем уже обрабатывать для того чтобы это обработать я опять таки использую мой предыдущий трюк спички фильтр это специальный компонент который занимается преобразованием вашего исходного кода он это делает скрытно не видно ну работать продакшене будет нор а потому что интегрина сок крышам интегрируется все на уровне компо за то есть как только устанавливается голубь и он начинает тесно общаться с компьютером и договаривается о том какие файлы откуда загружать поэтому вы можете грузить одновременно и версию на кода без аспектов из аспектов то есть это можно сделать там буквально настройкой в январе мити который будет отключать эту настройку а вот дальше начинается матчасть и матчасть довольно сложны для того чтобы сделать эту работу сложно вообще провернуть весь магический трюк необходимо весь исходный код сперва проанализировать хорошо что есть такая замечательная библиотека от никита как печки парсер сена позволяет провести таки низации и построить абстрактные синтаксического дерева всего вашего кода на этом этапе я создал еще одну библиотеку которая называется упиваться reflection она работает поверх этого 100 дерева и позволяет делать reflection исходного кода не загружая его в память для меня это важно потому что как только класс загружается в память и он оттуда никак не может быть выиграю нам не надо узнать его структуру заранее и дальше начинают свое грязное дело то есть я разбираю текущий файл и знаю собственно какие в нем есть классы и как их изменить благодаря тому что у меня есть аспект на выходе у нас получается очень аккуратненько я и удобная штука виде простого класса дико верующие ваши оригинальные особенность фреймворка в том что он подменяет ваш класс точно таким же классом с таким же именем оригинале при этом переименовывает в кэше то есть неоригинальный ваш код прямо меняет по ходу а делает крыши отдельную версию который чуть чуть меняет название класс и потом от этого класса наследуется соответственно если вдруг ваши класс был финальным для меня не проблема я сниму файлов и добавлю вот сюда то есть наследование работает даже в этом случае поэтому можно отлавливать и финальные методы и финальные класс и собственно кто знает библиотеку аспект мог она как раз поверх него framework а работает она позволяет замок ать в том числе и финальные методы и статические методы все это все работает под капот ну и собственно наш при определенный метод выглядит довольно просто мы вызываем joint point то есть в терминах аспект на интимном программирование каждый метод или обращение к свойству или же там перехват функции или создания это все называется joint point там что ожидать дальше как уже наверно поняли у нас открываются невероятные возможности которые нам рассказал дима и никита соответственно весь л.п. движок будет рекам палец этапе загрузки вашего приложения и тем самым оверхед на его исполнении которые даже сейчас составлять 10 миллисекунд превратится вообще в ноль то есть будет strapping фреймворка не будет занимать практически вообще ничего то есть весь lpf армор будет находиться памяти . следующая штука которую я буду делать и это наверное повергнет многих шок это изменять бинарного входы то есть как только вы используете пищи пиво коды у вас файл системе генерируется файлик с названием . бен используя фифа дима уже по улыбался сейчас я спросил можно также тенге да можно супер все взлетит вот так что благословение я уже получил будем будем работать и совсем уже жесткое мясо на самом деле это и модификация печки движка самого со стороны ес онлайн как это будет происходить внутри печки на есть глобальные перемены соответственно если мы через wi-fi подключим пички сами к себе визар land мы получим доступ к его внутренним свойствам к его внутренним классом структурам так даль и почему воспользоваться я думаю на этом мы на магию стоит под остановить пока что еще одна на реализовать но дай бог реализуем собственно reference на мой framework он есть но пока jesty у него там более миллиона установок более тысячи звезд на гитхабе если вы добавите еще парочку я буду весьма признателен если вы боитесь магии я сделал помощь помощь называется плагин для печки шторма данный плагин очень удобен тем что позволяет подсвечивать синтаксис point катофф то есть мы знаем какие мы хотим методы обрабатывать и как во вторых он предлагает навигацию то есть переход от тех методов которые отразятся аспектами к тем свойством которых мы каким методом который мы хотим перейти мы видим что есть метод execute тонг-ашер он и и есть есть логика аспект который его как раз таки отразит вот с то можно переходить ну и давайте напоследок еще один трюк сделаем уже с помощью всего того что я вам выше рассказал то есть с использованием аспект нова framework а посмотрим как делать отложенные методы идея довольно проста вы имеете некоторый код и допустим какой-то за тех методов отрабатывать медленно таких случаях рекомендуется вынести выполнение этого кода надо моментов а сиджа финиш request но почему то вот мне это кажется немножко неудобно потому что время приходится там помнить куда его засунуть какой-то call back прикрутить в общем выглядит как-то не нативно что я предлагаю сделать и как это может работать создаем доктрин омскую аннотацию который называется дифферин и помечаем что она применяется для любого из методов после чего мы создаем такие аспект который говорит что ребята вокруг вызова методов содержащих аннотацию дифферин нужно выполнить вот собственно эта пометочка нужно выполнить следующий код то есть мы берем и там в свойства этого аспекта начинаем накапливать отложенные методы сохраняем туда метод который вызвался сохраняем объект для которого был вызван на данный callback и сохраняем аргумент с которым был вызван callback и не даем выполнится этому коду то есть у нас там было написано какое-то выражение она вот сейчас не будет выполнено мы его как бы отложим и просто возвращаем какой-то результат на самом деле если делать правильно и есть поклонники react от тут на самом деле должен быть promise то есть мы на самом деле в этот момент пообещаем что когда-нибудь данный метод будет выполнен а когда-нибудь потом мы его за комп летим и получим разумное решение дать посмотрим как же будет это все работать под капотом выглядит все довольно просто мы регистрируем shutdown фарш ну прямо в аспекте то есть как только запускается наше приложение у нас есть callback который говорит нам о том что пост о как приложение завершится надо будет вызвать call back in peach петер меняет и в этом методе мы просто делаем фа сидя финиш request то есть мы говорим все отправь пожалуйста клиенту весь контент который на генериус а теперь начнем по одному выполнять наши отложенные методы то есть то что мы заранее написали она будет вызвана сейчас для примера представим что у нас есть некоторый код и с and push notification это допустим синхронный вызов и какой-то плохой человек сделал его слишком медленным то есть он спит две секунды и вроде бы как не хотим чтобы клиент который там делать какой-то запрос наше приложение чтобы он еще две секунды ожидал к даже мы ответим и мы просто помечаем этот метод как дней перед все то есть на сход моментально вылетает клиент получает моментальный ответ где-то потом фоновом режиме по 100 как рекой а завершился мы отправляем модификацию и она уже в принципе не так сильно эффект клиент собственно на этом наверно все я надеюсь что вам понравился мой урок магии и натолкнулась на какие-то размышления я буду очень признательна если вы оставите отзыв на join дыня кстате прошу это делать постоянно потому что только так спикер получает какой-то фидбэк не знаю было ли что-то хорошо было ли что-то плохо вот если вам понравилось то спасибо если можно я вопрос задам можно выглядит круто но скажу вот а какая цена у этого какие подводные камни но я имею два подхода я бы сказал так есть одна замечательная фраза что аспект на анти он и программирования похоже на острую бритву в руках маленького ребенка в общем в чем суть не страшно использовать как страшно допустить какие-то ошибки которые будут непонятны начинающим разработчикам поэтому я прежде всего таргетируя аспект нативный фреймворк на какие-то известные фишки такие как логирования кэширования авторизацию которые внедряются затем ли дом какую в каком-то продукте то есть как правило просто есть какие-то уже там в компании или в организации устоявшиеся правила и когда приходит какой-то разработчикам и говорят вот дела вот так все будет работать тимлид как раз занимается тем что внедряет вот такие вот и высокоуровневые концепцию уже в приложение для того чтобы это работало централизовано вот ну и плюс из подводных камней на продакшене это генерирует вторую версию кода то есть надо понимать версии кода выполнялось обычного элиз аспект но это понять довольно прост потому что будет написано путь либо в одном файлики либо версии с каша доклад на что бомба очень классно интересный вопрос такой когда подключать новый разработчик который не знает ничего то что было аспект подключен к кому них юзеру и что-нибудь там local около деревни к происходить когда мы хотим просто создать новый instance а планируется ли вот в этом плагине для печки шторм сделать какую то ссылку на то что clicker dragon говорит вот сейчас создашь да но дополнительно еще и наконец а вот это вот этой вот это да это уже сейчас произойдет то есть как только то есть круга осмотреть как это работает есть некоторый аспект который говорит что все методы которые там допустим либо публичные либо там помечены определенную а тации они будут подвергаться действию аспект как только вы создадите еще один метод попадающих под эти условия у вас тут же рядом возле этого метода загорится буковка а который вам будет сигнализировать о том что есть адвайс нацелены именно этот метод вы будете понимать что заботливо тимлид подумал уже о том что нужно применить это и к вашему методу в том числе следующему которую еще не создан и вы поймёте тем самым что здесь еще к дополнительной маги спросите что это за буковка и вообще как с ним работать расскажут что все работает автоматически достаточно следовать там каким-то определенным правилам единствен момент еще добавлю по поводу подводных камней предыдущему вопросу эта штука не работает сейчас symfony потому что соединить магические symfony framework с магическим аспект ным фреймворком получится какая-то гремучая смесь так что пока это не работает но воровал люмен и framework там да это все можно завести это будет работать очень хорошо особенно варки еще вопрос спасибо за доклад у меня вопрос по поводу пички фильтра можно ли с помощью него сделать ему тай-бо объект путей было на вроде как она была возможность то глубоко да на самом деле я думаю вы пробьете да это на самом деле хороший способ обойти защиту которые придумал моя могу подумать как это та защитить следующем туре квеста на самом деле достаточно легко проверить текущий путь то есть если мы сделаем ст от текущего файла есть такая конструкция называется стрим wrapper то все я рассказал простые фильтры есть еще стрим wrapper вот и его тоже можно выглядеть на самом деле то есть у нас есть стандартный файл ропер файл вот если вы выгрузить то либо in cloud который будет подгружать обычные файлы будут проходить еще через этот wrapper и вот там-то можно понять пытается ли меня кто-то прочитать или не пытается и плюс таки я могу навесить контроль чек сумму на свой класс то есть он может запускаться только тогда когда чик сумму этого класса совпадет всего лишь он такое тоже можно сделать с помощью конструкции которой я еще не до рассказал называется холодком полер и размещению сигнатуры после конца класс привет спасибо за доклад классно здорово весело расскажи пожалуйста будет ли вот это все работать с новые фичи ведь 74 с приводе нгам да конечно как будут обрабатываться фильтра если у нас класс уже загружена если он уже прочитать когда то давным давно когда разрабатывать свой фреймворк я зари патил дмитрию стоковую и шум и заключалась она как раз таки в том что appcache не должен обрабатывать и кэшировать файлы которые подключаются через три mfilter из того момента все работает так как я задумал спасибо то есть файлы который подключается через php старый фильтр они не кэширует сопка шум и соответственно не каждый раз динамически выполняются спасибо за доклад у меня такой простой но и сложный вопрос что произойдет со всей этой магии если человек который уделал ушел из проекта большой никто не не знает как это работает эта проблема спасибо за доклад какие есть скоб и вот доступны вашей библиотеке то есть например можно ли определить аспект для всего для всех методов всего класса простота немецкую например да конечно я расскажу какие поддерживаются планка ты то есть вы можете перехватить все файлы в определенном namespace и все классы по определенной регулярке то есть синтаксис очень смахивает на регуляр вот соответственно то могу быть все публичные либо все protected методы это может быть обращение к свойствам как приватным к защищенным публичным это может быть перехват создание перехвата загрузки класс например с помощью перехвата создания класса можно сделать сингл том как только загружается класс память печки вызвать callback и на этом калмыки в его свойства инстанса поместить рабочий instance вот есть такая помимо это он поддерживает перехват функции нативных из печки так что если вдруг вам нужно замок ать функцию спички которой они явно импорте на через flash то и это тоже можно сделать вот но вообще функционал довольно широком позволяет перехватывать и методы и в трей так можно отлавливать и там у калмыки ставить и для финально класс так что спектр возможностей этого фреймворка помоги я думаю превосходит любое решение которое которая где были то еще не было пожалуйста еще вопрос нами на этом все рода на тогда уже уберите лучший вопрос лучше вопрос да какие же они были парень спрашивал можно ли я думаю это был лучший вопрос про можно ли с помощью стрим фильтра взломать ему то объект но это уже очень хитро"
}