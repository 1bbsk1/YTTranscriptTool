{
  "video_id": "yLrSp174yc0",
  "channel": "HighLoadChannel",
  "title": "Ах, как хочется вернуться, ворваться в монолит! / Павел Лакосников (Авито)",
  "views": 17187,
  "duration": 3002,
  "published": "2023-10-16T00:07:32-07:00",
  "text": "и сейчас перед вами выступит человек которого очень очень хочет антимонопольный комитет а также антикоррупционная комиссия Потому что перед вами выступает человек который этот монолит распиливает как пилит инженеры погнали Авито Паша погнали вам раз два три Да здорово меня слышно и правда Авито не 10 лет конечно лет восемь рассказывает про распил своего Монолита и действительно интересный вопрос и почему собственно эти восемь лет рассказывал очень популярная история и кроме нас Кроме этого последние восемь лет про эту историю наверное все поговорили там и все весь Биг ТЭК вообще все почему Потому что микросервисы это новый черный приходи В любой компании приходи войти разговоры сервисы и тебя поймут тебя одобрят там с тобой пообщаются можно вот ну и здесь я вот этот слайд конкретно я показываю наверное уже третий раз и каждый раз я аудиторию ребят Прошу прислать мне логотипчик своей компании чтобы я его тоже на сайт добавил Это пример тех компаний что только за микросервиса вообще Есть такое мнение что все становится лучше с Блютусом на самом деле только с Блютусом с Блютусом микросервисами также искусственным интеллектом биткоина блокчейном вот этим всем такой некоторой устоявшийся творчество как считаете нужным Вот и Авито действительно восемь лет это правда очень большой срок 8 лет Простите у нас а-а компания выросла бизнес поменялся там большая часть разработчиков там ну тоже подросли та аудитория хайлоуида тоже Лично поменялась и э каждый раз каждый год на хайлоуиде выступал кто-то из Авито и рассказывал мы видим и рассказывал проблемы которые мы ловили какие-то превозмогания и вот сейчас в 2023 году Авито готов практически махнуть флажочком сказать что всё вот и вот в этот момент к этому текущему состоянию близкому к эпохальному для компаний конечно же мы подошли в состояние что у нас около одного процента всего трафика обслуживается в аналете это немного Правда немного это конечно тяжёлый трафик Это суровый там суровая пища нагрузка но всего лишь 1%, это не очень много вот и все эти 8 лет Мы в Avito готовили огромное число презентаций мы э рассказывали про платформы мы рассказывали про подходы мы рассказывали э про шишки много про что а я отдельно попросил наших евреев Составить список э статей выступлений э видосиков Где кто-то это вид и рассказывал про распил Монолита и про сервисы вот мы их собрали вот на этой садике на презентации там можете посканировать Может там А там потом отдельно презентация посмотреть пощёлкать А вот наверняка найдете что-то полезное но сегодня мне хочется рассказать хороший процесс когда ты выходишь там после чего-то думаешь все ли я сделал правильно сейчас будет небольшой элементы рефлексии там на тему распила Монолита микросервисов и почему вот лично я все-таки сектор теплотой вспоминаем Монолит И периодически хотел бы что бы кое-какой функционал Монолита оказался такие э в снова со мной снова рядышком вот а тут сделаю чуть небольшую паузу там знаете Это в бок вел А цель доклада А во-первых чтобы э Вы меня после доклада побили за микросервиса что это я тут наезжаю А во-вторых чтобы вы все вместе там со мной или там друг с дружкой пообсуждали в целом а и Воспоминания как было в Америке как было микросервис что вы потеряли по дороге и что получили то есть Давайте Хари варить на эту тему это вот основная ценность которую я хочу принести сегодня вам вот Ну для того чтобы это сделать вот хочется ответить на этот вопрос просто стоило ли распиливать структурно я постараюсь рассказать вот о чем вот Авито вот эти 8 лет делала распил делали белыми микросервис уменьшали объем Монолита и хочется сделать такую небольшую таймлайн чтобы рассказать о самом процессе Почему Потому что он дико сложный потому что процесс который длится 8 лет не может быть простым потому что вместе мы решали огромное число промежуточных Проблем итоговых Проблем Проблем разных и вот сейчас будет небольшая первая часть доклада это таймлайн с описанием проблем способов решения там кратенько для того чтобы понять что собственно а может не надо нам туда то есть прежде чем вообще микросервис Посмотрите вот на вот эти восемь лет работы восемь лет реально много я до сих пор пытаюсь в голове эту цифру вложить и понять Надо ли вам оно вторая часть доклада там это мифах Ну то есть все кто идут говорят приходить микро сервис там будет хорошо и вспоминаем мем с этим с жирафом помните в болоте В общем мне вспоминаем и поговорим о том какие мифы есть микросервис типа там будет хорошо и вот на основании после восьми лет У меня есть ощущение что многие мифы собственно действительно мифы и неправда всё и э третья история третья часть Ну просто по ностальгированным как классно было в аналитии А по сравнению с этими несчастными микросервисами вот ну и начнем Ну как раз ставимлайна про историю распила Монолита вот а вообще это в 2007 году появился замечательный красивый вот такой вот старый старый эмблемкой может быть кто-нибудь помнит такую Это первый логотип Авито тогда первый товар который продавали это была банка кофе который купил основатель Левита у Авито там продавались тогда только котики была маленькая команда у нас было PHP Монолит там основной язык для разработки шаблонизировать Мы конечно же Фигово основное хранилище там никаких кэшей ничего не нужно было 2007 год мы спокойно переваривали вообще всю нагрузку а команда была мало они делились на разные функциональные направления То есть у нас был отдельно команда backender и там пачка Back and разработчиков команда фронтендо и тоже пачка фронтен разработчиков по сети нас было не очень много нас было десятки десятки инженеров и процесс релиза был достаточно простой самое начало и мы живем аналитик как это происходило приходит который говорит чуваки у нас вышла классная сейчас давайте катить в этот момент по запросу этим ли да собирается консилиум других видов других команд нас немного было и начинают эту фичу катить это процесс он занимал там ну в хороший случай там несколько часов в плохом случае несколько дней ну там собрал выкатил из правил там тестировщиков нагнал они все вместе прощёлкали проверить там что-то нашли там заход фиксели Короче проблема Ну никак не проблема но э нас до- на тот момент-то устраивало но тоже там важно понимать что вот в этом состоянии мы потихонечку подходили к распилу на тот момент нам было Норм вот потом 16 год прошло почти 10 лет 9 лет то есть 9 лет Авито жил в таких технологиях и на тех самых масштабах как я и говорил приходит тимлид говорит и заказывает релиз какой-то этим лет вот к началу распила мы подошли немножко в другой конфигурации у нас было больше 360 серверов там десятки терабайт данных в подгребать данных снова сказать есть тоже некоторые миф мы его потом к сожалению развили что Авито в этот момент времени была самая большая не шортированная база постгресс в Европе к сожалению не оправдался потому что цены оказывается всё-таки больше базы имели но видимо мы где-то вот после ценно Вот и я тоже специально для презентации подготовился посмотрел как работала вот выкатка помните 2007 году говорил тимлид заказывать и выкатываем А сейчас в релизе вот этот год это состояние до 25-30 продуктовых задач влезала в один рез то есть собиралась 25-30 тиндов их время дорого они вместо того чтобы работать они вот сидят вместе катят этот несчастный рис они натравливают тонну этих разработчиков несчастных иев и вот всё вместе тяжело со скрипом выкатывается опять же иногда быстро иногда всё хорошо но нередко это занимает реально много-много времени Вот и собственно присутствует понимание того что пора пить Ну пить потому что ну так жить нельзя с такими релизом Ну прямо он не масштабируемый и опять же Подумайте У вас есть такая проблема Если нет то вам не надо повторять будет оставайтесь смотрите там вкусно несколько команд в этот момент времени поняли что им неудобно и некомфортно вот эти вот релизные поезда по 30 задач они решили что давайте мы сами все сделаем мы сами выпилимся нам хорошо будет и это правда сильные команды наверное одни из сильнейших что были в Avito на тот момент времени они решили мы сами сделаем мы красавцы Вот ну собственно что делать они взяли свой код они пришли к отдельным функциональному направлению где вопсов сказали чуваки Мы хотим чтобы там выпиливаться нам вот наоборот надо бы как-то диплоиться Независимо вот Ну и что убирайтесь у нас тогда не было он тогда ещё не распаренный был так так-то и всё это все эти сервисы то что они вот выпиливали заворачивалась какие-то LC контейнеры а и укатывались они тоже как-то самостоятельно то есть сильная команда приходит вытаскивает свой кусочек кода самостоятельно как-то его оборачивать в LX контейнер как-то хз как если честно вот и потом кастомным образом абсолютно персональным выкатывает его на продакшн собственно баз данных Ну тогда не очень мало кто понимал как это правильно делать поэтому не иногда база данных уезжала вместе с сервисом но чаще всего выезжала какая-то часть данных а дальше Просто какие-то коннекторы каким-то таблицам как-то они работали с базы данных монолитов то есть жаренная база вот эта вся грязь которую мы про которую мы уже все хорошо знаем что делать не надо Ну на тот момент не всех не все об этом знали и все знали это хорошо не очень понимали как это делать а ну в общем нормально вообще нет проблем куча диплой Ну то есть когда начинаешь каждой команды свой процесс кто-то диплоиться по расписанию кто-то по заявки кто-то там выкатывает понять как оно все взаимодействует как оно взаимосвязано там вот какой-то кусок есть поменял таблицу что происходит попытаться понять что у какой-то команды происходит внутри Ну прости пожалуйста очень тяжко Ну то есть Представьте себе что вы пришли Вот в какую-то команду Где вы там сейчас работаете А потом выясняется что там есть огромный мир про который Вы не вообще ни разу никогда не знали и там свой фреймворк свой язык свой диплом план своей лексиконтейнеры свои собственные кастомный способ сборки Всё своё Ну то есть вы фактически чтобы занырнуть новый проект вам нужно взять и сменить работу фактически То есть вы просто меняете реально проект работу всё ну короче не очень круто база данных как я и сказал тоже там частично шаренные частично не жареные а там сколько раз было вот эти реально сильные команды я подчеркиваю это реально сильные команды делали Вот первые такие шаги были Вот такими миграции ломают сломали сделали миграцию монолите сломали микросервис Короче не очень а история с контрактами в этот момент времени появляется необходимость как-то строить взаимодействие между этими несколькими релаксичными контейнерами монолитом И вообще системой там внешним миром и сервисы начинают думать что давайте-ка мы воспользуемся мобильным подходом у нас тогда было очень сильная команда мобильщиков они говорят что слушайте любой там внешне нам дает sd-кашку Давайте здесь работать по принципу внешних интеграций каждая команда напит свою sdk там всё будет всё хорошо там всё в сетевое условие модельки всё будет хорошо вот в общем делали языкашки потому что ну как бы трудно а такие стакашки трудно обновлять А если вы ещё пить ихние системно Ну создаёте в смысле то кто-то вокруг одной библиотеки сделать обёртку кто-то вокруг другой библиотеки сделает обёрт кто-то вокруг вообще чего-то там своего кастомного там крылом сделает без всяких обёрток В общем тоже грязь получается и в итоге мы пришли к состоянию что первые попытки распилить вообще хоть что-нибудь и если вы будете выпиливать вы тоже к этому придёте а каждый выпил это какой-то абсолютно уникальный кастомный продукт который Ну прям сам себе вещи себе то есть своё и а жить в таком состоянии особенно в каких-то того что у вас сильно растущий бизнес и вам наоборот эти Касты Нужно меньше мешать Ну тяжеловато и что дальше дальше мы собственно там прожили в таком состоянии пару лет Ну то есть там вот два года прошло не знаю что в начале 16 мы резко сделали 10 loc-сервисов потом резко их удалили Нет просто постепенно там первый сервис второй сервис первые шишки вторые шишки и вот где-то к 18 году пришло понимание того что надо менять подходы и вот в этот момент мы уже начали вести себя как большие Мы уже на капель опыта мы стали понимать как надо И вам опять же Давайте подумаем Надо ли вам в микросервисе может остаться потому что вот тот же самый путь он наверное будет покороче сейчас информация побольше Но путь будет так же и вот Кристина распела вот мы подошли в состояние что слава Богу сервисов не так много но даже какие-то стандарты начали появляться у этих наших Galaxy S60 определённые кое-что стало оставлять резерв не всё далеко всё и нагрузка на них небольшая Ну то есть состояние 2018 год что какие-то куски вроде выпилены и там вроде даже какое-то относительный порядок но очень разнообразный всё ещё неоднородный и пришло понимание что нам требуется системный распил Монолита то есть не просто там и побежали и там кто во что горазд короче нет создали такую Тайгер Тиму которая была непосредственно постараться аккумулировать опыт являться точкой экспертизы Вот и готовить вот эти вот процессы системного инструмента для того чтобы другие команды могли этим пользоваться вот такая Тайгер Ким делает они Сиди там прорабатывает вопросы масштабирования в общем хорошая история вместе с этим опять же в 18-19 году приходит понимание того что практика СДК она максимально гибкая их сложно доставлять там дотаскивать до клиентов потребителей чем больше чем сложнее становится жить и разработчики сервисов тратят достаточно большое число времени а то что просто Простите кашку сделать рассказать как модельки бегают сюда Ну короче тяжеловато и смысла опять же нет И мы придумали что нам нужно система контрактов контрактного тестирования и какой-то генерации вот это как раз закроет все эту историю с болями совместимостью фишки совместимостью контрактов вот историю с доставкой обновлений для клиентов понимание кто каким контрактом пользуется вместе с этим в 18-19 году вместе с началом системного распила у нас появляется первые заходы нам появляется первые сервисы которые до этого были внутренними сервиса которые готовы обслуживать непосредственно пользовательские запросы и опять же сейчас концептуально мы наш продукт наш API очень похож концептуально на Конг но на момент 2018 года Конг был состоянии версии 1.0 и мы про него не знали то есть мы сделали свой потом спустя 2 года узнали что есть оказывается точно такой же но другой Конг а почему про это тоже говорю потому что для того чтобы привести Ну запустить нормальный процесс распила вам нужно прийти в точку системности и решать те же самые задачи вместе с первой Tiger тема у нас появилась команда вторая тайгерь зима это значит команда лежала чуть ниже на слое абстракции и Её задача была отойти от LG контейнеров потому что они достаточно ну слишком кастомные и прийти к системе платформы такое понятие платформы сейчас такое условно называют паас на тот момент по словам пас не звучало оно было звучало слово платформа Вот и вот как раз после восемнадцатого года начала системного распела Прошло 5 лет и вот сейчас я стою перед вами 23 год и мы э кажется Монолит э распилили и пришли ему вот вот этому состоянию один из первых и вот есть его дополнение мы много чего сделали мы уменьшили там количество строк кодов аналити мы там спилили кучу сторонников которые стали не актуальными мы смогли нарастить число команд огромное большими кусками Вот но Обратите внимание на последнюю цифру у нас 50 крутых инженеров занимаются тем что поддерживают чисто микросервисную платформу есть у вас 50 человек нету если нету то Не начинайте потому что без 50 человек вы просто системность не получите А без системности Но вот придете в понимание в тот первый этап когда все все делают в разнобой и нифига ничего не понятно Вот ну и собственно стоило ли оно того Ну давайте думать Давайте вспоминать И тут хочется второй части доклада перейти о том как было плохо в микросервисах Ну как стало плохо нам микро сервисах есть такой миф что их очень легко и просто скалировать слышали о таком что если у вас есть микро сервис быстренько там 10 сканировал здесь пишешь Независимо как раз Танечка экономим ресурсы Здорово будет в 2018 году Авито бежал на их серверах вот какая-то цифра абстрактная вот без конкретики чтобы там не перечислять количество ядер количество там вендоров ну и серверов спустя 5 лет 2023 году нагрузка на Авито выросла примерно плюс-минус 5 раз большой рост 5 лет 5 раз Хорошо как думаете а как выросла объем потребляемых ресурсов насколько стало больше кушать восемнадцатом году мы еще системно не начали распиливать было мало сервисов вот в какой состоянии мы пришли Напоминаем миф про эффективность сервисов пришли к состоянию того что количество железа выросло в 30 раз пять раз нагрузка в 30 сразу в выгодно Поэтому если у вас нет 30 кратного запроса по железу не идите микросервиса 30 есть еще один миф говорят когда вот собственно рассказывает про микросервисы Здорово на конференции говорят чуваки и вы сможете нанимать абсолютно любых пацанов с любым стеком хотите раз то в чем набираете набивайте ростовчан хотите на но Джесси пилите нанимайте на Джейс микросервисы позволяют вам быстро там на всех языках делать проблем с нами не будет там вообще красота плюс новые там революцию не Простите там какой-нибудь хороший миф думаю что тоже многие из вас хотя бы слышали о нём может быть спорили согласны и Согласно дело десятое Но вот миф есть Я считаю что вот в этом мифе вот слово легко оно неправильное можно менять язык микросервисах Ну вот слово легко близко рассказывал про то что появилась система генерации контрактов дикашки выше появились там куча других туллингов стандартизации всего чего можно и вот теперь для того чтобы появился у вас новый язык Вот вы хотите затащить большой жирный классный раз теперь переписывать систему генерации контрактов пожалуйста Перепишите платформенные библиотеки которая обеспечивает для вас правильно экипа лайвы правильные там дополнительных катерах запросам там какую-то метод запросам делают телеметрии обязательно сделайте да да сервис Discovery безусловно важны микросервисы вы добавляете новый язык теперь ваши сервисы должны уметь друг с дружкой общаться чисто контрактов мало Давайте тут Discovery сделаем а-а Да это тоже делает Тоже тащим То есть первый раз ещё вот это сделать прежде чем язык новый появится А вам же как бы сервис катить надо интеграция в лайфхак у многих языков лайфхакл достаточно Каста основной многие истории там требуются особо запекать в доке своей порты свои будьте любезные интегрируете вы же всё ещё хотите затащить новый язык микросервис правда Это же хорошими а-а в принципе невозможно поменять язык не переписав весь молит сбоку новый Но в любом случае что в одном что в другом случае что микросервисах смена языка это такая боль которую проходить сложно но в одном случае её в принципе невозможно пройти в любом случае просто наборчик себе руки ноги Ну язык дотащите Стоит ли оно того Ну если честно я видел мало примеров когда компании просто брали новый язык микросервисом докидывали но это все-таки очень необычная ситуация необычное явление поэтому миф По мне так миф есть сердечники ваши микро сервисы Да теперь раньше пока был монолит у вас один релизный фол по заказу понятный простой как дверь Понятно Где Когда Что появилось вот сейчас вот заказал там Tele2 ваш реликтом или кнопочку нажал пошёл катиться ваш Монолит замечательный понятно что было в аргументах кто Какая причина какой вызов и откуда Откуда многие торчат в целом всё ясно абсолютно классно профилировать Ну Простите кто не профилировал молодец Ну ладно А теперь Представьте что вы теперь в микросервисах сможете профилировать своими микросервисы один микросервис да а пачку все кто сможет все профилировать кто пробовал Ладно на вопросах есть кто-то пробовал поднимите удав вижу одну руку Здорово на вопросах Потом расскажешь Спасибо У вас теперь в микросервисах если раньше был один релиз для вашего среди инженера понятная история теперь их сотня я специально опять же для доклада посмотрел у нас количество релизов в сутку сутки варьируется от 300 до там 500 релизов как-то самых пиках было 300 релизов на микросервисах удачи ваши инженеру прям реально крыша потому что контролировать все он не может физически нужно какие-то системы для того чтобы смотреть А с чем оно может коррелировать сильно ли оно концептуально там вообще пересекается одного сервиса Спасибо конечно спасибо большое потому что его мало ошибка в одном сервисе не даёт понимание того что вообще пошло не так Почему туда пришёл так запрос почему упал Что происходит если это еще не первый первый сервис перед пользователем окунем там на 10 уровне цепочки вложенности вообще ни черта не бегать ваш среди инженер должен освоить какие-то джедайские техники овладения трейсингом потому что без него он вообще ничего не понимает у вас топология связанности вашей сетей ваших сервисов будет меняться Много и часто вышли микро сервис пошли значит вы будете их делать много стабильно Ну теперь осваивайте вместе с микросервисом вам придётся вводить такие очень жёсткие регламенты по обезболете А если честно все успешные компании которые внедряли микросервиса я поговорил с четырьмя разными Поэтому четыре тоже много значит все а-а они внедрили в разных степенях подход а-ля кот Эта история Когда вместе с кодом сервиса есть набор обязательных метрик без которых сервис Ну нельзя выкатывать рот или нельзя передавать на эксплуатацию а пожалуйста будьте любезны теперь у вас есть такая головная боль предполагает что вы стандартизируете подходы по их доставке стандартизируйте подход к аллер там и куча куча всего того всех тех инженерных Практик которые э-э которые которые вам любят рассказывать сорян теперь Вы теперь должны это делать если вам это не нужно теперь обязаны потому что без них микро сервис не живут сорян поэтому снова может Ну допустим все еще нет не убедил у вас много микросервисов в случае озона там у вас 4000 случае Авито у вас 2000 микросервисов Их много и теперь ваши сердечный чувак должен в нужный момент кого-то разбудить отправить там голосовое сообщение отправить натравить на вас робот женщину которая будет среди ночи ему нужно для быстрого Дауна иначе он будет возбудить вообще без повода Ой кажется у нас упал что-то упало и будет полкомпании кому такое надо или там вашего еда которую мы тоже там не в зуб ногой а обновление зависимости тоже хорошая история знаете особенно когда есть большие наборы сложных библиотек в этом много чего вендерзависимости Иногда приходится какую-то зависимость обновить и потом эту зависимость затаскивать для всех остальных для тех которые так или иначе используются в вашем проекте вы это радостно делаете дотаскиваете обновляете красота нечеловеческая а потом вы ловите какой-то конфликт версии думаете блин черт возьми чё делать и я не знаю сталкиваюсь ли вы с таким в своих больших монолитных проектах Мы конечно сталкивались то самый близкий наверное слово Dell Hell Вот хорошо описывает историю и есть миф что микросервисы решают эту проблему Ну как бы Зачем У вас все весь код микросервиса всё в сервиса всё хорошо так вот нифига микросервис эту историю не решают потому что у вас есть контракты совместимость этих контрактов между всеми у вас появляется венгрзависимости только Раньше она была в одном монолите А теперь она в двух с половиной тысячах сервисов И вам если раньше нужно было обновить в одном монолите решить конфликт версии там нескольких ветер библиотеках Теперь нужно решить этот же самый конфликт в двух с половиной тысячах сервисов и 4.000 если у вас их четыре сложно и требует и требует определенных турингов определенной практики которые вы можете быть не готовы и снова вопрос точно хотите между прочим статический анализм ошибки подсветят А сейчас микросервис там исправил А тут ничего не засветилось на других сервисах когда выпиливайте из Монолита микросервиса одну из частых задач является правильной декомпозиция на домены и мы в Avito столько шишек набили на этом ошибочно декомпозиция доменов вас приводит к таким проблемам вы маленьких масштабах они кажутся незаметны но чуть стоит вам вырасти двойные запросы пере использовании моделей жареные модели распределенные транзакции синхронные релизы знаете как в этом вот кажется вот четыре пункта блин какой дурак Это не сделает дурачок легко же нифига э-э кем бы вы ни были в какой компании не находились вам придётся все эти проблемы решать и вы на них будете спотыкаться ни один не два и не 10 раз постоянно как минимум потому что ваши доменные модели и ваши в принципе доменное разделение оно постоянно меняется Вы же про динамический продукт вы вы постоянно переписываетесь отжали Все дела и из-за этого даже в моменте у вас нет проблем через день могут появиться А вы о них не знаете конечно могут быть проблемки но и жить так легко исправить У вас есть она подсветит вам всё использование всех переменных рефакторинг в монолите проводить такое приятное дело по сравнению с 10.000 микросервисов которых вам нужно всё это влезть всё это сделать Ну и Последний пункт Давайте пронострагируем о том как было хорошо В монолите вот рефакторинг я про него говорил вам нужно сделать Ну не знаю там обновить стильно вашим проекте вашем продукте Сейчас вы будете делать это куча разных сервисов то есть соответственно в какой-то момент времени у вас будет пользователь видит не консистентное состояние где-то его аватарка квадратная где-то круглая Ну вот так спокойно сделать один мертвый квест Да может быть жирным но все-таки доходят есть такая у вас опция монолите на самом деле есть для того чтобы сделать вот такую атомарное изменение вам нужно столько плясок сделать Вам нужно все сервисы закрыть специальными трогалами закрыть какие-нибудь жареным стоит потом выкатить все изменения убедиться что они выкатились потом что они не откатились в процессе а потом уже сделать переключение Но конечно можно Ну вот реально такой головняк обычно с этим никто не заморачивается квадратные клубы катень когда-нибудь будет консистентом состоянии когда-нибудь консистентность а у нас примерчик в какой-то момент времени нам нужно было поменять поведение локаций на вид выбираешь город Там они имеют некоторые хищность мы там добавили некоторую подкатегорию локации некоторые дополнительные фильтры для удобства пользователей в монолите подобная задача заняла бы две недели микросервисах мы этим занимались квартал квартал команда добавляла локацию это Короче еще раз Подумайте вам надо в микросервиса или нет вспомните Те проблемы которые которые Решала Авито микросервисом Подумайте Есть ли у вас нет может не всё так страшно локальная среда ой обожаю локальную среду вот как было виртуальная виртуалка запускается запустили там потом скриптыми играться накатываются Одно второе третье десятое полчаса ждешь потом поднялся всё работает расставляешь нет в на мой неплохой в целом ноутбук влезает но наверное десяток микросервисов влезет а у нас их несколько тысяч я не могу поместить все вот это вот с учетом x30 расходов на железо все влезает Всё теперь у вас нет локальной разработки Во всяком случае в том виде как она была вы разом локально все аспекты своей фичи даже можете не протестировать у нас нередко разработчики сталкиваются с тем что они выкачали три-четыре-сервисах подняли в них против них прогнали и удалили потом заходили новые и снова прогнали проверили Либо вы делаете какой-то супер большого стейзинговую среду тестовую и уже цитируете в ней но это не локальная разработка Господа а-а локальная разработки в микросервисах Но она очень своеобразная и далеко не такая богатая прозрачность работы легкожить бряки Всё для вас в монолите красота в сервисе нет И тут знаете этот слайд я добавлял в самом конце история про Amazon Я думаю что многие из вас слышали это замечательный пост про амазон где они рассказывали как для продуктов видео они сэкономили э-э немножко денег переместив всю архитектуру в Монолит там конечно много бы там переводы статей были на храбре а потом разбить кучу разбитых копий там сломанных щитов когда пользователь habr и там куча других англоязычных ресурсов Они реально ругались на эту тему потому что каждый трактовал статью амазонок по-своему кто-то говорит вот смотрите обратная тенденция все молит побежали кто-то говорит нет Вы посмотрите там это там всё лямбда не свои заворачивали это всё ерунда на масле но сэкономили они порядка 90-95% денег это много много И э-э я вот тоже там И статью почитал там из рефлексировал это полезно рефлексировать и вот что подумал а может быть вообще прикол-то не в том что они в момент переехали а в том что они в целом что-то делали может быть на самом деле не важно едешь Ты в Монолит или из Монолита а важно что ты перефачиваешь свои процессы перефачиваешь домены и подготавливаешь новые туринг для себя в общем-то неважно монолитные карасервы там в одну сторону или другую идешь вот процесс важен Вот вот пока вот эту историю Я кручу на языке там думаю прикидываю там а-а Как же хорошо было И вот пока катаю Ну предлагаю вам тоже подумать может быть даже обсудить со мной куларах э вот в том числе с контексте азона Ну и я уже почти все выводы вам точно не понравится монолитах если у вас мало денег вам нужно готовить огромный мешок деньгами вам потребуется ввести технофашизм для своих разработчиков Если вы их также любите как авить на своих разработчиков придется вам их зажимать в такие рамки что не вздохнуть не выдохнуть ну и готовиться к тому что путь в микросервис это строго 8 лет Вы уверены что ваш бизнес только переживет вот когда Шли очень на это рассчитывали слава Богу дожили Ну и собственно вспоминаем противовес Он позволяет вам легко быстро рифачить допускать меньше ошибок он в конце концов хороший эффективный локальную среду без каких-то пределах Ну и собственно все давайте вопросы Давайте обсуждать особенно обсуждать кулуарах Ну и можете проголосовать на мой доклад будет здорово Спасибо за доклад такой вопрос Вот мы можем бесконечно ностальгировать по монолитам но было ли бы вообще возможно увеличится в пять раз живя дальше в монолите сослагательное наклонение знаешь так -то Черт его знает как до состояния 2018 года мы дожили может быть Я не знаю но Вопрос хороший в этом месте тоже знаешь чуть-чуть расширив у нас было много проблем которые мы хотели порешать микросервисами и в целом мы шли туда-то осознанно то есть мы многие проблемы всплыли в процессе того как мы просто косячно переезжали когда был не системный распил вот многие процессы мы начали ценить очень системно Мы понимали что идем вот хочется чтобы вы тоже понимали Ну все равно вопрос господа так я вижу руки спасибо Павел за доклад такой вопрос Через сколько лет вы в Авито начнете переходить на Монолит обратно если есть такое решение Как вы думаете Будет ли это легче чем с Монолита на микросервис Ну и такой под вопрос второй если ваш путь был таким тяжелым Это же не обязательно что у всех он такой будет все-таки по концу вы пожалели что Ну вот в итоге вы пожалели что начали этот путь или нет спасибо Мне было два слайда которые должны были выразить одну мою маленькую мысль итоговую мне показалось что я слайдами неудачно донёс поэтому я их удалил остальные были такими завершающие быстро поднятые сервисы сделаны за три минутки вот строили внутри вот тут ответ типа того что пока вы думаете можно сделать быстрый сервис который решит проблемы за вас вот поэтому наверное в общем итоге мы-то в целом довольно тем что получилось вот получилось получилось хорошо и технологично из кучи крутых плюшек которые мы получили в конце но Как много Мне не хватает от Монолита в том числе и доешки дибага сквозного и вот это всех прелестей Ну а в тему того будем ехать я о таком решении не знаю предлагаю подумать что может быть дело не в микросервисах А вот в процессе переезжания переезда просить ты не думал над каким-то таким вариантом посередине когда есть и не микросервисы и не Монолит А такое более облегчённое Монолит и сервисы сателлиты есть такой подход Что называется Бастион вот есть Бастионная вокруг него там куча куча башенных микросервисов кажется что это все-таки какой-то промежуточный вариант он не туда Не туда Он подходит вот он на наши проблемы все равно бы не отвечал я их перечислил Чтобы понимать Почему мы туда дошли и предлагаю подумать вам ответит ли Вот такой подход на ваши проблемы на ваши вызовы то есть микросервы болят и Я попытался рассказать как много вы потеряете в процессе Как много нервов там у вас пропадёт в процесс переезда Ну да но он как раз может в принципе для тех кому кто еще пока не дорос до каких-то микросервисов сэкономить ресурсы но тем не менее разделить на продуктовую команду и всё такое может быть Спасибо а еще ближе Спасибо Спасибо Вы сказали что в пять раз выросли по нагрузке сказали что у вас две с половиной тысячи микросервисов то есть не сравниваются ли тут разные вещи насколько выросли по функциональности что Можете ли вы например монолитах сейчас с монолитов вернуться вернее с микросервисов обратно Монолита мой вопрос перекликается вот с тем что задавал человек но больше про нагрузку спрашивал именно про функциональное содержание Хороший вопрос и скажу так продукт продуктовая Техническая наверное замечаешь и следили этих слайдов было показать что в любом случае монолит некросервис это нифига не про эффективность то есть продукт не стал в 30 раз сложнее он стал сложнее безусловно не в 30 раз оверхэто микросервисов большой Надо к этому Быть готовым готовить свой кошелек Спасибо еще вопрос друзья вот сейчас вас найдут Расскажите Как изменилась жизнь разработчика с распила Монолита То есть если раньше какой-нибудь словно разработчик мог работать над каким-то своим куском Монолита Да он должен был там знать как этот кусок взаимодействует с другими соответственно частями то теперь этот же разработчик должен знать не только как работает но и по крайней мере о существовании каких-то необходимых ему десятков Может там сотен сервисов как изменился его сон зная об этом Вот как раз хотел тебе ответить Именно так я стал плохо спать а вторая история Я теперь очень быстро могу прототипировать в том числе для каких-то новых проектов процесс создания маленьких быстрых прототипов mlp-тестов прям приятный но я плохо Стажеры прототипировали протепировали про типировали про типировали добрый день Добрый день спасибо за доклад Мне кажется ваш доклад не случайно поставлен был последним практически и вот мне все время оказался сарказм какой-то ваших словах и вот обратную сторону прикрутить что все-таки микросервис они лучше лучше да Мы скучаем по манту но но нет вернуться нельзя и второй момент все-таки вы сказали что в 30 раз выросло количество железа но при этом нагрузка выросла в пять раз шесть Как сложно тебя обмануть обратно не проворачивается К сожалению поэтому Даже если я буду Руками ногами за вот в обратную сторону не провернуть и поэтому придется делать хорошие критериев ответы на большое число проблем они помогают быстрее ездить но При всем при этом ты в процессе перехода микро сервисам огромное число теряешь меня хотелось на самом деле в рамках этого доклада снова рассказывать прилипающих зубам Подумайте вам точно не надо микро сервисы может быть Сначала Монолит потом вырастить потом когда подрастет это 100 раз так говорилось Давайте просто поговорим о том что вы потеряете Спасибо будь добрый раз и потом 2 Здравствуйте спасибо за доклад Вот вы немножко слайдов скольз сказали Как у вас компания организована мониторинг вообще жизненного цикла И наблюдаемость вообще вот приходит событие и вот до конца его то есть вот там Ягер Open телеметрии то есть Какой мониторить Вот этот состояние чтобы к отлавливать Все спасибо за вопрос я отвечу на него в следующем докладе Ну или кулак очень просто вот стажер Да Паш Привет Спасибо за доклад ты так много на самом деле набросил что даже не понятно что и спросить но я выделю 2 коротких Давай два первое ты говорил про поставить breakpoint очень удобно Вообще говоря если проект там сотни тысяч строк кода и этот кусок вообще не твоей команды того что ты поставишь breakpoint какой Профит там какие-то переменные инстанции вообще ничего не понятно второй вопрос про всякие флаги для выкатывания там с изменений сложных тут кажется такая уже подмена понятий Давайте делать Просто контракты на API Да если мы ломаем обратную совместимость опять 20 Ну и плавненько мигрировать короче не надо за один раз переименовывать публичный интерфейс и всё ломать в первую очередь это про атомарные изменения то есть они не всегда связаны с нарушением обратной совместимости я стилей ты получаешь на одной страничке один Стиль на другой страничке другой стиль ты решил поменять не знаю там способ форматирования цены у тебя здесь в рублях А здесь не знаю там в копейках Вот тебе пожалуйста не консистентность теперь пока ты по цепочке все все не обновишь Конституции у тебя публично не будет Вот это очень простые примеры со стилями там с квадратная или круглой аватаркой вот надо синичка на Квадратное другой Круглое и чтобы сделать такие изменения томатно нужно очень много стараться прям отдельно доставлять эту историю это нормально Вот первый вопрос еще в двух словах напомнить что потерялся точно а на самом деле бывает всякое может быть ты не разберешься А может поможет мне всегда помогал инженеры еще вопрос с другой стороны спасибо спасибо за такой спорный доклад не очень спорный сервис при этом Да я вот услышал что в одном месте изменили там кругленькая в другом квадратненькая было дело и вот мы тут с коллега подумали А что фронтенд был микросервисах слышал такой концепции как микрофонды Почитай это тепленький и прохладненькие Ну вообще ты такой пинг-понг устроил вместо того чтобы погрузить человека в предметную область где Почитай вот меня в университете были такие преподаватели да бывает бывает Ну блин если сейчас буду пересказывать историю про микрофонда тут второй доклад есть сейчас следующая компания будет покупать Да в чате есть несколько вопросов вот вопрос номер один уже говорили чуть-чуть об этом докладе сказал три мастера плюс 10 хостов плюс 6 - 7 - 8 это про другой доклад А это у нас микросервисы на фронтезе пришлось увеличить железо в 30 раз экономия А есть какие-то цифры Во сколько раз нужно было увеличить железо Если вы не остались блин Да это мастер-класс Попробуйте что-нибудь спросить чтобы получить ответ да вот пожалуйста можно молодому человеку телефон подарить новый вот он а старому продаст на Авито финальный вопрос и потом дарим подарок давай спасибо за доклад еще раз Раз нужен точный ответ более-менее Плюс Минус Там несколько десятков процентов хотелось спросить какой-то рецепт Сколько в среднем человек в команде которые должны заниматься микросервисами и сколько сервисов может быть в зоне ответственности одной команды чтобы не превращалась какую-то сильную боль Слушай у нас У каждой команды есть владение сервисами и Это определенный культурный слом внутри инженерных Практик нужно наращивать такой процесс как не только без этих историй у тебя полноценное владение когда у тебя оно есть достаточно большим числом примерно здесь команда у которых 15 сервисов владения сама команда Там пять человек-женеров Вот Ну а на тему того сколько человек нужно чтобы занимались микросервисами у меня был слайд у нас 50 крутых инженеров которые занимаются исключительно поддерживанием поддержанием платформы для микросервисов только платформа Они не пишут продуктовый код Если у тебя есть лишние 50 человек кому принц за лучший вопрос А махните рукой кто пробовал вот мне очень вопрос понравился с цифрами где меня э-э обсчитали вот мне кажется правильно всегда надо быть внимательным цифрам вот Подойдите пожалуйста к вашей Заберите у него книжку прямо из рук Спасибо за вопрос Отлично тебе тоже супер призы от конференции Мы купили их на Avito Да спасибо за противоречивые доклад"
}