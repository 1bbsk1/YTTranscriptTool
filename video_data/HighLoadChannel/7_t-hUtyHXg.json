{
  "video_id": "7_t-hUtyHXg",
  "channel": "HighLoadChannel",
  "title": "Распределенная система, которая работает везде и на всём / Олег Филиппов (WiseAdvice)",
  "views": 1476,
  "duration": 2707,
  "published": "2020-04-14T10:49:45-07:00",
  "text": "добрый день коллеги мой доклад будет про распределенность тем в ритейле то есть первую часть я посвящу больше наверно или тейлу иначе потом будет непонятно затем ребята всем этим страдает почему как бы городят распределенную систему зачем как бы почему нельзя сделать что централизовано использовать стандартные там типовые для хайло воды подходы изобретать какие-то такие ключевые вещи вторая часть доклада уже будет соответственно больше про те методики и технологии которые там ну я мы не знаю там больше я буду говорить на примере сел и соответственно в компании который нам был последний проект больше относительно большое успешным который мы используем но соответственно для того чтобы все это дело построить и они не всегда так скажем сейчас современном мире уже классические хотя многие там используются по стандарту но некоторые женятся достаточно оригинальный ну как почему я буду об этом говорим говорить потому последний проект было наверное села это a fashion retail мы в основном главный мартышин хотя fashion либо технология потому что там где там где продукты там несколько другая история и систему другого класса они как бы в прошлом году маханул рассказываю неплохо ребята с x5 retail там мне нечем добавить в шине есть относительно эксклюзивная такая штука про который там дальше скажу но плюс еще наверно кейс в нескольких компаниях которых мне удалось ввести проекты строить системы подобного класса но соответственно он где-то всех этих компаниях в том или ином виде что-то присутствовала ну и недавно там узнал что как бы практически один в один этот кейс просто повторяют там dns retail но у них как бы там процессе расскажу некоторые вещи сделан тоже по круче поинтересней поехали но сначала я буду как бы расскажу для чего нужна fly то есть грубо говоря для чего общее сложно строить такие слабо связанные с темы которые могут работать при отсутствии стабильного постоянно интро цене не потому что принципе 2020 году казалось бы там эта фраза может звучать очень странно на самом деле вот как бы вот для этих ребят в принципе делаются оффлайн решение и eveline по-прежнему актуален по-прежнему должен работать как бы ритейл бывает очень странным современ тенденций идет тому что она все объединяется и то есть даже самый маленький ларек он как бы он принадлежит какую некрупный расти а я snoop ridgid крупной ручно сети там где ты как бы работать твоя система должна работать и у них тоже а у них как бы может быть интернате мобильник у них может быть какой-то макось у них у них компьютер может быть все что угодно куда можно воткнуть сканер штрих-кода кого-то даже как бы вместо канарских вместо сканера штрих он мобильник то есть оффлайн как бы ну вот он нужен и в моем кейси я буду рассказывать как построить систему который может стабильно работать когда у вас как бы очень много может быть разных точек они могут быть территориально распределены они должны конкретно работу в оффлайне даже если у вас как бы интернет не просто моргнул может не моргнуть он может просто не быть вот как час онлайн касс во всех магазина там 1 30 дней появляется интернет вот как бы требований к системе 1 30 дней интернет появляется тогда она может работать дальше а ну вот картинку все новерна знают известного шла интернета свое время по наделала много шума и практически классиком front and back and на самом деле но как бы бретели то же самое только заменяется на офиса и соответственно фронт-офиса бэк-офис на фронт офисе у вас красивая коса там улыбаешься люди все замечательно кассир который быстренько быстренько все пробил чек отдал вам всем здравствуйте здание на бэг-энде работают бедная техники которым это всё выливается следующую историю то есть нашим и не только наш импульс и кейсов это репликация 400 плюс б д бывает конечно больше намного они небольшие в районе четырех гигабайт ну нашим кейси опять но это реальный сервера то есть это относительно зависимые vitamins танцы которые так также требуют администрирования это не шутки дальше все это дело работу до 47 ну не совсем до 47 часть технологическое окно есть но как бы для упрощения мы считаем что его нету потому что принципе взять территории евразии слава богу как бы случае целый ну или для зеленым плохо на другой континент не переехали но вот по всей евразии магазин расположен а дальше самое интересное то еще скажу отдельно любой запрос кбд это не больше 300 миллисекунд все это приводит еще к полному зоопарку оборот они соответственно в отеле ну как бы знать там франчайзинг соответственно вот тот человек который пришел какой броне есть потом вы должны работать то есть система не может он не можете выдвигает требование брудно вообще никакой практически вот если windows запустился сканер воткнулся все должны работать но соответственно торговое оборудование все любая любая фигня который выпускается ведь российская промышленность должна к этому ко всему делу подключатся при этом как бы бизнес не стоит на мест на месте придумываются новые акции придумают какие-то интересные штуки соответственно работает замечательный ecommerce и как бы но continue the liver нельзя сказать но раз в неделю релиз точно должен быть чаще рождения 1 день вот такой вот истории когда как бы интернет он как то есть то нету это не такая простая задача как у нас по классике а как бы а где ну как бы стандартно относительно историю то есть ничего интересного самом деле холопы здесь highload это в принципе вот на всем этом деле надо обеспечить стабильный отклик стабильно ткану 300 миллисекунд откуда это взято это были менее эмпирического значение которое выработан годами если у вас там над ниц и больше то есть если система не ответила за это время то всех она кассир начинают выкрутим выделить дикая и 300 миллисекунд это как бы это верхний порог то порог после которого уже вы точно начинают при этом без требований к оборудованию а если брать нам дальний восток и так далее там там только пинки стучат миллисекунд то есть у вас на работу б.д. остается там 150 миллисекунд при этом запрос это не просто там не знаю там штрих-код вот вам товар то есть там линейный нет запрос это как бы там получим не товар к нему акцию если понедельник если дисконтная карточка если продавец такой-то и в чеке 20 товаров то есть там запрос может занимать там 34 страниц про оптимизацию это все дело конечно можно долго рассказывать это абсолютно отдельная история там все переписана оптимизирована причем один запрос должна будет на 2 2 этаж на 300 d одинаково из одинаково примерно стабильно временем отклика а это непростая история но как бы в принципе оптимизирует запросы наверное все кто в холоде есть уже как бы умеют это не совсем тема доклада ну как бы штатная система которые с которой начинали на только за полторы секунды запросов полнела вот примерно так выглядит таки ландшафт там где соответственно экран мобильника это фронт-офис там где задняя часть это то что находится у нас в бэк-офисе ну и как бы между ними соответственно обмен начну наверное с последней истории ну как бы как говорил уже распределенная система данном случае два раз буду обращаться к замечательной теореме или теореме cup в первом контекте когда мы говорим просто о создании разберем с теми как бы поддержки кучу узлов их там 400 на самом деле в том кейси про который рассказывает может быть нам хоть миллион здесь мало нарисовано просто нарисовать лень их может быть сколько угодно ключевая история в том что вот вся евразия вся россия и ближнее зарубежье но там может находиться в нашем кейси были все-таки ну все сервера вся сердце мощность расположен в москве в едином суде ну как бы 200 их там несколько конечно центральных бас несколько центральных серверов там они и кластеру tawan падали там подобное но вот как бы периферийные да где угодно хоть на камчатке могут располагаться и в данном случае с как ярема нам важно в принципе только то что узлы могут быть распределены система нужно устойчива к разделению но это не всегда так бретели есть как там где а.п. так так и 7 то есть в определенном контексте дальше об этом расскажу важно именно традиционно целостность к сожалению и причем проблема не с тем что распределите там затем или слабо связанные там устойчивые к разделению а проблема именно самая ключевая самое стрёмное то тысяч при этом согласованность данных и в одном контексте она нужна ну вот так работает в принципе история с данными именно разделенными то есть там ничего как бы сложно есть центральная база в ней собрано все что можно сложные правила фильтрации причем не только там если магазин такое тату туда отправил нет там есть там эти типы цен отправить этот магазин и эти по разным эти там разделить это далеком подобные оттуда и центральный банк тоже данный код приходится обратно только данные размеры сообщение может быть как минимально там 500 нас килобайт так может быть и 20 думать достигать в определенных кейсах а них тоже расскажу но самое интересное в том что не сюда всю так получается мир не стоит на месте у бизнеса если продлён требования в 90 процентов ритейлеру бизнес есть требование что продажи как только продали чеку пробили хочу получать онлайн хочу видеть для того чтобы оперативно управлять отбирать и вно иметь возможность данные смотреть самое сложное то бонусная система там данные к сожалению уже должны передаваться не по стандартной схеме распределенные то есть когда нам важна только устойчивость к разделению а там данные в определенных случаях должны передаваться согласованы то есть там распределенной транзакции там другая история и ну и бонус соответственно тоже должен сейчас онлайн ладно поехали начну смене интересной части она фронтон и фронт-офисами соответственно сначала наверное самое такое классическое это 400 плюс у-b д сумма до у нас либо под gres либо mssql то есть маску или там есть версия экспресс которые можно поставил работать в итоге не лень если вас донести кьюбайт но соответственно если база может вырасти больше то остается погреться как это все дело администрировать но там на самом деле рецепт только два простых они как бы просто до безобразия первых это хороший документация потому что техподдержкой работать 23 7 и нормально и база знаний это нормальный сон инженер то есть если техподдержку которые сидит как бы ну не только в москве и по всей россии то есть в некоторых дальних регионах если это другой часовой пояс них пойдешь просто did в том регионе в котором как бы нужно людей обслуживать и если что-то сломалось люди должны знать что делать если что сломалось люди знают что делать ответственно как бы они звонят москву кого-то будет и что-то страшное происходит но соответственно по всем региональным офисом в том числе по магазинам должна быть единой базы знаний должно быть доступно должна быть с поиском должна оцифровывать существующим мы взяли dokuwiki потому что confluence конечно хорош но в случае если надо вот всем вот этим вот включая партнер фран тизеров который там платят копейки месяц печени доступа ну как бы концу из дорого-то и медленно вот поэтому на dokuwiki ну и соответственно классическая история администрировать только сценарием только как бы нажатием кнопочки некой там остались техподдержки не может не знаем вручную взять и там снести сервер потом поставить новый нет у него для твоей сценарии у него для этого там есть наш сотрудник техподдержки ставит сам это он ставит средства собственно говоря администрирования нашего собственно разработки почему собственно водки дальше расскажу так теперь вот это интересной части до на фронте 1с но конечно не такая 1с современно выглядит немножко по-другому это абсолютно нормальный интерфейсы если кто-то видел фронты у крема там все намного страшнее это все ставится на пост это всё достаточно юзер френдли это даже имеет веб-интерфейс случае если магазин там низко человек там кто-то мобильника заходит тут все дела то есть это не такой прям все страшное что думали раньше но случае как бы с пряностями который должен работать абсолютно везде принципиально именно другая история что как бы это все дела но как бы на самом деле найти все + + и там не требуется ни живым они идут на это не дай бог не чего-то еще такого страшного что для компьютера который был закуплен лет десять-пятнадцать назад каким партнером и теперь он отнес магазин это критично отдел работает шустро если ребята как бы оптимизировали как то более менее запросы написали их по-человечески и все это дело как-то вертится-то в принципе время отклика стабильный ну плюс как бы веб-клиент невозможен как таковое естественно много рассматривать дальше скажу сил того что нужно оборудование некое оборудование но работать только с com портом некой работать некому и мутации com порта в общем это достаточно сложная история и как бы в пасть обеспечить достаточно трудным ну то есть как бы вот так выглядит есть плюсы определенные а самый главный плюс должна сама не в том что как бы тот технологической обмен на самом деле требование бизнеса от которой никуда не уйдешь дикий голод кадров соответственно кассира который видел один sq хотя бы хоть раз его найти просто проще поэтому если даже придешь там скажешь ребята как бы хочу чуть другое мы тут разработали попытки были не раз и не два ребята как вы теперь ли научить сделать интерфейс такой же тогда еще рассмотрим дальше зоопарк другого оборудования которое может быть абсолютно любое слава богу один из вас поддерживать нас нам не приходится как бы самим разрабатывать каждый драйвер это можно повесить ну и все что придумают российская газоль законодательства вроде degrees of шуба из 54 фаза и прочие безобразия но поделиться коробке но за это нам приходится платить технологическими сложностями так фронта ну как бы там еще куча функционала это к тему к того что разработка с нуля это должно сложную историю то есть на самом деле фронт-офиса то там и перемещение товаров инвентаризации прочистки в общем все чем магазин работает чем сиджей этого меньше просто у fashion ритейла там перикла лейки ценников акции их прочь безобразие чем нам приходится это дело платить мы не можем обновляться в онлайне практически как бы никогда то есть не можем просто там взять алтарь ты был написать отправить сказать ребят вот как бы теперь таблички лесного колоночка нет это требует монопольного режима работы и пользователей как бы в это время sbd работа не могут в принципе конечно хорошо бы это делать если такого нет явного запрещение но вот наставит нас такие условия ну а как же он туда рассказываю все про 24 7 что мы тут работаем онлайн понятно что как бы в магазине все дела можно сделать там пожалуйста ребята вот здесь человек пять ну подождите центр в центре все как бы предельно просто две базы на скруглений пользователей все пользу и перешли в одну базу 1 обновилась работать другой потом все работу 2 2 обновилась работу переключить обратных первым стандартная в принципе истории так теперь о не влезло как мы управляем конфигурации централизовано протен структуры и приложениями это как бы ну понятно в какой то момент времени слава богу современный мир оживает по джей ло и когда проект начинался в один прекрасный мент мы поставили что ну как бы систему пралине конфигурациями приложением нужно идем ребятам вот так вот такой зоопарк и бизнес сказали что они мы займемся с разработкой украине конфигурациями что придумал процессе процессе к сожалению пришлось там своевременно тормознуть проект основной потому что мы продали за а теперь пора уже этим управлять пилот запущен все хорошо все вроде работает крутится но как бы тем управлять как как загораете 400 там серверов администрировать централизовано ну плюс как бы сам один там тоже большая история в общем мы ставим 3 мне сначала конечно пункт задач должно быть они пусть то есть по умолчанию гис тем работ по буш потому что на сервер открыли порт отправить сообщение сделать событием в случае с ритейла мы то соответственно куча куча куча куча узлов на которых нету белого я печника на которых вообще шлюза интернет может этому чему-то мобильник и у нас самые так скажем популярная система уже отсюда и списка исчезли потому что там предполагается пушем 2 нашим требование было как бы но вы не представляете сколько mutter в час медуз и работает его тоже он поддерживать слава богу хоть уже windows до 108 удалось отбиться там как бы убунта или mac os тоже может стоять и без проблем вообще у нас исчезла еще парочка систем который на windows xp не работают принципиально ты не когда-нибудь работ да и зачем но вот как бы две очень устойчивых трети требованиям и как бы поняли что нам еще нужен кроме всего прочего сидел на tkat мониторить собирать на метрики нужно собирать логе логина пресс-центр об этом как бы еще во второй через доклада отдельно расскажу и стал все катера форм могут решать задачи мониторинга а вот это требование но очень интересная то есть зачем вообще как бы систему не конфигурации чем вместе с десктопом все просто люди люди работают нужно обновить базу обновить возможно срочным прилетели новой акции пролетел на выход фигня у нас continues delivery здравствуйте ребята как бы обновление срочно это все дело фоне мы сделать не можем потому что кто-то добавил колоночку табличку поэтому ну все мы видели надоедливые замечательное крутое сообщение windows там ваш компьютер будет перезагружен ума кость то же самое выберите время когда он будет перезагружен если в это времени при загрузились еще одно время потом пять раз отложил на 3 на 6 тебя дали 10 секунд при загрузить за тебя вот мы делаем то же самое даже то же самое прям даже с такими за историями то есть отложить отложить отложить а вот теперь отложить уже нельзя у вас есть 5 минут чтобы обслужить людей на пенсию после этого последнее из популярных систем управление конфигурациями от нас лились потому что как бы но это никто смотреть не мог и такого кейса использовать к сожалению эту ну более того нам это дело нужно к сервис очень не молилась техподдержка не поддерживать кучу джемов потому что system система старый и живым есть далеко не везде да ждут нет как это ни странно есть далеко не везде последний история в 1с есть свой скриптовый язык для которые решено очень большое количество большое количество chinese 3 рования там скрипт это грубо говоря то что язык там 1с и транслирует свою скрипта некое подобие шейла но как бы и очень сильно попросили ребята сделайте поддержку его тоже потому что что принц приписывать на там на питоне на повышение не хочется она тоже нельзя xp he или иных но поэтому на самом деле как ботать костыли делает блин вот вот все ритейлеры которых видел они все делают это то есть даже даже dns даже как бы кто-то крупный у всех какая-то вот своя система к сожалению централизовано я не видел что кто-то что придумал вот так это выглядит разработана относительно быстро на коленке у нас выглядит вот так у других ребят это выглядит по-другому и свой центр администрирования 1с свое я это сказал не просто похвалиться сабель как бы ну это все как бы у меня на гитхабе выложена открыто там можно посмотреть в принципе внутренне использования но кто запрещает сейчас уже нам над core переписали поддерживать плагины пол задачи long polling и дело нормальным состоит из трех четырех элементов но на клиент стоит агент плюс агент монитор агент соответственно это сервис который все дача внедрение затягивать с центра и выполняет агент монитор это именно та фигня который показывает надоедливые сообщение кассиром в том что ребята закройте вашу систему выйти из базы гитлер это сам сервер который может здание по расписанию запускаете в нужное время под каждый магазин настраивается свое время составляется расписание что там страшно самом деле истории после эксплуатации там списание прорва и монитор собственно говоря визуальная часть windows forms никто особо не заморачивался вот так сообщение выглядит который консерве dito1 дальше расскажу про резервной копии который происходит на фронт офисе резервные копии на фронт офисе они в принципе нужны но как бы не особо на самом деле смысл примерно в том что если оборудование старая если там никаких рейдов если там непонятно чего стоит а баз данных срок будет потеряно то есть с этим на самом деле несколько раз пытались бороться пытались делать бэкапы регулярный пытались включать full модель recovery какие-то средства резервного пир на пост стоит что мы только не делали короче на самом деле потери б.д. она все равно будет потому что отказа оборудование здесь не прекратишь нормально и средства администрирования если вот куча инстансов на всякой фигни его всего не сделаешь что надо обратить внимание надо брать внимание то что чтобы узел из нас быстрому в нашем кейси как бы там все элементарно у них два яблочка база локальная база центр если вдруг + база локальное средство если она недоступна то автоматически переадресуем центр если как бы она доступна ну а им что-то не нравится они увидели что там что-то частично разрушилась не дай бог к этой транзакции повисла еще что случилось они запросто работа центре внушают потому что как бы с интернетом проблемы но тем менее работоспособность вставляться а последний кейс восстановление работоспособности потерянный абсолютный б д занял 20 минут так грубо говоря в районе 20 минут занимает как бы установить узел с нуля если говорить о том сколько будет на слабом рудным там есть боится знаете с быка по примерно те же самый там 15 20 минут соответственно в кейсе вот с такой системой которая реально распределена кота должны работать на всем потери б.д. нормально ситуация с этим как бы надо смириться и надо сделать нормальный механизм ее восстановления но только собственным локальный б.д. работают потом как бы создается новый баз данных в центре сбрасывается сообщение обмена и происходит полной репликации тех узлов которые существует все хорошо все как бы вот это уж закрутилось это уже работала большой узел технологически затык возник в одном месте с которым уже такая система не смогла справиться к сожалению большой объем общих данных начал работать нормальный маркетинг появились как бы картики который там не знаю каждый чек это запись б д то есть это там не знаю там плюс там 500 килобайт к обмену соответственно потом это все дело начинает гулять по всей сети и грубо говоря сообщение обмена состоит из 99 , 999 из общих данных вот этих самых самых интересных дисконтных карт кик а все остальное там вот эти вот мелочи чеки которые передаются у нас стали большие сообщения у нас стала большая публикация она стала проходить очень долго она была близка к тому чтобы завалиться и в принципе ну как бы это завалится может по-хорошему район с теми как бы общие данные то в целом ну это плохо то есть тем тем их меньше чем они проще и красивее управляются тем лучше но вот так у нас выглядит центральной бдд потом когда общие данные занимают им какой-то объем а все остальное там немножко специфично для одного для 2 или 3 магазин это не страшно там общая там б д на там терабайт не знаю автора байтах и ныряйте в магазин соответственно там должно быть в нормальных пределах нормально предвестником и если б д магазинам полностью пусть и занята общими данными кроме того что то тупит это неудобно это стрёмно там есть определенный нюанс абсолютно правильно построена система нападать поддерживаются он уселся при обмене все-таки у старается к традиционной чтобы никаких не было коллизий чтобы не могли пройти частичные данные чтобы они не могли быть при записаны кем-то это даль там подобное это требуется что больших накладных расходов плюс репликация регистрации изменений тоже поддержка лизе это сложная большая история но как бы будет пить плюс репликации зашла сложно в случае как бы ты сам или с классической реляционной б.д. что-то поиграться с ней сделать плюс репликация чаще всего они завязаны какие-то центральные узлы которые тех который сидел проходит нам не хотелось как бы репликацию чтобы чем все со всеми без где там есть малейший белой печник чтобы система реальность использовать всю свою определенную мощь ну как бы а из этих данных и зубчиков факту используется что мало они просто должны быть синхронный зачем карточки синхронные потому что как бы появился онлайн появился интернет магазин так завел себе картик увереннее вдруг где-нибудь там соседнем магазине ли с ними о не завел картику он хочет и воспользоваться пожалуйста белкам заходит мобильника у него и и там нету потому что все не попал еще в интернет магазин либо там соседний магазин пришел там смена не было день почему то это на самом деле большая сложным проблемам то есть отменить обмена нельзя как бы поддерживающий сложно и это не данный факт а это именно справочные данные которые как бы общие для всех что в этом кейсе мы попытались сделать сначала стал и требования нам нужно быстро реплицировать однородные данные нам нужно multimaster репликация это все должно быть естественно простой настройки и практически чтобы также работала везде где только можно воткнуть нами проблема проблемным оказался последний пункт потому что чтобы работала везде это не для всех решений после долгих поисков вот такая фраза привлекла внимание что к учёбе на самом деле как бы очень неплохо сертификации об этом принципе все как бы заявляют но как бы в кгб и мы реально проверили реально работает реально работает неплохо причем мы можем делать вот так вот можно сказать слушай реплицируется пример с локалхост ну может реплицируется с 10 узлами там пожалуйста вот есть магазин там в каком-то база там есть белая песня пожалуйста реплицируется с ним на долю с центром а еще может вот с тем магазин а если ещё здесь узел еще вот с тем и грубо говоря таким образом вы сами такая сеть репликации которые завалить ну как бы очень сложно нужно упасть только только все вместе это причем вот кость белые как бы свойство что вот ты один раз там настроил причем настолько она выглядит сейчас курочку вдруг тут так вот визуально то есть реально если кто-то строил там репликацию там мая скелетон под грейси не дай бог в миску или особенно мер же репликацию когда вы там всё куда угодно может мультфильм multimaster там повесить просто три строчки в нашем кейси это конечно там отправка одного простого очень простого g соника и все пожалуйста все работает причем там под капотом тамерлан то есть or long этого то что там поставил везде где хочешь и и она как бы запустилась это все достаточно устойчивым к разным проблемам то есть даже там бывала компьютер летели диск сыпались а к уж тебе там выживал до последнего точно живет а значит и больше любой реляционный б д живет стабильнее чем под грех живёт почти на всём нашем случае как бы к учёбе просто вот он на ситуацию спасал причем это все дело реплицируется но поставил и будет и забыл не забыл только платеж центр в центре конечно нам пришлось сделать балансировку там естественно там индекс между ними там 34 к учебе и сервера и дальше соответственно уже джинс распыляет кому-кому что кому и запрос на публикацию один все таки может завалиться там нет у концерна классика нужен все как бы и так вся вся репликации проходит то что надо если бы как бы на этом самом деле можно построить там один из полную систему пожалуйста умка на самом деле перешли на нее то есть для вот таких слабо связанных стенд которые работают на всем чем угодно про махал на самом деле ну думаю здесь все-таки есть достаточно большая часть если большинство в бомбил разработчиков который блин чувак нам рассказывает к учебе работает не только в принципе как некое решение для десктопа для оффлайн а у него есть младший брат по учёбе абсолютно интересная история как бы баз данных которые разворачивается прям на клиенте прямо джесси про на фронте в принципе но это никого не удивишь а удивишь тем что по учёбе и поддержит полностью репликацию алгоритм репликации коуч коуч тебе другого на байке стоит на фронте получил все дела успешно как потягивать данный на фронт любые которые существуют на фронте может делать такой полноценный offline причем оффлайн абсолютно стабильный причем без каких-то затрат потому что все все же все чем рассказывать но как бы направлена в основном историю с оптимизации затрат потому что к учебе она вообще но как бы есть не просит и может работ на всем на чем угодно и как бы репликации все-таки не кластеризации и у кого уж тебе есть старший брат к у тебя есть все-таки нужно то младенцы нужен полноценный кластер нужно к вы за кого какой то хранилище то соответственно в кучу истцу есть при этом поддерживать самые замечательные крутой в горы там репликации из кгб то есть мы можем поставить к убийству бег и почти бесполезно фронте и это все дело будет стабильно круто быстро реплицируется и даже как бы я так понимаю что ребята из кгб под эту всю тему а разработали целую концепцию и ее активно поддерживает шо offline first грубо говоря сначала обеспечить работу ваше положение offline а потом уже думать обо всем остальном ну как бы получить и бессовестно использовать предельно просто ничего хитрого нету тоже как и в кого взял сказал реплицируется отсюда но как бы вас на фронте все данные получили дальше можете работать и как бы ну нашем случае несколько решений в принципе мы так и сделали работает быстро будут красиво работ устойчиво так теперь к быку баки вот с этим с этой истории было самое все сложно интересным здесь у нас уже скопа потребовалось не а.п. а ну по факту нам не потребовалось на самом деле стабильность и и как бы но как устойчивость можно обеспечивать но в случае с нашим 30 дней ним как бы как таковой сея наверное невозможен настолько принципиален важно реальность если сравнить бонусную программу которую есть любую розницу она очень сильно похожа на какую систему виза вы можете списать деньги списать бонусы за числе деньги банкомате зачислить бонусы расплатиться бонусами расплатиться онлайне баланс по большому счету как бы processing бонусов он процессинга банско карта не так далеко и ушел то есть там те же самые операции только если у банка на это есть там вот столько вот денег у розница отдел денег нет поэтому покупаются кит решения решение купить как бы ну не проблема мы выбрали manzana потому что потому что потому что дальше расскажу проблема начинается в том что транзакции на фронте начинает выглядит так ну как бы а так и раньше выглядела то что обычно так сталин begintransaction что-то сделали базе и кометами дальше в розницу ни фига подобного begintransaction потом банк с терминала потом печать чека с оборудованием мы уже как бы слава богу научились работа там есть драйвер у них и специальные свойства что как бы транзакции завершена транзакций откатить там транзакт тоже так поддерживаться там уже все ребят привыкли все производили оборудование уже с этим смирились и вы даже не могли наблюдать там у нас кобанской картине прошла чек отменён вот всё красиво за счет того что как бы поддерживал загсом такие в базе данных в это время ничего не образовалось а в распределенной системе если вы к загсу завершили а потом пробили чек ваш чек мог уйти в центр вот это вот уже проблема а соответственно если вы поддерживать транзакции то вы не можете зафиксировать у вас обмен в это время не пройдет ну то есть вот такая история а вот проблема когда сюда добавляется еще одна фигня замечательно система с бонусами вот то тут начинаются трудности потому что все это дело транзакцию проводит не только локально но еще и через интернет здравствуйте распределенной транзакции там десять раз пленка dax там есть что там есть распределён блоки который хрен от ловишь на самом деле в случае если на фронте вот такая вот вот такую история происходит нам никакого там координатора сплин турок и падеж хоть и остается делать собственно надо обеспечить более менее стабильный отклик вот эта система оно не будет уже централизованной она уже не будет распределенной она уже будет централизованной почему а потому что если вы не дай бог там списали деньги и вот тут она в центр не ушло чувак быстренько причем нашем случае делаем пытались распределён сделать то есть у синхронно направлять кто нам зачем транзакции то есть писание бонусом зачем это то есть человек стоит на кассе потом таки умный вид на кассе ткнул там пробить чек попали в этот магазин заказал интересные истории люди додумаются до всего чего угодно более того если говорить да пусть посмотрите если вы там положите в банкомат деньги так вам и надо там они у некоторых банков стран придут unica top банк вы в мобильный уже не сразу видите а вот если вы попытаетесь списать соответственно вам писать если у вас денег мы ищем нужно покупку не даст соответственно как бы в банках работ примерно также списание происходит в транзакции зачисление васин хроне сейчас скажу еще одну ужасно вещь сервера на vs это плохо сервера в случае как бы вот с такой историей которая существует сыгран на любом углу чем сервисе это плохо мы пробовали сначала две области вселенной достаточно работали долго то есть там тоже сам это на списание начисления бонусов но там получилась такая история что как бы облачным что нормально все как бы сервер переехал ребята теперь у него как бы в dns тот же печник другой либо он уже теперь в другом хостинге но это нормально абсолютно как бы вчера я имеют право миграции куда угодно но только в случае с ритейла как это происходит вот через централизованную систему со всех хостов отправляются и причем это обязательно делать отправляются пинге до этой самой бонусы системы и либо систем процессинга картик pink обязательно проверить трассу обязательно проверить как бы нужно делать да хотя бы через там транслировать контент ping test нужно обязательно пропустить если вдруг не дай бог с бонусами и с любым другим процессингом картик приходится столкнуться пинги островским чтобы они не были больше 100 миллисекунд если там больше 100 миллисекунд меняется провайдеры надо мы каких-то там случаях не знаю от провайдера убирали проводочек ставили мобильный мобильный интернет мобильной отработал быстрее просто провайдер он как бы не он нормальный человек и он как бы поставил нормально трассу провайдер который был там в этом торговом центре у него трасса была где-то тебе соединенные штаты у кого-то через мкс там то есть мы видели пинге там у по 3000 миллисекунд из середины россии это как бы но это нормально то есть люди работают как могут и или как хотят соответственно когда вы знаете вот все пинге выстроили все хорошо все везде 100 миллисекунд наконец-то техподдержка радуются магазины могут нормально писать бонусы приходит дождей все заново а у ребят ну просто знаете блин ребят мы подумали что как бы вот так вот хостинг у нас дорогой как бы у нас есть грани сюда переехали но как бы у нас ничего не поменялось у нас как бы все так же то есть а все трассы стали другие здравствуй до свидания после определенных мучений мы выбрали выбрали стал хост решение даже более того мы расположили вот строго в одном дата-центре там там ничего хитрого там один мы соску или файлов и все то есть один айпишник всегда один даже если да падет это будет не так страшно если только насчет код переезжать ну и соответственно каждый новый узел когда там магазин открывается обязательно проявляется pink выбирается тот провайдер с которым может здесь нормали стабильно пингом это важно дальше все более нестандартные то есть про то что я говорил там у нас продажи логии мы используем логирования все что происходит в магазинах оно должно проходить там есть там есть на самом деле технический лук и пользователь мог использовать многом чуть сложнее потому что вам много технический локон как бы чуть проще но там как бы все передается буковка к хаосу ластик и в одиночку единственно как бы отличие от что один из кафку не поддерживает и приходится использовать и некий костыли к конференции концу интер с прокси то есть это некая истории который обладает кафку пройтись типи типи запроса он соответственно даже попадёт к вам нужно с кликал сам всё замечательно в хаусе как бы для кафки есть специальный адаптер view и он как портим данный процесс и тогда когда ему надо вообще очень очень круто работает и ласков к напрямую интегрируется там тоже за что просто и легко ну в нашем случае позволяет нам если все магазины со всех узлов начали бомбить резко продажи и так далее там удобный от центра начнет засыпалось или там не успевает судил приварить но какое-то время в кафки аккумулируется то есть мы в принципе никаких продаж не terrain и бонус это особенно клика уж коли house мы используем для хранения логов так как бы ни для кого не новость это все просто и понятно ну если что как бы я мог говорю про экономию и здесь не потому что модно потому что очень экономично сначала на пробу лихо эклоги власть как это принято даже вилка стек там был все это дело но суть такая что у нас система храни логов получилось по ее как бы объему инфраструктуры которые под нее была задействована система налогов получилось примерно такая же как и продаж то есть очень прожорлив для кого-то это не имеет большого значения для ритейла это имеет огромное значение у меня просто не поняли когда олег то хочется хранить подлоге столько же сабиров и столько же денег сколько мы платим за все остальное зачем ну действительно зачем собственно дальше критерий было что взяли логе в базовом своем варианте сжали их диплом посмотрели сколько получилось и после загрузки в суде проверили сколько получается пуст игрушки на самом деле за счет к лодочного хранение в клик совы получать больше но ненамного по факту пользы телок когда используем что там какой-то польский провёл такой документ что-то удалил где-то смухлевал и вот для это всё делать нужно справиться взбирается по конкретному магазину по конкретному пользователю за конкретный период и даже и на по конкретному объекту анализируется там все равно есть отбор и можно использовать индексы когда можно использовать яндекс бар и здравствуйте хауса мне нужен план xtu поиск и в 99 процентов складирование и тайвин так как бы elastic он как для этих целей не совсем подходит особенно если хочет сэкономить в нашем кейси как бы но anti-fraud решаем вполне успешно house там гружу keep терабайт и которые превращаются в мегабайты гигабайт и так далее там честно вообще сама с ним лагеря не больше терабайта всего того что очень неплохо сжимается куплю себе сказку эту грусть очень быстро успешных хорошо вообще проблем не вызывает она местах мы как бы регламента многим до чистим их как там практически нету ластик ластик имени не ушел ластик не ушел потому что есть технологические логика логична блогами все достаточно сложно ну там как бы реально сложно вот это официальная рекомендация ребята как вам следует некоторых технологических трудностей в местных тех журналах там поток сознания которые парсится там иногда гриппом иногда в к там 1 и скрипты есть там чего только не присутствует то есть если хотите найти утечки памяти использовать вот такую строчку ну конечно как бы собрать тексты и файлике и запустить на них там в консоли какую-то команду это не очень прикольно мы себе для этого дела все грузим власти к власти ки тоже там настроили некоторые отбор и запросы с регулярными и их для этих целей используем во первых ничуть на другом писать во вторых все заработать быстро просто удобно и без перебора куча лишней информации так ну и соответственно было бы неправильно если все это дело не собрали красивый даже борды красивый даже барда собираем графом туда пока еще zabbix да хорошо и как ли house такой ластик может быть красиво картинки в общем то в принципе все что хотел рассказать спасибо за внимание вопросы боюсь вас огорчить временно вопрос у нас совсем не осталось осталось возможность и необходимость поблагодарить нашего спикера за первый доклад за открытие нашего зала и мне кажется надо выберите докопались ментами но и что ты его подарить полисмен это по вашей части я думал подарить"
}