{
  "video_id": "r_82l5jbvL8",
  "channel": "HighLoadChannel",
  "title": "Web scale бэкапы для MySQL / Алексей Копытов (Percona)",
  "views": 190,
  "duration": 3024,
  "published": "2017-04-22T14:47:45-07:00",
  "text": "меня зовут алексей копытов я работал программистом киркой нас в компании бирка на земле сработки пока она серая прикольных собака для не в итоге также руководитель проекта и поклона x-tribe кластер еда в этом докладе я буду рассказывать про webscale бэкапы честно говоря понятия имеешь жуковский но модное словечко я подозреваю что каждый вкладывает в это слово что за свои очень личное я буду рассказывает про бэкап и серверов но под большой нагрузкой или с большим объемом данных во первых нужно объяснить что бы котлы от логически физически я думаю большинство людей то знает значит логически бэкапы это представление данных в виде набора искал команд которая при выполнении сервером выстраивают некую копию данных то есть данные будут идентичны тому что было на исходном сервере очевидно для выполнения sql команд то есть операций импорта нужно время обычно это медленно тем не менее логически backup а иногда незаменим незаменим и например в случае восстановления поврежденных данных до например если у нас какой-нибудь побился индекс в вы надели индексный является собственно данными нужно поднять сервер с какими-то мы на тебе force recovery сделать логический backup да и таким дан таким образом данной сутки восстановить может быть там на другом сервере логически backup а также часто применяются при апгрейде иллидан грейди том случае если какие-то новые версии вводят не совместимые форматы данных то часто upgrade логический bk преобразили дом грязи обратной снова версия что-то не заладилось является единством способом сделать полный дамп изотопа потом рилот физических бэкапы работают с файлами на диске они когда копируют файлы в обход сервера частых приминаем применяют для клонирования всей базы данных как правило это гораздо быстрее чем дам и импорт логического быка по но такой серьезный минус как правило физически backup занимает на диске гораздо больше места чем логически за счет того что в ну вот формат данных которые форма хранения данных на диске в базы данных он сильно избыточен есть очень много служебной информации страницах есть всякие там ряду логе есть онтологии проще служебной информации которая собственно не является данными секторе индексов конце концов честь для москве а существует огромное считаю количество утилит для бэкапов я не специалист по другим базам данных но быстрый поиск в google и показаны что мой аскел пожал является рекордсменом по количеству тилли для backup а вот только то что мне пришло в голову и это не считая всяких настроек всяких утилит которые занимаются ну или представляю графический интерфейс к этим утилитам или реализует какие то конкретной стратегии backup а ну например там делаем 1 неделю полный backup все последующие дни инкрементальный backup храним последний там 30 дней бэкапов и тогда летом подобные вот это только базовые утилиты не считая всяких там backup менеджер сейчас быстро пробежимся по этим утилитам чтобы было понятно о чем и говорю дальше mysqldump это самая простая утилита на общем то единственный плюс данная реализует логически бэкапы единственный плюс в том что она доступна всегда если у вас установлен неважно какая там какой-то какая-то версия москве или мо резьбе лепрекон сервер у вас автоматически снимает складом лосьонов и в клиентский пакет ну это не суть из минусов можно отметить что как у всех логический бэкапов мой скил там не поддерживает инкрементальные был копы он однопоточный то есть и дамб и импорт делается в один поток результат дампа это один большой скол файл если например нужно установить установить какой-то всего лишь одну таблицу из бекапа приходится как-то импровизировать и выкусывать соответствующий скилл команда из одного большого там по и очень медленно восстановления майдан пор является улучшенной версии mysql дамп это тоже утилиту логического backup а написал и человек с большим опытом работы в качестве маски особей и саппорт инженера поэтому зрителей такой слоган холмс холма искал de bien саппорт инженер воды медленно моя складом ключевая ключевое отличие от майдан ты различается в том что это многопоточная версия поскольку каждый поток копируют свою таблицу то приходится сохранять в отдельный файл но это может быть как плюсом так и минусом плюс заключается в том что если нам нужно восстановить сегодня будет одну таблицу или какой-то набор таблиц нам не нужно разбирать какой-то огромный dump file да можно просто взять соответствующей таблице и загрузите с помощью парные утилиты это называется mail order да но такой серьезный минус серьезный нюанс в мой дом бери который в некоторых случаях может оказаться критическим звучит в том что мой таймер поддерживает только локальные бэкапы то есть нельзя сгенерить какой-то поток да и отправить там скажем псс вечно какой-то удаленный хост можно только сохранить данные в на на локальной файловой системе но и тем не менее восстановление все же медленно и все же требуется импорт хоть и даже если он выполняется в несколько потоков то это занимает время maylene backup как можно догадаться по названию работает через снапшоты файловой системы интересно желтый лавеем эта утилита физического backup а ее главным плюсом я бы назвал всеядность она работает с любыми типами таблиц даже будь то и наделили току тебе не важно что даже тел storage engine и которые еще не написаны mail и mail veeam backup их заведомо поддерживает о том что это просто snapshot файловой системы минусом является то что эта утилита не умеет делать инкрементальные бэкапы точнее их можно реализовать собственными средствами там есть для этого необходимые хуки но вам скорее всего этот такое решение такой организации инкрементальный бэкапов не понравится потому что для вычисления дельты придется сканировать как исходный backup так и текущую версию данных что для больших объемов для webscale систем часто неприемлемо и да естественно поскольку это snapshot файловой системы майло мдк поддерживает только локальные бэкапы только тебе кодеков новичок в в забеге но как мне кажется не очень удачный старт потому что сейчас поясню почему это утилита реализовано в качестве библиотеки которая работает вместе с серверами прихватывает все вызовы ввода-вывода да и копирует соответственно тут точнее дублирует всю запись например базу данных какой-то там отдельный круто отдельную директорию в отдельные файлы которые сосны составляют backup по завершению утилита фактически это инверсным shot но реализованные на стороне приложения в user space да и суда с точки зрения какая вот для меня ускользает смысла знаний от утилит я не понимаю что горячим фундаментально это отличается от того же майло veeam backup конечно можно придумать какие-нибудь там аргумента сказать что теоретически это решение она кроссплатформенная и оно не зависит томат и мне нужно чего настраивать но с другой стороны linux это фактически стандарт для webscale систем до элви я настрою не так же сложно поэтому эти аргументы они довольно слабые ну стоке стоит отметить что до этого теле этого физического backup а поддерживать любые типы таблиц но теоретически несмотря на то что первая публичная версия только терехов bk было выпущено примерно год назад до сих пор в нем находит довольно серьезные ошибки вот недавно я видел они обнаружили что оказывается только тебе holding up не поддерживает асинхронный ввод-вывод который используется вы надели на linux и соответственно и на тебе не поддерживается хотят теоретически должно бы это конечно исправят надо поговорить о том что потребуется какое-то время для того чтобы этот инструмент это утилита повзрослела и видимо говорит о том что пользователи веселит и не так уж много да она не поддержит инкрементальные бэкапы по определению естественно может быть опять только может делать то делать только локальные бэкапы и вся запись базу дублируется процессе backup а если данные пишут фактически дважды что тоже может сказаться на производительности нужно отметить продукт где приход байков что это не является не является свободным open source решение это id утилита распостраняется только вместе с только тебе энтерпрайз который любимая что это не коммерческое предложение только так я не знаю что там есть еще помимо только тебе had come back up но это не бесплатно и не свободная то так же как и следующий утилита которое является майский enterprise backup это тоже утилита физического backup а это при приторный по доступной только по платной по платной подписки от oracle реализует горячий backup длина тебе то есть backup для копирования файлов без остановки и без блокировок почти и мы об этом подробнее потом поговорим утилита поддерживает инкрементальные б кпк по на удаленные хасты быстро выставления всей базы поскольку фактически физически бы копыт и есть копия файлов которые нужно просто переписать нужное место и после этого запустить сервер внук недостатком как у всех фактически физических усилий до физического бака то можно нанести большой размер данных на диске гораздо больше обычно ну примерно 1 10 например больше чем соответствующий логический backup для тех же самых данных не поддерживает некие расширения экстра тебе поскольку это утилита тора клана поддерживает только москве лот oracle соответственно перка на сервер например ли мария тебе есть опции которые меняют формат данных на диске с целью каким вы там оптимизации но вот маска энтерпрайз backup этого не поддерживает тоже нужно иметь ввиду и естественно не поддерживает о к тебе purple она экстра backup наконец во многом аналогична утилита это фактически свободная бесплатно альтернатива для майского лента псб как они практически стопроцентно совместимы в функциональности есть какие-то мелкие нюансы какие-то мелкие отличия функциональности что-то умеет персоны из рук от того что не имеет mysql enterprise бэкап и наоборот если это мелкие отличия в интерфейсе команды строки или гита не once нюансы в реализации когда одни и те же функции просто реализовано по другому соответствие работают есть мелкие нюансы в том как как работает та или иная функциональность но вот фактически это вот по большому счету это одно и то же xp как используется в facebook в twitter в linkin рнк еще куча компаний и поддерживает все основные форки или brain чем я спел собстна тот майский который дорог la mare di persone сервер расклеил что угодно связи с этим с таким большим разнообразием разных утилит возникает вопрос что же выбрать из всего из этого ну на самом деле при всем многообразии я бы сказал что большинство случаев покрывает связка моей дампир и преклонный экстра пикантной дампир биологических бэкапов и для физических бекапов церковная starbucks the backup это те утилиты которые используются в нашем отделе который является перка на манер services который фактически они выполнят функцию удаленных детей до для клиентов вот каждый раз когда я нужно настроить какое-то решение для бэкапа для клиентов они используют эту связку майдан туры преклонных из тропиков и потому что мы разрабатываем и майдан перепихона x 3 bk потому что эти утилиты они в общем то покрывают ну большинство нужд исключение оставляет случай когда используются только тебе до purple нестерук от не поддерживает только тебе и фактически единственным выбором в этом случае является mile end eq от можно попробовать только тебе ход backup но как вы наверное догадались я довольно скептически настроен по поводу утилиты у нас перка несколько проект аркона клала тулс который использует только себе и вот они для бэкапов используют mild and backup и у нас есть несколько блогов на у нас есть несколько постов в блоге перк он и на эту тему в общем это понимаю что они вполне довольна функциональностью mail backup ну и наконец мой скил энтерпрайз backup несмотря на то что это конкурент для пир клона экстра backup я не собираюсь как-то какой-то антирекламой заниматься это довольно хороший инструмент я часто на скачиваю какие-то пробные версии и тестируем не интересно как реализовано та или иная функциональность и это большим хороший инструмент я бы ради нее исключительно ради майский энтерпрайз backup не стал покупать платную подписку но если оно у вас уже есть каким-то другим причинам до силу других причин то почему бы не использовать этот праздник любой backup это некий компромисс между размером данных на диске и скоростью установления ну простейший пример если мы хотим скомпенсировать данные да для того чтобы сэкономить место на диске скорость становление очевидно увеличится тоже сама относится к логическим бэкапом и физическим патологически бэкапы капрал займет не меньше места на диске но скоро составления значительно меньше тоже некоторые утилиты соответственно и для логических backup для физических могут ну представляет нику функциональность для того чтобы минимизировать негативные эффекты да например биологически бэкапов в маске алдан их слабое место это медленно скорость восстановления в версии майский дан который поставляется вместе спокойно сервера мистика опция называется на тебе арте myspace она доступна во всех общем-то на знал в настоящий момент поддерживаемых версиях перку на сервер она в некоторых случаях довольно значительном ускоряет импорт что она делает му идея простая когда мы генерируем файл excel файл для импорта то сначала идет создание таблиц и описание схемы потом собственно данные если у нас есть какие-то вторичные индекса их может быть несколько то сначала получается создаем таблицу с полным набором индексов и потом вставляем данные каждый раз при каждой вставляй каждую запись мы обновляем эти индексы это медленно гораздо проще создать таблицу без индексов ставится данные 1 x можно построить потом используя какой-нибудь быстрый метод типа индии fast in expressions когда ненных создается не вставка с сортировкой функциональность пока не рисованного москве и соответственно чебак которому уж по моему лет 5 и пока не реализовано в майдан трахать я знаю что разработчики мой dumberg те которые работают перка не они в курсе про эту проблему и я думаю скоро это будет реализовано народу утилита для физического карта представляют некие средства для уменьшения размера данных на диске дан словам стороной физической бэкапов является большой объем данных на диске для занимаемой бы котами так например преклонные мистер backup есть функциональность называя который называется компактные бэкап и что она делает но папаху по аналогии с мая sql дамп она эта функция при бэкапе не копируют странице принадлежащий вторичным индексом потому что в этих больших страницах не собственно данных их можно перестроить потом тоже используя кого-нибудь быстрый метод да тут немножко на слайде разъехалась где команда сначала на копируем и указываем копируем данные указываем ключиком комплект потом вторая команда для того чтобы подготовить этот backup к становлению нужно указать ключик rebuild индекс с которая собственно перестраивает перестраивается речные индексы пропущенные на этапе копирование данных маски латекс backup представляет похожую функцию которая зывается skip a new space только пропускает он они не странице вторичных индексов пустыне используемой страницы в некоторых случаях эти страницы могут занимать тоже значительный объем значительную часть от общего размера быка по и работа на похожим образом то есть после того как мы скопировали данные с пропущенными страницами при восстановлении эти данные нужно перед эти пропущенных страницу нужно вставить обратно потому что иначе все какие-то смещения в внутрь информации на тебе есть смещение на странице если странице просто пропустили то и на тебе не будет работать потому что все смещение поедут совместно мы уменьшаем размер на диске но за счет большего времени на восстановление потому что нужно перестроить файлы данных перед установлением блокировки что может я про блокировки все утилиты про который рассказывал они обещают горячий бокал на самом деле они используют блокировки не на все время backup а она никакие ограниченный промежуток времени который может быть небольшим в большинстве случаев это небольшой промежуток времени но в некоторых случаях клинических он может быть довольно приличным значит блокировки используются для согласованности с не транзакционными данными если у нас есть это мой сын таблице мы хотим чтобы это был некий атомарный снимок до снимок состояние всех данных неважные тайна гибели mayson в некий конкретный момент времени для этого нам нужно на какой то момент времени когда мы завершаем копирование ряду logo и нози би нужно заблокировать запись в не трансакционный таблицы нужно у дома я сам этого места есть и другие нетрадиционные storage engine кроме того есть frm пока еще в москве есть frm и для того чтобы наша копия данной было согласовано с этими frm файлами в которой хранятся описание схем и таблиц нам тоже приходится заблокировать все операции ддл на время копированием файлов и наконец часто при планировании серверов например при планировании слева нам нужно получить координаты берлоге или конкор знать локальными ноги или координатами влоги на мастер если мы планируем slave том случае чтобы мы могли выполнить правильно команду чинишь мастер в тот момент когда мы понимаем этот слайд с backup а вот для получения этих координат тоже используются блокировки и все эти утилита на самом деле использует одну и ту же команда который называется вот флаш tables with ритлок и проблема здесь заключается в том что эта команда блокирует слишком много блокировки которые она захватывает они слишком слишком строгие задалась на совсем других целях целей фактически она запрещает любые обновления данных любых таблиц для любых storage engine до явно команда unlock the eagles на самом деле утилита мне одну из утилит для резервного копирования такая функциональность не нужно но они все используют поставил сюда венок прост потому что сервер не представляет более более тонких блокировок в чем же суд на проблема во flash ты был предлог на берет блог на высоконагруженных серверах вот некий упрощенный алгоритм работы как это все реализовано начала флажки был фильтре ног сбрасывает капельки аж двери кэш редко используются в высоконагруженных проектах но тем не менее есть случай когда он действительно помогает и вот это тоже может быть первый шаг тоже может быть стать тоже может стать проблематичным в этих случаях значит потом flash to be sweet ритлок блокирует все новые записи то есть апдейт insert выделит все все эти команды блокируются на неком бьют exe после этого флажка и был святые блок дожидается завершении всех выполняющихся записей это уже само по себе плохо на острове нагруженных серверах потому что вот это вот ожидании осуществляется с заблокированными новыми заповедь записями то есть заблокированными новыми входящими командами отдает insert да наделит после этого мы дожидаемся завершения всех текущих select the macallan select опять же еще одно ожидании с глобальной блокировкой и наконец мы блокируем все операции к нет очень строгие очень сильные блокировки которые на самом деле не нужны проблемы решить мы в iclone сервере реализовали такую штуку которая является back at lax политики до 2 команды сегодня канал на первое это локти bells ппк команда блокируют и дел все операторы кейфейбу alter table так далее и эта команда блокирует записи в нетрадиционной таблицы maison и 2 команды отсылок белок ходоков эта команда блокирует commit если бы если точнее то эта команда блокирует любые операции которые привели бы к изменению координат в берлоге или координат корзин от мастера на сливе по сути вот эти две команды это все что нужную утилитам для быка под неважно логические the backup или физически это не нужно и это гораздо менее проблематично для нагруженных серверов да то есть вот сравнение персонале backup естесно поддерживает backup локи он использует их автомате их автоматически в том случае если он видит что backup локи поддерживаются на стороне сервера вот сравнение алгоритмов скажем так работы как он если backup в том случае если используется флешкой был свят рядок когда server не поддерживает backup локи этом случае когда используется backup локи в случае глобальные вот бы блокировки экстра бокал сначала копируйте на деви таблицы потом на блокирует делает серого фактически приводит сервером were данный режим с помощью флажки был свой венок затем копирует cfm а я сам файл и под глобальной блокировкой напомню что в этот момент даже обновление и на тебе таблиц заблокированы получает мастерства их координаты завершает копирование ряду logo и после этого блокирует сервер зависимости от того как много у нас таблиц как много у нас моей санта блесни транзакционных сколько у нас какой объем занимает ряду лог то есть объем ряду лог зависит от того сколько обновлений у нас было сделано во время backup а все это может занимать очень большое время и фактически все это время сервер доступен только на чтение только для селектор случае использовать backup логов мы сначала копируем его таблицы потом мы блокируем выполним команду локти был свой карту с блокируете сделал операции за письмо ясен таблиц ну вообще предполагается что мой сын таблиц на нормальных на высоконагруженных проектов быть не должно отдел операции они сами по себе довольно редкие поэтому фактически эта команда не влияет на нормальную работу сервера и на тебе таблицы продолжают бы доступными как до чтения так и для записи на копируем файлы мой сын таблицы если они есть и так далее блокируем белок получаем координаты завершаем копирование ряду loko разблокируем таблицы после этого мы можем получить координатами логов в том случае пока белок на заблокирован и после этого уже можно блокировать блок backup закончен момент маскел до версия маски утилитами я спел танк который ходит пакет перку на сервера тоже была модифицирована для поддержки backup локов то есть традиционно в традиционном аскел dasn't есть два метода создании бэкапов да это сигнал transaction этот режим не блокирует сервер но у него есть серьезное ограничение он не работает если есть но ясен таблицы точнее обновление мой сын таблиц или операций дел во время backup а точнее работает он работает но мы получим итоге неким системный бэкап и майский алдан должны сможет нас об этом предупредить альтернативы этому режиму или сокол тибблз да мы полностью блокируем фактически тот же самый flash games with релог только моей скилл данном случае выполняет его на все время копирование данных что но в большинстве случаев это неприемлемо даже обсуждать нечего полный риддл окна на все время дамб и это очень очень плохо и наконец в пир клан сервере моя складом теперь умеет поддерживать такую опцию log for back of который работает вместе с опцией сингл transaction она не блокирует сервер в том плане что она использует backup локи будут заблокированы только те операции которые привели бы к некой системному backup у а именно ддл и апдейты там нетрадиционных таблиц как например maison то есть том случае если мы используем только и на тебе таблицы и у нас там но считаем что операции дело вполне саванна редко блокировки будет вообще никаких аренду капан да турнир забыл упомянуть пока эта штука опять же не поддерживается майдан пиром хотя должна быть я знаю что разработчики в курсе это же у них это в планах есть то есть я думаю что они перенесут поддержку до каталогов и исмо искал домой дампир типичный проблема который возникает с webscale системами когда данных очень много лет в том что нам нужно скопировать не весь объем данных который может быть очень большим а только какие-то отдельные таблицы ну например мы можем делать полный backup к всех данных 1 неделю но если нет особо чувствительные данные которые будет было бы очень болезненно или дорого потерять такие данным и скажем копируем делаем резервную копию раз в день в этом случае pixar выход поддерживает позволяет указать какие именно таблице мы хотим скопировать есть вот несколько опций которые позволяют по-разному это сделать плюс заключается в том что это все тот же горячий бкб без блокировок минус заключается в том что больше времени на восстановление это связано с тем что вы на тебе есть такая оптимизация который называется чинишь баффер его для того чтобы получить консистентную таблицу такую таблицу которая потом можно переписать на другой сервер импортировать отдельно весь этот чинишь баффер нужно объединить собственно с данными в таблице это может занимать значительное время на больших объемах данных mysql database backup поддерживает такую же функциональность в планете частичных бэкапов но у них есть еще один режим который называется транспорта volta и был spaces с ними он использует функцию транспорта был spacex которая появилась в москве 56 плюсом является нулевое время на восстановление но есть один большой жирный минус эта опция и вообще функциональность транспорта болты был spaces блокирует соответствующей таблице на время backup а для меня наличие такой функциональности в excel backup это несложно в общем-то реализовать но некоторые старается это сомнительным потому что если есть функциональность транспорта болтаю space на сервере если хочется имя заблокировать бэкапы на время много платили в таблице на время пока то то можно собственно ту функциональность со стороны сервера использовать нет смысла использовать в функционале со стороны утилиты горячего bacopa но если вам нравится такая штука нужна преклонных стрекот сообщите нам на реализуем это несложно частичное восстановление снежная проблемы с проблемы частичного копирования иногда восстанавливать всю базу целиком слишком дорого или просто ненужную нужно установить какие-то отдельные таблицы которые скажем побили сюда перку она эстер backup поддерживает частичное восстановление собственно с первых версий очень давно причем экспортировать таблицу для последующего импорта сервер можно их так lancer и 51 и 55 и 56 потому что функциональность было реализовано стране пирккала сервера тоже довольно давно и соответственно в маскел 56 где появилась такая функциональность в стоковом так сказать в обычном москве и того настройка отложила поддерживает майкл типа с backup эта функциональность появилась сравнительно недавно и вот не очень понятное для не ограничению то что она поддерживает moscow 5 6 я понимаю но почему-то это работает только для детей с бэкапов то есть быка по которой используя транспорта был тайбл spaces почему так ограничениями не очень понятно ну что неправильно прочитал документацию но положено написаны довольно ясно что поддерживает только для транспорта болты русской с бэкапов инкрементальные бы какие проблемы возникают сентиментальными выкопаны на больших объемах данных традиционный метод который реализованный в преклонные кстр бэкапы в москве ндс backup для организации инкрементальные бэкапов если вычисления дельты разница по сравнению с предыдущим бэкапом этапа сканировать все данные и найти все страницы у которых lsn последнего обновления больше чем lsn но некий заданные лосин в качестве обозначения обычно использовать и лосин предыдущего показал по это может быть полный backup или предыдущий инкрементальный backup как мы захотим очевидно проблема для ваших объемов данных и требуют полного сканирование всех данных для того чтобы оптимизировать этот процесс нужна какая-то кооперация со стороны сервера поэтому у нас есть некоторые функции есть прикол на сервере реализованный которые позволяют этот процесс создание к ментально выкопав значительно ускорить один из них называется и на тебе трек чинишь patches при включении этой опции персона сервер начинает сохранять bitmap всех измененных страниц в отдельных файлах соответствий преклонных тропиков может использовать эти пятна файлы для определения всех изменил на странице с некоторого момента времени без полного сканирования всех данных в некоторых случаях это может драматически ускорить время создания игры ментального backup а и похожая функциональность называется логар кальвин если вот включительно тебе опцию на тебе la cour кайф в единичку то энтеббе начинает дублировать ряду лог в отдельных файлах как наверно знаете ряду локона тебе имеет кольцевую структуру то есть он со временем перезаписывается что делает его непригодным для инкрементальный бэкапов до что делать если у нас уже тот хвост который соответствовал последнему полному бог аполлон уже перезаписан у нас нет полной полной истории всех изменений на начиная с момента прошлого backup а вот чтобы это избежать эта опция вот дублирует все записи в ряды лог но она никогда не перезаписывает эти файлы они они запись про тогда один лог-файл набирает полный размер сдается новый файл и так далее экстернат поддерживает инкрементальные бэкапы с активированными лагами но я бы сказал что это функциональность и и нужно протестировать в некоторых случаях она может привести к наоборот к большему времени создания к ментального backup а здесь нужно тестировать до вопрос который нам часто задают пользователи я рассказал один из самых часто задаваемых вопросов это как вот проверить что с бэкапом все в порядке да как проверить целостность бекапа и при всей кажущейся простоте вопросы какого-то простого ответа на него не существует почему потому что но это традиционные методы проверки целостности по типа проверки контрольных сумм они в данном случае не будут работать например что есть у нас какая-то таблица по каким то причинам вообще не попала в бокал да мы печатаем контрольные суммы контрольные суммы все будут там сойдутся но то что нас таблица вообще никакой нет мы не заметим список файлов тоже не гарантирует проблем тоже не гони гарантирован корректность потому что собственно не мы не можем проверить целостность и на данных да и традиционно проблема проверки целостности решается сравнением да но здесь нам сравнивать ни с чем на самом деле потому что допустим у нас есть backup которая является копией данные в некий момент времени t 0 когда мы решаем когда мы хотим проверить целостность этого backup а это будет уже новый момент времени t1 которым к моменту к этому моменту нас уже мог быть какие-то обновления в базе данных у нас есть некая старая версия данных и новое текущая для того чтобы проверить целостность бекапа сделано в момент времени t 0 нам нужно было бы откатиться назад во времени но москве а пока не поддерживает такую такого режима поэтому сравнивать нам не с чем у нас сзади заведомо разные копии данных одно элегантное решение довольно мне оно понравилось и было предложено пользователям и мы даже включили его в свою документацию она не не идеально смысле него тоже есть свои недостатки но по крайней мере она дает гарантированный ответ на их вопрос давайте скажем что у нас backup это некий слои который возможно дома стал от мастера а текущей сервер это собственно мастер да тогда задачу проверки целостности backup а мы смотрим задачи проверки целостности репликации эта проблема очень решена в частности утилита 5-тый мальчик сам из пакета перка на tool kit делает это довольно таки удобным образом и старается делать это так чтобы не нарушать как можно меньше нарушать работу самого сервера в общем она эта утилита проверяет считаю контрольные суммы на мастере и наследие следит за тех за следить за тем чтобы за достижением того момента когда своих догонит мастер если в этот момент контрольной суммы сошлись значит репликацию нас целостно и значит исходный backup у нас был целостный там иначе репликация просто не сошлась и в заключение хотелось бы сказать про облачные технологии какие же webscale бекапы без облаков кто поддерживает настоящий момент бэкапы в облака во первых это моя складом майдан перспектива сторонней утилиты которые используются для загрузки любых типов данных в облака например из 3 синди mysql and backup поддерживает бэкапы в облака начиная с версии 310 2 и здесь мы немножко стали питона extra bed or 23 поддерживает клал backup а но пока только варькой по версии f23 пока существует в альфа-версии какие именно облачные хранилища поддерживаются mysql и ндп sbk поддерживает что на в настоящий момент amazon s3 что они в планах я не знаю они нас не информируют но протоны из трубы кадры могу сказать что на данный момент мы поддерживаем openstack свифт и в планах у нас поддержка и монастырей естественно amazon ли еще мне кажется очень перспективная вещь именно для бэкапов поскольку ну это если кто не знает о такой интерфейс практически ленточные хранилища в облаке то там там нет случайного ввода-вывода можно взять большой объект положить его целиком в amazingly я тонул взять целиком и еще того что у нас нет куб случайного ввода-вывода он не представляет просто таких интерфейсов потому что они хранят или либо на лентах эти данные реально либо на есть там блю-рей дисках это все очень дешево но это практически то что очень подходит под бэкапы мы собираемся реализовать поддержку миссию тоже и google глава сторож тоже в планах вот как выглядит создание удачных бэкапов альфа версии питона x3 backup мы используем функциональность потокового бэкапов экстер backup который генерит поток это поток можно перенаправить в отдельную утилиту и косби клауд которые можно передать в сочи параметры например тип хранилище пока что поддерживается свифт имя контейнера юзер пароль там url можно загружать параллельно в несколько потоков для большей скорости почему поддержка бэкапов реализовано отдельной утилитой ну такого подхода есть несколько преимуществ в частности можно взять уже готовый backup который был создан не вне в облака сохранил на локальном диске и положить его в в облачные облачные хранилища если бы мы реализовали поддержку типом строили эту поддержку в самых 3d cad то можно было бы пока 5 либо либо локально на локальный файл систему либо в облака здесь у нас есть некая гибкость восстановление золото выкопала выглядит тоже довольно просто мы используем утилиту испекла для того чтобы скачать наш backup из облачного хранилища на выходе мы получаем поток формате extreme который можно распаковать с помощью одноименной утилиты и подготовка бокал . восстановление из него выглядит как обычно в данном случае мы работаем просто с локальными данными которые мы уже вытащили из облака с криминальными выкопаем есть одна тонкость что обычно для того чтобы значит создать инкрементальный backup мы указываем директорию полного или предыдущего backup а это нужно для того чтобы экстра backup автоматически прочитал л с н все что ему нужно от директории прошлого или по прошлого века по этой власти назначения да но в случае с выкатными волках предыдущий диктует предыдущий пока просто не доступен лежите там в облаке и чтобы вы скачать нужным возможно потрати большое время но для этого у нас уже есть готовый опция когда называется x-trail с эндер можно указать такого параметр в экстре бэкап и все что он сделает он создаст обычный cloud backup создаст обычный backup в облака но при этом lsn текущего elsen значение соответствующего навыка по сохранится в отдельные директории на локальном диске который потом можно будет использовать на того чтобы создать инкрементальный backup основываясь на данном sm без скачивание полного бекапа из из облака посмотрите из мобильного приложения вопрос да коментировать стоит ли заморачиваться с бэкапом с быковым с использованием lipslide готовые инструменты я никогда не работал с ним slave я зная примерно представляешь что это такое это понимаю что в качестве готового решения caught коробочного она явно не подходит да все что она делает это коннектится к мастера и скачивает берлоге но можно для кого-то организации point in time recovery то можно использовать и нам нужно еще суд на копию базовых данных получить я не знаю поддерживает ли это летсплеев мне кажется что нет то есть идея как бы для какого-то инструмента может быть хорошая но это никак не готова и коробочное решение скажи пожалуйста можно ли экстра backup он перетащить базу с одного сервера на другой где никогда не было да поймите виду без хранения на локальном диске да сразу послать наполнена устранением на втором сервере и никогда не было то есть там другой набор баз ну да это канонически собственно способ мы делаем backup можно хранить в локальной а потом как-то там скопировать на удаленный хост мы можем сразу сделать потоковый backup стримим бэкап и отправить его сразу на удаленный хост там распаковать и получим просто копию данных но как не запущен на христе a dose базы a b c на хвосте без базы dc и вот базу а на перенести на второй хвост можно а виду сделать некий импорт да мне прервать какую-то отдельную группу таблицу в базе это можно сделать not back at она делает только экспорт таблицы она подготавливает таблицы так что или бы что бы их можно было импортировать потом на стороне сервера импорт на стороне сервера он не автоматизирован нельзя просто 2-я что импортировать все таблицы которого то этой базе можно по по отдельности там есть alter table дискард его спасает от того импорт тейлз общем это все можно автоматизировать на видеть кантинг ряска нет часто задаю этот вопрос нет наверное нужно тоже что-то создать но в любом случае нужно делать на стороне сервера не на странице пока спасибо алексей но вопрос нужно доклад продолжая вопрос вот предыдущего коллеги я так понимаю что все эти схемы бэкапов они достаточно тяжело работают с последующим восстановлением допустим для бэкапа и восстановления таблицы на дбв как над которыми поднятой constraint и вот восстановление особенно на другой сервер с другим пообщаться с другими внутренними адэшника my пространство имен и на дыбы могут быть большие проблемы нет эта проблема решена этот как раз то что мы решили в консерве начиная с 51 это что оракул решил моя спел 56 можно импортировать таблицу с совершенно другим и они в котором нет таблицу с идентификаторами портировать можно но в случае если есть constraint он не даст это вопрос так сделать а какой constraint ну скажем так корреляции между таблицами обозначены в явном виде да но если вы импортируете новую таблицу по определению не может быть никаких инструментов нет никто не может ссылаться уточняю у нас была база данных в ней была группа таблиц константами с реляций ами они побились вот они пробились нам их надо установить из бы к бою вот эту опцию френки checks в ноль и не пробыли установить это запрещает проверки все на фоне кекс not от 0 до 6 варианты разные в форт recovery а сет сет фарин кич x равно 0 это то что делает мой скил дан пример когда он импортирует а же он генерит файл для импорта до другого можем импортировать на сервер здесь какие-то инструменты он эти форин кичик запрещает на время импорта потом решают обратно я думаю что должно теоретически работать с случае с импортом из экстра ducato ну понятно общем в любом случае надо работать руками кроме всего-то коробочного решение которое позволяет слить и на дыбы и установить обратно ну просто нет да и вообще говоря это довольно часто запрашивая функциональность и дома нам нужно обратить внимание на это это хорошая вещь спасибо за не забили это здравствуйте если у вас в планах интеграция с каким-либо централизованной системы резервного копирования там собака командой зад mondo из такой продукт еще а мы интегрированное мы когда-то спрашивает а если кого-нибудь графический интерфейс для x 3 bk мы говорим у нас есть сторонние решение которое земан они полны что они рождаются симон да да у них есть графическая обертка 0 xor backup которая показывает что у вас там столько бэкапов вот там прогресс какой то есть или что вроде окей спасибо большое них есть платная и бесплатная версия это так здрасте снова спасибо за еще один интересный доклад подскажите у меня так два вопроса первый по поводу целостности бака по проверке ну по-моему самый простой способ это аккаунт записи количество записей по сохраненным и меня всегда удивляло почему вы на гибель никто не догадался сделать счетчик измененных данных да сколько данных конкретно в таблиц как это сделано в мае сами то есть принципе у нас каунт таблицы и на геби всегда занимал очень много времени хотя это можно было бы записать служебную таблицу и брать оттуда сразу барометром разрешает уже обсуждали вот на на стенде это вопрос с кем то уже было про счетчик записей но ответ мульти version ность вы на себе на самом деле у вас есть несколько версий данных до каждая транзакция может видеть свою версию поэтому единого ответа на вопрос а сколько у нас записи в таблице просто не существует ну точнее вот в общем случае они существуют а есть и транзакции завершенные считать елена да но это можно но что делать с теми транзак сами которые в прогрессе и если она говорит покажем несколько сейчас записи в таблице мы должны читать тот за ту запись которого служат на таблицы или считать в явном виде не очень понятно это любом случае будет показывать некое приблизительное значение в большинстве случаев ясно и подскажите пожалуйста вот второй вопрос вы сказали по поводу карт из измененных страниц насколько я понимаю это можно сказать просто card in the fda указатель на сохраняем на страницу который у нас изменились и это буквально bitmap это последний из чисел который поставляется набор из нулей и единиц если нужно читать соответсвующий страница не изменилось извините не значит получается адрес страницы и faq измена такой формат начать мы пишем блоками в каждом блоке и заголовок который указывает space айди начальный ну скажем так диапазон страниц которыми в этом блоке описываем из офиса потом идет bitmap который говорит что 0 это значит страница не изменилось в этом диапазоне единиц значит изменилась и вот на такой набор блоков и мы пишем его файлы в которых гриме время файлов ключевым гсн поэтому мы можем потому сервера спросить покажи мне список всех измененных страниц начиная с такого тела сян сян сян просто прошлого бы карпа и он можно доказать без сканов всего всех данных это не сильно замедляет получаешь мой при записи в память до изменяя допустим в памяти пишем сразу еще и на диск да но мы в любом случае на тебе пишут что и на диск есть ряду лог да фактически вот эти вот bitmap и это некая компактная форма представления ряду logo просто предлоги больше информации предлоги мы говорим что мы изменяем такую страницу нам нужно ставил такую запись этапа а в честь выдает файлы с bitmap ими у нас просто идет единичка мы изменили эту страницу поскольку то последовательно запись и довольно компактная но бенчмарков у меня нет каких-то чисел на руках у меня нет но я не думаю что я очень удивлюсь если там должно пять процентов заметил производительность хорошо спасибо большое алексей спасибо за доклад подскажите вот за счет чего целостность данных обеспечивается когда происходит backup то есть вот вас была такая схема где бакра плоти за счет чего там данные консистентную будут то есть данные не блокируются как мы обеспечиваем целостность и на тебе данных параллельно с копированием собственный бит данных наверное нужно не с этого было начать не просто тяжело начинается целостности несбе таблиц обеспечит за счет того что он в параллель с копированием собственно файлов и на земле мы копируем мы делаем копию ряду лог соответственно потом когда мы прикладываем эту копию сделаны во время backup а мы получаем консистентную версию и на тебе таблицы на момент окончания backup она давно перестали копировать традиционный лук также за целостность и на тебе таблиц а все остальные изменения вне транзакционные таблицы которые могли бы нарушить целостность мы просто блокируем с помощью backup log off спасибо до этого не были реализован скажите я правильно понял то что если мы устанавливаем на чистый сервер то есть где там нет не гей баста это довольно просто проходит без каких-то проблем да это просто вопрос копирование всех файлов базы и мы поэтому вот физически backup используется в тех случаях это нужно установить всю базу целиком в разы гораздо быстрее чем логический backup тех случаях это нам нужно установить cut отдельную таблицу то тут уже возможны варианты если совсем небольшая таблица то просит сделать логический backup или восстановить логического пока по поэтому эти ну в большинстве случаев фейсбук например сделает то же самое у них есть все backup остаются дважды логическая копия физическая копия и потом зависит от того что вы на самом деле нужно установить они решают откуда они будут устанавливаться притон при этом при всем redundancy это всегда неплохо некая избыточность не помешает"
}