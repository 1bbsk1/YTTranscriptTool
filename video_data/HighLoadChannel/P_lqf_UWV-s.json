{
  "video_id": "P_lqf_UWV-s",
  "channel": "HighLoadChannel",
  "title": "Основные кейсы использования in-memory СУБД на примере Тарантула / Денис Аникин (Mail.Ru Group)",
  "views": 2787,
  "duration": 2925,
  "published": "2017-05-14T22:53:06-07:00",
  "text": "то есть если вот так вот очень кратко сказать про тарантул то это такая очень очень быстрая система управления базами данных внутри которой есть еще сервер приложений кратко наверное одной строчкой про тарантул вот а почему собственно тарантул для чего его использовать и когда он хорош нужно смотреть на конкретный кейс и чтобы не абстрактная прям вот конкретно и вот собственно я об этом и хотел сегодня рассказать если совсем кратко про тарантул то смысле как чуть чуть длиннее чем одна строчка на первый он быстрый то есть быстро во всех смыслах слова имеется виду что он обеспечивает очень маленькую light он все это время между вопросом и ответом на запрос и при этом он обеспечивает очень большую пропускную способность то есть это количество транзакций в секунду которые он готов исполнить при этом он экономной то же во всех местах это слово то все очень экономно использовать все ресурсы там и процессор и память команда тарантула реально очень сильно замороченная на оптимизации вот то есть там как как один из примеров 4 байт ные числа внутри тарантула они кого хранятся в таком специальном формате что по сути это число может может занимать от одного байта до четырех байт то есть если например это число меньше чем 256 она весит всего один байт но это один из примеров то есть там там экономия приманок на каждом такте процессора на каждом бите она просто всегда и везде и пронизана всем вот поэтому в итоге получается что тарантул способен работать на минимальном количестве железа то есть на минимальном на минимальной конфигурации и на минимальных на минимальном количестве серверов он универсальный то все можно запускать там как и на серверах так и на ноуте девайсах я продолжу расскажу чуть чуть позже вот но и он сам был очень простой то есть опять же он разрабатывался с прицелом на простоту например эксплуатации чтобы реально можно было быстро развернуть бы тара запустить собственно мы сегодня это демонстрировали вот те кто ходил на митап и в переговорки для для митапов мы это в принципе все что годна показывали плюсом простой но вообще-то каско для повседневной эксплуатации то есть для админов то есть там нет каких-то регулярных то специальных процедур там типа вакуум или сути поэтому он он просто его поставил он просто работает сам по себе без без всякого вмешательства вот теперь давайте пойдем по порядку я сгруппировал кейсы в несколько групп вот их тут 9 вот сейчас я очень кратко расскажу про каждую группу вот а потом я пройдусь просто покажут по каждой группе кейсов отдельно вот первая группа это для быстрого will happen такое слово как в цепи вы не раз слышали кто это слово услышал поднимите руку круто вот теперь это онлайн transaction processing это по сути такой паттерн нагрузки который характерен для веб-интерфейса когда пользователь чего-то хочет в онлайне там типа жмет кнопку там или и не или заполняет данной формуле что ты еще делаешь ему нужно моментально ответить вот тарантул он как раз для этого кейс очень хорошо применим также применим для лап ulab это это по сути аналитика аналитика что такое это когда нужно загримировать большое количество информации и на основании этого сделать какой-то вывод вот так вот для онлайн аналитики смысле решений которые нужно принимать в онлайне тарантул тоже очень хорош тоже потом про это расскажу конкретные кейсы вот но экономии денег я про этажом выше сказал то есть он способен работать на минимальном количестве оборудования сосны если это важно да то если там условно говоря вам в каком-то из ваших проектах кажется что это слишком дорого слишком много серверов то обратите внимание на тарантул он поможет сэкономить устроение зоопарков тоже очень интересная штука наверное почти все мы с ними встречались вот кто из вас понимает о чем о чем речь зоопарк вот это самом деле не тот зоопарк животные вот это зоопарк когда очень много много разных технологию например там не знаю основная база данных хранится в mais quel и к ней конечно memcache и значит еще один конечно родись и потому что моим конечно мне всю имеет но при этом он быстрее редиса где-нибудь там еще сбоку monbebe и кассандра в общем много много технологий которые каждый год нужно в итоге получается зоопарк тарантул во многих случаях позволяет просто весь как бы зоопарк поменять на один тарантул кэширование тоже это такой кейс который в принципе родной для таро папаша тарантул он вышел по сути можно сказать из из моим каша to set a cash которого приделали возможности президент нова хранения изначально вот он работает быстрее при этом чем memcache даже когда ассистента хранить данные и его можно просто заменять нам в кэш именно drop in то есть он полностью поддерживает его протокол про эту тоже будет позже сервер приложений внутри су бды и вот все что связано со при конечно с сервером тоже она даёт некое удобства в каких-то случаях когда внутри сбт можно разрабатывать прямо на по сути там хранимые процедуры они же программы нога ритмическом языке упрощение хвататься про это тоже говорил вот и путин тоже про это я скажу самом конце этот наш такой интересный кейс который мы только недавно обнаружили the cat's тарантул можно использовать на на интернету сфинкс устройствах ну что понеслась начинаем с онлайн transaction processing я тут в принципе приведу 44 кейса вот то есть которые написаны на экране они все характеризуются тем что это практически рилтайм то есть раза акции в реальном времени лейтон все одна миллисекунда и меньше пустая способна сотни тысяч запросов в секунду вот это все характерно для всех этих кейсов но при раке эту систему сессия и все картинки очень простые поэтому должно быть я думаю мужчине очень все понятно то есть пользователь идет веб-интерфейс веб-интерфейсе он клад окликнет веб интерфейс пользователя авторизовать отрезает начну он должен проявить его куку с это как он должен сходить куда-то в суде быстро проверить быстро сказать да нет еще обновить время cookies то эта транзакция ответственную например на портале mail.ru mail.ru у нас происходит порядка одного миллиона вот этих транзакций в секунду суммарно везде это все обрабатываете несколько серверов тарантулом несколько я имею ввиду их там четыре или что-то около того и при причем это не майн фрейм и естественно обычной commodity серверов supermicro там условно за 2000 долларов каждый на самом деле в качестве сессию он справится не только в mail.ru это такое очень-очень на частое применение тарантула следующий пленение тоже очень часто эта система очередей по сути при системной очередь это как набитым пью только она надежная и быстрая вот ну и пластеризуется еще то есть она мог где применяется и в mail.ru и за пределами тоже обратите на это внимание если вам нужно очереди вот посмотрите на тарантул опять же это его как бы нового родная стихия потому что очередь это транзакции нужно записать потому что считать каждое обращение к очередь это изменение чьего-либо изменение состояния которое должно перечисляться на диске поселиться быстро вот с чем-то рад вы прекрасно справляется следующая система она уникальная только для mail.ru это push-уведомление но возможно она применен где-то еще по сути если у вас есть мобильные приложения который генерит кучу наверняка не а ноги не with a server сайт генерит кучу ивентов то есть куча push-уведомлений который нужно доставлять на мобильные устройства то тарантул и как очередь и как система хранения токенов опять же очень хорошо в это вписывается и еще такой интересный кейс это роутинг запросов опять же на больших проектах он это очень частая проблема тогда у вас есть какая то база данных бы клиент файлохранилище неважно что которое раз шарди равана по нескольким серверам там не знаю по десяткам или по сотням и вам нужно например по айди пользователь или по имени пользователя понять куда идти собственно тарантул это так очень элегантное решение этой системы в л я я помню что я в своей личной практики дает использовал mais quel думаю скрип был медленно это походило сделать хип таблицы a hip таблице они не пирсе стиле в общем там была огромная головная боль и наперёд находилась и смазку или загружать в память uber каждого сервера локально в кого-нибудь демон полностью таблицу sharding а потом и обновлять вот имея в арсенале тарантул можно просто на каждый хит вот в эти бренды сначала идти в тарантул потом смотреть куда идти в какой backend мир таким образом обрабатывается ну все запросы на почту mail.ru то есть почта mail у пользователя не лежат на разлив на большом количестве там четырех тысячах серверов и чтобы понять наку ящик сходить на каждый там хит веб-интерфейс на доставка письма на каждое каждое обращение мы идем в тарантул с этой нагрузка справляется один сервер всего но есть мастер и реплика только для фото вера вот теперь olap это аналитиком в принципе это все что касается таких песенка нужно в онлайн быстро проанализирует много много данных опять же на примере mail.ru показываю например система онлайн-рекламы вот на портале mail.ru показывается реклама на каждой страничке чтобы показать рекламу можно нужно понять какую рекламу показать и чтобы это понять нужно обработать большое количество стоит несколько источников как-то там выбрать данные по торс агрегировать и в итоге вот ну нужно очень быстро принять решение о том что показать и это должно занимать там ну буквально там несколько миллисекунд чтобы чтобы странички пользователей не тормозили вот это все обрабатывается на кластере тарантул тут уже не один как будто нато целый класс это же там огромное количество аналитики соответственно следующая штука это антиспам в принципе это система принятия решений к нужно там как-то класс терези ровать классифицировать понять там спам от имени спам и вот это все тоже делается на основе таран плох основном на аналитике который как бы запускается вот поверх этого кластер а вот еще такой хороша ли эта фича разбери свой ящик у нас почему то есть такая фича она автоматом предлагает пользователю представьте вы заходите в почту и вам говорят что нам кажется что вас ящик захламлен и мы мы вам предлагаем вот эти письма положить в эту папку эти в эту-то всем прям автоматом предлагает все разобрать там рассылки тома соц сетей там куча разных категорий и выкопать дальше смотрите и если вы с этим согласны вы жмете ok и оно все автоматом туда разбирается так вот можно в онлайне определить стоящих пользователей захламлен вот apple тоже очень быстро потому что это онлайн тоже опять же делается через тарантул то есть я буду при эту фичу надо бы хотел вот тоже тут заострить особое внимание часто бывает что от вас менеджеры просит что то сделать там продуктовый магазин какой то вот какой то фича какой-то там не знаю какой то что руку и вы и выбираете что это сделать невозможно потому что там нужно столько перелопатить данных что там она будет работать не в онлайне а часами вот мы нажали вам верят и эту фичу просто не делайте да а когда вы что-то не делаете что в принципе надо то вы теряете конкурентные преимущества вот имея в арсенале тарантул возможно класс фич который можно сделать он ну существенно расширится как это случилось в почте mail.ru анти брутфорса все что касается анти это тоже про тарантул то есть там анти брутфорс и anti-fraud 90 стены система принятия решений в онлайне тип этот пользователь хороший или плохой например пароль грудь от или не бросит там условно нужно быстро понять когда вводили такой же пароль откуда где и вот что я такое то эта часть атаки или это хороший пользователь просто вводят он честно свой пароль вот это про систему принять решение вот про экономии денег тут есть 33 был ручных кейса по сути везде смысл один какой-то большую систему там из большого количества различных ну как бы зубы д-да то есть из большое количество серверов с этими супы д заменили там на парочку тарантулов вот но система профилей я про это уже рассказывал на холоде и наплевав на предыдущем там огромный парк из mais quel просто заменили там на несколько тарантулов то профиля всех пользователей mail.ru оффлайн сообщение mail.ru агента это знаете когда поле 1 поле пишут другому а тот пользователь в оффлайне the safe не нужно где-то сохранить что потом ему доставить вот соответственно кстати они тоже интересный факт что в старой системе они занимали там порядка двух терабайт суммарно автором то ли всего 500 гигабайт вот по сути это все влезло на два сервера оффлайн сообщения систему токенов для сборщиков почты это смотрите какая штука вот у почту всех там у mail.ru яндекс gmail всех есть такая фича она называется сборщик почты это когда вы настраиваете по сути себе почтовый клиент внутри вашего почтового ящика который собирает почту с другого ящика чтобы все почки читали в одном месте вот и посылка сейчас модно это дефекации делать через а уж чтобы не хранить локально пароля чтобы вы знаете когда вы всплывает такое окошко там его спрашивать вы доверяете этому сервису или нет его чтобы это все делалось нужно хранить токены такие специальные токи нужно постоянно обновлять потому что сложная логика и по сути это много-много транзакций в секунду при каждом сборе почты собственно вот это тоже было сделано на tarantul вот теперь про зоопарк опять же я и я не утверждаю что что так везде но такое бывает часто если у вас такого нет это круто и общем то есть как я рад за вас но у нас такое иногда бывает и когда мы анализируем а зачем нам вот эта система вот то и вот это почему их так много то оказывается потому что вот а это слишком медленная а это ненадежная и вот тарантул тут в вожди случаев спасает из по сути он позволяет все это просто убрать целиком заменить на один тарантулы никакого зоопарка не я честно там проще диплом проще и администрирования там меньше головной боли меньше геморроя опять же вот этот обращу тоже тоже внимание что часто бывает что вот этот зоопарк он растёт постепенно там добавили тут тут сбоку memcache там коуч bass там кассандру а потом где-то какой-то мент ну как бы появляются проблемы и вот я как сказать ну рекомендую что нужно вот сюда думать вот добавляю новую систему вот новый какой-нибудь особо долю новую систему хранения может уже подумать они взяли вот суммарно старую там и новую систему заменить какой-то одной вдруг это можно а чем меньше систем тем всегда проще тем кстати более согласованные данные пока данные хранятся в разных системах там они и друг в друга плохо реплицируется не согласуются там и так далее много много с этим проблем теперь кэширование вполне понятный кейстут просто трата может вызвать как memcache но почему нельзя просто использовать memcache но можно но у него есть там несколько проблем он не надежный если он падает то все теряется вот у него нету репликации как известно по сути он не очень быстрый то есть тарантул он работает быстрее мы например у себя в мы в mail.ru даже вот настолько популярен тарантул в качестве моим кэша что когда мы ставим task на админов защита пить memcache они считают просто тарантул как бы человек который просит а может быть даже про это и не знает потому что ее полностью интерфейс моим кэша и когда в тот момент когда то пусть допустим изначально там не нужно ни репликации ничего там плевать зато нет когда нам нужно или когда нужно чтобы данные не потерялись чтобы из конечно диск это просто конфетами включается в транс и все обман каши уже кому поздно уже нужно как то как то переделывать слегка инфраструктуру следующая штука которая есть в таранто ли это сервер сервер приложений внутри субд м то есть можно логику разрабатывать прямо внутри субд и можно интегрироваться с другими субботы прямо изнутри тарантула логика внутри судьбе часто бывает как вот приходит пользователи на веб страничку и делает несколько запросов на вере как делать один запрос покажи мне там что-то список писем а ваш код который работает на веб франция он ходит в субботу несколько раз ходит несколько раз потому что или свободы не умеет исполнять логику и ли она это делает слишком медленно мы все прекрасно знаем что чем мог бы сказать чем мы больше всего унесем из угодить им проще потому что когда в суды могут родится внутри процесса во времени то нам нужно и в какой-то момент шарди а шарди чтобы да это всегда страшно и неприятно в этом лучше чтобы она была простой и легкой и отсюда получается что такой вот но даже парадокс даже таких собак этом как mais quel и или паскаль с у которых есть хранимой процедуры они по сути на продакшене в онлайне не используются ну вот по крайне мере на наши кейсах потому что если это делать во первых медленно а во-вторых она потребляет процессорное время нужно шар дить и все вытекающие отсюда последствия вот так вот тарантула можно не бояться можно прямо в нём писать как бы логика при достаточно толстую логику прям вот там толстый applications можно не писать на языке про гомеле который у него есть внутри кучи запросов которые идут вверх фронта просто заменяется на один вызов хранимые процедуры все исполняет как внутри б.д. и следующая вещь которая тоже есть tarantul и вот в плане вот именно языка проверены что он очень хорошо дружат с другими sbd то есть например если это логика логика который нужно нужно выполнить она затрагивает несколько других баз например там тот же после смазкой oracle что угодно или другие из вас это раттата выйти базы можно хранить можно ходить прямо изнутри тарантулу и важно это не аффекте ты его производительность то есть условно во все тормоза вот этих вот наружных бас они никак не затормаживают сам тарантул потому что внутри асинхронный он построен на фейдерах и соответственно как бы внешней системы не тормозили он от этого не замедляется и старался может даже ходить в лес и перед из даже какие-то ну более как высокоуровневые системы и он тоже опять же с этим с этим хорошо справляется не замедляя ничего микро сервис и вот мы тоже по это все не рассказывали нам этапе суть не кассиру состоит в том что когда вы хотите какой-то сделать фичу но вы просто делаете маленький сервис у типа там http и сервис который полностью независимо от всего другого у него он там где-то хранить данные где-то обрабатывает логику вот такой маленький компактный отдельно deep ловится и не связан больше больше ни с чем вот но проблемами cry сервиса в том что все равно даже для микро сервиса нужна какая-то инфраструктуру там нужно все равно когда-нибудь веб-прокси там типа engine x или х прокси нужен как минимум апликэйшен сервер не знает может apache там или джанга или что-то что-то в этом роде нужно особо нужен кэш потому что свобода медленное и нужно даже даже иногда прокси перед собой д потому что су б.д. можно фолз толеран сеть как-то то есть нужно если там мастер лег ходить на реплику или шарден какой-то делать служит делать какой-то прокси между apple кришну между apple конечно сервера массу б.д. получается такая пить известная на самом деле архитектура вот который нужно там но для каждого микро сервис огородить конечно не кресте лесу можно суммарно пихать там на одни и те же сервера но тоже нужно следить чтобы один микро-микро сервис там перник невилл есть процессоры не убил все остальное тарантул в данном случае он что говорит давайте мы уберем три уровня из пяти и оставим только два по сути engine x и тарантул engineers будет прокси будет еда the bass прокси тоже то есть то что в нем есть модуль специальный модуль тарантул который позволяет шортить и реплицировать прямо внутрь engine.exe при этом вся аппликация логика может быть написано внутри тарантула ну а вот и и при этом еще модуль engine икса он автоматом ну а ну-ка бы функцию la преобразовывает в рис 3 то есть таким образом получается что вы просто пишите прям ваш бизнес логику 11 раз там было горя ну ложки вот она автоматически rest api зиру и ца индексом и of магическим кабы вокруг этого оборачивается микро-микро сервис уже спал спал толеранс а мы уже с шарден гам мы сегодня это демонстрировали тоже на нам этапе она все делается быстро и просто и самогону что у вас не болит голова как бороться с высокой нагрузкой потому что об этом уже подумали как бы за вас там и тарантул engine x они все нагрузку тянут там одна машина и того и того и другого справляется но фактически любой нагрузкой вас можно ставить по две машины там для fall толеранс а и пихает на них микро сервиса там в любом количестве примерно это и написано что что два самых обычных сервера там опять же ними фреймы ничего там такого там просто вот обычные supermicro там с одним процессором они посмотрите он почти любую нагрузку вот плюс плюс еще минимизируется время выхода в продакшен естественно да потому что мы как я уже выше сказал вы не боретесь холст или ransom я тоже за вас все все решено вы вы не оборачивать его что т.п. да вы не боретесь шарден грамм все уже есть ваша задача просто написать бизнес-логику все дальше на работает следующая тема покажу как как происходит в таранд или некоторые эксплуатационные процедуры которые нам нашим админом очень нравится самый первый то что нет вообще никаких полярных процедур он работает просто сам по себе но это не самое интересное самый интересный идет дальше например в backup вот у меня к вам вопрос вот как сделать backup у горячий базы данных можно ли просто взять всей файлике и скопировать если строение которых позволяет это сделать вот так вот тарантул он настолько просто устроен что у него бэкап с мастера это это просто команда scp то есть по сути команды scp можно прямо на горячем tarantul и скопировать все его файлы на отдельную машину и он там подымется почему так происходит потому что тарантул хранит данные следующим образом у него есть насчет это снимок состоянии базы данных на какой то момент времени в прошлом который который не меняется есть лог транзакции и это все изменения после этого снимка который только дописывается в конец таким образом когда происходит копирование команда scp то копируется snapshot который не меняется и он такой же есть них и копируется transaction log который в процессе выполнения scp конечно меняется на просто он обрезается на какую-то транзакции таким образом получается очень просто якобы система бэкапов без всяких сложных инструментов и она главное понятно вот там там понятен прогресс там и так далее это все понятно что происходит самое интересное штурма также происходит и реплика 11 в 1 ну в трантон есть и of the tool за которая позволяет ему сказать мне вам сказать что вот там мастер пожалуйста поднимись на как бы обновить полностью с него но даже и без этого опять же командой scp просто поднимается реплика прямо прямо с горячего мастера и backup это состояние база данных на какой то момент времени вот вас будет состояние на какой-то времени то что порезанное она просто не зачтется следующая интересная штука это опять же перенос сервера на сервер поднимаем реплику говорим реплики что мастер там ждем пока реплика догонят и делаю реплику масти все опять же все это делается просто там или через команду scp или или или просто автоматом прямо из своего тарантула без всяких сторонних тузов но и опять же там простая и понятная структура хранения то есть иногда бывает что когда база данных там не дай бог там бьется из-за проблем с диском или или или за чего то еще то админ начинают разбираться а что же там в ней лежит и вот там много-много файликов и никто не знает кто файле какой файлик за что отвечает и как вот из этого дела собрать обратно базу данных утратил такой проблемы нет опять же по сути два файла но два набора файлов там snapshot лоб лоб поверх snapshot а все причем самое интересное что благодаря такой системе можно в принципе откатывать транзакции если они вам не понравились вплоть до тла менту как бы до которого у вас есть логе это тоже тоже тоже и на будет важна потому что она бывает что из-за багов в программе просто появятся те транзакции которые не нужны их нужно откатить вот но и последняя такая очень кратко такая такая кратко вишенка на тортике вот это то что вот недавно выяснили что throttle может работать и на интернет и и на ауте девайсов ауте девайсы от на эти такие маленькие девайсы тонн в мир на платформе intel edison которые там работают как как как датчики или там как еще что то там для для умного дома там для автоматизации там какого-то оффлайн бизнеса вот и тарантул можно применять и и на этих устройствах тоже потому что но опять же все все все благодаря тому что он там супер эффективно супер оптимальный малояз памяти мало есть процессоры да вы может работать на маломощных устройствах работает там эффективную при этом летом можно использовать и как apple конечно сервере как базу данных и пульсировать между этими устройствами все что я хотел сегодня рассказать такая иллюстрация до что в принципе татум расставить на на и от устройства ставить в облако и реплицировать во все стороны благодаря мастер мастер репликации иметь полную полностью синхронную систему вообще везде в заключении да то есть очень важно понять что то что тарантулы это не серебряные пули вот он это просто инструмент для своих задач для каких именно я сегодня рассказал в основном еще раз я повторюсь это все задачи связаны с онлайн и песка нужно что-то online high load a real-time что все работало быстро вот в этих случаях я обязательно рекомендую посмотреть на тарантул скажите пожалуйста в реальной жизни в описанных вами кейсах требующих сложенной или сравнительно сложной логики типа подбора интернет-рекламы объявления рекламного либо спам фильтры и так далее и тому подобное у вас эта логика но внутри тарантула или же он используется как хранилища просто это зависит от то есть у нас во первых частично есть старые версии тарантулы там 1 и 5 там самые-самые ранние там я был еще не совершенен вот и вот в таких тепло их у нас он пишется просто просто просто поверх вот но во всех новых дипломах там держала быстрый то есть это человек ну по сути с 1 и 6 мы все стараемся писать писать ну а вот все такие вещи мысль мы стараемся туда уносить но тут есть одно но мы всегда стараемся делать так что было меньше шарден га то есть по сути скажем так если от мы мы не ставим на один сервер больше чем 256 гигабайт памяти и если этой памяти для работы the round ого хватает вот но при этом он упирается в циpкa там и зала или зачеты еще тогда мы это все вносим наружу это лучше чем шарли потому что всегда лучше page or die ну как не пожали всегда проще балансить логику без состояния чем шарик базу данных поэтому тут кабы находим такой баланс грубо говоря пока вот еще раз с этим объемом памяти она сервис все запросы стол стоит 100 и количество этих который мы в нее внесли мы там и так оставляем пустой все ритмы его но синусита мы это делаем не прям так а мы как-то вот заранее например этом оцениваем да расскажите о недостатках главный недостаток у тарантула и пусковых 2 то есть первое это то что у него нету иску или все еще то есть там по сути вся логика пишется ну а вот и скорость скоро будет он в процессе но пока его нет это создает следующую проблему что трудно перенести legacy код это раз а два трудно иногда понять что у него хранится потому что нужно на пса легко это может быть простую но функцию ну а но понятно что для админов проще написать там какой-нибудь трехэтажный сквозь запросто как быстренько чтобы что-то вам понять и вот и продать его по реплики или как то еще вот этого как бы не хватает мы это понимаем причем и сквере он нужен не только для такого но еще и для онлайна тоже мы его делаем следующее его минус это то что он один из тарантула он не использует все ядра процессора он использует максимум 3 ядра но обычно 2 одно ядро для транзакций процессинга и второе ядро для сети поэтому по сути тарантул даже в пределах одной машине нужно шарди тоже как за пределами одной машины это не создает каких-то больших проблем потому что он даже на одном ядре способен делать столько транзакции что все равно в машину не ставишь только памяти сколько нужно чтобы создать такую нагрузку но тем ни менее как как минимум для чтения нужно уметь проверить как транзакции на разные ядра это это тоже то о чем мы работаем но это это тоже его недостаток 2 такие самые основные больше пока ничего в голову нырну не приходит на может там более более искать обычно пользователи они больше видят чем там разработчики но и на хотя мы сами пользователи у нас только уже к нему привыкли что может может мы чего-то не видим что видите вы спасибо спасибо спасибо за доклад на самом деле большую часть моего вопроса только что задали но мне все-таки очень хочется спросить если вы вот вы как одно из существенных преимуществ рассказали что он очень легко интегрируется с другими базами данных поскольку вы же его разрабатывали значит потребность раз вы это сделали и сделали так хорошо то есть потребность в этом была достаточно большая почему если все базы данных можно заменить на тарантул судя по вашим словам ну во первых там нет иску или то есть мы не можем старые заменить на но пересекались есть какой-то проект или там продукт бетонное скального кода мы не можем заменить его утрату нужно все переписать вот мы не хотим все переписывать мы хотим сделать искали tarantul часто бывает что например там одно за другое цепляется есть судьбы деками и скверные и она кем-то используется теперь нужно из нее реплицировать данный в тарантулы или наоборот и сторон тула в неё потому что какой-то новый код он использует тарантул старый еще es que el средства чтобы и волки сыты и овцы целы это все на самом деле это все проблемы интеграции это все проблему что тарантул не является дроп им replacement для любой су б.д. причем если мы говорим про mail.ru у нас очень мало хранимых процедур там нам о искали и на пол и ситом обычно просто es que el операторы и этому подержав и скрыли можно это делать все заменить то примере секрет про другие компании в сбербанке у банков у них oracle oracle pl sql и пыль с культом просто фигачит прямо код программный и там даже часто не es que el а просто там up in курсор for пошел то в цикле потом еще в цикле и вот такие вещи их дропы нам уже вообще никак не заменить вот и поэтому с ними нужно интегрироваться уметь как-то так спасибо за доклад и у меня вопрос по поводу лап вот если мы допустим используем какой-нибудь и мастерской то у нас там ну средства для работы это опустим powerpivot или сейчас вот power bi ой а вот если мы говорим о tarantul что мы можем использовать именно для пользователей хороший вопрос сейчас несчастную тему активно думаем но смотрите по идее у любого bio инструмента есть внутри какая-то база там субд e или смотри какой какая-то интеграции с произвольной судьбы д то есть то есть он или сам хранит и строит все она люка в графике из того что хранит пеленку датами входить и собственно поскольку тарантула есть lotus как язык программирования его можно интегрировать в принципе с любыми но там инструменты тут только просто просто вопрос цены был в асадаль круто если вы рассказали нам может как бы не не прямо сейчас в кулуарах какой у вас конкретный инструмент как он хранит данные и куда он имеет их угрожать или откуда он умеет их забирать вода простая более более как это смогу объяснить вам спасибо вы в начале сессии говорили что тарантул устраняет зоопарке ну как бы у вас наверно достаточно просто устранить зоопарке то есть у вас есть запрос мы хотим на мы использовали вот этот вот продукт для того ты для того-то хотим его заменить тарантулом ну допустим вот представим что то я хочу приехать на запад на тарантулу страницу зоопарк и там есть какой-то успеть что мне делать писать вам фичи request и лишь записать всего на lua или как как мне из этого ходить положении вы можете написать в любом вот из этих контактов not вернее вот сюда можно email написать а сюда можно сообщение просто писать facebook вот и мы просто поможем и подскажем что он сделал или нужно посмотреть на вашу архитектуру даже если хотите подойдите ко мне после этого доклада в кулуарах мы посмотрим на вашу архитектуру и подскажем как как как он взглянул в эти и если есть зоопарк новые скроенных решению то они все обычно такие типы ки и ким ольга подобные не достаточно легко переносить потому что вся логика на не внутри этого зоопарка а где-то снаружи вот если это что такое es que el на его сложно это уже будет сложнее нужно смотреть пусто в каждого в каждом в каждом конкретном случае как я искал по нашему опыту уйти из зоопарка новой скурили проще чем уйти зоопарка иску или или пыли просто сыску или вы мельком упомянули про кластеризацию можете пояснить что это такое как она работает то есть я могу поставить много тарантулов и размазать одинаковые данные там например юзеров может ли работать индекс там скажем по одному полю по второму варите пока по сути это consistent fashion and который написан на lua извне тарантула удобства тот самый модуль engine x и по сути нас коран так у вас нету транзакций между шарден в пределах шарда есть транзакции между шагами у вас на загсы нет мы мы сейчас работаем над автоматическим решение чтобы все получите пуки опа когда вот именно так и пока но по сути опять же на наших кейсах большинстве случаев sharing или не нужен потому что и так 11 справляется или sharding происходит на теле как это вот в таргете таргет этой системы рекламы там настолько много разнообразных источников данных что там эти данные они на как бы они естественным образом шарится там вот как-то и сейчас говорите про систему профилей там или пользователей то он например все профилей всех всего mail.ru сообщение допустим пользовательские какие-то личные то есть их не шортить невозможно понять они не поместятся да и не нужны этого памяти но надо понять сколько они весят вот то есть это там они положим не влезут на одну машинка это кстати один из следующих вопросов и говорить про экономию денег если они не влезут на одну машину то мы рекомендуем поставить лента раунд 1 тарантул для роутинга и вот скажи как делаем мы один тайтл там мастер или пока хорошо 2 для для роутинга и отдельные там или the rout или какие угодно бэг-энда где хранятся эти сообщения но это понятно но тогда можно только индексировать сортировать только по одному из параметра до пустота понять из вашего вашу конкретную задачу что вы хотите и по поводу экономии вы говорите что экономия они не бывает ли ну то есть могу ли и по поводу зоопарков если мне надо хранить логия же не буду хранить в tarantul нет ну лаги лаги можно в нем в целом toughness дисковый движок но у него есть и мы были движок и дисками там логе но я бы этого не делал потому что ну это и так как жилось просто к примеру блоге действий пользователя и такие штуки у нас у нас для логов они пользовать памяти на самом деле логе депозит или можно там крайне потому что лопасти палитре это такая штука которую нужно там условно по эти пользователи достать сразу все вот-вот если паттерн обращение такой-то то можно если паттерн обращение какая-то сложная аналитика вот по разным пользователям с пересечениями и это реально там не знаю сотни терабайт или петабайты то это конечно лучше ходу пони таранто то все зависит от паттерна понятно а вы говорите реплика поднимается то есть мы подключили реплику и она поднимается во сколько потоков она работает карамзин она все упирается просто уму скуля есть например такая проблема что если большая база данных и туда постоянно добавляются данные то она не может ее просто реплицировать ним в один поток не будет усваивать и со скоростью кантилима тропу для тут и со скоростью сити нет даже не со скоростью сети сети но именно сама когда база подымает она работает там одна поставочные вас понял знаете когда вот-вот все говорят правду поточность я просто сюда напоминаю что просто я вот я вот как бы сам таскать еще начал программировать в том когда лет двадцать назад туда процессоры были очень слабые и концы предстали очень оптимально и вот если просто вот уйти к истокам там к серверу то можно вспомнить что 1 ядро процессора способны исполнять 1 миллиард операций в секунду 1 миллиард одно всего ядро а теперь подумайте сколько у вас транзак секунду происходит и вот сколько в этот миллиард можно уложить нет когда мы сравним с мускулами что такая задача встало все таки в кэш такая смотрите такую проблему утра ушло нет мускуле он после тарантул реплицирует не знаю в десятке если не в сотню раз быстрее usb здесь только вопрос количества highload это наверное не просто количество там больше меньше а именно на сколько он там может выполнять операцию за один времени или это будет зависеть от размера данных ну то есть по сути здесь можно сказать что тарантула то там в десять раз быстрее но проблемы все те же остались смотрите вот он узком так он реплицируется то же скоростью что и выполняя транзакции даже быстрее поэтому ну условно от вас идет поток транзакций и репликацию поскольку он реплицирует быстрее то понятном спасибо можно резать дополнение к этому вопросу майской этот проблем возникает из-за того что на мастере все вот эти транзакции они ну они идут несколько потоков по факту на сливе в 1 то есть когда у losing his life используется маску или auf тарантул я так поняла все равно 11 поток литра акций поэтому проблемы такой не возникает именно поэтому такой проблема просто нет не совсем смотрите сейчас я объясню вот попробуйте загрузить мускул синтетикой то какой-нибудь фермер с 30 двумя ядрами но хорошо еще воздаст вам несколько десятков тысяч транзакций в секунду о смысле select of вот есть там по несколько сотен на ядро от роду дает у нас прям есть тест открытый выложен в open source я писал сам его лично прям могу дать ссылку вы можете нам на амазоне на одноядерном компьютере поднять тарантул вон там выдаст миллион транзакций в секунду вот с прямо прямо в интернете вот эти когда он работает на одном ядре в 30 раз быстрее чем мои сколь это 32 ядра кедров то тут как бы уже вопрос не в том что одно ядро а в том что он настолько быстрый что трудно даже представить такую нагрузку что она вообще принципе будет на на сайт google она в в google.com приходится в секунду 60000 всего запросов это самое высокое причем сайт в мире да понятно она внутри там создает много много разных транзакций может быть там миллионы в секунду может быть 10 миллионов в секунду но тут вот 1 ядро тянет но порядок вот примерно там какого угла и не я не верю что можно там весь гугл сделать ноги древ просто по количеству транзакции что просто было понятно она где-то вот такой цвет и трель это огромная цифра вот и поэтому проблемы тут не в этом и в дополнении к этому когда вы тарантулы ардити в пределах одной машины на несколько я тир у вас и реплики там шарится поэтому реплики тоже применяются каждое с отдельным но каждой в отдельном потоке и ответим на ваш вопрос небольшой вопрос уже пока скажем так стороны администратора того вы сказали что у вас допустим используется а у файл который при бэкапе копируйте ну там такой-то тот момент а ну а если конь допустим обвязка для определения вот конечно момент на которые у нас завершился backup но тут унций то есть какие-то внешние или эти это когда вы файл копируйте вы запускаете тарантул и вы можете утром спросить найти последний транзакцию просто не узнают и можете понять где этот раз акции было там тоже есть вы можете понять где вы реально остановились и на какую транзакций у вас есть баков более того вы можете имея там обрывки оригинального сервера с которого вы делали backup когда он уже умер какие-то куски там остались вы можете реально понять а что было после этого бэкапы и докатить туда спасибо за так вот хотела спросить какие механизмы существуют для индексирования то есть если во первых какие-то bunchy с тем него слышал рублей утром то есть два типа индексов это дерево и хэш вы когда строки таблицы вы сами определяете тип индекса если вас нету последовательного перебора данных по возрасту индексы произойти hash hash он ну понятно быстрее дереву потому что он работает за от единицы дерево оно работает за от логарифму им там собственно и собственная реализация дерево то все это не std map это прямо к своей реализации которая быстрее процентов на 30 наверное вот стандартных деревьев до от отличие тарантула от oracal условно вода в том что поскольку он in memory изначально хотели сейчас есть и дисковый движок он пошел от мэмри и он изначально сильно заточен на оптимизацию по циpкa и по память oracle такою никогда не было бы заточен на оптимизацию под и опции вот потому что узкое место был диск так вот когда у вас данные нужно обрабатывать в онлайне и вам их приходится все кэшировать они во-первых ворог ли весит там три раза больше условно и работают все это там сто раз медленнее потому что там in-memory структуры на над ними там так особо сильно не думали а сейчас уже поздно сейчас оракал mais quel позгалев это огромный монстр условно мы например были бы рады взять их выпускали сына пример не знаю и внедрить в него там такой же быстрый там и memory движок это было боковое счастье для всех и все были бы рады но это сделает уже невозможно то 40 лет сумма иска или и прочих свободы от опыта быстро сделали правда то что люди умные проекты открыты вот поэтому собственно раунд лодка бы отдельно до слегка так так все красиво вот но самому пустим там над тем что там после сам врагом там много лет работают до они парадигм отругает корпоративная другая противно другая они работают над фичами они работают например после себя они работают над тем что полностью скопировать про или скрыли за руку чтобы заменять oracle вот потому что импортозамещение ну например вот у них там много много разных есть фишек fitch там там джейсон скайпе там и прочее да то есть тарантулы он изначально он шел не не по пути фич пути именно вот чтобы работать быстро чистка бы и сейчас у потихоньку идет и по пути fitch тоже будешь одеваться никого там и скрыть всем нужен вот этот фокус изначально на скорость как вот объяснить вот вот вот вот например одна из мер у нас есть такая такой специальный инструмент который позволяет сравнивать проводить быстрый нагрузочный тест для каждого коммита вот каждый камень делается и автомата проводится тест если где-то какой-то график приседает там или или наоборот не в ту сторону это повод для расследования вот то есть тут реально люди в команде тарантула очень сильно на это заточены на подозрительность на минимальной memory footprint но чтобы все было быстро а то есть это это я бы сказал это не какие-то алгоритмы там супер там не знаю бы ну как бы изобретены новые это просто оптимизация но банально пишут о о от n до но от н а а н а а н у рознь она может быть там в тысячи раз медь либо же там тысячи раз что-то копируется понимаете индекса конечно добрый вечер не нужно всем меня зовут деннис деннис спасибо за доклад себя приведите пожалуйста пример замены например mais quel а тарантулом не останавливая сервис какой-то делаете принципе есть 10 что общий механизм как это делать сначала мы настраиваем репликацию из моих крыльев тарантул да вот умея делать когда он там все загоняется мы переключаем там на тарантул ну если краска туда спасибо спасибо спасибо большое"
}