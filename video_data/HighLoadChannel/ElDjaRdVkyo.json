{
  "video_id": "ElDjaRdVkyo",
  "channel": "HighLoadChannel",
  "title": "PostgreSQL 11 и далее: обзор новинок и тенденций / Иван Панченко (Postgres Professional)",
  "views": 1907,
  "duration": 2975,
  "published": "2019-05-15T04:26:31-07:00",
  "text": "добрый день сегодня расскажу про что новые в подписи под руси постоянно появляется каждый год выходит новая версия мы уже привыкли вот вот сейчас 2018 версия подвеса в нём выходит 11 таки можем положиться встает на 7 номеров и неизвестно догонит когда-нибудь или нет вот пока что догнать не планирует 11 под газ вышел практически в срок практически без задержки это говорит о том что сообщество научилась работать сейчас быстрее и качественнее чем несколько лет назад вот но с другой стороны общий принцип развития по адреса не изменился ровно такая же процедура действует с коммент тестами с review сама политика не меняется она особенно в чем-то она хороша помнишь очень консервативен каких-то радикальных изменений в нем не появляется благодаря этому он имеет приличное качество с другой стороны каких-то больших резких изменений в каждой следующей версии тоже ожидать не приходится люди вносят изменения по кусочкам если вы хотите внести в позже скажу что-нибудь большое новое то тогда вам придется распилить это нам несколько частей каждый из которых имеет какую-то ценность для пользователей например например примерно хорошим было логическая репликация который уже перевели все кант квадранте несколько лет назад сколько лет 5 назад и и сделали год назад она попала наконец phoneless это в урезанном виде вот они планировали и больше туда воткнуть своих разработок по логические репликации но мы так и не знаем довершат ли они свой план до конца потому что рассчитанным был значительно лет на 5 6 вот но они уже подходит концом итак давайте посмотрим чем же хорош подлез 11 но если не хорош по крайней мере чем он интересен значит я буду рассказывать конечно не обо всем что там есть поскольку у нас хай лодка конференция они хиппи девелопер то будем рассказывать о снова про то что влияет на производительность там работу в условиях большой нагрузке в общем все что обычно называется хай-лоу да но не прошу я буду рассказывать одинаковой степени подробности ну что буду рассказывать то что самому приходилось пробовать итак начнем с параллелизма некоторое время назад под гости появилась возможность это было два года назад появилась возможность исполнять запросы параллельно это означает что некоторый запрос может быть разделен на параллельно исполняемая части и от основного процесса который исполняет данный запрос все наверное знают что в конкурсе одна сессия это один процесс бэкенда от этого процесса от значит от него отрастают от отдельное процессу worker и которая обмениваясь с ним информацией получают задание издаваемые результаты начинают эти части запросы исполнять вначале параллелизм относился только косякам последствий уж к нам к секунд к нам самым простым видом запросов в прошлом году в десятой версии он распространился на яндекс сканы сейчас появилась тоже много нового в параллелизме значит чего уже можно использовать на практике вот и даже что-то из этого не просто интересно реально полезно даже для файловых вот ну вот здесь есть несколько ссылочек который потом когда эта презентация будет куда-нибудь выложена можно будет посмотреть вот я все время смотрю на sql workbench . нет я не стал его скриншоте потому что он здоровенный вот на это такая таблица которой сравниваются все собой д по фича и вот надо сказать что фокусника то время был не на самом первом месте в этой таблице а сейчас он на первом месте по количеству слов радостных слов из трех букв найти какое-то слово это слово из вот пользуюсь и больше всего fitch которая есть у каких либо баз данных можно порадоваться этому вот неё есть действительно практически все значит и их юлит packard написал это и весной новый документ хороший pdf на такое превью всех основных фич 11 версии вот можно посмотреть там куча всяких хороших примеров есть вот по ссылочке которая тут презентации есть можно будет его посмотреть вот дальше идет на хабре статей к нашей компании с обзором этих фич ну и конечно самая главная вещь которую мы сделали для 11 позже с это перевод документации 11 версии он вышел пару недель назад и он вот по этой ссылке доступен очень удобно считать если будете присылать замечания мы будем вам за это благодарна если будете пришивать много замечаний по делу то тогда подарим билет на прыжок он в точка ру так и так параллелизм а самое главное с моей точки зрения для хай-лоу до что появилось предмета параллельно создание яндекса яндекс и по большим таблицам нога долго создается случается так что вы до выхода выходов рот не можете использовать полностью мощь своей машины потому что самое главное индекс который вы ждете который все клиенты ваши ждут делается в один поток медленно вот сейчас до этого что-то появилось об этом давно мечтали и вот наконец bad речные индексы можно создавать параллельно вот интересно общее отношение к параллелизма в холодной транзакционный среде как правило под хай-лоу дом понимают all the пышную среду для базы данных когда есть много маленьких запросе как исполняемых одновременно и количество сессия как правило превышает количество циpкa ну или там количество условных каких-то там магических виртуальных сессий превышает количество циpкa как и тут вам уже не до параллелизма в этом смысл действительно параллельно и select и там и секунд сканы это всё не для хай-лоу да это для долго исполняющих запросов вот и даже параметры в конфигурации которой влияют на то когда исполняется запрос они зависят от стоимости этого запроса дешевые простые запросы подвеса не пытается исполнить параллельно это для длинного вот но в таком классическом простом файлов для длинных запросов могу разве что вот может быть create index вот и поэтому для нас только зрения холода это самая главная фича значит что про него известно сейчас он распространяется только на b3 но понятно что это первый шаг ищется доброволец который сделает это для других типов индекса в первую очередь для джинна конечно вот значит сделать это питер гей gun и еще кто-то которую я ж не знаю как произнести правильно это имя вот но в общем суть по всему этаж google summer of code человек значит есть некоторые параметры которые управляют количеством worker of и памятью которая на это дело выделяется есть специальные параметры которые называются made in sour cream про этот параметр все подгрести ст и знают но вот есть еще макс провел мейта нас workers это как раз то самое максимальное количество worker of которыми можно делать этот индекс реальное количество worker of будет меньше и если что вам может быть придется раз растолковывать фон лесу сколько же именно worker of вы хотите на этот задача напустить вот потому что под газ это не операционной системы как следует ресурс он пока еще не научился количества маркеров вы можете указать явно непосредственно для таблицы которые вы индексируются есть такой параметр alter ты был можете сказать сэт параллель acquires и это этот параметр имеет наибольший вес по сравнению со всем остальным если вы не укажете позже будет угадывать автоматически сколько вам и гадать вот важно особенно что если вы создаете индекс конкурент ли то только на часть создания индекса на первый проход распространяется параллельность последний проход все равно будет делаться в один поток вот вещь полезное попробовали в прозе помогло насколько она помогает вот здесь есть тоже ссылочка на статью из сайбер т.к. где ханс-юрген чайник написал про свои тесты вот значит я здесь показываю эту картинку существенно больше этой картинке там посылки вы не найдете но любопытные могут сходить но здесь примерно виден масштаб насколько помогает есть законом дала который мешает любому параллелизм у очень сильно ускорять в карете ваши в процесс и все его суть в том что сколько бы вы не раздавали в параллельные процессы все равно у вас остается какая-то не парализуем а я часть синхронизация на про между этими процессами это синхронизация отнимает время и чем больше вы раздаете тем больше доля времени каждого отдельного процесса каждый отдельно потока уходит на синхронизацию и соответственно уже добавление перестает что-либо приносить вот это наблюдается сплошь и рядом везде даже в метро там например на турникетах везде возникает узкие места которые мешают параллелизма ну вот здесь вот видно что например переход от двухъядерных четырем у него очень мало что дал вот эти вот столбцы которые здесь нарисованы значки расскажу потому что не видно наверное чего первый столбец это одно ядро у него индекс делался 1000 секунд какой-то эталона для него вот на двух ядрах yandex не удивился шестьсот шестьдесят секунд мы видим что даже уже не совсем в два раза почти 4 ядра пятьсот тридцать четыре секунды то есть между двумя и четырьмя уже совсем чуть-чуть разница вот потом попробовал это улучшить и добавил туда work мимо менты нас work мимо побольше подкинул за счет этого еще до 448 секунд снизился результате 4 ядра по следу с одним он ускорился в примерно два раза вот потом он еще попытался улучшить улучшить значит увеличив интервал между чекпоинтами но это дало ему еще 10 процентов примерно вот а потом он взял и понял что индексный ключи у него плохого типа он numeric у по но merrick устроил индекса решил дает по строя индекс поинту и в два раза сократил время построении индекса о чем это говорит конечно параллелизм это хорошо все эти новомодная высокотехнологичная штуки это хорошо но старая добрая оптимизация архитектуры вашего приложения выбор правильных типов данных может гораздо больше про это много пишут потому что тема действительно такая затратная полезно огород вот значит но вот документация здесь есть ссылочка и статья из депеша тоже он там какие-то эксперименты проделал следующая вещь правильности хэш join тоже из серии параллелизма помогает довольно заметно ускорить некоторые запросы но вот здесь есть там типичный запросик на join 2 куплен таблицы из индекса там нет то это будет сэр джон соответственно в здесь вот на картинке то что в квадратных скобках это появилась в 11 версии в десятой версии был параллельно секстан он был бы сделан раз параллельно несколько процессов но все что под ним вот этот вот построение сша и секс ткань из которой строится она бы делалось уже не параллельно раз под параллель параллельным каким-то узлом есть у вас не параллельно узлы это значит что они исполняются на каждом процессоре то есть картинка раньше была такая вот как слева то есть по внутренняя таблицы пассажирском делал собой три раза три раза строился бы хэш и потом уже параллельно все это уже занялась сканируя по таблице ой там сканирование было бы раз параллельно три узла и каждый об свой хэш проделал бы этот join это в десятой версии ну вот там уж монро из enterprise д.б. есть такой человек и вот здесь ссылка на его блог днем про это рассказывать он сделал по-другому он научился хранить-то самый хеш по которым дело со george and shared памяти и через это научился строить этот хэш тоже параллельно вот это дает нам параллельных с join вот картинка справа показывает что здесь теперь как бы все все три узла занимаются работой на каждом этапе и не про делают такой вот глупы обезьянья или как это ещё сказать не хорошую работу короче лишнего to deny проделывают каждый одно и то же не делается уже вот и здесь пролин действительно для этого случая стал хорошо работать картинка показывает как это какой эффект это дало этот картинка оттуда же из той же статьи тонуса вот видно что она выходит тоже на насыщение и вот зеленая это с параллельным хором а сенека то что было раньше видно что насыщение но выходит гораздо дальше то есть да там 7 потоков до семи озер у вас наблюдается прирост и прирост в принципе хорош то есть на 7 кадрах вы выигрываете шесть раз здесь гораздо лучше удалось утоптать вам дала чем утоптали его для crate индекса но для crate индекса суть по всему ресурсы тоже еще есть для улучшения и в12 версиям очернить получим вот дальше значит параллельный append он тут мало чего можно рассказать вот но суть в том что если вы unity теперь какие-то вещи то они могут выполняться параллельно что в этом особенно хорошо что uni junya нить можно также и fd вишня удаленная таблица вот то есть вы можете распараллеливание же свой запрос не только по разным процессором но и в принципе по разным источникам данных по разным другим серверам вот сделал это тоже человек из enterprise db этим можно пользоваться следующий пункт нашей программы джек компиляция достаточно давно люди мечтают о том что можно было бы не обходить дерево запроса исполнительным а вначале превратить его в машинный код ну или там какой-то под близки к машинному и потом исполнить его уже как есть при этом этот код оптимизировать как-нибудь подстроить под конкретные ресурсы может быть даже это была мечта человечества мечту это человечество многие разные люди занимались занимались на сказать и у нас в россии значит были ребята из института системного программирования ран который достигли очень неплохих результатов кстати даже лучше чем то что есть сейчас но они не давили то до конца можно сделать что-нибудь хорошее на до конца не довести и где-то пару лет назад или даже три года назад на европейской конференции был от них доклад 2 по достижению там они ушли далеко вперед американцев но вот далеко уйдя вперед они присели где-то на завалинке и решили отдохнуть тем временем другие люди сделали jit значит жить с помощью м далеко не многое значит компилируется всякие выражения арифметические которые запросе там встречаются что вы складываете умножаете вот и janitza раз подшивания то пола как он хранится у вас базе вот превращение его во внутреннее представление в памяти onaji титце кроме того построенный л.м. кот он может оптимизироваться есть параметры некоторых самый главный параметр так называется jets которые можете включать свои сессии jit равно он пишите сет жить равно lan и поехали вас жить будет работать может быть вот и значит касты тоже слишком дешевый запрос нет жители это невыгодно сложный запрос уже g тельцу насколько сложной вы с помощью этих параметров можете задавать можете играться значит на доку дальше но не все так просто если вы установите пакет пожгли со вы будете долго удивляться ну там не знаю мам там или чем чем вы установите пакет и об этом вот вы скажете asset джейд там он скажите джей cost 0 и будете долго удивляться почему ничего не работает то есть почему ничего не меняется верни все работать но ничего не меняется тогда вы почитаете игре нибудь не сдох а там или что то еще или нагуглить и и нагуглить и что оказывается скорее всего вашим пакеты позже скомпилирован без поддержки jetta вот почему так сделано но по многим причинам прежде всего потому что он за собой что-то тянет и тянет он за собой не так много всего лишь навсего компилятор clang и llvm как таковой причем не каждой версией скорее всего даже не той версии который вас дистрибутиве идет по умолчанию значит для того чтобы это работало нужен clang 39 л л м соответственно 39 вот наиболее популярных red hat а или debian а может быть у вас будет к вам какой-нибудь более древний версии но вы все равно найдете эти пакеты вот иприт не вам придется компилить его ручками скажите enable llvm вот и тогда если вы действительно все пакеты установили то оно соберется дальше вот вы уже сможете сказать себе джип он и тогда в explay не будет видны вот такие примерно штучки начинающихся слова джек то есть там будет большими буквами написано джек еще одно хорошее слово из трех букв вот и там будет примерно расскажи на сколько времени ушло на jit компиляцию вот там вот внизу будет написано и какие опции g то включены вот но судя по всему это будет развиваться дальше раз это уже попала в подвес то какой то толк из этого мы получим значит вот та же статья из блога компания сайтов где люди померили померили вот значит что там же запрос это запрос некоторые стихи пи аш набора тестов и to select в котором считается что-то типа сумма какого-то счет этом суммированием с умножением такие вещи вот и они получили что джек действительно дает нам заметное ускорение эти ускорения заметны с десятым пазле сам 11 позже том в полтора раза дает лучший результат это вполне вполне серьезное улучшение вот надо правда сказать что при переходе от 96 весить пример такого же улучшения добились безо всякого jetta ну сейчас наверно уже предел достигнут и бюджет и дальше никак вот но другой стороны очень может быть что резервов там есть еще больше потому что жительства сейчас сравнительно немного резерв огромный был позже sql один чего только стоит вот не говоря уже просто опускаю запросах следующий пункт нашей программы секционирования как известно позже секционирования долго делалось не прямым путем а через наследование таблицу делают это очень давно и я первый раз делается в 90 1999 году вот и с 1999 года до 2017 года ничего не менялось но 16 15 на самом деле ничего не менялось если вы хотели проецировать таблицу разбить ее на части вы должны были сделать базовую таблицу от наследовать от нее кусочки написать какие-то правила или триггера которые перенаправляли бы вставки в одну таблицу в какие-то ее партиции ну это приходилось делать руками это было неудобно самое противное то еще неэффективно поэтому пользуюсь и 9 когда был позже 95 тогда мои коллеги написали extension такой позже пасман это extension который делал то же самое но работал гораздо эффективнее при большом количестве партиций в чем фокус дело в том что при планировании запроса не всегда можно понять какую партицию попадает ваша запись и поэтому при таком вот классическом позиционирование все время обходились лишние партиции вот ну и сама планирование было неэффективно то что она не знала где что может лежать вот и для того и соответственно и локи там лишнее возникали и работа лишняя возникало и вот три года назад был анонсирован тоже пасман он был сделан он работа используем 96 использую сам 10 он используется в крупных организациях в крупнейших можно сказать финансовых организациях нашей страны даже вполне хорошая проверенная вещь вот но что позже что тоже не стояла на месте она поняла что нормально проецирование нужно наконец-то и вот 10 под гости появилась парте церовани и на что значит портирование это значит что в языке sql появились команды партий шин и парте шинтай well buy опять же много ручной работы но уже в школьном синтаксис это гораздо приятнее чем вниз куриную синтаксисе это делать вот при этом к сожалению в десятке внутри оставалось еще ровно то же самое что было до нее ну в основном вот то есть это был только синтаксический сахар чтобы подсластить жизнь разработчиков вот но напомню что пользуясь большая фича сразу не пройдет одним махом надо по кусочкам и вот этот синтаксический сахар он был первым кусочком в 11 версии уже началась реальная оптимизация так которую как когда-то делали в паз money вот ну и в двенадцатой версии он уже достигнет пасмурный пасман тогда наоборот наоборот пасман станет оберткой вокруг обычного подвеса для того чтобы клиенты которые начали его используют чтобы они не имели дискомфорту никакого вот значит что появилось секционирование на первых runtime узкий выбор портится и при джоне кросс портишь на blade это значит имеется в виду умный выбор партиции при апдейте хэш партии shining это парте цианирование возможно либо по интервалам либо плохо шум и случайно разбрасывается по partition либо по явному указанию какой партиции что-то должно лежать вот сейчас появилась похожу раньше было по интервалам значит появилась partition по умолчанию куда попадает то что не попадает ни в одной из обозначенных партиций значит появились constraint и в масштабах позиционирован и таблицы вот и что важно наверное важно для хай-лоу да да процесса нейронов таблиц можно создавать локальный индекс в принципе секционирование и hail out это тоже достаточно спорная вещь вот судя по всему секционирование holod совместимы если секционирования таблица раскладывается нас тораджи разного типа с разными скоростями когда вы делаете небольшой горячую базу на быстром стороже работайте с ней и значит какие-то старая секции держите на медленную старриджа но почему-то так делают редко но тем не менее это полезно на что еще для чего нужна секционирование сейчас из-за того что вакуум например однопоточный процесс из за того что удаление медленная операция от рынка и быстрая вам иногда хочется разбить свою таблицу на много маленьких табличек просто чтобы заботиться о них отдельно например чтобы вы могли взять и зачистить 10 процентов данных которые например устарели хорошо вы можете зачистить портится одним тонкий там но удалять дели там вы замучаетесь скорее всего вы не захотите это делать если у вас очень большая система вот то что мы с вакуум может поскольку параллельного вакуум пока нет вакуум будет большой таблицы идти долго вашей машине будет тяжело вот партиции можно в принципе делать или доводы общего водить их и живо комом вот в общем портится открывает новые возможности кроме то вы можете их откладывать даже на ftp и таким же масштабироваться но так что портится это хорошо и холодное применение они тоже имеют значит помимо таких полезных больших вещей есть еще вещи менее масштабные которая может быть даже с точки зрения хай-лоу но при не сразу очевидно например процедуры вот вот здесь и некоторые считают что фонд гости были хранимая процедура по крайней мере там есть система на каталоге таблица позже проц вот правда другие люди говорят процедуру воспользуемся нет то есть если к подагре сестру приходит арок лист и заявляет подгрести 100 что у вас после процедур нет во странная база вот он показывает ему как же вот позже проц и слова процедуры там где-то встречается велики и вот но на самом деле процедуры post это функцией и отличить их от процедур то что она выполняется в рамках одной транзакцией а процедур это то что за пределы транзакции выходят и которые сама может транзакциями управлять вот теперь по здесь эти процедуры появились спрашивается но хорошо программистом от этого стало легче они могут там что-то длинная программировать теперь до чего хай-лоу да это все окажется вот для чего вы получаете уже возможности из хранимых процедур действовать не в рамках одной транзакции то есть вы можете из храним ки теперь работает с большими объемами данных например взять и налить данные или взять и пропустить много данных ни в одну транзакцию потому что одна большая транзакций это трудно вы можете делать транзакций такого размера который вам нужен из хранимых процедур значит следующий кусочек из серии всякое разное это так называемая include индексы иногда их ещё называют покрывающим индексами но это вроде не совсем научный термин значит что это такое кредит индексу можно добавить специальный волшебное слово include о чём это говорит это говорит о том что ваш индекс попадет дополнительная информация которая не будет включена в индексный ключ но тем не менее в индекса лежать будет это нужно для того чтобы во первых для того что в большем количестве случаев вы могли использовать яндекс он риска что вам не надо было лезть в таблицу затем что не попало в яндекс во-вторых это позволяет экономить иногда количество индексов в каком случае это позволяет экономить количество индекс смотрите значит предположим что предположим что вам нужен например какой нибудь constraint по уникальности этот constraint влечет наличие индекса предположим что вам нужно искать по трем полям нужно делать индекс own risk on по трем полям вот в принципе вы могли бы на конце не требует что был яндекс по двум полям третье поле здесь будет лишним если вы хотите делать индекс can i can станет одновременно вам придется сделать два индекса один для constraint а другой для яндекс к на а здесь если вы третье поле добавите в уникальные индекса но не будет входить в уникальный ключ но тем не менее по yandex к ну вы его достанете вот здесь есть статья на хабре в котором написано как этим пользоваться интересно что это эту штуку сделано было но я думаю что года три назад года три назад одному из наших клиентов понадобилось держать чуть меньше индексов на какой-то много доработанной таблице много терабайт на таблицу для него это было сделано каждый индекс его кормить же надо не то он не только место занимает его надо еще апдейтить там и так далее вот и на большие таблицах это мешает это мы это сделали достаточно быстро но слушая что принимала долго просто не потому что вещь плохая них то что плохо сделано было просто консенсус такая штука трудно достижимо и вот ну вот анастасия lubin не кого есть такая у нас мощная разработчика после со которым ног хорошего сделала и вот это одно из одной дает достижениям значит другая вещь тоже которую сделали наши русские коллеги это transform для языков был первый пэр питон и типы данных джейсон что это такое и какое отношение к холоду иметь такое отношение что это повышает производительность значит если вы хотите работать джейсоном из процедурных языков вот таких вот топор для сам по себе не знает как джейсон как внутреннюю структуру джейсона перевести внутрь new структуру вот того во что это превратится у вас pearly ли в питоне он это делает через текст через текста и представление вот а можно сделать это напрямую и тем самым сэкономить то есть из внутреннего позже стало представления джейсона или джейсона б особенно сразу получить перловую структуру данных с кашами массивами или питонов скую вот эта функция называется transform значит в по злишься на появилась версия 96 такая возможность эти transform и создавать вот но на практике transform был сделан для редко используемых типов данных типа и штор а для джейсона его сразу не сделали и вот ребята его сделали антон быков из и на полюса и никита глухов из воронежа ему потом помог вот эта штука была сделана и за комичен а значит вот правда если вы программировали на пыл v8 вдруг есть такой язык то там это вот автоматически уже была встроена в p8 а для нормальных языков вы можете писать такие transform и для того чтобы эффективно передавать любые типы данных процедурные языки для этого достаточно написать всего 2 2 функции преобразования туда преобразование обратно и сказать crate transform вот значит другая вещь тоже полезная для хай-лоу до известно что фонду если быстро и легко можно добавить колонку но если у нее нет дефолтного значения если дефолтное значение есть ровно должно проставиться во все места где оно должно стоять теперь нет не должно теперь системном каталоге появилось место где-то дефолтное значение хранится если его просто нет то она берется оттуда и поэтому теперь колонку с не пустым дефолтом добавлять также легко как колонку с пустым дефолтом это полезная вещь дальше теперь надо подавить том что не вошло потому что это тоже любопытно стандарте скрыл 2016 года появилась поддержка джейсона стандарт понятно дело разрабатывался не сообществом подвеса компаниями всякими типа oracle microsoft и другими хорошими людьми которые конечно puzzles изучают это что делается в воздухе внимательно иногда заимствуют вот этот стандарт был сделан составлен и во многих собой д поддержка джейсона было реализовано по этому стандарту сделали это и для подвеса значит сделали это тот же самый никита глухов из воронежа и известный многим олег вартанов носи к сожалению в камне достаток стандарт sql он не предписывает специального типы данных для джейсона то есть джейсон и предлагает сохранить внутри базы неизвестно как ну например текстом вот и поэтому пришлось там немножко я бы не сказала костыли тино придумывать что-то творческое для того чтобы этот стандарт хорошо лег на полюс это было сделано этот патч был выложен на коммент фесты мы честно говоря ожидали что кто-нибудь решится его принять мы не хотели комитете вы сами несмотря на то что сейчас уже есть два русских к метро фёдор сжигает и александр коротков но хотелось чтобы какое-то одобрение сообщества прошло и чтобы какие-то совершенно независимые люди сами это за к метели но позже большой там около 100 тысяч строк и никто так и не решился 012 это позже см и это конечно пропихнем вот кому-то нужно срочно работать джейсоном то сейчас есть же сквере расширение которое была написана александром коротковым еще лет пять наверное назад она работает позволяет по индексу искать внутри джейсона очень эффективно значит части синтаксиса которой в сквере есть он такой не очень легко читаемый но части с него перешла в стандарт school 2016 но стала там еще менее легко читаемый вот но зато если человек программировал он же сквере то тогда стандарт скрыл 2016 дастся ему легко и непринужденно вот значит это большая такая разработка достаточно важная потому что это элемент стандарта и в принципе вот где должен эту штуку поддерживать поэтому скорее всего 12 под здесь она попадет другая штука интересная которая не вошла хотя ожидалось это мерз и как раз вот история о том как мертвый вошел она можно сказать драматичная драматичная история она там в кратком достаточно кратком изложении она приведена вот статья на хабре которая упоминается внизу по ссылке вот дело в том что автор этого подчас айман rex известный разработчик глава компании второй квадрант он несколько раз по-разному переписывался патч а сообщество все не принимала и не принимал а вот но при этом он сам к метро он сам может коммитить он это и делал вот он писал патч значит он пометил его потом люди другие камеры этот патч от которые говорили саймон ты не прав он что-то переделывал победил заново ему писали значит по всем каналам связи саймон то не прав но он опять комитет но что такое мертв это собственно возможно сделать insert или апдейт если десерт уже если такая запись и там уже есть да но сейчас пользуюсь это делается с помощью конструкция insert он конфликт апдейт вот то есть для этого нужно какой-то первичный ключ если сорт нарушает этот первичный ключ то тогда делаются апдейт то есть записи вот это есть давно вот но она не соответствует скал стандартам прежде всего основной недостаток она не соответствует искал стандарту оно сделано не так как в других базах то есть не так как ворог ли на примере как microsoft и поэтому тех кто занимается миграцией это все время тревожат плюс покоится там других другой синтаксис и более широкие возможности в команде мерз поэтому саймон очень хотелось она с 2003 года же стандарте позже до сих пор нет вот но проблема сделать это аккуратно потому что должно быть атомарная операция которая гарантированно ли вы ее сердце 3 бы облететь вот и надо ухитриться это сделать так чтобы лохов не слишком много возникало и за это и за то и за 3 саймона ругали очень сильно вот и сейчас саймон уже не к митр так получилось вот но как значит нам рассказали он принял это и не обиделся а вот значит ну вот некоторые отличия мер для него не требуется что был уникальный индекс в нем можно вставлять вот там еще ставку или такое для того чтобы дано из других таблиц использовать вот ну и фил это он рисует совсем по-другому и поскольку он не опирается на уникальный индекс это ведет к тому что люди делают дополнять изобретают но дополнительно типы log off вот и конечно сообщества этому сопротивляется как может вот ну вот смотрите в статье там интерес интересная история почти драма дальше вот уже некоторое время есть пар пару версий пользуюсь есть параллельные агрегаты то есть принципе очень многие вещи подписи например агрегатная функция или функция они имеют признак пригодна для прижима или нет вот если запрос хоть что-то непригодное то тогда параллельном он быть не может вот ну вот значит попытались сделать параллельную реализацию для таких агрегатов то есть string а г г это агрегат который контролирует всю строку и array а г г который сваливать все в массив полезная вещь и хочется параллели вот но пока что не получилось вот не получилось потому что это это не такие агрегаты как просто сумма да там надо сортировать порядок имеет значения и хочется многим разработчикам хочется чтобы он еще и был таким каким вам хочется они случайным а если они собираются параллельно тогда надо для этого надо как-то до сортировать поэтому вот дэвида роули этот патч он пытался его подать в 11 версии в 11 версии весной он не вошел значит летом наконец месте его еще раз прокатили и но мы все таки надеемся что он попадет потому что параллельные вот эти вот агрегаты рей а г г многие их используют хорошая вещь вот значит я уже подхожу к концу сейчас мы перейдем к вопросам и я в конце покажу два совершенного график которые были получены на прошлой неделе обеим есть некоторое количество хороших компаний вот объём это хорошая компания я не рекламирую обеим хвалю за то что они дали нам на пробу свой новейший и в empower'e 9 сервер вот поэтому они молодцы значит надо сказать что это не единственное хорошая компания hewlett-packard например тоже давал нам сервера для эксперимента вообще разработчики очень любят когда им дают до экспериментов мощная новое хорошее железо они потом хвалят тех кто вот дает значит что здесь на этих графиках что по осям значит это простейший тест который тестирует работа исключительно памяти in memory все в кэше вся база в кэше кэш прогрет значит сколько транзакций в секунду транзакций на чтение это выборка по индексу по оси x количество одновременных запросов 32 ядерная машина значит количество запросов в секунду видно что меняется начально она растет потом выходит на нас ощущение тот же самый законом дала который мы видели когда говорили о параллелизм внутри одного запроса о чем говорят нам эти графики на каждой панельки есть график для разного объема shared памяти слева после с 10 10 5 ну вот здесь видно что чем больше shared памяти в принципе тем лучше это значит что в 210 5 шарик памятью работа хорошо сделано оно реально помогает вот и достигается там максимальное значение 730 2000 транзакций в секунду до 730 2000 055 вот на полюсе одиннадцатом больше 800 тысяч семьсот двадцать четыре то есть примерно 10 процентов быстрее просто так ни за что вот но что прикольно это достигается на другому время shared памяти вот на что он здесь до 64 и 128 миг до 64 гек вот если сравнить поведение на 32 пардон на 16 гигов то тогда выигрыш будет уже не на десять процентов а на 20 процентов вот но к сожалению на большом объеме shared памяти 11 позвизд почему-то не показал хорошего результата наша что ты там наверно изменилась и возможно в 11 1 может быть это и пофиксен вот мы сейчас как раз ищем в чем там причина почему при большом объеме что-то он там насчет где-то запутывается ногами в ней но много известно много shared памяти бывает вредно вот он она тоже требует заботы но вот в одиннадцатом она значит чуть больше требуют заботы чем десятом и это интересный факт он вот нуждается в изучении на следующей неделе нам еще раз дадут этот power мы попробуем там с патчами вот и может быть что это улучшится но по крайне здесь вот видно что вы можете получить некоторый прирост даже на даже при малом объеме shared памяти прирост есть вот хорошо значит ну самый конец у меня есть еще пять минут значит о перспективах я расскажу сейчас не о том зачем сообщества работает о том о чем работает его российская часть ну конкретно использовались про вот во первых компрессия вал вал вам трафик иногда вы это очень большой например для яндекс or типа джин спогис большой овал трафик это тяжело вот можно компрессировать обобщенное компрессия потому что для любых типов данных на работает просто исходя из сравнения вал сегментов она может уменьшить вот над этим работает у нас один очень умный студент если она что у него что-то получится при вычислении stay был функций это тоже некой оптимизация здесь есть ссылочка на обсуждение списки рассылки наша сотрудница ведет там диалог с томом ллейном время от времени по поводу того как бы все таки это сделать что в это приняли вот но в одиннадцатом не приняли может быть до 12 это будет доделана на самом деле тема непростая как оказалось значит логическая репликация для двухфазного коммита до для фазных транзакций это нужно для того чтобы при п тоже проходил на реплику сейчас пока этого нет но вот это будет кастомизированные методы компрессы для разных типов данных что вы могли указывать что вот этот там например текстовое поле на его хочу скомпрессировать таким-то алгоритм с такими параметрами вот значит всякие разные оптимизации join of но вот такими танками 200 сейчас одна из них оптимизация join of связано с сокращением тогда стал джайнов когда таблица joannites а с собой же по первичному ключу вроде бы кому это нужно но вот оказывается некоторое время такие запросы генерят том числе 1с вот а подвес он простой он думает что никому не нужно и поэтому иногда делает там совсем совсем нет а вот значит есть еще несколько темизация joy на который тоже пойдут наконец вес ты скоро в целом вот на один из моих тестах там раза в полтора можно за счет этого ускорится глобальное уникальные индексы нужны для того чтобы иметь уникальные constraint и по поэтому сама по парте тонированным таблицам в том числе по таблицам процессе они равны с использованием вдв то есть разложенным на разные узлы и вот и такая новая вещь который еще мало говорили за встроенный пул коннектор но сейчас имеется прототип встроенного пула коннекта в которой лучше чем позже балансер тем что он хранит большая информация сессии то есть он это неполноценно еще коннекта то есть например если вы заведете у себя интерпретатор perl perl а то это не будет корректно работать в этом пуле вот но если вы будете например временная таблица создавать то они будут храниться вместе с вашей сессии вот поживу сером такого не дает вот но это прототип не факт что он попадет в 12 версия скорее в 13 вот но пост про 12 может быть пропади попадет уже чтобы узнать подробнее про puzzles приглашаю всех на конференцию по жекон проша которая будет феврале московском университете на экономическом факультете там же где и в прошлом году 4 по 6 февраля значит дедлайн по докладам там 5 декабря поэтому если кто хочет что нет рассказать то уже надо торопиться да как только дедлайн по докладам пройдет там стоимость билетиков тоже возрастет еще одной один повод торопиться вот спасибо вакансий у нас есть вопросы еще уникально нет уникальное нет для этого нужно глобальный индекс пожалуйста подменить в секции одну таблицу в перед ну можете значит с помощью домкрата там еще кого-то инструменты можете просто конструкции языка для этого нет но сделать это можно пожалуйста да пасмурным поддерживаем там принципе у нас мы немножко им передали дело что реализация которая делалась пасма не она существенно более костыль на чем-то реализуется которую дело сейчас она была сделана зато быстрее это как бы идей там много тех но реализована они по-другому и другими людьми наши там чуть-чуть им помогали чуть чуть чаще главное они показали пример от помощи том что показали примерно может быть там сейчас еще будет там еще вот никита глухо что-то делает для них может быть во имя там появится да такая штука есть это последний вопрос нам покажут финишному можем в кулуарах поговорить да ну просто приоритеты штуки оказалось чуть ниже поэтому ее пока еще этого но принципе и сделали мы просто я еще самое не пропихнули сообщества"
}