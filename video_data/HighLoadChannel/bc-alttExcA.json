{
  "video_id": "bc-alttExcA",
  "channel": "HighLoadChannel",
  "title": "Как не провалить импортозамещение / Евгений Лукин (СберТех)",
  "views": 2367,
  "duration": 2886,
  "published": "2023-04-28T06:10:46-07:00",
  "text": "Да всем привет слышно меня нормально смотрите Почему я вообще захотел рассказывать про вот эту тему мы внутри сбега действительно заменили свою шину данных которая у нас была вот иностранного вендора и многие компании сейчас после 24 февраля приходят к нам за каким-то опытом или пытаются даже купить наш продукт Мы в принципе готовы но когда мы с ними разговариваем Я часто вижу что А те методы которые они хотят использовать в этом импортозамещении в этом как процессе Да мне кажется они не рабочие и я не могу клиенту сказать Вы знаете Вы не правы Да вот поэтому я решил это вынести на хайлоут вот поделиться своими мыслями может быть услышать какой-то фидбэк от вас поэтому я Сначала поговорю о том Почему мне кажется их стандартные подходы не работают дальше расскажу про то как мы шли и как мне кажется что выделю какие-то моменты Почему у нас это всё-таки сработало вот Ну и дальше Я наверное расскажу с чем мы столкнулись по пути Что такое сервис-меш Ну дальше уже разберёмся а что такое импортозамещение в глазах клиента Ну сейчас многие Клиенты приходят вот у них картинка слева да у них был какой-то Oracle у них был Саб или что-то такое у них была иностранная шина данных и они хотят заменить whike to like да Они хотят заменить Oracle на какой-нибудь постга из Они хотят заменить там не знаю Саб на 1С да Или на что-то такое и найти какую-нибудь шину с российским шильдиком и кажется что вот так вот и нужно это всё делать а с моей точки зрения почему это не работает ну потому что это правда Машина времени в прошлое то есть представляете куча орака db э которые хорошо Архитекторов которые отлично знают этот продукт да для них перейти на поздно это болезненно у многих там огромный перекуэль свой Да который просто так не перепишешь То есть это мучительный болезненный процесс которым ты будешь заниматься заниматься и Через пару лет ты в лучшем случае получишь то же самое а на самом деле ты возможно получишь что-то хуже потому что ты не можешь использовать тот отличный функционал который правда есть там и в сапе и ворохле поэтому получается что вот импортозамещение не работает Ну наверное я пошел чуть раньше закончил Ну конечно это шутка Я поискал в интернете здесь может быть не очень хорошо видно на слайде это всего лишь картинка из интернета но это просто какой-то пример различных систем которые живут вот тут Как пример просто взять какой-то какие-то американские департаменты Там трежи и так далее и так далее и срок жизни этой системы и вы там можете увидеть что это 50 лет 45 лет и так далее И если Вы подумаете а хотели бы вы работать в компании где нужно поддерживать или развивать систему которая 50 лет Да написано наверное На прекрасном кобале или на чём-нибудь ещё что я даже не знаю вот Ну мне кажется Вы скажете что скорее всего не хотели бы да А и даже на этом же сайте вот картинка справа все там респонденты говорят что да мы понимаем что менять системы нужно что это даёт там дополнительный рост доходов сокращение операционных затрат и так далее и так далее То есть что-то делать нужно соответственно Как найти вот этот баланс между тем что ничего не делать и что что-то начать делать И вот тут как раз наверное стоит перейти к тому как мы прошли этот путь Ну во-первых я не знаю со многими уже общался много есть Выходцев сбера и мне все говорят а шина данных к США так это называлось у нас Бей вот возможно многие сталкивались вот наша шина выглядела вот таким вот образом то есть довольно просто э-э есть какой-то м-м потребитель данных Да он складывает там запрос в мку а мку там дальше идёт вот в какой-то там веб-сфер там уже происходит какая-то трансформация какая-то может быть интеграционная логика дальше это складывается в мку уже на стороне поставщика данных в его формате Да он вычитывает делает какую-то свою магию и также по обратным пути делает э возврата этого сообщения потребителя Всё хорошо Всё понятно и удобно а как Мы работали здесь Ну понятно что за подключение отвечает потребители поставщик да А вот за всю интеграционную логику за создание чая идеи зато какая логика будет написано за это отвечала интеграционная команда расскажу несколько этих интеграционных командных потом было все больше и больше и все это работало это было довольно надежно Вы когда заходили в какой-нибудь Сбербанк онлайн или там так далее куда-то вы все равно проходили через нашу вот эту к США то что мы называли в какой-то момент нам это активно перестало нравиться почему Ну во-первых Мы заметили существенный рост транзакции вот здесь видно данные за 2019 год мы выросли тогда на сто процентов да то есть почти в два раза и мы уже не могли держать все наши интеграции на одной вот этой вот США то есть мы до какого-то момента покупали более хендовые сервера Но дальше Всё да ты уже не можешь купить какой-то более хреновый что нам нужно было делать Мы просто начинали делать эти шины рядышком и у нас было там такая шина для финансовых операций такая для там какого-нибудь МДМ такая для чего-нибудь ещё и эти шины начинали по этим стало сложно управлять это стало ещё сложная интегрировать это первая проблема вторая проблема сейчас покажу слайд который возможно многих напугает вот нервные сразу лучше Выйдите из зала вот посмотрите на это этого ужасно То есть это задача на команду интеграции Вы видите что она занимает с точки зрения разработки всего ничего но 226 дней От начала создания до взятия этого в работу да Ну и год примерно до реализации Вот это был наш тайм-ту-маркет когда я только пришел в сбег и как раз занялся вот этим всем на меня посыпалось куча эскалаций от со всех уровней о том что возьмите мою задачу Возьмите за мою задачу буквально наверное на первой же неделе мне позвонил человек вот просто узнал мой сотовый телефон позвонил мне и сказал Вот вы знаете моя задача мой Лидер трайба пообещал гафу ГФ пообещал Путину вот если вы сейчас не возьмёте мою задачу то вы лично Евгений подводите игорефа и Отлично вот а на этом моменте я немного расстроился и стал думать что же делать я пытался ему объяснить что я как раз настраиваю различные процессы фаст-трек что если вы хотите чтобы вашу задачу взяли мы можем это сделать у нас есть паятизация сходите туда он сказал нет Вот вы сейчас подводите Вот Но я не люблю людей которые идут вне процессов такие вот я их называю обочечники Да я ему отказал Вот и переживал несколько дней Но через несколько дней Мне стали звонить другие люди и говорить что А вы подвели вот этого начальника департамента вы подвели его того вот руководителя трайба Ну я им уже всем спокойно отвечал что ребята я уже Гаев и с Путиным подвёл Ну как бы мне уже что вот Ну на самом деле это история тогда была не так смешно вот я переживал что меня уволят Вот Но это было наша реальность Да бэк Лок команд был настолько перегружен что вот это вот объективная реальность мы не могли взять Вот эту задачу Раньше Да потому что появлялись либо какие-то приоритетные Почему либо Мы выходили выходные и так далее и так далее да наращивать постоянно команды тоже невозможно и к чему мы пришли в итоге мы поняли что нас в принципе не устраивает такой архитектурный паттерн как сервисная шина то есть и мы подумали что мы хотим нового Да что нам важно первое мы хотели отсутствовать централизованного посредника То есть как технологического То есть как точку отказа до что вот ну шина все-таки Она имеет точку отказа второе как вот такого бизнесового то есть мы не хотели чтобы опять была какая-то команда или несколько выделенных которые становились бы опять бутылочными горлышками для нас было важно чтобы разработчики во всём сбей могли самостоятельно делать интеграции чтобы тайм-ту-маркет был существенно существенно ниже второй нам конечно хотелось иметь возможность горизонтального масштабирования Да чтобы нам не нужно было опять же там делать какие-то разные инстанции чтобы это было всё модно молодёжно Ну и как результат Наверное мы хотели изоляции транспо каждого свой от прикладной логики сервиса потому что мы понимали что если каждый разработчик начнет писать что-то свое связанное с интеграцией прям внутри своего кода то при любом изменении нужно будет переделывать все сервисы Но это глупо и неправильно вот Ну те кто читал описание доклада или кто уже сообразительный догадались что мы пришли к паттерну сервис Мэш Я может быть не знаю Ну насколько аудитория там хорошо знает сервис-маши или нет просто я тогда вкратце расскажу э-э В чём смысл сервис США Ну смысл основной такой что у вас есть вверху элемент который называется контрольная панель И когда вы диплоите свой сервис какой-то вы диплоите также набор яму конфигов таких файликов Да в которых вы описываете Как у вас будет происходить интеграция Какие политики по таймаутам Ну какие-то ещё вещи там а и контрольные панель - это всё подхватывает эти файлики и распространяет на все ну консервативно относится к любой доработке потому что ну естественно от всех доработок как раз все проблемы если ничего не дорабатывать то проблем не будет Ну и не разработчики Никто не хотел просыпаться ночью Да и разбираться что там за новые технологии почему она все свалила соответственно как работали Смарт топоры как-то пары То есть как только Они видели в мониторинге что идет какое-то накопление ошибок они просто обрубали эту ветку и все и вся интеграция возвращалась через нашу старую к США и все были соответственно спокойно там Потому что никакой инцидент не нужно просыпаться ночью ты потерял чуть-чуть сообщение Да но у тебя всё откатилось всё всё работает а уже с утра Давайте разбираться что там было а и вот это был наш план и всё классно да И вот тут я поставил а одну из своих любимых групп Металлику которая говорит Бойся своих желаний Возможно это всё сбудется Да это ещё пожалеешь Это мой вольный перевод а с чем мы столкнулись Ну первое то что сервис-меш это вот как вот это моя любимая сказка когда патчайцы говорили отнеси дрова там сделай это сделай это сделано и спи отдыхай потому что чтобы сделать интеграцию тебе нужно заполнить все вот эти ямки Да тебе нужно настроить много того что-то раньше как разработчик не знал Вот и когда ты это всё настроишь что действительно всё будет работать но вот пока ты это настроишь ты замучишься то есть мы выкатываем новую технологию и десятки тысяч разработчиков сбера немножко в шоке от этого и с чем можно столкнуться когда ты выкатываешь новую технологию вот с этой картинкой Где на самом деле зашито Две шутки вот ну слева шутка о том какой бывает код и если ты не изучаешь технологию Да если ты не погружаешься в документацию и не понимаешь как она работает то есть риск написать Вот такой код То есть он рабочий Да но мы все понимаем что он ужасен либо же у тебя вариант два я понимаю что справа не видно я так сделал специально Это пример реального резюме где я поменял только контактные данные да А вот это список технологий которые человек пишет что он знает поэтому у него 2 года опыта разработки вот ну то есть вы можете себе представить что если у него такой список технологий который он знает и он занимается разработкой только 2 года вопрос А когда же ты занимался бизнес-логикой То есть ты по сути всё своё имя тратя его на то чтобы погрузиться в Новую технологию И это тоже современная проблема потому что мы берём разработчиков чтобы он писал бизнес-код да но в каждой компании он сталкивается с какой-то новой технологией и требуется погружаться в неё и это проблема а вот это дальше два слайда они прям там двухлетней давности это прям из той презентации которую мы делали до которую мы прям внутри делали что у нас было вот так вот мы видели наш процесс в середине находится разработчик Ну то есть наша команда которая занимается внедрением сервис США и на нас со всех сторон идет бомбёжка писем звонков что у меня не работает а я пытаюсь настроить ваш дурацкий сервис Маша он не работает и так далее и так далее А мы кому-то успеваем отвечать кому-то не не успеваем и э-э в итоге люди Ну недовольны Да синапс - это то Как называлась наша платформа Ну и так называется синус А И вот мы видели что должно стать туби процессом то есть мы должны уйти вот от этой модели когда мы работаем всем помогаем Да но нам кажется что все вокруг идиоты не могут сами сделать и пойти к модели когда мы делаем таким образом чтобы люди были самодостаточны то есть разработчики могли всё делать сами Ну начали мы с банальных вещей понятны хорошие кук-букс примерами Как сделать интеграцию детальной документации примеры это есть у всех это понятно мы пошли дальше мы у нас есть такой Boot Camp Это где может пойти разработчик Да там есть какие-то курсы мы сделали прям курсы то есть вот прям тестовые задания ты проходишь тестовое задание учишься делать какую-то тестовую интеграцию с помощью сервиса Ну вроде как ты обучился но на самом деле дальше мы стали смотреть А как вообще работает разработчик и вот если слева менеджер Да Ну То менеджера есть жира или как мы на предыдущем докладе увидели джира есть у всех уже вот но я как менеджер смотрю в тасочки потом пишу письмо Привет какой статус по моей задаче да то как работает разработчик Ну сначала он читает архитектуру пытается понять что это вообще такое за новые технологии потом он ищет ещё какие-нибудь материалы во внутренней базе с какими-нибудь примерами потом он читает ещё какие-нибудь материалы считает сайзинг и так далее потом он все равно ничего не понимает идет смотреть какой-нибудь доклад того же хайловода где ему рассказывают а что это такое каким-нибудь более простыми словами Дальше он все-таки приступает к написанию кода и это хотя бы то что он любит наверное еще вот дальше он пытается как-то понять по всем зависимостям там все собрать чтобы у него собралось Дальше он пытается всё это замерзнуть и тут у него новый сюрпризы вот он пытается это как-то всё собрать и куда-то поставить на какой-то стенд э и тут тоже всё то есть мы видим что разработчик своей работе он а вынужден работать по куча куча разных инструментов Да какие-то внутренние базы данных э-э База знаний YouTube и так далее и так далее И вот это плохо и мы подумали А как мы можем это всё упростить И на самом деле к чему Мы пришли мы пришли к тому что мы сделали внутренней деф портал на котором разработчик Может начать э свою работу и тут есть всё то есть у него есть он может создать себе и сразу трубу если он вообще первый раз вот пытается что-то сделать на синапсе он может посчитать сайзинг тут же есть калькулятор сайзинга там есть закладочка обучение Там прям выложены видео Примеры как паям с нуля сделать какую-то интеграцию чтобы он мог посмотреть Но самое классное здесь что есть готовые схемы то есть человек сначала архитектуры напоминает что с чем он интегрирует то есть допустим он говорит Ага здесь у меня будет тест А с этой стороны у меня импушка значит мне нужен какой-нибудь тему адаптер он выбирает эту схему параметризует ее то есть указывает просто там свой проект какой контрольной панели он подключен и у него все файлики все ямы файлики которые должны быть они ему автоматом гениаятся он их диплоит и у него уже какой-то hollow-world условно Да но интеграция уже ходит то есть понятно что он если ему нужно что-то там с оптимизировать он может уже залезть внутрь Да там что-то подкорректировать но у него уже есть что-то что работает он уже на этом может развиваться и вот это существенно существенно помогло а вторая штука с которой мы столкнулись да это все отсылки к предыдущему к тому что мы хотели то есть мы хотели самодостаточности пользователей мы с ней наелись Да второе мы хотели горизонтальное масштабирование и вот оказалось что да вам дает сервис вам все это дает возможность горизонтального масштабирования но все это не совсем так по дефолту работает ну очень простая картинка Да что такое горизонтальное масштабирование Ну то есть вот у нас раньше был Какой мир что вот там жёсткий сервер какой-то прям вот мы чётко оцениваем Какой может быть пик мощности Да закупаем этот сервер Ставим на него Application большую часть времени он у нас там Возможно не даёт утилизирован Да ну вот у нас вот такой вот мир а в прекрасном мире куберется а Квеста реализация у нас соответственно вот есть кластер есть какие-то пудики которые представляют копию вашего приложения и когда вам нужно у вас может это всё растягиваться То есть у вас становится больше копии вашего приложения когда нагрузка спала становится меньше копий приложения да и все это выглядит очень здорово и кажется что вы экономите на иисусах потому что вы раньше ну как бы покупали сервера с запасом да под какой-то рост под какую-то нагрузку будущую под пике то теперь у вас вот есть кластер он же горизонтально умеет масштабироваться Да и в теории вот все звучит вот так классно но на самом деле здесь опять же кроется некие подвохи то есть смотрите во-первых как работает вот этот вот автоскелинг то есть поднятие дополнительных пот Ну он работает через Trash Hold То есть вы задаете некий уровень утилизации который если будет превышен то у вас начнут стартовать дополнительные позы и стартовать они у вас начнут скорее всего лесенкой то есть у вас начало справа вот видно стартанет одну надо дополнительная копия вашего приложения потом вторая и так далее и так далее да и всё Это здорово но это всё будет требовать времени и вот тут мы столкнулись с чем с javy конечно же основной язык разработки А в корпоративном мире этот JAVA да А у Java есть что есть GM Классная штука вот Вот оказывается что из-за этого все становится не так здорово со стартом кодов вот тут можно посмотреть на графике мы тестировали рядышком наш адаптером Q который написан на Джаве и он же написанный на Go и здесь видно что в зависимости от того сколько ресурсов там CPU памяти вы выделяете чем меньше выделяете тем медленнее у вас стартуют ваше приложение здесь видно что в самом таком печальном случае порядка 40 секунд Ну кому-то может быть 40 секунд это немного а Для нас это много Потому что если у вас пошла нагрузка то вот эти 40 секунд пока стартанёт дополнительный Путь Да вы Возможно не можете обработать эту нагрузку и будет воспользоваться или получать Ну или системы будут какие-то таймауты получать что не здорово а на голову Вы видите что независимо от того Какое количество ресурсов вы выделяете время старта у вас оно практически идентичное и довольно низкая А мы также протестировали по перформансу и тут оказалось примерно то же то же самое что мы в результате сделали ну в результате мы просто наши ключевые компоненты которые мы отдаем как часть платформы вот допустим адаптером Q мы переписали на Go за счет этого у нас стало быстрее Казалось бы решили мы проблему Ну не совсем Сейчас секунду тут немножко медленно вот вот это вот тоже печальный график Да потому что есть вот такие вот сервисы то есть смотрите нагрузки нет нет потом резкий всплеск нагрузки потом опять нагрузки нет и таких сервисов довольно много они связаны в принципе с психологией людей то есть Вот оказывается когда люди пенсионеры получают пенсию сразу же идет нагрузка там на Сбербанк онлайн они идут платить там коммунальные и так далее и так далее Также в пятницу вечером люди снимают в банкомате Деньги идут видимо Тусить в бары и нагрузка резко вырастает и вот получается что если мы будем использовать стандартные авто Скелет который поднима с Вот такими вот лесенкой да то есть один подвиг 2 3 и так далее то возможно вот такие пики мы не сможем обработать Да и мы опять же будем получать какие-то тайм-ауты что мы Для этого ну придумали Мы подумали А что если пойду угадывать эту нагрузку то есть что если нам брать исторические данные Ну у нас же такие сервисы они постоянно повторяются там из месяца в месяц примерно одинаково себя ведут соответственно можно построить некую модель машинного обучения через которую прогонять те данные которые сейчас ходят делать предсказания и поднимать заранее то количество поводов которое понадобится чтобы обработать Да и потом так же убирать количество этих поводов Вот и нам пришлось это написать для того чтобы получить Вот эту вот по имущество этой славутой а-а горизонтальные масштабируемости А тут кстати было интересно дискуссия перед этим вот кто-то мне прямо сказал что горизонтальное масштабирование не работает вот я согласился но сказал что вот можно вот так пытаться делать вторая интересная штука это про эффективность утилизации и тут конечно Я капитан очевидный что если у вас не хватает места в кластеет то никуда вы не увеличите Да своё количество кодов это логично А Но когда у вас есть кубер нейт когда у вас есть сервис mesh вы начинаете платить ресурсами за Надёжность то есть что это означает вот к примеру У вас есть два центра и какой-то балансировщик который там не знаю по Андроида но раскидывает нагрузку между ними а у вас уже вместо одного котика который нужен для обработки этого запроса Да ну потому что возможно нагрузка не такая большая Но вам уже как минимум нужно два Ну то есть в каждом суть должен быть под уже поднят Да и утилизацию его вы его тоже не делаете близко к 100% вы её делаете там где-нибудь держите на середине потому что ну вы волнуетесь что если нагрузка скаканёт Да будет подниматься новый пото Зачем вдруг мы что-то потеряем и вы начинаете уже два делать Но дальше вы начинаете думать Ну а если у меня зашел трафик в какой-то цод и вдруг там под попал на какую-то ноду которая Ну что-то с ней не так да вот что-то она там подзависла тогда все у меня запрос потеряется внутри этого цода он же не выйдет другой цвет и все И вы начинаете уже поднимать в каждом цуде по два таких повода и в итоге у вас по сути 4x запас Да а на самом деле больше потому что утилизация каждого из этих кодов невысокая То есть вы с одной стороны защитили себя с точки зрения надёжности всё классно вы молодцы но вы теперь стали тратить очень-очень много ресурсов и всегда у вас будет Вот эта вот аппетит к иску больше или меньше а когда у нас банки огромные кластера и много очень сервисов то это становится очень-очень дорого Да и что мы здесь стали делать Ну здесь Мы перешли э на такой феде-рейд супермаш вот здесь такой будет небольшой спойлер вот на предыдущем хайлоуиде и на следующем будет доклад продолжение доклада а вот как раз Максим чудновский сбера как раз будет рассказывать про этот супермаш но в общем что делать суперменш он просто берет Вот эти два разных дата-центра и как бы натягивает их как будто на один сервис-меш и вы по сути управляете как будто внутри одного сервиса вы находитесь что это означает на практике Но это означает на практике что если у вас трафик зайдет И вот тот вот тот под который находится в соде один будет почему-то недоступен да то вы в принципе спокойно смонтизируетесь на второй цод То есть у вас трафик зайдя в тот не умрёт он будет знать что вот этот сервис доступен ещё вот там-то и за счёт этого по сути вы с четырёх Да вот этих вот лишних поводов Вы по сути экономите да двух то есть два раза То есть это довольно существенно а Следующее о чём хочется сказать что а-а ну стандартного Open Source не хватает в интернете и это такой путь которым идут многие То есть вы берёте какой-то он классный нажимаете его использовать но тут у вас оказывается что здесь у меня какая-то Legacy система здесь у меня какая-то там система со своей спецификой Да и вам нужно это допиливать вам нужно что-то дорабатывать или Как пример мы взяли неплохую опенсорский Али это такой Ну такое средство визуализации вашего трафика то есть оно вам показывает как у вас трафик внутри кластера проходит такая Красивые такие строят диаграммки То есть она показывает что за синггс здесь трафик зашёл здесь вот пошёл вот так Классная штука мы её поставили на наш кластер Ну и поскольку это браузерная штука которая начала в себя подтягивать все связи которые есть на этом классе я там десятки тысяч микросервисов ну то мы получили аутов мэйма с этим да А ну что нам Пришлось сделать нам Пришлось сделать э-э доработку То есть делать оптимизацию перформанса какой-то razy лоудинг и так далее и так далее Вот это просто небольшой пример того что приходится делать когда вы начинаете работать с Open sources или О чём вы Возможно не думали это потому что сервис мышь работает классно да вон всем инвоем всем микросервисом рассылает конфигурационные файлики классно Но поскольку он рассылает всем А это десятки тысяч микросервисов да то есть соответственно такое же количество конфигурационных файлов то вы во-первых немножко начинаете подзабивать свою сеть вот этой рассылкой а во-вторых применение этого всего тоже становится не быстро а соответственно нужно писать что-то чтобы оно как-то более эффективно отправлялось до либо не все всем либо только то что нужно ну но здесь основной мысль что не нужно этого бояться потому что все это решаемо вот просто нужно быть к этому готовым и доделывать Ну и такое что у нас В итоге Получилось Да как все это в итоге выглядит Ну это такая очень грубый архитектурный эскиз Но в основном это истио сбередишен потому что это наша сборка и инвой до Сбер Edition тоже с нашей сборкой дальше у нас вот есть здесь киали и дополнительные валидаторы которые тоже вам если у вас большие кластера где работают куча команд тоже скорее всего понадобится вот плюс много ещё инструментов А дальше это отдельный свой такой синапс Ай мы его называем Синай Вот как раз тот который делает позитивный автоскейлинг да то есть поднимает заранее вот это количество поводов это как раз часть вот этого Сената также он умеет делать к локацию то есть допустим А когда это просто к власти вы хотите за диплоить свой бэконд и фронта да если они ну с точки зрения cubernots - это какие-то абсолютно разные микросервысы они у вас могут стартануть на любой ноде сетевой да А они у вас взаимодействуют друг с другом ну постоянно соответственно если они на разных сетевых нодах вот у вас трафик будет туда-сюда ходить по всей сети а здесь а этот инструмент позволяет также сделать умный квакалакейшен То есть он понимает что эти микросервисы наиболее часто взаимодействуют и может их под разместить на одной сетевой ноте соответственно у вас трафик будет Ну внутри или метеором вот а следующая важная вещь Это супермешь по которой чуть-чуть рассказал Да ну дев портал который тоже очень важен то есть который позволяет что делать который позволяет И автогенерить вот эти ямки и предоставляет адаптеры с которыми удобнее будет работать потому что опять же разработчику не нужно каждый раз писать какой-то адаптер есть прям набор стандартных адаптеров которых он к себе подтягивает и просто настраивает Вот это очень удобно Там же есть инструменты нагрузочного тестирования потому что у нас полностью концепция что разработчик должен сам уметь сделать интеграцию сам её протестировать то есть соответственно там есть Там специальный инструмент заглушками которые позволяют там загружать разные тестовые планы запускать получать отчёты а Ну и это наверное то что в итоге у нас получилось то здесь можно увидеть что за три с половиной года Да у нас рост опять же около 450 процентов вот дальше я сделал некий по Edition просто на базе предыдущих лет то есть видно что если бы мы оставались той же корпоративной шины что у нас было то мы просто не смогли бы вот это поддержать либо это было бы очень дорого и очень неэффективно А тут мы это спокойно поддерживаем на самом деле масштабироваться можем Ну практически как угодно дальше а тоже небольшие итоги здесь можно увидеть что Ну вот текущая такая средняя скажем нагрузка - это 50.000 ТПС а на самом деле в Пике она там бывает значительно выше вот а процент миграции вот со старой США 99% здесь почему не стул просто Потому что некоторые системы должны отменить до конца года Да и мы просто не пушим их на этот переход то есть они спокойно тамруют Вот и вместе с этим полностью шина вот а Ну что дальше Да То есть как мы видим дальнейшее развитие первое мы активно развиваем этот федеральный федеральный супермешь мы активно развиваем наш вот этот Синай синапс И что будет там дальше может быть мы будем делать отдельный доклад мы будем стараться делать аномалии по Edition и автохилинг то есть что это такое понятно что всех есть мониторинг мониторинг там что-то мониторит какие-то ошибки или что-то ещё но зачастую случается Так что у вас идет какой-то фон такой ну непонятный то есть какие-то немножко пакеты потерялись Да чуть-чуть утилизация почему-то Ну там потери Ну утечка памяти но вроде не критично Да что-то вроде ТПС количество то же самое А память Начала утилизироваться больше и так далее и так далее вот этот инструмент он это всё собирает и пытается Ну пойду Пойду угадать сказать вам что что-то идёт не так да и это такой первый шаг что он будет подсказывать что вот что-то возможно здесь идёт не так у нас был ну чтобы вам было понятнее у нас был такой пример что на тестовом стенде на одна команда приходила что-то У нас вот не так много что не так-то Но вот смотрите вот ретрайз работал ну все же нормально все же прошло да да а потом в итоге оказалось все умерло потому что диск просто физический сыпался Потихонечку вот и в принципе ошибок-то не было да ну то есть они как-то были Ну вроде они не ошибки потому что ретраль отработал фактически ничего не потеряно вот для того чтобы такие кейсы разрулить мы как раз это делаем дальше автохилинг - это понимать что что-то идёт не так стартовать где-то рядом эти выводить трафик автоматом на них а вот эту ноду просто изолировать Да чтобы администратор брал и начинал с ней разрабатывать Ну что-то делать Ну и третья часть этой экономии ресурсов это тоже очень важно Вот сегодня уже тоже в кулуарах обсуждали то что тот же истину сейчас идёт в прокси лес вот мы тоже в эту сторону смотрим есть несколько других решений Ну тут сейчас мы тоже не буду рассказывать это всё такое поработки Ну и выводы Да поступаем к выводам то есть первое А можно по-разному относиться к тому что сейчас происходит войти Да но если на это посмотреть вот что мы есть там где мы есть да Используйте Старайтесь Вот на это смотреть как на некую возможность потому что многие я понимаю ходят на хайлоуит Я раньше тоже ходил смотрел вступление думаю о ребят Классно да у меня вот здесь вот Legacy Блин я никогда туда не перейду то теперь на самом деле есть возможность То есть вы можете сказать смотрите давайте сделаем новую архитектуру Вот мы сейчас всё равно должны отказаться там отца от чего-то ещё Да попытаться совместить Вот эту вот задачу по импортозамещению с какой-то архитектурной которую вы давно хотели сделать Да вот это наверное был мой такой основной посыл второе - это то что Ну тут я тоже Капитан Очевидность продумайте технический план Да потому что это внедрение новые технологии не для пользователей А для других разработчиков у всех команд разные в интерфейсе просто зоопарке заранее Подумайте как вы это выкатывать третье Думайте о разработчиках вот это очень важно Я на это все время смотрю и не понимаю мы когда делаем решение b2c Да у нас там есть UX у нас там дизайнеры мы там кнопочки процессы продумываемся джеем и почему для разработчиков у нас все время здесь блин Кнопку нажми здесь что-то напиши где это узнать непонятно то есть Подумайте заранее Вы же делаете решение там для тысяч разработчиков своих компаний соответственно чем удобнее вы сделаете тем меньше они будут тратить времени на вот это вот всё вокруг и будут больше делать код а следующее Добавляйте и решаете функциональность Open Source Ну тоже тут я Капитан Очевидность Когда Вы начинаете работать с оптом соусом голову вам не будет хватать Не бойтесь добавляете расширяете а возвращаете ваши доработки в опенсорс Ну тоже хорошие лозунг тут я правда должен посыпать голову Мы планировали это сделать но как вы понимаете сейчас вот не очень это получается Ну и последнее делайте мне лучше мне кажется это очень важно Вот наверное это все что я хотел рассказать Всем большое спасибо что послушали Жень Спасибо большое Слушай очень интересно кстати вот этот момент с тем что у вас был предикшен на скейлинг Да мы где-то лет шесть назад делали тоже свой континист undigration Вот и у нас была примерно такая же задача то есть Нам нужно было скелировать Ворк ноды которые запускают задачи Да вот и сэкономить на этом чтобы не было вот этой лесенке и так далее Вот вот те же подходы ровно то же самое Это очень похоже паттерн Ребят давайте зададим ваши вопросы Я думаю их будет достаточно много Добрый день спасибо за доклад вопрос А что стоит очередью задать в джире их исполнением в год как там поменялась ситуация смотри она менялась конечно же постепенно вот ну тут два ответа то есть первое Конечно все эти задачи уехали теперь сами команды которые их создавали Но с другой стороны все команды непосредственно которые занимались разработкой Они ушли в банк то есть ну потому что нам сказали ребят смотрите Ну вы же сделали продукт Да теперь вам интеграция делать не надо давайте мы этих людей разберём в банк в нашей команды и они там будут тоже сидеть делать интеграции вот ну то есть задача если просто отвечать уехали просто к тем кто их задавал потому что они теперь сами могут это сделать И никого не ждать это сократилось это время да конечно На самом деле сокращение очень существенное Ну потому что смотрите пей тебе просто тупо не нужно ждать если вот ты как тот человек которому правда там да грефу Путину горит то ты соответственно найдешь у себя разработчика посадишь его и это не Рокет Science он сделает тебе эту интеграцию Да это будет гораздо быстрее конечно количество расстроенных путинов сократилось вот тут не могу прокомментировать Не знаю Слушай как ты засыпал смысле что ты подставил Путина плохо плохо спал вначале Вот но потом как-то успокоился Привет привет Спасибо за доклад Все интересно было вопросов несколько первый Если осталось ibmm Q в чем импортозамещение Хороший вопрос Просто я не рассказал про Все я понял Мы тоже заменяем вот и там два направления Это был Следующий вопрос как раз на что планируете Давай расскажу просто здесь я опять же сконцентрировался на сервис на самом деле в платформе нашей платформа потому что мы поддерживаем разные типы интеграции и у нас есть помимо вот хорош когда у тебя квест все-таки проходит А еще у тебя есть кейсы наверняка каких-нибудь там событийки да и у нас там есть Кафка с отдельно с флинком где ты можешь там что-то делать И вот как раз Отвечая Просто на твой вопрос мы делаем следующим образом мы сначала приходим к заказчикам в начале они сами все без нас делают если у них система готова перейти на rest то они просто тупо переходят просто не нужна они выставляют да или там уже выставлены они вызывают и все Если они говорят Не мы не можем вот ни в какую Да вот нам все равно им пушка нужна либо какая-то система которая уже свое отживает и Ну ей нужно просто там не знаю сгладить пики Да какие-то нужна импушка то у нас на это используется просто тоже свой Артемис мку известный Вот который тоже поддерживает GMS он в принципе практически безболезненно IBM Q меняется на вот так вот сейчас который на голланде он адаптирует вас http трафик в bmc Да еще один вопрос Вы сказали по поводу портала разработчика то что там генерируется ямы вот этих вот ну и прочих каких-то там куберовских сущностей для листья Почему они сделали какую-то абстракцию свою чтобы ну как бы оградить себя постоянного изменения в мире Open Source invoice там спека поменяется всё это как-то постоянно изменяется новые технологии приходят и хочется чтобы у пользователя спека конфиг дипломинг он не менялся Ну был просто хочу отсюда пойти сюда задекларировать связь ну таким-то с таким-то протоколом А вы на основании этого уже генерируете набор каких-то сущностей через внутренний оператор например куберу через какие-то ну то есть вернее так с одной стороны Мы хотим все равно остаться Ну инлайн систем потому что они тоже развиваются Возможно мы тоже что-то возьмём то есть иметь возможность все-таки быть с ними совместимыми с другой стороны мы понимаем что ну кейсов в интерфейсе очень много да если мы даём вот некий такой инструмент мы мы по сути и так делаем некую вот эту абстракцию просто Ну вот она сейчас проходит таким образом что всё равно под капотом Ну формируется вот эти вот файлики Но поскольку они отделены у тебя от бизнес-логики то если нужно что-то поменять У нас есть некий оператор Он это может поменять если это какой-то допустим масштабное изменение там по всем Да нужно где-нибудь проставить или еще что-то но мы в принципе так и делаем то есть конечно в эту сторону Мы тоже идем Ну спасибо так ребята еще вопросы Здравствуйте Евгений Спасибо за доклад хотел бы узнать каким образом вы осуществляете хранение данных которые Ну по обмену то что происходит у вас Ну смотри поскольку это вот именно сервис mash да то здесь нет персистентного хранения То есть это запрос ответ мы не прихраниваем здесь данные если у тебя прям система которая ну прям вот требует по экранирование данных то тогда мы просто будем советовать тебе использовать либо как раз ему пушку Куда ты будешь складывать это все ну либо там не знаю кавку будем тебе советую использовать есть у нас несколько Ну скажем так критических интеграций вот там допустим есть такой Swift Да но Мы все знаем от которого у нас там все то отключают то не отключают Я уже сейчас статус не знаю вот там есть как раз транзакция которая невозможно потерять Ну там есть некая такая кастомная логика где мы начинаем по их ранее куда-то Но это скажем так Это скорее не типовое и такое не продуктовый то есть здесь все это миг губернайтс мир пот то есть вот если у тебя что-то там недоступно то мы считаем что ты как поставщик должен уметь делать ретрая должен уметь обрабатывать Эти ошибки вот то есть вот тут вот так вот Мы это сделаем Вопрос немножко другой вот Ну у вас же есть кейсы когда одна система хочет посмотреть как проходил её трафик от и до и что было в пакете для того чтобы понять где проблема то есть ты имеешь в виду какой-то мониторинг и трейсинг определённая дрессировка Допустим мы не накидываете её сверху на смотри тут же ещё накладывается безопасность соответственно Ты как не хочешь хранить и смотреть наверное на все детали там запросов а-а поэтому мы наверное такое не делаем вот но трейсинг у нас конечно есть у тебя есть рейсы где ты можешь там добавлять какие-то спаны Да и потом ты можешь построить и посмотреть как у тебя проходил но какие там детали внутри Ну я боюсь что тут я могу собрать просто потому что я тут безопасности Не очень но мне кажется там не сохраняются потому что ну у нас просто такие требования Спасибо Слушай у вас жизнью у него есть встроенные инструменты трассировки всего остального Там есть трассировка все есть Да но я имею данные даже на самом деле я вот не рассказал тут может кому-то будет интересно мы сейчас как раз прорабатываем такую концепцию но тоже на базе Open Source No clite такой продукт Он что делает он может восстанавливать тебе запросы Ну то есть Просто смотрит Какие запросы проходят и восстанавливать тебе документацию и показывать диффы с оригинальной документацией Ну то есть ты допустим сервис Да и туда документацию а на самом деле она у тебя не очень актуальна так вот он находит эти диффы и как раз тебе показывают Ну вот нам чтобы это сделать мы как раз безопасностью воюем чтобы это всё было безлично все вот эти запросы чтобы там нельзя было посмотреть вот поэтому у нас тут вот с этим много ребят еще а то мне тоже вопрос есть Я хочу задать за майку Евгений Спасибо за информацию такую интересную вопрос в части утилизации вот два момента Первое это вот предсказатель вот этот вот там Синай который вот и то есть я так понимаю что если он там посчитает что в ближайшее время там потребуется ресурсы то он там нафигачит подав дополнительных Да И вот то есть это показатель утилизации они заведомо там где-то бы выше точнее ниже наоборот будут будут на всякий случай они могут и простаивать да то есть и второй момент то есть вот эти вот пороги Да он при этом тоже отслеживает если где-то требуется ресурса начинает дополнительно там поднимать там лесенкой там или как то есть и фактически Может там весь кластер так забить если кому-то Может там потребовались какие-то там произошло вот он начал жать а он лучше будет выделять выделять То есть это тоже как-то контролируется Ну вопрос хороший с моими ответа на него на самом деле даже два наверное То есть первый мы в начале не так вот просто что ты включил и он тебе сразу начал классно работать то есть все равно мы по каждому сервису сначала берем и строим эту модель обучения то что для каждого сервиса профиль будет свой предсказание будет свое соответственно мы в начале берем большой какой-то дом данных Да ну с какой-то статистикой и уже начинаем вот строить эту модель тюнить ее некоторое время плюс он работать умеет в двух режимах То есть он может работать принудительном и в рекомендательном то есть естественно сопровождение в начале очень опасается Да и он работает обычно в начале в таком рекомендательном то есть он просто говорит выводит что вот сейчас лучше бы увеличить количество поводов там не знаю двух там до пяти или памяти выделить или горизонтально вот а ну и Таити еще такой момент что мы сейчас на самом деле приходим к некому даже упрощению Потому что есть кейсы где сопровождение просто тупо он знает что вот в это время пойдет вот и там есть вообще ручной режим где ты можешь прям ну сказать что вот вот тут вот я ожидаю Да поэтому неважно что там сказала модель машинного обучения Выдели мне больше ресурсов а поражение скалирует вручную Прям просто в это время в начале они просто опасаются любой новой технологии Да потому что Ну мало ли что она сделает Поэтому в начале всегда внедрение Оно такое знаешь по ручное то есть они смотрят соотносят действительно оно так работает или нет Вот Ну и дальше уже там переключают или не переключают это уже такой принудительное же вот Понятно спасибо Вот у нас ещё вопрос Спасибо Сергей спасибо за доклад вопрос У меня такой у нас в кулуарах с ребятами в том числе с докладчиками другими много было дискуссий вчера по поводу сайт Car proxet это хорошо или хорошо вот вопрос такой сайт карт прокси вообще как явление как я понимаю это мое количество сервисов количество сущностей нашей системе Итак не маленькая умножили на 2 то есть два раза больше точек отказа в два раза больше хопов и так далее как с этим вообще смириться просто вот морально хотя бы это прям вопрос сразу на майку претендует на самом деле этот вопрос задают все вот и он понятен Вот и ответ на него тоже несколько Ну то есть во-первых Ну скажем так можно отвечать Так что Ну не так он много там чего и ест по сравнению с тем что он дает в преимущества да то есть по сути Ну у нас это где-то 02 кора Да на один подвиг То есть в принципе с точки зрения Вот именно нагрузки Ну вроде бы не так страшно то есть действительно если у тебя микросервис сам по себе вообще небольшой да то возможно эти 0,2 Это довольно существенно Ну тут как бы вопрос К тому А зачем ты это тогда делаешь такие маленькими красивыми Да он даёт тебе некий такой да с другой стороны Ты вроде бы как получаешь понятное Ну понятное по имущество и раньше я так отвечал А теперь есть ещё другое ответ то что сам истио как раз идёт в сторону прокси лес То есть у них сейчас появилась уже Прямо концепция новая которую они заявляют вот я честно скажу ещё внимательно не изучил вот стоит почитать Просто у них на сайте Вот они уже переходят вот к этой модели прокси леса и вот как раз с утра был Лёшей Ефимов выступал вот а это тоже очень интересная его концепция Мы тоже потом обменялись вот Ну в общем вот ответ такой что вот может быть скоро и не будет даже этих сайтов а можно в двух словах То есть получается на что заменить сайдкар на библиотеку какую-то у них там появляется у самого появляется такая концепция что у тебя как по моему выделено и такой ну сказать как выделенный отдельный такой вот уровень и которому всё равно тебе придётся идти Ну просто он будет не у каждого а микросервис а каждому красивому нужно будет через него ходить Вот как я понимаю да но тут опять же поскольку они только выкатили концепцию нужно почитать и они говорят что это будет такой ну возможен совместимый подход То есть ты сможешь где-то использовать где-то такой подход где-то миксовать это по-моему такой был подход То есть у них э-э ставилась прокси на ноду то есть не на каждой Сервис через него уже они обменивались"
}