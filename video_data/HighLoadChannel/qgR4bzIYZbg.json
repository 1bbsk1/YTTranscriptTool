{
  "video_id": "qgR4bzIYZbg",
  "channel": "HighLoadChannel",
  "title": "Согласованная локализация: версии, транзакции, очереди / Алексей Тимин (Badoo)",
  "views": 890,
  "duration": 2515,
  "published": "2021-10-04T02:03:50-07:00",
  "text": "здравствуйте я ведущий разработчик в систему локализации баду в компании мы работаем над такими приложениями как буду и bumble чтобы локализовать эти приложение в системе у нас находится 150 тысяч фраз и текстов которые мы перевели на 50 языков и чтобы эти переводы фразы и тексты были доступны нашим пользователям мы привлекли четыре сотни разработчиков сегодня в докладе я расскажу о технических особенностях процесса локализации потому что огромное количество вопросов мне поступает в периодически и самые главные моменты которые хотелось бы осветить это то как мы синхронизируем работы разных команд как мы versio неру им как мы обновляем и как поддерживаем согласованными переводы на мобильных клиентах на и навыки даже если у вас в компании например не используется какая крутая большая система локализации все основывается на google таблицах все равно доклад будет полезным потому что я рассказываю о процессах и о том на что мы обращаем внимание чтобы получалось качественно и я расскажу как мы достигли того что разработчики наши очень хорошо отзываются о системе переводов она не доставляет практически никаких проблем начну я со снов потому что очень много людей не представляется чего начать процесс локализации собственного продукта кто знает для тех будет большая сложная история дальше а пока рассказываю что такое лексема откуда мы их берем и как мы храним и так лексема это строка фраза или даже целый текст в общем любая неделимая единица которая приходит на перевод и показывается пользователю откуда у наберем лексемы представим что у нас есть html шаблон это может быть как html шаблон так и например форма если вы разрабатываете приложение для ростова мы извлекаем тексты из почтенных шаблона даем им идентификаторы как-никак промотает промо текст и переводим эти тексты шаблоне же у нас остается только идентификаторы вместо которых мы можем подставлять переводы на тот или иной язык и получать локализованное представление этого шаблона этой странице и так где мы храним лексемы которые мы извлекли из шаблонов как я уже сказал улик темы есть у данте секатор и переводы сама лексема и и переводы это как идея и перевода этой идеи на другие языки мы называем эту сущность эту целостность лексемы и переводов контент версия то есть это контент который может быть показан в том или ином месте в шаблоне идентификатор текста очень важен и используются в программном коде для того чтобы получать переводы поэтому этот фиксатор в основном хранится используется в ветке в детей а перевода хранятся в базе данных но для того чтобы обеспечивать синхронизацию синхронный релиз мы связываем ветку и запись в базу данных посредством номер и жира тикета сейчас небольшой обзор процесса перевода без каких-то деталей но чтобы было понятно как он у нас в целом выглядит и на что мы обращаем внимание начинается всё с технического задания в котором мы готовим написание текстов зачем они нам нужны дальше техническое здания идет команду локализации где представители команду локализации очень быстро переносят тексты системы в систему локализации и дальше параллельно не идут процесс перевода и процесс разработки клиента и сервера как только области процессы завершаются мы готовы релизе локализованную версию начнем с первой части нашего процесса подробнее поговорим техническое задание здесь сейчас расскажу как мы готовим лексемы и как мы их в базу заносим систему что касается подготовки основным элементом технического задания является таблица лексем в ней и мы указываем сами лексемы это текст который может содержать переменные которые может содержать html теги мы обязательно указываем в этой таблице лексема будет отдаваться сервером или она будет интегрироваться в клиент это очень важно потому что пресекает споры и обсуждения уже на этапе разработки то есть заранее архитекторы решают как это будет реализовано также важным элементом в таблице лексем является ключ и здесь такой момент если лексема раньше где-то уже использовалась то у нас в системе для нее есть ключ строковый и он здесь указывается в этой таблице если же текст совершенно новый и нигде такой раньше не встречался то мы его заносим в пазу но ним при цель команды локализации а в таблице оставляет порядковый номер чтобы разработчик когда начнет работать надо ситчина с функционалом сумма сумела перейти в систему организации и указать строковый индификатор который ему нравится который будет использовать программном коде что касается вот ключей и перья использование лексем есть очень важный момент о котором я сейчас расскажу начнем с истории однажды мы решили провести опрос на английском он звучал как дую смог варианты ответы были тесно у мы завели 3 лексемы перевели их на русский получилось все прекрасно вы курите корью не курю но потом мы решили провести другой опрос и создали новый вопрос английском звучало как фэнтезийной партии варианты ответа остались теми же самыми лексемами что и были изначально но зачем их менять и сноу все подходит при этом когда мы пилили перевели на русский сам вопрос но оставили те же самые лексемы для вариантов ответов у нас получилось вот такая смешная ситуация пойдете вы на вечеринку и вариант ответа курию не курю что отсюда мы вынесли что переиспользовать лексемы можно но нужно делать это осторожно и учитывать контекст в котором они раньше использовалась дальше поговорим о том как мы заносим лексемы в систему скриншот интерфейса нашей административной панели как мы администрируемых темы и здесь собственно показываются основные моменты что мы создали лексем у для баду указали ее текст указали текстовое описание зачем это лекси ему нужно где она будет использоваться и привязали алексей мука ticket у к задаче это помогает отслеживать прогресс под и водам по подготовке текстов в самом ти кити поле лексем выставилась в нью ченчик это поле используется нашими локализатора me для того чтобы контролировать что в этом ti кити сейчас с лексемами как только работа над лексема будет завершена это поле будет выставлена в дан и дальше уже по процессу пойдут следующие шаги но об этом потом так вот что хочется отметить говоря про это птоза обязательно нужно учитывать использование лексем в разных контекстах если бы перья используете текст обязательно нужно решать стараться решать заранее какие-то технические моменты такие как отдается лексемы сервером или она должна быть интегрированных клиент это экономит время потому что разработчики не решают это уже в процессе разработки и мы это делаем обязательно я как бы советую рекомендую связывает лексемы тексты с задачами потому что это помогает отслеживать зачем этот текст был создан кем когда под какие условия и так далее дальше предлагаю перейти к процессу перевода и рассказываете что происходит на этом этапе важные моменты здесь это в каком порядке мы переводим с какого языка мы начинаем что мы делаем дальше потом как формируется очередь на перевод и от чего зависит перевод и так порядок перевода изначально си текст у нас готовится на английском языке дальше с него мы переводим уже на испанский французский русский на основные языки переводчики на эти языки у нас находится в штате и мы очень очень быстро можем приготовить переводе этих языков также мы можем указать переводы не можем указать а мы переводим уже на остальные языки после основных и среди остальных языков у нас например вот как интересный факт есть пять вариантов английского и три варианта испанского очередь на перевод как она формируется вот пожалуйста скриншот инструмента который позволяет для каждого проекта для каждой платформы указать список языков которые используются например баду веб и видно вот глобус там где глобус и яркие черные значит этот язык используется для баду для веба то же самое для бабло как только мы создали лексем занесли в систему для какого-то проекта мы по той таблиц сразу определяем на какие языки нам надо переводить и дальше на специальном на специальной странице у нас есть специальный монитор который показывает очереди на перевод на конкретные языки также у нас есть инструмент который позволяет по задаче понять на какие языки нужно нам постараться поскорее перевести какие языки опаздывают в данном случае видно что meine kleine кучи среди и нам осталось перевести на три языка индонезийский тайские вьетнамский давайте поговорим теперь от чего зависит перевод у нас в системе возможно зависимость от 5 5 параметров это численная переменная которая в тексте встречается от того кому мы показываем этот текст или о ком мы говорим в этом тексте или кому и о ком мы говорим в этом тексте также вариант перевода может зависеть от платформы на которой мы показываем этот текст ну потому что на разных платформ могут встречаться разные термины какие-нибудь системные разделы если мы инструкцию какой-нибудь перевозим вариант перевода обязательно зависит от проекта для которого мы его делаем потому что каждый проект имеет свой тон в общении с пользователями на вы над и и вариант перевода зависит от абед с т а б тест это когда мы пользователям показываем 2 например три варианта одного и того же контента и зависимости от реакции пользователей понимаем что а вот этот вариант лучше чем мы тот так дальше очень часто встречается вот такая ошибка 29 тысяч подписчиков здесь число слова не согласовано с числом чтобы нам избегать таких проблем у нас есть инструмент это матрицы падежных форм и перевод который мы показываем пользователю зависит от того какое число у нас сейчас будет фигурировать в тексте и от того какой падеж переводчик указал при переводе и непосредственно только перед тем как показать текст пользователю мы выберем просто на пересечении строки и столбца именно ту форму которая сейчас нужно в интерфейсе переводов это выглядит вот так то есть здесь идет сначала переменные ну фигурных скобках потом слова people и вот после собачки 0 это значит первый именительный падеж там 10 человек добавили тебя вы страны и две формы перевода переводчик заводит да все переводы выполнены и оттестированы команды переводчиков нас там есть специальный человек который занимается тестированием то в пикете поле лексем выставляется как дан и ticket готов ехать дальше тестирование финальная и в на продакшн это что касается процесса перевода я рассказал о том как мы определяем на какие языки мы должны переводить и как мы отслеживаем трек как на треке состояние наших задач дальше давайте перейдем к разработке разработка у нас идет как я уже сказал параллельно с процессом перевода нас нету никакого смысла чтобы разработчики стали переводчиков или переводчик читали разработчиков абсолютно независимые две веточки здесь расскажу о том как мы организовали параллельную разработку с использованием локализации и как мы предупреждаем ошибки при использовании лексем параллельная разработка здесь все устроено вот как как-то разработчик начинает работать над какой-то задачей для него уже созданы лексемы в базе и ему остается скачать себе на машину набор лексем актуальный но как это сделать разработчик должен перейти по таблице лексем и спирте на страницу администрировать лексемы указать текстовый идентификатор at his name сверху красным введен по которому разработчик собирается запрашивать переводы данного текста и обязательно надо указать ticket с которым поедет на прот текст потому что код который уедет на продакшн в рамках какой-то ветки по какой-то задачи ничего из себя не представляет без текста и надо синхронизировать релиз и текста и кода какие ошибки при использовании лексем могут возникать давайте посмотрим вот есть перевод на русский язык напишите там то то то то какому-то человеку за столько-то кредитов здесь мы видим у нас есть большое количество переменных причем секунд username у нас еще и с падежом форма будет выбираться дальше у нас есть кредит сама вот это число значение которое будет передано в процессе исполнения программы и это у нас будет задано разработчиком а вот если посмотреть дальше у нас есть кредит это как раз таки ключи слова форма которая будет выбрана автоматически потому что форма слова зависит после : 3 mount то есть от переданного значения полученного код разработчика и от падежа который выставил переводчик вот все так сложно надеюсь понятно и какая только есть возможно в спешке или от невнимательности возможно что разработчик перепутает при передаче значение для подстановки ключ и значение и вот чтобы этого не происходило у нас есть специальный инструмент позволяющий нам контролировать как разработчики используют лексемы это абстракция вот в виде php класса реализовано но суть ее сводится к тому что эта абстракция знает о переводе какие используются в нем переменные и какой у них тип и эта абстракция контролирует все ли значения были заменены и правильно или правильный ли тип у подставляем их значений если все подстановки сделаны то абстракция превратиться в текст если же не все то при попытке привести абстракцию к строке что значит при попытке показать текст который скрывается в этой абстракции пользователю мы увидим варнинг не все подстановки произведены и это будет видно влогах и это сразу увидит разработчик процессе работы над задачей таким образом мы отсеиваем ошибки при работе с лексемами наших разработчиков что в итоге стоит особенно отметить говоря о разработке это опять же обязательно нужно привязывать лексемы крикетом потому что важно синхронизировать момент релиза момент тепло и кода и текста который используется в этом коде и желательно нашем случае обязательно это автоматически проверять подставляем ее значения перемен иначе может быть на продакшене вместо какого-то значения которые там подразумевалось ну просто пустота и получится кривой текст это уже это уже совсем плохо итак мы с вами рассмотрели быстро но основные моменты техническое задания разработку перевод сейчас давайте поговорим о том как мы релизе локализованной версии и здесь я вам расскажу о том как мы доставляем переводы какой формат файлов переводов мы используем как мы обновляем переводы причем так чтобы они были у нас чтобы обновление были согласованы на мобильном клиенте baby и на мобильном клиенте в случае если часть контента показанного на экране пришла с сервера часть это интегрированная что-то и так версии лексем у нас может быть доступна в любой момент времени две версии лексем диверсии текста та которая сейчас у нас на продакшене то которые сейчас у нас в разработке но самое главное что мы привязываем версии крикетом через номер 2 всегда ветки с кодом связаны с текстом это дает нам возможность как отправлять в релиз ветку и текст так и откатывать просто благодаря тому что мы знаем по какой задачи и действия производилась этот текст заводился этот код какой задач создавался как только задачи с кодом с текстом попала в релиз в пикете проставляется информация об этом когда это по сути зашифровано в релизе в маркере релиза зашифрованы дата когда он должен быть развернут на продакшн это позволяет продакт менеджером например зайти спокойно посмотреть никого не спрашивать процесс контролируемой прозрачный готовность пожалуйста все все у всех перед глазами иллюстрация того что я уже сказал что у нас в момент времени может быть две версии текста 1 на продакшене другая в разработке та которая на продакшене не может быть изменена потому что если мы ее изменим нам придется перепроверить все переводы и пока мы не удостоверимся что все переводы корректны мы получается не можем их показывать пользователям это значит что если мы что-то меняем мы создаем новую версию текста прям с новым порядковым номером переводим его проверяем привязываем g ракету и релизом когда уже все готово в данном случае мы заменяем текст мама намывала раму на текст мама мыла раму и очень интересный момент связанный с тем что у нас таким образом организованную разработка что разработчики работают параллельно с переводчиками момент связан с тем что вторая и последующие версии текстов могут релизиться переводчиками независимо от разработчиков не надо просить разработчиков поменять что-то в коде просто создаем новый текст переводим удостоверимся что интерфейс не поехал и релизе пока мы хранили текст в коде в гите постоянно приходилось просить разработчиков как только мы перенесли текст в базу сделали связку через номер тикета у нас эта проблема отпала все параллельно и так теперь о том как мы доставляем переводы давайте посмотрим на этот пример на этот скриншот мобильного приложения здесь у нас есть перевод который пришел с сервера и перевод который интегрирован в само приложение мы у нас сейчас интегрирована примерно 20 процентов текстов самого приложения это текст какие-то базовые например как видите ваше сообщение или тексты каких-нибудь б тестов которые должны проводиться непосредственно как только приложение запущено то есть еще никакой коммуникации не было с сервером а уже уже все должно быть доступно так как же мы вставляем эти переводы нашим пользователям есть разные платформы и первый способ доставки переводов это раскладка новых текстов с релизом который раскладывается на наши production сервера все просто открываете в от версию видите новые тексты с телефона грузите какой-то контент который грузится сервера видите новые текст если мы хотим обновить интегрированные переводы то мы должны приготовить мобильный релиз выложить его в магазин приложений дальше дождаться пока пользователи обновятся скачают запустят и потратит много времени кроме этого у нас есть возможность доставлять через платформы для опросов мы иногда проводим вопросы доставлять переводы в виде по файлов широко известный формат файлов перевода мы умеем экспортировать все переводы в profile вот но давайте вернемся к интегрирована переводом это очень интересный момент чтобы не ждать пока все пользователи обновятся на следующую версию переводов мы разработали механизм горячего обновления который позволяет так называемые снимки базы переводов доставлять до наших пользователей максимально быстро насколько быстро за три дня обновляется примерно 90 процентов пользователей такое хорошая быстрая доставка этот инструмент мы использовали например для того чтобы во в период празднования дня святого валентина временно поменять надпись у одной из опций кого вы ищете было dates стала валентайн стоит потом мы применяли все назад год посредством горячего обновления давайте рассмотрим теперь какой формат файлов переводов у нас часто меня спрашивали вот сейчас наконец я показываю как это выглядит в интерфейсе и дальше покажу как это выглядит в виде php-файла интерфейсе на что стоит обратить внимание у нас есть обязательного указания то что перевод зависит от пола и возможность указать перевод зависимости от пола вот два варианта перевода один из них универсальный для получается случая когда мы показываем мужчине или человеку неизвестному этот текст и другой перевод для того когда мы показываем это текст женщине в интерфейсе вот в таком на первый взгляд сложно все выглядит так а в файлах это выглядит вот так ключ лексемы собственно тот строковый дентифик атор который был указан разработчикам дальше у нас идет номер лексемы который позволяет нам быстро находить сам текст если какие-то вопросы возникают по нему обязательно есть список всех переменных которые используются в этом тексте или же используется для выбора правильного варианта текста и дальше вы видите собственно список белью список всех переводов в ключ включите указано условия по которым мы показываем этот перевод то есть либо это дефолт либо это вот как перевод для женского пола самый нижний там ключики указаны gender name f дальше у нас система локализации позволяет показывать пользователям несколько вариантов перевода одного и того же текста таким образом проводить аб-тестирование вот граффити это выглядит вот так просто добавляется еще одна вкладка для тестируемого варианта предоставляются переводы в данном случае три вот перевода значит контрольный вариант это изначальный и название второй вкладке это informal тона force то есть менее официальный тон вообще не использовать или вот проводим такая б тест собственно как а ты теперь вас выражается в виде файла какой формат все тот же номер лексемы все тот же список с типами переменных которые используются в тексте ну типа переменных нам нужны что вы могли контролировать что непосредственно приходит для подстановки в текст дальше у нас есть список вильнюс это список базовых вот этих контрольных тех переводов по умолчанию которые используются сейчас относительно которых будем тестировать значит нас там ключики дефолт нам singular иному с формой ту соответственно в зависимости от того какое число пришло мы выберем ту или иную форму дальше у нас идет список переводов для абэ тестов нас указано ключа б тест варианта bts то то что оба теста может быть не один вариант например 35 вариантов и мы тестируем какой из вариантов наибольший отклик получил по каждому варианту могут может быть свой список переводов и вот здесь вы видите как то же самое нижнего список целью сам ключик опять же нам singular нам ту в ключах массива и соответствующие им переводы только основной у нас у вас у вас у вас вариант перевода а тестируем вариантом у тебя у тебя у тебя вот такая бы тест мы проводим и так это отображается файл теперь рассказываю о том интересном механизме который нас реализован горячие обновления переводов что это вот концепцию объясню в процессе перевода мы понимаем что вот на данный момент времени переводы в базе у нас хорошие мы их оттестировали мы убедились что они качественные мы готовы показывать их нашим пользователям как только мы это поняли перед периодически там мы тестируем и говорим с адой момент времени все круто все актуально все супер мы готовы релизе переводчики понимаю мы записываем что какой-то момент времени такой-то текст нас устраивает и получается у нас есть список меток времени которые являются идентификатором версий наборов переводах и мы можем соответственно понимать если у этого клиента версия перевода с такой-то меткой времени а у нас есть что-то новое значит мы можем сказать обновить и клиент скачает новый набор обновленный набор переводов на тот момент времени который нас все доступен максимально свежий значит как это вот реализовано когда пользователь запускает приложение приложение сообщает на сервер свою версию перевода который него есть мы фоне рассчитываем для этой версии перевода персональный div персональную разницу есть вот у вас версия номер один а у нас на сервере уже есть более новые переводы из форматов на версию номер два для каждого клиента мы пошлем в ответе только то чего у него нет ни вне весь слепок не весь не всю базу ему отправим а только там поменялось 10 переводов относительно его версии ну значит мы это шлемом 10 переводов сэкономим трафик ускорим обмен данными ускорим приблизим момент того как быстро пользователи увидят новые переводы все будет круто так как мы поддерживаем согласованные тексты как я уже говорил в версии проблемы с этим нет мы обновляем атомарная версию кода и текстов на наших production серверах и все прекрасно все отображается везде одинаковые термины которые мы используем везде одинаковые тон с которым мы общаемся с пользователем если вы вдруг решили вакууме нет а вот как быть с мобильным приложением здесь есть переводы пришедшие сервера есть переводы интегрированные и как как обновить одновременно и тут мы используем можно дать это хаком но я бы так не сказал общем об и тестирование и таким образом мы поменяли термин суперсила на году premium как это было а б ты функционала бы тестирования позволяет заранее на все платформы раз сложить конфигурацию абэ теста и в этой конфигурации указать дату метку времени с которой мы начнем абэ тест мы заранее разгадываем конфигурацию с указанием момента начала теста и заранее раскладываем запускаем обновление переводов на все платформы и если мы знаем искать цифру 90 процентов клиентов за три дня то мы можем предположить что там через неделю через дела у нас прям вот все клиенты обновляться авиации будут готовы показывать новую версию тексты переводов и это позволяет нам а там арно в данном случае речь шла о название нашего сервиса и мы не могли допустить чтобы на 1 страницу была суперсила другой бату премиум вот таким образом мы решили проблему переименование название нашего сервиса что кратко теперь быстренько подведем итоги того о чем я рассказал я прошелся по процессу локализации и отметил важные моменты в техническом задании в разработке в процессе переводов и то как мы релизом локализованные версии надеюсь было полезно составляете всегда подробно и тоже обязательно привязывайте текст к задаче чтобы было понятно зачем для кого кто когда создавал этот текст и заносил как можно больше автоматизируйте контроль потому что в нашем случае 150 тысяч фраз и текстов помноженные на 50 языков получается цифры там под 8 миллионов текстов на разных языках на японском на тайском и надо как то это все контролировать кто как использует только переводит поэтому автоматизируйте контроль все всем спасибо вопросы пожалуйста на них отвечу так же вопросы можете направлять на наш телеграм-канал локализацию metal очень много статей по локализации на хабре в блоге нашей компании и в нашем тех блоге на сайте на нашем сайте все спасибо супер сейчас нам нужна минутка чтобы алексей подключился сюда мы подождем ребята может быть мы включим свет в зале для того чтобы алексей видео кто задает вопросы вижу на втором ряду есть рука на первом ряду есть рука и у кого-то уже есть микрофон да хорошо исключить мисс чтобы не не слепил сторона рано-рано так работает а вот алексей нас видит добрый день алексей спасибо за доклад меня зовут валерий я бы хотел спросить как много времени займет добавление нового языка на вашу платформу то есть насколько это сложно и как много текст придется перевести что касается времени которые потребуются на перевод текстов то вообще у нас есть целый 48 часов то есть мы 48 часов должны все языки все перевести но если вы говорите о том что мы должны добавить новый язык и все на него перевести и здесь надо будет уже узнать с какой скоростью конкретный переводчик переводит и прикинуть добрый день игорь компания костес у меня вопрос два вопроса первый вопрос про падежи в разных языках разное количество падежей вот в английском языке насколько я помню 2 падежа финском языке по моему 12-16 падежей вот как вы обходитесь во-первых значит падежами когда она разные языки переводите и второй вопрос вот вы показывали в примерах фразы которые зависит от пола но ведь может быть так что фразы зависит от пола того человека которому она показывается и того человека в отношении которого она показывается на то есть мужчины мужчине пытаются фраза о женщине либо там женщине и мужчине либо мужчине а мужчине женщине а женщине вот поддерживает ли ваша платформа такие ситуации спасибо спасибо за вопрос я записал два вопроса первое падежи собственно как мы с ними работаем для каждого языка у нас в системе занесены все платежи и у переводчиков есть возможность для тех слов формы которых выбираются автоматически заранее проставить все форму перевода что касается зависимости от пол это да вы правы это может быть как как и о ком мы говорим также и кому показываем и и это все возможно учитывать у нас нет ограничения на количество вот этих меток для передачи и для того чтобы предоставить пол пожалуйста о ком кому все это доступно все это работает как сказали ребята кто сейчас в онлайне вы помните что рядом с player у вас есть кнопочка выйти в эфир вы сможете задать свой вопрос алексей а ты помнишь что тебе предстоит выбрать лучший вопрос правда у меня все записано супер есть ли еще вопросы здесь если в онлайне вопросы не вижу знак спасибо тебе огромное за доклад во первых наша благодарность приедет к тебе я надеюсь своевременно это будет именно я рамочка признательность рассказ и худи с надписью highload году тоже города и полезно до михайлова от города скажи да вот тебе предстоит назвать лучше вопрос у нас здесь есть книжка и мы вручим приз за тот вопрос который понравился тебе больше всего 2 человек который задавал вопрос о чем там было про зависимость от пола супер вставай получите свой приз поаплодируем победителю сейчас алексей переключиться в зум для того чтобы в онлайн кулуарах вы могли с ним пообщаться вы можете подойти туда ассистенты дадут вам микрофон и вы будете общаться увидеть алексея у нас будет слышать вы будете слышать все у вас хорошо получится спасибо вам огромное"
}