{
  "video_id": "SOG7lQonLrQ",
  "channel": "HighLoadChannel",
  "title": "Уязвимости платформы Hyperledger Fabric  / Илья Дружинин (Positive Technologies)",
  "views": 105,
  "duration": 2443,
  "published": "2024-10-29T03:08:40-07:00",
  "text": "первый вопрос меня слышно но я себя слышу значит меня хорошо слышно Всем доброе утро немножко задержались мы на 10 минут но я думаю что успеем основной части вопрос Так секунду Да изначально здесь Было уязвимости платформы но правильно назвать особенности которые повлекут за собой уязвимости Ну сперва Так секунду да экранчик бы поставить в другую сторону Меня зовут Ия Дружинин Я занимаюсь исследованием безопасности в области расх систем и конкретно ных реестров и блокчейна работаю Tech и с 2002 года мы занимаемся комплексной информационной безопасностью ну и соответственно блокчейнов тоже Почему важно секундочку э ну задача нашего отдела - это проведение исследований в первую очередь как прикладных так и научных в области криптографии как ведущий меня ведущий сказал про хеширование Хотя все мы знаем что криптография более ёмкая А про хеширование конечно дадада вот также проведение прикладных экспериментов и исследований с существующими блокчейн платформами их Существует очень много Ну про себя в области блокчейна с шестнадцатого года руковожу повторюсь руковожу отделом исследований в Рас систем в technolog Ну и Также занимаюсь преподаванием в разных вузах как государственных так и всяких платформах Сегодня у Насри И что это такое кстати кто-нибудь из вас про фабрик что-нибудь слышал знает вот видимо сегодня вопросы хорошие Спасибо это модульный фреймворк для создания своих э своих блокчейнов А первый вопрос про блокчейн все же слышали Ну соответственно Да если часть есть то и про блокчейн слышали А отличие этого фреймворка от других потенциально это то что все участники информационной системы а известны друг другу если мы говорим про блокчейн публичные там чаще всего так называемая псевдо анонимность и участники определенно неизвестны вот до какого-то момента до их раскрытия в фабрике все участники известны и они проходят этап так называемой регистрации Какие компоненты можно выделить в фреймворке я рассказываю про все про фреймворк для того чтобы уже Прийти к особенностям это клиент это клиент кто создат транзакцию подпис отправляет здесь мы от классических блокчейнов Можно сказать что то тоже самое Пир участник одноранговой сети который занимается проверкой проверкой политики принятием выполнением транзакции и возвращению клиенту ответа о том валидно транзакции Ну то есть корректно и некоректно уст это оци принимают уже вот клиент транзакцию и формирует на основе него блоки также из одних из компонентов можно выделить каналы это некая абстракция некая можно сказать даже абстракция которая организует работу нескольких Перов и конкретно Чейн кодов Чейн код это у нас смарт-контракт программа которая выполняется в пенной манере между разными участниками Почему важно рассматривать особенности фреймворка фабрика потому что он в отличие от эфир вернее как он используется в корпоративном секторе чаще всего в финансовом секторе при этом изучение его уязвимых мест не уделено как нам кажется внимание все мы знаем про уязвимости эфир уязвимости других блокчейн платформ афаб Хотя он используется в проме мы знаем вернее экспертное сообщество не очень много и кажется что это важно из использований это платформы выпуска цифровых финансовых активов это автоматизация авио заправок в целом Это российские примеры но фабрик сам по себе фрер который используется во всм мире Для теже поставок для интернет устройств и прочих случаев в том числе и государственных медицинских социальных Так что хотелось бы выделить в модели работы фабрика это разделение на несколько шагов выполнения транзакций в первую очередь у нас идёт этап отправки транзакции подписанной от клиента к пиру Пир Ну мо здесь его назвать проверяющим политики одобрения то есть одобряющие политики э немножко пару слов об одобрении политик вернее политики одобрений э так как э при установке фабрика при установке при настройке при настройке сети э организация запускающий фабрик устанавливают разнообразные политики принятия и исполнения транзакций например что транзакцию могут может быть одобрена если её подтвердили там нзм участников либо какое-то большинство либо один участник для чего это надо для того чтобы потенциальное согласование транзакции происходила транзакция проходила согласовано с некоторым большинством далее Вот здесь мы про execute Ну я сейчас про неё в принципе рассказал далее подписанные собранные собранные одобрения по транзакции отправляются в так называемый ордеры то есть служба которая занимается упорядоченной транзакций с формированием блоков и уже отправки блоков в клиент Ну то есть в основным участником сети для того чтобы пройти этап валидации и утверждения блока после этого можно клиенту говорить о том что транзакция принята может быть мы сделаем немножко интерактива сразу как или после чтобы вопросы может быть вопросы возникают Главное чтобы мы Потом могли выбрать Два лучших хорошо ладно главное е чтобы Для этого нам надо запоминать кто задал вопросы но так в целом понимаете хорошо ладно немножко про чин коды смотрите мы можем оценивать э фреймворк с точки зрения нескольких компонентов Хотя сейчас про это расскажу для нас самое важное - это изучение Чен кодов чин коды - это смарт-контракты в фабрике их можно писать как на их можно писать на языках общего назначения если в эфир мы пишем там в эфир в других блокчейна мы пишем на каких-то Лях то в фабрике мы уволены писать на языках Java на ogs и Go мы сегодня пом на особенности особенности го которые влекут за собой потенциальну уязвимость чаще всего чин коды Да вся система фабрика перы ордеры разворачиваются как докер контейнера То есть если мы рассматриваем безопасность фреймворка то также надо обращать внимание на запуск комне в доке особенность Чен кодов отличия которые отличает его от блокчейнов общего назначения или как не обще назначения публичных блокчейнов это то что состояние не меняется на всех узлах сети сразу то есть меняется если какая-то особенность если мы отправили транзакцию в Перу и он там что-то выполнил то поврежденное состояние Остане токо Ура оно не будет размазано на всех говоря про модульность можно отметить то что там есть модульные консенсус про это мы сейчас немножко поговорим это кавка raft и С недавнего времени пока ещё не в проме но близок к этому Smart bft также и разные базуки это level db и coach db важная важная отметка - это одновременно снтк Скорее это пока что кажется что это не особенность которая потенциально может повлечь какую-то уязвимость но если там немножко подумать то можно придумать соответствующий сценарий атакующего идея В чём транзакции ког урядом Канам э когда ордере уря упорядочил неско транзакций по нескольким каналам а они исполняются на пирах А можно сказать что в некой форме параллельности в отличие от однопоточный фильки например так Чейн Код да А если я сечас буду немножко рассказывать и со стороны классических блокчейнов открытых и показывать Это как выглядит в фабрике и вам даю загадку вернее загадку задание думать про то на каких шагах может быть уязвимости в этом процессе Ну в процессе естественно работы модели исполнения транзакций и жизненного цикла чинда например в публичных блокчейна как мы записываем смарт-контракт блокче мы его компилируемые венно мы его компилирует тела в транзакции в по в поле в в сеть все узлы которые приняли на транзакцию они Пересылаю их Мане валидатором или Валида и они проверяют уже записывают по определённому адресу смарт-контракт в блокчейн в фабрике немножко по-другому у нас здесь есть этап упаковки упаковки чинда Но это классический сценарий упаковки чинда в виде некоторого архива с исходным кодом потом идт этап установки установки на каждый Пир Согласно политикам но сама установка ещ не влечёт за собой его исполнения то есть возможность его вызова далее идёт утверждение этого чин кода для его исполнения Ну при обновлении отчасти шаги повторяются про фабрик я кратенько вам рассказал Там естественно Есть множество разных компонент ти поставка пройде поставщиков криптографии для разных версий платформ и тут надо Перед тем как перейти к особенностям надо сделать небольшую ремарку у фабрика есть несколько версий есть версия более модульная с возможностью подключения криптопровайдера и в принципе в России разработали соответствующий плагин для подключения криптопро к фабрику вот для соответствия некоторым требованиям использование российской картографии в ряде м бизнес-секреты одним словом а но при этом при развитии фреймворка э возможность включение криптопровайдера стало ограничено при этом его возможности к самого фреймворка стали получше перед тем как к особенностям перейдём немножко про термины что мы подразумеваем под уязвимостями это некоторые свойства и условия работы программы или информационной системы которые могут повлиять на некоторые на её безопасность одним словом часть всего под уязвимостями мы подразумеваем например компрометация закрытого ключа либо снижение производительности когда это может повлиять на некоторые юридические там соглашение о количестве транзакций в секунду например о скорости работы это может быть рассинхронизация узлов это может быть несогласованность Ну да ял синхронизация несогласованность состояний Ну и на слайде разные искажения данных нарушение сетевой связанности оче рушение бизнет вся система работать но при этом созданный бизнес-процесс как мы знаем там из классического блокчейнов неправильно реализована бизнес логика либо она не была проверена э на условия например входные аргументы Бывают такие случаи попадались когда входные аргументы не всегда проверялись что вело к нарушению бизнес А бизнес логики Так всё да про консистентность конси уже говорил кратенько это согласованность данных между узлами информационной системы Ну и детерминизм - это После выполнения операций на одних и тех же входных данных возвращающие данные мы эти термины немножко будем использовать сечас про консенсус сечас можно разделить все особенности безопасности на три уровня это уровня консенсуса это уровня платформы и уровня Чен кодов смарт-контрактов говоря про Да говоря про консенсус тут можно сказать что в фабрике Была Был Серви кака кото отвечал за упорядочивание транзакций добавили с версии 1.4 по-моему ФТ консенсус когда-то в первой версии там ещё был Византийский консенсус но его реализация видимо не устроила разработчиков и они от него отказались в недавно Ну как Ну да в третьей версии они решили вернуться к использованию византийских консенсус и была разработана соответствующая библиотека но сейчас насколько мне известно в релизе не в прев А вот именно в релизе в работающем фреймворке как модуль это пока ещ не не работает то есть в хабе нет резной версии с Smart Но это информация там трёхнедельного ещё расскажу про платформу говоря про особенности платформы можно отметить например управление доступом к выполнению операций так как мы знаем что есть центр сертификации и поставщик членства так называемый и по большому счёту он является одним из точек отказа говоря про фабрик надо понимать что это довольно комплексная система в которой настраивается практически каждый чих если мы говорим про тот же эфир и биток то В тех блокчейна А всё намного проще потому что э ну они сами по себе примитивные и их функциональные характеристики ниже чем у фабрика хотя бы по производительности но при этом чуть выше по э масштабированию да про платформу управление доступом а раскрытие чувствительных данных а и Отказ в обслуживание то есть те все особенности платформы которые ведут как раз к этим недопустимым событиям Ну и нкд сегодня мы говорим про Гоше немножечко поэтому Гоше позволяет так как языке общего назначения они в них с ними сложно добиться детерминизма согласованность выполнения данных То есть у них возможности чуть шире чем у того же Sol потому что Sol он создан как раз для э детерминизма одним словом так ну и особенности окружения э ну давайте сейчас чуть позже раскроем Так а что у нас про особенности консенсуса про кафку так как он уже в принципе устарел и его с версии 2.2 по-моему а от него отказались то в принципе можно его не рассматривать но знать про стоит кавка это одна из таких точек отказа и потенциально Как сказать пирующих факторов стоп факторов для Росто производительно Росто масштабируемости сети Дело в том что кавка кластером по своей природен управлять выделенный участник также у нас есть рафт Ну кавка и рафт они относятся я тут про Раф больше буду говорить рафт относится к так называемым технически отказ щим консенсуса Что это значит То что представим себе сеть из пяти например узлов и у них есть лидер лидер задача лидера отправлять сообщения всем участникам другим чем узлам вома остальные участники как абсолютную истину То есть то что говорит Лидер есть истина сразу и Никто об этом не спорят Да но вопрос в следующем А что происходит когда Лидер падает то есть узел отвечающий за лидера начинает отказывать начинаются перевыборы перевыборы процесс под протокол ющих консенсус задача которых выбрать нового лидера пока этот процесс проходит выборов сеть можно сказать что останавливается Ну возможно что временные Задержки не столь велики но потенциально сейчас потенциально у рафта в его чистом чистой подстановке Есть множество особенностей которые может могут воспользоваться злоумышленники когда мы говорим про злоумышленников в фабрике надо понимать что этот злоумышленник очень компетентный потому что ему во-первых надо пробраться в контур организации дойти хотя бы до одного ордера хотя он может и на уровне пира уже что-то делать например цензури транзакции клиентов но допустим что то есть вы понимаете что мы должны понимать что этот злоумышленник уже знает что он делает и в принципе мы находили ладно Что может сделать злоумышленник на узле на узле фабрика например указывать на ложного лидера То есть он говорит что ну для отправки транзакции надо указывать на другого лидера самое кажется мне что интересным в рафте это то что если злоумышленник добрался до конкретного до текущего лидера раунда или как он там называется в рафте тат по-моему то он потенциально может цензури транзакции но это в чистом рафте другой случай когда злоумышленник добравшись до рафт кластера и он является одним из участников он может запускать этап перевыборов перевыборов нового лидера То есть это саботаж саботаж работы протокола так да либо узел прикидывается лидером раунда для того чтобы собирать информацию про Smart сейчас публичной информации мало К сожалению мы сейчас в процессе написания формально спецификации на и протокол так всё-таки не очень удобно моторус расположен надо его куда-то передать либо стойку что мы подразумеваем под особенности платформы Ну доступ системе я уже говорил что есть провайдер поставщик кото раздаёт сертификаты и ну проверяет валидность участников в этой сети при этом он может быть компрометировать то есть если у нас Хотя как может он быть компрометировать Как вы думаете как может быть мсп плохо работать предложение Ну представьте себе систему г есть выделенный участник который отвечает за за проверку сертов Да отчасти может так я его немножко не услышал но вроде бы отказ отказ а да в принципе он является точкой отказа для для работы платформы так Ну ещё в в гитхабе фабрика фабрик C э указано что потенциально воспроизведение токена авторизации возможно и по-моему они это пока ещё не поправили так что ещё важно на уровне платформы данные в БД в базуке не зашифрованы то есть потенциально Ну как это можно как это можно снизить если у нас злоумышленник на узле возможно все решения приведут к понижению производительности системы в деф моде не шифруются данные между узлами и встречали случаи когда демо был доступен То есть можно было по взаимодействию Ну я сейчас не говорю про российский сегмент естественно вот нерону не российский сегмент можно было посмотреть в такие сети немножко перебор значений с известной структурой То есть когда мы знаем что в виде сообщени у структура СМИ полями пере для этих полей грубый перебор мог может приводить к раскрытию данных 5 минут О господи да ладно тогда ускоряем и раскрытие версии сервиса почему это важно потому что потенциально Зная уязвимости так как весь это Исходный код открыт зная и Анализируя уязвимости исходного кода и зная что конкретны сервис работает вернее как у сервиса конкретная версия можно реализовать уязвимость опять же используя открытые источники можно найти соответствующие эндпоинты из известных из известных особенности платформы это отказ в обслуживании для ордера и для пира Когда можно было отправить пакет невалидный и участники ложились особенности Чен кодов Наго смотрите я уже говорил что есть в языке некий не детерминизм сам по себе зашитый А из-за чего как он как его мо может достичь например используя глобальной переменной когда их обновление может быть на одном узле обновиться глобальная переменная а на другом узле она может не то есть не будет обновлена и при этом если она участвует вте процессе то может возвращать неверные данные генерация случайных значений также является плохой практикой и в принципе мы здесь ориентируемся на международный опыт то есть многие такие научно-технические статьи подтверждают что генерация случайных чисел если она требуется в блокчейне Ну в фабрике то лучше делать с помо с либо с помощью схем проброс Седа функцию не заниматься генераций случайных чисел на пирах потому что потенциально при выполнении транзакции это может быть привести к не детерминизм метка времени на различных узлах тоже не не не стоит использовать проход по структуре адреса объектов памяти Я наверно про эти сейчас части чуть меньше скажу конкурент программ опять же гока позволяет горутины запускать но порядок выполнения в рутина он на каждом узле будет соответствующий если какая-то операция зависит вернее как возвращает определённый порядок то естественно порядки при выполнении транзакций будут раз эта валидации потенци будет рассинхронизация детерминизм внешнего доступа Ну Коли мы уже знаем что есть что в блокчейне важно последовали выполнени операций чтобы они всегда возвращали одни и те же данные и соответственно мы языковыми средствами пытаемся ограничить себя ограничить ограничить возможности непосред некон систентки например вызвать какой-то веб-сервис для например узнать прайс какого-то какой-то пары цены да либо использовать некоторые внешние библиотеки кстати про вызовы веб-сервисов в принципе и в эфир само по себе запроектированы Так что это изолированная среда но гока она потенциально может глядеть в мир и отправлять запросы вовне выполнение системных команд относится является одним из источников не детерминизма из внешнего источника Да ну потому что системные команды могут на разных машинах если мы говорим про какие-то данные машинные возвращать не согласовано то есть не Не консист ну как ну не консистентные дамини иуп фаме иногда бывает что ладно особенности платформы так да здесь у меня сколько у меня ещё времени осталось 1 минута ладно в общем я особенность платформы там есть ряд требований это требования например проводить из самого интересного проводить чтение чтения вернее как конфликт чтения между записью Дело в том что если у нас в одной транзакции является в одном в одной функции мы пишем состояние в базуку и в ней же читаем по ключу тому же то потенциально может быть конфликт потому что состояние базы данных ещё не обновилось так меж канальное объявление полей Ну и программер ские навыки самые довольно часте на самом деле потому что это логика работы программ которые так Какие есть способы способы есть инструментарии самого го это всякие госе волны которые проверяют язык но есть ещё инструменты например известны для встк системе анализатор И для него есть расширенные правила так называемые R CC которые проводит некоторый проверку проверку кода на соответствие некоторых шаблонов там процесс происходит в разбивке кода на некую структуру данных абстрактное синтетическое дерево и проверка всех переходов Согласно шаблонам также есть возможности по динамическому анализу но индустрией они пока что не хорошо не очень хорошо описаны в принципе вот э данная информация основана на двух источниках это наш прикладной опыт который мы э базировались секторе э создавались инструменты анализа чин кодов но к сожалению Все они чаще всего не развиваются Вот Но они являются хорошей базой для того чтобы агрегировать наш производственный опыт и создавать инструменты создавать инструмент который занимается этим ну статический анализ мы просто проверяем на известные шаблоны динамический анализ льно выполнения когда мы думаем не про конкретное значения А про потоки управления данных и прочее Мы у пытаемся Нева вызовов но тут проблема комбинатор взрыва потому что потенциально пути исполнения программ может быть много вот но потенциальна точность она больше для разных типов там используются соответствующие решатель у меня ещё не всём нуть хоя 5 минут на вопро Осталось 4 мину 43 секун Ладно хорошо тиски анализаторы они проверяют использование те биотек Они проверяют например те же операции при функции они проверяют наличие горун для Ну чтобы подсветить разработчику что он делает не очень хорошо Естественно что опытные разработчики уже всеми этими вещами не занимаются что такие библиотеки здесь мы говорим про синами пополнения мы говорим про генерацию уже выполнение программ в динамике вызова функций вызов последных функций и генерации тестов Да я думаю что презентацию вам покажут да презентация конечно доступна и также можно будет продолжить общение в кулуарах А сейчас нам нужно задать вопросики и получить за них призы Давайте начнём перейдём к вопросам Спасибо за доклад Да жалко времени было чуть меньше так вот у нас есть вопро первый победитель первый победитель Вопрос Из зала А значит все транзакции в принципе ну все сетевой змо действи шифруются да то есть прин моде нет в в производстве Да там настраивается есть мини надо узнать ключи чтобы подслушивать взаимодействие да да в Диф моде оно не шифруется Ну для разработчики собственно продакшене если атаку А и получается Например Ну как отслеживать Наверное логирование метрики как-то это всё отслеживать там нештатные события Да наверное как это Извне или изнутри Ну изнутри отслеживать то есть ну наверное чтобы каждый узел какие-то метрики собирал Как узнать соы там есть возможно при запуске узла вот когда он собирает данные о том что с ним происходит можно это принципе анализировать какие-то да Второй Спасибо за доклад А есть какие-то эксперименты с шифрованием нет у нас не почему же там вроде как бы что стоит в чистом виде вро нехорошо же Ну мы не разработчики мы исследователи безопасности вот мы разработкой непосредственно не занимаемся Вот и вопросам шифрования стейта и данных в базе данных хороший мы посмотрим если это найдём случай применения мы посмотрим как это раскрыть тут вот важно именно что как там Что что с одним ключом там многими ключами ключ на всё там или на каждую запись ключ это вот интересно бы исследование запросы запрос комплексный Запрос к базе данных вот это вот или прочее по ключу или как там есть ну как бы рекомендация там есть сложные запрос возможно формировани слож запросов но обя рекомендация использовать для более примитив простые чуть меньше использовать или в ряде случаев использовать именно вот эти сложные комплексные запросы базе данных как шифровать ну как можно придумать Если захотеть Я думаю СБО здесь получается для производительности точка ну как бы узкое место которое ограничено производительно это о скорее у нас будет ордер вот он рассылает информацию уже остальным Пирам на этапе Ну принятия блока Вот но здесь здесь в зависимости от Хороший вопрос на самом деле ция то он должен будет их по крайней мере выполнить Ну то есть вернуть клиенту ответ по политикам хотя бы вот поэтому можно сказать что и пира можно завалить но он упадёт только он сам то есть он остановится конкретно если мы валим Орде то потенциально завалим его транзакции если намного много транзакций ло собрали транзакций Некоторое количество и потенциально Хотя это такой гипотетический скорее случай Мне кажется Орде членство здесь определяется центром илито там вот я могу быть вот эти ноды у на о сдаётся каким-то центром или это они а записываются конкретные ордеры и пиры то есть это отдельно выделенные участники А вернее у них разные права для работы сети то есть это владелец сети задаёт что вот эти могут быть ордеры правильно Да при при запуске сети А спасибо спасибо за вопросы Спасибо за доклад сейчас нам нужно из трёх вопросов выбрать один вопрос которому мы подарим подарок от вашей компании positive Technologies и ещё один вопрос которому подарим подарок от партнёра Газпромнефть кому что подарим Хороший вопрос Я бы самому отважно первому выделил и сложный выбор сложный выбор а вот третьего нет подарка Нет нам нужно именно Два подарка разделить на три вопросика это ещё из онлайна вопроси ков не было так было бы совсем интересно вот помо Спасибо хорошо Большое Вам спасибо Вам тоже вручается подарок за доклад который вы сделали Большое спасибо вот третий подарок спасибо вам"
}