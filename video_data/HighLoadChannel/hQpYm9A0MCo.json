{
  "video_id": "hQpYm9A0MCo",
  "channel": "HighLoadChannel",
  "title": "Миграция банковского ядра на собственную разработку / Лев Осипов (Райффайзен Банк)",
  "views": 413,
  "duration": 3298,
  "published": "2025-01-17T02:32:31-08:00",
  "text": "друзья Привет Меня зовут Лев и я расскажу про миграцию банковского ядра на самом деле это огромная тема которую можно растянуть на кучу кучу кучу докладов поэтому конкретно Сегодня я расскажу про концепцию про процесс миграции но акцент я сделаю на таком аспекте как работу с потребителями данных и интеграция на самом деле это достаточно важный Аспект потому что некоторую часть миграции можно сделать изолированной я об этом Обязательно расскажу но а полностью без аффекта на всего на всё то что вокруг ядра при миграции без этого миграцию не сделать Поэтому соответственно я расскажу о таких вещах э потому что Ну ещё раз повторю что если где-то что-то упустить какие-то интеграции на потребителя забыть то проект Может просто не реализоваться а совсем пару слов обо мне Я работаю в операционном управлении райфа продакт оум сервисов управления данными соответственно про часть сервисов я сегодня расскажу которые мы делаем До этого работал и техдом и разработчиком и аналитиком и в банках и не в банках но за всю карьеру понял что мне интересно во-первых работать с данными Как с точки зрения бизнеса так и с точки зрения техники потому что это Ну не знаю как сказать кровь организации и с этим реально прикольно работать на это смотреть и ещё интересно развивать it продукты соответственно Наверное поэтому я и есть по дата сервисов О чём поговорим сегодня сначала соответственно я расскажу про ядро райфа Почему вообще мы его меняем потом опишу какие интеграции потребителей с ядром есть сейчас ну на Хай левеле Разумеется расскажу про новую концепцию ядра и сложности которые она вызывает при текущих интеграция Ну и далее уже буду рассказывать по очереди про разные решения А как соответственно мы эти проблемы решаем это будет и IP менеджмент и обратный поток и онлайн реплика и бонусом ещё одно решение на самом деле у меня будет доклад такой не сильно технический и при этом я не хочу вас сильно грузить предмет кой Я надеюсь что это будет достаточно понятные Простые истории Но при этом рассказывая О всём этом в какой-то базовый контекст ехать придётся поэтому говоря о ядре не могу не осветить термин АС поднимите пожалуйста руки Кто знает этот термин именно в банковской сфере супер очень много людей Да это не антиблокировочная система на самом деле Аска - это Автоматизированная банковская система для того чтобы попытаться просто её объяснить Давайте вот на такую картинку посмотрим У нас есть некоторые а фронт сервисы это могут быть клиентские приложения например там не знаю мобилка Для клиента вебсайт и так далее это могут быть фронт системы для сотрудников через которые они там тоже смотрят на клиентские сделки кредиты депозиты как-то ими управляют а под соответственно фронтальными сервисами есть непосредственно продукты банковские продукты то есть это отдельно продукты например для физиков потребительские кредиты ипотеки депозиты для юриков тоже самое кредит Юли депозиты и прочее прочее прочее соответственно в банке есть разные команды они сидят в разных блоках то есть есть там блог который занимается развитием продуктов для физических лиц для юридических лиц есть отдельные команды которые занимаются развитием этих продуктов Как с точки зрения бизнесом которые управление этими продуктами осуществляют и соответственно они интегрируются с фронтальными сервисами то есть в клиентском приложении есть там какой-нибудь экранчик типа взять кредит и соответственно он взаимодействует с соответствующей продуктовой системой соответствующей продуктовой команды но при этом у многих банков Ну у банковских продуктов под ними есть такие вещи достаточно базовые Это история про методологию введения счетов То есть когда вы берёте кредит нужно открыть специальные счета чтобы между ними там правильным образом Согласно стандартам российского бухучёта ходили деньги есть регламентные процессы начисления процентов по кредиту которые совершаются ежедневно выхода на просрочку и другие такие истории Ну да и другие такие истории в разных продуктах это И всякие списания комиссии и клиентские пулы это такой продукт для юриков когда определённым образом банк управляет средствами на счетах если у какого-нибудь корпората этих счетов там 100-200 сся и больше то есть есть очень много процессов которые нельзя по-другому сказать на Яровом слое для Ну ядро пото что если каждый продукт будет сам заниматься методологией ведения счетов начисление процентов и так далее но это будет мягко говоря нецелесообразно собственно говоря Автоматизированная банковская система это есть то самое ядро банка там происходит централизованный учёт и процессинг кредитов депозитов других клиентских сделок и продуктов И самое главное за тавтологию главная книга банка это соответственно реестр всех счетов всех проводок э провод пом движений по счетам ещё говоря про главную про банковское ядро есть такой интересный процесс называется закрытие дня это как раз регламентная история Когда у нас раз в день происходят все эти процессы вот как после какой-то отсечки начинают начисляться проценты по кредиту выходы на просрочку списываются комиссии и так далее это прям процесс критичности уровня ноль если что-то в нём по пойдёт не так если он сбой если он упадёт на следующее утро банк вместе со всеми клиентами проснётся с неправильными балансами и как бы если будут неправильные балансы какие-то движения по счетам не будет проходить то это риски вплоть до отзыва лицензии Ну вот для понимание Ну как минимум это штрафы но и вплоть до отзыва лицензии Поэтому вот закрытие дня сбои не должно вообще никак на самом деле это очень-очень упрощённая схема информационных систем банка если под этим ещё дорисовать какие-нибудь хранилища куда всё сливается и где уже происходит всякая отчётность продуктовая аналитика и так далее это будет такая более-менее приближенная и упрощённая картинка банка соответственно как Аска в Райф сделана тут сразу на слайде видно очень-очень много всего вендорс на самом деле это ный стек начиная с железа То есть это железные серваки это операционная система от ама а400 может быть кто-нибудь сталкивался это аная база данных Аны менеджер очередей это касательно инфраструктуры а что касается соответственно самой коробки самого ядра это тоже венское приложение монолитное майс от фи настры которая написано на языке IBM RPG Да ещё один мемасик про RPG это не ролевая игра ини какое-то оружие это действительно язык программирования от ама это по сути аналог кал Report pram генератор Вот примерно так на нём выглядит код вот как-то так а соответственно Почему меняем ядро Я не буду на этом слайде остановиться долго Я думаю вы и так уже многое поняли Но всё-таки если тезисно то это с учёт там экзотического текка вендорс решений - это проблемы Ну не проблемы а зоны развития скажем так в тату Маркете потому что очевидно что количество бизнесов запросов оно растёт Это история про высокую стоимость доработки и поддержки с учётом этих первых двух водных и вот критичности некоторых процессов особенно закрытия дня особенно в монолите о чём я говорил если там что-то пойти быстро делать и что-то сломать то откажет всё и банк очень сильно пострадает То есть это ещё единая точка отказа ну и наконец это Разумеется импорт замещение а переходим ко второму разделу собственно Какие интеграции есть текущей аской тут у меня такое авторское было разделение я выделил три типа интеграций первый это самый простой - Это история про интеграции с продуктами это вот то что я показывал раньше на схеме что есть продукт если он хочет там чтобы ну он хочет чтобы у клиента завёлся кредит он говорит там ядру заведи на такого-то клиента такой-то кредит с такими-то ставками процентами и так далее наоборот там продукту нужно получить какую-то информацию по клиенту он также у ядра спрашивает Дай мне информацию по этой сделки или там не знаю например запостить какое-нибудь движение по счёту тоже это интеграция с ядром соответственно такие взаимодействия к счастью обычно осуществляются через ошки Это первый тип второй тип тоже то о чём я говорил чуть раньше всё ВС либо большая сть асна разуме реп в хранилище это финансовая отчётность управленческая отчётность различная продуктовая аналитика соответственно все эти процессы они не требуют онлайновых данных их уже можно крутить где-нибудь в хранилищах ну или в аналоговых хранилищах каких-нибудь репликах непосредственно от ядра да хранилищ на самом деле у нас несколько и есть третья группа процессов она на самом деле самая сложная Это история про то что есть процессы которым нужны данные в онлайне и при этом кросс продуктовые интересны пример наверное будет какое-нибудь взыскание Когда нужно получить по всем клиентам физиков у которых сегодня какой-либо платёж по кредиту при этом это может быть потреб это может быть ипотека это может быть там не знаю какая-то задолженность по кредитной карте вот нужно собрать соответственно всех клиентов которым Сегодня надо что-то заплатить посмотреть сколько у них остаток на счетах какие у них остатки на счетах и могут ли они вообще этот платёж сделать и какую-то нотификации им кинуть неважно там звонок эсэмэска пуш почта Ну в общем сказать Типа чувак тебе платить надо вот для того соответственно чтобы эту историю сделать надо собрать кредитные сделки с различных продуктов надо собрать информацию по движению по счетам это всё как-то запросить какую-то логику применить И после этого Ну соответственно сделать необходимое бизнес действие и таких процессов достаточно много я их назвал Да вторичные бизнес-процессы комплексные онлайн данные и вот такие вот интеграции К сожалению зачастую строятся либо на прямом доступе к БД либо на каких-то хранимых процедурах которые для этого были сделаны Ну они могут вызываться там через какую-нибудь шину но сам факт того что для этого пря пишутся храним или идт доступ к БД Ну кстати говоря вот в монолитной структуре когда все кредиты лежат грубо говоря в одной табличке там счета лежат рядышком это достаточно удобно сделать вот теперь перейдём к тому что вообще нового точнее как мы вообще решили сделать новое ядро словом Я наверное никого не Удивлю что это будет микросервисы на лоде постоянно обсуждают микросервисы соответственно здесь примерно такая же история а микросервисы соответственно делаются Под каждый продукт либо группу продуктов То есть у нас вместо одной коробки которая обслуживает все продукты банка на каждый продукт делается свой набор микросервисов причём они бьются то есть нет такого что один сервис там не знаю для всех кредитов физиков или для всех кредитов юриков а в рамках одного продукта выделяются сервисы например сервис сделок который будет управлять атрибутами сделки какими-то её условиями А ну да атрибутами сделки по сути есть сервис графиков платежей который будет строить график для клиента когда что где ему надо заплатить отдельно там сервис просрочек который управляет выносом кредита на просрочку и её дальнейшим урегулированием То есть каждый продукт ещё бьётся на такой набор И в каждом продукте отдельно есть сервис собственно говоря закрытия дня то есть вместо концепции Когда у нас есть одно закрытие дня которое Там перемалывает абсолютно все продукты все балансы и может там и Ну не 5 минут мягко говоря у нас на каждый продукт появляется своё закрытие дня продукты Точнее микросервисы можно между продуктами переиспользовать например на уровне как бы бизнесов доменов потребительские кредиты и ипотека - это разные продукты за них могут учать разные команды и развивать их а вот на уровне ядра в принципе это продукты более-менее похожие Ну то есть у того и другого есть там какие-то условия начисление процентов график платежей и так далее и соответственно в принципе можно запихнуть буровые микросервисы вот те же сделок графика платежей просрочек и так далее и ипотеку и потребительский кредит потому что именно процессинг их он одинаковый по тик стеку в принципе всё достаточно для банков стандартно То есть это Java cuber пагр кавка Артемис Ну про преимущество не буду наверное долго рассказывать но как я уже сказал это меньше зависимости в части того же закрытия дня это ну и тем самым больше надёжности это более гибкая разработка развития этой всей истории То есть можно отдельно там доработать именно сервис кредито физиков или кредито ф юриков схематично это примерно всё вот так вот выглядит то есть верх картинки он такой же остался То есть у нас есть какие-то клиентские приложения и другие фронтальные системы А есть соответственно продуктовые системы И теперь у нас на уровне ядра вместо одной большой коробки куча продуктов при этом продукты могут быть при этом микросервисы продуктовые ядровые микросервисы могут быть переиспользовать между продуктами вот как в случае с кредитами физиков как я уже сказал с ипотекой и по требовани на этой схеме кстати интересно выделить что мы разбили разработку ядровые на разные команды То есть например за кредитные продукты отвечает одна команда это кредиты и для физиков и для юриков За продукты так называемые пассивные или liabilities products То есть это депозиты накопительные счета отвечает другая команда за инвестиционные продукты потому что это отдельный а отдельная немножко тема со своей продуктовой логикой отвечает третья команда и соответственно нельзя Не забыть про главную книгу то о чём я говорил раньше микросервисы главной книги это считая проводки это тоже отдельно реализована такой группой и соответственно все остальные продуктовые сервисы с главной книгой общаются то есть создаётся кредит для него заводятся счета потом какие-то Ну соответственно выдаются кредитные средства потом соответственно они списываются и всё вот это вот это интеграция между микросервисами активных продуктов и микросервисами главно книга А чуть-чуть хотел бы ещё сказать про миграцию важно на самом деле достаточно момент миграция может происходить по продуктово То есть у нас нет такого типа что вот работает Монолит мы там пишем Пишем пишем все вот эти вот микросервисы и потом вот какой-нибудь Час X и мы переключаем абсолютно всё Ну на самом деле мне кажется это даже звучит абсолютно нереально когда мы говорим про большой банк Ну так не работает поэтому продукты выносятся по очереди То есть как это работает у нас кредиты там например да создавались и просились в Старой коробке в какой-то момент этот поток начинает литься уже в новое ядро и обрабатываться там то есть это какой-то Сначала один пилотный кредит это может быть там не знаю кредит какому-нибудь сотруднику банка и он залетает уже не в старую коробку А в новое ядро и процеси там потом Второй третий и в какой-то момент полностью переключается процессинг Ну и помимо этого так в случае Долгих сделок тех же кредитов которые могут там идти несколько лет а ипотека там вообще десятками то Разумеется ещ отдельно нужно мигрировать текущий портфель из старой коробки в новую Это примерно все этапы миграции вот эта вот схема она по каждому продукту работает и в конце концов мы получаем что в старом ядре не процеси ничего и всё начинает процеси в новых микросервисах и тут мы приходим к самому интересному что вот если разработку сервисов можно вести изолированно Ну пока это не в проде там требования собрали написали что-то заработало Ну пока там ничего не просится А вот как только туда уходит Хоть одна как бы реальная клиентская сделка то И разумеется как только мы начинаем уже полностью переключать процессинг и мигрировать стат портфель тут неизбежно возникает вопрос А что делать тем кто данные из ядра хочет получать это вот вот эти вот Три группы ребят о которых я чуть выше рассказывал то есть на вот этих вот всех этапах начинается уже тесное взаимодействие с потребителями данных и какие сложности это всё вызывает Ну во-первых очевидно что это всякие новые ошки новые контракты то есть Нам не хочется повторять абсолютно те же форматы опишет что были в старом ядре Ну просто потому что в том числе эта вся миграция происходит для бизнес развития для новых бизнес фичей и так далее и закладываются как бы уже новые требования во-вторых и это на самом деле самая большая проблема данные начинают тупо различаться по БД то есть вот когда у нас был Монолит всё лежало плюс-минус рядышком когда мы переходим к микросервисов микросервиса мало того что продукты разъезжаются то есть вот потреб ипотеки они может быть ещё и в одном месте лежат Но вот да те же кредитные сделки которые Казалось бы кредитные карты которые Казалось бы тоже кредитные сделки физиков они могут лежать вообще в другом сервисе В другой БД Ну и при этом внутри каждого сетапа микросервисов тоже атрибуты они по разным базам разъезжаются Ну вот то что я рассказывал сервис сделок сервис графика то есть всё прямо максимально разъезжается по разным БДМ модель данных Разумеется новая как по нейминга Ну потому что вот в Старой мной коробке точнее даже не мной коробки А вот вендерс коробки аски на IBM стеке Ну там нейминг были не супер вот ну хочется наверное их не повторять а поменять Ну и та же структура данных то есть атрибутный составы они Разумеется в какой-то базе похожи на старую модель но тем не менее Да есть изменения есть новые атрибуты много там лишнего убрали и так далее и интересно то опять же что вот эта вот модель данных она может различаться даже между похожими продуктами опять вернусь к примеру с потребами ипотека и кредитными картами Казалось бы и там и там кредитные сделки для физических лиц но тем не менее атрибутный состав там может быть разный потому что разная архитектура этих микросервисов разные бизнес-требования Ну и в конце концов нельзя забывать про человеческий фактор Когда разные люди разные команды в разное время делают хоть и похожие сервисы Ну что-то всё равно бывает по-разному Ну вот тут вот никак это на 100% не проконтролировать соответственно встаёт проблема что делать вот всем вот этим вот ребятам и продуктовым процессам и отчётности и вторичным вот вот этим вот онлайн процессом которым комплексные данные нужны сейчас дальше я буду рассказывать про различные решения которые направлены на конкретно какую-то из этих групп Ну или на несколько групп сразу вот прям последовательно по очереди Но прежде чем я начну рассказывать есть один маленький дисклеймер что в масштабах такого проекта без времянки Ну никак вообще Поэтому то что я сейчас буду рассказывать будет делиться на решения временные и решения целевые решения временные Ну в принципе Понятно Они дают тебе то что нужно в моменте то есть какие-то требования сразу удовлетворяют но при этом они могут быть тех долгом костылями и банально лишней работат То есть ты что-то сделал ты это делал там условно говоря там не знаю пару тройку месяцев полгода А через года два это выкинет то есть такое может быть Ну и есть целевые решения которые удовлетворяют всем функциональным не функциональным требованиям Но их может быть делать так долго что ну либо они просто заблок условно говоря года на полтора а проект стратегические либо же когда они там будут сделаны либо Новые бизнес вводные приедут либо что-то поменяется Они вообще будут не нужны Поэтому вот всегда в прое в масштабах в проектах такого масштаба приходится различные решения выбирать между вот эти между времянкой и целкой соответственно первое о чём я расскажу это это менеджмент AP это как раз вот история про продуктовые процессы которые через ашку сидром общаются то есть либо там запт новую сделку либо учить информацию по сделке либо проводку запостить и так далее проблема в принципе понятна а пишки просто новые ну то есть они чуть-чуть другие по формату а может быть и не чуть-чуть и надо менять соответственно интеграции с продуктами а продукты - это как бы люди которые сидят в своих бизнес доменах у которых свои клоги они как бы продукты развивают у них как свои технические клоги есть так и в конце концов клоги бизнесов И несмотря на то что Казалось бы проект стратегический для всего банка все о нём в курсе то есть нет такого что ты приходишь они спрашивают А что это А зачем это Нет конечно же такого нет но есть история про то типа мы сделаем но через сколько-то там квартал полгода Там и так далее вот ну или же просто нет возможности или там тоже например какая-нибудь система которая под де комиссию Я думаю для многих жизне какая-то де комисси сам приходишь к потребителям они тоже де комисси и называют свой срок и он как бы тебе не очень подходит В общем подхода тут два Первое - это вс-таки заставить продуктовые системы как-то доработать причём не просто адаптироваться к новым ошка А на своей стороне сделать вот этот вот тогл чтобы по каким-то клиентам процессинг шёл в старое ядро а по каким-то в новое то есть мы прямо максимально здесь загружаем продукты а а второй подход - это на нашей стороне на стороне ядра некие маршрутизатор запросов то есть продукты продолжают по старой опиш что-то посылать А у нас есть такой йй который по нашим же правилом можешь посылать либо в старое либо в новое Ну примерно Вот так это выглядит эти два подхода то есть в первом случае продукты дорабатывается и на сй строне делают во втором случае на нашей строне есть gway самый интересное на этом слайде Вот это единственный слайд из всей презентации где я не смог однозначно классифицировать это как Таргет или transition как целку или как времянку потому что на самом деле в каждом из подходов Есть плюсы и минусы Серебряной пули тут нет то есть в случае например с доработкой продуктов кажется что уже на их стороне происходит доработка для того чтобы ребята уже опиш что-то Ну куда-то стукались но при этом им надо сделать тогл тогл в какой-то момент Да он выкинет то есть в какой-то момент всё уже пойдёт новое ядро а во втором варианте Казалось бы мы делаем лишнюю штуку вот этот вот маршрутизатор и в любом случае когда-нибудь продукту надо будет сделать новую опиш Особенно если они захотят новых бизнес свечей Но с другой стороны это морти затор это не такая уж и плохая Тема Можно как-то там логировать контролировать нагрузку чем-то управлять Ну в общем это дополнительная такая тока контро Да она же и точка отказа но и точка контроля на стране ядра поэтому на самом деле и тот и другой подход мы применяем в разных продуктах Ну в разных проектных стримах как я уже говорил у нас ядро мигрирует по продуктово то есть в разных продуктах мы так или и так делали оба подхода в принципе работают оба имеют свои плюсы и минусы это вот что касается менеджмента ашки Поехали дальше к обратному потоку на самом деле у меня так презентация построена что я не начиная с проблемы и потом так медленно подхожу к решению я сразу спойлерю прямо решение то есть я думаю сейчас будет очень понятно О чём речь обратный поток решает соответственно проблему как отчётности продуктовой аналитики которым данные нужны С задержкой Ну с допустимой задержкой в один день так и вот онлайн процессом пресловутые прям конкретно разъезжаются и по разным продуктам и по разным микросервиса по разным базам при этом есть которые говорят так у вас вот появляется одна кредитная сделка пускай будет эта кредитная Сделка на 100.000 руб вот реально масштаб банка копейки но при этом какая-нибудь вино отчётность говорит ребят Ну мы это должны к себе втащить мы не можем в ЦБ завтра дать отчёт где этого кредита не будет Ну вот никак потому что это нарушение регуляторных норм это тоже риски это тоже как бы последствия вплоть до отзыва лицензии Ну и вот какие-нибудь риски резервы и подобные банковские процессы они говорят ребят Ну сорян не получится у вас даже один кредит а сделать так чтобы он к нам не попал соответственно А что кажется какие у нас есть варианты э как я уже сказал хранилищ в банке несколько вот данные там всех кредитов Ну давайте зацепи за кредиты раз я Это пример привёл они сливаются там в разные хранилища там работают процессы Фин отчётность риски резервы и так далее И вот всем вот этим вот процессам Ну где-то есть Центральный слой в хранилищ и кажется можно доработать Центральный слой и для потребителей типа ничего не поменяется но есть и места где потребители смотрят прямо на лендинге и то есть грубо говоря это превращается в то что надо прийти там к дети и дай бог если к дети командам и сказать А вот вы тащите сейчас кредиты А вот этот вот один кредит потащит ко из другого места и адаптируйся КК новому атрибутивному составу Ну и вот короче ждать пока все вот эти вот процессы критичные переключатся чтобы получить Этот один несчастный кредит для пилота а его без этого как бы не выдать может пройти условно год То есть проходит год Ну может быть полгода год ну прям очень существенный срок Мы ждём год да плюс ещё проблемы с коммуникацией это разные команды в разных подразделениях банка проходят год все эти ребята дорабатывается мы наконец-то можем на продуктивен кредиты на новом ядре и Пилот там ну неуспешный не знаю надо там атрибутикой добавить что-то не сработало и опять ещё на год уходим на доработку Ну в общем я думаю это звучит абсолютно не жизне способно есть ещё вариант на самом деле как-то вручную тащить Вот то есть опять же просить эти 10 команд давайте вы Этот один кредитик как-нибудь ручками к себе в отчёте пропих ё Но если опять же умножать это на то что мы не там один какой-то кредит мигрирует А всё ядро вот так вот по каждому продукту просить а давайте во все отчёты Вот эту вот сделку добавите А теперь вот эту А если условия поменяются или там например мы Тестируем какое-нибудь частично досрочное погашение или полное досрочное погашение давайте Вы ещё ручками Вот завтра все ещё поменяете сумму там к погашению ну короче ну тоже не работает поэтому подход в принципе я уже заспорили это обратный поток то есть мы берём данные из нового ядра и запихивает в таком же формате как это в старом ядре лежит чтобы соответственно для потребителей ничего не менялось они данные вот как получали все так все и получают соответственно Эта история Может быть реализовано как ежедневно так и в онлайне мы сделали И то и другое для ежедневной истории соответственно есть некоторая отдельная БД для трансформации и мы написали свой фреймворк на базе apach airflow который соответственно примерно в процессе закрытия дня данные из всех новых сервисов вытягивает их трансформирует и кладёт в старое ядро и дальше как я уже Да дальше уже в старом ядре эти все данные объединяются под какой-то одной вьюшкой которая раньше которая называется так же как раньше называлась табличка из которой потребители там забирали данные либо в хранилище либо в онлайне ну и соответственно для потребителей не меняется вообще ничего Эта история становится вьюшкой потребители также продолжают получать все эти данные у них работают отчётность А мы под этим можем пилотировать там заво Ну пилотировать новые сервисы потихонечку начинать заводить новые сделки в новую систему и так далее для онлайновый истории соответственно тоже мы сделали сервис на джав который ловит соответственно события от продуктовых микросервисов и тоже в старую в старую асоку кладёт Да я не сказал что микросервисы новые они в основном работают на хореографии то есть там есть некоторая событийная модель также мы параллельно пилоти с как альтернативу Смотрим как это будет работать но пока в основном на хореографии они реализованы вот кстати интересный момент на этой схеме что если бы мы положили бы данные вот этих вот новых кредитов прямо вот туда же вдш ядра где лежат как бы данные кредитов старого ядра то они тоже бы начали процеси то есть по ним бы тоже началось бы начисление про и так далее поэтому м рядышком будет двойной прон Это вся вот эта вот история Совершенно очевидно что она временная Ну потому что ну в теории вообще так можно жить дальше то есть абсолютно все там кредиты и другие продукты вынести в новое ядро и они там просто раз в день либо в онлайне будут перекладывать в старое потребители будут жить так же и вообще можно как бы для них э у них ничего не менять но тогда как бы во-первых мы не получим бизнес вещей которые могли бы быть могли бы уже получить в новых сервисах в новых данных и отдать это потребителям Ну и во-вторых мы бы вынуждены были поддерживать всю Вот эту вот IBM историю для того чтобы поддерживать интеграции поэтому это очевидно времянка Да это времянка там условно говоря может быть на год на два и больше но тем не менее времянка поэтому переходя к к тому что делать вот с этими всеми потребителями и отчётностью онлайн процессами уже в более целевом Сета Мы пришли к тому что а давайте сделаем онлайн реплику почему Ну то что опять же данные в разных форматах разных БД их делали разные люди их надо как-то собирать Я уже всё озвучивал помимо всего прочего если есть онлайн запросы вот типа взыскания о котором я в начале рассказывал где нужно собрать вообще из разных мест данные их как-то соединить запросить и куда-то отдать Ну кажется что не хочется грузить сами микросервисы то есть мы в один Второй третий Давайте в 10 залезем оттуда дофига данных достанем как-то их покрутим может быть ещё куда-то залезем по результатам того что мы покрутили Ну в общем нагружать не очень хочется помимо этого хочется как-то централи данные проверять есть такой интересный термин называется банковская реконсиляция если простыми словами Это что-то типа бизнесов проверок качества данных что мы например хотим проверить что у нас Движение или остатки на одном счёте как-то соответствует другому счёте что у нас сумма сделок по продукту соответствует какому-то остатку на счёте То есть это именно бизнесов данных и хотелось бы делать такие централизованные проверки если данные будут лежать в одном месте это делать удобно ну и наконец в хранилище тоже хочется из одного места выгружать а не подключать там каждую бку каждого микросервиса к выгрузке в хранилище соответственно пришли к тому что а давайте сделаем онлайн реплику и при этом над данными этих всех микросервисов сделаем ещё некоторые слой абстракции опять же возвращаясь к тому что сервисы разрабатывали разные команды разные люди Да мы Разумеется ввели стандарты что должны быть некоторые обязательные атрибутика в каждом микросервис некоторые нейминг то есть этим на самом деле мы тоже Ну занимаемся и какие-то общие стандарты ввели тем не менее всё равно есть человеческий фактор есть те сервисы которые были разработаны до стандартов поэтому всё равно хотелось бы привести всё к одной какой-то красивой модели которую мы уже будем транслировать потребителям чтобы как бы они не видели вот этой вот внутрянки что на самом деле это очень много микросервисов очень много команд поэтому мы как-то берём из этих микросервисов в онлайне реплицируемый то слой где абстрагируйся над этим же слоем мы делаем некоторую сервисную прослойку куда уже могут тыкаться потребители которым данные в онлайне нужны примерно так эта история выглядит не могу сказать что мы её прямо уже успешно сделали тиражи на самом деле мы её пилотируемая тривиальная Техническая задача сделать онлайн реплику с высокой степенью надёжности собственно скорости под которой есть много БДК разных команд которые при этом ещё и активно развиваются Ну то есть как бы они продукты продолжают развиваться добавляются новы атрибуты новые фичи и так далее Поэтому вот эту задачу на самом деле уже третий подход сейчас к технологии применяем пока делаем и наконец последняя история на самом деле она даже не касается столько миграции Сколько уже выстраивание новых процессов новых фичей многие сервисы хотят переходить на событий то есть прямо вот в формате события получать что не знаю там новый кредит у клиента появился или по кредиту прошло погашение или там какая какое-нибудь особенное движение по счёту произошло то есть Ну в принципе я не думаю что я сейчас что-то рассказываю такое необыкновенное Многие хотят садиться на событий потому что это круто онлайновые удобно соответственно в сервиса как я уже сказал есть событий потому что там есть хореография поэтому мы но опять же есть проблема в том что она может быть немножко разная потому что разные продукты разные команды и всё такой и кажется что тоже нужен слой абстракции поэтому мы ещё соответственно сделали такой централизованный менеджер событий который всё вот это вот кушает что из разных сервисов вылетает какие-то навешивают хедеры какие-то трансформации хотя бы по неймингу производит Ну и в итоге в выходных потоках отдаёт всё в красивом для потребителей виде примерно так это работает разумеется это тоже целка на самом деле четыре решения хотел да рассказать что могу сказать в итоге на самом деле целью этого всего А да ещ Вот такая вот есть интересная картинка где я решил пря на одном слаке показать здесь и временные решения они больше сверху зелёными стрелками и целевые они больше снизу синими стрелками есть некоторые истории даже не знаю наверно не буду сейчас озвучивать могу рассказать в луаре когда мы из когда мы делали что-то среднее между временных решений и целевых например мы не хотим ждать онлайн реплики для того чтобы отдавать данные в хранилище потому что потребителям хранилищ тоже надо переключаться и в них это надо заряжать по проекту как можно раньше поэтому мы построили страции такой же как будет в онлайн реплике Над вот этой вот бко через которую мы делали обратный поток и из этого слоя абстракции сливаем в хранилище то есть потом будем сливать уже из онлайн реплики для потребителей Ничего не поменяется но мы как бы пораньше им отдали данные в хранилище чтобы они начали переключаться То есть это вот такой уже получается гибрид между решениями временем и целевыми для того чтобы проект ускорить а к да как я уже сказал в рамках этого доклада хотел просто рассказать Вот эту вот большую историю освятить что мы мигрирует и сфокусироваться на огромной куче решений которые мы делаем и будем делать для того чтобы а потребители тоже как-то могли к этому адаптироваться чтобы проект вообще как бы свершился и не растянулся там на 10 лет Это всё Разумеется непросто и хотел отдельно подсветить что без временных решени иногда Ну просто совсем никак то есть да мы делаем как бы историю с пониманием что она проживёт там условно говоря там 2-3 года мы её при этом делаем какое-то время но это нужно потому что без этого мы бы там не знаю проект делали там условно 10 лет то есть это действительно экономически целесообразно Ну и вот в условиях неопределённости тоже банальный тезис зачастую выигрывают пилоты mvp и вот что самое интересное что это актуально не только в продуктах Где в целом как бы постоянные пишки проверка гипотез и так далее это может быть даже актуально в ядровые сервисах где Казалось бы операционка где Казалось бы вполне там понятная история от бизнеса но относительно удалённая при этом всё равно вот в таких вот интересных проектах Мы тоже какие-то условно технические гипотезы Тестируем и делаем пилоты пишки для того чтобы проект дальше Бежал быстрее Ну собственно Именно поэтому тут я вспомнил историю с улиткой которая спешит на гору фузи а точнее не спешит Но вот нейронка на генерировать её на мотике потому что вот мы к горе фузи едем достаточно быстро А на этом У меня всё на самом деле это мой первый доклад на такой большой it конференции поэтому Всем спасибо Жду вашей обратной связи и голосов тебе первый вопрос от мирового интернета сразу как реализована отказоустойчивость в первую очередь согласованность закрытия банковского дня с учётом того что оно реализовано в разных сервисах Хороший вопрос Это фана из инте Хороший вопрос на самом деле Разумеется некоторый контроль есть если в двух словах сначала закрываются продукты потом закрывается главная книга Спасибо большое за доклад очень хорошее объяснение что такое для первого доклада это просто выше всяких похвал Вопрос вот какой у вас в каждом микросервис своя база данных ну и очевидно что там Практически любая база с такой нагрузкой справится хоть там хоть а что вы используете для онлайн реплики то есть насколько я понимаю для большого банка вот монолитная база которая содержит всё это проблема вот что у вас Спасибо за вопрос на самом деле как я уже и сказал вот эта история Пока пилотная мы решили Просто начнём с пас Гри посмотрим что что и как это будет выдерживать если поймём что нет либо начнём разносить всё-таки пог то есть получим всё-таки не совсем одну реплику но хотя бы сгруппированным если поймём что нам не хватает ПАЗ Гри Ну будем думать пока не решили потому что да понят Ну смотрели что есть на рынке но тоже история чтобы в тащить банк какой-нибудь там не знаю условно условно опять же Тарантул или какую-нибудь подобную большую историю но это тоже дорого Поэтому пока пилотируемая похожим в другом банке вот интересно как вы долго это делаете э И как долго Ну как вам кажется Когда вы закончите Да потому что иногда когда такими проектами занимаешься они становятся как будто бесконечными и в этом Ну немного удручает это всё это первый вопрос второй вопрос Когда делаешь параллельную систему Да самописец к вашему переходу на вашу систему Может можете рассказать какие у вас были с этим проблемы и какие-то лайфхаки как вот Как можно уменьшить вот этот вот боль перехода со старой системы на новую систему очень интересно спасибо большое спасибо за вопросы Ну на самом деле вот касаемо точной длительности и сроков это всё-таки nda а могу сказать что ну несколько лет несколько лет но это там не 10 лет вот на самом деле меньше И разумеется как это часто бывает Это была не Первая Попытка то есть там тоже концепция она немножко менялась по поводу второго вопроса Да к сожалению бизнес очень сопротивляется с одной стороны это как бы стратегическая история то есть нет такого что мы вот сидим там какой-то командой и у нас есть типа нужда ко всем приходить объяснять там по 10 часов что мы мигрирует и так далее э история всё-таки централизованная стратегическая она там всем объявляется все в курсе что это нужно для чего это нужно при этом как я уже сказал Разумеется всегда есть какие-то Ну не сопротивление но митч по срокам по бэклога Поэтому вот как я привёл пример на самом деле с IP менеджментом иногда мы просто понимаем как мы сами можем достаточно дёшево сделать так чтобы потребителю и любой интеграции перерабатывать было меньше ну то есть иногда мы просто сами понимаем что есть вот такое обходной и где-то возможно временное решение где-то действительно всё-таки сроки Ну согласуем продавливать и так далее где как Спасибо под свету рубашки можно догадаться Из какого банка вот всё нормально да пожалуйста А спасибо большое олев за доклад Да я тоже занимаюсь похожим другим банкам другом банке подскажи по А у тебя какой цвет рубашки у банка не соответствует К сожалению или к счастью а да подскажи пожалуйста а у вас есть какие-то механизмы там страшные слова скажу тестирование на проме да А какие-то может сервисы инструменты которые позволяют там протестировать на выделенных клиентах Да там гипотеза То есть раньше мы получали информацию из одной системы сейчас например продуктовые команды вынуждены там с пяти с десятью система интегрируется не всегда это всё хорошо получается на проме не всегда можно там на пятидесяти клиентах это проверить да А есть ли у вас банке какие-то инструменты позволяющие там сделать какую-то выборку по клиентам сделать там например предрассудок угодно это никогда не будет полностью продом а у нас на самом деле не то чтобы есть много вариантов как мы можем на проде что-то мутить потому что я уже сказал есть Фин отчётность которая говорит нет ребят у вас не получится какой-нибудь кредитик там пускай он даже копеечный что что угодно с ним делать чтобы он не попал в отчётность поэтому все пилоты вот обратный поток для чего сделан мы проводим правильно То есть это уходит в отчётность уходит во все там расчёты рисков резервов и ещё кучу процессов Но вот как я уже упоминал и ты тоже правильно сказал можно просто взять см наименее болезненную с точки зрения клиента жертву можно взять сотрудника то есть да это ВС равно будет литься в отчёты Но если что как бы это человек который хотя бы там условно говоря может его там не знаю взять погасить закрыть мы управляем хотя бы немного бизнес-процессам в данном случае то есть если только вот так вот то есть это говоря мягко говоря лояльные клиенты это не обязательно сотрудники на самом деле могут быть но лояльны клие других подходов Нет более масштабных токо наны ли каких-то там ну провести там тестовые расчёты на проме Да в оффлайне написать отдельный сервис который посчитает по-старому посчитает по-новому сравнит есть или нет различия такого у вас нету да а понимаешь в чём дело тут же речь не только посчитать то есть надо взять и все проводки запустить Ну конечно можно взять там не знаю и по 100 сделкам сделать там 100 движений по счёту а потом их начать сторнировать но это уже и по бизнесу тяжеловато и может вопросы вызывать Ну то есть это не просто что-то посчитать это надо все движения произвести Спасибо Будь добр Да Лев спасибо за доклад У меня два вопроса значит первый по подходам переход со старой системы на новую в целом выглядит как переключение рубильника причём Ну как бы с невозможностью вернуть его обратно Да поток данных в целом решает проблему Но почему не рассматривается вариант параллельного заведения в двух системах то есть какое-то время сотрудники совершают действи в Старой в новой системе в тот момент когда убеждают что всё хорошо переходит на новую второй вопросе абстрактный Почему банки как кажется отказываются от собственной разработки часто идут каким-то готовым продуктом потому что внедрять новый продукт в такую систему достаточно сложно Я услышал что сервисы универсальны то есть вопрос глобально такой сколько времени займёт внедрение нового продукта вот сейчас есть там кредиты депозиты вот появился новый продукт Сколько времени вам нужно чтобы это заработало Спасибо за вопросы они меня под загрузили нанм с первого вопро чем Ну кажется да А почему не пролен но на самом деле просто потому что опять же Это не просто какие-то расчёты это движение по счетам которые уходит в отчётность То есть как мы можем и ну как бы и в новом сервисе и в старом сервисе мы как бы делаем определённые махинации со счетами А что фино отчётность получит и там и там типа двойной Ну как бы не знаю это получится кредита условно говоря нет как вариант в принципе на самом де неплохо подрасчитал который тоже пригоняют всё в старую систему и мы сверяя то что получилось между вот этими двумя то есть на Нон проде Мы в принципе так и сделали на проде делать это в принципе целесообразности нет то есть мы ещё на Но проде это отлавливать по поводу второго вопроса Ну не знаю на самом деле как даже как на него ответить ну быстро Ну наверное это будут месяцы Ну то есть смотри что у нас есть у нас есть как бы команда у которых В связи с тем что они ядро мигрировали Они в нём разбирались они делали новый микросервис у них во-первых хорошее Погружение в предметку Ну и плюс вот история с микросервисами понятно что там очень много общего есть то есть есть некоторые централизованные трубы есть некоторые там централизованные подходы тоже к разработке подходы там к уберу и так далее То есть в принципе база для того чтобы сделать новые микросервисы есть предметною области есть поэтому Ну в принципе Просто такого нету что в банке появляется какой-то принципиально новый продукт для которого надо делать Прямо новый набор микросервисов всё-таки Скорее это будет тюнинг наверное одного из существующих очень много продуктов они вполне укладываются в текущие ядровые процессинг если бы для каждого банковского продукта необходимо было пилить свой модуль в монолитной аске ну как бы это банк бы так не работал то есть обычно как это происходит там не знаю появляется новый какой-то кредитный продукт или ещё какой-то бизнесов продукт с новыми тарифами но вот вся вот эта бизнесом оня вполне укладывает в технический сетап того что реализовано то есть прям делать для этого нового набора технического функционала обычно не надо это будет скорее всего тюнинг каких-то существующих микросервисов спасибо спасибо дай проте Дада спасибо очень крутой доклад Кирилл пфм А понятно что это очень долго дорого перспективы зачем это делается не очень очевидны на сарте Да а как выска с общение с руководством Да может какой-то топчик таких приёмов аргументов Да что вот вот или это мы сделаем или умрём пытаясь А если не будем делать точно умрём Ну вот как вы выстаивать общение с топ-менеджера чтобы они согласовали выделяли бюджеты ежегодно Я так понимаю это ну не один год как ты сказал да Ну сразу скажу что этим занимался не я но в целом аргументы Но это стоимость на самом деле потому что Айская инфра она достаточно дорогая и аргументы - это история Ну я не исключаю что во всей этой истории есть И волевое решение типа Ребята давайте сделаем своё ядро это действительно относительно уникальный на рынке эксперимент Поэтому такая часть Здесь тоже есть да понятно что это будет непросто поэтому какая-то доля вот этой вот проверки общей гипотезы типа давайте сделаем она тоже была отлично У кого микрофон А вот у меня ещё есть микрофон Стоп кто это сказал а вот да пожалуйста Голка Да спасибо дошло слово до голки вопрос первый Можно ли после распила на микросервис продолжать называть это ядром То есть это всё-таки уже не самостоятельные какие-то единицы двигающие потому что ядро - это такой термин монолитный наверно больше Вот и вопрос второй Я как там человек 20 лет назад помогавший сложиться Вот этому старому решению в райфа в мы там потратили время на то что вот дорам про этова лоскутной автоматизацией которая значит Ну вот не ложится в какую-то центральную канву сейчас это вот движение в обратную сторону всё Опять распиливает на вот такие куточки поменялось ли что-то за эти 25 лет вот в подходе к построению абсо получается тогда такой вопрос спасибо спасибо за вопросы по поводу вигоди потому что по сути именно ядровые функции процессинг как бы банковских продуктов сопровождения их с точки зрения процессинга сделок с точки зрения главной книги оно всё остаётся просто оно немножко Да разнесены оно функционирует по микросервиса но тем не менее это банковская ядро всё в совокупности - это кор поэтому А что же касается тенденций мне наверное сложно будет прокомментировать про динамику именно подходов КБС за последние 20 лет Да Рафи на самом деле я работаю чуть больше полутора лет наверное всё-таки Может быть это связано с текущей ситуацией не знаю а может быть действительно что-то меняется потому что да как бы действительно банки к этому идут и начинают писать собственные ядра может все поверили в себя будь добр пожалуйста Большое спасибо за доклад Владимир промбанк вы говорили то что у нас с разъездов получатся доменов из Монолита данные тоже разъезжаются и в ситуации когда нам нужно построить какую-то сложный Крос доменный запрос да для бизнес логики нужно какой-то источник знаний То есть вы решили сделать реплику Я так понимаю для этого да вот и вопрос Следующий Как вы разбирались с отказоустойчивости потому что у на по сути я так понял Одна база данных сервисов да И второй вопрос не рассматривали ли вы вариант синхронизации данных по шине получается вместо того чтобы обслуживать одну большую базу данных Спасибо Хорошие вопросы кстати заметил что ты сказал про экспертизу которая требуется опять же для того чтобы эти Крос доменные данные давать это тоже вообще вот история с экспертизой чуть-чуть отк от Ну пока что отве на вопро эза в этом докладе очень важна потому что для того чтобы делать все эти обратные потоки и онлайн реплики и сервисы которые эти данные дают действительно нужна экспертиза именно ядровая собственно говоря поэтому и есть отдельная команда которая управляет сервисами данных которая помимо того что делает технические эти решения она как бы имеет экспертизу по всем продуктом Потому что вот есть команд которые пилят там кредитные сервисы депозитные А вот есть команда данных которая помимо дата сеесом ещё и экспертизой этой обладает и именно как бы она участвует в том числе вот в предоставлении данных потребителям с точки зрения экспертизы А по поводу отку за устойчивости мне пока что прокомментировать нечего Просто потому что мы эту штуку ещё делаем она действительно не тривиальная мы её делаем наверное уже не первый ну не наверное а не первый и не второй месяц мы пробовали два способа с с репликации с дебе Зум и с логической смотрим в сторону ивент сорсинг Вот как раз наверное вот близко к тому что ты говоришь но на самом деле инсорсинг - это тоже история достаточно сложная И что в ней самое нехорошее это то что она требует очень сильной вовлечённости команд источника А у них как бы тоже есть свои проектные планы и заставить всех как бы вот что-то там переделать или сделать кардинально по-другому не просто поэтому это опять история про то только уже не в масштабе там а ядра и продуктовых команд А в масштабе даже внутри ядра между командами есть вот истории а как вот нам добиться того чего мы хотим Но при этом минимизируя там какие-то истории или кросс командные или бэклогом пока в этом процессе спасибо Так у нас веселье время закончилось но мы дали два микрофона давайте быстро ответим на вот эти два вопроса Сначала вы потом вы пожалуйста Да спасибо за доклад Лев вопрос Довольно простой по поводу апихит Да это как Gateway и рубильники тогл вот По какому принципу вы отбирает и почему всё же ну как-то второе решение рубильники их же мне кажется сложнее поддерживать Да и например там есть какие-то продукты в которые Ну на новые версию могут там годами веками даже переходить и вот этот рубильник тянуть вам соответственно довольно дорого и долго мне кажется то есть единое как решение gway Почему не хотите использовать на самом деле всё примерно Спасибо Да за вопрос на самом деле всё примерно к этому идёт Вот Но мы решили попробовать и первый подход тоже то есть прийти к продукту смотри там знаешь там може быть история То есть gway он остаётся Вот только вот продукт с ним общается не по старой ашке а сразу по новой то есть изменения в продуктах никто не мешает сделать даже если gway останется и мы где-то пробовали как бы это было Ну это это сработало Но это было долго Поэтому да конечно целесообразнее для того чтобы быстрее идти по проекту всё-таки Gateway и чтобы продукты вот прямо по-старому интегрировать но всё равно в какой-то моментом переделывать надо будет Поэтому тут опять же вопрос индивидуального взаимодействия вот с этой вот командой может быть лучше в них это пораньше закинуть Да они сейчас это не сделают но сделают потом Но вот короче тут всё очень индивидуально ноги Way в целом Тема да мы его используем и вишенку на тортик Добрый день а у меня такой вопрос Вы начали переделку С тех сервисов где Time to Market сократить А вот если вот начать с другой стороны делать там где вот отчётность ЦБ и то мне кажется что вы бы использовали меньше костылей То есть расшивать как бы не делать не Time to maret уменьшать Да а сначала расшить вот эти вот устаревшие костыли и потом это дело запустить вы не считали не рассматривали такие варианты Почему А я не совсем вот понимаю какой тогда будет сценарий то есть мы же переносим процессинг вот из старого Ну из старого вообще системы полностью другую систему то есть отчётность - Это всего лишь один из потребителей Нам нужно будет в любом случае выстроить отношения со всеми Ну выстроить интеграции новые всеми то есть речь же здесь не идёт о том чтобы как-то там помочь отчётности в любом случае меняется полностью концепт и нам надо все данные всем дать Ну окей спасибо У нас сейчас супер задача надо дать два сувенира первый тому кто задал вопрос инвестирующие в сообщество а второй просто клёвый поднимите пожалуйста руки кто вопросы задавали махни чтобы память освежить вот на самом деле было два вопроса про parallel R Я так понимаю один Вот был отсюда про тоже Ты спрашивал что-то про parel Run это а у тебя уже есть матрёшка есть что опять следующий нет тогда сюда просто MTS Digital подарок отличный от генерального спонсора тебя там и и оденут и даже не обут А И теперь за вклад в сообщество поднимите е ещё раз руку по Магните кто задавал вопрос пожалуйста ещё раз это супер задача тебе надо быть не просто умным А ещё и в Memory Games играть Вот со сце скажи пожалуй Вот кроме сроков про что ты спрашивал старый продукт новый продукт Какие проблемы Ну да да это это хорошая тема матрёшка уезжает в Сбер Отлично вот потом придёшь домой скажи что рейф с уважением Да тебе тоже памятный памятный мерч конференции ребята Спасибо следующий доклад здесь L"
}