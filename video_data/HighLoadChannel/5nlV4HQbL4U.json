{
  "video_id": "5nlV4HQbL4U",
  "channel": "HighLoadChannel",
  "title": "API management и API gateway. Что это и нужно ли оно вам? / Виктор Попов (НЛМК)",
  "views": 897,
  "duration": 3159,
  "published": "2023-10-06T07:19:10-07:00",
  "text": "Привет меня слышно видно поехали меня Питер Попов зовут Как меня представили да шутки про мужик ушел на завод вокруг меня встречаются какое-то время мы комбинат металлургический а не завод попрошу Вот работаю в НЛМК Не суть важно чем вообще я занимаюсь Да я на самом деле Ну как бы дивопс инженер занимаюсь поддержкой платформы в том числе Вот и собственно бегаю по разным людям с безумными идеями мешая работать что-то там придумываю э-э Вот это основное наверное мой фронт работает и здесь хочу как бы сказать большое спасибо ребятам из команды которые вот пока сейчас работаю Я занимаюсь вот этой ерундой а-а вот собственно Да мы на ВК у нас большой текст полторы 2.000 айтишников разработка классной сложный и вот э много интересной работы как бы Велком поехали маркетинговая часть закончилась А давайте поговорим немножко с Вами У кого есть API менеджмент на работе неплохо А у кого есть API какие-нибудь на работе неплохо Те кто не поднял руки что вы здесь делаете поехали Что такое Пи это определение из Википедии я не буду его читать и вы не читаете все знают что такое Пиа иначе они пришли Господи у нас есть такая штука Как жизненный цикл апель на самом деле его разные люди формализуют по-разному и визуализируют вот такая вот схемка есть допустим мне она в целом нравится Ну больше всего у нас есть три больших этапа по мнению автора этой схемы это собственно creat Control и consium Create Эта история когда мы пытаемся что-нибудь отдавать Ну то есть каким-то машинам потребителям У нас есть какой-то API может что-то придумали и собственно мы планируем как это будет выглядеть потом мы это диплоили посекьюри или там как-то отмасштабировали и оно уже на этапе Control Ну и потом приходит живые живые машинные пользователи и начинают нашими Pi пользоваться и они решают некоторые проблемы типа там дискавера там ещё какие-то штуки вот есть вот такая вот картинка она допустим разделяя этапе публичного мира в целом тоже точка зрения здесь похожая всем знакомые по дефопсу восьмерочка Ну тоже точка зрения Да есть еще вот такая вот схема которая на мой взгляд примечательна тем что здесь есть прекрасный этап ретая в конце который не упоминается собственно предыдущих схемах важное про жизненный цикл API заключается в том что На мой взгляд он у вас просто должен быть я не считаю себя каким-то компетентным чтобы я топнул ногой и сказал что одна картинка правильная другая неправильная они все на самом деле умеренно применимые Вот это мне нравится в том плане что он достаточно верхоуровневая и её можно углубить вот вроде таер Это история про то что мы планируем как мы будем теперь кейтить как мы будем мигрировать на новую версию API Да я буду говорить API простите меня пожалуйста ну такой вот у всех есть недостатки Ну и собственно да то есть как бы нам вот эти все миграции осуществлять и завершать работу IP без максимальное количество вам более для конечных пользователей и собственно Мониторинг это довольно важная часть ретарминг процесса Ну про это поговорим и собственно Почему я спрашивал да У кого есть API менеджмент потому что ну ты или живешь умираешь стартапом или живешь довольно долго чтобы у тебя появилась В2 версия твоего лапе вот очень смешная шутка Мне очень нравится Теперь давайте ближе по существу Это был такой небольшой экскурс и эти данные нам понадобятся дальше про API менеджмент менеджмент это процесс распространения управления контроля и анализа API На мой взгляд менеджмент есть у всех у кого есть апи просто не все об этом знают потому что иногда выглядит Вот так например тоже нормально На самом деле и собственно то что я хочу сегодня донести в чем вообще некоторые смысл этого доклада и цель его в том чтобы там вы осознали что если у вас нет Apple менеджмента что он у вас на самом деле есть как-то его формализовали а ещё немножко расскажу про инструменты которые вам помогут этот этап и менеджмент у себя как-то немножко возглавить в целом на самом деле в таком менеджменте ничего страшного тоже нет просто Потому что если документация не знаю там если Василий это и есть документации и вам нормально и у вас все процессы работают Ну и слава богу Господи ну правда кто я такой чтобы вас отсудить ещё апи-менеджмент на самом деле набор инструментов для создания распространения управления контроля и анализа API то есть с одной стороны это некая методология которая опирается на тот самый айпи Лайф сайкл Ну и мы как-то по этому лайфсайку движемся и по точкам себя валидируем да с другой стороны это некоторый набор инструментов менеджмент решений которых на рынке до фига мы про них немножко поговорим сравнительно но как бы термин один а штуки разные говорить буду про API менеджмент как процесс иллюстрируя на примере одного конкретного решения или ни одного конкретного вот ну и собственно встает резонный вопрос А зачем нам вообще это надо Ну вот на мой взгляд есть некоторое количество проблем которые возникают у владельцев appia и которые менеджмент решает проблемы выглядят Примерно вот так вот у нас есть история про обнаруживаемость Да мы хотим знать какие апедо доступны вообще и кому они доступны Ну и с другой стороны опять же люди хотят как-то знать что Аки вообще есть что ими можно пользоваться а не костыли что-то своё вторая история тамбординг как то есть Окей я узнал что есть там какой-то API дальше-то что идти как шимпанзе через мост чтобы спрашивать Ну хочется узнать как пользоваться API Как запросить к нему доступ как оно вообще выглядит как оно работает Ну и что делать с этим всем счастьем Следующая история про безопасность Да мы хотим защититься от неавторизованного доступа э хотим защититься от лишней нагрузки хотим защититься от Ну скажем так того что мы не ожидаем Да мы хотим максимально там формализовать эту историю а дальше история про мониторинг Мы хотим знать кто пользуется в моей мапе и собственно в каких количествах пользуются то есть здесь немножко не тот мониторинг который мы считаем Ну там не знаю живы время ответа Хотя это все мы тоже можем конечно с помощью API менеджмент инструментов делать Ну и собственно история про жизненный цикл да На каком этапе жизненного цикла у нас Апина находится вообще э-э там подготовиться к миграции на какие-то новые версии на подготовиться к прикейту всё это нам опять менеджмент инструменты позволяют и последний момент ну не для всех актуальный но на мой взгляд довольно прикольный Эта история про монетизацию да то есть мы хотим иногда мы хотим пилить пользователей нашего лаки давайте мы посмотрим в общем-то как эти проблемы мы решаем с помощью чего какие вообще преимущества менеджмента ну у нас есть удобная абстракции Мы можем взять какую-то сложную систему и представить ее более удобно То есть у нас есть не знаю что-то очень старое и мы можем сделать какое-то удобное RS представление этого старого мы можем объединить несколько разных API в один единый Ну в общем мы предоставляем некую абстракцию которая пользователю конечному сильно удобнее простота обнаружения API документация к ним история про то что у нас есть какой-то портал туда можно зайти и ткнуть нужно это и получить документацию получить примеры запросов получить не знаю контакты всё это без SMS и регистрации или СМС регистрацией если вам так хочется авторизация да то есть мы хотим чтобы наши мяты пользовались только авторизованной аутентифицированные пользователи и не пользовался посторонний тоже api-менеджмент эту проблему решает управление трафиком Ну Rate лимиты квоты там троттлинг какой-то вот все это тоже можно делать промониторинг я кратко говорил хотим понимать Кто пользуется наша маппе и от менеджмент решение предоставляет такой функционал Ну и собственно преобразование забросов Это история бьётся в удобной абстракции В каком-то смысле Ну то есть вы можете отдавать не знаю слово о папе через РЭС например просто штатными средствами какого-нибудь я понимаю системы или наоборот есть недостатки иначе было бы слишком скучно увеличивается задержка у нас появляется еще один прокси ничего с этим сделать нельзя про влияние расскажу попозже увеличивается сложность Ну то есть просто это еще один компонент и еще одна движущаяся часть это всегда не очень здорово Ну что поделать надо взвесить плюсы и минусы Ну и стоимость владения то есть API менеджмент систему надо поддерживать С ней может пойти что-то не так она может потянуть за собой всю вашу систему вот Ну такие вот такая вот цена у всего этого и стоимость владения в том числе ещё и ресурсы То есть у Вас например менеджмент система жрёт какое-то количество ваших ресурсов э ну за неё надо буквально платить если ты допустим лицензия какая-то Из чего состоит типичная система Ну в целом это 4 типовых компонента Первое это менеджмент Core это какая-то штука в которой есть логика да то есть интерфейсы вот что вообще такое API там что где Полина вторая часть это какой-нибудь портал или юань эти компоненты иногда объединяются иногда разделяются Посмотрим дальше Ну просто какая-то визуализация общения с менеджмент кором третья часть это API Gateway это штука через которую непосредственно проходит трафик что-то с ним делается и он куда-то дальше пробрасывается Ну и собственно сторож Да у нас где-то должны храниться информация об API у нас должны где-то храниться данные мониторинга у нас где-то хранится должны там данные логирование и прочее то есть в целом все это менеджмент решения состоят примерно из этих компонентов Ну там где-то они объединены где-то они более разделены но суть примерно такая а дальше буду рассказывать про на примере Gravity в основном То есть если я явно не говорю что это какая-то другая ты менеджмент система то я говорю программите почему Гравити потому что в общем мы его не выбирали пока мелька его не выбирал и так получилось что я его вот на предыдущем месте работы Немножко внедрял там забавная история в том что у нас на предыдущем месте работы Был Была перемена система но не было менеджмент-процесса а сейчас у нас есть менеджмент процесс но нет системы и мы в общем Сейчас э-э с опытом в гравите пытаемся что-то сделать но мы это нормальное решение Ну вот на его примере Будут дальше показывать Ну и просто Вот пример допустим архитектура Да мы видим что у нас есть менеджмента и это как раз тот самый корм У нас есть два портала У нас есть apegateway Ну и какую-то сторону есть дальше Ну собственно и пользовать или на этом пока не стоит особо акцентироваться вот допустим пример другой менеджмент системы это тук у него даже борт и собственно Core объединён также есть Stories есть вы вот оно всё примерно одинаковое про apegateway Давайте поговорим вообще что это такое в принципе это во многом ключевой компонент api-менеджмент системы и в целом apegateway это реверс прокси на максималках нет ничего такого что может апи-менеджмент Gateway чего нельзя сделать с помощью engines и такой-то матери Вот и как кусков всего кода более того в целом Если вы понимаете нормально понимаете свои требования собственно к apegatella То вероятно энджинсы какие-нибудь кастомные лашные или хищные скрипты это лучшее решение для Литвы которые вы можете для себя сделать потому что ну минимализм простота и прочее Но если вы хотите более навороченного решения то О'кей то есть штука которая просто пропускает через себя трафик входящий в исходящий и что-то с ним делает всё очень просто что он с ним делать-то вообще в целом У нас есть основные какие-то штуки на мой взгляд Первое это роутинг мы хотим этот трафик куда-то прокидывать по каким-то условиям вторая история собственно аутентификация поэтому немножко говорили а логирование мониторинг То есть это статистика метрики логирование запросов прочее прочее это политики довольно широкий термин который говорит что мы что-то хотим делать С трафиком применять к нему какие-то правила как-то его трансформировать Ну и посмотрим подробнее это троттлинг э-э он Ну и рейд лимиты и это допустим кэширование ответов тоже на мой взгляд это довольно важная фича которая ну как-то дополнительно тюницей которая добавляет ценность этому решению Ну вот пример роутинга да то есть у нас есть три типа роутинга это hostbase когда мы по URL по хосту разруливаем у нас есть паббейст вот он на примере Как раз Это пример из я забыл всего это haproxy у них тоже есть решение для этой менеджмента например Это вот их картиночка и у нас есть допустим header Base когда мы хотим какую-нибудь канарейку blue green делать Вот Gravity умеет всё но header Base надо писать кастомные скрипты из коробки ничего такого нет про логирование мониторинг вот такой вот прикольный пример интерфейс опять же в Гравити то есть мы просто героем все запросы видим время ответа видим что пришло видим что ушло очень удобно и собственно здесь встает резонный вопрос типа дружище У меня уже есть эластик зачем мне всё это отвечу на него чуть позже дружище У меня уже есть прометеос зачем мне всё это ну вот аналогичная история у нас есть время ответа какие-то метрики оно всё вот в таком вот удобном представлении Ну и какой-то общий овервью Да мы видим там количество РС среднее время ответа максимальная вот такие вот штуки нам в целом на примере Gravity предоставляет в качестве статистики про политики Ну вот политики я условно поделил на 4 категории первая трансформация здесь вот есть какие-то примеры да то есть мы можем трансформировать одни запросы в другие там хтмэль в Джейсон RS to Souls и так далее на нашем примере Допустим мы очень активно пользуемся Trance Frog headers то есть мы тупо явно ждем определенный список хедеров Извне к нашему приложению которое опубликован в интернет То есть мы дропаем все техэдера которые мы не ждём Но это Вот пример использования Трансформеров может трансформировать параметры запроса Ну вот такая вот магия дальше идёт валидация то есть мы можем валидировать допустим Джейсон схему А чтобы там было только то что мы ожидаем Аналогично gws можно валидировать можно валидировать просто запрос там в общем его видели безопасность Джейсон protection Это история про то что мы описываем требования к джейсону которые у нас приходят в запросе например мы говорим что не знаю массивы больше 10 элементов мы не пропускаем мы говорим о том что вложенность там больше пяти уров мы не пропускаем мы просто дропаем такие запросы и отдаем ошибку Ну вот мы считаем что к нам таких быть не должно нам так безопасно аналогичная история redext Red protection просто мы пишем регулярку все что под нее там попадает или не попадает проходит или не проходит Ну и там ipfiltering в целом у всех есть файерволы как будто бы фильтры не очень нужен silen forcemand тоже не самая популярная штука и прочие удобные штуки например трафик shadowing вы поднимаете новую версию сервиса и просто весь трафик реального приложения дублируете на новую версию сервиса и смотрите как она себя ведёт нормально всё там не знаю собираете какую-то статистику а-а мокрый спонсор у вас ещё нет но вы хотите что-то потестировать и вы на уровне API менеджмента делаете какую-то новую функционал который Ну и собственно и твоей отдаёт вам какие-то ответы э в виде оков брейкер вот буквально на тех толке передо мной рассказывали Это история про то что если у вас and Point не отвечает Давайте отдавать что-то другое дико крутая штука никто не любит пятисотки ну пользователя когда они приходят но пользователи гораздо больше любят страничку Извините у нас временное неполадки работы все закончится тогда-то звоните Спортлото вот secot Breaker позволяет такие штуки делать более того ну это можно делать гранулярно у вас не знаю один из поинтов не отвечает мы на эти запросы отвечаем заглушкой она все остальные отвечаем правильно и в целом поддержка javascrity груве скриптов То есть можно написать в целом произвольную логику обработки запросов которые к вам приходят и что-то с ними делать про аутентификацию меня попросили добавить вот этот слайд потому что все нормальные люди путают аутентификацию авторизацию естественно аутентификация Эта история про то что мы проверяем подлинность это когда я подошел на стойку сказал что я спикер Дайте бейдж мне говорят Покажите права вот права меня вот идентифицировали что я Вектор Попов авторизация - это когда я подхожу спикерскую комнату показываю чёрный бейджик и мне говорят заходи и тебе можно Потому что ролевая модель - Это позволяет Вот примерно такие штуки Не забывайте и собственно у нас офиги твои опять же на примере Гравити позволяют нам по-разному вот эти фиксировать пользователей Ну то есть можно кейс вообще без авторизации всем Можно пожалуйста заходить и радуйтесь а авторизация просто попить то есть бинарно при шарадке есть вот может быть разным для пользователя может быть общим APK есть заходить нет а пике до свидания то есть мы можем взять какой-нибудь внешнее провайдер например какой-нибудь Key Clock и через него аутентифицировать пользователей и собственно смотреть на токены и принимать Ну собственно есть поддержка airbaco то есть мы можем на основе токена на апегитвы принимать решения можно пользователю нельзя и в целом Можем даже рулить то есть если пользователю там не знаю нельзя то давайте мы очень другое покажем например какой-нибудь другое опять дадим про троттлинг лимиты да то есть опять же мы можем настраивать У нас есть квота квота Эта история про то что у нас рейд лимит за большой период времени например не знаю пять запросов в год Потому что почему бы и нет э-э рейд лимит Эта история про маленькое время допустим Не знаю пять запросов в минуту там или 5S какой-нибудь и Спайка ареста Эта история когда мы Ну делаем некую имитированную очередь и говорил что к нам пришло 100 запросов а-а прямо сейчас от одного пользователя поэтому мы первые обрабатываем мгновенно второй задержкой третий там ну и между ними какая-то задержка то есть мы фактически в очереди устраиваем и отвечаем задержкой Ну и собственно латвинности можно вернуть мой 2007 и на все запросы просто поставить 500 МС если чтобы не расслаблялись э-э ну история про допустим тестирование с медленного там какого-нибудь нравится соединения нестабильного интернет соединения пожалуйста вот очень просто это всё делается про каширование запросов собственно Ну мы можем кэшировать запросы Спасибо за внимание заголовки контент статусы настраиваем условия для кэширования важно нам нужно внешнее хранилище кэша То есть например там может быть radiss или лучше kdb Вот оно между аппетициями шарится там храни хранятся крыши история кстати с Red limit тоже можно это делать из коробки но лучше использовать какой-нибудь kway Memory для того чтобы хранить рейд лимиты так сильно лучше Вот мы посмотрели на твои вернемся к нашим проблемам вот подсвечиваем что историю про мониторинг и Безопасность из тех проблем которые я тут сама провозгласил мы как будто бы прикрыли с помощью этой игры в какой-то мере дальше у нас появляется такая штука Как API менеджмент портал тоже неотъемлемый компонент выглядит он примерно так и в целом делится на два во взаимодействия с ним довольно важных первый способ взаимодействия сводится к тому что если вы публикуете API то это как бы один Flow и на примере Gravity он выглядит примерно следующим образом мы создаем API как сущность именно сущность Гравити Мы настраиваем один или несколько планов Ну хорошо иметь план добавляем документацию публикуем обе на портал Поздравляю Вы великолепны У вас есть менеджмент системе делать это можно через графический интерфейс на кликали и поехали делать это можно API или записи погоняет конечно же и есть антибуроль я ей не пользовался она от комьюнити собственно говоря ведь но выглядит нормально по диагонали почитал и собственно документация можно макдаун выгружать можно спецификации выгружать Естественно да потому что у нас век когда мы все стандартизируем для создания 5 тоже можно использовать Open Apple спецификации конечно же и можно всякие внешние источники использовать там из Гита подгружать документацию с какого-нибудь веб-ресурса поддержать документацию очень удобно Что такое план план это представляет собой уровень сервиса поверх хайпи это такая абстракция когда мы одно и то же Ну один и тот же финальный Point можем отдавать по-разному разным пользователям например то есть разделение идёт на основе авторизации если у пользователя Один apkate он пользуется одним планом Если другой IP то другим планом например ну или на основе там девяти токена какого-нибудь и собственно у нас допустим одним пользователем мы отдаём с одним рейтинг там а другим рейми там одним пользователем мы не знаю трансформируем заголовки А другие трансформируем То есть у вас политики привязываются к плану и вы можете одно и то же Ну в конечной API не перенастраивая публиковать множеством разных способов с разными параметрами разными настройками это на мой взгляд довольно прикольный функционал и в целом эта штука она порождает такое такое явление как концепт apse product называется когда вы из какого-то Ну вот программного интерфейса фактически делаете некий продукт который вы предоставляете никому не ограниченному списку пользователей да у вас есть вот планы к ним есть разграниченный доступ соответственно вся эта магия она еще и настраивается Вы можете допустим к своему порталу как публишеру сделать публичный доступ пожалуйста любой желающий заходит регистрируется и публикую этапе еще и настраивает кому она публикует Вы можете сделать какой-то очень зарегулированный доступ Ну и собственно Да у нас был такой момент пролетайлер я на нём акцентировал внимание опять же у нас есть история про педикейшен на примере того же Гравити когда мы объявляем apitated а на него нельзя подписываться то есть нельзя получать новые аппетии для доступа а для текущих APK можно выставить время жизни там через 3 месяца всё превратится в тыкву и собственно всем пользователя отправляем письмо что через 3 месяца если превратится в тыкву вот новая версия вот так на неё перейти пожалуйста подпишитесь иначе нам вас не жалко Вот это была история собственно про то как это выглядит с точки зрения публикации API и у нас есть вторая сторона вопроса это консьюмеры у нас есть опять же портал в концепции Gravity этот другой портал почему-то и опять же мы заходим на портал создаем такую сущность как Application и подписываемся на пи план нам опять же могут быть доступны все планы не все апе планы никакие планы могут быть публичные подписался получил доступ могут быть с валидацией могут быть там по какой-то ролевой модели пожалуйста что угодно вот собственно принимаем правила пользования то есть там может быть какой-то Явный контент от вас требоваться и получаем документацию доступа вот здесь вот на примере пожалуйста вы подписали снайпе Вот ваша опеки обращайтесь с ним опять гейтвей вас кидает в наше нужно ваша Ну в нужное вам план конкретно всё здорово понятно то есть мы еще три проблемки здесь как будто бы решили Эта история про обнаруживаемость Как у Вас узнать про ваши апи И как вы можете узнать кто ими пользуется Эта история про онбординг Как понять как начать ваша мать и пользоваться И что с ним делать И эта история собственно про жизненный цикл да то есть у нас вот этап публикации Это первый этап жизненного цикла когда мы там что-то дизайнером У нас есть допустим дизайн-студии в том же гравите когда вы можете визуально там распланировать API запросы что Куда идёт и потом из этого создать То есть это можно там какой-то экспортировать и прямо ваш код затянуть например э-э вот Ну да про жизненный цикл там и Дори тайрамента это всё неплохо ложится на эту модель следующий момент у нас про монетизацию Ну рано или поздно наступает такой момент когда вы хотите там на своем опыте что-то зарабатывать она допустим публичное может быть и вот этот пример как раз из апеджи у них Вот такая вот парадигма монетизация в целом опять же Это довольно прикольное решение которое очень сильно заточено на монетизацию я бы сказал что это прямо его чуть ли не Ключевая фишка да по нашему опыту с ним работаем вот собственно какие у нас вообще модели монетизации бывает бесплатная просто доступно и доступно и часто Если вы внутри компании что-то делаете то это бесплатная вторая часть Когда вы считаете по квотам и видите пользователя по количеству запросов например то есть насколько я знаю история с авиабилетами примерно так работает когда агрегаторы опрашивают более крупных агрегаторов и там сейчас монетизация в основе количества запросов поэтому они очень не любят частые запросы и очень любят крыши история про Премиум У вас есть апи который доступен В бесплатной версии на одних условиях В платной версии на других условиях А еще более платной версии на еще более других условиях вот Ну и какие-то совсем платные API Да когда мы говорим что ну нет денег нет доступа например и соответственно это удобные инструменты это удобная точка про которую можно задуматься с точки зрения того что как с данными вашей компании могут взаимодействовать какие-то внешние подрядчики допустим да Или внешние сущности продавать данные в машину читаемом виде Это прикольная бизнес-модель Почему бы и нет а у нас вот да проблема моей ситуации тоже подсветили В общем я как Молодец огласил какое-то количество проблем самых решил вот такой замечательное решение У меня есть рубрика прочие в которой все то что не попало в остальные какие-то штуки ну во-первых про выбор решения смотрите я не очень ни к чему не призываю Мне нравится Гравити я с ним работал но в целом У меня нет какого-то сравнительного опыта хорошего на хаббре есть статья она такая немножко неоднозначная на мой взгляд Ну вот ребята сделали вот такую табличку накидали какое-то количество требований там функциональных не функциональных отказывал устойчивость в условиях санкций допустим и сделали вот такую штуку и здесь вот типа Гравити как будто бы победил даже у них они и собственно и мы пользуются но в целом тут ключевой момент я про это говорил в самом начале и повторю ещё раз э-э важно что ВВ поняли что условно есть вот этот фол-апе менеджмент а инструменты на мой взгляд вторичные одни инструменты более удобные другие менее удобные но вы берете инструмент ради вот какой-то методологии ради Flow который вы реализуете требования ваши То есть я перечислил кучу штук которые могут опевеи но нормально если вам они не нужны вообще или вам нужно что-то там сильно более простое Ну я говорю очень капитанские вещи но как будто бы часто такое бывает что вот на сцене порекламировали решение все бегут им пользоваться Вот такая вот штука да я забыл кстати сказать про мониторинг я делал сноску смотрите зачем это всё надо потому что мониторинг плотно интегрирован в портал как издателя API так и калью то есть понятно что у вас есть там какой-то свой мониторинг корпоративный там логи мониторинг метрики всё что угодно но доставка задача доставки этого мониторинга до каких-то пользователей Особенно для широкого Круга Она обычно не очень тривиальная на самом деле А здесь встроенными средствами менеджмент системы можно отдавать гранулированный мониторинг по тем сущностям которые эти пользователи создают или потребляют На мой взгляд это довольно прикольно и Да в логирование есть маскирование сенсив информации Ну написали регулярки спрятали пароли вот тоже такой очевидный вопрос про отказоустойчивость опять же на примере Гравити В целом все примерно системы по такому принципу работают видели эту картинку всё стоит ли и все не зависит друг от друга довольно настолько насколько это возможно соответственно Всё реплицируется если Ну то есть очевидно что самое чувствительная часть в этой истории это офигительный Да потому что через него идёт продавать трафик если мы не можем опубликовать и ничего страшного но если трафик не идёт то беда а Беги твои естественной реплицируется а-а Что будет если у нас упадёт допустим хранилище Ну не будет кэша будет работать он будет подтягивать запрос но кэш отдавать не будет что будет если упадёт хранилище для рейд лимитов например ну не будет считать лимиты всем бесплатно все гуляем за мой счёт сегодня а-а но важно что аппетит будет работать и будет пропускать трафик Что будет если у нас упадёт бы контаки ну ничего не будет тут Конечно уже не в силах Happy менеджмент система она может там показать вам другое бэконтаке например да И она может мониторить состояние быкан тапии и что-то куда-то переключать Ну тоже довольно удобная фича остальные компоненты не столь существенны но в целом там портал и админскую консоль можно просто реплицировать некоторых количествах менеджмент апе тот самый Core тоже можно просто отреплицировать в каком-то количестве и Ну потому что они фактически стоят если просто пишут в базу в состоянии база опять же на примере Gravity из коробки mongo есть э-э плагин который говорит что давайте поздном пользоваться логи из коробки эластик Search но вроде как всё чаще эмигрирует но официально у них пока везде ластик всё ещё числится А вот э для рейтиметов тоже по умолчанию Red limit это хранятся в монге почему-то но есть плагин опять же официальный который говорит что давайте хранить рэйтлиметы в редисе Ну и в кейдебе опять же тоже его горячо рекомендую и собственно про бэкентапе есть некоторое количество магии трансформации которые говорят что А давайте мы будем синхронный трафик играть асинхронно и мы будем гнать допустим через кавку То есть у вас есть есть инструменты которые позволяют трансформировать запросы и ответы и гонять их туда-сюда через шину данных э меня Нет какого-то живого кейса зачем это может быть кому-то надо но в целом это такая очень модная нын тенденция с точки зрения менеджмента систем э Чтобы это делать через сказку бкндэпе опять же могут быть в целом любыми да то есть grpc rss ttp а важно что ну то есть э-э Кафка В общем в качестве бэкэнда можно подключать ещё и всякие очереди то есть там может быть там может быть Кафка просто спортивная Но для потребителей этой истории исключительно htпичная это прям важно то есть вы отдаете именно http-шные отвечайте на http-шные запросы в том или ином виде по отказа устойчивости кажется все рассказал по производительности здесь будет сильно менее информативный слайд Чем вам хотелось бы потому что и depends в целом плюс-минус одна две миллисекунды просто за то что вы добавили еще одну прокси ничего с этим не поделать К сожалению такие времена Вот и соответственно если у вас какой-то ультра супер хайлоут Когда у вас не знаю торгуются на бирже что-то очень быстрое то возможно вы хотите сократить количество систем и это тоже нормально масштабируется Ну Гравити конкретно написано на Джаве и масштабируется он вертикально лучше чем горизонтально Ну в том плане что до каких-то пор по крайней мере лучше докинуть ресурсов на гейтвей чем делать Много мелких гейтв вот по каким-то рпсам сильно зависит от того Какое количество политик вообще накладываете потому что очевидно что у вас какая-нибудь магия с криптографии там девяти допустим там ssl всякая магия она требует процессор чем её больше тем больше процессора вам надо а трансформации запросов требует память потому что вам этот запрос надо целиком положить в память что-то с ним сделать рядом в памяти и собственно отдать пользователю дальше Вот здесь у меня по всем бенчмаркам не знаю всегда стандартный вопрос Если у вас что-то что очень требует как производительности серьёзные не слушайте мужиков на сцене Возьмите и Посчитайте блага это не самая сложная задача э ничего лучше Никто не сделает чем вы под свои задачи Ну и логирование жрёт место жрёт Нормально э-э ничего с этим не сделать включать гранулировано Мы например там логируем и всё А использовать как диагностический инструмент то есть дефолтная политика что логирование выключено на гейтвы А если вдруг надо то собственно логирование можно включить и что-нибудь по дебаты конечно прелесть ну и эта штука естественно в плане логирования интегрируется с трейсингом То есть вы можете взять рейтинг систему подключить не Gateway в том числе он будет там всякие добавлять и все это будет везде смотреться здорово и замечательно по отказа устойчивости Хотя в одну штуку еще сказать есть небольшой нюанс мульти тендентности Ну во-первых вы можете в целом в парадигме апе менеджмента как будто бы есть централизовано это гейтвей как сущность и на него намазана куча API э Ну по крайней мере все в архитектурах типовых рисуют Так мы делали сильно по-другому мы делали APS сергейтвей мы множили гейтвы они были как бы в собственности команд которые владеют конкретно майки то есть есть механизмы что гейтвей вытягивает только те правила которые релевантны конкретно ему и мы этим довольно активно пользовались это сложновато менеджер и конкретно в случае с Gravity есть болезненная точка что апегейтвейну нужен доступ в монгу Ну хотя бы на чтение Да чтобы не хотя бы а на чтение чтобы считать политики вот там нет мультитанальности соответственно у вас у каждого гейтвы пароль от монги который может почитать все политики это такая точка комплементация Мне она не нравится коллеги говорят что если использовать то там можно поделить по пользователям чуть ли не по таблично и каждый гейтвей читает только те правила которые ему нужны и главное не может ничего другого почитать звучит как менеджмент усложняется но кому-то может быть это надо вот про встает резонный вопрос Да думаю у многих у меня уже есть сервис mash Зачем мне все это звучит до более похожее немножко разные задачи решает соответственно сервис mash у вас находится внутри инфраструктуры сервис mash у вас решает задачу Восток Запад апельки решает север юг то есть это такой сквозной трафик от пользователя апекейтвы более специфичны под какие-то штуки они знают только то что они знают в отличие от мыша который знает всю топологию да и это часто избыточно и собственно работает на уровне приложений и важно что он применим К любым приложениям и любой инфраструктуре потому что ну говоря Мэш Мы в целом подразумеваем что это кубер И меж внутри этого кубера Если у вас есть какой-нибудь API на виртуалке не знаю вообще в другом DC то apegateway туда может пробрасывать трафик А с мышом надо немножко повозиться для таких ситуаций и в целом ну еще и Мой ход Take сводится к тому что мыши на самом деле нужны гораздо меньшему количеству людей чем им пользуются потому что это дорогая система это сложная система и очень часто мыши внедряют ради какого-то части их функционала и в общем-то возможно Для вас менеджмент система какая-нибудь решает тот же функционал но в целом дешевле и Мэш вам может быть просто не нужен нормально не иметь Мэш 2022 году А такие вот тезисы прочее У нас есть русскоязычная грабить сообщество оно не очень живое в тележеньке но там отвечает на вопросы Антон Козлов Привет Спасибо за помощь в подготовке доклада И на самом деле в рамках программы Краткость сестра время вопросов видите Спасибо тебе большое друзья поддержим поддержим поддержим Вот вот фанфары и благодарность слушателям я Напоминаю что у нас есть онлайн чат туда наши онлайн зрители могут постить вопросы Так давайте начнем отсюда поэтому у меня уже есть онлайн вопросы и перейдём потом вот туда вот Спасибо за доклад у меня такой вопрос то есть наш бэкенд может так Да нормально из коробки имеет Просто теперь надо взять собственность вам надо Когда вы создаете API взять политику Ну собственно создать на опеки твоей политику и настроить эту трансформацию то есть магии Нет к сожалению Но есть инструмент Ну код надо будет писать я не Я теперь просто не делал Поэтому сходу не скажу вот возможно оно как-то автоматически работает вот который напишет я мог программист возможно Вот кстати в продолжении вопросы из онлайна очень ну продолжает идею А если возможность какая-то Техническая описывать настройки для этого в репозитории бкнд-сервиса чтобы сервис тебе пробрасывал все настройки и вот это типа магия происходила не вижу Проблемы в том плане что мы можем тепло и ничего не мешает на этапе брать какой-нибудь файловый репозитории Где у вас какой-то бэк не подписан и собственно применять эту конфигурацию на вашем менеджмент систему на мой взгляд здесь есть некоторые моменты которые зависят от Ну там от вашей вот этой не знаю API конфигурации в целом Потому что далеко не всегда в случае сапименджмент системой 1 API в терминологии API менеджмента и apkv это 1 БК и тогда стоит вопрос А где это всё дело описывать если у меня там не знаю мёрзнут ответы из двух разных appi они там как-то сшиваются что-то делают кто-то кого-то опрашивает И от кого-то зависит тогда это отдельная сущность Но если 1:1 то идея хранить конфигурацию там же я по этим хорошая но при этом эта конфигурация должна быть чётко в Ну формальном языке описание конфигурации это говорит ой то есть инструментов там не знаю свагер тью ipadway configuration каких-то не присутствует там есть история про создание API из свайгер спецификации но допустим если Ну то есть ваши спецификации ничего не знает о как трансформации там не знаю заголовков условно поэтому вы описываете да То есть вы описываете но этот же сон по-моему Гравити вы описываете какую-то jsony в которой описываете ваш API но просто этот же сон можно изначально сгенерить там из своей спецификации и как-то их вместе спасибо Вот с правой стороны третий ряд второе место Здравствуйте у меня такой вопрос с точки зрения внешних пользователей Можно ли сделать таким образом чтобы внедрение прошло бесшовно для внешних пользователей Можно ли сохранить статику и никак не тревожить смотрите да то есть ничего не мешает взять на него какое-то количество правил сделать условно и просто в какой-то момент переключить DNS запись чтобы трафик теперь шел через 5 если все правильно настроено никто ничего не заметит второй момент что допустим внутри этой уже какие-то переключения можно APK не генерить а задавать руками То есть если допустим вы пользователь переключаете на другой план каким-то образом неведомо для него вы просто на новый план старые ставить а старый план удаляете Все сработает бесшовно третий момент есть история про то возможно вообще генерить APK PR пользователя статичный который будет если пользователь пользоваться несколькими API то опеки будет все равно один допустим да и он по разным поинтам будет на разные планы попадать Но вот такие штуки они есть да спасибо большое друзья третий ряд вот здесь вот где Ну ладно следующий классная шапка здравствуй Виктор спасибо за доклад Вы очень много времени уделили длительному жизненному циклу обеда в самом начале и при этом возникает вопрос и вот как в таком достаточно простом портале который мы видели она не поддерживается смотрите она поддерживается разные местами Вы можете если у вас допустим Breaking изменения то вы выкатываете новую версию этой как новая и собственно теперь старая пользователи получают инструкцию как перейти на новые если у вас какие-то минорные изменения добавляются новые новые функционал допустим какой-то то там есть прям механизм версионирования То есть как это работает Вы когда меняете на портале изменения мгновенно не докатываются такие твои У вас есть кнопочка То есть вы что-то наделали передумали сделали еще нажали поди ловить выкатилась новая конфигурация вот эти вот изменения они версии они руются внутри apegateware и консьюмер может видеть историю То есть он такой так вот в этом обе изменилось то-то ну именно настройка там не знаю снизился лимит поменялся добавился какой-то новый путь добавился там Обработка чего-то то есть пользователи это видят Вы можете их оповестить о том что вышла новая версия API смотри документацию там где ты обычно смотришь документацию и собственно они её посмотрят и увидят версионирование и историю изменений а когда несколько версий API должны одновременно поддерживаться причем достаточно много как это в интерфейсе выглядит На мой взгляд у вас в таком случае то есть как бы мажорная ломающая версия API это просто новая API либо новый план который ведет на какие-то другие поинты в зависимости от религии Спасибо большое Так немножко Ответ вас не удовлетворил кажется разбавлю вопросы из офлайна вопросам онлайн очень интересный вопрос очень интересном кейсе применения А может ли инициатором выступать бкнд чтобы бэкент ходил в опеки твои А уже пигги твои проксировал запрос бэкэнда на сторону какого-то партнера но смотрите в теории Да ничего не мешает вам не обязательно Когда вы создаете системе в качестве указывать в вашу систему в общем-то ничего не мешает на какой-нибудь публичное Яндекса настроиться и у вас будет внутренняя абстракция которая там за вас ходит какой-то внешний другой вопрос что в целом мне кажется в конце Как таковой если ваша куда-то ходит типа там вся история проходят к вам мне так кажется картинка из буханки хлеба нужно сделать то есть таким образом Да можно настроиться просто на внешней API и пользоваться им четвёртый ряд молодой человек давно руку держать уже задали Всё тогда человек вот в шапке классный Я ему четвёртый ряд Следующий вопрос Привет Спасибо Да у меня вопрос по поводу хранителямитов в вы говорили что лучше использовать внешнее хранилище мне интересно вы имеете в виду хранилище если партнёров много Просто если их мало то как будто бы лишняя латте накидывает на проксиум и как будто бы от каждого устойчивость повышается если она будет локальная в Питере смотрите она не сломала партнёров она не во-первых она она не локальная просто по той причине что у вас опередит в реплицируются И вам надо говорить лимиты сикать А офигейтвей про друг дружку ничего не знают это всё фича да то есть это прямо так задумано Поэтому если у вас ничего не настроено то он будет иметь и хранить в мозге что На мой взгляд довольно интересная архитектурное решение Поэтому лучше поднять редис использовать его потому что заведомо быстрее для рейтинг О'кей Да еще вопрос по поводу того что получается вы выкладываете с конфигам каким-то ямбургским epicway и можно изменять в интерфейсе Как вы соблюдать Ну проверяйте то что версия в репозитории и версии в вейпе одинаковые Ну то есть получается настроек смотрите если мы говорим про то как было там сделано у нас то это просто некий языком и в интерфейс можно смотреть но там нельзя трогать например да то есть ты говоришь что у тебя вот источник Правды в детей если что-нибудь накликало в конфиге То придёт с ac/d-система или там не знаю не топ система и вернёт всё как было э-э Вот примерно так решаем если мы говорим что это некий публичный портал который доступен к широкому кругу лиц то это их головная боль если они хотят накликивать то слава Богу Поздравляю О'кей понял спасибо большое второй ряд девушка Спасибо большое за доклад хотела уточнить Почему ваша практики было принято решение множить пропорционально бэк-эндом getway Несмотря на то что как вы сказали можно было бы обеспечить разграничение политик разное переехав с манги на постгрис во-первых про то есть проблема была не разграничения это просто некое следствие того когда у тебя Гейтс много Почему мы хотели множить гейтвей потому что не хотелось сделать так что если один гейтвей Ну не знаю один сервис дико нагрузили то он точно не влияет на другие прямо абсолютно точно то есть мы на уровне гейтвы обеспечиваем гарантированность ресурсов конкретному API вот у нас просили мы сделали В общем примерно такая идея делается Ну то есть это не очень удобная с точки зрения менеджмента решения но зато вот такое свой надёжности дополнительно появляется уточнение из коробки предоставляет репликацию то есть они вообще ничего не знают ни о ком Как работает gitway он стартует идет в монгу вычитывает конфигурацию и просто работает потом он идет Не знаю в редис считает пишет рейд лимиты если это нужно там есть кстати довольно такая дурацкая история не знаю пофиксили нет новых версиях короче там довольно сложно сделать Ливны с пробу Да Ой redden испробу на гейтвей потому что у тебя допустим Ну энтри-паф уникальный получается да для каждого гейтвы и пока гейтвей стартанул но не вычитал конфиг он отдаёт задор на 404 просто на запросы и ты либо городишь вот эти вот уникальные рейдин из пробы э либо просто дурацкое решение не знаю дилей 3 минуты на старгей твоей делаешь На стартерберга если их много то не страшно то есть типа холодный старт медленный Зато на горячем старте тебе всё равно мы так сделали спасибо большое разбавлю ещё одним онлайн вопросы а есть ли у Гравити возможности разделение троллинг в политик по клиенту смотрите вы делаете планы на планы настраиваете разные троттлинг политики и разным клиентам даете разные планы но при этом в зависимости от параметров клиента например от типа устройства и каких-то других метапараметров мы не можем это сделать смотрите есть груве скрипты в целом Вы можете читать то есть я думаю что можно методом магии раскидывать клиентов по планам на основе например там не знаю какого-нибудь хедеры Там типа устройства Например я так не делал У меня не очень понимаю как это прямо сделать но я почти уверен что так сделать можно эти филипы вопросы пожалуйста наверняка Я задал раньше Вот первый вопрос по поводу как разгрузок скриптов что там сверкционированием сложными диплоими становится частью вообще говоря бизнес логики вот что там с диплоими то есть могу там оттиплоить только на части офигитлеев в зависимости от пользователей вот это вот всё откатить груве скрипты это тоже политика то есть в целом почти всё что я описывал это просто политики да Ты создаёшь план к плану цепляешь в политику в ней какой-то груве скрипт другая политика другой скрипт то есть могу выделить там тест на них тестовой политику Если всё хорошо раскатать Вот и второй вопрос Если опигитвы для асинхронного взаимодействия Когда например у меня там какой-нибудь Кафка Не дай Бог наружу торчит пока что хочу получать смотри в сокетами оно работает я не делал но узнавал бы такой запрос а-а если задача опубликовать голую кафку по протоколу Кафки наружу то нет потому что эта история про http как транспорт все-таки Да это из пяти транспорт все тогда давайте последний вопрос вот один отсюда и второе из онлайна остальные в дискуссионной зоне Добрый день У меня два маленьких вопросы первый это каким образом вы реализовали песочницу которую в портале именно доступно попробовать задействовали ли вы при этом бэковые системой или делали какие-то заглушки особенно в процессах где процесс состоит из вызова нескольких И второй вопрос Это Каким образом реализовали сертификацию чтобы человек опустить в рот смотрите мы на самом деле у меня с как я говорил что на предыдущем месте работы мы пользовались А здесь у нас есть методология но мы пока не пользуемся и конкретно там у нас была история что у нас не было вы А ты портала из-за сервис мы его не предоставляли то есть у нас была некая форма тикетов который из которой мы делали на отдельном гейтвей а отдельный набор политик вот такой вот не очень изящное решение Ну то есть сертификацию на данный момент никакой нету да ну у нас у нас нет и в целом мы считаем что я там в этом плане верю что типа разработчики понимает что делает или должен и если он хочет выкатить не знаю кривой конфиг впрот то это его полная правотирует он на вашем тестом контуре Да у нас есть просто тестовый контур Гравити но куда можно там выкатить допустим там какой-то промежуточный конфликт поменять что-то в апель поменять что-то в версии поменять что-то в конфигурации и посмотреть что будет я информация о нём расположена на продавцом портале Нет два разных два разных решения допустим задать этот вопрос дискуссионной зоне вот вопрос онлайн Давайте можно преобразовать https с ошибкой к одному виду например один бэк тебе отдал 404 год а второй бренд отдал 200 код Но в теле в Боди э-э какой-то Джейсон с ошибкой Ну смысл один и тот же ответы хочется клиенту отдать ответ в одинаковом формате А смотрите я я не делал но думаю что да Потому что трансформация ответов там тоже есть вот меня кивает что можно так делать значит можно Ну и в конце концов типа груве скрипты уху Ну во-первых да я дополню кровью скрипты во-вторых вот там замечательная табличка которую ты показывал про сравнение там некоторые решения это даже сложно назвать IP Gateway это вполне себе Enterprise Ну интерпрайз-сервис баса который позволяет прямо закладывать логику модификации ответов в такую и угодно а ведь Спасибо тебе большое У нас есть традиция нам нужно выбрать самый лучший вопрос и дать за него подарок можно онлайн можно офлайн онлайн тоже мы как бы подарочек отдадим Я что-то Отвлёкся и не запомнил вопрос на самом деле наверное мне понравился вопрос про сертификацию и про песочные вот молодому человеку соответственно подарочек второй ряд второй ряд вот то есть вот вот здесь второй ряд Ведь мы тебя благодарим за прекрасное выступление за доклад от программного комитета от организаторов конференции тебе памятные призы подарочки чтобы ты на них любовался и чаще приходил к нам на конференции с прекрасными докладами Спасибо Спасибо большое друзья Спасибо за внимание"
}