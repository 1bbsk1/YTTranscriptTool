{
  "video_id": "H9U91WfgLYA",
  "channel": "HighLoadChannel",
  "title": "Antispam ML: как и зачем автоматизировать обучение моделей / Дмитрий Меркушов (Mail.ru Group)",
  "views": 1512,
  "duration": 2924,
  "published": "2020-04-27T12:06:56-07:00",
  "text": "да действительно меня зовут дин меркушев я тимлид в команде машину обучения антиспама почты mail.ru одни расскажу вам о том как мы соответственно так это я могу снять зарядки на эту сейчас как мы автоматизировали процесс обучения наших систем для чего мы это делали с какими сложностями столкнулись и почему это может быть полезно в том числе и вам до в первую очередь вам как пришедшим сюда послушать меня заранее прошу прощения за мой не совсем здоровый голос на 10 не помешает вам усвоить основные концепты которые собираюсь донести до давайте наверное начнем с того что вообще поговорим о том что такое что мы сегодня будем что мы сегодня посмотрим в первую очередь поговорим о том что такое общая задача машинного обучения монти спаме чем она категорически отличается от большинства других доменов применения машинного обучения кстати поднимите руку те кто не имеет дело с систем машинного обучения в продакшен будь то не знаю почта будь то пользователи будь то люди зубами ну то есть кто не имеет окей достаточное количество на самом деле тогда вам просто в назидательный целях рано или поздно я уверен вы дойдете до система сможет до систем машинного обучения в породе и будете понимать какая то боль но как и приятно решаете как вы решать эффективно соответственно поговорим о том что такое машина быть у него нити спаме какие ключевые факторы успеха для эффективного решения задач антиспама с помощью машинного обучения поговорим более подробно про два основных наверное факторы успеха это то как мы формализовали себя концепцию обучения наших моделей вернее до обучение наших моделей почему мы это сделали как нам это помогло и также соответственно как мы с помощью пользовательского фидбэка смогли автоматизировать этот процесс до регулярной основе вот и освободитесь много ресурсов рук и вывести эффективность на новый уровень соответственно в конце мы зафиналим сам таким небольшим рецептом для всех разработчиков эмаль систем то как на основе нашего опыта мы сейчас подходим к созданию систем машинного обучения с нуля ok поговорим до машины обучением эти спаме что это такое начнем с некоторое количество цифр в первую очередь это полтора миллиарда писем в пользовательские ящики для нас это хайло для нас это существенное ограничение для наших систем но мы рады с этим жить если бы ты был михайлов я бы здесь не стоял вот соответственно пользуюсь к аудитории у нас это примерно 30 миллионов в дели на дневной аудитории мы надеемся что мы наша система делает их счастливее верни ему этом уверен и вот и на страже этих пользователей трудиться там больше десяти система шину обучения там систем систем не какие-то там разрозненные классификатора концепции которая приходится поддерживать и постоянно развивать вот и мы надеемся что эти системы соответственно помогает пользователям ну как-то устраивать свою жизнь почте гораздо эффективнее лучше и чище в первую очередь зачем сама сделать ящики чище давайте сразу синхронизируемся по поводу того как не решается задача машинного обучения vadis помине она не решается моделью наивного боится на бегу forts чтобы нам не говорила курсе рано говорит что надо делать именно так вот отделка не так к сожалению делать это надо иначе у нас на страже пользователей прям зоопарк модели исторически мы начали с линейных какие-то из них до сих пор дожили до сегодняшнего дня и показывают свою эффективность поэтому у нас нет большой нужды их спиливать в потом исторически мы перешли на абуз тенге над деревьями таким образом действительно удалось там существенную эффективность повысить и в конце концов мы тоже никуда не делись от глубоких мир сетей которые в основном обрабатывают контент в целом на каких признаках на каких данных у нас модели работают но это в первой через контент письма то есть чтобы разъем под контентом текст и картинки атаки url и помимо этого на самом деле есть еще очень большой пул признаков сильные это место признаки на письме и они на самом деле раз сильнее чем текстовый то есть чем контент на и в целом что такое это признаки то эта информация которую мы у себя знаем про отправителей про получателей про соответственно tom & peace который идут рассылки и так далее это очень сильные признаки на которых мы соответственно ориентируемся все это вместе с моделями складывается в один большой зоопарк систем машина вообще него не спамь и соответственно опять же может быть расхожее заблуждение что антиспам это такая скучно задача точки зрения машины обучения нет ни разу потому что мы сообщи каждой недели не похожи на предыдущего постоянной новой задачи постоянные новые ну проблемы которые для нас в итоге становятся новыми задачами да вот так к этому относимся это прикольно потому что никогда не стоим на месте над ним и над одним и тем же соответственно какой-то момент никто кроме нас уже не может лучше ответить на вопрос а как еще сделать эти антиспам лучше поэтому мы становимся в принципе в некотором смысле продукт менеджерами тех историй которые мы доводим до пользователя то есть одно дело да круто решить задачу которую он пришел дядя другое дело круто решить задачу которую делась у вас голове вы продали довели до пользовательского счастья в принципе то очень круто это очень нравится вперед и немаловажный фактор того что это не скучно этот тот факт что мы замкнуты в внутри собственной инфраструктуры которая позволяет нам сделать две вещи во-первых минимизировать time to market то есть доставку наших разработок до пользователя и во-вторых минимизировать рейтер тех усилий которые мы кладем стол на самом деле сейчас он сведён примерно к нулю это очень все не любят да наверное трудиться трудись трудиться потом положить свою модельку в стол вот у нас такого нет благодаря инфраструктуре мы в принципе готовый диплом все то что у нас так или иначе получилось хорошо в наших в нашем research а вот ну и наконец на самом деле только что мы будем дальше развивать машин обучение vadis помята очень непростая задача в чем здесь основные в челлендже сложности но в первую опять же не в порядке приоритета то есть скорее просто по пунктам до holod как я говорил ну просто это определенное ограничение для нас мы должны убеждаться что наши модели допустим действует в строго отведенных таймингах noise в особенности на inference хотя очень часто и на обучение тоже вот ну inference в первую очередь да то есть поскольку мы должны принимать решение онлайн то мы обладаем там весьма сжатым таймингом на котором должна успеть все узнать про письмо про пользователя про отправителей так далее все наши весь наш папа ит-систем должен большинство но большинство моделей из этого pipe они должны отработать онлайн там до в тот момент когда письмо летит пользователю помимо всей остальной логики как там не только машины обучения работает вот помимо этого все наши модели основаны в первую очередь ну естественно как любую модель машину обучение основано на выборках мы пришли к тому что выборки мы берем из того тех сигналов которые посылают нам пользователь увидит своего фидбэка здесь есть проблема фидбэк этот очень шумные пользователи разные по-разному воспринимает те кнопки которые не могут те сигналы которые могут нам послать соответственно просто так братья учиться на этом мы не можем нам приходится это фильтровать о том как мы это делали тоже немножко расскажу и главное пожалуй штука которая отличает машины обучения выньте спаме от прочих доменов применения машину обучение the human adverse или то есть это реальные ребята на той стороне честно моя задача является минимизировать эффективность наших усилий и вот это прям боль для нас для наших систем для наших задач и это там не знаю 50 процентов наших мыслей сосредоточено том как не просто решить задачу в моменте а сделать это так чтобы она была эффективна в течение долгого времени не смотря на то что та сторона будет пытаться адаптироваться да вот подробнее наверное поговорим про ему на дверь сыре какие это особенности вносит задача ну в первую очередь это очень быстрая адаптация на наше решение то есть происходит примерно так что мы можем адресовать какую-то проблему на потоке нашей разработкой в течение приличного количество времени вложить много ресурсов всяческие измерить получить оффлайн метрики они по ней онлайн метрики по ней и в конце концов прийти к тому что мы и даст знаем что мы от нее ожидаем дипломы и и наблюдаем эффект примерно сравнимы с тем что мы ожидали всем этому очень радуемся хорошо все круто а потом бац и и там через некоторое время зависимости от системы это время может быть разным мы наблюдаем в резкую деградацию онлайн метрика это значит что произошло адаптация вот поначалу мы просто с выпученными глазами наделал смотрели не понимали как же так столько усилий вложено и тут вдруг разум там буквально мгновение ока это дело резко деградирует вот это как раз особенность того что на ту сторону пришли сигнала относительно событий которые у нас происходят то есть они видят что меняется ситуация там доставляемость писем ухудшается письма папку спам кладутся меньше больше вернее и таким образом им тоже нужно делать свои шаги и вот это в итоге приводят к там постоянной гонке вооружений кто быстрее тот и прав тот имеет реально больше шансов на конечный успех вот что здесь еще можно сказать что модели в целом деградирует безотносительно даже him он отверз или просто в данном случае это происходит быстрее на самом деле там любой любая система но обучение в будущее там однажды обучены за тепло и на имеет какие-то метрики до онлайн и неизбежно будет происходить с течением времени одна из двух вещей либо и и абсолютные метрики будут держаться на уровне но и и относительные метрики вы просаживаться потому что ну просто на потоке новые паттерны неизбежно появляются либо соответственно ее абсолютной метрики будут просто деградировать и такое тоже может быть вот все связано с тем что новый паттерн и появляется при этом когда у нас есть him an order совете новый паттерн и просто появляется в разы быстрее соответственно нам с этим приходится жить и бороться на сайт и все это очень похоже на недавние через от фейсбука там и соответственно как там странные люди меняются имени очень стороны люди меняется за 10 лет вот некоторые меняется драматически как например кейтлин дженнер да она или он поменялось там предельная сменив имя прическу главное палатки ну в какие-то ненужные части тела вот спаммер все гораздо проще с этим они и вот мгновение ока могут поменять пол цвет кожи я не знаю возраст имя все что угодно и нам с этим всем приходится жить чтобы пользователям это все равно не пропускать ну как это выглядит проиллюстрирую немножко там на конкретном примере была проблема там timeline до слева направо идет была проблема на потоке иллюстрируется зеленой метрикой долго пилим решение на кольцова выкатываем красная черта и радуемся наблюдаем там резкое уменьшение спам нова паттерна круто значит мы добились того чего хотели примерно там соотносится с тем что мы ожидали а потом вот в данном конкретном случае проходит по моему часа три-четыре да вот и все возвращается на круги своя мы расстраиваемся и как бы не против делать столько усилий вложено но в данном случае нам удалось достаточно быстро переобучить модель а потом мы поняли что мы не хотим каждый раз при тепло и новые модели спешно через 4 часа и и снова переобучать а потом возможно еще раз снова переобучать и так бесконечно гоняться за собственным хвостом поэтому нужно было как-то к этой проблеме подходить иначе и исторически мы подошли к ней без машинного обучения то есть общие исторические barbasol спам происходил без машинного обучения у нас по крайней мере в команде соответственно были какие-то перешел teens которые вручную глазами руками реагировали на всплески патронов на потоке всплеск означает по сути новый паттерн до который нужно закрыть какие инструменты для закрытия ну эвристики регулярке все это приводит к тому что ну там каждый новый паттерн это новая регулярка но вы эвристик они копятся это становится таким монстрам саблезубом который вообще невозможно поддерживается он там с течением лет на перерастает сам себя там крошиться по-разному все это похоже на самом деле на стремянку из костыли по которой мы карабкаемся карабкаемся карабкаемся и там естественно более падаем с неё подъема в тот момент когда этот подход ну опирается в потолок под потолком для подхода является очевидный случай когда паттерны и появляющиеся уже сложно обобщить глазами ну то есть вы смотрите как бы дать что-то там общая есть а вот как это сформулировать 1 эвристики уже не очень понятно вот естественно спам до того до такой стадии эволюционировал ну там относительно быстро там на горизонте может быть пару лет и в общем пришлось подходить уже со стороны машину обучения поспешно нам на помощь в этом случае три основные вещи которые позволил нам машины обучения сделать ну в принципе как за что мы все любим машины обучение в первую очередь счас высвобождение большого числа рук то есть мы смогли и разгрузить те толпы людей которые глазами смотрели на потоке все самые миллиардные потоки писем нашим пользователям на какие другие более эффективной задача ну другие эффективные задача антиспама то есть не только же классификаторами вспомни спал много чего можно делать вот при этом что мы получили взамен мы начали обучаться на правила которые были написаны те самые в листики да и наблюдаем такую ситуацию мы имеем и эвристику который закрывает x проблем новая обычная система закрывать 2x проблем круто а когда мы начали обучаться на там сотнях и тысячах накоплены в таких в листик мы получили какой-то экспоненциальный рост и сами были в шоке потому что первые тепло и происходили примерно так мы оценили онлайн там типа что будем закрывать так то эту штуку мы выкатываем и в течение недели на подминает под себя абсолютно все там и доводит свой recall на порядок выше ожидаемого нами изначально и это конечно очень круто после это стало понятно что имели то раз и навсегда средства для всех бед выданы в данной конкретной ситуации и 3 point который мы здесь приобрели заключается в том что у нас появилось ручка то есть мы теперь могли не просто закрывать новый паттерн написав еще одно регулярку дали эвристику мы смогли как бы сделать так что в принципе да тюнить модель на новый паттерн а то есть мы конгресс грамм новый паттерн а еще что-то приобретаем сверху и все это в рамках той самой при не модели что случилось давайте вернем картинку вот на я пока продолжу в общем таким образом сделали так что у нас водолеи эволюционирует за счет просто правильного подхода да то есть раньше приходилось пилить новый новое новая теперь фиксируем то что есть и просто его равномерно развиваем скажу без лайдаки как это не надо делать как вообще не надо подходить к решению задач машина обучение долго не буду на этом остановимся на делать примерно как коглда то есть одна сложная модель который мы пилим долго там ансамбль и ruim я не знаю пустим все что угодно там последние минуты получаем прекрасные метрики на всех возможных сетах открытых скрытых от нас вот радуемся 100 процентам метрикам на выборках вот так делать не надо ну понятно да все знают почему типа это сложности production на самом деле нет зависти protection и когда у вас есть своей инфраструктурой за плечами такой гигант как mail можно в принципе все что угодно вопрос два других ответ на вопрос почему надо делать во первых стопроцентной метрики на выборке вот как говорил как говорил в предыдущем докладе да не надо их вылизывать потому что у нас мы можем сегодня закрыть сто процентов завтра появится новый паттерн который модель уже адресовать не будет а придется вкладываться примерно столько же соизмерима и количество времени который мы вложили в изначальную модель для того чтобы прийти к успеху и соответственно мы пошли немного другим путем мы начали с простых относительно простых моделей машинного обучения быстро их доставлять до поклеп для пользователей и вкладываться в инфраструктуру их развитие и это нам как раз помогло гораздо более эффективно решить проблему соответственно здесь ключевые факторы успеха мы выделить для себя уже по опыту 3 до 1 это как мы обучаем такие модели как мы их потом повторно обучаю то что мы называем до обучением одна и та же модель развивается во времени как в эта концепция действительно это прямо ключ к успеху соответственно следующее это автоматизировать эту историю каким образом на самом деле автоматизировать вообще все я расскажу чуть подробнее и вот в сочетании до обучения автоматизации этого до обучения позволяет очень сильно раскрутить и цикл по скорости и соответственно опережать спамеров в любой гонке в конечном счете также еще можно сосредоточиться на том как эксплуатировать модели таким нехитрым делом является эксплуатация казалось бы но на самом деле это ответ на ключевые вопросы про вашу систему это какой эффект она приносит сейчас какой эффект она будет ни какой эффект она может приносить если вдруг что-то пойдет не так и как быстро отреагировать на проблемы как о них узнаете как кака них узнаете что мы с этим будем делать давайте мы наверное дальше сильно не сможем двинуться пока нам картинку не вернут сориентируйте пожалуйста будет она у нас или нет ok да можно по прошедшей части легко а то смысле это да в итоге да я чуть дальше буду про это говорить но в действительно мы пришли к тому что лучшие асессоры это пользователь не в том смысле что они прям глаза всего нам размещать с это в том смысле что они это делают и на и больших объемах и вот поэтому действительно так микрофон тоже хоккей ну да конечно да безусловно вот поэтому ну то есть чуть опять же буду по это про это подробнее говорить нам приходится в конце концов еще и фильтровать эти действия но как играл фидбэк шумный мы не можем напрямую на нем обучаться в том числе потому что он шумный и за спамеров тоже вот они активно нам пытаются послать сигнал из своих рассылках но мы поскольку узнаем что в большинстве случаев что низ памирские вот соответственно можем это учить учитывать нужна картинка давай все вопросы ура давайте за давайте продолжим вы сами понимаете да по мере того как он по миру получают ваши сигналы рано или поздно и начинает адаптироваться по поведением иных пользователей как а потом начинайте как поведение пользователей ну да они начинают мигрировать пользователь не вы знаете они как бы и у них кажется нет задачи действовать в ящиках также как пользователя они наверное придут к этому когда-нибудь нам придется адаптироваться под это но и такая большая история то задача которой перед нами до сих пор не стояло ну так вышло вот такого еще не было они на самом деле ведут себя ну прям очень хорошо можно посмотреть на паттерн поведение спам у них просто нет столько времени чтобы они обычно происходит там типа скриптами вот это совсем другой патрон поведение соответственно 3 концепция который сейчас не сюда вот три концепция которых я говорил сейчас пробежимся по ним чуть подробнее туда обучение это автоматизации это эксплуатация моделей 300 на которых стоит наши успешная борьба вот начнем с до обучения как мы для себя эту концепцию формализовали тут появляется там избавиться как уже как предвестник формул не только наивного бойца вообще что такое концепция до обучения как мы для себя сформулировали что мы хотим от этого процесса итерационного улучшения моделей во первых чтобы она закрывала то что она закрывает уже сейчас во вторых чтобы оно приобретало новые паттерны да без потери старых в третьих нам нужно добавлять фичи потому что очевидно там на текущих вещах всегда есть потолок пока посетил модели и поэтому нам нужно такие давать их и четвертое то к чему мы пришли неожиданно пришли достаточно быстро просто потому что это вас возникла такая очень большая пользовательская боль когда мы впервые стороны на весе до обучения что нам пришлось висит окупается как продуктовая регуляризация что это означает ну по сути это формализация требования как бы сохранение интерпретации interpret ну да интерпретации модели старый и предыдущий предыдущие текущие то есть если мы хотим если мы хотим очень так действительно регулярно обучать модели мы должны вы быть уверены в том что у пользователя остается консистентные поведение системы то есть если у него вчера там письмо попало в папку спам он должен быть уверен что точно такое же письмо попадет в папку спам и сегодня до другой день мы будем улучшать наши модели там может быть по нашим меркам закроем щуку в это гигантское количество спама но при этом если мы откроем для конкретного пользователя то самое письмо он же будет не рад поэтому нам нужно это самый продуктовая преемственность с отчета который мы сможем убедиться в том что новые модели ведет себя примерно так же как и предыдущие на тех кейсах на которых она уже себя вела да вот я немножко там в целях экономии времени на примере линейной модели не буду останавливаться на том как мы приходили к формализации этой концепции до обучения становлюсь уже на финальном лоси для линейных моделей этого слагаемое 4 слагаемых вернее каждый из которых отвечает одному из тех самых продуктовых требования которых я говорил во первых это два лосса одно на старой выборки другой на новой выборки предполагается что нам выборки могут быть еще и новые фичи далее два слагаемых связанные с регуляризации 1 ну верни 2 понятно и слагаемое но про регуляризация новых весов который модели раньше не видео ну просто чтобы не переобучаться не вот первое это как раз сто как мы в итоге формализовали продуктовую преемственность то есть мы просто стягиваем сферу наших весов в новой модели к тем что у нас были до этого и в концепции мы в итоге получаем 4 слагаемые с четырьмя ручками и в зависимости от того какие у нас продлить ее то есть там закрыть новый паттерн получше если он какой-то особо агрессивный или наоборот там сосредоточиться на том чтобы у нас крутая модель получилась прошлый раз давайте максимум по максимуму и оставим такой как есть крутить ручки там на кросс валидации на сетках не имею надо нагреть о чудо и в итоге подбирать таким образом параметры окончательный лосс за счет которого мы обучаем нашей модели в данном случае книги логистическая регрессия по моему ну впринципе вместо не может любой другой ленин и вот с деревьями мы поступили несколько иначе мы заглянули в структуру сна такое там бусинка деревья ну так или иначе в конце концов это ансамбль деревьев просто много деревьев вот обученных на старом свете соответственно что мы делаем мы убираем какую-то часть деревьев со старого сайта и fost докидываем новой продуктовой регуляризация мы здесь получаем за счет регуляризации листьев в новых деревьях то есть получается такая ситуация что во-первых они сами по себе последний деревянную с минимальный вклад автор книг шеи и листья регули рисованная таким образом старый паттерна феди аффекта минимально новый паттерн и закрываются причем еще и новый фичей добавляется в новой деревья как бы профит очевиден здесь цифры проведены а стандартных наших там деревянных системах поль порядка там но не за 200 деревьев в ансамбле и вот там за каждую итерацию мы выкидываем 5 докидываем 10 таким образом вроде как удовлетворяемся в нашем требованием к обучению да кто потому что мы себе по себе сформулировали когда обучение есть одна проблема вы постоянно увеличиваем размер и нужно в какой-то момент этот размер радикально уменьшать потому что ресурсы не безграничны если мы там каждый условные день до обучаем модели мы очень быстро там перерасти мне непонятно во что вот соответственно это рациона и мы увеличим а потом приходится однажды взять и уменьшит но как это сделать так чтобы не вернуться к исходному качество модели поначалу был не очень понятно а потом там съездив найти эмаль мы как-то капнули в сторону новых destinations но как капнули именно с точки зрения деревьев то есть получить модель новой структуры заведомо более простой которая ведет себя так же как модель эта модель ученик ведет себя так же как в отель учитель соответственно как это делается просто обучаемся на софт орбитах на 100 пунктов вернее моделей учителя таким образом получаем действительно достаточно эффективно получаем новую упрощенную модель которая там теряет по нашим требованием не более скажем полупроцента рикулло и тут предполагается что мы типа однажды потеряв полпроцента очень быстро за счет до обучения типа процента закроем и даже перекроем на выходе будем иметь даже более эффективную модель но сильно проще там скажем в два раза в два раза меньшим размером на сетях долго останавливаться не буду там это проблемы нами только сейчас решается там есть одна особенность катастрофическое забывание то есть нужно эту проблему решать там прям особенно явно иначе старые паттерны будут теряться просто buy дизайн нейросетей вот поэтому сейчас мы решили так что мы там до обучаем только последние сети все до последней своих сети все остальное заморожена и таким как минимальное число объектов открывающих новый паттерн системе а в целом идем к тому чтобы реализовать но уже 10 лишены тут потому что но это единственный ответ на вопрос как соответственно после того как мы разобрались как мы с тем как мы тогда обучаем нам нужно максимально эффективно это делать максимально быстро про автоматизации очень долго говорить не буду понятно что автоматизировать можно в принципе все это такая очень понятная концепция всем какой какие здесь вообще этапы сбор выборки до обучения про которые я уже сказал соответственно добавление признаков его тоже можно автоматизировать выбор признаков в том числе и deploy моделей через оба тесных продакшн это все можно автоматизировать и максимально сделать их иман фри в конечном счете 1 . миша сказал это все замыкается у нас фидо клуб поскольку здесь участвует пользователь и на этом фидбэк луп мы по сути каждый раз возвращаемся к началу и таким образом улучшаем наши модели итерационным то есть собрали выборку обучили за тепло или получили сигнал от пользователей и вернулись назад и снова собираем выборку уже до обучаем диплом и так постоянно и чем чаще тем лучше вся наша инфраструктура позволяет это делать вообще бизнеса без вмешательства человека и не надо забывать о том что автоматизировать еще можно и мониторинг вот и вообще в целом эксплуатацию это очень важно потому что немало времени съедает именно эксплуатационные вопросы когда речь идет о системах машинного обучения если удается и автоматизирует часть а лучше все то это очень круто про фидбэк был вопрос как мы с вообще боремся как ну если такая проблема что спамеры заставляет есть металл промеж спамеры защемляет пользователи тоже не всегда понимает как им ну по-разному понимают как они могут послать нам сигналы все некоторые пользователи ведут себя достаточно странно с нашими кнопками в данном случае там для задача спама фидбэк который может послать нам пользователи эта кнопка спама кнопка не спам вот например кнопку спам пользователи очень часто путают кнопку удалить а может быть намерен это делают причем так очень странно типа полтора года мы прекрасно получали рассылки а то зоны а тут вдруг вазон сменила логотип и нам это не понравилось и фифи озон теперь я буду нажимать на него это спам ok а нам с этим жить как-то надо этом понимать что вот так вот пользователя решил с ней спам еще хуже потому что не спам действительно самая ручка которую после который спамеры могут нам пытаться обелить своей рассылки это тоже вносит шум и все это не дает нам в конце концов на прямо обучаться выглядит это примерно так то используйте пользователи жмут на все кнопки подряд нокий надо кончать с этим делать в итоге да у нас отдельная система которая classic от который по сути классифицирую для нас эти сигналы классификатор кликов или мисс кликов как мы их называем . которые ведут нас не туда куда нужно в чем особенности задача почему ее можно эффективно решить потому что нам достаточно от этой системы добиться очень крутого присси жена может быть даже в угоду приколом то есть наоборот с поправкой на ком то есть мы можем действительно поступиться им главное добиться того что у нас очень высокий престижно на тех точках который мы выбираем для обучения нам не обязательно обучаться на всем пули фидбэк от пользователя потому что там их ну там много десятков тысяч в сутки достаточно там успешная эффективного тележка будет а под выборку и делать это так что вы в конечном счете можем обучать на этом все наши системы именно так мы и поступили отдельная система которая период всеми признаками которые только есть на письме это и признаки отправителей признаки получается ли признаки контента все это там просто теперь классифицируется никак спама как смотрится на итоговый клика является из и ну и по сути единицей является та ситуация когда сигнал и наше понимание об этом письме совпадает и и соответственно не совпадает до 0 вот таким образом мы как-то все наши клики сделали гораздо более упорядоченным оставили только тех пользователей которые максимально смотреть на пользуются этими двумя кнопками и позволяет нам на этом обучаться на автоматизации в отбора признаков сильно останавливаться не буду в принципе задача отбора признаков достаточно хорошо решено особенно для модели помощи всем неплохо известно наверно как это делать вот а для деревьев я единственно что при привел здесь рисунки который очень наглядно иллюстрирует что тот метод который мы например избрали нам казался таким изящным и простым и вроде как мы нигде его раньше не встречали а потом когда готовился к этой презентации бац и увидел что вот ровно он запишем записаны карандашиком где-то и проиллюстрирован прим то что мы делаем шикарно на основании там тестов на независимость признаков и новых признаков кандидатов и таргета мы упорядочиваем их по результатам 100 тестов папе вылью этих тестов да и соответственно берём те которые показали себя наиболее зависимыми очевидно линейная зависимость встраиваем в линейной модели для деревьев сложнее потому что система нелинейный так делать не стоит мы теряем много информации долго думали как решать эту проблему в итоге поняли что дереве сами решать за нас поскольку мы добавляем там порядка 10 признаков его де порядка десяти деревьев там не больше наверное да за операцию у нас там по определению весь наш 1000 куб у признаков новые деревья не войдет войдут сплит и ровно те которые особо актуально сейчас так мы решаем для университета к проблеме ст и потому что нет руется с контентом где признаки то там грамм и пикселей на картинках новые появляются в черепе редко в картинках вообще не появляются вот про автоматизацию деплоя нельзя говорить без автоматизации а bt став надолго на этом и становится не буду просто ну понятно что это можно реально автоматизировать не нужно каждый раз смотреть на результаты вашего теста нужно сделать систему так чтобы она вам даже ничего не сообщая можно сообщать том что новую модель пришла к пользователям а дальше продвигалась по процентам смотрела на тебя и на каждом на каждом этапе а pt100 и или принимал решение раскладывать дальше или нет и в итоге это мы делаем так что до 50 процентов выкатывается автоматом а дальше мы действительно оставляем себе возможность для контроля выкатить окончательно сто процентов иногда и этой возможностью не пользуемся вот про автоматизацию и газа интересно поговорить с точки зрения эксплуатации потому что здесь возможно не очевидно что можно автоматизировать но всяческие репорты alert и это прямо первое что просится на ум потому что очень долгое время мы тратили на то что просто с утра приходили и там читали открывали графики смотри как пожелать наша система не была ли проблем ночью вот все это можно оставить виде каких-то не больна небольшого количества точек входа и таким образом наблюдать за состоянием вашей системы о он зе мандат либо когда реально какие-то проблемы возникает то есть статус отдать должна слать вам система они вы должны ходить в нее и спрашивают как она себя чувствует прапор проблема я вообще не говорю все проблем котов происходит система должна вам раньше кого бы то ни было сообщить о них они менеджеры там продуктовый должен прийти на заметив на пружину продуктовых метриках проблемы здесь с эксплуатации есть очень большая сложность точки зрения крупные эмаль системы что когда мы имеем там систему ну такую достаточно серьезную у нее скорее всего все метрики ну если только какой-то апокалипсис случился в среднем по больнице будут иметь там температура 36 и 6 реальные проблемы они могут быть точечную например на каком-то хостесс или из пула серверов на котором и дипломе msi или на каком-то там среди пользователей вот и это на самом деле какую-то часть пользователей может очень больно за эффекте и мы должны знать об этом поэтому например пришлось проводить мониторинг по большому количеству срезов как вы понимаете там комбинации таких срезов там экспоненциальное число из аниме глазами уже слить просто невозможно поэтому пришлось это автоматизировать вот сейчас наша система умеет там строить вот про себя вот такие штуки естественно них опять же не хотим смотреть глазами на все срезы потому что в данном какой-то ситуации приведён пример поведение системы распределения до гистограмм к поведение системы на каком-то одном конкретном хвосте хостов таких там под тысячу естественно глазами на сидел смотреть не будем но мы можем сделать мы можем смотреть отклонение да на конкретном срезе от того самого среднего по больнице пример так мы сделали вот построили метрику кульбака lindner этом отклонение распределением на срезе от распределения в среднем когда эта метрика идет в небеса мы понимаем что какой-то срез у нас испортился вот и естественно средний по больнице за детекции вообще не проблема это один alert всего лишь его это вообще речь об этом идет действительно когда это проблема у среднего по больнице здесь тоже все будет гладко но мы при этом это увидим на этом единстве молексы который что вообще-то системы сломалась и как бы такой снова будет исключительно редко факт о том что мы должны об этом знать и не должны об этом каждый раз спрашивать сами мы должны получать информацию об этом как только это происходит ну и соответственно когда мы понимаем понимаем на каком конкретном среди сломалась мы понимаем во-первых какой эффект от несет во вторых как это быстро починить и куда смотреть вообще наверное такие основные вещи озвучил которые хотел и в конце просто на нашем опыте как мы сейчас подходим к разработке новых систем машинного обучения уже безотносительно того что у нас human ad-ver-sary что у нас быстро адаптация паттернов мы например распространили свои подходы на соседнюю команду которая занимается фичами машинного обучения в почте для пользователей не типа там smart триплой или там какая-нибудь классификация писем на финансы билеты ну знаете все что делает нашу жизнь почте удобнее помимо папке спам вот этим заниматься не и мы им тоже с удовольствием рассказали о том как мы эффективная поборолись помоги почему это может быть полезно и для решения вполне себе продуктовых лишенных там такого негативного негативного реагирования той стороне решено такого негативно реагировать на этой стороне паттерна соответственно поэтому как мы не делаем систем машину обучения с нуля так чтобы потом приходилось тушить их примерно так дата одной проблемы к другой вас тоже долгое время это было мы там это может быть аварийно продакшене ли это может быть просто там новый паттерн который система не закрывает и мы должны там с грудью на амбразуру в пятницу вечером судорожную пилить новую модель вот чтобы вдруг она наконец-то решила кит проблемы соответственно чтобы этом всего не было там вин дизель рекомендуют делать следующие в первую очередь качестве на ямале систем начинается с качественные модели под качественные модели мы естественно подразумеваем модель которая закрывает текущие проблемы на потоке как она и закрывает мы должны всегда знать а именно уметь это измерить то есть под изменили не мы понимаем оффлайн метрики метрики на выборке мы понимаем оценку онлайн метрик до диплом модели то есть это то как мы там по сэмплом по еще не запущены моделям на пользователях должны оценить насколько она все просто будет приносить после того как мы удостоверяемся что с этим все хорошо модель реально то что мы хотели мы должны еще задать себе вопрос а как мы будем потом ее развивать если для развития модели нам потребуется полностью переобучить это плохой путь нам бы все-таки прийти к тому чтобы это рациона и улучшать это освобождает очень много ресурсов очень много времени делает эволюцию модели сильно и эффективнее после ответа на эти вопросы мы в принципе идем потому что вы уже продумывать pipeline работы системы уже на продакшене там речь идет о том как мы будем занимать чем собственно мы будем и надо обучать тут нам очень интересен фидбэк от пользователей и поверьте мне далеко не всегда ей очевидно ответ на вопрос а как не будет фидбэк собирать не буду примеры приводить я думаю у многих из вас они прямо сейчас ради в голове например некоторые символы торчат наружу и пользователь просто не может дать по ней какой-то конкретный ответ вот поэтому навсегда продумать а как мы будем набирать выборку с потока на размеченный выборку с потока на этом для этой системы как правило на нашем опыте какой бы сложный ответ не был мы его всегда находили то есть кажется ответ на можно найти всегда если система работает в продакшене соответственно продуман как мы собираем фидбэк как мы делаем из этого цикл до обучения полный цикл и как мы замыкаем архимандрит для полного ускорения этой этого дела чем быстрее это все происходит тем лучше для любой системы не только связаны с анти спам и в итоге добиваемся того что у нас наша система должна быть качественно за мониторинг я говорил о чем идет здесь речь это в первую очередь знать где и какие метрики онлайн уметь ответь на вопрос сколько профита приносит системой какие проблемы если вдруг они случатся как их гасить до для этого нам нужны там избегая вера alert и нашей системы которые должны в первую очередь нам сообщить этом что что-то пошло не так вот следуете этому реестру концепции подходов можно действительно вывести качество из своей системы на новый уровень достаточно быстро просто задав себе вопрос а какой еще олег можно прикрутить чтобы получше узнать проблеме или как вы текущую модельку которую меня там когда ты запилена в ноутбуке как бы иуда обучить то так чтобы она в принципе была такой же но только стал чуть лучше если вы найдете себе ответ на этот вопрос вашу жизнь в продаж не станет гораздо веселее и на самом деле она станет гораздо рецептов появится больше времени на другие задачи они на поддержку текущих систем вероятно этом все давайте продолжим с вопросами которые накопились за вторую половину сколько разных моделей не очень хорошо слышно я понял то есть вопрос скорее проект пэдов прополз позитива если я правильно просто не все было слышно конечном счете смотрите лс позитив модели это вообще первое на что мы смотрим при ну вообще первое о чем мы думаем когда мы тепло и модель мы должны понимать что гораздо хуже допустить фолз именно фолз позитив назвать там нолик единичкой чем наоборот поэтому все наши там подходы к обучению модели мы как бы немножко сдвигаем в сторону при сижу на варле колда с мы готовы поступиться церковном системы в году престижную там условно стопроцентная точность там 99 и много девяток после запятой это того что мы всегда смотрим или с точки зрения при хижина приколы из за этого может немного просесть но это не главное потому что не файзова положенное письмо в папку спам или вообще не не дошедшие до пользователем и такой инструмент нас тоже есть боги за система шин обучения это конечно репутационного мину гораздо хуже чем там допустить папку писю спам на письмо выходящий вот если я ответил на вопрос я просто не могу скрыть до конца его слышу да вопрос если можно вот первый вопрос какой то помогите киста к использовать час интересно как вы это обучаете деревьев вас самописная система или второй вопрос вы сказали что у вас за парк модель используется а в конечном итоге у вас бинарной классификации и как в эти модели дублируйте а сам лером да я понял мы не то чтобы давайте начну со второго мы их не то чтобы с ансамблем в конечном счете для принятия грант решения нолика единичка у нас просто разные модели трутся ну грубо говоря на разных срезах потока вот потому что есть более доверительный срезы поток этом от каких-то надежных раз сыщиков есть гораздо более шумные потоки вод на них нужны более серьезные модели скорее это так происходит по поводу того как какой стог смотрите у нас в целом скажу да мы обучаем все на питоне обучаем да все на питоне соответственно если это фреймворк то это python мы как-то были одними из первых адептов кажется в россии по и торчащую когда он был 01 я не помню ну в общем 00 вот вот мы очень быстро перелезли слугу на python то есть torch анапой и соответственно очень долгое время уже свяжем с ним питон и 27 и 36 и соответственно так о продакшене это все работает на полюсах но через но вот в чаще всего в принципе у нас основной поток с основным потоком и взаимодействую злу у нас да сама по сути самописная мель реализованный на плюсах сабин деньгами в лоб разбросанными по поводу деревьев скорее интересен интересен да никак это работать продакшене как мы это обучаем этот подход с выкидыванием накидом деревьев мы до очень долго пытались найти что-то поддержку чего-то похожего существующих фреймворков нас прокатил их же boost нас прокатил котбус несмотря на то что мы активно общались с ребятами вот в итоге мы нашли такое успокоение в виде light кбм и которые в принципе то тот вид в котором он хранит модели позволяет взять отрезы да я дальше действовать с остальными деревьями так как мы хотим вот мы в итоге допилили like gbm и используем его спиной это уже давно не like gpm такой типа сам описанной не никогда снова на alive gbm вот спасибо большое за так я на самом деле хотел бы выяснить футболки из пользователь как бы начал получал получала а потом взял и сказал что это спам ну на самом деле это скорее всего такая ситуация допустим какие-то потребности жизненные изменились пользователь пытается от этой рассылке отписаться я неоднократно сталкивался с тем что подписываешься там либо всего каких-то богов или в силу юзабилити то есть грубо говоря отписываемся от них там писем от руки реально приходит вот пользователи это не понимает он один остался третий раз он просто нажимает как бы отправить e-mail спам мне кажется вот по этим ссылкам отписки по нему надо ходить как проверять вот есть такие сигналы возникают но это как с 1 комментарий с а вообще с функционалом отписок очень большая инфраструктура наведена мы в этом рассыльщики предоставляют там on субскрайб специальные брюки до для пользователей соответственно мы очень внимательно относимся конкретно к этому кейсу более того если пользователь однажды что-то там нажал это спам то все эти рассылки начинают ему приходить понтам проблем в другом в том что пользователь сегодня делает так завтра делает иначе а после завтрака делать так то есть он не всегда консистенцию в этом своем видео есть у него однократно поменялся этот паттерн ok он после этом по идее в сервисе mail.ru он точно не увидит этих писем больше во входящих вот там достаточно такая прибитый лайка в этом отношении а вот вопросы обучаться нам на этом или нету на этот вопрос мы должны для себя ответить и он гораздо сложнее чем просто как что поступить с письмом пользователь все ещё раз то придет к вопрос вы сказали что пользуйтесь классификатором обычная модель классификации и что для нас значит пресекаться либо единичка почему почему вы не использует там я не знаю модель какого-то prediction а чтобы понимать что этот спам это чуть-чуть спам письмо это не совсем спам может быть спал ну и так далее и так далее чтобы несколько таких моделей формировали скажем итоговую структуру который может и фиксировать а мы пример так и дело на самом деле то есть мы у нас пороге у нас есть просто пороге принять решение которое на самом деле мы тоже как бы пересматривал мне тоже выберем их автоматизированы пересматриваем у нас ну как пример да у нас есть на самом деле не два ответа спам не спама на самом деле их три типа там входящие папка спам или вообще не допустить письмо до пользователя в ящик никогда в жизни такую гадость нельзя допускать вот это все происходит одной системы с разными порогами то есть мы изначально мы естественно как классификатор нам не метки выдает a soft метки вот а потом мы их соответственно по порогам уже относим к тому или иному решению на продакшене и эти пороги мы пересматриваем тоже в процессе до обучения то есть как-то так это работает спасибо большое извините но время вопросов вышла вопросы можно продолжать задавайте в дискуссионной зоне там будет докладчик находиться ожидать 30 минут всё спасибо большое вам за доклад скажите пожалуйста к вопрос про различные вопросы быть но мне всегда нравится вопросы про пользователей и вот про fp был вопрос как обычно самый такой насущный давайте человека который спросил прав использовать его нашей системой за это поблагодарим а вот молодой человек вот он может поднять руку он видимо понял чем я говорю спасибо хасси большая"
}