{
  "video_id": "lUQLI6mAmZA",
  "channel": "HighLoadChannel",
  "title": "Непрерывное нагрузочное тестирование на интеграционных средах | Сергей Жебет (Совкомбанк Технологии)",
  "views": 234,
  "duration": 3185,
  "published": "2025-01-17T02:26:18-08:00",
  "text": "ребят Привет меня зовут Сергей Работаю я в Совкомбанк технологии Вот и сегодня буду рассказывать о том как мы перешли к концепции непрерывного нагрузочного тестирования в хом банке Почему в хом банке на самом деле наши два банка сейчас находятся в процессе слияния и мы переносим процессы из хом банков Соф комбанк технологии вот собственно говорить я буду про процессы в первую очередь в банка соответственно есть некая специфика Будьте к ней готовы Вот и ещ одно на кого рассчитан данный доклад в первую очередь доклад рассчитан на тест следов и руководителей подразделений то есть тех людей кто понимает и создаёт в организациях понимание Как должны быть устроены процессы то есть вот в этом докладе кода не будет здесь больше вот это вот менеджерская бла-бла-бла про процессы про технологии и о том как ВС лучше организовать о непрерывном нагрузочной тестировании но не в смысле непрерывности когда мы разработку кода разбиваем на некие этап и на каждом этапе проводим тестирование Нет мы сделали зашли с другой стороны Мы создали в банке среду нагрузочного тестирование интеграционную на которой все банковские процессы работают как в продуктивен прод который случае чего можно уронить и попробовать на НМ свои процессы вот естественно такой подход как и любой другой имеет ряд плюсов ряд минусов Вот и чтобы с правильной перспективы воспринимать эти плюсы и минусы Давайте сначала разберёмся в наших целях целеполагания мои любимые вопросы когда мы обсуждаем те или иные процессы - это А зачем мы их делаем зачем мы делаем нагрузочное тестирование вот ну интересный вопрос на него можно долго философствовать на самом деле мы когда-то давным-давно пришли к выводу что основная Цель нашего нагрузочного тестирования - это не искать максимальную производительность не заводить баги а помогать бизнесу развиваться и минимизировать его издержки на эксплуатацию и внедрение IT систем Вот и собственно второй вопрос как правильно это делать почему мы делаем то что мы делаем так а не иначе вот с каким вопросом чаще всего приходит к нагрузочному тестировщику вот на самом деле нет это не поиск максимальной производительности вот Представьте есть бизнес который говорит что клиент будет счастлив если мы сделаем кнопочку по центру экрана есть разработчик который разработал эту кнопочку с чем они приходят к тестировщику вот естественный вопрос Можно ли это поставить продуктив и уже Потом вторым вопросом будет А что произойдёт с системой если пользователи начи на эту кнопочку нажимать Вот и собственно основной вопрос на который должно отвечать нагрузочное тестирование - это о наличии критических деградации то есть вот ради вот того чтобы уметь отвечать на этот вопрос быстро мы делаем всё что вот всё о чём я сейчас буду дальше рассказывать вот собственно этими вопросами мы озадачили довольно давно ещё лет се назад в банке Вот и исходя из этих вопросов как раз была сформулирована концепция интеграционного нагрузочного тестирования то есть нагрузочного тестирования в интеграционной среде вот собственно сейчас мне понадобится ваша помощь Поднимите руки кто вообще понимает что такое нагрузочное тестирование Кто там сталкивался все понятно дальше не объясняю собственно Когда нам нужно сделать нагрузочное тестирование что мы делаем мы очевидно пишем скрипты не буду рассказывать как это делается Как там проводится параметризация как мы снимаем трафик не рассказываю вы всё знаете без меня вот дальше пишем эмуляторы смежных систем таким образом система с одной стороны окружена скриптами с другой стороны эмулятора смежных систем и мы можем подавать нагрузку и давать какие-то результаты когда систем становится несколько возникает вопрос что будет ели мы входы одной системы настроим на выходы другой Системы ну то есть у нас явно выделяется фронт на среде нагрузочного тестирования явно выделяется к чаще всего между ними появляется midle и вот вопрос Можем ли мы технически что-то здесь сэкономить в разработке вот на самом деле ответ да это оценка сложности нагрузочного тестирования на среде в случае если у нас много систем и оценивали мы в некоторых попугаях артефактах Да что мы поднимаем по артефактом это один скрипт или один эмулятор или Ну заглушка смежной системы вот что мы здесь видим что на фронте у нас порядка 100 скриптов и п50 эмуляторов на Мидл слоя около 300 артефактов вот ну и также есть некая оценка На бке что мы можем сэкономить Если мы одни системы настраиваем на другие вот на самом деле Циферки которые приведены сверху они отличаются у всех банков Да вот а вот Циферки экономии мы можем сэкономить примерно 2/3 нашей работы нагрузочного тестировщика они примерно по у каждого банка они одинаковые Ну Такова особенность архитектуры потому что у нас есть н есть midle есть Back вот собственно что здесь можно ещё сказать особое волшебство у нас возникает когда тестировщику прилетает на тестирование задачи не затрагивающие Фронтальные или бековские процессы тогда что тогда тестировщику вообще не нужно ничего разрабатывать он просто задеплоил изменения на тестовую среду и нажал кнопочку провести тест всё больше ничего не надо разрабатывать после этого он получил результат отправил их заказчику вот в принципе Каковы плюсы и минусы такого подхода при работе с интеграцией вот ну первый плюс - это существенное снижение трудозатрат это вот как я нарисовал 2/3 примерно трудозатрат по разработке эмуляторов и скриптов мы получили вот следующее это увеличение естественно ели мы не разрабатываем скрипты то э скорость она может пойти на увеличение интенсивности тестирования Следующий вопрос Следующий плюс Он огромный на самом Плюс потому что он качественный Мы научились выявлять интеграционные ошибки все понимают что это такое Да наверное не все вот что такое ошибка производительности когда вот мы компонент Тестируем разработчик забыл допустим какой-то индекс по базе данных база наполнилась ВС упало это обычная ошибка производительности Что подразумевается под интеграционной Когда у нас есть интеграция Да предположим Ну все пользуются интернет-банка Да вот в приложении куда заходишь нажимаешь на карточку получаешь список транзакций Да И вот предположим что разработчику пришла от бизнеса задача при входе клиента в интернет-банк сразу отображая ему список транзакций Ну хорошая задача клиенты же наши ходят как раз для того чтобы транзакции посмотреть да вот разработчик реализовывает задачу проверяет на своём разработчиком контуре и видит что задача реализована возвращается три транзакции смотрит в базе там действительно три транзакции Ну разработчика база она такая вот и комитет её передаёт тестировщику на тестирование функциональному тестировщику функциональный тестировщик запускает задачу на своей базе и видит что там 1500 транзакций отобразилась заводит разработчику БАГУ Что делает разработчик он её исправляет каким он Берт вот этот вот список транзакций который он получил на фронте Да сортирует его по списку выбирает топ 10 комит тестировщик проверяет и задача готова идти в прот что мы получаем когда мы ставим её в продуктив правильно у нас ложится БК Почему Потому что по транзакций по каждому клиенту начинают ходить по всей банковской инфраструктуре Каждый раз когда клиент входит в интернет-банк то есть вот если у вас клиентов Вот вот в масса операций начинает ходить по банку и вот такие ошибки можно выявить только на интеграционном нагрузочному тестировании и даже обычное нагрузочное тестирование в принципе не может выявить такие ошибки Почему Потому что мы в случае компонентного тестирования обыкновенного мы заменяем вот эти вотк системы мы заменяем их заглушкой а заглушка сколько транзакций вернёт Ну как у рабо который мы получаем за счёт интеграции вот Ну отсюда следует увеличение качества тестирования Какие минусы данного подхода Ну первое - это существенно более высокий порок входа для тестировщика То есть когда тестировщик приходит к вам в команду его нужно обладать знаниями не только о том как проводить нагрузочное тестирование Как писать скрипты но и о том Каким образом устроены процессы в банке То есть когда он сталкивается с какой-то проблемой он должен уметь её сам решить Вот именно на интеграционной среде следующие минус - это организационные усилия на поддержку тестовых сред Ну все понимаем Если у нас э система на среде одна мы можем её задан таймить в любой момент Подождать там полчасика она поднимется когда мы говорим об интеграционной среде если у нас 20 система в интеграции например да каждые по полчасика уже там день потерян уже никто целый день не работает не может тесты проводить вот Собственно отсюда возникает а необходимость каким-то образом упорядочивать вот все работы на вашей среде Вот и следующая сложность - это сложность локализации проблем производительности Ну о чём здесь тоже понятно То есть когда мы подаём нагрузку на фронт падает БК но видим то мы это на фронте что у нас деградация началась Да И вот тестировщику нужно обладать достаточной компетенции чтобы расковырять вот э суть проблемы То есть дойти до того что у нас фронт падает из-за того что тормозит БК а БК может быть тормозит изза того что на фронте много запрашивают вот эту вот историю всю нужно тестировщику разложить по порядку чтобы завести дефект Вот Но это ещё не всё у нас есть ряд минусов которые при должном подходе минусами перестают быть они ну как бы характеризуют некие сложности которые мы получаем при переходе на интеграционные среды на интеграционное тестирование но при этом они могут быть технически решены первый вопрос первая сложность это тестовые среды Ну собственно врем пересоздание опять-таки помним если на пересоздание одной системы мы что чтобы пересоздать одну систему на среде мы что делаем мы копируем экп с продукти обезличивание его там может быть проводим какие-то подготовительные действия и можно запускать нагрузочное тестирование Вот это когда одна система на это уходит Ну неделя две-три если у нас систем 20 мы 2 недели умножаем на 20 в течение года у нас среда готовится тоже неудовлетворительно Вот соответственно нужно помнить о том что подготовку когда готом тестовую среду все системы нужно обрабатывать и готовить параллельно вот не у всякого не у всякой организации есть технические ресурсы на то чтобы со всеми системами параллельно работать на средах нагрузочного тестирования вот второй пункт - это централизация логи мониторинг и результаты нагрузочного тестирования О чём здесь вот если у нас все логи каждый лежит на своём сервере результаты каждый лежит на свом сервере на свом генераторе нагрузки то тестировщик вместо того чтобы проводить анализ и собирать результаты и делать какие-то выводы разбираться с проблемами он будет заниматься большую часть своего времени тем что он лазит по логам лазит по серверам пытаются всё это собрать и хоть какой-то отчёт получить вот поэтому рекомендуем так не делать сразу централизовать нужно централизовать вообще всё что у вас есть Следующий вопрос о котором нужно помнить - это Стратегия организации пулов данных Ну надеюсь все знают что такое пулы данных для чего они используются вот тут нужно понимать что что когда мы Тестируем одну систему и вы разрабатываете набор пулов данных этот пул данных должен иметь логическую целостность в рамках одной системы Да вот Но если вы тестирует иметь логическую целостность в рамках всех систем в интеграции которые участвуют там Да вот иначе что иначе у вас БК будет возвращать ошибки там допустим номер счёта не принадлежит данному клиенту и кейс у вас пору то есть об этом нужно помнить Не забывайте стратегии организации пулов данных вот ну и последнее ограничение оно Наверное сейчас уже не столь явно и необходимо о НМ упоминать но всё же все помним что если у нас используется какой-то инструментарий нагрузочного тестирования лицензируемый лицензионный да то он чаще всего лицензируется по количеству пользователей виртуальных вот ну собственно больше систем больше пользователей Не забывайте про ограничение лицензий вот в принципе хороший под жить но ВС меняется когда приходят вот эти товарищи Да вот чем они характерны они умеют обходить все регламенты которые тестировщики разработали То есть если вы говорите что ни одного внедрения в прот не должно быть без тестирования нагрузочного эти ребята обойдут Они знаете как скажут они скажут что это микро поставка это не релиз мы внедряем когда вы говорите что вот даже микро поставок Нельзя впро они что сделают они скажут у нас микро поставка фито углами закрыта мы всё равно пойдём в прот вот Давайте вот тестировщики постойте в стороне А сколько вы тестировать будете у 2 недели нет нам не подходит вот fogle мы пошли впт Почему Фи тогл не работает для нагрузочного тестирования все знают а если мы говорим о фиче огх для функционального тестирования в чём здесь суть Ну fogle что такое это когда у тебя есть флажок которым ты можешь включить выключить какой-то набор функциональности Как делают разработчики а разрабатывают функционал закрывают его фито Когда тогл выключен функционал не работает когда тогл включен функционал работает Что происходит в нагрузочной тестировании ну тогл нужно включать по ночам да то есть никого не устроит то что ты в течение дня там в 12 дня когда все пошли на обед включил фитол карточка не трант всё это Нет обед нельзя оплатить вот никого это не устраивает поэтому филы их тоже включают по ночам Вот и если при включенном фито администратор может проверить работает функциональность или нет зрения производительности возникают нюансы ты включил ночью нагрузка минимальная ВС работает наступило 9 утра пользователи повалили не работает пользователи валят продолжают валить а у нас тормозит всё принимается решение Нужно выключить фитол что в итоге получается получается что у нас половина банковских документов Создана по новым процессам которые были когда в тение поло постам пром В итоге в конце дня бухгалтерия смотрит Так на это и говорит Да непонятно что с этим делать потому что у нас вот половина документов по одному процессу половина по другому а день закрыть нужно вот как-то вот в среднем естественно этот процесс когда у тебя половина документов в одном статусе половина в другом никто не тестировал и никто вообще не знает как это делать Нет вы выключили вы решили проблему в продуктивен предложить нагрузочное тестирование вот собственно на нагрузочное тестирование здесь выделяется совсем маленький кусочек времени То есть девос это те люди которые бегут в прот вот Всеми силами хотим вот прямо сейчас и не можем ждать неделю или две вот естественное пожелание - это вот в этот маленький интервал времени поместить анализ тестов Ну и собственно проведение тестов А все остальные работы Выполнять их когда-нибудь ещё вот Да какие это работы могут быть Вот важный слайд если кто-то соберётся работать тестировщиком Это первый вопрос на собеседование всегда Что нужно сделать чтобы провести нагрузочное тестирование вот собственно работ обычно много занимают они определённое время А И их нужно каким-то образом реструктуризировать вот мы когда подходили к этому процессу использовали четыре принципа Первое - это ориентация на результат то есть по каждой работе Мы расписали результат или артефакт который создаётся в процессе выполнения задачи или работы Если результата нет значит наверное она не нужна и её можно не делать Вот второе независимость мы предположили временно что все работы могут быть независимы друг от друга и дальше по каждому результату по каждому артефакту расписали две характеристики две временных характеристик первоя - это потребность в наличии то есть когда этот артефакт используется вторая характеристика потребность в актуальности какой степени актуальности должен быть артефакт для того чтобы уровень качества выдаваемого нагрузочного тестирования оставался стабильным но очевидно что нам нет смысла пересобрать профиль каждый день да вот а когда мы можем раз в неделю можно а раз в квартал раз в год и вот мы вот так вот прошли по каждому и обновлять тот или иной артефакт Например если мы говорим о постановке задачи то она трансформируется в список изменений каждую когда внедряется какая-то задача тестировщик чтобы что-то по ней разработать чтобы что-то по ней протестировать должен понимать что же изменилось Да вот и соответственно хочется видеть вот список изменений или L который приходит вместе с задачей котора попадает на нагрузочное тестирование вот интерес ситуация сру тестирования вот меня часто спрашивают А есть ли ребята у вас методика нагрузочного тестирования вот по которой вы проводите тестирование Я честно говорю нету но нету почему потому что она у нас распалась на три составных части первая часть - это та часть которая практически никогда не меняется она вошла во внутренние нормативные документы банка это регламенты порядки инструкции это то м та информация которая описывает как мы проводим тестирование Когда нужно проводить тестирование Когда можно не проводить тестирование какие критерии там успешности неуспешность которые общие для всех систем и которые вот в банке они по сути стабильны и не меняются а вторая часть - это которая меняется периодически Ну например архитектура системы у нас периодически приходят задачи которые позволяют ну которые подразумевают под собой изменение архитектуры Вот это часть вошла в базу знаний по нагрузочному тестированию системы Вот и есть ещё вещи которые изменяют часто каждый тест каждый релиз это собственно профиль нагрузочного тестирования кейсы и так далее Вот это всё вынесено в систему версионность кнопочку и убедиться согласовать или не согласовать Вот и собственно когда мы вот таким образом прошли по всем артефактам у нас все работы сгруппировав вот циклы между собой независимы и производятся с различной интенсивностью с различной частотой которая зависит вообще говоря от внешних параметров слайд для фотографирования собственно первый цикл - это годовой он направлен в первую очередь на поддержание процесса нагрузочного тестирования то есть в нём ничего нет из самой нагрузки но он выполнение этого цикла позволяет нам производить нагрузочное тестирование с нужным уровнем качества что сюда входит пересоздание сред нагрузочного тестирования то есть раз в год мы тамим среду на несколько месяцев пересоздать восстанавливаем работоспособность и переходим на неё проводя Эталон и так далее вот первичное наполнение пулов сюда же входит актуализация профиле и управление производительно сред нагрузочного тестирования то есть вот это вот задача она очень важная Не забывайте про неё это о том что прот развивается впт докупать сервера а докупить сервера на нагрузочные стенды их чаще всего забывают вот ну собственно вот чтобы не забывали нужно помнить вот эту задачу её должен тестировщик всегда поднимать и бюджетированию релиза и выполняется Ну столько раз сколько приходит релиз в год вот содержит работа актуализация с продукти ВОМ снятие эталона установка обновления или собственного релиза самого и формирование итогового заключения когда мы даём некой комитмент о том что можно что-то впт поставить и предпоследний цикл - это цикл задача но всё тоже самое но про задачи вот на самом деле здесь есть интересный вопрос Если кто-то занимался управлением релизов жду его в конце доклада вот цикл релиза он вообще говоря не дает по длительностью с циклами задачи Вот и это нормально и есть последний цикл - это цикл одного дня в нём собственно тесты не проводятся он направлен на то чтобы опять-таки обеспечить возможность проведения нагрузочных тестов в следующий день Какие задачи установка фиксов пересборка регламентные работы которые позволяют поддерживать э актуальное состояние тестовой среды сюда входит что закрытие дня расчёт процентов Ну то есть вот если мы выдали кредиты то этот кредит должен войти каким-то образом первое в графике погашений а второе он должен быть потрачен клиентом Вот соответственно вот эти вот работы они проводятся ночью в регламентное работы и потом пересборка забирает на следующий день и вот когда мы все вот эти четыре цикла сформировали прошли по ним возник вопрос А можем ли мы проведение тестов считать зада а считать принадлежностью цикла одного дня то есть сказать что мы тесты проводим не ради задачи а тесты у нас просто запущено потому что мы знаем что задачи обязательно придут а проведение тестов перенести в цикл дня вот на самом деле можем и таким образом родилась концепция непрерывного нагрузочного тестирования В чём суть то есть тестировщик приходя утром на работу он не смотрит не открывает список зада ову очередь проверяет среду и запускает нагрузочный тест а уже потом начинает подбирать задачи которые будет тестировать в рамках этого нагрузочного теста вот ну собственно вот эта вот задача по проведению тестов у нас разбилась натри запуск установка теста анализ результатов и формирование вырезки для того чтобы сформировать вот скоп для анализа как этот нам от проектов по нагрузочному тестированию к процессам в ЧМ отличие ну одна задача один тест это было стало один день один тест то есть один тест запускается на оди день следующее это анализи мы начали анализировать временные интервалы то есть мы анализируем не всю длительность теста а мы анализируем только тот интервал который тестировщику интересен то есть появилась функциональность вырезки интервала Для дальнейшего анализа это обновление внутри теста тоже очень важный то есть тестировщик запустил тест вечером он его остановил вопрос Когда производить обновление обновление нужно производить внутри теста Почему мы можем это сделать почему это не влияет на результаты потому что мы не включаем его во временной интервал который анализируем и вот только тогда можно как раз устанавливать во время теста вот анализ производится тестировщика параллельно с тестом и Последний пункт подготовка к тесту про вобще не рассматриваем в частности у нас она вынесена в интервалы недоступности по ночам то есть ночью работают все джаб которые пересчитывают Ну удаляют лишние данные пересчитывают пулы проводят закрытие дня и так далее их можно вынести на выходные в принципе когда тестировщики тоже не работают но мы решили что каждый день это более Актуально это что мы видим здесь мы видим интеграционную среду состоит порядка из 20 систем у нас и кучка микросервисов там порядка 200 микросервисов Вот и мы на эту интеграционную среду смотрим со стороны нашего интернет-банка сверху приведено количество транзакций в минуту снизу количество ошибок в минуту что мы видим на графиках собственно Первое - это разгон потом у нас есть некоторый интервал стабильной нагрузки потом мы видим микросервисов каких-то было на среде Потом тестировщик зал скорректировал средст нагрузочного тестирования То есть он передел скрипты и обновил профиль нагрузочного тестирования Вот соответственно это всё сразу отразилось на Псах потом некий интервал стабильной нагрузки и снова перезагрузился сервис Что делает тестировщик Дальше он выбирает Вот этот интервал фми ИТ об табли Вот и красно подсчете акценты на которые ему нужно обратить внимание при анализе теста То есть он не занимается сбором логов не занимается там просмотром всяких засов фан и так далее он смотрит на вот эту вот табличку если она полностью Зелёная он может сразу поднять флажок и отпустить в продуктив если она есть красные какие-то вещи тестировщик начинает анализировать с чем связа проблема тестировщика вот ну рабочий день тестировщиков у нас как у всех восьмичасовой Вот соответственно тестировщик приходит на работу и в первую очередь начинает подготовку к запуску интеграционного теста что он делает он проверяет версии проводит спецпроверка тест основной боевой тест запускается на 7-8 часов вот после этого у нас обычно встреча отдела Где мы обсуждаем Есть ли какие-то беды Ну вот в ходе помешало ли нам что-нибудь запустить тест если помешало то все идём решать эту проблему если не помешало что бывает чаще всего А мы идём заниматься своими делами какие это дела Это мониторинг За тестом то есть фол глаза приглядывай что там ничего не свалилось Вот И основная задача тестировщиков в этом процессе - это актуализация скриптов и эмуляторов то есть тестировщик не сидит не смотрит постоянно За тестом для этого есть фан для этого есть алергии так далее вот в случае чего ему приходит эсэмэска что товарищ у тебя там что-то свалилось посмотри вот а основное своё время он как раз разрабатывает средство нагрузочного тестирования которые ему потребуется для будущих задач вот когда готова становится вырезка то есть прошёл некоторый интервал тестов есть некий стабильный интервал на ко который можно принять для анализа производится вырезка интервала там собираются уже подробные данные мониторинга проверяется профиль и формируется отчёт что либо всё хорошо либо всё плохо вот ну и в конце готовятся заключение где перечисляются дефекты зарегистрированы и оценивается их влияние на продуктив то есть вообще делается вывод о том можно это ставить или нет ну понимаете да вот тот график который с табличкой я отобразил если он зелёный всё просто можно ставить продуктив но он чаще всего зелёным не бывает то есть тестировщику нужно ещё поковыряться понять Вообще с чем красные флажки связаны объёмы тестирования Вот это штука которой мы очень любим хвастаться вот собственно что здесь нарисовано у нас проведено 295 нагрузочных тестов Вот Но каждый тест дал результат по 15 системам одновременно то есть вот по сравнению с компонентом тестировани это порядка 4.000 тестов мы провели за год вот при этом было закрыто более 2000 задач на нагрузочное тестирование то есть тоже за год Прим закрыто это не значит что мы проверили задачу нашли отправили е Нет это значит что мы нашли деградацию отправили деградацию с баре портом барер нам вернулся мы провели ретест 1 2 3 если нужно и потом отпустили её в продуктив то есть здесь учитываются только те задачи которые дошли до продукти вот ну собственно наверное всё по этому слайду есть следующий слайд по нему тоже ожидаю массу вопросов Это принципы построения сред нагрузочного тестирования есть их задают Изе вопрос всегда возникают собственно Какие принципы первый принцип - это виртуализация То есть у нас все компоненты инфраструктуры они на виртуальных машинах находятся Почему Потому что это позволяет гибко менять вот это вот соотношение 25% от продукти Если вдруг нам прилетает задача Когда нужно там не 25% а 50 мы с одной систем снимаем чуть-чуть ресурсов на другую накидывает Это позволяет нам на какую-то систему компонент подчеркиваю слово компонент 50% нагрузки вот также у сред нагрузочного тестирования единый владелец это отдел нагрузочного тестирования это те люди которые проводят оркестрация на среде то есть чтобы не было бардака когда каждая команда ставит что хочет когда хочет есть единый владелец который все эти установки согласовывает ну и соответственно есть очередь поставок когда вот команда приходит хотим протестировать вашу задачу задача добавляется в очередь потом по этой очереди сотрудник нажимает рубильник и поставка даже дальше Может установиться на среду и по ней Дальше можно проводить нагрузочные тестирование вот ну среды административно поддерживаются командами то есть администратор у нас те же самые люди которые в продуктивен естественно анимированные Мы же банк Вот и есть отдельная среда для компонентных тестов вот на ней остановлюсь чуть-чуть подробнее Почему Потому что периодически бывают задачи которые разработчик сразу исправить не может но при этом они вносят критическую деградацию Вот и с этими задачами что-то нужно делать потому что Они тормозят весь остальной поиск задач которые выстраиваются за ними а тестировать мы не можем у нас критическая деградация что мы делаем Тогда тогда мы эту задачу вырезаем из основного поезда выносим её на среду для компонентных тестов там даём играться разработчику тоже под нагрузкой вот а сами продолжаем свои основные процессы оценка подхода что нам это даёт Ну во-первых ещё больше скорости То есть тут очевидно понятно откуда скорость возникает Да что ещё возможность выявления ошибок установки под нагрузкой Ну сейчас наверное уже все банки по рынку они не ставятся с таймов почему-то не устраивает что в 2359 он не может оплатить ресторан карточкой Да поэтому все банки ставятся в онлайне То есть под нагрузкой Вот и Нам необходимо как тестировщику уметь проверять эти ситуации Почему Потому что часто бывает что разработчик проверил установку дистрибутива там на тестовой среде Вот Но когда начинает ставить под нагрузкой возникают на базе всевозможные блокировки ол их сбат и процесс откатывается Это хорошо если он откатывается полностью чаще всего база встаёт В какое-то непонятное состояние с которым нужно полночь потом разбираться и вот чтобы этого не происходило Мы всем разработчикам рекомендуем под нагрузкой Благо у нас появилась такая возможность это То есть это вот новая услуга которую отдел нагрузочного тестирования может предоставлять разработчиком Вот и ещё одна возможность - это возможность быстрой проверки работоспособности то есть в чём здесь принципиальное отличие вот у меня на то чтобы проверить какую-то функциональность на тестовой среде уйдёт 10-15 минут то есть вот когда разработчик сделал свой комит на то чтобы сказать да Окей Можно впт или нет что-то не то уходит 10 минут Почему Потому что ты 2-3 минуты ставишь эту поставку на продуктив потом ты по онлайн мониторингу нагрузочного тестирования Наблюдаешь что всё более-менее хорошо и всё у тебя Зелёная табличка сформировалась ты можешь идти в прод если сформировалась Красная табличка Ну тогда извини будем разбираться если сравнить с функциональным тестированием там ставится нужно ждать пока выделит функционального тестировщика нужно смотреть когда он верит он ещё какие-то баги заведёт какие-то документации попросит это долго с автоматизированным тестированием всё быстрее но автотесты у нас чтобы не мешать функциональным тестировщика запускаются по ночам то есть в любом случае если ты поставил сегодня разработку на среду то результат автоматизированного тестирования ты получишь завтра утром Это в лучшем случае А то может быть и к обеду Когда тестировщик разберёт результаты прохождения автотестов вот Ну что ещё из минусов здесь у нас несколько поднялся порог входа для тестировщиков То есть он стал ещ выше Да вот и часто у команд возникает желание проводить только нагрузочное тестирование то есть они перестали проходить функциональное тестирование и всеми правдами и неправдами пытаются запихнуть всё на нагрузочное тестирование понимая что мы дадим результат там через 5-10 минут а не когда-нибудь когда там тестировщики прочитают документацию что дальше Вот в принципе хороший подход вот таким подходом получили возможность что мы получили возможность встроить нагрузочное тестирование в devs пайла то есть понимаете да нагрузочное тестирование превращается в такой квадратик кубик на основании которого Дальше можно выстраивать Dev пайла то есть па ставит доработку запускает Ну через некоторое время получает вот эту табличку с результатами и на основани этой таблички с результатами принимается решение можноли катить дальше можноли выходить в продуктив вот начем мы сейчас работаем Ну в связи с интеграцией с комбанком мы сейчас приостановили эти работы но в планах они у нас ВС ещё есть то есть мы по ним планируем возобновить движение это целевой очередь которая выстраивает поставки таким образом чтобы у нас всегда в тесте были чистые интервалы обозначенные синенькими Вот и интервалы которые позволяют Ну имеют достаточную длительность для проведения автоматического анализа вот таким образом мы получим возможность собирать по Вот devops практикам наши интеграционные релизы то есть все команды ставятся на среду в течение дня в течение дня мы можем привести там Ну в течение дня вот идт тест И как только у нас появляется интервал которого достаточно чтобы зацеп эту задачу она акцепте и улетает в продуктив Таким образом мы вот полностью встроили в пала devs есть второй вариант это вот я рассказал про точку оди есть второй вариант Когда у нас задачи ставятся на среду инкремента а решение о принятии всех поставок которые поставлены на среду в течение дня принимается вечером но это вот как раз про ночное Вот это вторая точка то есть Таким образом мы тоже можем инкремента собрать все поставки на среду и в конце дня сказать вот всё что мы собрали оно Окей его можно ставить продуктив или нет Вот не Окей Мы вот ту задачу которая не Окей мы её вырезали она обозначена красненьким цветом А всё остальное можно ставить опять-таки в продуктив начное окно что е можно Отметь это ограничения собственно минимальная гранулярность нашего одного маленького слота - это 15 минут собственно ограничение - это скорость расчёта вот этих показателей производительности которые мы замеряем и скорость расчёта флажков Вот и минимальная длительность чистого интервала это 1 час То есть фактически 4 минутных слота Почему Потому что во время Ну чтобы корректно оценить нагрузку нам нужно чтобы банковски бизнес-процессы завершились несколько итераций да то есть если мы там продаём какой-то кредит нужно чтобы он не прерывался посреди интервала А продался до конца и вот если у нас все банковские процессы завершаются то этот интервал достойный для того чтобы прово проводить эту оценку вот ну у меня наверное всё коллеги Есть ли вопросы и готов услышать обратную связь Большое спасибо тебе за доклад а перед тем как перейдём к вопросам хочется сделать небольшой анонс сегодня в лаунч зоне в 7:00 вечера будут встреча с программными комитетами А это будет программный комитет goen CF будет программный комитет ai CF Industrial коф поэтому подходите пообщайтесь может быть они помогут вам найти тему для доклада и расскажут вообще о чём интересно послушать на этих конференциях Спасибо теперь к вопросам и Давайте вот руку тянет в цветной Такой толстовке мужчина Спасибо за доклад У меня вопрос с учётом регулярного дня тестировщика не выгорают ли у вас люди которые этим занимаются Не выгорают потому что они вот в первую очередь занимаются той работой которая им Интере тестировщика тестировщику интересно писать код тестировщику интересно анализировать результаты то есть вот когда флажок загорелся красным Интересно раскопать почему же он красный вот что не интересно тестировщику Я могу точно сказать тоже когда ты был тестировщиком мне интересно лазить по серверам собирать логи мне интересно сидеть анализировать какие-то в отчёты сидеть смотреть в заксе Тысячу графиков Вот это неинтересно Вот Но это мы автоматизировали поэтому не выгорают Спаси так следующий вопрос я микрофон поделюсь Спасибо за доклад А расскажите бывали ли ситуации слышно чего вообще не слышно А вот так ещё даже вот так может быть а Спасибо за доклад интересно бывали ли ситуации когда в продакшн уезжал какой-нибудь патч который в общем на самом деле проходил перформансе тесты только потому что перформансе тесты были неполными и что в таких ситуациях было ломались ли допустим там измерени или что-нибудь такое ещ раз что значит проходил который Ну вот был релиз который в общем прошёл перформансе тесты Не потому что он не ломал и деградации не вносил а потому что просто перформансе тесты на тот момент были неполными как такие ситуации обрабатываются не ломаются ли там исторические данные которые вот там архивируемых наверно тестов не было Вот собственно наверно Т вопрос больше про работу с инцидентами То есть если мы понимаем что в проде случился инцидент Ну вот инцидент прямо инцидент когда всё легло и ничего не работает у нас вот этого на моей памяти уже давно не было бывают инциденты когда мы что-то внедрили а в проде видим деградацию какого-то сервера по производительности Ну там условно говоря там было 50% цпу загружено стало 80% цпу загружено А на нагрузочное тестировании мы этого не видели Вот и тогда естественный вопрос тестировщику Что же произошло вот тестировщик разбирается понимает Какие кейсы он не доработал или в чём была беда и дорабатывает кейс Таким образом у нас модифицируется то есть развивается модель нагрузочного тестирования Спасибо Давайте переместимся в конец Сала и вот с правой стороны Да вот ближайшая рука Спасибо большое за доклад У меня два коротких вопроса Первый я не до конца понял подскажите вот вы полностью от компонентного результате отказались просто интеграционные компонентные Казалось бы они взаимодополняющие но никак не взаимоисключающие Вот это первый вопрос а второй поскольку Вы сказали что у вас как таковой методики нагрузочного тестирования Нет она не предусмотрена там понятным причинам но тем не менее каким образом вы фиксируете все артефакты SL скоп тестов который должен проводиться там от в зависимости от постановки задачи это просто какие-то заявки в джиро или всё это прикладываются там к отчёте смотрите Давайте про первый вопрос компонентные тесты Нет мы не полностью от них отказались У нас осталась ещё среда одна для компонентных тестов но они уже идут вторым эшелоном То есть если мы не можем на интеграционной среде длительное время разобраться с результатами то мы переходим на компонентный тест и совместно с разработчиками начинаем понимать в чём же там проблема вот бывает отдельная ситуация бывает когда к нам приходит команда и говорит А вот мы конечно понимаем ваши методики тестирования но мы хотим вот мас сделать и ма мы естественно на интеграционной среде подать не можем потому что оно всё завали ну Нет оборудования столько в банке Ух мы тоже вот вынуждены экономить Вот и тогда мы эту команду отправляем на компонентный стенд и там уже по классике разрабатываем скрипты разрабатываем заглушки проводим тестирование я ещё какой-то вопрос не ответил про артефакты нагрузочного тестирования собственно У нас есть фиксация запросов на нагрузочное тестирование в джире Ну когда вот задача приходит в релиз или задача приходит на нагрузочное тестирование там вот постановка задачи она фиксируется но кратенько фиксируется что прошу протестировать система такая-то список изменений такой-то вот тестировщик начинает с этим работать вот что делает тестировщик тестировщик дорабатывает разрабатывает скрипты дорабатывает разрабатывает методику и выкладывает их в систему версионность те кто а стоят те ребята которые как раз должны стоять то есть это либо поддержка либо разработка либо аналитика кто должен вот отвечать за соответствующий артефакт Таким образом у нас вот согласование методики Оно проходит в системе версионность по разделам Спасибо вот прям сва скажите вот у вас интеграционный стенд а е ли какая-то система подаст там большую нагрузку чем этот стенд сможет переварить вы какие-то лимите используете для этого нет не используем системы подают нагрузку Они же не просто так э системы нагружая мы то есть за каждой системы стоят какие-то скрипты нагрузочного тестирования которые подают нагрузку на систему и потом система подаёт нагрузку на смежные системы Если какая-то система начинает подавать нагрузку больше чем от неё ожидается то это уже инцидент это как раз то чего мы не хотим в проде допустить Ну то есть у вас получается все системы регламентировано дают там какой-то определённый уровень нагрузки да Ну да и этот уровень зависит от скриптов нагрузочного тестирования который мы уже разработали а я напомню что вопросы ещё можно задавать в чат а пока звучит вопрос из зала и а ответ на него от Сергея я буду чатике мониторить Давайте вот а с третьего ряда вопрос послушаем Да Сергей спасибо за доклад я понимаю как эта система встраивается когда мы говорим о внутрибанковский системах но есть ещё внешнее подключение Ну там банальные источники рыночных данных например как это встраивается в вашу систему То есть вы всё-таки какие-то эмуляторы можете дополнять или Ну ну да конечно все системы которые внешне относительно нашего банка они заменены эмулятора мы с нспк вот напрямую не можем тестироваться потому что нас сразу закроют Спасибо Давайте вот из центра зала Да очень высоко руку тянет Сергей Добрый день Спасибо большое за доклад самые интересные наверное за сегодня э я услышал С доклада что у вас ээ огромное количество работы автоматизировано в том числе поставки какой-то анализ и так далее Скажите пожалуйста э чьими силами и ресурсами поддерживается и дорабатывается интеграции и если тэшка то где вы их берёте таких а тут вопрос наверное на две части разделю То есть у нас есть интеграции которые поддерживают ну которые отвечают за код который идёт потом в продуктив то есть вот если мы говорим о тех системах которые у нас тестируются то эти интеграции поддерживаются отделом devops - это отдельно да то есть они Вот дают нам только интерфейс за которые мы дёргает Если речь идёт о том как мы поднимаем генераторы нагрузки как мы учитываем версии внутри нагрузочного тестирования то это уже разрабатывается нашими ребятами Но со ссылкой на интерфейс которые ры нам дают Спасибо большое Так давайте Вот снова в начало смести Спасибо за доклад очень интересно А смотри ты сказал что пересмотр профилей и нагрузки выполняется там раз в год А можешь пояснить что в себе содержит профиль нагрузки то есть из чего он состоит и как вобще процедура пересмотра построена смотрите на самом деле тут я несколько слу кавил У нас есть скажем так два профиля нагрузки точнее два процесса независимых и пересмотр - это фактически корректировка поиск аномалий что имеется в виду То есть каждый день У нас в проде собирается статистика использования продукти по данным с балансировщика то есть балансировщик откидывает один порт сетевого трафика безопасника и вот рядышком кучку нам сыпет вот у нас строятся автоматические отчёты которые Ну по количеству запросов по количеству обращений пользователей Ну вот вся вот эта вот нагрузочная история Да вот и ночью это заезжает на тестовый стенд но заезжает как утром тестировщик видит что вот за ночной Джоб пересобрал отличаться Вот и тестировщик говорит Да вот этот профиль применить вот этот применить А вот здесь Наверное какой-то инцидент был это не применять это там что-то ставили вот таким образом тестировщик просматривает профиль утром и Акцепт вот есть второй процесс который направлен на поиск ошибок в этом процессе вот он происходит уже раз в год То есть мы собираем статистику вообще со всех компонентов продуктивного контура не только э с балансировщика нагрузки то есть не только со фронта И не только вот с эндпоинт которые по взаимодействию систем мы собираем арки мы собираем логи мы собираем Вот всё-всё-всё и вот это всё всесв сравниваем с тестовым контуром Ну тоже автоматизирован там есть набор скриптов И вот если мы вот в этом массиве данных видим существенное отличие от теста то мы поднимаем опять-таки Арт говорим Ребята у нас профиль почему-то разъехался и уже начинаем работать с этой ошибкой Так а у нас вопрос из онлайна следующий задаёт его Ярослав скажи наруч тестов ва нагрузочных контуров у вас в итоге и как добиваетесь повторяемости тестов при наличии разности работы систем в разное время под разной нагрузкой Да в виду там запуска каких-то различных джебов или неоднородности тестовых данных Смотрите сколько контуров отвечу на первый вопрос всего контур у нас то есть два из них интеграционных один компонентный компонентный используется когда мы на интеграционном должны какие-то работы проводить а работа встала из-за деградации вот мы её выносим на компонентный Вот почему два интеграционных контура первый интеграционный контур у нас всегда боевой Ну то есть на нём ведутся тесты второй контур он либо подменный либо на нём проводится пересоздание среды То есть у нас пересоздание среды занимает 2-3 месяца Вот и естественно 2-3 месяца банк без интеграционного тестирования жить не может Ну соответственно у нас сред вот так вот меняются друг за другом Понятно спасибо Давайте последний вопрос из зала вот со второго ряда девушка и Сергей нужно будет выбрать лучший вопрос и с чата тоже можно если что вот Вопросов много Конечно задам такой вы сказали что у вас 15 систем сейчас заехали в этот интеграционный контур выбрали потому что наверняка в банке систем гораздо больше каждая из них с интегрирована ещ с огромным количеством и планируете ли вы остальные системы затягивать Вот это непрерывное интеграционное тестирование и кто ВМ случае решится это всё поддерживать потому что цепочка будет уже достаточно длинная и неконтролируемая смотрите у нас на самом деле 15 систем - это те системы на которые мы подаём нагрузку и по которым контролируем отч то есть по которым строится отно которы вот оценивается производительность систем порядка 20 на контуре то есть есть системы которые на контуре присутствуют для интеграции но в оценке не участвуют Вот и есть ещё у нас порядка 400 микросервисов по-моему на этой же среде вот По каким критериям оценивается у нас в банке есть Ну устоявшиеся критерии Business Mission Critical систе то есть есть Business Critical сист и Mission Critical систе Business operational и вот эта вот вся история из it взятые вот ну собственно Business и Mission Critical мы все Тестируем нагрузочное Bus Mission Critical они на среде должны присутствовать А их всего 20 Bus Mission Critical Да микросервис я за систему не считаю микросервис там порядка сотни по-моему всего количества То есть получается в одну систему может входить какая-то пачка микросервисов ещё которые её обслуживают Они между системами там у нас сложная иерархия мы на самом деле как В вечном процессе перехода от Толстого Монолита leg в поэтому у нас вот часть микросервисов они принадлежат системе часть не принадлежат часть принадлежала одной системе через год они принадлежат другой системе поэтому мы их просто читаем микросервис Понятно спасибо большое Давай выбирай лучший вопрос который тебе больше всего понравился мы подарим тематическую матрёшку можно будет походить дальше по остальным конференциям и пособирать коллекцию Они все будут раз да мне Боше всего вопрос понравился тебе большое за то что развиваешь коммьюнити тебе тоже большое спасибо Серёж за доклад за то что такой наверное нестандартный подход получился потому что вот чтобы прям днём нагрузочной Ну весь день гоняли нагрузочное я такое честно говоря не часто слышу вот поэтому спасибо тебе большое за то что приносишь что-то новое развиваешь сообщество и у нас для тебя тоже есть подарок Приходи к нам ещё рассказывает доклады Спасибо Успехов тебе спасибо"
}