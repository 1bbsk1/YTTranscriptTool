{
  "video_id": "dd_LGH_261E",
  "channel": "HighLoadChannel",
  "title": "Генерация хайлайтов / Евгений Россинский (ivi)",
  "views": 543,
  "duration": 1855,
  "published": "2023-01-19T06:59:52-08:00",
  "text": "меня зовут женя и а технический директор компании we постараюсь уже десять минут пропала постараюсь очень быстренько рассказать зачем я сюда пришел пришел рассказать вам о том что такое хайлайты что такое трейлер и на хрена мы решили их генерировать автоматический какое-то то получили профит и немножко технической конкретики и немножко инженерной конкретики или ведущий онлайн ресурс для просмотра легального видео здесь это слайд о нашем величие на нем заострять внимание не буду потому что время уходит если очень коротко то мы показываем видосы практически на всем что умеет показывать видосы и она существует два типа видео это длинный контент то есть он сам фильм или сериал или мультик и какие-то дополнительные материалы это трейлеры фильма фильме какая такая вот шляпа соответственно вот о дополнительных материалах и пойдёт речь давайте теперь определимся что такое трейлер и что такое highlight насчет трейлер это законченное художественное произведение благодаря которому происходит маркетинговый акт воздействия на неокрепшие умы значит за примерно две три минуты нужно в любви человека в длинный засыпает ноут надо влюбить человека в длинный фильм сделал так что можно посмотрел highlight эта история когда человек проходит по улице или проходит по вашему ресурсу его нужно поймать просто задержать его внимание от какие-то яркие кадры яркие моменты вот то что вас цепляет теперь нахрена собственно говоря мы решили генерировать как трейлер и так и хайлайты на в голову пришла идея что вот смотрите у нас есть страничка на который есть информация о контенте там есть статический постер блин мы же про видео возможно динамическое видео будет конвертировать просмотр намного лучше такая простенькая гипотеза из говна и палок собрали эксперименте где для 10 15 единиц контента ручками положили хайлайты человек ходит и видит сразу автоматически стартующий видос посчитали профит оказалось что профит если он будет раскатом на весь контент около 200 миллионов рублей в год что в общем то очень даже неплохо а это значит что этим можно заниматься не просто ради аренде а ради того чтобы сеять вечное и полезное но печаль для всего контента трейлер if a highlight of нет совсем всего на 80 тысяч единиц контента всего 30 процентов покрытые нормальными и трейлерами чё делать насчет значит давайте генерировать их самостоятельно вот так вот выглядит смотрите это маленький коротенький highlight который в общем то даже не супер продающий с первую на первый взгляд но даже вот эта штука конвертирует в просмотр раза в четыре лучше чем просто статическая картинка а это значит в общем даже не очень хорошо сгенерированный у меня быть два примера это не очень крутой и highlight а будет еще специально крутой бомбически highlight за который мне иногда стыдно соответственно теперь когда понятно проблематика давайте поговорим о том как мы собственно генерируем хайлайты и так немножко к тому процессу как человеке кожаные мешки делают хайлайты или трейлеры значит есть длинный большой видос дальше из него специально обученные люди как правило это не режиссер потому что режиссер относится к своему фильму как к ребенку а ребенка нужно продать порезать и продать поэтому трех штатах это делают либо продюсеры либо специальные обычные монтажёры значит поскольку у нас есть свой собственный production мы ножками пошли к нашим продаж нога ребята расскажите вообще как вы это делаете выяснилось ужасная что в реальном мире трейлеры делаются около полутора месяцев то есть двухчасовой фильм дальше первая версия примерно две недели потом пост-продакшн различные согласований прочее прочее это значит и если наш production облажается и у нас будет фильм но не будет к нему трейлера нам придется ждать полтора месяца пока мы его получим от 8 как бы купить зашквар и это у нас еще сильнее за мотивировало мы допросили поняли как бы основные там на чем нужно фокусироваться на что смотрит монтажёр на что смотрит режиссер и побежали смотреть какие у нас есть данные у нас есть большое количество трейлеров как я сказал примерно 30 процентов для контента вот мы принимаем за данность что человеке знают секрет как из большого фильма сделать маленький значит нам нужно создать модельку обучить ее на этих вот человеческом знании вот и потом бесстыдно этим пользоваться для того чтобы перейти к вопросу модель над поговорить о тех примитивов с которым модель будет работать что такое фильм вы прекрасно понимаете да и собственно совокупность кадров дальше есть сцена сцена это определенный отрезок времени в фильме объединенных местом действия и актерами дальше сцены состоят из сотов шо ты это расстояние от одной монтажной склейки до другой nuage атоса свою очередь состоят из кадров что такое кадры вы знаете соответственно нам надо каким-то образом обучить меня все умерло не знаю что вы видите у тебя тоже вижу вот нам надо каким-то образом понять какие части внутри большого фильма являются классными для того чтобы стать кандидатами для трейлера что мы делаем мы нарезаем на желтых да это от одной монтажной склейки до другой как большой видеофайл с длинном видео так и трейлер который для него создал человек а дальше сравнивая шорты пытаемся понять где что ты равны значит вот этот счет хорошей значит мы взяли фичер extractor вот который сами доработали модернизировали вот и в этот вечер их трактор закидываем шат шат по сути можно закидывать практически все кадры но чем больше кадров ты закидываешь тем дольше будет происходить извлечения фич в конечном итоге эмпирическим путем мы остановились на трех кадрах это первый середина и последний таким образом на выходе у нас получается три вектора которые мы усредняем вот засовываем sigvald и на выходе получаем значение от нуля то единички где ноль это вообще не подходит для трейлера единицы где подходит история про какой фичер extractor как мы его доработали в конце будет ссылочка чтобы не быть голословным и так значит что у нас получилось мы создали модель которую обучили на основании того как люди создают трейлеры но это на самом деле деталь процентов 30 от успеха если не меньше потому что у модельку создал все хорошо а дальше нужно из этого сделать финальный продукт общей схемы генерации highlight of является такой что сначала нам нужно на генерировать шо ты потом из этих шортов нам нужно сделать сцены потом из этих сцен нам нужно отобрать нужные кандидаты сгенерировать непосредственно highlight значит пройдемся теперь по каждому из этапов потихонечку спокойно генерация шатов насчет для того чтобы определить монтажные склейки есть божественный прекрасный инструмент который называется этот комплект который вы все наверняка знаете если вы общались с видео и мы конечно же начали с него он работает довольно неплохо есть только одна засада на смене резких динамических сцен и например на fendi одного кадра в другой вас получается такая грязь на границе шутов с этим надо что-то делать и вроде как у нас есть отдел машинного обучения компьютер vision 100 такой давайте сделаем еще одну модельку но подождите зачем делать модельки когда они уже существуют вот 30 минут серфинга вот мы нашли модельку которая работает по скорости не хуже чем ffmpeg а по качеству где-то раза в полтора превосходит на вот этих вот плохих кадрах ссылочка на модельку тоже будет в конце этого мы определили шо ты извините был напуган вот соответствие мы определили шо ты и дальше нам нужно по определенным эмпирическим правилам эти шо ты выкинуть почему потому что во первых в штатах могут быть титры мы сначала хотели заморачиваться что давайте искать тетра автоматизировано но поскольку мы легальный сервисе у нас весь контент проходит редакторскую обработку а там тоже много чего автоматизированы поэтому координаты титров мы знаем рей задачка простая нужно просто наложить сделать фильтрацию по координатам дальше есть такая хрень который называется спойлеры в трейлерах да вы наверное не захотите смотреть фильм после того как все основные моменты вам показали в хайлайты или в трейлере здесь мы тоже довольно сильно не заморачивались были холивары что давайте как раз тоже обучим модель который будет искать спойлеры или нет оказалось почти неподъемные задачи вот поэтому просто убираем все что во второй половине вот и берем первую половину получилось фильм нарезанный на шорты и эти шорты отфильтрованы по определенным эмпирическим правило дальше нам надо из сотов сделать сцену да напомню что же такое это все мигает насчет решетов нам надо сделать сцену сцены это совокупный шортов мы бежим по фильму и объединяем непересекающиеся сцены регулятором то есть ограничением сверху и снизу у нас есть входные параметры модели чем меньше например у вас время минимальное время у меня все мигает не мигает и очень хорошо все хорошо вот значит здесь вы хотите сделать трейлер более динамичным вы накладываете фильтр минимальным и максимальным временем определенным образом да то есть вы сужаете вот этот диапазон хотите чтобы это было более зовут поставить там семь секунд у вас будет сцена с диалогом где люди думают о жизни соответственно дальше есть такая засада что все таки в трейлере есть звук и вам нужно найти каким образом вам нужно идти где на границе сцены обрывается речь иначе у вас будет сцена не закончена и люди будут теряться и тика раздражаться собственно мы взяли специально для этого классификатор ватт классификатор да эта хрень которая позволяет определять происходит и сейчас длится или сейчас голос или нет довольно широко использующиеся штука в том числе в мобильной связи вот мы взяли обычную спектрограммы перегнали с помощью мел фильтров мел спектрограмму вот и применили классификатор вот классификатор ссылочку не дам потому что мы вроде бы тоже нагуглили нашли а когда я готовился к докладываю все только над пропал поэтому если кому-то будет нужен для исходники пришли вот значит обрезали сцены убрали те в которых нет границ и прерываний речи вот и дальше нам нужно это все отранжировать относительно классности вероятности того что это будет трейлер да все очень просто мы что ты внутри сцены их вероятность попадания в трейлер складываем и взвешиваем на деятельность таким образом у нас получается ранжирование сцен в внутри длинного видоса и теперь из этого нам нужно сгенерировать уже highlight на вход алгоритмы подается количество желаемое количество highlight of которые мы хотим получить вот и опять таки ограничения по длительности всеми этими параметрами опять-таки делаем как динамичность самого хайлайта так и динамичность сцены а дальше отбираем уже количество highlight of которые нам будет нужно и вроде как вот я щас так быстренько чтобы уложиться постарался игрокам пробежаться и рассказать как это работает и кажется что это очень просто и классно и вообще мы сели на по ней на радужного единорога и проскакали в как бы волшебный мир получение highlight на самом деле все не так вот и первые результаты были настолько отвратительны и что вне за них стыдно вот мы они даже не проходили верификацию внутри компании там через месячишко мы вышли на уровень когда уже нам не стыдно показать за пределы компаний и чем мы сделали мы не знаю возможно поэтому меня засунули на яндекс трек что мы решили воспользоваться яндекс толока и вот для того чтобы проверить на асессора насколько мы хороши мы поставили себе два вопроса насколько качественно мы нарезали сценой и насколько хорошо мы отранжировали эти сцены между собой да то есть мы хотели понять там насколько мы убираем титры насколько мы не как насколько сцена содержат смысловую нагрузку дальше мы каждому пользователю предложили текстовое описание и 2 видосика и спросили скажите пожалуйста какой из двух фрагментов заставил бы вас посмотреть фильм с большей вероятностью и какой из двух фрагментов лучше всего отражает смысл того текста который мы вам предлагаем тоже несколько итераций вот такие все прекрасно за исключением интерфейса вот это мы параллельно запускали два проекта на одном из них мы пытались обучить наш детектор глупых лиц вот глупые лица нам нужны для того чтобы генерировать постеры вот потому что когда ты вырезаешь постер с лицом а там какая-нибудь вот такая вот хрень вот понятно что это модерирует не на моделируешь ся поэтому но зато довольно дешево вот поэтому рекомендую как инструмент для проверки на живых людях которые просто глазками будут говорить хорошо вы что-то помогают вам условные разметить datasette нашем случае помогли довольно неплохо 3 итерации потребовалось на то чтобы мы как раз дать у нелли модель и pipeline до того чтобы результаты были не отвратительные вот и дальше получилось что получилось мы начали уже этим гордиться вот и потихонечку на тестовом стенде сгенерили сгинь ирины и хайлайты стали подгружать в прод и вот чего мы добились и какую особенность мы обнаружили да еще надо проехать пару сотен миль через всю страну это же проглатываю данном вы не геи дождался деревенщин короче мы выяснили что не все в хайлайты которые на первый взгляд хорошо converted просмотр мы не имеем право публиковать на нашу в ресурсы вот потому что во первых в некоторых случаях они нарушают законы российской федерации а еще в некоторых является полным зашкваром поэтому совершенно избавиться от пост модерации пока не получается хотя вот этот highlight мне кажется просто божественный я бы посмотрел после этого вот идем дальше значит для каких задач получается наш метод подходит естественно для тех для того контента на котором мы обучали модельку модельку мы обучали на художественных фильмах полнометражных эта штука будет неплохо работать с сериалами но есть одна особенность если вы обратили внимание алгоритм работает только с одним видео файл на вход для того чтобы сделать качественный трейлер сериала обычно применяются несколько видеофайлов как правило это несколько серий и тут у нас а проблемы со спойлерами ибо это вообще принципиально другая другого уровня задача с которой как господу побороться не получилось потому что все вы знаете чтобы жить чтобы вас затянуло в сериал как правило нужно продраться через одну или две серии я например игру престолов смог съесть марий только с третьего раза потому что я все время срубал ся на первой серии нак на кадре с чашками коня который меня просто выводит из состояния равновесия дальше не смотреть не хотелось но по прошествии нескольких лет я понял что миллионы мух не могут ошибаться я должен это посмотреть также будет хреново работать с мультиками у нас вообще для детского контента и для мультиков вымыли и вообще я всегда отдельное направление что в рекомендательной системе мы пытаемся почему ты сделать рекомендательном воспитательную систему что в генерации постеров где у тебя есть детекции лиц ты нормально обучил модель на лицах человеческих берт тебе нужно отвечать одного кексика от другого и что дракончик это тоже персонаж и вот это вот все поэтому дети для детей строится как правило отдельные модельки поэтому с мультиками вы пробовали вырезать получается такое себе вот то есть что-то получается какой результат хрен его знает вот пока я в мультике надо еще бежать отдельно ну и совершенно точно эта хрень не подходит для спорта маленький ликбез для спортивных трансляций вообще в принципе другие правила работы контента потому что спортивные трансляции люди смотрят не в записи и люди смотрят в лайве вот и конечно можно обучить модельку на какие-то кульминации комбинационные моменты каждого вида спорта там голевая передача в гол там нокаут там я не знаю какие то другие истории но есть намного более простой метод чем пользуется метод статистический были быть парсить и текстовую трансляцию где кто-то пишут там такая эта секунда гол отступаете 5 секунд назад делайте 10-секундные ролики вот то что подвело голу как правило там будет выход к воротам там или еще что-то работает практически безотказно вторая история это тоже статистический метод но пользовательской реакции то есть все хотят социализировать видеопотоки а это значит что в приложениях есть у пользователю возможность выразить свое отношение к происходящему и как правило когда частота вот это выражение максимальная a55 отступаете от этого момента чуть-чуть назад и получаете ровно тот самый интересный пред интересный момент который вам нужен и так мы все еще прыгаем по облакам на радужном единороги то есть у нас есть модели мы верим что она работает классно вот но модель без того чтобы как бы сейчас эта модель на текущем этапе вот пока я не начал рассказывать дальше запускается силами инженеров компьютер vision на каких-то тестовых стендов и соответственно пропускная способность подобной штуки для нашего бизнеса ну десяток в лучшем случае в неделю вот это как бы не десятки тысяч и вообще как бы такая шляпа нужно в качестве рэнди разве что поэтому надо это дело внедрять и вот тут как бы честно как вы поели какашек потому что у нас две команды одна команда который занимается pipeline нам кодирование команды разработки ну и собственно команда компьютер vision ребят которые занимаются аренде у одних свой boklok в других свой backlog у например как команды энкодера куча задачах например о том как сделать нормальный дал микс из 51 в стерео потому что при адаптивным streaming дескать четко уровень звука и какие то вот такие штуки и тут приходят какие-то горит модельку возьмите нет вот поэтому слава богу ребята с компьютер vision руки приделаны них задница к плечам поэтому они взяли гайды работы системы кодирования просто написали туда дополнительный модуль а команда разработки это просто от review элла дальше как бы мы были подвержены мифу что есть это занимаешься машинным обучением тебе нужно г пушек и мы к собственно готовились к тому что если не будем это внедрять то нам потребуется где-то взять г пушек но выяснилось что в общем это вообще не разница в 2 минуты то есть вот если я привел пример с фильма матрица две минуты разница всего г пушек у нас молиться пушек у нас поэтому практически любая любой наш энкодер любая кодирующая машина может делать эти операции соответственно теперь вроде как разработали модуль который надо внедрить в наш pipeline кодирования и тут выясняется удивительное что во-первых моделька тренировалась на 720 на 3 ст а вот а система кодирования имеет прямо скрижали которые сбиты в днк которые говорят о том что если вы хотите заниматься транс к деньгам вам всегда надо брать видос из исходника такой исходник исходник это полученные от studio или правообладатель или производителей контента классная не зажата большое видео в максимальном разрешении также 100 мегабит битрейт он какой-нибудь такой лютый вот соответственно и вот если ты хочешь сделать какую-то производное от него пожалуйста вот их в системе катеру не прямо за кого днями прибита чтобы никто никогда козел вот но жизнь говорит что типа это очень не работает моделька не летит вы таки ну хорошо тогда а может у down спилить вот этот вот оригинал вот а потом запихнуть модель куда можно работает очень медленно то есть первый костыль который мы хотели минимально потратить в ресурсы разработки и развалился просто в пух и прах же делаем дальше хорошо ну вот на предыдущем слайде я показывал что есть оригинал есть различные качества да там для того чтобы впоследствии работал адаптивный streaming давайте мы будем использовать файлы готовы streaming у для поиск вот этих вот координат из которых потом мы будем нарезать готовый highlight все хорошо полетела и первое время даже работала до тех пор пока там оказался нам везло везло потому что фпс исходника совпадал с fps сам файл и готовых стриминга как только это оказалось не так хренакс все развалилось вот файлы готовы к стримингом и естественно приводим к одному и в поясу почему потому что наши плееры на разных устройствах иногда впадают в эйфорию если сначала у него там 25 fps потом 30 потом 40 это героев что ты что происходит какой-нибудь там корейский телевизор рассказывает все что он думает о разработчиков уходя в жесткий reboot поэтому у нас получились кривые шорты из кривых штатов получились кривые сцен из кривых сцен получились кривые хайлайты и все таки как бы мораль что пришлось взять и сделать по нормальному по сути сделать отдельный flow мы берем файл готовым streaming у в низком разрешении оттуда получаем координаты шатов дальше мы берем максимальный файл максимальный по битрейт у файл в высоком разрешении и не вас на основании координат делаем highlight и это в общем то оказался успех почему потому что к сожалению потратить кучу времени на каждую эту операцию было потрачено времени потому что работа с кодированием видео это все это поставил два часа тебе надо поставить это все перри котироваться подождать пока ты переключил контекст ушел пить кофе еще что то она упала такой боли ну ладно пойду сначала вот или какой не занял твой классный тест вылечил что-нибудь поэтому когда вы работаете с длительными операциями самая большая засада это сохранение в фокусе внимания как и обещал ссылочки на детектор шатов и извлечение фич класс я уложился очень быстро практически до так догнал вот и с удовольствием готов ответить на ваши вопросы давайте поаплодируем и вообще говоришь вообще совершенно великолепно почти идеальный доклад с точки зрения и объема новостей фишек которые ты рассказал с одной стороны и походил индекс конечно что тоже замечательно вот а есть вопросы в зале вот тот молодой человек давайте вот сначала вот сюда а потом суда вот микрофончик а это подставной вот вот в третьем ряду пласты к лайту сейму целевым бабам я сказал он же может быть классным смотрите меня за него застыдили давайте так я могу вам скинуть после вы не представите вчера 2 часа я провел что вы тут ведут заиграл так и вот пожалуйста вот сюда вот микрофончик и потом вот сюда жизнь спасибо большое 1 очень интересный хороший доклад а мне на самом деле вопрос а далеко это bass line делали сравнение например взять сгенерированные трейлеры там людьми и те которые у тебя были подменить на свои посмотреть насколько ты близок может быть даже лучше это делаешь чем вот та команда редакции когда смотри слушать на трейлерах проигрываем человеку трейлер когда человек осознанно заходят и заходят дополнительные материалы и как я хочу смотрит трейлер а потом после трейлера делает еще отдельные действия либо покупает либо там проигрыш там режиссеры все-таки молодцы вот а под хайлайта my примерно паритет то есть вот еще раз хайлайты это вот ты заходишь открываешь страницу с контентом и тут же стартует коротенькое видео то мне не длинее там 20 40 секунд вот вот там примерно паритет с трейлерами которые две минуты примерно да вот то что в кино театральном выходите в оффлайновые кинотеатры вот там вот здоровущая штука там вот там проигрываем но там прямо действительно качественным качественный монтаж а вот еще в резине вот я просто продолжение этой темы очень хочется спросить а когда делают такой ты говорил вот отдельная модель к для поиска глупых лиц вот вы пытались попробовать получить ее искать классные как раз кадры для того чтобы подставлять в пластике в платочке ну когда вот список фильмов у тебя есть и вот отдельный тип мини пастор да-да-да ну собственно это вообще тема для отдельного доклады у нас наш ребята об этом рассказывали да действительно как бы есть у нас алгоритм генерации постер вот и персонализации этих самых постеров то есть под конкретного потребителя конкретную потребитель дату из 56 вариации постера видео и там на самом деле довольно интересные результаты там надо бороться не с персонализированной не персонализированная там самый классный бы из line это в принципе меняющейся постер то есть человек привыкает к контенту какому-то какой-то картинки дальше покажи ему любую другую картинку он на нее прореагирует вот а потом и только потом уже сверху масло можно намазать персонализацию потому что персонализация сам просто даже randomizer в данном вопросе уже супер классный относительно статически не меняющимся постеров так хорошо и пожалуйста вот много человек вопрос да и потом потом он туда вот при намного людей стал уже в зале время есть павел компании ока евгений спасибо большое за доклад подскажите почему не избавились от костыля поиска координат of на битрейте 700 почему не перри обучили модельку на самые высокие метро и а зачем в этом мы попробовали в этом нет никакого профита то есть у тебя более качественных результатов не получается то есть 300 это тоже не смотря на прекрасные рифмы до 300 это тоже как-то классный размер который мне уточнить лирический на нем получились нормальные результаты и все из и а зачем больше если работает на меньшем быстрее спасибо всем потом embedding потом а тут достаешь пошел давай еще один вопросик у евгений большое спасибо за ваш доклад очень интересно к сожалению я не успел на его начало и возможно и выглядит очень интересно возможно я упустила вопрос на какой бизнес или у вашего решения вы взяли зарыли кучу ресурсов на очень интересную фишку эта фишка ну 200 миллионов в год оценивали смотрите я об этом говорил что несколько процентных пунктов в конверсии и в покупке супер спасибо ."
}