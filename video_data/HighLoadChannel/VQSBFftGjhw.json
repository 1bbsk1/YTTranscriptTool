{
  "video_id": "VQSBFftGjhw",
  "channel": "HighLoadChannel",
  "title": "Завалить в один запрос уязвимости веб-приложений, приводящие к DoS / Иван Новиков (ONsec)",
  "views": 674,
  "duration": 2950,
  "published": "2017-04-22T14:46:01-07:00",
  "text": "поехали откуда растут ноги мы занимаемся вон сети тестированием безопасности как правило мы занимаемся поиском уязвимости и которые могут влиять на конфиденциальность информации но если слышали о какие курсы по информатике в университете особенно ту информации есть много разных свойств это одно из них это доступность одно из них аят конфиденциальность также там есть консистентной все остальное так вот вообще вся информационная безопасность на своем этапе развития здесь это либо конфиденциальность либо доступность мы обычно занимаемся конфиденциальностью ищем уязвимости те вещи которые позволяют ну например угнать учетную запись там администратор но иногда те же самые или другие вещи позволяют влиять на доступность то есть выполнить то что называется отказом обслуживание то есть не дать наоборот администратор зайти или пользователям зайти ну и остальное и это как правило проще с точки зрения понимания потому что это прямые убытки дат если у вас не работает проекту соответственно не получать с него деньги так вот поэтому я буду рассказывать не про тот самый классический доз до распределенная таки когда используется большие бонеты а про отказ во обслуживания с точки зрения каких эксплуатации уязвимости различных которых этому приводит то есть свойств кода самого они свой сети или организации трафика и все остального на и так что такое отказ в обслуживании как мы будем здесь понимать в этом докладе в общем это то самое что приводит к фразам типа диалоги нет не работает не оформляет или еще что-то много других не когда какая-то логика либо всего приложения например в целом сайт не отвечает 502 до или же или же 503 или же какая-то часть конкретное его не работает например не работает там оформление заказов магазине или не работает там не знаю лайк в фейсбуке хотя все остальное работает вот мы про это ну и соответственно отсюда возникает первый вопрос на чем отличается то о чем мы будем говорить от того что привыкли рассказывать про доз досыта распределенной атака которая ставит своей целью исчерпать как правило какие-то ресурсы на сервере это может быть сеть если однако большая может быть ресурсы брендов или фронтов если так приложение спроектирована что она быстрее закачу как правило так и по появляется в доз который мы будем говорить отказ от служит тот же самый вопрос только количество запросов на терминах которые сейчас модно так сказать раскручивать да это зовется кпд атаки то есть проводится какая-то так на целевой ресурс с целью вызвать его отказ в обслуживании и чем меньше нужно злоумышленнику атакующей стороне или там тестировщику которой валит этих самых запросов с уникальных адресов тем выше кпд таких соответственно идеальный вопрос один запрос можно послать один запрос всего пойдет ну идеально слухи вообще не пасовать некий запрос если она сама всего пойдет но дело в том что когда она сама все падает до смысл проводить какую-то нагрузку нет но тем не менее вот в один запрос взвалить вполне реальным и об этом мы будем говорить хотя это естественно некий предельный случай выписаны здесь как наши практика реальной жизни но и как собственно такое красивое оформление то доклада то есть но все-таки будем рассматривать с вами причины почему и когда можно завалить в один запрос когда можно сделать три запросто 510 это непринципиально на самом деле главное что это не распределенной сети соответственно стоимость атаки в общем то с точки зрения затрат злоумышленника на инфраструктуру атакующие она очень низкая хотя с другой стороны силы которой он затрат на то чтобы ту возились найти не могут быть сильно ну как бы более трудозатратами на это понятно ну тем не менее если это возможно если можно этому быстро или случайно что самое интересное научиться то есть просто случайно что то что то не так вызвать какой-то не тот параметры всего пойдет будет беда ну и вот таким образом мы работаем модели что существует всего какой-то один запрос который может убить на напрочь какую-то функцию приложения ну и соответственно надо понимать что то о чем мы будем здесь говорить это принципиально не даст потому что мы тип лакируем логику то есть проблема просто то что я буду говорить сегодня это логика в приложении и ответственный за это ну разработчики иногда администраторы причины будем рассматривать чуть дольше но никак не ваш провайдер или кто-то еще ну если вы правда не шарит хостинг на там совсем беда там как бы вам половину сурс вдруг делаются page or shared hosting ну вот немного очевидной теории так вот на очень высоком уровне рассмотрим как работ весь вот есть там сиджа им мод печки там вот какие-то другие библиотеки для веб-серверов есть вас сиджа и есть observer атаки это том к этой какие-то другие в общем случае это всегда инвар киров которые выполняют код можете сказать что сиджей это же как бы каждый запрос и порождает свой маркер который выполняется просто это понятно но сколько worker of apache будет которые будут рождать эти маркеры сиджа и будет сколько-то ограниченное число в этом случае на них переносится то о чем мы говорим в случае не сиджей ну кто используйте сиджей господи только энтерпрайзе на заводах пароходов вот понятно что есть инвар киров который выполнять код предложение так вот отличие между всеми этими технологиями чем то только в том как инициализируется интерпретатора или верт машину перед исполнением входа то есть все эти оптимизации фасе джае там библиотеки использовали только для того чтобы как можно быстрее и как можно полнее загрузить контекст до того как придет запрос принципиальное отличие для для того что мы смотрим мы рассматриваем разговариваем про worker и которые выполняют какую-то бизнес-логику приложение не важно какая что они внутри синицы а лидируют мы эту фазу а будем опускать просто для простоты потому что эксплуатирую и или вот эти особенности это очень долго рассказывать поэтому мы этого сейчас вот оставим немножко за рамками и будем рассматривать именно ситуацию что вот есть он worker of они работают все неважно соси за это или этапу маркеров там веб-сервера для нас сейчас будет неважно абсолютно вот ну и соответственно возникает вопрос есть n обработчиков который исполнит ловкого приложения соответственно минимальное число запросов чтобы занять их всех каким-то определенным делом ну понятно тем самым делом чтобы они не занимались ничем кроме этого дела в общем завалить да в общем то должно быть н похоже не похоже знаете почему нет почему это число не н иногда то есть она может быть иены больше он это понятно я говорю про минимальное число потому что отказоустойчивость потому что реализованную куча механизмов которые нужны для того чтобы максимально снять нагрузку с администраторов по обслуживанию и сделать этот процесс так сказать наиболее гладким для пользоваться чтобы ничего не замечал но проектирование этого процесса частота что мы видим нас проектов а мы видим довольно много проектов практически там наверно но большинство из тех ресурс который очищать каждый день им так или иначе что с ними делали занимались им их безопасность так вот реализуются там механизмы которые нужны зачем для того чтобы при падении какого-то функционал природе нова бэг-энда да гладка для пользователя представить его по день чтобы не видел что купол backend но с точки зрения наших атак когда причина этого падения в нас в наш запрос был таким который этот backend уронил получается эффект домино есть балансир ну допустим frontend давайте даже перенесем это чудо есть frontend который занимается тем что берет запрос пользователя дает их бэг-энда если backend мне ответил что делать хороший front and i съезда перешлет этот запрос другому booking но если причины падения в запросе получается что мы так незатейливо распределяем наш один запрос на все все все бэг-энда ну как вы понимаете что может упасть в этом случае чтобы все lipgloss одного запроса на практике как вы понимаете если даже он займет один worker на каждом процессе то будут еще worker и и соответственно все бренды будут работы других worker of логично и казалось бы ничего не должно упасть в один запрос но теперь нам нужно чтобы понять почему в данном случае что-то у нас падала на реальных проект в один запрос нужно немножко обратиться к вот курс физики 7 класс что является ресурсами которые и стащим и вообще даны компьютеров но это первопричины наших наших эксплуатацией до первопричины которые собственно мы эксплуатируем для того чтобы уязвимости у нас работали до это исчерпания какого-то дискретного системного ресурса на нас есть не тут надо убрать конечно это такой то есть все ресурсы в компьютерах они дискретные почему ну понятно катушкам питера цифровые и аналоговые все очевидно так вот теперь она квант улица тем что называется акты в секунду так вот если даже вырос один процесс а то живет даже простишь случай 1 1 гнуть нету нету вас процессоров несколько да нету у вас один процесс сожрет топ 100 процентов что такое сто процентов все равно новый процесс получит хоть чуть-чуть процесса нам времени потому что у кванту с очень маленькими тиками и нельзя исчерпать его все одним процессом такого не бывает никогда поэтому этот ресурс он нам в данном случае довольно плохо подходит понятным причинам да он очень-очень маленькими квантами кванту с очень маленьким маленькими такими частичками поэтому каждый процесс хоть что-то да получит до чуть-чуть да будет тормозить но запускаться будет и работать будет есть дисковая подсистема которое квант уйти up some iops это операций ввода-вывода в секунду так вот если вы знаете для жестких дисков это например тысячи значение апс и около 1000 что происходит если несколько процессов одновременно хотят прочитать разные области на диске бросались как диск работает ему нужно вот найти магнитный домен но вот этих блинах да на определенной области в какой-то в какой-то части вот этого диска он не может это сделать одновременно с разных участков потому что банально вот шпиндель откручивается есть вот эта штучка которая головка должна прийти в какой-то вот конкретный кусочек диска она не может быть одновременно в двух местах это просто ноет это обычная физика так мехенди квантовой она не может одновременно к за 2 места python тормозит если вы используете ssd то и опции у вас увеличивается сразу на до сотен тысяч и миллионов чувствуете разницу до между этим так вот дисковая это наверно наиболее такая типичная первопричина когда что-то ломается конкретно ну наверное все знаете такой сыр с когда диски сыпется наверное все в заявках на сервера там где нить в инфраструктуре пишите новые диски с восклицательным знаком некоторые с тремя восклицательным знаком пишет кто использовал тогда часто так вот понятно это первопричины на которой мы будем эксплуатируем которые мы будем экспортировать каких конкретных уязвимостях уже и соответственно приводить доз вот и также есть какие-то высокой дискретные величины например количество pedo в системе тебе это индификатор процессов то есть каждый процесс системе например linux метку tente feat этих единиц катаров ограниченное число если у вас возможность есть неограниченно создавать процесса это называется в простонародье форк бомбой то все у вас pidы кончится сколько всего системе вот в unix в стандартном да я именно так если есть возможность 2 в 16 в общем видов сколько-то штук и они кванту ются сильно большими кусками чем например текке процессор night акты в секунду на поэтому тут не бывает такого что каждый получит и тут может быть так что отработает for бомба и вас все кончится и причем планировщики здесь уровня ядра вам не особо-то помогут просто это нормально для системы он не знает какой процесс отстрелить у него нет это надо отдельно кастомизировать и настраивает этого не кнут можете проверить у себя там написать себе простейший формам посмотри как среагирует ваш букетом или фронт знает ну есть другие более еще более дискретной штуки например количество соединений с базой если вас observer какой-нибудь типу том к этой настроен на пол соединение с базой то есть сервер сразу устанавливать несколько соединений не открывать низко сокетов держит их открытыми проходит там авторизацию до держит этот пул с целью отправлять ваши select и быстрее не устанавливать заново соединение с базой пользоваться уже открытыми соединение в пуле понятно что не может одновременно прийти два запроса в один из этих в один элемент упала соответственно пул может закончиться это типичная ошибка я думаю кто спроектировал там java юсб эксплуатировал нагружал и и вот нам сервера где используется пул модель сталкивались с этим и все это знают также может закончиться и ноды надо на файла системе это просто от как бы индексы едине в котором файлов атрибутов файла они тоже дискретные потому что файла с тем что такое по сути такой же программу она также как-то реализовано если надо закончились ну вы не может создавать файлы почему это приводит будем говорить чуть дальше и как это можно эксплуатировал ну и собственно второй вариант вторая глобальная первопричина такая физическая все о чем мы будем говорить дальше от зал очень нужный ресурс лог это искусственная написаны программистами штуковина который нужно чтобы контент из данных не страдала простым языком это специальная заглушка который говорит этот ресурс сейчас нужен мне не трогая его наверное все знают что кайлок в базе данных и почему он происходит поэтому остановлюсь здесь не будем это тоже первопричина глобальное да я ее вот это вот вот блоков да именно особенность лезет за рамками общей физики то что это искусственно программная штуковина который реализовать для чего-то для того чтобы что то есть что-то не перезать эрл бисли совсем по-простому едем дальше и вот причины которые на более высоком уровне до позволяет нам эксплуатируйте самой первопричину это классический узи масти обработки форматов данных про который мы будем сейчас говорить первым делом это классические уязвимости конфиденциальности ну например наверное все слышали такую страшную штуку как инъекции но тут про них это уязвимости логики работы приложения когда с точки зрения проверки в входных данных все нормально с точки зрения там нашей работоспособности внутри тоже все нормально но просто логика приложения немножко страдает будем сейчас приводить пример где это проявляется и узи масть архитектура администрирования просто вот как сказать приложение не спроектирована под такую нагрузку под нагрузку в 3 запроса вот таких вот она вот вне спроектирована соответственно невозможно это поправить в коде нужно его к сожалению перепроектировать это какие-то общие классы до чтобы хоть как-то собрать вот в голове представление тех самых вот элементов уязвимости по которым вам говорить ну и вот на этот самый классический пример который называется какой у вашего партнера порог вложенности вы принимаете xml xml у нас отлично древовидный формат он имеет ссылки внутри элементов на элемент элемент у нее называется entity это так и называется xml ну и леса бомбы то что опыт частный случай xml и как вы понимаете его расширению поэтому с api тоже работаем ну и собственно переопределение заставляет ваш парсер который отображает xml ходить по этим и нести очень долго и ну и соответственно повышает нагрузку казалось бы сейчас надо сказать нет почему потому что у меня есть я не использую xml вот ну как вы понимаете на каждую хитрую на и так далее возвращаемся к вопросы какой у вашего партнера порог вложенности никаких чудес не бывает выползти строку на элементы которые кладутся в некий массив массив индексируемый отлично будем его индексировать пока он не очумеешь для этой штуки например если вы посмотрите ну тот же . сам интерпретатор например мод печки печки не файл там есть специальный директивы которые говорят сколько максимально может иметь размерность это массив и так далее то именно делается для удобность для того чтобы парсинг этот не был бесконечно но как вы понимаете если вы глянете в код сейчас вы просто любого вообще интерпретатора до который даже даже проще парсера который parts that you real вы увидите там что она занимается чем она занимается тем что вот и ищет подстроки дальше выделяет у них элементы как вы понимаете если он находит квадратную скобку он должен запомнить что сейчас мы находимся ну по сути да в квадратной скобки следующие квадратные скобки если она стужу сторону открыто это ее как бы индекс а вот в другую сторону это не индекс здесь возникают эти вопросы забавные что что то есть мы нагружаем парсер искусственно и мы это можем сделать для любого кода потому что он так работает соответственно так или иначе задавая как бы изгалялись над вот этой вот этими строками мы увеличим нагрузку на пальцы рук соответственно приводим по сути к тому же самому что и xm альбом по только другими затратами но и соответственно зависит от марса понятно что большинство проектировщиков парсеров они не знают про это и проектируют свои парсеры нормально во первых не все во вторых как правило это еще какая-то дополнительная опция которую надо настроить при компиляции кто-кто компилирует библиотеки кто-то компилирует библиотеки руками из из разработчиков особенно вы знаете как вообще с каким флагом не собрано ваш парсер на продакшен мы сейчас будем про это говорить никто не знает поэтому жизнь такая да проще проще проверить чем чем искать в коде потому что код на сие вообще кто читает код на синус узел из форматов данных в общем они ровно также распад отстрани как и форматы если есть xml значит есть какая-то бага в xml слезть фарма джейсон значит там тоже есть как вы понимаете джейсона тоже иерархической структурой в ней абсолютно те же самые штуки могут быть единственно что там нету ссылок но зависит от того какой у вас же сон то есть могут элемент ссылаться на элемент по данным здесь и того какого с реализацию десантом вполне могут быть они стесняют какая-то расширение специально даже sepsis vegas пик coma separated что там может быть что там может тормозить спокойно в общем парсер бегает ищет запятые там начинающему давать длинные массивы данных между этими запятыми он начинает мило умирать еще есть unicode там 2 байтовые состояние нужно если он поддерживать у них 1 байт это надо держать стоит предыдущего байта что понимать может ли вот два байта 18 чем то тормозит все вопросы именно как вот это протестировать ну и как вы понимаете проще один раз проверить руками то есть собрать все эти вектора на то что мы делаем и как бы на когда прикольно проект начинаем его тестировать вот такими хитро извращенными методами мы естественно не занимаемся и вычитки кодов тошнота выхода нет если есть код проекта the code библиотека скаты которыми он собран на примерку xml парсер или любой ценой парс том что понятных не так много конь джейсон парсеры или там пороси российские если он вне этого проекта с ненавидя написано как модуль подгружена как библиотечка или джем естественно у нас его нет естественному проще проверить чем что то делать ну и соответственно zippo другие форматы то же самое они уязвимы под это это архивы они распаковываются там тоже есть иерархия папок на и вообще понятно да все распакуем не папку в папку папку в папку на и так далее а по в конце будет 7 лин который ссылается на первую папку и еще и еще из жизни чтобы дать какие-то практические рекомендации того что мы находим очень часто называются веселые картинки наверное все понимаете о чем сейчас пойдет речь вот вперед называется рисовать меня полностью не надо отдавать пользователю ручки чтобы дергать размеры конвертируемых картинок он может сунуть туда что-то очень близкое к пределы in the и отправить ваш сервер в очень долго обработку этого ресайза а ещё он может быть еще хитрее знать как работает те самые фильтры внутри библиотеки например джидде библиотеки или иначе magic или еще внутри чего-нибудь и спроектировать сами данные внутри картинки таким образом чтобы их рисовать занял очень большое время ну вы наверно примерно себе представлять что это возможно сделать сам если вытягивать например область какой то картинка альтанки цвето нити или например он еще знает что профиль цветовой меняется и соответственно может подгадать какие цвета который просто дольше будет конвертировать ну и так далее это уже такие тонкие нюансы ну собственно который я во первых не могу рассказать уж и долго вот во вторых и за это деньги платят поэтому не буду ну и поэтому важно проверять не только размер картинки в килобайтах байтов данные и линейные размеры потому что частенько мы видим что там просят картинку не больше 90 килобайт мы можем на 90 килобайт сделать какую-то картинку очень большого размера потому что формат и в карте научные они же очень оптим оптимальный ниже нам жмут цвета там и все такое и соответственно писать картинку размером там много много пикселей можно за очень маленький размер этой карте ну да там внутри этой картинке будет как они полная фигня но зато она будет очень большого размера и соответственно заниматься ее resizer именно ресайза ними крапом да когда нужно вырезать кусочек его 3 сезон вот проверить что там все отлично отрицаете лосем но самый левый байт реально по полу в картинку 32 на 32 на свое место библиотеки очень тяжело ну и все она начинает тормозить мы приходим к эксплуатации этих самых ресурсов про который мы говорим вот пример ошибок логике сри варда а да забыл сказать еще were бордах участвуем то есть варды это борьба не те программы которые нам позволяют ломать всяких крутых чуваков типа фейсбук of и яндекса и не получать за это по шапке они сами говорят ломайте нас а за успешные уязвимости которого найдете помощью денег заплатим ну какие-то небольшие деньги вот вот например с яндекса пример webdav яндекс диск говорим перенеси мне папочку корень и она впадает в рекурсию но впадала естественно начинала строчить папочку в папочке папочка в папочке и завидна вам вообще вектор нет видно что нибудь ну в общем может быть даже хорошо что не видно ну смысл в том что мы переносим папку по протокол webdav естественно у них реализован ими самими самими да как так как так или иначе и говорим перенести мне папочку слышь куда-нибудь там по адресу ну куда нибудь по адресу и она начинать переносить все папочки которые есть в слушая естественно это циклиться и получается что он начинает создавать папку в папке папочку в пабчике естественно что падает просто по таймауту его отбивает но в это время как вы понимаете этот worker он висит только на нас но это пример вот за нее даже 5000 рублей заплатили прям классно вот отвлечемся собственно вот музе масти логики и ним еще вернемся кстати а пока просто про классическую есть есть там те самые старые добрые бодрые инъекции которые позволяют внедрять свою логику в запрос например базе данных или ещё куда-нибудь земельный форматы и кс-е который вам позволяют читать обращаться по крайней мере к локальным ресурсам и все ну или там и срыв сервер сайт request for жили которым позволяет просто делать запросы к локальным ресурсам или каким-нибудь от имени сервера именно да ну и все это почти все серверную юности так или иначе который мы позволяет эксплуатировать сервер умышленно не буду говорить какие они во-первых много вторых очень долго займёт вот именно каждый из них разобрать поэтому вы знаете что и серверную земли можете погуглить это классика не так интересно даже они что делают они нам позволяют отправить сервер читать чего-нибудь например какой нибудь и рандом да и of a естественно он будет очень долго и все ну и отлично worker будет наш дальше надо будет загрузить остальные worker и также например ну и вспомните теперь про диски и про бедную щеточку благо дев рандомно диски не лежит но он например есть не знаю там файлы логов у него с такой особенность он записывается вот беда но у него есть ев это не так круто то есть момента открытия он дает все таки добежит но тем ни менее поверьте как бы у вас на диске есть большое что почитать даже доступная любому пользователю может поискать вполне очевидно нафига козе баян зачем нам ведь она отвернулась и он не нужен зачем нам нужно брать классные классические возьмите которая позволяет в общем-то эксплуатировать сам сервер и использовать их для какой-то фигни для отказа в обслуживании ну я тоже долго не понимал пока мы не начали эксплуатировать сильно больше проектов чем он мог себе представить то есть у нас стало много проектов компании и появлялись например такие штуки как инъекции в пустую таблицу такая самодостаточная штука мы можем эксплуатировать базу данных и у нас пользователь имеет право ровно на одну таблицу она пустая очень круто вообще то есть мы можем туда писать-читать то что мы записали и все никаких чужих данных там нет потрясающе инъекция с импактом 0 надо есть все пользователи ограничено ничего не может делать вы можете читать писать и пустую таблиц в таких случаях и и многих других до в изолированных средах когда нас администраторы то есть разработчик плохо написал приложение там есть уязвимости но администратор был такой молодец что все анальном ручки закрутил вот нам и стоит столько эксплуатировать ресурсы и соответственно хоть какой-то impact в этой баги делать и когда один раз в жизни а теперь это уже не один раз получилось что ценность эксплуатации отказывал обслуживания от нашей в общем-то узел месте про конфиденциальность угоны там какой-нибудь учетки выше оказался то что отказ в обслужены панельный примерно как на сайте лежит бизнес сразу понимает где матерей деньги когда мы говорим что у возможно где-нибудь там через месяцок но он загрузим админов это кино ну да окей вот поэтому демонстративно так скажем вот зачем козе баян и так иногда нас спрашивают а зачем мы это дело нас есть там макса никишин times и проще лимиты на процесс попробуйте запихать могу я про печки потому что это просто еще он ну практически все про него в курсе про конкретный observer надо конкретно разбираться понятно да про конкретную среду исполнений вирт машинку или там интерпретаторы тоже над смотреть но в целом так все лимиты про который мы говорим которые там отбивают процесс после 30 секунд они никогда не убьют процесс который целенаправленно что-нибудь делает например читает файл время чтения внутри или время чтение соки она не учитывается этом например максим чушь in time она не учитывается соответственно если мы отправим серого читать что-нибудь наши например через ту же срыв до сервиса 3 quest for железа ставим сервер отправить нам запрос примере жизни там видели где-нибудь на сайте как войти через оба найдите ссылку 2 можно пихнуть вот он отправить запрос на этот сервер этот сервер будет наш этот сервер будет заниматься тем что медленно и упорно раз в минуту потому что сок 1 тайм аут минуты как правило отправлять ему по батику 1 2 worker будет ждать например там работает печка и максить уж in time вообще 5 секунд никаких 5 секунд он он будет ждать до упора что ему помешает то есть скажет ему что все баста пора заканчивать помещать только одно если мы отправим ему разделители строке он поймет что это них такой протокол получит значит побег ну и лес там чанг настроен принять там 1000 байт и потом уже по артистам протокол в общем случае работает отлично вообще тормозит дико то есть worker наш он мы заняли его целиком своим делом дальше мы повторяем это по количеству worker of они все вы очень хорошо сидят и слушаются ждут что нынче полезны в socket отправим мы там раз в минуту им даем значит вот с легче будет обязательно будет такой как ты хочешь только еще подожди минуту но все то есть 55 запросов держит значит все worker и там на сервер и мы отлично живем там все не работает фигурки на нас ждут понятно что мы можем перенести эту функцию на дом bpm другой и так далее да то есть понятно это это очевидно и мы говорим как занятие конкретный worker примерами все свои случай конкретное приложение должны все его функции рассмотреть и каждый вид функций пытаться там так или иначе квартиру это пример ну и вот классический вместе логике вернемся к рекурсивному yandex и просто ради знаете тормозящий поиск а также известны под кодовым названием sony в like процент то есть когда у вас есть поиск все любители свою туда процент и естественно лайки на процент это выгрузим не все что там вообще есть по этому параметру wildcard то же самое что звездочка да ну естественно все начинает тормозить но более интересно прикольная так и на классификаторы когда у нас есть такой человеческий поиск через чем модно на сайтах стал делать такой человеческий пост где можно написать там например на сайте там не знаю любителей кошек можно написать найди мне там белую пушистую кошку и он сам по колосси котором найдет внутри что это на таки большие мощные проект я думаю вы знаете магазинах часто применяется еще вот эти магазин отличным отлично простоит классе который идет лесом когда вы там начинаете искать какие-то явно не пересекающиеся класса например говорите многими красная там но при этом синие шоколад быстрый еще для девушки он и естественно все по разным классе котором он он пытается пытается все эти массивы вместе потом склеить естественно и умирает хотя при этом очень все красиво выглядит то есть понять что этот запрос тормозит невозможно ну как с виду но на практике отлично тормозят отлично парсится формулы отличные многие сайты позволяет теперь написать нам не знаю вес меньше 10 килограмм они так они так чудесно просто работают с весом это можете просто потыкать только аккуратно очень на своих проектов она она просто реально отвечает годами может очень долго . это классификаторы как они внутри работают опять же договорятся не будем потому что у меня вот вот семь минут осталось мне чем надо много интересных кейсов рассказать выдохнули дам плохой пример как исправлять лайки мы начнем фильтровать длину например один байт принимать не будем ну пихнуть вам много процентов не принципиально сколько процентов получит лайк он отлично от лайкает и это для него абсолютно будет то же самое да там для субботы ну вот мы там отправили разработчикам богов сказали вот смотрите вас там длина поиска минимальная 10 байт мы сунули 10 процентов вас все очень медленно отдается возьмись логике все такое а не думаю думаю чешет репу и говорят ну все ок значит мы уберем процент нельзя процент пихать все конец ну ладно что нужно сделать нужно спросить siri какие есть wild card лайка для вашей базы потому что это не только процента например они могут ну там есть группы там есть отрицание там есть на начало конец строки там есть собственно wild card на один бантик и это все также тормозит ну давайте пару слов как вообще-то эксплуатирует чтобы сделать максимально тормозящий запрос вот из таких вот конструкция что нужно сделать вам чтобы нагрузить и и и удивить всю свою компанию какой-нибудь все очередная фигней вот особенно перед релизом будет вообще пятерка что нужно сделать нужно собрать такой запрос чтобы подумать немножко да за партию нужно сделать такой запрос чтобы он как можно больше бегал по возвращался назад чем больше вот поиск возвращается этой регуляр кой демон так тормозит то что ему надо запомнить состоянии положить его в память бегать назад как работает регулярке опять же очень быстро не смогу рассказать но смысл такой вы увидите строку в по строке если что-то может изменить состояние то есть вам нужно прочитать назад это тормозит соответственно ваша задача с этими комбинациями этих байт естественно как правило смотрятся реальные данные заставить ее вот бегать назвать если это можно сделать всё как бы вы победили потому что он будет тормозить по понятным причинам ну и так далее то есть не обязательно даже заставить базу вы дать вам много то есть чтобы она тормозила на операции записи в этот соки до данных но может заставить о тормозить на уровне самого за прошлые уйдет простой select но очень долго будет крутиться потом войдет пустоту ну и отлично как вы понимаете сделать яндекс на поле где есть like довольно тяжело чтобы она хорошо работала ну и там есть такое расхожее мнение что но и скрытом и всякие там in-memory базы к этому неуязвимы но это уже не так то есть в memori просто мы эту нагрузку на себя возлагаем на то есть мы должны эти же запрос ну да в доступа память очень быстро и все отлично ищется но что-то посчитать все равно siplus известно нагрузить это очень легко можно не верить и дайте мне проекты вам покажу работает вот ну и до самую интересную штуковину дошли видимости администрирования до разработчики пишут код админы код обслуживают возникает вопрос а кто отвечает за баги которые на стыке то есть пример могу можно поправить и от админов и у разработчиков кто будет это делать или же разработчики говорят да у нас в ходе нормально мы всегда так писали вообще у меня 8 лет стажа все около то у вас просто бэкенда криво настроены давайте настраивать и админы говорят а я вот 10 лет бэг-энда настраивают везде так делал всего кого вы нас вот что-то не работает вот кто ответственный за это архитектор самый главный дядька это архитектор он должен сделать очень хорошую систему продумать ее всю и потом значит набегут разработчики и будут чуть чуть не так делать как он хотел и администраторы будут чуть чуть не так делать как хотел это жизнь вот ну и классика кончились соединение с базой они все знают мы уже про это историю вкратце упоминали пул соединений если у вас observer случае там всяких jaf enterprise всяких там есть пул сколько-то сокетов они открыли соединение к базе прошли там авторизацию держит их таки довольны array мы готовы туда запрос и вдувать ну и приходит кто-нибудь и начинает неожиданно во всей их в давать какие-то запросы которые неожиданные перестают отвечать ну например те же лайки нам нужно все получается понятно кончается пул встречи запрос остается в очереди ну и так далее там отлично что делать приложение каждое соединение будет читать писать в тот момент когда придет новый запрос ну понять что ничего не будет он будет держать пока что-то не отдаст есть конечно механизмы значит от лупов когда запрос слишком долго идет на уровне баз данных разом закрывается из что не получается и как только кто-нибудь реализует этот прекрасный механизм что запрос надо выбросить он получает сразу вот такую вот штуку потому что он нарушает консистентной знаете почему представьте что кто-то неожиданно сделал какой-нибудь insert и он наполовину проставился мы не про трансакцию говорим да про то что обычно не не 0 в нирване араха транзакции делается какой-нибудь апдейт какой-нибудь который наполовину прошел а потом неожиданно ну есть же значит отказоустойчивость она не нужна ждут он убил значит этот процесс все страны не просто велась получается прекрасные вещи например так условиям гонки race conditions частенько после вот такой вот оптимизации против же наших баков которые мы находили неделю назад мы получали авторизации ну потому что там диска процессе поставлялся но неожиданно идеть катар роли не успевал проставиться в нашу табличку а роль null это администратор что-то он тоже самое что 0 и все окей вот бывала на то есть по полному красиво дальше сессии файловой системы это просто моя любимая штука полая система как вы понимаете она не резиновая причем не резина не как по объему диска но также количество файлов торта можно быть жить системе на соответственно даже темпов с в unix а на котором например печки хранить сессии вот так вот а другие штуки хранят сессии по другому мы будем чуть про это дальше но тем ни менее хранят они естественно иметь ограниченный размер по и нодом не надо это я же говорил что такое да это яндекс по которым лежит атрибуты файла и естественно сколько может быть создано файлов tmp fs а вот столько для темпов с зависит от объема вашей оперативной памяти причем от разрядности системы не зависит от зависит от денег saten как я выписал для четырех гигабайт памяти это всего 512 и нодов прикольно если у вас например маленький серво да и брендов несколько которых ранен сессию а для 64 гигабайта это 8 миллионов и нодов как вы понимаете 8 миллионов сессии ну в общем случае за 8 миллионов запросов можно сделать а 8 миллиона запросто стать не очень много особенно в килобайт тоже запрос очень маленькие могут быть генеды они будут только соси строчить анонимные сессии да они будут пусты совершенно на файл это будут а что будет когда файлы закончится а новых пользователь не будет лаги нить и например даже новые файлы записываться не будут потому что файлы которые а плодятся они тоже в тайм пао хранятся а всю систему больше не может их положите но тут и кончились места на диске дофига только енотов нет беда-беда но особые особого конечно люди они не в нпф если могут хранить там еще все и тормозит tfs хотя бы в память да нет скажите вы почему-то жилья memcache явным к сохранил сессии ну по-моему для там проектов высоко нагружена который такая частенько штука cтраница если в memcache или в другой там in memory баз данных собственность queen of частенько по моему от круто как вы понимаете чудес станет ресурсы как мы поняли из учебника 7 класса на себе все равно ограничены поэтому все равно будете в них упираться например вот так собственно дело не в том как у вас хранилище да что вы туда кладете если вы храните в цельсии пользователя такую важную ценную информацию какого user-agent его логин историю которую он посетил но вы все же трахают пользователь g круто возникает вопрос а сколько это может занимать гигабайт не в нормальном случае а в случае когда мы принципиально заполним эти все поля до отказа например будем сделать себе сессию которую очень часто ходила везде но их винить ужасной ссылки с очень длинными длинными параметрами по нескольку несколько килобайт ну естественно будет пухнуть наша сессия наш один файлик ну по сути в нем каши наша 1 кей до прямой большой вылью в итоге его ли это закончится у него прошлись какое-то разумное ограничение на длину ну мы сделаем вторую и так далее так за несколько как правило даже до миллиона не доходят запросов просто память кончается мем к что у нас ограничен не количеством ключей которая может хранить как и ноты и мяту и памяти которую подниму выделили ну и все когда мы им как закончился для некой от вопроса что происходит с новыми сессиями одессе того как вас настроена обработка этих исключений она может настроить двумя способами ну собственно затирать новые затирать старые ну и дальше можно например не давать можно держать если затирается соответствие самые старой можно просто всегда делал в новой сессии и не давать никому логиниться просто все связи будут ваши не будто анонимные очень ценные с множеством гигабайт всякого непотребщина но никто не залогиниться и соответственно там админ кстати очень начинает нервничать когда не может залогиниться системам думать что что-то сломалось бежит как правило в ssh и тут из старшему говорит извини не могу подключить все ресурсы и сожрали worker и его не попадаете на backend начинает дергаться левый глаз вот дальше значит возникает потрясающе он не понимает что происходит потому что авторизация не может же ресурсов не осталось ну да ладно это все на самом деле и такие истории временно вышло вот я бы рассказал еще но времени нет поэтому дам контакты вот у меня есть ветер есть лап смысле наши технические блоком правда на английском потом и в основном там про конфиденциальность но вот эти какие-то штуки типичные кейсы тоже потихоньку туда будем выкладывать и осталось у нас минут наверно 5 на вопросы поэтому я бы лучше на вопросы время потратим спасибо а вот зря и время на вопросы оставил в общем-то не совсем вопрос ну что доклад очень полный спасибо такое может быть идея так сказать для дополнения потому что значит в некоторых случаях допустим теоретически у нас есть xs-s да но про эксплуатировать мы его нормальным образом не можем то есть за инжектить собственно какой-то год скрипт вот но в некоторых случаях мы можем сделать такой специфический доз на веб-приложения когда мы inject чем что то что просто ломает страницу в итоге как бы тоже та же самая идея что не получив управлением и все равно портим жизнь когда пользователь ну я говорю далее прочитаем и спасибо вам большое за замечание но действительно классическую земли можно эксплуатировать ну как бы серверный можно клайн сайт до также эксплуатируют например те же и к сетке это называется выстрел в колено когда сервер прыгнул тьмы мы делаем inject как он java скрипта который не может украсть cookies купил на защищены но он занимается тем что запускает с каждого клиента который зашел и видит этот скрипт несколько сотен тысяч ajax запросов на и тот же сервер получать что мы как бы используем всю клиентскую мощность чтобы атаковать от сервер в общем то приходим к носу уже такому более классическому но в целом да можно сделать развертку самим сами стране сами самой странице то есть сломать верстку и упадет код функционал можно эксплуатировать даже там какую функцию локаута просто в автомате в автомате делать логично logout там как правило не те кто кино флага уйти нету и соответственно человек заходит у него отображать страницы там за клан сайт атака который возлагал разлагает ну и все ничего не работает а это в ленте где-нибудь на первой странице все у вас к ограничение работает человек очень пойду да спасибо план сайт круто вообще наши все сможете ли вы какие-нибудь инструмента автоматизированную для проверки что нибудь допустим fighting до facing это круто для тех кто не знает fighting это вот техника а так который занимается перебором мутации байты все такое когда берется нормальный формат и начинает меняться выборочный байт или более интересно мы явно используем fighting но как вы понимаете вот пример хороший был даст от классификатором атаки на классификатор когда он черный но не зелёный и так далее понятно что в этом суть возник не поможет поэтому здравый fighting он всегда пригодится особенно для узи вместе форматов данных но никакие более глубокие вещи дата киноклассика тары и так далее она не сломает поэтому fighting от такого 20 процентов работы 60 процентов работы это как бы ваше представление о том как вы думаете работает система и опыт ну и остальное это уже там удача случае так далее если это blackbox нет sonic целом да fighting используем спасибо да не за что тоже еще один вопрос всегда доклад вот был ли на ваши практики трой случае когда уязвимость эксплуатировала какие-либо недочеты именно новых версий каких-либо библиотеку например на продакшн админ но так исторически сложилось выкатил новую версию библиотеки взял панели например не из портов а вот вообще много версия то он всех уверял что вот она там мега крутая она там супер там где исправленного куча багов ее нужно обязательно выкатить был ли такой вот на практике случаях я просто были были именно такие версия до новой версии были но чаще это все-таки старой версии то есть основная масса проблем из-за того что кто то не обновил библиотеку из того что кто то ее быстрее обновил из дева бывает но и же не потому что не потому что это реже вызывает проблема в душ так реже кто-то делает вот и все ну понятно да дизай this type of последний вопрос можно потом я найти будет и подавать вопрос без без микрофонов добрый день отличный доклад большое спасибо хотел бы спросить такой вопрос не технически больше такой то есть есть он старая история про хакеры салон куда то есть там когда чего-то ломают и тех кого ломают это неинтересно и вот там ваши способы нанести пользу они там игнорируется и так далее вот как как в таких случаях отлично вы поступаете ну надо про завалить продакшен и всего на самом деле если без шуток то мы против проектов когда заказчик не понимает ценность этих работ иначе это все как бы мы находим классная вещь и нас это радует заводит мы приходим с пеной у рта рассказываем заказчика ему не интересны на такие проект не нравится поэтому их не берем вот поэтому как бы сказать спасение утопающих дело рук самих утопающих а мы инструмент для этого если вы не умеете пользоваться инструментом спасательный круг 2 тоники вот вот и все никак короче ответ надо брать больше денег за консультацию нужно когда ты заплатил за консультацию адовый кучу денег но просто не воспользоваться этим но это будет просто глупо это тоже хороший вариант но мне кажется работы ладно пропасть спасибо большое отличный доклад"
}