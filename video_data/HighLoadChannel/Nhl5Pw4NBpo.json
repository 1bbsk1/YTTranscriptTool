{
  "video_id": "Nhl5Pw4NBpo",
  "channel": "HighLoadChannel",
  "title": "Биллинг в Дримсим / Дмитрий Симонов (Drimsim)",
  "views": 1645,
  "duration": 2739,
  "published": "2019-05-15T03:24:11-07:00",
  "text": "всем привет меня хорошо слышно если тут зале кто знает что такое dream все или хотя бы слышал о нем очень значит максим выяснилось очень интересный момент про путешествующих за границу эти люди едут отдыхать они не пользуются роумингом не покупает местные симки и даже вай фай они там есть есть нет нет они может быть и хотели бы в процессе своего отдыха послать пару фоточек фамилии сообщение родным близким но это становится сложно они не знают могут ли конкретно они купить симку местную и бурлит например симка работать соседней стране если покупать то сколько это будет стоить денег какой выбрать тариф сколько нужно гигабайт 135 или может быть даже 10 но и обыкновенный языковой барьер как известно тоже является препятствием тому чтобы там на симку подключить какую-либо услугу dream 7 пришел к операторам и сказал что он нашел способ обойти все эти барьеры поэтому давайте мы купим у вас его в каждой стране много много услуг а как мы их продадим как с комплектуем где возьмем клиентов это уже наш собственный забота в этом собственно суть dream 7 поэтому у нас хорошие тарифы хорошее обслуживание и вообще сам по себе trim симках лапочка есть согласные dreams to dream team лапочка чтобы все это сделать понятно что нужен биллинг биллинг нужен не просто биллинг обилен нужен быстрый почему ну бизнес план подразумевает 100 миллионов clio 100 миллионов клиентов в очень недалеком будущем более тысячи подключенных операторов есть термин mtv у нас нет на текущий момент клиентов только в антарктиде я видел списке наших клиентов по моему даже до 25 двух граждан ватикана не знаю как они там оказались мы видим и trim 17 хороший кроме того биллинг нужен гибкий как вообще гибкость биллинга можно измерить есть такие запросы от маркетинга или от продажников которые заключаются в том что их просто нельзя обыкновенным искали запросам вытащить нужно саму лось логику не спиленный logo к вполне программируем обычную логику внедрять сами база данных и строить ее настолько настолько хитрой что не всякая базы данных со всем этим справиться опять же все это нужно для оперирования более там тысячи различных прайсов реферальных начисление вот этим и съем все что связано с продажами ну и понятно что биллинг должен быть емкий то есть в нем он должен проживать всех-всех все данные все исторические данные уметь ими оперировать и быстро доставать без существенных трудозатратах и наконец биллинг нужен свой то есть нельзя взять счёта коробочное решение и соответственно не на него потеть как на иглу либо как сервис взять либо чудо коробку надо писать что своем это нужно для того чтобы было из коробки что называется дешевая масштабируемость всех компонент полная независимость от кого-либо и разумеется white pebble чтобы такой by renata строить нужна база данных который обладает тремя основными свойствами скорость и отзывчивость скорость отзывчивость для чего нужна когда мы открываем в по телефоне там сайт avito.ru либо yandex.ru либо еще какие нибудь сайта и пробуем зайти вот именно в этот момент симка взаимодействовать с местным операторам оператор взаимодействую с dream силам вот и dream сим говорит что потратить денег можно столько то поэтому общение между биллингом и симкой должна быть мгновенной мгновенности есть точное значение 100 20 миллисекунд гибкость управления данная про нее уже рассказывал емкость и готовность управлять большими объемами данных и так как раз то самое что позволяет хранить все исторические данные считать маржинальность по всей парка по каждой транзакции и строить аналитики тарантул вчера я не присутствует не присутствовал на вручении но мой хороший знакомый господин осипов получил статуэтку все знают что такое тарантул это быстро и быстро и быстро это пол ориентированная база данных которая способна принять практически любую любую нагрузку и она дешева дешево и просто масштабируется под глэсс qu'elle пост greyscale это то решение которое позволяет внедрять в себя практически люк логику любой сложности то что позволяет реально программировать и работать с данными на уровне самой базы данных и наконец клик хауз каре house обеспечивает емкость которая подразумевает там практически бесконечное количество данных можно складывать хоть вечно просто добавляя ноты давайте посмотрим как мы все это выстроили мы берем тарантул и загружаем него баланса и прайсы баланс и пользователей у пользователя на балансе 3 евро и прайсе допустим зимбабве телеком цена 1 гигабайта 1 евро соответственно если у него 3 и 3 евро на счету он может потратить 3 гигабайта чтобы связать данные баланса и по прайсу с конечным зимбабве телеком требуется коннектор коннектор это если совсем просто совсем на пальцах обыкновенный маленький веб-сервер который по установленным с оператором сотовой связи протокол общается с ним отвечает на простой вопрос сколько отгрузить трафика одному конкретно взятому клиенту соответственно общение происходит примерно так симка просит интернета у мисс местного зимбабве telekom зимбабве телек он стучится в коннектор коннектор выполняет транспортную функцию заточены только строго под этого провайдера и спрошу спрашивает о тарантулом трандл сколько можно отдать трафика этой симки тарантул говорит у этого клиента у этой симки на счету 3 евро цена 1 гигабайта 1 ияра значит можно нагрузить не более 3 гигабайт за одну сессию одна сессия это соответственно непрерывное пользование интернета но не более определенное количество секунд в нашем случае это 306 триста шестьдесят секунд количество симок которые могут постучаться из этого оператора не ограничено мы стреляли яндекс яндекс танком и получили характеристику что вот прям совсем в узкой в 1 в 1 ядро наш наш биллинг умеет спокойно работать отвечать давать ответ в течение 100 миллисекунд при нагрузке 6000р пскр ps это конечно же не сравнимая нагрузка с тем что умеет в принципе тарантул здесь есть куда есть куда оптимизировать но сами понимаете тарантул может все вот мы его простым нагружаем дополнительной логикой теперь мы добавляем 2 коннектор в тарантул который отвечает за работу со вторым провайдером соответственно точно также симки стуча достучаться в оператора сотовой связи оператор сотовой связи стучится в коннектор коннектор я сам написал что допустим верхне коннектор это реализован протокол диаметр на эрланге нижней на питон на питон торнадо оттуда выйти коннекторы можно напихать напихать все что угодно говоря современным языком мы имеем в наличии микро сервис который отвечает отвечает за одну маленькую конкретную функцию за общение с каждым оператором верхней коннектор отвечает за общение там зимбабве telekom нижней ну предположим с каким-нибудь не знаем там вода фоном соответственно таких коннекторов можно выстроить сколько угодно пишут они легко и легко и просто там в принципе написать это написать коннектор для одного оператор занимает работы программиста один два один два дня больше всего там работы как ни странно связано пуск согласованиями с настройками сети пвп на карточке карточки на настройки этого vp на и вот это вот все все взаимодействие таким образом мы имеем полноценно полноценный микро сервис с бесчисленным количеством коннекторов понятно что таких микро сервисов там можно разделить на всю группу клиентов на разные ноты например вот так соответственно мы получили на этапе мвд на x коннектор фан вынес биллинга неограниченной масштабируемость и шарди рование сами сами по себе таранда атаман длинные ноты понятно реплицируется по схеме по схеме мастер мастер на текущий момент у нас три таран дульных кластера во франкфурте люксембурге и амстердаме мы планируем еще два кластера поставить в азии 2 в америке теперь немножко о так называемом буфере транзакций я вот немножко клоню сюда вот сюда симки симки фактически создают у нас транзакции которые тратят тратят баланс накапливать электро накапливать этих транзакции можно ролл ровно то количество то количество которое помещается в памяти одна транзакция занимает 150 тбайт причем на самом деле там есть еще куда есть еще куда оптимизировать вот 1 1 но до 1 note соответственно а сейчас а сейчас дает 199 190 гигабайт путем несложных арифметических вычислений можно понять сколько у нас помещается памяти но все эти транзакции в режиме стрима выгружается дальше на следующую часть биллинга задержка не более 10 секунд соответственно flow flow движения транзакций биллинга от tarantula после сквер где он превращается в полноценный белен биллинговые проводки там соответственно работает бухгалтера маркетинг менеджер и все на свете кто кто обслуживает всю работу работал оффлайне продажа симок рефералы ну и вот это вот все соответственно закрыли день выгрузить этот контакт сэйв crack house и все у нас получается тарантул свободен погряз свободно и мы не решаем задачу обожравшийся коровы у нас никогда не возникает ни возникают ситуации переполнения базы данных на этапе mdx биллинг автором то ли никогда не возникает задача перегруза перегруженности база данных на этапе пожгли сквере у нас все складывается в подвал и кгб увлекался соответственно немножко права по сгорю что нам требуется сложно требуется на этапе обыкновенного биллинга с которым каждый из нас сталкивался кто нибудь трубилин когда-нибудь столкнуться задача режь решал поднимите руки пожалуйста ну соответственно все чем вы сталкиваетесь это вот все все есть вот все все знакомо есть в наш в нашем позади сквере гибкость логика на всех на всех уровнях то есть логику можно как угодно построить внедри сам по узбекский можно любой клеевой язык и тула ппх первые не знаки нить еще языке соответственно шарден ввысь реплицировать здесь можно практически черта с рогами построить и самое главное мы не решаем задачу здесь задачу скорости на решаем задачу только гибкости мы можем построить какое угодно какое угодно какой угодно сложную логику следующий пункт соответственно клик house от него требуется просто уметь хранить и правильно и быстро обращаться с огромным массивом данных или house является колоночный ориентированные базой данных и практика загружает даже тупо access логе все исторические access логе за все годы жизни но давно-давно распространена соответственно мы используем клик хаос как для конфетного приземления данных о нас из коробки готов к горизонтальному масштабированию и у него есть аналитика вот соответственно к нему дальше дальше прикрепляется аналитические системы которые не это работниц самое простой не аналитическая просто для реализация тоже граф она спокойная работа если house в итоге мы построили ис-3 ис-3 компонент полноценный биллинг умеющие решает при основные задачи отзывчив отзывчивые быстрый он гибкий и он емкий у меня все вопросы просто здравствуйте спасибо за доклад у меня вопрос такой вы оставили хранится на счету мне 3 евро потом проводки когда списывают когда с когда списывается со счета деньги деньги списываются сразу при отгрузке трафика она соответственно транзакция записано записывается страна в список список транзакций то тарантула и дальше перегружая перегружается в паз грейс келли для консистентной sti данных в каждая транзакция содержится результирующий баланс и вот мой когда транзакция записывается сразу списывается баланс баланс в tarantul и спасибо такой вопрос а где находится сложная биллинговая логика то есть тарантул просто отвечает да нет аистом кита под условия сложно например трафик для контакта или что не подобное значит за это отвечать за это отвечает прайсовой политика которая загружается на тарантул вспоминаем слайд с тарантулом я сейчас его покажу секунду или я это сюда не писал до ним сам значит тарантул загружается баланс и пользователей и прайсы в прайс и входит дели деления на непосредственно самих клиентов на и msi внутри симки соответственно приходят разные и msi они подчиняются различным прайсом и так же сам трафик трафик делятся на категории например есть категория отвечающие за час зачата вый трафик соответственно для читал отрада трафика в прайсах отдельной колонке спасибо микрофон не работает ололо у меня зовут михаил вопрос такой как часто у вас происходит обновление данных из под гриф тарантул и какой механизмом в онлайне типа или существует какой-то конвейер который туда загружает насколько это там дискретностью значит них меня попросили перед началом выступления дублировать вопросы видимо для записи повторю ваш вопрос значит как часто происходит обновление данных не по основному flow 2 же движения от tarantula клик хаоса а из ее спас лифта автором она происходит директивно при при изменении баланса тарантул таки да такие даются транзакции немножко уточню это получается в подогрев срабатывает какая-то триггерная система до что изменилось теперь надо закинуть в обратную сторону то прошу прощение значит когда я рассказал чине доклада о том что происходит flow информация о тарантулах пузырь сквер и клик хаосу я имел в виду что делает это не самостоятельно тарантул после клика us a клеевые клеи и вы языки и коннектора в случае тарантула коннекторами вот они коннекторами может быть or long орланд для реализации протокола диаметр питона питон tornador конце концов можно даже тоже тот же 1 прикепить потому что функции настолько примерно настолько примитивным эти микро сервиса то справится любой язык по моему даже пуск риф справиться соответственно для по для под грейс келли у нас используются клеевые языке мы используем папы hulu айгул связи 90 чем обусловлен выбор вас пазлики х соответственно например по сравнению с уроков что является таким классическими решение я прошу а вот такие же не значит я повторяю вопрос потому что они попросили по регламенту чем обусловлен был выбраться вывода по после сквер и клик хауса значит сегодня в сравнении с 40 вам значит вопрос это чисто коммерческий относится он к тому что мы хотели свой собственный биллинг у которого есть дешевые масштабе дешевая масштабируемость вот 40 вам наверное мы бы не получили такие такого снижения к стоп конечно же можно а здесь привести аргумент о том что мы в в дальней перспективе можем нам учиться способ способе склеили ecли how some оракал дает этой из коробки но пока всей истории успеха которой я которой я слышал вне банковской сферы с оракулом сталкиваться в основном больше сложностей которые вопроса клиентские приложения через которые там тарифы заводится абоненты за улице прочее они с чем работают фуги да естественно значит всех все клиентские части которые которые проводят эквайринг которая происходит заказ семак которую производ многочисленные мы к численные админке для менеджеров для дистрибьютор а для нашего собственного менеджер то не работает с основной базой данных пузыри с грейс келли то есть здесь ключевая мысль заключается в том что мы используем традиционные механизмы пас грешки или стандарта стандартный в пфр фрай марки для решения стандартных в бы вы барских задач для решения задач мвд x биллинга мы используем тарантулы микро сервиса к нему для хранения всей информации мы используя используем клик house еще вопросам да вот у меня спасибо знак от меня вопрос во первых уточнения а где вы делаете вот в те самые сложные биллинговые операции выставление счетов представление налоговой отчетности какой из баз данных давайте еще раз как вас зовут то ли на тореза наталья задала вопрос о том где происходит непосредственно сама работа основного биллинга со своей слой со своей сложной логикой разделение примерно такое в клик хаусе мы храним все исторические данные тарантул общается через коннекторы непосредственно с операторами соответственно под грейс келли и web и в приложении стыкуется с такой свое приложение мтс такой там с ценами и air пышками урывками а потом у рынка ты это другой серии вот они соответственно реализуют все те за все те сложные задачи о которых может которых может возник потребность у бизнеса сам биллинг построен по классической бухгалтера бухгалтерская схеме с двойной двойной записи о каждой проводке управление активами и пассивами и этапе это по разгрузке вы говорили про про вы говорили что вам скорость времени важную это про клик house именно банка я вам наверное важно тогда время да потому что счет можно нужен некоторым клиентам нужно очень срочно счет выставить хорошо вот эта срочность выставления счетов для клиентов измеряется в миллисекундах нет днях на верх а вот я так подозреваю что скорость с грейс келли хватит хватит для того чтобы удовлетворить любого клиента и хаусе конкретно поздравит разделение не почту есть исторические данные в данном случае то есть формирование в документов считаем ежемесячный биллинг проходит в паз игры а в какой момент приходит данный при house и насколько недоступные для чего или они параллельно существуют и содержит одни и те же данные cliff house для аналитики только используется при закрытии при закрытии бизнес дня все да все давно передают в кликал некоторые данные при перегружают перегружается раньше для того чтобы для того чтобы их можно было в реал тайме подвергнута аналитики до подглядывай пазле потеха граница значит суд суточные данные для операционки месич месячные данные для закрытия месяц в месяц а не все не все да они все данные пеленгования проходит в какую из систем бланк ежемесячный биллинг покрыть ими да значит это все происходит в подвижкой то есть там месяц как минимум хранится получается не день а месть часть часть данных часть данных остается под горшки ель на на месяц соответственно мы следим за тем чтобы у нас тарантула и пожгли шкель выполняли так называемые фильтрационные а фильтрационные ли обогатительные функции а окончательно данные которые уже не изменится никогда они перегружаются клик house заказ документов возможен да там можно заказать счет месячной давности двухмесячный трехмесячной в одном случае обращая всегда это если хауса берется да да на данный можно заказать и годичной давности искре house low практически такой вопрос вот ты прилетаешь другую страну закону выходишь из аэропорта вставляю симку интернета нет и вообще как бант подключен долго почему-то регистрировать иногда не всегда но иногда что происходит фону вот то есть как у вас общения с местным операторам происходит почему регистрации может тормозить отправит вождь и рыскает я могу только кратко потому что это вообще тема отдельного отдельные целой серии доклада значит я кратко упомянул дело в том что симка это такой же компьютер как скажем там вот такой ноутбук ну просто это микро-микро компьютер в нем в нем за зашитым новость о много симок и существует логика по которой эти семь теперь переключаются и соответственно при регистра регистрации в сети симка включает включается на последнюю использую использованной им сию осматривается где она находится в какой стране и после этого переключая переключаются на правильный и msi для нужной стороны это треба требуется для того чтобы подобрать правильный корректный тариф и чтобы у нас цены не были там по 100 долларов за метр ну а если вот очень долго это все будет происходить то есть вы с оператором вашей симке общается и за что значит домой ася моя симка наша симка об щая общается именно с оператором на случай если возникает какие-то совершенно не придали ему непреодолимый злот сложностью в приложении есть цены в 2 2 специальные функции которые как предохранитель из паза спасают от любой ситуации во первых там есть оффлайн faq мы специально построили систему чтобы поставил при обновлении приложения 1 обновлялся факт которым есть ответы на большая часть вопросов если этого не спасает у нас есть служба поддержки как у которой норма но норма скорости ответа заключается там пому 20 или 30 секунд здравствуйте за свой клад меня два небольших вопросов 1 вы говорили про отгрузку трафика покупателю ну то есть пользователи сети проводится ли таким же образом отгрузка трафика нам то есть именно закупка трафика либо это происходит в операционном биллингов пожгли то есть грубо говоря произошел условный звонок мы списана с баланса нашего клиента симки не к суму но в этот же момент мы приобретаем услугу от оператор правильно понимаю или лет или я нет не в ту сторону значит расчета с оператором и происходит по факту месяца то есть это большая сумма я на по факту не нагружена в планетам маленьких транзакций их нету одна большая пауза методов когда в конце отчетного периода мы проводим перекрывать перекрестная проверка проверку свет сверху и по результатам такой сверки проезд происходит расчет и так понятно спасибо и второе по аналитике в treehouse я предполагаю что есть некие сквозные измерения по которым бизнес требует аналитику биллинга ну то есть например по строчкам по sim картам по там тарифам по каким-то группам пользователей как вот это организовано с точки зрения там структуры данных можете пример привести то есть это большая широкая таблица там 40 колонок на абсолютно я приведу пример типичного типичного за запроса значит нужно посчитать маржи на маржинальность транзакции по по всем операторам и из них соответственно сгруппировать по клиентам которых средний чек 10-20-30 из 40 40 евро это пример например запрос от бизнеса это все treehouse да спасибо здравствуй очень интересно у меня два вопроса первый просто 20 миллисекунд 120 секунд это время ответа требуемая от коннектора до тарантул но и обратно до или это сквозной от симки до биллинга это время а вот коннектор а до оператора коннект это понятно и второй вопрос по поводу тарантула я вот увидел строчку lua на языках да вы что то используйте внутри дну как сера и приложение его использовать или как только базу данных нет конечно же мы не спорим мы используем таро тарантул как сервер приложений потому что именно эта логика и отвечает на основной вопрос сколько отгрузить трафика коннекторы выполняют исключительно транспортную функцию это очень жесткое разделение потому что с одной стороны кажется что тарантул бы тоже мог бы мог выполнять эту функцию мы намеренно разделили канал отдали коннектором транспортную функцию задача как коннектора установить кадр connect между тарантулом и оператором грубо говорят тарантула общается с коннекторами по единому про то по единому протокол а коннекторы уже общаются с операторами по специфичным для пират для оператора протокола поэтому на коннекторах находят только транспортная функция грубо говоря не период разными протоколами а вот а тарантул выполняет всю логику связанную с вычислением того сколько сколько клиент может потратить денег и и много такой логике вот внутри тарантула нас она не страдаете в этой поддерживаю такого блоки внутри базы данных ну не больше чем разработка либо любого другого приложения для нас это а еще а еще одно приложение которое там у него есть свой собственный репозитарии она соответственно развивается по своим законам тестируется ну соответственно проходит понравится цикла разработка dvd ft стретч production спасибо вам большое спасибо за доклад продолжим или если тему вас наслать и там был написан что вы поддерживаете более тысячи бен и x различных операторов это что в данном случае значит что у вас больше тысячи им сено к на мальте им все карточки либо вы хотите более тысячи вернул операторов различных на своей платформе значит операторов действительно много ем все действительно много но и больше чем сотню на новые симки не поместится вот конечно же мы знаем про все эти ограничения как именно мы решали эту ситуацию это ответ за рамками этого доклада я с удовольствием с вами спешить нам в конце есть мои контакты спешите сан и попробовал ответить наш опрос да хорошо пасибо после везет по сайдингу тарантула оборудования имею ввиду то есть премьер но если можно да там примерно но не знаю там на студия метровый запросов в секунду которые идут от оператора да какая мощность оборудования под тарантула нужно примерно мне проще на она пристать к конфигурации железок спешите со мной после доклада я пришла простите меня ширина вопрос есть вы когда новой к трилистья вы его на горячую подменяете или тарантул перегружайте все зависит о каком уходе и коде идет именно горечь все тепло и у нас строится по бесшовной схеме поделись сине-зеленой схеме пардон за тавтологию это сине-зеленая схема подразумевал подразумевает что у нас существует два продакшена из ответ соответственно последовательность переклюк его последователи переключения каждой компоненты с основного состава на запасной регламентируется правилами сине-зеленый схемы это с оперным проблема в том что тарантул это и код и данные тоже поэтому как не очень понятно как это работает мы разделили разделили таранто тарантул отдельно у нас живет кот который по тяге подтягивается в тарантас с данными ну соответственно у нас в tarantul и присутствует в две копии куда здравствуйте есть спасибо за доклад у меня такой вопрос про консистентной sti надежность транс разговора биллинге можно чуть подробнее понять вот у вас есть тарантул чтобы он быстро отвечала вы укладывались в этот sl100 20 миллисекунд но при этом вам надо все проводки зафиксировать в подбрось вы это делаете асинхронно взаимодействие сервисов друг другом или синхронно и в момент запроса получается оператора до вашего коннектора вы еще внутри себя делайте один сетевой запрос имеете дело с таким с такой архитектуры решение о том сколько а сколько можно отгрузить трафика принимает тарантул самостоятельно взаимодействие способ диска или происходит асинхронно из ну наверное все таки бывали случаи когда там позы груз был недоступен какой с консистентной именно консистентной до нас данных платежей tarantul ее в подписях поддерживать у вас там consistent консистентной данных требуя требуется не как копии всех транзакций а требуется консистентной баланса чтобы под пользователь загрузив на приложение из историю своих трат видела видел адекватные данные вот если у нас отвалится connect между тарантулом ip-адресом мы просто на пост с грузим чуть чуть чуть позже чуть позже последний транзакции но я я об этом наверно не сказал дело в том что значит он нас тарантул выстроен здесь наверно это не очевидно тарантулы кластер а тарантул выстроенные по схеме двойного двойного дублирования то есть у нас существует три три копии данных поддерживаемых на страна стороне трандла понял спасибо здравствуйте вот это за доклад подскажите как вы с ярмом проблему решает всем фирмам форм бы российский оператор зарегистрированы в рф или нет какие же определенное сормово и законодательства и то есть со своим биллингом это лицензирование это кучу геморроя на этот вопрос есть ответ одно под микрофон я который деньга-то не готов поэтому оставим под формулировкой без комментариев спасибо добрый день спасибо за доклад ный следующего bronze маги пояснить как выглядит процедуры списание средств районе понимая что на момент запроса доступного количества трафика идет именно вот в этот момент списание средств для этого происходит позже в какой-то момент у могли бы тот момент раскрыть значит на сторона стороне тарантула находит находится самый актуальный самый актуальный баланс баланс у пользователя когда опера к нему приходит операторы спрашивать сколько можно сколько нужно списать денег вот этот баланс уменьшается и записывается записывается в виде транзакции транзакция хранится кроме самого списания еще хранится результирующий баланс задержка не более 10 секунд эта транзакция попадает в пост грешки ели превращается в биллинговой проводку соответственно когда у пользователя закончатся деньги на таран то ли он сразу перед перестанет получать услуги то есть получается сотовый оператор не спрашивать сколько доступно он сразу запрашивать транзакцию списать средства со счета и темпами samp samp протокола общения немножко сложнее он выглядит примерно так дорогой тарантул скажи пожалуйста сколько у поля сколько пользователь можно нагрузить трафика дорогой оператор трафика можно отгрузить не более двух гигабайт за одну сессию спасибо дорогой дорогой торрент вот потому пользователю которым ты разрешил потратить 2 2 гигабайта это пользователя потратит 17 тысяч восемьсот шестьдесят три байта тарантула горит спаси спасибо дорогой оператор деньги мы списали соответственно когда он приходит следующий раз дорогой то дорогой тарантул сколько можно потратить трой на трафика он соответственно получает число меньше на это 18.063 байта так вот это общение происходит под капотом то есть я вот загружаюсь танец условно говоря запрос пошел сотовому оператору и все это это в течение всего этого процесс идет это вот взаимодействие словно я понял пасибо у меня еще вопрос первый про мультивалютность вообще есть такое понятие или нет если да то как организовано хранение баланса в валюту на стороне трампу вот это первый вопрос значит отвечает отвечая на вопрос на ритм и первым иди одна одной валютой евро то есть только евро и второй вопрос такой управленческий вот этими тремя условно подсистемами занимается одна команда или целый пул если целую пункту как они между собой взаимодействует с точки зрения организации разработки значит команд команда разработала разработки специалист специализировано то есть отдельно задачами по микро сервисом связанный способ способе сквер из сторон за занимается разные люди но они постоянно постоянно взаимодействуют друг с другом с общая численность команда сложить достаточно компактная спасибо такой вопрос 2 запросы от оператора может не прийти с количеством сколько именно было потрачено и оператор это потом предлагает смотреть пологом вы это как до списываете этого является на перекрестках сырках на перекрестных и тогда в тарантулы происходит апдейта баланс абонентского ну туда дома мы оперируем транса катран так сами 2 записи бухгалтер и соответственно это просто дополнительно проводка корректирующие здравствуйте спасибо за доклад а еще такой вот вопрос вы куда платежи принимаете и как обновляйте баланс в торонто ли платежи принимается в пост голова после эскель соответственно микро сервиса кузова подвижки еле идут тарантулы и добавляю туда транзакцию на увеличение баланса еще вопрос коллеги можно конечно скажите вату и сказали про двойные проводки про перекрестную сверку что будет если пользователь списал потратил трафика больше чем ему разрешено просите я снижу во где потрите просто вопрос что будет если пользователь потратил больше трафика чем ему разрешено то есть и это выяснилось при перекрёстной сверки какой-то то есть отрицательные баланс и бывают нет отрицательный баланс и так они в наш в нашей схеме исключения потому что мы работаем по авансовый схеме авансовый схеме платежей а вот ну в такие в таких случаях ну да у клиента получается отрицательный баланс он его со временем исправляет или не исправляет это общительная тем наши беседы спасибо здравствуйте дмитрий у меня вопрос такой что вот из-под gresso ушла от все транзакции в клик хауса да и вдруг они неожиданно информация а транзакция понадобилось ну не знаю там спустя месяц обнаружилось какая-то ошибка там не знаю неправильно списание средством линия симку украли там не знаю там посуду восстановили деньги там на ней транзакций уже в под грехи нету они уже только в хаусе лежат что делается но это часто бухгалтерский вопрос бухгалтера первые за понятием закрытый банк разогретого банковский день конкретно в этом случае будет просто дополнена дополнительно транзакций аналогичные денег ну то есть они общаются с клика усам да и просто добавляет какую-то определенную проводку глинку систему ну если совсем правильно правильно говорить на баланс пользователям начисляется начисляется средства и они дальше идут по осаго по сравне flow рано или поздно попадает канала попадает в кли house спасибо ольге 20 алексей у меня такой вопрос я правильно понимаю что поддерживается только один тип баланс и монетарной то есть нет возможности скажем при по приезду в какую-то страну купить пакет состоящий из трех гигов до чтобы он меня как не монетарный баланс был из вписывался в обратную сторону это полить значит это вопрос касается ценовой политики dream сима значит dream сим позиционируется как оператор в котором нет скрытых платежей нет сложных по нет сложных пакетов только-только а плата за трафик сколько потратил столько заплатил спасибо влазит а вот который мобильное приложение которое показывает понимаю историю клиенты так далее все через позарез делается ну по сидению полей он хочет посмотреть допустим да как там у него в личном кабинете там списать списывались деньги там на что он потратил значит здесь мы уже упоминали что часть данных кликах ли house идет сразу сразу же при получении выгрузки данных из тарантула и как раз пей за эффекте зафиксировано зафиксированные проводки сразу сразу идут копируется кликал из для того чтобы искре хауса можно было можно было делать как раз ответа на этот вопрос она чтоб отрадно что потраченные деньги типа этим занимается клик house как раз спасибо коллеги еще вопроса просить я не все вопросы поотвечаю то для трансляции наверно плохо да прекратите для построения информирования отчетности которые sky house уже идет но в печатной форме например да или там краматорска и какой то какие средства используются специализированные или просто написанным там на чем-то ваше собственное то есть учетная система каким образом поздравим там не понятен вопрос генерация отчета другими словами ну технически там ничего со ничего сложного на выходе получается pdf к вот на и так понимаю вопрос что другой спрашивать его для формирований pdf и вы просто сами писали какой-то софт и или используется какая-то отдельная система внешне куплены они роду здесь используется наше собственное создание спасибо я извиняюсь уже могу образ простой вопрос сумма номинальная на балансе хранится в копейках или все-таки с плавающей . сумма хранится в целых в целых числах значит 11 евро это сто тысяч единиц 100000 и второй вопрос вы говорили что при списании там ну при приводили примеры в байтах потраченного трафика еще раз вы приводили пример при списании с баланса в байтах по тропе потраченного трафика вот я понимаю что это в копейках ну не получится стопроцентно круглая сумма как вот именно округление как происходит как разруливаются вот эту в какую сторону округлять там приводить к десяти центам условно к центру или как то еще как вот это вот решается вопрос округления потому что понятно что там точность может быть совершенно не 4 не 6 даже насчет меня настоятельно просят закругляться давайте вот ваш вопрос отвечу и еще один вопрос значит еще раз и еще раз подчеркиваем значит оперирование трафика идет в байтах оперирование деньгами деньгами идет из расчета из расчета единиц что один евро это 10 10 тысяч единиц округление сейчас сейчас production идет о правлении пому до 4 знака после за до 4 знака после запятой в евро вот соответственно при ну там лежал был в ближайшее время не скажу несколько не скажу какое точность повысится еще один вопрос спасибо за доклад а вопрос такой каким образом настроена резервирования и если она вот этих всех нот и каким образом них нефиг синхронизируются баланс и транзакций между ними это значит реализовано на уровне мастер мастер аппликации штатная репликации торрент вот кроме крана кроме того мы решительно перерыва бака пойми но про это действительно долго рассказывать на этом все огромное спасибо за вопросы я был рад за изменить ваши какой-то взгляд взгляд на биллинг на не надеюсь был был полезен вот в конце слайда мои контактные данные пишите стучитесь в мой чатик посвященный вопросам технических директоров всегда был и буду рад компания dream a dream симу всегда все мардан"
}