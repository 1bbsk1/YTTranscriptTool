{
  "video_id": "o9XuVXTotHU",
  "channel": "HighLoadChannel",
  "title": "Как мы внедряли ядро инвестиционного бизнеса Альфа-Банка на базе Tarantool / В. Дрынкин (Альфа-Банк)",
  "views": 1046,
  "duration": 2960,
  "published": "2019-05-15T02:15:27-07:00",
  "text": "всем привет сразу скажу спасибо что вы пришли я знаю уже вечер уже поздно все устали сегодня но я постараюсь сделать доклад более-менее легким на подъем чтобы вы тут не скучали не грустили и все прошло гладко и весь опыт к не зря меня зовут рынке владимир я работу альфа-банке я расскажу сегодня о том как мы строили внедряли ядро трансакционные дроне сонного бизнеса для альфа банка на базе тарантул скажу сначала пару слов о себе кто и такое общее я уже три года работы в альфа банке я успел поучаствовать за три года работы в 6 проектах и на текущий момент я являюсь тех ли дом команды развития инфекционного ядра которыми дальше буду рассказывать коротко скажу о компании в которой работаю альфа-банк это крупнейший частный банк в россии он входит топ-10 банков по размеру активов всего альфа-банка более 14 миллионов клиентов и альфа-банк является универсальным банком что имею ввиду имею ввиду то что альфа банк выполняет все наверно или почти все виды банковских операций и одно из направлений бизнеса банка это инвестиционная и дальше именно нем пойдет речь не сезонный бизнес это своего рода рокет сайенс в банковском мире почему потому что у нас есть кредиты и займы есть депозит и вот все то же самое что есть в рознице а ещё сверху у нас есть ценные бумаги валюта товары деривативы различные фьючерсы и опционы с папой и новые веяния структурные продукты также ин сон и бизнес оказывают брокерские услуги для физлиц депозитарные услуги по охране не бумаг депозитарии оказывает услуги лицам с крупным частным капиталом по двигательному управлению и выпускает ценной бумаги для других компаний немного цифрах альфа-банка альфа и не ционного бизнес в частности медицины бизнес это более 3000 котировок в секунду мы получаем с различных площадок мы получаем больше трехсот тысяч сделок за 12 часов работы рынков и сохраняем и к себе до 5000 исполнение ордеров в секунду происходит на бирже по нашим сделкам и на других площадках и мы осуществляем пересчет позиции для всех клиентов в различных разрезах в чем собственно нас проблема проблем у нас в том что мы наблюдаем устойчивый рост числа клиентов и их потребностей с чем это связанно это связано с детскими вещами первое это то что низко лет назад появились индивидуальные сезоны счета который позволяет торговать физлицам и не платить налог на доход с торговлей бумагами также мы наблюдаем рост финансовой грамотности селения населения все больше увлекается торговлю границы между различными сегментами клиентов потихоньку стираются и клиенты становятся клиентами и все больших направлений бизнеса и они все хотят управлять всеми своими продуктами сразу управлять мульт продуктовым портфелем и конечно же все клиенты хотят видеть отчетность по всем своим продуктом в реал тайме я и не как иначе кроме роста потребности клиентов мы наблюдаем рост потребности регуляторов очень много всего я даже не буду щас это все перечислять знаете что если у вас там вдруг появится свой фен тех или там вы устроитесь банк госпожа набиуллина будет пристально следить за вами и за вашей деятельностью исторически сложилось так что направление сцену бинтовали звонки развивались независимо было направление связанные с биржевой торговлей и брокерскими услугами для физлиц был направления связанные с торговли валютой и было направления связанные с в не биржевой торговлей ценными бумагами и деривативами как для крупных компаний так и для состоятельных лиц и почему это правило приводит а потому что мы попали в ловушку функциональных колоссов что это значит системы дублируют функции друг друга у каждой системой своя модель данных при том что эти данные по сути об одном и том же мы имеем запах зоопарк технологии потому что все эти направления развивались друг к другу независимо они строили систем на своем стейки своими разработчиками и никак между собой просто не пересекались мы имеем на текущий момент устаревающую кодовую базу потому что все наши системы появились середине двухтысячных годов с тех пор они просто лью обрастали обрастали различным кодом и поэтому сейчас у нас медленный процесс разработки и конечно же проблемы с производительностью и поэтому резюмирую вышесказанное могу сказать что без технологической информации не стану бизнеса мы потихоньку будем терять просто и обороты которым мы набрали и поэтому нам была поставлена задача сделать хранилища и поместить в это единое хранилище все данные бизнеса и поместите в это хранилище данные не просто так а именно в единой модели чтобы все сущности они были представлены лишь один раз и только как описано в модели и мы могли строить отчетность как клиентскую то кури культурную по всем этим данным оперируя одним языком над этими данными обязательно у нас должно быть вы все они ранее данных потому что сейчас это боль сейчас у нас оно есть но не везде и более того business hotel не просто какую-то быструю базу и быстро хранилище он хотел получить платформу для решения каких-то бизнес-задач и регуляторной задач то есть чтобы на этой платформе можно было устроить какие новые сервисы и все новое и при этом все было внутри все было в коробке чтобы код был рядом с данными все это работало быстро и нам были поставлены так же условия что решение должно быть уровне enterprise в банках по другому не бывает в общем-то потому что мы работаем с финансами и работаем с деньгами что это значит это решение которым мы принесем оно должно быть уже опробована в каких-то компаниях в крупных банках или в теле комах и на него должна распространяться поддержка режим работы нашего решение должен быть мишин критику что накладывает серьезные ограничения на схему развертывания мы должны находиться в нескольких дата-центрах одновременно мы должны репрессировать данные обеспечивают полный отказоустойчивостью обязательным условием было то что в нашей системе должно быть горизонтальное масштабирование потому что все нашу текущую систему масштабирую столько вертикально и мы просто-напросто уже упираемся возможности железо которые мы покупаем поэтому мы хотели и нам будет поставлю слове чтобы это все работало на коммунити железе и мы могли просто закупать простые сервера и масштабируется горизонтальный любой момент времени и в совокупности у новой системы нужно быть невысокие te sigo то есть невысокая стоимость сопровождения несу к стоимости разработки и разворачивания и собственно вот мы все это получили собрали и отправились искать решения мы сформировали как обычно требования по нашему банковскому процессу нам нужно было пойти в закупке с этими требованию чтобы закупки дали нам список компаний которые признаны на рынке и которая готова для нас будет сделать эти решения мы получили списка за 10 компаний с каждой компании мы встретились и рассказали им о нашей задачи и от 6 компаний получили оценку решение которые не готовы сделать для нас завершения нашей задаче мы в альфа-банке очень любим все тестировать особенно на грушин тестировать поэтому обязательным условием нашего конкурса бы его прохождения нагрузочных тестов мы сформировали тестовые задания для нагруженных тестов три компании с 6 не согласитесь реализовать прототип решения ноябре технологиях за свой счет ну в общем мы залива отлично и протестировали под нагрузкой и все полученные три решения то как мы тестировали я могу рассказать потом отдельно потому что то большая тема и тема достойна отдельного доклада поэтому я здесь просто подведу итог что вашу производительность в нагруженных тестах показал прототип решения на базе тарантул от команд разработчиков из mail.ru вот мы заключили с ним договор у и начали реализацию проекту нашего проекта следующей командой бухучет и разработчика стороны mail.ru 3 разработчика страна альфа-банка 3 аналитика страны альфа банка и как обычному solution архитектор продукт оунер и скрам мастер и далее я вам расскажу как мы вот на базе тарантула шаг за шагом кирпичик за кирпичиком строили нашу систему в первую очередь у нас появились кадры и адаптеры мы должны были получать данные из текущей системы нашего ландшафта и так как большая часть систем работает по у нас поищите это либо swap либо перри пересылка джейсона в площадь и то вот мы просто взяли и добавили 2 ищите пи адаптера блогов tarantul они есть фронтов очень хорошо работает из коробки с ищите и пошли дальше так как мы собирались хранить данные в единой модели а данные в исходных системах лежат в различных моделях нам надо было эти данные все трансформировать чтобы трансформировать нужно было их подвергнуть каким-то правилам трансформации мы долго внутри себя спорили о том как это надо делать вообще то есть трансформировать данные можно на купил в декоративном языке можно на каком-то императивном языке почему мы пришли мы решили что декоративный зик это все конечно хорошо и это удобно в каких-то простых случай когда вам нужно переложить данные из одного поля в другое как только вам нужно решать какие-то более сложные задачи да это какие-то условия какие-то циклы какая-то сложная аналитика уже на входе то декларативный за к вам явно не хватит и поэтому мы сразу договорились о том что язык нас будет императивным и так как тарантул он внутри весь код работает на вам решили что void будет отличным выбором потому что он простой легкий понятно и подает нам более того мы сразу сделали такую вещь которую называли песочница и она называется вот на свой dies in box песочница это то место исполнения кода которая в котором будущие ваш код исполненным он не может поломать ест всю внешнюю систему то есть вы можете запускать там любую вещь и тут код который вы пишете в может не бояться за его качество не можем вы можете не бояться то что он поручит вам систему то есть в песочнице запускать код безопасно и мы это сделали просто вот потому что язык во дает такие возможности пробросить какие-то безопасные функции работать именно с ними далее вот мы трансформировали данный виде на модель и дали их надо тва лидировать все-таки совпадают он стены моделью или нет мы также долго внутри себя обсуждали какой формат нам выбрать для описания модели потому что есть много разных языков есть x везде и все знают есть еще другие языки в итоге мы остановились на avr а почему авра во-первых потому что языку чем простой я не знаю кто видел кто не видел позволяет очень просто описались им структуру ваших данных при этом он не перегружен никакими лишними концепциями то есть он только вот про структуру немного сделал лирическое отступление и расскажу про то как мы делали единую модель и с какими трудностями мы столкнулись поначалу нам казалось задач простой мы думали вот мы в принципе хорошо знаем наш бизнес мы знаем все нашей системы сейчас мы возьмём из каждой системы в грузим данной какие там есть посмотрим смочим поляну группируем покрутим поверьте мне у нас получится единой модель в общем то мы так и сделали все выгрузили посмотрели составили какую-то единую модель пошли снег бизнеса говорим вот модель играть нет это не модель и почему это не модель ну потому что все на самом деле по-другому ok пойдем день течет спросим пошли в другую часть business in green вот смотрите вот модель этого то что мы сейчас получились текущей систем как вам говорят нет не подходит собственное мы оказались таком ему своего рода тупике потому что мы не знали как это решать проблему дальше и единственным решением которые мы нашли его следующее мы начали собирать с нашего бизнеса со всех тех людей которые используют как то данные кейс использования данных то есть мы начали решать эту проблему кейса кейса мы собрали бизнес кейсы и мы начали выдвигать гипотезы и натягивать нашу модель на эти бизнес-кейсы смотрите как эта модель решает эти кейсы именно поэтому с самого начала мы хотели сделать так чтобы модель данных была value цианирование чтобы в каких-то разумных пределах ее можно было расширять и менять без каких либо ограничений поэтому что мы сделали мы сделали какой-то первоначальный каркас модели которую удовлетворяя этом первой части кейсов и мы заложили основу до чтобы и потом дальше эволюционирует и развивать чтобы решать задачи кейс бы кейс и в итоге получить все таки то что на самом деле нужно бизнесу и вот мы ее а два лидировали объекты по единой модели и теперь их нам нужно сохранить сохраняемых вот хранилища мы используем wish арт мы используем реплики у нас geo geo разнесенный кластер то есть часть реплик живет в одном да да центре часть переживет другом и таким образом мы обеспечиваем отказоустойчивость давишь а также нам дает возможность масштабироваться горизонтально в очень широких пределах и тем самым мы решаем задачу вот с mesh in critical системы нашей текущей системы который сулит нам данные это как правило legacy системы и они нарушают просто поток данных и не в принципе все равно пришли к нам данный или нет они просто нам их реплицируют поэтому если что-то в этих данных не так или не проходит валидацию по модели или они как-то они трансформируются в единую модель мы не должны терять эти данные вот таким образом нас появилась ремонтную очередь ремонтную очередь это то место куда попадают какие-то вот проблемы то есть это либо что-то неправильно смотрелось либо что-то вот пошло просто не так администратор помещается как только что-то попадать ремонтную очередь и соответственно может либо поправить модель либо поправить и данный который не удовлетворяет модели если что-то в данных именно не так было либо как ты подкрутить конверт рансон обработка так чтобы на правильность все усматривать сохранять это конечно очень хорошо вот я рассказал все про сохранять но тем не менее как мы сохранили они там лежат и собственно что дальше да как бы их надо как доставать и тут я тоже расскажу небольшую историю как мы внутри себя спорили что уже у нас должно стать языком запросов данным первоначально нам говорили что вот мы делаем новый проект все круто а давайте мы сделаем свой супер гибкий универсальный язык который будет подходить просто под нашу предметная область наилучшим образом мы так подумали подумали и посмотрели на наши срок и решили что он не настоящий де хорошая да и почему бы нет но за разумное время на мало реализуем а вот и поэтому мы начали смотреть на то как живут наши системы как они общаются между собой как общаясь своими брендами и своим базам данных и на самом деле все просто у нас довольно классической архитектуры приложения есть front-end и back-end есть какая-то база данных обычно реляционная и вот как раз бэг-энде там есть какой-нибудь vrm который мопед устраняет соматический разрыв между от реляционной моделью и объектной моделью и мы решили а почему бы нет почему бы и взять да не сделать сразу у нас нормально интерфейс которые объектный наружу вот и для этих целей нам простаки отлично подошел граф киеве травки разработка фейсбука язык запросов гибки язык запросов можете попросить только те данные которые нужны вам этот язык он предоставляет вам полную интроспекция значит всех запросов и ответов которые вы у него просите и мы сразу сделали так мы с 1 телеграф quelle с моделью и у нас при загрузке модели сразу генерируется интроспекция и сразу предоставляется на клиенты то есть любой момент когда вы просите интроспекция вы получаете свежую модель и можете прямо вот строить запроса и либо и системы вы либо просто руками он вам любой клиент вам подсказывает для граф келли как это делать мы сразу поняли что для каких-то запросов нам понадобится просите простейшие функции которые передают полями объекта например вот приходит вам котировка с какой-то площадки и в котировки есть цена bid и цена ask a системе которое потребляет данные нужно не только by тоска еще нужен курс средней значение котировки и поэтому сразу добавили функции которые также выставляются на трапецию графики ель и которые вам позволяют получать в полях объекта который уже лежит какие-то вычисляемые поля на основании какой-то простой логики ну соответственно каждый запрос там он должен быть аутентифицирован авторизованно добавили аутентификацию и в итоге мы так смотрим смотрим на наше решение понимают что в принципе все наши вот функциональные блоки они отлично группируются по низким ролям вот у нас пути у скопировать по трем ролям это вот роль который занимается обработкой входящих соединения называется дико ник на слайде роль которая занимается обработкой транзакционный и в которой крутится код который вполне ты про водку это называется бикор и роль сторож которая только про хранение данных и что вот резюмируя то что было на картинке я сейчас еще раз скажу мы получили асинхронную записи трансакционного потока данных и ремонтные очередь с интерфейс администратора мы получили эволюционируем и модель данных которые описываются на языке apache вра это очень важная вещь с нашей точки зрения как я уже сказал то есть модель сразу же закладывали тонированную в модели вы получите просто возможность оперативно наращивать просто вот степ бай степ вашу модель и получать ровно то что вам надо мы получили механизм запуска пользуйтесь кого кода в песочнице и мы не боимся запускать наш код на нашим решением мы получили очень важны тоже с нашей точки зрения вещь мы получили горящие обновление кода и модели то есть нам для того чтобы обновить наш пользовательский код и обновить модель не нужно ни перезапускать не останавливать ничего общего с таранто мы просто просто загружаем код и он сразу применяется то есть это удалось добиться благодаря вот тому что язык во-он скриптовый дай он позволяет просто на ходу перегружать функции и мы получили конфигурирование кластер на базе ролей также мы получили репликацию шар диване данных между дата центрами на основании трант лови шарф мыс имплементировать язык запросов данном графике эль очень важно и та же вещь и мы еще одно сделали экспорт метрика в систему сбора метре prometheus чтобы собирать различные системные метрики бизнес метрики вообще смотреть как у нас вас перформансом там дела того кода который мы написали теперь я пройдусь немного по достоинствам благодаря наличию вот тех ролей о которых я рассказал тех трех королей можно развернуть кластер любой топологии можно развернуть на ноутбуке можно развернуть на десятку серверов это безумно удобно потому что это позволяет вам для тестирования вашего решения не готовить не кучу площадок не тепло и текучей серверов вы просто берете один сервер сборочный запускать на нем это решение и прогонять и там все тесты вот в продакшн вы идете с полный топологией тестируйте на моей топологии те ролик которые занимаются обработкой входящих соединений и занимаются обработкой и транзакции и преобразованием они не хранят вообще состояния и поэтому их можно масштабировать брусе анально входящий нагрузки и утилизации циpкa серверов то есть мы разрезали между собой вещи которые хранят состояние которое них ранее состояния наоборот напротив роль сторож которая хранит данные она не занимается никакой обработка эти ходящих данных и по этому профилю утилизации он не в сторону циpкa оон в сторону просто памяти потому что мы как раз используем память по те объекты которые мы кладем и наличие граф кель позволяет вам организовать единую универсальную точку доступа ко всем вашим данным с предоставлением интроспекции по всей и загруженной модели сейчас наш production он работает на всего 4 серверах это два сервера для входного контура для stateless это обычные шестиядерные xeon и и 64 гигабайт оперативной памяти на каждом на серверах хранения данных у нас те же самые xeon и а по совсем обычных сион и и просто всесильна больше памяти потому что профиль утилизация там как раз эта память теперь хотел бы сказать что у нас с тестированием мы в свое время натерпелись много более с тестированием как inner на любой enterprise и не знаю как у вас у нас были проблемы почему были проблемы потому что как вот процесс это выглядит обычно вендор вам что-то делает потом присылает поставку наверное мы надеемся покормили мы верим что до этого что-то тестирует вам присвоят он поставку вы деплоить ее у себя и начинает тестировать фишку трон для вас сделал вы тестируете тестируете сроки поджимают вы думаете о неплохо бы сделать еще и регресс тестирования смотрите о времени уже нет перекрыть перекрещиваете he идете в продакшен обязательно что-то ломается вы поэтому опять грустите как попытались решить проблему 1 1 1 1 решили давайте сделать делать автотесты давайте принесем фреймворке там в selenium cucumber и будем писать автоматические тесты чтобы они про гонялись вот каждый раз без вот ручного всего это вмешательство мы начали писать тесты нашу систему уже долго продакшене у них куча всего и поэтому мы пишем тесты пишем пишем пишем пишем тесты только нам кажется мы покрыли какую-то значимую часть мы получаем в системе много новых фич и понимаем что система уже убежала вперед собачка подросла пока мы шли и что мы делаем мы пытаемся 5 догнать и вот мы играем в ахиллес и черепаха мы догоняем систем уходит вперед мы догоняем с тем уходит вперед и так вот все время поэтому что в общем мы сделали на этом проекте мы пишем unit тесты на воз помощью фреймворка тарантул tab мы пишем интеграционные тесты на по это не с помощью с помощью фреймворка пай тест from word с очень удобно фреймворк и практически вот декларативно в стиле позволяет вам писать простые тесты которому писать не только разработчики а принципе все кто вовлечен в процесс там и аналитики и продуктов миры и все-все-все и мы поэтому вот пытаемся применять тест гривен диодную то разработка через тестирование как это выглядит у нас любая пища которую мы хотим по возможности мы и покрываем сначала тестом если покрыть сразу тестом перед тем как начать делать не получается ну мы и делаем на параллельных сторон делаем тест как только фичи сделана она обязательно покрывается интеграционным тестом на питоне на python не с помощью форм в руку от пай тест и любая ошибка которую мы находим системе мы не бежим сразу справлять сначала идём и делаем на нее тест тест который воспроизводит эту ошибку но в полной мере и в полном объеме и только сделав тест на эту ошибку мы берем просто код который производит ошибку тестирует ее открываем на улитку в детей пушем гид открываем задачу и только потом и исправляем прямо в той же ветки и поэтому мы получаем то что у нас вот все фичи и все ошибки они еще перед тем как быть реализованы они уже покрыты тестами и это нам по ощущениям по нашему нас покрыта где-то вот 90 процентов кода почему не из 9 потому что надо же утвержден остине развод стреляет вот поэтому все таки и там всякие разные непредвиденные вещи бывают и поэтому хотел бы сказать что по возможности если у вас есть какой-то новый проект попытаетесь внедрять у себя разработку через тестирования поначалу вам будет больно очень больно будет большое желание делать эти тесты почему я должен тратить время на эти тесты а давайте мы просто сейчас быстро пофиксим а потом когда-нибудь напишем попытайтесь пересилить себя и внедрять у себя потому что это очень полезная вещь как я уже раньше говорил мы очень любим все на грушин тестировать и мы считаем что на груше инвестирование этого прямо почти самое важное что есть сейчас я вам скажу как мастера вот первый получившийся версию нашей системы мы взяли ее поставили на ноутбук как я до этого говорил обычно такой вовсе на ноутбук 4 гидроцикл 8 гигабайт оперативной памяти и сзади поле всего на местности тарантула все роли мы включили нагрузку на этом же ноутбуки и получили 4 тысяч рпс транзакций в секунду ну как бы частью на самом деле нашему него приема потому что это вот обычный офисный ноутбук который совсем простой и на нем уже четыре тысячи транзакций в секунду вы думали мы жизнь прекрасна и нас ждут большие перспективы мы сразу же взяли и развернули стенды нагрузке 4 виртуальных машин и на объем vr между ними буксировщик садили виде по одному тарантула где-то посадили 2 чтобы отказоустойчивой конфигурация минимальная включили нагрузку и получили 3500 рпс грусть грусть и наши просто на самом деле не было предела потому что ну мы думали о как так вообще у нас опустились руки и мы думаем как как так может быть вот ноутбук 4000 теперь да вот целый стенд и 3500 пьеса ну как бы в чем в чем проблема ну мы чешем голову давай смотреть утилизацию какая там была на этих серверах и мы смотрим что эти сервера они не были ощути легированные то есть ну вот на серверах традиционной работки да там было по 16 по утилизировано насера хранение это вообще ничего не как утилизации не было мы думы в чем дело вообще как бы ну почему так вроде как вот все было хорошо и и тут тайм-аута получаем до оси равен простаивают в чем вообще проблема а мы звоним разработчикам трантон спрашиваем собственно парня чем проблема почему так но играть ну как же мы же вам говорили трантон может эффективно утилизировать только одно ядро цпу дума окей хорошо ну давайте справляться и мы справляемся мы взяли заселили просто под самую крышечку севера этим тарантулами включаем нагрузку и вот получаем вот эту нашу цифру которая нам сделал жизнь комфортной мы получили 14 с половиной теперь с в секунду то есть вот вот здесь мы умерли в прошлый раз здесь мы уже начали радоваться продолжали повышать и вот там в самом конце мы успели зафиксировать 14500 транзакций в секунду перед тем как он времена отклика взлетели там до 100 миллисекунд и что хочу сказать хочу сказать что благодаря отделению вот на роли на функциональной роли который уже говорил на серверах трансляционной обработки и серверах выработки входящих соединений утилизировать циpкa прям вот нам удалось утилизируйте абрам под самую крышечку и почти не утилизировать память память раскладываю столько на сетевое соединение на время на объект когда появлялись у нас в процессе обработки этих транзакций на серверах хранения все было наоборот утилизация спал бы намного меньше потому что они не занимаются никакой обработкой данных а память утилизировать пропорционально объему загруженных данных и так как тарантул он очень эффективно сжимать данные 230 миллионов объект в загружены в рамках этого теста на заняли всего что нас гигабайт в памяти расскажу немного дальнейших планах по развитию нашего решения мы не собираемся останавливаться на том что мы уже сделали и следующим шагом мы планируем сделать репликацию данных наружу потому что у нас есть куча лик система который не могут нас вызывать не мог нас вызывать пишите и не мог представить сервис для не мог представить какую заглушечку в которую можно пульнуть а потом там джитибиси и вот поэтому мы добавим триггеры на изменение данных и очереди обработки которые будут управлять объекты наружу и конечно мы отправка объектов наружу сделаем в отдельные роли для того чтобы логически развязать между собой и хранилища и тот компонент который будет вызывать внешней системы также мы сделаем там тоже песочницу чтобы можно было те объекты которые мы вытаскиваем нашел хранилище преобразовывать как-то для систем потребителей вот и что дальше так же вот помимо того чтобы нам реплицировать данные по мере их поступления мы сразу поняли что нужно выгружать данные по планировщику например там на конец дня граф кель на текущий момент у нас реализованы полностью у нас реализован только механизм очки не через граф кель но мы также хотели бы для того чтобы поддержать наш фронтом системы сделать там гель мутации что это такое это подмножество языка граф келли который позволяет вам модифицировать те данные которые у вас лежат мы хотим получить полную совместимость с какими-то графские библиотеками обычными ти попова и получить возможность синхронной записи в наше ядро с возвратом ошибки на клиента особенно это полезно когда вы делаете сразу над вашим решение польский интерфейс также мы понимаем что тех функций которые мы сделали для расчета над полем объекты будет явно недостаточно потому что они очень просты ему в дело только простые вещи а мы-то хотим строить сервисы в нашем хранилище чтобы код который работает на работу рядом с нашими данными и поэтому мы планируем сделать механизм сервисов чтобы мы могли загрузить просто произвольный код который мог бы произвольно работать нашими а нами и делать какую-то сложную бизнес-логику и тем самым чтобы мы могли деплоить наши микро сервисы прям внутри нашего ядра чтобы они работали как можно быстрее а также мы понимаем что оперативной памяти на далеко не резиновая она конечно дешевеет но многое и не поставишь и поэтому мы точно знаем что когда-нибудь она кончится и нам понадобится отбрасывать какие-то архивные данные для хранения куда-то вот и у тарантул есть движок трандл винил это диск вы сторож и мы планируем сделать для для него тот же интерфейс доступа что и для движка которая сидит памяти чтобы пользователи которые запрашивают данный час граф теперь они даже не знали что они сейчас работают с горящим сторожем или с холодным также нам нужно будет точно аналитика есть аналитика я просто есть аналитика сложная и мы планируем добавить механизм расчета там сложных агрегатов для того чтобы читать сложную аналитику и планируем сделать на репликах которые на самом деле сейчас у нас простаивают что-то вроде мы previews для расчета каких-то простых аналитических вещей вот на наши данные позволяют написать код который эффективно продвигаться по данным поэтому вот и мы решили что это прям то что нам надо почему они простаивают давайте загрузим тоже по полной еще раз быстро перечислю у нас уже потихоньку время подходит концу мы получаем их your нет данных на планируем получить архивирование данных на диск планируем сделать распределенные вычисления в парадигме похожий на мапри дьюс планируем сделать механизм конструирования и расчета при расчетах сложных агрегатов аналитических планировать делать графики или мутации для синхронной записи и объектов планировщик задач и фоновые процессы репликацию данных во внешней системы по подписке и планирую все-таки сделать платформу для создания сервисов которые живут как можно ближе к вашим данным что мы уже успели решить на наши новой платформе мы начали дышать задача загрузки данных единой модели на разработку модели мы потратили три месяца с учетом вот наши всех сборов бизнес кейсов и хождения туда-сюда у нас было шесть систем поставщиков данных и все наши pipeline обработки которые официального они сейчас занимают около тридцати тысяч строк кода и на самом деле большая часть работы впереди потому что еще не все системы меня всех всем получаем данные которые нам нужны еще не полностью готовую модель и задачи по собиранию всего виденных ранее считалось очень сложной задачей который мы в начальном этапе просто недооценили также мы сделали простую бизнес задачу мы написали сервис который формирует предложение подмены валюты для клиентов банка около 50 лет ных пар для конвертации рыночные данные из низких площадок и наш код который вот мы написали за три недели который занимает около тысячи строчек нового он формирует уникальное предложение для разных сегментов клиентов с минимальными комиссиями и в дальнейшем мы планируем делать аналитику как для трейдеров так и для клиентов мы планируем формировать отчетность берегу для регуляторов и переводить разработку всех сервисов на единую платформу теперь я хотел бы остановиться на выводах хотел бы сказать уже нарын повторюсь третий раз что проектирование едины модель данных это не просто если когда нибудь придумаем станет такая задача и вы подумать что вы вдруг и переоценили все равно смело умножайте время натрия потому что времени вам не хватит имеющиеся проблемы в бизнес-процессах данных не получится решить с помощью новой суббота пусть даже очень производительной что я имею ввиду по нашей неосторожности мы на начальном этапе создали впечатление такое что вот мы сейчас притащим к себе новую су б.д. безумно быструю суда поставим ее и все процессы пойдут как по маслу потянутся бизнес-процессов след и вот прям время сократится до in the market сразу сократится вот именно процессов и все заживем счастливо и вот мы берем ее ставим и в процессах ничё не меняется потому что как правило на самом деле в процессах дело не в системах и процессы надо рефакторинг с помощью су б.д. отдельным решением еще раз повторюсь что разработка через тестирование она может приносить боль на начальных этапах отнимать много времени и быть даже собаки равана частью вашей команды но вам нужно с этим бороться вам нужно давать удобный инструмент людям для того чтобы не писали тесты и краткосрочный и эффект положительный эффект от разработки тестирования он замечено даже в очень краткосрочной перспективе может вам не надо вообще руками спускать эти тесты вы включаете их один раз pipeline все работает за вас в каждый раз получаете поставку автоматически при гоняются все тесты какие только могут быть нагрузочный функциональные интеграционные винтовые и вот по столько вы сделали commit через несколько минут у вас уже полностью рабочий код полностью рабочей версией вы с этим живёте счастливо также крайне важно банальная достаточно вещь ну я тоже расскажу крайне важно проводить нагруженности рования всех этапах разработки если вам кажется что вот сейчас вот вы сделаете сделать и делайте систему а потом мы как нагрузим и сразу поймешь что там как получилось так не получится потому что скорее всего что-то пойдет не так поэтому если вы делаете какую-то даже небольшую вещь в своей системе новые обязательно и тестируйте обязательно груши инвестируйте потому что если вы уже сделали больше часть вашей системы вы понимаете что стикер подобраны удачно потом будет очень больно и трудно это всё переделывать порой когда ты рассказываешь людям о том что у вас вот язык во внутрь и и надо писать сервисного это люди очень удивляются награждает вообще что за язык такой откуда вы его взяли на самом деле язык довольно популярный он все больше развивается последнее время это благодаря тому что он очень простой для изучения очень компактный и он очень быстрый поджиг он код написано у jit исполняемый среди вот жетон работает почти так же быстро как си по нашим ощущениям также вот сиквел это замечательный язык и это тот язык который мы все привыкли и поэтому отсутствие его вашей судьбе приводят людей просто бургас но на самом деле он не ведь не всегда и не везде нужен его у тебя системе у вас есть альтернатива вас есть альтернатива виде граф цель для собирания бег тов по связям и альтернативу виде распределенных вычислений 2 my данными и последний вывод который хотел бы сказать это то что при используем тарантул сразу проектируете в решении так чтобы оно могло работать параллельно на десятках инсов тарантул иначе просто вы не сможете как-то эффективно масштабироваться и вы будете зажаты в одном циpкa и вы будете получать те самые грустные результаты перенеся это решение с простого сервер на большой в заключение хотел бы сказать что после того как мы начали решать в задаче мы поняли что в принципе на tarantul можно построить любую вещь но лучше всего он справляется именно стран секционной обработкой данных если у вас есть какая то похоже задачи по обработке данных вам нужно собирать кучу транзакций и вы как раз в поиске решения или вы когда-нибудь планировать этим заняться то я советую вам отлично себя посмотреть в сторону тарантул это может оказаться просто очень хорошим решением для вас спасибо так вопросы да на секунд спасибо за доклад хотел спросить ещё есть 100 randall были какие-либо проблемы кроме то что утилизация только одного ядра наверно были вот хотя были и разного рода проблемы были у тарантул просто на самом деле высокий уровень вхождения вот трудно взять просто так легко взять там кант манга да я что-то делать сразу мунга вот но намного сложнее взять тран то что сразу делать на tarantul и потому что довольно высокий уровень вхождения и вам нужно посмотреть на самом деле кучу видео влагу уже есть кучу видео про то как надо строить приложений интернету есть куча нюансов и поэтому вот просто так взять и сделать не получится да вот по большей части вот с этим были проблемы с 8 заклад я здесь струи страниц такой вопрос скажите когда у вас принуждается север как ведет себя тарантул он деградирует падает а были ли случаи падения когда что последовало большая перри нагрузка идет слишком розовыми типа nero просто ног запросов идет известно с работы много запросов идет у вас типу растет да все больше открывать соки из все больше сессий циpкa растет растет он подходит по сто процентов и ничто ничто ничего не происходит партнером тула не падает сервер не падает просто вашим клиентам начинают вращаться тайма у вас не падает севера да никогда не от от ну от нашей клиентской нагрузки не не падают тогда вот такой вопрос у вас там было четырнадцать тысяч операций да это понимают на на кластер скрытие вот вы смотрели узкие места что вызывает им такое количество операций потому что тарантула ну казалось бы можно ждать больше это баз данных памяти супер скоростная и так далее почему именно столько у вас максимум мы посмотрели вы профилированные губки места искали точнее смотрите дамы профилировать и вот мы на самом деле мы получим сначала меньше чем вот здесь да мы потом чуть-чуть разогнали просто тут и у можно разве не бесконечно можно пытаться как-то оптимизировать вот просто это та цифра которая нас устроила который нам стало жить комфортно это покрывая все наши нужды и все наши планы вот поэтому мы остановились просто на этой цифре и не и перестали следовать дальше просто он на это уже не осталось времени и после не тогда скрыть а как вот вы проектировали таким образом чтобы использовать кучу тарантулов так скажем в чем здесь эвристик а вашего подхода главная мысль как делать так чтобы не все взаимодействие тогда какой у них есть общая память и так понимаю да они за нее дерутся как вы как вы подходили к этим вопросом память у них не общее она как бы на каждый выделять своя ну когда на каждом копить три кучи тарантулов дара понимаю что под под каждый выделяются кусочек памяти а то есть они шокированы сильно у них shared на финк принцип да да да то есть данная сугубо свою каждого экземпляра спасибо здравствуйте спасибо за план у меня такой вопрос а вот то холодная хранилища данных которой планируете создать вы думали как его горизонтально масштабировать будете если будете досмотрите мы его планируем также сделать на таран туле вот просто утра на ул есть два движка для хранения данных есть мем текст который хранит данная оперативной памяти есть виню который хранит данные на диске вот и можно достаточно легко построить интерфейс доступа к данным одинаковые для мем кексы для винила вот и мы будем нет это я понял но вот то хранилища которого was in memory она у вас горизонтально масштабируется за счет вий шар да да а винил лишь арт не поддерживает вопрос в этом на самом деле вы смотрите сидит у вас же поддерживает который его wish арт да и он поддерживает до тогда спасибо за доклад у меня два вопроса опрос 1 почему же все таки не был выбран xsd была выбрана авра можно ли подробней на сколько я понимаю пытались имплементировать некая некую вольную трактовку f панель на так скажем совсем вольным вот какие с этим возник возникли проблемы какие вы видели потенциальные проблемы в этом это вопрос первый его просто 2 возможно ли на данной платформе на ваш взгляд создавать ну скажем так позиционировать или в данную платформу как универсальное решение ну например там mdm на нем можно сделать или нет спасибо я начну по порядку начну с форматом модели загружаемой мы рассматривали как и сказал не за брендами сиди да и различные уже готовые модели nike size типов тоннели и прочее они сильно перегружены концепт вами что вообще сам формат existe перегружен концепциями что от те модели которые построены cassidy порой даже эти модели которые построены exedy и они выходят за рамки xsd и это что-то вроде excite плюс плюс получается да и к с этим работать как бы мы не знали вот поэтому мы выбрали просто более простое решение по поводу вашего второго вопроса ну смотрите по идее вот это наверно можно сделать таким более-менее универсальным кирпичикам для построения каких-то других систем то есть ну в любой системе нужно запись данных любой системе нужен чтения данных то есть видимо с какими-то модификациями да наверно возможно это сделать таким у кого-то еще есть вопросы я может быть пропустил не всем понятно и у вас источники данных примеры просто вот источники данных это по котировкам это различные площадки по сделкам от различные но опять же бирже и нашей системы учетные по всяким справочным данным типа контрагенты договоры клиенты это наш справочный внутренние системы так ну то есть вы все таки но у них свои базы ездя правильно понять есть свои базы в них живу свои процессы это такие большие функциональные колодцы в которых вот накапливайте взращивать все вертикально долгое время да то есть все таки алла при решении делаете то есть вы как хранили хранилище то есть из традиционной системы вот которые вы оказалось смотрите сейчас цель да смотрите сейчас у нас этого у типе да потому что мы сейчас к тебе просто все быстро собираем да у нас есть планы да вот отвести с тем что я рассказал про аналитику на реплик astra j да мы хотим сделать что-то из этого что-то подобие olap принципе мы знаем отчеты какие у нас есть эти чувства как я уже сказал хорошо продлится по данным и эта задача аналитическое задач она решится в каком-то виде да ну в том виде в котором мы хотим то есть мы сможем решить можно ли как-то это обобщить решение на произвольную там задачу как бы ну вот это вопрос открытый то есть вы все-таки то есть olap дело делаете правильно ну то есть в конечном итоге с нагиевым аналитические запросы к нему потому мы продала чё ты я видел там да мы продолжим обрабатывать транзакционный поток да и на нем же делать какие-то элементы лап и тарантул хорошо для этого подходит на мой взгляд для аналитических запрос да вполне данные в памяти это очень быстро работает и блин диски запросов по я просто талант вниз смотрите там не получится делать аналитические запроса своим произвольного вида да то есть какие-то то есть ваши данные должны лежать немного по-другому чтобы делать аналитически запросы такие совсем произвольные до совсем и должна быть вам систему прямо полноценная но наш спектра задач это покроет да и поэтому мы хотим это делать здесь часто как в памяти если сервер что случится вам тогда ничего страшного потому что от рандаллс пишет райта hotlog то есть транзакция перед тем как быть за комично она сначала пишется на диск в инкрементальный wog далее потом она попадает в памяти только потом возвращается ok на клиента придем поделитесь пожалуйста опытом какие инструменты используются для генерации нагрузки при нагрузочное тестирование num enterprise поэтому нас используется его adriver такой большая интер праздная индра правильная машина которая вам умеет все пустой стоит кучу денег и вот мы и просто все это дело нагружаем поэтому вот достаточно у нас все так это энтерпрайз на прозаично еще небольшие вопросы скажите все таки про надежность вал этот лог трудно и жди если у вас очень долго пишется данная это же огромное количество информации обычно его подают на диск винилы хранилища пластина если система упадет то вот причитать это огромное количество да да само собой вы правы конечно поэтому кроме вала есть еще и снапшоты то есть по планировщику раз там в настраиваемое время у нас раз в час делать полность либо памяти и там пиццы на диск при этом вот те рейтах этологии которые были они прибиваются и начинают писать начинает писать снова рад их отлова очень хорошо там была такая такое место асинхронно в ком есть 8 крон применили синхрон смотрите ищите уже сам себе синхронный да а синхрон в каком смысле что система которая нас вызывает в текущем варианте она всегда получат окей от нас если мы это к себе сохранили президент на то есть у нас это может как-то не обработана у нас может что-то не так пойти и в конвейерах обработки и это может варьироваться по модели она выводит ремонтную очередь но система получить такие потому что вызывающий нашей системе на текущем этапе нашего развития и принципе все равно как бы star без ожидания просил он спасал результат ясно спасибо просто открыть просто какие другие варианты были которые вы рассматривали и почему не рассматривали классическое некое хранилище то есть почему вы начали тестирование именно с количество запросов на запись в секунду то есть почему нельзя это там просто раз в сутки выгружать из оперативных систем к вам и строит никакого хранилище вопрос хороший я с радостью не отвечу вот тут только в fine потому что это вот прям требует ещё одно докладывай минут на тридцать как бы вот поэтому да давайте я вас буду ждать снаружи просто и мы с вами поговорим"
}