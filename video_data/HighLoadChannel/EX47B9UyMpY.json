{
  "video_id": "EX47B9UyMpY",
  "channel": "HighLoadChannel",
  "title": "Промышленное ускорение сайтов / Николай Мациевский (Айри.рф)",
  "views": 702,
  "duration": 3358,
  "published": "2017-04-22T14:48:20-07:00",
  "text": "значит всем добрый день я надеюсь что с кондиционером разобрались всеми сейчас комфортно кому комфортно все поели все молодцы справились меня зовут на царский николай доклад у меня про промышленно ускорение сайта в чем суть я поделюсь некоторыми наработками большим количеством наработок у меня порядка десятка кейсов как ускорять сложные не очень сложно и очень сложные сайты кейса собранную буквально за последний год но под ускорение у меня порядка десяти лет если вы захотите там посмотреть кто и чем я занимаюсь там первый доклад был на рите 2007 как раз на тему скорее не сайта собственно с тех пор всё и пошло значит кому нужно чуть больше теорий есть две книжки не доступна в в открытом доступе разгони сайт реактивные веб-сайта там они нас недавно написано эти вещи которые там описаны они не сильно устарели не сильно немножко устарели но в целом то что я вижу они нормально в докладе я сфокусируюсь на ускорение не маленьких сайтов сразу скажу что фокус мой сайт с посещаемостью 20000 так давайте сейчас будем руки поднимать у кого больше двадцати тысяч посетителей в день так хорошо начать больше ста тысяч так чуть поменьше уже хорошо больше миллиона вот супер от от ли идеальная аудитория собственно для вас мой доклад я я попал в цель заходите я пока еще только разогреваюсь что у кого-то 500 миллионов и не расслышал все нормально большие нагрузки значит когда мы в чем основная проблема собственно начинаем и вот примерно с такой картинки кто-то кто так делал честно поднимите руку я не буду ругать я честно когда тоже так делал там я искал там 10 и там 15-20 50 советов как не ускорит сайт значит методика называется сами с усами мы молодцы мы сейчас по списку все найдем все сделаем все будет хорошо мы мы мы ускорим сайт носить следующий шаг профессионального роста человека который занимается оптимизацией фронтэнда они на что знает про инструмент google pagespeed insights в целом хороший инструмент он вырос на отличных на отличных инструментов во времени то есть первым был там яху потом мы сделали потом сделал zoom zoom еще жив мы уже нет яху тем более уже нет но в целом они используются вот некоторая мерил к то есть от нуля до ста насколько сайт может быть быстрым относительно себя же вот понятно что инструменты и свои ограничения но в целом он подходит для такого беглого взгляда ну когда он не очень понятно что не так забил посмотрю михайло откуда взять семь забыли кошелек для картина включить ну ладно хорошо сейчас включат будет уже 80 90 там нормально на самом деле профессиональную скорее начинается примерно в этой точке то есть мы можем работать с диаграммой загрузки мы знаем что такое диаграмму загрузки кому эта картинка так или иначе знакома давайте черту все молодцы значит мы в правильной точки мы умеем работы с диаграммой загрузки и здесь начинается что мы умеем задавать правильные вопросы диаграмме загрузки потому что там куча каких-то там разноцветных данных и вообще не понятно что с ними делать вот правильный вопрос какие что значит должен быстро отвечать сервер то есть у нас чисто сетевые задержки должны быть маленькими следующий вопрос что у нас отрисовка странице то есть вот первое наше линии 1 отбивка должна быть достаточно быстро это обычно там одна полторы две секунды в зависимость того чем вы меряете но в целом там это какая-то быстрая вещь дальше в третий вопрос что еще мы должны загрузить между собственно началом отрисовки окончаниям отрисовки то есть какие-то супер важны и картинки какие-то с какой супер важную логика там обязательно шрифты еще что то есть какой-то минимум нашего нашего сайта нашего приложения которое обязательно должен загрузиться перед срабатыванием от голода то есть в чем этот минимум что мы вот без чего мы не сможем жить без чего пользователи умрут не дойдя дальше что это и за тест на последний вопрос который мы все знаем что мы можем еще загрузить там счетчик аналитику статистику там какие-нибудь при connect и сделать там природы так далее так далее это уже там в конце естественно после всего эти вопросы они формируют уже дальше стратегию как мы можем работать с ускорением сайт вот кто чуть чуть больше погуглил он естественно слышал про google pagespeed кто слышал про мод почтит вот немножко знает отлично значит я про него у меня целый слайд про него сохраню интригу слайд будет потом значит место оптимизации стратегии многие выбирают давайте мы постираем поставим этот модуль там воткнем какие-нибудь настройки вроде сайт стал быстрее отлично на этом остановимся все хорошо целом нормальный подход как бы до достойны уважения но он не всегда работает когда он не работает я б таки сегодня скажу то есть если у вас небольшой сайт если у вас достаточно часто могут быть изменения то есть например ежедневная выкладка каких-то новых билдов там не знаю заливается там картинки не очень большими объемами там десятки сотни в день то в целом инструмент ускорение сайта на лету там один из наиболее популярности снова от пусть спит он подойдет вот всех остальных случаях либо когда у вас большая нагрузка либо когда у вас небольшая не большая частота обновлений лучше используют другие инструмента них я тоже скажу начни здесь на без этого тренда никуда значит мы говорим у нас есть сидел так давайте его использовать воткнули сидел все молодцы там если у вас мировая аудитория седин по миру российскую территорию седин по россии у нас сайт стал быстрее сидела там компании которая снять сидена не безумно счастливы что они нам волновал не ускорение сайтов собственно продвинуть свой бизнес но там ситуация немножко не то как правильно измерить сиди как нам посчитать есть нам выгода от сидена или нет как нам плюс-минус выбрать правильный сиденья тоже расскажу этот один из вопросов котором обсуждали на встрече докладчиков холода и он он реально актуальны причем нам как нам а поскольку мы тоже занимаемся мониторингом производительности по россии к нам с этим вопросом приходила три компании которая представляет сидена то есть по следам первая компания которая сделала сидел в россии 2 компании который делал син трахит эти компании придавайте нам померить и как хорошо работает на си and now кабану мы можем к же померить но к сожалению то очень мало будет иметь общего с тем как сидим будет работать для каждого конкретного сайта почему правильно разная аудитория потому что в одной аудитории сидит москве для них сидел вообще не нужен 2 аудитория чисто мобильная там сидена работает ограничено третья аудитория она сильно размазана как-то папа россии и в чем размазана с локализацией с центром точкам обмена трафиком и тогда сидел очень хорошо будет работать но зависимости от аудитории может работать же на по разным вот этому тоже осмотр теперь первый кейс который я очень люблю и которые я везде рассказу мы даже перевели на русский язык если вы забьете в поиск ускорение garden garden за одну секунду там новости за одну секунду ссылка сразу будет нашу статью значит в чем суть мы изначально там не считаем во сколько раз может быть сайт быстрее мы а нам это не нужно мы говорим мы хотим чтобы сайт показывался за одну секунду или гамагори мы хотим чтоб сайт показал за 2 секунды 2 секунд нормально там секундам маловаты 2 нормально 2 мы справимся и там полная загрузка за 4 секунды там для половины пользователей окей мы вас то мы выставили такие теперь мы выставили такие ограничения дальше мы смотрим может ли сетевой стык нам это позволить то есть garden они реально разложили кистевой стек и для мобильных пользователей меньше секунды там но значительно меньше секунды даже полсекунды сделать среднее время загрузки страницы отображения страницы отрисовку домры эти события практически невозможно потому что у нас будет нам большинстве случаев да на запрос нас будет долгих коннектом 150 200 250 миллисекунд естественно вас будет долгий ответ от сервера из-за того что просто connect долги долго будут там пакеты доходить и естественно сервер может тоже не быстро отвечать все это собственно сжирает наши 600 800 миллисекунд и быстрее секунды на мобильных среди них мы не сможем сделать ну там если у вас не мобильный пользователь если у вас там немножко другой срез аудитории то в целом вы можете выставить кипиа и пол секу но вот понимание того за какое время мы хотим чтобы наш сайт работал она является базовым вы с ним он начинаете дальше все процесс ускорения которых я сегодня буду рассказывать секунду ok все супер значит я очень рекомендую посчитать кейса даст на нем много технологий внедрили собственно чтобы одну секунду получить у них там получилось даже для несколько секунд линий для мобильных пользователей десктопу них павел получилось отрисовку со 08 там для для большинства аудиторий 08 то есть они там из пора ли загружаются стиле со скриптами они там и дело через local storage шрифты и так далее так далее то есть они просто взяли шаблон сайта сказали что-то это нам не нужно этому потом загрузим рекламу потом там комментарии потом там другие новости потом только контент только хардкор только нужны стиле все вот мы вот это можно секунд отгрузить мы это отгрузим ну молодцы то есть началом них был теперь по скорости а потом мы посмотрели что потом они посмотрели что они в этот кипиа и могут сделать что реально сделать и они смогли это сделать технически час ограничений нет то есть все технические ограничения у нас уже чисто в голове раньше там были модемы там был как тяжело чисто физически за этот грузи час проблем с этим никаких нет только вот некоторые жонглирования технологиями эти что у нас есть для того чтобы чтобы измерить чтобы измерить производительность чтобы понять движемся в правильном направлении или неправильно значит сразу тоже маленький вопрос кто использует google pagespeed google analytics чтобы по мере скорость не бить не буду все хорошо можно поднимать руки если честно у нас две трети заказчиков кто к нам приходит они используют google analytics еще треть ничего не использует поэтому google аналитик тоже хорошо нас нем есть одна маленькая проблема то есть он там считает не все хиты но это как бы не но не критично там из не 85 процентов хитов он будет считать а 60 65 процентов там чуть меньше покрытия но большая засада в том что там чтобы он читал ни один процент у него была выборка сто процентов надо принято лизации счетчика там выставляет дополненный параметр я вот забыл его опять презентацию ставить но если вы погугли вы найдете если вы еще не выставляет там принцессы там типа печи la times и там сто процентов там или привело вот там перцентиль вот стопроцентно до выставить тогда усе данный соберет их целом как инструмент референса то есть там за отнести маркетинговые показатели с техническим он хороший то есть даже в первом приближении что вот то есть какой то непонятно этом знает система мы там через google analytics что-то посмотрели и за отнесли как минимум тренд у нас ой становится быстрее или медленнее он подходит то есть он как так промышленный вариант если у вас большая нагрузка большие большое количество хитов просто нанана объеме он он выполз выползает если у вас например пища и масть меньше 20 тысяч только сожалению шуметь будет очень сильно очень сильно шуметь и там реально сайт стал быстрее или медленнее будет непонятно больших объемах нормально показу нас естественно есть в битриксе инструмент я хотел ставить даже скриншот яндекс метрики но к сожалению в последние яндекс метрики они что-то переделали интерфейс и у них вот того удобного инструмента он куда-то испарился то есть раньше не вы там было прямо по времени график частом только по хитам и по времени них просто сводка в таблице как этим пользоваться есть есть ну вот я буквально ночью собирал blind nation не нашел я полтора часа искал яндекс метрика не нашел но наверное есть не буду вот яндекс метрика чем лучше в этом смысле она собирает данные по точнее это можно сделать кипиа я теряю сегодня тоже скажу кипиа номер 80 перцентиль выставляйте висят и перцентиль это на самом деле очень жесткий теперь вы не подумайте тусит там и когда говорят что мне остается на секундомере туда 50 перцентиль одна секунда это половина пользователи там до 1 секунды быстрее а вот если 80 перцентиль у вас будет одна секунда то это но я не знаю google она на нет такого что у него одна секунда 80 петель потому что у 80 пользователей сайт грез одну секунду или быстрее то есть это там реально там какие-то проблемы со связью были не были там были слабы соединением обильно много данных неважно сайт загрузился быстро это жесткий теперь мы когда работаем заказчиками мы говорим что давайте будем ролик по десятому она 50 чтобы не смотреть как там на на reference некоторых то есть сайт целом работает быстро но ускорять мы будем 80 потому что там вот кабы 80 процентов пользователь должны получать сайт быстро я там будет там распределение чуть дальше вот если вы закладки нет это хорошо наш битриксе тоже есть инструмент что мне мне очень хорошо что он не показывает полное время загрузки по всем нам и там у быстро очень быстро мега быстро супер быстро и активно но относительно отрисовки отрисовка хорошо но кроме отрисовки нас есть еще там понятно что отрисовка этой наиболее важная метрика выпускать скорости сайта но кроме отрисовки нас еще есть полная загрузка и пользователь может просто но от рисовалась но за этом подвис где-то на какой то на каком-то этапе и все и полную загрузку не не случилось вам об этом никогда не узнаем из более только эту метрику значит есть более профессиональные инструменты в целом который я рекомендую ну я им пользовался знаешь что нехороший ими можно пользоваться юра или кто использовал я думал что половину даже на руки поднять ну я промахнулся 3 четверть an hour хорош тем что можно состыковать с вашими серверными метриками то есть как как долго у вас от отвечала база данных как долго у вас год выполнялось как долго у вас там диск отвечал их внести в именно в в этот хит от то есть пошел хит мы знаем сколько сервер настучат почему он так долго отвечала и дальше посмотрим почему так долго закрывал страниц чем мест нет но вы проходите куда-нибудь не стойте дверях честно доклад очень интересно вы заходите на сид и у можно выстроить таким образом достаточно длинную цепочку то есть вот серверный производите до клиентской понимать что где у нас там просела базы поэтому нас там чуть всплеску серверная часть в поползла где-то где-то там просил диск у нас поэтому там сползла производительность и так далее интересный подход также дает состав со своим импульсам они забирают также данные по конверте показывали сразу сколько там но мы за сколько времени сколько человек купил а то есть секунда то здесь такие покупки если там две секунды здесь только покупок и так далее но они все за тосно сейчас мы дойдем также естественно все данные собираемые мои мы это показываем чем например также наглядно как new relic с теми же кипиа яме и также можно все посмотреть чем хорош такой график то есть почему мне не нравится графе google analytics причем не нравится графики яндекс метрики потому что мы всегда можем посмотреть и мы чуть позже разберем кейс какая там какая стадия но затормозит а здесь видно что там отрисовка ну ладно там висят прицел три секунды ну медленно но хрен с ним но проблема у нас на уровне на уровне он вода идет где-то у нас проседает tomcat скрипты после отрисовки и вот именно с ними можно работать это там 80 процентов наших задержек и главное понятно как то приседая с чине время то здесь она не проседает то есть все время медленно все время иногда бываешь на какие то там всплески серых провис мы это видим на самом деле вы используя стандарт performance тайминг api performance тайминг а в 3 c вы можете собрать там свой с вами и тоник со всеми нужными вещами со всеми нужными вещами и получить собственно все те же данные которые получают то есть все вы хотите мере там dns и как у вас там время tdms время запрос dns этом распыляется отлично получили свое собственное хотели как-то соотнести с нагрузкой системы опять-таки за 1 со всеми своими метриками это все доступно это все собирается там строчка буквально там 1 килобайт кода которого мчится берет я думаю что николай в следующем докладе расскажет даже чуть подробнее как это все автоматизировать как это профилировать но ничего сложного в этом нет у специально сделали стандарт который сейчас подержит 85 процентов браузеров его можно использовать гораздо интереснее я говорил об этом полтора года назад это дополнение к стандарту которая позволяет собирать не просто данные по каждой конкретной страница а также собирать временные метки по каждому ресурсу на каждой конкретной страницы и мы можем уже в автоматизированном режиме посмотри там kill нас там ресурсы больше всего пользователь тормозят то есть не то что там тормозит onload или там добрый ден там отрисовка ли полная загрузка или сервер а вот в этой в этой временной рамки там от 0 до 3 секунд какие ресурсы у нас больше всего тормозя то есть там это картинки нас тормозят это на скрипты тормози отеле баннер тормозит например там скриншоты на нашу интерфейс для новых клиентов не буду называть какова там видно три буквы все там понятно вот у них как бы по этим по этим выгрузка мм которые следует из рисуешь тайминг а 1 все понятно то есть понятно что у них тормозит баннеры понятно что у них тормозят тормозят их картинки то есть у нас там 75 процентов этой картинки со скриптами то здесь как бы сайт принципе быстро но из за того что на нем там вызывается много чего вы не в отложенном режиме он не очень быстрый и понятно что с этим делать то есть когда вы ставите вопрос почему сайт медленный что мы должны сделал чтобы его ускорить то у вас на самом деле сейчас уже прямо сейчас есть огромные инструментарий чтобы ответить на этот вопрос и мало того отвечает на этот вопрос ежедневно то есть вот сегодня посмотрел у нас там сайта тормозит поэтому нас там весна картинки не zaptie мир надо картинки порезать вот и еще один кейс с онлайн кинотеатр моник но на из пришли и сказали мятном принц все нравится на сайт быстрый мою даму увидел он он быстро от 50 и перцентиль там порядка пяти секунд полное время загрузки то есть там 1000 миллисекунд на на верхнем графике сейчас в 10 1000 миллисекунд вот а здесь распределение собственно по секунда видно что пик где то что там три четыре секунды пик то есть три с половиной четыре секунды у там медиана и время загрузки все остальное уже как-то там длинный хвост мышцы в целом хорошая картинка вот мы хотим знать чуть-чуть чё у нас плохо что плохо куда куда нам двигаться что что улучшать значит и оперирует теми данными которые мы можем получить через стандарты либо через web-интерфейс и сервисов которые представляет это мы видим что на ночь половина времени половина времени и загрузки сайт это там что-то между отрисовкой и загрузка дальше мы смотрим что 80 процентов этнос картинки и понятно что если там - процент тормозов картинки и они занимают там половину времени загрузки но очевидно что единственный шаг который поможет это либо выкинуть половину картинок но если они еще не выкинули и мы за оптимизировать как казалось картинки у них практически со премьер но есть там ряд инструментов секретных я у нее они будут у меня на слайде ближе к концу так что не уходите никуда там будет секретно слайд секретными инструменты для секретного супа и только оптимизируя картинки они могут как-то существенно подчеркивать с twin ускорить сайту все остальные методы там давайте мы накрутим там базу данных выжженным 10 миллисекунд а давайте мы по клеем стиле там выжмем там 50 миллисекунд а давайте мы не знаю java скрипта выкинем половину выиграем 100 миллисекунд в данном конкретном случае скорее всего вас будет примерно такое суть они не дают никакого эффекта в предыдущей доклад был какой мы сделали четыре вещи и только одна из них помогла там вам ускорить в пять раз все остальные три вещи они там почти не помогли до помогли в меньшей степени парад гулар кто слушал вроде было народ кто-то слушал чуть не пересеклась аудитория очень был рассказ как у скорее ангар и там вот только только одна из четырех один из четырех вещей что-то сделали вот чтобы не не тыкаться и не не думаешь нам поможет мне об этом будет чуть дальше слайд можно посмотреть на то какие у вас сейчас проблемы взять там бог бог с ним пусть даже google аналитик взять посмотреть куда мы упираемся взять посмотреть какие ресурсы у нас тормозят какие запросы каких аст и у нас проседают и сфокусироваться усилия на это значит теперь следующая больше который мы столкнуть я думал что все просто то есть давайте вот у нас есть проблема мы нашли проблему сейчас мы ее решим то есть мы возьмем мы молодцы мы умные на сроке cry прямым и сейчас все сделаем значит но проблема в чем что изначально пытается решать какую-то другую проблему то есть не проблему скорости я проблему скорее знания разработчиков что он еще знает на те ускорение сайта то есть он сначала делал все что знает потом гуглит делает то что нагуглил и примерно этом заканчивается наша дальше непонятно что делать вот чтобы такой ситуации не было изначально можно выставить кипиа им такие кипиа я называю хорошими но не в смысле что они там правильно поставлен на какие-то конкретные цифры на все уже озвучивал что это загрузка полная загрузка например 80 процентов пользователь этом из 4 начну до 4 секунд то есть у 80 процентов пользователей получили там большую часть или все страницы сайта до 4 секунд то есть у нас тут вот распределение гауссово она как-то до 4 секунд мы почти всем отгрузили в целом хорошо то есть сайт как бы половину пользователь ощущается как быстрый большинством пользователи как достаточно быстро ну нормально это один из вариантов кипит их вы можете использовать эти пять можете выставлять китая на отдельные конкретные страницу сейчас разные там карточки смысле разных страниц и типа главной странице карточки категории там пользователь личный кабинет выгрузки какие-то выделяем 5 какие-то характерных страниц 710 выставляем на них теперь его цену и дальше в автоматическом режиме все это отслежен хороший кипиа являясь на отрисовка за одну секунду там хотя бы для половины процента для половина пользователей 50a перцентиль и собственно загрузка 50a перцентиль загрузки за 2 секунды либо как я уже сказала 70 перцентиль за 4 секунды загрузки это хорошее кипиа в том смысле что они соответствуют ощущению быстрый сайт то есть сайт будет загораться быстро если у вас сейчас не так то дальше мы с этим должны что-то делать вот но тут тоже какая-то дальше что то мы должны делать это один из клиентов наших средний плюс одежда на сене к нам пришли примерно в июне вот здесь это у них было плохо это 50 проц intel загрузки начале они сказали вот давайте на нами таки посмотрим дальше будет секретно слайд возвращаетесь мы посмотрим на 50 30 загрузки там у нас 78 секунд хорошо значит и посмотрим что с этим делать значит видно что нас серую отвечает но не очень быстро он достаточно быстро то есть если мы 700 миллисекунд там ли 600 ускорим сервер в 5 раз то есть это будет вообще в баума в пять раз разогнали sure to относительно всего времени загрузки мы получим там жалкий семь процентов то есть вообще будет незаметность такая махина мы там закупили дата-центр построили все супер ну вообще не в куда если мы займемся там не знаю стилями и скриптами которые там до отрисовки страницы может там чудо шрифты пожмем еще что-то по клеем то в целом мы можем выиграть там ну оптимистично 2 в два раза мы это можем ускорить то есть где где-то там 07 1 секунды мы выиграем если мы углубимся там оптимизацию стиле то есть выкинем ненужное будем задавать какие-то баллы там соберемся в один файл загрузим параллельно там положим local стула рад что есть вот эти все достижимо методы которые тяжело автоматизируется там в ряде случаев то есть у нас постоянно чет меня есть вам нужно постоянно заделать сборки постоянно но валидация кэша вот это нам даст нам ну пятнадцать назад уже лучше вот но если мы посмотрим чего но за за ерунда и вот между дадут там полутора секунд происходит и 7 секунды то есть что у нас у пользователя берусь за шесть с половиной секунд то есть это та мне новостной сайт там нет рекламы это там интернет магазин там не очень много счетчиков на что какие у вас будут предположения что там такого было плохого картинки да причем самое интересно даже не то что их было много ну как магазин понятном должны большие красивой картинки а там для всех пользователей выливалась двойное разрешение для ретины но их картинки можно было порезать там примерно в два раза по объему без проблем для вас 90 процентов пыльные с iphone авто много заходила там они реально были нужны вот но собственно что примерно было сделано там за три недели видно что там оно там как-то отлично отлично упал лайковые сейчас в ситуацию уже немножко сложнее там не только картинки уже тормози атом начинает серый тормозить так далее иначе здесь мы видим что он beer через 4 месяца у нас просил сервер то есть он вроде там незаметно что 1007 а здесь там полторы но здесь уже видно что там если мы серы уже раз кори в три раза там и автомат 5 секунд уже получим там секунду то есть уже какие-то измеримые вещи на которые можно ориентироваться значит что мы с этим совсем можем делать у нас обязательно быть как бюджетно ускорение то есть мы не просто там выделили не знаю два часа в месяц заходить но не 22 дня вместе заходить на highload и забыть на этом на год нет у нас как у любой команд должно быть там были на количество часов мизес там 10 часов 20 часов 100 часов там не знаю может быть 200 часов какой команде есть на оптимизацию фронтэнда но или целом общаться и то я буду очень этому рад у нас есть некоторый бюджет котором мы каким-то образом режем собственно основная часть бюджета на идет как раз но тестирование тех методов которые по идее должны дать самый большой результат то есть мы смотрим где у нас тормоза смотрим методы там инструменты мне будет слайд с детально с утилитами с подходами как с этим можно работать методы и инструменты которые нам могут в этом помочь мы внедряем то есть в этом смысле мне начинается подход бату я с ними общался они у них там прям выстроен этот процесс ускорения то есть у них там порядка десятка методов в очереди стоят а иначе смотрит один там я знаю vp они например кто знает что такое в.п. богу знают хорошо vp это прогрессивно формат изображения который понимает примерно половина браузеров часто на базе хрома и он меньше примерно на 15 процентов среднем любого изображения но там каких-то больших причин 15 процент средний выигрыш поэтому внедрение ввп например там для для того же больного но могло вылиться там счет того что у них в мобильное приложение выгружается которые по умолчанию chrome bass вот они могли там не знаю сколько ты серов выкинуть у них там это одна из задач которой они тестируют там раскатывают на одной десятой части аудитории смотрит на эффект если эффект есть то не это внедряя дальше в разработку и использует если эффекта нет ни вопрос мы мы взрослые мужики мы плакать не будем это просто выкинь и мы не забудем об этом там года на три пока это не снова не станет актуальна не попадет наш план там по оптимизации значит только такой the rating подход сможет вам что-то дать то есть не просто в этом взяли поделали поделали поделали и может быть даже померили нет сначала выбираете что вы делаете потом это внедрить тестируете потом вы от анализирует смотрите на результативность если все хорошо то есть результат реально тот который вы прогнозировали что-то дает не просто два процента вам там процент 30 вы выиграли 20 процентов там или хоть десять процентов но это вам существенно тогда вы тоже внедряете в разработку потому что внедрение в цикл разработки стоит отдельных усилий на тоже нужно закладывать бюджет значит теперь про собственно методы как мы это все дело самый простой конечно сделать руками есть везде автоматически сборки файлов а там стилей скриптов картина к шрифтов в этом внедряете и в целом забываете о том как это все нужно но смысле этого все собралось выгрузилась вы забыли собралась выгрузилась забыли проблема встает только одна если у вас точно часто изменения то есть если у вас изображение например выливаются там миллионами в день там там где сотнями тысяч или миллионами в день если у вас например стиле могут меняться там ежедневно то есть у вас там сидит крупа верстальщиков которые что так там регулярно сайте правят то возникает проблема с как раз тестированием то есть вам нужно кроме того чтобы протестировали там дебаг версии он нужно тестировать productions то есть этого сразу там расходует и сервер дополнительные и дополнительно какая-то инвалида ция кэша то есть вам нужно убедиться что вас вы сбросили кэш гарантируем сбросили кэш ранее используемых стиле то есть если у вас есть какое-то сборка вы там выгрузили сборку вам нужен точно сбросить кэш случае если у вас отдельный конкретно файлики там чуть проще и слива сборка какая-то но нам нужно ключами немножко за мать в этом нет никакого уроки танцев просто это нужно знать что вы там в том числе этим занимаетесь это одна из тех головных болей который вас накроет когда вы там будете внедрять от через собственный сборку значит что придумали умные люди ну это реальный прорыв был какой-то ну не какой-то защиту честно которую научную мысль и научно-практическое он сдвинул а давайте мы забудем про сборки облегчим разработчик скажем нас есть серебряная пуля у нас есть ускорение сайта на лету то есть мы просто будем брать код будем применять к нему какие-то правила на основании тогда еще не была там одна фраза это машин cleaning но вот сейчас можно ставить на основании машин cleaning мы будем сайт нашу скорее отлично ну и сама известность с намоткой спит на эту тему в целом это работает то есть если у вас небольшая нагрузка то есть там 20-100 тысяч может быть пользователи видеть до 100 тысяч если у вас вы вы не хотите думать как у вас там что происходит если у вас там не горят кипиа и потом по скорость есть в этом что-то внедрили она вас как-то работает целом точно хороший подход но к сожалению мы честно мы три года назад его внедрили и вот недавно от него полностью отказались то есть мы наткнулись на ряд с проблем более или менее критических которые вот я сейчас озвучу и которые желательно что вы тоже знали поэтому собственно сегодня здесь уступаем значит первое мод по себе это не очень много настроек то есть там есть я настроек который как-то с друг другом коррелируют друг друга перекрывают и вот если примерно знать как он работает и несколько раз протестировать то какой то будет правильный эффект но в целом задать правильное поведение чтобы вот он делал ровно то что вам нужно ничего другого требует примерно тех же усилий чтобы настроить собственную сборку по тем правилам который полагает google по себе то есть кому вы там тратьте не зная 50 часов на google по из петли бы 50 часов на собственно сборщик на выходе у вас либо черный ящик который может сломаться там в любой момент при обновлении либо вас понятно там описанная какая-та инфраструктура внутренне первый момент второй момент там естественно есть проблемы с инвалида цепеша то есть вам нужно все эти вещи которые google pagespeed выдает их кэшировать и себя дополнительно потому что если вы например вы грузите хотели в нем ну какой ты скажешь возьмете хтмл google pagespeed будет думать что простите но этого ресурс у нас уже нет у нас уже ресурсов поменялись там просто выдаст 404 но тот ресурс который существовал и все и будет плохо ведь причем эти мелкие ошибки можете общение выловить то есть проблема наблюдаться конечно нужно синхронизировать ваш кэш и кэш и приложение кэш модель а также есть с чем мы столкнулись собственно зачем полностью от него отказались это нестабильная работа под нагрузкой то есть даже в фиг с ним стом со времени фиксер что он добавляет там минимум 50 миллисекунд на обработку запроса там как бы на фоне того что он срезает 2 секунды при ну там две три секунды при полной загрузке страницы этим можно жить вот но к сожалению если он не успевает там обработать достаточно количество запросов секунд то есть нет обстоит limited не больше там кристине больше 50 миллисекунд работать он просто ничего не делает то есть вроде есть но вроде нет такой замечательный мед все вот при большом потоке запросов он тупо перестает работать то есть он он не справляется с оптимизацией и ничего не делать и волосы суть при хайло диана сводится примерно к нулю ну естественно там ряд непонятных вещей типа если мы объединяем java-script затем мы через и вал его вызовем как леска оптимизация мало стыкуется то есть и причем отключится нельзя то есть это нельзя сказать что угол блин ты молодец объединяясь стиле скрипты и я тебя очень люблю но пожалуйста не заворачивая вал как ты по-другому объединяет там нет такой настройки там все захардкожены только через и вал только хана но только жесть вот оно че теперь собственный секретный слайд который можно фотографировать я не буду отбирать фотоаппараты этот стек тот стек утилит который мы используем и который мы протестировали за последние вот скажем что за последние шесть лет в промышленном масштабе то есть это вот те самые там там пятьдесят сто миллионов хитов в сутки чтобы их отгрузить чтобы их отгрузить корректно чтобы ничего никого не сломалась чтобы у всех все было быстро мы собрали некоторые набор инструментов во первых это очень разные модули джинкс то есть мы немножко тестер лила но я чуть позже скажу почему мы не используем лова то есть мы решили что максимум что мы можем позволить джинкс у потратить на клиентскую оптимизацию это одна миллисекунда то есть вот все что дольше одной миллисекунды это не наша если google pagespeed хочет 50 молодец но он не наш у нас highload мы хотим отгрузить там 2000 de и 1000 100 тысяч ресурса в секунду там может быть не из одной железки но требования хайло да но не совместимо с тяжелый клиентской оптимизация поэтому и делали все чтобы сделать ее легкой мы собрали собственно стояк оптимизации изображения собственно частью перед выписаны здесь вот я ссылок списание давал муж ты просто я бы вот 5 слайдов меня были бы только ссылки и очень кратко каждый из них гуглится open source практически все прыгнул на ну все даже upon source дополнительно скажу что мы кровь кроме того что используем зов ли для статики мы еще внедрили брод ли полет нормально каких-либо проблем и ни у кого не зафиксировали то есть там уже месяца два у нас работает жмется отлично только стоять и к стати к оборот ли нормально хорошо работает с доче который вот очень хотим попробовать пока не еще не в план нас не вошел пока не даться может тоже где-то внедрим раздачи и страстно ряд утилит для оптимизации этих векторных изображений своего и естественно подъема который наползает то есть яд вести так можно использовать и тависток работы значит позже я расскажу как это все работает значит вот примерная схема что мы можем потратить на клиентском путина то есть это хайло то есть когда у вас есть там серверное приложение вы знаете что там не знаю запросы к базе данных это 50 миллисекунд там не знаю северный код там там он эти запрос обработает 30 миллисекунд 10 миллисекунд у нас выливает этот шаблон и 1 миллисекунду ходит на клиентском тюменцы тогда можно жить с этим можно жить это в правом промышленных масштабах работает это хорошо это это это ну это можно масштабировать уже если у вас там клинском час будет занимать 200 миллисекунд или 500 миллисекунд только сожаление никуда не не pride конюшни пристроишь ничего на этом не сделаешь поэтому вилли парадигму ускорение сайт со скоростью gzip то есть вот где потратит там порядка сотен микросекунд то есть это десятые доли миллисекунды на то чтобы там рожать но зависимость объема здесь то есть там по моему 10 микросекунд на один килобайт текста такие характерные вещи вот тест на порядка 1 миллисекунду он там большой если файл нам пришел он может потратить но в целом но она хорошо работает здесь нам экономим на канале если мы принимаем deep но нам его нужно рожать то есть мы с одной стороны к нам на канале другой стороны теряем на на процессоре мы что мы выжимаем и здесь на все менты клиентской оптимизм которые есть они должны работающим быстро поэтому все что мы не можем быстро сделать сейчас мы выносим в отложенный режим оптимизации говорим что ребят у нас есть такая задачка давайте мы посчитаем ещё с клиентом очень быстро ответил муж то на чем мы там мы сделаем только хуже и ряд вещей которые мы вынесли из обеспечения собственно процесс аппарат ложную загрузку сегодня уже говорили о думаю не расскажет это ваша серебряная пуля там на ближайшие годы как минимум то есть все что не нужно чтобы показалось у пользователя на первом экране все что не нужно там ему вот прямо сейчас выше она спокойно выносить в отложенную загрузку там можете повесить но добрый день лучше всего но лоты все и пользователя ну у неё там рот что-то догружается browser браузер может немножко показываете индикатор загрузки в некоторых случаях но в целом мне абсолютно отзывчивый интерфейс у него весь контент есть для работы и дальше уже не его головная боль что там на сайте много картинок или много данных или еще чего-то много он получил сайт быстро страницу быстро следующую вещь которую мы редко где встречали но тоже внедрили мы назвали реактивным ускорением sulcem что если у нас есть какая достаточно тяжелая серверная страниц то есть мы не можем то есть нет у нас методы чтобы взять и отдать ее быстро мы можем немножко схитрить и отдать клиенту некоторый флаш некоторый аналог флажек ты знаешь такой флажок раньше был такой flash в php быстрый сброс быстрый сброс контент это аналог флаша когда мы отдаем клиента некоторые некоторый блок к странице содержащий стиле скрипты т.е. статические ресурсы которые надо загрузить и пока браузер клиента за их загружает мы ему докидываем таким весь остальной контент ну то есть он там в параллель идет здесь очень хорошо видно что там вот контент идет долго но зато мы все за все это время еще десяток там полтора десятка ресурса загрузили и пользователь по факту он ждет на ту самую там секунду или полторы секунды меньше то есть это один из методов который работает которые тоже можно прям завтра применять для того чтобы сделать сайт и быстрые и там буквально два слова как у нас встроен оптимизация изображений понятно что за одну миллисекунду мое изображение пожать не можем там даже даже быстрые методы они работать несколько там миллисекунды десятков миллисекунд здесь она стоит очереди там рама полностью раз параллельной работой у нас там как-то ферма ферма на который там отгружается сейчас порядка миллиона изображение сутки они отлично там в отложенном режиме обрабатываются и по нашим по нашим кипиа и мм и не менее чем 95 процентов случаев пользователях дружим уже оптимизирован изображение то есть там первое первый запрос то есть не оптимизирован уже в сообщении 5-10 минут ему отгружается на следующий вопрос оптимизировано и все хорошо теперь буквально три еще кейса меня уже почти закончилось время но я надеюсь что материал интересно вы чуть-чуть задержитесь если вдруг следующие доклады если что нам делать как нам до по поводу сидена что нам делать сединами как я сказал померить адекватно сидена вы просто не можете самый простой взять тестовый период ну подготовиться к нему основательно взять тестовый период что вас просто никаких других работ не было и просто сделать я б тестом сединам и без сидена если вы придумаете как вам сделать а п тест за там услуга и одно и то же время что вас сейчас сайт работает дома для этих пользователей без сидена для этих сединам окей мы просто задача может быть на порядок сложнее может нам нужно как то вот из кэша отдавать для пользователя которые они раньше сидена приходили значит вот и скажи одни страницы и значит из кэша может быть другие страницы которые без седины ресурс это может быть сложнее по времени вы можете развести можете очень хорошо посмотреть дает конкретном для вас этот конкретный сидена эффект или нет и вам вопрос потом просто но не возникнет нужен вам седин или нет все все будет понятно секунду срезаете просто счет сидел за счет до отгрузки за счет там меньшего размера изображения которое дается через сиди окей мы его используем не выигрываете секунду не выиграете полторы не нужен вам седину осветить без сидена отлично работает дальше меня очень много спрашивали как нам от профилировать производительность на мобильных то есть на мобильных у нас есть две ключевые проблемы у нас слабый канал и в целом там долгий pink то есть у нас там бог знает что может твориться на канале пользуюсь едет машине и перебрасывать между базовыми станциями нам нужно еще мог сайт показатель при этом вот задача решается просто то есть мы опять таки собираем ти метрики делаем срезы по по performance по performance тайминг ok но нужным а юзер агентом и смотрим на срезы если у нас если видно по срезу что у нас вот синие такого фиолетовый прошу прощения фиолетовый канал долго и время загрузки тоже большое это значит у пользователя провис канал и это не циpкa то здесь в циpкa нет проблем если у нас будет много вот таких вот ситуаций когда нас быстрый канал сейчас пытаюсь нативных просто здесь мало не очень характерно здесь вот время видно что север и connect долгий был скорее сьюза этого провисла про из общее время а если мы возьмем например какой нибудь даже не знаю ну да где где фиолета вообще не видно а очень долгий долгий голубая плашка большая дальше то давно нас от грузились быстро север ответил быстро то есть с коннектом именно проблем не было но при этом были проблемы с отрисовкой и загрузкой если таких пользователю вас будет достаточно много значит действительно вас есть проблемы с законом обильных и вам нужно эти проблемы решать если это какие-то там случайно выброс то есть на 5 10 процентов аудитории и от скорее все просто слабые мобильной то есть если у вас не стоит там с кипиа их там для 99 процентов пользователей чтобы сайт отобразился быстрота принципе на них можно забить и если сайт открывается медленно мобильных то скорее всего это канал если вы это посмотрели по вашим данным поэтому самый простой способ от как ответить что провисла мобильных канал или там циpкa взять статистику и посмотреть канал это или циpкa и 3 3 кейс я уже почти закончил буквально буквально еще три слайда я вас отпущу на вопрос был у нас один случай не очень большой интернет магазин значит вроде вроде все хорошо вроде запросов немного картинки пожара ты там но как-то сайт быстрый а когда его открываешь он открывать и подвисает browser браузер виснет там секунд на 20 и все и ничего не происходит если он не отрисовывает не загружают никаких запросу просто виснет в таких случаях единственно что он поможет это за профайлер хороший profile бесплатный которым я пользуюсь который камин дую надо есть еще это здесь в гугле забыл профайлер открываете его включаете кнопочку и он вам все покажет какие джаваскрипт функций как подвисает 10 с но у нас но модуля модуль этого динамического коллтрекинга он на че ты сказал что-то в доме штамм 2 20000 миль миллисекунд из 20 секунд он чё-то в доме искал суммарно она понять что 20 секунд просто и twice убрали модуль сайт не виснет все счастливы но найти это как бы классическими методами вы не сможете то есть вам нужно дополнительно профайлер подключать слава богу таких кейсов очень мало реально то есть скорее всего означает классическое если большие картинки либо там ни пожарные скрипты либо там какие-нибудь сторонние счетчики которые можно вынести в отложенную загрузку вот и резюмирую еще первое к чём вы начинаете уставать начинает составление кипиа iv сейчас есть все инструменты для этого вы выбираете кипя и для основных таймингов их назначаете и плавно к ним подходите в год что для бизнеса нам нужно таки это цифры окей мы их начали собирать дальше мы смотрим как все изменения на эти цифры влияют эти цифры улучшаем следующий момент правильный инструментарий этот изобразил не включим античную диаграмму наш зависимости от количества запросов от вашего холода и в зависимость частоты изменений на сайте у вас будут разные методы применимы то есть если у вас мало я частота изменений это малая частота запросов используйте что угодно если у вас высокая частота запросов и малая скорость изменений вы можете спокойно в там внедрить сборку то есть просто собирать вручную там нет 1 недели там тестируют дополнительное вываливать то есть это редкий случай если у вас высокая скорость изменений и высокий highload но здесь почти ничего не поможет кроме кроме бога аллаха и может быть нас вот потому что динамические динамическое ускорения но будет жрать ваши ресурсы с ним немерено силой там статические сборки с вашей стороны они будут жрать человеческие ресурсы с немедленной силы вот но если у вас не очень высокая нагрузка высокая частота изменения то можете там динамически в в компилить его фронтэнда и все будет плюс минус работать и значит финальный слайд финальный слайд можно уже да кто хотел уходить можно собирать вещи и уходить в финальный слайд как собственно стоит подходить к ускорению сайта чтобы это был именно в промышленном масштабе есть очень хорошая технология думаю что часть из них из вас про нее слышали это подай за кто слышал про птс а про ps а вот три руки есть отлично значит ли остальных слушателей я скажу очень полезны слова гуглите бдсм bdsm или pdc вот я чуть-чуть перевел на русский язык чтобы что было понятно что нас планирует потом делать потом считать потом анализируете внедрять суть я уже на предыдущих слайдах описал но сначала вы выбираете что вы хотите сделать потом вы делаете некоторые тестова внедрения после этого вы оцените результативность теста внедрения только после этого внедряете основной цикл там нужные вещи можно просто внедряет там что попало в основной цикл вы в лучшем случае ничего не сделаете лучше с какой-то там вариации что-то улучшить и что-то ухудшить и но не сможете понять что конкретно вы улучшили что хочет значит на этом у меня все я буду очень рад ответить на ваши вопросы или даже в кулуарах что-то обсудить у нас там даже жизнь вопросы супер 1 раз александр у вас на сайте увидел что вы используете зов zopfli для сжатия изображения хотел бы узнать не не успел прогуглить технологию на скольких браузерах работает со всеми клиентам хорошо выставляет значит по поводу zopfli два два слова буквально сейчас учета народ видимо там параллельно где-то еще очень интересный доклад и все и все побежали или или обед там 16 слотов значит запри это некоторый метод обратно совместимы с гриб который позволяет на 57 процентов уменьшить размер zip-архива то есть он полностью complimentary нг zip то есть мы вместо gzip используем зов ли мест на его отличие что он там где-то в 1000 раз медленнее где по поэтому его в динамическое динамическое сжатие не воткнешь то есть если в этом в джинсах нити зов ли у вас там у джинсу пойдет по цепному что все время просто будет нажать тратить вот для картинок есть аналогичный подход он реализован библиотеки zopfli png он позволяет точно также png который есть цветовую информацию уже прошедшую по всем фильтром сжать только место где по в час как для сжать используется зоб и все то есть и сопли обратно с и missing зипом тех все текст браузера опера поест все браузер его поддерживаю да просто единственное вами ну что он очень тяжелый на стороне сервера и вот в динамику не воткнешь и все спасибо еще два вопроса со спрайты можете ли вы посоветовать используете ли вы технологии которые создают генерирует спрайты уже после исполнения всех всего кода например . но чтобы вручную не не обрабатывать frontend потому что много информации много сайтов хороший вопрос спрайты технология объединения изображений они были актуальны лет 10 назад когда другого механизма чтобы там не знаю 20 файлов взять и отдать в в одном запросе не было тп-2 иметь ну например сейчас я поясню прописать у меня должен был быть секретно слайд после теперь два но я ночью не успел собрать данные просто то есть я вот тем кто осталось маленький бонусом скажу хуже если к тета п 2 вы внедрите вместе с цель не будет это однозначно везде где мы внедрили у нас показатели по скорости не просили то есть в ряде случаев они улучшились в ряде нет там точных данных еще не собрал но то что я отсмотрел ночью хуже не стало то есть эта цель добавил к тета п 2 немножко убрал в целом она плен на том же уровне осталось носа цель вот по поводу спрайтов уже начинается е 8 появилась полная поддержка технологии боишься 4 то есть мы когда в css прямо записываем в боишься 4 кодировки бинарные данные вот я был доклад на одной из конференций дело сравнение как разберусь и четыре из обычного сжатия так вот большие 4 прыгай процентов на 5 при этом он на порядок проще во внедрении чем css спрайты то есть спрайт их там мы писали даже целую библиотеку которая там находилось прайд а если они 1 типом одним 1 одним образом и вклеиваем другого типа другим образом 3 образа третьем образом почему разбивается там там сложный очень логика и хороший библиотек но сейчас они менее актуальны я знаю боишься ошибиться не стоянов стив в этот soldiers steve sanders посмотрите стив soldiers с тем soldiers вот у него была пан собственной библиотеки как раз лица спрайтов на технологии сейчас неактуально то есть вам нужно либо использовать боишься 4 и через него картинки в css там просто отдельный файл вы вызываете там можно потом ради отдельным csm он там загрузит вам отдельным пакетом либо вообще забыть про это переключиться на хотят ап2 и в этом режиме дальше работ может кто-то подвал собственно заменяет технологии и хуже хуже не становится спасибо еще третий вопрос если ты art party реклама есть ли какие-то способы оптимизировать сайт потому что от на графике вы указали действительно более более 6 секунд кроме своей первичной отдачи занимает именно реклама если какие-то вообще методы да и методы есть конечно не просто не вот но они со мной сторон не рокет сайенс то есть мы об этом говорим уже лет десять с другой стороны нет монтажных библиотек которые позволили бы так взять взять простуд обернуть и выложить может рекламные коды они немножко меняется там время ну там чуть менять он когда there'sa фреймы когда ты через и фрейме когда через док документ райт и в целом вот наклон от некоторых кончине но общий метод я сказал от отложенная загрузка то есть вы говорите что в там вся реклама у нас горовица под полно ладу все то есть мы оставляем placeholder и на странице в нее потом вписываем рекламу рекламные коды и дальше уже в каждом конкретном случае мы как-то doppel его им там вызов рекламных ходов чтобы на сайт не разваливался после этого к сожалению сейчас это в том взялся в этом смысле мало то есть у нас есть решение если вы будете к нам подключаться мы эти решения доработаем но сказать что уйдет на сто процентов готовы там вот исходный код выложили пользуетесь я не могу то есть там есть некоторые там они скажем 100 создания бета то есть там есть метки по замене документу рай то есть методы по отложенной загрузки скриптов они естественно автоматизируются там она как-то собирается но как-то работает но пока вот сказать что он работает там на 100 миллионов хитов без ошибок я пока не могу еще последним вопрос спасибо а именно по вашему сервису если например использовать ваш сервис но через какое-то время по разным причинам перестать пользоваться работа над сайтом который вы проделали будет ли она сохранена то есть например если мы три четыре пять месяцев поработали а потом просто у нас сайта например на паузу поставленный или меньше трафика стала вы работаете напрямую сайтами как но с кодом или именно подключается только мы с кодом не работ именно поэтому можем там за какие-то небольшие суммы просто прокси ровать трафик его на лету как-то порезать по поводу сохранения изменений но самые тяжелые же картинки на картинке можно выгрузить то есть услал гривы там в а советской же лежит вы потом берете там через там неделю или через две недели выгружайте все картинки из кэша и получаете их уже с оптимизированными там по цене по цене затрат а остальные вещи они скажем носит больше декларативный характер то есть они могут быть вами сделаны без особых там трудов либо там также внедрены тоже не очень сложно если вы можете сделать их на своей стороне отлично по поводу от того же к тета п 2 но там это опять-таки настройка ли со стороны сисадминов которые могут это номально ладить если вы отключаетесь вы должны своей стороне то иметь чтобы иметь возможность чит не переносится то есть она как бы мог серьезно ник сайт за спасибо большое спасибо я предлагаю перенести оставшийся вопрос если они есть кулуары я сейчас отойду на следующий докладчик выйдет николай нет его здесь вот ему передаю слово нас буквально пять минут перерыв"
}