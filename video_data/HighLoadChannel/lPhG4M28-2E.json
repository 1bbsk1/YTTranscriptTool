{
  "video_id": "lPhG4M28-2E",
  "channel": "HighLoadChannel",
  "title": "Оптимизация сайта. Диагнозы и курсы лечения / Иван Михеев (AGIMA)",
  "views": 176,
  "duration": 2166,
  "published": "2017-04-22T14:47:51-07:00",
  "text": "колин и продолжаем нашу сердцу докладов сайтов частью нашего следующего докладчика сегодня вообще оптимизации но кому надо нам пути нас всегда встречает много интересностей от того как нам приходит какой-то непонятный спорит подрядчика например свой код который нам приходится потом переосмысливать и возникает некий проблемы которые при определенных нагрузках начинает ластиком спокой в этом докладе если вы пришли за каким-то диким хардкором у него здесь нашли не увидите поможет 6а а то что я буду сегодня рассказывать это вообще никакой руки танец ничего сложного это те инструменты которые вы можете получить даже на виртуальном хостинге если у вас на х его использовать ну допустим расскажу инструменты какие примеры оптимизации были у нас компании ну и немножко за тройни масштабируем так как это тоже сам hal оптимизации но уже в другом возле кирпича и вот который я встретилась для себя разработки торт серебряные пули вообще не день существует есть нет какого-то универсального решения универсального кого-то подхода или инструменты который решил всё головную боль который мы встречаем крути вот это вот оптимизация поэтому вот такой есть выпустив серебряной пули не так же тоже по опыту я понял со временем что если у вас вчера был день обновлений и вчерась у вас спасать кто тут тоже никакой особо науки нет делаем его обновить чтобы делом над которым обратно и начинаем разбираться чем что произошло чтобы вылить мне так важно понять сразу что у вас произошло но это поговорим уже более-менее будешь выглядеть пример это что у вас растет нагрузка на ваш сайт возможно наносить равномерно а возможно а скорее всего она неравномерно какими-то пиками и вашему сайту дико плохо становится он начинает бесконечно отдавать страницы у вас там белые кран место контента различные случайные ошибки 500 и и не 500 и опорные отсоединение от серверах замечаете часто или вообще вот страница загружается на половина половина картинки прогрузилось пола не только наполовину крутых мест варится эти симптомы говорят о том что вам пора задуматься об оптимизации вашего порталами сайта и уже применять принимать какие-то шаги на пути к лучше для того чтобы нам структур докладу посмотрим типичное компании приложение с чем он вообще состоит обычно на любом языке целом это есть какой-то фронте непосредственно расположен если сайт это браузер приложение то какой-то трубы есть applications на котором держится ваше приложение 5 бизнес логика и свой данных это может быть зуба то это может быть дай этому остыть и были даны которые должны приходить к вам таким каким бы то ни было способом могли киш ему ты меня в структуру из возвращаемся проблем у нас он долго грузится есть какие-то проблемы с чего начать как этому делу подойти что что же нам делать первыми что напрашивается это посмотреть наш фонд и потому что наиболее такая вещь которая может отбросить сразу несколько вариантов того какую сторону двигаться и основные проблемы на проблема связана с тем почему это у вас не так ладно долго грузит страницы все понимает что скрипт отработал оптимально быстро а но доставка контента клиенту browse она происходит очень долго вас там блокируется исполняется это про то что у вас tруднo пользователей сначала белая игра на потом это превращается для него что-то красивое но это же ситуации когда вы видите частичную загрузку контента 3 sporting долго ли у вас прорисовывается модель еще долго это тоже не очень ситуации но и задержку исполнения джей скриптов когда у вас на какой то скрипт подключается вот 10 списки всех его скриптов не понимает что отрабатывает так как можно здесь тоже простит уже в дивизию есть для этого достаточно простые инструменты которые есть 1 пользоваться 12 он точно имеется под 0 по посмотрели какие воздух запросы сколько страниц отдается когда контент загрузится когда исполнилось какой-то скрыть это вообще бесплатно просто посмотрели статистику займет у вас там пять минут ну дотянуться до клавиши в 12 минут у всех вас есть а статистика уже есть какое-то понимание какую сторону двигаться дальше есть очень инструк интересный инструмент это ее слова и колбочки но и и спорта очень интересно весь в крови на каких-то метров может а все рассказать словами чтобы исправить то есть это такой инструмент достаточно для меня вот такое открытие некий является чтобы польстить который вам еще расскажу как повысить транжира на сайте на основании того что вам тут на хотя поменять а здесь я смотрю с точки зрения толкнули эти инструменты посмотрели что у нас сломалось начинаем исправлять на что обращать внимание нужно когда вы смотрит эти метрики первое наверно можете такое является ключевым и большинство задач на таких конкретных сайтов лежать в это скорость отрисовки дом потому что есть такие сайты у которых дал модель содержит очень много ли он десять тысяч это уже как бы становится проблемы для того чтобы это люк тырить чтобы важным при скроллинге начинает сайт убить если вы открываете на телефоне это еще больше только его становится той посмотреть сколько у вас вообще отрисовывать 100 том 2 наличие внешних железо css это вообще отдельная тема потому что если у вас какой тот же лес который лишь не у вас на сервере запрашивается причем выдавить иногда не знаете какова будет размером итоге потому что какие-то внешние библиотеки там очистимся сложно блокироваться просто загрузка этих стрельцов ждёт пока загрузится скрипт а не какой то там еще что то тут нужно выделять какие скрипты тут наверное сколько доступно сервиса которого забирает вот этот жест но это тоже у нас был такой случай когда мы выкатывали один сайт ну достаточно известна фига скобок там был некий стриг нежный который подключался идем некие операции доход разработчики разрабатывали все у них было круто они не любишь то что у них язык ширился набрался никогда не продвигать или вот то есть и там весело полметра то есть что такое 500 килобайт в рамках там переброса между дисками то наверно но не очень большие цифры вы когда это начинает грузиться ну не очень короче круто когда вас тревогой грузится какие-то секунды u1 плюс там было очень много контента и графического который тоже закашлялся у разработчиков спросили к вашим ногам исследование проводили потом пока не понял что вообще делает но и время становитесь 1 серия здесь вообще все интерес потому что там у вас ловить то есть такие проблемы тоже случается и тут скорее уж нужны и через газ ваши про валеру сети копать ваш код какие же можно применить методы оптимизации фронта унификация объединение от сжатия все это у вас влияет лишь на один фактор это вес и количество фактов если количество файлов при загрузке когда у вас грузится 10 java скриптов и некоторые там возник внешне сервисов это не очень хорошо спалось на фантике потому что там фразу по моим может поддерживать соединение там зависит от версии вашего все остальное блокируется если конечно произвести фон и обвинение варить вам помогает этого избежать с востока 10 файла формируется 1 и естественно 130 кило ваттный загрузится быстрее чем 30 киловатт то здесь нужно понимать но здесь есть такой момент . дефекации советом css потому что когда у вас идет момент отладки набросив знаете кого звезды русской бани и начинают обвинять циферки как все поменялось и очень показывает строчку так вот служат и файл в меню укажут вам строчку один только кроме тех случаев если у вас нету собственно на вот этих вот minifee кадрах но и топтали снесет это значит иногда некоторые собственной пироги тоже он только какой-то ключевой элемент главный богат я начинается и конкретно в коде может быть очень сложно да здесь можно тоже про вот этот подход потому что во кладке вам может сыграть злую шутку ну и сзади здесь тоже все наверно прозрачно потому что медикам до нужно точно зажимать грузит в контейнер 100 на 100 пикселей какую-то положите картинку потому что там все до сих пор часть такие встречаются случаи когда вроде картиночка маленькая туда клиенты проговорил почему так долго вот то есть такой момент должен прочитать вторая группа инструментов для зацепили патент вашего джея склады потому что часто выкину он тупит потому что он так написан особенно если вы используете фрибурге который вов до конца понятно а еще у вас дом модель состоит из нескольких тысяч элементов а еще у вас какие-то события джек вы это навешены от боди боди джек варикапа вам погнался 10000 метров навешивать этот его это пара чего всего будет на самом деле не очень так быстро работать ну оптимизация дом это тоже такая вещь на самом деле когда если помню что выходило али pack 1 и 2 атома не по самом деле было проблем когда они бросили всяким сайты с портом или контактные новостные порталы могу могу еще какие такие исторически сложилось что до модель была очень сложно то есть очень много элементов и просто ipad переварю свою открывали там сайт он календарю родили улетаем как бы человек приходило 100 мом очень сильно капельки не даст ну и собственно просто ускорению работает этого сайта то есть здесь тоже тест бесплатно совет уже которая клиентам а больше крон фанту вашего прокси какого джеклин сервис что статику отдавайте через сих пор мы встречались тени случай как издателем через angels идет и это на диске сказывается нужно очень хорошо поэтому если у вас сайт убит и вы считаете что остальном все нормально проверьте или кстати полость через ржев старица легенд перетер более интересный которые на самом деле встречается большинство ошибок и которого дает просто полигон для оптимизации если у вас нет ли апробируются страницы выполняется скрипт чтобы они открытию браузер ли встречаются часто 6 500 любые баки 100 это уже как бы звоночек и какие-то простой сайт наблюдает через ваш систем мониторинга тут если не нужно бить тревогу встречу стоит задуматься все ли у вас в порядке если какой-то единичный случай то можно подумать посмотреть разобрать его если это воздухе череда каких-то таких случаях то тут уже подходить комплексно и задач а какие у нас варианты когда тормозит обретёшь на самом деле вот этот 3 у вас сдержанностью исчерпал свой ресурс вот какой то сделали программисты не очень качественный или что-то неладное творится базе как это все вообще разобраться первое что вообще приходит в голову это не устанавливать какие-то пришли ров щеки будет вообще понятную вещь а просто зайти ваш терминал и воспользоваться обычными инструментами системы есть нас команда тот который вам поможет понять бога который поможет понять сколько у вас осталось понять есть ли estrace весов и так далее то сеть командами есть операционной системе люксовый подвину тоже есть подробная команда то есть вы ничего такого не делайте вот всего есть под рукой просто смотрите какой станет ваша текущего и здесь вообще ничего такого страшного но тоже кстати был случай с одним ритейлерам у некоторых есть такие вечных каталоге узнаете кочевать и интересный случай что день когда они выкладывают почему-то очень много людей начинает скачивать не знаю на какой целью пар для две тысячи человек . почему подобные портал начинают качать на каталоги и у нас начали разбираться системный администратор господство от его так понял что диску пришел и хорошо стал там поняли что просто все пайки отдавались что запачкаться 40 конечно давать водичку и рисовать очень хорошо просто переключили конфликтный совету достать все залетала носитесь такой явный пример что помогаете на это 50 просто ахнули от а посмотрели что естесственно происходит посмотрели access ног все все сразу понятно поправить если даже у вас еще круче есть система мониторинга то вам даже в операционной система сама ходить нужно вы из них можете всё понять то есть есть различные метки по которой вы понимаете где в каком месте всем наступил кризис второй момент который приходит на слоге слова логе есть постелите слоги они вам помогают определить место и время когда произошел тот или иной запрос или скрипт выполнялся необычайно долго здесь какая основная тема со слугами или проблему поможет проблем вопрос такой повод поспорить то говорить это время определениями данного запроса на самом деле еще проще вы владелец ваша система вы знаете какое время запросы любого институт для вас являются оптимальными допустим и просто настраиваете слова вот эти можем чтобы все критический запрос вас писались во всех которые критическими писательством важно понимать какое время для вас для частично чтобы там не ставишь то есть вопрос вполне сможешь трех секунд у это уже все как потому что есть такая вещь как океан статистике или расчет или отчеты станках были пять секунд выполнение запросов целом 0 еще один совет проходит осталось 8 включать раз начале разработки а этого спасет от неожиданных пиков нагрузки и потом разбором полет да что у вас случилось потому что с тем же обновлению когда вы выкатывать его напрочь а у вас начинает нагрузку очень неравномерно скота на 7 то тут если у вас волк не был включён быстро вкатиться вернуться состоянием вам будет очень сложно собрать статистику леницкий если же вас они были включены то просто как вы не смотрите подобной мастер жестью решаете возможность пробовать их аккуратно груз тестированием собственно вот и все просто локи ну и также у нас есть еще различные логики и roblox s-log то есть все инструменты серверу которого нас есть наше распоряжение их можно использовать применение каких дополнительных инструментов и то что есть у вас в коробке крыса на систему но плюс мониторит мониторит нужно настраивать а следующий шаг на пути более быстрому понимаю вашу вложения а если она не ваш то это еще наверное более интересно для вас инструмента профилировщика рефери ножки есть по сути под каждый язык мне кажется из под каждый язык и исокаст уважающий себя профилировщика он так сказать не следует содержит некие плюсы которые передали вопросы к 1 ах это простота использования свой просто определяют скромных стартовать закончить пишите настройки что он должен писать какие политические характеристики всех на выходе вы получаете call stack всех и спорной функции профилирование видите а коснуться сколько исполнял у вас есть понимание сколько эта функция исполняла само по себе сколько исполняю сие вложенные функции есть путь его несколько память она потребляет а ну и также фрезеровщики ничего позволяет hologram построить чтобы вы могли проследить а маршруток какого-то действия который является высоконагруженных так случайно которого время выполнения больше там спасибо например если stuff то есть мы разрабатывать на php есть косичку это так как выводить из принц мне кажется у многих похоже интерфейсе снег и таблица стол стеком и есть некий кратко трон показывает как как откуда начилась начинался сложных какой-то запрос да и дело заканчивается есть также еще visual studio провалились еще разные g пруфы тогда литва многие языки мне кажется века гуглится любой профилировки а дальше чтобы понимать что же нам нужно сделать условия пример смотри небольшой это начнем с симптомом если мы вдруг понимаем что наш сайт 8 тормозит в данном случае высокой время исполнения с цветами на сервис вы поняли что у нас во франции сумма но при формировании скрипта нас никаких проблем все что нам нужно это профилировщика или слово в данном случае то есть кому то есть кого то что может построить и такая большая команда такая профилировщика виде вот такого что куст у вас 14 вызов moist верху или выполняется за 1 секунду ну короче не очень хороший показать а если мы проследим как мы немножко вышитому понимаю что некая функция 7 get you зерна чекистская выполняется из 640 миллисекунд и скорее всего из этих что 40 на 620 выполняет запрос то есть можно предположить и понять что да здесь какая-то сережка работал и вот это вот функция на являясь на 6 мест все что вам нужно пойти в эту функцию и посмотреть он запрос вполне и видим что запрос лис материально это выбор количества новых уведомлений и на самом деле тут еще большее недоумение но возможно уже сразу понятно чем проблема что затем запросы не так но чтобы проверить наши опасения мы просто делают explanatory селектор погибаем что это select который хочет у пользуйте вы выбрать все непрочитанные давление пробегаю по таблице с миллион строк после возить ситуации я хочу там выбрать отдельного юзерам приготовления он не все по всему миллион нагружена операции короче вот здесь не так мы видим из этого explore что у нас таблица в данном плане я что не хочет использовать мы переходим дальше делаем простой чертей но добавляем яндекс по юзера иди по прочитанным и что мы видим что у нас миллиона сократилось , 2 мне кажется следить работает ли он строчек продвигаться до 2 ничего такого вот данный пример покажи что данном случае дисплей посмотрели что у нас необычайное количество но огромное количество строк задействовав планета и поняли что просто находить такие триплексы но действенных синко сальтос нужно быть осторожным и из explain а потому что если у вас их стоим в одной версии acrobat по одном из не факт что он отработка короче такой же версии в такой же бася другой версии потому что explain а не задействовав планировщики оптимизаторы и как бы отверстий к версии стратегии планировали твой для этого саммита что хоть осторожней и так что там и который мы находили на 1 он как бы он другой здесь очень легальный примерчик в принципе можно скильки поле сложно запроса смотреть если бы у нас были шутки to join или еще каких таблицы с вами показал просто 1000 мест костров и сказал вам чтобы он использовал в яндекс и сколько строк представь что высохла зависть то есть пенсии интересный инструмент который мне кажется нужно использовать любой диагностики запросов она поможет очень много всего довести до в результате у нас выполнение запросов с одной секунды с кардио за 300 миллисекунд мне кажется хороший показатель в целом если говорить о загрузке страниц что-то вот эта операция с индексом 1 строчки кода она выполняла за две с половиной секунды после вот этого 700 миллисекунд то есть ничего себе такой оптимизация это бесконечно еще а какие проблемы могут быть еще а наши пути здесь наверное собран некий топ логических ошибок программистов первое что встречается на выполнение запросов цыбуля цикле это когда у вас есть некий select с какой-то таблицы а потом просто внутри другого устройства select и делать еще какой-то select принципиально тип который можно было вынести 1 через трое какие-то забирайте дополнительной информации для битрикс разработчик это вообще не кажется какая проблема достаточно распространенный потому что ни делай свой бит лист будет ли ступала на фоне чём этот еще хотя гитлер забирает по какую не очень круто же сказывается на производительности вторая проблема это бесконечный цикл а в коде . это логическая ошибка где у вас vandals пути до какого-то значения там дается такую тонус просто колбасит в бесконечное количество раз что не очень хорошо сказывается на ваше приглашение на вопрос о причинах дает ну и также встречается там с помощью филлеров щека это очень хорошо определяется то ненужной вызове функции когда вас без того чтобы запихать почти никакого это исполнение функций перемен то просто поставляется без перемен эта функция называется дикое количество раз особенно при работе со строками это такой момент который в теории может как бы обломать вашу систему даже 20 им делать мне кажется нет вариантов только делать какой-то рефакторинг исправлять ошибки в позе ну и следующий сделать какую такую другую более калеб а но в этом или существуют все другие процессы которых является ошибка разработчиков скале является ошибкой узнаете недооцененность вашего приложения когда вы думали что процесс дозу забрали это большое количество ресурсов в итоге вопрос такой василек строк для вас неожиданности есть тоже перед себе практики для этих вещей это если у вас есть какой-то процесс который не очень критически real-time выполняют просто вы носите их в кровь планировщик либо делать какой-то пошаговый скрипта либо вводите понять и очередей ст нужно нагружен операцию сделать потом достаточно быстро отдать карта пользователя пример таких операций в принципе типично это либо и порталов какой-то который я должен проводиться на каких-то хитах публиковать на сайте отправка почты это мне кажется тоже достаточно показатель пример потому что будете вы его отправлять тот же момент в целом и свой большой поток отправки сообщения того что просит ваш сервис ты слушай для таких вещей делать в очереди но и у нас были такие пример когда клиент вроде четкость в цели это мощно было количество строк но ему нужно было знать о по клику раз чтобы показался отчет тут мы вводили в пошаговое создание или тоже очередь сказали что он вроде боятся а чё там через пять минут и потом аточа формировался отдавалась с такими мир методики убийцу применимые достаточно эффективны мне кажется в любой платформе до подходим вопрос тому что все таки если у вас все хорошо если кот у вас вылизан если индекс упасть настроены если у вас такого нет понимаешь работал тут нам на помощь приходит горизонтальное масштабирование потому что любой оптимизации рано или поздно она заходит в тупик она ограничиться ресурсы вашего сервера так или иначе то есть сколько бы вы не были за ваш код сколько бы вы ни там вырабатывали различных подходов к формированию индексов так или иначе вас все равно придется все присутствующие и тут у вас есть два варианта либо вообразить просто ваш темы такая еще 1 фото добавить делаете диски побыстрее или просто можешь сказать о ней чуть либо переходите горизонтально масштабируем что принципе решая такие две задачи первое это резервирования то есть вы всегда иметь какой-то резерв случае если у вас первый сервер мастер да и вас есть некий такой баланс нагрузки распределяется должен ног стерве концентрироваться ожидается несколько что положительно сказывается на скорости вашего приложения но но тут важно понимать что это все клинка до вас реально рабочий если у вас приложение то его здесь спасти то есть вас просто будет там на все сервера какая нагрузка бешеная и тобой из того чтобы состав пользователи до миллиона туристов со стока 150 то есть здесь важно тоже границу а если подводить итог то принципе не ищите универсальных способов потому что их просто нет каждой задачи вникает для какой-то оптимизации и как бы больше ничего не нужно переваренного на тросе так как а вот момент пока будет произвести factory ну в принципе это не очень дорого сделать апрель процессор купить дополнительную память первую очередь определите узкое место то есть перед тем как что-то делать лучше провести диагностику чтобы точно знать в каком месте у вас кубок и используйте простые инструменты нужно выдумывать каких-то меткой решений просто есть операционной системы есть и инструменты есть различные профилировщика а используйте их докупите азову это тоже оптимизация здесь тоже вопрос про то что иногда вопрос стоит и оптимизации кода или приложения просто в покупке дополнить вас от оперативной памяти это решит вам 10 ваших проблем ну иди плати предыдущего ли запального масштабировать рано или поздно если вы планируете что у вас сайт будет все еще жить вы к этому так или иначе придется потому что нагрузка будет возрастать будет возрастать это процесс на сайте и вам придется все равно его горизонтально повторилось ноги спасибо за внимание спасибо за вопрос такой начали говорили готовы элементы на странице как вы считаете ли количество и какое количество считаете необходимым чтобы от мезим предел как мы считаем никак это турция понятно что страниц там очень добрый девицы наверное скорее всего эта проблема the top model какое количество до тоже вопрос потому что ну наверно 100000 дом элементы кто-то ушах к критично 1000 это вроде бы да здесь тоже зависит от вашего сайта от вашей аудитории какие у них машина-то стране даже у меня нет ответа какое число дом пример страницы страница может долго грузится из десяти думали правдин до лета и страшный момент вот так вот этот момент определить из-за дон или нет за и большого количества или же это все таки есть событие браузеры которые вам подскажем то есть за какое время был трансформирован доводить есть общая видового когда вас просто все загрузилось настроение с под этим параметрам из того же твой бады вы можете понять какой из показатели у вас воды спасибо за так скажите насколько не знаю как пронизывается услуг ехал везло сколько там не функционал устоять перед а он просто немножко о другом через google pagespeed он больше на устах говорить как оптимизировать ваш трон для мобильного там просмотра и чтобы там еще ранжирование бы была выше 100 вас от этих правил google google от слова то больше уже а проблем с wanted for that и все просто обращений формацию дает его что мне такие спа которого можете провести оптимизацию то есть итоге или то есть вообще можно его и богословы был бы стоит использовать и это кажется еще хочет вас он просто берёт вы говорите и что статику мы отдаем с помощью раньше вопрос какой этот случай если у нас очки работает apache мы вот навешивает получается бензин используем его как практика что есть вот мы создаем новый проект какой-то допустим и нам с лучшего как бы сказать который в принципе будем использовать больше предпочитаемого а большинство там что из этого лучше я вам не скажу вот но вообще нас несомненно вроде схему из важный вопрос свою вину вот на больших нагрузках что жить будет надёжней . спасибо за доклад хотел узнать партесь не рассказывают ну такой просит иногда парниша отель загружает непонятности стокса смотри как настанет пройди тут я вам не советчик работы я вам спасибо вам свой ход"
}