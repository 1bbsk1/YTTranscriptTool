{
  "video_id": "GCNKNqkaNAw",
  "channel": "HighLoadChannel",
  "title": "PHP в облаках  / Павел Вирский (Авито)",
  "views": 347,
  "duration": 2120,
  "published": "2023-10-06T07:22:49-07:00",
  "text": "Привет Меня зовут Паша и сегодня мы с вами поговорим про перенос вашего PHP приложения в облако а именно в cubernatis мы поговорим Про некоторые особенности этого процесса про подводные камни и потом как некоторые проблемы мы решаем в Avito как бы должно быть заметили меня нет перед вами на сцене я не выступаю вживую потому что пару месяцев назад мне внезапно для себя захотелось провести осень в Армении Это означает что я не смогу задавать вопросы Вам и не смогу получать на них ответ Однако Вы можете задать вопросы мне после основной части доклада немного обо мне Я много лет разработки пишу на разных языках раньше этого основном был PHP сейчас скорее гон я руководил разработкой и поддержкой одного СМИ одно киберспортивного СМИ последний год работаю в Авито пишу Back and в основном на Go и все это время интересуюсь де боксом и тем как наше приложение работают на серверах И как это все настраивается о чем мы с вами сегодня поговорим во-первых поговорим Зачем вообще вам нужно переезжать в облако возможно сейчас уже хорошо работает Как изменится ваше приложение Как изменится окружение на которых запускается ваше приложение и какие они могут быть что будет жить Рядом с Вашим PHP приложением внутри кубового кода как мы будем собирать метрики и логи и Как изменится процесс Скорее всего вы слышали Это слово и Возможно даже знаете что оно значит Однако это не самая простая технология и для того чтобы не оказаться в ситуации я не буду уходить в детали Как именно это работает нас не очень интересует нас интересует именно запуск приложений внутри Итак Зачем же вообще в облако возможно сейчас ваше приложение крутятся на одном или нескольких железных серверах невозможно виртуальных серверах так Какие плюсы Вам даст переход в облако и в интернете во-первых это более эффективная утилизация во-вторых возможность постепенного обновления вашего приложения и самое главное удобного отката более эффективно масштабирование вы сможете при необходимости если на ваш сайт прошел большой трафик докинуть еще несколько серверов добавить кубовый кластер масштабировать на них приложение и выдержать этот пик нагрузки и Кроме этого устойчивости все сильно проще потому что всем периодически нужно выключать сервер на время обновления операционной системы или каких-то зависимостей и в случае с cuberneticsом это сделать не сложно вы даете кубернатису команду удалить все приложения с этого сервера после этого вы можете выключить сервер обновить то что нужно и вернуть его в строй и Кроме этого если ваша команда пишет на PHP соседние ребята пишут на Гоа еще какие-то ребята Вы можете все вместе существовать в рамках одного кластера не мешает друг другу странными зависимостями которые вам всем нужны а комфортно вместе работают Итак давайте начнем подготовки начнем подготовку с того что нам нужно будет допилить наше приложение ваше текущая php-шпичное приложение явно потребует некоторые доработок для того чтобы хорошо работать в пластырем нам потребуется подумать про статический файлы про внешние ресурсы про сессии про консольные команды и в частности про миграции и про конфигурацию вашего приложения Начнем с того что я напомню вам что такое 12 факторное приложение скорее всего вы слышали слышали такое выражение оно было предложено Адамом вигенсом в то время инженером в своем блоге и оно описывает 12 факторов как следует из названия 12 признаков того что приложение готово работать в Облаке и его будет удобно это облако выложить факторов 12 здесь я привел 6 который наиболее на будут важны для дальнейшего доклада и Давайте пройдемся по изменениям которые потребуется сделать для начала это статические файлы Что такое статические файлы это все то что не является частью вашего приложения не содержит расширение PHP это всякий джеский CSS картинки загружаемый пользователями файлы все такое давайте начнем это Джесс и все что касательно графики вашего сайта то что помогает вашему сайту выглядеть только вы хотите так вы хотите и вести себя так вы хотите здесь есть два подхода как можете поступать этими файлами сейчас скорее всего у вас есть какой-нибудь процесс сборки этих файлов запускается например получается Папочка дисков которые лежат с этими файлами так вот куда можно их положить эти файлы их можно положить в образ прямо Рядом с Вашим приложением в каждой реплике приложения будут лежать Джеймс файлы и сайт будет нормально работать отдавая эти файлы оттуда еще один вариант который я хочу вам предложить Это cdn после этапа сборки внутри вашего Sea когда все файлы собрались Вы можете взять итоговые файлы Отправить И тем самым и отдавать их оттуда пользователю Такой путь возможно вам тоже подойдет Подумайте какой вам будет удобнее дальше Давайте поговорим про загружаемые файлы это все то что ваши пользователи загружают на ваш сайт внезапно это могут быть и пользователи администраторы какие-нибудь картинки товаров таблицы PDF и все что угодно а если вы сейчас работаете с PHP приложением на одном или нескольких серверах скорее всего если на одном то скорее всего у Вас рядом с приложением есть Папочка оплот который лежат эти файлы Возможно они разложены внутри по отдельным папкам но суть не меняется Это одна папка рядом с приложением Почему такой подход не будет работать в случае cubernetics потому что приложение запускается в нескольких репликах запрос на загрузку файла пришел на реплику А и В папочке apploads на реплике А создался этот файл а запрос на чтение этого файла пришел может прийти на сервер Bay на сервер CD этих файлов нет и в этом случае пользователь получит ошибку и в итоге ваше приложение на всех репликах на которых она есть будет иметь разный набор загруженных файлов и пользователи никогда не получат нужны и в целом этот подход с тем что нам нельзя хранить что-то внутри контейнера внутри самого приложения нужно выносить куда-то отдельно и в целом этот подход когда мы не храним что-то рядом с приложением внутри контейнера а выносим какой-нибудь отдельное хранилище будет с нами на протяжении многих слайдов В итоге что мы делаем с друзьями файлами мы должны сделать какое-то хранилище отдельно от приложения Вы можете взять какой-нибудь S3 внешне или поднять его самостоятельно сделать какой-нибудь ftp-шник или что-нибудь еще такое в целом S3 кажется самым понятным сейчас путем для работы с S3 есть библиотеки для PHP и ваша задача сделать так чтобы ваше приложение просто умело все эти файлы отправлять какой-то внешнее хранилище полупротоколу S3 что это будет неважно вы сможете их переключать при необходимости главные рекомендации сделать так чтобы ваше приложение эти файлы умело загружать протоколы и отдельный вид загружаемых файлов Это изображение они в целом похоже на файлы это такие же статические файлы которые мы должны также положить куда-нибудь в какой-нибудь внешне хранилище Однако с изображениями часто нужно сделать какие-нибудь действия например случае интернет-магазина у вас есть фотографии товаров которые вы хотите выводить на странице товаров в размере 100 на 100 200 на 200 какие-то миниатюрки и соответственно большой картинки вам нужно создавать эти маленькие размеры здесь два подхода Вы можете делать миниатюры в момент загрузки файла А можете воспользоваться каким-нибудь прокси который возьмет на себя задачу по изменению размера по накладыванию каких-то эффектов и так далее моя рекомендация попробовать ребятами из злых марсиан очень рекомендую Очень удобно работать и в целом Не бойтесь этого подхода поначалу кажется что это странно что на лету Фотографии должны обрабатываться но там много кошеи плюс Вы можете добавить своих это все правда работает удобно благодаря этим применять рядом идёшь прокси дело 20 минут Окей профайл поговорили Давайте поговорим про другие внешние ресурсы в частности про базу про кэша-процессии и самое важное конечно это база потому что базы данных лежат все данные вашего сайта и 99 процентов что вас эта база данных есть что здесь важно помнить что продаю базу данных имеет смысл и в целом принято класть отдельно от клубового пастора вам не нужно упаковывать Потому что так она будет работать быстрее а никаких преимуществ которые дает вам нужны вам не нужно поднимать нескольких репликах и все такое поэтому прудовую базу Мы ставим отдельно кластера Это нормальный путь А вот тестовые как раз клюва ложится в кубы потому что он может потребоваться поднимать отдельные реплики тестовой базы данных для например разных тестовых средств которые вас есть и после того как они большего не нужны Вы можете тушить эту реплику и она пропадает поэтому именно тестовые они не нагружены имеет смысл быстро поднимать быстро тушить это клёво ложится в кубы предлагаю вам пойти этим путем Давайте поговорим про кэш кэша бывают много разных видов нас интересует несколько и первые которые в целом в PHP реализуется но используется довольно редко поэтому Как именно делать в вашем приложении рассказывать не буду разберетесь сами а вот то что касается нашего доклада нашего обсуждения это хранение этого каша внутри инстанса или вне его Какая здесь разница предположим вы хотите положить что угодно и первое очевидная идея давайте положим этот радист прямо рядом с приложением внутри плода клевая идея Так вы сокращаете задержки на доступной сети на сам по себе кэш будет неэффективный Ну представьте у вас 20 вашего приложения 20 кошелек которые 20 инстанция фрейдится поднято эффективность будет маленькая потому что пользователь приходит случайно разные реплики данных выше нет каждый раз создавать и так далее Поэтому моя рекомендация скорее думать в сторону какого-то общего Коша для всех ваших инстансов Вы можете поднять его отдельно в cubernetics тот же родители кэш и использовать такой общий кэш для всего приложения и в чем-то особый шайта сессии в PHP клёвый механизм сессии который позволяет удобно с ними работать на всякий случай Напоминаю что по умолчанию это все лежит файлах и этот путь нам не подходит по той же причине по которой мы не можем хранить статические файлы поэтому сессии берем и выносим какой-нибудь внешнее хранилище в тот же рейдес или если вы Ничего из этого не поднимали можете положить их просто базу данных это тоже нормально работает все фреймворки с которыми скорее всего работаете умеют жить сессиями лежащими где-то отдельно от самого приложения еще одна вещь которая может быть вашим приложении это какие-то консольные команды или крон жобы особенно здесь Какая предположим У вас есть 23 вашего приложения и у вас настроена cronjoba которая в два часа ночи например отправляет отчет о продажах вашему менеджеру так вот реплик 20 кронов тоже 20 менеджер приходит 20 отчетов с утра он просыпается смотрит бокс и очень доволен что делать здесь прикольный механизм в целом он существует в программировании и его реализации есть во всех нужных во всех фреймах которые скорее всего используете что это такое Это по сути флаг в каком-то внешнем хранилище о том что консольные команды сейчас выполняется первая консольная команда которая успела запуститься она ставит этот флаг Она говорит я работаю и остальные консольные команды которые параллельно запустились они проверяют есть или нет Если есть они понимают что какая-то другая команда сейчас уже выполняет операции и просто выключается опять же механизм этот есть внутри симфония Лары всего прочего всех прочих проверках он не сложный для того чтобы Изменить консольную команду чтобы она стала работать в единственном экземпляре даже в случае кластера вам потребуется добавить Ну там две три строчки под это не сложно еще вы можете вынести подобную задачу вообще на уровне Вы можете про них чуть подробнее почитать туда тоже можно положить консольные команды и кроны или если вы любите что-нибудь например и вы любите описывать ваши кроны в виде пэхапешного кода Вы можете просто запустить параллельно контейнером вместе с вашим приложением главное не забывайте что те же проблемы с параллельным запуском останутся думайте Думайте о том не случится ли такого что пользователям или вашему менеджеру придет 20 писем сразу и есть один хитрый вариант консольных команд от иммиграции миграция изменения схемы базы данных поэтому более-менее помню здесь есть та же самая проблема с одновременным запуском вы не можете при выкладке запустить там 5-10 миграций одновременно скорее всего придет проблема вашей базе данных каких-то конфликта х но с миграциями стоит поступать чуть иначе еще и потому что их хорошо бы применить до запуска вашего приложения есть несколько вариантов можете взять отдельный этап внутри себя и там прогонять миграции или вы можете поколдовать и объединить вместе контейнеры кубовые чтобы эти миграции запускались я привел ссылку на клёвую статью которая рассказывает как раз про этот путь про то как миграции положить ссылка будет в докладе в конце доклада поэтому вы не потеряете рекомендую посмотреть И последнее что нужно сделать нашим приложением это конфигурациях учат нас тому что наши предложения должно быть конфигурацию из переменных окружения именно этому мы исследуем ребята Это правда удобно Если вы сейчас используете какой-нибудь Файлик из которого вы забираете все ваши доступ базе данных блоков пожалуйста переходите в переменные окружения Не забудьте о том что их нужно подставлять в приложении при запуске а не при сборке Потому что некоторые фреймворки в некоторых конфигурациях своих идеальных контейнеров эти переменные берут именно при сборке то есть начинает собираться контейнер момент билда приложение Он берет переменные окружения тот же самый доступ базе данных запекает их внутрь образа внутрь и в следующий раз когда вы хотите понять почему вас что-то не работает на продакшене и берете образ Продакшен разворачиваете локально вы работаете продавать базой данных скорее всего вам это не нужно это может привести к всяким разным проблемам Вы можете отправить пушить какие-нибудь вашим клиентам не нужно поэтому все что внутри приложения остается внутри вся конфигурация и все доступы к внешним ресурсам которые мы с вами говорили берутся из переменных окружения и только Где же хранить это все нужно естественно где-то безопасно хранить здесь есть несколько вариантов можете взять кубовые секреты Вы можете взять какой-нибудь внешнее хранилище например вот который мы используем Авито можете взять переменные все что угодно скорее всего вам потребуется перед стартом вашего контейнера написать какой-нибудь скрипт который будет идти в Ваше хранилище секретов например в тот же Волк и складывать их переменное окружение и дальше запускать само приложение тем самым вы получите ту ситуацию которую мы говорим переменное окружение все секреты пробрасываются именно в момент запуска приложения на данный момент не пишем логи файл вот прям жирно и четко не надо писать их файл в случае с кабернетисом вы сможете придумать какой-то механизм как в эти файлы соберетесь нескольких реплик Но вам это не нужно намного проще Просто их писать в stador если хотите можете писать их видеть Джейсоном структура Если вы хотите докидывать какой-нибудь информацию по пользователям Однако Не забывайте что по дефолту ограничение одной Лог записи в php24 байта Если вы будете использовать скорее всего вам этого не хватит вам придется его увеличивать Окей наше приложение готово мы вынесли отдельно статику мы положили отдельно бдкши мы хранился если не в файлах А в каком-нибудь например radise Мы подумали про консольные команды к ролламу про миграции и перенесли конфигурацию в переменное окружение отлично Давайте теперь поговорим А где именно приложение будет запускаться то есть среды про окружение правда соответственно может быть которые входят ваши пользователи которые работают с продакшнему у вас может быть один или несколько серверов Где вы показываете свою работу коллегам или менеджеру и какая-то локальная среда для локальной разработки у всех этих средств будут разные внешние ресурсы очевидно что продавое приложение должно работать с продакшн базой данных тестовые тестовые локально Вы можете вообще хотеть использовать какую-нибудь другую базу данных или отправку почты делать не настоящую а видимо может быть желание разделить образы отдельно на фпм на села Если вы хотите еще уменьшить их образ их размер сейчас мы про это поговорим и Но кроме этого внутренней зависимости тоже будут отличаться потому что на тестовой среде вам очевидно нужно например для того чтобы прогнать тесты локально тоже хорошо бы иметь а еще и какой-нибудь А вот это все не нужно и давайте начнем с внутренней зависимости композитор Локи напоминаю это файл в котором хранятся все версии библиотек которые используют ваше приложение ребята Кладите его в гитовый репозиторий в образ тогда вы не столкнетесь ситуацией когда локально Вы поставили какой-нибудь например и он вас отлично работает а на продакшене все упало потому что за то время между разработкой продакшеном вышла новая версия и напротив совершенно другая версия Поэтому если вы положите Лог файл в репозитории будете работать с ним то все изменения версии будет осознанно когда вы хотите обновить версию библиотеки вы запускаете локальную команду композитором и обновляете комите новую версию файла в репозитории поэтому композиторлог кладем репозитории соответственно вопрос что касается XD Бага это кривое инструмент который позволяет вам дебажить локально ваш печный код и в целом хорошо помогает при разработке Здесь вопрос Нужен ли он на стриже а нужен на продакшене потому что в целом конечно хорошо бы чтобы образ был вас один и тот же но вроде создаст наверное или все-таки не создаст его и здесь мы тоже задались этим вопросом и Саша Макаров один из организаторов конференции создал обсуждение в Твиттере ссылка на него Здесь тоже есть это очень интересный тренд про разные подходы к тому как куда класть дебаг на продакшене или локальные образы очень рекомендую его почитать но там есть один самый важный коммент Дерек пишет что нет никакого оверхеда В случае запуска PHP с выключенными с дебатом Даже если он установлен что это означает Мы можем взять для образ который мы собираем для продакшена добавить туда этот модуль выключить его в конфиге и в теории не получить никакого дополнительного замедления или трата ресурсов но решение за вами Возможно вы хотите еще сократить размер проданного образа и не класть Давайте собственно перейдем к тому как именно могут выглядеть ваши образы у нас будет несколько докер файлов один наслаивается на другой как Матрешка начнем с базового который мы будем катить на продакшн В нем мы делаем какие-то общие настройки ставим тайм-зону устанавливаем модули и прочие зависимости операционку все вот это вот здесь же мы ставим composer здесь я провел удобную команду которая это можно делать буквально одной строчкой без необходимости забирать установщиком позе Вот это запускаем композицию ноут DF потому что этот образ который пойдет на продакш и нам не нужны тестовые зависимости нам не нужен и стараемся максимально уменьшить размер этого образа это в принципе хороший подход внутри доктора а так мы будем катить этот образ еще на продакшн то это нам ускорит обновление поэтому используем вместо и посмотрите Билд Если вы этого не знаете в докере это механизм который позволяет отдельно например первым блоком Поставить все зависимости потом второй слой 2 стейдж этой сборки куда мы кладем только папку вендор и не ставим композиторы все прочее что он собой тянет тем самым уменьшаем итоговый образ Отлично мы собрали с вами образ для пруда Давайте Теперь попробуем подумать что нам нужно на Стрижем на тестовом средах здесь уже композитором запускаем с ключом Def потому что нам нужны печки здесь возможно вам потребуется бак или какие-нибудь еще дополнительные инструменты напоминаю этот слой использует Basic файл который был раньше все что там было установлено будет установлено здесь сборка этого и следующих образов будет быстрее за счет использования базового образа Ну и последний образ который мы будем использовать для локальной разработки здесь мы добавляем если еще не установили Здесь вы можете добавить какой-нибудь профилировщик например Для более удобной работы и все что может потребоваться локально Вы можете запускать этот образ и в принципе вести разработку хоть в докер композиции если вам привычнее хоть мини кубе мини куб потребует чуть меньше конфигурации она будет совпадать с конфигурацией общего кластера там будут изменения но она будет ближе для таких композа придется написать свои файлы в целом тоже не сложно Ну естественно мы монтируем локальную папку для того чтобы видеть сразу изменения внутри приложения это нормально делается и в мини-купе сложности Здесь тоже нет что нас получилось у нас получилось несколько образов потому что один скорее всего не получится из-за разных зависимостей но это Окей из-за того что мы используем и наследование одного образа от другого сам процесс сборки образов довольно быстрый образа весит немного У нас есть базовый образ который мы будем катить на продакшн Если вы хотите можете сделать отдельно phpm на выброс отдельный силой образ здесь я про это не раскрываю сложности там быть не должно и отдельно образы есть для стрижа для тестовых сред и для разработки некоторые образом можно объединить если например внутри стрижового образа Вы почти не добавляете ничего нового Вы можете согласиться с тем что на продакшн поедет печь и образ будет весить чуть больше Зато получив меньшее количество образов которыми нужно будет иметь дело супер мы с вами поговорили прообразы Давайте поговорим где они будут крутиться то есть про состав пола Что такое вообще пот под это минимальная по сути минимальная абстракция внутри cubernetics который мы осуществляем масштабирование одна реплика приложения это один под который может состоять из одного или нескольких контейнеров в случае с PHP это будет как минимум 2 и именно масштабируемся если мы хотим выдержать больше нагрузки мы поднимаем больше и на них приходят весь трафик чтобы входить в такой типичный пот собственно само приложение и для потребуется сделать Некоторое количество настроек во-первых мы должны слушать сетевой порт а не юнисовый сокет потому что общение естественно происходит по сети внутри под между контейнерами и вторая настройка Здесь очень важно нам нужно сказать чтобы PHP не занимался сам менеджментом процессов зависимости от перезагруженности поэтому ставим статический режим работы менеджером мы говорим ему что пожалуйста Подними нам 10 процентов как здесь в примере Вы можете подобрать свое число база Вы можете начать и весь все управление тем какой нагрузку которая выдержать ваша печь при приложении вы будете делать масштабируя сами реплики увеличивая количество плодов не нужно полагаться на fpm для масштабирования количество процессов здесь еще есть несколько настроек которые нам пригодятся дальше в целом самое важное что нужно запомнить Что мы слушаем порт и включаем статические режимы поставили какое-то количество процессов если Будет не хватать и мы увидим мониторинге просто увеличиваем количество пор а что еще входит в под естественно входит сервер который может отдавать статический файлы и переадресовывать запросы в сам PHP Возможно вы захотите поставить какой-нибудь прокси для базы данных или для рейсам это может быть который мы используем в Avito или там про психо прокси Вы можете захотеть это делать для сокращения сетевых задержек если у вас стоит где-то отдельно от вашего кода для того чтобы приложение добраться до базы данных он делает первый запрос бампер после этого опять же делает запрос в базу данных и все в обратном порядке это все сетевые опыты по ходу по сети если баунтер будет прибит внутрь года тогда вы убираете 11 запрос потому что внутри кода Ну и здесь может быть какой-нибудь агрегатор для Метрика логов phpm exporter например для прометеоса или что-то подобное в целом базово это PHP mornings остальное факультативно смотрите Подбирайте Под свою задачу супер мы с вами подготовили приложение сделали образы подумали о том что будет еще жить вместе с этим приложением внутри Давайте поговорим про то как нам понять что все работает в кубах есть несколько видов проверок одна из них это Лайф нас проба которая перезапустит под если ответ на не пришел неправильный эти пробы могут быть успешные и любые другие и второй вариант пробы это один из проба который исполняется все время жизни вашего приложения то есть еще раз Разница в том что бы запустится и если она ответит ошибкой то весь приложение будет перезагружено если вернет ошибку поймет что сейчас приложение не готова больше принимать трафик И перестанет отправлять этот трафик на эту конкретную реплику как только родились проба снова оживет трафик соответственно Ларина с проба Мы можем поставить на какой-нибудь URL infourl например Hands который мы задавали в конфиге а Родина спроба это прикольное место для того чтобы проверить что есть подключение к базе данных кэшам и даже прогреть каши достать какие-то данные логин и кладем оттуда собираем складываем в какую-нибудь эластики брелок статьи про это есть сложности Здесь тоже больших не будет метрики если вы любите подход Push То есть когда приложение само отправляет метрики Вы можете это делать в той же самой Родины с пробкой потому что она и так несколько раз раз в минуту или раз в 2 минуты будет выполняться Как вы настроите если у Вас уже есть прометеос Или вы любите больше полупод подход когда какой-то внешний сервер обходит ваше приложение и собирает метки этот подход тоже работает для прометеоуса есть настройки для губернатора супер Здесь тоже разберетесь Отлично Теперь мы еще понимаем Как работает наше приложение хорошо выполняется как туда выкладывать вообще соответственно поговорим про себя возможно сейчас ваша связь выглядит Вот так это нормально Это хорошо работает Когда у вас один несколько железных оперов вы делаете композиторский зависимости поднимаете базу данных миграции базы данных и например меняется между двумя папками как будет выглядеть Теперь во-первых вам потребуется контейнер registry то место где мы будем хранить готовые образы вашего приложения это может быть докер хаб это может быть хаос или вы можете поднять самостоятельно библиотеки и собираем итоговый образ после этого если вы используете статические анализатор Вы можете прогнать запустить тесты и сделать какую-нибудь кнопочку для диплоида Вы можете хотите автоматически Если вы дерзкий но в целом кажется более хорошим спокойно вариант а сам диплом тоже не сложный Мы берем готовый образ мы прогоняем миграции это все отдельный этап тепла мы прогоняем миграции как это делать мы с вами поговорили там есть кривая статья Green cash если это требуется отдельный той же самой родиной с пробой и начинаем постепенно апдейт Siri получается не очень сложный состоит примерно из тех же шагов но сделанных Ура Мы с вами подготовили наше приложение и поговорили про разные аспекты Давайте разберемся что мы все-таки с вами сделали вот теперь соответствии 12 фактором окружение продуманы и мы описали все образы которые могут потребоваться Мы подумали что еще должно быть рядом с вашим поводом что может там еще прикатиться помимо мы придумали как мы будем собирать логии метрики У нас есть кнопочка по нажатию на которую мы обновляем наше приложение и самое важное если что-то пошло не так мы его отказываем И если нам пришла нагрузка например в черную пятницу или какие-нибудь еще события на нашем сайте вы можете просто докупить железо или виртуальных машин Если вы живете в каком-нибудь публичном Облаке добавить свой кластер отмасштабировать приложение и все будет нормально и потом выключить Что можете сделать дальше после того как вы провели все эти действия во-первых моя рекомендация не пускайте сразу весь трафик в пластырь который вы настроили Там могут быть какие-то особенности какие-то проблемы Вы можете поставить перед вашим сайтом например Джинс который будет 10 или 5 процентов трафика отправляйте новый пастор А в основном работать со старым приложением это хорошая идея это позволит вам посмотреть на метрике под тюнинг лимиты в интернете соски Если хотите Посмотрите про по авто скейлинг это механизм по сути механизм автоматического масштабирования он следит за тем как живет ваше приложение и если нужно увеличивать количество поводов конечно в рамках ресурсов которые вы дадите поэтому только успевает сервера Ну и если хотите можете сделать отдельные тестовые среды не просто 11 сервер а под каждый ветку отдельный поддоменные и кусочки вашего пастора благодаря которому это делается тоже не сложно они будут мешать друг другу могут использовать какие-то общие ресурсы не использовать их в общем это всё а здесь составил для вас чек-лист переезда который может вам помочь он составлен по некоторым пунктам внутри доклада и плюс какие-то еще дополнительные материалы здесь есть ссылка есть qr-код предлагаю зайти посмотреть Надеюсь что он вам поможет для вашего переезда еще несколько ссылок на разные темы которые мы с вами рассматривали и в том числе две статьи от моих коллег из Авито про то как мы Монолит упаковывали и очень клевые глубокая статья про работу сетевой сетевой обмен внутри сервисов а на этом все оставляйте комментарии обратную связь по qr-коду пишите мне в телеграме в Твиттере и я готов ответить на ваши вопросы Большое спасибо за доклад ваши вопросы коллеги так в зале пока вопрос не вижу спрошу Я вот облака следующий этап в облаках когда мы переводим логику функции типа лямда функции на амазоне Могу ли я упаковать PHP код в лямбда функцию вот мне нравится на PHP писать но при этом хочу такие технологии попробовать полный сервер интересный вопрос мне кажется что у кого-то есть такой механизм кто-то может транслировать PHP что-то что они могут исполнять но в целом Если вы пишете на PHP Наверное вы же знаете по-моему точно были Так что Ну да согласен стандартный Ответ Лучше попробовать другой язык который лучше ложится на эту задачу Да согласен так Посмотрим есть у нас вопросы в чате в чате тоже пока Вопросов нет В итоге при переходе в облако Удалось ли Вот сэкономить например деньги бизнес выхлоп какой был серьезный в случае с Avito рассказать сложно я наверное не смогу даже сказать в целом предыдущему опыту по деньгам получается на самом деле или также или чуть больше на просто гибкости сильно прибавляет То есть у нас появляется возможность масштабироваться под задачи особенно если паттер нагрузки на сайте такой что есть какие-нибудь внезапные всплески трафика то можно в это время докинуть ресурсов пережить его потом их убрать перестать тратить деньги значит ли это что переезд на такой кабернетис докеры не для всех проектов скорее для больших которым нужно масштабироваться резко Мне кажется попробовать стать всем благо сейчас есть всякие готовые домашние решения в Яндекса есть у всех больших провайдеров есть поэтому это не сложно сделать это не очень дорого как минимум поэкспериментировать и поиграться с этим стоит вдруг вам настолько станет удобно и для разработки использовать облако что Даже несмотря на маленький сайт маленький трафик что я попробовал Спасибо"
}