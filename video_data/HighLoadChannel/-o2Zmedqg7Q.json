{
  "video_id": "-o2Zmedqg7Q",
  "channel": "HighLoadChannel",
  "title": "Deploying MySQL on Kubernetes & Openshift / Александр Рубин (Percona)",
  "views": 2084,
  "duration": 3335,
  "published": "2019-05-15T03:23:14-07:00",
  "text": "меня зовут александр рубин и я рассказывать про майский обернитесь и я работаю с майский элем уже слишком долго в течение 10-15 лет работал в майские лобби и майский алиби было куплено sun microsystems аркл и с 2013 года работаю в компании перка на кто не знает про company профком здесь все знают отлично значит сегодня буду рассказывать про кубер нить из ясеня был в докладе отличный доклад дмитрия столярова про вообще базы данных в кубер найтись и есть кто кто не был на этом докладе окей хорошо значит я посетила доклад и лишил но давайте я опять слайдов уберу вообще вот и несколько слайдов добавлю потому что объяснение на самом деле были очень хорошие я не буду вдаваться в подробности очень сильные что такой кубер нить из и как он работает и сконцентрировались на том как собственно работает самое с гелем что такое кубер нить из но я обычно говорю что кабинете такая операционная система операционная система для контейнеров и соответственно что мы получаем мы получаем оркестр конце контейнеров но если совсем подумать что такое кубер нить из в обычном мире физическом мире вот я подумал подумал и понял вот что это это порт морской порт вот эта фотография сделал в барселоне это морской порт когда у нас загружаются контейнеры разгружаются контейнеры из них значит какой-то контент достается вот они куда-то уплывают приплывают и так далее то есть это на самом деле самая лучшая аналогия кубер не tissot зачем нам нужен кубер notice вообще ну естественно опять же дипломат да если у нас есть тысячи серверов то как собственных деплоить если у нас есть база данных базы до распределённая может быть тысячи нодов то соответственно если мы хотим это деплоить в контейнерах то вот у нас есть теперь такая клевая штука называется кубер нить из значит перка на это вообще консалтинговая компания в том числе и у нас есть разные клиенты большие маленькие и несколько больших клиентов к нам пришли и сказали мы хотим магию мы хотим нажимать на кнопку и получать базу данных вот в амазонии есть орудий с до relational databases сервис мы хотим это делать внутри у себя потому что большие компании они в клауд идти не могут или не хотят и соответственно они своих как бы свои департаменты своих сотрудников собственно как бы считают что они как бы клиенты да то есть департамент какой то это их клиент соответственно de valmont может нажать на кнопочку но нужна база мы нажимаем на кнопку на сайте получаем базу нужно больше нагрузки мы запускаем команду и соответственно делаем скейл то есть база будет больше нодов и так далее у нас есть разные дистрибутивы кубер на эти c теперь у нас есть опыт shift от redhat а и это на самом деле одна из самых популярных сейчас у нас есть в амазоне есть свой кубер нить из у нас есть google кубер найти на google собственно сделку вернетесь вот в других клубах у нас есть купер notice вообще у нас 35 сейчас более тридцати пяти разных дистрибутивов купер на этих как это все работает но я быстренько расскажу и потом мы сфокусируемся на базы данных а значит что у нас есть у нас есть сервер и соответственно в сервере есть под под и это такая совокупность контейнеров внутри кода может быть запущена один докер-контейнер или несколько докер там тренеров соответственно все они используют могут использовать в данном случае local storage то есть те тот диск который находится на этом сервере соответственно если мы делаем скилл внутри кубер найти зато у нас есть много этих серверов внутри каждого сервера запущен этот пот и они все используют local storage дальше что у нас происходит с контейнерами контейнеры можно удалять можно ли стартовать можно соответственно скилл да то есть увеличивать количество этих контейнеров и известно что это уже как бы давно говорили много про это что они хороши для stay close если у нас есть какое-нибудь приложение там php и java что то еще то мы можем их много запускайте все нормально и не бояться что у них там есть внутри но в базах данных для базы данных и это большая проблема да потому что мы нам нужно наши данные соответственно сохранять если у нас например будет ли старт и мы запустим этот самый контейнер где-то в другом месте и все у нас данные потеряются но это не дело это не то что нам дает базы данных соответственно какие нас проблемы данный произрастает и второе это класс telling да если у нас есть импликация если у вас есть класть link to это большая проблема сама по себе соответственно в купер найтись и недавно стало возможно решение этой проблемы та проблема которую нас было с докером сто лет назад вот кубер нить из позволяет решить эту проблему путем стоит вал сет и pure system search теперь расскажу про базы данных и как мы это будем решать соответственно если мы говорим про сторож the storage купер найтись нативно поддерживает 6 вот это и хорошо и плохо одновременно это хорошо потому что у shared storage есть возможность сердце тора чем им возможным мы можем получить блок данных мы можем получить блок который база или что то еще будет использовать для запись и соответственно это называется у нас persistent валим и pure system болем клеем то есть наш под и наш контейнер может заклеймить какой-то кусок диска и соответственно использовать его для своих данных волен клеем его можно использовать по разному но обычно в базах данных это называется райт vans то есть это значит что у каждой базы данных будет свой кусок диска который только она будет использовать дальше майский эль кто-нибудь не использовать майский один человек не использовать маски а что используете после окей хорошо ну понятно доклад так называется майский эльфку вернитесь и понят что приходят люди которые используют маски отлично значит вы все знакомы с майский элем если мы запускаем один майский сервер кубер найтись и то проблем никаких не туда вот есть водно описание как это сделать ну мы просто можем место у нас есть один майский сервер можем его как контейнер запустите все дальше если у нас более сложная то есть как бы кто-нибудь использует вообще один только сервер уже в продакшене один сервер никто да ну понятно а естественно нам нужно high visibility высокая надежность да вот нам нужно по крайней мере несколько майских серверов и мы поговорим о том как мы это будем делать значит нам нужен persistent storage нам нужно постоянное хранение данных нам нужен backup and recovery нам нужен роутинг трафика то есть наше приложение должно подключаться к ман мо из келью это будет допустим кластер и оно должно иметь возможность подключаться к майский элен несмотря на то что там как анти 1 но до вышло из строя и последнее что нам нужно это мониторинг этого всего пойдем дальше значит вот эту картинку которую нарисовал вадим мой коллега сити а собственно перк он и когда мы думали как бы нам это все сделать значит что у нас есть здесь у нас есть и эта картинка это собственно я забегаю вперед значит у нас есть три ноты майские ли у нас есть прокси с келли это собственно наш трафик раутер у нас есть возможность сделать бэкап и и у нас есть мониторинг и это собственно был наш заказ да то есть что нужно чтобы у нас получилось давайте посмотрим на каждую из этих на каждый из этих кусочков прежде всего репликация на майский все знают майский ли кто-нибудь не знает что такое репликация я думаю что ни одного человека не будет который не знает что такое майские репликации да значит майской аппликация было вообще это как бы она из есть из коробки она была создана наверно в каком девяносто девятом или в девяносто восьмом году и майские люлю при кация до сих пор используется это отлично у нас есть разные опции вот традиционная майской аппликация да сейчас в маске ль 8 есть новая майские люблю catia называется группы a british на кто не слышал про группу для плит лично у отлично и последнее что у нас есть не последнее третье что у нас есть это пятка на x-tribe кластер она основана на галеры реплики шин кто не слышал о прогорела галера реплики шного отлично значит теперь какие у нас есть проблемы с традиционной репликации когда монтеверди news создавала репликация в каком там 96 97 98 году то не было никаких возможностей сделать как бы он ни сделал и как бы не проектировал возможно автоматического файловая до перехода если у нас мастер умрет то больше как бы ничем случится то есть никакого перехода на сайт не будет никаких смен ролей не будет да и это одна большая проблема с майскими аппликация особенно в кубер найтись и особенно в контейнерах вторая большая проблема это в том что когда мы подключаем новых слоев мы должны сделать кучу всего там я думаю что все кто здесь присутствует слышали про это кто-нибудь вообще никогда есть тут кто-нибудь кто никогда не ставил майская репликацию ни одного человека окей соответственно мы все знаем что нужно сделать чтобы поставить своих да мы должны сделать бэкап скопировать данные найти позицию в берлоге делать чек моста туда нам потом делать starslife то есть нету никакой автоматизации из коробки чтобы нам допустим я хочу еще один slave нажал на кнопочку и все магическим образом произошло до такого из коробки нету а дальше группы applications но я скажу что групп рипли тишина это отличная штука отличная идея но она слишком много сейчас аркл майский эль над этим работает и надеюсь что в будущем она будет стабильно кроме того такая же проблема существует из группы киш нато есть если мы хотим например поставить новую моду в группе репликейт он нам все равно нужно делать бэкап все равно нужно копировать эти данные и так далее что у нас еще есть у нас есть перк оникс людьми кластер собственной это кластер на основе галера реплики шни галера реплики шин это синхронная репликация которая использовать так называемую группками никишин что это значит значит что если мы записываем какие-то данные на сервер 1 здесь то автоматически и синхронно эти данные будут скопированы на сервер 2 на но до 2 и но до 3 это хорошо потому что это дает нам consistent это не очень хорошо для пифон потому что в отличие от мастер цифры плетей шин где у нас master и slave они работают в асинхронном режиме то есть мастях совершенно не ждет и вообще не знает про то что у него есть здесь совсем другое то есть мы должны понимать что у нас есть три ноты это синхронная репликация и это будет работать с со скоростью самой слабой ноды в другой стороны это очень хорошо для кубер notice a и для deployment а потому что у него есть так называемая ато pro-vision и то есть если у нас если нам нужно поменять сервер у нас там я не знаю вышел из строя диск нам нужно взять новый сервер поставить в кластер мы что делаем мы просто копируем конфиг-файл устанавливаем боялись устанавливаем майские ли туда запускаем сервер он подключится к кластеру выбирает одну ноту из списка и сделать бэкап он сделать бэкап скопировать скопируют эти данные и подключиться к кластеру то есть проблема которая у нас есть с репликацией с нативные майские леру фикации здесь полностью решена если у нас контейнер умрет и данные у нас потеряются не дай бог то соответственно мы можем восстановить новый контейнер он подключится кластеру и все будет работать как обычно это собственно картинка продайте трансфер как происходит какие есть две возможности синхронизации с новыми машинами то есть то что я описал это pro-vision и это называется sst то есть это полное копирование всех данных если же у нас есть но до которая вышла из строя но она недолго была там она как бы было в дауне но была в дауне не очень долго есть возможность у кластера послать не все данные а только дельту только кусочек то что тот сервер не получил потому что был давним это называется incremental стоит трансфер 6 соответственно если надо было в дауне недолго то она получит только дельту если она была в нокдауне очень долго или вывод данных вообще нет они потерялись то соответственно она получит полный полный sing посмотрим теперь на вторую проблему которая у нас есть в кубер найтись и это система хранения данных значит что у нас есть я буду достаточно быстро здесь рассказывать значит здесь у нас есть локальный сторож у нас есть ssd envy me опции но от традиционного кубер нити были проблемы с менеджментом этих святых стоить до почему потому что если у нас каберне this распределен нам на много разных машин и мы например говорим что ну я хочу эту ноту майский или перенести с машина один на машину 2-я и конечно перенесу но опять же а данные потеряются потому что не локально на этом диске поэтому а кубер нить из всегда поддерживал networkhd touch network storage был это хорошо для менеджмента но плохо для performance очень многие наши клиенты говорят вот у нас есть сторож вот у нас есть нфс давайте-ка мы запустим майский эль не nfc как нет запускал майский иллинойсе в продакшене в общем не делаете этого вот сам нфс это ужасный протокол а плюс еще вы вся эта network latency которая будет там использоваться нфс глаз рфс это очень плохо для баз данных поэтому если мы говорим про кубер нити 100 это то что мы не хотим использовать а если мы в ее ws например то мы можем использовать и без и без не идеальна для баз данных и от особенно для перфоманса и для нагрузки но как бы у нас много много людей много клиентов много компаний которые используют майские на и би си то есть это нормальная опция кубер notice поддерживает и bs то есть в качестве persistent вольным клеем мы можем использовать и без то есть и bios может использоваться как persistent валим мы можем сказать что мы хотим persistent валим клеем от и биоса и он нам даст кусок выделит специальной специальную сторож намазывание пойдем дальше роутинг трафика какие здесь есть проблемы у проблема на самом деле очень простая если у нас есть кластер то наше приложение должно подключаться к кластеру а на самом деле оно получается не кластеру она подключается к одной ноги да потому что так майские реализовано так так мы реализованный скриптов такого что мы хотим сделать мы хотим перед майский элем поставить роутер какой бы роутер вы поставили ну например речи прокси эти прочь они хорошо почему потому что он ничего не знает про майский одессе пилот баланса да вот значит у нас есть праксис кель прокси детский эль отличается хорошими качествами во первых у него хорошая производительность он написан с нуля и сам на си плюс плюс соответственно он позволяет нам крутить escape кроме того он поддерживает файлов и это ровно то что нам нужно если одна но до вышла из строя то нам нужно автоматически переключаться второе это то что он может быть так называемым men in the middle да то есть он может парсить иру учить все запросы и собственно это мы и хотим использовать значит вот картинка про прокси сквер соответственно что у нас здесь происходит наше приложение подключается ника майский элю она подключается к прокси ский практически лишь собственно говоря представляют собой как бы и имплементировать майский протокол наше приложение подключается к прокси скального на самом деле приложение думает что она подключилась к майский и practice cures собственно делает роутинг на узлы она наш узлы кроме того праксис гель имеет такую классную фичу называется разделение чтения и записи соответственно если мы вспомним про наш пир комикса тебе класть а то у нас все узлы в перк он и экстра тебе класть или в галеры класть или они все одинаковые теоретически мы можем писать на все эти узлы это большое отличие с майские ли аппликации да и что мы можем делать здесь это мы можем выбрать одну ноту чтобы она была райтерам это неважно какая будет ноды райтерам но она должна быть одна потому что если мы начинаем писать на все три ноты одновременно тогда у нас возникают конфликты конфликты это не очень хорошо это не конец света на самом деле в pixie в gallery потому что в случае конфликта что происходит одна нота будет как бы убито и все данные будут скопированы но на мы не хотим как бы никаких конфликтов получить мы не хотим мы обрабатывать эти комплекты конфликты в приложении поэтому выбираем одну ноту чтобы она была райтерам и остальные ноты или две ноты чтобы они были лидерами вот собственно говоря что мы хотим получить на кубер найти у нас есть галера для плетения у нас есть праксис кель у нас есть веб-сервер и соответственно это то что мы сейчас попытаемся запустить а что еще мониторинг в питоне есть мы реализовали опием им пин-кодом они тоже нет менеджмент сервис это open source solution убийством grafana то есть на основе граф анны и соответственно мы будем его интегрировать в наш deployment для кубер начаться значит это то что мы гид хоп то что мы сделали вот у нас было наше задание до в качестве картинки и то что мы реализовали это я бы сказал это бета-версия но как бы если вы хотите это посмотреть на это и попробовать то вот гид хоп биткойна open shift теперь я считаю начинается самое интересное я расскажу как собственно мы можем это делать и как мы это делали какие у нас есть опции для дипломата первые опции это опция вручную да мы можем брать ямал files и просто их туда запихивать 2 пса это хелм charts и третья опция это опера это мы прошли все эти шаги значит как это делается вручную у нас есть файлы ямал куча файликов ямал значит что мы должны сделать с пепси и или с майским мы должны соответственно прежде всего нам нужно вольем иметь да то есть нам нужно данные нам нужен диск куда собственно записывать файлы дальше нам нужно передать конфигурацию в майский дальше мы должны запустить собственно пикси и запустить его специальным образом так чтобы он собрался нам нужно собрать кластер в конце концов нам нужно запустить праксис кель чтобы практический сама сконфигурировал кроме того нам надо передать в майский пароли и последнюю очередь или не в последнюю очередь мы должны сделать иметь возможность делать бэкап вторая опция намного более привлекательная him charts значит him charts и это возможность собственно говоря использовать тимплей ты кем чарте это то что мы собственно реализовали и hell чат позволяет нам иметь возможность придавать значение в наши тимплей ты если мы считаем что наш кубер нити сайта операционная система do the hell чарт это таких менеджер да мы делаем ям install и получаем пикси и последнее это он оператор оператор и это такая вот сама движущая повозка я бы сказал или sale в драйвинг а которая позволяет автоматизировать разные задачи сейчас пока мы говорили только про deployment мы говорили про то как мы создаем этот кластер как мы хотим запросы к этому к кластеру и так далее но у нас есть ещё куча разных задач других например нам нужно автоматизировать бэкапы или нам нужно делать апгрейт вот и вот это все решает оперой там оператор или оператор это собственно картинка которая была опубликована на сайте ли тхат собственно говоря у нас есть первая фаза 2 фаза 3 фаза и так далее и на 5 фазе у нас получается автопилот то есть у нас есть база который мы создали которая сама себя оптимизируется мо значит за собой следит сама делает бэкап и может быть даже сама восстанавливает бэкапы я уж не знаю ну вот это собственно говоря не то что это уже существует этот такой promise да ну хорошо давайте сделаем небольшой дымом значит что мы сейчас сделаем мы сейчас поставим установим пепси кластер и для того чтобы установить пикси кластер мы будем использовать him значит здесь вместо того чтобы писать ей яму или apt-get install майский эль вы нам мы напишем help in стол name кластер или что-то там мы хотим из и нашей целью да значит что произойдет мы это собственно установит три ноты дракона и кстати кластер праксис гель и из конфигурирует наш проксей сквер чтобы она мог шутит наш трафик значит после того как мы это сделали мы соответственно вот что мы видим да то есть у нас есть 0001 но 2 праксис келли мониторинг значит что здесь произошло во первых у нас собрался кластер автоматически если видите 0001 но но 2 это стоит full set стелс от это возможность создавать коды контейнеры специальном порядке это на самом деле очень важно для кластер а я покажу потом в конце как собственно мы эту лизу это важно для кластер а потому что кластер должен собраться мы стартуем ноду один точно до 0 здесь дальше стартуем следующую ноту это следующий но до подключается к предыдущей ночи и берет backup соответственно 3 надо делать то же самое она встает подключается к кластеру говорит дайте мне бэкап и забирает этот backup таким образом у нас поднимается кластер дальше у нас поднимается практический прокси эскель видит этот кластер заключается кластеру себя конфигурирует и соответственно мониторинг принимает наши метрики что это была одна команда мы стартовали разные маски или ноды мы стартовали праксис киль и мы добавили мониторинг значит теперь посмотрим более внимательным значит это у нас кластер один прокси скелетона строк сискель 0001 и ноут 2 это наши ноты только на их свадьбе кластер а теперь нам нужен айпи адрес айпи адрес нам выдается кубер нити сам и здесь у нас есть разные опции зависит от версии кубер найти сам мы можем использовать лот bouncer но на самом деле это не важно потому что у нас есть api адрес который смотрит на рок сискель и вот у нас есть пор 3306 да это обычно порт майский эля это не порт маски или здесь это порт праксис кель фокси escape притворяется что на майский и мы наше приложение подключаем к этому айпи адресов и этому порту кроме того праксис кель настраивается с помощью специального административного протокола используя порт 6032 но это по умолчанию соответственно праксис киль может у нас посмотреть что класть от стал и себя настроить давайте быстренько посмотрим значит если мы подключаемся к этому порту я подключился напрямую здесь я не использовал этот ай-пи-адрес который нам был выдан я подключился напрямую внутри контейнера подключился напрямую к праксис кель до 6032 использую просто майский майский клиент праксис кель админ интерфейс и это собственно говоря майский протокол то есть там тоже есть таблицы там мы можем делать selecta мы можем делать апдейт и так далее здесь у нас есть сейчас 3 сервера есть хост group has групп это собственно говоря то пароль который есть у сервера ход групп 10 это райдер топ-11 это ritter таким образом у нас есть три серная и прокси skillz сама будет выбирать к крутить запросы теперь давайте убьем под значит мы убили один под он здесь термин этой и все будет работать значит что происходит если мы сделали опять select from майским сервис мы увидим что этот старый сервер вот 210 да он был подставлен как оффлайн вижу 15 минут он был поставлен как оффлайн и соответственно он теперь прекратил был быть райтерам foxes кейт взяла один из лидеров у нее есть список она взяла один из лидеров выбрала один сервер и переключил роль что теперь он стал райтерам соответственно ничего не происходит соответственно наше приложение продолжает иметь возможность писать в кластер как быстро это произойдет это зависит от наших таймаутов на самом деле здесь получится гонка между тем как быстро кубер нить из перезагрузит под потому что у него есть такая возможность и между тем как практически ель как быстро пак сискель отреагирует я решил посмотреть как собственно быстро самку вернитесь будет перегружать под и поставил специально тайм-аут так чтобы прокси и съели на самом деле наш под не стала перегружать так давайте это пропустим сейчас и покажу дымку записанную так не работает отлично так ну давайте сначала тогда пройдем как мы это все делали и потом попробую ещё раз показать дымку а значит как мы это все делали начать шаг 1 мы лишили ну давайте посмотрим как у нас есть ямал files да как сделать с этим ямал сполз соответственным мы наделали много разных ямал files и они до сих пор доступны можно посмотреть и потом я подумала как собственно это все теперь с этими ямал файл их надо запускать ну что пришлось создать бар shell script соответственно shell script запускают деплой . я сеть мы сначала делаем секрет потом делаем вольем потом делаем и все все остальное в общем это конечно страшно неудобно нужно проверять ошибки в баши в щели вот это конечно не пошло до создаем восемь файлов делаем тепло и свеча проматываю ошибки неудобно шаг 1 ok шаг 2 хелм и тимплей то это конечно большой шаг вперед значит что у нас тут есть у нас есть тут в и льюс ямал передаем значение в template а его вылью мы можем сказать например что это у нас опыт shift или это у нас я не знаю кубер нить из или в вылез мы можем например перечислить пароли прямо это не хорошо конечно но мы можем это сделать а значит дальше мы можем в значит что у нас еще есть это у нас есть возможность использовать конфиг map да конфиг map это у нас тоже template в конфликт map мы можем передать специфические параметры для майский эля можем передать и на дебит бафа пол сайт например или мы можем посмотреть что-нибудь использовали темплейты мы можем посмотреть если у нас мониторинг и ней болт то для мониторинга мы можем специальным образом передать какие-то дополнительные параметры на самом деле здесь моим кучу всего в экстра пены значит как это работает это просто сильная файл да он записывается в специальное место на диске когда майский стартует он его соответственно могу увидят теперь что у нас тут есть значит у нас есть конфиг map ямал у нас есть секрет яма у нас есть street вал сет и у нас есть сервис это собственно тимплей ты который как мы видели мы можем использовать мы можем использовать в и льюс для того чтобы передавать значение в эти темплейты но самое интересное идет дальше у нас есть проблема курицы и яйца почему потому что например праксис кель чтобы сконфигурировать флаг сиски или надо его стартовать но контейнер докер-контейнер должен иметь готовый процесс у нас нет времени его конфликта конфигурировать до обычно как делается у нас есть какие-то конфигурационные файлы мы их об детям и дальше запускаем соответственно вижу дальше запускаем процесс в данном случае нам это не совсем подходит у нас есть прок сискель прокси если запускается после пикси и праксис киль должен тебя сконфигурировать сам что делать и нет контейнер сейчас расскажу про как мы это сделали сначала и потом расскажу про нет контейнер значит как мы это сделали сначала у нас есть пикси контейнер у нас есть здесь до тех файл докер der cnf и так далее значит докер файле мы прописываем entry point кто не знаком с докером все знакомо отлично прописанный entry point в entry point и мы должны собрать и опять же это про пикси да это не про праксис кель пока значит intel pointy мы должны собрать кластер чтобы собрать кластер мы должны знать кто у нас еще есть вокруг соответственно мы используем в данном случае есть много возможностей это сделать можно использовать эти сиди можно использовать все что угодно мы используем просто нативную dns кубер не tissot чтобы получить к ней доступ мы используем пир лист пир листа там маленькая программка нога у которой а значит получает список всех пирс которые есть и стартует программку то есть первый раз мы запустили ноду один но до 0 до у нас нету перс ничего нету запустили ноду один у нас появился один пир запустили но 2 у нас появилось 2 пер значит как это работает значит прежде всего мы запускаем пир лист мы говорим что он старт мы делаем configure конфига пикси это shell script shell script делает кучу разных вещей но кроме всего прочего получает наш список пирс и для пикси делает одну простую вещь он записывает этит список пьер специальную к информационному переменную пикси соответственно если у нас ничего нету то эта переменная будет иметь пустую строку пепси работает так что если у него есть наши кластер адрес в нем ничего нету то он разрешает connect с любых кустов это называется быстро соответственно если у нас ничего нету то он разрешит каналец других холстов и любой другой хост сможет подключиться дальше если у него уже что то есть он нам запишет в этот кластер аиде список того что у нас есть собственно и все таким образом мы за счет того что у нас есть стоит full set который стартует ноду одну с другой и за счет того что у нас есть вот такая магия мы можем получить собрать кластер практический достаточно быстро покажу значит опять же у нас есть entry point вентиль point мы делаем похожую вещь но немножко более хитрую значит у нас есть опять же еще раз у нас есть проблема с проблема курицы и яйца мы должны чтобы сконфигурировать сискель мы должны его запустить кроме того мы должны дождаться пока кластер соберется вот значит решение номер один это мы пишем вот такую функцию и от перс опять же используем пир лист запускаем и от кластер ноут опускаем его в background и запускаем процесс киль внутри этот кластер над мы значит ждем пока прокси стартует и когда прокси стартует мы используем программу праксис келли обмен чтобы его скандалить и это на самом деле не очень хорошо достаточно выглядит достаточно плохо лишения номер два это и нет контейнер и нет контейнер это возможность запустить контейнер который что-то сделает вначале потом за shadow нет наше приложение и запустить наше приложение уже на уже сконфигурированы и нет контейнер с мы можем вставить в стритбол сет ямал и соответственно мы можем прямо запускать команды то есть в данном случае вот в данном примере я вообще использую просто бизе бокс вижу пять минут используй обе xbox и соответственно если у нас есть тело с то мы копируем эти самые ключи тело мы можем делать все что угодно здесь соответственно что произойдет и нет контейнер запустится он запустит контейнер сделай то что нужно этот контейнер будет убит и дальше у нас пойдёт основные контейнер основные контейнер пойдет на том же диске так что все что было сделано и нет контейнером останется то есть вот такая магия получается что дальше мы у нас есть а мы планируем сейчас использовать операторы я к сожалению сейчас не могу ничего сказать про операторы но на самом деле надеюсь что на следующей конференции я уже буду рассказывать про операторы использования операторов для майский in крипторы то есть дата и трест encryption это еще одна интересная штука и менеджмент ключей мы выпустили такие альфа-версию оператора так что если вам всем интересно то это можно можно ее использовать но не в продакшене а это собственного дополнительные ресурсы как другие компании много работы сейчас гигантской интерес конечно к этой теме и другие компании работают на до тех ниш самыми ресурсами есть or call вы использовать майский оператор прислав выпустил недавно оператор мария тебе выпустила хилом и есть другие еще варианты к сожалению похоже что у меня нету времени сделать дома но если кому-нибудь интересно то может ко мне подойти и я могу все показать большое спасибо есть вопросы все очень здорово и как-то я тоже запускал в кубе кластере как раз класс стр галера а вот стоит вопрос до 8 сейчас мы используем вот он выезжает та же база данных и тот же самый пейном не справляется с мониторингом свопа и и а ну потому что он радостно не видит ход систему здесь как вообще это будет решаться на то есть тоже нужно контролировать важные параметры и слаб и и и а да это хороший вопрос я боюсь что я так не могу на это ответить значит спм вам у нас какая есть была проблема быстро расскажу значит пмм это мониторинг это мониторинг в том числе майский роман gdb значит спина у нас была проблема мы собственно это работает как у нас есть одни админ м.м. админ и это собственно говоря агент который работает на том же посте соответственно он посылает метрики используя prometheus и соответственно нас есть графа на дашборд который их все показывает с правительством с версии 1 была куча разных проблем мы сейчас перешли на версию 2 я не знаю какую версию используете pmma последнюю или нет не последний но вот так что нас было было много проблем с этим про миссию сам и соответственно мы над этим работаем чтобы это соответственно починить по поводу а ей своп я так понимаю что проблема власа самим пимом сервером и леонид нет но в принципе показатель вы сможете мониторить только на host this theory в без системе ну в контейнер и вы не сможете не только а я понял об осе изменять вопросов да это вот кстати вот хороший вопрос это мы думали про это потому что у кибернетикой же есть экспорт метрик из соответственно в каберне tissot которым мы можем здесь использовать мы пока этого не не делали мы вот тут думали про это если бы из если использовать экспорт метрик которые уже есть в кубер найтись и и соответственно их посылать в нашу графа ну да вот это было бы конечно хорошо но у нас есть только доступ внутри контейнера не понял хорошо хоть до александр пасибо за накладываю интересно было скажите пожалуйста на ваш взгляд каких случаях не нужно мыс quelle пихать все-таки губернатора рядышком парочку машин по классике да вот хороший вопрос на самом деле потому что пока я считаю что если у нас микро сервисы да то это хорошо вот у нас есть какие-нибудь мы красимся которые там тепло ются вы там есть приложением и тепло и майский и в этот мастер может быть там используется на может 12 там есть 100 запросов минуту до или что-то еще это для кубер напиться пойдет отлично если уже у нас есть один массивный гигантский майский и мы попытаемся запихнуть в губер на час и у нас и так уже есть там 10 тысяч запросов в секунду и 10 терабайт данных а моего еще губер найти записывать запихиваем да я не думаю что это хорошая то есть вот если у нас большой майский массивный да и он обслуживает куча разных приложений то я бы не стал бы его куда то есть это как бы по наитию по ощущениям или вот прям правило что если есть нагрузка данных много все забудьте не надо дело в том что на этот вопрос пока пока похожие ответы нету вот сейчас вот каждый делает свое да и как бы таких вот best practices я думаю просто сейчас не существует вот мое мнение с как бы из моего опыта это вот такое вот спасибо георгий спасибо за код скажите когда у вас одна нота падает ну то есть она умирает вы автоматом поднимайте новую да вот к сожалению я я бы показал бы дыму а ну вот значит что происходит если у нас у нас есть две конкурирующие системы 1 по система это то что у кубер нить из и есть возможность автоматически поднять но туда то естественно мы убили контейнер так оберните сатурн оды подымет кроме этого у нас есть три ноты и мы можем использовать любую из них соответственно мы можем использовать прокси эскель для того чтобы соответственно зоро учит трафик на другие ноты соответственно даже если мы и поднимем да ну через сколько времени может быть она там через 2 2 минуты поднимется или там поднимется на каком другом костях за это время праксис келли успеет переключиться я понимаю следующий вопрос а каким образом у вас уже или еще не реализовано добавление новые ноты в уже существующие работающий праксис кель да я увидел вас конфигурация столько на момент старта до сейчас рассказывать на секунду это очень хорошо вопрос пожалуйста вот значит что у нас здесь есть мы можем использовать скилл да и сказать что мы хотим увеличить количество реплик с трех до четырех назвали это не очень хороший пример потому что четыре реплики не должно быть должно быть там 57 что-нибудь значит что произойдет на у нас наша система под ним это еще одну ноту но до подключиться в кластер она подключиться в кластер потому что оно поднялось у нас соответственно запустится перш файндер сделать от кластером на вот найдет пирс поднимется подключиться в кластер дальше что произойдет на уровне праксис келли у прокси с келли есть собственно говоря с кириллов то есть в практически ель есть система такая как бы крон job который автоматически проверяет доступность разных нот и соответственно так как она проверяет доступность разных нот она увидит что у нас появилось новое но да потому что у нас рио есть она появилась в списке кластер а тима за она и и добавит она и и добавит в как риттер и соответственно у нас будет четыре ровно фича практически это фича которую мы конфигурируем да она встроена фича праксис келли мы используем специальный скрипт который собственно запускается и и тестируют внутри прокси и скелеты стены канады я потом более подробно скажем добрый вечер большое спасибо очень интересно я вам желаю успехов написания пирата честно меня пока возникло такое ощущение что решение достаточно сыровато и вот как бы вы меня не убедили потому что она обеспечивает безопасность и целостность данных покажем вот я правильно понял что у вас напились и только пока полежат снося на напились и ну на я имею ввиду то что вас настой аджику бернетт из олежа бэкапы да да да ведь получается что если у нас вдруг внезапно исчезли все инстансов который происходило запись дорна то мы потеряем какое-то количество давно если купер нить из вообще весь материал взял развалился любви у него какой нибудь там не знаю сплит brains да конечно будет естественно бэкапы нужно копировать на куда-нибудь там и на ис-3 это ты я уже немало просто имеются ввиду что backup ум не отражает актуальное состояние возможно по какой-то степени значит на самом деле это очень хороший вопрос да про consistent надо дают наверно и тем более смотрите в развитии то госту извините прибив купер не то сможет сам по себе взгляд режиме работы дистанция у нас такая это надо ушло там на нее сервис какой-то запущен но он не знает о том что есть ваку в остальные работающие ноты до продажи с таким сталкивались значит консистентной данных она обеспечивается не кубер найти сам в данном случае она обеспечивается майский элем данном случае она обеспечивается галерей у нас есть галера кластер версии которая соответственно ответственна за то что у нас на всех трех нотах одинаковые данные допустим у нас есть какой-нибудь конфликт или кто-то что-то сделал плохое s1 is not у нас пришел запрос с но до 1 на 0 2 этот запрос не может выполнится на ноги 2 потому что там таблицы нету что произойдет но 2 и и галера убьет вообще автоматически она ее убьет после этого она соответственно сотрет все данные стартует и и когда на ее стартует она подключиться к кластеру запросит бэкап делается бэкап и соответственно это надо поднимется то есть с точки зрения консистенции данных пикси отличный с точки зрения производительности может быть и нет да а отличный вопрос нет не совсем так во первых поэтому в том числе и поэтому у нас есть три ноты до почему у нас три но то есть обязательно нужно хотя бы три ноты потому что это кворум до network professional не то что вот говорилось на предыдущем докладе значит у нас есть три ноты дальше 1 но да у нас выходит из строя одна но да у нас донор и 1 надо полностью доступна дальше донор не на то что дон но до донор это не значит что она недоступна экстра backup который используется он нам блоки то есть единственное что будет недоступна самом конце бы копания будет сделать all the people это единственное что значит он будет то есть конечно oops да увеличится но но да будет доступна для чтения и записи так далее то есть если у нас три ноты то у нас есть хорошая harville билете случае если вопросов нет больше нет то мы закончим и благодарим вас за прекрасные выступления спасибо"
}