{
  "video_id": "w75P9RrVgKg",
  "channel": "HighLoadChannel",
  "title": "Aсинхронный PHP / Антон Шабовта (Onliner)",
  "views": 8477,
  "duration": 3088,
  "published": "2020-07-17T06:47:25-07:00",
  "text": "всем привет вот антон я разработчик этого русской кампании onliner предыстория очень странный пичкали разработчиков я всегда печки пытался делать такие штуки которые которые меня слышно редко делают на нем но делать их можно и даже от этого есть польза сегодня я хочу поговорить про синхронный печки одна из таких вещей которых я очень интересуюсь прежде чем мы начнем давайте введём несколько определений я долго пытался найти точное такое научное сформулированное определение асинхронной операции и асинхронности как таковой я их не нашел мне пришлось написать свои собственно что такой асинхронность это способность нашей системы не блокировать основной поток выполнения и синхронная операция тогда это что-то что такая операция которая не будет соответственно блокировать поток вроде несложно но если у нас какие-то операции блокируют давайте сначала найдем какие действительно блокируют все помню что пичкает интерпретатор идет построчно по нашему коду каждый код каждую строчку кода копны интерпретирует переводит какие-то свои инструкции и выполняют на какой строчки собственно наш код заблокируется и что будет блокирующий операции если мы работаем с каким-то бэкон экшеном до нас есть какой-то менеджер который обновляет например пользователя в определенный момент мы заблокируем сезон 1 sim и на пределе на строчки когда нас идет запрос сказки или серверу почему это происходит потому что печки не знает как долго вы теперь будет обрабатывать от запрос не знает вообще вы полны салютов заправиться вдруг там нас скоро сервер упал с ошибкой и он ждет ответа он ждет ответа от сервера и все это время как бы программа остановлена и не выполняется дальше с этим есть конечно же проблема запросы могут выполняться очень долго то есть если у нас какой-то простой апдейт до это так мелина на секунды есть запросы которые выполняются несколько секунд есть запрос которые выполняются и минуты и все это время наш киеве будет простаивать это не очень круто хотелось бы как-то по-другому сделать когда еще будут простаивать печки ну естественно на всех его операциях будь то файловая система работа с базами данных где окон еще одна треть из экспаншен любые почти все старшины которые мы имеем для подключения баз данных будут работать по умолчанию блокирующим режиме естественно работу с процессами так как это все построено через все сколы это блокирующий операции на работу с нашими стабилен и дауд и еще один категория того когда мы будем блокироваться это таймер когда мы явно говорим по току уснуть на некоторое время но пик пик язык общего назначения да у нас уже не 97 год и у нас не типичный fly который был только для веба поэтому мы можем написать асинхронный сколько лет сами с нуля задача не самая тривиальная достаточно сложно сделать но можно что такое клиент должен подключиться к нашему стилю серверу перевести работу соки право не блокирующий режим запаковать как-то бинарные данные понятны sql серверу и собственно записать и кусок так как socket будет не блокирующим режиме то запись для на спички пройдет быстро но что мы сможем вернуть как результат такой операции но пока непонятно потому что мы не знаем к что нам screensaver ответят вдруг он упал с ошибкой или мы не знаем когда он ответит он может выполнять наш запрос очень долго что тоже вернуть надо но все помню что если мы используем видео и если мы вызываем какой-то апдейт на искре сервере нам возвращается аффект страус на количество собственно затронутых строк этим запросам и там и вернуть пока не можем поэтому мы можем пообещать что это вернется концепция promise это концепция из мира синхронного программирования и она представляет собой по сути какой-то объект обертку над результатом асинхронной операции к сожалению какого-то единого стандарта promise не существует есть некоторые стандартные из мира java-script но естественно принести их пички напрямую не получается как работает вообще promise так как результаты еще нет мы можем установить только какие-то калмыки которые нам скажут что когда данные появятся то надо их выполнить если же произойдет ошибка при золы пробиться то нам надо выполнить какой-то callback для ошибки все достаточно просто если посмотреть на интерфейс promise а то он будет выглядеть приблизительно так есть отличие есть реакции методы могут естеств называться немножко по-другому либо вместо отдельных методов для установления кол баков для рисованного или джек там может быть какой-то один так например н кличке делает но основное чтобы пробиться есть статус есть метод для установки кубиков и какие-то методы собственно для заполнения про метаданными либо ошибка очень часто методы для заполнения резонов reject их выносит в отдельный объект deferred его можно рассматривать как некоторую фабрику для a promise одноразовый то есть один берет на один прогноз соответственно издав рады мы можем получить promise зарисовывать и за rejects так нам это применить успел нашем клиенте и если вы вдруг решили все-таки сами его описать но мы создали просто в начале сделали всю нашу работу соки тогда записали данные сформировали бинарные и вернули просто promise все все очень просто когда у нас кроме съесть соответственно снаружи мы можем поставить какие-то калмыки и уже получить например тот те самые а фиксит роуз которые нам возвращает от видеокодека либо как-то обработать ошибку за лагерь rotelli попытаться заново выполнить запрос если у нас сквер сервер ответил ошибкой остается один вопрос вроде кабаки поставили круто а кто будет вызывать в 5 reasons i reject существует концепция даже я бы сказал паттерн ивенту цикл событий это такая штука которая умеет обрабатывать какие то сообщения в асинхронной среде для асинхронного от его если мы говорили о днем-то такими сообщениями будут сообщения от вас о том что у нас какой-то socket готов к чтению либо записи давайте посмотрим как это все будет происходить наш клиент сообщает и в antutu что его интересует какой-то socket и вот лук начинает опрашивать с через системный вызов стрим select о том готов ли этот socket записались ли вода полностью все данные либо пришли ли туда данные с другой стороны у вас можно сказать что нет 105 еще не готов он еще заблокирован и event log соответственно повторить цикл как только он скажет что socket готов данные пришли либо полностью записаны и вот лук вернет управления в наш клиент и мы соответственно сможем разрисовывать наши прописи этими данными если выразить эту концепцию в коде простейшем случае убрав обработку ошибок много много всяких нюансов то на самом деле в сухом остатке нас останется один бесконечный цикл которая на каждом проходит спрашивает всё готовых качению соки так для записи готовых сокетах чтению и готовых часов и так записи и соответственно вызывает столбики которые нужны для конкретного соки дополняя наш клиент мы когда создали наш десерт теперь можем сказать event лупу что как только socket с которым мы работают будет готов данные в него придут от sql server а то нам надо наш deferred разрисовывать этими данными естественно в реальном коде там все немножечко сложнее концерт я надеюсь есть окей имен клуб имеет обрабатывать наши какие-то его работы с сокетами что еще он может делать если кто-то пишет на джесс я думаю все так или иначе сталкивались все помнят что есть такие штуки как все тайм-аут от интервал то есть мы можем сказать что типа выполнить этот код пожалуйста через какое-то время либо повторяйте этот код через каждый секунд это называется таймеры и так как наш ивент руб бегать бесконечном цикле он также может отслеживать таймер и их для нас вызывать еще важный момент что i want лупу часто обрабатывают сигналы это какие-то сигналы от с это те самые наши любимые process control и очень часто это полезно использовать написать иван клуб самому можно и я бы даже сказал нужно если вы хотите работать chrome тычки написать какую-то простую реализацию свою чтобы понять как это работает это очень важно но продакшин коде естественным это использовать не будем и будем использовать какие-то готовые реализации которые уже есть которые стабильные выгодное плане ошибок и работы на данный момент существует 3 основных таких реализации это react печки самый старый проект он начинался еще спичкой 53 сейчас у них минимальная требуемая версия пичкали 538 в плане работы с процессами они реализуют стандарт про miss a standard тоже из мира джесс вторую реализацию которую использовали и предпочитаю использовать именно я это а м . они требуют минимум по 70 из следующих версий будут требовать h7 3 так что для кого то это может стать блокирующим вопросам они используют к рутины наверх promise of что такое мы сейчас поговорим и есть еще очень интересная разработка называется с воли то китайский фреймворк ребята делают очень прикольную штуку они пытаются соединить точнее даже не соединится скорее привнести какие-то концепции из мира go в печке но с ним есть много вопросов в том плане что документация сейчас уже да есть на английском но она неполная большая часть и существенно гитхабе на китайском и если вы конечно знаете китайские то вперед с его важно использовать мне пока например его использовать немножко страшно ok давайте посмотрим как бы выглядел клиент для ряд печки для нашего сквере на самом деле все почти так же как мы написали мы создаем какой-то connection выполняем запрос и можем установить callback для обработки результатов нашей страус вернуть либо call back для обработки ошибок все очень просто но из этих кубиков можно строить длинные длинные цепочки потому что каждый результат цена вряд пи пи возвращает также promise и в принципе это решение проблемы который называется callback и сожалению в реализации по крайней мере в печке это приводит другой проблеме который называется уже проехал чтобы подключиться к рыбе intel например к череде муки п создать там connection подключиться к очереди заменится на кой ты качаешь все это сделать корректно с обработка ошибок нам надо создать где-то 10 кубиков по моему 11 даже но ебашить такой код и работать с таким кодом достаточно сложно я как бы очень быстро от этого ушел и понял что это не мой грят у нас есть другой проект который продвигает немножко другую концепцию это м печки проект младше чем react но соответственно он использует очень крутую штуку которая называется к рутина если посмотреть как происходит работа с мы склеили мы вмтп то мы увидим что это почти также как мы работаем со ска или в нашем видео connection мы создаем какой-то подключаемся выполняем запрос мы можем обрабатывать ошибки через строке нам не нужны никакие калмыки единственное что у нас появляется это ключевое слово ел передала синхронными вызовом кто помнит что такое вообще ел спички и есть да а кто не public ясно хорошо я делает нашу функцию генератора как только интерпретатор печки встречает ключевое слово ел в телек ниц и он понимает что это функция генератор и принял ее выполнение она не выполнится создастся специальный объект класса генератор что мы можем сделать с нашими генератором ну если по заглянуть внутрь мы узнаем что генератор элементе интерфейс итератора мы соответственно можем пробежаться циклами по ним фаре чем файлом но что более интересно литературе есть методы карантин next и мы можем пройтись по нему пошагово сами если мы запустим нашу функцию выполним генератор corrente нам вернется то что там выбросил наш аккаунт как только мы сделаем генератор next to внутри генератора код придет к следующему вызову yelp и весь участок кода между двумя вот этими ягодами он соответственно выкинет выполнить и это очень круто продолжая раскручивает генераторы мы получим такой какой то результат для данного случая что более важно кроме того что генератор применить этот интерфейс императором него есть еще две замечательная возможность это возможность снаружи отправить данный генератор и как только генераторы появляется такая возможность он уже становится не совсем генератором а к рутины со программой если кому то интересно русский вариант более приятен я буду использовать английскую кальку как более понятна большинству что интересно в данном участке коды то что наш файл true он не заблокирует нам весь код да он выполняется один раз мы сделали с получили в ялте halo сделали следующий цент получились бич тираж в принципе я думаю понять кроме того что мы можем отправлять данные в генератор можно отправить еще и ошибку и соответственно изнутри и как-то обработать что очень удобно подытоживая что такое картина это какой-то компонент программы который поддерживает установку и который помнит свой стек вызовов помнит какие данные прыг у него внутри и соответственно может их использовать дальнейшем если посмотреть сейчас на трофей со генераторов promise of the они выглядят ну за исключением разных названий методов одинаково совершенно мы можем отправить данные генератор мы можем отправить данные в promise мы можем выкинуть ошибку генератор мы можем выкинуть ошибку в пробить можем как-то это вообще использовать но оказывается что можем мы можем написать какую-то свою функцию которая будет брать у генератора текущее значение я тут немножко утрирую конечно да мы должны проверить что текущее значение которое нам вернулась это какой-то instance of promise но если это так что мы соответственно можем ему задать колобок который внутри отправить данные обратно в генератор когда promise будет разрезала и запустить следующий цикл опять же эту функцию рекорд то же самое мы можем провернуть с ошибками если у нас promise возразил с ошибкой нас там screensaver сказал по мере connections например то мы можем эту ошибку выкинуть внутри генератора и перейти на следующий цикл все это подводит нас к очень важному понятию которая называется кооперативную многозадачность я не знаю как вас но у меня редко встречаются такие простые методы в работе когда намного только с 1 bdr например работать чаще всего в процессе обновления например пользователя надо обновить там данные вбд обновить данные в поисковом яндексе потом еще как-то почистить или обновить кеш потом еще наверное 15 сообщений в раббит intel отправить и это все выглядит в печке как-то так мы выполняем каждую операцию одну за одной сначала обновили базу потом и яндекс потом кэш и на самом деле если приглядеться зная что печь при по умолчанию блокируют на таких операциях на ее операциях то все это выглядит на таймлайне приблизительно вот так серой части это там темы заблокировались и на самом деле эти части они занимают больше всего времени если мы работаем в асинхронном режиме то у нас этих частей нет ведь у нас timeline такое разрыве ст и соответственно мы можем это все склеить и выполнять наши кусочки один за одним для чего все это если глянуть на размер timeline of the здесь он занимает огромное количество времени но как только мы склеиваем мы можем очень сильно ускорить наше приложение и это замечательно сама концепция event лук и кооперативный многозадачности она не нова она применяется уже очень давно применяется в различных приложениях частности nx not мкс трэвис флаттер их если кто то знает все они используют внутри себя иван клуб и построено на этом же принципе и раз уж мы начали говорить про джинкс и но джесс этом сервере все помнит то давайте вспомним вообще как у нас происходит обработка запроса в печке наш браузер отправляет какой-то запрос попадает managing сервер за которого стоит какой-то пул fpm потоков один из потоков заберет в работу этот запрос подключает наш код и начинает выполняться все очень просто когда приходит следующий запрос соответственно другой поток его fpm заберет опять же подключить код будет выполняться количество vpn worker of как все знают ограничено мы не можем запустить их бесконечно можно запустить только определенные если у нас например 50 м маркеров на сервере то как только придет 51 запрос он будет ждать пока один из маркеров свободиться в этой схеме работы есть достаточно плюсов нам не надо как-то сложно обрабатывать ошибки если у нас один из запросов отвалился упал умер что-то пошло не так мы просто можем даже ничего не делать но ничего придет следующий запрос это никак не повлияет на его работу более того нам даже не надо думать про память нам не надо думать как чистить нам не надо следить как бы за памятью если где-то что-то течет ну ничего потекло ну на следующем запросе все равно вся память почиститься это крутая схема и она работала как бы пички самого начала и работает до сих пор и работает очень успешно иначе мы здесь все сегодня не собирались но в ней есть несколько и минус как я уже говорил количество супа маркеров у нас достаточно ограничено и поднять их там тысячу сто тысяч это нереально кроме того пока на шоу с переключает запросы между маркерами то операция на уровне процесс называется контекст вич и это достаточно дорогая операция на выполняется огромное количество актов не буду врать сколько сейчас не помню но долго потому что надо сохранить все регистры надо заполнить сохранить так вызовов все что у нас там процессоре есть потом переключиться на другой процесс загрузить его регистры его стек вызовов опять торчит а выполнить опять переключиться опять сохранить это долго мы можем подойти к этому по-другому мы можем написать http-сервер на самом печки раз мы уже научились не блокирующим режиме работы с сокетами http connection to будет такой же socket то соответственно можно сделать как он будет выглядеть и как он будет работать это примеру в стартапе серверов фреймворке м . тут все достаточно просто мы строим наш какой-то applications я хочу сказать что это может быть там симфония равиль апликэйшен на не совсем верно так как внутри они будут блокировать но да можно и так взъелся потом мы создаем какой-то пул сокетов может быть один может быть несколько запускаем наш сервер устанавливаем какой-то хендлер который будет выполняться на каждый запрос и соответственно передавать или запрос нашему причинам дабы получить ответ и последнее что нам надо сделать собственно запустить сервер в ряд печки это будет все выглядеть приблизительно так же но только там будет 150 ккал быков на разные варианты не очень удобный с этим подходом с http сервера мы сообщаться синхронностью в печке есть несколько проблем первое и для меня достаточно важно это то что у нас нет никаких стандартов каждый фреймворк мтс воли react вич и реализует какой-то свой интерфейс прописав они несовместимы а им пищу еда может теоретически резолвится react печь пышные promise и но как бы есть нюанс нюансы с тем что если код для ряд кличке написано не очень хорошо и он где-то явно там дергай клуб или создает то у нас получится так что у нас 2 м клуб покрутиться внутри это конечно такая себе ситуация есть также стандарт про мясо плюс которые реализуют газу клиент всем известны для карла точнее клиент лишь теперь и они используют джесс узкую реализацию пробиться плюс это хоть какой-то стандарт и было бы на самом деле как по мне очень хорошо чтобы фреймворке пытались ему слез следовать но такого нет к сожалению пока нет вторая проблема это утечки памяти как я говорил если мы работаем в обычном php-fpm режиме мы про память можем не думать поставили какой-то там сторонник смешно спасла и там где-то люди забыли написать хороший код забыли про гарцевал гринт и там где-то внутри что-то течет ну что насчет счет последующем запросе почиститься начнется заново клёво если мы работаем в асинхронном режиме то такое себе позволить нельзя потому что рано или поздно мы просто упадем south of memory card что-либо жить это все бывает достаточно сложно и больно но возможно мы используем в каких-то случаях и где бак для этого в каких-то случаях экспорте stralis для разбора какие-то фанатов вызванную в мире и с этим есть проблемы решают второе что важно если мы пишем синхронный какой-то код нам жизненно важно не блокировать де бонт луп только мы блокируем мы замедляем все приложение каждая из наших картинок начинает работать медленнее чтобы найти такие операции для м печки есть пакет лук блок который делает очень простую штук он просто выставляет таймер на какой-то очень маленький интервал если вдруг тайлер за этот интервал не срабатывает но значит мы где-то там заблокировались он помогает в поиске таких блокирующих мест но не всегда честно не всегда если блокируется где-то внутри кого-то extension а мы это можем даже не увидеть и наверное самый важный момент все и основная проблема всего странного . это поддержка библиотек мы не можем использовать всем привычные педагог an action редиска дальше привычные драйверы которые мы там без вот он стал кто-то и вроде все работает круто нам нужны реализации не блокирующие и соответственно писать их надо тоже на печке в не блокирующим режиме потому что хищные драйверы очень редко предоставляет какие-то интерфейсы которые мы можем интегрировать во синхронный код для меня в этом плане стал наверно самый странный опыт это драйвер для бдк сандра они предоставляют операции языку to sing get to sing и прочее но не возвращают при этом объект фьючер с единственным методом get которые блокируют ну то есть вроде как у нас есть возможность что-то получить огромную но чтобы дождаться результата мы все равно заблокируем весь наш лук сделать это как-то по-другому можете сделать через кабуки там не получается я в этом плане даже написать свой клиент для кассандры что мы используем работе еще одна проблема это проблема не самого скромного печки скорее проблема а м php и картин того как мы используем это что мы сможем зато похитить наши картинах мы помним да что если у нас функцией встречается слово ел то функция становится генератором и в этот момент мы уже никак не можем зато и квинси что она вернет нам какого-то объекта юзера не генератор пожалуйста а юзер нельзя можно 72 по моему да можно даже terrible зато hansen ну не то чтобы это сильно нам поможет окей что нас ждет печкой 8 подробно про это сегодня расскажет дима я пока какие-то свои догадки и свои хотелки store тоже есть шансы есть ребята которые работают над тем чтобы внести иван клуб в каком-то виде в ядро если это произойдет то у нас появится функция и weight как в джерси как все sharpie если кто-то работает который позволит нам дождаться в определенном месте результат асинхронной операции и при этом нам не нужны будут уже никакие extensions все будет работать на уровне ядра асинхронно это круто второе что возможно нас ждет это дженерики все же generique в год ждут generique мы ждем дженерики мне всегда странно когда говорят о том что мы ждем дженерики для коллекции я хочу посетить что эта коллекция юзеров коллекция юзеров это не боль ну типа это не сложно проверить а вот то что у меня promise развиваться именно в объект юзера вот вот это для чего нужна дженерики спичкой ок ней это все круто остается основной вопрос зачем вообще все это зачем всем этим заниматься если есть только проблем столько нюансов есть проблем на которой общей можем решить ради скорости это все к вопросу перфомансе печь перед атакой язык где большую часть операции это операции это и a bound какие-то штуки моего редко делаем кopoлeм bound код мы редко делаем код который там значительно завязано какие-то вычисления на процессоре скорее всего у нас это работа соки , надо в банско входить прочитают что-то вернуть ответит потом файлик там куда-нибудь или до путь и асинхронность она позволяет очень сильно ускорить этот код на тысячу запросов посмотреть средние время ответов мы можем ускориться где-то 8 раз если мы говорим о десяти тысячах запросов там ускорения где-то в шесть раз будет одновременные запросы под яндекс танк собственно все спасибо спасибо антон кто-то вопрос поднимайте руки вам подойдет татьяна или алина и с микрофоном ведется запись поэтому обязательно задавайте вопросы микрофон чтобы его услышали те кто будут смотреть запись пока у нас есть вопрос от лично спасибо большое за доклад меня зовут павел я хотел спросить следующие вещи когда вы указывали мир это не я есть да да простите когда был пример о том что мы можем параллельно писать в базу обновлять яндекс и сбрасывать кеш по большому счету нам же эти операции нужны друг за другом на самом деле то есть нам нет смысла сбрасывать кеш или обновлять поисковый индекс вместе с базой потому что запрос возможет не пройти и тогда нам все это не потребуется вот и само длительность вот этой операции она по времени займет столько же сколько без асинхронности и по асинхронности получается мы здесь выигрываем только в том что hp как бы снова свободен для других запросов и позволяет нам еще чаще бомбить базу вот такими вот запросами которые на самом деле будут выполняться то же самое время я надеюсь все понятно за вопрос такой но мне кажется да что вопрос едем слышал вы скорее утвердительно сказали и да это будет именно так и если идет вопрос только о том что вы последовательно там выполнить то асинхронность ну мы можем если нам плевать что если вдруг там например не обновился индекс поисковой да и кэш окей мы сделаем например синхронно один запрос сначала для обновления данных базу а потом есть несколько операций которые мы бы хотели сделать но если вдруг они там одна из них не пройдет у нас не очень важно и тогда мы можем здесь сделать как бы параллельно асинхронно есть ситуации когда например надо обновить сразу там 10 запросов москве отправить тогда опять же мы можем их выполнить сифонной тут будет такая же ситуация просто будет дтп s1 до s2 ps3 и как вы правильно заметили что самое важное это когда все у нас полностью внутри работают асинхронно работает поверх асинхронного http сервера то да пока у нас вот эти вот промежутке пробелы пока мы ждем ответа от б д ответа от редиса мы можем принимать уже следующий http-запрос это же начинать его как-то запускать я понял спасибо так есть пример когда вот с помощью вашего а м печки нам нужно там что-то подождать или за это руки ел все что нам надо же сделать чтобы дождаться что-то это перед результатом пробиться на что-то возвращает объект пробиться мы просто делаем build все верну числа это чтобы вопрос по рт был если мы хотим что-то синхронно сделать в этом году ну да в общем я не по-дурацки задал свой вопрос синхронно смысле нет я имел ввиду как будет выглядеть именно реализацию этого момента где кэш должен почиститься строго после обновления базы и индекс должен обновиться строго после обновления базы вот вариант просто перед каждой операции будет стоять ел хелп хелп нас генератор на в нашу функцию которая обрабатывает выкинет сначала один promise дождется когда придут данные в этот пробиться запустится 2 дождется которого запустится 3 мы можем объединить то все можно щелкнуть своим печке можно выкинуть через ел сразу массив процессов и тогда он будет ждать их все то есть как только все завершатся он вернет управление функцию можно возвращать по одному то есть перед каждым вот здесь перед каждым вызовом будет собственно ел все понятно спасибо меня зовут михаил спасибо большое за лекции очень интересно было вопрос такой у военных летчиков есть принцип выстрелил и забыл то есть какие-то полетела ты можешь у тебя уже могут уже сбить на твою как это собьет цель вот что произойдет если и вот я сделал первый database or do it или же ты конечно пошло сведение соки том что то пошло поехало а потом бах и печкой процесс вдруг по какой-то причине что придет с данными которые я вроде как уже отправил нужно ли их дожидаться ну а как вы их дождетесь и процесс уже сдох вот поэтому не проще ли как решение возможно полно синхронно это использовать тот же самый любит им киву закидал мастерами это все-таки бывает быстрее чем закидывать базу данных людей там и тогда тоже можешь сдохнуть любой процесс спокойненько там уже работает все это я вышла вы просто когда я кому-то рассказываю про асинхронного печки это вот вопрос который всегда звучит честно типа давайте просто закинем в ребят и она там где-то потом поднимется обрабатывается может вообще на другом сервере и да ребят это отличная штука и она позволяет решать какие-то вопросы там консистентные в том плане что если у нас внутри там что-то потом упала мы можем перри поднять и сделал повторить операцию асинхронность она не про повторение операции если вдруг что-то пошло не так она про то что если говорим о рыбе thank you все наверное используют php make полип он там может сообщение кво через закинуть по моему что там 2000 3000 в секунду мой асинхронный клиент для муки п может отправить шестьдесят сто тысяч сообщений в секунду это порядок цифр цифра сейчас немножко из головы но он приблизительно такой то есть facing раньше на это про производительность это про то что мы можем намного быстрее выполнять какие-то операции я ответил на вопрос или нет как так кивните но если процесс долг у вас будет точно такая же ситуация и в синхронном варианте вы могли записать в базу до попытаться отправить в рыбе и он в этот момент сдох окей но это с этим ничего не сделаешь если мы говорим о том что там пришла уборщица и выдернула сервер из розетки то есть какие-то ситуации которые мы не сможем от через обработку ошибок через 3 выловить данные начинают улетать это не знаю возможно я не совсем донес эту мысль но когда мы запускаем синхронную операцию то данные начинают улетать независимости от того и напишем мы перед этим слова ел чтобы и дождаться то есть даже если бы здесь было просто написано полк вере-то все данные полетели в сквере мы просто не ждем ответа вопрос в обратную сторону то есть мы ему сказали делай когда мы говорим help мы говорим делай и дождись что что на мы склеили ответит на это добрый день я здесь похож я на протяжении доклада записывал проблемы в основном у меня получилось что у нас получить тяжелая отладка утечки памяти проблемой нативных библиотек отсутствие стандартов отсутствие там фитингов то есть мы теряем типизацию и у меня сложилось впечатление что проблем больше чем плюсов то есть да вы говорить о скорости но в тоже время мы знаем что у нас есть целый ряд языков которые работают быстро и нативно работают со синхронностью если смысл действительно операции делать это в php вместо того чтобы взять язык который предназначен для решения таких проблем и решить это там но возможно окей да если у вас есть разработчики которые могут написать этот странный кот на год например да который целиком и полностью заточен под асинхронность и они смогут это быстро сделать качественно и там это не вызывает у вас проблем туда возьмите год действительно это проще бы проблема есть проблем с хромом . очень много и они достаточно серьезные действительно но это не значит что нет из кейсов для его использования я могу привести пример из real life мой коллега он работает с системой документооборота очень крупный и она написана на печь певца бизнес-логика написанный на php и у них такой кейс что у них целый день система простаивает там один два запроса в минуту ну то есть вообще нет нагрузки а в 5 часов вечера все бухгалтеры по россии начинают резком выгружают документы и у него за минуту приходит топ 100 тысяч сообщений он пытался это решать через rapida в начале положите сообщение в ребят но все равно часть из них теряла что-то падало в итоге как бы взял и написал просто значит перед http до слоем асинхронный и у него при стала падать все сообщение внутри да точно также перекладываю rabbit но он уже не терял запрос и есть такие кейсы когда синхронный спички это единственное решение эти кейсы редки и если есть возможность написать склонность на другом языке доделаете я не говорю что это silver баррель в плане решением проблем performance спасибо мертва плохо видно я здесь спасибо за доклад скажи пожалуйста вот какие основные проблемы встречают на своем пути разработчик который встает на путь на пути асинхронности когда он приходит из синхронного мира и вторая часть вопроса какие проблемы видят перед собой проект когда его переводят на синхронные рельса спасибо давайте начнем с разработчиками когда я приходила в асинхронность для меня было сложно уловить концепцию крутит и на самом деле вот вся вот эта магия с ел дам это то что у нас вот здесь происходит в этом функции которые разворачивают наши генераторы это был основной проблем у меня в голове то есть я смог это решить тем что я сел и написал и в индексом простой очень вот как я показывал the wild rustream select и погнали спасибо никите кстати за отличную статью о том как вообще это все внутри как написать свой scheduler статейка есть и обязательно стоит почитать перед тем как входить во синхронный мир на тот момент по моему статьи ещё не было поэтому я просто сел и написал вот сам шидевер написал сам ивент лук и это поставило что-то в голове на правильные места я понял как это работает и после этого я уже смог писать что-то свое в плане проекта у меня не было опыта внедрения это уже существующий проект у меня был опыт написания с нуля проекта полностью синхронной схеме мы вначале пытались использовать тряпочки впоследствии перешли на м . и основная проблема для проекта это то что нет разработчиков которые умеют и знают это сразу найти такие кадры очень сложно таких людей мало и особенно их мало на постсоветском пространстве если мы берем волмарт там все проще и если очень много ребята которые используют активный react печки и м печки то очень стабильные проекты которые работают там месяцами там без перезагрузки вот в этом асинхронном режиме и никаких проблем вам не кажется что это не правильно называется синхронностью это просто конкуренции но не асинхронность в том виде в котором она существует в javascript и например почему поясните потому что чтобы запустить в м клуб у все равно ну допустим если я работал с козлом все равно называете white и блокируете свое исполнение просто параллельно выполняя несколько запросов то есть это не асинхронность с точки зрения архитектуры это просто одновременно исполнении нескольких запросов но я с вами не согласен во-первых внутри в джесси точно такой же иван клуб вот прям один в один и реализацию если там взять например но jest реализацию иван тупо из но джесс ребята вынесли в отдельную библиотеку за что ему большое спасибо называется на липу в и тот же а м peach и умеет если у нас установлено расширение для липу в он умеет его использовать то есть он уже не делает через три msi лет он использует у реализацию если pva и и бензинки это более стабильный вариант где то он быстрее но точно стабильнее чем через три msi лет особенно когда у нас большие нагрузки будут если вы говорите про газа the dark если вы используете синхронную столько там из того что предоставляет газа это все еще асинхронный а.ю. но это естественно не иван tube ну то есть там от немножко по-другому реализован спасибо за доклад вопрос такой раз морс рассмотрели рудольф разработчики первых версий печки какой-то момент в районе том 4 да такой комментарий что он разрабатывал печки как шаблонизатор и когда люди начали писать о шиндо три бизнес-логика а потом начать делать шаблонизатор для шаблонизатор он понял что он потерял контрольной ситуации и язык не были так как то что он планировал вопрос какая позиция core команды зонда по поводу асинхронных вариантов потому что это как бы концептуальный перелом и мультики там эры психика для дженериков некоторые того тоже хотел бы нам поддержки в ведре да я к сожалению не состою в кор команде зонда у нас вы есть сейчас на конференции присутствуют два человека можно их помучить потому какая официальная позиция по этому поводу но я знаю что есть люди испортим которые очень активно продвигают вопрос асинхронности и один из разработан ntp библиотеки также участвует в рпц участвует в голосовании что на мой взгляд как бы ну уже показывают что если вы приняли бы для участия в rfc разработчика то это важно и асинхронность это важная штука которую мы движемся раньше данном хватало еще туда помнит math.php да и apache потом нагрузки возросли ребята из компании буду придумали fpm который значительно все ускорил это такой же скачок когда-то даже math.php php-fpm вариантов просто перестанет хватать не говорю что это произойдет завтра но если у вас компания там объемом году то для вас вопрос нагрузок стоит очень жестко и асинхронную каких-то моментах не всегда во и с учетом всех нюансов не всегда это оправданное решение но она может дать огромный выигрыш в производительности спасибо спасибо друзья спасибо за каверзные вопросы антон тебе право выбрать самые лучшие вопросы подарить подарок книгу ров так сложновато наверно даже с выбором давайте наверное вот человеку где-то с помощью той стороны на счет ошибок и проблем проговорил ошибки и проблемы это обычно то что мы упускаем всем нравятся красивые графики большие цифры и и что это все круто но не часто мы думаем про то что и проблемы в этом в этом всем тоже есть и у нас небольшой подарок для тебя поблагодарим антона спасибо спасибо если вам понравилась та тема у нас еще шесть часов будет доклад об использовании коз вместе с пич и там тоже будет просим ровность очень интересно и следующий доклад у нас от никиты который собственно и разрабатывал к рутина вернее генераторы в печке это будет через 10 минут так что возвращайтесь"
}