{
  "video_id": "NXU7zULI-lA",
  "channel": "HighLoadChannel",
  "title": "Трансформеры в Такси: в нужное время — в нужном месте!/Артем Просветов, Эрнест Глухов (Яндекс Такси)",
  "views": 425,
  "duration": 1974,
  "published": "2023-01-19T06:59:52-08:00",
  "text": "итак я рад вас видеть на своем докладе спасибо что пришли послушать про трансформеры я надеюсь что вы на ней не ожидайте здесь услышать про оптимуса прайма или про мегатрона потому что речь будет совсем про другие трансформируете мы с моим коллегой эрнестом занимаемся m-elle модельками в яндекс к сожалению эрнест не смог сегодня присутствовать на докладе но я уверен он посмотрит это выступление в трансляции мы занимаемся поведенческими технологиями в область наших задач входит например сегментация подбору оптимальной коммуникации для различных клиентов оптимизация трат на привлечение удержания для решения всех этих задач нужны различные модели но при знаковое пространство в этих моделях очень схожи для подобных задач традиционно используется большое количество признаков которые регулярно считаются более нескольких сотен признаков считается на каждый заказ на каждую сессию таким образом что покрывается достаточно хорошее пространство свойств пользовательского поведения с другой стороны наша команда еще занимается поведением водителей это такие задачи как оптимизация нагрузки упреждения тока и этих задачах нам снова нужны признаки конечно мы эти и знаки также считаем и регулярно однако у них есть и плюсы и минусы каждый раз когда возникает новая задача мы под эту задачу должны проверить подходит ли текущее признаки заняться fitch инжиниринга если признаки не подходят нужно добавить что-то новое и естественно текущие признаки далеко не всегда отражают те свойства которые нужны в наших задачах признаков много конечно приходится делать фича selection и более того в некоторых задачах может получиться так что в признаки ненароком оказывается важная информация о таргете то есть возникает до толик поэтому нужно всегда очень аккуратно проверять какие признаки есть пользуются но у текущего подхода есть ряд хороших свойств все признаки легко интерпретируются и быстро считаются их можно показать менеджером и объяснить что означает тот или иной признак но это не единственный подход и естественно в современном мире активно в области работы с текстом в нлп и а также в компьютер режим используется mb денги для тех кто первый раз услышал это слово на самом деле нет ничего страшного embedding это по сути векторная форма сложного объекта и простой аналогия митинга может быть кодирование rgb если мы абстрагируемся того что каждое число rgb векторе относится к определенному каналу для построения митингов уже было разработано множество подходов множество рецептов известный во рту вверх и берд и подходы на основе не только текстов но и на основе графов типа ноту веке граф switch-ем понятно что нам хочется применить более современные методы в наших задачах для того чтобы поднять метрики качества для того чтобы их обобщить и мотивация у нас дополнительно есть если представить последовательность взаимодействие с клиентом последовательность взаимодействий с водителем то эту последовательность можно выразить в виде вектора и этот вектор будет отражать достаточно много свойств а последовательность векторов будет отражать все поведение объекта то есть мы переходим в пространство так сказать транзакций и таким образом можно работать не только с пользователями водителями это подход применим и в такси и в маркете и в еде но есть небольшая загвоздка в таком подходе важно передать информацию о времени поэтому последним компонентом в этом векторе мы фиксируем время между текущим событиям и следующим событием и так в подходе связанным с mb деньгами целый ряд плюсов агрегация признаков получается уже не линейная модель учиться выявлять скрытые покорность скрытые свойства в этих данных и такую форму очень легко использовать в других моделях то есть казалось бы все хорошо но есть нету явно интерпретации мб-1 гав mb денги сильно завязаны на version ность моделей с помощью которой они были получены и конечно требуется больше вычислений для них для того чтобы найти оптимальный способ извлечения maiden гав даже если мы определились конкретной архитектурой трансформеров все равно приходится провести ряд экспериментов и наш подход был следующим мы обучили модель sequence ту sequence то есть модель которая переводит последовательность викторов последовательность векторов здесь на изображении я уже перехожу к терминологии привычной в нлп и в области связанной с неровными сетями и эту последовательность называю последовательностью токенов каким-то образом извлекаем мы виктора из модели векторах обучаем классификатор под конкретную задачу замеряем качества и выбираем наилучший подход и самым наверно естественным путем будет излечением викингов из последнего слоя модели трансформера напомню тем кто только знакомится с этой темой что трансформер состоит классический трансформер состоит из n кодера и декодера это по сути две крупные части так вот мы можем усреднить последние вектор последний слой декодера и на этой информацией получить amway тенге по сути это то что предшествует выходу на taken и смотрите над чем мы будем обучать нашу модель мы будем обучать модель на прошлом таким образом чтобы она предсказывала будущее то есть модель будет смотреть на прошлый заказы такси и предсказывать будущее заказы такси из и в свойствами для каждого клиента другой вариант извлечения боингов основан на использовании специального taken a технического который добавляется в входящие последовательность токенов этот гель с таким такой подход хорошо себя зарекомендовал в нлп задача и еще один конкурентный подход взять последний слой из энкодера и усреднить то есть избавиться от декодера оставить только энкодер по сути это та форма которая сконденсировалась сеть информацию в ней для того чтобы в последующем декады рим перевести такими шагом в будущее теперь мы поговорили про то что у нас будет три варианта извлечением беден гав но как мы их будем тестировать понятно что метрики качества которые нам пока же трансформер в процессе обучения будут говорить только о том как хорошо он может предсказывать будущее поездки для клиентов но нам хочется получить универсальные признаки которые были бы полезны в различных задачах то есть нам нужно протестировать извлечение этих признаков в других прикладных задачах которые нам встречаются такие задачи могут быть например предсказание пола дохода предсказание core пользователей тарифа лучи мои детские а также предсказание новичков тарифа детские оказывается что все три подхода хорошо себя показывают в этих задачах понятно что задачи разные по сложности для классификаторов и предсказать core пользователей тариф одет и или ультимы намного проще чем предсказать новых пользователей тарифа детские почему потому что те кто катается уже в детском тарифе они будут кататься в детском скорее всего то есть это задача сама по себе более простая пол пользователя достаточно сложная задача но на что стоит обратить внимание самая простая архитектура в которой используется только энкодер во всех случаях показываете себя не хуже чем остальные архитектуры а часто даже чуть чуть лучше следовательно зачем использовать более сложные подхода если более простой подход дает наилучший результат поэтому мы остановились на нем другим способом протестировать mb денги является задача uplift моделирование такая задача возникает в тех случаях когда мы хотим раздать скидки например понятно что некоторые пользователи вас пользуются сервисом и без скидок и раздача и мсти так будет невыгодно для компании если мы от ранжируем пользователей в случайном порядке и первой половине из них раздадим скидки то мы получим линию которая на слайде обозначено зеленым цветом и вот зеленой стрелочкой как раз будет тот профит который мы от них получим то здесь не используется какого-то знания какой-то дополнительной информации о свойствах покупательской активности пользователей если мы начинаем использовать какую-то модель которая помогает отранжировать пользователей в нужном порядке для того что получить больше прибыли от них на основе признаков классических мы получаем ярко синюю линию и видим что случае если мы раздадим половине пользователей скидки уже в этом порядке от ранжированных у нас будет существенно больше прирост богиню здесь же можно посмотреть есть сравнения с моделью на основе мб-1 гав и оказывается что она еще сильнее чем модель на основе признаков это нас воодушевило и мы перешли к более сложному эксперименту мы решили попробовать модель на основе maiden гав в задаче определение новых пользователей тарифа детский этом на самом деле сложная задача то есть представляете что человек раньше не пользовался тарифам детский тут внезапно начинает им пользоваться и эту задачу можно решать например на уровне эвристик каких-то правил которые мы можем выделить и разработать и они будут работать лучше чем случайный сегмент признаки и классификатор на признаках даст конечно существенно больше качества и мы на 10 на 100 тысяч пользователей новичков обнаруживаем две тысячи действительно новых пользователей тарифа детски но mb денги дают еще больше скачок в качестве и их количество больше чем 3000 на 100 тысяч пользователей что также подтверждает универсальность и эффективность этого подхода обратимся к анализу значимости признаков и окажется что в этой задаче та модель которая обучалась чисто на признаках в первую очередь смотрела на то пользовался ли ранее пользователей тарифам детский конечно это может быть до толик и таким образом модель оказывается более слабой с другой стороны по имбилдингом мы видим распределение фича impotence более гладкая не выделяется ничего так сильно как там до толик на модели с признаками но конечно в топ попадают определенные компоненты вектора м боингов которые сложно интерпретировать обратимся к другой задачи возможно этот подход сработал хорошо на пользователях но на водителях он не сработает попробуем решить задачу оттока водителей то есть определить тех водителей которые перестанут кататься в ближайшем будущем и решил также эту задачу с помощью классических признаков и с помощью м викингов и окажется что mb денги без даже дополнительного тюнинга без попыток как-то оптимизировать улучшить и подтянуть модель дают качество уже больше чем качество модели на классических признаков если проанализировать фичи impotence в этой модели то окажется что на первое место выбивается в классических признаков информация о том что водитель катается в четверг почему-то это важная информация но когда мы поговорили с экспертами нам подтвердили что действительно водители любят этот день конечно с точки зрения maiden гав мы видим в топе признаков набор компонент который нам не дают какую-либо информацию о том насколько они адекватны и или насколько они хорошо помогают решить эту задачу но давайте запомним например вторую компоненту номер 84 и попробуем ее проинтерпретировать как можно интерпретировать компоненты вектора казалось бы задача не классическое нетривиальная часто в рамках решения такой задачи для токенов в анализе текстов используют attention маски но можно пойти и другим путем есть известный метод шепли он широко используется в интерпретацией классических моделей например на основе деревьев градиентного бустинга random forest а и так далее он основан на теории игр и позволяет рассмотреть каждый признак как игрока эти игроки как будто вы перетягивают канат и мы можем определить того игрока который перетянул на себя больше всего канал вот возьмем одного случайного водителя и возьмем компоненту вектор номер 84 и попробуем применить метод шепли оказывается у этого подхода есть дополнительная имплементация именно для интерпретации нейронных сетей которая основана не только на теории игр но и на интеграле градиентов по архитектуре нейронной сети и мы получаем карту значимости которое нам позволяет сказать что действительно сеть на что-то больше обращать внимание на что-то меньше вот здесь яркий квадратик на этой карте значимости относится к какому-то признаку этот признак относится к примерно 15 дню недели но что еще можно обратить внимание в доль одной из осей больше присутствуют количество ярких квадратиков это значит что на какую-то компоненту исходного вектора сырых данных трансформер обращает больше внимания и тут начинает играть свойства векторов replay у них есть свойство аддитивности мы их можем складывать это нам позволяет сложить все компоненты по времени и определить топ признак в исходных данных и вот например для компонента 84 которую мы только что сейчас увидели самый ярковыраженный признак который выделяется относится к информации о полному количеству сессии водителя в течение дня что в принципе логично для того чтобы определить отток вероятность оттока водителя действительно это должна быть одна из ключевой информацией для модели интересно что этот признак попадает в несколько компонент но карты этого признака для разных компонента относятся к разным дням более того некоторые компоненты обращают внимание например на статус водителя а также в топ признак самого главной компоненты попала информация о том какая доля поездок была совершена в вечернее время водителем тоже кажется вполне логично потому что вечернее время но востребована и выгодным для водителей если он пропускает это время то скорее всего он может уйти в отток эксперименты привели потому что мы удостоверились в том что подход рабочий подход даже интерпретируемый и мы уже внедрили их в продакшен стали активно использовать для пользователей для подбора коммуникации для сегментации что же делать также строится наша архитектура у нас есть одна модель которая извлекает им бединге строить виктора она обучается один раз в год и каждый месяц проводит inference на всех пользователей и и виктора если чон и фиксируется в хранилище обязательно ввести необходимо вести учет даты расчета векторов для того чтобы если будет на этих векторах строится модель она не заглядывала в будучи она смотрела только на нужную дату на таких векторах работают другие модели но что же делать если у нас модель меняется тогда нужно обучить новую модель и пересчитать исторические данные после того как мы пересчитаем виктора для исторических данных мы должны старой модели обучить на этих векторах используя старую разметку новый виктором будут работать на новых новой модели будут работать на новых векторов без проблем таким образом все функционирует достаточно гладко плавно перехожу к этому направлению в котором нам хочется далее развиваться нам хочется применять этот подход к другим объектам не только к водителям и клиентам этими объектами могут быть курьеры это могут быть различные виды транзакций тот вид кодирование признаков которые мы использовали он не является сильно замысловатым и особо сложными и сейчас уже есть другие подходы по переводу например табличных данных признаков в taken и хочется попробовать что-то и из этого направления возникает вопрос если мы решаем задачу например сегментацией с помощью embedding of трансформера почему бы не натренировать трансформер она как раз эту классификацию сразу на такую классификацию недостаточно обычно данных для того чтобы сразу к ней прийти но это может быть подход стиле feel sad или one shot йоник что тоже было бы интересно попробовать ну и трансформеры активно развиваются возникает изобретается множество хаков и приемов по работе с ними и конечно хочется попробовать и эти приемы для того чтобы поднять качество излечи извлекаемых викторов что мы могли бы обсудить какие выводы мы могли бы сделать на основе этого доклада во первых конечно устаревают не только данные и даже не только модели но и устаревают алгоритмы сейчас логистической регрессии уже никого не удивить сейчас в большинстве областей доминируют архитектуры нейронов в стиле трансформеров и вполне интересный будет вопрос что будет доминировать в следующий декаде подход который позволяет извлечь признаки из сырых данных на основе нейронных сетей хорошо себе показывает и в текстовой области и в компьютер vision также он себя хорошо показал и у нас в задачах в которых требуется поведенческие виктора метод шепли применим не только для классических моделей стиле кредитного бустинга или деревьев он применим и для нейронных сетей и показывает хорошие интерпретируемые результаты ну и конечно каждый раз когда возникает вопрос стоит ли переходить на новую модель необходимо ответить на тот вопрос она канонически обоснованно или необоснованно потому что новые более сложной модели требуют больше вычислений и эти вычисления могут быть экономические неоправданными на этом я заканчиваю спасибо за внимание и я буду рад ответить на ваши вопросы давайте поблагодарим артем возьмите большое скажи пожалуйста вот работу который ты рассказал как много времени она потребовала от начала работы до внедрения если трава чистой время или так сказать ну пойми календаря я понимаю что есть нюансы есть большие нюансы связанные с конечно параллельными другими задачами мы начали эксперименты с mb деньгами в прошлом году осенью первые результаты получили в течение пары месяцев но потом большая работа была проделана для того чтобы удостовериться в этих результатах провести всю проверку найти оптимальную архитектуру сделать какие-либо эксперименты я думаю это заняло еще не меньше двух месяцев чистого времени он хорошо спасибо большое так если есть вопросы коллеги поднимайте руки через софиты попробую вот барышни пожалуйста скажите пожалуйста как вы гарантируете что там в деньгах не будет дата веков для некоторых задать хороший вопрос спасибо большое действительно я обозначил что до толики могут быть в классических признаках но смотрите смб деньгами ситуация такая что мы для того чтобы их тренировать используем только определенный срез данных набор самых ключевых признаков для нас то есть мы не используем там все несколько сотен признаков которые рассчитываются мы выделяем несколько дюжин признаков ключевых таких как там полное количество сессий и это уже позволяет нам ориентироваться на то где будет дата ли где не будет для того чтобы до толика не было по времени нам необходимо еще фиксировать время которая этим бединге были рассчитаны то есть конечно полной гарантии мы дать не можем но мы можем быть уверенны что эта ситуация контролируема спасибо так и вот молодому человеку в центре будьте добры привет меня федор зовут поближе микрофон пожалуйста га-ва-го просто первый такой больше продуктовый успели уже оценить но бизнес эффект деньгах в плане провести какие-то тесты и ну в принципе вот отыграть схему что вот мы узнали что человек следующем месяце воспользоваться детским тарифам провели с ним какую-то коммуникацию или какую-то скидку делали и после этого там провели тест там увидел цели там средний человек или в принципе какой бизнес метрику смотрели это первый второй вопрос а второй больше технический насчет в принципе да обучения это мое обучение модель-трансформер а использовали ли какой-то при добыче ну и там чуть чуть только позвонить у нели и это заняло там чуть-чуть ресурсов либо взяли какую-то тяжелую архитектуры обучали с нуля там долго больно там на кластерах вот это второй вопрос пассивно красиво начну со второго вопроса как более технического мы не могли взять чужую архитектуру потому что мы закладывали информацию о признаках именно в соответствии с нашей доменной областью то есть по поведению например пользователя или по поведению водителей архитектура в принципе трансформера действительно может быть перед пользованием и общее фрагменты использовали но при допущенную не равно сеть мы не могли бы даже найти под эту задачу теперь что касается проверки на экспериментах ну вот uplift моделирование это по сути тот эксперимент который мы мы можем в оффлайне провести сейчас потому что для этого для этой задачи нужно данные о контрольной группе и тестовой группе сейчас конкретно уже запущен эксперимент как раз на тарифе детский поэтому и если кто-то первый раз прокатиться на тарифе детский знаете что вы нам помогли конечно не первый и второй вопрос это как раз второй вопрос куда мы пытались запустить еще несколько экспериментов но они выпадали на аномальное время и поэтому в их интерпретируем асти возникают споры . дальше бизнес оценка какая-то вот этих результатов которые получены ты между без оценка такая что мы уже перешли так сказать на рельсам викингов мы их используем в наших текущих задачах и это оказывается удобней потому что они как полуфабрикат их достаточно подставить в отдельную модель новую который решает свою задачу и она уже на этом послании получает неплохое качество спасибо большое давайте еще один вопросик возьмем под под конец да спасибо большое а какие модели power can be king вкрутите вам сейчас скажу раз уже работают модели по определению сегментов по uplift моделированию модели связанные с тарифом ultima связанные с тарифом комфорт и комфорт плюс и look-alike модели то есть поиск людей похожих на других людей почему кстати это лучше всего было для look-alike мы изначально решали look-alike задачу и если обратиться к идеям викингов получается вот даже в этой аналогии с rgb цветом близкие цвета имеют близкие виктора то есть нам как раз не хотелось такое же свойство получить в работе нашей модели а если чисто технически тоже маленькая не ромка поверху чисто технически сначала мы пробовали маленькую нерон q а потом оказалось что котбус прекрасно с этим справляется и более того у капуста есть специальный формат передачи данных embedding типа embedding это не так легко найти в документации но вот помимо указания того что там категориальные признаки или численные признаки есть еще формат мвд рф и как бы с этим справляется даже еще чуть-чуть лучше спасибо блин такой интересный вопрос суши я хотел бы просто продолжите пробовали ли вот look like делать не дни для пользователей а для водителей ну то есть мысли какие-то там результаты есть для водителей мы в 1 через смотрели отток только тогда пока только тогда но у нас уже в процессе работы задача связанная с определением тех водителей которые например чем-то недовольны"
}