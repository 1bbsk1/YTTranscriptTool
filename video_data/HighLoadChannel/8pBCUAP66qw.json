{
  "video_id": "8pBCUAP66qw",
  "channel": "HighLoadChannel",
  "title": "Анатомия Kubernetes Operator для базы данных / Пётр Зайцев, Сергей Пронин (Percona)",
  "views": 1404,
  "duration": 3033,
  "published": "2021-10-04T02:44:22-07:00",
  "text": "что господа кто здесь использует каберне this о отлично а а кто-нибудь базы данных пытался напускать на к вернитесь все это мало рук у нас остальные боятся столь и страшно ну вот мы постараемся чтобы вы боялись меньше надеюсь ну может быть может быть и больше это уже как как получится в общем мы расскажем о том что такой вот фиг оперная оператор для баз данных да там и вообще как он внутри устроен вот а со своей стороны как ребята сказали мы из компании перка на я руковожу компания сергей руководить операторами то есть я вам скажу ну знаете как сила положено там рука и производить вот а он расскажет все самое-самое adobe поближе то по да вроде не умещается на камеру это не мешает смотреть ван tata nano как дал хорошо ладно а так о чем мы говорим о том что не так и значит мы в компании пир конов сделали операторы для скольки наверно двух с половиной баз данных у нас есть полноценные операторы для москвы и манга деби и вот мы совсем недавно несколько дней назад выпустили там первую можно сказать бета-версию операторы для для паса вот соответственно со всем этим нам видны некоторые паттерны и о том что делать хорошо что делать не очень вот в верху не мы занимаемся базами данных вообще то есть мы грубо говоря не кг обернитесь центре компании но многие клиенты в последнее время мигрируют в оберните своими work ладами вот стала эхо не увидим надо выключить микро after вот и связи с этим они хотят использовать в к оберните с базы данных базы данных тоже понятно что если база данных использовать выбирайтесь можно разным путем да там некоторые слышали люди здесь на концерте разговариваю о hell да там просто берем холмс ставишь районам позволяет поставить базу данных на а пираты очень классно вот что позволяет оператор это не только но то что называется да иван да там как на поставить базы данных но сделать весь цикл работы с базы данных то есть в принципе если оператор уж совсем классный да он должен большому счету умеете делать ну практически все да там что в стандартном варианте будет делать не человек руками вот для чего мы используем императоры в турку на самом деле для двух вещей то есть во первых это для людей которые знают и понимают кабир найти с они используют операторы напрямую также мы их используем для разработки открытого дети в сизо сервис то есть наша и идея в том чтобы предоставить людям что-то вроде там amazon rds да там или же там индекс клауда то мечты тебе чтобы это все было в сделано open source технологии и вы могли его использовать в любом claude которым вам хотелось и строим и это на наших операторов вот ну что собственно говоря я вас нам рассказал до того этих уже вопросы в этом то что оператор нам позволяют делать не только инсталляцию но и это и сергей вам теперь уже расскажет о более подробно о том что именно мы делаем и как давай бери этот я выключил микрофон буду в роли нормально нормально ну все вот учил 1 раз муки да я расскажу про внутренности операторов что там внутри происходит там слайды дублируются отлично сначала подумаем что происходит когда нет оператора вот пришел человек он хочет говорит хочу сзади плоть базу в кубер не тисе первое что происходит человек deployed под ну под понятно это маленький я блэк который есть и есть и не кушать не просит работает и ok потом добавляется сто рача естественно какая-то база данных либо это persistent вольем либо это какой-то хост пас если любите экстрим и позже добавляется сервис все баз данных готовы то есть вот у меня есть под у меня есть сервис у меня есть база данных принципе ничего сложного зачем здесь оператор но потом естественно появляется желание чтобы база данных была чуточку отказа устойчиво так как в кубер нить это среда такая эфемерное все время что-то падает чтобы поднимается и вот чтобы такого не происходило добавляется либо deployment либо какой-то states чтобы если один поди купол другой всю нагрузочку подхватил ну и этого тоже недостаточно потому что даже если мы трипода засунем то мать маги не случится нужно настроить какую-то между ними репликацию то есть в нормальном мире вы заходите на хост настраивайте репликацию между там не знаю виртуальными машинами либер металл серверами а здесь у вас спады то же самое в принципе можно сделать зайти is configured ну как бы зачем после того как вы сделали репликацию надо чтобы это все продолжал работать даже если один под упал то есть один под упал надо как-то чтобы автоматически все recovery люси ли вы добавили новый порт к своему кластеру что было не 3 опять подав например или больше это тоже нужно все configure ти если вы это делаете руками это опять же надо зайти в порт опять же его с configure потом появляется желание почему бы вместо сервисом не использовать прокси потому что мне нужен играть сплит мне нужен каире кэш мне нужно еще какая-то магия от прокси вы ставите прокси опять ее надо с configure ее надо научить чтобы она могла смотреть на эти коды понимала какие из них жива какие нет потом появляется желание сделать речей прокси потому что если один под прокси упадет у вас легла не база а весь ваш сервис апликэйшен не может туда достучаться потом появляется желание с кастомизировать базу данных то есть какие-то конфиге дополнительные подсунуть и все это без оператора достаточно сложно и печально и руками и to configure ведь очень долго а если кластеров не один а если их 100 если вы их отдаете девелопером каждый день на растерзание то это превращается в головную боль поэтому если мы говорим про оператор то у нас есть купюрница примитивы это стоит вался этой позы там сервисы и прочее у нас есть applications в случае базы данных это сама база данных и какие-нибудь там прокси галеры еще что-то если они включены в оператор и на пересечении этого всего где-то живет оператор из точки зрения пользователя или девелопер или еще кто этим пользуется остается лишь один оператор и больше ничего ему не надо вы оператору приходите и говорите дай-ка мне базу данных или дай-ка мне backup или дай-ка мне еще что-то и инструкции они выглядят примерно так это такой абстрагирован эй кусок из нашего манифеста для пикси оператора что вы говорите ему да не столько tanoth дай мне такую toprak сюда не такой the image там affinity можно с configuring uber найти ну что угодно ресурсы размер 100 раджа все что угодно все что вы можете сделать кубер нитей можешь делать ей через оператор просто это будет не 100 ямал файлов один единственный который оператор будет контролировать если смотреть чуть поглубже вовнутрь оператора то примерно вот так выглядят все операторы это какой-то под в котором внутри крутится ри конца и лук а рядом с этим при конца глупом какой-то корт и это три конца и лу периодически ходит к мастеру q вернуться к чаю и спрашивает а если там sea or a изменился lessar ну все редкостным resource если он изменился или появился новый то в дело вступает код который раз мораль разворачивает либо кубинец и купюрница примитивы и настраивает сам апликэйшен в данном случае он настраивает базу данных если говорить про базу данных то это конфигурация репликации включение там блогинга какого-нибудь мониторинга юзер менеджмент тот же самый тоже можно все делать через оператора афк убирает все эти те же статус эти секреты ромба и секс ice control и сайт карт контейнер если вдруг по какой-то причине они нужны если говорить про di2 как сказал петр di1 операции это легко да это можно за деплоить и забыть но потом появляется нужда делать что то какие то каждодневные задачи это backup & restore is killing of great и также может быть вам хочется сделать дтп из-за сервис как вот делаем в пир конь а кто-то может сам хочет сделать на самом деле это очень легко используя оператор и так оператора это всего несколько яму файлов и их можно как угодно компоновать и если погружаться глубже например в di2 operations и говорить про skay link to обернуть скиллинг достаточно просто делается и как бы как везде наверное есть три типа скиллинга вертикальный да это когда у нас база маленькая там 10 гигабайт памяти нам стало мало нам надо теперь 100 до и мы просто добавляем лимитов для uber нет спода или для контейнера и все у нас база теперь не тормозит горизонтально искали скиллинг это добавление not bad было три ноты мы добавили еще одну появилось четыре например да мы распределили как-то нагрузку ну и последний случай это sharding это не для всех баз данных например для манги когда мы хотим разнести когда вертикальный скиллинг уже уперся в потолок ресурсов мы дать больше не можем и мы можем разнести ресурсы по шар дам для и есть сторону старичку вернетесь как бы я думаю все знают там в основном это делается через енисей президент валим claims если вдруг стороны стола не хватает мы сторож наращиваем то есть увеличиваем пиве себе где-то в бэкграунде девисе наращивает сторож на либо claude либо это если сев либо еще что то либо опытный biesse даже тоже может такое делать но опять же сторож он не бесконечна будет скейлится наверх надо это понимать и когда-нибудь вы упрётесь в амазонов 116 терабайтный например лимит и вам захочется что-то больше тогда единственное решение это наверное sharding или что то еще другое придумывать например для маску или sharding доступен в вид с операторе дальше есть проблемы backup & restore а как да и 2 операция огромный соблазн всегда за деплоить базу данных и начать ее бы копейки какой-нибудь внешний вид то узор да там не знаю у вас есть уже какое-то решение в принципе она рабочая почему бы нет но надо всегда помнить о том что ваш код может упасть в любой момент и тогда у вас быка прервется если ваше решение уже как-то это может обходить и вы готовы сказать что все даже если под упал я потом попробую опять backup ну почему бы нет она будет работать но надо еще помнит про performance что если вы делаете backup склонить огромной базы высоко нагруженный то это может быть не так дешево для вас другой путь для бэкапов это запускать backup tool зубов сайт корея он чуть получше потаму что у вас backup tool за рядом с по диком живет если что они вместе помирают и вы как-то это можете отследить но проблема все равно остается если backup не завершился вам надо как то все равно это контролировать сколько операторов не видел практически во всех backup & restore и делаются через кастом ресурс потому что это проще у вас есть уже рикон силу который бесконечно отслеживает все ресурсы если он видит что backup не завершился он просто заново его потом когда нибудь попробует это же самое с ristora мысли у вас ресторан делает это лучше делать через красным ресорт чтобы в конце глупые оператор всегда знали завершился restore или или же нет designs to recovery designs to recovery это такая проблема обычный энтерпрайзис маленькие бизнесы тоже начинают они их задумываться когда уже поздно но как бы энтерпрайзе думают об этом с первого дня и дизай ставка very можно делать из бэкапы если у вас recovery time объектив позволяет то есть вам без разницы лежит база там 100 часов или нет то можно делать из бекапа но надо понимать что если вы в кубер нить это делаете у вас бэкапы сделано через кастом ресурс то вам надо научить ваш оператор восстанавливает базу данных без кастом ресурсов потому что если у вас весь губерний кластер умер у вас умерли кастом ресурсы у вас умерли и умерла и база поэтому у нас операторы умеет восстанавливать из с 3 например напрямую то есть вы говорите вот у меня backup ps3 восстановим не его оттуда через тот же ciare и дальше если вам rtl важен вы хотите восстанавливаться чуть быстрее то надо уже делать какую-то репликацию репликация возможно внутри одного кубрина цикла страдает когда у вас несколько авиабилеты зон между ними у вас какая-то репликация настроена например синхронная синхронная без разницы ну тогда появляется проблема например в региональных кластеров когда у вас один на вот ист коуст другой новый сколз штатах на например часто такой узкий сбывает и тут уже надо думать это на кубер нет слова ли решается в федерации данного федерейшн я не знаю кто нибудь может использовать ее здесь ни разу не видел такого кисть что кто-то использовал в продакшен и потому что она достаточно сырая и поэтому надо придумать какую-то уже решение для самой базы например для мая скрыл это всем известная репликация для морды это поместить но до 1 replicas это в другую в другую кластер совершенно и она будет работать но надо понимать что для москве у того же самого чтобы это дело работала вам надо каждую праймари ноду выставлять вовне с помощью какого-то сервиса чтобы реплика могла туда достучаться до каждой ноты если одна но да у вас падает та реплика должна сама переключиться на другую ногу чтобы брать оттуда берлоге в mais quel это решено нормально 80 в 5-7 это нормально пока что не работает без каких-либо хаков но есть хотят определенные если говорить про операторы почему операторы важны почему операторы нужны то много наших клиентов и юзеров компьюнити они берут операторы только из-за их стратегии мультик лаут и мультик лаут это не просто что я у меня там 10 кодов или там 10 applications за тепло и на в дтп а 10 в амазоне мультик лаут эта стратегия когда у вас действительно работает отказывай устойчивость между несколькими колодами просто если вы за тепло или разной applications это не мультик low ты просто вы не можете не как выбрать в каком claude запускаться и поэтому мультик love достаточно сложная штука когда речь заходит а несколько убирать кластерах несколько applications как то это все надо балансить и это не так просто давай спросим кто несет мультик low dose пользует вершин как у вас с мульти клауда в плеске то я знаю что используют ну куда же куда ж без тепла в ней хорошо а кто-нибудь использует больше чем один клауд вообще но вот о не в сергиевском понимает хорошо а кто интерфейс пользует клауд смотри как как мало рук никому не интересен глава никому не интересен и все на br металле даже вот или харви болл forever молодцы молодцы но а у вас несколько бы army to love там или все в одном месте храните в на 22 верха я понял не она правильно да но тишка здесь в том что даже если у вас все запущено в нескольких дата-центрах как вы любите в нескольких облаках то надо понимать что купюрница он не меняется от облаку к облаку он не меняется от дата центра когда-то центру и примитивы купюрница они остаются теми же сам то есть с оператором вы его diplo эти в одном kuben из кластер в другом она у вас работает но то что там внизу в принципе кубинец не интересует какие у вас там стороны как она вас меняется внутри никому не интересно поэтому здесь конечно кубер нить очень помогает и операторы они спасают ну и частый вопрос который я сам себе задаю или клиентам которые к нам приходят и говорят вот мы решили там мигрировать нашу базу в кубер нить ну первый вопрос а почему кубер не тесно не берет ну вот слышали классная штука ну да штука классная но зачем вам это у вас там она будет крутиться у нас radios 11 но зачем вам кубер на эти со если все и так прекрасно работает это действительно как бы кубер нить из и операторы это другая история это не то что давайте все засунет кубер нить из и будет круто потому что это катины туда-сюда купить он не для всех это не серебряная пуля и да надо задумываться о миграции в купер ниц если у вас стратегия то есть вы говорите все мы хотим там все двигаем кубер нить из у нас полностью вор вся работа на нем построена ну еще имеет смысл дальше были у нас крупные клиенты у которых тысячи там баз данных именно серверов и они говорят что вот если мы это все засунем в rds да у нас как бы бизнес умрет потому что мы будем платить им миллионы в месяц и конечно цена вопроса она встает здесь на первое место если у вас свой какой-то танку верный свое решение засунуть туда базы данных миллионами их там тепло и титана гораздо проще чем делать тот же сервер лось в гору или какой интерфейс винды log in я не знаю если у кого-то такая проблема кто-нибудь ее может когда-нибудь боялся решал но для больших энтерпрайзис это боль до когда они deployed свои базы данных там в одессе вроде кажется ну мои скрыл им sql какая разница куда хочу туда эмигрируют а потом вдруг оказывается что у них вокруг mais qui la там вокруг ардис а еще построен аналитика нарежьте в с3 они льют какие-нибудь данные напрямую из rds и потому что так удобнее у них а им policy настроены и в итоге когда встает вопрос а давайте там мигрируем в google клауд они говорят ой блин нет у нас тут вон сколько всего завязано такая простая мы сейчас делать не будем нам год нужно и миллион долларов девелопером чтоб чё то там переписать поэтому вот это вот история swindle лукина она достаточно болезненно и обычно с купюрница мы и не происходит если у вас каких там завязок нету да а а еще фраз ноты корешка вернитесь так все классно почему просто нам на ансель и что-нибудь мне написать это новинках слушай ну я знаю многие так делают меня к нам подходил человек и не знаю здесь он сейчас в зале или нет тоже говорит я вот проще мне самому все с криптомитом обвязать и чтобы она работал за то я это сделаю ну это такая история почему нет можно и job security у человека будет на на 10 лет потому что он это напишет их никто в этом никогда не разберется зачем это делать если есть рабочий продукт который уже можно использовать и даппи допилить комьюнити если что-то не нравится пожалуйста что-то поменять но на самом деле есть еще один момент который мы часто склада сталкиваемся это как не только opensource истратите но и повернитесь потому что многие компании даже вот еще несколько лет назад да там они смотрели вопрос не в том что поверните сейчас а то что он будет через а через пять лет до может быть сейчас мы пока еще но это использование базы данных повернитесь есть скажем так острые углы не все там совсем так хорошо на самом деле если кто помнит похожая историю было например с виртуализации я помню как сколько наверное сейчас лет двадцать назад ай да настоящий база данных нужно только набирает удержать виртуализация не доверять нельзя да то я до сих пор не убрали туда вот но но всяким же банком и и продали вот так что приходится пользоваться да и потом в клаву то же самое было дата amazon rds помню было там совершенно такая по девочка которую только можно было для самых маленьких баз данных использовать ну а теперь уже используется для очень больших проектах и то же самое мы видим со ска верните сам да то есть если сейчас например может быть не любую базу данных и все имеет смысл размещать их обернитесь то объем из кейсов на которых на которых с которыми к верните способен работать он растет из года в год да ну это интересную штуку сказал что вернется когда-нибудь вырастет во что-то больше сейчас говорят кубер на это номер один для контейнера регистрации келси хайтауэр говорит что кубер нецид уже номер один control plain то есть менеджмент амазона или там джесси пить через границу и пиа и пожалуйста делаю вот это вот еще интересная штука да то есть люди которые говорят вот такие я вот могу взять написать свои как бы не знаю там ваш скрипт и да там на какой-нибудь ноги вот а дальше на больших на ваших узлах да там вопросу те что если вот это но до упала когда ваш ваш скрипт выполнится только наполовину вода участвовать разработчики который я все это сам напишу за weekend они о таких проблемах не очень думают на самом деле в с распределенными системами у которых там бывают хитрые сплит brain и и так далее и тому подобное там нужно очень много таких вот странных вопросов решать которые каберне this уже за вас решает поэтому как вот использовать как с такой халли available to control plain да там которую можно сказать сделать так и как-то она там сама сделает это куда более правильный концепт чем пытаться все это делать вручную и пытаться продумать все эти фигуры nereus ручкой ну знаешь оператор оператору рознь тоже сегодня рассказывал про маска или оператора есть киев тебе для которую такой швейцарский нож для всех операторов и вроде он тепло и но если посмотреть поглубже он тепло и совершенно без оглядки на базу данных на самом тепло от контейнеры а дальше гори оно все гарри поэтому да тоже интересно то есть оператор не не факт что решит все ваши проблемы но мы стараемся да это вот интересно мент счет если вот вы смотрите на оберните с оператор это здесь получается нужно такие 2 скила до что были у команды с одной стороны люди понимали к оберните с другой стороны понимали базы данных потому что если это только одно из двух у вас будет либо что-то да там которая хорошо сделано с точки зрения базы данных но как-то совершенно не к оберните style или вы наоборот будет то что классно с точки зрения каберне this look and feel no там вот эти вот хитрости базы данных один удар неправильной ну вот у нас булат сидит он знает какая то боль найти девелопера которые с гулан вам sq верните сам из базами данных и вот это да это конечно юникорн надо да очень и очень тяжело ну что самаре давай посмотрим у нас там оператор capability lovers кто-нибудь видел когда идет картинку кто с операторами общался это род котовская картинка они меряют как-то maturity мать и расти как убрана кубер нас операторов несколько мило валами и если мы смотрим на пример на пир конный оператор то хорошая новость что мы во всех вроде пунктах где-то покрываемся вовсе но и но не все да если смотреть на level 1 то там понятно там за тепло из configure all nokia это каждый оператор умеет level 2 это уже апгрейде да то есть у нас есть фича в операторе smart апгрейт который умеет без downtime а апгрейдить оператор нами норму на следующем минорную версию это пожалуйста level 3 backup restore она тоже уже более или менее во всех операторах есть каких-то правда за деньги у нас бесплатно level 4 the deep inside да есть у нас там мониторинг да есть алерта через пмм ну например аналитики пока что нет то есть какого-нибудь интеграции например с клика усам которую мы очень потом в будущем хотим сделать она будет но то есть где то что то перекрывается на этом уровне где-то нет level 5 тоске и link а вот о конфликте uniq у нас тоже есть а в норму ты так что пока что нету это тоже уже из области аналитики каких таких вещей ну я бы сказал вот так по-хорошему дату из полной то что у нас есть из level of rio оператор да там то что мы действительно поддерживаем full live site и если смотреть на операторов которые есть сейчас на рынке наиболее это наверное наиболее такой тот level который достигается да там потому что хотя многие могут обещать да там у нас абсолютно сел ранен дейта в с да там обычно все-таки это достигается но далеко не а далеко не полностью ну да ну вот я знаю вид с а например у них классная интеграция они же выезжают на интеграции с дата долгому например на не классно интегрируются и все метрики они куда пуляют из-за этого у них там и abnormal detection есть еще что то ну это скорее вы уже скажем так не в операторе или градусов потому что то же самое она же тоже есть сайт cars в которой можно и дейта dog & new relic интегрируется с чем хочешь но может быть немножко больше с напильником да да ну что давай что там по красоте у нас контейнер и везде ну да ты такой самаре что например когда вы деплоить мангу если вы мангу деплоить сортирование то скорее всего у вас будет и трипода replicas это у вас будет три пары конфиг серверов и у вас будет триподом он газ и плюс у вас один порт на оператор то есть у вас уже 10 подав это только один реплика сет на и руками менеджер титану я не знаю я ленивый человек я не представляю как это делать и мало того что это 10 кодов так в каждом ходе у вас еще скорее всего по два контейнера потому что он входит мониторинг добавится эти 20 контейнеров руками менеджер ну тоже какая-то магия для меня ладно томку вернитесь он как-то справиться если уже лезть во внутрь базой что-то настраивать ну я лучше руки seat рублю ну и до операторы они все упрощают в плане менеджмента кубер нас примитивов и менеджмента самих баз данных и их компонентов если у вас какие-то прокси мониторинге тоже есть я вот здесь товар еще один интересный момент который может быть на не совсем очевидно с чем вот мы часто сталкиваемся до что если базы данных но тепло и ручками там очень много flex abilities это можно напридумывать совершенно интересность кого топологии хитрых конфигураций и так далее и тому подобное и вот что многие компании сталкиваются с тем что если они дают такую свободу своим девелоперы могли там дивов сам кому угодно то потом когда эти шибко умные и вовсе уходят то у них появляются большие проблемы с тем как это все всем разобраться и в этом плане вот такие вот решения даже как вот amazon rds дали дтп с инвестировать они вам дают ну границы весьма ограничено что она работает именно так и вот и к верните сон а и операторы куда ближе к этому то есть если вы используете оператор то он работает именно таким образом с одной стороны к этому возможно придется привыкнуть потому что каких то там такого способа дипломанта база данных там скорее всего не будет но с другой стороны это как бы стабильная платформа да там которых ну предоставляет вполне тогда понятный концепт который можно можем добавить то есть вот есть тоже такой benefit этом особенно для там больших команда там где можно может быть много разных групп разработчиков да там который хотел его что вы схожи несколько более дефиците раваны подхода да да у нас в операторах по-моему я в каких то еще это видел есть функционал чтобы человек не выстрелил себе в ногу например там без определенного флага нельзя запускать меньше трех нот в пиксель кластеры или там бизнес и цель и или еще без каких-то как мы их называем инсеев конфигурация то есть юзер может сказать не я сам все знаю лучше вас я сам все сделаю пожалуйста выключай флаг но по дефолту это невозможно ну вроде тогда все ну что все являлись уложились модель в ну там один слайд про планы на так рассказываю операторы наверное ну планы про оператора у нас простые как бы у нас стратегия пера кони такая что у нас есть софт который работает в веках вбр металле везде и когда к нам пришли клиенты хотим добавить его на кубер нить из запускать его там мы это сделали да но сейчас нам надо догонять по вещам да то есть например там мульти кластерная мульти дата-центр репликации она возможно пикси и в майскую это в обычном но в операторе и пока что нет потому что мы не можем добавить этот функционал так просто приходится там где-то колдовать и наша основная задача сейчас это вот вот этот фича берите его как бы сделать чтобы у юзера который когда-то запускал наши продукты или там мая сквере другие окон собственные базы данных в дата центре или на virtual машинах чтобы он мог то же самое делать кубер нити через оператор то есть вот этот функционал нам надо догонять большая проблема это мульти кластер это не только для нас но и для других операторов наверное кроме опять же вид с а они умеют все в плане sharding у них ну из коробки это работает небось интеграция в начале мы говорили что у нас есть дтп за сервис продукт который сейчас в бете который работает первыми как он мониторинга менеджмент и нам надо наши операторы полностью туда интегрировать пока в эти можно за диплом базу данных на кубе notice но при этом нету функционала backup restore а пока что ну потихоньку это все добавится до петлицы разгар составил так как мы его только зарелизили на надо его доработать напильником топором рубанком чем угодно так как он у нас базируется на crunchy операторе там функционал очень очень приличный но нам надо его подпилить чтобы он работал с нашими какими-то ей коми и иксами ну то есть такие какие-то штуки которые знаем только мы и mais quel у нас есть оператор для таркан x-tribe кластер синхронная репликация сегодня это на другом докладе рассказывал и план сделать оператор версии 2 наверное он будет называться с осинка репликации поддержкой групп репликейт а потому что группы applications это уже де факто стандарт синхронной репликации в морскую карьеру она сделала свое дело коллега может уходить но как бы пока она вот так вот вроде все но смотри такбир самое главное сказал то сказал нет павлик рот на паблик public руб то есть что важно знать град на то что проект и циркона а они опенсорс вот у нас есть открытый 1комментировать говорите что вам нравится что вам нужно мы это примем к сведению вот если вы знаете что в это синим и сильно приняли к сведению то тоже есть для этого всякие коммерческие карман основы еще что очень важно до что происходит с open source продуктами это если у вас есть какие-то идеи вы что-нибудь может для себя наработали напильником пришлите нам патче request и коммиты мы это с радостью включим и скажем вам большое верховское спасибо да у нас инженеры очень радуются когда ему десяток pr of пролетает им надо их все от тестить так что шлите больше это был сарказм нет нет не серьезная я радуюсь всегда когда и все они наверное тоже я с ними радуюсь на что она отлично значит что мы готовы к вопросам до спасибо большое ребята и так привычно вопрос-ответ а если у вас онлайне тоже есть вопросы задавайте их мы вас выведем на экран и послушаем ваш вопрос и я сразу скажу секундочку ваше прощение важный момент вам надо будет сообщая выбрать автор самого интересного вопроса на получится у нас и большой подарок все будьте внимательны и помните все вопросы которые раздают спасибо за зубов от меня зовут стася компания плеск спасибо за xtb кластер за галеру это очень круто пару вопросов мы с вами в компании пользуем zalando оператор и я столкнулся с двумя проблема первое это как при помощи крд доставить какой-нибудь сайт карте по мониторинга и второй вопрос это попова того как мастер lektion происходит если мастер упал какая гарантия того что следующие слои станет мастером и расположить залаза ландов скином ну вопрос про как zalando добавить сайт корр да легко как у вас это происходит возможно у нас через кастом ресурс добавить сетка да отлично и вот расскажите как вы происходит выбор мастера если мастер упал потому момент адресу оргрэс а именно в москве в любом вашем продукте в mais quel и в любовь наших операторах мы опираемся на купюрницы примите война сам функционал того что мы диплом то есть на applications в случае мы успели это галера галера оно само по себе может определить кто праймари кто не праймари то же самое как без кубер не происходит просто оператор разворачивает галеру оператор там вообще не участвуют выборе праймари не как у нас всё спасибо большое спасибо за ваши продукты пожалуйста спасибо за вопрос давид привет привет я тут андрей родыгин флант слушайте звучит привлекательно классно у меня в сущности один вопрос наверно самый важный как мне обезопасить себя от потери данных то есть мышь в кубах есть по вехи и множество было кейсов когда оператор там сошел с ума и решил пешки перри заказать потеряв данные я не знаю там еще чуть происходит такое если у вас к эта фича флажок который заставит никогда не трогать пешки мои данные самые важные драгоценные флага нет когда есть точнее флаг когда вы по дефолту удаляете сер на спешке не удаляются они остаются на месте если вы добавите флаг в финал озера до что удали ко мне в вэшки он их удалит то есть тут магии никакой нет но от потери данных спасение кроме как делать бэкапы я не вижу никакого то есть дата центра он может взорваться в вышке могут сгореть схд может умереть надо делать бэкапы и для манги и для майской или для подвеса в наших операторов есть даже point in time recovery когда две ноги и о блоге валы льются куда-то там его истории это все понятно это про recovery для классно что эти фичи есть меня просто беспокоит прежде всего моменты когда оператор действуют непредсказуемо для devops а там инженера и вследствие какого-то мисс конфига человеческий фактор происходит уничтожение ну вот склерозом я сталкивался с таким что происходил перри заказ пвх и они сделали после этого оттяните ребята специально прям фичу что чтобы не там не указали но пвх всегда на месте оператор автоматически не преодолеет их никаких никогда не тронет пешки ну слушай я не знаю какое клих хауса был кейс но у нас таких кейсов не было мы как бы опираемся на то что есть кубер найти то есть стоит full set и я не слышал ни разу чтобы какая-то магия случалось что он сам по себе вдруг удалял ну это надо вернуть себя и зайти и удалить их ты сказал что по умолчанию флэшки не удаляем но если настроить удаляю да вот у нас есть и даже при апгрейде у нас они удаляются они на месте всегда строки может я какой-то и истец не знаю если у тебя есть хоть и успеть можем я подойду тебя в кванту тогда пообщаемся ну да ну пока не вижу space такого если есть какая-то идея я просто не знаю как угли хаус это случилось что-то у них саша зайцев расскажет у него есть кей не брат не брат и брат первый вопрос нам угол он спросит спасибо спасибо спасибо большое за доклад очень интересно у меня пару вопросов часа можно вот первый такой вот коллега уже спрашивал можно ли добавить сайт корр и но я думаю что сайт корр вы просто вытащили вот там и с под спеки вы просто вытащили настройки какие да то есть если вы какие-то настройки не вытащили а вот мне нужна какая-то гибкость что делать ну да надо pull request делать никакого work раунда вот на крайний случай у вас нет вот не не было такого чтобы пользователь приходит и говорит вот очень мне надо вот прям сейчас подправить ну да нет ну конечно пользователю все надо вчера тут как бы это не обсуждаете но есть несколько идей дата чтобы юзер в спике не указал все ари все просто кидай да но это может выгореть еще хуже поэтому мы достаточно аккуратно к этому подходим ну как бы стараемся все добавлять да если там какие-то прям ну что-то забыли ну добавим там в следующем релизе явно было что пользователь к нам приходил там знаете не работает да но это никогда не бывает так что знаете не работает в продакшене это достаточно странно то есть юзер приходит я черт потестил фигня какая то не получается но потерплю там недельку пока в этом зарелизить или в мастер за комитете ответил на вопрос да да да спасибо и вот еще такой вопрос какая-то автоматизация тестирования наверняка у вас есть для операторов как да у нас куча нтн тестов прям автоматически язык ютиться при пиаре сначала не запускаются на джиг и мы гоняем только на джиг ли я перед релизом ближе к релизу мы гоняем уже там наука шрифтах на реке с на обычных убирать их это все нтн тесты есть ручками протестировать но мы потихонечку все-все-все там прям такой простыня intent тестов от теста это условно там баш или питон или это какая-то молекула ну вот тут я не отвечу это может было час крикнет все на баше говорит но он в reactos он врет но там не знаю на чем тесты но тесты они не то что запустил кластера там тесты вплоть до того что могу ли я восстановить там 10 терабайт базу из бекапа а что будет если я сеть выключу даже cows инжиниринг testing там тесте можно ли выключить сеть или там убить рандомно под это все тоже тащиться спасибо пожалуйста спасибо за доклад когда вы планируете начать рекомендовать использовать подвес оператор от вас это первый вопрос я рекомендую а уже можно что сейчас уже можно той доу уже можно понимаете там дело в том что так как это наследие crunchy оператора crunchy дата у них оператор на самом деле неплохой и были какие-то решения которые мы переработали в ядре им были какие-то решения которые мы добавили например у них там реплики как странно совершенно менеджеры мы это переделали сейчас у нас версия называется 010 через пару версий через пару месяцев может чуть побольше булат на меня уже стреляет мы зарелизили версию 020 которая скорее всего будет уже j да но у нас уже есть клиент который нетерпеливый он уже за тепло и у наш оператор и гоняет там на нем тесты и шлет нам фидбэк пока все нормально понял и второй вопрос репликация там уже есть для вас ведь и что репликация в под без операторы уже релиз рада она там на слотах или на стримах на волосах или на стримах еще раз стрип реплики шин оля как версиях 96 иди на слотах уже с подпиской сабскрайберами а летом булок может скажет я не знаю там по спасибо нескажу подходи на стенд потом можем пообщаться запас грэс я тебя с контакта с ребятами тратим на короткий вопрос если как я видел вас в пятой стадии в пятом левеле было backup и восстановление recovery во лидируете ли вы автоматически бэкапы пределами или вообще каким как о какой процесс валидации есть да да я ждал этот вопрос на самом деле нет но смотрите то есть мы думали внедрить валидацию бэкапов и почему бы нет то есть у нас есть валидация внутри там x3 бэкапы да что мы делаем если рискует говорим он наплодит backup а есть валидации внутри оператор что он получает текст и backup секс с что backup завершился да во всяком случае мы точно знаем что что-то там случилось что он завершился с без ошибки сам процесс но то что залилось ли все мы не знаем да и были идеи что а давайте мы будем брать backup восстанавливать чек и проверять чек сумму до но это в тоже время это ресурсы то есть не каждый users как блин а чё у меня здесь еще кластер такая опция включаем и ёпте да да да да вот были такие идеи почему бы не сделать включаем опцию но пока какой-то буче никто не поднял и как мы видим на например public кладах они тоже это никогда не делаю то есть они не тестит бэкапы мы с amazon нам общались они горят блин мы ничего не тестем это сами тестить и чего хотите то и делайте эквестри доползем базу данных там за полгода бэкапы за коробками ребенка может может да я согласен такой узкий сон валидный никто не спорит пока что мы этого не делаем спасибо жестко там молодой человек а уже давно артемку поднимает так у вас короткий вопрос там короткий давайте один вопрос и все привет а огромное спасибо за доклад это была правда интересно я скажу что у нас есть при кредиты как пользования этим оператором у нас есть uber найти с у нас есть мускул но хотелось бы узнать что вы можете сказать кому вы можете искать не пользуйтесь нашим оператором ну что мне сказать или ты не говоришь ну смотрите если у вас есть вот стоит например сейчас такая железка большая толстая в ней скажем так 2 терабайта памяти 150 core и база данных нас на 50 терабайт и вы вокруг нее ходите не дышите чтобы она как-нибудь не упал до вот это вот базу данных вот сейчас переносить вернитесь на эти операторы не не стоит тупая счет такого совершенно экзотичный на может пример что стоит я высказал как вот стоит начинать да там для любой компании это как как есть и к верните свою базы данных не гоняли то начинать чего начинать как бы st стендов потому что понятно что у вас будут какие то свои да там но проблемы да там люди что-то не будут понимать сначала потом может переносить какие нибудь там менее mesh in critical база данных можно кинуть production но не очень большие и уже как у вас опыт растет двигаться в сторону более mission critical и больших высоконагруженных баз данных то есть я бы рекомендовал в таком порядке мы смотрим спасибо"
}