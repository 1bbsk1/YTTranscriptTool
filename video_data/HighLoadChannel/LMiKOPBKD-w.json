{
  "video_id": "LMiKOPBKD-w",
  "channel": "HighLoadChannel",
  "title": "Успеть за 350 миллисекунд. Эволюция архитектуры Антиспама Почты Mail.ru / Константин Хицко",
  "views": 505,
  "duration": 3119,
  "published": "2024-04-17T01:10:26-07:00",
  "text": "Привет Меня зовут китско Константин сегодня Вам расскажу про антиспам почты mail.ru сам я этим Лид команды ядра антиспама вот сегодня мы с вами поговорим в целом пройти Спам что это такое Зачем он нужен что у него под капотом Какие технические трудности мы испытываем при реализации работы с антиспамом немножко коснемся темы эмэля для тех кого хочется погорячее Там будет перекопано две ссылки на более технические доклады касательно Эмилия Вот можете ознакомиться будущем Ну и самое главное я расскажу про то как наша архитектура развивалась за 15 лет сочетание диспама и собственно Каковы причиненные этого развития были Итак Пару слов про почту mail.ru если кто не знает почту mail.ru крупнейшая почта в российском рунете наши пользователи получают более 400 миллионов писем в день и наверное все 18 миллионов пользователей которые наши сервисами ежедневно пользуются за исключением может быть спам аналитиков не очень довольны когда они получаются спам Вот соответственно наша цель защищать наших пользователей от спама Давайте немножко поговорим в целом про спам откуда вообще этот термин появился как мы его понимаем потому что понятие спама достаточно субъективно чтобы мы как бы немножко Были на одной волне целом слово спам в обиходе с нами с 30-х годов прошлого века благодаря вот такой вот жестяной банке из консервами из свинины благодаря небезызвестной коме группе летающий цирк Мунди пайтона к этому термину прикрепилась к слову спам прикрепилась синоним навязчивости какое-то вредоносной рекламы и поэтому когда Первое вредоносное письмо отправлено было примерно 30 лет назад уже как бы за ним четко прикрепилась синоним слова спама Ну и в России слово спам появилось в 91 году когда были известны всем вам события а Итак вкратце можно выделить некоторые общие виды спама которые существуют в первую очередь это недобросовестные рассылки от обычных рассылок они отличаются если вкратце тем что они база e-mail по которой ссылается рассылка она получена нечестным путем То есть вы не давали согласия на отправку вам email а вам вы его получаете соответственно это Явный спам также как спаму можно отнестись различного рода мошеннические письма целью которых является получение от вас денежных средств это всякие письма с выигрышами в лотерею уведомление о том что вам ваш богатый дядюшка из Нигерии Оставил вам наследство так называемый нигерийский спам и Фишинг которая в отличие от двух предыдущих он менее массовый Но более вредоносный наверное целью злоумышленников является получение вашей конфиденциальной информации вот в целом если по какой-то причине например антиспан перестанет работать то Ну самое главное что произойдет пользы почтой станет пользоваться небезопасно потому что открывая конкретно письмо от отправителя вы не будете не можете быть уверены что внутри контент который можно доверять что не может быть уверены что можно переходить По ссылкам и так далее по различным оценкам Это примерно 10-15 процентов почты составляется Итак таким образом глобальную цель спама можно сформулировать следующим образом мы защищаем наш наших пользователей от вредоносного контента вредоносный писем чтобы пользоваться можно было почта безопасно в целом Если говорить о цифрах то это примерно 50 миллионов писем день вредоносных отсеиваем в год это почти 20 миллиардов песен а так давайте теперь посмотрим как же мы собственно делаем эту проверку в целом Что можно сказать о проверке спама прежде чем письмо доходит до конкретного пользователя все письма проходят проверку антиспамом до того как они появляются вас анбокси вы получаете пушеведомление о том что пришло e-mail мы обучаемся наши алгоритмы машинного обучения и вестические правила на основе сигналов от пользователей То есть если пользователь кликает вся в интерфейсе спам не спам соответственно мы на основе этих данных учимся и обучаем наш алгоритмы работают лучше если брать сам пайплайн обработки письма то первый важный важный этап Это доставка письма тут Важно сказать что в целом тут значимо то что балансировка самых писем то есть так как у нас очень много воркеров обрабатывает данные письма то очень важно было сделать грамотный балансировщик нагрузки который умеет чекать состояние серверов в каком состоянии находится данный сервера какой размер очереди и так далее иметь возможность в рамках того окна который мы проверяем письмо на является чтобы можно было сделать несколько переповторов грубо говоря если какой-то один worker по какой-то причине не смог уложиться в заданное время чтобы мы могли отправить письмо на проверку еще раз в рамках заданного окна следующим этапом после того как мы уже получили письмо является паркинс парсинг письма на этом этапе происходит нормализация письма выделения какую-то основных элементов этого письма например там заголовки сам текст какие-то сущности внутри отмечу отдельно что в чем важности выделения сущностей например урлов картинок это чей Дело в том что различные письма могут содержать внутри одинаковые сущности например там несколько различных рассылок могут ввести на один вредоносный сайт таким образом если мы например определяем что какой-то URL внутри письма имеется вредоносным Таким образом мы можем как бы реализовать несколько рассылок в одну говорить о том что все они являются вредоносными на следующем этапе происходит выделение признаков то есть условно на картинке показано что как будто бы алгоритмы Так видит письмо то есть выделяет какие-то некие объекты которые могут применяться дальнейшем бизнес лукакой для первичного анализа письма дальше запускается правило бизнес-логики правила бизнес-логики условно можно разделить на три части Первая это набор реалистических правил число в листических правил составляет на данный момент более 6000 То есть это какой-то набор проверок каких-то элементов письма дальше запускается на каждом письме более 20 мл моделей которые также формируют какой-то набор признаков и заключительный этап это поход большое количество баз данных за репутационными признаками за каким-то еще другими дополнительными данными в конечном итоге вот обрабатывая каждое письмо Мы формируем пул из более чем 2000 признаков на основе которых на основе этих двух тысяч признаков делается принимается собственно решением тот же слоя бизнес-логики является ли письмо сплавным тогда автоматически происходит письма то есть по сути письмо даже не доходит до пользователя является ли письмо потенциально вредоносным тогда оно появляется попадает папку спам и или письмо является хорошим тогда к нему начинает применяться правило пользователь фильтров и оно дальше уже попадает либо в inbox либо там Соответственно по папкам перемещается пользователя вот на весь цикл проверки у нас среднем есть 350 секунд а исходя из того что принципе сейчас рассказал кажется что алгоритм достаточно прост и есть как бы набор простых правил с помощью которых можно все запрограммировать если медленно работать накинуть больше железа и как бы это все заработает И спам сто процентов будет фильтроваться один достаточно известный человек в 2004 году также говорил что по его мнению в 2006 году спамом вообще не будет то есть за два года проблема спама будет решена этим известным человеком был Гейтс вот Ну давайте посмотрим Почему собственно Билл Гейтс был не прав опять Ну в первую очередь Какие технические вызовы У нас есть когда мы фильтруем спам Почему не все так просто в первую очередь конечно же нагрузка в Пике мы обрабатываем более миллиона писем в секунду соответственно мы должны вот в тот заданный период времени который мы говорили 50 миллисекунд принять решение является вредоносным или нет далее письмо может быть разный размер то есть вне зависимости от того имеет он размер несколько килобайт или несколько десятков мегабайт мы должны его обработать и принять решение за 350 секунд а также дополнительно техническим вызовом является то что письме часто недостаточно контента то есть достаточно сложно определить по письму является спауном или нет Если Оно содержит пару строчек в чем тут фишка что спамеры они как бы зная Ну Собственно как работает а не спам они пытаются контекст письма то есть грубо говоря смысловую нагрузку вынести куда-то дальше Либо они предлагают пользователя там Перезвоните мне свяжитесь со мной там выгодный тендер что-нибудь такое соответственно выносит куда-нибудь в мессенджеры либо это внешний ссылки Да перейдите по ссылке получите там дополнительную информацию Либо они пытаются тот же контекст перенести в точи например там какой-нибудь PDF Q либо какой-нибудь офисный документ где содержится дальнейшая информация Надежде что нам эти данные А из от точей то есть контекст будет вытащить сложнее а также дополнительная сложность является обратная шумная обратная связь я уже говорил ранее что мы обучаем свой алгоритмы на базе того как пользователь Ну отвечает как пользователи сообщает нам обратную связь то есть является письмо с Павлом или нет а само понятие спама и рассылки вредоносности оно достаточно субъективно Бывает так что пользователи если они подписались на какую-то рассылку Они ее получают потом им надоедает это рассылка им лень искать где кнопочка отписаться они нажимают на кнопку спам и собственно перестает получать эти данные Ну вот просьба большая не делайте так кнопочка отписаться есть в самом верху и это нам сильно упростит процесс собственно фильтрации спама также дополнительно по поводу шумной обратной связи спамер активно использует создание всяких авторезов ботов и так далее которые опять же на кликивают генерирует обратную связь на свои же письма либо на письма своих Ну можно сказать коллег Да и соответственно там отправляются вам на письмо А потом накликивают туда обратную связь что это письмо является не является спамом таким образом пытается как бы сделать так чтобы как можно больше людей увидели их письма Давайте немножко поговорим подробнее про активный спамеров спамеры это Живые люди из плоти и крови которые заработок которых Сколько денег Они получают напрямую зависит от того как хорошо Мы работаем если спам работает хорошо и их выручка снижается если антиспам работает плохо у них праздник Собственно как на чем основана их активность но так как мы на каждый спамерское письмо вынуждены генерировать реджект то они достаточно быстро получают обратную связь если какая-то рассылка закрыта То есть если письмо распознается как спам соответственно у них есть возможность достаточно быстро адаптироваться к изменениям изменять паттерные рассылки То есть если сегодня они рассылает вам какую-то рекламу в виде каких-то внешних ссылок то завтра уже этот паттер может измениться или не через несколько часов уже это может измениться также есть место реверс инжиниринга то есть Они активно пытаются всяческим образом понять вычислить как наши работает наш алгоритмы есть всякие теневые форумы на которых ребята обсуждают Да там как какие варианты есть какие эвристические правила там работают по их мнению и так далее Вот и как бы покупая взломанные ящики Или сами взламыванные ящики сразу же практически сразу же после того как ящик пользователя взламывается сразу же оттуда идет спам Ну вот соответственно также помимо взлома есть всякие автореги то есть аккаунты созданные только для того чтобы отправлять пример спамятка активности Также можно отнести активную эксплуатацию особенность того что компьютер и человек по-разному видит например etf8 символы соответственно как бы есть примеры защемления текста etf8 символа когда вот просто символ вставляется текст также примеры защемления HTML разметки когда в незначимые поля например вставляется отрывок из Войны и мира надеюсь на том что наш фан-фильтр Ну каким-то образом сломается Когда мы будем обрабатывать Это большой кусок например значимый для тех для пользователя текст мы не сможем работать а таким образом происходит такая классический пример гонки вооружений то есть по сути благодаря активности антиспама происходит развитие спамеров их технологий они вынуждены совершенствоваться производить какие-то дополнительные reesech развивает нас вынуждая нас бороться с такого рода спамом в конечном итоге получается что себестоимость отправки спама растет и соответственно по законам экономики Выгода от отправки спама снижается то есть по сути конкретном примере Да если брать эволюции за более чем 30 лет получается что спамеры должны тратить много денег и получает мало прибыли и соответственно в конечном итоге стратегии борьбы одна из стратегией борьбы с антиспамом сводится к тому чтобы сделать бизнес по миром не рентабельным Давайте тогда раз расскажем подробнее про то как развивался эволюция эти спама в 2006 году антиспам представлял собой набор неких сервисов на баш и перле который активно использовать regex 2008 году это уже был монолитно си плюс плюс благодаря тому что Поток Поток увеличивалась и возникла необходимость большей надежности больше управляемости когда число в российские правила начало расти и было сложно уже пихнуть это внутрь кода было сложно этим управлять появились отдельно люди которые не писали код который писали именно правила спама возникла необходимость вынести бизнес логики бизнес-логики на слой выше логика без логика было переведена вынесена на язык луа собственно Почему был выбран луа потому что это достаточно быстро и он очень легко интегрируется с плюс а дальше в начале десятых годов произошла может сказать эволюция в развитии маркетинга что я имею под этим виду что рассыльщики поняли что им важно заботиться о своей репутации о контенте который они рассылают соответственно рассылки стали выглядеть красиво удобно у них всех появилась кнопка отписаться соответственно с памером чтобы не затеряться в этой массе они тоже начали мимикрировать под такие рассылки то есть по сути рассылки спамерские практически перестали чем отличаться от обычных рассылок и в итоге чтобы нам отслеживать такого до рассылки эффективно бороться с паммерами мы внедрили достаточно сложные репутационные системы которые позволяют хранить репутации за различные промежутки времени и соответственно отслеживают динамику Как меняется репутация репутационной системы Ну закономерно тут появляется мэр который позволяет более эффективно повысить эффективность существующих правил и на основе существующих правил формировать новые признаки а немножко расскажу про eml как принципе эволюция самого мэли развивалась что началось все с линейных моделей как только линейной модели появились в МР они сразу дали достаточно большую эффективность и их стало появляться большое количество большое количество мэрия спровоцировало развитие инфраструктуры то есть нужно было развивать инфраструктуру с помощью которой можно было легко обучать диплоить инферить модели которые были большом количестве появлялись соответственно произошло дальше развитие инфраструктуры как только начали проверять модели стали замечать что полученные модели которые выкатывались на пруд через какое-то время они начинали деградировать деградация Возникала из-за естественных причин потому что паттерны менялись рассылок и так далее плюс вторым фактором деградации системы является опять же 10 деятельность паммеров то есть они видят что рассылки начали закрывать соответственно Они меняют паттерны и модель уже как бы хуже справляется с этими обязанностями соответственно возникла необходимость постоянно до обучения модели чтобы такое как бы деградации не происходило Ну и как практически следующий виток эволюции было появление трансформеров вот а тут Я внизу две ссылки указал здесь По ссылкам два таких хардкорных доклада по eml в которых очень подробно очень хорошо рассказывает про автообучение про NLP Трансформеры Роберт и соответственно одним из последних шагов развития эмэля является появление SR система вся система которая позволяет обрабатывая картинку то есть по картинке вытаскивать из нее текст и соответственно на основе этого текста уже понимать вам на контент или нет Так как тенденция последнего времени в том что спамные контент переносятся в картинке что же себя представляет сейчас они спам сейчас сейчас практически полностью содержится в кубери это дает нам возможности по отказоустойчиво масштабирование у нас больше 150 сервисов которые расположены на более 4 тысячах кодов и мы разрабатываем на c++ в основном конкретная мыли сейчас более 20 различных моделей уже там нет линейных моделей по-прежнему есть автообучение а развитие самих моделей привлеклись но дополнительно вылью самому продукту почту которая первоначально не предполагалось то что ну то есть они спам не должен это выходит немножко за рамки диспама то есть ml-модели умеет классифицировать и категоризировать письма Если вы пользуетесь почтой mail.ru Вы наверное видели что некоторые категории письмам сворачиваются в папочке для некоторых писем высвечивается определенная плашка например там письма с госуслуг билеты какие-то важные письма по ним автоматически появляется некая плашечка вот это как раз делает антиспам и для них также мы успешно справляемся с определением ботов то есть умеем определять что это бот и он автоматически зарегистрирован был умеем детектить то что ящик пользователя взломали достаточно быстро и блокировать к нему доступ чтобы не было рассылки вредоносной и не портилось репутация пользователя и ДТП брутфорс пользователи когда какой-то злоумышленник начинает перебирать пароли в целом получить доступ к пользователю так продуктовые требования к нашей системе принципе требует диктует какие-то условия к разработке то есть в целом я рассказал как на большом масштабе эволюционировала наш антиспам сейчас в принципе могу рассказать как валицирует он прямо сейчас требования продуктовые диктует нам требования к надежности То есть если антиспам по какой-то причине будет работать плохо или не будет работать течение какого-то времени пользователь получит большое количество спама и будут соответственно недовольны что кажется на продукте поэтому для любой разработки для любых сервисов У нас есть требования Slice и слов которые мы должны соблюдать также специфика разработки диктуют требования к темпарке то есть мы должны любой новый функционал который появляется мы должны достаточно быстро выкатывать на пруд потому что собственно все очень быстро меняется адаптируется и соответственно любой функционал должен появиться быстро не в течение нескольких месяцев Поэтому при требовании к надежности с одной стороны у нас появляется требования к быстрой доставке наоборот это мы должны делать несколько релизов в день и если касается бизнес-логики то это уже и речь идет о десятке правок бизнес логике в день также есть требования по масштабированию компонентов если взять классическую хоровую систему обычно у ней профиль достаточно стандартный то есть есть какой-то система которая более нагружена есть какая-то мелкий сервис который менее нагружены и динамика сильно не меняется если брать речь антиспами то там немножко не так то есть любое подсистема может быть профиль нагрузки может существенно измениться в течение дня например пришел какой-то новый спамер который ссылается новый тип спама который сильно нагружает нашу подсистему там которые обрабатывает картинки или многократно увеличивается нагрузка на систему урлами поэтому мы должны быть готовым что любой система должна быть масштабироваться и Быть готовым к разным увеличению нагрузки а обратный эффект то что мы должны опять же чтобы экономить ресурсы иметь возможность Например если какая-то система не нагружена отмасштабировать ее так чтобы она Ну условно не курила и не требовала ресурса требования к надежности диктует как бы необходимость гибкого управления логикой работы Что это значит Это значит что мы можем должны иметь возможность на лету включать и прокачать какую-то посистему условно если какая-то база данных работает плохо и какая-то система из-за этого перестает отвечать выдавать какие-то признаки мы должны иметь возможность чтобы система не тормозила чтобы мы не тратили дополнительное время на походы к этой базан база данных выключили это по системе при этом это не должно сказываться на стабильности работы самого антиспама соответственно мы при разработке нового функционала Мы должны предусматривать наличие такого рода ручек чтобы каждому национальному Можно либо быть включен выключен либо мог настроить менять настройку на лету его работу Ну и конечно же мониторинг любой новый функционал должен быть обвешен достаточно большим количеством метрик чтобы можно было по метрикам как раз следить превентивно отслеживать различного рода алерты и следить за производительностью на базе метрик Можно опять же строить какие-то правила бизнес логики по автоматическому масштабированию компонентов заключение об тестирование конечно же то есть новый функционал желательно выкатывать через обе тестирование то есть Сначала это есть выкатывание на процентного функционала отслеживания с помощью мониторинга и потом собственно Когда уже все проверено и протестировано выкатывается тест на пруд мы используем полезные общепринятые практики при разработке которые позволяют нам добиться надежности нашей системы это в первую очередь или перспективный анализ проблем то есть каждая проблема которая произошла мы пытаемся понять В чём родкоз этой проблемы почему так произошло и соответственно формировать какие-то требования Чтобы такого больше не повторилось Ну конечно нет менеджмент если какая-то в большая масштабная авария произошла формируется по спортам на основе него формируется задачки которые с высоким приоритетом решаются и делаются соответственно решение на основе как раз эти постмортаном архитектура может претерпеть значительные изменения Ну и как Вишенка на торте это регулярное учение подказоустойчивости мы применяем практику что раз в месяц отключаем дата-центры наши и смотрим Какие системы по сути после этого деградировали где отказа устойчивость была нарушена и соответственно пытаемся устранить эти ботулки чтобы При следующем учении таких проблем не возникло Ну и заключение несмотря на вот эти все полезные практики которые происходят конечно же бывает проблемы когда все что все пошло не так один одно из этой проблемы я сейчас расскажу представьте себе два сервиса сервис взаимодействие сервисом B сервис а состоит из более 1000 поводов сервис B на котором происходит из 100 пудов и взаимодействие классические между ними происходит а выставлен тайм-аут э-э на 50 МС в котором мы ожидаем что сервис B ответит сервису А и как бы Казалось бы Всё достаточно хорошо всё быстро работает но тут Однажды произошло не забыл незапланированное переключение на МРТ то есть модель была выключена в prod но не должна была быть включена и по ряду с течением обстоятельства она была её включили раньше чем ожидалось и что по факту произошло что при вызове этой модели она сразу же возвращала ошибку так как в рамках окна 50 миллисекунд так как модель возвращала ошибку чении там единиц миллисекунд то в рамках окна в 50 миллисекунд мы могли получить таких сходить в сервис B и получить ошибку много раз и таким образом получил получилось такая эффект самодоста то есть нагрузка на сервисы увеличилось больше чем сто раз за счет многократного увеличения на сеть на сервис и так далее сво сервиса снизился в 5 раз его пришлось можно сказать отключить То есть за рейт ли метить походы в него чтобы это не привело деградации самого сервиса и ну ошибку устранили после этого провели по спортом в результате которого выяснили раткос проблемы которая произошла и были выполнены доработки то есть обертку сервиса а доработали таким образом чтобы помимо факта самого ошибки внутри Мы понимали контекстные ошибки то есть данном случае что понимали что произошла такой-то тип ошибки по которой бесполезно делать и соответственно число ошибок с которыми мы Обращаемся также в ходе системы было выявлено очень полезное замечание что наша система балансировки нагрузки работала Не идеально в том смысле что если какой-то сервис начинал сбоить и работать выдавать большое количество ошибок мы не не пессимизировали запросы к нему и соответственно он получал продолжал получать запросы таким образом внося дополнительный фон ошибок соответственно мы внесли доработали нашу систему балансировки в конечном итоге по результату sls-сервиса вас рост до 4 девяток И самое главное что после того как мы сделали повторное учение после устранения этих проблем повторный учение прошли успешно то есть подобная подобная ситуация не привела Никакому деградацию сервиса спасибо на этом все слушать ваши вопросы Да Вопросов много Это хорошо можно вот у вас микрофончик а Да привет Спасибо за интересный доклад у меня вот два таких вопроса первое а используете ли вы в антиспами какие-то белые списки то есть для вас же понятно чтобы услуги или Сбербанк не могут спамить И зачем на них тратить время белые списки конечно же есть И второй вопрос откуда взялась всё-таки вот эта цифра именно 350 миллисекунд но придёт письмо задержкой в минуту пользователя он же этого всё равно не заметит Да э-э от э-э Хороший вопрос по поводу 350 секунд это по сути эмпирическая число Дело в том что конечно же 350 м/с никто не заметит но очереди есть очереди если каждое письмо будет обрабатывать больше чем 35 МС то А между почтой антиспамом вырастут глобальные очереди что приведёт тому что письмо где-то из верхушки очереди может идти больше чем минуту больше там ну не буду говорить полчаса но существенное время А вы именно шли к этому показателю Или вы его добились и озвучили То есть вы взяли разделили количество писем на время обработки получили 350 миллисекунд и мы стояла задача именно добиться 350 это было число мы не шли мы просто мы по фактически идем к уменьшению числа очередей и как бы эмпирически видно да что если при текущем конфигурации железа да А если у нас всё хорошо то медианное время обработки писем там меньше семи секунд поэтому это число взято как вот такое некое а Sli для наших сервисов Чтобы понимать что всё идёт хорошо спасибо Спасибо за доклад У меня вопрос Почему Отказались от линейных моделей и какие сейчас модели приносят наиболее Ну наибольший эффект вообще в антиспам-детект Но почему по поводу линейных моделей отказались Наверное потому что есть модели с большей эффективностью которые на выходе дает больше признаков Почему собственно какие из моделей имеет больший эффект тут сказать сложно во-первых это надо наверное более глубоко погружаться в мл что данном случае я не специалист по eml А во-вторых тут просто все модели они имеют немножко разный Профиль то есть есть модели которые детектят Фишинг есть модель которая детектор там новый вычислять текст Шида то есть на основе какие-то писемляют Хеш которые вычисляет похожесть двух текстов как бы можно сказать что все эти модели они работают как некие то есть они работают сообща и поэтому как бы эффективность конкретной модели сказать Наверное сложно просто удивительно именно что полностью ушли от линейных моделей как будто они прекратили привносить какой-то эффект и хотелось стояла вроде как переобучение постоянно Нет они действительно просто по факту как бы эволюционировать Да и по сути приходит на смену модели который показывает большую точность больше то есть лучше числовые характеристики поэтому как бы с ними работать проще если интересно опять же Вот там две ссылки есть как когда вот в Первый из них наш там руководитель который занимается мелем он достаточно подробно рассказывает вот этот эволюцию именно в эмэле Как появились линейные модели как они эволюционировали и Собственно как реализовано было автообучение спасибо Спасибо за доклад вопрос первый Почему когда вы выявляете спам не заблокировать бы отправителя сразу а потому что по России мы должны не заблокировать отправителя Ну да я имею вы же знаете сервер который отправил И все последующие сообщения по идее должны быть оттуда уже спамы а не факт Потому что во-первых есть такая неприятная штука Как ложноположительный срабатывание То есть наверное самое худшее Что может случиться когда мы заблокируем пользователя который не является спамером это очень-очень неприятно будет теперь да то есть мы блокируем конкретных пользователей Когда уже ну прям явно видно что это спам и от него идет только спам То есть если грубо говоря есть какой-то порог тогда он блокируется и системами которые по репутации пользователи Хорошо тогда от этого следующий вопрос вы сказали о том что невыгодно стало рассылать менее выгодно менее выгодно менее более затратным но не стало ли для вас более затратно иметь 4000 подав для того чтобы этот спам уничтожать и иметь только сотрудников для того чтобы это обслуживать нет и учитывая учитывая такой огромный опыт mail.ru не было ли какой-нибудь инициативы подобной той которую сказал некогда Билл Гейтс предлагал Видимо как раз в то время 2004 год предлагал избавиться от спама тем что ввести платные платные услуги за отправку почты электронной Вот такая инициатива учитывая что сейчас есть различные системы на основе биткоинов Я не говорю что именно биткоины а децентрализованные сети не было ли такой какой-то инициативы и предложения сложно сказать была такая инициатива или нет наверное была как бы потому что вот это вот история с белым гейтсом она действительно слуху А собственно Почему мы опять же отталкиваемся от продукта от желаний пользователей если мы мы будем какие-то кардинально менять какие-то требования и просить их как-то существенно переменять свою логику там добавлять какие-то дополнительные проверки то это придет тому что мы просто потеряем пользователей потому что большинство конечно наших пользователей То есть у нас достаточно много пользователей которые являются мелкими рассыльщиками которые не могут нормально настроить там таким и прочие базовые вещи которые мы не можем как бы просто так их блокировать поэтому как бы инициативы конечно же такие есть но пока они наверное не применимы потому что первую очередь Они наверное ударят по пользователям опять же есть конкурентная среда есть другие почты крупные достаточно которые Ну не делать не есть не делают так и поэтому как бы мы не можем можно сказать также поступить Ну вообще вопрос интересный Да спасибо спасибо за ответы Спасибо за доклад не вопрос про eml Вот вы внедрили его используете А вы не думали что спамеры тоже используют эмаль я уверен что они используют может быть это война будет вечной А ну я надеюсь что то есть Я уверен что когда-нибудь они просто переключится на какие-то другие системы то есть ну как бы Зачем ему отправлять спам по e-mail если есть какие-то другие способы например там не знаю через Telegram Ну и как бы хотелось бы услышать ваше мнение как Билл Гейтс сказал Вы можете спрогнозировать или нет исчезнет В каком году Нет я прогнозировать Не берусь потому что ну это неблагодарное достаточно дело Я верю что то есть Судя по статистике год от года спама становится меньше Вот люди меньше почты пользуются на самом деле на самом деле кажется что это так но на самом деле объем почты растет год года это невероятно на подъем спама и объем спама и объем почты Там как бы прописали растет а если брать то есть число писем растет число пам спама пропорционально растет но число спама которое доходит от пользователя оно уменьшается Ну то есть вы без работы не останетесь Спасибо к счастью на базе антиспама реализуется достаточно много всяких разных интересных технологий которым можно применить в других сервисах компании тут еще вопрос такой больше не проспам Наверное профишинг если массово верная какая-то рассылка Понятно А если целевая атака можно как-то предсказать а целевая целевая атака Она имеет какой-то вектор и который также как бы ну это наверное другая немножко другого рода задача но она также решается Да тот же Фишинг он блокируется на базе других признаков просто для него наверное не работает каких-то признак массовости то есть статистические Фишинг не вы не вычленить то есть всякие репутационные системы там Практически бесполезны там вот применяется более активная мыль технологии и другие признаки которые характерны для фишек Ну добрый день спасибо за доклад вы упомянули цифру в 6 тысяч евристик более 6000 с точки зрения разработки Как вам удалось Какого размера должна быть Команда чтобы написать 6 тысяч евристик как минимум Сколько времени это может занять у команды разработки и более насущный вопрос 350 миллисекунд обработка одного письма и если поделить 350 миллисекунд на 6 тысяч евристик это получится 50 микросекундные сюда еще включается eml-модели как вам вообще это удалось может быть у вас есть какие-то свои фреймворки и спасибо очень интересный вопрос во-первых про Команду у нас команда небольшая то есть размер точно сказать не смогу но это больше 10 меньше 50 человек эти правила они ну как бы писались не за год они там есть какие-то старые правила актуальные есть новые правила Дело в том что во время запуска письма То есть я первоначально говорил да что есть набор выделяемых первоначально признаков на основании этого набора признаков понятно уже грубо говоря есть какой-то ветвление да на основе которого понятно что нужно запустить какие-то эвристики из этого набора то есть не все 6000 в листик пробегаются просто 6000 опций они есть но вот как бы конкретно понятно что вот письмо пришло из какого-то похожие на Фишинг грубо говоря Значит нужно напустить такие-то модели и запустить такой-то наборы в листик каждая в листики они обрабатывают достаточно быстро там идет о каких-то миллисекундах сколько на каждом письме запускается в рестик и моделей это опять же вот сложно сказать а так я ответил Вроде на все вопросы или нет спасибо спасибо большое за доклад мой вопрос будет может быть немножко парадоксальным но вы упомянули вот эти вот теневые чатики да и я хотел спросить Можете ли вы рассказать может быть какой-то случай что из этих чатиков было подчеркнуто что-то как раз полезное что чтобы внедрить Спасибо Спасибо у нас есть анекдот немножко немножко не из этой роли когда спам аналитики у нас начали в общем какие-то ребята спамеры Начали открывать письма есть такая часть письма как эпилог Вот и некоторые спамеры Непонятно вообще не начали в этот блок вставлять Ну типа личные сообщения типа ребята спамом аналитики Если вы насчитаете как бы не читайте этот Пилот он вам не нужен что типа такого вот и как бы получился такой увлекательный диалог между спамерами и аналитиками в целом как бы я не могу сказать как часто происходит вот мониторинг эти если сейчас смысл мониторить форму или нет кто-нибудь на постоянной основе это делает Я думаю что возможно делают возможно какие-то правила оттуда достаются из этих форумов да Спасибо за доклад предположим что все-таки произошла беда И у нас ложная положительная срабатывание что я могу как владелец рассылки предпринять для того чтобы мое письмо исключился спама насколько вообще автоматизирован этот процесс и Насколько сложно это сделать но на самом деле ложном положительно срабатывания там по сути процедура это надо идти через форму Как называется техподдержки да то есть обратиться к службе поддержки сообщить что вот Извините там меня заблокировали по ошибке и соответственно на основе этого будет создан инцидент который будет обработан и внесены коррективы и письмо соответственно сразу же будет появится если это действительно ложная положительная срабатывание в целом как бы сами ложные положительные срабатывания они тоже детектится и есть большая вероятность очень большая вероятность в том что они как бы без необходимости обращения вернуться через какое-то время когда аналитики заметят о том что вот пошел фон должен был жить не срабатывания из-за какой-то ошибки то есть обратно То есть даже после обработки события письмо которое было заставлено ранее может быть обратного Спасибо И второй вопрос от 350 миллисекунд если за это время вы не успели обработать письмо то есть какой-то определенный результат возвращается что-то не спам правильно а там логика такая что если он есть у нас какое-то окно в течение которого мы должны принять решение о том является письмо вредоносным или нет Если мы в течение этого окна окно выше все-таки чем 350 секунд Оно просто варьируется поэтому конкретные цифры не назову если в течение этого времени которое несколько переповторов несколько перепроверг мы не смогли выдать решение и проверить письмо письмо попадает в папку пользователя но после этого у нас вот этот проверка секунд она обязательно для всех но последующие письма они все равно проходят ряд проверок десятки и вот этот попадание спамного письма в inbox пользователя может пропасть Просто может получиться Так что пользователь уже успеет его прочесть в соответствии с этим получается для вас важен порядок которым письмо проходит через весь paypeline то есть есть какие-то методики по которому перемещаются там порядок обработки и так далее связи там с тем что просто не успеваете очередей конечно же разное количество принципе сам по плану не смогу рассказать да По какому признаку эти очереди А приоритизируются и так далее То есть есть различные механизмы которые защищают например от случай когда появился новый домен только что регистрированный и Мы ничем не знаем это соответственно одна очередь если это какие-то крупные рассыльщики типа Яндекса мейла там действуют другая схема если это какой-то там подозрительные еспрессорщик это там третий пайплайн для каждого из них есть разные правила спасибо спасибо за доклад Константин хотел спросить по поводу отказа устойчивости вот вашего тестирования с отключением дата-центров Это относится только к вашей вот системе в кубе ли которая находится или вот сама очередь писем тоже тестируется Ну там несколько учений по сути есть учение и в кубери да Когда в кубери выключается какие-то подсистемы есть и учения которые касается вот ну серверов которые вне клубе находится те же очереди то есть отказа устойчивость касается всей всех подсистем и все как бы затрагивают Привет коллеги Спасибо большое Кость не устал Нет еще есть один вопрос тогда тебя Ты как раз про Фолз Позитив начал говорить коллега из чата спрашивает про А сколько их Ну давай так он спросил А сколько их происходит насколько много Да примерно как вот Ну примерно примерно цифры сказать не могу носить их это такое можно сказать один из самых неприятных штук которые есть и с ними как бы активно борется именно коллеги бизнеса аналитики которые следят э-э за такого рода вещами обрабатывают обращение от пользователей конкретные цифры к сожалению не смогу сказать Хорошо Кость тогда у нас приятная часть вспомнить троих человек который тебе больше всего запомнили Да я попробую вспомнить первый мне понравился очень вопрос про 350 МС И откуда мы взяли эти Циферки по-моему Да вопросы был это я бы сказал первый приз второй приз Да вот вот здесь вот очень замечательный был вопрос именно серия по поводу того как мы можем обрабатывать за несколько микросекунд Вот и третий вопрос я бы вот после один из последних товарищей вон там задавал вопрос Да по поводу вот э-э там серии вопросов было Вот я могу принципе немножко рассказать о призах они тоже тематические помимо за первое место а во отлично это выкашный Пинг Не очень видно Но похоже он релизил в пятницу И вот у него такое лицо да да вот а вот символ спам Да вот это получается туда Да это по сути это не точно но возможно он поможет вам как-то защититься спама потом Расскажите Насколько этот артефакт помогает вот а Третий третий вот сюда все призы нашли своих обладателей Спасибо большое коллеги"
}