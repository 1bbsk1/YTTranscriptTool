{
  "video_id": "jHpyQzjStTg",
  "channel": "HighLoadChannel",
  "title": "Платформа для любой биометрии / Сергей Браун, Артур Душелюбов (РТ Лабс)",
  "views": 1006,
  "duration": 3044,
  "published": "2021-10-04T02:29:37-07:00",
  "text": "сегодня будет доклад о платформе для любой геометрии о том какие мы встретили проблемы как мы их решали и вообще о том как устроена единой биометрическая система рассказываем мы это артур душ любов я сергей бравым разрабатываем эту систему с семнадцатого года он презентаций ура спасибо соответственно работаем в компании рта labs основной подрядчик ну вот что-то делаем давайте посмотрим что же это за система то такая когда-то подумала наши дорогой государстве говорит а давайте мы сделаем геометрию для государства ну хорошо как это все организовать давайте построим большую надежную систему где все будем делать аккуратный предоставлять самые разные услуги для того чтобы например сдать биометрию в систему можно пойти в любой банк нас куча банков подключен у вас там сфотографирует голос записан и прессуются к нам чтобы воспользоваться соответственно тот сервис который интегрируется с нами работает вот тут какие примеры есть ночь все про бизнес давайте пойдем дальше с чем мы столкнулись у нас возникли такие простые вопросы а давайте посмотрим что есть на рынке мы не хотим изобретать велосипеды мы знаем отлично очень много коллег работают с биометрии самый разный мы говорим о windows кириши не здорово есть куча различных характеристик у каждого процессора 1 работает лучше другое хуже ту этот в темноте отчеты видит этот не видит ничего ведь и уют ребята с голосом дружить понятно зоопарк полный не россетти сами знаете модная штука развиваются все время растут отчет перри обучает используют здорово но у нас задачках быть бендер агностика нам надо работать на государство поэтому ну что-то с этим зоопарком делать надо с другой стороны из вопросов безопасности когда к нам приходит человек он для нас здесь как бы платформа находится в удаленном канале его мы не видим мы не знаем что происходит с ним где он как он нам надо как понять что это вообще нами фотографию прислали не просто человека там не знаю листочек сфоткали поставлены в стакан воды или еще что-нибудь а может злоумышленники видео смонтировали нам тоже представляются кем-то ну с этим надо бороться и третья проблема это бизнес который всегда хочет узнать дорогие друзья у вас тут всякое распознавание вероятности а как с этим жить то вообще говорим ну хорошо давайте посчитаем риски ну выводы посмотрев на рынок мы сделали примерно такие давайте работать сразу со многими модальностей сразу со многими дарами будем брать от каждого лучше дам надо учесть что надо отбиться от атак посмотрим как это сделать ну и все это конечно надо сделать и без потерь данных и отказывай устойчивые и под нагрузкой не разъехаться ну как то так давайте посмотрим что мы делаем для начала маленькая история про нейросети все знают как они работают и работают загадочно если мы возьмем и кинем пару фоточек попросим какого-нибудь вендора сравнить один нам скажет 42 другой скажет 78 3 скажет 33 мы такие скажем макияж тоже это значит г-н мэр вам хорошо скажет слушай ну вот если у вас скоро 42 то соответственно ошибка первого второго рода у вас будет вот такая ладно хорошо если 43 ну вот такая потом ты думаешь ну хорошо все у вас как бы там пять девять десять минут 7 точность чудесные графики в маркетинге вы все про приносите но когда ты берешь и проверяешь все немножко и так никого не хочу обидеть жизнь суровая нам пришлось что сделать собрать собственную базу образцов на который все мерить самим мы берем считаем берем замечательный гост открываем пишем кучу кода ага здорово давайте посчитаем теперь реальной вероятности для каждого скоро этого вендора после этого когда мы будем работать с такими вендорами нам будет понятно что они говорят то есть он скажет 42 мы поймём эти вот этого vendor 42 это хорошая история там точность 10 минус 7 например ну классно ошибка второго рода понятной можно пользоваться ну нас чуть-чуть про архитектуру архитекторы любят рисовать квадрат и вот план квадратов примерно такой один квадратик мы пробежали вот да мы померили показатели что еще делаем ну у нас есть куча вендоров они применяют чё ты чё там делают у каждого своя платформа своя фишка ухо ну в силу того что мы государственные мне сказали ну слушайте друзья давайте вот вам стандартная пищи к очень простая всего пара методов будьте добры кто хочет нам стать пожалуйста и и реализуйте и как ни странно многие смогли сделать для того чтобы использовать разных вендоров вставить их в разное время у нас есть отдельные процессы переиндексации данных и перерегистрации как это все выглядит она выглядит примерно так для нас гендер это такой black box который мы ставим куда-то закидываем перед ним ставим замечательным образом любимый всеми индекс игр но вот у нас есть балансировка классно этого vendor можно поставить 10 копий 20 так как бы при эксплуатации посмотрим даже если он медленный ну хорошо размажем нагрузку что происходит когда к нам приходит биометрия ну например фоточка сначала оно пришло от куб там издалека мы берем читаем окей о чем фотка хорошо берем смотрим в конфиг говорим о кей сколько у нас вендоров но например 6 хорошо каждому из них говорим на тебе пожалуйста фоточку дай пожалуйста вектор он же шаблон вентр чинить отвечает ну к сожалению не всегда не все вендоры из тех фоток извлекают данные ну ничего бывает мы запишем все что не смогли сделать соберем сложим у себя куда-нибудь когда приходит к нам какой-то новый вендор мы берем ну вы со конечно же сохранили надежным образом эту фоточку сохранили все извлеченные виктора поставили нового вендора взяли жук прогнали все вход в котором нас актуально через этого вендора тоже самое делаем и со звуком и с чем угодно в систему можно просто накликать какая у тебя там модальность ну вот и на сетчатку глаза да пожалуйста нам все равно это все не зависит от модальности как выглядит описка которую делают вендор ну вот примерно как-то так всего совсем просто мы берем говорим дорогие друзья для того чтобы получить вектор вот вам соответственно фотография может быть к ней какие-нибудь там метаданные прилеплены летопись к слева например экстракт когда нам надо сравнить две фоточки мы кинем вендору в другую пешку скажем вот пожалуйста два вектора скажи пожалуйста это вообще похоже или похоже вот примерно так мы закрыли следующих квадратик ну хорошо сделали мы разных вин даров ну классно а как что еще если биометрии мы говорили что надо проверять что-то про безопасности давайте посмотрим на рынке есть опять куча разных решений много хороших например что можно проверить можно проверить чуть живой человек что это нам ни подставили фотку и правее когда нам кто-то прислал фотографию мы можем сверить ну кинуть эту фоточку на специальный движок он скажет скорее всего это живой человек настоящая фотка все здорово таких решений очень много очень простых делают много компаний разницы в чем какие-то хорошо видят подделки например на веб-камере какие-то видит хорошо подделки на фотке сняты с телефона поэтому приходится обязательных комбинировать для того чтоб действительно удостовериться человек живой другой вариант можно не по фотке можем по голосу третий вариант можно вообще скомбинировать эту историю и сказать о'кейа давайте вот видео возьмем а давайте сразу и по голосу и по лицу и по видео и уж про посмотрим в человек рот открывает и правильной буквы говорит и цифры произносит хорошо и вообще это не монтаж ну как быть ну как как приходится делать все до берем делаем подход применяем абсолютно такой же как только что я рассказал про винда робко да точно также считаем ладно с обычным windovs ким решением с единой опечаткой кому интересно может пойти на портал прочитать эту записку ну ладно вроде тут с вот как-то мы разобрались с вендорами и так ну более менее понятно ну что же такое за биометрия к нам приезжает а жизнь оказалась такого что мы хотим проверять человека который хочет например открыть счет как вы операция так не сам простая да как бы хочется очень надежно проверить что действительно он поэтому приходится с устройства получать данные в виде видео ну потому что самый надежный life нас все таки такой это видео весит немножечко мегабайт 20 на транзакцию соответственно если подумать нам нужно транспортировать и фотографию что такое фотография хорошая сну легко мегабайт а еще вендоры работают чудные вендоры в некоторые по звуку например там звук даешь 30 килобайт он тигр этот тебе вектор метровый что ну ладно как то это надо передвигать по системе давайте посмотрим что может быть здесь я думаю что здесь история такого отличного решения которым все знают на х его вреда артур игрищ расскажешь нашей особенностью или может мы пропустим и все знают как работает кафка даже не знаю все знает как работает каско если переходить конкретно к сути того как она работает у нас по факту мы взяли совершенно довольно подходящие стандартное решение для передачи данных как вот сказал сергей раз уже нас летают бега бантики той десятки мегабайт и к вто давайте возьмём что-нибудь подходящее для передачи брест раз не очень хотелось поэтому давайте возьмем что не сделаем в качестве шип взяли соответственно в кафку почему взяли кафку потому что она довольно проста и эффективна вот нам показалось на тот момент для решения таких задач до сих пор пока что вполне справляется со своими задачами обязанностями в частности ну нарезали в очереди поставили модуль key module by там двух сторон стоят один пишет второй читает может быть их с одной из сторон их может быть очевидно там несколько может несколько пишем несколько читают за счет этого мы как бы посмотрели на кафку и подумали что нам вполне подходит дать дайте две ну и дальше вот как на картинке можете видеть понеслось там куча машин куча очередей много читателей и писателей то есть это такая среда обмена данными между модулями то есть это в чистом виде мы ее называем шин так как кафка она вроде довольно просто но при этом одна она одновременно с этим оно еще имеет ряд механизмов внутри себя такие там как то что она не децентрализованное за счет этого нам позволяют позволил нам просто взять там кучку машин дисочки в них понапихать и вот собственно при тем самым вроде как малой кровью закрыв возможность во первых а масштабирую вторых воспользоваться ее там стандартный механизм балансировки который за счет которых в общем то читатели имеем имеет полное право там то отваливаться приходить и уходить как бы моим там сами решает чем нам дел давай добавлю здесь смотрите история то какая мы говорили про надежность да штук в чем здесь можно что делать если отлетел какой-нибудь консьюмер да это один экземпляр одного модуля то ничего страшного капканом даст возможность когда этот модуль грохнулся пусть вся вода упала пусть весь сервак такие же копии этого модуль автоматически получит все механизме канавки все данные к себе если они не если у нас потребитель не обработал сообщений он для кафки ване комитет ну все соответственно если он сдохнет ну ладно кто нет другой подхватит сделает ну соответственно постольку поскольку она основана в первую очередь на том что нам просто тупо живет в основном на риск то есть это такой в чистом виде очень похожи на нет это по факту это реально журнал больше чем наверное очень по крайней мере мне так кажется отсюда нам в общем то она позволяет записали в нее до на наши там сложил на диске все и она лежит как правильно сказал сергей страну от реплицироваться мы осознанно идем на то что ждем при записи с каждого из наших модулей мы там осознанно идем на то что мы ждем аки от всех имеющихся в кластере брокеров ну и соответственно и самому во всех записалась значит там потерять ну как минимум там хотя бы треть тех же реплик ну этот ну так скорее всего будет работать даже не особо заметен опять же так как в силу того что кафка поделен внутри себя еще не просто совсем плоский такой поток данных там еще есть разделение на партиции и за счет этого то можно даже кусочки это там выпал у нас там портится что поделать дымка это время без них живем на оставшихся партиях на опять же тем самым за счет количества портится увеличим просто потенциально возможно колю количество читателей ну и как я в самом начале про репликацию говорят сказал что там есть диски ну нам там быстрые дорогие диски не нужны поэтому мы взяли там обычные шпинделе дешевые относительно поставили любо-дорого посмотреть называется соответственно диски можно точно также вполне себе менять за счет того что репликация позволяет это делать но если у нас там чё-то выйдет из строя чисто механически или там совсем не восстановим по сатурну в заменим значит ничего страшного ну и вполне наверное логичный вопрос почему то мне что-нибудь кроме кафки там чему например не тот же робин ну основное скажем так основное отличие ну точнее основная разница которая нам сказала что вам нужно кафка ребята это вот было ровно таки такой первый пункт децентрализации потому что у того же например рыбе то у них есть центр all star да у них он вполне себе там иметь свои механизмы отказоустойчивости но с одной стороны во первых там он не очень на наш взгляд кажется все таки до сих пор ищу предназначен даже в него довольно больно совать какого-то ощутимого объема сообщения при этом чае разному постоянно объема там-то верху вниз к чуть не очень понятно как он себя будет вести плюс соответствует центральный штор и довольно такая плотная связь с памятью ну и также кроме кроме этого в особенность других решений типа того же там кролика заключается в том что у них механизм чтения общения со щелями он построен на том что если потребитель забрал то что отправили тону это считается забором и в кадке в силу того что она ближе к журналу она там немножко не так там прочитал потребитель хорошо не прочитал неважно но там так и будет лежать до тех пор пока не наступит этом определенная политика по месту и по время ну тогда уже будет вычищать ну и соответственно дает этот такой основаны 2 вот именно пункт того что на мне очень хотелось устраивать там сложный можете узнать какие-то там хитрые съемки стройке проще записать один раз всякому на одну придут прочитают ну еще добавлю что капканом чем оказалось просто мы всю архитектуру системы построили в основном в режиме pipeline of то есть это прямой поток когда нам не нужен от очереди роутинг но вот в тех случаях когда нам стало его немножко надо у паука вкус к решение ничего ну была идея что может быть не пойдет мне как сказал не погодите у нас на этот случай есть выход вот стримы мы вам привезли там какой-то из версий кафки недавно уже давно появились ну и собственно вопрос сможете зация он в общем целом отпал то есть так как есть кавказ 3 мы поставили воткнули там где нам надо поменять ник и pipeline либо сделать у него какой там отдельный логику обработки состоянием соответственно просто воспользовались уже встроенным логикой самой кафки и вполне удобным д с элем с возможностью если что потом опять же за счет тех механизмов поведения журнал пири-пири обработать если что-то пошло не так ну и в целом ограничение на мне притащила задачу по сну поставили 1-му дорог с как стримом из агрегировать то что нужно общем-то получили конечный результат сказали что обработано ну взяла логику надо рассказать коленный кошмары если у нас на вход что-то пришло нам надо где-то работу разветвить и собрать воедино дождаться результата например здесь нарисована картиночка дальше еще увидим что мы работаем в районе там с несколькими вендорами как говорили и слои властями все результата нам надо собрать вот прям отличный кейс когда нам помогают стримы именно вот в таком режиме и так мы достроили еще один квадратик нашей замечательной архитектурой когда построить то построили транспорт есть хорошо опускать по систем можно ну какой у нас вопрос ну теперь надо это как и когда когда из дороги до что-то перемещается давайте куда-нибудь это все-таки привезем видел не положим но мы вот как-то посмотрели сказали что есть вот эти вот странные данные какие-то которые у нас ходят очень неструктурированные непонятны ну для странного непонятного ну вполне себе есть отличное решение которое не знаю там все говорят ходу ходов hb и сном и вот казалось бы все горит от big date технолоджи но нет мы ими просто пользуемся совершенно неправильно но нам почему-то понравилось давайте попробуем разобраться почему ну собственно основная эта идея заключалась в том что почему опять же те же самые тот же самый аж bass поверх того же самого ходу все довольно просто и банально силу того что hbs вот такая некая скажем так column арка выросший из big time of в ней есть свой ряд особенностей в том как она хранится на самом деле по дискам сам внизу так как там внизу есть есть преимущество xk dfs соответственно может жить на распределенной fest получается так что в силу того что есть такое понятие как регион сервера ваш базе есть такое понятие как регионы они по факту являются такими ну по большей части там такая единица хранения при этом они мало того что хранятся такими обособленным самостоятельными кусками то бишь и каждый это довольно большой кусок может развалиться живем натхо dfs может развалиться на блоке dfs а что дальше уже развалится на файлы в обычной флешки в диск на машины что опять нас возвращать потому что у нас есть кучка дешевых шпинделей почему не попользовать их примерно для того же самого что и вставки он радовался диски ровно те же совершенно спокойно кладем раскладываем соответственно логика сбора данных вот она как-то так выглядит соответственно и регион сервер отвечает за регион раскладывает ну он управляет одним или несколькими регионами дальше это все проваливается в dfs здесь здравствуйте тот реплика фактор который ты настроил потерять что-нибудь очень трудно ну если посмотреть как это все бьется с тем что говорили про передачу биометрии там про прогон сообщение дмитрий по кафке все опять же довольно просто так как у нас есть некий не некие однотипные данные ну однотипные с точки зрения того как они выглядят то есть могут быть например данные размером там в 10 мегабайт а то и больше могут быть например данные килобайта войну вполне в принципе логичных по какому-то никому признаку между собой разделить чтобы не перемешивать и более или менее равномерно и все сложить ну и соответственно в качестве механизм решение этой проблемы взяли что реально просто таблицы с болезный так как у них есть такое понятие как калум families являющиеся чуть ранее смотрели они по факту это просто такое объединение скажем так данных которые дальше уже внизу разваливать собственно опять же на регионы но тем ни менее хранится на одним единым куском ему сказали да почему нет давайте поделим грубая один колумб family одна какая-то модальность то есть это может быть либо звук отдельно там либо голос либо еще что-нибудь но при этом там покрутим чуть-чуть параметры настроек hb и за чтобы он там чувствуется чуть чуть попроще по подкрутим ему размер региона постоянно 10 гигабайт и там не будем умирать на об стоянок compaq шинах либо на там сложных перебалансировка таблиц регионов будет не очень много данных тяжелый тяжелый 10 гигабайт ну да мне миллион и миллион ские влазит поэтому в принципе вполне немного опять же дешево сердито получается я тут добавлю что до рекомендация стандартные если вы посмотрите для базы по настройкам делать регионы поменьше причиной тому является логика того как он работает когда вы что-то пишете у него этот вид весь каллум family начинает схлопываться и собираться или в разбиваться наоборот это одна из самых тяжелых операций для hp и за и кушает памятью ну а кушает он ее по количеству объектов в силу того что у нас объект достаточно крупные мы как раз и можем себе позволить сказать окей мы возьмем сделаем большой регион и они будут поменять но просто потратим сильно меньше ресурсы на них но при этом опять же за счет того что она довольна таким равномерным слоем ляжет в феску размажется по итогу на диски на машины и мы не приедем опять же в то что у нас там какая-то одна машина чем красное из за того что там на ней одна большая таблица одним большим регионам который там никак не отмасштабировать здесь с этим все несколько проще ну и чем заканчивается в итоге отделение как ты о том достичь этого разбиения на хранение разбиение на машины все остальное мы начали с того чтобы поговорили про регион сервера и про регион и соответственно да мы поделили просто скажем так по логике получаю получаемых данных мы их разделили между собой на модальности то есть фото звук видео например если опять же видео тоже храним в случае оригиналов случае шаблонов так как опять же вендором на модель разные виктора разного размера разных объемах характеристиками и хранить их тоже хотелось бы наверное не в перемешки между собой моих точно так же просто поделили наколол family сказать что вот этот фильм ли будет у нас такой то такой то венда точнее виктора такого the vendor или там соседней таблицы с оригиналом и там в таком фильме ли это будет колун фильм лес модальностью от vendor то кого то есть это фотки но там такого то вендора каким образом это все раскладывать так чтобы опять же не приезжать не делать им там выполните не приезжать перебалансировки еще что не такой здесь подход он стандартный так как ваш базе все привязано к руки и соответственно чем чем больше у вас чем заранее чем лучше вы заранее подготовили то какие ключи у вас будут использоваться в качестве ключей для строк тем равномернее можно распределить о чем речь ну то есть если взять кунин the brown дроби например или ждет приз плит таблицы и начать его просто проворачивать эти ключи так чтобы они не шли непосредственно приманка ментально друг за другом + 1 до поворачивать их можно просто ран дроби на меня это первый последний байт как сделали то есть начинаем отсчет там даст 0 ну дальше меняем местами байтики и получаем циферки уже не от 0 там да и на инкремент нас несколько другого другой лайки и позволяет там наполнять довольно равномерно наполнять каждый из ирисок размазывая при этом опять же нагрузку на запись в том числе на разные машины диски и ноды в самом кластере давай нам тут нам надо немножко пояснить вам штука в чём если кто-то каждый регион региона набиты просто hb и зам по кускам он не думает ни о чем он говорит такие вот этому диапазона и нижников от 0 до суда во все вот он так работает и если вы водите инкрементальные к руке кирпич никита там каким-то авто инкрементом вы просто всю запись будете класть в один регион сервер он будет вас приезжать на горе греть и одни и те же диски какой-то момент он скажет горя и расплетите хода до потом он скажет все мне надоело пошли делить и вот это будет тяжело да вот простая замена в инкрементальный могильники вот так поменять два байта местами если кто-то помнит дали что у нас ни один байт в целом числе прекрасно работает ну что у нас получилось с тобой вроде бы еще один квадратик дорисовали вроде все что несли донесли сложили да хорошо теперь нами нам поговорить о том что же с этим работает здесь у нас история такая во-первых кафка во вторых у нас куча модулей которые работают сами по себе вот здесь нарисованы чуть чуть больше квадратов чуть чуть подробнее и например есть какой то фронт в котором мы взаимодействуем когда человек хочет пройти биометрическую верификацию мы делаем следующий сценарий у нас фронт просит инструкции одноразовый персонально под этого человека сгинь ирины и сейчас дергает их с модами инструкций который кстати тоже пишут всю историю полностью всего чего по кому выдан в тот же самый hbs отвечает наружу человек выполняет там не знаю улыбается приседает вот всё чего мы его просим должен сделать присылает нам прекрасные видео и мы начинаем это видео разбирать во-первых мы дергаем из него фотографию в мы отрезаем его звук мы разрезаем если проверок несколько какой life нас какую будет проверять все это вот так вот распределяем и раздаём по исполнительным частями к по которым про которым мы поговорили чуть раньше после этого получаем результат собираем его и нам его надо отдать наружу ну в общем вроде бы понятно давай говорил вот ну какая история возникает для нас мы хотим что-то про нагрузку делать и в нас куча куча куча модуль каждый модулем должен быть запущен точно не в одном экземпляре много больше и начинается интересная история вот у нас прошел асти kipi запрос на предыдущем слайде нам надо в него отдать им ответ кафка куча партий сынов все пишется не пойми как и если понять что вот этих вот квадратиков api не один а вот как нибудь например хотя бы 2 мы понимаем что на одну ноту нам запрос принят как на слайде слева видно да пришел запрос нам надо точно ответить у ровно в этот типичный connect ответа может прийти как здесь опять нарисованная совсем в другую ноду ну что делать почесали голову слушайте есть хорошая история называется рай один простой как валенок решение у него есть хороший механизм бабу сабов мы берем просто по идентификатору у нас по системе гоним все пакетики с идентификатором грамм а вот отойди сник вот одесских этого запроса все дальше по кафке все путешествуют садись ником этого запроса когда какая-то is not получает этот ответ она смотрит у себя это мой конёк или нет если от нее окон и как-то она просто толкает данный в rides the note которая изначально получила запрос на эту информацию подписано соответственно при изменении данных в одессе через механизм попса во все получили можно отвечать наружу по-моему просто как апельсин но зато очень приятно работает ну как бы раз мы поставили редис мы такие думаю слушать у нас куча настроек по системе как-то вот все это админу настраивают сидят ну пусть настраивают админ приходят в админку чоп делает как оповестить кучу модули который нас стоят да все просто мы когда настраиваем мы знаем как и у нас настройки могут быть мы гамаки и ребят вот эти модули им нужен реестр например вендоров мы просто-напросто подписываемся на нужный ключик в одессе когда у нас произойдет event того что админ чтоб настроил модули ничего не надо ни перезапускать никуда он он получил от тренд через родис посол болтаясь там своем докере сходил на нужный вес забрал нужно и обновление все здесь закону как бы в механизм сделан так что это все обновляется сразу же без остановки ну да так как здесь у нас настройки поддельные немножко между собой на те настройки которые можно покрутить в рандами там не требуется перезапускать модуль ки и там очевидно есть настройки которые при котором придется перезапускать модуль соответственно если админы хотят поменять что-нибудь например там знаю настройках рендера например корова него там пороге модальности еще жизнь понастроить ходили по настраивали в модуле приехала работаем дальше не останавливаемся ну да ну и еще на на история 1 да нет повести печальнее на свете ну так как из предыдущих пары наверное тезисов можно было догадаться что мы довольно активно пользовались х дубовыми около х дубовыми сервисами когда-то исторически таблицу довольно давно мы приняли идею загрузить конфиге взк какое-то время пожили так пока модули было не очень много и пока там не было такого постоянного скажем так изменении каких-либо там сторонних настроек для модулей там например настроек тяж вендоров модальности ищущего нет такого ну какое то время но жил о вполне себе там успешно хорошо то есть балансировка было построен на том чтобы учились у киперу подключились кафе все хорошо все между собой подружилась и синхронизировалась вот как только появилась такая штука как какие-либо настройки отличающиеся от технических настроек модуля настройки там так называемых между собой реестрами то появилась проблема в том заключающейся в том что то что хранится в зуке перед довольно сложно посмотреть скажем так человеку который звуки пир видит там 2 да даже если третий раз приходится команда собирает все время ругаться чуждыми не подсказываешь консоль ничего ну и опять же так как мы уехали с головы голых живым машину ехали в контейнер и возникла вполне закономерно предположить давайте откажемся просто де прикинемся логику работы с звуки фирм и переедем на отдельные конфиге на коробочное решение которое в общем то предлагает нам больших так мы переехали в него чего получили выпилили кучу кода взаимодействия звуки первом синхронизации подключения конфигов опять же объем там уменьшили плюс в общем-то перестали заботиться о том что у нас там наши какие-нибудь кривые модули либо ещё что-нибудь случится произойдет так что он начнет нам долбить звуки пир ну и сложим вообще весь половину ходу пава кластера который музыки пир завязано но и по итогу посмотрев на кафку мы увидели что парни написали мы отказываемся от звуки рассказали о класс мы тоже хотим ну и отказались соответственно в совке больше нет такого жесткой завязки на продукты и мы переехали просто в тупые обычные плоские джейсон выкатили модуль в в шип сказали мол тебя новый конфиг map а вот пожалуйста ну там при подъеме из контейнера засосал джейсон к все пар пошел работать да вообще стал поприятнее и многие задачки по конфигурированию системы эксплуатации в итоге стала решать сама а не бегая к разработчикам гриву как нам затащить этого звуки pir это и как попроще стал попроще что получается ну вот мы почти пришли к финалу осталось поговорить про внешние описки давайте посмотрим что у нас тут так техника техника не подводи me ура и так у нас есть внешние взаимодействия для нашей системы мы не находимся внутри не находимся в бункере хотя многие этого хотели до был очень здорово не взламывая систему было бы ну и мы поняли что есть еще потребитель сервисов надо им чего-то как-то помочь наверное давайте поможем нас есть всякие разные сложные вот эти вот все проверки слои вы сами какие-то там инструкции надо делать мы поняли что если идти клиентам и те которые хотят воспользоваться платформы сказать ребята вам тут если мы пришлем инструкцию в которой написано что вы должны произвести такой этой текст вы вот это вот так вот на фронте должны нарисовать ну сами принять такая не работает поэтому мы изолировали просто процесс себя поэтому фронт у нас частично тоже свой мы как бы клиенту отдаем кусочек например если это ma bell кто это sd qashqai через наше приложение можно сделать все который реализует этот всю сложную мутную логику плюс также для нас является то что мы полностью контролируем фронт а значит если нас ломают если нам надо срочно внедрить новый лавины с новой проверке мы делаем сами мы не ждем контрагента не ждем пока он строит там в свое приложение новую нашу версию нет делаем все сами соответственно протокол один общий и на веб и на мобилку мы внутри у себя в видим кто к нам ходит в зависимости от того какие инструкции проверки не знаю сигналы от аномалии пришли мы можем сформировать для конкретно этой сессии для конкретно этого человека свою историю скажем не знаю при ты всегда с этого телефона ходил да мы тебя не будем заставлять прыгать на одной ноге если ты вдруг телепортировался куда-то и у хочешь как-то очень подозрительно выглядишь для нас ну давай мы тебя бросим сначала сплясать станцевать да может быть больно человеком зато его денежку за него никто не получит ну хорошо вот ну и соответственно мы наружу отдаленным всего-то пару простых интерфейсом говорим аки если вам нужно выбери директ нити пожалуйста вот сюда и тем самым закрываем кучу проблемы с норматив к и всем остальным что это мы работаем с клиентом напрямую вам не нужно ничего сертифицировать ну в итоге картинка выглядит примерно так с точки зрения инфраструктуры самый тупой докер он прекрасно работает для биометрических вендоров потому что эти прекрасные люди используют замечательнейший в библиотеке собрать которой самому примерно невозможно мы просим всех говорим друзья дайте пожалуйста как бот куба разочек мы как нить вот с ним а все остальное мы как бы сказали ну хорошо поставим класс по ходу по какое положено догадались это соответственно транспорт в к кафка хранил кеты hbs какой-нибудь берем хорошо хорошая база данных ходов классно а все остальное просто вращаем его концовке понравилось пользуемся прижилась до прижилось на этом наверное основная часть закончена ждем ваши вопросы да задавайте ваши вопросы надеюсь вам понравился доклад ребят давайте начнем с конца вот идеально спасибо за доклад у меня два вопроса первый я так и не понял мотивации краски они просто хотят за кучей сфинксов для надежности который решит вас проблема того что нам надо возвращать ответ человеку который ждет и так далее смотрите когда и ну то есть мы и есть до вариант сделать все это на местах в глубину провалиться да и разница будет следующим что если у нас мы получаем к сожалению данный не только из ростков вынуждены говорить ребят мы приняли такие то данные и положить да хорошо коллаген от и приняли как только положили что-то очередь отвечаем наружу 200 ок до свидания человек не ждет проработать то есть у нас мы тем самым позволяем себе еще и очередь организовать то есть если у нас с жестокий пик и к нам прилетела не знаю там пачка данных из смело ну там не знаю пришли и там несколько тысяч регистрации сразу мы их можем оттуда забрать выгрести очередь на той стороне алярм не поднимется мы просто сделали ся очередь то есть если синхронный интерфейс ос до второй вопрос от вы говорили про надежность что вы делаете когда что-то пошло не так как вы синхронизируете между 7 и вендоры миша вы там у кого-то из легше шаблон у кого-то не извлек светом сохранилось не сохранилось и так далее хорошо смотрите вендор нас ничего не хранит храним и все сами у нас ничего не переложена на венгерскую сторону у вас просто нет это просто докер-контейнер который выполняет две ровно две операции соответственно когда к нам приходит человек мы границ контакт когда он зарегистрируем нас да у нас есть некий шаблон когда он приходит пользуются системой есть в некотором be my baby биометрическая проба мы из этой пробы точно также пытаемся извлечь вектор соответственно есть пусть там не знаю 7 вендоров 6 извлекла для шаблона и вот для нового происшедшего извлекла 5 очевидно есть пересечении да когда есть пересечении все мы можем сравнить пару пару сравниваем отлично дальше приоритет по вендорам поехали у всех математикой стандартизованной поэтому точно знаем какая вероятность ну и дал некоторых процессах иногда есть чуток что пограничье что если например нам прислали биометрии весь который мы обязаны извлечь из звук обработать и фото при этом бендера по звуку например не смогли извлечь что если процесс того требуется иметь такие игры gentoo мы можем просто отбить попытку там зарегистрироваться и успешно ну просто в силу того что мы не смогли удовлетворить критерием конкретно в этом процесс но при этом sirbu сохранив все что прислал все что получили так есть ли еще вопросы вот они как раз мне вопрос идеально спасибо за доклад очень интересный вопрос это все генерит огромное количество лагов как у вас как у вас организовано хранение log off и как с мониторингом обстоят дела с бизнес метриками с железными метриками осмотреть спасибо за вопрос так значит попробуем ответить с точки зрения логов логов много часть мы лакируем сами то есть во первых чем еще для нас понравилась нам кафка тем что мы просто на нее сверху на все очереди которых я чет происходит да вот процесс его данные пролетают мы совершенно спокоен под другой группой читателей навешиваем на эту . еще один модуль который забирает от добра складывает в чудесную штуку про которому не говорили hive называется и там дальше бери переваривай чем хочешь эти логе соответственно есть хотите в бизнес мониторинга берем spark утилитку пишем в паршивом нужную историю выплевывала по погнали естественно вся эта история ну shift мониторится тасс обмазана там мониторингом снаружи не переживайте соответственно по железу у нас там это не мы мы мы люди за софт ребята взялись у нас отдельно там много цодов делают как им самим тут некоторые коллеги знаю есть из тех с кем работаем вот поэтому тут проблем не особо какие-то так ничего не забыл ну кратко и пробежаться из только по ключевым словам что там у польши вт это связка флинт плюс киба нам для оперативного перекатывания логов админами соответственно чтения до долгосрочных условно говоря журналов именно то есть там читается реально просто все все очереди которые нарезали мы все засунули в 1 модулю прочитаю что служили ну и дальше там трансформируем чем что хотим то делаем с этими метрики можем считать все чтоб многом и как-то считали мониторинга на читали все пять сказали пожалуй хватит так еще полу возле ствола вопрос грэм а еще один а можно давайте его коллега евгений сбербанка смотрите можно поближе микрофон был онлайн слышишь так лучше осмотрите специфических есть поскольку вы государства допустимо приходит уважаемые люди говорят нужно обмен тубуса сделать это один ко многим как-то сделать называли все такие кейсы или нет смотрите для того чтобы делать идентификацию схема отдельная но у нас пока уважаемые коллеги с такими вот запросами совсем не приходят да я знаю что у вас там специалистов в плане поиска побольше чем у нас но дамы отдельно эту функцию мы честно выносим в отдельный кусок то есть оно не находится здесь у нас есть механизма управления там идентификационными базами отдельные как в которой мы там можем поставить вот хотите там идентифицировать давайте мы сюда управляю вас этого ядра поставим кусок . отказ является самой vendors к и решение то есть у вас они они 15 штук но и против этих рубин дорога воли или вы имеете ввиду идентификационную коробка работает на бизнес у нас их просто много то есть мы просто вот так размазать ничего страшного конечно не все три от резервируем то есть там как еще раз и например некоторые вендор работают быстро ты достаточно хотя бы минимум два понятна стоит дав системе а некоторые настолько быстро что надо поставить 8 чтобы они посмели за теми двумя они еще вот такие вот ресурс им выдать ну тогда они кое-как поспеваю поэтому нет обязательно все дублируются мы не верим честно лишь мне одному вендору как-то не нет честно эксплуатации вендров это очень тяжелый вопрос с которым мы столкнулись то есть люди хороши в биометрии обычно да но оникс платформе насти решений как то очень трудно она почему-то не работает почему-то падает зачастую ну вот приходится поднимать илим пингвинов подрабатывать на самом деле отличный вопрос и я вижу вот здесь был вопрос у вас не отменился еще вы хотели задать вопрос не да давайте я вам микрофон свой дом просто до коллеги смотрите как вы пуншем через импортозамещения про тасконы зачем нам протаскивать вот вот не надо совать то куда не надо вставать смотрите относительно импортозамещение и всех остальных список 91 р там вот вы в нем находитесь по самые уши и очень интересно как вы его купили ну что ты начинаешь рассказывать ну вообще говоря зачем его сердце сертифицировать вы должны то что нужно сертифицировать если вы выиграли сейчас я объясню смотрите вы можете закрыть с одной стороны инфраструктуры с другой стороны софтом если вы построить все вокруг у вас у вас все хорошо это это прикладной софт понимаете если это не средство защиты в виде массе импортозамещения не так представлении не забрасывать в чем вопрос если вы имеете право просто хочет расскажешь разбросал антон гусев у нас к структура занимается организацией да то есть ростелеком соответствую них есть свой форк который называется отвечу на вопрос спасибо да и он есть да и второй вопрос глаз для configuration management и использую как минимум три решения да это звуки пир для кафки редис вот для управления настройками до его подшивки у вас и днр по умолчанию вам нормально да что у вас три решения используется для одного и того же ну смотрите на mackeeper мы с руки первым уже больше не ставки как бы она же есть она как то там сам с ним разбирается слава богу на сомнений нас они не беспокоит они там дружат нормально нам хорошо с точки зрения управления наоборот стала еще сильно лучше потому что ну например край крайне маловероятно что вы будете вот как пользователь там система имеет админа пользователь вы вряд ли будете ходить там по модулям раз там не знаю 15 минут или там в 20 минут и зачем то там менять у них там не знаю тайм-аут и wrike объектов какие настройки подключения куда-то там не знаю название баз данных или еще что не такое ну как бы соответственно статика вот оно все живет и живет под управлением шифта перекате ли новое обновление летом привезли новую версию конфигов он он задаст обновилась то что там рабочие данные администратора меняют там опять же добавляет например нового вендора ну ок добавили а ну там фронтами просто пол перри получила новый список вин даров продолжал работать дальше просто 2 разных группу настроек абсолют raider пройдись в этой части он выступает очень просто для шрифта и смол и все in fresh ft он не нужен совсем он там никак не участвовать статические конфиге лежат под управлением шрифта и лежат себе у нас он конкретно используются именно для того чтобы быть точки синхронизации о том что модули нужно получить новый новую версию конфигов сходить и забрать ее просто о том что что что-то поменялось надо переплачивать за кипер тоже также это умеет дав какой-то момент да он работал точно также но и звуки первым мы использовали именно для статичных конфигов раньше что есть для технических конфет модулей а потом просто сказали что зачем если вся на в докер едем дальше я понял спасибо ребят спасибо большое за ваш доклад"
}