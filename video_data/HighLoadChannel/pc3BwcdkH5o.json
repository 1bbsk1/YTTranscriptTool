{
  "video_id": "pc3BwcdkH5o",
  "channel": "HighLoadChannel",
  "title": "Оптимизация high-contention write в PostgreSQL / И.Панченко, О.Бартунов (Postgres Professional)",
  "views": 3838,
  "duration": 2782,
  "published": "2018-08-16T04:52:37-07:00",
  "text": "вот сегодня мы будем говорить про оптимизацию high court and straight pull леску или и доклад в некотором смысле немного необычный потому что нас тут некоторые люди обвиняют что мы пропагандируем подольской он хороший то сегодня мы будем говорить о что упал риса есть проблема и мы честно скажем какие ни есть и что мы хотели пытались сделать чтобы эту проблему порешать ну и в частности расскажем как с ней бороться принципе да пара слов о том чем мы вообще занимаемся то есть вот здесь сладко подготовлены к 20-летию подвеса здесь указаны все мажорные фичи из релизнуться которые были за 20 лет законченный в пол рис вот здесь мы отметили красненьким этом наш вклад собственно мой вклад начался уже вот где то 97 год вот интернет и интернационализация а до меня в один михеев он как раз сделал первый патч который вошел в релиз через 2 недели после начала проекта это просто к тому что оголиться наши российские вследствие в подписи достаточно большой вот моя первая работа состояла вообще из каких там сотня строчек пачек но он дал возможность использовать адрес в европе но вот во всех странах которых не отличных странах потому что кто не помнит 1 по адресу он работал только с ними битами как раз моя работа заключалась в том чтобы сделать его доступным всем другим и так не считаю тема нашего доклада вот здесь такая картинка и и будет использоваться на мне понравилось и мы с олегом жили в гостинице 1 и там висела такая картинка не давала лягу спать а благодаря этому я хорошо подготовился к доклады которые там где эти люди смотрели на олега и он записывал всего лишь диалог который с ними нашли нашел да то есть вот здесь вопрос на ищешь возник о том насколько пузырь из хорош как на узкую для базы данных вот действительно это очень многих людей привлекают что после как бы хороший имеет хорошую функциональность и при этом было бы соблазнительно еще иметь их как греются использовать его на узкую щель базе данных тем более что прошлом году в конце вышел из q или 2016 стандарт в котором было уже прописан джейсон то есть существует теперь стандартный способ работать джейсоном подержанные сквозь стандартам и эта вещь будет работать одинаково в подписи ворог ли mais quel mssql это конечно очень приятный для разработчиков на другой стороны это ужасно потому что после все уже есть поддержка джейсона теперь придется что-то под этот стандарт менять надо сказать что нынешняя поддержки джейсона тоже вкус без вошла не сразу было два три разных способа до того как вот утвердилась то что утвердилась сейчас вот на тем не менее штандарт есть и ему надо следовать и мы решили померить наконец-то померить производительность на узкую элфи через пол-леса потому что все что до этого делалось это я собственно запускал какие скрипты водил какие-то запросы списку или и тешил себя мыслью что после вполне себе нормальный ночь мире или в основном из манго db потому что они потому что там оно очень сильно ненавижу и или и так далее на самом деле вот мы сегодня как раз с разработчиком манга очень хорошо поговорили об раз потому что он мозга является одним из лидеров вот нос quelle и с кем тогда было мериться а мне несколько раз говорили что эти бич марки это делали как говорится после совы и люди там а их нельзя повторить и так далее и люди хотели каких-то таких бенчмарков которые поддерживали не только puzzle is a поддерживает другие базы данных чтобы дать marvel open source на и что можно было взять запустите самому пока получить эти все результаты и вот мы нашли этими benchmark собственно тут важно что мы нашли этот бенчмарк которые рекомендуется для малышку wheelbase только пузомерки для на ускоренное на их поле его проводить сравнение называется это вальс с бенчмарком он по нему написано учиться статья его всячески цитирует его использую для тестирования производительности в общем куч компании до сих пор не тестировался поэтому мы решили посмотреть как же он как же позлить будет с этим лишь марком работать какие показатели то есть цифры которые можно сравнивать это было действительно очень интересное занятие потому что мы набили много шишек много шишек с этим бенчмарком мы поняли проблему ползли со вот а когда понимаешь проблему это за часть что уже полдела сделано мы надо ее решать то есть я очень к лицу доволен с этим делом мы делали три рано на самом деле больше то есть у вити синхрон узко мид of кто знает такой скромный хамитов это такая штука если вы хотите чтоб ползли слетал вот реально выпишите из всех роуз комментов и тогда будет производить будет раз во много раз в день на порядок выше но при этом вы имеете проблему с тем что вы можете потерять какие-то последние данные база будет коэффициент а это очень важно но вы ему имеете возможность потерять какие-то данные не очень может быть существенны для вашей в для вашего проекта но ты такой мы сделали его синхрон ска метров потому что он а г б д б по умолчанию журнал тоже не пишется на диска в памяти то есть чтобы играть как-то одинаково мы сделали вот такой seafront комментов сделали естественно для малого количества клиентов вот мы изначально делали на х пышных блейда там количество лента была меньше ста двадцати восьми вот потом нам дали машину на которой можно было уже там тысячи клиентов гонять вот и естественно мы сделали ран citron в коммент он что будет с патрисом из манга если мы хотим конце полной сохранности данных то есть транзакции считается возвращает ответ гамид хаки если не просто там вы записали в валок но еще при этом лог сих рисовался то есть совсем произошел то есть вы уверены что все на диске вот но мы тестировали бы три индекс много db мы брали последнюю версию этого я рта гирс и сосна пиком причинам это 3 4 там уже не помню как 6 что ли и тестировали просто извлекали от либо весь же сон и либо одно поле и смотрели на были у нас канай раньше сканы вот сегодня достаточно говорить про то что мы будем говорить про одно поле просто вытаскивается ключ самом деле там еще размер всего этого измерял хитом и очень разных измерений было вот и наш был доклад в прошлом году на пожилые где более детально рассказано об этих результатов можно принципе посмотреть его стоит сейчас мы будем рассказывать уже как мы продвинулись дальше потому что мой топор брали длинный джейсон который постился все значку толстая и там обнаружить свои проблемы то есть действительно там к этим проблемам обнаружилось что и сканирование очень медленно из-за того что приходится ради ползать весь джейсон большой а поговорили за испугались и медленный это для этого сделали патч который в puzzles вводит новый способ создания костяных компрессы метода это сжатие то есть можно было для джейсона так что то такое у нас ни одного стал говорить и вот он да и компьютер погар погас вот но можно пока поговорить а вот про джейсон бесси а ой это не мы это фон предрешен вещи надо сказать джейсон би си вы тоже били тоже об этом не будем говорить про пока вот здесь идет такой разговор скажем что в 11 релиз мы хотим закомитить сжатии джейсона потому что джейсон by очень хорош но очень жирный люди размер ключа у нас там не ограничен до не ограничен в 2 в степени 28 и люди этим пользуются они делают такие длинные длинные ключи очень понятные всем но при этом они занимают конечно очень много места и вот жизнь веселее у нас будет использовать словарная компрессию но помимо обычных для макс сжатия массивах там warband компрессор а используется еще и просто словари держится в отдельном месте и тогда джейсон би си оказывается вполне себе сравним размером с реляционным срисовывать табличкой сейчас они сделают это мы тоже не будем показывать да вот но можете поверить что вот его производительность она почти не страдает то есть вполне нормально остается итак другим к передать здесь проблема . на что мне читать это проекция можно сюда вставить или кира то есть еще чем хорошая туварсе избе тестировать для вас было тем что мы вот я лично для себя понял очень важную вещь что это все говорили что пузырь из это позже bench оптимальное the bass то есть действительно разработчики пользовались позже bench in тестировали но иногда делал какие-то внешние бенчмарки но проблема позже бенчи вы должны об этом знать заключается в том что по умолчанию там используется равномерное распределение но об этом чуть позже давайте сейчас еще немножко про айхербе и да винчи марта и сытая хук laughter in benchmark здесь ссылка есть на его до рек упоминала личную статью вот здесь как раз есть на нее ссылка можно будет потом посмотреть у нас будут какие-то люди из университета люку что об этом думали вот значит там есть шесть типов нагрузки вот посмотрите какие значит тяжелые апдейты основном чтении разные смеси между чтениями записью вот workload для чтения последнего записанного тоже достаточно распространенной в жизни случай вот есть там же запросто же вот ну вот посмотрите и здесь важно конечно какое распределение ключей вот мы вначале по традиции после пробовали распределения равномерно здесь вот рекомендуется некоторые исправления лифа или ципфа вот о нем чуть позже поговорим значит вот это на наши конкретное случае и вот результат итак вначале мы попробовали равномерное распределение ключей значит что эти запросы это ключ значения фактически базы как обычно бывает на войску или вот то есть есть и запросы по ключам и вероятность того что он запросит встретиться любой ключ одинаковая это и значит равномерное распределение до синяя линия который идет вверх это позже после был самый свежий но позже лишь обычный ванильный без всяких патчей а зелененькая эта манга по что по осям по горизонтали это количество параллельно запроса а по вертикали тысячи запросов секунда то есть мы видим что здесь заметьте что осени одинаковые то есть вот здесь workload а это 500 тысяч максимальная парк вот это миллион то есть цифра достаточно внушительной но и машины была серьезная то есть это увидели семьдесят два ядра 3 терабайта памяти давайте работе с создает такие серьезные машины в чем машины были две для клиента для сервера и соединены очень шустро сеткой то есть вот мы когда получили вот эту картинку и у меня прям душа возрадовалась потому что после ставите сильно лучше манга все очень хорошо приятно и красиво вот и как бы я стал об этом говорить может вот но на самом деле весь фокус в том как измерять вот и так что же такое распределение зифа и почему она важна вот кстати benchmark life's been как раз рекомендует использовать такое распределение для запросов почему но мы конечно написали патч для того чтобы каждый день щи научить давай запрошены равномерно распределенная таким образом вот что это такое за распределение когда-то давно еще до войны насколько я понимаю это было люди начали обнаруживать что существуют какие-то математические и статистические закономерности нормальной человеческой жизни в экономике здоровье там ценах и так далее всем этом вот и и одни люди исследовали сколько народа выпивает возьмешь процентов водки нуждается для другие люди исследовали во сколько раз самый богатый человек богаче самого бедного и вот примерно из этих исследований родилось распределение зифа вот изначально zip получил его из анализа частотности слов в английском языке вот он обратил внимание что самое частое слово примерно в два раза чаще чем второй по частоте примерно в 3 раза чаще чем третья по частоте и так далее вот рифф в принципе то есть изначально он должен был бы называется цикл потому что он немец на поскольку он переехал в америку то соответственно стал зипом вот соответственно родилось такое распределение которым частота обратно пропорциональна рангу данного значения что это значит это вот как раз тут значит что кенни по значение n встречаемости значения встречается в n раз реже чем самое частое вот а потом было много исследований и математического обоснования этому до последних лет не было сейчас вроде говорят что появилось в частности график из статьи 1 калифорнийской женщины о посещаемости веб-сайтов loop оказывается она тоже подчиняется распределению zippo вот на самом деле в обычном таких обычных веб применениях это означает что есть самая часто востребованная наиболее востребованная посты в блогах там самые часто читаем ее материалы самые популярные блогеры и так далее и основной вал запросов идет к ним будут создателей этого теста они порекомендовали считать что распределение мента кого то есть самый популярный блогер читается в два раза больше чем следующий ну и так далее и вот считается что поскольку это распределение хорошо прокси мерует многие жизненные ситуации в частности например населения в городах тоже подчиняется этому распределение богатства богачей тоже подчиняется этому распределение и многое другое и поэтому мы взяли его и для позже бенчи тоже и результаты сразу изменились нельзя сказать что все стало очень плохо но заметно по другому вот можно посмотреть на воркаут а например где при большой конкурентности у нас позже срезка загнулся вот ну и вот war пловдив мы тоже видим что он тоже загнулся на самом деле a&f это одно и то же практически то есть можно не говорить про них вот у нас а.б. там где конкурентов 5 провела там где апдейт от 5 процентов у нас позже до сих пор растет но это временно то есть он добивается там где высокая конкурентность запись со всякой вывод был сделан вот и начали разбираться в чем же дело вот значит вот еще на вам с другого прогона равномерное распределение вот и здесь есть уже датчик отличие нет нет здесь отличие заключается в чем что мы когда уже сделали до 128 до клиентов решили уж вы решили посмотреть чтобы идет дальше на 1000 клиентов и на 1000 клиентов мы увидели что на самом деле даже для однородного распределения ведь и синенькое даже для дорого распределения пузырь начинает спадать то есть удружили там где порядка 500 клиентов по адресу же сравнивается с мангой и дальше только становится хуже опять же обращаю внимание на то что это для апдейтов там где ряды там все прекрасно пузырь продолжает прекрасно работать вот аналогичная ситуация зипом она становится и вообще коса катастрофой видите как то есть на март логе а наверху deef мы становимся сильно быстрее сильно хуже манга падаем самое печальное что новом клубе б там где всего скажем пять процентов апдейтов тоже навар kludi б пользуюсь начинает деградировать если больше 50 клея довольно много но начинают деградировать уже до сотни нажмите вниз сравнивается с мангой в данной конфигурации уже в 500 то есть вот что оказывается интересно получается когда мы начинаем смотреть другое распределение запросов и когда мы начинаем смотреть на другую степень конкурентности может дальше вот ну то есть выводы такие что мы надо напомнить что это было этих рон узко mind of hopsin дистрибьюшен то есть расстояние зифа и большая конкурентность больше ста и вроде очень нехорошо для подвеса обновления для обновления но даже для однородного распределения при большом количестве клиентов производить обновление адреса деградирует вот там была картинка что мы включали синхрон узко мид он он немного помогает по адресу вот ведь ip-адрес немного помогает но просто напросто смещает то есть картинка формально остается той же самой деградация просто это деградация наступает чуть позже просто из-за того что когда вы включаете синхрон ушками там включается эффектная синкая sing head of single никак не сказался замывает конкурентность так значит ну то есть вот и по результатам мы видим что для веганские нагрузки пол рис тут сливает естественно что вы тут младенец говорить что надо разбираться ну да девушкой нагрузка на 10 назвали на самом деле такую нагрузку в которые имеется распределение дефо вот просто и в которой до что важно отключается синхронно ушками да так серьезных приложениях не делая вебе наверное делать и но давайте разбираться теперь по совету младенца то есть вот в потряси нормально любой нормальной базе и миссис поддержка и сюда здесь мы будем говорить про изоляцию это когда она и что работа выполнение на выполнение транзакции текущие не оказывает влияние другие транзакции которые работают параллельно с ней и вот для этого был придуман mvc что было хоть какое-то производительность нормальная да таскаете чтобы читающий пишущий транзакции не блокировать до друга используем pcc это когда старой версии срок сохраняются для того чтобы читающий транзакция их могли видеть то есть при этом очень важное понятие здесь snapshot как раз между двумя транзакциями база находится в каком-то состоянии ксн там и чтобы его взять вот этот придумали snapshot и дефицита вать то есть что можешь был отличать какие транзакции прошлом для данной транзакции какие в будущем и в пол здесь и это и то есть везде в любых базах данных после все это реализовано виде двух чисел и массива то есть есть x мин xmax и массив здесь пример мы видим что здесь имеется транзакции которые in progress красные они еще не кончились и все реки это ответ транзакции которые уже закончились и вот красная черта вертикально это момент на который мы берем snapshot и это snapshot характеризуется x мин равно 6 от шестерка это та минимальная тра это аиде минимум транзакции которую началась открыть которые открыто да и максимально это 10 вот это та которая вот транзакции который идет максимальная а вот этот массив тип вот он содержит 6 8 это те транзакции которые которые еще один прогресса и мы ничего про них не можем сказать их надо сохранить то есть весь народ сохраняется виде вот таких двух чисел этого массива но тут здесь показана 3 сторонних наблюдателя 3 сторонний транзакции которые видят разные версии у них своей x-men xmax x хитры и вот они видятся три разные версии строки вот которые были обновлены там просто яички добавлялось в пузырь все по умолчанию уровень изоляции to ride комитет рядками that это когда вот здесь как раз нарисована картинка как это работает с учетом почему нужен snapshot как это делается вот например ведь exit 10 и транзакции десятка она читает ту плей вот один b2c внизу архип это тупой там лежат их несколько штук 11 обновляет упал вот 4-е пунктиром и комитета оксиды 10 она читает упал 3d 3d который указывает на 4 я а он уже ему не виден так он уже был обновлен 11 транзакций то есть в итоге мы можем потерять строку потому что вот здесь видите здесь показан случай когда мы сканируем по индексу мы назад не возвращаемся мы идем вперед и в итоге мы потеряли строку чтобы этого не было делать как раз косить 10 он берет snapshot для читающих запроса то есть он получает перечень перечитывает обновляет ситуацию то есть мы вот эту штуку не потеряем здесь в данном случае написано как мы потеряли вот ну вот контента здесь тоже значит вопрос когда две транзакции пытается обновить одну и ту же строку это как раз случай к которому подходим то есть они прочитали соответствии со своими snapshot ами одну и ту же версию строки вот эти сохраняется вот 01 летит это значит что к это просто координаты грува положив физическое положение ступала на диске и подготовили обновленные версии с со значением двойка вот на втором шаге от видите дам транзакции 10 она пытается обновить она обновляет строку и добавляет версию новые уже со значением двойки а транзакции 11 она тоже пытается обновить но видит что она уже обновили на вот что же делать так вот вопрос что делать это на это зависит от уровня изоляции то есть для рипит алгоритмы выдаем что ошибку его и приложение нужно просто-напросто в цикле продолжаете спрашивать это дело вот то есть сериализация такая способ способ избежать вот этого контента на вот но у нас в для кометы buried уровня изоляции вот здесь у нас происходит вот такая вещь то есть мы прочитали первые два у нас 1 3 1 2 у нас одинаковые на третьем шаге мы видим что noble обновлено и мы ждем завершения этой транзакции 10 вот когда касси 10 за к месяца 4 11 просыпается транзакция находит последнюю версию строки и локи и и при вычисляет обновленную версию строки will you try вставляете ее в хип вот таким образом в пользуюсь и происходит машинерия вик как сейчас видно очень сильно зависит производительность зависит соло как мы лучшим как мы дело как возвещаем строку вот до пузыри со еще в 94 мы было происходил это таким образом что как ахилл и черепаха то есть мы дожидаемся пока транзакция записано в xmax закончится то есть вот транзакции которая вот в которую мы находимся на заканчивается и мы ищем последний тупо цепочки апдейтов потому что много других транзакции они обвинители строку и существует много достаточно еще других версий мы ищем последнюю и пытаемся свой xid записать в в этот xmax но за это время кто-то другой уже это сделал за нас и нам приходится обратно идти к шагу 1 ждать когда вот этот эксмо закончится то есть мы чуть-чуть приближаемся в этом я кто-то отодвигает и вы дальше идем по циклу то есть в обычном случае это было не очень страшно но когда вот большой контент шин это очень било поползли слухи в 94 за к мите ли вот за к метели некое улучшение которое уже в 95 она выглядит немного по-другому вот то есть берется лог над упала ей и при этом происходит так что стало становится лучше транзакции выстраивается в очередь некоторую и как бы это очень хорошо как бы ситуацию вы правило вот можно однако проблема состоит как раз подстава заключалась в том что блок ставится на тупо лойди а тупо лайки это некая физическая вещь то есть когда транзакций обновляет упал строка появляется и и youtube алаги меняется и таким образом каждая последующая транзакция она должна брать новый лог на следующую версию физическую версию когда у вас имеется 1000 клиента то есть 1000 процессов вот который пытается запретить одну строчку вам приходится сделать вот видите как он н н квадрат взять и отпускать локи а этот лук он heavyweight то есть это тот самый лоб который берется вот например делать критерий был там alter table такой серьезный лоб а тут получается мой на строчку берем вот этот лук и это он сам по себе очень дешевый потому что этот лог он заключать в том что нужно заглянуть хэш табличку в жареной памяти вот можно дальше вот к сожалению вот виды лаков в подписи есть пилот легкий лак и гель лак к сожалению для нашего случая для других лохов не предусмотрено то есть нам приходится брать вот heavy лоб потому что заранее невозможно выделить жареную память под каждый лоб потому что мы не знаем сколько этих строчках эта проблема возможно при для кардинального решения задачи нужно придумать какой-то новый тип локов но пока что вот оставаясь в рамках это и существующей клоков вот нам приходится подходит только не подходит только этот следующие и что вы придумали мы придумали а давайте делать лак не над упал айди она праймари кей потому что про америке это остается неизменной и тогда получается действительно вот видите внизу картинка вот нам не надо брать очередь одна она не переезжает нам нужно просто-напросто как бы отслеживать только одну один праймари кей вернется в америке или но это все работает он случае если он не меняется он обычно не менее сюда так сделали соответственно всякие оптимизации вот такие как праймари келлог основная оптимизация и была целая пачка низкого уровня оптимизации которые вот особо большого они конечно принесли какой-то плюс да но по сравнению с про email о ком они не очень заметной но они уже часть помогут закончен а вот остальные лежат вот обсуждаются в сети посмотрим как все это будет можно дальше вот ну конечно это естественно это все таки упрощенная картина более сложной картина она включает себе еще там race car race кондишен и так далее там потом еще имеется транзакции будут иметь суп транзакции и так далее но в целом картина вот который мы раскопали она выглядели на таким образом то есть из за того что топология меняется высота делается от n квадрат локи и вот результаты выглядят уже так например для однородного распределения вот как мы видим даже на 1000 клиентов доползли в принципе красненькая фиолетовая уж не знаю какой цвет фиолетовый цвет мы видим что для огорода распределения вылечилась все стало вполне себе достойно вот разве что только вот так разит они так усердно существенно лучше то есть по крайней деградация сдвинулось то есть прайма реки онон как бы полечил о не до конца вот если мы включим синхронный узко мид он то есть persistent возьмем там от видим что ситуация стала лучше но тоже так как бы мы видим наклон лучше нас мысль стала что она как была лучше чем быстрее чем манга но наклон остался и тенденция видна что если мы будем клиентов еще больше увеличивать то пол рис станет опять хуже чем манга вот дальше то есть с патчами ситуация улучшилась но она проблем остается нужны конечно дополнительно оптимизации я очень благодарен конечно вот этому случаю он нам открыл глаза на многие вещи и у нас появились такие хорошие задачки для того чтобы сделать пузырь из более дружественным как говорится к веганскому war кладу может дальше другое дело что если вы видите на цифры на цифры то для большинства проектов конечно вы этого не заметите потому что больше 500 пишущих потоков резко когда была да то есть какие-то большие проекты они действительно этом скобу споткнуться да но реально конечно вот надо для и постараться я думаю когда вы дорастете мы к этому времени успеем чего-нибудь к 11 версии что не сделать до ворот мы ждать улучшение это всегда самые хорошие рекомендации ну здесь просто ешь и ждать у моря погоды это одно дело до ждать когда вот существуют конкретные люди уже заряженные на это дело до отскать то это уже хорошо в общем работы продолжаются что то еще будет вот ну а пока костыль здесь некий описан типичный случай когда возникает хай контент шара это которой мы говорили это вербовская некоторая задачу от представь себе что есть посты таблица постов и таблица комментариев и представьте себе что в таблице постов есть счетчик viewcount который инкрементироваться каждый раз когда возникает комментарий к этому посту тогда понятно что я же есть супер популярная по ст это как раз на них и будет возникать конкуренция люди будут пытаться писать в одно и то же место и там как раз будет возникать этот квадратный лук про который рассказывал олег вот как можно с этим бороться но рекомендация просто я не считать честно все эти аккаунты чтобы из-за простого считать их день другом месте а таблицы аккаунтов время от времени их пополнять вот но сейчас мы покажем способ как это можно делать аккуратно с точки зрения snapshot of к сидов всего прочего вот представьте себе что действительно как правило точно знать количество аккаунтов тем более в мире где все течет все меняется эти команды постоянно прибавляются точно знать их не обязательно и некоторых случаях невозможно вот поэтому можно считать что вы где нибудь там в памяти как-то считаете это циферку вот мое время от времени подсчитывайте их основной таблиц для того чтобы делать это аккуратно можно добавить такие дополнительные поля именно в каждом комнате запоминать тот косит который его вставил вот и соответственно запоминать snapshot в посте последняя snapshot когда был пересчитан этот самый аккаунт вот и тогда вы можете выполнять время от времени вот такой вот апдейт который будет автоматически добавлять подсчитывать сколько с того что что-то прошло еще новых комментариях вот то есть здесь вы видите что используется некоторые функции внутри под колеса для получения текущего snapshot а и для проверки того видим лишь наш эти данные эти транзакции вот с помощью их можно аккуратно и точно выстраивать такой счетчик чтобы он у вас в целом не нажал вот ну еще раз выводы видите что результаты позже cena vs б хорошая вот и для большинства реальных нагружать он вполне конкурентоспособен по отношению к манга не говоря всех других его достоинствах вот но проблема есть решать ее надо и что-то для этого уже сделано вот но пока проблема все же сохраняется и но другой стороны большинстве случаев надо просто смело придумывает костыли вот и они спасут нас вот примерно так спасибо за внимание ну то есть вот для как разработчику как разработчикам это был очень хороший мы подняли этот red там есть вот street в пока бенчи о том что действительно у нас такие проблемы то есть народ начал как-то реагировать и очень важно что если если мы хотим чтобы puzzles действительно шел на вот такие новые виды нагрузок интересы мы должны что-то нереально делать менять что я говорю что мы обнаружили это где то в апреле эту всю проблему и все это время работали над там была куча патчей куча всего исследована делать вот пока не пришли к некоторым уход правильную реке you но теперь мы уже должны включать включаться очень очень хорошо потому что больше нет пока таких резервов кроме как например ввести новый вид лука не такой тяжелый это очень большая работа по ядру и но это видел это придется сделать далее на придется да то есть если есть какие-то желающие поработать с в этой теме то давайте начнем присоединяйтесь хорошая такая тема которая достаточно точечная и и на ней можно сделать себе оказывается хорошее имя в комьюнити что давайте есть есть какие то вопросы говорите да а вот пологи бар один из индекса что хочет сам сказать можно ведь по-другому решаете проблему с счетчиками раз шивайя их следующим образом берешь делает shape and only табличку на каждый просмотр пишешь туда строчку если там не очень важно консистентной можно я даже unlock сделать вот по крону раскрыта время из нее доносишь данные до основных непосредственно счетчиков соответственно если те там было 1000 просмотров эти равно 1 апдейт на популярный пост или комментарий это прекрасно работает там ну на десятках тысяч рпс записи на там даже на один счетчик без проблем да вот ведь это конечно пока от этого не страдает consisted ность если нужно вот прям точной цифры вот прямо сейчас то берешь значение счетчика и считаешь количество строчек в этой open тон или таблички ну там как правило яндекс по сущности для которой ты считаешь счетчик есть и поэтому этот запрос работает но это все же как и таракан стороне приложения работал этому хорошо бы все-таки решать это в ядре да спасибо да вот виде человек из индекса он вам рассказал хитрость которую они используют это работает ночь будут работать для вас еще вопросы да то есть планируется ли не планируется ли перенести это дополнение в обычный под газ и толпа жорж нет просто вы она отдельным модулям его конечно можно поставить просто значит смотрите вот на самом деле вот связи с тем что у нас мы сейчас реализовали скульд джейсон для ванильного пузырь со который будет в 11 версии сейчас идет review и отладка там появилась такая штука называется джейсон пас то есть это такое тип данных которую резон подвезти который позволяет описывать вам вот как бы кусочки документов это очень здорово это похоже на джей сквере которая была тем самым расширение его страстно предан мы сейчас работаем над индексом который позволяет вы можете теперь сказать create index не почему джейсоном который в основу мусор да и вам не нужно его индексировать а именно потому джейсон пасу то есть можно указывать джейсон пас вот про это все работает и даже даже без никаких изменений проблема в том что как сделать так чтобы планировать guitar понял что запрос подходит под этот же запас мы сейчас за этим работаем это будет выпал source вещества и он там еще просто в дополнение была возможность указать яндекс по разным полям насколько я помню типом полей числовые и строковые чтобы там соответственно операции сравнения это уже сквере расширение на конкурсное его можно поставить вас критику как бы там написано что возможно в скором времени это расширение нативно войдет в под газ ну поскольку внезапно возникает стандарт с кожей солнце теперь я сношу же впускаешь войдет к видим неджи сквере а вот этот стандарт но возможно стандарт придется как-то расширить потому что джей сквере есть такие вещи которые стандарты напрямую там просто не сделаешь после совы сообщество очень консервативной если продаем что его продавить вот такой до той же сквере уже сколько три года вот там пользователи масса но продавить его в сообщество чтобы так сказать это целая большая работа на которую нас пока нет ресурсов еще раз тебя же тоже вопрос можно олег насколько понял тяжелый лог который на то пройди было стал на первичном ключе он берется всегда когда у нас было ожидание на конкурентной записи то есть когда мы ждали commit и rollback транзакции не всегда а только когда было ожидание то есть на не content and right он никак не повлияет доу никак не повлияет и ничего страшного и боги результаты показывали там для народа распределения там вообще все хорошо хорошо а про чем она здравствуйте алексей я из игра майкро вопрос такой я же правильно понял что вот это вот проблема оно возникает только в том случае если делать апдейты если то близко только для десертов и реально ничего нет все нормально конечно эта проблема викодина для апдейтов и когда вы synchronous канец выключаете вот и когда у вас распределение зифа то есть тогда на вас будет бить очень очень сильно спасибо вот и когда воск not клиента очень много принципе и говорю что конечно я вообще удивлён что мы до этого не только только недавно до дошли вот это показывает о том что очень полезно заниматься бенчмарками чужими до ну вот мы его сейчас шлифуем это же естественно в 11 пойдет да конечно просто понимаете одно дело когда вы делаете прототип патче да и другое дело когда этот патч прошел через кучу всего там комьюнити это серьезное дело не моего естества зачем нам удержать у себя все астана будем про профи пропихивать здесь важно доказать показать комьюнити что она реальная по этим проблема то что там сообщества демократичная и каждый имеет свое мнение вот и ты говоришь что вот например ворог ли это тогда почему у нас не так все говорят о на фиг нам нужно урока ну и так далее там то есть поэтому нужно показывать конкретные кейсы и конкретные случаи прямо вот прям бить в живое тогда мы удается но для этого нужно уметь во-первых писать на английском был хорошо вот уметь писать много и часто потому что там такие тренды там сотни двести-триста этих самых на это сил у нас сейчас не бывает поэтому и говорю что работать в bonsoir си на порядок тяжелее чем ты работаешь своей компании посты в компании сделал внутренние review все там покури в курилке поговорили за все нормально коичи говорит а все хорошо и хорошо а тут понимаешь целая такая там кучу людей любой любой из вас может взять вот сидит человек пойдет подпишется хакер скажет это и все вот отвечать почему в том что и так далее и это может затянуться там очень долго то есть в этом смысле сообщества на хорошо она свое своим сопротивление потому что эти фичи которые не очень хочется они просто не пройдут вот и только если будете биться до конца до смерти вот я помню первый патч который мы сделали с федей и the gist тот самый известный действия которой все пользуются в любви мы уважаемый там позвонил работает вот км и лаками теле я не знаю просто там я просыпался ночами писал ответы всем конце газу заметили сейчас вот ситуация сам стала еще напряжение потому что подрисовывать сообщества сильно меняется если раньше мы все были фрилансерами ну то есть работали не за деньги а за для души нам было интересно и действительно нас другие базы данных не волновали то сейчас все сообщество теперь дровец а несколькими компаниями и в пять шесть компаний подрисовка все ведущие разработчики они где-то в какой-то компании работают эти компании они хотят быть коммерчески успешным естественно они должны жевательных они работают с каста мерами то есть к нам приходит на пир какой большой к сми говорит я хочу эту фичу сейчас вот никогда бы там про пикнике через сообществе тогда ли вы хотите сейчас вот если к вам придет сбербанк и скажет вы же не можете ему сказать да пошел ты на висит это сейчас сообщества обсудить такого не может быть естественно так и происходит с большими в со всеми компаниями поэтому начинается вот эта работа что каждая компания пытается вот эти фичи реализовывать и пропихивать обратно в сообщество почему это нужно потому что вот это ванильный после сна который мы все говорим о на самом деле является основной ценностью потому что он поддерживается и тестируется очень большим количеством людей естественно фичи которую ты туда пропихнул они будут поддерживаться они будут вылизываться это очень здорово уменьшается затраты на поддержание свои внутрь его своих свою форка так что сейчас компании они борются на рынке с другими базами данных поэтому приходится бороться и показывать что ты там хуже лучше не уступаешь нам с другими у нас основное конечно основной это oracle sql server это так получилось исторически у нас в россии вот и чтобы как-то добиться вот всего от этой работы нам нужны кейсы реальные и фидбэки от пользователей к сожалению наше сообщество несмотря на то что там больше несколько тысяч человек сообществе скажем например в мыле кресте нас всего ну человек 20 из россии вот почему так получай поэтому наши слова вот и очень тяжело пропихнуть сюда вот в то время как там скажем американца там по моему 60 тысяч 60 тысяч пользователей то есть при желании они могут задавить всех вот сказать но хорошо что все таки сообщества у нас более менее дружная и если какие-то действительно серьезно хорошие вещи пропихивают что они принимаются по пятам мы очень надеемся что в 11 сквозь сон пойдет потому что это все-таки стандарт и как бы против стандарта уже трудно отказать вот а всякие индексы и так далее это уже наши расширения и нам нужно доказывать что действительно это работает это хорошо это не приведет тому что кот станет нестабильным да там что где-то что-то ухудшится здесь очень нам придется работать и вот этот бенчмарк у васи сбил очень хорошего для этого дела потому что мы можем говорить что вы видите как все плохо давайте делать лучше еще на прошло примерно значит такая больная тема прямо в кровь на вич делать то что когда мы затеяли наш пасман и каким партиям ванилин после сей не не было то есть был какой-то вялой традиции ничего не было и мы пасман разрабатывались специально для того чтобы все было быстро то есть мы планируем на этапе там их вы знаете надо пользовать из да то есть и все было хорошо а в это время как раз другая компании enterprise себе она проснулась и стала драй ведь пар тишине вот они собственно придумали вот этот сент пробили этот синтаксис который сейчас десятки это очень большой большой большой плюс потому что уже можно писать как бы ну декларативно но как вы знаете внутри то-то все ничего не изменилось внутри конечно парте shining ванильный проигрывать пасман там сотни раз то есть реально те кто пользуется они пользуются по сменам вот и сейчас мы приняли решение о том что нас наступить но придется наступить на горло собственной песне и скорее всего а вот эту пасман немного заморозить до заморозить ну то есть бак составлять а вот эту всю функциональность которого говорить и начать двигать vanilla то есть мы надеюсь что вот водился версию vanilla будет сильно быстрее этот пример такой когда взаимодействия компании и сообщества по крайней мере пока не войдет звонила все хорошее что есть позвоним опасно поддерживать вы да и щелкните вопросы присутствует ну вы хотя поняли о чем разговор то был"
}