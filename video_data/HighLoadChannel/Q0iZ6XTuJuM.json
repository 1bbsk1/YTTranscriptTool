{
  "video_id": "Q0iZ6XTuJuM",
  "channel": "HighLoadChannel",
  "title": "Безопасность ядра Linux: в теории и на практике / Александр Попов (Positive Technologies)",
  "views": 1601,
  "duration": 3735,
  "published": "2023-10-06T07:22:11-07:00",
  "text": "Добрый день Меня зовут Александр Попов мой доклад называется безопасность сидера Linux в теории на практике и прежде чем начать немного скажу о себе Я разрабатываю ядро Linux уже 10 лет и я главный исследователь открытых операционных систем в компании поезде в Technologies выступал с результатами своих исследований на многих конференциях разработчиков и хакерских конференциях обычно я рассказываю про то как там нашел определенную уязвимость Каким образом сделал прототип эксплойта как сделал ответственные разглашение исправление этой уязвимости но сегодняшний мой доклад будет отличаться от того о чем я обычно говорю И сегодня у нас будет такая обзорная экскурсия в безопасности У меня есть две цели доклада первое Я хочу показать вам общую картину безопасности ядра потому что это общее это очень сложная предметная область с большим количеством понятий мне хотелось бы чтобы вас сформировалось общее впечатление я расскажу об инструментах которые в том числе и сам разрабатываю которые позволяют вам настроить ядро Linux в на котором базируется в вашей системе система безопасна и прежде чем начать чтобы говорить на одном языке нужно определиться с терминами у операционной системы в целом Есть множество определений вот мне нравится такое если сформулировать очень емко операционная система это некоторое программное обеспечение которое с одной стороны управляет аппаратными и программными ресурсами компьютера с другой стороны предоставляет некоторые сервисы компьютерным программам которые работают и выполняют основную задачу системы и если говорить про ядро операционной системы это некоторая на мой взгляд самое интересная часть которая занимается основными задачами предоставляет процессорное время процессом Это задача планировщика операционной системы дает доступ к оперативной памяти управляет аппаратными ресурсами И что важно предоставляет средства межпроцессорного межпроцессного взаимодействия между программами и что важно отличие ядра в том что оно работает в привилегированном режиме процессора важно это понимать чтобы отличать ядро Linux от просто операционной системы гнулинукс Linux это ядро это не операционная система она лежит в основе операционной системы гнулинукс Или например Android и заслуженно считается что Linux Это один из самых впечатляющих результативных совместных проектов разработки вообще за всю историю и чтобы определиться какая у меня аудитория хотелось бы просить Кто из вас слышал про Linux отлично кто его использует каждый день почти все а Кто когда-нибудь собирал ядро сам Класс у меня отличная аудитория будем говорить на одном языке просто люди когда говоришь с людьми про Linux они удивляются не знают что это такое на самом деле мы все его используем в повседневной жизни и вот есть отличная статистика из отчета Linux Foundation еще за 2017 год 90 процентов публичных облачных ресурсов работают на Linux 62 процента процент рынка встраиваемых устройств работают на Linux 99 процентов рынка суперкомпьютеров работают на Linux я честно говоря не знаю какой там один процент который работает не на нем и на 2021 год в мире было больше трех миллиардов активных Android устройств вот живых и работающих при этом ядро Linux это открытый проект разрабатывается под лицензией gpl 2.0 и более 4000 разработчиков участвуют в разработке ядра каждый год То есть каждый год 4000 человек что-то закомители в ядро люди которые занимаются разработкой Могут просто сопоставить Представьте размер команды вашей организации там даже 10 человек Представьте Если вы мой тренер проекта Как вы мейнтените проект который разрабатывает 10 человек а тут 4.000 каждый год как ядро взаимодействует с остальным остальной частью операционной системы вот на этой на этом слайде представлена схема в целом это гнулинукс внизу в пространстве ядра находится linuxurnal ядро Linux и оно через интерфейс системных вызовов взаимодействует с пользовательским пространством пользовательские программы Когда хотят выполнить какую-то задачу там например открыть сокет Послать какое-то сообщение по сети прочитать записать файл программа обращается к ядру с помощью интерфейса например системных вызовов Есть множество разных интерфейсов ядро отрабатывает их в рамках этого пользовательского процесса причем ядро оно состоит из части универсальной которая для всего User Space работает есть архитектурный зависимые части которые знают специфику конкретного железа как с ним работать и как предоста ресурсы железа пользовательскому пространству правильно мы сейчас будем говорить про безопасность и вот эта картинка очень важна чтобы Мы понимали про периметр атаки ядра теперь уже больше про безопасность вот Дмитрий предыдущий докладчик упоминал вот эту всем известную Триаду что Безопасность это у нас целостность доступность и конфиденциальность но мне очень нравится добавлять что основная задача информационной безопасности это обеспечивать вот три свойства информации но при этом делать это целесообразно И сбалансировано что это значит вот тут стоит привести цитату брюшная что Безопасность это управление рисками ты не можешь взять сделать безопасность Всего и сразу ты должен чтобы сделать твою систему безопасной определиться сначала что для нее является риском Что является недопустимым событием которого ты бы не хотел чтобы оно произошло и а после оценки рисков вот этих недопустимых событий ты можешь сбалансированно и целесообразно выбрать средства защиты которое закроют вот эти угрозы которых ты бы не хотел то есть для того чтобы сделать систему безопасной в первую очередь нужна модель угроз и она очень разная например для там устройство интернет вещей и системы в предоставляющие на который работает облачные ресурсы или там промышленный контроллер или десктоп система разработчика для них всех разные модели угроз и поэтому конечно разные средства защиты если мы говорим про безопасность и говорим про угрозы то нужно сказать через что они реализуются угроза реализуются Через уязвимости что такое уязвимость это некоторое ошибка какой-то недостаток либо в программном либо аппаратом Либо вместе в комплексе программно-аппаратном обеспечении компьютера которым может воспользоваться атакующий для реализации вот этой самой угрозы то есть не любой баг не любая ошибка в программе является уязвимостью уязвимость Это только тот баг который может воспользоваться атакующий для реализации своих целей А эксплойт это такая программа или последовательность команд которые использует уязвимость и через которую реализуется как раз атака то есть уязвимость от недостаток по эксплойт это действие атакующего если говорить про уязвимости в ядре Linux то ситуация с ними сложная ядро огромный проект больше 30 миллионов строк кода это вот в ядре 5.11 причем темпы разработки Оцените 8900 строк кода добавляется каждый день две с половиной тысячи строк удаляется и 2100 строк изменять это каждый день такой объем изменений причем скорость мержа патчей 9,6 патчей в час и как я уже упоминал 4000 разработчиков участвуют каждый год там огромное разветвленная иерархияров которые обеспечивают вот эту скорость разработки И причем там еще используется четкое расписание релизов которые всегда занимают одно и то же примерно одно и то же время в таком бешеном темпе нужно каким-то образом заниматься безопасностью и контролировать безопасность ядра и конечно у нас для этого есть множество разных средств есть статический анализ и средства статического анализа есть динамический анализ это в первую очередь фазинг как самый результативный способ находить ядерные баги У нас есть санитайзеры с которыми ты можешь собрать ядро и прифазинге обнаруживать повреждение памяти но при этом всего этого К сожалению недостаточно чтобы выявлять и устранять все уязвимости и Дмитрий вьюков который разрабатывает файзер scooler в компании Google он сделал на Linux lambers отличный доклад который называется сказка тысячи ядерных багов он прям конкретных числах показал что к сожалению ядро добавляется больше уязвимости чем их устраняется То есть ситуация с уязвимостями год от года с течением времени ухудшается это факт мы должны его принять для того чтобы двигаться дальше что-то с этим делать это не значит что баги не надо отправить это значит что нужно действовать еще как-то и тут прежде чем говорить про способы борьбы с уязвимостями стоит упомянуть Linux Security modeus модули безопасности ядра Linux просто люди иногда думают но вот если мы говорим Безопасность это значит политика безопасности в операционной системе И вот она решает все вопросы нет Вот тут я хочу подчеркнуть этот момент linuxecurity Models это подсистема в ядре Linux с помощью которого реализуется политика безопасности доступа там процессам к определенным объектам в операционной системе и для ядра линукса ванильного Есть множество реализации лсм там А пармак их много и специальность когда придумал вот эту идею что политики безопасности должны реализовываться через специальную подсистему он сказал вот вот я вам делаю лсм А вы там каждый свою модель безопасности реализуйте и вот не деритесь друг с другом таким образом кто какую захочет тот какую сможет загрузить в игре но важный момент лсм не защищает от ядерных уязвимостей Linux политика политика безопасности доступа она уменьшает периметр атаки то есть ограничивает процесс и те к чему он может получить доступ в системе То есть это можно замечательно проиллюстрировать вот этой картинкой Секьюрити на первой Мы видим что при компрометации какого-то привилегированного процесса системе работает какой-нибудь сетевой сервис с повышенными привилегиями при его комбинации он получает доступ сразу ко всей системе все игра проиграна У нас есть linuxecurity Models то этот привилегированный процесс он будет некоторый песочнице и при его компрометации он действительно не может там Дотянуться до других там процессов других сущностей в системе но если есть ядерная узимость которую можно выполнить от процесса внутри этого внутри этой песочницы то весело сам мгновенно превращается в пустышку потому что получив исполнение кода исполнение произвольного кода в ведре мы можем отключить лсм как атакующий поэтому лсм это не проблема Ой не решение проблемы уязвимости в ядре а какой же есть ответ альтернативный для того чтобы решить проблему с уязвимостями в ядре появился сначала патч от Jura Security и Pax они были там можно сказать пионерами вообще в этой области в вопросах так называемой Self protection самозащиты ядра потом по мотивам джер Security Pax появился kernel protection Project основная его идея в том что нужно разработать в ядре такие механизмы которые сделают целый классы уязвимостей неприменимыми для атакующего так называемыми не эксплуатабельными то есть когда происходит определенный тип ошибки Он уже там приводит например к падению системы но с помощью него невозможно атакующему поднять привилегии Или например возможен такой механизм который позволит на этапе компиляции предотвращать определенные типы ошибок то есть мы да правим баги но при этом как ортогональный подход Независимый подход еще и разрабатываем механизмы которые позволяют расправиться прямо с целыми классами уязвимости а иногда еще и методами эксплуатации потому что для того чтобы воспользоваться уязвимостью атакующим нужно применить определенные трюки мы можем не только типы уязвимости блокировать но еще и трюки ломать атакующему в этом основная идея protection Project и есть у них замечательные Вики есть обзор от лидера проекта кейса Кука о том как protection Project движется вообще по всем направлениям улучшения безопасности ядра таким образом подытоживая вот эту вводную часть безопасности это очень сложная предметная область которая есть множество ключевых понятий это типы уязвимостей методы их эксплуатации для проведения атаки Есть средства защиты которые позволяют там закрыть определенные типы уязвимостей Есть средства отладки которые не Продакшен не в промышленном Промышленной эксплуатации системы а именно на этапе отладки позволяет вам найти определенные баги в Чем все эти средства защиты они еще бывают те которые попали в онлайн те которые все еще разрабатываются те которые вообще коммерческие те же самые а бывает те которые зависят еще от определенных свойств аппаратной платформы то есть используются некоторые фичи центрального процессора для того чтобы реализовать функцию безопасности много сложных ключевых понятий когда я начал разбираться с этой темой много лет назад я понял что мне бы для того чтобы это более системно изучать было бы здорово иметь какой-то графическое представление этой предметной области и тогда это было в 2018 году я разработал карту средств защиты ядра Linux это открытый проект он на гитхабе это майндмэп карта в которой вот в легенде вы видите ключевые понятия которые только что назвал типа уязвимостей средства защиты и на карте каждая линия между объектами она обозначает что между ними есть какое-то взаимное влияние это не значит что средства защиты полностью закрыло определенные векторы атаки это значит что если вы изучаете там вопрос возвратно-ориентированного программирования Посмотрите про определенные средства защиты которые с ним борются с помощью этих связей можно легче двигаться и изучать эту предметную область и важный момент эта карта не затрагивает методы уменьшения периметра атаки системы Об этом я скажу еще позже Это чисто про средства защиты иначе карта была бы слишком сложной Сейчас я покажу в обзоре Какого размера карта чтобы у вас сложилось представление это 5 слайдов первая часть вторая третья четвертая пятая и легенда Вот такая Огромная карта множество связей множество объектов как эту карту читать Давайте посмотрим это на фрагменте карты который касается технологии защиты стеклик эта технология изначально была разработана джер Security и Pax и она шла в их отдельным патче которая применяется к ядру сейчас он коммерческий он закрытый это средство защиты позволяет бороться с тремя типами уязвимостей это переполнение стеков в глубину То есть когда у вас в ядре выделен определенная область памяти на стек и в процессе там рекурсии или выделении памяти на стеке стекпоинтер указательный стык вываливается за границу этого этого региона называется переполнение стекла в глубину второй тип это утечка информации какой-то важной из пространства ядра в пользовательское пространство и третий тип это использование не инициализированной памяти в ядре вот против этих типов уязвимостей в той или иной мере помогает стеклик и Здесь вы можете видеть что есть еще зеленый объект обозначающий стеклик то есть есть определенная реализация в млайне это эту реализацию делал я она попала в ядро 420 Это было очень большая работа которая заняла полтора года нужно было выделить стеклик из общего джер Security патча разобраться в нем переписать 16 версий заняла заняло согласование этой функциональности с мейнтейнерами и с минусом В итоге оно попало в онлайн и теперь оно доступно для всех дистрибутивов Да еще важный момент Вы можете видеть что есть средства отладки которое называется kmsun curnal Memory sanitaser оно позволяет в режиме дебага находить утечки памяти изнутри утечки информации и использование не инициализированной памяти но это не средства защиты которые можно использовать в продакшн это именно средства отладки которые нужно делать нужно запускать в процессе разработки а вот например Более сложный фрагмент карты который касается более интересного вектора атаки перехват потока управления в ядре вот сфокусируемся здесь На некотором подмножестве есть тип атаки называется Return to userspace это такой метод это exploy примитив при котором получив Поток перехватив Поток управления в ядре атакующий прыгает на шелкот в User Space в рамках своего Explay процесса и исполняет какой-то шелкот для того чтобы повысить привилегии там отключить лсм и сделать такие вот действия и против такого против такого трюка Есть средства защиты аппаратные она называется на x864 оно называется СМП на ARM это pxn это некоторые аппаратные средства которые Запрещают исполнять в пространстве ядра код из пользовательского пространства Ну понятно Здорово трюк такой для атакующего полностью закрыт но находится обход общественной защиты это когда мы прыгаем в userspace но при этом исполняем там Роб цепочку используем возвратное ориентированное программирование код в userspace непосредственно не исполняется и там таким образом вот эти аппаратные средства защиты обходятся и атакующий может дальше развивать атаку но против returner programming возвратно-ориентированного программирования Есть средства контроля целостности потока управления Control Flow integrity их множество разных видов есть те которые здесь обозначены синим здесь есть множество разных видов есть те которые зависят от аппаратных средств процессора есть те которые зависят от компилятора и реализуется с помощью инструментации поданные этапе компиляции они все имеют разные свойства разные характеристики и все они здесь на карте обозначены вообще разобраться с cfi было для меня довольно сложно но то есть вот эта карта это плоды долго и кропотливой работы обработки множество разных источников про источники я еще дальше скажу для вас же кто начинает путь в вопросе безопасности ядра Вы можете просто читать документацию ориентировать по карте причем источники которые нужно читать я тоже привожу в проекте как карта реализована несколько слов Ну во-первых важно сказать что карту нужно регулярно обновлять потому что ядро Linux развивается атакующие свои подходы развивают появляются новые примитивы появляется новые средства защиты поэтому карту нужно регулярно обновлять и конечно из-за этого мне хотелось бы иметь исходник карты в текстовом виде для того чтобы вести карту в системе контроля версий как при любой нормальной разработке при этом очень очень не хотелось вот эти все элементы расставлять вручную и там пытаться понять как бы их расположить там на плоскости с минимальным пересечением связей друг с другом и конечно мне хотелось бы чтобы это делалось автоматизировано Я нашел отличный инструмент есть пакет программ называется Граф виз у него есть язык Dot на котором ты можешь описать любую схему и граффист генерирует тебе красивую картинку по ней Причем ты пишешь в текстовом виде проект карты живой успешный и конечно участие приветствуется он на гитхабе Вот пример кода карты который как раз я вам демонстрировал на слайде с средствами защиты стеклик Все очень просто я пишу что стеклик должен соединяться с стрелочкой с Пак с мемори стеклик и граффис рисует соответствующую стрелочку дальше идут две команды которые задают связи между кейсом и детектируемыми типами уязвимостей и наконец остальные связи между средствами защиты и типами уязвимости То есть я просто пишу описание схемы в тексте граффист генерирует красивую картинку Какие источники источников несколько в первую очередь это конечно документация ядра Linux причем появилась она в ядре уже после того как я начал Этот проект сейчас у curnal Self protection Project есть отдельная глава в документации ядра Где вы можете почитать про самозащиту ядра всю эту концепцию про уменьшение периметра атаки очень рекомендую конечно же документация они были пионерами они придумали множество интересных идей и документацию Когда читал их документацию У меня как раз во многом сформировалась то понимание На какие классы вообще разделить уязвимости потому что очень часто Ну вот эти вот классы уязвимостей которые я в итоге выделил это ну мой субъективный взгляд Потому что часто уязвимость попадает там например в несколько классов и мне хотелось именно выделить такие такой минимальное множество которое при этом позволит максимально детально реализовать связи между средствами защиты и типами уязвимостей Поэтому вот этот разбиение на классы уязвимости это вот В каком-то смысле ноу-хау при этом классы уязвимости еще имеют Если Вы посмотрите на карту идентификаторы cw и Common weekness and nomiration есть специальная льная специальная Как сказать классификация Да реестр классификация типов уязвимостей и некоторые из них я связал с идентификатором в commans и nomeration интересный момент Дело в том что у Microsoft есть Microsoft Security respons центр это их подразделение которое делает множество публичных исследований их публикует и вроде бы ядро Windows ядро Linux два разных мира но в принципе то типа ошибок и идеи о средствах защиты оказались довольно похожими поэтому множество знаний Я подчеркнул из на самом деле исследований по безопасности ядра Windows и также есть другие источники на в репозитории проекта можно получить на них ссылки классная карта в теории А что же делать на практике и эту мысль хочется проиллюстрировать замечательные картины Виктора Белова советские ученые теоретики в теории Здорово Что же на практике а на практике Есть огромное количество некоторых параметров безопасности ядра которые на самом деле дистрибутивы наши популярные многие очень часто не настраивают или имеют там небезопасное значение по умолчанию и Конечно хочется при создании своей информационной системы сделать чтобы ядро для нее было более безопасно в соответствии с моделью угроз как я вам говорил но проверять там конфигурации ядра вручную это любят не все А может быть даже никто не любит поэтому я подумал нужно чтобы компьютеры делали свою работу сделаю инструмент который по карте и тем средствам защиты которые есть в ней могли бы проверить конкретные конфликт ядра например того насколько правильно в нем настроены параметры безопасности и я создал инструмент это тоже открытый инструмент называется Key config harden Check тоже в 2018 году и он получил большой успех и хорошее распространение Сейчас я вам расскажу чтобы рассказать о том что он умеет покажу его справку по использованию Ну во-первых инструмент поддерживает на данный момент 4 архитектуры ядра это микроархитектура ядра центрального процессора x864 x8632 r64r то есть для этих архитектур можно проверить конфигурацию ядра во-вторых инструмент умеет проверять опции компиляции ядра это опция безопасности которые закладывается в ядро на этапе сборки из исходного кода в-третьих инструмент умеет проверять опции безопасности в среди параметров загрузки ядра так называемый kurnal com онлайн параметрс и также инструмент может выгрузить результаты проверки в формате json для того чтобы Вы могли вывод от этого инструмента связать с вашими другими вашими другими инструментами и автоматизированным может быть перенастраивать какие-то параметры пример вывода инструмента значит красным я подчеркнул передаваемые параметры это конфигурация ядра при компиляции так называемый кейконфиг и параметры загрузки инструмент автоматически распознал какая-то Micro архитектура какая-то версия ядра каким компилятором она была собрана обозначена зеленым и потом рисует большую красивую таблицу с вердиктами в таблице у нас несколько колонок первое название опции безопасности Какое конкретно параметр ядра мы проверяем второе какое-то тип параметра либо такие конфиг на этапе компиляции либо это параметры загрузки который Передается от загрузчика ядро операционной системе при старте 3 Откуда берется эта рекомендация Я очень не люблю ссылаться на себя когда даю рекомендации по безопасности Поэтому я всегда в первую очередь ссылаюсь на авторитеты откуда я взял эту рекомендацию и следующая колонка 4 Для чего нужен этот параметр безопасности как я вам говорил карта Это только про средства защиты А этот инструмент config harden Check он еще и дает рекомендации по уменьшению периметра атаки ядра в ядре Есть огромное количество подсистем и разных средств отладки которые проявили себя как очень небезопасные и помогающие атакующему и для повышения безопасности ядра важно не только самозащиту включать но еще уменьшать периметр атаки и отключать реально ненужные вам средства и последняя колонка это вердикт OK или фейл проверка прошла успешно у вас настроено ядро в соответствии с рекомендациями безопасности или там какое-то другое значение в чем на самом деле ситуация бывает сложная и нужно строить целые логические цепочки там эту опцию необходимо проверять только для такой версии ядра и только для такой микроархитектуры все это реализовано в инструменте там есть логические операции или и также возможность верить версию ядра для которой выполняется эта проверка опять же обзор 3 4 5 вот такая здоровенная таблица с рекомендациями огромное количество параметров конечно не хочется это проверять вручную для каждой вашей системы да лучше это делать на этапе создания образа системы для вашей конкретной прикладной задачи теперь про источники как я сказал не хочу ссылаться на себя максимально ссылаюсь на авторитетные источники это в первую очередь рекомендации kurnal protection Project Я сам тоже к интервьюер и участник селфи protection Project но при этом эти рекомендации они создаются коллективными обсуждениями и их утверждает Лидер проекта кейс кук то есть Это рекомендации которым можно верить есть также дистрибутив защищенной французский клип ос в котором отличная документация по безопасности ядра где они для всех рекомендуемых опций конкретно говорят А вот это вы включите для того чтобы у вас там были такие-то конкретные системы эффекты безопасности в вашей системе на них я тоже ссылаюсь также по последним публичный патч Секьюрити Не в плане средств защиты у них они коммерческие а именно в плане отключаемых параметров джер Security знает что такое Нужно выключить в вашем ядре для того чтобы максимально усложнить жизнь атакующему эти знания выделил из их последнего публичного патча и добавил в инструмент также есть очень интересный модуль lsm называется Security Lockdown он не так давно в итоге попал в minline-едра этот лсм затрудняет пользователю Root суперпользователю возможность изменить образ системы То есть это немножко похоже на Windows где там администратор и System это разные вещи тут также для при создании в системе цепочки доверенной загрузки и включение Security lot downlsm Root не может просто так изменить образ системы который работает там и те фичи ядра которые конфликтует с лсм я также включаю их отключение в рекомендации моего инструмента потому что поддержка цепочки доверенной загрузке Это очень важный компонент безопасности и также проект успешный поэтому довольно часто мне непосредственно там создают ишью на гитхабе пишут мы интейнеры и дрались говорят Слушай вот это подсистема это прям проблема лучше отключайте вообще теперь про то что под капотом у этого инструмента инструмент открытый лицензия gpl 3.0 пишу его на питоне Я конечно Тут извиняюсь я разработчики дрались уже много лет поэтому к сожалению или к счастью мой кот на питоне очень выглядит похожим на коси Он очень простой минималистичный возможно было бы здорово если кто-то кто обладает так называемым взглядом посмотрел на мой кот и сказал бы как это лучше было бы сказать на питоне при этом установка производится с помощью setuptools в инструменте идут регулярные релизы мы знаем что ядро Linux после после каждой после выпуска каждого очередного релиза ядра есть определенные изменения в подсистеме безопасности их нужно отражать в инструменте поэтому я обычно привязываю релизы инструмента к релизам ядра происходит несколько релизов ядра после чего я делаю обзор того что там по безопасности изменилось Как это нужно отобразить в инструменте и выпускаю релиз инструмента а также я сделал continense integration есть автоматические функциональные тесты с подсчетом покрытия которые запускается при каждом пуше в репозиторий покрытие 95 процентов это здорово Еще бы здорово сделать не только подсчет покрытия кода тестами но еще оценку корректности отработки тестов потому что мало написать тесты которые покроет код нужно еще проверить что тесты правильно отработали Да вот также в работе участвуют большое количество контрибьюторов из международного сообщества это очень радует и Большое спасибо этим контрибьюторам ряд из них из России и приглашаю к участию В разработке инструмента инструмент используется несколько несколькими дистрибутивами Linux при их подготовке пакета ядра в частности каноне субботу использовать мой инструмент российские дистрибутивы они используют Мои инструменты некоторые вообще поставляют к конфиг харвин чек как пакет в составе системы Это здорово и приятно Кроме того Наш отечественный технологический Центр Исследований безопасности ядра Linux также поддерживает мой проект за что Тоже Большое спасибо в любом случае в ядре Linux десятки тысяч опций и потянуть такую работу в одиночку было бы невозможно поэтому я сразу когда просто поступил к этой задаче когда стал делать карту понимал что хочу сделать инструмент Я понял это эту разработку нужно вести открыто иначе ну успеха не будет И в итоге очень ценно контрибьютеры пишут заявки скажем так в хабе говорят что вы знаете вот если включить вот эту опцию там на цену S при таких-то условиях отваливается такой-то функционал наверное Есть зависимость User Space мы добавляем этого документацию это очень ценно такую работу можно делать только сообща ну да про идеи планы что хотелось бы реализовать в будущем во-первых хотелось бы реализовать в полной мере проверку динамических опций ядра не все мы можем пересобрать ядро для нашего для нашей системы правильно Часто мы используем какие-то дистрибутивные ядра но есть множество опций ядра которые можно настроить при загрузке как параметры загрузки ядра и в процессе работы ядра как sis Control И мне бы хотелось реализовать проверки этих динамических параметров в инструменте вот работа в процессе уже скоро будет завершена сидит контролы впереди хотела бы реализовать возможность переопределений и расширение набора правил это как раз попросили мы тренеры из каноников у них есть разные устройства с разными версиями ядра Как как целевые и они бы хотели для разных устройств иметь разные проверки в этом инструменте поэтому я вот думаю что можно было бы реализовать эти проверки как какую-то иерархию сначала базовые потом вот эти для вот этого конкретного применения а потом вот этого конкретного устройства В общем это фича которая хотел бы каноникул далее интересно было бы разработать некоторые инструменты которые автоматически взаимодействует скей конфиг то есть мой инструмент выдал вердикт и был бы какой-то инструмент который автоматически перенастроит опции компиляции ядра и позволит вам там по этим рекомендациям быстренько собрать тестовое ядро это было бы здорово Потому что сейчас приходится в кей конфиг по рекомендациям править это дело вручную хочется настроить вот эту интеграцию с выгрузкой через Джейсон также хочется добавить пятую микроархитектуру риск файлов потому что она все более в тренде набирает обороты было бы здорово проверять опции безопасности которые касаются конкретные риски файлов далее два огромных момента Но которые были бы очень важны во-первых единая документация по параметрам безопасности ядра сейчас когда вы исследуете карту или когда вы смотрите вердикт инструмента вам нужно ходить по документации по разным источникам которые я даю и смотреть А на что конкретно влияет этот параметр Вот хотелось бы иметь это все в Едином виде но это вообще книга получится но да это стоит сделать еще отдельный очень интересный вопрос Это измерение накладных расходов производительности тут все сложно на самом деле потому что накладные расходы они могут быть разные на разном типе нагрузки Мы все знаем что безопасность она не может даваться бесплатно это либо уменьшается удобство для разработчиков либо появляется дополнительные накладные расходы и хотелось бы давать какую-то приблизительную оценку то или иной фичи ядра по безопасности как она повлияет например на СУБД веб-сервер или там просто там чтение большое количество чтения записи файлов там если мы говорим про там сервер сборки который при сборке проекта много читает и пишет файлы вот как повлияет определенные средства безопасности именно на производительность такой системы Это большой интересный вопрос и есть множество людей которые очень хорошо разбираются в измерениях производительности вот тут нужна помощь если вы такой человек Давайте ваши рекомендации будет буду очень благодарен в заключение Я хотел бы подытожить весь доклад связать его в единую цепочку как говорит брюшнайер Безопасность это управление рисками то есть для того чтобы защитить вашу систему нужно оценить риски которые для нее есть Какие недопустимые события для этой системы могут произойти и каким образом какие у нас есть угрозы важные для конкретной нашей информационной системы вот таким конкретным применением после этого по карте средств защиты можно определить для вот этих вот векторов атаки для этих угроз Какие средства защиты мне Важны и с помощью инструмента взять вашу конфигурацию ядра и проверить на соответствие вот этим средствам защиты которые для вас актуальны это называется создать модель безопасности системы и вот как Великолепный пример модели безопасности я Очень советую Android а Google опубликовал эту работу как научную работу Там всего 16 страничек довольно простого английского текста Я очень рекомендую там именно построена вот эта цепочка от угроз к модели безопасности на этом У меня все большое Спасибо Буду рад вопросом прям с первого ряда поехали Александр Спасибо за доклад опишу свою проблему я бы кэндер и у меня есть проблемы с безопасностью как Наверное у многих Потому что есть много штук Как вы сказали а пар море с я Линукс потом докере Ну в общем очень много всего Да я хочу DSL в котором я буду описывать модель угроз в своем приложении Ну как докер файл или еще какой-то другой и иметь автоматизированный линтер который условно как статический анализатор или еще что-то будет встраиваться и проверять надежность моей системы в целом не только ядро Как вы считаете насколько ваш продукт может развиться до Вот именно такого более крупного который будет проверять не только ошибки в ядре а глобально Ну IP tables там policy например и так далее Ну во-первых по поводу Вашей задачи Мне кажется идея сделать инструмент это всегда очень здорово поэтому для того чтобы вам успешно ее решить Мне кажется нужно сначала распределить ваши системы по типу там той нагрузки которая на ней работает для каждого типа из этой нагрузки Определить модель угроз и потом просто для каждой новой системы на которую вы хотите настроить безопасность инструмент должен ваш инструмент должен отнести ее к определенному классу и сказать для нее такой комплаенс вот так ее нужно настроить который решит все Переходи в мобилку зеленую кнопку сделать безопасность нет такого так не бывает вам придется Безопасность это комплексный вопрос поэтому вам придется подходить к вопросу комплексно вот касательно того хочу ли я в инструменте реализовать и там еще какие-то другие функции на самом деле у нас в Linux есть такое понятие unixway Это когда ты в одном в одной цепочке задача решаешь применением маленького большого количества маленьких инструментов которые решают свою конкретную задачу Вот мой инструмент - Это скорее вот UNI а именно по безопасности ядра и то некоторые люди говорят Слушай ну ты только какие конфликт не надо динамические параметры трогать Но мне бы хотелось ещё и динамические параметры на этом я ограничусь я выгружаю в джейсоне берите и делайте что-то в вашем инструментом там Используйте этот э-э эти рекомендации перенастраиваете классифицируете свои системы настраиваете их дальше Мне кажется так можно это решить Если вы хотите ответить на предыдущий вопрос лично подойдите к парню его зовут Илья и Посоветуйте но Илья аккуратных бесплатным советам надо относиться пожалуйста да Меня зовут Владимир компания Дека У меня на самом деле три вопроса но начнем с простого Только ближе микрофон Ладно с простого вот у тебя получается ну он выдает вердикт как ты его тестируешь есть какое-то бестиарий который Ты запускаешь грубо говоря с релизом и проверяешь что те настройки которые Ну предложил тебе сделать ты их съел и они реально работают как-то проверить это смотри конфигурация ядра это просто текстовый файл ты это конфликт ядра это файл который лежит у тебя в репозитории с исходным кодом Ты когда мейк выполняешь он берёт поэтому этот файл Ты можешь проверить там на любой системе То есть ты как-то тестируешь вот это собранный ядро уже набором каких-то эксплойтов тестирование набором эксплойтов ты говоришь про уязвимости Да конкретной уязвимости Нет я проверяю средства защиты там смотреть попахина у тебя ядро против определенных уязвимости это один вопрос включены ли у тебя средства самозащиты ядра это другой вопрос а проверить что они работают проверить что средства защиты работают которые внедриликс есть подсистемы называется LK DTM linuxurnal это подсистема которая при какой-то неправильной ситуации должно привести систему к панике да Вот И там есть набор тестов которые например при конкретной порче памяти запускается у тебя запускается порча памяти если у тебя включены средства защиты ядро упадет в панику если она отключено ядро не упадет это вот такой вот runtime-тест который ты можешь запустить это именно вот есть такая по системе ядра тут по поводу тестов есть еще к Юнит который так давно появился ты его используешь для нет исследования ядра в ран-тайме именно конфигурации ядра нет у тебя был слайде что проблемы онлайн разные параметры соответственно То есть ты же все равно когда формируешь Ну разрабатываешь Какие параметры на что они влияют Ну как-то все равно тестируешь ну по факту там Защитила но не защитило конечно Ну вот Ну смотри это вопросы разработки Да вот этот инструмент это комплаенс да конкретно вот когда я разрабатывался Клик Конечно у меня есть набор тестов которые тестируют что стеклик вот происходит переполнение стеков в глубину и он сразу красят ядро или пытается сделать так называемый селфилинг останавливает этот процесс который сделал плохое действие Вот то есть то о чем ты говоришь это конкретное тестирование конкретные фичи Да и в ядре есть на каждую фичу по безопасности определенные тесты Но это делается не важном ядре лкдм не входит в Production потому что там куча плохого кода который делает плохие вещи это продакшене то есть что мы делаем мы Тестируем что средства безопасности ловят это на диважном ядре в продакшене конечно Этот дебаг отключается и мы просто используем включенные эти свойства безопасности вот как разработчики ядра это обычно делают такой еще вопрос сейчас тоже активно развивается юзер путь юзер драйвера Соответственно что по селфику для них есть ли вообще какие-то варианты Ты про андроидовский там какой-нибудь то есть они же по факту реализуют вообще идеи разграничения между юзер Space curreal Space если говорить с точкой зрения безопасности это там dpk и другие такие решения не полностью ломают всю идею разграничения доступа в ядре поэтому мне кажется если говорить про dbdk это должен быть один процентной системе которая занимается Вот именно там разгребанием трафика и больше ничем каким-то образом сделать его изоляцию с другими процессами Мне кажется будет очень сложно потому что он имеет очень много у себя визер-спейсе Ладно спасибо Александр Спасибо большое за доклад у меня такой вопрос вот есть проект который называется Linux керну рантайм Гард вот которые разрабатывали в частности отечественные разработчики солдат дизайнер Да и в отечественным назвать Вы про него вообще не сказали на слайдах в то же время это тоже protection вот что про него скажете он недостаточно успешный чтобы про него говорить или с ним какие-то проблемы есть Спасибо Guard есть в карте Если Вы посмотрите Вы его там найдете на мой взгляд Ну знаете как одна из одной из моих свежих исследований когда я нашел определенную уязвимость в ведре сделал на ее прототип эксплуата мне интересно стало а Смогу ли я из моего прототипа эксплойта сработать успешно на системе с lkrg я его обошел могу подойти ко мне дам вам ссылку на это исследование я рассказывал об этом лизера Nice Если у тебя есть исполнение кода в ядре то какое-либо средство навесное средство защиты которое болтается в ядре ты можешь легко обойти в любом случае потому что получив кодекс decution ведре первым делом я вырубил LG и пошёл делать дальше получать своего рода Поэтому если вы хотите сделать некоторые навесное средство защиты которая будет защищать защищать от эксплуатации в зависимости оно должно работать по моему мнению каком-то другом контексте гипервире там не знаю в тразоне в каком-то особом режиме куда атакующий скомпрометировав ядро не может попасть Потому что если решить проблему Как говорит Эйнштейн может можно только выйти на другой уровень нельзя на текущем уровне компетенции решить определенную проблему вы не можете находясь в ядре которая скомпрометирована обеспечить безопасность ядра вас уже сломали поздно то есть что можно сделать в ядре это уменьшить периметр атаки и сделать какие-то типы уязвимости неэксплуатабельными Но если эксплуатация уже успешно пошла всё поэтому мне кажется LG для того чтобы быть успешным должен работать например в гипервизере или в трамзоне как Samsung Nox делал раньше по крайней мере не знаю сейчас Samsung по-моему оказался от этой идеи поэтому lkrg у меня есть в карте да я его там упоминаю в плане контроль и целостности ядра но как средство самозащиты ядра от эксплойтов Я считаю бесполезная история Понятно спасибо еще один маленький вопросик Почему все-таки в линуксе нельзя в самом онлайне сделать разумный набор дефолтов для настроек безопасности как например Сделано в проекте openbsd Дело в том что мы интейнеры и дралинукса продолжают перформанс и производительность вот а Безопасность это не про производительность вот поэтому всегда для каждой настройки каждого мельчайшего там процента накладных расходов разворачивается огромные дебаты поэтому Linux это конструктор вот для суперкомпьютера нужно одно для интернета вещей там нужно другое и вот Используйте Linux для того чтобы создать свой конкретный образ ядра для конкретной системы а рекомендации которым следовать опять же зависящие от модели угроз Вы можете воспользоваться инструментами и выбрать для себя Потому что нет общего рецепта который подойдет вообще всем для клауда одно кто-то скажет на Espace нужно ограничивать там процессы друг от друга а кто-то скажет на им спейсы они увеличивают периметр атаки ядра ужасно можем поговорить об этом Потом в общем даже по нам спейсам Мы не договоримся Спасибо проблема спасибо спасибо Артур Манукян задал вопрос э-э полчаса назад Похоже что стеклик достаточно сильно влияет на производительность Как повысить накладные расходы если предположим что количество коротких системных вызовов будет 100 минут например Когда я делал оценку расходов по производительности для стеклик я делал синтетический тест называется Hack Bench это штука которая зовёт много-много коротких системных вывозов передающих сообщений между процессами и вот при этом синтетическом тесте при максимальной вот этой нагрузке У меня получилось 4% а при компиляции ядра просто вот мы запускаем комбинацию ядра на самом ядре собранным с этим с этой фичей там было меньше процента одного меньше одного процента Ну вот как-то так то есть если у вас много чтений там маленьких нет Наверное если у вас много коротких системных вызовов накладные расходы растут Если вы там вызвали один системный вызов который долго отрабатывается в ядре Вы почти не заметите накладные расходы вот как-то так класс как насчет похожий проверки для FreeBSD да да был такой Похоже да хорошо отлично ваша разработка может помочь с поиском про тест VR в ядре или это другое Еще раз повтори пожалуйста а вот посмотри Вот в термин вот этот Может я по-английски плохо читаю протест Да в ядре Я пока в ядре Linux слава Богу не видел просто в общем этих активисты так называемые в ядре я еще не видел чтобы они появлялись вот если их активист в ядре появится это будет в рамках там отправки какого-то конкретного одного патча моя штука проверяет конфигурацию ядра я с исходниками ядра не взаимодействую в прямом виде Поэтому я думаю что никак не поможет Но при этом в ядре Просто я еще не видел синие терке насколько безопаснее сейчас использовать российские Linux с точки зрения безопасности ядра Спасибо использовать российский Linux скажем так более Независимо чем использовать чей-то другой Linux про который тебе завтра могут сказать Ну теперь мы тебе поддержку больше не оказываем там я не буду конкретной компании там говорить Да ну то есть по крайней мере ты будешь чувствовать себя более Уверенно и независимо насчет безопасности как кто настроит так и будет Вот если возьмете рекомендации по безопасности ядра и настроить ядролинг в соответствии с ними Ну молодцы а если нет Ну значит менее безопасны Был ли запрос на архитектуру Эльбруса или самостоятельное использование запросы такого не было Но если будет контрибьютеры которые захотят ее добавить я с радостью возьму но по-моему поддержка Эльбруса в майнлайне она там не принята еще в общем если будет конкретика будем разговаривать конечно но сейчас Зато поддержка арарата во все идет Да пожалуйста Здравствуйте Александр Спасибо большое за доклад вот есть два небольших вопроса собственно Первый вы упомянули так называемые перформансы что вот разные инструменты оказывают разные воздействия вот на текущий момент по умолчанию в инструменте проверки включены такие средства которые сильно влияют на переформанс но мы всё равно их порекомендуем самое влияющая на перфоманс на производительность сейчас это защита от сайта Channel А так это вот эти вот трендзит execution атаки миллдаун Спектр mds L'One TF и вот это вот все то что средства защиты от аппаратных уязвимостей центрального процессора вот оно пожалуй сейчас даёт самые большие накладные расходы это наверное самая дорогая в плане перформанса рекомендация по безопасности остальное все это не так дорого это меньше по-моему меньше пяти процентов или около того есть у меня в описании проекта добавлена ссылка на статью один из контрибьюторов решил проверить включить все опции и сделать тест базовый тест производительности на там по-моему центов он использовал и вот Он конкретный числа дает и гистограмма рисует я вот рекомендую посмотреть вредные проекта есть ссылка на его статью вот it worlder он это сделал Большое спасибо ему и вот второй вопрос тесты друг другу не мешали и в дебене был такой аутов 3 патч который по умолчанию выключает их только чтобы использовать Ну и собственно Возникала проблема что по этой опции нигде нету документации Она помылась выключена Мы хотим ее включить Обращаемся к безопасникам Они говорят Мы не знаем что такое не можем доказать что-то безопасно и включать не будем вот Что можете посоветовать в такой ситуации делать типа Нужно ли как-то пытаться доказать найти информацию или лучше смириться не будем трогать В общем спейсе это такая очень тема раздоров многочисленных в у меня прям вредные проекта есть целый раздел говорящая юзернейм спейсах namespace бывают разные и вот те которые имеют проблемы с точки зрения безопасности ядра и так называемый юзернеймспейсы это name Space в котором ты можешь не привилегированного пользователя отобразить в Рута то есть снаружи им спейса это не привилегированный пользователь а внутри него он Root проблема с безопасностью в таком случае Какая внутри этого фейкового внутри этого спейса фейковому роту доступны те интерфейсы ядра которые обычно не привилегированные пользователи никогда не используют Поэтому если в таком интерфейсе ядра Бага ну его обычно не фазили оно никому не интересно и так круто доступно всё нормально но внутриса если использовать этот интерфейсом э-э netlink например и эксплуатировать там БАГУ то ты поднимаешь привилегии от фейков ворота выходишь из на эмэспейса и получаешь доступ ко всей системе получаешь на неполный контроль то есть юзер который позволяет мать айтишники пользователей это огромная проблема потому что увеличивает периметр атаки ядра но при этом Это позволяет отлично изолировать процессы друг от друга Если у вас там есть один контейнер Внутри там User ID какой-то тысяча от него исполняется много разной работы и в другом контейнере тоже от юзера еды 1000 может это происходить Вы можете это смотреть там на другого пользователя это удобно там для определенных применений Но это несет проблемы безопасности с точки зрения ядра поэтому у меня целый раздел который говорит о том что надо учесть и куда надо посмотреть Прежде чем сделать этот выбор я прям ссылаюсь на конкретные исследования конкретных людей а можно сделать Как создать юзер на эмспейс только со стороны привилегированного пользователя то же решение на экспрессе включены но можно сделать только от рта то есть там много разных способов Я рекомендую туда посмотреть чтобы там безопасники могли решать Да здесь можно а там нельзя Понятно А вот получается проект Он настроен только на мои онлайн или будет как-то учитывать специфический опции Вы можете Какие конфликт проверить для любого вообще ядра но опции как они называются это именно мейнлайновские названия Да если вот если у тебя своя отражена нет но если она не будет там отражена Но если будет реализована фича которая сказал вот эти иерархии наборов правил Вот вы сможете иметь Там отдельный Файлик с вашими правилами и инструмент будет проверять и свои правила и ваши вот поэтому я хочу это реализовать Да вот это теплое общение нужно сохранить над ним надстроить подойди пожалуйста краю сцены и задай вопрос сразу как только вот мы спикеры отпустим Ладно кому подарим подарок за лучший вопрос Вот вот парень Отлично все вот парень Да вот тебе парень да подарок от позитива седовласый парень тебе памятные призы от конференции Спасибо большое за выступление"
}