{
  "video_id": "pIQo6yCicQk",
  "channel": "HighLoadChannel",
  "title": "Архитектура и производительность фронтенда / Павел Павелко (Яндекс)",
  "views": 4827,
  "duration": 2707,
  "published": "2019-01-14T00:10:43-08:00",
  "text": "всем привет меня зовут павел я яндекс маркет там в группе технических проектов и сегодня мы границы для того чтобы их отличать от текущего подхода классического вначале рассмотрим классическую модель классическая модель это та модель которую мы все знаем мы пользуемся ею ежедневно и она очень просто крем приходят делает запрос наш сервер его обрабатывают разбирают после чего формирует некоторый ответ внутри то есть достоин база данных или другие микро сервисы неважно формирует ответ после этого шобла низе руются и в лучшем случае стримит ответ соответственно минусы в этого подхода они на поверхности пользователь вынужден ждать всю страницу даже если интересующие его информация находит на первом находится на первом экране что чаще всего бывает и кроме того загрузка ресурсов начинается только после получения ответа ну потому что список ресурсов у нас находится в еде и нам нужно дать head чтобы его отдать нам нужно начали узнать код ответа узнать заголовки все выставить их и только после этого мы сможем начать отдавать зато этот подход он максимально простой всех in work его реализуют и нужно никаких дополнительных телодвижений ограничения в архитектуре соответственно со стороны пользователей это выглядит как все этапы выполняющиеся последовательно соответственно работа сервера и работа клиента никак не выполняется параллельное выполняется строго последовательно и мы видим что это в общем-то не очень эффективно и если у нас большой странице создает некоторые неудобства пользователю в отличие от прогрессивны моделям прогрессивную модель можно рассматривать как некоторую аналог прогрессивного hpk и строится он на том что мы разбиваемся страницу на некоторые чанки и отдаем эти чанки последовательных клиенту соответственно если у клиента достаточной информации в чанки для отображения которой информация он рендереру на винде литров браузеры и пользователь что-то видят если несколько еще ограничить архитектуры о чем мы поговорим то можно добиться того чтобы эти чанки не просто отображались пользователю но также и были интерактивные то есть чтобы пользователь мог там кликать что-то переключать интерактивный не просто с точки зрения браузера что мы можем то посылки перейти а интерактивные в том плане что у нас джесс про инициализировал ся для этого чанка хотя даче еще идет и этот жест может выполняться соответственно преимущества этой модели но очевидно поглощать и недостатки предыдущей это то что пользователь видит контент постепенно то есть у нас готово часть мы и отдали это называется постепенная отдача либо прогрессивная дача соответственно время до первого байта она практически нулевую если мы правильно все построили и загрузка ресурсов тоже начинают происходить практически сразу же если если сравнить две модели слева находятся классическая справа прогрессивная модель то мы видим что прогрессивной модели есть некоторые парализации между работы сервером и клиента потому что начали отдавать раньше клиент начал работать тоже раньше соответственно общее время сокращается пользователь видит раньше и всю страницу первый экран видит раньше вот и он счастлив для того чтобы построить orchid такую архитектуру введём некоторые абстракцию некоторую структурную единицу единицу разработки назовем ее виджет и дадим некоторые описательное определение виджета через его свойствам во первых виджет он одновременно серверный клиентский то есть он внутри себя содержит и серверную часть в основном это серверный контроллер и клиентскую часть это ну зависимости от того на чем мы строим эти виджеты например если эта редакция он дополнительное пикетом придется с собой тащат и так далее кроме того он инкапсулирует всю логику получения данных он никогда не получает данные сверху он получает только некоторую конфигурацию скажем если нам нужен виджет который отображает информацию о товаре то он получит только идентификатор этого товара он не будет получать всю информацию и сверху а другого виджетом а как достать по индикатору эти данные он решает для себя сам кроме того эти виджеты могут быть вложенными но при этом не какие виджеты не коммуницируют друг с другом но и дополнительное свойство что виджета является бандере в том смысле что ни какие ошибки не выходят за пределы виджеты не на клинч а не на сервере и для примера мы будем рассматривать страницу как раз тот страницу товара есть описание товара некоторые альтернативы и вот справа это первый экран товара странице товара а слева это интернет с которой на нем есть то есть непосредственно в первый экран попадает шапка меню попадает информация товара от аварии и ниже мы видим некоторые стандартные предложений если у нас магазинов несколько это что не попадает в первый экран это аксессуары к этому товару который нужно просчитывать runtime это довольно дорогое удовольствие и аналоги который тоже нужно считать и время для получения аксессуаров аналогов может достигать там секунд до ti2 в то время как для того чтоб получить самую информацию о товаре нужно сходить я лежу базу и это там от силы 50 миллисекунд при этом мы можем стать в виде что некоторые элементы они будут повторяться на всех страницах здесь нам помогает вложенность виджетов то есть если разбить эту страницу на виджет соответственно по цветам я думаю вы догадались соответствие мы видим что хэдер у нас есть меню чуть ниже и вон информация о товаре и некоторые дефолтный offer то есть предложение магазина вот это только первый кран сразу же можно поставить как будет происходить прогрессивная дача при таком подходе соответственно начали запрос только пришел в пользователь еще ничего не видит дерево у нас условно построена и мы начинаем отдачу первые отдается хэдер меню как наиболее быстрые участке потому что для них и не нужно практически никакой информация они улетают обычно в перчатках потом отдается когда у нас готово те самые 50 миллисекунд на достали из базы информацию о товаре информацию о товаре пользователей увидел потом дефолтный offer дополнительный запрос и пользователи уже видно все 1 страница хотя удар у него еще крутится потому что страницы не загрузилась тем не менее он уже видит основной информацию ради которой он пришёл на эту страницу потом погружается аналоги на первом экране у сад из ничего не меняется аксессуары подгружаются то есть спустя несколько секунд и так далее пока вся страница не загрузится сразу заметим какие метрики у нас дополнительные появляются к дополнительно к общим метрикам вроде как да вам контент лады там лодок или first paint и так далее у нас появляется гранулярный метрики для каждого виджета то есть у нас для каждого виджета путь появляется метрика сколько времени он затратил для получения данных сколько времени он затратил от начала запросы чтобы отрендерить их поток кроме того нас появляются клиентские метрики time to render и там-то интерактив для каждого виджета а так как на клиенте мы знаем попал этот виджет 1 кран или нет мы можем строить еще обобщенные метрики соответственно время до рендеринга первого экрана время для interactive с первым экраном обобщенные ну например мы в маркете на эти метрики делаем усилия и если какой-то релиз и превышает это служит достаточным основанием для того чтобы откатывать этот релиз до этого мы условились что виджет ты никогда не получают данные сверху значит если нескольким вижу там нужны одни и те же данные но скажем информацию о продукте то каждый из них получает только продукта иди по которым должен получить соответственно возникает резонный вопрос что делать потому что каждый из них должен запросить эти виджеты это первая проблема а второе но запросить эти данные а второе он должен тебя на отдать на клиент чтобы самом про инициализироваться это означает что у нас будет дублирование данных причем дублирование данных как при запросе других микро сервисом чтобы получить внутри на сервере и либо к базе данных так и при передаче клиент у нас будет дублирование данных если у нас 3 виджета которым нужно интерес данных содержит три раза больше данных вначале рассмотрим проблему отправки данных на клиент как избежать дублирования и клюшки публикации лежит нормализации данных нормализация данных предполагают что все сущности предметной области они хранятся в некоторых коллекциях но по простому ассоциативные массивы где под entity котором лежит непосредственно этот ну скажем по продукта дион если же продукт соответственно место вкладывание одной сущности в другую мы используем идентификатора то есть если у нас с каждым товаром есть список изображения то мы не включаем эти изображения в товара охране только индификатор изображения идут в отдельно коллекция кроме того мы теперь отправляем с каждым держи там не целые данные а мы отправляем почи почи получается следующим образом мы берём данные который мы хотим отправить из них вычитаем все предыдущие данные которые мы уже отправили на клиент соответственно ссылается только разница и эта разница когда приезжает на клиент она накладывается на некоторое общее хранилище общее хранилище предполагают что все все вижу ты которые есть на странице используют именно его и его структура она ну в общем то просто у нас есть некоторая условно та лекция виджетов в которых все виджеты их данные и есть отдельно вот эти общие данные которую коллекции в которых у нас хранятся в ассоциативных массивов сущности предметной области соответственно если у нас есть digit который показывает информацию о товаре он у себя в своих данных храни только индификатор товаром и во вью he он соответственно берет этот индикатор товара берет коллекции из коллекции достает поэтому дети фиксатору нужную сущность и паневин делиться следующая проблема это дупликация получения данных то есть каждый виджет должен сделать какой-то запрос либо другой микро сервис либо в базу данных чтобы достать нужны ему данные соответственно стоит вопрос если нас есть два вижу то каждый из которых хочешь получить информацию о товаре как избежать двойных запросов и здесь мы можем решить эту проблему видя дополнительный слой абстракции назовем их резал дыра соответственно на 3 уровне архитектуры слева видно три уровня соответственно виджеты резольвер и ресурса виджеты это то о чем мы говорим в этом докладе ресурсы нижний уровень это как раз некоторые обертки условное над базы данных чтобы достать оттуда что-то или над другим микро сервисами сами же лизал веры являются функциями для получения сущностей то есть если нам можно получить в индификатор у товара информация о товаре у нас будет три salwar резал в продукт байден который ведет вернет нам товар нормализованном видим на этом же уровне реализуются кэширование и самое важное кэширование и такаши равнину запросу соответственно поскольку все это происходит в одном запросе с клиентом кем пришел сделал запрос и в сети виджет работают параллельно но внутри этого давно одного запроса то если мы будем на этот запрос кэшировать разговора то один тоже ли зол рот конкретно резон продукт байден вызванный два раза с одним и тем же нить в котором товара вернет нам просто запиши ровный результаты сперва вызовом таким образом осуществляется именно дедупликации получения данных есть и более изощренные методы кэширование более общие то соответственно каширование на инсент сервиса условно какой-то рубеж и есть разделяемый кэш ну например мы используем нам кэш для того чтобы кэшировать между инстансами можно кушать не только резольвер и можно пришивать целый виджеты но это отдельную отдельная тема кроме того на этом же уровне можно выполнять волкова нее запросов соответственно если у нас есть два виджета одному мужчин нужно показать информации об одном товаре а другому нужно показать информацию другом товаре каждый из них дергай 3 зол продукт байден но resort продукт байде так реализован тон если несколько запросов попадает какой-то временной интервал он их объединяет и делает один запрос там в базу данных или другой микро сервис следующий вопрос который появляется это как как отдельный виджет может влиять на некоторую общую информацию например информацию о заголовке страницы или там эту информацию и соответственно ну или как выставлять cookies как делать 3 директа и сложность который здесь появляется это каждому какому виджету на какой странице разрешено это делать скажем если какой-то второстепенный визжит настояли на на страницу он захотел redirect то будет глупо делать этот самый redirect потому что он не несет ту информацию которую пользователь хотел видеть на эту страницу и второй вопрос это как не блокировать отдачу здесь подробнее стоит наверно заметить ну например заголовок страницы тайтл непосредственно то что пользователь увидит в браузере в топике например мы хотим показывать не просто заголовок там мой магазин терри назван ну просто магазин мы хотим показать более детализированный заголовок соответственно мой магазин тире и потом название товара который мы продаем а это означает что вам нужно получить начали этот товар чтобы узнать его название получается мы задержим всю страницу для того чтобы прилетит тайтл поскольку тайтл должен идти в ходе а хоть должен идти первым но перед ну вначале что мэри соответственно задержимся страницу вопрос становится можно ли это как-нибудь избежать и ответом но на все предыдущие вопросы становятся единицы работы единстве работаем ну или мы их называем jobo предполагает что виджет не изменяет объект ответа самостоятельного никогда не делает хедер не кратом сад cookies не делает он лишь сообщает что я хотел бы выполнить какую-то работу он выставляет некоторые по желанию а выполнять эти работы будут уже обработчик каждый единиц работы конкретно ну то есть есть отдельный обработчик для единиц работ по выставлению кук отдельный обработчик для тайтлов и так далее для редиректов при этом работам каждой работа может выполняться двух режимов блокирующим режиме отложенном режиме блокирующий режим но как следует из названия блокируют отдачу а отложенный режим не не блокируют и осуществляется это так что отложенный режим выполняться седа с клиента ну например единиц работы cookies в блокирующим режиме предоставления cookies сколько будет выставляться используя заголовок с cookies а в отложенном режиме мы вставляем прямо в поток некоторый скрипт который дергает документ . cookies и меняется соответствующую куку кроме того обработчик может решать в каком режиме он будет выполнять каждую джуму в блокирующим и от или отложенном и здесь множество факторов главные из них это собственно отдаем на страницу роботу или клиенту или человеку если модем робота то например мне мы можем мы обязаны сделать redirect честно через решите теперь то есть выставить код там 301 указать лакей шим куда мы редиректом но если мы даем человеку мы можем точно также встроиться в поток и сказать там условно locations равно и поменять lucky shine интересующий нас пользователю все равно как вы сделали этот redirect но есть redirect условный то есть каких случаях он происходит а в каких-то нет то мы начинаем отдавать страницу еще не знаю будет redirect или нет и только если он происходит мы вставляем страницу и редиректом для пользователя разница почти никакой нету а для робота мы продолжаем этого честном соответственно мы не парнем никакой силы вот все счастливы и человек виде страницу быстрее и робота мы даем правильный контент кроме того может влиять земли мы человеку с отключен джесс или нет если человек пришел и у него джез не работает то и глупым и мы не можем выполнить работу в отложенном режиме будем отдавать ему практически как роботу единственно что роботу мы дополнительно можем по вырезать некоторые данные которые нам не нужны потому что она пользуется не будет соответственно и последний но не менее важное это является ли виджет главным и не является мэн путь каждый вижу среди дочерних может выбрать какой-то главный ну в данном случае например у нас рутовый вида выбирает продукт пейдж к главной оправдаешь выбирает информацию о товаре к главный и если мы рассмотрим допустим низко виджетов захотели выстроить какие-то работы скажем строим эту информацию карт то есть информацию о товаре хочет поменять тайтл потому что не все и у него есть информация о продукте соответственно может выставить сказать ага ко мне пришел пленку значит я хочу чтобы пользу у пользователя был плюс в заголовке кроме того кто-то захотел он cookies выставить кто-то статус и если мы не все работы будут выполняться соответственно аксессуары который захотел сменить статус не является главная страница поэтому изменить статус ему не разрешается а вот карт который является главным на странице имеет право выставлять тайтл менять эту соответственно на другой странице где карт не будет являться главным него такой возможности не будет этажом будет заблокирован если посмотреть несколько другом разрезе с точки зрения таймлайна параллельно с задачей запускаются все эти обработчики job соответственно сейчас мы видим как работать все это дело будет для обычного пользователя пользователь пришел мы должны встать ли хоть что-то написать поэтому первый тайтл мы выставляем блокирующие это условное название нашего магазина нас всегда есть поэтому не блокируй мне как отдачу но когда виджет который получает информацию о товаре отработает и него появится информация как уже на самом деле должен быть тайтл он выставит работу измени тайтл на более конкретный то есть мой шок плюмбум где мы добавим название тамара соответственно эту джуббу мы уже в этот момент мужа даем страницу можно заголовок а далее только тогда у нас появляется информация о том какой какой циклоп на самом деле мы хотим выставить и поэтому это джо бы выполняется отложенном кроме того мы видим ниже кто-то хотел выставить куку она тоже выполнится отложен а теперь то же самое но только когда к нам пришел робот робот хочет увидеть последний тайтл чтобы он у себя мог в поисковой выдаче показать нам правильный что это человек условно ищет в поисковике плюс и у него покажу что это мой shop длинный терплю bus поэтому мы дожидаемся последнюю джуму который выставляет тайтл в блокирующим режиме и выставляем по стране с предыдущим мы видим что начало отдачи сдвинулось потому что мы должны дождаться этого но за там роботу продолжаем и давать правильно контент cookies тоже выполняться блокирующим соответственно redirect снизу мы видим что на нашей странице никому redirect не нужен был поэтому никаких job не было теперь немного поговорим про микро сервисы и о том как такой подход может помочь нам в микро сервисной архитектуре в front энди откуда вообще то берется мы только что взяли условии что все виджеты у нас максимально изолированные друг от друга они не коммуницируют друг другом коммуникация происходит исключительно через данные да у нас есть некоторое общее хранилище охраняющий меня это имеется some widgets у них имеется соответственно отображения напрямую бюджеты не взаимодействуют мы условии что виджет полностью самостоятельно его можно выдернуть ставить на другую страницу и ничего не изменится потому что мы данные не сверху мы покидаем самых получает тогда если мы сделаем наше дерево условимся что она может быть не только синхронным но и часть по деревьев может строиться синхронно ну например у нас есть некоторые микро сервис cms в которые специально люди задают структуру в которой специально люди задают структуру как должно выдать нашу страницу они говорят а у нас должен быть один виджет должен быть другое захотели поменяли их и так далее но чтобы получить эту схему нам нужно сходить в этот микро сервис получить эту схему соответственно один из наших виджетов он не декларируют что вот я ими вот такие вот поддержат и а он делает запрос и только после этого возвращает ну грубо говоря условно в контроллере виджета мы возвращаем там условно promise в котором мы говорим как я на самом деле будет структура соответственно мы получаем возможность строить деревья не синхронно и асинхронно и это дает нам следующую возможность это делать виджеты доводить их до состояния когда не могут выступать в качестве отдельных сервисов рассмотрим такую архитектуру у нас есть клиент ее на эту диаграмму лучше читать снизу вверх у нас с некоторых клиент он пришел и его запросам обрабатывать компоновщик соответственно компоновщик делает запрос в этот отдельный микро сервис совместный получает схему в которой описано полное детализировано какие есть какие есть виджеты нашей странице сам компоновщик знает какой виджет в каком микро сервису может запросить то есть у нас условно есть несколько микро сервисов и би си каждый из которых предоставляет несколько виджетов скажем у нас есть отдельная команда которая занимается только виджетами которую информация товаре показывает да их там может быть десяток а есть отдельная команда которые занимаются только доставкой соответственно их виджета не пересекаются предметную область но они именно они не пересекаются по коду они пересекаются только в предметной области соответственно нет никаких оснований держать их всех в одном сервисе и застали чтобы при обновлении 1 нам надо было катит полный релиз делать нам мы можем разделить их на несколько микро сервисов каждый из которых будет свои свой релизный процесс вот всем быть счастлива соответственно команда там условно микро сервиса а может пофиксить могу своем вяжите релизнуться и для пользователя богата фиксится хотя сам компоновщик никого не задел вот конечно у этого подхода есть минус а ну какой любых микро сервисов у нас появляются и инфраструктурные дополнительные издержки кроме того это издержки на сами запросы типичные ну или там какие чтобы получить эти данные вот и поэтому он не без изъянов но сам такой подход он имеет право на существование и вполне юзабельны хорошо это скажем так не то что вершина айсберга но я хотел дать некоторые высокоуровневые представления о прогрессивном подходе я надеюсь что у меня получилось если нет то я об этом узнаю сейчас вопросов соответственно на самом деле их много тем которые можно было бы еще обсуждать я надеюсь когда-нибудь не получится сделать тоже так на конференция это различные отложенные виджет и ленивые виджеты много связаны с вопросов с инициализацией как правильно инициализироваться вот да но на этом все и я думаю можем приходить вопросам чит ускорился я сильно но это хорошо у нас больше временно вопроса и должно быть много привет павел спасибо за доклад вопрос такой смотрите говорил что есть отложенная загрузка если какой-то виджет загружается после того как уже отобразилась страница вместе нам приходит потом отдельности или до отдельный джесс что делать с режиссерами отложенную ты имел ввиду что я сейчас только 6 посреди до differ виджеты но нам мы храним список все хорошо nav пока полной страницы не загрузилась и когда приехали новые регистры мы прогоняем через нину заново прогоняем всех шина через них для недостающих вот этот ложный виджета не всегда это решает все проблемы не любой виджет можно сделать отложенным для примера хороший пример от ложного виджет а значит наверху в хедере мы видим чисел куда двоечка стоит сколько у человека находится товара в корзине на самом деле чтобы получить мы должны сделать запрос да ну как в нем скатить базе вы получите вам оао шапку хотелось бы уже отдать поэтому мы можем его пометить как отложенный отложенный в том смысле что он будет в этом же не отдельным запросам идти а будет идти в этом же запросе понятно просто данные для него при этом когда не будут готовы то есть мы уже отдадим меню там возможно дадим половину страницу же у нас появится этот чисел k двоечка у нас грубо говоря прям в поток вставляется скрипт который в котором содержится данные для этого виджета для этой точки до грубо говоря там содержит этот патч и в патче идет информация для этого виджета соответственно когда мы его вставим он выполнится патч наложится и вершит рисуются при этом чтобы виджет инициализировал ся нужно чтобы выполнялось там три условия первое что банду приехал до с кодом поэтому имеет смысл гранулированное делать больше банков вот здесь нам поможет тебе два как можно больше банков в идеале это вообще собраны повяжут ные банглы но сочетанием конечно второе условие это было должен приехать данные по должен приехать сам патч может приехать ну разными способами он может приехать например прямо в потоке страница джончик распечатаны он может приехать бинар на как-нибудь через websocket то есть мы взяли там условно через порт above перегнали его там ну и на клиенте распаковали наложили он может приехать в 2 сервер пушками вот не важно он должен приехать то есть у нас бандл должен быть должен патч должен приехать и третье это верстка но с отложенными вижу ты меня нет ну то есть вот это вместо это двоечки будет просто пустота желтого кружка не будет только данные появится ведут от рисуются то есть мы делаем там словно ряд hydrate да и он адресует на двоечку и появится вот этот ложный виджеты я ответил на вопрос еще небольшой вот кусочек уточнения в итоге сам template полностью стиле сразу приезжают потом мы делаем только поход за данными не смотри по ходу в час все что мы говорили это всегда в одном запросе мы не делаем дополнитель запросу с клиента и то есть ленивы виджеты которые только если мы до скролим до них они будут делать запросы но вот все что он говорили мы до этого это всегда все в одном запросе у нас нет дополнительных запросов вот а насчет стиля но мы тоже можем буквально с каждым виджетом присылать стиле вот но если их немного то ну например мы сейчас пока собираем все таки один бандл присылаем его ну там не один там несколько но до присылаем его в ходе спасибо дальше привет вашей спасибо за доклад я твой коллега меня зовут сами бирюков живо литнике короче хочется узнать когда это наконец появится у нас в каком-нибудь приложение на шучу какие-то метрики можешь сказать как было раньше ну по производительности и как стало сейчас с какими-то цифрами по по оперировать ты чтобы стало понятно что это действительно приносит много пользы раны нити нашим пользователям хорошо ну на самом деле он знает ответ пашу мой коллега и он графики знает ну прям с это назвать не могу но я скажу так что до больше всего падает первый байт и соответственно загрузка всех стилей скриптов тоже начинается сильно раньше время рендеринга первой странице тоже падает сильно ну то есть там полтора два раза у нас пока к сожалению время до взаимодействия с первой странице у нас падает не сильно но это связанную с другими проблемами с большим количеством джейсона клиенте legacy тоже мы правильно переживаем ценой технология другой вот но мы ожидаем что упадет и время до взаимодействия с первым экраном тоже сильно когда мы решим эти проблемы вот можно немножко все-таки спросили добавить как как сказал буквально в соседней комнате олег бунин можно мя катки цифры конкретные то есть сколько было в секундах сколько стало в секунду спасибо ну сейчас попробую вспомнить что-нибудь то есть не просто упала значительно да я принялась а конкретные цифры спасибо хорошо да мы верим 15 95 писатель и ну вот rendering первого экрана у нас на доступной версии упал с если не ошибаюсь 10 секунд с 15 секунд 95 писатель да то ли 8 то ли 7 ну в общем как то так мы можем подробнее вот можно мне отловить и мы подробнее поговорим об этом еще раз повторю что если совсем идеально все строить всю страницу по этому подходу будет лучше потому что сейчас кажется да что 10 секунд соронов дофига но это правда но как и повторю что есть пока другие проблемы которые не позволяют в полную меру но эффект уже виден спасибо за так он такой смешной вопрос а зачем эти вложения роботов зачем эти вложения в логику и так далее для того чтобы учитывать работу с роботами arcade олимпу я страницу ним и не учит им хорошо конечный вид если робот умеет выполнять же s конечное вид страницу него будет по осень этичным понятно поэтому здесь никаких расхождений нет но о сем случае сошники даёт добро на это с другой стороны мы если мы будем отдавать всем как роботу то как я уже сказал например нам придется дождаться когда мы получим вот эту информацию про пленку с обыкновенной чтобы выставить тайтл соответственно пока мы не получим вот этот виджет который посередине мы не сможем отдать даже заголовок котором ничего нет не сможет наших и города где вот там яндекс маркет потом ниже идет поиск каталог это все мы не сможем отдать соответственно имеет смысл тайтл вот разбить круг говорил несколько частей виджет он пишется одинаково понятно да он не знаю как джо бы будет выполняться он проскакал я хочу такой тайтл вот и в этом вся фишка что мы для робота отдадим сразу конечно это это чтобы у нас правильно проиндексировал а для пользователя мы разобьем на несколько чтобы не тормозить отдачу страницу ответил я или уточнить эта я могу примеры с другой джо бы дать например с редиректом а зря с редиректом красиво из примера page спасибо за доклад у меня есть несколько вопросов в общем первый это ну вы делаете вот эту штуковину планируете ли вы ее пинсер сеть и можно ли ее почему по сейчас вот легенда на второй вопрос связанный с рисованными ресурсами ты сказал что для того чтобы совершить дупликацию мы нормализуем данный на уровне ризограф можно сказать такое не резон возвращает нормализована данные но нормализовать лучше как можно раньше тем лучше такого не ресурсов так и еще у меня был один вопрос я ещё на 1 не ответил я хотела вот эта тактика да замечательно запутать его первый вопрос касался open source а когда мы только начинали год назад и мы делали презентации у нас не было еще ну где дупликация было только зачаточном состоянии и dice работ не было вот такие же вопросы были в целом мы максимально обособились в этот собор который реализует такую да сам фрибург он ряд среда кс и над этим надо вот так довольно узкое направление он довольно обособлен там нет никаких наших внутренних завязок и мы собираемся panzar сеть это к сожалению не быстрый процесс вот но мы к нему идем вот и если интерес к этому будет ко всей этой теме том конечно же залпом совсем почему бы не поделиться вот хотя и будет лучше если кто-то из вас проникнется этими идеями и запилят вот это все хорошо я вспомнил что я хотел спросить магию в общем про реакций дак собственно в общем есть же еще view и там есть похоже что нет некоторой здесь машину использовать можно да конечно причем дам в планировании этого from орка закладывалась что когда-то там появится промежуточный слой который можно будет поменять более того их прямо сейчас у нас виджеты не только реакторе dax у нас еще некоторые вы даже не знаете таких технологий короче некоторые устаревшие технологии соответственно перевод страницы у нас ощущается таким образом что мы начали его переводим этот второй написано страницу мы разбираем его по вижу там вот этой старой технологии а потом отдельно каждый виджет переводим в на реакторе dogs нам не надо переписывать всю страницу благодаря тому что у нас есть такой подход отдельный бюджет и могут подписаться на разных технологиях вот вам спасибо за доклад вот мы услышали по поводу времени загрузки хотела бы узнать и другие характеристики например как изменилось количество запросов общий объем данных что я потому дима замеры делались скорее всего он доступном компьютере спаржу нет кстати все это начиналось именно на мобильных и у нас большая часть как раз про мобильное устройство потому что дано мобильные устройства там у нас большая боль особенно когда выходишь из хорошего покрытие да да конечно я там за качество и соответственно услышать как в плане объема за количество запросов и как это все чувствительно соответственно по пингу pingu акт pingu смысле к задержке так давай начали про размер по сравнить с обычным подходом классическим дает когда мы набрали весь торт его перегнали потом понимал определились но или вначале это делились на сервере пеленали мисс терке очень то ничего не меняется количество данных те же самые возможность дедупликации станет получше если у вас до этого было плохо устроена то есть дублеры данные внутри сущности но в целом по объему ничего не меняется но просто по труду данный по-другому представляем чтобы можно было вычитать но если все замерзли все эти патчи то получится вот это первый старт самый большой как как при классическим и бы вы набрали большой здоровенный star самого почтенным поэтому дам но объем никак не меняется да дополнительных нет ну единстве что может у кого лучшую сторону если ты нормализовал предметной области оказал что вы вообще тут ведь и ссылались на одно и то же почему и это вынести пир стало меньше вот что касается там был размер а второй было до количество запросов как я сказал это вся отдача и вообще все все это работает конкретного запроса соответственно вот этим появляющийся виджеты это все мы дописываем вижу подготовился мы записали в поток и это все один запрос тут есть ну да это все один запрос мы открыли сопит грубо говоря и мы в него пишем пишем пишем пишем пока всю страницу не закрыли даже если вы диффер вот эта двоечка она тоже запишется в и тот же поток соответственно полнить young вопросу запросов меню с клиентами генерируем если это не специально или не выведут ада количество прос осталось прежним 1 а ну да это во время его работы а вот сейчас эти патчи они приходят в этом же запросе вот здесь ничего нет но если как я не сказал не открывать отдельные websocket которые не всегда можно и коне через него вот спасибо за доклад у меня еще такой вопрос есть кокос реализовываться и вообще если такая тема копы интеграционное тестирование вот selenium или бы этом каким-то образом вот и вот я пока не знаю что вот есть такая проблема то есть когда на страница что-то резко обновляется там догружается то всегда автоматически очень сложно определить то есть момент когда уже странице готовый можно смотреть да да у нас есть конечно же системное тестирование функциональная вот авто тестами ну там условно на в драйвере кое-что ну таймер и тайм-аута ничего такого но он мысленно дождаться причастил мне проще дождаться когда все страницы загрузится и потом уже тестировать и нам все равно что ждать когда при классическом подходе мы и все дадим или вот так почтим будем отдавать вот конечно здесь если в теории будут какие-то баги которые связаны именно задачи до прогрессивный что мы их не отловим да здесь есть такой минус вот но когда мы пишем виджеты они получаются ну прям таких контейнеры и условно можно со страницы выкинуть все но у нас есть такие специальные флажки говори параметр ты передаешь оставляешь например только этот виджет и все остальное но как будто даже не запрашивал ничего не рендерилось я только этот виджет который работает все вот и в идеале если ты в нормально пошли gets у тебя не должно быть с этим проблем сказать что совсем честно построить тестирование прям вот с учетом этого но это сложная задача да им пока такого не делом было вопроса небольших еще можно до рос интерес не это класс два небольших 1 я правильно услышал что перераспределение нагрузки между серверной и клиентской частью мне происходит перераспределение а как можно перераспределить например на железо если вы до этого не делились на сервере вы сейчас re-entry тесь на сервере есть я про это и говорю то что нагрузка никак не падают никак не меняются абсолютно ничего нагрузкой на сервер нет если вы не разбивайте на микро сервисы тогда каждый из них им делиться то нет но тут ожидаемым задача вот виджетов это вот изолированная такая такой контейнер который сам все может достать для себя ibiza это изолированностью мы можем делать вот такие вот прогрессивная дача здесь только про отдачу то есть чтобы взять пользователь пришел к нам когда у нас был сайт классический он подождал там условно в среднем ну типа секунду на него появился к а чтобы когда мы подключили прогрессивную дачу он пришел к нам и он увидел как появляются у него элементы вот ну мы снимали видео это особенно мобильных устройствах когда у тебя недель на покрытие это очень хорошо видно вот это не про распределяли нагрузки хорошо тогда второй вопрос а если какие-нибудь профили как раз поведение при нагрузке то есть нагружаем чем-нибудь и смотрим какое то профиль распределение а что мы увидим ну что что мы ожидаем микрофон лучше вернуть там вернуть а что мы ожидаем увидеть но скажем смотрите классический подход это на самом деле просто крайний случай вот этой прогрессивные прогрессивного да когда мы взяли в самом начале сделали очень виджет который работает самый длительный вот и тогда у нас как будто вся страница придет одним залпом вот единственное что можно сказать насчет профиля должно быть улучшение вангую должно быть улучшение в том смысле что мы rendering и теперь по виджет на точно гранулированное вместо чтобы определить большой то есть но условно вот это вот страница только один rendering может занимать 300 миллисекунд все этой странице вот это дорого но это реакции ничего поделать нельзя пока соответственно эти 300 миллисекунд даже если мы используем сейчас стримы из-за react а они никуда не деваются это большое время которое нам нужно потратить на rendering он практически вот литой но если мы делимся по виджетом то у нас получается гранулированные такие отдачи и между ними у нас могут можем обрабатывать наш маркер другие запросы то есть если для одного конкретного пользователя ничего не меняется вот то в среднем у нас должны попадать пике понятно что условного сварки в час обрабатывать 2 страниц 1 легкое главное у слова и 2 тяжелое нагруженная там вот вот это вот страница особенно если она еще single page какая-нибудь и там есть переключения на большая нагруженная то если к ней человек пришел на эту страницу и параллельно пришел человек с главной и главному не повезло то у него на 300 миллисекунд увеличится время рендеринга во время ночь я правильно услышал что получается графики был средним сглаживаться да да это всё спасибо уже нет времени последний вопрос или уже спасибо спасибо"
}