{
  "video_id": "_yrHoRRQcMs",
  "channel": "HighLoadChannel",
  "title": "Как вложиться в Open Source и не прогореть? / Антон Виноградов (СберТех)",
  "views": 220,
  "duration": 2860,
  "published": "2024-10-29T03:08:40-07:00",
  "text": "Антон Виноградов сбертех Давайте поприветствуем При привет твоя сцена дейст раз 2Т Окей Сейчас Сергей Бережной из Яндекса как раз вот задел Ту самую интересную тему о том Зачем собственно вкладываться в Open Source да Это во-первых для того чтобы код был лучше Да тот момент который я услышал один из самых интересных и во-вторых как он сказал кармический долг чтобы делать хорошо и опенсорс тоже И об этом и многом другом Сегодня поговорим У меня есть немножечко другие примеры Итак а начнём с пары слов обо мне а я с пятнадцатого года занимаюсь разработкой apch ignite это распределённая база данных сейчас работаю в сбертехе где мы занимаемся разработкой продукта на её основе сегодня расскажу про наш опыт именно наш нашей команды нашей компании Enterprise на Open Source на примере одной из фичей которую мы в доли поперёк разберём которую Нам заказали наши камеры а начнём с простого зачем вообще нужен Open Source думаю для многих Это не загадка но всё-таки проговори во-первых Да я думаю лучше Что лучше всего об этом расскажет конечно Ричард Стома но если говорить о каких-то прикладных моментах о практическом опыте то выделить можно следующее во-первых это способ показать себя да доработка Орса - это ваш способ продемонстрировать свою экспертизу Что вы делаете Где вы делаете Как вы делаете Посмотрите ваши коммиты во-вторых это способ использовать готовое тратить меньше ресурсов форкнуть это способ оказать влияние на тот проект который вам действительно интересен То есть если вы каким-то проектом пользуетесь найти в нём бак в вести какой-нибудь тикет не знаю приложить хотфикс или в идеале даже Прити какой-то фий в продукт и реальный пример думаю что в двадцать третьем году все знают что такое 3D принтеры Дани для кого Это не загадка есть дешёвые есть дорогие Да и в целом так складывается что дешёвые - это медленные дорогие - Это быстрые есть ещё ну довольно много категорий сравнений но остановимся на этой для разбора интересного момента у дешёвых довольно топор чная механика и менее производительная ну чем у тех которые справа те которые дорогие Да навороченные навороченные альтернативы которые перформ очень хорошо и у дешёвых Что самое главное у них Электроника начального уровня она простая ничего лишнего там нет на всём на чём смогли сэкономили и там не работали алгоритмы быстрой печати то есть они были реализованы для оплат начального уровня но на самых распространённых платах не работали и всем в целом было всё равно так продолжалось долгие годы как бы хочешь чтобы у тебя были алгоритмы рабочие чтобы печатал быстрее Просто купи небольшую плату за небольшие деньги и всё у тебя будет в целом так все поступали покупали дешёвый принтер к нему плату в комплект там и таким образом апгрейдить сразу апгрейды принтера делали и так продолжалось много лет а Ровно до 21 июля двадцать второго года когда в один прекрасный день один прекрасный человек пришёл и задонатил в дефолт прошивку починку алгоритмов быстрой печати для плат самых распространённых для самых распространённых драйверов и буквально С этого дня вы просто покупаете дешёвый принтер просто его обновляется дефолтов прошивку ничего покупать больше не надо и у вас принтер в два раза быстрее то есть не СПО как Вполне себе Рабочая машинка которая всё ещё очевидно медленнее чем дорогие принтеры там какие-то разницы по фишкам но разрыв существенно снижен И всё благодаря тому что это Open Source что код прошивки открыт что человек взял посмотрел воспользовался и просто починил баг который ну по факту лет шесть всех терроризировала то есть почти все принтеры на рынке этим страдали ну то есть можно было делать быстрее и вот сейчас Те у кого принтеры старые там не знаю пятилетние просто обновляются у них принтер становится быстрее удивительный факт просто благодаря тому что это Open Source и в него человек вложился всё починил всё стало хорошо окей пример хоть и показательный Да такая небольшая байка но не совсем в тему доклада А так что вернёмся к нашему энтерпрайз опенсорс который возможно возможно вас слово Прай в этом предложение немножко отталкивает но только только пока То есть к тому Зачем большим компаниям как например там сбертех вкладываться Open Source ну во-первых самое базовое у нас Open Source - это фотографировать пока рано будет выводы Чуть позже это очень важная строчка привлечении новых кадров Да чаще всего это означает что у вас есть какие-то распространённые практики прозрачные процессы Например у вас из Практик есть код Style код RW чаще всего Open командах которые работают с Open Source проектами общение идёт на английском языке как минимум вот в моей практике И самое главное - это в проектах приживается меритократия то есть власть того кто понимает лучше как это нужно сделать Кто больше знает и больше умеет а также это возможность использовать успешные продукты для компании именно которые уже как-то зарекомендовали себе на рынке которые имеют пользовательское коммьюнити имеют базу да А есть наковер инструкции по настройке и починке а Возможно даже есть какие-то там курсы по этому продукту есть какие-то материалы книги Возможно даже но в целом продукты по которым легче найти экспертов это очень важно для рзно бизнеса но самый важный Аспект это возможность отреть код продукта то есть провести какую-то сертификацию то есть ну все понимают что сейчас почти весь почти ВС импорт замещение програм общения просто берётся Open Source проводится сертификация и это становится грубо говоря Ну российским продуктом и поэтому Open sce работает и второе это возможность как я говори в приме СМИ повлиять на его развитие исправить ошибку или принести какую-то новую фичу которая вам нужна просто начинаете работать вместе с командой продукта и всё у вас хорошо и собственно реальный пример от нашего продукта сбертехом на камер пришёл с проблемой которая шла от базового продукта от где она собственно и проявлялась что при превышении оного порога хранимых данных данных вшей у него происходила резкая деградация производительности перед тем как разбираться именно в сути проблемы Давайте да и том как мы её решали решили Давайте Сначала пройдёмся по вводным данным по продукту чтобы было больше контекста Итак как я уже говорил наш продукт - это распределённая база данных основанная на Она позволяет хранить больше данных чем вы можете хранить На одном сервере есть у ва есть ыва одним сервером Дина точка вхо там данные и вы можете эти данные обрабатывать так же как если бы они лежали грубо говоря На одном сервере то есть Единый центр хранения и обработки данных и собранной из кластера это KV storage это SQL это честные распределённые транзакции сервисы И на самом деле много чего ещё большинство сидящих в зале Я думаю косвенно являются пользователями именно нашего продукта даже не apch а именно нашего продукта через использование сбербан онлайн Когда вы оплачиваете покупку вы используете как минимум токини заторы процессинг которые используют нас на слайде немножко про их масштаб и нагрузки которые ну одноно довыебывались опасных ситуаций у себя там на железных дорогах есть и другие вендоры кроме нас которые на базе создают собственные продукты имеют кучу инсталляции там в банках тоже себя деплоя в целом зарекомендовавшие себя и проверенное временем Open Source решение где пользователь столкнутся с проблемой Да и для понимания сути проблемы Давайте сначала проследим путь который которые данные проходят в базе Да прежде всего они выпадают оперативную память где они будут разложены по страницам который помимо всего прочего страниц - это удобная форма для зеркалирование данных на диск страничная запись крайне эффективна Да там жёсткие диски к этому всегда готовы для гарантии записи мы используем журнал изменений в headlock который заполняется непосредственно перед тем как мы запись из оперативной памяти произведём на диск в него мы записываем страницу которую мы изменили да либо Дельту этой страни если мы в рамках одного чекпоинта изменили больше одной страницы Это позволяет нам переживать отказы оборудования допустим выключили свет момент чекпоинта того момента когда у нас из памяти грязные страницы сбрасывали на диск да и у нас либо не все страницы сбросились и мы потенциально потеряли данные либо у нас ка какая-то страница сбросилась наполовину потому что жёсткий диск обесточил и в этом случае мы просто Стартуем ноду до накатывает из ВТА Лога физические страницы на Stage и получаем конное состояние на в тот момент когда у нас выключили электричество то есть всё безопасно а также ВТА hw мы храним логические операции они используется для восстановления консистентность не одного узла Да а целого кластера Ну например а опять же при отключении питания если мы были не в чекпоинт а просто где-то вот там между чекпоинта у нас какие-то какие-то данные приходили то мы по логическим операциям создаём изменения просто пробрасывается на снова данные не потерялись то есть нам как и в любой другой системе позволяет не терять данные гарантированно либо другой вариант у нас кластер в нём есть узлы узлы хранят данные разные Да у нас моргнула сеть к ненадолго отключился от сети потом вернулся и у нас есть два варианта То есть как бы он немножко отстал по своим данным от всего кластера и нам нужно это отставание сократить РИА но нужно просто на него перебросить все данные которые есть в кластере которые Ну там не должны распределяться это может занимать дни потому что данных может быть очень много либо вариант второй если он отключался не надолго то мы просто перебрасывать на него только вот ту Дельту из роты Лога которые соответствено его отставанию и всё это может происходить за пару минут узел возвращается и всё в порядке также мы используем эти логические записи для механизма грубо говоря просто подписывание на ивенты об обновлениях каких-то интрей да И мы этот механизм используем например для межклассовая что происходит кладём данные в базу Да Гарантируем запись операции синхронно то есть синхронная запись на диск Перед тем как мы говорим клиенту что мы всё твою операцию обработали не беспокойся она сохранена а потом асинхронно когда на копим достаточное количество грязных страниц в памяти мы сбрасываем их на на Дис на чекпоинтов неш системам например там механизму асинхронной репликации почему с некоторого момента начинает деградировать производительность всё очень просто потому что мы можем хранить больше данных чем влезает в нашу оперативную память со второй версии У нас есть синхронизация с диском и вот в памяти страниц на диске мы храним пять на самом деле там как бы конечно порядки другие если мы совершаем операцию по странице который нет в памяти то для того чтобы подгрузить её с диска Ну в памяти её нет да Нам нужно какую-то страницу из памяти вытеснить чтобы на её место положить ту которая нам нужна готово А Итак мы делаем Каждый раз когда у нас нет той страницы которая должна быть в памяти снова читаем Не из быстрой памяти и Ну а из диска которые там на пару порядка медленней и собственно прощая performance и это то с чем столкнулись наши кастомер у них иногда данные переставали влезать в память начинался реймент резкая деградация То есть у них было 3 миллисекунды допустим А И становилось 30 мсн В девяносто девятом пересели что как бы ну очень не очень избежать с этого варианта можно очевидно двумя способами Ну то есть проблема в том что у нас не хватает памяти данные в неё не влезают первый вариант очевидный Давайте добавим больше памяти Это довольно сложно сделать если на у вас на сервере уже почти терабайт памяти Где взять сервер с двумя терабайта памяти особенно в текущих реалиях а вариант номер два мы можем немножечко потрудиться и сжать данные которые лежат в оперативной памяти Да и собственно мы пошли По этому варианту если сжимать те данные которые раньше занимали всю память то появится место для того чтобы те данные которые раньше не вылезали но нам были нужны в память поместятся Ну собственно всё очень просто мы просто сжимаем и помещается чуть больше да давайте перед тем как говорить именно о том как мы это реализовали да прикинем А всё у меня не та кнопка Пардон да Перед тем как мы это всё реализовали прикинем сколько же у нас данные занимали места до чтобы ну оценить влияние того что мы собственно сделали сде для оценить то как это было раньше и допустим вот у нас бенчмарк стримил какие-то данные Да не будем вдаваться в подробности и что Получилось получилось что в памяти мы храним 1,4 Гб на диске мы храним ровно столько же потому что у нас зеркалирование один к одному а в вра хлое поскольку мы храним Страницы или их дельты мы храним логические операции это занимает больший объём то у нас получилось 3,3 ГБ что ж а оценили как было до Да и теперь нужно решить как мы собственно будем делать сжатие а чтобы у нас и эффект отжатия какой-то был высокий да И фонс при этом у нас не продевается сжимать данные на входе в систему То есть когда пользователь отдаёт данные Да мы их сжимаем как бы и всё хорошо будет ли это эффективно Ну это на самом деле вопрос зау Если кто-нибудь скажет да нет О'кей хорошо А обычно данные - это какой-нибудь ключи это какой-нибудь интеджер а означение какой-нибудь какая-нибудь там строка среднестатистический байт на 200 ну там какой-нибудь ФИО город что-нибудь такое большинство данных они вот статистически такие И какой результат мы ожидаем от жати Абсолютно верно никакой потому что данные малого размера Они или сжимаются очень плохо или никак Ну но мы храним данные в страницах они значительно больше по объёму там уже 4 КБ например да и значит вероятность жати этих данных гораздо выше хоть чуть-чуть Но точно сжимаем Ну вот примерно там вот какой-то такой рейд может быть он лучше может быть хуже что-нибудь Да сожмётся сжимать сожмётся в памяти сожмётся великолепно прекрасно всё самое жирное мы сжали кругом одна экономия перспективно есть небольшая проблема она заключается в том что не во всех случаях у нас получится сжимать страницы Да и мы изначально решили что сжимать страницу - это хорошая идея потому что они хорошо сожму да Потому что меньше после сжатия но в идеальном мире это именно так бы и было а в реальном мире мы запишем ровно столько же потому Ну с нулями либо начале или в конце потому что как я говорил мы зеркалирование ни он наверняка будет более громом занимать время место как бы ну это будет не очень хорошо вот то есть мы если будем нажимать страницы мы решимся этого преимущества это проблема то есть грубо говоря Имея эти два ограничения мы приходим к тому что для того чтобы всё просто продолжило работать как оно работало раньше после сжатия страницы мы должны получить обязательно тот же самый размер что немножечко идее сжатия противоречит Но на самом деле есть трюк а трюк заключается в том что мы можем увеличить страницу кратно допустим с 4 до 16 КБ и если после сжатия у нас появляется свободная место которое больше или равно блоку файловой системы то это хорошо и в этом случае мы можем использовать этот блок для Других данных почти все современные файло системы имеют возможность работы с разряжённый файлами А вы просто говорите в файловой системе что вот этот блок ты можешь использовать для любых своих Других данных которые тебе захочется сюда перенести и она его занимает То есть просто говорите панч хол и просто всё продолжает работать у вас файл как лежал один непрерывный Так и лежит адресация работает при этом файловая система ваши дырки использует для Других данных это очень просто э делается Конечно есть там вопросы быстродействия но экономить так реально А проблема в том что это подходит только для диска потому что на диске есть файловая система А мы храним данные в вхи в страницах каких-то там наших структурах дата регионах чисто теоретически мы могли бы написать страничная там да с разряжённый всего пришлось бы переписать почти всю базу прям вот почти вот реально всю и при этом мы получили бы другой продукт с другими там преимуществами недостатками как бы да это слишком выглядит слишком жёстко ради одной фичи вот поэтому приходим к тому что сжимать страниц мы именно страниц мы можем только на диске и данный вариант никак нашему камеру не поможет Хотя в целом Кто знает может быть завтра к нам придёт кастомер и скажет вы знаете у меня есть проблема я пишу на диск файлы Да точнее пиш пишу данные у меня вот заканчивается диск как бы да И это для меня проблема И тогда для него вариант жать страни на диске может быть очень-очень полезным что ж Давайте оним какой Профит можно получить для того чтобы потом сравнить с вариантом который для камера и оценить их между собой из-за того что мы вообще ничего не делали в контексте оперативной памяти мы продолжаем работать с СМИ данными на записи на чтения у нас нет деградации в контексте работы с памятью не для чтения не для записи а для ну для чтения у нас нет деградации вообще то есть мы просто забираем данные из страницы в памяти и всё у нас хорошо ничего не меняется сжатие при записи у на происходит наме чекпоинт Да это асинхронная операция которая если мы не перегружая ет на то есть тоже всё хорошо с логом чуть хуже хло мы вынуждены делать синхронно для того чтобы гарантировать пользователю не потерю его данных Да и поэтому у нас есть некоторая могла бы быть некоторая деградация на н но интересный момент здесь в чём мы чуть-чуть уменьшаем размер га и даже с учётом того что мы тратим некоторое время на C на сжатие мы пишем меньше на диск и примерно то на То на то и выходит То есть у нас грубо говоря сжатие становится бесплатным то есть чуть-чуть меньше CPU потратили чуть-чуть больше CPU потратили чуть-чуть меньше записали примерно тоже самое по выходит Окей напомню что главной фишкой всего решения то что мы увеличили размер кратно страниц да там по 16 КБ сделали вместо че у нас в памяти 16 на диске Отче до 16 и собственно всё что сжимаем всё наше Итого сжатие больших страниц как минимум вот в нашем бенчмарке показало очень крутые варианты почти в пять раз мы сжимали килобайт xml сжимали его с помощью спи не увеличился при этом размер влога чуть-чуть уменьшился Что позволило Что позволило нам избежать явной деградации в эсе то есть Всё в рамках статистической погрешности и это тот вариант который был реализован пай до того момента когда пришёл кастомер собственно поэтому кастомер и пришёл потому что он ему никак не помог Несмотря на то что сжатие данных у нас было заявлено в базовом продукте а это значит что нам нужно было либо доработать решение либо придумать что-то ещё но Напоминаю что доработать мы не могли потому что у нас в памяти не сжимается нам пришлось пере переработать всю систему И даже если бы мы в принципе всё переработали мы бы столкнулись ещё с одной проблемой мы бы на каждом чтении вынуждены были бы разжимать по 16 КБ ницу что по перформанс очень очень нехорошо то есть Ну это точно путь по которому не стоит идти Окей Может быть кто-нибудь знает вариант по которому можно было пойти и как как помочь кастомер Как сжимать данные в памяти загрузок скажем так или выг Ну то есть мы ням все холодные данные в порядке записи из памяти мы берём выделяем вот как у вас на рисунке один блок памяти и его переиспользовать мы обсудим в дискуссионной зоне хорошо тут просто Вопрос в том что данных действительно больше чем оперативной памяти то есть не сжимать не вариант нам нужно держать их все в памяти для того чтобы они все были горячие чтобы их за единичку грубо говоря из памяти дёргать и в этом главная проблема Окей А в целом единственный вариант это был откатиться к первоначальной идее Да сжимать именно сами данные сжимать не страницы а сжимать самы данные большинство данных они статистически малого размера то о чём я говорил раньше но нюанс в том что небольшое количество больших данных может занимать огромное количество места потому что они большие как бы да там и в реальных окружения оказалось что это половина всего объёма а большие данные сжимаются хорошо огромные данные сжимаются просто великолепно а данные малого объёма мы при этом можем просто игнорировать То есть если мы допустим какой-нибудь Холд поставим там на 300 бай то мы просто эти данные вообще никак не сжимаем и идём дальше экономим CPU Ну то есть нет деградации на малых данных с ключами ситуация интересней а ключи к сожалению какого бы большого размера Они не были сжимать нельзя А почему Потому что ключи - это наш способ индексации данных а и главное ну какая проблема то есть если Если бы у нас алгоритм сжатия был детерминирован грубо говоря то наверное да но смена версии архиватора даже одного и того же да у нас будет давать немножко разные байты и чисто теоретически даже один и тот же архиватор одной и той же версии на разных допустим операционных системах может давать немножечко разные байты Ему же Главное чтобы данные сжимались и жима да А не то чтобы байти были одинаковые вот совестно у нас шкод будет Разный будет разный индекс мы построить не сможем Ну и в целом э хороший момент в том что ключ - это обычно какой-нибудь integer да Или его аналог и в целом тут нечего сжимать поэтому как бы тут и делать-то нечего и мы оставили индексы в покое оставили ключи в покое и начали сжимать только значений сжимаем только значение в памяти а автоматом они зеркалит на диск автоматом они сжатые попадают в дельты и в логические операции вспоминаем что у нас есть механизм сжатия страниц которые мы использовали в предыдущем варианте используем его и получаем что абсолютно везде мы имеем сжатые данные то чего и хотел кастомер на самом деле кастомер хотел чтобы у него просто память сжималось да получилось что сжимается везде и Давайте пройдёмся по результатам в три раза мы уменьшили Ну вот на нашем бенчмарке с килобайт мм потребление памяти что прино соответствует тому что происходит с реальными данными мы получили на диске конечно это меньше чем то что мы могли получить в предыдущем варианте со сжатием страниц потому что страницы были бы 16 Гб 16 КБ сжимается лучше но это тоже хорошо вот опять же возвращаясь к венс Да мы очень сильно увеличили генерацию влога которая пишется синхронно перед подтверждением камеру который мы Ну не можем записать после и это уменьшение размера райта Лога позволило нам добиться очень интересного момента а мы улучшили НС операции то есть в данном подходе мало того что мы экономим место для кастомер для других его данных так у него ещё и н операции записи улучшается Вот это н смешанное чтение записи то есть мы делаем одну запись и четыре чтения это смешанная Н В этом бенчмарке то есть ну представляете себе насколько н записи стало лучше а да сейчас немножко назад Да собственно мы мерили на SSD хорошем SSD плохом на шпиндельной диске мы не мерили к сожалению у нас такого не было но Чем хуже диск да тем лучше прирост нси по отношению к не сжатому варианту и переходим собственно к тому С чего начали к энтерпрайз наму опенсорс Да мы реализовали сжатие как часть нашего продукта А как преимущество его перед ванильной версией То есть у нас есть все фишки из базового продукта вот а да В нашей в нашей сборке да и у нас появилась ещё одна Ну одно преимущество на д да вот то что мы разобрали жати на самом деле фишек гораздо больше Да но вот разбирали именно сжати и здесь на самом деле можно было бы закончить выступление на том что Open Source это круто берш его как бы да форка дееь пару фичей затраты минимальные Профит свом именем продашь как бы всё успешный успех круто же да ну в моменте наверное на самом деле я знаю людей которые именно так и думают в моменте это круто пока бы вот вот на этой стадии Когда вы форкнуть когда вы начали продавать потом вас постигает вот это Open Source АйТи из него приходят изменения чем больше у вас приватных изменений тем больше у вас вот этого на каждом апдейтер каждой версии Я знаю пример где просто Ну люди забрасывали разработку потому что этих коммитов становилось настолько много что уже невозможно смержить Как бы да и проще просто выбросить своё и написать заново и рано или поздно Да вот как бы вот в любом продукте Где вы форка ете и делаете приватно У вас это будет основном занятием окей можно поступить полностью противоположно можно ВС делать в орсе вы такой вот этот вот кармический долг Вот вы его отдали вы сделали фичу в орсе например опять же вот сжатие в памяти которые сегодня разбирали его можно было полностью реализовать в орсе как бы не проблема и ждать пока не появится кастомер который альтернативный вендер который назовёт этот Open Source своим именем и будет продавать его как замену вашего продукта что уже звучит как не очень прибыльный вариант Если вы хотите на этом деньге всё-таки как-то зарабатывать да И что же делать если вам не хочется заниматься постоянным резом конфликтов но и отдавать первому попавшему камеру ваши доработки да не хочется да Или плагины Когда у вас базовые функции доступны в Open есть ванильная версия Где у вас базовая функциональность Где у вас всё есть фишки какие-то дополнительные Да вы предоставляете либо в плагинах либо в платной сборке и мы пошли По этому пути ради сжатия ради того механизма котором сегодня рассказывал просто его реализовывать то есть движок зна в Open Source у себя в плагине реализовали сжатие данных как частный случай их трансформации Ну то есть сделали Всё как нам нужно в плагине там на наших на наших алгоритмах которые вот прям вот наши Да с нашим тюнингом с возможностью это всё дело главное продавать вот если сводить в табличку да схему того работаем ССО отд нам не нужны м конфликты да бафик нам не жалко отдавать мы отгружаем доработки ядра включая новые функциональность которые мы придумываем мы отгружаем то что мы не можем реализовать в плагине по каким-то причинам и то что в плагине будет работать не эффективно а будет работать эффективно ближе к едру вот это то что мы отключаем отгружаем в Open Source и ключевой момент здесь в том что мы это делаем Главное понимать что мы это делаем не по дов душевной мы это делаем потому что это наиболее подходя место для необходимых нам изменений и мы хотим избежать меж конфликтов То есть можно сказать что мы вынуждены донати в Open Source но опять же всё что можно сделать в нашем плагине мы делаем В нашем плагине Да у нас есть огромный набор бенчмарком именно вот про High про наше серьёзное железо про наш продакшн Да которые выявляют потенциальные проблемы для нашего прода Ну если кто-то помнит там был слайд где 2,5 млн операций в секунду вот собственно это то что мы Тестируем в рамках нашего форка также очень важный момент что мы можем накатить патч уязвимости нулевого дня если Open Source лизи раз в квартал то у нас релиз выпускается в течение пары часов что очень важно для продакшена когда мы понимаем что есть уязвимость мы можем предоставить новую версию и бывают случаи когда у нас у наших камеро бывают какие-то особые за которые по каким-то причинам нельзя влить ком такие проблемы мы тоже решаем В нашем рке Да и решаются Они через К сожалению те самые приватные ко приватные коммиты и собственно Да мы конечно же не уходим от Ризо Да у нас есть необходимость при потягивании изменений несколько конфликтов реть но зато мым что этих этих коммитов У нас очень мало они не доставляют почти никаких проблем но кастомер доволен это главный вам может не показаться что а Enterprise использует Open Source в своих целях собственно выжимаю Профит да до последней капли а компания экономит деньги используя готовый проверенный продукт э имеется возможность доработки этого продукта Да и огромный бонус по пиару по найму по маркетингу что мы используем Open Source как бы да меньше проблем с поиском специалистов но продукт в целом получает не меньше И вот это вот собственно то на чём я хотел бы заострить внимание во-первых он получает расширение коммьюнити и ускорение развития продукта Потому что от нас идут контрибьютор железе то есть серьёзный вендер с большей охотно возьмёт этот Open sce к себе и несерьёзный тоже Ну просто на серьёзном железе это стреляет чаще на несерьёзно иногда Но тоже неприятно то есть мы вычи проблемы которые проявляются на хорошем железе и главный момент для почти любого опен сорса что у него в принципе нет финансирования а компании которые используют Open Source они предоставляют опенсорс мощности например мы для па за донатили железо и команду девопсом у них был CD проекта то есть сейчас почти весь CD проект поч гет на наших мощностях и наших Псах и в итоге на самом деле очень большой вопрос Вот кто из них в большей выгоде Open Source даёт энтерпрайз наработки А ну в то время как Enterprise вкладывается в развитие Open Source да А сейчас и собственно И вот так по кругу да И надеюсь получилось да получилось ответить на вопрос почему Enterprise складывается Open Source Почему это не альтруизм а взаимовыгодное сотрудничество Да и рассказать про наш опыт который Ну вот нашего продукта где мы действительно вот у нас была проблема кастомер мы её решали через Open Source при этом не потеряли возможность зарабатывать на этой фиче то есть не только для этого кастомер для кого-то ещё продавать Вот и надеюсь что вопросов не осталось но если осталось то с удовольствием на них отвечу Итак давайте тогда у нас есть микрофончик Давайте первый вопрос здесь и потом вот в конце зала у нас будет молодой человек туда микрофон пожалуйста Представьтесь и так Алексей ба Hunter подскажите пожалуйста три вопроса Первый Вы сказали что вы нажимаете Ну большие Ну как большие куски данных то есть какой алгоритм сжатия вы использовали на самом деле у нас поддерживается как минимум три алгоритма это S4 и возможно что-то своё скажем так понял спасибо второй вопрос Вы сказали что те же интеджер или сериалы Они не сжимаются но у того же кликхаус есть кодеки специализированные для сжатия Ну как медленно изменяющихся данных Диш и которые меняются бы потихоньку там секунды или микросекунды текут То есть вы их не собирались или не планировали использовать эти Понял Вопрос Мы едим слона по частям То есть сейчас мы решили ну 90% проблем с местом то есть 90% данных которые можно было сжимать мы простым понятным способом сжали Если вдруг почему-то потребуется сжимать именно ключи то воз рассмотрим я говорил глая То есть это должен быть какой-то один алгоритм который не будет меняться со временем То есть это не спини что-нибудь такое но проблема в том что здесь смотри Профит не очевиден то есть у нас обёртка занимает больше чем сам Ир то есть мы получим какое-то минимальное количество улучшений А потратим для этого достаточно много ресурсов то есть скорее всего мы это делать не будем понял и самый главный вопрос вы говорили про кластерную базу всё-таки Хотелось бы услышать подробности как этот обеспечивается транзакционный базе те же волы коммиты е в случае падения там одной ноды как они пишутся там на одну какую-то параллельно на все то есть ну и в случае падения вообще что происходит как обеспечивается вот эта распределённая транзакционный коллега Максим Тимонин рассказывать там будут раскрыты эти моменты но В общем я расскажу что у нас двухфазный комит Ну точнее У нас есть вариант атомарных операций У нас есть вариант однофазного комита есть вариант двухфазного комита а вре headlock на каждой ноде свой он локальный и у нас есть механизмы Recovery есть механизм через consistency Cut допустим там на точку какую-то вернуться во времени или восстановиться на точку во времени то есть такие варианты на дву трёхфазный ко он наль мале Давайте дискуссию про охд в кулуарах проведём потому что я подозреваю там хочется в деталях покопаться А сейчас ответим на вопросы вот молодой человек пожалуйста в конце зала Да здравствуйте Меня зовут Арсений компания спите такой вопрос Это нормально Это нормально дадада Вот вы всё прекрасно там рассказали это всё работает Когда у вас команда теров над орсо но а как вкатиться в Open Source это гораздо сложнее Мне кажется чем войти потому что я уже сделал там пол реквест не знаю мне кажется штук 20 а принимаются они там процент 15 наверное Ну есть такая проблема конечно да Вот пример Хороший вопрос кстати пример кстати прямо из нашей команды У нас есть контрибьютор в кафку и собственно от них я слыл кавка - это самое недружелюбно Мне кажется сообщество Да и от них я слышу именно то что ты сейчас говоришь что есть проблемы см котов Да ну собственно скро терник звёздам Да нужно просто делать то есть со временем чем Ну то есть начинаешь сби тикетов втираешь в Доверие тебя уже грубо говоря знают то есть смотри с он Сорсо главный момент в чём а тебе нужно не стать обузой то есть тебя если по имени уже грубо говоря узнают что Ты приносишь комит которые можно не особо валидировать и там есть уверенность то что ты прогнал не знаю там регрессию а у тебя сход стайм Нет проблем у тебя там тесты какие-то особые не выстреливают да то что ты знаешь что ты делаешь Что нужно просто принять Т комит его принимают то есть вот те люди которые втираю в Доверие у них очень быстро заходят Коми на самом деле Спасибо Спасибо офигенный вопрос так давайте вопрос здесь и вот человеку молодому Да спасибо за доклад два вопроса небольших вот ци этого плагина Да звучит так что вы не знаю больше больше кода и реализовали уже в самом Аче Да и ну любой Сейчас может взять небольшую доработку сделать реализовать этот плагин там архивирование да и ну а чтобы реализовать плагин надо было много сил потратить наверное или всё-таки нет нет Смотри да как бы никто этого не скрывает как бы по чесноку разработка плагина дешевле чем разработка того что мы задонатили но здесь нюанс в ЧМ его донатил грубо говоря тенер Ну это я всё писал да Если так говорить своими словами Я знаю как всё работает я знаю где есть какие-то места которые нужно обойти Где сделать быстрее Где сделать лучше как бы там как лучше протестировать как протестировать на нашем нагруженном железе да то есть как бы мои тесты гонялись на очень специфических кейсах где они выстрелили и вот там у нас есть н под сжатие и там прям полезли баги когда мы начали гонять на на нашем настоящем железе то есть всё можно просто Вопрос в том что написать это примерно 20% ресурсов ещё 80 это отладить так чтобы это в проде не создало никому проблем это вот собственно то за что нам наверное и надо платить потому что мы пишем так чтобы у нас заработало А как бы ну сбертех сбе это очень серьёзные кейсы да И если это работает то кажется что это заработает вообще везде Вот наверное в этом преимущество в том что мы просто делаем качественно Понятно спасибо ещё вот вопрос один вы такую работу провели А ну экономили как бы небольшое количество места Да а почему нельзя было там ваш заказчик не мог рядом сервер ещё один поставить и у него уже памяти было в два раза больше масштабы просто зака смотри не буду или буду Ну короче смотри а есть процессинг допустим у него 32 клас если я не да Давай я лучше отмотать врать это не моё есть ли шанс что а коллеги включите нам пожалуйста презентацию на экран больше нот В смысле больше кластеров в каждом кластере больше 10 Но короче 15 кластеров по 32 узла по 700 ГБ оперативной памяти на узел сервер в котором больше 700 гигабайт памяти на узел найти довольно сложно понимаю но добавить в микрофон а всё уже мне кажется вот здесь уже дальше начинается дискуссия и мне кажется это можно будет уже в кулуарах покопаться в деталях Давайте вот возьмём ещё последний вопросик чтобы Прежде чем перейти к дискуссии Вот давайте последний возьмём А спасибо за доклад Антон очень интересно А Сергей из Тарантула А ну у меня два вопроса один технический другой такой значит технический только по очереди Ладно чтобы я не забыл спасибо это если брать упакованные данные из памяти и распаковывать это дорого потому что это на сервере Может это стоит на клиента распаковку Ну то есть отдавать ему не разжатие данные если алгоритм позволяет разжимать в любом другом месте Ну а да это дорого будет по сети наверное наоборот же упакованные данные будет передавать Так подожди Всё я не разжатие данные отдавать клиенту Пусть он там разбирается А смотри а в целом Да но это не работает для страниц потому что Ну как-то достаточно глупо Ну хотя нет А почему страниц говорили про большие документы Ну в целом это тоже подход но зачем ну экономия и на распаковке и на передаче данных но мы сейчас добились того что у нас разжимается именно тот объём который нужен клиенту на сервере то есть небольшой обычно И это ну то есть по нашим замерам это никак не афект что то есть скажем так тот у нас обычно кейс как бы записей не сильно меньше чем чтений обычный кейс Ну в целом не везде конечно да но мы настолько сильно начинаем экономить на записи что чтение Ну для него появляются ресурсы понятно и второй У меня вопрос такой Насколько я понял организация Open Source comand и энтерпрайза это две разные компании Уточни пожалуйста вопрос нуг который есть он предоставляет услуги энтерпрайз за деньги а Open Source на котором это построено не принадлежит этой компании Нет конечно да А есть ли какие-то рекомендации я говорю про Таранто для компании которая Взяла на себя всё Это рекомендации в м организовать есть в ТМ случае довольно вот для энтерпрайза мы значит пишем специальные Ну как бы заказные фичи поверх Орса которые мы взяли где-то там мы им значит донати Ну всё как ты проговорил А теперь когда Представь себе что этот Open Source был бы тоже твой смотри если ты про то как выложиться в Open Source то у меня есть такой опыт Я в своё время в ггей как раз донатил в Ну собственно да И это не проблема на самом деле ты просто ну приходишь к Ну в данном случае к пачу Да к ребятам которые умеют делать Open Source там есть менторы которые тебе подскажут что и как делать Ты согласовывает вой код с лицензиями с правилами этого коммьюнити ты раздаёшь стартовые права А то есть назначаешь мете потому что это клёво модно молодёжно у тебя появляются внешние мейте неры ты им даёшь там допустим В Аче есть классификации там котер или член pmc Да ты им даёшь либо то либо другое и они там начинают эту Движуху уже от себя там с твоей помощью производить то есть в нашем конкретном случае случилось очень интересное что был гй Community Edition который задонатил с в пач Да и потом комьюнити разделилось потому что появился сбертех который сейчас как минимум половине половину коммьюнити А на это занимает То есть у нас диверсификация произошла как бы вот ну вот расширился коммьюнити О'кей то есть ответ - это как раз отдать Open Source в какую-то третью компанию и чтобы туда смогли подключиться Дополните что если ты хочешь простой рабочий сценарий то Допустим АСФ - это наверное хороший вариант Если ты хочешь допустим как конт продолжить контролировать и иметь как бы злых контрибьютор не любят потому что невозможно залить то ты можешь это делать сам Окей спасибо Как это есть два стула как говорят да давайте поблагодарим нашего докладчика за совершенно замечательный доклад и ответы на вопросы у нас есть небольшие подарочки за лучший вопрос Давай может быть выберем какой-то из вопросов который тебе больше всего понравился Может быто так а теперь нужно вспомнить хотя бы пару вопросов Ну вот вопрос от сбертеха Да я я понял Какое когда вот ту туда да тогда подарок к нам сюда в студию убегать со сце ничто не куплено всё Почему небольшой подарочек тебе от организаторов и вот да специальный подарочек тебе Давайте тепер попло"
}