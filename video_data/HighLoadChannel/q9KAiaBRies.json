{
  "video_id": "q9KAiaBRies",
  "channel": "HighLoadChannel",
  "title": "Monitoring driven эксплуатация / Николай Сивко (hh.ru)",
  "views": 224,
  "duration": 3301,
  "published": "2017-07-30T00:47:36-07:00",
  "text": "от хардкорного энтерпрайза к более хипстерским вещам и мы послушаем николая сивко он расскажет о том как устроена эксплуатация в компании headhunter и собственно как они используют мониторинг для того чтобы следить за качеством эксплуатации поприветствуем николая всем привет меня зовут коля я руковожу эксплуатации в хару доклад называется странно но по сути стал к не работает по сути мою говорить будем а следующим начну издалека на самом деле на конференции про мониторинг говорят на каждом докладе я хотел бы осветить наверное другую сторону не как хранить метрики а что хранить зачем хранить и что какой профит из этого получить начнем издалека зачем вообще в компании нанимают админов и какую задачу для бизнеса они решают дальше постараюсь осветить вопрос как бизнесу понимать хорошо работают админ или нехорошо дальше мы внедрили кипиа у себя и расскажу немножко про него как мы мотивируем админов работать хорошо и постарались связать это с профитом для бизнеса ну в общем посмотрим и дальше поговорим о том как это сделан как этот все видят админы то есть изнутри уклон непосредственно на мониторинг сделан ну потому что чтобы было интересно как и руководителям так и технарям ну начнем бизнес хочет ну в нашей ситуации бизнес компании связана с тем что мы знакомимся искать или работодатель это происходит на сайте соответственно необходимым естественно не достаточным условием того чтобы бизнес зарабатывал деньги является то что сайт работает также бизнесу нужно чтобы был кто-то один кто отвечает за то что сайт работы групповой ответственности них не существует нужно конкретный человек на конкретной должности с кого спросить с кого спросить прогноз потребовать решения потребовать вообще кардинально ситуацию исправить и есть еще у бизнеса требования такие что скорость работы сайта влияет на деньги ну и бюджет все в рамках бюджета из этого никак дальше мы начали договариваться про то что такое сайт работает вообще потому что непонятно в первой версии мы договорились на том что мы и директор нашей или кто там еще считаем что сайт работает если 1 минуту проходят некие сценарии то есть приходится искатель него загружается главная страница сайта он делает поиск поиск находит хоть одну вакансию вакансия открывается аналогичный кейс по работодатель скому сценарию и все это там есть рамки на время ответа сколько ты секунд соответственно такой подход нас работал это вот то что можно прийти и сделать там сразу прийти наконец сайт который делает внешние чеки запрограммировать там сценарий он будет обрабатываться если заказ на счет пойдет не так и получите sms такой подход работает но есть проблема проблема в том что он не ловит все случае он не ловит весь функционал которые эти тесты не чеки не затрагивают соответственно у пошли немножко дальше это не идеальный вариант это то что пришлось объяснять бизнесу что примерно означает сайт работает в данном случае количество ошибок на сайте меньше 20 в секунду это 20 число берется из головы потому что мы знаем что когда их больше то как правило нас все взрывается когда их меньше мы допускаем что есть баги и на какие-то редкие странице возможно сайт 500 мы их называем фоновые ошибки и с ними эксплуатацию ничего не делает их отдельно смотрят девелоперы но мы pysemska мне просыпаемся если на сайте там один рпс 5 соток а дальше нас есть критерий по времени ответа он достаточно так взят запасом потому что ну сайт и современные работают быстро у нас там это грубо там 500 миллисекунд по факту основной странице 100 миллисекунд и внешне ячейки на случай проблем вот этот сценарий мы сейчас эксплуатируем то есть у нас сейчас мониторинг реально в реал тайме читает логе смотрят за этими показателями и настроен триггер то есть если сайт начинает работать за рамками этого если то мы получаем эсэмэски и вперед это на самом деле бизнес ценности по сути отражает косвенно что и вообще говоря над смотреть на бизнес показатели нашем случае эта активность о режиме вакансиям и откликом но на самом деле это косвенно может можно понять из лога access access logo engine xa но по сути бывают кейсы когда на клиент эти происходит какая-то ошибка там баннер перекрывает форму отправки отклика или еще чего-нибудь и вроде как бы со стороны engine это все хорошо на самом деле все плохо пользователи страдают и бизнес польза не получается кто по факту какая ситуация с ответственным по факту полностью отвечать за работоспособность могут 2 делала это в нашем случае службы эксплуатации и отдел разработки это никуда не годится и вот дальше будем придумывать как решать но он инциденты всегда на эсэмэски разработчики никогда не подпишутся админы они получают надбавку за вредность за то что к ним по ночам приходят sms соответственно попытаемся решить что как вообще это разрулить чтобы было понятно и бизнесу эксплуатации девелоперам чего происходит вообще первой идеи у нас была такая что админы получается смску идут чинить них есть телефоны самых крутых разработчиков случае если они не понимают что происходит они звонят вместе чинит но в этом случае кипиа и ну показатели работы самих админов здесь можно вычленить только время реакции на инцидент мы мы так жили так было там в годы когда было проблем мало когда мы там чуть побольше времени уделяли инфраструктуре нормально жилось потом перестало устраивать мы пришли к ситуации что реальный профит бизнес не получает админы свой теперь выполнили то есть просыпались быстро жаль и ок быстро что типом и проблемой начали заниматься по сути сайт долго лежал потому что на то сколько они будут чинить они никак не были замотивированы попытка 2 которые мы даже пробовать не стали было была идея с там сверху сбоку они помнят куда на прилетела что админ должны отвечать вообще за весь аптайм но мои возражения о том что ребята ну вот есть большое сложное приложение она падает течет там всякое обмен они могут отвечать они не могут у него влиять это для них blackbox не отвечали давайте вот вам ящиков целый отдел прямо в службу эксплуатации засунем все что они тестировали это ваше с ними ответственность ну на самом деле хороший кейс делать вообще сложно и дорого потому что ну и слабы реально в итоге решили что делать этого мы ничего не будем я настоял на том что хороший теперь можно сделать тогда когда человек может на него влиять то есть если он понял что типу тут я налажал тут я справился я молодец нам получу банки вот чему мы пришли весь аптайма поделили на классы на зоны ответственности выделили какие-то классы проблем обмен отвечают за то что реально в их зоне ответственности что реально можно взять исправить что делать со всем остальным не решали сейчас это как такой подвешена вопрос я не буду касаться но там поймете примерно и так что нужно сделать нужно задать какие-то рамки условия чтобы было всем все понятно и прозрачно мы договорились с и что такое свой что такое сайт работает это если показатели выполняются все хорошо если нет все инцидент если не работает только там какой-то функционал по-прежнему работают то мы считаем что все равно проблема downtime и полностью сайт неживой на любой инцидент реагирует по-прежнему админы понятным причинам у нас на самом деле дежурных мы не уделяем на слишком мало рассыпаются все ну кто первый этот и начинает если надо там уже подтягивает остальных по каждому из 10 обязательно разбор мы должны и обязаны докопаться до причины мы не можем сказать что типа это был подземный стук и там какой-нить статус типа класса новым типом все ничего не знаем нет мы обязаны сделать это дальше уже покажу как что мы затем мы нарвались соответственно мы у нас отчетный период квартал мы фиксируем весь downtime за квартал поддельно на классы делим позволь нам ответственности админский downtime на него завязаны так вот классы проблем какие мы выделили 1 эта проблема во время релиза это либо плохой код выходит на продакшн все взрывается либо это процедура выкладки неправильно и в момент выкладки чем там 500 лет или что-нибудь тупит такие штуки мы классифицируем как проблемы с релизом ошибка в приложении это случай когда приложение работало работала потом взорвалось и перестала работать причин может быть ну там самая разнообразная начиная от утечки и кончая тем что пришел какой-нибудь запрос на какой злой url с какими другими параметрами все уложил где-то там завис удаленный ресурс там тайм-аут и не отработали еще такое железо сеть канал и dc это то что связано с хостингом за это отвечаем мы админы человеческая ошибка здесь только от минска и потому что разработчики на прод ну там где можно накосячить доступа не имеют проблемы запада мы выделили отдельно потому что мы аутсорсинге бей ну и так это интересное для нас квас проблема мы хотим отдельно его считать чтобы потом может быть какие-то выводы делать плановый downtime сделали потому что но без этого никак там стопроцентной доступности никто никому не гарантирует но play now don't м а есть ограничение о надо заранее объявлять это нужно делать в часы когда нагрузка совсем слабая ну как правило по ночам просто ошибка мониторинга вынужденная мера мы иногда бывает так что пришел какой-нибудь бот по 500 л там 50 ошибок секунду пользователей не были затронуты это вообще не проблема она никого не пофиг тела но мы должны это пологом естественно подтвердить ну и чтобы ложные срабатывания не удалять инциденты не когда мы вот сделали такой класс он в downtempo фактами считается но вот он есть в админы в их зон ответственности входят вот эти три класса все что связано с хостингом все что связано с человеческой ошибкой и проблема с базы данных тушить но почти хостинг эту инфраструктурная вещь разработчики не отвечает вот мы реально сделали кипиа и мотивацию то есть премия которой человек получит в конце квартала это реально функция тап тайма но в его зоне ответственности все по-честному табличка составлялась примерно из таких посылов что больше трех часов в квартал лежать стыдно поэтому бонус мы не получим если мы обеспечиваем в квартал по своим показателям четыре девятки мы молодцы и получаем повышенный бонус а потом просто серединку как-то пропорционально поделили это реально мы живем с января 13го года вот так дальше что вообще с этим делать как происходил и внедрение и что мы узнали мы вот прям реально в декабре перед тем как уйти на новый год включили ну соответственно долго-долго тестили мониторах включили и начали огребать то есть реально нужно если мы считаем все все все мы поставили все пороги мы должны с этим справляться нам реально пришлось работать то есть до этого мы занимались непонятно чем в первой же неделе мы поняли что сильно уважаем в плане того что напротив пускаем всякое не думая и это affected сайт то есть все 500 очки посчитаны поэтому там не забалуешь научились думать научились если сомневаешься бери плановый down той ночи что-то делать это реально прям сняла много проблем то есть прям заметно также начале мы сомневаться в том что у нас сделано все правильно начали проводить реальные учения это все объявляем downtime прибиваем мастер по сгрыз и типа засекаем за сколько мы справимся все развернуть мам реплики есть гасим там по-божески на самом деле ну вот реальные боевые учения с с падежом the mood все выключать разные сервисы без которых сайт должен работать потому что мы время завязались на сервис аренды цехе т.ч. и разделили на сервис и какие-то основные какие-то не основные начали вырубать не основные а сайт этой мало ты не правильно сделано поэтому все ложится в общем жуть сколько мы всего исправили за первый квартал logo rotate и давали пятисотке потому что они начинались в одно и то же время там кроны там 500 или то есть чего мы только не выгребли в engine.exe как-то были там на полу дефолту настроены ретро и тайм аут все это пришлось выгребать чинить мы сильно переделывает диплом мы начали даже в одном месте переделали заставили разработчиков переделать всю работу с очередями то есть прямо чтобы любую очередь можно было нормально погасить это не affective никого самое сложное это выяснять причину всех пока баф то есть вот чтобы не случилось нужно докопаться конечно поначалу не удавалось началу приходилось ну логе пишутся не так подробно как хотелось бы приходилось там как-то пытаться кита гипотеза проверять на стенде там грузинки делать потом как то за первый квартал всё устаканилось и мы начали примерно уже успешно справляться задачи и в частности нас перестал устраивать текущий мониторинг вот наверно к этому перейдём требования нашим узнать что проблема случилось самое главное требование это надежно должно работать всегда то есть если за пределы с евой вышли все alert смски чудака и видеть что происходит буквально вот за за полминуты надо понять насколько проблема затрагивает все они все какой примерно сервис потому что инфраструктура большая грепп отлогим и уже уже не успеваем иметь достаточно метрик чтобы копаться задним числом этого то что сыграло последнюю каплю нам не хватало метрик мы видим циpкa подскочил что это было кто пришел какое запустил скрипт или там что происходило на серверах какой процесс съел эту цыпу это нужно было делать задним числом потому что бывает так что есть проблема в моменты и починки мы 4 ст артем мы понимаем что где-то болит мои три старте мы это исправляем но причину мы не знаем но мы обязаны потом ее найти вот ускорять решение проблем потому что ну премий от аптайма зависит нам хочется денег больше мы какие-то вещи из логов типичные выносим на графике чтобы ну тупо ускориться и простота расширения потому что кто-то предлагает ну типа там разгребли какой-то инцидент поняли что вот эта метрика следующий раз поможет эта метрика допустим влогах пишется надо иметь возможность быстро и и вкрячить на график что у нас вообще за всю историю седьмой год в компании работают что у нас было за всю историю у нас был nagios была такая штука француз какая-то подделка не знаю жива до сих пор центре он называется это такие графики которые на она гирс kuyper дате рисуются соответственно мы ее там подсели потом мы ее выкинули написали свою потом у нас сгибался nagios мы написали свой поле snmp в общем в это время разработчики когда я надо какую-то конкретную метрику свое нарисовать они пилят какую не скрипт который в контакте или график чуть шлет потому что в наш мониторинг они нам долго на спросить надо чтобы мы там чет включили свое решение у нас был разработчик он год пилил мониторе все было хорошо он удовлетворял нашим требованиям потом они изменились мы поняли что нам надо выкинуть все нафиг вот про проблемы там отдельно слайда есть поняли что надо выкинуть все и написать заново потому что там вся концепция изменилось наше требование изменились все изменилось мир поменялся более того тратить время на разработку мониторинга нас не было и не хотелось делать это достаточно вот такая интересная работа там для тех кого любят там циферки пожрать star положить там достать там все вот это вот на самом деле у нас много другой работы нам надо чинить нам надо где-то что-то оптимизировать нас гораздо больше кайфа возникает когда он там график гистограмма времени ответа зеленеет нежели то что у нас там новый красивый график появился мы хотели full stack то есть собрать из графита там других не знаю там пластилин и зубочистка это решение можно я не сомневаюсь но это надо посадить человека чтобы он взял и все это собрал более того у нас были такие решения мы собирали но потом когда это ломалась чувак уже не так интересно это чинить потому что ну вот он собрал график нарисовал но по сути когда там половина данных съехала ему надо там пойти в кито логе посмотреть агенты проверить в общем грудь и у нас требование такие ну выше среднестатистических мы много всего хотим смотреть приходилось доделать по себя мы решили что мы не будем этого делать больше и успешно мы так полгода живем мы взяли saas во первых не нужно программировать это кайф во-вторых мы не скованы никакими законами о банковской тайне мониторинг и нету персональных данных мы шлём туда обезличенные метрики и мы не прочих за свой периметр выпустить ну как бы ну группы и сыну что даже конкурентом они и принципе не интересно не когда мы себе не могли позволить надежного мониторинга в частности мониторинг мониторинга нужен потому что у нас все на этом завязан если мы узнаем о проблеме нет нет эсэмэски от звонка саппорта но это скрытый вообще позор мониторинг требует тестов машиной the soft выпускать бажина и ломать откатывать но это тоже как бы задача мы можем прогибать подрядчик или сервис потому что мы не маленький клиент нас интересные задачи у нас интересная экспертиза выдаем интересный фидбэк по сути в итоге ценник сравним с выделенным разработчикам учитывая что у этого разработчика был я project manager який я эксплуататор еще мониторинга был то есть суммарно сервис обходится чуть ли не дешевле мы используем вот так метры он и нас все устраивает дальше я хотел поговорить о том не как метрики хранить а что нужно снимать и же на что нужно смотреть чтобы проблемы решать с метриками какие есть проблемы приходят люди говорят мы сейчас за мониторим наши ядра мониторят основные сервисы основные бренды все остальное забывается до конца до делать какую-то задачу людям очень сложно поэтому нужно тут какой-то подход мы пробовали в регламент и включать покрытие мониторингом это не работает потому что чувак смотрят чтобы не выпустить сервис нужно покрыть мониторингом что такое покрытие мониторинг веб-сервис наверное про чекать что у него порт открыт и все тут то есть формально требование выполнено по сути голову не включил никто это конечно можно решать там тем что людей это надо шлепать или еще чего это она лучше это система как-то решать часто снимают не все потому что некоторые под системы нуждаются в том чтобы отдельно настроить съем метрик из них ну в частности там в яви надо включить dmx в позарез нужно пустить мониторинга во пользователя и ну и так далее инфраструктура постоянно меняется запускается сервиса что-то передал бастиле новые виртуалке новые сервисы где-то backend прикрыли engine никсон где-то х прокси поставили все много операций происходит в авральном режиме поэтому уследить за всем проблема бывает так что метрики вроде бы собраны но по ним ни хрена не поймешь задним числом потому что они общие то есть там кто-то сожрал дискового ну блин но кто я же не могу вернуться linux лоб не пишет кто-то пожрал подход у нас такой все что можем снять без конфига мы снимаем всегда ну здесь я говорю о том что мы попросили у нашего сервиса чтобы сделали для нас эта концепция исходила от нас реализация не наша я вот буду рассказывать может быть вы своих решениях просто подход возьмете все что можно снять без конфига снимаем со всех машин надо не надо пусть будет если агент видит что нужно до настройка или мы нужен доступ это alert мониторинге админы классно чинит alert это вот то что у них получается хорошо вот есть лампочка он что-то сделал лампочка погасла кайф то есть админ такую работу выполняет хорошо то есть как раз dry went very old men test упал тест починили все задача решена в данном случае примерно тоже метрики мы снимаем максимально детальные в пределах разумного то есть если речь идет о том чтобы снять время ответа суммарная хорошо на мы хотим орлам улов много ну вот мы подумали подумали запросили сделать топ ну нам снимают тайминги по углам но тех которые там больше чем один процент ну вот хорошо но мы можем докопаться где тупила где не тупила задним числом ждем также чтобы было of the discovery но не в терминах там то что принято а мы много снимаем прототипе мы видим где сервиса с кем взаимодействуем если вы поймали какой-то айпишник которого нет в мониторинге там не стоит агент от него метрик нет alert тем самым мы вот на мониторинг за счет куча лампочек мы это все починим и он будет каждую минуту это проверять это это классно чем мы снимаем я вот постоянно собеседование к спрашиваю админов что надо снимать чтобы было что то понятно вот настала моя очередь отвечать на этот вопрос стандартные метрики которые снимают все циpкa в процентах memory всякие шарит кэш и прочее своб свобо сухого обязательно посети пропускная способность веке trade ошибки по диску диск в емкости использование нодов и о операция в секунду ретрит в трафике redlight и есть такой был стать и процентик это время которое диск был занят его ну то есть можно сказать что это процент его со всех машин обязательно тайма в сет относительно эталона потому что это даже может бизнес в эффекте если у вас на время отстает проще просто один раз занимать это везде настроить триггер и чтобы все было хорошо состоянии рейда стране райда массивов батарейки операции которые там идут дальше интереснее про каждый процесс вернее никак не про каждый сам от процесс а парк каждый процесс с конкретным сгруппированным по реке тобол и пользователю мы меряем циpкa время то есть время потрачено процессоре в разрезе систем юзер память диск его на каждый процесс сколько операций записи чтения сколько трафика диск своп на каждый процесс своп рейд на каждый процесс это вообще нам сильно помогает количество трендов количество открытых файловых дескрипторов и лимит на file descriptor и практики пиф если мы смотрим за всеми листы сокетами если видим что его соединение на той стороне имеют айпишник из нашего колки мы снимаем про каждый а печник отдельно снимаем и количество соединений в разных статусах стек лишний veikals weight для каждого печника опять же мире мтт мтт нам нужен потому что на самом деле абсолютно он ничего не говорит о скорости вашей сети потому что есть селектив окно лишь те цепи но сравнивать что вот тут сеть работала хорошо а тут сеть работает плохо по нему вполне себе нормально более того имея хорошую детализацию метрик мы можем судить о том как работалось сеть между двумя узлами сети не абстрактно вот у нас там ethernet встречался хорошо именно вот эта машина с этой взаимодействовала до факап его так вовремя факап а так после факап его так также для всех le son of мы снимаем количество backlog размер бак логана акцепт и лимит его похожие метрики для исходящих соединений индекс у нас джинкс не только на фронтэнда еще внутри у нас balancing на нем внутренней сделан их там хранилище всяких фоточек пользовательских портфолио сделано на джинсах мы часто случалось ситуация когда мы забывали парсит логе поэтому мы сделали l'eau par sing логов автоматом если на машине работают и jinx агент находит его конфиг читая такса слог понимает его формат настраивает парсер знает всех заслуги в лицо и начинает их парсить если нету таймеров или лак формат устроен так что его нельзя распарсить бывает такая там в районе всяких апстримом респаун ставим они там через запятую с пробелами общем бывает так что его расспросить невозможно агент верни мне дороги появляется alert меняем лак формата лерд гаснет все мы знаем у нас полный axis lock со всеми таймерами хороших разрезах снимаем gps и по статусам потопа урлов пока штату супа методу примерно под тем же раскладка мы снимаем тайминги так живым нас больше половины этот живые мы желаем а также авто детектив пытаемся понять где у нее dmx dmx выключен alert если внутри мы обнаруживаем чинить интересно кассандру там данном случае только кассандра занимается я метрики у нас есть там инсталляция кассандры снимаем про меточки профит про gc про мои mare pool и протрите кину там по стандартам не много вариантов что снять но мы требуем чтобы джеймс был включен везде потому что где-то включена а где то есть подозрение на gc приходим метрик нет проблема пропускать у нас по сгрыз также мы его пытаемся агент пытается за коннектится и снятие метрики если мне не получается это alert allure печеньем более того монитор не требует чтоб там было включено пиджи состоятельность потому что мы хорошую аналитику снимаем поисковым запросам и позволяет нам сильно сократить время починки базы не хватает прав alert снимаем про про запросы про таблички про конкретные индексы ну там какая-то логика есть не столь важно важно что много метрик и копаться потом хорошо метрики из логов снимается примерно так ну не знаю видно не видно в общем есть лук мы пишем regexp с именован ими группировками потом из этих именованных группировок делаем метрику в данном случае это количество вызовов api нашего из мобильного приложения вы на портале версию приложения на портале девайс пользовательский iphone айпад не знаю там еще что то и версию операционки после этого можем сделать из этого сразу же такой график в данном случае самом деле лог просто расспросили бизнес в или нормально мы выпустили новую версию приложения и видим как у пользователя она обратилась во времени увидим чтобы в первый день тампу треть пользователей заботилась авторы это еще за три дня все на 47 приползли примерно вебе выглядит это вот так у нас там есть язык запросов агрегацию метрик сделано на лету соответственно все это мы вешаем триггеры потом метрики изыск леля страшный запрос но зато частный как есть просто пишем конфликт пишем кастомный сколь запрос свой он возвращает сколько-то строчек одна колонка должно называться в илью там быть чисел k 2 колонки это спецификации метрики данном случае мы считаем количество резюме количество переходов резюме из одного статуса в другой за последнюю минуту снимаем эту 1 минуту получаем метрику режим очень discount делаем такой график то есть сколько резюме как меняются то есть если где то чет залипла на этом графике провал если вы пяти сотен на этом графике провал это основные наши показатели я здесь осени не нарисовал потому что несколько лишать секрет ну ладно чего тоже не так важно зато мы когда эта штука проверяли вы заметили что у нас ночью в 4 часа утра есть переходы резюме в от моделированы модераторы у нас в основном в московской той зоне и мы начали разбираться реально какая-то тетка у нас модераторов на нам это тетеньки в декрете и чары и она вот стала кормить ребенка решила от модерировать резюме она была одна поэтому мы поняли что она модерирует 4 режима за 10 минут вот ну зато реально нашло аномалию на дальше про триггеры начну с принципов потому что с конкретные триггер у всех свои у нас посыла таким проактивного мониторинга не существует это все фигня про активный мониторинг может вам сказать что у вас диск кончатся скоро и у него есть для этого данные web системе особенно загруженный все может меняться за секунду у вас сейчас работает через 100 миллисекунд не работает ни хрена и вы никакими разлад камень и какими ходу пами эти это предсказать не могли поэтому давайте довольствоваться тем что хотя бы мы узнаем что сломалось и постараемся причин найти опять же зависимости между алертной многие вот так вот типа zabbix а заморачиваются типа если вот это лет зажегся вот этот мы не зажигаем потому что это следствие вот хорошо это сделать невозможно на мой взгляд поэтому тоже мы это делать пытаться не будем нормальном состоянии активных alert of быть не должно то есть критиков критиков события это то что нужно починить прямо сейчас критик он не может подождать пока вы пообедаете если следовать этому принципу вот мы допустим а то вот в данном случае цыпа ученица прям сейчас не нужно если это не аффекте пользователей сайта поэтому никакие смски о том что критика сбу у нас нет у нас есть всего три критиков триггер это те что были описаны для бизнеса это пятисотке это время ответа это внешний чеки все остальное это подсказки когда человек приходит чинить или иногда в рабочее время чуваки заглядывает мониторинг и там какие-то воронки загораются чонин но по сути мы даже на почту их не отправляем потому что это нафиг не нужна лучше зажечь много триггеров но в пределах разумного чем пытаться там что-то под скрывать потому что человек ну там в пределах минуты 2050 дворников парсит глазами нормально и может там фигню отнеси дни глазами отличить часто бывают ситуации что вы лежите спите вам приходит с м с а вы такие ну таки не решаетесь вылезти из-под одеяла такие ну блин если через минуту придет recovery то я даже и не буду вставать мы эту обязанность отдали мониторингу у нас notification идет если мы 2 минуты alert уже работает потому что но даже если вы там захотите что вас инфицировали секунд на самом деле вы доберетесь до компа за пять минут потом пока вот там проснетесь пока вы откроете sage пока вот там пропарсить и alert и то есть вот эти вот две минуты ни на что не влияют и по сути нету в великой ценности alerts сразу поэтому мы решили вот так вот зато он чуваки знаем если приходит с м с все надо чинить все уже все сломалось уже рекавери не будет идеально когда причина есть списки alert в варнике если нет есть даже борды есть графики потому что но не для всего можно придумать адекватные пороге и всякую крутую математику чтоб детектива провал этом вас пайки и так далее но мы стараемся чтобы следующий раз подобная та же самая проблема была видна в лентах вот если важно если из горит alert вы не собираетесь его чинить выключаете потому что если вы знаете шва с монитором чистой и начинает гореть какие-то лампочки все их надо починить 200 до чистого состояния это классный такой принцип с ним иногда сложно нужно перебороть себя но если мы не будем себя обманывать это проще то есть в данном случае если вы постоянно от zabbix или не знаю счет какой-то невнятно настроенного мониторинга получается тонны писем в папочку которую никто никогда не читает ну проще не обманывать себя выключи настроить исключение если там циpкa ног у этой машине вас не интересует по сути циpкa тоже хороший триггер но он хорошие когда вы решаете проблему я не хочу получать письма образом наши триггеры это вот то что чтобы concrete куда бить соответственно все внутренней сервиса стоят за балансирами у них такие же есть как основные критика вы вор нинги пологом engine.exe пятисотке тайм-аут и время ответа на все процессы open file you such это отношение открытых дескрипторов к лимиту потому что мы натыкались они знают 25 раз на ту мы не upon файл слоги все мама закрыли для всех абсолютно процессов если загорается для чего-то не важного ну мы просто руками у нас есть возможность вот чистяков ругался что надо подавить alert у нас такая фишка есть мы просто гасим не нужно лет все он никогда больше не возникает для всех лесных сокетов мы меряем backlog соответственно если приложение начинает тупить и перестает септик соединения мы знаем опять же мы настроили один-единственный конфиг для всех ли сан сокетов если где-то какой-то второстепенный reddy's начинает в эту операцию вопрос ты его закрываем мы знаем что если где то произойдет задница она нам высветится в мониторинге про диски мы снимаем user и о нас интересует только если она в планке 10 минут и более это такие ну тоже hand и которые помогают там понять что-то про рейд здесь стоит отметить если тут какие-то операции там consistency check на софтом рейде это может за фиксить его поэтому у нас лампочка горит если идет к эта профилактика батарейки там есть какие-то киски мид и железками это может вырубить write cache и там будет тоже мы хотим просто знать что это происходит живо все и джинкс апраксии важные процессы на машинах где они были хоть раз запущены то есть мы не пишем триггер чекай на фронте таком-то таком-то и таком-то мы говорим просто check engine x если engine.exe на машине стояла и он там не он не раз запущен лампочка не зажжется если где-то в руками запустить на тестовом engineers но там который в мониторинге есть и потом погасите зажжется лампочка ничего мы ее погасим руками за то мы будем знать что если где-то что-то потухнет мы об этом узнаем давно нет данных от агента на ком сервере это варнинг нет данных вот живые map адрес и так далее the burning happy usage больше 99 процентов это варниг на протяжении 2 минут мы таким образом пытаемся поймать out of memory в яви потому что не все настроены на есть опция что она restart уитни все настроены мы просто настроили триггер и следующи раз найдем такое место мы починим такой мониторинг гривен эксплуатации мире им time of set и важные очереди и дальше у меня мало времени остается быстренько инцидент примерный что происходит происходит с м с дальше одновременно с этим мониторинг заводит задачу в жире обязательно для того чтобы во первых считать и вести там какой-то warhol тогда же начал читаем прецедент начался админы просыпаются не должны в двери прийти и нажать ок это перевести задачу статус инцидент но проблемой занимаются нужно это почему потому что в компании есть саппорт который звонят клиенты они заходят жир увидят что есть проблема реально гетеры запалил что все плохо и вот коли сивко проснуться и чинит у клиента говорит все чиним сейчас скоро будет и причем никто никого не обманул классно чиним примерно так смотрим текущие alert и синхронизируемся в чатике пока нет не закрыт в жару никто ничего не пишет потому что это долго муторного данном этапе обсуждали все это потом основной график у нас чтобы одним взглядом понять состояние светофор зеленый это быстрые запросы по шкале раб с и нас где-то там под 2000 руб с это со всех логов со всех фронтов программируем наш фронт сайд зеленая быстро быстрее чем полсекунды желто помедленнее до секунды красноту чаще и запросы черные ошибки естественно сразу видно в каком масштабе сломалась что произошло есть даже борды которые показывают взгляд на систему сверху какие сервисы засек чины какие урны засек чины какие хендлеры за эффектен и очень нас много сервисов мы используем зачастую топ функции потому что сервисов у нас допустим 40 на графике 40 серий выглядит плохо мы используем покажи нам топ 5 сервисов по 500 км по ошибкам в данном случает нижний график видно что сервисах и стейшен 500 лет и это собственно вся и проблема есть дальше там подключается это уже side effect и подключаются остальные сервисы не справляются таким образом одним взглядом на картинку мы сузили скол проблема для конкретного сервиса пошли в его даже борт пошли в диалоге но неважно починили если все равномерно эффектом и у нас есть такое правило проверять жевали базу базу мы проверяем по среднему времени ответа это на самом деле хреновая метрика но она отлично справляется задача показать хорошо также сейчас работает база или по-другому в данном случае видны выброс эта проблема у нас есть детальные метрики по базе если там мы там часть работы пытаемся ну теперь чтобы не дергать попусту пытаемся понять если там конкретный запрос вылез мы там либо релиз откатим либо еще чем-то либо там kontron выключен и так далее так совсем быстро начинаем после восстановления важно мониторинг меняет статус задача мониторинг фиксирует исправление не человек мониторинг для того чтобы точное время downtime а прочитать поиск причин идет пост-фактум потому что опять же починили не значит поняли суть нашли в жире все записали ставим класс задач и закрываем на дальше если там нужно разработка или еще какое то есть продолжение workflow вот примерно выглядит в жире так была проблема это резолюция ошибка в приложении криво внедрили центре не поставили ограничения на очередь я упала south of memory fixed buy задача в эксплуатацию поменять на стройку интеграции центре связанная ticket от саппорта и соответственно проблема была второй раз дубликатор по результатам надо человеческие ошибки все обсудить поговорить с командой и посмотреть может быть человеку не надо в то место лезть можно автоматизировать и так далее это важно если проблема с релизом может быть как следствие изменения в авто тестах и либо в процедуре выкладки проблема в приложении как правило выливается задачу для разработки железо сеть не всегда возможно что-то починить но задачу над завести можно уменьшить вероятность можно сократить downtime в будущем можно обеспечить там самовосстановления как-то ну то есть какие-то меры чтобы суммарный downtime снизить и не забываем про мониторинг может быть добавить метрик может быть метрики сделать более детальными может быть новый триггер либо конь классный график все все рассказал надеюсь было полезно тошиба на таймере полторы минуты не знаю сколько а а от отвечу на вопрос николаев спасибо вообще супер доклад вот по моему личному впечатление вообще самый лучший было очень интересно по делу и вот пару вопросов некоторые мелкие некоторые более крупные вот вы счас мониторинг используется какие силы у вас конкретно с этой конторы который вы работаете как они вам обеспечиваются качество бесперебойность самого мониторинга который для вас маст хэв на чем в договоре свой не зафиксирован мы им верим потому что у них физически больше возможностей сделать классный чем у нас мы просто верим то есть у нас есть счас мониторинг и внешние чеки еще какие-то то есть если что-то сломается на самом деле у нас fall back на внешний чеке есть это можно хоть десяток сервисов но мы им верим и по сути оказывается что это работает надежно то есть мы мы с ними дружим а не заморачиваются на отказоустойчивость они нам рассказывают как они это делают на грим ну классно не ног как человеческие отношения нормально чтобы я согласен аки просто интересно было второй вопрос вы когда детализированные school об ответственности да там первый пункт был на самом деле эта выходка релиза нового и если что-то поломалось вот там был кейс с тем что ошибка разработчиков кейс с диплом ментам вот deployment а ты разве не ваша часть deployment мы какой-то момент договорились разработчиками что мы сделали классную дипломе если дипломе перестает будку осман ну на самом деле если это реально наш косяк мы его забираем в ошибку в эксплуатацию они они тоже заинтересованы чтобы ну по сути негласно да все остальные вот эти ошибка приложения они на них как бы они у них деньги на это не завязаны но негласным на них и чтобы на каких то там правлениях совете директоров им тоже не краснеть они участвуют в прениях что это и мы заполняем ошибку к все согласно что этот чей косяк то есть тут тоже совещательный такой процесс какие-то спасибо последний все чтобы не занимать время это вот по поводу трудоемкости тех метрик которые вы снимаете выдавали несколько примеров да там по базе по индексу вот это все ложится на вас то есть вы уже все собираете и потом отстреливаете в saas вот сколько у вас приблизительно занимает время на выбор нужных метрик и их скрипта вания cryengine все из коробки про бизнес метрики у нас мало бизнес метрику нас сейчас бизнес один дашборд с десятью графиками мы это сделали за час потому что но и тут я малики понаписали как бы ну и графики сделали это быстро нам уже не нужно писать модуль который вас quelle ходит в этом 3 кайф кастомные логе у нас девелопера пишут если они хотят этой штуки смотреть они пишут у нас анти бы они пишут конфликт делают нам pull request и наш репо у санса люблю мы жмем ну классно она разряжается все в них есть метрики графики сами делают мы спасибо большое все а нет вопросов у меня много вопросов первый вопрос а вот вы говорите что у вас все метрики мониторинга они диска варится сколько времени обычно проходит с того как вот вы выкатили новый релиз появились новые метрики до того как они появятся в системе мониторинга и реально начнут обрабатываться придет минуты мы собираем разрешение у нас 1 минуту потому что мы считаем что больше разрешения не нужно более того большинство классных метрик тяжело снимать поэтому снимать их допустим 1 секунду очень тяжело поэтому агент насколько я понимаю он снимает метрику и сразу же пытаются и отправить сразу же она видна минуту окей как быстро второй вопрос вот у вас там на слайде было про отлов ошибок администрирования в этот но я не увидел во всей презентации делаются ли какая-нибудь проверка человеческих ошибок кабина администратора то есть когда вы неправильно чувства к фигуре ли проверка ошибок администратора ну вот например навасом есть raid-массив вывоз configure ли осталось два диска несколько garena которые надо было засунуть там в р-не нам это не инцидент это сайт ежедневно сонджу работал но все равно я пока все работает все классно мы начинаем ругаться и ругать но не ругать человека разборы устраивать когда косяк приводит к проблемам то есть допустим вы пришли там на какую-то машину с базой и начали крепость огромный лоб просадили его все упало то есть мы ошибку админа заносим то есть был факап он длился три минуты произошло это потому что петя не умный ну вот как то так да да понятно и самый последний вопрос вас презентации было отмечено что при проблемах вы заводите тикета в jiri по моему а это делается автоматически система мониторинга или нет тут я немножко обманул нас старая единственная шемета который остался на старом мониторинге это работа с jira сейчас нам делают хук который позволит из сервиса заводить жир из мониторинга по нашей да есть все это заводит робот как бороться как боретесь ли вы с множественным срабатыванием с flappy нгам 32 пингом до посылает что ли вылетел прав loping на самом деле мы боремся так что инцидент завозится модификация за начинается не сразу чтобы человека не будить инцидент закрывается не сразу а после допустим 5 иаков в 5 минут нормального состояния затем закрывается сливаете в этом окне он похлопал это все будет один инцидент но мы на самом деле у нас нет такой ситуации по факту сейчас мы все вот эти мониторинговые штуки отловили на первом квартале сейчас пошел третий год у нас все как часы спасибо здравствуйте меня михаил зовут во первых хочу поблагодарить за доклад ну просто больше особо не было хочу справиться как в мерить рпсц слугу да у вас есть к возможности описать аксу слог ну да ну просто я в своей карьере не видел способа когда access lot писать было нельзя потому что есть сам 50000 руб с акций слов пишется и парсится быстро ну окей опана курса у вас есть ответственный человек который отвечает что все метрики которые вас интересуют попали в мониторинг и что все они работают там нет нулей unknown и прочих статусов так и если там есть отдельный триггер на то что метрики поступают важные метрики если не поступают не важные метрики в каком-то графики дырка кто-то заметит кому надо придет починит если на важных метриках access лог у нас настроено типа там триггер что если там дырки то все проблема корнем к правда не critical на форме вот допустим такая ситуация вот появилось новое приложение java до выкатили его на сервер и нужно его чтобы она тоже мониторила сито автоматически добавится вот это вот новая java-приложений смотри мониторинг админ мы завели новый сервер мы туда поставили агента сейчас нужно поставить туда агента по ставкам агента поставили если мы запустили там яму и там выключен g-max либо там включен джим экс-агент самого найдет сам у нас появится метрики все хорошо если он там выключен появится варнинг типу чувак на сервере вирт 21 работает java но g-max там нету включаю вот а если там допустим 10 я зажжется 10 вардинга то есть каждая вот из этих яхт будет автоматически за мониторе надо мы мы этого хотели мы это просили нам это сделали вот спасибо и последний вопрос если он есть есть последний вопрос спасибо за до вопрос последний один я бы я очень маленькие 1 половину последнего вопроса можно сказать спросить сколько у вас модулей развертками в продакшене сколько человек его собственно в команде занимается саппортом вот этого все взял саппортом чего саппорт вот это вот команде которая такой мая занимается мониторингом и диплом не наша команда занимается администрированием к хору мы не занимаемся мы интернет-пользователи money to me я пытался донести нас я бездельник и 4 инженера по штатному расписанию сейчас у нас минус один там по ряду причин то есть три инженера и я начальник ладно спасибо ответил или как другой вопрос а ну потом я готов но последний вопрос был или дадим возможно ладно"
}