{
  "video_id": "J_nU9VoUVXE",
  "channel": "HighLoadChannel",
  "title": "Новые дивные дивы (ты ж сисадмин? лампочку мне вкрути!) / Александр Чистяков (ФКУ Налог Сервис)",
  "views": 394,
  "duration": 2074,
  "published": "2017-07-30T00:47:36-07:00",
  "text": "1 раз борода по машину меня слышно она меня слышно отлично привет когда саша пригласил меня прочитать доклад он попросил меня сделать доклад этот рис платона а я видеть или из философов знаю только егора летова поэтому пытаться платона не будет наиболее то тоже неплохо да да да но я просто боюсь что если значит фиксируется егора летова просто нужно сразу повышать планку возрастную соперник может не позвать потому дано догадаются наверное нельзя со сцены вот так вот егора летова цитировать а у меня доклад называется новые дивные дивы тут видимо я не знаю какое слов ключевое новые или дивные знаете я не люблю ходить в цирк а потому что там пахнет всякими зверями всякой жевать иной вместо цирка я хожу в компании luxoft на собеседования там тоже смешно на самом то деле я работаю в федеральном казенном учреждении на лук сервис и цирк не хуже чем в люкс often ну да винчи у меня доклад такой формате букваря вот буква д давайте познакомимся меня зовут саша у меня есть проблемы кто из вас у себя внедрял такой какую-то не был мониторинг нибудь пожалуйста руки а те кто не поднял руки зачем здесь находитесь вы собираетесь внедрить мой любимый вопрос про мониторинг поднимите пожалуйста руке те у кого нет рынка будет хорошо зачем вы меня обманываете да вот я на самом-то деле собираюсь вам рассказать про мониторинг и начал бы я наверное с декомпозиции проблемы видите ли как заявили коллеги на круглом столе про мониторинг в идеальном мире мониторинг не нужен но в идеальном мире инженер это общем-то не нужны я не могу себе представить идеальный мир котором есть я мир сразу будет объявлен не идеальным я инженер я люблю все декомпозировать я может быть не очень люблю слово uniq своей но мониторинг это вот это место где unix вы отлично подходит видите нам что же в чем в чем наша задача в том чтобы у нас на сервер и был какой-то агент который собирал бы метрики этими таки отправлял бы в какое-то центральное место где они обрабатывались бы сохранялись визуализировали и может быть нам приходили бы какие-то уведомления видеть у нас получается целый спектр нам нужен агент нам нужен сторож нам нужно какой-то софт который будет нам рассылать уведомления и нам нужен какой-то дашборд обычно когда я прихожу к клиенту у него уже стоит другая система мониторинга другая система мониторинга меня не очень устраивает потому что она пытается все эти вопросы решать одним пакетом я не могу из неё удалить а то чтобы не нравятся проще удалить саму и обычно все этим и заканчивается я удаляю а дальше я начинаю набирать свой конструктор и два года назад я думаю что я нашел идеальный вариант этого конструктора я радостно об этом читал доклада я говорил смотрите вот у меня есть отличный стек я сейчас вам назову так такой это graphite который умеет файлы писать наши метрики это grafana которая умеет эти метрики обрисовывать это стад де которыми загримировать и записываются graphite это меня всем устраивала у меня есть отличное даже борды которые правда я не умею скрипта вать графа ну и долго общем бился с собой видеть мониторинг на самом деле это во многом вопрос философский вот платон бы здесь очень пригодился к сожалению я ироничного платона с одной стороны я хочу скрипта вать дашборд я хочу чтобы меня все это было описано в репозитории а с другой стороны каждый клиент на дашборде хочет видеть свои собственные метрики что просит клиент он просит чтобы в случае когда сервис недоступен или не работает ему пришло одно единственное письмо к сожалению я не знаю ни одной системы которая может быть установлена куда-то и в случае вот подобные проблемы познать одно единственное письмо почему я не знаю такой системы потому что каждому клиенту нужно у каждого принта своих бизнес метрика на самом-то деле обычно когда мы говорим о веб-сайтах вела себя как очень простая это чтобы количество пользователей которым приходят положительный ответ на их запрос долларов равно количеству польза ли вчера у нас ничего не должны меняться на самом деле это очень простая вещь другая система мониторинга в случае отказа какого то сервера присылает большую пачку писем видите проблема с олегом состоит в том что рано или поздно мы перестаем читать . нам присылают с этим как я не придумать с этим бороться на самом деле я придумал с ним бороться не писать еще можно завести папку куда складывать письмо от а лифтинга и никогда не заходить я часто так делаю потому что когда вам приходится 100 писем за полтора часа а при этом система работает вы думаете ну я не хочу больше этого видеть другая система мониторинга однажды прислала мне примерно следующее уведомления количество не поддерживаем их метрик увеличилась я прочитал но не понял сейчас я потом объяснили что это значит но когда человек является владельцем сервиса бизнес человеком ему приходит такое письмо он читает после этого он как бы набирает инженер друзья у нас есть не поддерживаем и метрики их стало больше эта проблема ну в конечном итоге все это как-то нужно прекратить как это нужно прекратить ну понятно как не читать есть два варианта allure синга первый это процессить события по мере их поступления и не помнить историю так делает софт от развивать риман кто-нибудь вызов с ремонтом не пользуясь ремонтом а пользовались ему отличный он написан на функционально языке и коллега который познакомил меня с иманом ну знаете этот рассказ о смелости кроме всего прочего со своими друзьями они купили машину новую по проехали по россии и утопили эту машину в реке после этого внедрять рим он легко и приятно ремонт хорош он присылает уведомления когда их читать и понимать что произошло хорошо поэтому ну понятно что меня интересуют такие воды уведомления которые я могу понять и моих коллег как выяснилось интересуют такие уведомления которые еще можно подавить то есть вот где-то случилась проблема об этом написали мы об этом знаем проблему мы решим через неделю больше вам писать не надо оказывается что на самом деле эта истина такова реальная проблема когда человек получает одно и то же письмо рано или поздно он предстаёт его понимать и читать я знаю ровно одну систему у которой есть возможность подавление alert system зывается nagios я не могу это поверить 2015 i got a вещи которая хорошо работает до сих пор написано 1 открыто спользовал на диск стать оба даже и как вам что-то вы как-то не не активна на самом деле видим они так хорошо вы знаете nagios это хорошо она хорошо умеет рассылать почту больше она не хорошо не делает ничего ну это же прекрасно потому что другая система мониторинга она тоже умеет рассылать почту но может быть мы не хотим ее читать cвoю получается что систему которые процессе события по мере их поступления меня не устраивают они помнят историю с другой стороны системы которые помнят историю видеть даже вопрос не в том помнят она истории или нет вопрос том что я должен уметь подавить alert и туда стильными нагаша не работает ничего с graphite стеком есть две основные системы которые позволяют alert по графиту на самом деле 3 3 это nagios но я об этом вспомнил два дня назад ехал в метро мне нужен дашборд даже бодрость в надеюсь и я у не успел внедрить просто есть graphite бекон которые совершенно отлично у него есть одна проблема если у вас в граффити было записано метрика и она однажды перестала поступать вас она останется когда graphite а когда графика натыкается на метрику которая больше не поступает он перестает процессе все метрики вообще сломаются как бы привет я написал на это дело патч правда я его им некуда кантри будет не стал потому что я плохой программист но ко мне можно обратиться и наверное page выложу graphite бетона отлично на самом деле мониторит выходит глефой смотрят что произошло и он отлично скрипту its а вторая система которая умеет alerts graphite в это кэбот недавно в рассылке джобсов рекламировали копыта там вы примерно такие слова что вы ставите кого дальше у вас есть веб-интерфейс или вы все быстренько вы конфигурируете ну это антиреклама я не хочу чтобы она была по интерфейсу я всем из них на фигуру потому что ну другая система не только именно этим и занимается и этого всего не люблю я люблю скриптовой отлично скрипту это все описывается все работает единственное что вам придется познакомиться с языком описания графа это самого но это не проблема дешворда сегодня мы рисуем графа ный ничего кроме графа на больше не бывает у меня есть табличка где я просто выписал все популярные даже гордо для graphite от их довольно молодых около 10 штук видно просто у меня есть такая своя мета к которая придумал это количество комментов на гитхабе количество лайков и форков граф она реально в 10 раз всех ревет и она хорошо единственное что мне не хорошо по что она долгое время требовала установкой ластик search и elastic search я бы наверное поговорил бы отдельно ластик search ну он смешной работает он плохо кто из вас использовать пластик search у кого он работает хорошо ну и как вам это удается я не знаю точно уверенность он хорошо работать вы проверите возможно это и не так мы честно пытались что описывать логе власти ксир чьи дела и толок station блок стаж написано j руби то есть это знаете первая проблема это джей верим вторая проблема тоже под garbage collector а третья проблема это еще и руби она как-то работает до тех пор пока у него не заканчивается память самое смешное что он пытается как вы рисовать логе который в него а кают а elastic search тоже может упасть потому что у него тоже джавы тоже garbage collector я не знаю видите ли у меня во многих местах есть hadoop стек у меня есть hd fps и у меня есть hbs я считаю что если у вас знаете этот косплей и сергея полонского до который девелопер которого час экстрадировали из камбоджи у кого нет у стойки и сервера что-то поискать в жопу вот у меня обычно столько серверов есть поэтому я понимаю что ну когда у вас есть 20 машин их хорошо бы значит утилизировать пусть они сами себя мониторе пусть у нас есть распределенное что-то например класть котла стирала step search а когда у вас есть plaster ластик сердца и вы выключаете из него надо потом включаете его обратно вас кластер приходят в странное состояние мы все проверяли он как-то это результат работать на самом-то деле когда у вас есть пусть даже пол стойки серверов и вы пытаетесь мониторить все это при помощи graphite 100к вас примерно после установки агента машина куда вы записываете вашей метрикой просто пятну градусов диск утилизация диск достигает 100 процентов кстати в качестве агента мы используем старый добрый коллег где который написан массе просто-напросто он легенький проблема коли где в том что если у вас или где не куда писать если у вас погиб server cal и где начинает пытаться это в памяти держать рано или поздно память заканчивается но это проблема любого агента я не знаю зачем они так делают вторая проблема коли где состоит в том что в коле где нет тут такой важные метрики как диск utilisation это важная метрика и портится со 100 мг отказывается python даймонд как понятное название он написан на python и он тоже очень любит от есть 50 процентов памяти на машине поэтому мы как настоящий system administrator просто сделали ему лист от 1 3 часа на самом-то деле просто нужно вы запачкали где и научить его и пальца предмет рику на то что как бы научиться писать на seo я это всего же разучился делать может быть когда нибудь получается что у меня сейчас на каждой машине стоит по два агента из за того что я люблю смотреть диск утилизация так вот если у вас есть приблизительно 20 тысяч метрик вы репортите их в веспер graphite овский вас диск какой бы он ни был хороший начинает просто погибать у вас утилизации достигать 100 процентов когда у вас в диск утилизация сто процентов означает что если вы входите с замечательным хостинге hetzner жить ваши будет осталось пару месяцев он гарантированно умрет я вижу что вы коллега знаете а кто кстати хочется в хистори тут мало вас рассмотрите вариант отличное место a-data вы научитесь писать отказоустойчивые приложение вам гарантирую что такое умерла бы дисков сервере вы узнаете сразу так вот после того как я понял что с моими нагрузки mega fight of his так меня больше не устраивать я решил доступны разобрать и по заменять в нем некоторые вещи даже не потребовалось заменить сторож я решил что дух смотрите есть два варианта первый вариант это имея уже hd fs поставить чтобы которая зывается open this baby это такой маленький дима ног который тоже на джаве написан и он умеет time series метрики вливать просто-напросто в вич bass ставится он элементарно ну hbs вообщем ставится очень легко выбирать просто вот так вот комбинируйте мне сказал машин а то было все работает а то есть пытался кстати вич без поставить ой как хорошо ну вот да я умею на самом деле попробуйте вам понравится неделю веселья у меня есть замечательный график который я вам не нарисовал потому что взрослые люди вы мне поверите на слово в тот момент когда я метрики стал писать выплюнуть изгибе у меня утилизации диска прекратилось вообще значит у меня там диск умирал а потом я переключился и все те же классе благодать единственная проблема состоит в том что граф она настолько замечательный софт его хорошо приводить в пример вот если бы мы были на конференцию x дизайнеров я бы привел пример хорошего викс дизайна и плохого и оба примера были бы графа на графа на когда над обрисовывать graphite это прекрасный юзер экспириенс берешь просто легко и приятно рисовать графики когда граф он обрисовывает open this baby ты реально ужас и мрак с у меня в экран не помещается просто настройки open this baby она не делает пост агрегацию метрик то есть метрики никогда не комп от лица они всегда лежат целиком все что вы записали она всегда будет лежать вечно поэтому если вы хотите посмотреть суточный график у вас приезжает в отрисовку в браузер знать миллион значений браузер погибает вообще самый лучший способ занять macbook pro работой это сказать ему от рисует мне суточный график графа не после этого у вас все процессы начнут сильно греться но зато войска красивая получится там есть нас троечка которая позволяет сказать о принципе чтобы он отдал они все значения пропускала делала агрегацию себя говорят что в последние графа нет она строчка сделано автоматически я не знаю я не смотрел я не пробовал вероятнее всего это хорошо говоришь вообще последняя grafana она стала очень хороший потому что в ней выбросили власти все когда мы были молодыми мы пластик сиваш выставляли прям морды в интернет а власти все еще есть дыра которая валяет очень быстро его взломать и начать всего помощи рассылать письма разным людям однажды ты приходишь с твоего сервера уходит какое-то почта про виагру прикольно конечно на тебя за это блокирует мы научились с этим справляться стали джинкс просто перед пластик си о чем а сейчас граф она взяла и выбросила его нафиг вот в попытках заменить сторож мы нашли штуку которая умеет с одной стороны притворяться горы fighters ким коллектором но при этом данные записывать в массандру я не зря пришел в топе русской футболки мы любим докер к центру мы поставили через докер нам пришлось отцепить от докеры сеть потому что как бы а сандра работает через мать и красоты просто в докере нет называется если вы действительно хотите цирка то как бы вам стоит рассмотреть варианты передавать кассандры мы поставили кассандру мы поставили софта постоянной которая является как раз пробки из грифа это в кассандру записывать метрики он записывает читать он их не читает посмотрели как бы ну классно эти метрики пишутся на не визуализируется потому мы его сразу выбросили оказалось вчера оказалось что на самом-то деле существует вариант записать много метров graphite но мы ваще не пробовать называется он гол карбон видимо надо попробовать сделать вот вот это пока что мы метрики просто пишем в общем тесте бен но видите возникает проблема лифтинга проблема а лифтинга решается просто есть софт написан могло как особо сам он умеет а ерзать по принцесс baby он умеет рассылать письма в принципе его поставили письмо он шлет мы довольны еще есть такой backend как граф анекто траян flags он написан ногой и в течение последних трех месяцев он загружен пытается за релизиться я с удовольствием наблюдаю этот процесс и все жду когда же когда же но судя по всему не когда они там это все переносят поэтому мы его не пробуем мы не настолько носу всего принц если бы работает но не пытаемся этим заниматься есть еще софт от раза promises но он тоже нагула написан видите у него освещена непонятная ситуация с масштабированием вроде был она масштабируется но мы можем и же вы во все это не верим ну вот верим в драм-машину поэтому у нас есть лишь прессе и в общем как то так живем вопрос агрегации логов это очень больное место мы на самом-то деле не хотим agree with агрегировать логе вот почему видите я считаю что приложение если она правильно написано оно должно уметь сообщать свои метрики прямо вот куда куда следует до этого мы просто стали всегда используем у нас 0 метрик это как бы числа до числа таймер и алаги это ну какая-то позорный пережиток прошлого выплата пишете текст вы потом вы должны зачем-то прочесть понять распикировать вот еще отослать надо же лишняя работа и на самом-то деле я об этом думал и понял что жизнь она подтверждает мои слова софт для агрегации логов бесплатный он позорно плохо просто пластик search это полный отстой я у меня коллега очень велел власти к search он собирался в нем хранить бинарные данные в инвертированного яндексе хранить бинарные данные но он в общем то попробовал и быстро понял что это не работает что там ни там ни там ни там нехай не вылупились ничего если у вас есть одна машина мне удавалось на проекте на котором практически нет нагрузки но при этом очень много логов зачем вы знаете успешно печки никто не пишет на печке один человек собственный я отвернусь ну я не знаю вот если вы писали на пищи минут я знаю что вы пишете на самом деле физически генерируют огромное количество всяких слов то есть для печки программистом нормально питается в логе постоянного лица ошибки их никто не читает но их при этом нужно коллить и зачем отправлять централизованы куда ты так вот проект очень большой нагрузке генерирует ну 50000 событий в минуту так вот есть них начать писать власти ксир через месяц у вас classic чушь погибнет вместе с диска минут есть замечательный фронт-энд hibana которые собственно портировали она же она же так сказать это ее for cad графа нога и в какой-то момент у вас ластик search него просто индекс перестает помещаться в память все на этом вы приезжаете можно попытаться пастеризовать но это заканчивается плачевно он опять помолчи-ка 100 работает до 5 не любит а мы любим дочь есть вариант описать логе прямо вот у кого есть близко высечь дев вас прямо в hd fs я это пытался настроить это все делает voxtel но проблема в том что люди которые написали сборщика лоб от отправку логов из лобстеров в gdfs они 100 минировали boxter версии 133 ровно этой версии ровно вот только у них он не работает я попытался это все воткнуть в 15 оказалось что в 15 побед поменяно все там просто этих файлов я пытался вопрос там в 14 оказалось что если толкнуть в 14 блок стоишь стартует видит конфигурацию новый очень удивляется и перестает работать вообще ну я пожал плечами и решил что как бы видимо не так мне нужны эти ваши блоги есть порт и баны от росы банана который теоретически должен работать вот с этим коллектором но проблема в том что есть у меня не работает collecta мне не нужен визуализатор есть замечательный проект который называется froom тоже это агент маджори который умеет отправлять логе прямо в hd фсб куда настроить и все люди которые работали с флим они седые у них руки дрожат я к этому всему не готов просто я я люблю писать на java но что еще сказал выписано жалко не люблю писать на java свидетелем получается такая ситуация что в 2015 году любой вариант отхода от классического графа перского стека приводит к каким-то диким таким вот корнер кейсом вот я вот пытался что-то сделать по-человечески у меня тут же джаван рисовалась она не работает она ждет моей usals она там есть пропитан еще который ждёт мою память все это меня дичайшим образом фрустрирующая еще люди которые пишут могу и не могут заявиться и я пришел к выводу что мониторинг это сложно и ну я незнаю видеть самый простой мониторинг как мне сейчас кажется когда ваше приложение сама знать что она делает когда она сама репорты что-то куда-то и сама за собой следит пришли на проект взяли сторонний софт поставили его это сторонний софт вам присылает правильные алерта в правильное время я такого не видел никогда вот слайд слайд ради которого все это нужно было другая система мониторинга на вот в.г. я ее ненавижу это ну а именно она у меня есть весь когда у меня знаете у меня стоял zabbix и на диске кончилось место место мы почистили alert и приходить не перестали причем или приходит эсэмэска надеюсь казань это 90 процентов я прихожу за это 60 но этот базовая вещь какая-то 9060 разные общем то числа их можно я не знаю можно справиться сравнить их zabbix не справился ко мне часто приходят от понимаете россия да они вот знают слова они приходят и говорят у нас записи стоит мы хотим забиться в этот момент я спрашиваю зачем ну потому что у соседа стоит за пиццу а если у соседа допустим вас стоит пошто как бы на базе если что я не знаю ну так это безумие какую-то я не знаю у кого из вас забит это заметьте что это не те люди которые довольно мониторингом я вас понимаю да я тоже не доволен мониторинг это сложно и посмотрите вот никто из вас не пишет на печке на все хочется забиться как те люди у которых забил дейстительно работает они как правило его кастомизированные вы переписали я помню я рассказывал про такой плохой zabbix и спросил у кого он работает олега поднял руку оказалось что работа в компании 7раш я этот zabbix просто начали переписывать всерьез я знаю что в яндексе zabbix работать по что они взяли оторвали от него слой хранивший написали свой я тоже сильные смелый но кто бы мне за это еще за все заплатил вы знаете а на самом-то деле все сказал если у вас есть вопрос я бы может быть судил ну маленький комментарий есть zabbix работает zabbix и хорошо работает zabbix это три разных состояния 3 просто невозможно знаешь как сейчас эльфа встретить примерно хорошо работает запись идеальный мир саша не кажется что всего старая она г она на такое сырое что время тратится ну не сад несоразмерно количество мониторинга но значительно много времени тратится на эксперименты ну это же на самом-то деле все не от хорошей жизни у нас нет другого выбора мы должны как-то бороться с этим мы должны однажды перестать использовать за пиццу если мы этого не сделаем этого не сделает никто в этом на самом деле суть моего рассказа в том что я долго держался того того чтобы упомянуть на упомянул все равно давайте перестанем помогите мне в этом пожалуйста я не могу один я не справляюсь завтра придите и dance талер уйти забит но если на этом вопросы закончились то разработчику видите ли надо как-то я рад что он теперь знает язык . все что я могу сказать про это видите я читал кот за пиццу и как как в luxoft сходил 1 тоже смеялся до а подскажите все-таки в вашей картинке мира приложения должна сама себя мониторить то есть то в общем для чего мониторинг создавал над чтобы это было что-то обособленное это в корне неверно а но оно должно уметь рассказать чем она занята да оно должно быть так построена чтобы она ну как это разговаривала с пользователем чтобы он уговорил вот я сейчас как бы трачу я сейчас упала сюда да да да вот вот это самый простой случай вот когда она сейчас упала про это с этим и nagios справится он увидит что ну на парту не слушает никто нормально приехали мы пишем alert когда она не упала а вот днем ну классических пересадок когда вот на странице как бы 200 до при этом там ничего нет того что пользователям надо вот пользователь может добавить товар в корзину и это сразу видно в бизнес метрики мы видим что нет покупок антон нам-то нужно и чтобы 200 было нам нужно были покупки ну так это бизнес показатели которые также можно прикрутить к мониторингу я просто не понимаю почему ну как бы это нужно перекладывать чисто на разработчиков ну так нет зачем смотрите мы же и мы же есть разработчики разработчики разработчики кто из вас разработчику стать вы меня извинить разработчики криворукий и их пока их пока не ударишь по голове уже все равно у них софт работает в поняшки там идеальный мир как бы они в эксплуатации как правило не понимает ничего они приходят и говорят почему у меня в машине все работа вояж покупку совершил а дальше его не волнует вообще не что отлично приходится как бы сделать это самому приходится говорить ну дружище они-то не совершили покупку пользователи они же нас кормят вот проблема да да я на самом деле выступаю за то чтобы был плотный контакт с разработчиками желательно сверху когда ты говоришь дружище reports мне бизнес метрика пожалуйста делает а вот у тебя есть стали клиент пожалуйста пишем несколько то чего сейчас право дал чтоб чем занимается твои приложение пусть она рассказывает об этом как иначе невозможно поставить zabbix чтобы запись говорю о продаже ты идут пусть он призвал приложения спасибо огромное вам спасибо"
}