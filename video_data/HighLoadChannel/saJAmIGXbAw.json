{
  "video_id": "saJAmIGXbAw",
  "channel": "HighLoadChannel",
  "title": "Оптимизация времени запуска iOS-приложений / Николай Лихогруд (Яндекс)",
  "views": 516,
  "duration": 3481,
  "published": "2018-01-16T13:20:34-08:00",
  "text": "меня зовут лихо грудь николай яркого эти группы разработки мобильных яны скат для ios недавно мы провели большую работу по оптимизации времени запуска нашего приложения опытом которые я с вами сейчас хочу поделиться пожалуй начну с цитаты стива джобса очевидно что самый дорогой ресурс человека это его время возможно кто-нибудь слышал историю про то как стежок составил оптимизировать время запуска операционной системой макинтошем на 30 секунд мотивируя это тем что назад запуска всего лишь на 10 секунд позволит сэкономить 100 миллионов часов пользователя по всему миру за год поэтому сам стив очень ревностно относился ко времени запуска и что это одним из признаков качество приложений любого софта почему же это так важно во-первых быстро запуск это важно кратное преимущество визу приложение с примерно одинаковым функционалом пользователь выберет то что будет запускаться быстрее потому что почему бы ему не сделать так если у вас много вариантов нет все равно быстрый запуск улучшает настроение ваших пользователей и наоборот долгий запуск демонтируют пользователи чаще заходить ваше приложение и заставляют их писать это узнал гневный отзыв история как было например знаю когда-то мы нельзя забывать про то что время запуска она ограничит на уровне системы и если вы превышаете и вот та загрузка приложения прерывается что особенно актуально для слабых устройствах где это совершенно несложно получить почему во время запуска начали так вот на говорить именно сейчас ведь принципе все то же самое было раньше все дела систем все больше приложений переходит на съезд все больше фреймворка переводит переходит на swift новые разработчики новички приходящего другим плату с других платформ или выпускающихся университетом уже не хотят выучить обжег все всего час и а проблема свифта в том что его не взяв скомпилировать статические библиотеки ну и плюс с youth свифта вы приложения за собой тащит всю некоторый набор для мишки блеать eq a dime ческие видеотеки грузится долго поможет а при загрузке геймерские или отёки и ним нужно проверить и подпись независимо от ее размера все настолько плохо что год назад на wwdc был отдельный трек посвященный че за все время запуска и как раз этот момент и пошла вся эта тема про оптимизации времени запуска потому что именно там рассказали про некоторые возможности отладки и запуска которых не было раньше чтобы комплекса разобраться проблеме нам нужно во-первых разобраться что такое время запуска и как его правильно замерять далее разобраться что происходит на эту систему этапе загрузки вашего приложения то есть когда еще ваш код даже не работает разобраться как улучшить имитировать уменьшить время вашей части где вы же ваш код работает и как не испортить результат biochem облейте начнем с замеров как это не банально но давайте пройдемся что у нас происходит точки зрения пользователя при запуске приложение он нажимает на иконку далее разворачиваются поиска и приложения какое-то время висит потом вы выходите здесь финиш ланч инга у вас появляется стартовый экран где ищи тоже какие-то загрузки могут быть могут происходить и только после этого когда все прогрузилось уже пользователь может действительно пользоваться приложением поэтому нам как разработчикам нужно учитывать все эти этапы и оптимизировать полное время от нажатия на иконку и до момента когда приложение готово к использованию то есть нельзя просто победить и финиш ланчик этого недостаточно более того возможно кто-нибудь да да я все замечают что есть приложение только что кришна или его выгрузили из памяти повторно его открытие загрузится быстро а вот если его долго не запускали или например телефон только теперь загрузили я уже не загружается долго и так называемой ситуации теплого и холодного запуска из чего они возникают все дело в том что до момента передачи управления функцию main вашу происходит сборка приложение памяти и подготовка его к запуску на этом этапе который называется прямо in 1 загружаются динамически блеать ecs для каждой библиотеки появляется подпись смотрится какие у нее вещей зависимости все это дерево библиотек загружается потом загружена библиотеках исправляются указатели например если указатель смотрит на какой-то define символ то проставляется его реально уже физический адрес если это указатель на какую-то область внутри библиотеки то нужно поправить его базовый базовой частью стоят потому что били teka может быть загружено в любое место памяти после этого инициализируется объекте контекст то есть создается все классы категории уникализируете селекторы исправляются смещение хрупкие переменных и так далее создается все метаданные нужно или работаем жить и и после этого в классах вызываются плюс воды и вызываются конструкторы глобальности + + то есть вот у нас четыре этапом и они могут быть большими при холодном за я не собственно из-за них холодный так отличаются от теплого запусков можно теплым запуске как например ну во первых на порядок быстрее и например на тёплом запуске нега загружаются динамически библиотеки то есть не уже в этот момент загружена отсюда у нас получается такая разница между холодным и теплым запуском поэтому нам важно не просто померить время от нажатии на иконку приложения и до момента когда пользователю может быть с приложением но еще и разделять отдельно холодные и теплые запуске для холодных запусков учитывать прямые то есть нельзя просто заняться оптимизация нашего куда нужно еще из при - это сделать почему будет дальше видно на самом деле замер прямей на это нетривиальная задача которая бывает очень сложный до wwdc ты 16 вода идет здесь на самом деле потому что наш код там очень работает мы не за некую информацию процессе после новой os 10 добавили поддержку перемен окружении де ваал дим при не статистик которая вводит статистику работать омического загрузчика а именно бывают полное время запуска и выводит отдельно по этапа поэтапно время загрузки де amis библиотек время исправления указателей это прямо из банд время загрузки блики и контекста и время работы интерес и время пока вызывались реализаторы глобальных переменных и плюс слова dеf классов вот теперь мы можем уже и вы знаем что происходит на этапе прямей на и можем с этим дальше работать уже смотреть где у нас там battle.net хорошо прямо inner забрали нужно тебе посмотреть как заверять of the main первое что приходит на ум это пометить финиш ланчик поставить в начале и в конце не вовремя замеры и ключевая дата там вычесть их и получим время как работал дельфине шланчик но это неправильно потому что не учитывают время создания объекта и и applique не учитывает время создание объекта рисующего я приличный делегат а еще вас нам сложные конструкторы то там все это мы потеряем и там некоторые системные операции девушкам приметам статус бар c лидирует в общем все это мы теряем поэтому нужно умерить с начала мая на почему это подчеркивая потому что если у нас проект нас вертеп то по умолчанию в нем нет ума и на я вам нужно самим добавить большинству из вас наверное знают как делать но чтобы не пугались все-таки внук делается так есть добавляем 1 . свифт вначале его ставим замер текущего текущей датой и явно вызываемые applications main хорошим учились замерять проводим замеры видим то что время сильно скачет потому что каждый раз у нас разное состояние операционной системы разные состояния дисков к шее прочего это нормальный процесс то что время скачет в разных запусках но он на мучительно мешает потому что на эти шумы их нужно от них избавляться если мы говорим об оптимизации которая там теоретически должны надеть процентов сократить время запуска нашего соответственно если делать это вручную то будет нецелесообразно это не сможем и достаточно времени от потрать счастью есть утилита ли поймал девайс которая делает все что нам нужно она взаимодействует с устройством по тем же протоколом которым с ним взаимодействуют айтюнс и xcode и позволяет нам нужно нам опираться делать и при этом не требует джейлбрейк может протокола те же самые что она позволяет во первых получить список подключенных устройств установить конкретный конкретный бандл на конкретное устройство запустить приложение заданным и пойди на конкретном устройстве и перезагрузить устройство идти там на самом деле еще больше возможностей но это те возможно которые нужны нам чтобы автоматизировать замер запусков что особенно приятно и чего нет у других решений например у ios диплом здесь можно передать переменную окружении в запуск а нам очень важно передавайте бл-10 стикс чтобы посмотреть сколько у нас прямо на работает здесь это можно сделать передаем в девал deep green статистику нас консоль выводится соответственно статистика работы анечку загрузчика и мы можем полностью автоматизировать таким образом замеры запусков для этого первых берем сборку которая автоматически вылетает завершается если дана здесь указано перемен есть переменное окружение де велде по статистике но еще одна и естественно быть собран из резины конфигурации чтобы там всякие где важные наши воги не не учитывались я cert и были выключены берем такую сборку и пишем скрипт идея скрипта достаточно простая берем либо яма бал девайс и делаем перезагрузку устройства запускаем приложение учим холодный запуск еще раз запускаем получаем теплый запуск логе у нас все в консоли собираем их как-то по парсим мы сохраним в этом скрипте есть правда одна проблема это то что перезагрузка устройства это во первых очень длительная операция и вторых мы не можем точно поймать момент когда устройство действительно завершила загрузку то есть у нас появляются шумы от того что устройство старт что-то делает к счастью перезагрузку можно заиметь переустановкой тоже не очевидный момент то есть после переустановки у нас пример та же картина что и после перезагрузки явно не теплый запуск и тут у нас и деметре или отёки долго грузится и либо избавить все все тоже самое только так чуть поменьше но главное то что эти два времени они пропорциональны друг другу то есть если мы после переустановки исказили за пустой видеть на перезагрузки тоже быстрее остановится при этом у нас меньше шумов и переустановить быстрее чем перезагрузить поэтому скрипт в итоге будет такой что мы ставим приложения запускаем еще раз запускаем сохраняем ноги ну и в итоге используя такой скрипт мы собираем статистику запусков на разных устройствах я отталкиваемся дальше от нее естественно при спуститесь и собираем холодные и теплые для каждого еще замеряем сколько у нас прямая сколько of the main а какие то наше действие там уже зависит от приложений прежде чем перейти непосредственно к оптимизации хотелось бы понять к чему мы стремимся а стремимся мы к тому чтобы у нас время запуска приблизилась ко времени запуска приложений уже быстрее быть не может и тут на арену выходит несчастью свифт берем проект на обжечься пустой замеряем время запуска ну то есть просто диво статистика при на статистик включаем смотрим сколько занимает при main видим то что ну все нормально вроде диво ди омичи ский или отёки долго не загружаются миллисекунды все остальное там тоже небольшой общем 20 миллисекунд здорово берем свифт и все тут уже плохо здесь уже время загрузки динамический блеать эк увеличивает общее время загрузки приложения парктически на порядок если мы запустим тоже сам проект на iphone 5 то получим что здесь время загрузки демич библиотек уже приближаются к секунде и даже вы вы еще ни одного класса написали вас уже приложение грудь и секунду давайте разбираться что происходит для этого каскаде включаем галочку динамик qvibry лосс в вкладке logging и это нам выводит в консоль все засаде чем загрузкой какие теме стебли отёки загружаются по ходу работы и смотрим чем отличаются вывод случае обжегся из лифта видим что и там и там загружаются бинарник приложения и 146 системных библиотек но случается и втащить дополнительно загружаются день библиотек из банка приложения вы хамина фигурирует липси вт дай что-нибудь и называются они в целом стиле стандартной борис если вы пересмотрите присмотритесь к логу сборки вашего приложения то у вас там один зап будет это копия стандарт светлая бриз этот как раз они копируются банду вашего приложения откуда они взялись дело в том что свифт не поддерживают никакую обратную совместимость потому что продолжай от активно развиваться то есть такой до абсурда то есть у вас есть xcode 821 вы собрались никакой фреймворк потом перешли на xcode 831 вас это прибор там уже не заработает компилятор вырывается скажет что там несовместимы эти два две версии свифта поэтому свифт не является частью системы и всем приложениям приходится таскать за собой свифт стандартная бриз при этом они лежат боли приложения и грузится долго из чего заключаем что во-первых загрузка системы библиотека оптимизирована случае враки все вот эти вот 146 системой библиотек загружаются меньшим за миллисекунду они где-то там просто в каше лежат и не занимают время загрузки никакого и какой доле а вот время загрузки библиотека лежачих банды приложения но долго потому что там нужно опять-таки проверять подпись и к несчастью свифт сан дотла и борис кладутся банду поэтому тоже долго есть и тоже нужно потянуть то что любое приложение но слегка будет грузиться минимум секунду на iphone 5 потому что даже пустой проектом грусть в секунду все из того же самого свифта однако все наверно так плохо перспективе съесть все таки завершит свое развитие и станет частью системы и тогда эта проблема полностью жизни хорошо поняли проблему теперь давайте смотреть что с этим можно сделать если посмотреть внимательно wwdc и пространство не разобраться что там будет некоторые набор рекомендаций он примерно противоположным при прямо обратим этапом загрузки приложение на этапе прямые на загружайся девочки или отёки давайте загружать меньше тюменский блеать эк создается в жэке все контекст давайте меньше использовать общайтесь и конте обжиг 7 вызываются плюс воды и конструкторы глобальных переменных давайте не использовать услады переносить код который там есть в плюс вмешалась и не использовать глобальной переменной i + + тем не менее если у вас уже большой проект на стив те как было в нашем случае вам эти рекомендации уже не более не актуальны потому что у вас и так нет то есть и плюс плюс переменных у вас так нету плюс родов у вас так облепихи используется по минимуму и все что вам остается это стараться уменьшить число загружаемый де amis гибли отёк и ну это достаточно просто это мы вам расскажу как сделать а вот посложнее это уменьшит размер бинарного файла то есть чтобы на старте грузилась меньше символов тоже рассмотрим как то можно сделать отталкиваться будем от тестового проекта тестовый проект у нас содержит некоторые набору модов которые поставляются файлами то есть компилируются в отдельные таргет и в отдельные де amis гибли отёки и где-то внутри приложения как вторичная функциональность используется марс статический блеать тех например яндекс маркет янык спички замеряем время нашего исходного проекта видим то что она в три раза больше чем у пустого проекта и в основном больше за счет этапы загрузки динамически я три раза почему так смотрим залезаем в банду нашего приложения собранной и видим то что добавилось очень много не висели отёк потому что для тически девочки были отёка добавилось для каждого пода и добавились новые библиотеки светланов libris которых не было в том проекте начнем с того как избавиться от де amis гибли а те которые и спадов пришли для этого есть плагин на капот корпусами а мимо нам плагин для капотов что он делает он и объектные символы и объект ники которые созданы которые были созданы при компиляции отдельных под of link уют непосредственно в бинарник приложения они выбирают линков qs де amis киндли отёками то есть у вас получается что все символы которые есть динамических библиотеках и спадов они кажутся непосредственно бинарник но сам плагин собственно делает это и убирают томлин ковку с dea мешки девочки были отёками кодов почитающем скрипты которые создают как им пользоваться принципе ничего сложного добавляем плагин в вот файл и добавляем пост инсов под файл здесь сожалению у вас могут возникнуть проблемы с тем что помимо ну плохо работает с водными которые поставляются фреймворка me any валиками собственными такие под и вам скорее всего придется вручную интегрировать но тем не менее для низких проектов я пробовала применить каждый раз там максимум час два занимала исправление ошибок компиляции сборки и дальше все заводилась применили его и видим то что с 500 миллисекунд у нас время загрузки девочки блеать эк уменьшилось в два раза до 300 миллисекунд тем не менее все еще не столько же сколько у пустого проекта а мы стремимся пустому смотрим что у нас оставить банды приложениям видим что библиотеки яд кодов исчезли но сейчас там лежит плюс пять dime стебли а те которые начинаются на lips of то есть плюс 5 миски библиотека the swift стандартная бриз откуда они взялись здесь еще однако скажем так особенности в там если вы в каком-то святом фай или пишете import карл акишина либо в ближе 4 или в каких либо файлов которые люди бриджей header транзитивной у вас стоит импорт карл окей шанкар логично . аж то в мангл приложение добавляется девочки библиотека lip свифт карл окей . де ваал гип это некоторая вели отёка маленькая она там несколько сотен килобайт адаптер говоря к стандартной библиотеки из sdk чтобы сделать ее интерфейс более свифт о вам к сожалению тут нет никакого решения на данном в данный момент кроме как такие кроме как не использовать core лакей шумные некоторые другие библиотеки систем а использует только выбрать всем но на самом деле тоже ничего страшного и достаточно несложно выкинуть использования кур логично и свифта просто написав аджики все обертки над ним то есть a black sea обертки который результата же самый интерфейс но префикс немножко другой там сел w делать уроки шнура пирс написали такие обёртки и заменили использование шрифтов и файлов все in locations менеджер носил w лакиш менеджеры все у нас lips are lucky shine lip исчез из банда к сожалению все немножко сложнее есть транзитивной зависимости угу библиотек то есть пример если вы портите get a map with the это еще и спа imported core locations если вы импорте обе fondation там вообще 3 библиотеки сразу добавляются дополнительно к или foundation того 4 то есть если вы где то в каком то симптом файлики написали импорт или fondation у вас сразу время загрузки на iphone 5 увеличивается на 400 миллисекунд можете добавлять 4 стебли отёки в общем нужно пройтись по всем таким местам понять от чего у вас появляются динамические библиотеки себе стандартный обрез возможно вам еще править придется пройтись по шнеком которые вы им портите в ближних и dream если это повыкидывать аж не которые портят карл акишин или как-то их тоже обернуть в общем здесь уже немножечко побольше времени придется потратить но результат того стоит потому что с 300 миллисекунд мы получаем 200 миллисекунд которые в пустом проекте у нас есть потому что больше по другому быть и не могу мы избавились от всех динамический блиа тех которые дополнительно были у нас в нашем оригинальном проекте по сравнению с пустым приложениям это здорово это уже можно сказать почти победа если у вас приложение на свифти тем не менее еще одну технику все таки покажу вам и она опирается на банальный факту что на старте должны загружаться только те символы которые нужны для показа стартовые интерфейса символы из бинарного файла поэтому попробуем сделать такой как в нашем случае как я упоминал в тестовым проекте где-то в его недрах используются спички той марки для того чтоб показать карту или же запустить познавании голоса это не основе функционал на старте у нас карты нету на старте нет распознавания голоса это где-то внутри на контур внутреннем экране символы из этих статический блеать эк нам не нужны на старте но они все равно загружаются потому что они в ленка войны в бинаре приложения и системный загрузчик он загружает все символы из бинарник а если мы как-то будем грузить le nil а то у нас неизбежным уменьшится время загрузки а именно это этапы либо из банды и в гестапо как ты сделать для этого статическую библиотеку нужно обернуть динамическую и загружать и или него через нелепым сначала посмотрим как сделать статическую билетик динамической для этого в своем отдельный таргет нашим приложением вот файл правим так чтобы в этот таргет добавлялся нужно нам под данном случае там smap четыре спички и ну там можем нужно поправить компиляцию скорее всего будет потому что если зависит от того насколько хорошо написан в аспект года может быть там сразу все заведется возможно в пасвике чего не забыли для таргета is argued основного мы этот вот убираем линкуем ся с химически в leo те кай и дальше нужно написать обертки надавить химически блеать экой которые будут загружать июле него или не вытаскивать из неё символы дальше уже немножечко пострашнее дальше нужно использовать и 5 дерево по нам и делись им страшные функции раньше я их тоже очень боялся но на самом деле не все так страшно достаточно простой там и и не сильно усложняет написание собственно этого wrapper а с чем уже начать во-первых нужно определить где лежит де amis ким ли отёкам то есть путь до нее найти и закинуть его в отделе up on delete нам вернет дескриптор который нужно потом использовать в delphi 7 и чтобы вытаскивать отдельные символы и дальше у нас есть три сценария ну ты типа символов первый тип символов это глобальная функция она вытаскивается из я мической библиотеки по своему имени то есть так как она была написана в 1 также она будет и здесь называться вы получаете указатель на функцию косите к нужному типу это указателя их дальше вызываете как обычно функцию обычный вызов функции показателю и и второй тип символов это глобальные переменные для глобальной переменной гель сим нам возвращает ее адрес по тому же имени что у нее в коде была остается только этот адрес разыменовать все ничего страшного дальше мы можем использовать как вот как обычно символ уже как обычное как обычно переменную чуть-чуть посложнее дело с классами во-первых если мы за им портим аж ника из нашей библиотеке это ничего почему плохом не придет помощь страшненько только декларации они не вызывают необходимости в линковки библиотеки пока мы не чего-нибудь не используем оттуда на прямой путь символ далее нам нужно загрузить его класса из миски или а детям символ класса имя символа класса формируется как префикс обж и xi класс доллар и имя класса дальше идет гель всем нам возвращать некоторые сущность которые можно скастовать типу класс далее у этой сутью можно вызвать alac это вернет нам объекте поедим и здесь наши начинается скажем так волшебство обж exim так как у любого айтишника в любого объекта идея мы можем вызвать любой селектор который известен приложение а селекторы у нас определены ваш ники и соответственно мы можем вызвать у этого объекта тоже самый конструктор использовать то же самое и пиаре уже дальше с этим объектом как в какое определенного днями в этом ваш ники соседству можем вызвать конструктор можно вызвать какой-то метод из это ваш ника общем дальше уже использовать его как обычный символ тут как обычно объект не прост как обычно вот как тот который нам нам нужно скажем так и вот таким образом пишем на wrapper и надо и при библиотеке они могут содержать логику какую-то могут не содержать главное что они динамически загружают символы лениво только тогда когда нипель раз понадобились я мечтаю же библиотеку и символизме написали в рапиры получили ускорение в данном случае небольшое здесь 30 миллисекунд практически не о чем но если у вас приложение какое-то зависит от когда большие сиськи блеать эти которая вам на старте не нужно и она занимает реально какое-то большое время на старте и и загрузка то вам такая такой подход может помочь плюс вы таким же образом можете и собственный проект побить на динамические библиотеки это же их загружать ленивы в идеале у вас бинарник приложения должен состоять только из тех символов которые необходимы для отрисовки стартового экрана все остальное нужно разбить на модуле и загружать лениво при запросе пользователям какого-либо функционала еще раз повторю какие у нас были этапы так мы избавились сначала темечке библиотек кодов через плагин а мимо но потом избавились от дополнительных библиотек из фонда fly борис через аптеки себе обёртки и постарались часть символов загружать лениво то есть вынести в де amis гибли отёки и загружать их через деле пан принципе приблизились к пустому проекту и это последнее действие оно будет валить на для любого проекта не только для яндекс карт если у вас проект на объекте сету вам вам первые два этапа точнее до 2 этапа с нами монова из обжечь вечными обертками не нужны потому что вас так личный любишь стебли отёк нету тем не менее вам может пригодиться и пойти и лег мам и разбиение собственного проекта на модули с переменным покончили здесь на самом деле уже больше ничего особо и придумать нельзя он точнее можно но это если останется время расскажу займемся теперь немножечко of the main то есть этап за этапом загрузки когда работает наш код на самом деле здесь нет каких-то специализированных техник потому что это уже дальше идет обычная задача оптимизации ос приложения то есть все что вы можете прочитать по поиску оптимизация ios-приложений то же самое из вам и на этапе загрузки сработает но тень на что по нашему опыту стоит обратить первую очередь внимание во первых очень сильно портит создание лишних сущностей на старте вы сильно портит во первых это отнимает время вторых усложняет профилирование далее на старте не нужно создавать избыточную то есть только тот ей который нужен для покажу стартовые показы стартовый интерфейсам и без чего как правило в каждом проекте некоторые действия которые выполняются на старте который можно чуть-чуть отложить так что пользователи этого не заметит но тем не менее вы раньше разблокируете интерфейс ну и пройдемся по пунктам про некую зависимость сначала поговорим если у вас классической лекция зависимости то у вас каждый класс принимая свою зависимости через конструктор данном случае руки контроллер у нас состоял принимал на старте принимал в конструкторе фасад поиски фасад мушки зации получалось то что для того что закрутил контроллер нам нужно было создать посад и поиск амортизации а у них свои зависимости они тоже создаются у них тоже свои и в общем итоге у нас создавалась все дерево класс на старте как мы эту запороли мы примере мы вместо того чтобы принимать отдельные зависимости в конструкторе мы принимаем некоторые контейнер реализующий протокол в котором перечислены зависимости нужного классу и дальше обращаемся к этим зависимостям через этот контейнер за теста класс у нас принимают туристу потакала зависимости их оформленных в некоторых тоже протокол а дальше в реализации этого протокола мы используем и easygo раз лифтовые есть как это выглядит нас теперь руки контроллер понимает не отдельно фасад поиска и мат и фасад амортизация а принимает некоторую сущность реализующий протокол его зависимостей которым определены что нужно возвращать фасад и крутим дальше мы его имплементировать так что в имплементацию нас те две сущности создаются лениво через свои товары свифта вы таким образом дешево получили то что у нас спас от поиска фасад можете за создают слюни при этом не нарушена никакие принципе геев и это также нам не мешает перейти к такому же композицию руту как и в классических framework определяют а уж sound айфону только канала к сэм ли у нас он реализует все протоколы верхнего уровня в сущности и прокидывает себя как контейнер зависимости у них здорово избавились от создания личных сущностей на старте это нам разгрузила профилировщика теперь можно посмотреть что там поподробнее точнее как еще 10 у нас ассорти делаются плюс это не используют рефлексию то есть работает быстро практически как как обычный вызов функции вообще никакой никаких накладных расходов в этом нету и чищу здорово это то что резов проверяется во время компиляции то есть если вы где то в каком то протоколу зависимости добавили зависимости которые нету компании шнуры те то вам на этапе компиляции вам ее придется добавить начни из компилируется это здорово потому что большинство фреймворков все-таки резов делают проверяют в ран тайме и придется ждать момент пока вас все это крыши нет так тогда вы увидите то что сказать зависимости какая зависимость компании сплетения определено тоже помогает нам с рефакторинга дали им нужно поработать над я им чтобы создавались только так суда во столько-то частью ой которая нужна для по к старту интерфейса если у вас где-нибудь какой не кнопочки лежит лейбл в котором на на старте нету текста или где создается контейнер который ничего на старте не кладется все это нужно убирать из вставать на старт у кати view которые необходимы нашем случае мы пришли в этот такой достаточно толстенькой стопочки view создаваемых на старте к стопочки где уже ясно и какая view для чего была создана ничего лишнего можете обратить внимание что тут вот какая то конструкция висела раньше над этой стопочкой это было летящим барр то есть нас вся карта классе навигация контроллер для того чтобы потом можно было другие краны пусть у него но тем ненавидящим бар был вскрыт этот контроллер не добавлял никакого этот контейнер ный контроллер не добавлял никакого юань соответственно что есть его что нет пользователю незаметно на старте избавляемся от него у нас таким образом и энергии чем барни создается в новейшем баре у вас там могут быть кастомные штифты или какие-то иконки очень полезно все тут можно заметить некоторые стопочки тоже это были наши кнопки раньше у них как раз как я говорил создавались лейблы и мы живем которых на старт не было контекста этому тоже убрали он тебя там встает минимум того что нужно ну и можно вспомнить про некоторые другие еще техники которые нам пригодились а именно во первых загрузка шрифтов занимает некоторое время и лучше бы и грузить лениво если у вас к эта графика рендерится программно то те картинки которые renders программно используем ассорти лучше отрисовать в ассеты сэкономить на это время если у вас для какого-то лейбла используются только для этого лейбла то этот лейбл тоже уже от рендерить картинку из таким образом не вредить вообще и конечно автора тоже может наложить тормозов лучше бы его переписать на прямо тут многоточие символически стоит потому что все зависит от вашего приложения и повторюсь это здесь уже мы имеем общую задачу оптимизации приложения не связанную как-то конкретно с запуском просто нужно имитировать то что вы делаете на старте ну еще момент капор который стоит тоже упомянуть и которые нам немножечко дал прибавку это что на старте не нужно так нужно посмотреть то что у вас уже осталось после предыдущих двух этапов и делается на старте скорее всего эта работа на старте нужно и ее нужно будет сделать но задумайтесь необходимо ли оно для того чтобы отрисовать интерфейс и насколько будет критично для пользователя отложить ёна 100 200 миллисекунд если не критично то давайте отложим и вот картах мы таким образом отложили синхронизацию закладок на поражение закладок на карте загрузку конфигурации приложения там еще настройка аудиосистем сложили в общем все эти вещи они пользуются практически незаметны но в целом дают там какой-то прибавку конкретно совершенно как уменьшают так это что касалось оптимизации еще хотелось бы несколько слов сказать про то как не испортит результат при очередном апдейте ну конечно нам тут по ним помогает continues in ты грешен так как все это можно встроить в этот процесс устраиваем скрипт с автозапуска меня в кантине умственно грязь и то есть после каждого билда берем build прогоняем вот на симуляторе тестовом устройстве через скрипт собираем статистику этих запусков и куда-то и выкладываем подробнее на этом я не буду останавливаться потому что это все хорошо описано в докладе mail.ru у них статья на хабре есть в общем найдете ссылки есть конце просто пару советов чудом пару идей что можно накинуть первых давайте бумаги ровать зависимости который остается на старте и если в ходе работы вы что-то деле и у вас начала создаваться что то что на старте не должно создаваться мы это таким образом увидим также давайте логировать список загружаемый де amis библиотеку и тоже совать его с эталонным списком если я обновился ios или же вы тоже опять это что-то потрогали за им портили core локейшн в симптом файле мы это здесь тоже засечем и предпринимать какие-то нужные действия ну и тоже не тоже немножечко не связано с какими-то грешно но тоже полезная фишка так да тут анимация потерять есть такая функция называется сетей которая позволяет получить информацию о процессе на unix-подобных системах системах в том числе в этой функции структуре которая функция заполняет лежит время старта процесса и по нашим наблюдениям сколько мы мы это проверили это время совпадает с временем когда пользователь нажал на иконку приложения соответственно используя эту функцию вы можете замерить полное время запуска от нажатии на иконку и там на какого-то нужного момента которые время запуска который произошел уже как у реального пользователя который уже скачал ваш приложение stora и можете это время отправить в систему аналитики там метрику или ван спирс и просто проверять графики и смотреть что у вас не стала хуже просто через задевал де пренс статистик см и не можем мы не можем передать переменное окружение в запуск который происходит у пользователя а через эту функцию мы можем померить прямо в том числе и заключении пару слов о том чего мы добились картах время холодного запуска мы сократили на треть в случае iphone 5s мы сократили 2,3 до 1,6 то есть на 700 миллисекунд это время после переустановки после перезагрузки там соответственно больше получаются разницы поможет там целом времени больше есть что особенно приятно спасибо я пузо то что такую же такой же ускорение мы получили и на остальных устройствах то есть примерно при примерно одинаковой все устройства работают и если вы получили ускорение на 5s то и на других устройств у вас тоже время улучшилась таким образом не нужно после каждого раунда оптимизации вам про ты кивать весь набор устройство которых работает ваш приложением случае теплого запуска у нас чуть получше больше чем на треть время улучшилась на там почти 40 процентов ну да тут наилучшим без комментариев на 5s на 40 процентов она 6s у нас вообще в два раза улучшилась ремизов skype уж там очень переросла видеокарта в этом телефоне ну наверно на этом на этом все здесь у меня есть собраны ссылочки которые вам могут быть полезна во первых я выложился пример который рассматривал этом проекте ноги т'хаб также стоит естественно посмотреть презентацию wwdc ссылка на либо я мобайл девайс ссылка на такую от почту mail.ru стоит посмотреть как вопросами мама и документация краситель так как тут может кому то плохо видно вот еще ссылка на мой backup там слайды тоже лежат история сегодня рассказывал всем спасибо за внимание так почта моя вот здесь добрый день и спасибо за доклад вопросы такого плана можно ли частью этих задач автоматизировать что выглядишь за 1 первые два шага можно автоматизировать достаточно просто первые два шага это вы про помимо но и про первый шаг он вообще по идее должен делаться автоматически то есть вами монопод сейчас не не очень большой камень эти но есть этот инструмент прокачать то это просто будет выглядеть как добавление двух строчек в под файлы и у вас сразу же все эти динамические либо кодов исчезли второй этап он тоже делается автоматически если у вас уже есть и обертки примеры этих оберток на гитхабе у меня выложены если они уже у вас есть то вы просто по проекту заменяете использования села кич менеджер носил w офис-менеджер убираете импорте кур логичный ближе хедира иск из истории файлов если вам повезло то у вас тоже сразу все взлетает если не повезло то нужно еще проверить валите который портится в ближних и dream то есть это да это не требует особого индикатор особых интеллектуальных скажем так усилий этот чисто машину рутинная работа пскова на автоматизации пока нет ну вам придет строк проект потрогать братом использование core логично спасибо за доклад у меня вопрос насчет влияет ли на время запуска количество классов в самом проекте на смотря каких классов обжечься или свифт свести swift the ну естественно там чуть-чуть если рефлексия там readonly мире линьки есть поэтому естественно там метаданные некоторые при загрузке класс сдается но не столько сколько их создается при загрузке а психического класса поэтому влияет но практически незначительно и и порекомендует использовать там где вы можете использовать и вто не обжечься особенно а из его структуры то там еще до то есть проблем с со всеми этими оптимизация my и на примерах архитектурой вайпер в принципе быть не должно потому потому что вы перед довольно много файлов не создается не должно так и второй вопрос пожалуйста ребей и бензин time что такое gps и бензине баню банник это другой ряде омическое связывание когда подставляясь физический адрес указателя указывающего на символ другой библиотеке ли bass это когда у вас есть а миски библиотека есть касательно что-то внутри этой библиотеке к этому указателю всегда еще на уровне там этих таблиц и в библиотеке дописываются еще базовые смещение омичи ский библиотеки в общем самой так как де amis к ебле отёка может быть загружена в любое место операционной системы поэтому там не лежат уже физически адресатом лежат смесь с адреса относительно базового адреса диаметре блеать ecs а что делать если вот именно львиную долю вот времени запуска занимает именно ребей спиннинг насколько я знаю создание и загрузка объекте контекста она частично делается через либо из банды то есть например нужно стараться уменьшить в excel and с ну да нет на свете ну потому что же есть строго аджики хищные класс так ну-ка если наверное и спадов кто-либо из банда такое такой этап который сложно профилировать то есть вы можете например посчитать сколько у вас конкретно было либо из брендов то через консольную утилиту тукос но вот что с ними делать если вас выше чем новая не могу сразу ответить потому что это уже как как это уже прям очень системная штука у меня вопрос такого характера если мы в объекте все приложения хотим свифт использовать у нас эти библиотеки все они будут представьте грузится даже ли их нельзя говорить про это я и хотел сказать еще будет время она у нас есть меня в этом на моем гитхабе выложена так так так так сейчас я как-нибудь тут соображу вообщем можно идти вам нужно будет код который использует свифт выйдет девочка библиотеку у этой яме скоблить эти в зависимости будут доставлены диаме ческие библиотеки свифта в основном бинарном файлы приложения в зависимости этих не будет и поэтому они не будут грузиться на старте а загрузить только тогда когда потрогайте динамическую ли отёку которым будет ли второй год и всем во сне вы тоже можете загрузить через деле пан и вот на моем гитхабе есть идти + мышка не вижу сейчас есть там по пример того как раз как ладно давайте не буду то есть получается можно пользователя попробовать обмануть быстро забудете объекте всей конца доказать красивый там природы бегунки а вот время тяжелый sweet teen именно так можно спасибо возможно еще и я неправа тот вариант но возможно где люпин можно вызывать на фоновом потоке но это не рекомендую делать и спасибо за доклад у меня такой вопрос может быть это отчасти задаст во но если сам стив сказал что запуск так важен может быть все реально нам жить и все переписать нас не все так классно зачем мы так учимся тоже такой же вопрос мне задавали и когда я ты тоже так ладно мобиль рассказывал и про то можно ли сделать на на старте только обж иксия потом свет в общем да я таки да такие вопросы которые прямо скажем так просится ответное на него это наверно все таки выбор каждого то есть с youtube развивается и активно пушиться и полом и когда-нибудь из него эта проблема с таскания стандартных библиотек в каждом бандле исчезнет и появится статической линковки совместимость и все стоят 100 часть схемы и к тому моменту у вас будет проект на современном языке на котором на которой легко найти разработчиков по которой написано фреймворке а свифт он все таки будет уделом таких одиночек но не одиночек дано общем объекте он тихонечку уже не так выдвигается как раньше но и к тому же в нашем случае как вы сказали взять и переписать на объекте в нашем случае это не работал по что у нас носить я уже там было 300 тыс . никто бы нам не даваться делать когда вот вся эта каком и до конца разобрались что за чего у нас такой запуск долги уже какой-то момент объекте все нас есть переехали мы не доехали мы посплю соль приложения 2 год назад ну где не менее может пока описали его нас не было проблем с запуском акая написали она уже появился уже было поздно вот у меня два вопроса вот первое если при динамической подгрузки библиотек с помощью да и уайлд в главном потоке не может быть такое что если размер библиотеки слишком большой то при нажатии допустим кнопки там лениво подгружается и пользовательский интерфейс тоже блокируется что создаст негативный экспириенс да разумеется загрузки для место для тех сколько сколько занимает мы просто и перетаскиваем это время со времени запуска на время когда поезд и нажмет на кнопку но если у вас 10 семечки блеать эк то время запуска 1 библиотеки там скажем 100 миллисекунд 100 миллисекунд пользователь скорее всего не не почувствует и плюс она загрузится только один раз а вот когда они все в 10 грузиться на старте это 1 секунду он почувствует понятно да вот и еще вопрос от способа интаймом как вы верите вы не могли бы еще раз слайд показать вот то что вы перед мы ну самой первой строчкой в мы не вызываете да там такая вот что тут вначале было какой тут надо нажать чтобы мне не хватает кусочка экрана чтобы презентацию ввести ну короче там где то до сейчас все попадем какой но там где мерили в мае не время да кстати дополняя в ответ на предыдущий вопрос вы принес заблужусь а да да все таки я могу дополнить я в том что пам по моим ощущениям время загрузки девушки блеать эти не зависит от размера потому что она не читая с полностью с диска очередным об отображаются в адресное пространство зоне погрузки страниц основное время там занимает проверка подписи то есть даже маленькая девочка явили отёка грузится 100 краской большая так так так вот это да и где где вот какого момента где вот это будет в дом ну мы начинаем до старт у нас а где у нас and замера времен замера а в эту зависит приложениям вы должны laughing да в самом простейшем случае в конце детинец voyager 1 га но вообще я отдельный страус проговорить донести то что нужно замерять не только когда вы вышли из десяти не шло ни нга но и тот момент когда вас всё загрузилось полностью стал провожания доступным для использования в самый простой случай такой конец не финиш вот вот я вижу то же время нсд и там же мне кажется это не очень корректно использовать мактайм вот такие прецеденты game time with time of day лучше использовать но это не принципиально понятно ладно спасибо спасибо большое за доклад а можете рассказать перед задачей чтоб что было вообще то есть кто пришел и сказал о том что чуваки у вас слишком долго приложение загружается или вы как сами до этого дошли простая допустим завтра приду на работу пропишу до или до ld и посмотрю и то есть после какой цифры мне бить тревогу спасибо это зависит от того как ваше приложение используется если она запускается каждый день часто и на несколько секунд всего в нашем случае так то есть пользователь достает карты открывают смотрит где он находится и часто сразу же убирает если в это время будет приложение долго запускаться это будет раздражать а вот здесь у вас приложение которые там размять запускается утомленный 5 секунд может подождать так что зависит от приложения когда бить тревогу да это точно зависит приложение нашем случае у нас были какие-то отзывы негативную историю что там долго грузится на таком слабом устройстве они как бы накапливались и какой-то момент мы решили этим заняться это прямая всем спасибо за внимание"
}