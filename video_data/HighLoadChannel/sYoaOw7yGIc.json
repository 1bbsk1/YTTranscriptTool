{
  "video_id": "sYoaOw7yGIc",
  "channel": "HighLoadChannel",
  "title": "Описание инфраструктуры в Terraform на будущее / Антон Бабенко (terraform-aws-modules)",
  "views": 11762,
  "duration": 3016,
  "published": "2019-05-15T05:23:45-07:00",
  "text": "меня зовут антон кто-то из вас наверняка использовал код который я писал я сейчас буду об этом говорить больше уверенностью чем когда-либо потому что у меня есть доступ к статистике я занимаюсь terra форму и являюсь активным участником и контрибьютором в большом количестве open собственных проектов связанных с эра форум и амазона с 2015 года примерно с тех пор я написал достаточно куда чтобы изложить это в интересном виде о чем я попробую сейчас рассказать итак я буду рассказывать о тонкостях и о специфике работы с таро формам что на самом деле не является каким то таким таким предметом для хайло до часа постепенно поймете почему со временем я писал тира for модули пользователи писали вопросы я их переписывал потом я написал разные утилита для форматирования кода с помощью при commit хуков и так далее было много интересных проектов я очень люблю заниматься куда генерирования потому что я люблю чтобы компьютер сделал все больше и больше работы за меня и за программистов поэтому сейчас работаю над генератором трав он кода из визуально диаграмм которые ну кто-то из вас видел край красивые коробочки со стрелочками я считаю что было бы здорово если можно нажать кнопочку экспорт и поучительно все как кот я с украины я живу много лет норвегия поэтому если вы слышите какие-то буквы или кита звуки которые вам чужды это нормально особенно буквари у вас будет очень часто удивлять но это мы так в украине все разовая также информация в этом докладе было собрано от людей которые знают мое имя и находят меня во всяких с твиттерах с лайках потому что меня почти всегда один и тот же никнейм последний рекорд был когда человек нашел меня в шахматах ночь с дот ком рита я знаю кто такой дайте вопрос задам мы играли с ним шахматы это было очень интересно и так как я только что упомянул я являюсь главным моим тренером тира формой дпс marvel's которая является одной из самых больших репозиторий на гитхабе где мы хотим модули для самых распространенных задач или писи и авто с кейлин rds небольшой дисклеймер то что вы слышали сейчас это была самая самая базовая если вы сомневаетесь что вы понимаете что такое terra форум что такое же вы прочитали документацию то лучше найти время препровождение день в другом месте здесь не будет матюков как написано я зачеркнул strong line watch но здесь будет много технических терминов которые я надеюсь вы прочитали на сайте документации потому что уровень доклада я не постеснялся и заявился максимальной это значит я могу рассказывать используя все все все возможные терминологии без особого объяснения и я так надеюсь если будут какие то вопросы мы сможем обсудить либо во время либо после либо потом будет митап сморю все остались значит нужной аудитория тут здорово и так трав он появился 2014 году как утилита которая позволяла описать планировать и управлять инфраструктурой как кот ключевое понятие здесь это инфраструктура как кот вся документация как я сказал написано there for mail и она еще большинство из вас знает об этом сайте вы прочитали ее здорово иначе вы в нужном месте так выглядит обычный таро форм конфигурационный файл где мы сначала определяем какие-то перемены в данном случае мы определяем idps регион потом мы описываем какие ресурсы мы хотим создать запускаем какие-то команды в частности таро формы не для того чтобы загрузить зависимости провайдеры и запускаем команду тора формулой для того чтобы проверить соответствует ли указанная конфигурация тем ресурсом которые на самом деле уже созданы так мы ничего не создавали до этого the perv он предлагает нам создать эти ресурсы здорово мы подтверждаем это таким образом мы создаем baked которая называется сист mail ну все есть так же несколько похожих утилит многие из вас наверно кто пользуется амазонок знаю то это был склад формейшн или google cloud deployment manager или ажур ресурс менеджер у каждого из них есть своя какая-то реализация для управления ресурсами внутри каждого из этих public load райдеров траффорд особенно полезны той связи что он позволяет управлять более 100 дополнительно ресурсов более 100 дополнительных провайдеров таким образом цели который преследовал тира форм самого начала было то что iphone дает единый вид ресурсов и позволяет поддерживает все современные про-тф о платформе и также тира форм сау начала было задумывалась как утилита которая позволяет менять эту инфраструктуру безопасно и предсказуемое 2014 году слова предсказуемо было очень необычно мол как это так неужели мы можем посмотреть что за изменение собирается произойти то есть тот год это было очень классно киров он также является универсальная утилита и потому что если у вас есть какой то можно управлять совершенно всем чем угодно можно использовать более 100 120 провайдеров для управления всем чему душа полежит например можно используя сера форм для описания доступа к хип-хоп репозиториям можно даже баги в жире создавать и закрывать можно управлять new relic метриками и так далее можно даже файлы в dropbox и создавать если очень хочется это все достигается с помощью пера фон провайдеров которых открытый api который можно описать на гол и счастье итак допустим ситуация мы начали использовать реформ прочитали культа документацию на сайте посмотрели к это видео начали писать на интерес как я показал на пару предыдущих слайдов назад вас все классно у вас получился файл который создает крепись и кстати кто из вас знаком с и в с амазона с терминологией то есть не надо объяснять что такое писи и вершил поет клауд то есть кто-то знаком кто-то не знаком поэтому если вы совсем не понимается не стесняйтесь поднять я объясню что это такое на самом деле большинство этих сокращений а сам не помню уже настолько часто употребляются слова висит то есть означает a version правят клауд а может это что-то другое сегодня значит ну в общем посмотрим если вы хотите создать этот был ли писей то вы указываете пример над эти 12 строк описывайте в ком регионе вы хотите создать какой сидор блок айпи адресов использовать и все постепенно естественно проект будет расти вы будет добавлять туда кучу нового всего ресурсу источники данных вы будете интегрироваться с новыми провайдера неожиданно вы захотите использовать телефон для того чтобы управлять юзерами в вашем вашим гитхаба аккаунте и так далее вы можете захотите используют разные dns провайдеры скрещивать все подряд совсем ушел 1 тира форма этого легко позволяет таким образом рассмотрим следующий пример где вы постепенно добавляйте internet gateway потому что вы хотите чтоб ресурсы из вашего записи имели доступ в интернет ну хорошая идея потом вы добавляете согнет и и так как это играется pdf а о котором я не знал у вас все должны хорошее воображение сейчас идет анимация вот этот слайд поворачивается наверх этот слайд следующий все представили итак кто моменты когда вы захотите добавить над gate вы раут срал then they бл кучу других самолетов у вас будет не 38 стройка ну примерно 200 300 строк то есть ваш main те файл постепенно растет и довольно часто все люди складывают все один файл main телефон появляется 10 20 килобайт представьте себе 10 20 килобайт просто текстового контента все со всем связано с таким работать постепенно становится сложно 10 20 килобайт это хорошее юз кейс бывают и больше и не всегда люди считают что это плохо иногда люди думают ну а что такого ну да для понимания этого файла надо приложить усилий ну да но работает чуть дольше но это жизнь то есть я-то с этим смириться как и в обычном программирование обычная пример это такое более как это все хватающий термин но программирование не инфраструктуры как кот мы привыкли использовать кучу разных классов пакетов модули для группировки и так далее terra форм позволяет делает примерно то же самое то есть как мы видим код растет зависимости между ресурсами тоже растут и у нас возникает такая большая большая нужда мы понимаем что так жить дальше мы не можем у нас код становится ну очень необъятный 10 20 килобайт от конечно не очень необъятный но это мы говорим только о networks так то есть вы добавили тока сетевые ресурсы мы не говорим еще про ваш лот балансир applications deployment и исчез кластеры кубер нет и суда и так далее можно доплести еще килобайт 100 легко если если вы все это напишите то вы очень скоро опять таки в документации узнаете что кира форм предоставляет тира for модули траффорд модули это самодостаточное terra форм конфигурации которая управляется как группа это все что надо знать о таро for модуля они никакие не умные они не позволяют делать вам какие-то сложные подключения в зависимости от чего-то это все ложится на плечи разработчиков то есть это просто какая-то тиров он конфигурацию которую вы уже написали и просто давайте ее вызывать как группа таким образом мы пытаемся понять как мы будем оптимизировать наши 10 20 30 килобайт кода мы постепенно понимаем что надо использовать какие-то модули первый тип модулей которые встречаются это ресурсные модули они по сути не понимают вообще о чем ваша инфраструктура чем ваш бизнес где какие то у вас условия это именно те модули которые я вместе с полпинка сообществом администрируйте и которые мы выдвигаем как самый начальный building blocks для вашей инфраструктуры то есть когда мы хотим создать когда мы вызываем ресурсы модуль мы указываем с какого пути мы должны загрузить содержимого мы указываем какой версии мы хотим загрузить мы передаем кучу аргументов туда и все это все что нам надо знать когда мы используем как модель то есть когда мы используем этот модуль внутри же этот ресурсный модуль это очень важный момент кстати но и думают что если использовать последнюю версию то все будет стабильно нет инфраструктура должна быть version на и мы должны четко всегда мощи ответить на вопрос какой версии было за тепло и на той или иной компонент a pure вами кот которые находятся внутри этого модуля модуль security group опять-таки scroll в pdf и не работает пока здесь scroll идет до 640 строчки для создания security group ресурса в амазоне во всевозможной конфигурации это очень нетривиальная задача не достаточно создать просто security группу и сказать какие правила ей передавать это было бы очень просто внутри амазона есть миллион разных ограничений например если вы используете в письме and point префикс листа пиве секса певица и пытайтесь все это совсем скрестить поттера форм не позволяет вам это сделать плюс amazon и 5 тоже это не позволяет поэтому надо спрятать эту всю страшную логику в модуль и пользователи выдавать код который выглядит такого так пользователя не надо знать о чем как внутри она сделана второй тип модулей который состоит из ресурсах модулей уже решают задачи которые более применимы для вашего бизнеса часто это то место которое является расширением для тира форма и задает какие-то жёсткие значения для тегов для стандартов компании также там можно добавлять функционал который таро форм не позволяет сейчас использовать опять-таки мы говорим сейчас сейчас версия 011 которая вот вот вот отойдет в прошлое но все равно препроцессоры джейсон нет cookies катар и куча других вещей является именно тем вспомогательным механизмом который надо использовать для для полноценной работы я покажу дальше некоторые примеры из этого инфраструктуры модули вызывается точно таким же способом вызывается указывается источник откуда загрузить контент и передается куча значений которые которые передаются в этот модуль далее внутри этого модуля если мы посмотрим что с содержимого него вызывается куча ресурсных модулей для создания записей или application load balancer а или для создания security группы или для власти контейнер series кластер таким образом есть два типа модули это важно понимать потому что в документации большинство информации которую я сгруппировал в этом докладе не написано в документации и в документация терраформер прям сейчас она довольно проблематично потому что она просто говорит есть такие фичи вы можете их использовать но она не говорит как эти фичи используют почему так лучше использовать и поэтому очень большое количество людей пишут что то что в общем нельзя потом жить с ним давайте дальше посмотрим как писать эти модули потом как их вызывать и как работать skoda ну первый совет даже совет номер 0 потому что здесь большинство программистов это не писать ресурсные модули большинство этих модулей уже написаны за вас как я говорил они open source на они не содержат никакой вашей бизнес логики в них нет захардкожены значений для айпи адресов пароли и так далее то есть модуль является очень flexible и он уже скорее всего написан для ресурсов от амазона модулей много около 650 и большинство из них хорошего качества теперь поговорим про то какие если вы все таки решили писать модули и решили же вот у меня есть такой ресурс который который еще никто никогда не делал до меня вот я его сейчас сделаю ну на данном примере рассматриваю если вам надо создать к вам пришел кто-то и сказал я хочу иметь возможность управлять базой данных создай модуль чтобы я мог создавать базу данных человек не знают подробности реализации не амазона гитара форма он просто ведь я хочу управлять mssql здорово то есть мы подразумеваем что он будет вызывать наш модуль передаст туда тип движка укажет time зону все здорово человек не должен знать о том что мы на самом деле внутри этого модуля будем создавать два разных ресурса один для mssql и один для всего остального только потому что в таро форму 011 нельзя указывать значение time zone и опция опционы не обязательны и на выходе из этого модуля человек будет иметь возможность просто получать адрес он не будет знать с какой базы данных с какого ресурса конкретно как мы внутри создаем это все это очень важный элемент скрытия и это применимо не только для тех модулей которые находятся в паблик в open source и также для тех модулей которые вы будете писать внутри своих проектов команд второй аргумент который является довольно важным если вы используете terra форм какое-то время то у вас есть репозитории в котором вы складываете все свои тура for модули для вашей компании и вполне нормально что со временем этот проект вырастет до размер это 1 2 мегабайт это нормально но проблема заключается в том как terra форм вызывать эти модули например если вы будете создавать модули если вы будете вызывать модуль для создания каждого индивидуального юзера the terra форм будет сначала загружать весь репозитории а потом переходить в папку где находится конкретно этот модуль таким образом вы будете каждый раз загружать по 1 мегабайт если вы управляете 100 или 200 пользователями то вы загрузите 100 или 200 мегабайт а потом уже перейдете в ту папку таким образом естественно вы не хотите каждый раз этот нажимаете тура форме не загружать кучу всего есть два решения на эту проблему первое заключается в том чтобы использовать относительные пути таким образом вы в коде просто указывается что папка локальная точка слэш и перед тем как что-то запускать вы делать и git клон этого репозитория локальная таким образом вы делаете это один раз есть конечно куча down side of например что нельзя использовать вершине и с этим ну иногда сложно жить но второе решение если у вас много много под модули и у вас есть уже какой-то уста кониной pipeline то есть проект например m5 который позволяет собирать из моно репозитория много разных пакетов и загружать их на s3 это очень хороший способ таким образом файл м user100 zip будет весит всего лишь один килобайт потому что код для сада этого ресурса очень маленький и это будет намного быстрее работать поговорим о том что нельзя использовать модулях вот кто посмотрит на этот код и может сказать почему это зло почему в модуля такого писать не надо но константа да это хороший аргумент но на самом деле допустим и константу вынесем самая страшная вещь это осень юзер a7 юзер это такой вариант authentication в провайдер который могут использовать разные люди например мы все будем оформить роль роль знаешь катера форм будет принимать эту роль и потом с этой роли будет выполнять остальные действия зло заключается в том что если вася любит подключаться к амазона одним способом например используя по умолчанию переменные окружения а петя любит использовать свой черёд keys который но у него находится в своем секретном месте в терра форме нельзя указывать и то и другое поэтому для того чтобы они не испытывали страдания не надо этого блока вообще указывать в модуле это надо указывать где-то уровнем выше то есть у нас есть ресурсы модуль инфраструктурный мудр и композиция сверху от где-нибудь повыше это надо указывать второе зло заключается pro-vision раз здесь зло заключается здесь зло не настолько тривиально потому что если вы пишете код и для вас она работает вы можете подумать что ну для меня работает мол зачем мне это менять зло заключается в том что вот этот вот этот pro vision вы не всегда контролируете когда он конкретно будет запускаться во-первых а во-вторых вы не контролируете что значит и двс и ситу мы говорим сейчас про linux или про windows таким образом вы не можете писать что то что будет работать одинаково в разных в разных операционных системах или для разных юз кейсов самый распространенный пример том числе который указан официальная документация это том что если вы пишете рлс incense вы указываете кучу аргументов то ничего плохого и там нет если вы укажете там и pro-vision our local экзо к и запустите свое once i был play бук или что там у вас используется на самом деле да ничего плохого и там нет но буквально скоро вы осознаете что вот эта штука local их зайка на не существует например в lunch configuration и когда вы использовали latch configuration вы хотите из одного если ту инстанция создать of the skin группу в лодж configuration нет понятия pro-vision р там есть понятие userdata поэтому более универсальное решение является использовать userdata которая либо в самом будет запускаться на самом инстансе когда instance ключица либо в в этом же userdata когда of those келин групп будет использовать эту ложь configuration если все-таки от есть такое желание запустить pro-vision р потому что он является как склеивающий компонентом когда один ресурс будет создан все таки вот в этот момент мне надо сейчас запустить свой свой pro-vision раз свою курица команда таких ситуаций очень много и самый правильный ресурс для этого называется новый ресурс null ресурс это эффективный ресурс который на самом деле не создается никогда ничего не трогает никакого и пий неких алтайский что у нее нет но он позволяет регулировать когда запускать ада запускать команда в данном случае запускается команда во время создания есть несколько признаков я не буду останавливаться на всех этих признаков очень детально есть статья блок пост об этом который рассказывает ну если вы работали с таро формам или использовали чужие модуле вы часто наверняка замечали что многие модули но как и в большинство кода в open source и люди пишут для своих каких-то нужд он написал решил свою задачу или не решил за колбасило в git хоп и живет он то будет жить там но если там нет никакой документации примеров то никто не пользоваться не будет также если там нет функционала которые позволяют решать чуть больше чем его конкретная задача trading тоже никто не будет пользоваться а если там еще как молодой человек заметил будет захардкожены и юрист в где-то там внутри то увы люди из другого региона тоже не сможет этим пользоваться а если этим кодом даже невозможно понять потому что он какой-то обфусцированный то это ну ещё минус один то есть есть много много хороших способов потерять себе пользователей если вы хотите написать что-то чтобы люди пользовались я рекомендую следовать хотя бы почти всем тесты отдельная ситуация потому что их довольно сложно написать я больше верю в документацию их примеры и так мы посмотрели как писать модуле есть два аргумента первое которые наиболее важны не пиши если можешь потому что кучу кучу людей уже сделал эти задачи до вас и 2 если все-таки решился то провайдеры в модулях и pro-vision старайся не используя это та часть от кассира часть документации которая вы можете сейчас подумать что учет тут непонятно мол не убедил но посмотрим через полгода теперь поговорим о том как вызывать эти модули мы понимаем что со временем наш код растет у нас уже не один файл уже 20 файлов все они лежат в одной папке может в 5 папках может них начинаем как-то разбивать по регионам по каким-то компонентом потом мы понимаем что теперь нас какая-то какие-то зачатки синхронизации оркестрацию должны возникать то есть что нам делать если мы поменяли какие-то сетевые ресурсы что нам делать с нашими остальными ресурсами как вызывать эти зависимости и так далее есть один способ есть к бы две крайности на самом деле первая крайность это все в одном это у нас есть один мастер файл до поры до времени это был как бы сказать официально best practice на сайте таро форм но сейчас это уже написано депре кейт и убрано и в общем как бы со временем все terra форум сообщество поняло что это далеко не best practice потому что люди начинают использовать проект в разных в разных видах и есть проблемы например когда мы указываем все зависимости в одном месте бывают ситуации когда мы нажимаем тура форм план и пока terra форум обновить состояние всех ресурсов может пройти куча времени куча времени это например 5 минут для кого-то это куча времени я видел случай когда она запускалась 15 минут 15 минут и дпс и pr дергался для того чтобы понять что состояние этого ресурса этого а этого и так далее это очень сложно очень большая область естественно связанная проблема будет когда вы захотите поменять что-то в одном месте потом подождали 15 минут она выдала полотно каких-то изменений выплюнули написали с и чо-то пошло не так и то это вполне реальный узкий стер форм не старается вас отходить от проблем то есть пишите что хотите будут проблемы вашей проблемы тира форм пока after for 011 не старается вам помощника 012 012 будущий 10 там есть определенные интересные места которые позволяют вам сказать что вася ты действительно этого хочешь может одумаешься второй способ заключается уменьшить эту область то есть область меньше и меньше можно связывать как-то вызовы 1 место и здорового места вечная проблема то что надо писать намного больше кода то есть надо описывать outputs переменные в большем количестве файлов обновлять это как бы кому-то не нравится мне лично нормально есть люди которые мой зачем будут совета в разных местах и от всего в один за колбасин ну можно и так ну это как бы вторая крайность поднимите руки кто использует либо так либо так ну для начала у кого это все живет в одном месте вот в один такой большой файл есть один шаг два человека 3 ну то есть кто то кто то использует а кто используется так вот один компонент вызывает один конкретно блог или один конкретно инфраструктурный модуль так ну так вон у так человек пять все нормально ну ты здорово потому что самый частый ответ это где-то посередине потому что если проект большой то у вас очень часто будет ситуация когда не то решение не годится и там не все получается и поэтому у вас получается смесь это ничего плохого нету лишь бы вы понимали что есть преимущества и у другого и и у того и того а как у вас с оркестрация например если изменилось что-то в стеке в писе вы захотели применить эти изменения например где-то ну в easy tool вы захотели обновить авто с келли групп потому что у вас появилась новый особняк то есть ну так такого рода зависимости это я называю оркестрация есть какие-то решения то как использовать я могу подсказать какие из решения можно использовать таро форум для того чтобы делать магия а можно использовать всякие миг файлы для опять-таки использованию terra форум и смотреть там что-то поменялось давай тут запустим как вам такое решение кто-то верит что это классное решение вижу улыбку видать сомнения закрались конечно же не повторяйте это дома тира форм никогда не создано было для того чтобы запускаться и старо форма на одном докладе мне сказали и это работать не будет так оно не должно работать хоть и выглядит она так эффектно когда ты можешь сестра форма запустить ира форма там еще terra форм не это не на так делается реформа должна всегда запускаться очень просто если у вас есть нужда в оркестрация вызовов когда поменялось что-то в одном месте есть тора grand 2 грант это утилита которая позволяет эта надстройка над terra форм которая позволяет координировать и artistry ровать вызовы инфраструктурных модулей типичный terra форум конфигурационный файл выглядит вот так вот вы указываете какое конкретно модуль вы хотите вызвать какие у модуля есть зависимости и какие аргументы этот модуль принимается это всё что надо знать о гранд вообще документация там есть тысяча семьсот звездочек на гитхабе тоже есть но в большинстве случаев это то что надо знать и это очень легко вживить в компании которые довольно новое с тира формам которые не знают таким образом оркестрация это драган другие варианты есть если у вас есть еще какие то идея я с удовольствием выслушаю их во время брейка давайте поговорим о том как работать skoda если у вас есть необходимость добавить новую фичу в код всегда большинстве случает легко вы пишете новый ресурс тут все просто если у вас уже есть какой-то ресурс который вы создали заранее например в трактир форм узнали после того как вы открыли рлс аккаунт и вы хотите использовать ресурсы которые у вас уже есть будет уместно расширить свой модуль таким образом чтобы он поддерживал и использование существующих ресурсов используя дельта сорс и создание новых ресурсов используя ресурс блок на выходе мы всегда возвращаем out put айди в зависимости от того что было использовано таро очень существенная проблема в таро форм 011 это работа со списками работа со списками top форм сложность в этом заключается в том что если мы имеем такой список юзеров то когда мы создаем этих юзеров у так используя блок ресурс то все происходит нормально мы проходим по всему списку создаем каждому каждому файлик нормально потом когда юзер которая посередине например юзер 3 должен быть убран отсюда то все ресурсы которые были созданы после него они будут перри создаваться потому что индекс изменится работа со списками в стоит в окружении стоит в окружении что это такое это та та ситуация когда возникает новое значение при создании этого ресурса ну например рлс mx иски или секретки когда мы создаем юзера нам приходит новый xs или секретки и каждый раз когда мы будем удалять кого-то юзера у этого юзера будет новый ключ но это не по фен-шую потому что юзер не не захочет дружить если мы будем каждый раз создавать нового юзера для него когда кто-то покидает команду решение такое это код написанный на джейсон ли джейсон это язык для создания шаблонов от гугла это эта команда позволяет принять этот шаблон и на выходе он возвращает джейсон файл который был от рендеринг по вашему шаблоны то есть шаблон выглядит вот так тира форм позволяет работать и с сэлом из джейсон одинаково поэтому если у вас есть возможность генерировать джейсон то вы можете его подсунуть второ форм файл с расширением tf джейсон будет успешно за оружием и потом мы работаем с этим как обычный тира for монитора формы план и мы создаем 2 юзеров как и хотелось теперь нам не страшно если юзер получит новый если кто-то покинет команду мы просто отредактируем вот этот джейсон файл вася пупкин ушел 5 5 а пяточкин остался петя пяточкин не получит новый ключ интеграция тира форм с другими устройствами по сути не является задачей трансформатора форм создавалась только как платформа для создания ресурсов и все все что подходит потом это не забота terra форма и не надо туда вплетать его есть определенные once i был такер и так далее который делает все же надо но возникают ситуации когда мы хотим дополнить terra форм и вызвать какую-то команду после того как что-то выполнилась первый способ это мы создаем out вот где мы просто пишем эту всю команду а потом эту команду вызываем из села тира форма от пут и указываем это значение которое мы хотим таким образом это является исполняемая команда со всеми поставленными значениями да очень удобная второй способ это и таки это использование null ресурса зависимости от изменения какого-то в нашей инфраструктуре мы можем вызывать тот же ловко лобзик как только изменится айдишник какого-то ресурса естественно это все гладко на бумаге потому что amazon как и все остальные public провайдеры имеют кучу своих кейсов самый распространенный и кейс заключается в том что когда вы открыли и давалось аккаунта какие регионы вы используете а включена ли у вас эта фича там а может вы его открыли после декабря 2013 года а может вы используете дефолт в офисе и так далее очень много ограничений по которой просто невозможно поговорить и amazon их разбросал по всей документации поэтому удачи если сколько вещей которые я рекомендую избегать и это это мое мнение для начала избегайте всех не секретных аргументов внутри terra форм планы литера форм села и все это можно сложить либо в фарс файл либо переменное окружение но не надо запоминать всю эту магическую команды terra форм план минус war и понеслась первая перемена минус war 2 перемена 3 4 самый важный принцип инфраструктуры как код который я чаще всего использую это то что просто взглянув на код я должен прекрасно понимать что там за тепло и на в каком состоянии с какими значениями и поэтому мне не надо читать документацию или спрашивать вася какие параметры ты использовала для создания от этого нашего кластера и мне просто достаточно открыть файл с расширением tf wars который часто совпадает с окружение и посмотреть все там также не надо использовать переменные аргументы майонез таргет для уменьшения области действия для этого намного проще использовать просто маленькие инфраструктурные модули также не надо ограничивать и увеличивать параллелизм если у меня сто пятьсот ресурсов я хочу увеличить параллелизм amazonas 10 которые по умолчанию до 100 она скорее всего пойдет не так или она может пойти хорошо сейчас но когда amazon скажешь все вы слишком много делайте вызовов у вас посыпятся проблема тира форм большинство этих проблем будет ретро им пытаться перезапустить но вы не добьетесь почти ничего параллелизм равно 1 это важная важная вещь которую надо использовать если вы споткнулись какой то бак внутри л.с. и pr или внутри terra форм провайдера и тогда надо указать параллелизм равно 1 и ждать пока тира форум закончат один вызов потом второй вызов в том 3 получи где она запускает сейчас еще все меня люди спрашивают почему я считаю шутера форум workspace зло я больше чем уверен что здесь есть люди которые тоже прочитав этот думает что я неправ я как уже сказал верю что принцип инфраструктуры как он заключается в том чтобы видеть какая инфраструктура была создана и с какими значениями workspace была создана не со стороны пользователей от не знаю пользователи написали там в гитхабе ищу сказали жить не можем без сыра форум workspace нет не то терраформинг рпс это коммерческое решение terra format рекорд решила что нам надо workspace поэтому их запилим я старше намного проще это положить просто в отдельную папку тогда будет чуть больше файлов на будет понятнее как работать skoda до работа со списками то по сути единственная боль и воспринимайте terra форм проще это не та вещь которая будет вам делать все все классно не надо пихать туда все что написано в документации в теме доклада была написана на будущее время почти закончилось я очень кратко на будущее это знать что скоро выйдет 012 012 это куча нового всего если вы пришли из обычного программирования то вы скучаете по всяким динамическим блоком таким то циклом правильным условным операциям сравнение где левая и правая часть вычисляется не одновременно а зависимости от ситуации вы очень сильно поэтому скучаете по этому 012 вам решит этого по сути но если вы будете писать меньше и проще использовать готовые модули и вообще сторонние решения то вам не надо будет ждать и надеяться что 012 придет и все за меня починит у меня все это был кэп очевидность вопрос там привет спасибо за доклад ты говорил инфраструктура как кот и буквально протесты один одно слово сказал скажи как нужны тесты в модулях чья-то ответственность нужно ли самому писать либо эта модулю ответственность пару слов до теста и это как по мне следующая конференция будет засыпано а вообще следующий год будет засыпан и докладами о том что мы решили все тестировать все тестировать и вообще что тестировать это самый большой вопрос есть куча зависимости куча ограничений разных провайдеров и то есть когда мы с тобой разговариваем и ты веришь мне нужны тесты я говорю что ты будешь тестировать я буду засирать своем регионе говорю о моем регионе это не работает а у меня аккаунт был открыт раньше то есть мы даже на этом чтобы не сможем договориться не говоря уже о том что есть куча куча проблем технически как и написать эти тесты чтобы они были адекватные я верю ну ка бы я стараюсь я исследую эту тему активно автоматически генерировать тесты на основании этой инфраструктуры которую ты написал то есть если писал этот код да мне его надо запустить и на основании этого я могу создать тесты тира тест это одна из самых распространенных даже не раз спасали самых часто упоминаемых библиотек которая позволяет создавать тестирование ну писать тесты интеграционными для тира форм это одна из утилит мне больше нравится dsl тип типа инспектор стек сервер speak в эту сторону а тот спасибо за интересный доклад меня зовут валерий позволите немножко философские такой может быть чуть холивар на вопросы долги ради холивара просто действительно самому хочется понять посмотри есть как бы условно продвижением когда есть дипломе повяжи никому не просто создает тепло мятную чем-то наливаем полезным там серверами нашими приложениями и прочими и вроде бы вот эту меня в голове сидит что от тебя форм он больше для проведения условную ansi был больше тепла минтану потому что в том числе и на физическую культуру позволяет поставить там или джеймс и под грессы там и прочее да там сконфигурировать их и так далее но при этом роде брианце был позволяет сделать провяжем как например амазонских ресурсов далеко а свою очередь но retiro форм позволяет какие тут уже с помощью своих модулей до за тепло из какой-то софт вот ставить точки зрения если какая-то граница которой проходит между там условно тира формам и носимом где я что лучше использовать или например там условно силу фигня это уже немодный надо пытаться тира борна всего использовать спасибо хороший вопрос валерия я считаю что тира форм с 2014 года не изменился в том плане плане предназначения создан для инфраструктуры и умрет для инфраструктуры у нас по-прежнему был и будет нужда в configuration management on se был пакет что угодно просто вызов в этом и пьем я вижу там что есть userdata внутри логика ты грешен и там ты дергаешь все свои падших ansi был что угодно то есть вот это стандартное разграничение которая мне больше всего нравится и понятно также если мы говорим же про имеются было infrastructure то есть утилиты типа пакир которые собирают этот образ и дальше таро форум используют datasource и для поиска вы от этого образа и обновление своей логиков играйся то есть таким образом pipeline заключается в том что мы дергаем сначала tracker потом дергаем terra форм и если произошел build то происходит новые новое изменение а еще последнее дополнение у меня есть наклейки знать здесь люди которые любят налепить наклейки как я от не мой компьютер также подойдете потом я вам дам наклейка еще есть я не знаю то вы можете анонсировать или кто это про книгу до лучший вопрос выберите и вручите книгу автору лучшего вопроса пока было два вопроса это лучший вопрос будет только быстро то время закончилось сразу спасибо за доклад меня зовут миша компании fbs вопрос следующим можно анти был вызывать вызывать через pro-vision р-ну при создании ресурса а также можно использовать в ансип есть такая тема как динамический инвентарь и можно сначала вызвать траффорд а потом вызвать анти был которой и стоит а возьмет собственно ресурсы и выполнит что лучше по твоему ну это это люди используют с одинаковым успехом мне кажется что динамик инвентарь эванс и был удобная вещь если мы не говорим про авто с келин групп потому что авторский элен группе у нас есть уже свой инструментарий который называется ложечка с игрой ща мы ложках играешь на записываем уже все что надо запускать когда создаем новый ресурс по этому сну в связи с амазона использовать динамик инвентарь и и читать трафарете стоит файл по-моему это излишнее если вы используете какие-то другие средства где нет понятия of those келин group ну например вы используете там digital оушен или контент-провайдер там нет у них of the skin группа этом да там вам надо будет ручками дергать айпи находите api адреса формировать динамик инвентарь и файл и ansi был будет уже по нему бродить для амазона есть ланч configuration там нет необходимости использовать динамик использовать ложка с игрой и авто с келин групп можно управлять сальсо митрофан поэтому в амазоне лучше это а для всего остального инвентарь и так кому же достанется книга но у нас нет времени на вопросы на западе результаты о котором мы будем говорить начнем с этого а потом перейдем на континенте grand era форм и и друзья друзья в данном случае это amazon докер танцевал и что-то еще"
}