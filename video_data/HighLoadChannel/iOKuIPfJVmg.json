{
  "video_id": "iOKuIPfJVmg",
  "channel": "HighLoadChannel",
  "title": "Использование телеметрии с клиентских инсталляций для предиктивного решения проблем / Максим Лапшин",
  "views": 1155,
  "duration": 2687,
  "published": "2022-03-21T14:15:07-07:00",
  "text": "коллеги а значит меня зовут максим лапшина я себе хочу рассказать немножко про то как мы как у нас живет грубо говоря клик house в техподдержке и сейчас выйдет на земле чуть-чуть а большим будет значит как в принципе нам получается заглянуть за людей то через головы людей посмотреть на то что происходит мы делаем коробочный продукт люди берут наш софт ставят на свои сервера то есть наши клиенты это другие компании мы бы тебе компания мы продаем софт люди ставят на силу своей севера так же как например выставить какой-нибудь под грех или что то еще подобное с конечными кабай клиентами мы не работаем вот которые там бит оседают в самом конце концу мира наши как раз клиент этого те кто девелопера администратор и прочее нам нужно оказывать им поддержку но люди да я получу люди платят нам деньги за софт ежемесячно и они хотят чтобы у них все было хорошо у них возникает вопрос они к нам приходят у нас есть штат поддержки то есть наша поддержка это не те люди которые поднимают труп говорят там ваш компьютер перезагрузите а это эти люди которые умеют собрать логе собрать тикетов тикет где-то даже написать какой нибудь там минимальный тест это очень квалифицировались этой поддержка такого 2 почти 3 уровня но беда в том что естественно нас не любят вообще звать потому что люди в принципе не любят снова общаться а у них вы думаете можно денег заплатили хотят что просто все работало и насера нас просто так например не пускают если нам интересно узнать о чё там у клиента на сервер это просто так нас там не ждут это целая проблема нам нужно заниматься поддержкой как и сказал и вот одна из первых трансформации которую мы для себя начали делать это отход от лагов в которых ну что можно увидеть в логах это можно увидеть танки и тикси пшена и все stack trace насколько они актуальны решают вообще насколько они релевантны к проблеме которые стю клиент это очень большой вопрос и вот пример доклассический что клиент к нам приходится какой-то проблемы он говорит что я диагностировал проблему я все сам знаю еще не дай бог сам логе от аккуратненько отодрав самые не нужны выкидывает нужны нам присылает в общем пример вот я взял и зубрит ваш софт плохо видео захватывает то есть почините захвата видео транскодирование у вас не работает мы открываем графики графики варят что клиента вообще слушать не надо потому что там например вот такой это графическая подсистема на которой видно что на самом деле просто харды рассыпаются вот и все м калеб менять жесткие диски он поменял и видно картинка стало хорошо и внезапным образом как бы и проблемы с захватом исчезли все остальное то есть первый переход который мы совершали это отойти от того что слушать клиента сразу и верить ему полностью отойти от того что смотреть логи и всё-таки подойти к тому чтобы смотреть графики потому что на графиках мы видим картину в шире дальше ситуация начинает усложняться с чем мы работаем например клиентов нотариальная фреда считая всего в реальные случаи с нашей поддержке порядок рассказывают клиент жалуется на перезагрузку раз в три дня мы заходим к нему на сервер смотрим все ок заходи к нему каждые пару часов на сервер и ждать но это честно говоря мучительно то есть это значит несколько дней надо ловить а если это будет ночью мы просто не успеем то есть будут спать открываем график и видим что у него просто такая ну классическая пила то есть он где-то у нас вытекает память все видно по верхнему графику что сражается какими-то какой-то в общем серу плохо но он страдает в корчах что там творится может память и дохнет видно что restart происходят как же нам попасть что же нам как там выяснить как попасть потому что ну честно время ночью люди работают не будут инженерами тасс график это пила как найти надо найти другие клиентов в которых такая же проблема мы же софт делаем серийно не не покажет вам от таких клиентов тысячи то есть у кого то скорее всего ещё будет такая проблема как найти подходящий паттерна у кого-то другого если графики не нарисован если графики уже не нарисованы задним числом как бы восстановить графики и скованы zabbix и уже крайне сложно если просто вы смотрите глазами на графике у вас нет данных то здесь уже ничем не помочь и сам главное что allure ты тоже не всегда помогают потому что вот например еще один клиент которую мы как раз нашли чтоб починить 1 у него цикл смотрите ни разу не доходят выше 80 там в одном месте может буквально на самом деле у него полка то есть вы классическая полка которая пойти полечить local быть не должно причем полка с характерным дребезжанием это тоже не нормальная картина и уже имея на руках такие данные не видя не виде графиков за биг си а ведь играют данных в базе данных уже можно что-то по и пойти поискать собственного можно найти того у кому будет плохо через час и пойти быстро решить проблему сразу для пачки клиентов и пройтись по ним по всем сказать ребята у вас есть проблема там обновлялись то есть какая проблема с классическим от минским мониторингом когда данные агрегируются когда до из данных пишутся график делаются данные сильно теряются жесткие диски на самом деле сегодня огромные в принципе далеко не что нужно тире нет смысла как бы сильных компрессировать алерта которые вы ставили админы они только преднастроенные тогда надо знать какая будет проблема а если мы знаем какая быть проблема скорее всего мы можем ее пойти починить помощью с помощью просто программистов это прольем больше не будет alert и решают проблему которой уже решено программистами задним умом быть очень сложно когда у вас нету исходных данных и собственно здесь мы переходим уже чуть чуть дальше от просто как бы мониторинг и поддержки и прочего к телеметрии потому что мы здесь сильно чем расширить понимание того как мы работаем с тем что нам присылают наши free соннике значит у нас стоят наши софт с наших наш состоит в количестве нескольких тысяч экземпляров это много тысяч по серверам клиентов это это несколько тысяч разных клиентов которыми у которых совершенно разные сценарии использования они очень-очень сильно не похожи друг на друга у всех разный у кого-то раздачи видео кого-то прием видео кого-то там транскодирование все богаче и мы принимаем затихли сонников даже пожелания клиента замеры и историю сессия точно разные вещи на самом деле замер это классические привычные графики там цыпа всякой деталей чем расскажу и 2 эту историю сэттии просмотра видео это более высокоуровневая вещь и вот второй от нас это же просто продуктовой аналитика то что другую нас нету а если где вас нет продукту аналитики то как бы работать тяжело и вот и данный момент мы сейчас находимся в таком прям в процессе длительные большой объем информации ко всей компании у нас прям буквально все все я делаю так или иначе учатся ходить к базе данных который все это лежит это 400 миллионов строк в день мы пишем порядка 200 и 300 гигабайт приходят приходят трафика на сервера наше около 20 гигабайт ложится на диск лик хаосе потому что мы все так очень плотненько научились упаковывать и вот про это чуть поподробнее отчет что мы уже как это как все дальше развивается от куда мы дальше ушли от простой от простых графиков и телеметрии клиент некий клиент жалуется на тормоза город все плохо бруса плохо не так любят говорить естественно погружаться в детали когда плохо что они при этом делают мы прямо что вы делаем гортань чего мы получили все будет плохо плохо ну понятно все дальше что-то выяснять бессмысленно то есть это такая вот есть на сложности тем что клиент вообще которые платят нам деньги не очень-то любят рассказывать нам в подробностях что они делают там числе с нашим софтом они считают что это не нужно рассказывать вот значит мы открываем аналитику которой собрано уже которые за им замеры по количеству разных api вызовов видим там странные аномалии с ними приходим уже к клиенту начинаем пытать захват там дергаем уже начальника говорим пожалуйста помогите то там тех директора сформировать в apple ответ на вопрос что же вы делаете в таком количестве и выяснять что оказывается мы просто забыли бизнес-процесса они сами его до придумали и вскрыли проблему потому что мы забыли вот собственно говоря на графике виден спайк это клиенту приезжает большое количество камер они их всем сразу проводят атака но и контроль все их сразу ментальный подключает здоровенное количество они очень быстро ментальное все приходят на одну из под систем которое было на это просто не рассчитана мы не был там такого заложено честно ну садимся дальше выясняем что происходит то есть это способ посмотреть за человека люди говорить не хотят а цифра скажут что мы в принципе себе собираем на основе чего можно пойти и узнать больше чем чем готовы люди рассказывают это самые простые вещи от на самом деле циpкa памяти дисковая подсистема загрузка видеокарт потому что например мака давайте собирать заданной по видеокартам нашли клиентам майнеров вот вот так вот мы видим что у не запускается софт и и там в течение минуты у них вылетает и хожу в полку влетает карта выпуск как бы не убирают транс к теме на видеокарте она уходит в ноль и не так быстро агностик сильно быстрее чем оно должно было уйти по нашим прикидкам и мы идем клиенты были там во что-то происходит драки оптики тут майнер оказывается вот и этому мы получаем возможность смотреть сильно за клиент особенно учитывая нас далеко не все клиенты способны построить свою систему мониторинга свою службу у них нет такого количества как бы мы одни да у нас 300 тысяч клиентов средних очень многих принципе мне нынче не мониторит они просто их работа это работа то их у них колл-центр мониторе там если чего не позвонят какие вещи мы можем видеть вот пошли к клиенту что-то починили сделали апдейт цепи пошел расти клиент прибегает и брат все кошмарно все плохо смотреть ваш софт жрет с процессора и вообще срочно откатить и обратно что там верните обновлением говорю смотрю у тебя дружище трафик в три раза смог вырасти то есть тоже такая вот такая вот вещь которая нас есть на самом деле в три раза человеку отпустили обще всего система она прям поползла наверх и ожила это уже такая аналитика которую можно отнести например product product может пойти посмотреть увидеть что что-то пошло не что-то пошло сильно лучше то есть явно была какая-то ограничивающая проблема на вот зелененький зелененький это старая версия желтых новая версия что-то мы поменяли и стала лучше можем пойти посмотреть оценить что же было этого клиента что же что у этого клиента это чуть чуть дальше что мы еще сохраняем что что еще полезно сохранять мы работаем с видео видео приходят наши сервера вот сам непрерывный поток передачи видео мы называем видеосессии это такая вот у нас бизнес-единицы какая-то единица оказания работы и мы когда пытались понять померить как же у нас был такой эксперимент мы пытались у людей наших клиентов узнать как же чтобы сна говоря мы влияем на их деньги они процесс очень прост пока вы работаете пока ваш авто работает мы зарабатываем вас это не касается если ваш зов не работает там и ничего не зарабатываем мы теряем все ну вот такая вот ничего детальней мы за 10 лет работы от отказ тембров не смогли узнать поэтому мы решили сами пойти померить и собственно говоря мы верим теперь для себя мирим объем оказанные услуги то сессии передачи видео у них есть количество байт которая протекло это то это касты клиента а есть длительность чем длиннее видео смотрели значит клиент больше зарабатывал слушаю очень просто чем сессии длине тем лучше таким образом мы подошли к тому чтобы за клиента померить одну из форм сердечных метрик как именно называть и соло или с силой это я сейчас оставлю вопрос сложный но это именно вопрос того что мы сами за клиентов начали мерить вообще уровень сервиса пришлось и как раз когда я показывал graphics цб этот был пример того как мы сможем увидеть на самом деле сильно больше стало трафика мы видим это на графике сессии и мы еще увидим это на фичи матрица потому что практика этим с ним привязан еще какие-то флажки ну что конкретно было использовано для этой сессии тоже такие прям фичи флаги продуктов и аналитики следующая вещь которую мы смогли начать с помощью клик хауса с помощью телеметрии делать это ответ на вопрос как там у клиенты дела потому что довольно паршиво история то ходить к клиенту и спрашивать ну как там у вас дела с нашим софтом как обсчета ману раба живет не живет работает не работает расскажите это бессмысленно спрашивать потому что там будет либо либо недостоверная информация вида все хорошо а может быть и все это может потому что что может не хорошо мы не знаем и он тоже не знает либо все плохо это тоже информация которая бесполезно оно бессмысленно потому что что такое все плохо вообще может к нам одного отношений не иметь вот поэтому для нас жизненно важен а этого-то куда мы сейчас идём то что нас принципе уже начало получаться этом находить проблемы раньше клиентов у screen пошел проапгрейдился а мы уже узнали что ему надо откатить обратно из-за несовместимости конфигурации или например у него какие-то проблемы мы можем узнать об этом раньше чем чем чем он это про активный поиск проблем пример вот с тем же клиентам пошли на его анализировать натравили наши наши новые скрипты нам об данные которые зато у него он и мы видим что у него есть аномальный пласт сессии которые очень короткие не ненулевые то есть что-то по ним там протекает какое-то количество байт а потом рвется все что происходит не понятно надо пойти посмотреть идем в клиент игры пойдем поищем мы нашли у тебя проблему как бы ты не видишь а мы видим поем вместе поищем он такой не это просто плохой интернет нас тут камеры висят на весь а тут висят там интернет непонятно какое то короче внимание не стоит давайте это не отвлекайте мы тут всеми делами занимаемся ну а вам видно что он не прав потому что причина закрытия который мы пишем сессия на другой а не та которая бывает на плохом интернете и все-таки добиваемся от клиента доступа на сервера получаем логе видим влогах то что вам показываю что на самом деле на целый партии камер неправильно дефолта настройка если бы эти камеры уехали дальше то клиент получил бы примерно полторы тысячи уж висящих камер по городу которые надо перенастраивать с физическим доступом к нему то есть по 1000 рублей за камеру на полторы тыщи умножаем ну как бы вот примерно то чего можно спасти человека то есть это эту пром ну это вообще это прям окрыляет к такие вещи начинаешь делать то есть чек не горит нет проблем от и грыж мы знаем ты находишь эти проблемы что следующее у нас возникает эта вещь который на самом деле она уже для нас не неспецифичны то может возникать у многих компаний которая или даже внутри крупных компаний чем крупнее наш клиент тем хуже человеческие связи то есть мы начинаем общаться с одним человеком если все хорошо начать расти по карьерной лестнице и все дальше уходит от того места где находится наш софт тасс мы с ним можем созваниваться с ним может созваниваться грязно кей аккаунт менеджер мы можем стоит встречаться устраивать дам стратегически совместной сессии обсуждать будущие проекты но при этом он вообще не в курсе что творится внизу внизу может быть какие-то проблемы и они в силу того что клиент все укрупняется увеличивается усложняются связи внутри него иерархия проблемы уже начинают гораздо тщательнее вызревать то есть если вчера например клиент был какой-то клиент был этот четыре человека сидящих вместе в одной комнате они быстро нам постоянно чем говорят там пишут жалуются мы им помогаем то когда я тоже корпорация на 1000 человек то пока проблемы не вызовет до какого-то общем состоянии около как это полное крушение всех надежд да вот фиаско пока надо это состояние вы зарядка на мы не пройдут и вот на суперклей пример наш каста мир очень хороший ну прям такой сильно денежный у нас с ним даже договор на нам compeed tucson нам платят деньги что мы не работали с его конкурентами и вот у нас там с ним здоровенный договор по этому поводу то есть отношения предельно хорошие и он звонит нам утром и говорят мы до вечера от вас съедем типа как бы делать что хотите но к вечеру мы найдем другое решение поэтому что в таком состоянии дальше бессмысленно вообще пытаться общаться с поддержкой с кем-то еще . де как бы каким-то образом у них дошло до состояния закипания и ему сделали очень большой втык уровнем выше и все это статься ступором то есть мы падаем ситуация даже при предельно хороших ниш корпоративных отношениях это никак не помогает качество сервиса которые мы даем за дело берется продукт который собственно умеет полюса клик хаусом лезет устанавливает картину картину и картина общее сервиса клиента карата сервисы этого клиента выясняет где там находится транскодирование наших я там находится сервера захвата где находится сера раздачи у них у всех характерны паттерны их очень немного чуть-чуть посмотрел в графике чуть-чуть сделал разные выборки выбор сделал выборки с квантиль ами и уже это видно становится находим два странных сервера до которые постоянно клиенты которые обращаются аномально это было всего две штуки и находим время резкого изменения их аномального обращения было вот так устала вот по-другому находим дату в какое-то было и говорим идите туда смотрите в киты были ли обращения действительно были обращения связаны с тем что и дальше вопрос абсолютно никак не связанные с проблемой что там у них поменялось какие-то кода коды ответа там оказалось что ребята какие то админы в этой компании щели сделать хорошо никому не сказав поставили мониторинг который дергает совершенно не за ту ручку за какую надо и она работала без изменения потом мы поменяли код она начала работать они видео рубль за недокументированные как бы возможность она начала работать по-другому не документирована и у них уже целый месяц сессиям соси передачи видео просто вернуться через 30 секунд и это происходит к счастью не так то есть из за того что их хреновый мониторинг он не успевает все порвать что только можно поэтому живёт примерно 15 20 процентов сессии которые есть и у людей уже целый месяц 20 процентов их бизнеса убивается серверами которые они сами себе поставили мы это все это отнесли клиенту все эти детективные расследования показали после чего нам сказали в общем извинились скале спасибо конфликт исчерпан вот и сделать это путем общения с людьми было бы невозможно то есть по опыту это заняло бы около 3 месяцев но ты потерпишь либо у нас был день был один день значит как вообще мы все это собираем как что то есть какие тут практически есть детали циpкa и циpкa память это просто 1 значит это цифру память они пишутся в одну колонку это просто одна колонка одна таблица много колонок естественно в ней время диктатор сервера все прочее и все показатели цвета числовые ну сколько у сам тут чем чем чем шире таблицы тем лучше как правило сбор сессии примерно так же это у нас вообще вся телеметрия это просто только две таблицы это одна таблица с замерами замерами другого игрока градусниками вторая таблица с сессиями сессии это широченная здоровенную таблицу которая полей наверное сейчас уже больше ста их будет большую но наша цель это примерно полторы тысячи полторы тыщи колонок вот и там уже всякие флажки в которых был архив не было архива какой протокол использовался ко всему этому есть интерфейс для клиента клиент может зайти посмотреть сам свою статистику в личном кабинете вот мы используем так map сердце да по сути то есть к нам приходят он всё новые и новые новые данные то есть одна и та же строчка она обновляется на флюса ники на сервере ну наношу на нашем сайте у отправляет на сервер телеметрии она там складывается и собирается в пачкать нравится клик house is просто перезаписывается то есть в принципе мы знаем что вот данные которые сегодня они такие грязноватые не до смены их к ним надо поспокойнее относиться в принципе за сутки данные данные уже уже перемешиваются все это нормально 4 replacing merge 3 так дальше пор передачу домой здесь момент который очень наверное интересную такую очень близок мобиль щекам которым и тему кому приходится длительное время поддерживать софт который это сделал давно вот у нас до сих пор живы инстансов ли сонников поставленные около десяти лет назад и убедить людей обновить бывает непросто ну то есть от так они их уже дело принципа нет мы не главного обновлять мы все еще поддерживать совместимость для этих бизнесом инстансов вот мы используем а из n 1 это вместо про табов это вместо тариф то эта штука которая была на десятилетие назад по большому счету наверное это мы выбрали его потому что у нас варлона сеттер long визе и в нем охрененная sn1 ную поддержка она есть только в ирландии для себя всех остальных языков по мы просто нету поэтому на нам здесь удобно был бы ней long наверно ему выбрать что то другое но а sn1 жутко компактный тасс она реально до каждого бита упаковывают и как компактнее чем чем а sn1 сам эти биты не упакуешь и утром любите к забить и com укладывает значит старые полям и иногда выкидываем но они мы их оставляем поэтому протокол чуть-чуть раздувается скорость его раздувания она невелика то смысле скорость скорость появления в самой схеме ненужных полиана пока небольшая нас устраивает вот геморрой со схемой потому что у нас есть схема данных по которым и бельем домой у нас есть получается минимум 2 место где оно хранится это сам флюс sonic которые мы раздаем клиентам и потом то есть когда мы отдали мы же не можем поменять и у нас есть сервер телеметрии на которая все это льется мы поддерживаем мы выбрали так что нас все данные в первичную эта схема вафлю соннике некоторые компании делу так что у них есть отдельные репозитории в котором схемы лежат ну наверное каком-то варианте это будет удобно но у нас у нас вот так мы выбрали так что нас в совке которые мы отдаем клиент находится первичная версия а из нее уже копируются в остальные сервисы которым это может понадобиться вот и тест у нас есть кот пенси возникает ситуация когда флюс sonic данные присылает а сервер телеметрии просто часть колонок выбрасывает то есть данные приезжают но часть из них отбрасываются и пока мы не обмоем новые не поставим новый сервер телеметрии у нас еще не будет равно сданный будут теряться мы обновляем сера телеметрии все начать работать вот теперь следующая важная проблема оказалась для нас это грязно исторические данные значит есть проблема сбора первичных данных мы на глаз делаем ошибки в том ходе которой который собирает первичку ну например можем на тысячу не поделить или лишний раз поделить и у нас может быть это такая что на там на общем графики трафик у нас курить волшебный взлет это один сервер например берёт и меняет статистику на все там тысячи сироп потому что там забыли кило битые и мегабита перепутали значит изменяем то что две трети наших костюмеров находятся на последних там трех четырех версиях остальные тоже еще пользуются и нам тоже важность них получать все еще данные в том числе когда мы выясняем баги которые были в старых версиях мы можем обработку workaround этих багов добавить в новый код сервера telemetry на в этом случае нас получается очень такая многомерная структура то есть у нас есть данные которые были записаны вчера и к нему же доверие меньше надо понимать что они где ты мог быть с ошибками а есть данные которые записаны сегодня но часть из них записано софтом новым а часть этим записано с авто старого и поэтому некоторые данные мы уже не можем исправить а некоторые уже но некоторые приходят максимально хороший как мы можем их простых способов улучшить этом унарный просто нет вот но мы до старые данные практически не альтеры мы просто смиряемся с тем что там могут где-то грязные данные и при выборке приходится где-то подрезать дед нормализовать или ставить условия на адекватность данных важная штука следующее это было поменять начать менять практику девелоперов потому что по сути мы здесь подходим к тому что называется обзор водились мы не знаем когда наши клиенты поставят свой на наш наш софту свои сервера и мы не знаем на мне рассказывает о том что получится будет лучше будет хуже у них будет больше посещений они будут больше или короба зрителей меньше мы этого не знаем нам не рассказывают другого способа кроме как выйдет с телеметрии у нас нет это если нам ее дают поэтому точно также как девелоперов свое время приучили к тестам то есть мы сегодня наверное не так много компаний в которых вообще надо объяснять кому то зачем нужны нужны тесты хочет их надо писать что без тестов как бы код это не рабочие история но наверное страны ситуация но по крайней мере вы чуждой о муса птицы немыслимым писать код без тестов вот для нас такой же переход час это по дефолту чтобы у каждого разработчика было понимание что он не только тесто пишет а еще и телеметрию то есть он сам должен пойти и сделать так чтобы он знал как он увидит последствия своего кода в уже в клик хаосе и собственно он должен пойти добавить этого все места руками пощупать свой код проверить увидеть что данные реально прошли в клик house после чего происходит вся процедура мер же заливки апдейта и потом мы уже там через несколько дней можем видеть можем видеть что данные реально потекли в клик house и мы видим что появились новые поля новые by текке новые флажки это все сильно растягивать процесс сияя и если так у нас например полная сборка со всеми тестами их чудовищное количество занимает около получаса но чуть-чуть через пол часа 20 минут у тебя в принципе готовый рабочий сот которая уходит клиентам то теперь он с новые с новым этим вот звеном в виде сервер в виде серого телеметрии это усложняется бывает до недели это такой вызов который пока мы еще не решили вот поддержка по которым он собственно начинали для них тоже это непривычно все ну как девелоперам да им говорят есть бак вот смотри в бак нашли воспроизвели вам хорошо с производятся что делает drp дал девелопер сначала пишет регрессионный тест чтобы больше этого бага не встречалось то есть значит что тесты где-то табак пропустили наш первым делом мы добавляем новый тест который there's no им будет вечно ну да кого-то массивного рефакторинга и он будет и табак больше не допустят никогда на продакшн с поддержкой тоже потребовалось изменение работы людей прибегает клиент говорит нас все плохо теперь с началом мы заглядываем просто в графике следующий этап это уже начнем этот процесс сделать он сложно он реально сложно очень это этим проблема начать систематизировать и записывать их грубая делая слепки чтобы можно было постоянно в режиме 724 проходить по имеющимся клиентам находить них то же самое чтобы же не клиент к нам приходили а мы шли клиентам словами вот пожалуйста обновитесь и будет лучше вот и собственно вот это мы сейчас и делаем это показывать клиентам как у них как как как вообще мы вот помогаем этой штукой вот значит здесь есть поиск багов здесь есть поиск улучшений потому что например одна из возможности которые мы сделали мы смогли таким образом запихать дома и что мы людям помогаем предсказывать некоторых мужчин к и меня нет микро попробовали сколько им нужно ssd купить для своего сервиса то есть люди запускают сервис у них начать расти трафик они такие в панике черт скоро у меня харды больше не будут справляться мне нужны ssd cache и какого попать размера 100 гигабайт 200 терабайт всем и мы говорим вот те цифры вот тебе нужны 303 100 гигабайт каша иди купи ssd подходящие расслабишься и следующая вещь которая тоже уже относится к сердечным практикам мы хотим до конца этого года внедрить машинерии для sf апдейта клиенты них естественно есть многие из них админы админов обычная практика работает не трогай они не любят обновляться чуть не бояться обновляться особенно когда людям проведут два года не обновлялись естественно очень много чего поменялось естественно каждый раз чем дольше ты обновляешься тем болезненнее будут обзоры без авто и один из способов успокоить их это показать им по графикам что у них ничего не поменялось них например объем трафика но не просто берем трафика еще длительность сессии если просто посмотреть например в график трафика то ты не видишь там что у людей начали рваться сессии возможно player сейчас все буфере зуют у них там кинг пузыри плавают по кабану по буферизации трафик при этом большой может быть но просто у них обрыва связи обрыва обрыва сессии и это будет видно из другого графика графика длительности сессии или наоборот у них выросла даже качества и поэтому у них что-то произошло ну что-то лучше вот это вот то что мы как раз хотим сделать и факте по сути мы хотим у себя вот имея данные под руками имеет чудовищно объем данных сделать такой сергей от вендора вот ну примерно вот такой у меня история вопросы номер один вопрос номер два из интернета не стесняйтесь выходить к нам в эфир по кнопочке смотри нам приглушенный свет сделали это вот отлично уже жаль что не видно потолка на на трансляциях ну чтож силой своего воображения представьте что над нами метро-то лорак это где-то на девятом этаже и оттуда кран свисает и вот возможность нас поднять и так в кулуары до пород максим привет поднял много вопросов я наверное задам самые интересные до всех а если что там потом добью в кулуарах потому что тема больная я в лаборатории касперского работают но как правило вопрошающий не способен сам определить какие вопросы интересные но я попробовал deepsea я попробую вопрос первый вот наверное может мотать на слайд про будущее вот история про паковым сейчас повторяемые паттерны и как и понимают идея в том что мы хотим сохранить какое поведение является проблемным и по статье понять что она случилась у какого-то количества клиентов тимати лорд так совершенно верно значит 1 штука которой мы сейчас обкатываем она самая простая клиент прибежал и говорит у меня плохо самая простая вещь найти полку причем как я показывал на графике на самом начале можно просто сказать ну давайте посмотрим у кого из клиент там цикл больше унес пять процентов и в течение например в течение 3 минут это уже alert но может быть и так что у него откуда берется полк рыб есть и процентах луис из ес из-за гипертрейдинг и веселого учета на какой-нибудь там наконец увертюра виртуализации и найти вот такую полку это уже задача посложнее то есть нужно ну уже-уже нужно по-другому считать гораздо более сложной нагрузка дальше клиент приходится щелкать задачей нужно пойти еще раз найти найти все новые и новые новые паттерны которые повторяемые вот да я как раз хотел спросить то есть получается сейчас какой-то системой контролер то нет гиром для просмотра статы является обращение клиента и либо просто желание нейро поддержки что там и смотреть данных то есть что является причиной пойти статус смотреть сейчас значит главное вот на данный момент как искал мы сейчас находимся в середине этого процесса москва как момент сейчас пока что это обращение обращения к или клиентов да потому что на пока мы вот видим очень огромное разнообразие у клиентов их патронов в силу того что их очень их тысячи но некоторые вещи мы уже отслеживаем и например отслеживаем же просто банальный у м а к заканчивается память заканчивается цыпы вот то что мы сейчас уже сами отслеживаем или например возросшее количество рестартов а тем вот это просто ведем по скрипту скрип-скрип ты пока ходят в клик house и еще там все что похоже графики судя по всему на графа не да да grafana граф она обычная пока пока сне и и второй второй доклад которые могут сказать что нету плагинов огров анны для того чтобы over the потрахался кидать они не нужны нам мы мы мы от них еще не ждем у нас усложняем я понял да это я тоже помогу потом рассказать но не всем интересно будет и получается что у вас нету апдейтов которые вы рассказываете клиентам в темную они сами обновления инициируют ранее понимаю да этом я еще очень против этой истории потому что например одна мысль о том что нас взломают и спокойно клиентам зальют без нашего но без их ведомо что то она как бы пугает и меня и клиентов нет нас в принципе нет такого софта такого механизмы я против его потому что это ну вот слишком слишком велик риск те кто нас пускает да мы можем пойти им поставить обновление но как правило стоит происходит вместе с клиентом потому что в сопровождении такое же получается да да да и получается вот эта система про паттерна это вы тоже с нами быть разрабатывать а не какое-то коробочное решение это фактически развитие вот этих скриптов которые сейчас мертвым ум и по полкам процент например пока пока я себя вижу это именно так потому что здесь мы отталкиваемся прежде всего на самой важной миссии конечно это приклеиться к продуктовым метрикам то есть это длительности сессий там среднее медиана какая-нибудь там разное к к к к к к к разные квантили посмотреть вообще все не так просто а и там вообще не сели так просто там да можно дальше есть идею сравнить поведение с прошлой недели и потом чтобы брать за прошлую неделю брать ли медиану или маленькое выращен короче много всего интересует оно добавится the deed спасибо за доклад я понял что я буду менеджер рассказывать какая фича нам нужно ну это так киллер фича до обязать принципе мы с тобой можем умирать до этого года спасибо большое да у меня такой вопрос click mouse click хаос клик хаос он один и если он один как много в него льете как много хранить и чистить его молодец ли он так начата естественно мы просто не один сервер это несколько многих немного на 100 штук штук шесть справляется с нашими задачами проще чтобы она выключится и не сдохла издохла все вот поэтому мы проводим мучения то есть нас бывает что кто-нибудь из них выключаться там или не включится после ребута до всех этих этим справляемся стандартная история звуки пир стоит просто один раз стиснули зубы запустили его забыли как страшный сон повтор возвращаться не хочется вот и наш вопрос сразу наверно будет про the hare горячие и холодные данные на данный момент у нас острая задачи пока что откладывать горячие данный ssd нету now click хаус это делается по моему там просто из коробки то сюда кладешь горячий дымность flash холодные у него это достаточно быстро они сделали эту фичу она вполне понятно мы не стираем данные а насколько быстро клик house раздувается вот ну если вы аят нам дает пьете то есть насколько он быстро раздувается и раздувается ли он я давал цифры у нас примерно сейчас 300 миллионов в сутки это событие которое мы пишем то есть нет это записанных записанных строк их бы их приходится гораздо больше потому что мы их до записываем в сутки мы прирастаем на 300 миллионов строк это примерно 300 гигабайт трафика на ну так там плюс минус и примерно 20 гигабайт мы запаковываем это на диске то есть она это не ваши не ваши миллионы оно работает я понял спасибо большое нам мы в москве это сделаем когда я говорю клик house они кричат не тормозит я говорю клика us они кричат не тормозит теперь продается да клика а теперь продается да да вот у девушки был вопрос и да пожалуйста да спасибо большое за доклад очень интересное отдельное спасибо за историю успеха которыми по ходу поделились очень вдохновляющими вопрос такой вот ваши практике встречались или часто ли встречаются такие случаи когда либо клиенты не хотят делиться в принципе телеметрии из каких соображений безопасности или вроде того или они работают просто в закрытом контуре где это вот опять же там безопасники мы-то не дают делать и как вы вот с такими случаями поступаете конечно бывают у нас есть у нас есть даже в метро инсталляции нас есть на кораблях инсталляции где-то еще было и бывает таких местах вот поэтому добывают что безопасники у них какой-то мнения но они абсолют иметь свое мнение они прям если мнение не высказали то это значит день прожит зря если некому жизнь испортили то это все плохо мы просто клиенту говорим что в этом случае мы не можем оказывать вменяемую поддержку она будет ограничено они будут жить как могут как хотят и просим их развернуть в себя какие-нибудь диму стенды еще в открытую зоне интернета учитывая что nas-сервер серы которым чаще всего полюса для интернет-вещания то в общем то история жизнь его в закрытой инсталляции это совсем не то на что в принципе мы рассчитывать нас есть клиенты типа банков которые делают интернет-трансляции ну как правило в банках мы сталкиваемся с довольно компетентными от местах внедрен сами которые охотятся то есть стороны с которыми мы и так решаем проблемы там нет праге задачи прям перейти через человека который не хочет общаться которым линии вы он не хочет и у него нет желания когда эта инсталляция там на многие-многие большие деньги то чаще всего мы видим с той стороны предельно адекватных людей которые заинтересованы в решении проблемы там нет таких острых проблем но мы уже конечно там не видим продуктовые составляющую мы можем лишь догадываться как они пользуются бывают конечно и всякое разное вот ноты случае просто мы говорим клиенты что у вас там происходит мы не видим мы мы не знаем чем вы пользуетесь поэтому вы на нашей карте вот вас нету можем выпилить эту фичу которая для вас критически важно вы нам про него не рассказывать понятно спасибо и поливать сейчас спасибо за доклад у меня такой вопрос расскажите пожалуйста про эффект который вам удалось достичь с помощью этого подхода то есть там как это повлияло на red engine клиентов там на скорость обработки обращений еще может быть на что-то тут на деньги что вам удалось сэкономить деньги усы над 1 например нам сохрани нам это сохранило клиента который находится в топ-3 на планете в своем в твоем свои индустрии говорить про нее не буду это как пример мы это реально облегчает работу это реально улучшает значит ну наверное сетки пошути про цифры да значит здесь сложно померить потому что у нас наш ride and shane клиентов это если говорим про биту би там так чуть чуть не работает у тебя ты клиента сначала привлекаешь три месяца потом ты с ним начинаешь общаться и его разрыв с тобой тоже может занимать какое-то длительное время поэтому такого чтоб прям сильного потока мы его не везде и всегда можно можно про него говорить то есть бит убью на нам нам тяжело говорить про поток своих клиентов это чуть-чуть по-другому выглядят на другая механика поэтому мы можем говорить лишь про тамбура есть конкретные кейсы там сколько денег мы уже спасли просто мы спасли вот и мы можем мы можем видеть например что какие-то фичи например там на многие миллионы рублей разработки мы не стали делать потому что мы увидели что на это сейчас нет никакого потребления или например есть всякие разные конструкции при у нас есть века фича распознавания субтитров которые пришли со спутника нам не понятно да и развивать не надо ее развивать у нас один клиент просит что вы и улучшены ну потому что это вот им из мы не знаем нам для него одного сделать дешево там скажем за там за 500 тысяч рублей или нам пойти сразу размахнуться на полный скульптура работа это уже там миллионов например миллиона три и мы идем смотрим в цифры мы видим что вообще там очень мало клиентов у которых у которых есть индикатор наличие этих данных в потоках мы проходим по ним говорим вам это нужно если мы сделаем они говорят нет нам это не нужно мы выбрасываем и упёрлась все спасибо как бы провели провели к задев сэкономить до 100 рублей вот она примерно так работает жирную точку ставишь в этом зале не такой жирный а потом . давай поехали ok макс уже может быть я пропустил а как доставляете эти метрики а диктует телеметрию пропустил да мы готовим ее на нашем saw them после чего упаковываем в уже в новом вербу качестве vr протокол используемая sn1 это позволяет нам реально как бы дима уровень геморроя который у нас нас сняла он просто огромный то есть с ним все очень просто добавить еще одно поле общине думая просто как он там ляжет тут положил там приехала все просто и легко легко транспорт почти-почти себе потянул мы открываем соки ты по нему льем каждую секунду или как это какой-то потихонечку под сочи чем чтобы не было не было этих спайках ничего она просто потихонечку сочится и все кому дать им книжку за лучший вопрос я думаю что девушки вопрос придать and shine не самый болезненный языком чесать и все гораздо когда тебя за цифры спрашивают это уже неприятно это с ответом на 20 миллионов хорошо друзья сейчас спикер по доброй традиции идет в цифровые кулуары чтобы ответить на дополнительные ваши вопросы"
}