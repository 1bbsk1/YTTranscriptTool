{
  "video_id": "MwZs7EqswmA",
  "channel": "HighLoadChannel",
  "title": "From nothing to a video under 2 seconds / Mikhail Sychev (YouTube)",
  "views": 240,
  "duration": 2772,
  "published": "2017-04-10T03:25:44-07:00",
  "text": "здравствуйте всем а меня зовут михаил сычёв я работаю в компании google я старший разработчик в команде тестов версии сайта youtube расскажу сегодня о том как работает youtube сделаю небольшой inside о том что у нас внутри происходят я являюсь одним из участников команды которая работает над тем чтобы сделать youtube как можно быстрей как можно быстрее и собственно есть несколько вещей которые хотел бы рассказать но основные две позиции будут во первых inside того что мы делаем как youtube отличается от любых других сайтов и сервисов youtube является третьим по третьим по посещаемости сайтов в мире что накладывает определенную специфику на то как мы работаем впрочем как будет понятно мы не слишком отличаемся от любого другого сока нагруженного проекта по большому количеству вещей и вторая вещь о которой я буду рассказывать это набор определенных вещей которые можно использовать на любом проекте и которые не являются специфичными исключительно для нас и собственно любой пилот проект может взять это прямо сейчас воспользоваться этим более подробно мы будем говорить о различных типах загрузках страниц загрузки страниц мы имеем три класса которые мы определяем внутри нашего наши команды какие проблемы связаны с всевозможными методами загрузки как мы решаем эти проблемы какие инструменты мы используем для того чтобы эти проблемы решать но и всевозможные мелочи которые мы узнали которыми на котором мы научились пока мы занимались разработкой тестов версии стоят ветер основным топиком о котором я буду говорить это будет производительность естественным и та вещь о которой мы говорим очень-очень много мы знаем что есть прямая зависимость и зависимость между тем насколько быстро мы отдаем пользователям нашей странице насколько быстро пользователи получают готовые к использованию стр они ци и тем насколько много люди смотрят видео и исследование эти производились как над ютюбом так это от google поиском так и любыми так большим количество других компаний например амазона и мы знаем что если мы делаем наши стервецы специально медленнее пользователи начинают меньше искать меньше смотреть потому что они просто не дожидаются уходит на другие сайты или просто заканчиваю цельсию хочу выпить хотя бы 1 здесь в твери поэтому существует несколько исследований того насколько нужно быть быстрыми для того чтобы пользователям было интересно и того чтобы пользователям было удобно пользоваться сайтом и исследование эти первоначально были сделаны даже не для веба для нативных приложений и определили 33 числа это одна десятая секунды для операции которые требует мгновенного отклика одну секунду для операции который требует некое количество работы но продолжают пользователя держать заинтересована и 10 секунд это время после которого пользователи большинстве своём просто заканчивают пользоваться сервисом недавно эти исследования были обновлены для веба и собственно все три эти числа продолжают быть валидны me мы знаем что для нас одна секунда это является наиболее важным наиболее важной отметкой мы стараемся чтобы все страницы которые мы разрабатываем загружались быстрее одной секунды ну или за одну секунду а понятно что название моего доклада это как от ничего до проигрывающего видео загрузить страницу до 2 секунды что значит что мы немного не укладываемся в бюджет и это действительно правда и несмотря на то что мы достаточно долгое время работаем над этим 2 2 секунды это наш предел а в целом а по всему миру мы считаем что это не так плохо потому что в отличие от обыкновенных сайтов которые рендере только статику нам необходимо показать видео и но мы являемся video streaming сервиса что значит то что проиграть видео для нас самое важное это значит что нам нужно загрузить очень много дополнительных вещей таких например как видео плеер и видел плеер должен загрузить видео байты до того как начать проигрывать что там с другой стороны мы работаем в огромном количестве стран в некоторых странах интернет является ограничением мы просто не можем быстрее передавать байты и в странах где интернет быстрый например россии где интернет быстрее чем среднем по миру мы достигаем средней производительности порядка 16 секунды поэтому лучше все еще не секунда мы работаем над этим надеюсь рано или поздно до этого дойдем так вот самое важное проиграть видео поэтому так называемой watch пересели странице просмотра видео это наша центральная вещь и я думаю наверное любой человек здесь знает что такое youtube и видел главную страницу ютюба и видел страницу проигрывания видео youtube и всякий случай вот как она выглядит это так как ее видит обыкновенные пользователи это так как и видят разработчики youtube каждый блок здесь это отдельный модуль со своей истории часто со своей команды elie saab команды разработки со своей стратегии того как мы загружаем данные своей стратегии как marine dream их на клиенте и я расскажу о некоторых частях более подробно но для начала давайте поговорим о типах загрузки страниц мы распределяем все страницы на три разных групп и холодная загрузка теплая загрузка и горячая загрузка соответственно начнет холодной загрузки это очень распространенный вид навигации это например пользователь открыл браузер набрал youtube в адресной строке перешёл туда или пользователь нажал на ссылку на youtube на любом другом сервисе не ютюба это обыкновенные чтить и пили чтить и период или учтите 52 запрос но количество информации которая возможно запиши равана ограничен мы загружаем полную страницу мы получаем полный набор html супом который браузер должен от рендерить возможно что-то из-за dns resolving а уже произошло возможно нет мы не можем это контролировать скорее всего это брожение не загружены потому что пользователь пошел на какую-то другую страницу и увидел новый набор видео которое мы интересно возможные ресурсы за кашированные но мы тоже не имеем никакого контроля над этим это естественно очень неудобная для загрузки для этого еще не удобный тип загрузки для нас браузер нам помогает это здорово потому что для браузеров это наверное самый классический способ загрузки страницы мы знаем что большой большая часть интернета это именно холодная загрузка страниц поэтому браузер и многие годы были оптимизированы под эту ситуацию и например кром используют всевозможные техники при рендеринга и видео youtube.com в он не бокс и не нажимая enter может привести к тому что браузер в бэкграунде скачает все необходимые ресурсы озарен дарит страницу и дойдет ровно с этого места где видео может быть проигрывала и собственно когда пользователь нажмет enter это будет уже готовая страница которая загрузится максимально быстро единственное что нам нужно будет сделать это начать проигрывать видео проблема в том что на этом браузер больше ничего не может сделать он максимально помогает нам но есть ограничение которые доступны браузером хорошая новость заключается в том что мы можем сделать очень много всего плохая но вы заключается в том что это все нам необходимо делать и любой выигрыш производительности является результатом кропотливого труда и сводится это все к вполне стандартной проблеме как нам передать наименьшее количество данных как нам передать только то что необходимо а как нам при этом постараться не загрузить браузер который заткнется носите или рендеринг 3d и просто не сможет выполнять то что мы передаем браузеру достаточно эффективно но сначала как мы решаем это мы делаем большое количество классических вещей которые логичны и понятны мы используем ищите 2 или спиде там где это доступно мы используем click clack это протокол на базе чтить пе-2 и спиде который работает через gdp используется для доставки видеоконтента доступен только frame сожалению но хором делает значительно быстрее естественно мы делаем клип естественно мы пытаемся оптимизировать наше изображение компилируем javascript переводим наши иконки в спрайт имени фиксируемся с используем фиде она абсолютно стандартные вещи из немного нестандартных вещей во-первых вот и я буду говорить о его по чуть чуть подробнее дальше но очень кратко это другой stardust стандарт изображений поддерживается опять же из браузеров только хромом и оперы которые на том же движке работает сейчас но это бесплатная экономия paid абсолютно за минимальную стоимость css и это то что мы научились на своем горьком опыте css очень быстро может выйти из под контролем в проектах где код пишут десятки иногда сотни человек очень легко оказаться в ситуации когда css не используется куски сердца просто не используется и очень тяжело во-первых понять что не используется потому что чтобы значит они используется нужно знать все состояния приложения в котором tes может быть применено после этого это css необходимо отследить обратно к потому что естественно все стресс у нас минимизирована компилирования нужно откатить обратно до исходных файлов для того чтобы понять что вот чем мы делаем ее по какой причине это было добавлено поэтому совет который я могу дать на нашем опыте следить за css и не давать ему разрастись и не давать ему взорваться а еще одна интересная вещь это то как мы компилируем java-script я об этом поговорим чуть чуть подробнее счету и такая такой простор проект разрабатываемый google называется коллажи компьютер это компилятор я начала скрипт и набор библиотек которые позволяют лучше совместимый с браузерами и добавляют большое количество функционала библиотека это немного энтерпрайз ориентирована поэтому нравится она далеко не всем а компилятор на моем мое мнение что компилятор незаслуженно очень часто обходится стороной в целом что делает этот компилятор он добавляет поддержку типов и да сейчас у нас есть typescript когда был разработан и кожи никакой поддержки с той пингов javascript не была поддержка это добавляется путем использования dsd комментариев набор очень интересных оптимизацией и возможность минимизировать код и возможность удалять код который не используется проблема тяжело настраиваемый тяжело интегрируемые и к сожалению далеко не всегда так например библиотекам сторонним есть информация о типах или иногда она бывает просто сломанная поэтому мы находимся в ситуации когда нам иногда приходится просто чинить драги совместимости другие проекты но я очень рекомендую попробовать кожи потому что мы не представляем себе как мы бы жили без него и как минимум проблему сложные настройки можно немного обойти и для того чтобы попробовать что он делает можно воспользоваться онлайн сервисом и ссылкам документации вниз несколько очень хороших примеров которые как раз показывают а то насколько мощно кожи и насколько компилятор этот может улучшить чего screen чонкин а возвращаемся к нашему любимому еще типе поговорим немножко о том как мы используем ищите тебе протокол для того чтобы делать вещи немного нестандартная по крайней мере я не разу не видел вот этого функционала в свободных фреймворк ах потому что это требует несколько переработки логике ну как работает стандартная веб-страница мы получаем запрос мы парсим этот запрос мы выполняем некий набор рпц или мы выполняем запросы к базе данных после чего мы используем шаблон на язык для того чтобы сгенерировать нашу страницу отдаем в браузеру браузер и умные поэтому как только мы начинаем отдавать данные в browser браузер начинает пытаться страницу либо запостили база рендерить проблема в том что пока мы делаем наши erp эфире пока мы говорим с базой данных браузера делать абсолютно ничего он стоит ждет и ничего не делает что вы можно сделать да и ситуация в том что когда мы доходим до конца а вот в этом вот мире без чан king у нас получается такая проблема что нам необходимо внезапно за рендерить все за партию все и скачать все что получается мы натыкаемся в сети мы используем наш отряд который использует для рендеринга для того что выполни абсолютно все результате проблемой приложение у нас останавливается и нас просто никуда двигаться и нету свободного места чтобы как-то это оптимизировать что мы делаем соответственно как только мы получаем запрос от клиента мы выполняем очень маленький маленький шаблон этот шаблон содержит себе ссылку на статические ресурсы и ту информацию которую мы можем сгенерировал няя запросы к базе данных после чего этот набор это часть страницы несколько тегов отправляется сразу в клиент и после этого мы начинаем выполнять наши рпц или наши запросит база данных что мы получаем если мы отправляем в браузер а кусок html а достаточного размера браузер начинает его исполнять и тот факт что после этого мы замираем на несколько сот миллисекунд и ничего не делаем для баранов абсолютно нормально для браузер это выглядит как то что ну сервер просто думает во время выполнения какого-то запроса но статические ресурсы которые при этом содержится вот в этом вот куске html а они браузером загружаются поэтому к тому моменту как мы начинаем отправлять уже полностью стран дареной кусок html браузер может скачать даже нам надо иногда мы используем это для того чтобы отправить несколько чанков и и чанки могут содержать например данные которые сервированы в чей сын массив это джейсон массив разбирается уже после того как приложения закончила свою цивилизацию и подгружает некие дополнительные данные работает как с классическими приложениями которые полностью рендера цены бэг-энде так и с приложениями более современными и как пример приведу запущенный нами недавно стоит гейминг и чудакам это полимер приложение так line сайт приложением мы делаем очень похожую ситуацию мы отправляем 1 чанг который содержит ссылки на салют на все ресурсы которые необходимы для того чтобы создать это приложение после чего backend заблокирован ожиданием данных и когда мы заканчиваем получаете данные мы отправляем их обратно а приложение к этому моменту если нам повезло уже инициализирована если нет она специализируется в любом случае быстрее смотрит в этот честен массив его создает страницу если мы заинтересованы приложения быстрее чем у нас есть данные мы можем показать красивый индикатор загрузки или просто сгенерировать chrome приложение без данных проблема нам надо быть очень аккуратными с таймингом потому что получается две ситуации иногда данные приходят быстрее иногда приложение its easy руются быстрее поэтому нужно быть аккуратными чтобы случайно не проигнорировать один из этих двух случаев ok а теперь а плеере понятное дело что нам нужно что то чтобы проигрывать видео и если вы посмотрите на сетевой активность когда youtube загружается вы видите огромные 350 килобайт ный кусок чего скрипт который в тебе содержит плеер очень не маленький и это не просто так было бы очень здорово вы могли просто ставить видео ted и начать проигрывать видео к сожалению это не работает наш плеер поддерживается на огромном количестве платформ на мобильных телефонах на телевизорах на игровых приставках на естественно доступе поэтому немного кода и player содержит себе логику для работы рекламы логику для выбора не к ней необходимых видео форматов поэтому много всего и банально загрузить вот эти вот 350 килобайта достаточно серьезная проблема поэтому мы естественно не хотим это делать каждый раз но в ситуации холодной загрузка нас нет другого выбора нам необходимо каждый раз этот плеер инициализировать мы к сожалению просто нету никаких других вариантов мы не можем никак обмануть браузер что мы можем это оптимизировать наш player а работать над ним стараться сделать его меньше и стараться инициализировать плеер как можно быстрее потому что нам приоритетно показать видео и нас устраивает например ситуация в которой мы будем проигрывать видео когда страницу ещё не готова ты же не есть проблема если браузер пытается коммуницировать со страницей например если браузер пытается узнать какого размера потому что на нашей вотч бич браузер может быть большим браузер может быть маленьким это зависит от разрешения экрана это зависит от состояния так называемого режима театра проблема в том что если мы спрашиваем у браузера о том какого размера в данный момент player мы останавливаем весь рендеринг который происходит в данный момент доставляем браузер выполнить все буфере zero ван и и команды по изменению лейаута и вернуть нам размер foul тати страница просто останавливается это очень не здорово потому что это десятки миллисекунд потерянный light in se что мы делаем это мы немножко это такой чит на нашей стороне мы смотрим на размеры экрана потому что есть ряд метрик которые можно и ряд элементов на странице которые можно трогать не вызывая лт и мы смотрим на размер нашего в упор то и на основании этого внутри player решаем как о уже на самом деле размера player естественно работает не везде только там где мой конкретно контролируем страницу и может сделать что-то умное как например смотреть на размер player размер страницы а ну и закрыв тему player video playback это очень трудный вопрос у нас есть целая команда которая занимается исключительно тем как эффективно проигрывать видео но если дать какой-то совет то выбирайте битвы не надо пытаться поддерживать проигрывание видео абсолютно везде и всегда это очень тяжело и flash умирает ура лишним all 5 наконец-то становится почти становится эффективной заменой и мы стараемся потихоньку перейти нынешнем l5 ii свои технические проблемы но рано или поздно это случится опять там нэйлс или изображение превью-видео любимая моя тема о чп речь опять куча томилов важные лете там nail и естественно важны потому что пользователи выбирают что смотреть дальше управлял то что видео важнее томилов не страница watch любая другая страница заглавная страница youtube куча тониус а для пользователя из супер важно потому что название видео канал который загрузил это все очень важно конечно но пользователи выбирают что смотреть в первую очередь посмотрев на превью видео и естественном и поэтому показываем очень много превью этих видео и проблема в том что youtube это очень большой сайт очень популярным и мы не являемся сайтом по размещения изображений но если поставить нас в один ряд с другими сайтами про размещения изображений мы будем в топе возможно самыми большими просто из-за того сколько у нас видео сколько изображения мы генерируем и сколько мы их показываем и если посмотреть на страницу которую мы только загружаем зависимости от того посетил ли пользователь уже эту страницу и запиши ролл статические ресурсы или за открыл эту страницу в первый раз мы можем потратить на изображении от 50 до 90 процентов всех данных которые передаются чтобы делаем чтобы решить эту проблему мы загружаем только те изображения которые нужно загружать и чуть чуть больше потому что мы хотим избежать ситуации когда пользователи двигают в порт и просто скроле страницу или изменяет размер браузера и там ныл и внезапно начинают появляться поэтому мы загружаем чуть чуть больше есть проблемы связанные с замедленной загрузкой сожалению в браузерах нету инфицированного и удобного и пиа я для получения видимости объектов поэтому нам приходится импровизировать и писать хотел сначала скрипт который это выполняет а проблема в том что чтобы понять что загружать нам нужно выполнить javascript а это означает что мы забираем у браузеры контроль за загрузка изображений теряем определенные набор оптимизации который браузер может сделать и становимся в этом вопросе менее эффективными другой стороны у нас есть страница на которых есть набор изображений которые будут видны всегда мы знаем что первые несколько изображений за всегда находится в порт поэтому что можем сделать мы можем использовать некий гибридный подход когда первые несколько изображений это простые теги простое так изображение все дальше уже подгружается при помощи javascript а собственно тот тот как мы это делаем зеленая зона это то чтобы загружена всегда либо опять же через начало скрипта удар либо возможно через просто и мечты желтая зона это то что мы загрузим на всякий случай красная зона это то что мы не загрузим до тех пор пока пользователь не раскрой оттуда проблема в том что если взять и отключить это то это будет очень больно для интернета просто потому что мы очень много изображений передаем поэтому мы просто не можем отключить lazy loading теперь это вещь который мы будем пользоваться навсегда ok ok как я уже сказал в.п. это стандарт который был разработан в компании google keep как пензе прекрасные форматы им наверное уже больше двадцати лет за это время работа по поиску эффективных методик зачатия не останавливалось поэтому пленный момент google выпустила набор кодеков как для видео так и для изображений и вопит очень забавный формат очень интересный формат он поддерживает прозрачность он поддерживает анимацию он поддерживает как и сжать изображение с потерей качества так и без к от потери качества и ситуации с потери качества обещания то что он будет в среднем на 25 30 процентов меньше мы естественно не поверили этому несмотря на то что это формат разработаны в нашей компании и проверили это сначала она очень небольшом наборе наших изображений оказалось что все работает поэтому мы взяли несколько десятков миллионов наших томилов перекодировали их в.п. и наши результаты получились чуть чуть скромнее я не думаю что нам где-то удалось обогнать официальные метрики и наверное мы остановились где-то в районе 20 процентов но мы немного хотели повысить качество изображений в любом случае а качество разницы между папе j-pop при одинаковых настройках кодирования практически нет она практически незаметна есть проблема была бы все очень здорово и хорошо если вы переработал абсолютно везде цветы одевать и работает далеко не везде понятно что вы и работает в хроме и опере которая базируется на том же движке в храме и все а firefox не поддерживает в интернет эксплорер не поддерживает в есть час клипе блеать ecs но мы опять же из-за вопросов производительности стараемся не заниматься декодированием изображений в браузере но хорошая новость том что мы работаем не только в браузерах у нас есть огромное количество нативных клиентов и они все поддерживают либо напрямую выпили бы при помощи библиотека сторонних разработчиков и уберете которые мы разрабатываем поэтому в целом подавляющее большинство наших клиентов поддерживает в.п. для нас был в этот момент когда мы поняли что действительно выпей может использоваться огромным количеством клиентов больше не вопрос поэтому если вы откроете сейчас youtube своя кроме не все изображения на большое их количество будет отдано именно в.п. так что опять же метрики могут быть разные у нас средняя средний экономия по размеру это 20 процентов средний экономию в результате загрузки полной странице порядка десяти процентов потому что наши страницы обычно требует приблизительно столько же данных сколько изображения на 50 процентов а еще чуть-чуть а за медленной загрузки опять же возвращаемся к watch все что находится на ваш плечи отмечена красным не будет на вотч бич когда мы в первый раз на нее загрузим комментарии не находятся на странице модуль загрузки модуля шаринга не является частью странице гайд эта вещь которая находится слева и позволяет перемещаться между каналами тоже не является частью странице мы стараемся отодвинуть загрузку того что пользователь не увидят мгновенно как можно дальше и дать как можно больше свободного пространства плееру который будет в это время загружаться и понятно что у нас есть меньше дом not у нас есть меньше чем скрипт исчез с который выполняется поэтому мы экономим на это время проблемы опять же для части из этих модулей мы должны знать когда они видны на странице когда они нет и когда мы начали заниматься загрузкой удаленные мы поняли что у нас есть проблема мы делаем много всего на странице и не всегда понятно что мы хотим приоритизировать понятное дело что мы хотим приоритизировать видео проигрывания но не всегда понятно как это делать поэтому в нас команде был разработан фреймворк приоритизации он позволяет нам управлять задачами внутри страницы решать что нам важно что нам важно больше что важно меньше но у нас очень большой кот bass поэтому сначала мы попытались сделать чит и обернуть наши функции с это intervals and time out внутри нашего фреймворка в результате чего мы получили абсолютную жуткие проблемы с race conditions и тем что мы больше не можем предположить как у нас работают наши скрипты поэтому в результате нам пришлось закончить тем что мы используем полноценный интерфейс к нашему менеджеру приоритетов и говори маму точно что мы хотим и в какой последовательности теплая загрузка с одной странице идем на другую можем использовать инструктировать браузер о том что есть некие техники при браузинга и заставлять его и сделать не дает нам большой производительность небольшого прироста все равно у нас плеер который нужно инициализировать каждую страницу можем ли мы сделать что-то лучше естественно всегда есть вариант того что мы можем сделать кланяться и приложения не очень работает в нашей ситуации потому что у нас очень много кода у нас огромное количество кода поэтому мы не можем просто взять и переписать все за один день поэтому нужны другие способы более того браузер и очень хорошо умеет рендерить html поэтому когда мы убираем это от браузеров мы попадаем на целый набор проблем в производительности о которых мы даже не думали что мы сделали f пффф это open-source фреймворк доступен на гитхабе доступен на google cdn можно взять его в любой момент и собственно я думаю все видели красную полоску которая прибегает сверху ютюба когда происходит переход с одной страницы на другую это как раз и space space делать достаточно много он управляется состоянием приложения управляет history api позволяет делать костанае кеширование но центральная задача этого фреймворка это позволить используя те же шаблоны и те тот же стек на бэг-энде которые закрою рендере части страниц делать рычаг с навигацией путем помещения этих кусочков чей сон который отдается в браузер и собственно браузер обновляет только части страниц используя этот чай сон в результате нам не пришлось переписывать на hb contain content мы используем все то же самое мы все еще используем чанки потому что джейсон объекты тоже могут разбиваться на куски мы и это очень важно мы можем поддерживать наличие одного и того же плеера который был принят ализе rowan только один раз а при перемещении между страницами мы делаем значительно меньше изменений дома и мы можем поскольку мы знаем больше о нашем приложении чем браузер использовать хитрые техники кэширования собственно это стандартное изображение которое мы показываем а чтобы начать проигрывание проигрывания вам нужно получить информацию о видео проинициализировать player загрузить видео байта когда у нас есть успев мы уменьшаем как минимум вот этого часть которая отвечает за при детализации браузера собственно это сожалению не могу показать реальные цифры поэтому придется поверить на слово это то как выглядит изменение нашей light если после того как мы включили спев на сайте и этот производительность или скорость до и время до начала playback а это где то год назад у нас достаточно много было еще flash проигрывание к этому моменту это речь на между html5 и flash и собственно то как мы включали спс начала вы включили только красную полоску и пользователи сказали похоже сайт загружается быстрее потому что полоска красная все знают что красно это значит быстро включили спев только на навигации с watch прыщ на watch поищи только в хроме во всех браузерах подключили changing только через сочтите пи включили на вещи что мол в 5 проигрывания в котором нету рекламы включили для всех страниц включили для рекламы тоже и включили и чан ким для спили что получили на 40 процентов быстрее начала проигрываться видео на 13 процентов меньше запросов к серверу за счет того что мы можем использовать кастомные режим кэширования горячая загрузка замечательно мы сделали исходные первоначальные холодные загрузки быстрыми мы сделали теплые переходы быстрыми можем ли мы сделать что-то лучше можем но сложно и мы переходим по очень экспериментальное среду где мы еще не знаем полностью что и как мы должны и будем делать в будущем но это наш путь к тому чтобы быть быстрее чем одна секунда собственно что мы попробовали что мы используем в той или иной мере можно ли использовать какие-то сигналы например тот факт что пользователи навел курсор на видео для того чтобы начать загружать страницу с этим видео или даже видео байты какие проблемы с этим ну во-первых мы получаем дополнительный запрос и далеко не всегда ясно начнет ли пользователь на это видео в результате чего все наши метрики в совершенно взрываются и мы не понимаем что происходит поэтому нам нужно переделать весь надежде весь наш pipeline по подсчету того например сколько пользователи переходят на другие страницы больше запросов потому что далеко не всегда пользователи нажимают на то что они навели поэтому мы получаем запросы которые тут никуда мы выполняем их как любые другие запросы на не не приводят ни чему поэтому это то что мы пытаемся еще делать работает с переменным успехом мы попробовали несколько вещей из сумасшедших вещей мы попробовали начинать кэшировать видео например когда пользователь нажимает на видео но если навигация в браузерах переход происходит по событию mouseup которая в череде событий является самым последним то мы начинаем кэширование например по маус когда пользователь только нажал получаем бесплатный 100 миллисекунд в которой мы можем выполнить какой-то код но и чуть-чуть об инструментарии которые мы используем во первых мы никогда не делаем изменения несмотря на метрики я знаю что часто люди думают что в ютюбе просто любят менять вещи просто потому что мы любим менять вещи это не совсем так мы смотрим всегда на метрики и у нас есть две категории метры это метрики производительности и это наш и метрики наших пользователей потому что есть много вещей которые можно ускорить можно замедлить можно загрузить позже большую часть данных на странице далеко не всегда пользователи реагируют на это положительно люди начинают меньше нажимать на видео люди начинают меньше смотреть видео поэтому любые наши изменения проходят два этапа проверки сделали они быстрее сделали ли они жизнь пользователям лучше обычно быстрее значит и пользователи более довольны далеко не всегда поэтому что мы делаем мы контролируем помимо того как метрики меняется когда мы хотим их изменить напрямую это как метрики меняется по каким-то странным причинам о которых мы не знаем поэтому мы периодически контролируем наш живой сайт мы проверяем как он работает и понятное дело что у нас изменение о которых мы знаем например мы очень любим делать анимированное видеоблога что означает что мы загружаем значительно больше изображений на странице бывают изменения которые мы не ждали например мы добавили некий набор съезд с о котором мы просто не знали и мы зависим от этого набора фея с но внезапно наши отец с бинарные файлы стали значительно больше поэтому мы контролируем все эти параметры и мы на самом деле собираем огромное количество данных которые помогают нам мы собираем информацию о различных моментах инициализации браузера о том какая производительность наших брендов какие важные события происходят более того все браузеры работают по разному поэтому у нас есть возможность получать среза этих данных по браузеру по версии браузера потому например было ли загружен эта страница в бэкграунде была она открыта на самом деле а пользователям который смотрит на эту страницу прекрасный инструмент для этого в естественно мы используем большое количество инструментария который мы разработали исключительно внутри нашей команды но вот тест абсолютно прекрасный инструмент которые позволяют получить очень хорошее объяснение того что происходит на странице какие ресурсы загружаются какие у них приоритеты и вообще а какой и жизненный цикл страницы и говоря о наших инструментах тоже интересный скриншот моего раньше никогда не показывали это а пример письма которая получает у нас есть ротация людей которые контролирует то как работает youtube это пример письма в котором все стало лучше что обычно хорошо если я не ошибаюсь это производительность на получение конфиг проигрывания видео что здесь важно мы знаем что вещи стали лучше но когда вещи становятся хуже мы знаем когда они произошли и между какими изменениями которые мы соответственно согните ли произошло что-то поэтому это значительно упрощает поиск виноватых ну или тех кто наоборот сделал что-то лучше ok подведем итог того я надеюсь это та информация которая будет действительно полезно одна секунда страница должна либо загрузится быстрее одной секунды либо как как минимум показать пользователю что то что позволит пользователю понять что происходит при этом страница может быть загружено разными способами стоит эти способы понимать стоит об этих способов знать ее по-разному к ним относиться в.п. как минимум супер полезен для спрайтов даже всего поддерживает только chrome в бри леностью глазах будет полезен и для других браузеров единственное что большая проблема если ваши пользователи любят сохранять картинки например это фото вопи не самый лучший формат потому что пользователи начинают спрашивать а почему у них не открывается файловых любимом просмотрщике потому что это выпи далеко не везде поддерживается кожи супер вещь вот попробуйте посмотрите от такого качества компилятора для java script я не думаю что я существует где-то еще ну и пытайтесь инициализировать вещи только один раз понимаете как работает браузер успев это pappleworth фреймворк который может значительно помочь в определенных ситуациях ускорить производительность вашего сайта changing требует определенной работы далеко не всегда может быть легко интегрирован но приводит к очень хорошим результатом ну и смотрите на то что происходит с вашим сайтом в процессе работы и биты и стинг прекрасные вещи на всякий случай я говорю бит с тем чтобы было понятно мы берем маленький процент наших пользователей и даем вам другой сайт чуть-чуть другой сайт и сравниваем 3-бет с ним очень вкратце ну и стоит делать профайлинг всего что только можно это и очень важно у нас есть 5 минут на вопроса поднимайте руки сразу боюсь на всех не хватит но спасибо за доклад у меня вопрос человека который находится немного посередине не разработчик и не представителя youtube оператор связи весь год назад возникла такая боль у людей перестал перестали грузится ролики и причина в принципе простая у вас есть такой проект google google кэш запросы кидала на кэш который работал некорректно то есть грузии 2 3 секунды видео и перестает соответственно конечные пользователи начинают обращаться к нам она обратится никому потому что у google каша нет интерфейсов нет интерфейса взаимодействия нашел кучу контактов по написал писем побаловался с бюджет и проблема частично стиль частично уладилось но где-то через неделю пришел ответ с одного из емейлов ну как сейчас то вроде все работает как как вы взаимодействуют со своими коллегами в google и которые работают сторонними проектами ну то есть google кэше он же cached youtube ярость это влияет мое знание конкретно этой части стека достаточно ограничено обычно обычно то что известно мне когда google кэш работает он обычно имеет люди которые занимаются имеют контакты непосредственно с провайдерами которые обращаются к этому узлу кэширования если это вне так это наш прокол это не очень печально что произошло как найти контакты найти кого-то из google я знаю это не очень хороший ответ можно можно мне сказать вот я постараюсь найти правильных людей или по-крайней мере спросить почему у вас нету контактов этих правильных людей один из вариантов тоже который странный но существует реддит посвященный youtube и поддержки youtube в котором мы разбираемся с проблемами playback проигрывание видео и скорость реакции там очень большая я понимаю это странный идти на реддит чтобы узнать почему не работает провайдер но этот тренд будет работать точно у нас есть люди которые конкретно это мониторят наверное лучший ответ который я могу дать на этот вопрос спасибо михаил спасибо за доклад ну вопроса 2 первый вопрос это когда flash все-таки умрет окончательно и какой процент сейчас вас вообще отдается через flash и какой формат и вы отдаете во flash вот и второй вопрос пробовали выпер toupper через в партесь ее как это всегда показал у вас не могу к сожалению сказать конкретные цифры по поводу flash и потому что не уверен что я могу этих цифрах говорить мало html доминировать слеш и я надеюсь что рано или поздно его убьет есть несколько ситуаций например life проигрывание где далеко не все браузеры научились html5 на достаточно мур не чтобы проигрывать поэтому в ближайшее время не ждите точно никуда к сожалению не от нас зависит мы очень хотели убить flash но это очень длительная и серьезная проблема можно что мы еще на многих года с ним останемся в каком-то формате по поводу форматов проигрывания тоже к сожалению не скажу этим занимается команда проигрывания видео и это огромная команда которая абсолютно отдельно от нас так что да вы flash еще не уходит спасибо вам большое за отличный доклад у меня короткий вопрос вы рассказывали про player но и java скриптовый которые весят 300 чем-то килобайт этого говорили про версию вас плеер сам модульный то есть для браузера выгрести одну версию для мобильного клиента другую и между для теста браузера или он у вас вот один имболк java script плеер в 300 килобайт на все платформы поселок если очень упрощать да это один большой бинарник который отдается разным клиентам мы очень хотели иметь разные модули к сожалению есть большой набор технических проблем которые далеко не всегда зависит от нас который не позволяет нам разделять плеер на меньшие части мы над этим работаем я надеюсь что рано или поздно можем это улучшить потому что естественно 350 килобайт это очень нездорова и нам приходится использовать все эти стратегии mitigation этого путем того что мы загружаем player например только один раз пока к сожалению до 11 монолитный бинарник давайте последний вопрос у кого честно графа и у меня такой вопрос почему youtube разрешен повести т.п. это первая часть вторая часть почему те email и которые приходят о том что кто то что то скажем откомментировал они тоже если ты переходишь по ссылке если хочешь ответить то страниц перезагружается простого когда ткнул в развернуть комментарии или ткнула лайк-дизлайк а так далее зачем это сделано отвечу на второй вопрос начала комментарии это длинная и болезненая проблема все наверное помнят google plus и интеграцию в углу плюсом то что я могу сказать на то что разрешено мне сказать все будет лучше обещаю значительно спасибо мы знаем насколько это больно так что мы очень стараемся очень-очень прямо вот вот очень сильные прямо сейчас первый вопрос правильно ли я понял что почему youtube работает почти теперь почему бы вообще не заблокировать скажем нажимаем нельзя затем на поиск нельзя зайти а вот на youtube можно почему так я специально проинструктирован не отвечать на этот вопрос к сожалению чтобы спецслужбы могли контролирует из проблем что я смотрю как я не могу ответить очень хотел бы вам ответить на этот вопрос на не могу спасибо"
}