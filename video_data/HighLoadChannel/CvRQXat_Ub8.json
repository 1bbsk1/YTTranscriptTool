{
  "video_id": "CvRQXat_Ub8",
  "channel": "HighLoadChannel",
  "title": "Разработка приложений, устойчивых к кратковременным отказам / Георгий Полевой (Dodo Pizza)",
  "views": 1550,
  "duration": 2916,
  "published": "2021-10-04T02:42:06-07:00",
  "text": "привет вы слышали меня зовут георгий полевой я и сергей инженер в компании да да инжиниринг мы строим и запускаем в производство систему на который строится бизнес да да пиццы по всему миру это самая большая сеть пиццерий в россии и около 13 стран сейчас мы поговорим о сбоях в наших системах последнее время их стало меньше гораздом за последние два года с пейджером стало совершенно спокойно находиться то есть когда происходит какой-то alert нашу систему сами восстанавливается в 90 процентах случаев но было время когда происходили ужасающие отказы системы когда никто не мог понять что происходит сначала у пользователей происходит какое-то замедление потом через некоторое время инженера на графиках видит что увеличилось в этом си потом краситься базы данных и начинает крошиться сервера один за другим чем сам ужасное что они не могут стартовать потому что они тут же ходят в крошку вот при этом мы знаем что у нас нету какого-то бага в коде которые отвечают за эту проблему было бы проще мы бы откатили релиз такое сделали но этого бага нет и это проблема всей системы в целом вот у нас есть сервер на нем есть какая-то нагрузкам мы считаем что ну там процентов 40 50 от того что серый вообще может выдержать в какой-то момент нагрузка начинают расти например мы запустили рекламную кампанию пришли новые пользователи для нас это очень хорошо вот но потом происходит вот такое мы превысили эту нагрузку например мы могли не рассчитать не согласовать что-то отдела маркетинга и они запустили слишком большой рекламы компания или это dos атака и очевидно что за сто процентов от графика не выйдет но дальше происходит вот такое и мы хотели бы чтобы если к нам пришло больше пользователей или нагрузку систему извне подано больше что у нас осталась хотя бы те 100 которое на котором и за ложились мы купили мощности в облаке там как-то рассчитали что хватит от лот тестировали что такую нагрузку держит но происходит падение причем ну то есть до такого уровня когда мы считаем что это полная откажется система чем дальше видно что вроде бы системы счетам трепыхается вроде бы график пошел немножко вверх на самом деле всего лишь день тех запросов которые пришли уже давно и вот тут вот вопрос такой сдает вообще в принципе сервер должен умирать под нагрузкой ну как бы если подумайте с человеком если там мы попросим человека сделать больше работы чем он может в принципе он не умрет он сделает максимум что он может разделит там откажется но почему сервер должен умирать и вот на самом деле не такой риторический вопрос потому что наша тема как раз вникнуть в то что происходит внутри серверы понять как его защитить я надеюсь что сегодня вы уйдете с неким инструментарием которые на теоретическом уровне позволит понимать такие проблемы внутри серверов на этом графике я прошу посмотреть на синюю линию оно означает те запросы которые су не поступили систему то есть эта нагрузка зеленый график означает фактически выполненный запрос обслужено и успешно и мы видим что здесь не совпадение очень слабая то есть вначале еще более менее там где-то в самом начале график а вот потом как и у нас есть некая черта критическое больше который сервер просто не потеря мы видим что после пика нагрузки у нас произошла такая ситуация фактически выполненные запросы сильно стали отставать от нагрузки вот здесь вот есть такая тень на графике то есть это тайм-аут и но и точнее это еще не тайм-аут и это просто задержка то есть вопросы стали выполняться дольше потому что им всем как бы интуитивно понятным тесно внутри серверы да мы пока не понимаем почему вот ну а потом нагрузка спала и вроде бы ситуация стала выравниваться но происходит второй пик и после него по как бы происходит то что мы рисовали полный отказ но на второй части графика видно подробно то есть вот некой вроде бы график уже ползёт вверх это на самом деле иллюзия потому что это те запросы которые влог записали отчитались о том что не выполнились но просто это уже очень поздно было вот и дальше желтый график показывает полный отказ система вот такой примерно такое у нас происходило это был это был чемпионат мира по футболу вот и откуда такая нагрузка с такими пиками то есть утром они покупают пиццу да там пользователи закупаются перед первым time потом по меньше нагрузка на 100 нормализировать стал обычный слышен в середине дня у них первый тайм прошел у них нервы да они хотят больше пиццы этот самый большой пиксель дня ну и под вечер уже пенальти то вот и третий пик добивает систему одна из компонентов выходит из строя и примерно два часа неё не обслуживают клиентов нам очень важно что проанализирует что происходило формула little а в теория очередей есть такая терминологии количество клиентов внутри системы на самом деле но это не такие бюджетные живые клиенты это может быть вообще запросы 1 серверах другому внутри облачных инфраструктур где много микро сервисов royal ray то есть это как скорость поступления клиентов внутрь системы и время которое они проводят внутри и вот таким соотношением она регулируется но все это происходит если у нас система статическая то есть оговорка для этой формулой а система статической у нас arrival рейд не меняется и время который каждый вопрос выполнять не меняется тогда количество тех запросов которые в данный момент выполняется будут постоянным эта ситуация практически никогда не происходит в живом серые которая обслуживает клиентов потому что нам нужно дифференцировать интегрировать части этого уравнения мы сейчас заниматься не будем достаточно понять что это вот такой интеграл интеграл от количества поступающих минус количество убывающих систем то есть запрос который выполнились мы считаем что они вышли вот и тут такой вопрос почему конкурсе вот это новый термин да это количество пользователей внутри системы почему can караси выросла неконтролируемо и мы видим на этом графике вот где-то посередине посмотрите такая куча есть она очень высокая да то есть и она однозначно коррелируется падением сервера вопрос почему она так выросла у нас вроде такого ничего не происходило на точно по графику нагрузки выполнены запросов видим что ну да они какие-то низкие вначале она была не высокая а потом она стала расти и вот если мы на вот эту часть графика посмотрим то вспомним что такое интеграл константы у нас can караси равно такому интегралу интеграла вот такое вот выражение где у нас количество поступающих примерно константа вот а количество убывающих у нас примерно равно нулю и интеграл константы у нас дает прямую линию идущую вверх что означает эта прямая линия означает что сервер самостоятельно не выкарабкается уже никогда из такой ситуации ему нужно чтобы скорость выполнения запросов совпало со скоростью поступления чтобы хотя бы держаться на том же уровне это происходит когда он выходит на плато вот но это уже слишком поздно это уже под вечер cred ca нагрузка спала вот соответственно мы понимаем что конкурсе на графике вот такая вот гора это равносильно смерти сервера и мы будем всячески бороться с тем чтобы в нашем серве было излишняя карась вообще почему мы с ней будем бороться это уже полезная такая модель то есть у нас в принципе есть много моделей конкорд в программировании есть мол титры давая модель эта модель которая нам позволяет делать вид что мы имеем дело со многими вещами одновременно эти термины термин часто путают с параллелизмом вот есть статья робу пайка на эту тему которое очень рекомендую он объясняет подробно что это такое но и объяснишь так вот я когда сюда ехал в пробке can can see the примерно количество машин который стоял на светофоре в пробке вот а параллелизм был равен двум это количество рядов полос дорожного движения по которым автомобили едут в компьютерах это равно количеству процессоров и вообще говоря нам не очень интересно даже степень параллелизма за которой выполняется запрос нам интересно степень конкуренции и малаги почему-то путают они думают что если больше тредов например создать так как то как то вот запросы быстрее или там параллельные выполнится на самом деле конкор ность накапливается и это убивает систему как бы в мире есть много примеров как он караси накапливаться люди борятся с этим например ни один бизнес не хочешь чтобы у неё на складе было много всего конкурсе это можно сравнить например в гидроэлектростанции от количества воды до затопили целую долину между гор вот это степень con carne который требуется у этой системе и это конечно же не очень хорошо мы сыграем в игру чтобы вот как бы интеграл был наверно трудно понять мы попробуем представить игру fire scheduling когда у нас запросы стараются выполнить за одновременно то есть они конкурируют за какие-то ресурсы и мы пытаемся честно раздать им эти ресурсы чтобы они будешь но это обычный молоке трейдинг вот у нас на каждый request good work lot work lot 3 и пролил 2 то есть как бы что-то вроде двух процессоров и посмотрим вот пришел первый request и некий условный такт произошел было нагрузка 3 соответственно выполнился один такт у нас осталось нагрузка 2 следующем такте у нас произойдет что пришел второй запрос 1 продолжает выполняться они делят 2 процессоры на двоих все хорошо числа целые а вот в третьем такте у нас происходит из-за фариш один раз происходит что каждый из них выполнился ни на один она две трети только и один вопрос уже застрял то есть вот мы видим он 4 такта он только сейчас выполнился дальше второй запрос уже выполнится больше чем с 4 такта и мы видим что эта картина запросы наслаиваются con carne все растет мы видим что степень конкор раз уже больше двух вот и response time вырос у нас вдвое соответственно по формуле little а все правильно и к сожалению вот такая система уже самостоятельно не справится с нагрузкой никогда то есть как бы сколько бы запрос не поступало они все будут все медленнее и медленнее отдаваться и у нас ну что это может быть физическом там сервере это может быть оперативной памяти внутри сервера запрос он отнимает эти ресурсы то есть такая игра проиграна мы попробуем прибегнуть к такому паттерну это очень важный паттерн теории массового обслуживания night club banger на самом деле паттерн вышибала и редко кто называет его называют букет обычную переборка ну ладно что делает уж он следить за тем что в ночном клубе было весело весело там когда там находится определенное количество людей не больше не меньше то есть если их там меньше то не весело клубу вот а если их там больше то не весело самим людям ну вот те кто стоит в очереди они смотрят если уже в очереди стоит определенное количество людей те кто вновь пришли думают стать в очередь тюрьме вот и сыграем во вторую игру он примерно как это будет работать то есть мы поставили конкор нас лимит длину очереди 2 сделали конкор нас ли мин 2 и такой же вор клод вот у нас идет и товар клод и уже в третьем кадре мы видим ситуация изменилась запрос который вновь пришел не начал выполняться он уже стоит в очереди у него троечка там вот первые два запроса выполнились за предусмотрено для них время то есть ну потому что они делили поровну на себя ресурс количество этого ресурса равно количеству максимальному количеству запросов который может выполняться ну и дальше у нас накопилось в очереди уже два запроса вот они оба ждут а первые два выполняются но они уже видим что выполнится дольше потому что у них есть история они чуть-чуть по стояли в очереди дальше происходит вот такая вот история как бы конкор носи вроде бы вы возросла но на самом деле это не влияет на скорость как она работает сервер потому что это внешняя конкорде как как нашу систему видят снаружи-то вроде бы зашли на самом деле они в очередь стали вот и видим что пришел так тот кто не может уже стоять в очереди потому что мы ограничили очередь двойкой все он ушел домой и это продолжается или кто приходит уходит домой такая система будет жить вечно ну в теории по крайней мере вот здесь выглядит все хорошо буклет можно сделать из обычного семафоры собственно так он и делается и в библиотеке полип тонгкат гораздо сложнее потому что там есть еще очередь но суть в том что нужно просто войти в семафор вот на самом деле какой такой псевдокод то есть мы заберем policy за сдаем 100 на 100 то есть что внутри 100 снаружи и дальше любой запрос мы пропускаем через букет игреки таких букетов может быть частей много можно поставить один общий на вход но лучше ставить на какие-то отдельные компоненты в зависимости от того на примерно какой url приходит сервер запросы чтобы для них отдельно рассчитывать вот эти от величины вот но на самом деле код чуточку посложнее да вот внутри и снаружи вот так вот это выглядит вот на эти вот и мы получаем соответственно эксепшен что запрос совсем не выполнилось посмотрим как это наношу систем повлияет помним да вот это вот горка огромная мы и хотим просто срезать вот и мы этот паттерн он позволяет напрямую прям влияние вот прям вот запретить все этого не будет но тут вопрос такой сколько у нас реально от бракуется сколько будет таких клиентов которые пошли домой условно и вот видим что получилось секундочку взгляну да вот эти вот я мы в обслуживанию они исчезли сервер по шиг по сто процентов которые для него рассчитаны по крайней мере то за что мы платили мы на все деньги выполним подъездные работы вот ясно что когда у нас есть чрезмерно пики нагрузки но это можно решить масштабированием там эластичному еще каким-то другими вещами но сам по себе а как есть сервер выдержит вот такую нагрузку то что желтая это там тайм-аута и невыполненные запросы понятно с этим тоже как-то хочет побороться попробуем увеличить длину очереди и видим чуть-чуть вроде улучшаются системы то есть первый пик мы даже почти разгребли а здесь вообще шикарно да или нет вот мне здесь не нравится вот эта вот вещь у нас в конце графика мы видим что вот по формуле little а нас получается что складывается степень конкор нас с длинной очереди у нас в 11 раз увеличится время процессинга если будет чрезмерной нагрузки собственно что мы наблюдаем у нас в конце вот эти вот все вот эти оба пика они размазались на весь день и система идет с отставанием очень медленно выполняю запрос поэтому мы обратно все вернем сделаем вот так примерно даже можно длину очередь сделать меньше она нужна только лишь для того чтобы заполнять ночной клуб когда вот только только один вышел мы сразу туда нового пускаем человека в принципе можно длину очереди ставить там близко к нулю то есть ну вот такой вариант нам уже более-менее нравится на этой диаграмме изображен приблизительно приблизительно изображена схема работа с red bull а оказывается что сейчас как бы модно делать асинхронную все до пришли мы делаем айсинг тоски в разных видах в разных системах они присутствуют мы не используем стараемся не использовать молотый трейдинг вот и снижать количество трудов но если у нас был автоматический triple в приложении он выполнял роль булки да и и некоторое время он мог защищает систему от таких сбоев что мы здесь видим предположим у вас есть connection pool который справа величиной 20 то есть 20 соединений к базе данных этот пул примерно 20 там thread'ов условно и вот пришел пил пик нагрузки было 20 а стало 200 вдруг мгновенно они стали в очередь на три пули этот пул эту очередь потихоньку раз гриппа и все и количество трудов не успела вырасти он выполнял роль бук правда очень плохо потому что он там стоит машина леоненко алгоритм который увеличивает количество трудов и это все неуправляема но тем не менее такая защита у нас было когда мы несколько лет назад переписали все на осинке это защита просто исчезла никто не подумал о том что то есть кто-то по дому на самом деле все кто переписку осинки потом запускает в продакшене видя что они прокачали свой сервер он теперь держит сколько угодно соединение прекрасно вот но как только мы повышаем масштаб чего-то повышаем свою собственную мощность вы должны думать о том первые правила проектирования больших системы это то что есть ты большой не раздави маленького вот сервер ни один у него есть база данных есть масса ограниченных ресурсов которыми приходится иметь дело ну собственно вот на этой диаграмме мы видим что степень конкор расти в случае асинхронных task-ов это бесконечность и нам уже нужно совершенно другой connection pool еще один примитив отказоустойчивости это 3d который трой часто бываешь нам очень хочется что-то попробовать снова ну не получилось нам exception давай еще раз очень хорошо работает если у вас например что-то происходящее редко чем мы не хотим избегать например детлок белок это тот редкий случай который можно ли тратить ретро ить то что произошло из-за отказа под нагрузкой лучше не или троить потому что и все же если мы начали ретро вид нужно думать о том что мы увеличиваем степень как аракси сервисе на которую мы подаем нагрузку если мы ретро им через равные интервалы мне вот здесь первые строчки не нравится потому что но предположим у нас recovery интервал то есть время за который затем восстановилась очень длинный и он нам нужен такой но за это время происходит так много маленьких запросов ну то есть много запросов через короткие интервалы их очень много мне нравится поэтому я увеличиваю этот интервал и мне теперь не нравится минимальный response time минимальный response time желательно сделать быстро но вдруг это был совсем кратковременный сбой и есть шанс получить ответ быстро соответственно вот это мне не нравится вот это мне нравится и на самом деле мне нравится у от м соответственно применяют экспоненциальной специальную формулу для расчета времени через которые вы тратите и в нем это на самом деле сумма степеней двойки и вот через эту формулу можно рассчитывать общее время которое мы можем ли тратить в принципе из количества ретро if i также можем высчитать длину 1 retro я ну и получается все довольно хорошо то есть мы обе вещи мы соблюдаем что у нас уменьшенное количество общая request of у нас минимальный response time коротенький потому что 1 литра и делом очень быстро и recovery интервал общем от длины ну и кстати вот примерно как выглядит график конкурсе когда мы что-то ретро или то есть это были она накапливалась как квадратичная формула стала как логарифм когда мы используем eq специальный быков и вот у нас есть библиотека поле которым идут на эти используем но она написана по следам he стрикса да то есть которые используются в джаве вот соответственно библиотека поле нам позволяет вот так вот настроить ретро и используя экспоненту мне эта формула не очень нравится потому что в ней применяется дискретная величина номер и троя это ведет к тому что мы получаем такой график чем этот график плох грег плох тем что есть у нас за литра велась очень большое колесо запросов то они будут ретро its через равные интервалы хотя и увеличенные хотя и уменьшило их количество вот но они будут чётенько по таймеру приходить все вместе обрушиваться и повышает степень конкор на сервере поэтому вот это мне нравится я добавляю сюда организацию в номинации мне дает такую картину меня всегда здесь не нравится что много пиков поэтому мы видим что ретро ведь даже с джиттером когда мы делаем какой то рандомизация рандомизированы также просто оказывается мне вот это вот все не нравится и приходится на самом деле достаточно долго мучиться вот все попытки сделать хорошо и мы где-то вот фиолетовой линии в пятой строчке это попытка команды а в с они публиковали статью как они уменьшили значит сбои в системе сделав джиттер на ретро и нам построить гистограмму я вижу что здесь есть пик но там такой зуб неприятные потому что эту гистограмму не так же просто построить мне удалось построить получше вот вот такой формы я здесь не использую дискретную величину в расчетах йа рабби зера гумен перед тем как его в жизни там степень двойки вычислить меня получается гладенько все это сейчас значит долго велась переписка с авторами поле они сейчас это ник аппарировали в кантри печь у них есть так называемые дикари ли это джиттер быков теперь вот он вот такую вот гладенькое распределение дает очень важный на самом деле вещь потому что она не накидывает конкурсе нижележащий сервер более чем хорош еще там пару слов скажу то есть инструмент интерфейс можем разные политики и примитива отказоустойчивости накидывает вот есть два экрана текста грубо говоря если бы аналогичный код писать вручную который умеет и circuit breaker включить и ретро и и time at вот тот получится кода очень много с ошибками скорее всего вот я упомянул circuit breaker кстати что же circuit breaker нам не поможет ситуации когда у нас сервер ходит в отказ но в принципе он где-то применим тогда у вас произошла к там чрезмерной нагрузки какой сервер стал падать начал сыпать ошибками и все вышибло пробки но для начала рассмотрим проблему cold start feel чтобы понять можно ли принимать церковь breaker вы длину нам полезен проблема холодного старта в чем заключается мы видим что от начала графика нас 15 секунд один запрос запросы выполняются на секунду тысячи рпс за 15 секунд пока сервер стартовал но уже считался включенным в лоб bouncer ну предположим даже уже приложению сама стартовал там шла jit компиляции все 15 секунд за эти 15 секунд у нас степень can карте возросла до 15000 запроса обрушивались в первую же секунду не один запрос есть невыполнимы здесь зеленого ничего не видим на этом графике помните там такой зелененькое должна выполненные запрос и здесь его нет ну то есть она номинально присутствует 0 только тайм-аут и это сервер который входит в крошку сразу когда стартует лечится это булка рядом очень просто то есть на входе ставится букет соответственно все что нам накидывает конкор оси вот то есть то что мы увидели что конкурсе накидывается там где мы группируем запросы по времени из какого-то интервала все в один такое может происходить вот что они группируются на микро в масштабе на что это похоже как вы думаете то есть когда у нас есть остановка ничего не происходит а потом движение продолжается но это garbage collector здесь имитированный деятельность горбач коллектора который делает стоп зе ворлд знаю что не все garbage collector и так делают но тем не менее таких флуктуаций может быть очень много системе и любая которая приводит к тому же не снижая нагрузки делает какие-то паузы она нам накидывает конкорд мы видим что здесь на фоне слева направо конкор настолько растет что ещё нам может навредить нам может нарядить код который вызывает высокий степень контент у нас есть некий за контент данный ключ один и тот же котором делается лог из разных запросов и оба запросы один обрабатывается друга его ждет это все повышает степень conca соответственно здесь у нас эта кассета с диаграммой мы видим нимб сплошным залиты это те ресурсы которые в данный момент добавляют конкор нас вылечить это можно с помощью того что мы делаем патрон fall back пытаясь не самые важные данные вычислить не обязательно вычислять их опять же нам библиотека поле помогает мы делаем fall back ну что это значит то есть мы сначала заправь обычно мы запрашиваем какие-то подготовительные данные например из баз данных в одном самое важное в конце в конце идет самая важная операция если нам удастся вычленить помощью дизайна и меньше vacancies это сложно но такие ситуации возможны когда самые тяжелые что мы вычисляем где-то в начале она не так важно и мы можем его искать и взять мы заворачиваем и the fall back берем например скажу таким образом мы ниже не ожидаем эту операцию и у нас получается вот такая система которая если мы ее в развитии времени посмотрим она не суть курирует наши ресурсы не накапливает concord ну и вот чтобы суммировать я скажу что конко россия такая вещь которую многие упускают из вида ее очень трудно и на графиках потому что ее нет в стандартных метриках обычных системах ну то есть есть там иногда это называется inflight request в разных системах или что-то такое но зачастую нам приходится самому придумывать как это должно работать это обязательно надо контролировать когда мы повышаем масштаб нашего сервера прокачку производительность если мы где-то упираемся ну то есть он у нас не резиновые ресурсы у нас в облаке конкретной машины которые должна нашу нагрузку держать если мы это считаем мы должны контролировать concord вот что влияет на конкурс ну естественно внешняя нагрузка влияет надо согласовывать свои марки маркетинговые акции не подавая более чрезмерной нагрузки естественно если мы ретро им нужно проверять что мы ретро им только то что имеет шанс зови троится и не создает не имеет накопительного эффекта то есть это не по причине ны когда систему падает под нагрузкой нам нужно ли травить и временные остановки всевозможные их нужно учитывать это нужно моделировать и смотреть как с тем будет реагировать иногда степень как она сможет в десятки раз прыгать особенно если очень высокий request рейд то есть там где разработчик вот каюту у меня всего 5 запросов в минуту а когда мы смотрим на графике мы видим что в какую-то секунду произошло 50 ну вот запросы имеют свойство от пользователей например иногда случайно совершенно случайно сгруппироваться могут не случайно может быть какая-то издеваясь труп инфраструктура притормозил эти запросы они сгруппировались вот ну и контент конечно же с контекстом бороться сложно немножко посмотрели как что можно сделать ну пожалуй это самые такие вот вещи о которых хотел сказать я надеюсь что вы лучше поняли что такое конкор эмси с моего доклада что вы сможете применить эти техники которые показал будете понимать как как их использовать своих системах вот мы наши наработки то есть теоретически исследование которые были сделаны по следам каких-то отказов наших систем мысу миром в виде таких докладов или видео упал собственных библиотек с примитивными отказывай устойчивости готовыми к использованию вот и всячески распространяемые то там внутри нашей компании вот и приглашаем ознакомиться с тем что мы делаем спасибо георгий спасибо тебе огромное сейчас будет у нас сессия вопросов и ответов а мы тебя благодарим за выступление именной табличкой и вот такой вот где вот как на мне надето такое классное теплое общество вот такая штука у тебя там сумки прикинь да вот вот такая вот это вот обожаю вопросы ребята я верю что у нас есть вопрос из онлайна и как только он есть его я вижу руки в центре зала как только готов онлайн вы его включаете прошу я обращаюсь в техникам проиграли да вот паттерн которого у вас был показан где поступает количество запросов в какой-то момент перестают справляться приложения я вижу что у вас там galant там же есть контроль буфера очередей как раз для этого и написан пишется свечи что все запросы свыше какого-то значения просто дропа еца вот впоследствии и это помогает ну вот избежать вот такой проблемы как как прокомментируйте что в чем вопрос не удалось понять чем вопрос повтори пожалуйста посмотрите вы говорите что есть проблема когда очень много запросов приложение 7 не справляется вот вы показывали код из гол анга который вот сумеров вот это все показывал наглядно что это проблема была вот здесь вот там есть контроль размера буфера очереди для каналов которые как раз для этого я приду чтобы через свич можно было дропнуть все те запросы а про не помещать возникнуть и прочим допустим для 2 миллион или там четыре миллиона во сколько поставишь все остальное будет доку то есть качество код будет написано вот а теперь вопрос ну вот вопрос как это можно прокомментировать то есть вот вы в эту сторону работали смотрели колонки и не очень как один угол а я показывал вот это вот на эти вот поэтому вообще и switch кейси пока не удалось возможно в кулуарах я верю про онлайн что теперь он к нам готов и мы ждем несколько секунд чтобы человек мог сказать представьтесь в вашем случае можно учитывать при выполнении да конечно нужно учитывать время выполнение запросов и скорость собственно ну то есть формула little нам показывает что конкор а все равно скорости пребывания запросов на время которое они проводят систем все это во время нагрузочное тестирование мы должны определять естественно есть и тяжелые легкие запросы у нас получается обычно что-то среднее вот мало того они могут плавать в каком-то диапазоне поэтому она грустит тира важного достаточно длительный период испытывать там нет вас там может пару часов идет я точно не знаю сколько бывал по четыре часа сессия нагружен тестированием они бывают разные вот и мы в что-то среднее которая наш сервер выдерживает как рассчитывается этот порог мы берём то где он упал ну и условно начинаем играть от этого в нижнюю сторону из теста мы не будем ставить ровно ну то есть он выдержал сто-сто 105 уже упал мы не будем ставить такую лишь поставим меньше 80 или там даже 50 то есть мы будем уже смотрели то это вопрос тюнинга параметров как ну естественно ничего одинаково не бывает что то в среднем есть опять же в теории массового обслуживания у нас во все усредняется допустит и как естественно какой-то имеется средний по больнице время выполнения но опять же здесь я говорил уже немножко что булка до нужно ставить на отдельные компоненты отдельные с разными параметрами собственно в джаве откуда это пришло там вообще принято соврет полами отдельными работать да вот и там собственно ул каиды есть предполье которые вот именно этим занимаются то есть как-то так вот сервер можно их целиком защитить какой веб-сервер можно изучить отдельные какие-то его зоны я понятно спасибо георгий напоминаю что тебе предстоит выбрать лучший вопрос я вижу уже человек с пароходом на руку тянет следующий спасибо за доклад я здесь по центру и посмотрите вы упомянули про краткосрочные отключения она то есть приостановку работу временно в идеале хотелось бы да ну вот molodoj картинку сочи вердикта роста и там в клуб пытается сайте что те люди которые подошли к это очереди увидели большие очереди прошли мимо потому что но они не будут столько ждать вас система работает ну пиццерии соответственно люди которые также приходят пиццерию если понимает что там огромные очереди не захотят ждать до и они соответственно просто пойдут дальше следующую пиццерию следующую заведение кто рядом с пиццерией правильно но это мы видим как бы верхнем верхние уровни как у вас системе доносятся до кассиров вот эта информация о том что ребята давайте приостанавливаем двери на ключ закрывая сообщение об этом я понял вопрос дед это конечно же здесь немножко не о том речь шла теории масса обслуживания кастамере системе это не живые пользую это у нас может вообще не быть пользователи это может микроконтроллер быть нет это понятно но нагрузка тем не менее же идет от пользователи вот то-то же разгрузка пользователю да есть разные причины по которым у нас могут приостановить деятельность пиццерии это может быть это какой-то фрод как или какая-то там так и хакеры там которые пытаются как-то обмануть и что такое происходит но и пузырю мог бы поставить стоп или например ну может что-то там произойти очень редко например не дай бог там закончилось тесто круга питере может поставить себя в стоп это функция в нашей системе есть такая но она мало отношения имеет где как коза устойчивой деятельности систем но все это не связанные вещи окей тогда смотрите вот произошел но не знаю людей очень много пришло очередной чемпионат систем начала загружаться и просто железно не справляется да вот пошла в горку рост нагрузки и нужно что-то останавливать останавливать входящий поток что у вас системе произойдет вы приостановите на уровне сервисного 9 сервиса не абстрактные давайте вот что сделал ребят во-первых у вас похоже дискуссии и для этого есть цифровые кулуары тех кто из онлайна захотят они смогут подключиться и в этом поговорить и да да окей посему договорились а я вижу нас есть следующий вопрос поднимайте пожалуйста руки кто еще хочет вот ближе ближе к выходу тоже будет следующим наблюдение на вич константин россельхозбанк это сколько я вижу вы работаете именно все равно с операции поступающими от пользователей а этих не требуется обслуживать бесконечно долго то есть если мы идем так или иначе мы смотрим на заказы тут скорее всего это заказы какие-то операции на на обслуживание то-2 же можно просто строить по времени вот в эту сторону вы не смотрели мы смотрели эту сторону у нас сделано все синхронны то есть у нас нет таких естественно запросов которые длятся столько сколько длится заказ у нас заказ принимается мгновенно игру слова надо потом уже какие-то дополнительные запросы к серверу делается чтобы обслужить и только вопрос том что если у нас асинхронная обработка идет в любом случае человек не ждет свой заказ беру бесконечно и даже в асинхронном общение у него есть время жизни после которую можно не обслуживать и очень часто вот проблему таких пиков решается выбрасывание внутрь моего опыта не на фоне только на входе да и но и в самой очереди вот в эту сторону не было ничего то есть выбрасывание изучили здесь речь идет об очень быстро очереди то есть это очередь она-то листик много ли там секунды держатся хорошо спасибо я задам одну секунду и я задам два вопроса коротких из чат и из онлайна потом последнего в у кого сейчас микрофон и дальше в цифровых лорак может продолжить такой вопрос задает никита от талкинг бакыт алгоритм не подходит ли для реализации на корм talkin' baked таким батю для реализации иных лобовым сыр потом я не могу даже скидку на этот вопрос никита найдите найдите георгию раскрыть задайте ему задачу darker авт а еще один вопрос из чата есть ли паттерна с более чем двумя череды очередями для случаев обязательный стопроцентной обработки запросов обязательность стопроцентной обработки паттерны были этого у нас лидер систем при в очереди используются там лебедь и они тоже не имеют отношение к примитивом мгновенный отказоустойчивости здесь речь идет о in memory очереди которая умрет мисс сервером и служит для предохранения точек быстрых таких сбоя супер спасибо и вопросы зала да спасибо за доклад а у меня два коротких вопроса надеюсь первое это не не очень понятно то что происходило на графике когда уголке до регулировали количество ну а итемов которые за пределами очереди находится то есть там когда было 200 500 1000 непонятно было то что не было видно вообще когда мы подняли до 1000 никаких отказов то есть не таймаутов ничего и свистеть и вопрос вообще вот в ожидании этой очереди есть ли какие-то тайм-аут или нет это вопрос 1 второй вопрос такой вот ты сказал то что ретро ить не нужно никогда но в том случае например если мы знаем что на сервер надежно за сервис надежно защищен высоких нагрузок тем что у него стоит bulkhead допустимо ли в таком случае ретро ить это всем спасибо допустимая ретро эти если у нас сервер защищен вопрос там имеет ли смысл это делать потому что мы литром мы попадем за пределы очереди тут же да вот есть мы по причине отказе батхед rejected exception получим ретро то я бы это не или травил потому что мы тут же попадем на полную очередь вот если это что-то редко опять же ли тратить на на то что гарантированно знаем или у нас есть теоретически подтверждение то выполнится у нас нету подтверждения чтоб под нагрузкой сервер вдруг мне в следующую секунду на авось мы будем ретро и что блок реле произошло почему ты должна быть причина веская для ретро я здесь я причину не вижу прямой в отдельных случаях наверное это 33 можно сделать через очень длительный интервал нам нужно ли нам это делать скорее всего нет первый вопрос что тут длина очереди увеличенная и значит у нас все его запросы выполнили да они выполнялись потому что нам хватило длины очереди чтобы все эти вопросы в себя вобрать это и история у нас не будет ну как бы мы не будем этим пользоваться в природе нам не нужно использовать очередь для был кредо уход очень ухода нужно только чтобы обеспечить миски вот эти вот высокочастотные флуктуации то есть чтобы он у вас не стоял в холостую не простаивал а не для того чтобы набрать то что должно обрабатываться позже в случае сокращения можно все таки вот на первый вопрос ответ то есть там в очереди в это и есть той мало то или нет они в этой очереди в данной реализации нефти а понятно семья оказать думала об этом что хорошо бы их там иметь потому что есть там на случай если запрос и вдруг стали другие вот в поле нету их георгий такое запросов понравился тебе больше всего потому что не понравился последние потому что я вы мне кажется они вообще полностью его понять вот так вот аплодируем поздравляем поднимись вот ассистенты ищет тебя счастливчика тебе книжку несут приза георгий продолжат цифровых кулуарах сразу налево и зала так чтобы из онлайна могли там с тобой общаться и так далее это совершенно я бы я пробовал сказать ребята это это реальная штука когда подключаешься через zune там такая классная камера и полное ощущение присутствует очень классно спасибо тебе большое"
}