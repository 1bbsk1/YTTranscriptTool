{
  "video_id": "_TLeyRUIkhQ",
  "channel": "HighLoadChannel",
  "title": "Сколько стоит разработать собственную сборку Hadoop / Семён Орлов (Сбер)",
  "views": 141,
  "duration": 2781,
  "published": "2023-10-06T07:21:50-07:00",
  "text": "Доброе утро пять минут не будем ждать и надеюсь оставшихся начнем вовремя Семен Орлов с бердата интерактив Поднимите руки пожалуйста кто считает себя инженером круто есть менеджеры а есть кто не определился И такой я и менеджер инженер одновременно все классно по-другому Сейчас расскажу повторюсь мне семинарлов зовут Я когда-то давно занимался физикой полупроводников изучать затухайте фото люминесценции в квантовых сверх решетках вот потом пришел войти в районе devobs инжиниринга Сергея инфраструктуры потом получил второе высшее образование где-то в этот же момент познал ходу Вот в общем за время работы с ходупом довелось количество детей до трех поэтому считать наверное фактором репликации Я немножечко каждый из вас в этом смысле последние четыре года я Занимаюсь строительством собственной сборки ходу в Сбере Вот за это время накопилось достаточно много опыта интересных всяких штуковин которые сегодня с вами поделюсь что рассказывать Буду конечно же историю какие-то там факапы какие-то сложности и в конце какой-то будет сам Мари сделаем выводы и вообще стоит это делать или нет чтобы подтвердить там легитимность вообще кто я такой чтобы вам это рассказывать вот мы четыре года не просто делаем мы уже сделали У нас тысяча серверов огромное количество приклада которое с мигрировало нашу сборку с топового вендора Вот и давать такую задачку чтобы немного еще проснулись вот Оцените сколько у нас серверов под ходу он крутится если мы точно знаем что вот поставили их столбиком один на другой мы получим такой столбик высотой выше чем больше Федерации вот чтобы упростить у нас те же двух юнитов Так ладно сейчас понятно что у нас все круто уже все супер называется вспомнить вам начинали и начинали 6 лет назад Вот только только там Чемпионат России Чемпионат мира в России можно было там посмотреть война бесконечности кинотеатрах и первая компания на рынке которую можно было акция купить которая стоила больше триллиона долларов Вот И в этот момент мы такие о давайте собственно сборка ходу поделать Вот но вспомним что у нас в тот момент у нас импортозамещение она чаще всего как шутка звучало в реальной жизни Конечно все ориентировались на вендоров особенно в интерпразе за какие-то там космические сотни миллионов долларов в этот момент когда ты приходишь с мыслью А давайте мы сделаем собственно продукт который заменит ведущего лидера на рынке выглядит какой-то наивный вот в этот момент как бы нам приходилось много отстаивать Вы там как бы Веру в эту идею и включая вот такие вещи как там спич все помнить что там нужно презентовать за 20 секунд но у нас были всякие смешные вопросы и вот начинаются тепло классно действительно ходу делаете и один из самых популярных вопросов был вопрос про название Вот еще одна такая Задачка Попробуйте совместить эти два слова и что у вас получится я уверен что большинство получилось именно то что получалось У людей в лифте и все думают что это офигенно Классная шутка ха-ха давайте мне важно было этот момент не грустить не расстраиваться говорить Ребята вы ошиблись на самом деле наша сборка называется sd-пи ходу Вот естественно были еще вопросы по делу например зачем это делаем здесь Наверное самый первый мотив Почему мы начали это делать поддержка то что мы банк у нас все класть в закрытом контуре и если у тебя что-то сломалось какие-то проблемы вытаскивать логи банды какие-то там скриншоты даже отправлять их в интернет ребята и из Индии достаточно не очень увлекательное занятие которое занимает еще там временами недели вторая Это история это про кастом который ты никогда не получишь от вендора понятно что вендор прислушивается большой заказчик все круто но когда тебе действительно нужно что-то там такое только для тебя то что важно ты можешь этого не получить Никогда потому что вендора свои планы на развитие продукта что с ним делать они могут просто не сходиться третья История - это написано Total cost of Да это по факту ценник очень хочется влиять на стоимость решений которым ты внедряешь вот и каждый новый контракт там на сотни миллионов долларов не вообще не радует конкурсную комиссию вот и они всегда говорят когда мы Прекратите покупать все эти классные штуки вот здесь важно когда мы считаем те силу да И когда мы вот это вот собственную сборку там эффекта оцениваем важно считать из его собственной сборки там не на 1-2 года на 3-5 лет вперед тогда цифры получаются гораздо бодрее и естественно убеждать получается лучше Ну и четвертый такой важный момент то что мы делаем не только для себя У нас есть дочерние компании наши друзья которым можем поделиться тем что мы делаем В общем одним словом мы продавали идею бизнеса продавали в таком порядке то есть самое важное найти всего деньги конечно же первый приоритет имеет вот Ну и когда ты сам формулируешь ответ на эти вопросы в итоге это все выливается какие-то презентации какие-то Ван пейджеры на которых я достаточно неплохо натренировался их там рисовать в свое время в общем-то нарисовал пейджер и идешь с ним убивать себе ресурсы большие компании тем хороши что в целом иногда одного слайда и там хорошо рассказанная история хватает для того чтобы получить ресурсы в нашем случае у меня было два с половиной человека с инженер бэнд-разработчик Я на полставки потому что мне ещё другой проект был предыдущий который заканчивал вот мы в два с половиной человека начали второй вопрос который Ну точнее второе Да один тоже из важных вопросов был э-э Как же вы вообще говоря сделаете качественную сборку качественный продукт если там он 2.000 человек это вот на минуточку Представьте Большой театр Да вот и типа X2 э ну или вот как все залы здесь на конференции но и вот это вот все вот в общем вендор и вас тут сколько тут 10 человек как вы сделать такой по такой же по качеству продукта это что никого худшее качество не устраивает дальше что название сейчас спойлер но Давайте разберемся конкретно разложим вот из кого такого полуинсайдерского информации узнаем что на самом деле у вендора то там 1200 человек это по факту там с LG продажники какие-то люди которые там маркетинг занимаются ещё чем какие-то конференции тоже проводят инженеров по факту на самом деле которые прямо разрабатывают и которых мы можем противопоставить свои вот этой Великолепные десятки Ну всё 500 человек э-э да у них больше компонентов нам например на тот момент когда мы стартовали у вендора было 36 компонентов у нас 15 компонентов сборке дистрибутива но всё равно там не в нашу пользу выглядит сравнение но важная история в то что у нас гораздо меньше комбинаторики мы делаем э под узкий кейс только для того чтобы нам нужно например вообще Я просматриваем никерберизированный кластеры то есть незащищенный кластер мы даже никогда не разворачиваем Да его можно типа развернуть в спущенной безопасности потом отключить но мы этого не делаем мы не Тестируем мы Тестируем условно под одной операционную систему которая у нас используется Да и под эту версию которая используется у нас нет этой комбинаторики и это дает нам возможность вот этими десяти людьми делать в принципе качественную вещь которая там не уступает вендорскому дистрибутиву так Следующая история когда вообще говоря я же типа продуктовый умер мне важны продуктовые метрики и хочется сразу же посчитать там ltv и прочее такие метрики продуктовые Вот Но у нас как бы не биту си у нас инфраструктурной продукт на котором даже если пользователи заходят на самом деле Лучше бы они не заходили потому что как бы работающих в продакшене Да он просто всё считает и с ним всё хорошо и мне просто не нужно ходить вот э-э у нас есть конкретные задачи нам нужно чтобы у нас кластеры работали чтобы администраторы не надрывались когда там после какого-то инфраструктурного инцидента поднимать нужно им там Пару десятков кластеров и чтобы вот это вот буква s в слове ходу действительно обозначало слово Security вот еще самое важное тоже историю чтобы у нас прикладники да те кто делает рекламные решения смогли достаточно гладко перенести свои прикладные решения с вендерской сборки на нашу здесь у нас один из первых факапов случился собственно изначально ставила задача есть вендорские там кластеры да там несколько десятков нужно с них все весь приклад мигрировать на собственный сборку вот мы так и начали делать Два с половиной человека потом мы построили какие-то там делали Как собирать Что собирать конкретно как-то устаканивали это второй продукт на тот момент был вот делаем сборку и тут у нас случается end of Live ходу по 2 в конце девятнадцатого года реально узнаем что в марте или феврале перестают поддерживать второй ходов нужно срочно переделывать на 3 месяца очень быстро там каком-то бешеном порядке сделали все получилось да возможно нам как бы продукт Vision бы помог Вот а еще бы нам точно помог опытный разработчик который помнишь что когда-то в жизненный цикл заканчивается и хорошо без этого опыта обошлись конечно Окей Ладно мы собрались сборку сделали У нас все поехало но нам что важно что нам не только нужно собрать нам что важно мигрировать Да и здесь такая картинка очень визуально понятно что мы релизы выпускаем типа там ну кучу релизов выпустили за это время и даже вот биотина с первым релизом уместился там Практически меньше чем в год вот а миграция заняла у нас 2 года как раз в этом году заканчивается готовились Мы ещё там полгода к миграции понятно что если у вас меньше количество инсталляций Если вы делаете там чуть меньше приклада она миграция будет меньше Но это важно наверное всех историй когда мы что-то заменяем да закладывать всегда временную миграцию для нас миграция вылилась вообще в отдельный проект с отдельным Delivery Manager потому что у нас в продакшене больше 100 кластеров прикладных там всяких историй то есть ну как бы там витрина данных какой он там рисков Какая конкретно их там больше 1000 экземпляров То есть каждый месяц что там может быть набор витрины набор этих сервисов поэтому у нас вся эта история с проектом проходила полностью создание концепции планы защита презентация участникам и вот такая вот схемка у нас родилась как мы проект миграции делаем один из секретов Почему у нас все получилось сделать в левом нижнем углу Эта та штука которую я проводил Ну ладно мы проводили да много кто участвовал ежемесячно Мы собирали какие-то кейсы уже есть мигрировавших те кто там накололся какие-то проблемы какие-то ошибки и рассказывали их там разработчикам администратором менеджером чтобы у нас соответственно осведомлённость была не сложно посчитать мы там больше 20 таких экспертных площадок провели каждый там на полтора-два часа там на этом 100 150 человек вот и одно из сложностей была история схема иммиграции понятно что никто не чтобы его приклад падал в какой-то момент да или там был недоступен когда мы говорим что у нас здесь вот кластер там 200 серверов его нужно стереть условно да то есть заменить на гендерскую сборку на собственную там технически Особенно это мажорной версии это еще не работает пекла тоже должен меняться поэтому у нас единственным доступным вариантом Был Была схема с параллелораном но когда реально поднимается отдельный кластер на него Соответственно убеждается что приклад работает также он работает стабильно там несколько недель работает только после этого старая венгерский кластер отключают Вот и когда все смотрят на эту схему все-таки думает ё-моё X2 железо потребуется на самом деле вот на предыдущая схемка и грамотно что у нас растянутого времени нам позволило обойтись 20 процентов дополнительного железа к тому что у нас было то есть мы у нас получилось мигрировать достаточно экономно вот Давайте теперь чуть технике Понятно Что у нас там управление менеджмент все весело чуть технике Какие задачи мы решаем здесь вот интуитивно понятная Картинка что мы вообще там в аналитической платформе делаем там оранжевые квадратики это то что построено на ходу пи а синие это там где очень тесная интеграция с ходупом если там говорить классический есть истории с репликами данных системы источников Да и построение какой-то там отчетности обязательно управленческой прочей и там эмэль всячески есть такой пример я его там всегда рассказывают мы делаем ходу А вот где вы можете увидеть его где-то его лучше торчат вот Сбербанк онлайне Если вы там зайдете у себя и нажмете кнопочку заказать выписки и справки чтобы получить юридический значим выписку да такую же как можно получить в отделении Вот она в итоге она придёт в ходу сгенерит там PDF ту которая уже там потом отправит к вам в приложение Окей важно что здесь кластеров очень много я повторюсь их там больше 100 штук они друг с другом взаимодействуют и вот давайте сейчас первым доработочкам которые мы делали вот начнут чуть издалека все кластер у нас взаимодействуют друг с другом по Федерации да это же Федерация что ты можешь достаточно прозрачным образом данные передавать между двумя ходов кластерами между двумя HD И когда у тебя только вендорские дистрибутив одной версии все прекрасно работает все супер вот там дата блоки летают между тонотами сразу все очень быстро работает когда мы приносим третий ходу собственно сборкой Вот Нам получается нужно как бы еще иметь Федерации вот такие вот друг Между другом и тут выясняется такой любопытный факт что Несмотря на все что написано в интернете они не дружат и третьих ходов по Федерации именно там важный момент да защищенный если керберс отключен всё работает Если вы включаешь он не работает нас клиент на третьем ходупе ожидал дополнительное поле блокаер чтобы понять этот блок складывать да На какой стороне Вот и доработка здесь была очень простая Да мы просто сказали да работали нет третьего ходу по сказали что нет этого поля Ладно только не падай брат и соответственно как бы ну всё заработало доработка тривиальная но у вендора как бы она как бы условно там не сделано да то есть вендера мы бы такую историю Может быть вы просили бы да но он бы так сказал Ну ладно такой специальный патч для вас Подождите два месяца Вот мы сделали достаточно быстро это один из первых кейсов Сейчас расскажу про один из тех недавних буквально вот осенний случился пару месяцев назад Вот у нас есть Федерации вот этих вот так кластеров друг с другом понятно что когда мы там говорим про данную у нас вообще встает полный рост вопрос дублированием данной Да что это типа дорого хранить там копии данных мы используем решаем эту проблему с дублированием двумя способами процесс на этой ЛМ понятно что там куча всяких есть Практик технический проксирование Федерации можете поискать в прошлом году Андрей Ильин рассказывал про то как мы строим устроили которые с проксированными данными про вкл Дэнс про всячески там сервисы которые мы разрабатываем Для этого уже разработали Ну и понятно что нас есть куча Федерации куча клиентов они друг друга ходят банально там витринные кластер ходит за репликами данных в репличных заданными врепочной кластер А есть еще Green Plane который через px входит в тот же реплики А есть еще всякие сатанисты которые на виртуальных лабораториях таких маленьких кластерочки на виртуальных машинках они тоже ходят за этими данными и вот в какой-то момент времени у нас одна из витрин какого там бизнес блока начала тормозить То есть она раньше читал за три часа началась считаться за 12 Ну это как бы всё все как бы пробитые быстро анализ там ничего не приносит то есть типа просто тормозит hdfs Почему не ясно в процессе анализа сравниваем там настройки или размеры определились симптоматику в комментах происходят Оказывается это у нас бывают проблемой и на вендорском дистрибутиве и на нашем дистрибутиве и не важно Какого размера кластер Какая нагрузка симптоматика на где-то есть где-то нет в инфраструктуру на мониторинге ничего не видно Типа все хорошо железки работает замечательно спустились даже там до обновления прошивок серверов но как бы тоже ничего не помогло в итоге мы нашли вообще что это тормозит у нас там понятно И много журнал нодами дописали логирование там где его не было вообще никогда и увидели что иногда вот в какие-то моменты Она когда пишет на диск данные она там задержки там не 0 миллисекунд типа там 2-3 ну и когда у тебя данных там данных спрашиваешь не сильно часто ты этого не замечаешь А когда ты там несколько десятков тысяч раз в секунду запрашиваешь эти тайминги начинают ролять вот и мы поняли что это проблема в том что мы пишем на диск который у нас на связано в jbot и иногда один из этих дисков он начинает чуть-чуть подтупливать совсем чуть-чуть Иногда я на инфраструктуру мониторинге этого не видно короче решили мы эту историю то что сделали первый рейд переключили на него немного проблема пропала понятно что на гендерской дистрибутивам бы тоже это нашли не знаю сколько это потратили там месяц-полтора или два все это время нас бизнес пострадал вот мы эту историю там где-то в общей сложности Наверное от первых симптомов где-то там за неделю разрулились с этими со всеми приседаниями все было очень весело Так теперь давайте про доработки Для безопасности которые мы делали на самом деле их очень много да но я там четыре типичных Сейчас расскажу начну с первого это грануляция привилегии наш дефицит такая есть фича фейсе очень классная все очень любят особенно те которые реплики данных ребята грузят Вот Но проблема в том что вместе с привилегиями тебе приезжают Вообще практически все привилегии административные приезжают супер-группы хадук Вот и безопасности естественно как бы не рада тому что у какого-то технической учетки появляются там такие привилегии с которыми можно делать все что угодно если бы вендорские вида дистрибутив был но когда она у нас был мы говорили просто смиритесь мы ничего с этим сделать не можем а собственной сборке мы просто вынесли это привилегию в отдельную группу естественно в настройках кластера можно подсказать что вот если Вот эта группа то соответственно это учёточки можно дефисным что делать соответственно Ребята получили у нас с точки зрения сервиса ничего не изменилось с точки зрения безопасности они имеют только то что им можно то что им нужно вторая третья по счету Эта история про Аудит в амбаре это то что тоже любит безопасники Давайте вот у нас какая-нибудь штука которая связана с безопасностью если там что-то и меняется но у нас амбаре как кластер менеджер станки настроечки меняются то мы будем сразу создавать инцидент безопасности есть специальная система саудиты но она кушает логики в специальном формате понятно что если бы опять же вендор как ты приходишь поменяй пожалуйста формат логов он говорит Ну дорогой друг Очень тебя любим очень много денег Но нет вот нас это не останавливает Да мы там чуть-чуть переставили как бы местами логии значит отправлять быстро и соответственно безопасность ещё чуть-чуть более счастливая стала чуть более хардкорная история всякие свои Фиксы с там нулевой толерантности гибели риском которая в компании объявлено cdшки они выходят на какой-то такой новый уровень Гигиенический то есть появляется буквально там на следующий день если день тебе приходит безопасность письмо ребята вот мы тут ваши компонентах наш лицевые срочно исправляйте ты бросаешь все идешь исправлять вообще там нас последний целый Ешка там 33 891 для третьего спарка которым активно сейчас начинает ребят пользоваться достаточно чувствительная и она была пофикшена там в самый последний минорной версии Спарка понятно что можно забанить версию выкатить обновление но там фичерлись чуть другой Возможно проблема с обратной совместимостью накатывать нужно в планах есть там какой-то бампер через пару месяцев Ну пару месяцев ждать нельзя посмотрели собственно доработку сделали бекпорт для своей версии раскатили на вот эти вот наши тысячи серверов без там ну со всеми оповещениями с тестированием совсем меньше чем за 4 дня Я считаю что круто э вот тот момент что у рационе до выкатить этот Продакшен Ну то есть мы по ночам не работали такая штатная работа была хорошая Вот еще одна характерная История это совместимость для авторизации доступа к данным используется Ranger Вот выходит его новая версия там новые фичи которая безопасники очень любят Очень хотят но она несовместимашем который мы используем и которые мы принесли эту версию и с точки зрения там отказоустойчивости 2412 мне кучу всего поправлено типа вот хорошо и принесли но они совместима с рейнджером 22 никаких проблем Мы дорабатываем там Ranger Pro логин для hbs для своего он становится совместим опять же Мы открываем дверку Для безопасности обновить Рейнджера до нужной версии В общем опасность стала с нашим приходом несколько счастливее и мы вместе с ними тоже но мы не только безопасности удовлетворяем еще и про разработчиков не забываем вот делаем какие-то доработочки для хайва Ну и как и все доработки которые мы делаем можно условно там на два типа разделить первое то что мы делаем сами и придумываем Сами как бы делаем условно только для себя э-э Ну ладно не только для себя да делаем а вторая когда мы нам нужно что-то Ну что-то уже поправлено более свежих версиях например 4 который выйдет когда-нибудь неизвестно когда вот уже поправлено в нашем 3 1 2 ещё не поправлены и мы делаем Ну вот например такой бекпорт делали когда там при работе с таймс темпом там Скорость обработки там данных увеличилось там почти 40 раз вот такую штуку делали например для себя да Ну наверное не только для всех она применима проблема такая делаем табличку его над очень сильно пропорционированным там большой объем сильно про позиционированных данных и когда делаем там сейчас парка всё это дело запускают они создают табличку и парк просто висит 30-40 минут ничего не делает только после этого начинает там 40 минут осталось всё дальше типа быстро отрабатывает как должное пробиваются вообще не круто что она там 40 минут делает но выяснили опять же добавив каких-то там посмотрев логику Что у нас Ranger логин начинает проверять привилегии к всем папочкам рекурсивно которые есть там в HD Face ко всем этих папочек условно там 100 200 300 Типа все нормально там пару секунд потупил и поехала когда он появляется десятки тысяч то это вот такие вот десятки минут иногда там больше часа начинают пить соответственно мы сделали на строчку которая позволяет останавливать только на Верхнем уровне То есть ты проверил что у тебя к папки есть доступ до катались логично партиции не Проверяй соответственно вот тоже не очень сложная история с точки зрения там логики как она выглядит но очень хорошая история с точки зрения бизнеса и разработчиков что делали экзотику всякую в начале года например сказали больше их не будет возможно Попробуйте на армии запуститься Ну вот ни один вендер на Армении работает мы работаем Как мы можем взять мы собрали все работает все супер работать примерно также на сопоставим по размерам железа по ценнику даже за тот же ценник будет работать также Короче если у вас есть кормовых железных Используйте это знание можете собраться реально тогда будет то что вам нужно так давайте как так выводам чуть-чуть финальная история типа как определить что пора здесь банальности конечно же Но вот как понять что можно сделать пора собирать сборку Первое это определитесь потребностями отрежьте вообще все что вам не нужно и Оставьте только те компоненты интеграции которые вам реально нужны а вторая История это возможности Вот и в компании еще можете инвестировать в это в том числе как бы ресурсы и там время Понятно вообще в компании пойдут инженеры там разрабатывать ходов да тоже как бы такой вот момент через который проходил проходить третья История это сроки результат нас не мгновенный То есть если вы начнете разрабатывать ходу у вас результат появится там через какое-то время вот опять же потом еще какая-то миграция будет только после этого получится начать получать вылью вот по итогам проводите кастовые анализ сравниваете эти всего и принимать решение в нашем случае было экономия была там десятки миллионов долларов радикальное снижение терабайт хранения вот остальное все вылью которому получали но такого уже дополнительными вишенками шло Вот теперь давайте про тайминги и попробуем посмотреть где можно ускориться нас условно Эта история заняла там почти два года вот я приду что примерно 2 месяца Можно было бы сэкономить если сразу понимать что нам нужно вот три месяца мы бы сэкономили если бы вот с ходу два на ходу три не этот не зафакапились примерно четыре месяца из этой истории можно было бы убрать если не отвлекаться на всякие сайты истории просто по дороге делали дистрибутив для гостях сервис внутри на ППР чтобы можно было как бы из его модели реализовывать которая Ну к сожалению взлетела какие-то дополнительные вот нашего понятно что нужно но как бы это целевая история может быть для вас Ну еще пару месяцев точно могли бы сэкономить на более раннем выводе в продакшн то есть мы чуть-чуть затянули Я считаю с этим можно было раньше водиться нашли больше проблем каких-то сложностей которые решали быстрее имели бы более там быстрее получили результат в форме работающий еще и важно помнить что команда собирается не сразу мы на к сбор команды потратили чуть больше года Потом по человечкам видно если команда есть сразу то вот типа 12 месяцев один год то когда можно сделать хороший дистрибутив Так давайте про Команду собирать дружную вот но важно что этапы разные этапы требуют разного состава скороговорок справедливо для ходов деловом инженер это на самом деле инженер там который умеет шутить только автоматизаторы когда мы запускаемся у нас появляется обязательно деливерие менеджер потому что нам нужна история с миграцией инженеров точно нельзя пускать Ну и когда у нас Продакшен во всю Там уже все колосится у нас появляется тоже неочевидный вывод девелоперы в самом конце не прописывайтесь истории с поддержкой это отдельная история отдельного доклада и Давайте теперь выводы слайд Первое это важно верить в идею путь сборки он не очень благодарны вас будут пытаться сбить с пути и много желающих будут испытать вас на прочность второе если делать то получится Можно бесконечно обсуждать обдумывать прицеливаться Но как только вы начнете сядете за кнопки начнете делать у вас получится второй пункт два года у нас на это ушло И третье очень сам наверное важное что если есть команда есть результат сбор команды это самое важное история если здесь такие про размеры три человека это минимум на самый минимальный чтобы делать ходу сборку если 10-15 в среднем уже такое неплохой дистрибутив получается для внутреннего использования если у вас там 30 плюс человек на Эта история то вы уже готовы скорее всего продавать свой дистрибутив наружу можно на рынке каком-то предлагать вот еще раз повторюсь что без команды Это история невозможна здесь хочу сказать спасибо моей команде нашей команде за то что мы есть я очень горжусь нами и нашими результатами которые мы достигли Спасибо за внимание теперь переходим к вопросу Спасибо Семен особенно за армой Спасибо у Семен очень классные подарки за лучшие вопросы поэтому я советую вам три штуки Да о давайте вот с вас Да Привет Семен Спасибо большое за очень интересный очень интересный доклад Спасибо большое а можете поделиться такими может быть секретами на ваших кластерах Ну там 100 штук неважно и тысячи серверов какие самые большие нагрузки с точки зрения данных с точки зрения компьютера Так мне там цифра была один вопрос второй вопрос опять же какая доля что ли или как выглядит с точки зрения и с точки зрения ваших кластеров и я и задачи по какому технологическому стеку могли бы пробежать Да могу Спасибо смотри какие-то Циферки сейчас попробую накинуть То есть у нас кто-нибудь посчитал сколько у нас серверов Ну да но на самом деле чуть меньше там 7 с копейками их сюда возят то есть 7000 серверов и они твои все двух юниты вы все до двух юнитов это большие железки там типа 64 процента полтерабайта оператос и 70 петабайт данных у нас всего вождя сейчас и порядка 120 петабайт данных в нём если говорить про вот задачи типа самая высоконагруженные у нас там изначально самая высоко нагруженная история была эта репликация данных система источников в банке порядка там до 1000 там 8 800 штук Да и среди них есть достаточно жирные большой источник данных это типа там 300-400 терабайт дельты за сутки могут быть там пара тройка терабайт это один источник Вот и мы работаем вот эти реплики эти батчивы это Т -1 то есть не за предыдущий день у нас есть данные и с насадку Ну типа за сутки переживать фигня а на самом деле у тебя заканчивается система в 12 часов а бизнес хочет начать считаться типа уже как рабочему Дню соответственно они витрины начинают читать там часов пять и у тебя остается на самом деле на реплику часа там 3-4 А таких реплик много и как бы это вот это наверное одна из самых таких больших высоконагруженных частей была у нас там на старте сейчас у нас очень много историй уже без носовых считается которые там ну по компьютеру Они сильнее они меньше по объему данных биржом их но по именно просчетам Они сильнее и сейчас я скажу там Ну бизнесовые кластера у нас это там порядка там три четыре тысячи ядер и вот они молотят у них там утилизация по Ну вот именно по Яр но там типа 80 90 процентов то есть они молотят без перерывно Здесь вопрос конечно же оптимизации к тому как код написать у нас сатанистов много они несколько там говорится говорить про ходу они естественно там используют парк и вот это вот все эти сотню библиотечек которые можно вообще вообразить отдельная история про то как мы ходу приземляем ПНВ на каждом классере склодер это были кастомные парсели в амбарят у нас эмпатия они просто распространяются и доезжают вместе с прикладом Давай следующий вопрос Давайте вот молодой человек хотел спросить первую очередь про миграцию тот момент когда с клаудира на вашу сборку Вот вы сказали что 20 процентов избыточности было То есть я так понял схема такая что вот есть два расчета вы их дублируйте на старом новом момент времени на новом кластеры очень мало ресурсов потом момент когда вы отключать на старом Вы докидываете железо в новый То есть такой процесс постоянного расширения правильно и старого убираете железку в теории он и был так задуман и мы где-то это провернули эти вещи но в итоге это вышло Так что 20 процентов это условно значит подменный фонд на котором типа разворачивают кластеры кому-то кто-то например там вот есть кто-нибудь розничный блог ему развернули кластер он у него начинает переезжать и там вот история с дико Миссия на самом деле не очень плавная она там типа в 2-3 чанка идёт то есть мы типа Берем например там не знаю 30 процентов расчётов перенесли на sdp Вы там где комиссию Но типа узлов и отдали их подменный фонд а там где другие у нас еще история Просто у нас сразу много разных сводов и вот эти вот когда у тебя там 7000 серверов у тебя времена начинает место заканчиваться в соде там всякие такие штуки но в общем-то отдельные очень говорят про миграцию это какой-то автоматически был процесс или это большая количество ручной работы очень большое большая нагрузка Ну как бы Ладно такая это большая нагрузка на прикладные команды начиная с того что даже безопасность не готова была там переставать участвовать в приёмке то есть ребята переписывают на мажорной версии на другие у них там ну второй ходу своей как бы свои Да мажорки в третьем ходу по своей и чуть-чуть Разница есть но безопасность такая ну если Разница есть Давайте проводить и мы будем Ну перепринимать это соответственно там ролевые модели переезжают в коллагере Это sentry здесь у нас рейнджер то есть всё нужно поэтому у нас по факту ребята делали новую версию своего приклада проводили приемку выводили в его в продакшн кластера на железе развертывается хватит вот нас постоянный зритель Антон не могу не дать слова только покороче пожалуйста короче но будет довольно такой интересный сложный вопрос представим себе что у тебя вот действительно тебя очень интересный кейс нам надо было переобуваться на ходу Ближе ближе микрофон с одного верха только на другой история такая А тебе еще нужно мигрировать кучу приложений типа ребят переезжаем на нашу сборку мало то что клиенты конечно клиенты короче первая такой под вопрос как получилось сделать железом Потому что ты говоришь есть подменный фонд какой-то который ты там ребят переехали потом в обратку А у тебя история такая что во-первых у тебя на старом ходупе Ребята так как они инженеры там аналитики они хотят чтобы это было Быстро идут искать оптимизации идут какими там допустим ВС инструкции для того чтобы они там работали на старом но на новом они заведутся железы у тебя приезжает новое железо А ты там заточился на какой-то старое у тебя сверху новая версия которая по идее может думать про старое железо ты уже сдал это железо ведь он начинается очень сложность вопросов его длине это еще пока во первых Во вторых уже не будет Антон хватит Короче смотри первое железки одинаковые это у нас диктат с бернфры Да потому что не говорит ребята Нет мы будем Вот у нас квадратно параллельные железки есть под ходу у нас все 7000 железок они практически все одинаковые железо которое у тебя же люди жили же на каком-то железе и все типа одинаковый Спектр жестоко Да сберут они очень жестокие люди Они очень не хотят геморроятся с в зоопарком железа в там нескольких содах хорошо А тогда насколько Антон Хватит давай ладно давайте просит Привет Спасибо за доклад спросить а вы не думали про то чтобы сделать в 10 раз меньше кластеров в 10 раз больше Казалось бы это упростило административные расходы и упростила прикладникам там уменьшил количество копирований хорошего просто номер раз Короче думали Конечно изначально такая была идея а давайте сделаем один такой вот один кластер и туда все трины и дата-сантистов туда вообще всех запустим а потом оказывается что ходу не любит маленькие файлы А все любят Ну а потом оказывается что у нас начинают приклад друг друга друг с другом бороться то есть реплики данных витрины как друг с другом совместить а потом нас разные клиенты разные бизнес-блоки начинают толкаться плечами И вот во втором ходу питом есть история с фаршадулером да типа спреемшиным которого заявлено Что работает вообще как часы А по факту не работает И в этот момент мы начали делить кластеры просто ну исходя там из вот набора проблем Мы начали просто говорить Так это у нас кластер с репликами это у нас кластер типа витринами данных здесь для сатанистов ой реплики еще подъехали они перестают влезать на этот мастер давайте рядом ещё поставим и у нас так потихонечку из одного кластера получилась несколько десятков но сейчас почти под сотни там 90 с лишним штук Так давайте Кто следующий давай вот первый ряд Но это было во-первых мой ответ во-вторых мы делаем следующий шаг на самом деле к тому чтобы построить сас сервис для аналитики для работы с данными Но это другая история уже да Ближе ближе Спасибо большое закладку что собственно ваше решение не является узким горлышком вопрос Смотри здесь важный момент что Несмотря на то что нас очень большая компания и очень много зарабатывает даже такой большой компании нет возможности сделать такого же размера как Production а потом возникает вопрос даже если мы делаем достаем такого же размера как продакшн типа тесты на нем сгенерировать вот тот профиль нагрузки который в реальности появляется Ну это отдельная очень сложная задача поэтому как бы если честно скажу крамолу конечно да у нас есть синтетические истории когда мы там отказ нагрузка на отказ какие-то там вот покопасить мы можем померить это есть но если мы говорим типа Теперь давайте представим что у нас там 28 реплик к ним 1050 клиентов Вот таких историй Нет это как раз чем остался на одном то есть что типа когда Овер дофига появляется пользователей Мы это можем поймать только в продакшене Ну и как бы здесь вот это вот нагрузка здесь важно что мощь тесно работаем с ребятами сопровождением с мониторингом чтобы такие вещи отлавливать до того как типа бизнес что-то заметить что-то пойдет не так Давайте дискуссию после последней наверное вопрос Ну откуда Давайте вот молодой человек вот белым Спасибо такой вопрос вот Классно вы построили всю историю классно продукт есть его заманили кучу пользователей пользователи счастливы А что дальше Потому что была классная картина с двумя девушками но тут у нас теперь с одной стороны ходу по другой выруливают новые классные там а Давайте теперь все на это сделать вторая часть ответа разделением уже несколько лет назад разрушили действительно мы делаем нас есть один из проектов мне в команде где мне такая типа саптин есть Да мы строим сторож дорабатываем активно участвовал понсорсе с apach Ozon сейчас там в релизе 12 уже есть наши фичи там следующий релиз на наших печей будет уже очень много это сторож широкий человек второго ряда рассказываю ам компьютер выносит действительно в куберетесь э очень хорошо работает здесь вот важная история что у нас данные это хранятся в зоне а он поддерживает HD fspi и S3 протокол и таким образом мы можем достаточно плавно мигрировать важно опять же помнить что у нас очень много железа есть которое как бы ну уже купили оно должно работать мы понимаем также что миграция вот этот вот в разделённый комплекс она не будет там не за один год пройдёт поэтому мы уже в этом году у нас есть первые какие-то витрины которые работают на этом в следующем году мы это больше обкатываем перестаем закупать ходук железа и ну в какой-то момент как бы да действительно там ходу весь хлопнется это один из моих вопросов запасных если мне вопросов никто не задал типа что будет с ходупом И вот я думаю что классическому ходу там года три есть еще жизни а дальше история уйдет уже в определенный комплект 406 сервисы по обработке данных раз не хотел начинать холивар насчет я на этот вопрос тоже лет пять отвечаю Готов ли ты вручить свои призы лучшие вопросы здесь будет очень сложно поделить Кому что поэтому Рандом давайте я мне пришлю вспомнить сколько их было так на лица Посмотри мне нужно оценить лица да Так ладно все будет у меня 33 подарка Вот первый ну я как типа самый классный самый классно первый второй третий короче первый Вот пьезо первый вопрос Да вот второй подарок вот миссия со второго ряда а третий и последнему который про компьютер да Спасибо Спасибо поаплодируем и тебе подарки от организаторов антончика от наших партнеров Спасибо за доклад было весело так"
}