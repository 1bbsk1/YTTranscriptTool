{
  "video_id": "VkSEEhCzjW0",
  "channel": "HighLoadChannel",
  "title": "Делаем свою прошивку для IP-камеры на Rust / Максим Лапшин (Erlyvideo)",
  "views": 5667,
  "duration": 3104,
  "published": "2018-08-16T04:51:27-07:00",
  "text": "и сегодня я расскажу немножко вещь которую я немножко отличается того что я обычно рассказываю сегодня я хочу рассказать про то как мы как мы столкнулись с потребностью с необходимости решали задачу две вещи во-первых мы решали задачу как нам поменять софт на и пика мире как нам воспользоваться и пиками расскажу зачем это было нужно и что мы здесь сделали как мы это делали что мы выбрали в основе для этого и выбрали модель твой язык раз это новая штука такая вот я вам сегодня расскажу про наш опыт который нас есть итак роста и пиками рада называется то есть решит о том что мы взяли вот такие вот железки которые висят на улице смотрят за нами и поменяли на ней прошивку и в качестве основы выбрали не классический язык си которые дорогой тяжелые болезненный но привычный и понятный а попробовали сделать эксперимент в виде роста на что мацы почему нам вообще нужно было почему возникает какой-то разговор про замену прошивки на и пика до пика мире во первых айпи камеры это одна из самых дешевых штук которые можно купить электронных сегодня вот где бы то ни было значит на в позапрошлом году здесь в москве китайцы предлагали в розницу по 89 долларов штука то себе решить о том что за 9 долларов вы покупаете железный корпус питания компьютер объектив с сенсором и к подсветка то есть компонентов больше чем долларов стоимость этой штуки и все это дело очень очень надежно и достаточно прилично работает то есть за счет своей массовости они начали сделать очень качественные приборы но у них есть сложности например на большинстве и пика мира который в том числе нырнула нас сейчас смотрят стоит слов примерно 5 года в 2005 года датирован со всеми этими богами которые там заботливо значит лелеют и не у него недели то есть если вы не знаете explay для лифт 555 серверов он будет работать для наверное думаю что 15 20 миллионов камеры в мире значит следующая штука мы хотим новые фичи то есть у камеры которая сегодня есть есть ряд сложности с тем что то куда они развиваются оно отличается от того что нужно нашим клиентам потому что сегодня к сожалению очень много устройств особенно которые не дай бог для дома они очень сильно закуп ливают сами в себе то есть например если кто-нибудь сталкивался с концепции умного дома и смотрел как это выглядит джека которые этим заморочился то это ужас потому что например в большом доме там на двести-триста квадратов которые можно построить подмосковье за кто засовывается всякое разное железо инфраструктуры и прочее прочее и у человека на получается целый экран android на планшет телефона забитого разными приложениями которые несовместимы друг каждый ходит всему китайскому облаку все это работает очень плохо вот и меня но вместе не стыкуется никак вообще мы так не хотим мы хотим нашим клиентам давать вещи которые они могут потом собирать вместе с мы хотим новые фичи поэтому мы решили что здесь нужно просто взять и написать прошивку для камер свою а еще одна маленькая деталь такая вот это про стандартная шутка про то что в слове уйти с это безопасность security начнет на данной на сегодняшний день вот проблемы которые есть забот на этом мира и они не устранены они не решены потому что они глубокие инфраструктурные а не понятен и и пока что разные вендоры в индустрии и пика мира не только подходят к тому чтобы правильно сформулировать для себя проблем могут на это мира я уже не говоря про то что там подойти к его решению вот у нас есть как бы идеи как это сделать вот поэтому у нас возникло вопрос о том как это все дело писать и заливать на камеры это болезненные вопросы еще про них расскажу и на чем писать почему мы выбрали расстались и это собственно говоря будет расскажу итак в чем конкретной проблемы с камерами со всеми современными которые есть в большинством у них отвратительно написанная сеть например есть хороший пост на хабре по моему года так из 10 может быть 12 бак которого нету там рассказывается про ту проблему что в китайском совке который стоит на эти камерах например аниме терять даны в тисе пи канале вот вот вот надо научиться взять и сделать так чтобы в потоке терялись данные утонет научились делать и это очень больно и неприятно тест но мы хотим это чтобы не было плюс для ip-камер стандартная вещь на что больше двух подключения на одну камеру нельзя вообще не как все . потому что просто тосов который стоит в ней он не умеет вообще отдавать данные больше чем одному клиенту на самом деле но этот это трэш просто треш мы так не хотим мы умеем делать больше есть ли другие фичи например хочется воспользоваться всей памятью а потому что в камере там под 100 мегабайт бывает оперативки она не используется вообще никак потому что просто таких чипов у них нету они их пихают и этим хочется пользоваться например не то и пика мир которая бы тут без затрат explorer от но их единицы to set реально единицы тому камеру вот у вендоров в мире которые научились вроде как там rtmp пихать то есть они требуют flash player который пока не расшатывали сел стал уже все одно как бы он забанен flash player сегодня многих местах мы этого готовым это хочу переделать с камерами сложности когда не находится где-то там вдалеке добраться до камеры сложным и это все отвесно решаем сразу первый вопрос который возникал у некоторых наших там знакомых при то что вы сами свою камеру не закажете почему не сделать свою камеру это плохая мысль я вам говорил до 9 долларов пойти и сделать что то такое что можно продать за 9 долларов в этом заработать денег надо быть собственно говоря фабрика в шеньчжене значит разработка свою железо это дорого долго сложно самое главное тут очень долго то есть даже две где нельзя просто взять например миллион долларов прийти к людям сказать вот миллион долларов пожалуйста через месяц делайте мне железку миллион долларов возьмут любую сумму возьмут любая любая китайская фабрика после чего вы через три месяца получите ничто не работающая с чем вы будете еще его отлаживать отлаживать отлаживать то есть точно такой же процесс как и в совке просто здесь это будет гораздо дороже и длине итерации а самое главное поскольку мы все-таки софтверный гендер мы по всему миру работаем нам нужно нажать на жили на ствующих застава сейчас у нас есть такая целая очередь из наших клиентов которые говорят давайте давайте доделываете свое свой проект и мы перельем нашей камеры на ваш на вашу прошивку то есть это надо вот с этим работать и так давайте приступим собственно что пайпе камеры это вот классическая железка вот как бы миниатюризация в самом своем вот-вот в воплощении это готовый компьютер мощности примерно сравним систем что было у нас в 90 где-нибудь в седьмом году вот был блог на котором можно было поиграть там в doom в quake по моему да но вот это примерно она вот теперь вот так сжалось только еще появился объектив значит как я сказал а вот куча куча деталей в айпи камере и собственно здесь мы можем влиять только на флешку да нам надо вот на флешку залить что-то такое свое потому что все остальное она отлажена значит понятно да что мы хотим работать с камерами потому что это готовый готовый девайсы в котором уже можно работать более того некоторые наших клиентов они хотят пошли дальше они говорят раз на камере есть экстра мощность которая не нужно там есть игры там есть почти пол hertz процессоры в 500 мегагерц но чаще 256 давайте туда же в одну какой нибудь еще и историю которая будет например ходить к датчикам дома можно пойти и за 15 долларов купить в 15-20 долларов уже камеры с каким-то поддержка мезе где идут и что то еще то есть камеры уже может быть как хаб для умного дома насколько это адекватная история это уже по ситуации ну как бы наши клиенты вот то что спрашивают там и для них и делаем значит нам нужно придумать как перезаписывать флешку чтобы не написать свой свою прошивку вот прежде чем дойдем до роста давайте немножечко пояснить и здесь проблемы что-то на ней есть такой надо с этим разобраться какая структура потом мы поймем как и в принципе перезаписывать как это сделать разбирая камеру потому что когда мы с камеры только чем знакомиться как с любым устройством сделаны мне нашего села разобрать его покрутить повертеть посмотреть подумать как его будем чинить когда мы сломаем все а это мы сделали бы ни один раз и после этого надо уже думать как нам сделать это все дело более масштабируемым потому что сейчас например мы уже клиентам отдаем измененные прошивки но не пока не то что будут новые сделали мы только меняем имеющиеся прошивки и они тушь на фабрике заливают а здесь нужно еще пойти дальше и убедить фабрику вот предыдущего уровня там заливать у себя потому что в китае вот у эти камеры там до шести уровней фабрик бывает который каждый занимается чем-то своим разобраться в этом очень сложно а что находится на обычной флешки в принципе очень похожие истории как на роутере вот от роутера современная epica мир отличается не сильно вот в этой части это загрузчик you but you but используется в принципе про него даже знают вот ремонтники которые андроидом умеет чинить то с ним можно проехать а то мишу будет переживать вас карту а да да знаю но на самом деле нет там есть рядом ли раздел из автомата и выбрать раздел и с конфигами в принципе достаточно разумная концепция в одном месте держим софт который нельзя перезаписать это хорошо правильно и удобно то есть когда flash user нельзя даже ничего смонтировать или записать это это это хорошо и полезно для такого дырявого устройства и есть три duravit раздел с конфигом куда будет что-то записать мы видели камеру на который была сделана страшная страшная вещь там было все ряду райт можно было писать на любую часть то есть можно было перезаписать это файлики можно было стереть например что-то для user это все это это очень плохо значит как мы пишем на флешку начинается все записи через у будто сам простая вещь если китайцы не кастрировали but all but это загрузчик это та штука которая это вместо ну грубо говоря вместо bells это очень такое это будет упрощение сильно но это та штука которую вот когда мы обычно как это включаем увидим что-то такое получено на на экране то здесь этот парень тоже самое будет то есть это то что мы видим самом начале с вот с ее юрт дисплея у камеры нет никакой видеокарте там не речи не идет все что можем сделать этой uart то есть его рта таком порт мы к ним подключаемся в обмен мы понимаем зачем нужно было еще одна камера потому что мы перепутали полярность зажгли вот взяли другой такую же и пошли дальше значит убуд это такой развесистые модный мощный bells в котором есть сетевая подсистема в нем есть возможность записывать флешку читать в принципе все что там нужно то есть мы его берем он нас видится видится сетевуху по цепляемся бы поднимаем tftp сервер и заливаем в память новую флешку и перри заливаем содержимое и понимаем что мы не сделали бэкап для там нужна третья камера значит там есть кайта софт значит вот софт как раз написано частично это обычная linux частично это как раз хитры хитрый китайский софт значит пошла выше важно знать о да и софт на камере он важной особенности он умеет перезаписывать флешку это нужно для того чтобы когда вы скачиваете апдейт для обычной камеры или облить для роутера точно такая же история вот именно софтина не у бута именно софтина которые запущена она ты перезаписывает и третья вещь которая с которой придется иметь дело в любом случае потому что вы где то обязательно ошибетесь это шлейф шлейф для разных флешек они разные значит это путь более печали то есть например нас культ момента была такая вещь что нас валялась в офисе если несколько несколько клещей и вот к некоторым клещам некоторые кабели подходили и успешно некоторые другие не подходили нужно было точно знать ту комбинацию версии винды кабеля переходник с usb на com порт эшли клещей на которых она работала и записывалось причем бывает такое что на одном шлейфе она может сочетать например содержимое флешки on другом шельфе можно записать это больно и так про you but now but с первой чем мы сталкиваемся с ним у него есть командная строка которую некоторые вырезают к счастью это бывает редко потому что обычно всем лениво все сделали камеру запустили работает и поехали вот но некоторые из вендоров китайских камера не решают надо здесь сделать пусик your не все надо защитить камеру от даже интроспекции и успехов и вот они убирают команду строчку ну как бы мы тогда проходим шаг субботам идём сразу флота к исследованию софта или шлейфа уорд earth паяльника слов это то с чем то же приходится принц иметь дело но в принципе если кто-то разрабатывала роутер или девайсе наверняка какие-то девайсы с этим всем приходится иметь дело вот важная штука здесь включается в том что к сожалению вот если вы берете одну камеру рядом другая камера вот между ними убуд непереносим вообще никак потому что в нем есть магическая зона в которой записана конкретная конфигурация данного железо причем вся прелесть о том что в эту конфигурацию нигде узнать не можете потому что ни один из продавцов по цепочке продаж к мир не может вам точно сказать что за железо стоит в ней вот вот никак не ему невозможно у них нет такого технологического процесса позволяющего точно сказать что в этой камеры стоит вот это примерно подобная штука на самом деле я думаю что и в телефонах потому что вы покупаете телефон до конца разобраться в том какая именно там стоит сети в ухо чипы что-то еще прочее невозможно потому что что-то где-то пути поменяли но об этом просто дальше не сообщили она как то так заработала и потом произошло и так что мы как как мы про субботам работаем до мы вскрываем камеру цепляемся к его рту сливаем посетить содержимое флешки смотрим инспектировал редактируем заливаем обратно и теперь мы вот здесь у да я всегда возникает проблема потому что маленькая ошибка здесь там питания скакнула и здравствуй шлейф значит и здравствуй вот вот такая камера превращается вот это таких у нас много в офисе значит что дальше происходит как только мы разобрались с таким девайсом мы сделали первичную итерацию и и редактирования дальше мы как правило можем уже на прошивку положить свой софт который мы с вами скомпилировались чтобы уже дальше облегчить выбрать нужные было тут введите в you but you are to the все мне нужно было то есть мы после этого делаем другую флешку или другую прошивку меняем и потом уже можем видёшку куда менять чтобы это было уже из авто из из linux linux на камере ну самое как бы финальная цель всего этого это договориться с фабрикой чтобы они поменяли свою прошивку которая не заливаю для конкретной серии камера и уже делали для вас нужную камеру что дальше все я рассказывал классно весила чуть не делать дальше значит нужно приготовить дистрибутив linux который влезет туда нужно написать код который работает с видео это сейчас ближе к этому и делаем собственно говоря самое веселое и забавное и смешно это веб интерфейс который нужно на пробовать без питона без рельсы без ничего на очень примитивных языках это очень классно очень приятно вот и всякие прочие вещи типа обновления которое может дожить не убив флешку не перейти реку буг не не потеряв вам еще не разбив камеру значит что с дистрибутивами есть белгород белгород это проект в котором ты себя небольшой репозитории которые подтягивают кучу разных исходников и это это конструктор для создания regular ведуны образа для обедов устройств это то что нам нужно вот для камеры та самая частая вещь есть всякие разные попытки всякие другие проекты типа йог ты чего то еще но мы с этим не сталкивались и здесь есть такие нюансы про клипсе на камерах не идет вообще потому что там нет места вот всякие есть у цели psy это самая частая вещь масло то тоже альтернативные всякие библиотеки с стадо лебовски но и которые дарт месячные либо вот но мы уберем то что уже идет на камерах потому что вечно удалишь почему значит терем подходим к специфике к специфике работы с камеры у камеры есть sdk это сложная штука его сложно добыть потому что например чтобы прийти к вам хай силикона сказать здравствуйте я хочу получить sdk камера не говорят прекрасно сколько миллионов камеры вы готовы купить в этом месяце ты говоришь пойду в другое место и здесь сложно потому что ты должен пойти к кому-то еще ну-ка часть таких таких кого-то еще их на самом деле много они отзывчивы и можно договориться значит следующий беда в том что китайцы лучших традициях patch патч от ядра подсовывают в же пильный код свой пакуются вместе значит здравствуй теперь но где джебель а где хай силикон и как бы ну как только в отменит поэтому здесь этим приходится жить поделать ничего нельзя поэтому например если мы берем камеру и даже испарина обычные на людей здесь не я не вижу ни одной скорее всего это будет некий два типа 263 и ничего с этим не поделать если там какие-то выводы руки именно в ядре то это будет грустным очень сильно завязана на чипсет причем номенклатура чипсетов она может быть такое что например там 3516 он новее и лучше чем 3518 но 3516 c он самый старый среди всего этого и с этим очень сложно разобраться то есть она все сделано так чтобы вот враг где-то по пути запутался испоганил всю свою аппаратуру и не разобрался значит классический то с чем мы сталкивались самого очень хорошо ложится на либо event то есть если мы берем например sdk берем обычную сильный либо event библиотека они вместе хорошо склеиваются сам всё ложится хорошо на событийную текстуру неких трендов не нужны в принципе без единого создания 3d можно сделать все очень классно и удобно вот и надо писать код но надо писать много кода дальше кучу кучу кода потому что вот sd каждая часть она неплоха а всю остальную плохо его нет вообще точнее и здесь у возьмем что если вы приходите на ком-то алиэкспрессе говорит дайте нам дайте мне из dk то вам дают нечто какой-то рар в котором куча делили и примеры на delphi знать что ощущение говорите я там джеком вам дали нерабочий sdk для того чтобы показывать в дали фавай программе видео с этой камеры вообще нету вот значит нам надо разобраться с видео и здесь вы знака как раз есть объяснение того как вам собирать правильно бил грушу на выходе всего этого получилось получилось получилось то что можно залить на камеру значит какая специфика разработки на таком девайсе самое важное что вот вы пишете кайта код и его очень сложно про прорвать тесты там в любимом вашим travis tritt travis их вообще невозможно там прогнать тот единственный способ прогнать тест это залить на камеру клип и и перегнуть подцепиться и получить какие-то данные причем мы вспоминаем что у стандартной флешки сколько у нас циклов перезаписи то есть при хорошем к мите можно раз в три-четыре дня менять флешку на камере точнее менять камеру поэтому здесь всякие разные хитрости тип нфс рута то есть на время разработки заливать на флешку вообще очень плохо эту закончится вторая проблема то что если вы пишете на сито стандартный способ отладки и общину написание кода носи это утро изучения core dump of то есть пришли открыв чили монитор налили кофейку и смотрим что там за ночь на наскребу лось если до ночи не было core dump значит вас просто некуда больше писать или сломалась место на которое писать вот здесь некуда писать курдам их вообще нет места ни какого то есть потому что это на все про все 8 мегабайт вот кто заливал linux на на на дискету про помнит этого ну я так и знал это это очень больно это очень болен и повторить этот опыт вот ну тут 8 мегабайт note 8 мегабайт еще на какой-нибудь там на картинку на png жку которую надо положить для конкретного клиента с его логотипом впрочем дальше нужно работать железом именно поэтому не загонять тесты потому что на обычном компьютере у вас нет вас этого ездока нету и она ни раба его не брать работать им железом с которым надо это больно и вот нам нужно писать носи но это делать не хочется почему потому что вот так выглядит стандартный программист носи после отладки камеры взгляд на две тысячи ярдов апать именно почему значит здесь мы пишем нет ни на пони по до почти не подвижен к мы пишем долго живущую штуку с подключенными клиентами арены нет всю память надо очень очень тщательно каждый аллоцирование байт надо трогать и не забыть освобождать иначе она будет подтекать подтекать подтекать и подтекать и потом к вам придет и скажет ребят я повесил тысячу камер и они находятся там куда у меня одно обследование стоит например там тысячи рублей они все повисли за неделю ровно строго за неделю значит сколько я потратил денег на их libre to reboot они я вот кто мне отдаст миллион рублей обратно значит ну все это стандартные вещи это сиквел ты проезды по памяти это кал бейки как основе способ конкурентности есть еще конечно картины но это для совсем смелых и бодрых таких вот бодрых вот как вот на этой картинке вот лучше который писал картины носи вот и самогона что это экспоненциальный рост в области разработки пока вас маленький прототип это все классно и весело как только у вас к этому прототипу добавляется система динамической реконфигурации фронтами например настроек железо мы начинаем плакать вешаться и просто не понимаем как собственно говоря это запустить как сделать уж бы ты работала и она ну долго делается что собственно говоря какие альтернативы вот я все плачу плохо плохо мы для себя выдели рас раст это новый язык программирования который претендует на роль 3 базовую вот у нас есть базовый ассемблер особенно парню людям с время внятно человек понятно ставок это нормальный человеческий способ писать на под софт под компьютеры вместо машинных кодов у нас м3 очень классно писать ну по сравнению с и вот но потом появился си который внезапно дал возможность переносить между компьютерами ассемблера и это было собственно говоря ничего никакой замены си за последние сорок сорок сорок семь лет не появилась статус 50 лет ничего не появилось нового вместо сей раз это чтобы который претендует на то чтобы быть хотя бы частично заменой сидят очень интересно что они обещают что обещают люди которые сделали дизайн языка они обещают управление железом на уровне сито есть в принципе все те же самые вещи которые есть все то есть это вот можно об с памятью именно с памятью на прямой несколько абстрактно виртуальными представлением контроль памяти они обещают лучше чем в си плюс плюс и этого в это верится то есть у них очень очень жесткая система memories safety то есть они обещают что работа работа с памятью будет в crippler у имам языке которой такой же пронзительный как эссе вот в нем будет мимо безопасность работ ставится такая же как в джаве также даже лучше значит в расти очень жестокая и беспощадная типизация просто на она очень сейчас покажу насколько она следующая вещь это к рутины то есть в расте есть готовое предложение по конкурентности и она опять же сохраняет все те восхитилась эти свойства то есть это безопасная это надежная это управляемое и самое главное что она очень легко не просто может цеплять код носи но и встраиваться в cod no se как библиотека а это уже не доступно никому кроме собственно говоря си ну и при особом мучение си плюс плюс а значит вот так выглядит раз для новичка почему значит во первых в россии есть контроля завладением что это такое это механизм который позволяет вычислить этапе компиляции какой кусок кода сейчас владеет какой памятью это позволяет избавиться и от сборщика мусора и от ненужного копирования потому что теперь раз точно знает что мы можем какие-то данные лоцировать на стыке и он точно знает до какого момента они будут нужны и что их немало никого не копировать не отдавать ничто не не не что с ними еще делать значит это вот ключевые слова умершей поборол в принципе с них начинается слезы любого 1 любого начинающего роста программиста я даже штука это жесткий контроль типизации вот если вы слышали про хаскеле здесь это все еще еще жестче потому что ну контакт стоит если вы собираетесь писать на расти стоят рядом не человек которым можно попросить перевести то что вот он что же он здесь такой пишет потому что контроль за типизации в расти очень очень жестокий но он будет бить вам пороком если вы например будете 8 битное число к власти в 24 бита или наоборот он нам скажет мнение так не пойдёт все это все это все это не годится переделывай явно указывать тип и явно указывает and ancient вот но это того стоит следующая вещь которая начинает рвать музыку это момент это то что контроля завладением будет через типизацию например мы делали я вот для эксперимента делала кусочек кода который позволяет из эрланга сходить к куску кода на расти и я понял что мне никак вообще в принципе не могу скомпилировать так чтобы я мог подредактировать данные которые пришли из орлан канут никак не компилится код потом внимательно прочитав я право что в принципе это подходит . с типизацию происходит запрет на изменения данных и его не обойти никак не какими там то есть нельзя сказать ему там дружище пожалуйста я лучше знаю тебя что делать вот пока там сейф не напишешь или если ты не уберу что все под мьютекс то есть он не говорит хорошо пожалуйста можешь пользоваться но убирает данные подменю так и тогда можешь их поменять а пока ты подведу вас не убрал я тебе даже не дам ни как поменять это охренительно удобно если у вас несколько людей которые пишут код до если тот в одном месте сказал что ребят эти данные они будут многопоточное использоваться вот я их сразу здесь вот размечу там нужно метками что их нельзя редактировать без мьютекс а то другой человек ни за что в жизни таких не доберется без без без без блокировки без захвата значит это больно потому что после кучменко ты начинаешь и так и сяк его давайте отправим здесь поесть поменяем вот тут запятую перенесем amante говорит не-не-не-не-не сходится пазл вот и на самом деле потом ты думаешь что это не что иное как перенесение сложности от всей той сложности который возникает в программировании кода на оси из вот из опыта многолетнего в требования компилятора то есть грубо говоря если бы перед нами стояло опытный программист на всем вы точно так говорил не я тебе не дам это запушить я тебе не дам переписывай вот и ты грешна что что что не так он говорит все не так вот все не так вот те раз природа говорит ну вот вот тут вот смотри тут у тебя вот бору traits и ты думаешь мне все все очень понятно вот поэтому при работе с ростова знакомстве с разным прах и стандартные стандартную ты вот стадии то есть нет я не буду этим боже мой да что это такое чтобы уже на seba все работало потом вот пожалуйста здесь чуть-чуть и потом начать следующий этап это к оперативность как обратилась надо честно расти это я бы стала так что то еще больнее чем все что чем рассказывал да ну вот маленький момент и что например даже раз будет бить по рукам если вы оставили переменные используем он скажет и это варнинг и варниг не убираем и потому что это все очень плохо это все дело дело дрянь из такие вещи делаешь вот значит про многозначность в расти какой она есть процессов в нем нету то есть процессов которые мем про и привычный по эрланга отчасти похожие процессы к по модель процессов есть в голландии здесь их нету это очень мне это очень непривычно и неприятное расстройство потому что процесс это хранить на удобная штука все мы знаем насколько удобность интервью никси в обычном процессов там есть процесс это классная классная вещь которую можно понять посмотреть что происходит там прибить кого-то а здесь этого нет нет этого есть всякие примитивы типа future вот кто сталкивался уже с кроме сами в java скрипте да можно да можно вот-вот поскольку люди не понимают как пальцы прогресс мир ява скрипте про мясо singh & weight это все настолько странно и везде разнообразно здесь нет разнообразить они одинаковые но еще более не более 5 лет почему потому что с этими футураме которые где-то там хранят ссылки на память у вас все еще сохраняется статическое управление памятью времени компиляции и вот это вот означает просто рвать в мозги потому что ты тоже чистую которая где-то хранится в памяти и компилятор все еще хранит данные на эти памяти знает точно когда это можно будет те лоцировать так как я сказал есть такая вещь на почту контроль за поточная безопасностью через типизацию то смазка что эти данные к ним нельзя ходить вот из разных потоков пока ты их там подбитых сам не за вернешь значит что у нас сейчас есть на расти из того что начинает да у нас вот то что мы раскрываем и писали все этапы мы прошли у нас сейчас есть айпи камеры в офисе на которой стоит наша софтина она там стерта все что было оригинального там стоит полностью наш софт он может заботиться о себе интерфейс можно увидеть в интерфейсе видео с этой камерой можно пойти к ней по rtsp можно даже поменять настройки работа еще уйма и но мы с этим будем работать иначе как от нас все это устроено с точки зрения уже роста в россии скачках сейфом сейф то есть сейф код это почти все все что есть а вот там сейф это там где можно мир пойти и адресные арифметикой пробудить в памяти pointer поменять в эту вещь которую в просто в расте сделать нельзя категорически а здесь вот подан сейф блоком это можно в хорошем коде on сейфа нет и быть не должно потому что это плохо ну как в любом случае во всех подобных системах экосистемах но вокруг видео sdk у нас есть и станции вход точно такой же ansa и вход нас вокруг его ct либо перезаписывание флешки и прочее прочее вот и для собственно говоря вещания для раздачи видео на раздаче для подключения похоть т.п. у нас есть покер с токио rs это токи в это такая эко-система внутри роста которая позволяет взять они короче это берем берется либо went ну своя реализация конечно плюс либо менты к нему приделывается механизм futura что редкой future и например у вас есть вы берете какие-то данные вода дать клиенту клиент медленно скачет вот этим про мегабайт целы из памяти и вот этот процедура по которой мы клиент socket клиента ожил мы отдали туда какое-то количество данных она больше не отдается кусочек блокируются мы потом еще раз то есть futura это те пытались которые вызываются чуть-чуть попозже когда-то там когда что-то случится и вот в токио как раз сделал механизм позволяющий вызвать кусочек который пошлет данные в соке тогда когда сопит оживает вокруг все этого е100 crysis 3 мы вот стримы эта штука позволяющая связать несколько future вместе вот на этом собственно вам начинает просто плыть здесь нужно очень много общаться тем кто пишет код вместе потому что здесь очень легко находит такого чтобы быть никому не понятно но за что то что может быть это мы можем получить транзакционных в ходе то есть например мы у нас система обновления конфига на устроена как мы формируем конфиг отсылаем его в центральный кусочек кода и дальше он кучу по куче куча разных кусков которые занимаются за видео под систему за сетевую под систему за какой то еще он спрашивает а вы можете вот поставить такие то значения если кто-то говорит я нет я не могу поставить я не могу памир порт и rtsp хтб на один порт назначить вся эта система обратно откатываться от все это это очень красиво и изящно немножко пугающая делается достаточно ну вот на на концепциях вот иных future которые есть в россии с чем что было неприятно вот реально неприятное в расти это а после эрланга очень непонятно непрозрачная экрана конечностью то есть это примерно как перейти на пример с классического linux на к enter тос в котором нет процессов вот именно это мы и получили мы сталкивались с тем что он прервал ланге из-за подхода которые в нем принят процессного есть многозадачность которая может закончиться тайм-аут грубо говоря один кусочек кода у другого чтобы попросил тот 5 за пять секунд не ответил и дальше у нас попав по лог-файла огромные полотна стектрейсы все рассыпалось все все как бы все плохо все пропало но мы можем прочесть по по логу что произошло конечно нас бы какая-то штука у друга что ты попросил и они встали в блоке и он потом через пять секунд сам развязался здесь такого нету здесь надо с этим все мощный аккуратно это отсутствие дефолт это может привести к тому что очень легко тихо она может просто залипнуть и начать ничего не делать вот у нас как раз такое было что мы из-за неаккуратного подхода ко всему этому видели что программа стоит ничего не делает не отвечает ни на 1 socket ничего с ней нету и все очень плохо вот к оперативность роста я считаю что это одна из самых страшных ним вещей которые гораздо страшнее чем чем все его тело типизация trade и бурову и прочее то есть осознать запихнуть в себя вот эту вот штуку когда у нас есть статическое управление памятью этап времени компиляции и приятным это связь это смешано вместе с многозадачностью это блин это сложно это реально сложно ну и из мелких вещей то что например камеры все старенькие у них арам в 5 стоит а официально сейчас все правильно человечество говорит что arm ниже чем в семь никогда не был его не существует и все что пытается поддерживать армирующим в семь это просто общается это в это плохо это уже пирло вот но тем не менее мы смогли этом немножечко с этим побороться и завести на не поддерживаем архитектуре наш наш кусок кода на расти также раздать есть традиционная проблема это одна из первых которой все обсуждается у клиентов но у тех кто не пишет еще программистов и это гена гигантские бинарники этаж там где она про кусок кода носи займет килобайт 40 здесь будет 3 4 мегабайта вообще сразу просто но это 3 4 мегабайта в которых которых легко можно смело выкинуть не про там три с лишним мегабайт и потому что это там одна либо другая либо вот еще про запас положили этого и еще того всего и еще там что и подсунуть она все потихонечку занимается этим заниматься то есть если например мы говорим про эппика миру которой флешка на 8 мегабайт то здесь простите лишних 3 мегабайт нету ведь это надо про с этим надо работать что мы получили с раз там на такой вот экзотической странной архитектуре как айпи камера которая чужая которая которой нет доступа к и разработчикам как искал другая модель на конечности она рабочая из цифр там где стандартная пика мира отдает 2 3 4 клиента у нас было больше 50 обслуживали на тестах но вот это было просто как мы разобрались со всякими залипания my системы приятные и неприятные вещи одновременно то что сложность отладки переместив в компиляцию для девайса которые нельзя перепрошить это в целом хорошо то есть чем больнее на чем больнее вот чем левее то двигается вся боль тем лучше то есть если мы сможем заставить всю боль от получить именно и счет в офисе на разработке это хорошо дальше она будет просто работать мы надеемся но это число ваших слов сходство на скомпилировать то есть время на разработку легко может скакнуть где-нибудь взять и прибавится там недели две недели потому почему потому что внезапно выяснилось что мы не можем там джейсон расспросить потому что оказывается там по системе типов она вот тут нельзя быть из расспросите все надо перекроить и вот система что да действительно на самом деле это же ведь и вот она не потому что какая то здесь вреден это придумала потому что здесь так все вот получается что если мы сделаем это здесь у нас будет утечкой памяти но выбора не узнаем только там через через год мучительными кровавой отладки на продакшене могут у клиента там под потолком на 5 метровой высоте десятком ноутбукам мы сможем там это увидеть а так мы это видим здесь при компиляции и вот у нас например придется время разработки нас не было ни единого сиквел то для софта носи который может достаточно ним немало уже я считаю вечно просто хранит нас не не ни разу за все время нашей разработки наша софтина на расти с фолком с коркой не обсыпалась вот этого собственно говоря вот о чем я хотел сказать режимы что вселенная эти камеры можно работать это классные хорошие дешевые устройства их можно курочить их можно переделывать под себя и можно даже никого про это не спрашивать о просто немножечко любознательность и интерес и и паяльника и это как бы это потом масштабируется на большие объемы и писать на расти под такие камеры тоже под такие девайсы тоже можно это больно это будет в новинку практически все что там есть но мне кажется того стоит что так если какие-то вопросы раз-два да у меня вот такой вопрос месяц будешь доклад по смежной тень его эти обновления вот вы обновление вкачиваете на ваши девайсы да значит стандартная практика для всех айпи камера то что во время обновления категорически зачатия питания потому что значит ну вот потому что кирпич до тоф вкачиваем это не особо что страшно то есть ну кроме того что значит в чем проблем обновлениями проблемы с ними есть том что если например вы перри записываете основную флешку-то если вы от мент будет скачок питание она будет не до тесной больше не загрузиться с этим можно сделать что с этим можно сделать например если у вас флешка на 16 мегабайт вы можете покинуть свой 8 мегабайт потом и как бы нахлёст амита одну планку до 2 планку и так вот пл одно то другое после чего вы перезаписывать вторую половину который не использовалась и в загрузчике меняете ту откуда грузится ну очень страшно трогать загрузчик но в конце концов авось пронесет значит мы пока просто как все перезаписываем по живому надеюсь на то что никто питание не трубят в процессе перезаписи вот мы стандартные вещи например некоторые вендоры подписывают прошивку ключами очень умна делают они подписывают симметричными с ключами думаешь что они секретные вот ну это успехов поэтому я здесь не ответил на вопрос да тогда интересно конечно я думаю что вы подробнее расскажите так дальше дальше дальше очень интересный класс спасибо большое хотелось попробовать раз собственно вопрос по конкретно железу вот вы описали процесса прошивки ваша камера очень много даже вспоминали собственно сетевое устройство очень похоже на процесс внедрения поддержки нового там новой точки доступа в проекта пан врт вопрос как бы конверте очень такая расширенная обширная система для разработки очень удобно очень просто и как бы вот счас на вопрос почему бы не почему мы находимся в стороне от движения в prt значит как я уже упоминал мы очень жестко находимся в в том что у нас есть вот если sdk например от вендора который говори конкретно sdk для конкретной для конкретной железяки и у него дара свой компилятор там есть который то ли стандарты то ли нестандартной пойди его разбери потому что менять в очень не хочется он собирает куски ядра и если получится одним компилятором собрано одни модуля ядра а другим компиляторах мусорных другие модули ядра то вот моя бытовая мой опыт подскажет что это закончится плохо поэтому лучше здесь не не не выпендриваться использовать то что дает вендор значит по поводу других вещей но к систем разработки вот мы еще вообще сейчас выбрали другую к систем разработки то есть мы пользуемся разным фактически у нас есть софтина которая там последние то на компе лиц и пападжи лиза запускать или мы все и apple отлаживать она уже всеми средствами самого роста они а никаких других систем то есть вы работать на ядрена компиляторе от производительность для акций к сожалению пока все жалости это так приходится с этим максим отдельное спасибо за пусть хоть и косвенную рекламу первым разрабатывает нарасти где ты берешь разработчиков на разного начинается значит нужно найти на сегодняшний день я считаю что кадры вопрос поиска разработчиков на 1 это немножечко такой преждевременный то есть скорее нужно найти того человека который готов к себе это принять пример если есть дело pero no se который поведал всякого и поел продакшена то скорее всего ему просто показываешь раз и дальше это будет блин ну так можно черт так вот то есть это я считаю что из того что я видел до своего не богатого опыта написания на оси я был просто кристаллизованные и очень жесткие структурированные требования к хорошему кода носи вот они все воплощены виде компиляторы и получился раст вот собственно говоря то есть это не то что у нас теперь есть и плюс плюс для которого нужно все что тебя ты знал выбросит навык потому что нос сильно siplus перейти эта смена вообще смена очень много чего то есть перейти на рои вместо управления больно здесь нет так здесь просто будет я считаю что продолжение продолжение опыта носи у тебя это хищники основной весь вообще сидел на china com которые не не на не носи писал то есть не таджик просто он просто просто толковые талантливые просто мне интересно кому хорошо заходит раз не могу тебе пока сказать то есть я наберу чуть-чуть опыт позанимаюсь наймом и обязательно поделюсь окей спасибо здравствуйте да доклад как программист на скале мне очень интересует стримы которые есть расти и включи соответствие как я понимаю там есть определенные тот пал на которых все выполняется все тоски значит это в расти сделано в виде виде примитивов которые можно пользоваться то есть нет никакого имплицитного трат пула хочешь дэдпул ты заводишь отдельные 3d и на них ты пишешь систему которая будет раскидывать какие-то задачи тоски и прочее значит до тоски в расти есть иная концепция task of those можно взять и по кусочек кода по выполнять каком-то 3d для этого она существует но это чуть-чуть уровнем ниже это не не имплицитно утра тпу в котором это будет выполняться а это ты должен где-то сам все это хранить то есть когда я какал протоки отталкивает окрас инфраструктура для того чтобы в одном месте получить реестр и этих вот стримов task of future утра всего то есть очень похожи на либо вент вот в этом плане на самом деле и для того чтобы это было многопоточное то нужно явно эксплицитно указывает что у тебя есть разные потоки как только ты будет выполняться то есть это вот оно вот так надо явно сказать что мне требуют 3d ok и второй вопрос а также к стримам если бы проще так так так так так значит вы сталкивались да да она в каком-то виде существует я немножко счет до конца разобрался в нем как там везде во всех случаях пользоваться вот то есть да она существует и можно можно по краям можно понять что дальше перепугался канал то есть можно связать несколько стримов вместе через каналы и может вечно канал забит и на прыскать нет пока не готова от отстаньте ходи позже и также по стрелам что является единицей стримах то есть это какой-то grove street шили что что есть я предстоит функция какая-то или что да эта функция которой значит по моему там вам о там сейчас темпом две функции говоря можно спросить готов ли ты выполняться не готов если готов отдать кому-то нет объект у него есть одна функция которой можно дёрнуть спросить готов выполняться или не готов с другую же выполняй ся вот если он в колда готов а сам не выполнился но тут как бы разве не сам сам напросился вот и вокруг всего этого на вернут а еще механизм то есть например вот такой полинг да он не работает с сетью то есть нельзя обойти 5000 софитов и спросить готов не готов готов не готов этого ментально не работает поэтому для этого для доктора это можно принцип а если есть фактор это можно в принципе для этого они должны сами под ней из качество вот вот вот тебе вот тебе мой совет вот и сам туда смотри и когда когда значит socket вернется на ноги поле тогда пожалуйста спроси меня богу ты готов не готов то есть это единица это все-таки по моему объект да это объект у которого есть функция можно не можно и выполнить спасибо ну примерно вот так взрослые спасибо за доклад у меня такой вопрос алгоритмы кодирования видео его передачи такте psp 1004 вы их сами реализовывали как значит смотрите по в видео есть очень жесткий прям вот кардинальный водораздел между компрессии видео передачи видео компрессия видео то есть приращение сжатого в а кодированное это фантастический ресурсоемкая задача потому что нужно примерно 1 гигабит в секунду сжать до 1 мегабита в секунду на там до 5 то есть примерно в стокеры в тысячу раз уменьшить количество данных которые передаются при этом воспользовавшись целой массой разных инструментов ни о каком специализации на эти камеры речи не идет идти не может в принципе потому что это всего столько аппаратно то есть выглядит это как есть сенсор сенсор вот тут в чип через какую-то шину этот чип делает видео на выходе его от этот чип он живут над оперативную память который они даже не будет linux и в этой памяти раз в какое-то время появляются сжатые кадры а дальше уже мы получили данные котор который дело техники упаковать порезать на части упаковать делать контейнеры протоколы сделать это то что мы делаем уже много лет и мы это делаем не плохо это уже мы делали с вами the heart sp мы написали сами а мне сложно оказалось вот о сжатии видео нет это совершенно другого рода задачи этим занимаются буквально единицу и второй вопрос вы планируете это распространять да и огромных людей а да да это вопрос на который мы сейчас на самом деле для меня лично назначить ответ возможному этого консорциум все то есть если мы если мы найдём способ как это сделать как это обернуть нам во благо там этого пункта с ним если это будет достаточно количество ну то есть это будет видим какой-то профит спасибо спасибо за доклад раз довольно активно развивается выходит новая версия насколько активно вы обратитесь обычно новая версия компилятора раз достаточно то есть мы сейчас мы на самом свежем и найтли причем без на этом даже не работает а часто она потом при переходе на 100 ballomax а ну конечно возникают нюансы то есть нюансы возникают но так чтобы приводило к деградации ориентирующего софта у нас не было вот то есть нас честно говоря меня больше беспокоит то что не про нас отдельный форквут и мной вокруг обертки вокруг липси которые потом b5 это меня гораздо больше парит чем чем то что на стоит ли с этим вот проблем не было хотя я понимаю что они в принципе могут быть у меня вопрос вообще насколько целесообразно такой проект вести потому что вроде бы вот есть там watcher да то есть можно на него камеры с базовой прошивкой завести все остальные лишь ники закрыть и уже какие-то функции уже централизовано делать у крупных заказчиков это наоборот будет даже им удобнее а вам выгоднее зачем до вопрос зачем нам делать что-то на камере с нас есть усердный софт как я уже объяснял вопрос других фич например у нас есть клиенты которые говорят нас к висит камера на lt и лить видео pl toyota дорого над реально дорого постоянно до этого всех местах это будет пока что везде дорого потому что радиоканал он не рианнон это то что не масштабируется никак вообще и поэтому нужно чтобы на камеру лила видео только для когда есть это сигнал по какой-то причине и здесь все камеры начинают лить все что уже поздно и не актуально мы хотим ведет ашман отдавал например предыдущие предыдущий н минут который в памяти накопят чтобы это все было надежно чтобы это все при этом не не весна и нет не падала такого практически у кого нет вот вот один из примеров того что мы хотим сделать а нет это еще целый там перечный разбирать ряд задач да да да ряд задач ну как как как вариант вот плюс стандартные вещи то что например и как искал айпи камер если вы вешаете и на столб она вот это в switch потом ещё один switch потом еще хоп то на выходе вы получаете плохо работающий нечто что сыпется обсыпается покрывается зелеными квадратиками виснет и прочее то есть вам нужно очень хорошо защите кадрировать если у вас большая сеть с камерами такая проблема еще каким-то образом спасибо большая"
}