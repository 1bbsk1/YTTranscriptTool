{
  "video_id": "YLFwkbTvb-4",
  "channel": "HighLoadChannel",
  "title": "Интерактивные 3D-карты своими руками / Александр Амосов (Avito)",
  "views": 3190,
  "duration": 2772,
  "published": "2018-01-16T13:29:24-08:00",
  "text": "Всем привет Меня зовут Александр Амосов сегодня Вам расскажу как можно что фейл сейчас всё равно расскажу вот всё-таки расскажу тем более немногие пережили обед расскажу про трёхмерные карты Как можно сделать своими руками какую-то трёхмерную визуализацию и расскажу это на проекте которы в рамках Авита немножко пару слов что это за проект его история компания у нас активно развивается появляются новые сотрудники и появляются новые этажи и так далее и появляется проблема навигация в офисе банальная до недавнего времени были вот такие схематичные карты чтобы это карта одного из этажей где показано вроде как схематически что где находится но она во-первых фиксирована с течением времени что-то меняется там не знаю видно нет показаны какие-то отделы Э где там кто работает но эти отделы постоянно там люди пересаживаются и это вообще неактуально и ещё больше проблем найти нужного сотрудника именно а не где какой-то там отдел а именно сотрудника Где находится и вот была у нас такая мощная таблица в конфлюенсе где а ячейки - это как бы места сотрудников а то что вот написано имя - это вот типа на этом месте Человек сидит чтоб если с воображением не очень хорошо то Вот примерно Это соответствует вот этой картинке на новых картах То есть это вот такая схематичная карта была можно сказать в Экселе в Экселе можно сделать всё что угодно но не всегда это супер хорошее решение и поэтому появилась идея сделать это как-то более удобно чтоб новый сотрудник пришёл там нашёл кого нужно и каких там проблем у него с этим не было и в рамках ви стати немножко подтормаживает просто КТА так записал на самом деле всё окей и ещ Я преобразовал в powerpint поэтому тоже немножко качество потерялось вот собственно вот такой проект где можно трёхмерный карт где у нас там все есть этажи можно забить какого-то человека узнать где он находится посмотреть там какие-то его контакты получить и там банально ка переводится ного были споры такие как вот делать мне вот говорили что зачем вот это 3D это всё непонятно все привыкли двухмерным картам они понятны их легко быстро можно сделать и вообще привычная такая штука что вот давай это двухмерной делать но почему было всё-таки выбрана трёхмерная реализация во-первых Я считаю что это красиво потому что у меня ресурсов каких-то не было очень больших и вот исходно у меня бы вот такая сгя схема И если бы я вот её взял как она есть и вставил на страницу то это было бы наверно ну не очень красиво мы её вставили как есть вот эту двухмерную реализацию и это выглядело не так красиво А благодаря 3D оно и каких-то там Нюшка и просто перспективе оно выглядит уже более как-то нарядно второе - это э такие карты Мне кажется более наглядной потому что мы все существуем в трёхмерном измерении всё же а и удобно повернуть как тебе нравится и с ориентироваться Это очень прикольно мне кажется Ну и самая Наверное главная причина потому что в принципе я это могу Мне это интересно и двухмерного реализацию Может быть я и не стал делать а как бы 3D Ну окей классно с чего всё начинается а начинается всё с создания модели А тут как бы есть варианты в принципе самый идеальный Наверное вариант - это найти какого-то там знакомого человека который разбирается в 3D Максе там и В подобных программах и чтобы он вам всё сделал и вы потом уже эту модельку просто взяли А второй вариант Если у вас такого человека нету скорее всего у вас его нету это найти на каких-то сайтах какие-то готовые модельки и что-то такое подобное и третий вариант который в принципе на самом деле обязательно он без скобочек опционально потому что вам в любом случае это нужно просто вопрос уровня погружения Если у вас есть молер то скорее всего вам там ну максимум что-то посмотреть допустим если он молер накосячил проверить почему что-то не работает а если у вас есть готовая модель скорее всего вам всё равно что-то надо будет подфункция такая программа для трёхмерного редактирования это вот как 3D Max только от мира Open Source он очень прикольный бесплатный есть под все основные платформы а он постоянно развивается и в нём есть ещё такая очень классная фишка что всё что можно сделать с помощью скрипта с помощью блендера можно сделать с помощью питон скрипта обычного и даже вот можно навести на какой-нибудь элемент интерфейса и там по хове покажется вот какой там метод допустим надо выполнить чтобы вот получить эти данные или там чтобы сработала эта кнопка и так далее А ещё классная Фишка в том что он по умолчанию поддерживает импорт из свг У меня как раз исходный материал был в свш поэтому мне это очень подошло выглядит это вот примерно так что мы да да да всё нормально выглядит так что мы просто выбираем импорт свг импортируем всё это дело в треугольнике и потом просто вот так вот вытягиваем стену сейчас будет опп Вот вытянул всё в принципе у нас уже почти всё готово Единственное что не было это стульев то есть именно сиденья на которых находятся сотрудники их пришлось расставлять вручную в блендере Тут ещё тоже такая заморочка была в принципе эме вот их просто нужно было клонировать по сути Ну с небольшим сдвигом Но их удобнее всё расставлять места это когда ты смотришь Сверху просто и тут может возникнуть Вот такая проблемка что вот сверху мы смотрим вроде всё О'кей а на самом деле они вот так вот на разных уровнях находятся и плюс когда мы клонируем их можем нечаянно склонить так называемую геометрию геометрия - это вот собственно точки из которых состоит наш Ну как каркас по сути а То есть если он продублированы это не очень хорошо и тут на помощь приходит собственно Вот одна из фишек которую рассказал что можно использовать питон скрипт тут мы просто берём геометрию вот этого места пробегам в данном случае по выделенным а объектом сбрасываем ration Если вдруг немножко где-то что-то подвернуть указываем чтобы они ссылали все на одну и ту же геометрию что это все инстансы одного и то же геометрии и вот эту высоту там Z ось направлена вверх и соответственно мы её сбрасываем до Ну ещё что я хотел что в блендере было сделано это были запечене тени А для сравнение вот на слайде показано Как выглядят просто плоские какие-то объекты Ну без всяких затенения и как они выглядят затенение с затенения соответственно это более прикольно выглядит объёмно и так далее Причём здесь использована техника А затенение в реальном времени амбиен ocus взаимное затенение объектов То есть когда объекты рядом находятся они как бы немножко Вот вместе с Тыко появляется Тен ушка и даже видно вот на видео что вот как только тени появляется она немножко начинает так под видео подтормаживает такие тени запечене справа - это собственно текстур а слева - это текстурные координаты по которой это текстура накладывается как бы на объект Вот ещё один пример как такие текстурные координаты выглядит Ну и собственно по сути нужно там после нехитрых действий в нажать кнопку й выбрать что Вот именно вот это взаимо затенение и запечь Почему не какие-то реальные тени потому что ну я не очень хорошо разбираюсь там в каких-то трёхмерных редакторах сложно было там расставить все эти источники света Красиво там чтобы всё вот это фактурно там было классно поэтому взаимное затенение уже О'кей А вот можно сравнить как плоская реализация выглядит и соответственно с Тен ушками с моделями разобрались модель считаем что у нас есть и теперь нам а нужно это встроить в браузер чтобы могли все пользоваться и так далее а тут на помощь нам приходит спецификация webgl А что это такое немножко истории Web jel - это основано на спецификации Open jel для Bed Systems версии 2.0 а которая по сути почти что повторяет то есть небольшими изменениями а Opel для mbed system в свою очередь является под множеством просто спецификации Opel только рассчитан на мобильные всякие устройства то есть там вырезано по сути лишнее есть сейчас weel уже версии 2.0 поддерживается браузерами но в распространение не так уже велико ещё в браузерах поддержка Ну ещё там мая пунти ком указал есть сейчас какие-то обсуждения но непонятно на что он будет и будет ли Вообще и ориентироваться уже вот вулкан есть так называемый Может на него будет ориентироваться непонятно подж ля первого очень хорошая Она по сути везде поддерживается на аох Андроидах и так далее В принципе с этим проблем нет с 2 вот для сравнения всё не очень пока хорошо Поэтому пока пока подождём и для давайте для того чтобы вникнуть в jel сравним опять же двухмерную трёхмерную реализацию допустим сделаем какой-то тест простой нам нужно сделать а обычный красный квадратик и как это будет выглядеть с реализацией двухмерная и трёхмерная двухмерная реализация Ну вот на канвасе довольно простая У нас есть элемент кавас мы берём его двухмерный контекст выставляем каким стилем мы его заполняем и собственно рисуем этот прямоугольник квадрат трёхмерная реализация вроде бы поначалу похожа мы берём кавас берём контекст и тут вот такие комментарии много а я сразу предупрежу сечас вот немножко расслабьтесь расслабьтесь Да и не сильно вте через пять слайдов вы поймёте почему Ну идём дальше что нам нужно сделать первое нам нужно создать вершинный шейр его скомпилировать передать вот этот код скомпилировать потом нам нужен фрагмент най шейр который по сути на выходе просто Дат красный цвет мы его должны опять же этот код передать скомпилировать потом нам программа мы притачивание его потом просто нам нужно всё это отрисовать вот так легко у нас получился красный квадратик Вот вы наверное поняли что web не так прост вот он довольно низко уровне куча каких-то методов причём в них миллион каких-то аргументов что-то там передаётся причём это был упрощённый код он рабочий Но упрощённый потому что там нет каких-то проверок на то что скомпилировать и так далее которые в реальной жизни будут если хочется вникнуть именно вот такой нативный есть отличная книжка она есть на русском языке рекомендую почитать э Мне очень понравилось там очень доступно и рассказывается с самых озов вот буквально каких-то там нарисовать квадрат треугольник Да уже когда там полноценные какие-то трёхмерные объекты с тенями отбрасывающий и так далее Вот Но если у нас нет времени на это разбираться А а у нас скорее всего его нету потому что даже вот проект который я делал он был сделан в рамках хакатона за пару дней там первый какой-то прототип с двух с двумя этажами был сделан и поэтому тут на помощь нам всеми любимые или нелюбимые фреймворки приходят Я использовал Web jel Framework 3GS как самый такой популярный и используемый скажем так и вот с помощью него самый главный Профит - это в том что он создаёт какие-то удобные абстракции с помощью которых можно всё сделать намного более быстрее и меньшим кодом скажем так вникая не вникая вот этот весь низ уровневый API Ну и поначалу там там да не нужно каких-то там шейдеров что это такое непонятно указывать вот этот пример взят из redmi 3GS то есть ну я буквально там какие-то теры поубирать посмотреть скопировав этот код в свой браузер по сути мы уже имеем полноценную трёхмерную визуализацию причём не просто какой-то там квадрат обычно это как именно трёхмерный квадрат который ещё и вращается немножко разберём этот пример хорошо видно видно Отлично А у нас есть некая сцена это какое-то такое виртуальное пространство а этих сцен в принципе может быть несколько Но обычно она одна это как если у нас несколько сцен как Параллельные миры в принципе это вот мир которым мы хотим заполнить есть камера это собственно то откуда мы будем снимать и откуда получать картинку А вот если это показать визуально то у нас есть вот какое-то некоторое пространство абстрактное и мы ставим из которой мы вот будем фотографировать или видео записывать потом у нас есть участок кода где мы создаём объект тут у нас обычна обычный куб создаётся создаётся материал в данном случае он красного цвета просто красный цвет задаётся и когда мы объединяем вот этот каркас то есть кубической как бы геометрию и налад нанм материал мы получаем уже красный кубик и соответственно вот кидаем На вот эту сцену на наше виртуальное пространство Вот то есть это выглядит где-то так кубик конечно здесь не красный но представим что он красный Вот и следующий этап соответственно создаётся некий объект Рен в нём создаётся там кавас и вот всё вот это взаимодействие с в данном случае мы просто задаём размер чтобы он был во весь экран и добавляем в Бади после чего нам просто нужно вызывать функцию вот кото Frame себя Ну и тут ещё плюс кубик вращается Таким образом у нас есть полноценная визуализация где у нас есть кубик он вращается всё отлично плюс вот этот если взять участок кода где мы просто создаём куб какой-то а его легко заменить на вот такой код где есть р и мы вызываем у него метод Lo для того чтобы загрузить модельку и уже на стен добавляем не какой-то там абстрактный неинтересный куб а именно наша модель и соотвественно уже видим в браузере свою модель это вообще уже уже круто причём как вот получить вот эту модельку есть в жесе уже готовый экспортер который нужно подключить то есть по умолчанию в блендере его нет но можно его подключить и он экспортирует в некий JS формат в который можно уже импортировать на сцену а единственное что не хватает Ну мы увидели скорее всего наш модель а но мы ничего не можем сделать Ну смотрим мы на неё даже картинка будет тупо статична а поэтому нам а нам хочется чего нам хочется вот взять эту модель как-то покрутить с разных сторон посмотреть там что как вообще происходит и в жесе опять же уже есть в этом плане всё А есть некие так называемые Orbit контролс которые уже они не как бы не в основном лежат в папке там 3GS А в эмла то есть очень много всего лежит в жесе в экзам То есть она не в кор код как бы не входит но можно дополнительно подключить и в принципе вот мы подключаем эти Orbit косы вот берём вот этот участок кода и добавляем вот одну строчку что нашу камеру Вот она управляется вот этими Орбит контрола И после этого можно мышкой уже вращать нашу модель то есть мы зажимаем левую кнопку мышки на начинаем двигать мышкой и она уже двигается там зуми Вся она вот приближается отдаляется вот Это пример из 3GS в принципе там как раз есть загрузка модели а и вот контролс вот эти которые наглядно показывают То есть в принципе это уже наша почти полноценная визуализация можно взять не знаю если мы продаём часы взять сделать какую-то модель или найти в интернете если это там какие-нибудь уже известные часы вставить в браузер и вот человек уже ходит и уже Может её приблизить посмотреть с разных сторон И так далее чтобы подробнее вникнуть вообще в мир трёхмерной графики на основе используя frw 3GS есть отличный курс на Юда сите очень весёлый там на английском языке правда но очень прикольный очень весёлый Там рассказывается буквально там всякие основы и именно как вот всё сделать с помощью 3GS фреймворка это когда мы в принципе уже всё освоились но нам хочется больше И вот Собственно как можно устроить работу уже какого полноценного приложения а ну не просто крутить вертеть А уже какой-то функционал дополнительно навесить расскажу как я как это сделал Я у себя я разделил приложение как бы на две части вве - это вот собственно та часть которая отвечает за работу с канва сом за работу с webgl в нём у нас есть вот эта моделька с запечёнными тенями А есть ных объектов это когда мы кликаем на вот этот кавас и определяется какой элемент трёхмерного пространства мы при этом попали кликом Ну допустим для выделения мест в данном случае или получить информацию по вот иконку посмотреть что это такое и для иконок собственно используются спрайты это как наверное Кто играл там в первые трёхмерные шутеры Там в каком-нибудь первом Думе все там противники смотрели всегда на Вас как бы вы не пытались их обойти они были двухмерные просто вот так смотрит на вас как двухмерная картинка и вторая часть - это юана которая классическая накладывается поверх канваса и там у нас есть какая-то интерфейс стандартный то есть в данном случае это поиск авторизация там выйти войти и по этажам перемещения То есть это можно перемещаться по этажам к примеру как в трёхмерной реализации там вот эти блины выбирая Так можно и с помощью с классического двухмерного интерфейса Почему выбрано два таких независимых блока потому что в принципе это мне показалось удобно что если вдруг даже у кого-то там не поддерживается wgl мы можем быстренько так раз ввер подменить ну или даже поддерживаться потому что мы смотрели что поддержка довольно хорошая Ну там допустим тормозит или ещё что-то можно подменить вве другим допустим какой-то вообще двухмерной реализации где там просто статичная картинка и всё Ну просто показали нарисованную картинку Это уже хорошо допустим но UI может остаться тот же Ну допустим там подсвечивать места на этой двухмерной картинке и всё управляется через Red то есть ну все наверно в курсе а что допустим если какое-то действие происходит создаётся экшн Ну мы можем вот в данном случае этаж выделить как А на трёхмерной схеме кликнув на этаж так и вот в двухмерном интерфейсе соответственно произойдёт этот Action обновится состояние приложения и оно потом распространится на обе части на вьювер и на UI в принципе всё как бы Казалось бы всё должно быть отлично У нас есть моделька мы её крутим вертим есть функционал есть интерфейс который там друг с другом взаимодействует но тут скорее всего вы столкнётся с проблемой что вот к вам придут пользователи скажут всё тормозит А если вы раньше этого не заметите конечно расскажу что какими проблемами столкнулся я и что помогло а первая проблема была вот в сафари на на макбуках у нас в основном на работе у всех макбуки Вот и в сафари говорят вот тормозит причём если посмотреть показывается вроде бы как все там 60 FPS всё хорошо Но вот по видео видно что такими рывками всё происходит Я долго разбирался В чём может быть дело всё отключал причём это только вот Сафари других там в Хроме всё отлично в фаерфоксе нормально именно вот в сафари долго разбирался всё отключал всё что только можно всё равно тормозит потом я взял вот тот который пример Я показывал 3G тупо с кубиком запустил его и там тоже тормозит Вот и оказалось в чем дело есть такая штука это аппаратное сглаживание там никаких усилий для того чтобы включить не нужно делать можно просто указать вот Ай будь то голый weg или с помощью 3G и картинка Становится лучше причём из-за того что это аппаратное сглаживание она быстро и каких-то проблем я никогда с ним не замечал Вот Но почему-то вот именно в сафари обнаружилась такая проблема причём это вот на на рити на экранах когда там огромное разрешение Ну видим Macbook большое огромное разрешение ви дюш они как всегда слабую засунули вот Вот и поэтому Ну именно в сафри Я не знаю Ну не разобрался помогло Отключить Вот этот антилай именно в сафри на Тине и вот основная наверное проблема Это что вот люди жаловались что у них ноутбуки взлетают запускают они тришку и кулер начинает нистого крутиться шуметь и так далее Вот и люди закрывают говорят что-то у тебя шумит вообще взлетает всё тут тоже всё оказалось просто даже вот в примере который я показывал есть вот эта функция Animate и в нём по request Animation фрейму она вызывает сама себя но дело всё в том что нам это в принципе не нужно допустим мы повернули модель картинка статична ничего не происходит но при этом видеокартой Frame срабатывает Ну 60 FPS в идеальном случае 60 раз и соответственно видеокарта мучается отрисовывать отрисовывать А ничего не происходит то есть ну зазря просто мучаем видеокартой поэтому вариант такой что не рендерить когда не нужно а начинаем вращать камеру начинаем как-то взаимодействовать Всё движется мы запускаем рендеринг он запущен как только мы отпустили кнопку мыши перестали вращать камеры и соответственно Всё мы можем остановить у нас картинка статичная нет смысла этого дальше ну и соответственно если как приложение состояние приложения как-то изменилось то есть допустим мы через двухмерный интерфейс выбрали какое-то место его нужно подсветить мы можем вообще просто один кадр отрендерить и всё он уже подсвеченный а следующее про что я хотел рассказать это про Стинг немножко Что это такое Я уже упоминал его это вот когда мы кликаем на кавас создаётся в трёхмерном пространстве вектор и просчитывается Какие треугольники из которых состоит стоят объекты этот Вектор пересекает соответственно Какой первый объект мы пересекли треугольника Какой вектор мы первый пересекли соответственно мы его выделяем в жесе это выглядит вот так у нас есть некий ре Кастер мы передаём координаты и камеру и соответственно объекты по которым нужно проверить Какие А этот Вектор Ну на какие проверку То есть если это мы места хотим выделять там объекты мест нужно указать и соответственно получаем пересечение В итоге Но если у нас модели довольно большие а из Больших большого количества треугольников состоит то это может занять большое время то есть по сути нужно перебрать все треугольники с которые состоит там вот все объекты поэтому используется что можно заранее в том же блендере создать некие объекты которые как бы описывают объект но состоят из очень маленького количества треугольника вот красным показано А и его не видно на сцене то есть мы его можем вообще невидимо сделать или на отдельной сцене но рекан происходит именно с ними и таким образом соответственно река у нас происходит намного быстрее причём если для этажей вот пришлось их вручную создавать потому что ну тут такая геометрия сложная скажем так то для мест можно вообще генерировать автоматически в Джес коде то есть мы берём место просчитывать у него минимальную максимальную позицию по иксу там по игре по Z Ну по Z даже не надо а и соответственно у нас есть такой квадратик Из двух треугольников состоящий и всё Вот именно рестим мы с помощью этого квадратика с какими-то местами более сложными там такой трюк уже не пройдёт и поэтому там нужно опять же или вручную создавать или оригинальную использовать но соответственно много треугольников будет и самое что дало большой прирост это использование так называемой техники инстан Синга А вот результат примерно показан слева до его использования У нас есть 365 д колов это дл - это отрисовка на видеокартой В чём смысл Когда у нас есть однотипные объекты Помните я вот рассказывал что у нас есть места и мы их они ссылаются на одну и ту же геометрию просто это как бы разные инстансы находятся в разных местах с разным цветом Вот смысл и это нам поможет в инстан Синг Потому что если у нас одна и та же есть геометрия то есть по сути объекты одинаковые у них геометрия просто различается именно вот эта позиция и цвет мы можем применить вот эту технику и с помощью неё снизить количество отсо на видеокартой объект и он отрендерить за раз за один проход в этом нам поможет вот такой экстен он везде есть в принципе он спецификации 2 прямо входит в спецификацию Вот это inst но в первый он не входил но есть этен причём этот экн поддерживается всеми браузерами по крайне мере я не встречал где он не поддерживается а и с используя него можно эту технику применить немножко попробую объяснить как это в принципе работает по умолчанию у нас есть вот допустим четыре места в четырёх разных позициях четырёх четырёх цветов разных А обычно как происходит Мы придаёт юниформ это такие данные которые вот распространяются на на на программу целиком то есть э придали Вот вот этому месту он за один проход он фиолетовый к примеру и находится здесь потом оранжевый Там и так далее но если мы их эти места объединены в один бач как бы то передавая одну униформу они будут одного цвета и даже больше они будут в одном месте находиться ку кожаные поэтому передавать Вот именно вот эти данные цвет позицию Дале атрибуты - это такая штука которая передаётся для каждой вершины отдельно То есть у каждой вершины может быть с свой атрибут Но в данном случае у нас по сути для каждого места для каждой Ну допустим для фиолетового для каждой вершины этого фиолетового сидения будет придаваться атрибут вот фиолетовый цвет и ну и позиция что в принципе стоит знать про ИНН это то что это сильно повышает производительность если у вас много есть однотипных предметов вас тормозит это ну прям большой прирост даст Но это сложно Я даже не стал показывать код вот снизу есть ссылка это там примеры из 3 можно почитать Как там всё происходит и следующая проблема с которой вы столкнётся это в том что вот появится Вот такая папочка ну в Хроме Это обычно происходит когда у вас не хватает видеопамяти И вот вкладка ши и всё вот Оки тут поможет во-первых Поможет упрощение модели Потому что если вот как в Blender преобразуют модели то они довольно много лишних по сути вот точек получается то есть они хорошо сглажены конечно но скорее всего мы это особо не видим А каждая лишняя точка - это соответственно расход видеопамяти там производительность понижается и так далее То есть можно вот упростить второе что чаще всего становится там сказать камнем преткновения это в том что у нас очень у нас допустим низкополигональная модель в ней немного треугольников но красивую картинку Мы добиваемся тем что у нас там много текстур они как-то там трава там всё вот это и если у нас много текстур то это тоже становится проблемой из-за того что опять же вкладка там под вкладку может выделяться не так много памяти и вот всё решится и тогда допустим у нас есть три текстуры по сути они чёрно-белые их можно разбить по каналам и объединить в одну то есть вот пер в красный канал засунуть вторую в зелёный и третью синий и получится Вот это ВС В итоге будет в три раза меньше видеопамяти занимать второе что третье точнее уже что это можно использовать сжатые текстуры что это такое Это есть некие форматы так называе pcc которые позволяют сделать так чтобы Какая текстура допустим размером 104 на на видеокарте занимал видеопамять как текстура обычно 512 на 512 а то есть в четыре раза меньше А причём а вроде крутой очень Профит но есть большие ограничения по этому поводу это и разные форматы это вот dxt причём он поддерживается только на десктопе ptc на iOS и TC - это на Андроидах то есть в общем случае скорее всего вам придётся четыре разные текстуры держать а проверять поддерживается ли dxt если поддерживается его использует там ну и так далее по цепочке если ничего не поддерживается то уже использовать оригинальную а плюс есть ухудшение картинки есть некие проблемы с прозрачностью когда на границ прозрачной областью появляются артефакты и это в принципе больши объём файла То есть если у нас есть пнш чёрная она вообще мгновенно скачается очень мало будет весить допустим чёрная пнш 1024 на 1024 но на видеопамяти каждая вот эта точка она будет занимать память отра каждая точка соответственно тут обратно ситуация у нас может сам файл текстур больше весить но на видеопамяти он будет соответственно меньше занимать ну и плюс он кзи пае но это не сильно спасает а немножко про качество вот в принципе Котик не сильно пострадал от сжатия А с текстурами вот такого вида тут уже видны артефакты если не видно то вот так наверное должно быть видно что вот теншоу типа травы это отлично подходит и наверное самый главный и полезный совет и самый простой скажем так это не гнаться за реализмом Если вы смотрели какие-то Инди игры они никогда там нет супер там графики какой-то реалистичной там она какая-то схематично какие-то весёлые красочные там человечки бегают но в них мало полигонов нет текстур но зато всё весело и прикольно соответственно таким же стоит этот совет так сказать себе применить И последнее что я хотел сказать Это если будете делать то не делайте проект в одиночку находите соратников в принципе вот проект который я делал был в рамках атона сделан мне помогало много хороших людей и вы тоже ищите соратников потому что одному сложно сделать там А когда вы вместе это и мотивирует и быстрее всё получается вот список ссылок которые были в докладе плюс дополнительно вот два видео это люди из Ян рассказывают мне просто понравилось Эти два видео в них рассказывают про рендеринг текст в webgl и про производительность вот ссылки собственно Вот это ссылка на все ссылки можно вот открыть и там увидеть это всё всё спасибо вопросы вопросы у кого-то есть Здравствуйте спасибо за презентацию очень крутые карты у меня два маленьких вопроса Первый - это где это лежит в часом репозитории компании или это можно увидеть на гитхабе А да это лежит в частном репозитории в компании я вот честно последние 2 дня пытался сделать демку в которой можно было пощупать но из-за того что оно в росло в корнями там в инфраструктуру так сказать я не смог это сделать потому что для демки получается слишком много слишком навороты мне я постеснялся это выложить вот а для какого-то такого шаблона в который можно прямо взять и поменять соответственно тоже нужно дорабатывать это дело понятно поэтому там есть вот ссылки на демонстрации я решил что Вот лучше зайти на какие-то эмл и там посмотреть именно вот отдель часть которую рассказывал в 3 там есть документации там не так много но вот есть куча примеров в которых Разно Вот это показывается как это использовать и вот проще взять и посмотреть вот разные эти экзампл потом уже соединить у себя использовать и такой вопрос как у вас реализован импорт изменений то есть Понятно стены они несущие никуда не деваются а перестановка столов и я не знаю снос каких-нибудь внутренних гипсокартонных стен происходит достаточно ча Ну именно снос там каких-то стен урно не так ча но в принципе да там какие-то поменялись местами места и так далее а Бывает такое не так часто но бывает и соответственно при данной реализации приходится модель модельку переделать просто ну то есть переделал переэкзаменаци такое-то место в такой-то позиции там находится и так далее тут стаёт проблема с тем что в данной реализации у нас запечених делать опять же в реальном времени но соответственно могут быть тормоза вот я показывал демку там как раз вот взаимное затенение но оно довольно накладное Поэтому в угоду скажем так производительности здесь сейчас сейчас используются именно запечённые тени и Поэтому приходится модельку поправлять хорошо спасибо спасибо за доклад дам немного контекста я не так давно работал в компании дгис и мы проходили всю эту историю с картами вот в итоге получился продукт дги сделан вле про то как это ещё скоре сделать меньше дро колов там можно не инстанция сделать а вообще все столы объединить в один объект и это будет делаться за один проход и возможно будет проще тенями но у меня вопрос другой вы смотрели на какие-то решения готовые льные типа того же чтобы это всё сделать тогда бы пришлось чуть меньше работать с Лем но чуть-чуть больше с подготовкой самих данных или просто был интерес разобраться именно в этом всём Ну так как это был именно хакатон естественно было интересно разобраться посмотреть с чем это идт и поэтому взять что-то там готовое наверное не так было интересно Поэтому собственно Здравствуйте тоже интересно такая тема все работали с жем все работали с картами все идут по одним и тем же граблям через 3GS Я так понимаю вы остались недовольны рисом Ну почему вы так решили ну вы привели примеры где он скажем так плохо себя показывать соответственно кончается память там медленно работает там и Ну это скорее не проблема 3G он довольно Ну там много всего можно делать и подменять там какие-то эти То есть он даже не столько фреймворк сколько вообще такая библиотека составная где можно что-то Если что-то не нравится использовать своё а то есть вы глубоко не погружались и голый webgl там даже не пытались смотреть ну что-то пытался почему но как бы тут такая ситуация что а скажем так не было времени прямо супер глубоко Ну конечно что-ты смотрел ла а что что вы говорите там плохо может быть а у меня сразу жесть претензий на самом деле сейчас я не помню но вот например основная что он кишиев модели А как вы понимаете что у же скрипта памяти на самом деле безумно мало а у видеокарты их может быть очень много Ну если использовать buff Geometry Вот Раньше у них была просто метрия А у неё какие-то там были геометрия состояла из объектов типа Вектор Вот который тоже просто обычный объект то да было такое что большая модель это ВС памяти но когда используется вот bu Geometry насколько я знаю это быстренько очищается п и собственно у нас нету в хи браузера этого дела всего Ну понятно Так и ещё один маленький лайфхак как бы Из своего опыта скажем так если вы сначала делаете анимацию потом рендерить то получается у вас анимация занимает из кадра в кадры разное время соответственно где-то можно нять 8 где-то там 15 миллисекунд и получается у вас кадры рендерится скажем так в разных интервалах можно делать маленький такой лайфхак Сначала сделать рендер потом подготовить сцену для следующего кадра тогда получается чуть-чуть до плавнее как бы те же те же 60 FPS но они уже гораздо плавнее смотрятся Окей спасибо А у меня вопрос Вот я так Поня используется redx для интерфейса используется Rea наверно да Вот бы сложности при интеграции собственно этой льной штуки и 133g с ретом или там ну в принципе каких-то особых проблем не было возможно он в принципе вот это подход redx не очень подходит возможно по трёхмерной лизации потому что я больше его использовал чтобы попробовать с одной стороны с другой стороны это повсеместно у нас используется и другому человеку будет легко в это вникнуть немножко наверно не у Что там на каждое действие там на какой-нибудь хове там на клик и так далее создаётся вот этот экшн там вот это р обновляется и так далее Что немножко наверное окил но в целом ложится ещё вот вопрос тот же человек у меня по сути аналогичный вопрос Ну хотелось побольше услышать про вот ну с моделькой Всё ясно как она вращается как она появляется из блендера вот взаимодействие Ну вот с базой данных то есть понятно что Ну там вот ты объяснил про Вектор который мы поняли на Какой объект мы нажали вот вся остальная магия чтобы мы получили что вот этот стол Это принадлежит вот Александру и так далее ну а тут может быть два варианта Ну точнее тут один вариант мы кликаем попали Чтоб в этот объект а в этот объект там приписано что это объект имеет дишни некий соответственно Мы также вот как обычно в интерфейс вызываем экшн что выделе на место и айди ник место соответственно заранее там базу данных да да нет ну в сам сейчас сделано так что в принципе в самом начале делается запрос получается список всех сотрудников и соответственно каким Там написано что сотрудник там Place ID у него такое-то ну и соответственно мы Эш произошёл ПС выделено мы смотрим какого человека есть Place ID ну и соответственно всё показывается Добрый день спасибо за доклад скажите пожалуйста вот при использовании оптимизации очищения объектов использовали только нативные методы 3 то есть не лезли глубже в очищение памяти видеокарты нет не лезли не лезли Да просто ну как бы на хабре была дискуссия один раз с человеком по поводу я доказывал ему что очищение Джеси памяти происходит когда у нас пропадают перемены из области видимости На что он он щик на на си он как бы программирует он сказал что есть в желе несколько нативных методов очищения буферов которая позволяет очистить память самого видеоадаптера то есть из джеса мы удаляются данные да сборщиком мусора нашим стандартном но при этом они остаются в памяти видеоадаптера Я использовал А у меня была такая задача Ну не в рамках этого проекта А в принципе некий виджет сделать как раз которым используется webgl и там нужно было его убивать вот и Я использовал там прямо вот chronos Steam А у них есть скрипт который там можно взять и он как раз вот делает что вот очищает то есть очищает память очищает да то есть чтобы за собой всё убить полностью там и дны вот очистить и с видеокартой и реально вот там есть в Хроме инспектор там можно показывать видеопамять сколько там сжирает вкладка и он правда и ещё такой вопрос а вы использовали один в принципе холст для отображения всей модели Один холст для отображения всей модели он прохо два не пробовали для отображения представлений и отображения модели а а какой Профит Ну как бы как я когда использовал два холста У меня получилось что перерисовываю когда мышка обходит отлавливать объекты получается что второй холст не использовался и он не тянул за собой все вот эти вот данные Ну тут получается что в любом случае тут по сути почти ВС время задействовано То есть это да я представляю там в какой-нибудь не знаю в какой-нибудь аркади когда там может быть задний фон допустим Человечек который чаще двигается там и так далее Это можно разбить на разные слои и соответственно в разное время тут как бы не знаю затрудняюсь что-то можно разделить Спасибо вторая сразу вспомнил претензию он из коробки не поддерживает знаете такую технологию Почему не поддерживает из коробки как бы нет есть как бы внешний плагин который скажем так пытается это исправить но это очень тяжёлая реализация Ну как бы я по-моему сею версию последнюю видел сечас по восем пя Ладно короче из коробки этого раньше не было сейчас зна может быть есть но вот по поводу кликов вот я видел что вы делаете дополнительные модели чтобы определять куда вы КНУ а рендер Pass - это такая технология которая позволяет отрендерить Ту же самую модель но в других цветах то есть ну да потом по цвет определить В какой мы это да да соответственно он в плоде того что решает проблему Что Ваши модели двигаются где-нибудь в вершинном шейдеры и вы всё равно знаете где это находится И как вы туда попали Ну по-моему он был и он как обычно в экзампл как я сказал много всего то что в 3GS есть оно прямо лежит в экзампл и соответственно по-моему оно было я пря в экзам было а но он так и лежит наверное в экзампл Я подозреваю Ну всё наверное уходит Так значит к наклейке вот первом человека который с спросил про то что демки нет правильно предъява а потом вот человек про сложности реак редак и Ну раз вот человек очень активно спрашивал два раза тем более Пусть ещё ему тогда за наклейкой к нам Подойдите мы дадим наклейки Вот пока что всё Сейчас перерыв между докладчика"
}