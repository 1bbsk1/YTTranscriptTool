{
  "video_id": "jL985VczwC8",
  "channel": "HighLoadChannel",
  "title": "Как устроена MySQL репликация / Андрей Аксенов (Sphinx)",
  "views": 7645,
  "duration": 2562,
  "published": "2017-04-22T14:47:46-07:00",
  "text": "на самом деле вообще как бы и я ожидаю полную ротацию зала если еще потому что треки покрашенные в разные цвета так далее его щепки из тех значит 3 или 4 слайдов которые я успел заметить значит сразу стало ясно что доклады во-первых и во-вторых во первых надо их было вот так вот развернуть чтобы сначала шло моё капитанство про то как она вот в принципе вообще устроено на очень так сказать базовом уровне вот ну и во вторых да как бы зал надо вот весь выгнать там и вот запустить новых и наоборот то есть как бы если вас интересуют значит увлекательные дебри и так далее вам скорее всего моё значит капитанство по поводу того как она в целом устроена но наверное не интересно внезапно не те слайды не если хотите я могу про поиск короче продолжить версии с репликации можем сделать иначе можем значит попытаться уложить доклад про как это уложить коротенький обзор того какая бывает репликация вообще в принципе в 15 минут и после этого с чистой совестью даму как про поиск и поговорить про поиск по подробней будет весело вот но до повторюсь как бы порядок полностью инвертированная мой доклад предназначен ровно для тех людей которые в принципе знает слова репликация даже знаю что мы искали она есть вот и возможно один раз или как настроили 15 минут по про там потратили по туториала и все забыли больше этого не про нее не знают ничего совсем вот сразу так предупреждаю дисклеймер дайте хоть какие-нибудь слайды мне как бы все равно в принципе тоже да это интересный опыт как бы рассказывать вопрос короче пацаны мы остановились вы значит остановились в прошлый раз нам на внутренних фундаментальных различиях вот давайте поговорим по них пропади по про них поподробнее не мы можем чем я могу кому нибудь дать флешку и там есть доклад опять он называется там что-то там халы 2014 майской или репу pptp и его сложно спутать он назывался так как бы в прошлый раз ну ничего я внес свой вклад в highload я наверное был единственный человек короче который воспользовался предоставленным шаблоном и теме значит как бы это сказать-то чтобы не оскорбить лица с домена . юрий ну шериф с названием бандера как ну не нормальный шрифт так хорошо читается все огонь вот и естественно как единственный человек который это сделал вот я установил что на презентационным лаптопе нету этого шрифта вот но ничего у меня с собой была о так вот значит давайте 15 минут пор капитан пока питанием про репликацию олег а рассказывала массу интересных слов прикладных случаев и так далее всего этого хардкора не будет как будет доклад для тех кто вот знает слова репликация не знает ни одного другого слова хочу заронить там три грана понимания попробуем если сработает кликер кликер работой был нет о да вот значит если вы все и так знай я это уже кажется повторил раза четыре вот clicker нет ни шиша вот более того поскольку я известный значит теоретик кайфата ну чтож такое-то может на плите ли есть кнопочка в колу выкл там или батарейку ноты с гостями что делать у нет а ну не знаю может она сама явно как-то нет кликер не работает решительно надо кричать следующий слайд пожалуйста значит да поскольку я известный и это было демоверсия вот поскольку я известный теоретик кайфата даже вот такого вот то есть вот всем этим значит всем известным и милым заявлением как эта ось заявлением господи языке sql statements он там шоу мастер статус вот таких вот значит замечательных туториалов которых в интернетах наверное ну как бы там штук так 17 миллионов примерно их тоже не будет предполагается что вот как бы мы немного проедем по теория после этого вывод с утра иными силами сможете сами нырнуть в документацию вот все вот это есть в интернетах синтаксис и разбирать смысла нет интересно значит нормуль и чуть-чуть бастер лог-файл masterlock вполз предполагается что вот вам интересно что это такое вы этого не знаете следующий слайд пожалуйста ссп вот до попытаемся объяснить как это все работает внутри боюсь что вот вообще нет аудитория и слечу мне есть слайды и про поиск следующий слайд пожалуйста как оно бывает вообще ужасно неудобно близких о них реплика заработала что какая победа что такая репликация в принципе ну блин копирование изменений у нас есть одна копия баз данных мы хотим с какой-то целью еще одну копию бывает разных видов разные так сказать и оси сравнении с touch id степень синхронизации этих самых изменений синхронная полностью охрана и так далее сейчас я немножко поподробнее обсудим и значит забавный факт про репликацию если немного задуматься репликация нам теоретически барабанная дробь и помогает из принципиальных соображений скелет только чтение такой нисколько не очевидный вывод это почему это потому что если у нас на одну и ту же копию данных надо налить определенное количество изменений и это определенная копия данных обслуживаться одним и тем же сервером то блин пасхальный этот сервер способен выдержать определенное количество апдейтов в секунду и вот ну больше ты туда ну не зальешь но способен сервер обновить 1000 записей в секунду а 2000 не способен что изменится от того что ты поставишь к этому серверу реплику неважно в режиме мастерских или мостят мастера сумей что на нее налить и на эту реплику 2 тысячи апдейтов правильный ответ нет ну то есть на реплику в режиме мастер мастер такое что все равно сумеешь налить и дополнительных апдейтов другое дело что когда они пролетят на первый мастер и попытается сделать на нем вторую тысячу апдейтов то как бы все равно емкость уже не хватит то есть надо понимать и не смешивать два как бы почти очевидных момента что оба рипли catia как про одно а то что данные надо дробить и если в чтении в если натски эрик не чтение записи то придет сделать счет другая репликация скорее всего не очень спасет но как это вот это вот другое репликация на больше прочти про синхронизацию синхронизация чувствую себя реально капитаном очевидность гарантия наличие доступности доступности в том смысле что она скользит прошел транзакция зафиксировалась все огонь эти данные видно одной или нескольким нодом в кластере они могут участвовать в следующих запросах ну здесь да здесь значит нет рефрена под названием commit закончился успешно что это значит синхронный комет означает что у нас локальный и удаленный камедь закончился хотя бы там на одной реплики удаленной то есть мы что-то за кометами на машину если у нас синхронный режим а репликации все огонь эти изменения успешно за к метались они видны для последующих запросов на локальной машине на удаленной машине хотя бы одно и тоже видны а это что означает это значит что если случилось стандартная нештатная ситуация ну то есть в один из серверов прилетел лоб и пробил все насквозь от процессора до самого винта то не смотря ни на это данные не только скопированы на нике удаленный сервер но еще и вдобавок могут мгновенно без каких дополнительных задержек участвуя в последующих транзакциях и это все заметим это как бы об общая терминология совершенно никак не связаны как с морской лев в любой распределенной системе про база данных или даже не совсем база данных она будет устроено вот так интересный значит асинхронный к нет никаких дополнительных гарантий локально за к металле а удаленно ну короче как повезет вот и наконец получить огромный камень такое приятное промежуточное решение это когда у нас локальный камень прошел удалённый комментарий на узнает товарищ прапорщик может слоев догнал может sleeve не догнал но по меньшей мере нам пришло подтверждение что эти данные вот туда куда то туда улетели и там принятый и наверно записались различные гарантии повторюсь наличие и доступности наличие это то что данные в принципе есть более чем на одном сервере но возможно пока еще эта транзакция не проиграл осени доступно вот а про синхронность и повторюсь это смазка или мне особ связано значит про сервера для записи как бывает какие бывают опять же виды репликации ну masters life classic изменение все льются на один сервер после этого копируется на массу реплик мастер мастер true когда изменения льются на кучу мастеров одновременно и каким то чудесным образом оно само по себе вот как то вот вот вот так вот с одного на другой из другого на 3 и между ними всеми что внезапно как бы порождает ряд радостей но одновременно порождает ряда значит автоматических проблем то есть понятно что когда у тя есть определенный золотой стандарт то есть вот у тебя есть одна золотая копия из ее несколько реплик которые должны идентичных при которые должны в идеале мгновенно повторять эту самую золотую референсную копию ну как бы все сравнительно просто с точки зрения того как вот данные туда-сюда гоните что делать на каждой конкретной копию с мастер мастер начинается интересная головная боль причем подчеркиваю не конкретном случае мая сколь и чисто значит сугубо теоретическое как же быть если на 2 и нотах одновременно попытались одну и ту же транзакцию прогнать которая меняет одни и те же данные причем меняет их для простоты значит примера по-разному понятное дело что одновременно бы эти два изменениям и применить не можем понятное дело что на момент когда мы начинаем на одну ночь вот из plant по 2 ноги еще пока ничего нет и как конфликт одну из транзакций придется откатывать плюс добавок начинаются увлекательные значит отдельные пляски со стороны реализации со сверкой число в кворума мать их надо так далее в общем весил при этом что интересно опять-таки любопытный момент даже вот этот вот вариант в случае если у вас в конечном итоге все вообще изменения со всех вообще мастеров должны постепенно распространиться везде все равно не поможет тому самурай биндекс обидно но вот так приятный вариант под названием мастерса сеймом и плюс роутинг запросов как бы приятен в том что как внутри программировать просто мастер свифт пары у тебя есть одна основная капитулирует на кучу машин вот это как будет сильно проще чем как бы мастер мастер среде когда все равноправные была суета мы так далее конфликта разрешать вот но с точки зрения приложения все равно выглядит так как будто у тебя точки точек записи много ты приходишь на любую ноту она знает куда тебя за раунд эти успешно рауте вот ну и чтение они вот как раз масштабируется вот оно счастье репликации читать можно со всех точек все всегда вот теперь значит ближе к базам собственных данных волшебным форматом statement бей строуба ест и так далее мне на всякий случай страшно проводить опрос значит кто че знает ну я себя не виню не я себя поставил после хардкорного не не я поставил вводный доклад после хардкорного доклада это был не я и вообще меня тут нет про формат изменений уже ближе к базам в целом и сбр rbr терминология насколько я понимаю морской рис специфика во вторых чем можно делать можно подавать сами запросы можно передавать только измененные строки подчеркиваю пока мы еще опять же не нырнули в дебри mais qui этим может заниматься любой а значит система база система управления данными какими-то в которой есть как бы запросы или вот например запросов которые запросы более слова сложные чем ну там кики вилью апдейты как только у вас кроме как только у вас в принципе возможно какие-то запросы порождающие большое количество изменений в принципе есть запрос который обновляет много данных запрос маленький а данных обновляет много так бывает иногда ну то есть если у вас конечно значит божественный легко масштабируемый эфемерный киви люстр все узнали memcache это вот та у вас наверное запрос который жахнет вот вообще пробежит по вообще всем строкам всех пар анализирует и треть из этих строк обновит его сделать скорее всего либо нельзя либо сложно я не слежу за успехами в достижении достижение в нем кишат к несчастью но как бы помню что изначально кизильники вы льете валюту функционал под названием давайте пробежимся сложно отфильтруем базовый что-то обновим по условия его просто вот нет в момент когда и то есть есть какие-то сложные запросы сравнительно с условиями более сложными чего ради ровно четыре пять шесть возможно они могут порождать значит сравнительно большие наборы изменений а могут и нет соответственно мгновенно возникает вопрос а что конкретно копирует можно знать сами запросы туда-сюда между нами гонять можно гонять только измененные данные интересны значит финн заключается в том что это клеток очень плохо но можно смешивать еще пытаться pawn clicker опять этого отвалился они не отвалился просто работать через два раза на третий но и для галочки я значит вставил сюда пункт еще ночь какая в принципе бывает репликация про модель распространения наверное где-то до сих пор вот еще не полностью вымерло модель push bass когда кто-то но да там машина тот сервер если угодно которые изменение внес то ты обязан его рассылать по всем остальным но там но опять таки это геморрой с точки зрения программирования отслеживания state of поэтому как бы пул bass рулит забирать апдейт с соседние ноды сильно проще чем забирать апдейта там сто или иные но ты это сильно проще запрограммировать чем на одной ноте следить зовут хаотичным кластером своим своих реплик общие термины некий ввели кто не знал рассказали всем трем этим человеком всем остальным напомним как сделано в mais quel и значит вспоминаем о том что mais quel сам по себе это вот некий обман есть логический слой под названием mais quel который занимается всяким общем и изолированным от хранения собственно да он общем не изолированные от собственных ранениями данных делами сетка оптимизатор кеш и все дела конкретный физический слой который отвечает за хранение данных он вот лежит на этаж ниже есть несколько встроенных есть несколько ставящихся плагинами но даже встроенный мая и займы на тебе и так далее они живут на физическом блин слое и до стандарт мгновенно плагина я архитектура это клёво можно подцепить новый движок но мгновенно вот некая не оптимальность вырисовывается сразу что в принципе вот эти транзакционные райт их и блоге которые физически слоя хранения все равно пишет до их был бы клево использовать для репликации и если система знает о том что есть некий физический уровень и или достаточно хорошо сопряжена с этим физическим уровнем то вот можно бы было отдельный лог на логическом уровне не писать а использовать прям тут же самый райка hotlog но вот нет москве реально как бы невозможно концептуально наверно либо если поменять интерфейс space я так чтобы стало возможно концептуально я думаю это большая куча работы довольно вот совет на немножко обидно но тем ни менее райта hotlog лизнуть он все равно есть море лизнуть его для репликации не получится репликация реализовано именно на уровне с мамой ce que el в этом помимо плохого есть так тащемта и хорошие то есть как бы интересно что у тебя помимо одного лага в виде неких глубоко внутренней данных движка хранения есть более-менее такой логически logs уровне возможно на уровне statement of который ведется отдельно от этого движка лишние так сказать безопасность лишний аудит trail и так далее плюс поскольку никаких ограничений внутри нет прикольно эта палка веревка этом можно делать что угодно можно делать креатив типу подмен движка на лету вот и clicker опять не от реплицироваться него значит ввезенных терминах что там в принципе есть давным давно когда машины были большими а маску или версии 41 вот человечество в лице там компании майской или бы наверное еще на тот момент придумала делать ровно значит одну штуку masters life понятно-понятно пул bass и асинхронная и строго синхронно и строго statement bass то есть если вы застряли в древней эпохи 4x то наверное у вас как бы все плохо в принципе 5x уже там чем ему чуть не 10 лет пора бы уже и обновиться потом забавно прослеживать по версиям как вот люди втыкались во всякие грабли и как бы но сделать уже ничего нельзя ну и надо к этим граблям как бы прикрутить еще новая игра будет чтобы жизнь была не такая болезненная вот и вот в 51 прикрутили робость репликацию для того чтобы заткнуть проблема коту неизбежно is a statement best и микст режим тоже в 56 еще через несколько лет вот предатели еще пару-тройку приятных штук сим айсинг на складе plus live прописан пропущено делает слив вариантные где ты наконец прикрутили еще такой момент что поскольку mais quel это некий общий слой с одной стороны его куча какая-то адская плава был движков с другой стороны в том числе встроенных там есть с определенного момента пожертвованный я уж забыл каким телеком божественный ndb кластер про которые рассказывают значит круто крутое и поют ему а самые как бы полностью синхронная мастер мастера репликация там приведшая дико доступно этом с миллионом девяток in-memory база данных там ну в общем как бы есть ровно один нюанс как только начинаешь искать людей которые в продакшене использует он тебе кластер то очень все эти тяжело и как бы люди такие находятся мал . говорят такие люди есть встречаются они не знаю может как конечно нет не туда хожу не с теми пью но встречаются они вот редко но формально говоря там это все та же есть и вот твоя реализации понимать что не тебе кластеров такой танк интересная тоже сбоку по ребенка по большому счету отдельные базы данных вот затянутая под общий зонтик mais quel а чем занимается мастер в тот момент когда вы собственно в тот момент когда вы наконец то подумали подумали и решили что пора бы репликацию это включить как ни странно на мастере происходит довольно немного дополнительных значит телодвижений как обычно знач ну мы принимаем том сеточки какие то запросите их партии транзакции гоняем и так далее фиксируем их к my time вдобавок к этому на логическом уровне потому что райта хоть лоб по не можем зарезать для этого дела mais quel мастер начинает вести так называемый бальный релог баннеры лог пацаны это ни хрена страшного этот тупо файл не совсем текстовой на то он и баннере в которой сыплются все подряд значит изменение причем изменения по умолчанию по моему ступицу строгов state and bass то режиме небольшой заголовок а потом в лобешник прибыль по большому счету текст запроса про убийство режиме соответственно по-прежнему бинарный заголовок тег ну и как бы данные того что поменяли вдобавок умеет рассылать эти данные эти боли реологии по сетке два ключевых моментах которые как бы приделанная к мастеру видимо решение сделаны сделать именно так а ну вот не в последнюю очередь из-за того что все это очень просто и вроде как работает вот чем занимается slave изменения в то же самое что вы подтягиваете с мастер и на sleeve лучше бы наверное вот не слать и потому что как бы можно попасть в интересно и непонятно усваивать чуть больше работы у своего вот помимо того чтобы ввести один дополнительный лук и по запросу его рассылать еще есть радик который ходит к удаленному мастеру а возможно ни к одному удаленному мастеру и качают оттуда бинарные логе решение под названием давайте ходить к нескольким удаленным мастером и как бы с них качать разные логия но вот ну блин неоднозначны с одной стороны прикольных стороны получается мгновенно расхождение то есть попросту физически копировать файлы psc по нельзя уже получается означает на сервере одинок в нем свои позиции локальному их по сетке тянем складываем в отдельный лог еще отдельный трейдинг бегает и их пытается проигрывать эти локальные логе и самое значит адская на мой этот как его нехитрый вкус заключается в том что у видимо опять таки такой мощной legacy вплоть до версии 56 идентификации то ли иной транзакции в логе происходило и происходит не почему нибудь там опа блин имени файла и позиции на этом самом как его на мастере интересное решение вот путь записи которые там простенький inter tig проходят без репликации он как будто по этом приложении скана кило серверу засунула в таблицу всю огонь с репликации значит получается несколько дополнительных шагов приложение писатель точно так же как и раньше идет к мастеру но вдобавок к этому это да эти данные попадают в том или ином виде в бане релог потом качаются по сетке брелок потом и зрелая logo постепенно рипли яйца если нам повезло из них не лагает реплей то сразу в таблицу на основе после этого все огонь доступных считать или ура ура ну вот как бы копирование через пару-тройку промежуточных тампонов что конкретно попадает в bine релог зависит от этих самых настроек вот statement быстро убийст или смешанная значит откуда это все растет вот представим себя базой данных нам пролетел простой запрос обмен обнови одну конкретную запись еще записать в баннере лоб в принципе пофигу на самом деле принципе можем коротенький запросы списать либо он простите обновил одну запись можем изменение это записать каким-то образом в том или ином формате все огонь вот другая ситуация представим что нам прилетел тот самый запрос который сам по себе маленький а данных меняет много ну тут вариантов опять-таки эффективный вариант 1 писать сам запрос потому что запросу маслом ровно тридцать два байта я специально посчитал записи он может обновить произвольное количество тысячу сто тысяч миллион сколько угодно нифига не эффективно писать их в писать флоксами изменённой записи но есть нюанс что значит произойдет если мы вот в принципе вот такой вот нехитрый нехитрый запрос под названием а давайте как бы отключим всех и жиров которые как бы ну не ладились давно если мы вот этот вот запрос в лог сунем внезапно приходит белый горный зверь писец или как тут написано горностай проблема в том что если реплицироваться реплицировать прям идеально сам запросто время во первых никогда не синхронно между двумя нотами то есть даже божественная идеальная репликация с нулевым абсолютно лагом если вот запросто чудесным образом прямо в тот же квант времени использую предлог предполагать что время квантово на в тот же квант времени используется исполнится на удаленном сервере все равно его результаты разойдутся просто потому что идеально синхронизировать часы на двух серверов невозможно совсем кроме того за счет того что путь записи довольно такой длинный брелок relay лак реплей и так далее в момента реплея вот этот вот на у разойдется опять таки и будет отличаться от того что значит будет отличаться от того значения которое было в момент когда моему коли мастер вот об реплика внезапно расходится с мастером от все последующие изменения формально говоря уже не безопасны могут привести к чему угодно может быть все нормально может быть еще сильнее разойдется ну и в принципе если повезло если там точность до секунды если она за эту секунду успела пролететь и если вот ни на какие граничных пользователей мы не не попали то в принципе она будет как работать вот но вообще говоря для таких уродских запросов к несчастью вне зависимости от того сколько данных они изменили в идеале надо бы копировать сами строчки ну опять-таки понятное дело что в данном конкретном случае опять же можно выкрутиться и сами строчки не копировать а простите зафиксировать вот эту вот константу и в лог написать не на упростить и а конкретный таймс темп который был использован мастером на момент репликации вот но в общем случае тот или иной не до термини раваной запрос а список этих не детерминирована в запросов документации морской он такой довольно увесистый занимает вам пару абзацев и там крайне исторические моменты там есть понятные любому дебилу моменты типа меня вот с этим самым на у него и default роуза так далее рэндом тоже не очень хорошо детерминирован а бывают довольно прикольные там расклады типа если у вас есть триггер на авт инкрементный ключ и на апдейт это включая и он срабатывают то почему-то ладно в общем страшно значит вот люди говорят в документации наверное врут что в этом случае как бы все рассыпается в этом случае на дорогу bass либо на худой конец микст ну то есть вот потребность вот из-за этого что не все запрос одинаково полезны некоторые можно залакировать a triple eight как есть некоторые нет чем хорошо и плохо ну как бы примерно должно быть ясно сбр хорошо потому что ну сравнительно небольшой overhead меньше данных на планировать и есть какой-никакой аудит trail такой мелкий дополнительный бонус наверное в подобной аудит трейлы смотрит там не знаю один человек из тысячи и раз в году но формально говоря он есть плохо не до термини зм то есть если с запросом что то не так если его исполнить не тогда не в тот момент в несколько не то есть среди он приведет ни к тем результатам об реплика разошлась и 2 как бы непобедимый момент это то что если запрос сложный считается три часа а потом изменяет три записи по результатам трех часов расчетов но блин опять таки блокируется сам запрос slave его будет доблестно перечислять еще три часа и значит через 6 часов после запуска начального запроса изменит не на сливе еще 3 записи вот с понятными как бы последствиями что но все это время все следующей публикации будет стоять робость ну вот соответственно как бы данных она пишет просто катастрофическое какое-то количество но зато чисто теоретически реплицировать можно все потому что вот копируется не запросите а прям образы строк прообразом строк там немножко побольше немножко побольше сейчас как раз скажу значит случай не и забавные или не очень факты которые вот узнаешь ныряя в дебри репликации причем повторюсь поверхностный слегка дыре но нарываешься на них сразу случайном порядке они такие мастер многопоточные да то есть принципе несколько концертов может запустить нам вставок облив и так далее сразу в какой-то мере они про реализуется понятное дело что в один прекрасный момент в одном прекрасном месте без глобальных log off или в конце концов о только все равно никуда не обойдешься вот но тем не менее какая-то параллельность на мастере она простите есть она славе и нет опачки опачки приехали однопоточный slave ну тут понятно что если у нас мастер как бы там в 4 ядра наливает нагрузку слоев эту нагрузку во тьму и ядро наливать не успевает о как бы все довольно плохо второе креативное решение значит это то что состояние слова она вот определяется именем оппозицией твоими мастера вдумайтесь значит в эти простые но в то же время гениальные придуманные не известным фильмам или шведам много лет назад слова состояние одной ноты в кластере определяется именем брин файла и позициям в этом фомина друга и нодди кластера с которым с которой в принципе может по любым причинам произойти что угодно вот в этот момент любой значит уважающий себя администратор баз данных уже начинает немного перекидываться и завоевать на луну вот следующий интересный факт спасительный ро убийста репликой шин вот оказывается если глянуть как будет не знаю насчет почитать документацию честно говоря вот я теперь я считала черный лак но если туда за нарвать вниз то оказывается что по умолчанию туда барабанная дробь пишется полный так называемый before and after и мая что есть мы изменили одну колонку в 5 килобайт ней строке шпак 10 килобайт трафика и там батиков 2040 оверхедов на эту строку то есть заголовок чик элемента баян или logo записался потом шпак едет такая клевая жирная строка предыдущие версии которая она была шпак едет после этого новая версия снова обе значениями значит администраторы воют уже хором но тем не менее с точки зрения некоторых извращенных приложений например внешние читалки которая пытается подцепиться к школьному серверу с него вытягивать данные и цинично с этими данными что-нибудь например в полнотекстовый индексировать это вот просто охеренно вот насколько это хорошо для насколько это плохо для с точки зрения администрирования базы в которые одно изменение на три байта порождает блин 10 килобайт его трафика на винте а потом 10 килобайт его трафика по сетке на каждого слоя настолько же это хорошо для всяких систем типа полнотекстового поиска типа сфинкса у которых нету локальной копии данных о моей сколь с нуля заново имплементировать нет никакого желания тебе данные апдейта пролетели если тебе что-то не хватает вот же они вот в 56 в 56 тут мы вот тоже забавно сколько лет прошло пять шесть товарища спохватились и сделали мышку под названием берлогу рауль мечту по дефолту она конечно же как мы все любим для совместимости full ну то есть изменили четыре байт в 5 килобайт 10 килобайта запишем есть еще два режима minimal и на блок писать минимальные возможны изменения и писать как бы все без бобов но по дефолту все равно вот вот так вот забавно вот короче говоря на счету устроенного ну вот настолько вот не хитро значит палка веревка один лакх второй лак и в этом блоге даже детские болезни довольно забавные который я вот честно говоря такого подарка судьбы не ожидал что детской мы ныряем в этот как у моря и в бинарный лог там делают изменению на три байта на там полная предыдущая версия и полная новая версия интересно все эти штуки приходят к понятным детским болезням которым я не знаю сколько нам 90 процентов из кейсов покрывается 21 процент вот но они как бы совершенно понятные и вот как это сказать из внутреннего устройства очевидны усли его протух лог или позиции разошлась или еще что-то надо что то делать слои флага it не может мастера догнать или наоборот slave не лагает но кто-то таблицу дропнул и как вы что-то нехорошо надо что то делать вот для значит человека который два дня как используют репликацию все это страшное тяжело вот но зная насколько она не хитро устроено в принципе понятно как с этой какой жить жизни ну как ну примерно вот так значит прежде всего конечно не дефолтом и внимательно смотрим на настройки думаем чего хотим statement быстро убийств настраиваем берлогу рауни мы включаем катет и скорее всего если есть техническая возможность дефолта местами странной лучше сразу настроить традиционно чем потом разбирать странный фарш вот ситуации под названием протух лог разошлась позиций неизвестны чего происходит ну понятное дело что разбор конкретных кейсах тут значит есть люди которые в этом разбираются раз так в 700 лучше чем я с одной стороны и способны просто но вот по одному этому слайду рассказывать два дня подряд с другой стороны значит а вот был еще случай интересный один на миллион общий подход мы понятен протухла позиция оно неизбежно потухает подобных систем ну блин простите позиционироваться по транзакциям без готти дав на основании имени файла на другой машине какая-то жизнь есть определенные инструментарий там смотрим и винтики и пытаемся понять какая транзакция уже проскочила какая нет можно ли это все делал спасти и восстановить и так далее если хотите заранее сумели включите достаточного версии жизнь становится проще 1 раз далее второй интересный момент такие вот наблюдение значится репликации и интересно посмотреть как внутренние вот кривое устройство она провоцирует не тоже эту конкуренцию а провоцирует создание дополнительных продуктов большому счету волшебный так стен который как бы хорошо говорят говорят хорошо решает задачу под названием блин однопоточный слои в чем-то довольно плохо еслибы не значит сложности если бы не врожденные сложности вот не было бы прикольного дополнительного продукта который позволяет пользуясь этим механизмом переливать данные в другие системы с одной стороны вы заодно решать ряд проблем которые есть встроенных в существующую систему с другой стороны как обычно уверенно советовать не возможно кому-то помогает кто-то будет как это сказать сильно плеваться но вот говорят есть ситуация в которых с неизбежным 1 по точным лагом прикольно справляется танкс я уверен значит есть еще всякие увлекательные sign up блин внутренней однопоточный слоев это тяжело но что делать если вы зачем-то использовали реплики как backup вот я считаю надо как бы у биться головой об стену потому что вот реплика и backup это две разные штуки вот но тем не менее если вот вот как креативные пацаны ее от используйте достаточную новую версию wot делает репликой шим вас спасает с одной стороны с другой стороны если вы не делаете прям полноценных быка пафосную на все равно еще не спасет вот далее значит еще один элемент креатива вот стандартная ситуация наверное стандартную в кавычках стандартной ситуации прочен вернее сформулировать так не трудно за представить ситуацию под названием мастер взял забил забил своими долбаными лагами весь значит диск или забил рассылка этих самых логов всю сетку и при этом 90 процентов этих обновлений нам на хрен не нужны потому что нам интересно реплицировать грубо говоря одну таблицу прицельно и нам интересно реплицировать одну базу прицельно по умолчанию все валится валом в бинарный лог все изменения по всем базам по всем таблицам по всему вот тут опять вот решение значит поражающая своей креативностью с одной стороны есть 2 нет ни 2 есть четыре настройки белок дуды backlog игнор db и соответственно реплика это так далее которые позволяют это дело фильтровать позволяют на мастере фильтровать чужим запишется все-таки влог а что соответственно за игнорируется и на сливе соответственно позволяют делать то же самое то есть на мастере мы можем за фильтровать то что попадает в bine релог вот вы тут вороночку которая сливается потом в сеть на сливе мы соответственно можно поставить входящий фильтр на то что пролетает из сети и писать на диск только часть данных а потом на сливе реплей опять же только часть данных внезапно даже вот в этом казалось бы нехитром момент наступает опять внезапно потому что вот мне не хитрая комбинация используем одну базу данных об этим таблицу в другой базе данных через интересный синтаксис она ведёт себя как-то вот как конкретно на себе ведет это в принципе детерминированный процесс если очень хорошо знать значит все возможные комбинации то можно построить легкую ментальную модель и понять что вот если берлога репликой db такой белок дуды б такой то вот это вот вот эта пара запросов поведет себя вот так но вот ведет себя вот как бог на душу положит что потому что вот разные фильтры срабатывают в разные моменты вот просто какой к-к-конечно корову вот но и да значит встроенных приятных штук под названием перевыборы того самого мастера если он внезапно сдох нету надо что-то поднимать руками внезапно отсутствие как это сказать отсутствие тузов для менеджмента кластера опять что интересно я считаю оказывается хорошо порождает конкуренцию порождает создание значит дополнительных продуктов в самом деле если бы идеально работала кливия мастер мастер репликации или хотя бы автоматическое поднятие этом после сбоев в обычном ванильном моей вскоре ну зачем бы была нужна всякая galera там персона кластер и так далее наверное не зачем бы не было нужно ну там понятное дело что как всегда кому нибудь было бы очень надо но большую часть кейсов она решала бы вот значит еще немного фокусов вот как бы с одной стороны конечно вот интересная реализация репликации которая вот простая как палкой веревка без всяких проверок с одной стороны и без всяких тузов для того чтобы как-то поприятнее менеджер кластер значит этих самых реплицирующихся слои вы с другой стороны это вот плохо вот но зато можно вручную лепить из этого таки интересная конфигурации что с игра содрогнуться все таки вот содрогнуться все кто потом придет и заводи будет этот разбирать значит конфигурация номер один значит мастер мастер на коленке мастер мастер мака рейки в это в стиле mais quel делается вот так пусть значит сервер а будет словом для сервера бы и наоборот вот если все взорвется после этого как-то вот интересно сильно разойдется и так далее то ваша основная задача этого время уволиться бонусные очки это их бонусные очки это если вы вот в такой вот по-русски как бы не очень хорошо звучит слово круга дроч но это он завязываете несколько серверов вот что пугает немножечко это тот вот сколько в мире идиотов которые говорят що короче ну тут погулять и мастер мастер морской reflections каждая вторая ссылка вот такая ага холокост фокус номер два поприятней значит повторюсь вот этих значит никаких вот ненужных проверок нет что с кого пролетает и кому попадает и его что с этим делать за счет этого можно делать забавные штуки тип осла его на которое либо прицельно сливается часть данных часть данных с кучей серверов либо прицельного сливаются все данные со всех серверов там сервер со всеми со всеми бэкапы но повторюсь репликация есть тут есть некий базовый инструмент такой которую там копирует таблицу а вместо бы и все вот ну и наконец фокус номер три он же последний вспоминаем что репликация живет на логическом уровне никак не связанным с физическим уровнем хранения за счет этого можно крайне интересно значит чудить можно менять движок на лету с непонятными целями вот три у storia что дескать и репликации за на тебе баз в магазин таблицы просто для того чтобы полнотекстовый поиск работал хоть как-то вот есть значит креативный find под названием изменения схемы через репликацию как бы в чем жир понимать отказываюсь но вот опять таки бывают и и такие фокусы ну и есть значит понятны интересные режимы работы под названием про модель параноидальный апгрейт через любка репликацию нам страшно взлетать с новой версии поставил версию новую как бы все хорошо от версии к версии у нас то не сильно что-то изменится апдейты из старая версия не проскочат значит в новую значит ради чего я капитане вас тут примерно 30 с чем-то минут если верить опер вернули таймер вот итоги подведем но доклад капитанский поэтому как бы повторюсь очень жаль что вот они поставлены в таком порядке я хотел рассказать и надеюсь немножко разъяснил тем кто не знал но никогда об этом не признается что по репликации я в целом бывает вот такая вот привлекаем репликация в mais quel конкретно при этом устроены вот так вот это вот такой конкретный подвид асинхронная мастер slave с мест с интересными значит встроенными безумие we типа позиционирования через название файла и позицию файле на другой машине и прочими интересными встроенными безумия my типа мне никакой защиты когда сказать вот таких вот адских значит все допов и так далее вот но тем не менее даже с этим мадам можно жить если примерно хотя бы понимать как он устроен и как бы основной посыл в том что вот репликация это вот не сильно сложно бояться ее не на нам надо примерно понимать как она устроена если чем то будет не так сложно и больно с ней разобраться и бороться вот"
}