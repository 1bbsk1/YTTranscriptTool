{
  "video_id": "WGYQus5J2Eo",
  "channel": "HighLoadChannel",
  "title": "Алексей Акулович на HL++ 2017",
  "views": 1847,
  "duration": 2743,
  "published": "2018-08-16T04:58:22-07:00",
  "text": "собственно вступление expromt в качестве темы выбрал доклад который покрывает почти час он довольно большой так я буду сегодня один тем какая тема этих нибудь знает mail.ru проводили в августе открытый чемпионат или highload как называется для backend разработчиков для создания задание коэн в курсе вообще слышал хотя бы а кто не участвовал хотя бы там хотя бы один нет тату ценного хомяк на сайте есть вот это проходило в августе то занимала три недели такого довольно вяло текущей разработки то более в а врали за последние сутки как делал я занимался более менее 3 неделя свободное время требовалось сделать решение расскажу о нем какое-то будет решение оно должно было быть единственным докер имиджем то есть собирается локальный образ заливается к ним там система тестирования прогоняет определенной тесты я тоже скажу какие и выдает более менее в реальном времени текущий рейтинг то есть это не задача где залил ждешь окончании собственно срока и кто узнает этом какое-то место нет это была борьба в реальном времени когда можно было там всплывать и тонуть в рейтинге в общем постоянно какое было задание задание было реализовать некую базу данных и некую систему хранения рисующий 3 сущности то есть у нас есть некие люди не слышно просто себя перестал слышать есть некие люди которые посещают какие-либо места в мире и приезжать то возможно неоднократно пусть это люди место посещения и визиты людей в эти места у кого-то таблички и требовалось реализовать некоторые запросы есть простые запросы типа гетто сущности всех полей были запросы более сложен и например визиты этого пользователя ну какие там есть фильтрации средняя оценка то есть чем после посещения оценить место к кому понравилось у ног и делать многократно разными оттенками это довольно важно это будет все сказано и простые запросы по обновлению создания сущности чтобы это было некое то статическая база загружены одноразово именно запросы на обновление требующий по счету индексы языка лизации любой можно было вообще делать на чем угодно то не знают ассемблер дахране функции в базах данных как угодно есть на галичине это было единства . image то есть кое-то сложные системы и низкий образом взаимодействующих там бы не работали опять же система хранения любая из можно было спросить о что угодно вообще все что влезет 4 гигабайта оперативки есть ограничение никто решение они не укладывались в эти лимиты я не прошли и собственно тестирование до 3 фаза это фаза движок умника решение поднимает сама читает пир начальную базу с диска потом мы ее нагружают запросами на чтения всевозможными потом идёт фаза обновлений и в итоге максимально нагружены фаза и а почтение уже по обновленным данным чтобы проверить что и решение их корректно обновила в себе и очень важный пункт здесь в том что упорно лет есенина купе с они на потребление ресурсов нет просто минимальной лет инси система тестирования оценивала решение как сумма времени ожидания на все запросы если решение успевал отвечать в один connect она долбил его один коннектор по одному не успевал он создавала новые connect и connect и коннектор и пока она не укладывалось в требуемый лимит это очень важно и для языков там со сборкой мусора там и прочих это имеет некий особенности если это просолить образно то формат данных был примерно вот такая то есть у нас есть 3 сущности у юзеров есть собственно почта имя но неважно пол дата рождения темп темп у места есть название страна город и расстояние от города до места в это неважно но ценных и поля и софтом визита есть ссылки на место и ссылкам и внешний ключ на юзера в терминах его там более имеет рисунок тонах на первый взгляд карту все просто казалось бачило взяли загрузили ничего интересного но все немножко сложнее из-за двух запросов запросы получения визитов пользователя и запросы на среднюю оценку и развлекательности по всем юзерам которые там были за фильтрации в чем правда фильтрация не просто для юзера визиты не просто все визиты юзера а все визиты в интервале дат и с названием по стране с ограничением по длинне по расстоянию которое посещал и эта комбинация любых вариантов может быть может быть никакие дай мне всей может быть запрос который не выберет ничего ну или какие данные и получается что вам и хотя как бы идем в данный юзера нужны все данные связаны с ним из таблиц визита и локейшнах побудем полям приходится выбирать похожая ситуация со средней оценкой нам нужно опять же по дате по возрасту по полу фильтрацию делать тоже нам нужна одна таблица нам приходится иметь зависимость еще в других но индексов там или как угодно в качестве маленького отступления до одна из самых сложных задач в этом решение оказалось посчитать возраст пользователя вот это ушло на неделя участников этого понять как вообще рассчитать возраст это было очень сложно но этим сделать а казалось бы простая вещь да у нас есть текущее время у нас есть поле без dv юзере и нужно посчитать возраст казалось бы но эта простейшая вещь но вот особенности в чем чем больше более велосипедные решение было участников тем сложнее было им посчитать возраст там приходились таки а давайте мы високосный год посчитаем что это 330 5,25 там дней тогда и прочее там плюс-минус 1 очку посчитаем и плохо это ладно високосные просто более сложные вещи что дата рождения меньше нуля многие детали ошибок и не корректны запросу это такое ну ничего сложно чек родился раньше 72 года казалось бы до более сложного пост на которой я сам нарвался это типа наливать дата рождения первоначально читал что поле не задано но в качестве хавка оказался мальчик родился в полностью там три часа ночи вот десятого года тоже и самая забавная вещь что оргии они выкладывали ежедневно базу данных тестовый код небольшой набор иногда забывали и обновите получала что если база гнедино позавчера у человека положение вчера а мы запускаем тестовый данный сегодня то неправильный возраст и вот все ищут баги переливают решения там в чате просто уор крикет штатах как а просто данные старые дошло до того что 5 выложили пример проданы питоне как они-то генерят но ногой это выглядит вот примерно вот такая простейшая вещь не знаю раз взяли дату разобрали на год месяц день вычли годы собрали новую учить а локейшн и потом важно через текущее время в нашем at emc темпе данные в базе были эти хищные ну чего сложного когда она в это реально заняла неделю вот бурление в чатах и так что у нас есть плане 2 запросов на чтение с индексами если делать на в лоб то нам нужны данные что по каждому юзер нужны списки но кадиш некотором случае всех его визитов и всякого локейшнах по которым мы могли бы продвигаться в дальнейшем ли фильтрации если взять так-то нас вариант выглядит уже вот так вот и это не очень хорошо ну на мой взгляд ибо нам нужен уверенность и низко в этом обновлении на чтения что здесь можно было бы улучшить адат очень важный момент что тест выданный примерный объем такое что нас примерно есть 800000 locations of у нас около миллиона юзеров 10 миллионов место посещений это исходные данные потом они выполняются на второй фазе апдейтов это вот минимальный да и по сути запросы дай мне визит юзеров с фильтрами дай мне оценку локейшнах с фильтрами и to join трав таблиц в простом варианте на коне 3 лицом ки и опять же на след инси низкий там будет очень и в общем это многие шине посыпались нет ни одного решения да нет ни одного решения которые бы попала хотя бы в топ-50 который бы использовал готовую базу данных абсолютно we stop это велосипеды просто самописные решение есть некая но мы д.б. я не знаю это как то не значит такой но мы db слышал могло быть вот один из участников третье место он написал что он использовал db и не значит что это такое я не нашел что но может туда самописная база запись на ipad это решение не знаю google не помог найти ничего такого адекватного какой-то известную молот все все были велосипеды собственные тоже стал делать велосипед сама начала и общем-то не ошибся заходов было несколько то есть это не спер попытки заработал нормально что было интересно что начался конкурс там 10 августа а уже там через два-три дня начали принять решение в основном горные первыми людьми которые написали корректно проходящий тесто решение были гопники видимо как удобность языка для быстро прототипирования получилось лишь на решение там ближе ты тоже через неделю-полторы их уже одному заметная разница и такое решение нам нужен неких это та пышной сервер но как очевидно дано мужчин парсер джейсона ибо все запросы ответы должны быть джейсоне и как в чем-то нужно хранить данные которые нам нужны как тестировалась тестер на предполагала оригинально от авторов там собирается какой-то бин бинарник не знаю там скрипты и тогда лизы запаковывается докер имидж отсылается им докер пушем они там в очереди запускают в раю цифры и получалось когда-то там ринулись участники там их было по моему за 1000 уже ожидания занимало часы вы представьте такой добавкой не мелкая ошибка которая занимает часы на каждый запуск ну это было очень ужасно я для своих целей написал решения которые потом выложил всем получился звездочек маленькое простое решение на вас в пышном этом косяка клиенте который долбила мои же решение тоже на горке и обстукивать а что важно решение тестировалась индекс танком и организаторы выложили патроны но это некие тестовые данные к запросов примеры не те же самые что на про так что не чтобы нельзя было обвинить ответы для них до сделаны тем же самым генератором данные о них выкладывали на git хоп и можно было собственно сделать решение которое брала эти запросы долбила собственное решение и тут же выдавала количество некорректных там тайм-аут или плотность и прочего качество маленького решить это здесь локально как это ты снилось оказалось что в плане задачи для тестировать именно на латинице там не на другие вещи самые полезные вещи это подсыпку это топ асока мульт аккумулирование им то есть самые медленные функции включая все вызываю мы из них а по употреблению память это выделяемые объекты несколько выделяется памяти не сколько используется сейчас а именно сколько суммарно за все время выделялось ним на сущности ибо мы боремся со сборщиком мусора в этом же будет и сбор профиля занимал часы то есть условно или когда он решения была стабильная оставляла научно запускал на него врк и он там там по 8 часов добился получала что у нас есть такой качественный профиль из за того что у нас сборщик центрирующий то есть он ловит не все это мелкие вызовы а вот за часы за многие часы позволяла собрать максимально полный сборщик самых мелких функций которые называются это было полезно долго да это долгий запуске первый заход который взял казалось их от последовательности т.п. это был очевидный момент решение в чем у него были первые проблемы во первых функции получения пути аргументов медленные в том плане что они честно партия запрос универсальном алгоритмы немножко там иногда выделяют память там есть short пути которые обычно срабатывает носится вот-вот а сорян и простой кнопочка о классно ведь это простое действие мы переводим с такую байт слайс у кажется как компилятор может идти оптимизировать но в 18 лет вы не делает и кажет такое используем это локация когда речь идет огромном количестве потоки запросов там их то там очень много и мы боремся за лето msi каждая локация это плохо затем приходилось бороться ну если с локации боится все просто мы вынесли его в переменную используем да все мосты башни это локаций то с вариантом по парсинга запроса все уже хуже там нет решения какого-то из коробки но это был опережением надо было счет начинать в плане джейсона взял а надо вот вас есть некий визит у нас есть оценка как его сделать опциональным и потребовалось некорректные запросы отшибать по ошибке тип в этом не передали поле вы передали некорректно значение поле и так далее а если просто вы сделать опциональным допустим указатели но часто делается да но при этом получается что у нас есть 10 миллионов визитов о суммарно с локейшнами юзеров у нас получается 56 миллионов указатели которые просто есть потому что мы так захотели и на каждый обход сборщиком нашего и помог получаем 56 миллионов обработаем показателей и всего свидания это непозволительно я сделал вариант с тем что то просто флага вы и поле было не задано поле еще может варианты типа оценка меньше 0 и атом или больше там максимально но это уже кто как хочет я сделал такой вариантом все теперь у нас есть структура не имеющая указатель она является одним объектом для сборщика зато это помогло отличать корректные значения отметка рек одну лафа от строками зачистила слишком уж их float афон все это заработало и в чем проблема еще в том что если мы хотим хранить не строкой который собственно это указатель который где мы меняем она suites новая строка на каждый раз за его не мутабельные мы хотим быть слайс это не работает он не он при таком использую не мы получаем фу строку вместе с кавычками и это вот не то что хотелось бы иметь тоже это стандартная будто то вот работы так я взял что ну это вот buger это был пир попытка использования это потоковый парсер который во первых не держит джейсон целиком в память и он позволяет потока бежать и вторых лол при парсинге возвращает не новый объект он вращает слайс указатель именно исходный буфер сейчас что мы не выделяем заново боится лайса просто с лоис хедиры который может быть это не очень хорошее решение там много проблем но вот дальше будет лучше а в плане обратный стерилизации когда - ты армировать ответ простой вариант это машин маршал у нас проблем в чем во-первых мы приводим наш объект интерфейсу это аллокации на buffing во вторых этот метод в функция она возвращает нас новый buy слайс эта локация это тоже очень плохо если мы будем на к аллоцировать буфер ответа это мы никак вообще причем сразу а другой вариант собственно кастомным методом это почти то же самое ничего не помогает но может быть чуть лучше в плане что мы интерфейс не создаем вот вариант такой где заметание проблему под коврик что мы спрятали все равно есть куча интерфейсов потому что я предпринимает собственно динамически размер трофея зав но это работал перверсия так этогою версия выглядело таким образом что мы передаем буфер заранее выделено который мы перри используем на каждый вывод поэтому какой-то момент он вырастает на размер максимального размера ответа и больше не лоцируется все это происходит в 1 там не сказал ответов еда это ужасный код который можно было сделано куда генерация но работает хорошо а ноги все то есть мы заменяем полностью строкам fat and end который опять же не вызывает аллокации при преобразовании intake строке 22 место уже пишет в существу имеющейся буфером дописывают него этот код не аллоцировать ничего принципе если он уже заранее будет дальше сент-пол что плохого в этом коде если мы боремся за каждого локацию там и и прочие clancy очень много очевидно проблема вчера какая что мы берем из гетто интерфейс мы кострому к этому типу а потом в cvut обратно пишем уже кастомный типом получаем обратно boxing кастомного б который байт обратно в интерфейс и получается у нас на каждый фут мы получаем новую локацию мы как бы имеем по уму при этом и опять поцелуемся это вариант какое можно все мы можем получать и гетов перемену интерфейс опустить уже ее да ну в общем так делать не очень хорошо а вторая проблема в том что при срабатывании сборщиком мусора мы теряем все наши собственно пол и потому что они так работают при сборке они ощущаются и после каждого собственного сборки которая еще выполняется мы теряем все наши каши так назовем это тоже плохо но если хватает это нет необходимости прям бороться за каждый там микросекунду то можно взять лучше вторая вещь утоляла который auto phase т.п. я попробовал в тот момент она работает лучше чем стандартное ну и но для бойца буферов ну так сколько процентов она реально удается стабильно другая проблема в чем была что у нас было приходит запрос g sony там есть числа нам эти числа мужчин if in to me они строками в стандартной библиотеке нет способа получить строку представлены байт с лайсом из нее int все методы имеющиеся они оперируют строкой все если а если мы переводим boys like строке то это локация есть и шью заведены на эту тему и там организаторы сказали ну просто работе что мы не хотим удваивать количество методов и стыда либо будем надеяться что компилятор научиться то оптимизировать как например дела там с кошмарами сейчас и прочих вот что вариант пока так и в качестве решили тип опишите вашу реализацию как хотите вот я написал свою реализацию я не пробовал в 19 может быть там он научился оптимизировать но не знаю 18 очень имеет так хранить данных более интересные вещи переходим и киты были водные вот у нас есть собственно индексы да ты нам нужно в любом случае как-то поедишь никуда запросе получить данные по этому объекту для и я юзеров и место взял просто подпиши маму с указателем потому что не можем поменять поле map и не собственно прочитав его в переменной как бы если мы читаем а потом пишем объект на обратно-то без указателя если его не будет опроса полностью копировать все поля юзеров кого-то структур поменять там полей копировать обратно нет с указателем и получаем копировали лишь по указателю но при этом мы получаем что у нас map и является уже не единым объектом для сборщика мусора а и приходится продвигаться по всей по ней для индексов юзеров локейшн это было не столь от актуальная ну по филировка а вот для визитов которые 10 миллионов что делать переделывать и заменять это на сла из указателей и отдельно заводить мапу маппить айдишник посещение на яндекс в слайде а это очень сильно позволило ускорить это переделки юзеров лакиш не просто не дошел я хотел сделать так везде это реально позволяет ускорить именно обход куча дальше а да вот если мы возьмем какой-то очевидный вариант что у нас есть юзер у нас в нем есть список визитов локейшн визиты в это место и просто будем хранить список кадиш ников таком в таком варианте да для того чтобы ответить на вопрос дай-ка мне там все визиты этого юзер нас будет достаем юзера достаем его все визиты покажем визита достаем данные визита по нему но понятно да даст им локейшн фильтруем получается что на каждую запрос нам приходится делать куча беготни в разные области памяти и нас полностью вообще не используется какой-то либо там кашированного под новым процессором и вымываем кэш постоянно шум бегаем по разному памяти хочется более локального кэшировать все данные которые требуются для запроса как для фильтрации так и для выдачи ответа хранить их рядышком именно рядышком в плане оперативной памяти в таком варианте это было очень медленно это было там какой то это может быть десятое место извинение же вообще то плохо почему да собственно это плохо это был очень и к финалам финала там вообще прошло уже там доли микросекунд а вот собственно это выглядело первый заход то есть все у нас работает работает работает но все хорошо у нас там время ответов потому какие-то там десятки микросекунд кто пошел сборщик страсть и это я и мы получаем время ответа там почти си почти секунду то есть там когда получают это просто феерично медленно это ну вот это уже тогда это было уже плохо хотя это был где-то середина еще место проведения я понял что то что мы использован фарс хаттаб этот бургер джейсон парсера такого хранение индекса она не подходит для этого решения она слишком медленная в плане реализации ну да около 150 я пробовал экспериментировать задание собственно размера срабатывания сборщика цепной пес он то есть со 100 процентов мусора там делал 200 триста-четыреста это позволяет да это позволяет отсрочить пик но если он приходит он просто пробивает потолок и уходит еще выше этом большом мусор даму собираемого дольше пробовала какие вещи пробовал выключать собственно сборку мусора и вызывать и руками между фазами тоже как такой грязный хак он помогает но если мы все-таки успели на генерить между сборками мусора чуть больше там и полностью опять же путь собираем мусор во время нагрузку тестирования и опять проигрываем и так жить было нельзя поменять язык и не хотел второй заход речь шла о микросекундах 10 секунд на каждый запрос даже на самом тяжелый запрос там с фильтрации из премирование десятков ответов требовал от адрес не волос 10 микросекунд и что было задачей я сел за профилировка именно вот точки зрения локаций во-первых переписал полностью джейсон парсер был самописный велосипед и не проволоки такой генерации типы там и сейчас он и прочее ибо это было написано не знаю там за пару часов над не охотники будут конфликтом интересно самописный конечный автомат который парсит просто джейсон под формат данных это не абсолютно универсальный алгоритм нет он делает он проходит все тест все что он делает он поэтому да он ни каких аллокаций данные собственно не выделения он показывает и мы прочитали is safe to buy слайсы парсер возвращает указатели на этот кусок данных ничего это собственно все он выглядит как то есть метод парс дата который умеет парсить массивы и есть метод портретом который имеет парке этих и шмапы кто это позволило по все ответы без за локации в плане индексов хотелось да собственно чтобы все данные и для фильтрации и для формирования цвета они были уже рядышком в одной структуры без указателей по максиму без каких-либо там локации ничего там не сердцами не не формировать никита изменение 7 идет уже комод для дачи я пробовал хранить прям готовые джессом ответы выпилить но особо вывешу не получается а вот то что мы добавляем 10 миллионов вас 1500000 например элементов в кучу то это замедляя сборщик мусора мы просто проигрываем . я же давал такое ухудшение во-вторых мне хотелось вообще использую сортировку никакие не сорт сорт ни каких во первых это кал бег нашей функция вторых это boxing того перемены которые мы сортируем это медленно но для такой задачи и хотелось уметь обновлять данные прим при фазе обновления многие многие решения которые других участников они как делали они писали на во время фазы обновление данные на обновления куда-нибудь там а когда фаза обновления заканчиваться не возникает применяли это позволял отвечать на обновление быстрее ну и торфа зачитывалась сколько времени вы обновляете данные но я хотел все делает уже прям в процессе нагрузочного теста что было сделано вот для посещения данных визита мы храним сразу все нужные нам поля для фильтрации для ответа прям в структуре более того не просто мы еще и типа дату визита который надо выдавать им с темпом хранится уже стилизованных строку и чтобы при чтении отдавать просто вот собой все все дистанции расстоянии 1 ники все есть оценка хранится уже не байтом от 0 до там бти а уже прям символом ноль один два три четыре пять шапки должны обрабатывать ясно проблем было в плесе то есть от название места в том что по условию задачи он может быть до гигабайта и как бы хранить сразу гигабайт данных на каждый узел визит нам не хватило что гигабайт памяти подо все ну вот единственно место когда ходят наружу что в плане сортировок так как у нас могла поменяться адана требующим они отсортированы были по времени в ответе но время может меняться в фазе обновлений в этом нам требуется перестраивать индексов пересортировать их при обновлениях чтобы не делать эту сортировку при чтении а не хотелось использовать и ров q поэтому как делается мы сразу вставляем элемент в нужную позицию необходимость раздвигая элементы за ним дальше обычно это получается это up and который скорее всего не делает новую локацию там есть немножко больше выделяется а потом копи фрагмента памяти довольно быстро операция это позволило вообще выкинуть какие-либо сортировки сразу со сдвигом массив как нам нужно единство проблем обучается в том что там есть сложные индексы внешние ключи которые там и каскадное обновление как в базах данных что у меня им один ключ к таро являются в поле которое является внешним для другого индекса на приходится заходить в тот индекса перестроить его тоже такими же методами новички особенности но исходника все есть мог стать последним зависимый индекса что приходится каскадные обновление других индекс пересчитывать в плане серверов hp хороший могут назначить им требуется минимальная в то есть это было не очень хорошо и 1 попытка его оптимизировать не последнее было переписать на голову над конечно то есть пекан их под ним а ему руками все обрабатываем парсер который был фазах такой был записан опять же на конечный автомат который умел партию просто их это там и но когда-то пышные запросы нужно формате опять же неких аллаха цена happy те же указатели на уже прочитанные данные соки то но основная была проблема в том что такой классический подход нам пришел запрос и мы запускаем грудь и ну обработка этого коннекта это было плохо потому что в профилировки было заметно видно как мы запускаем эти грудь и на как они работают синхронизация для доступа данным это было не очень хорошо хотелось еще дальше следующим шагом было переписывание на голос тискала socket собственно получения приму мы выкидываем все обертки мы получаем файловый дескриптор операционной системы используем регис adr и risport а зачем вместо того чтобы на каждый connect запускать новую грудь и на обрабатывать connect сразу запускается ну четыре данном случае это по количеству я der garten они привязываются к системным потоком чтобы они не могли мигрировать между рядами и сбрасывать как процессора и именно и поднимаем 4 случае слушающих соки то накажите грудь и пресс нас есть четыре системных потока которые слушают один и тот же socket и кто первый поймал себе как бы новый запрос то ты вы обрабатывает обрабатывает в себе же никита могутин не вызывая и софт на это был самописный пол собстна угашенный реализован для этого дела на имеющейся сколах мы выкинули все полу мы выкинули все грудь и на никаких каналов блокировок никаких там буферов райтеров ничего получили запрос быстренько вадим патока обработали ничего никого не ожидая ну на фазе чтения не на обновление конечно и тут же ответили и ждем следующий запрос в этом варианте получается что нас есть четыре независимых потока которые независимо обрабатывают без блокировок и могут нагружать себя на сто процентов все четыре ядра такой схеме дальше еще больше хардкор какой пошел следующий этого было недостаточно по-прежнему для что так это выбиться более менее хорошо что это уже грязной хаки было сделано при аллокация слайс of чтобы не делать когда мы up and расширяем в байт слазь который переоценить память копирует но данные мы сразу видим что у нас там будет юзеров значит там миллион давайте выделим заранее миллион двести ну понятно да локейшн 700 тысяч до миллиона визитов 10 миллионов 11 и нам этого хватит многие участники так и заложили собственно это была не просто к этому этом ноу-хау это было решение в чатах там на микаса почти все так делали а в чем проблема в том что если к нам организаторы осознанно пришлют какой-нибудь не знаю визита иди там допустим не 10 миллионов 100 миллионов пятьсот то кто-то пойдет вниз свою память и умрет просто по только doc многие решения были то что ну да ладно они такого не пришлют оргию или не мы так делать не будем но может и будем но может и не будет в качестве решения просто использую такую обработку я делают опытный map и которые получили пустые и которые хранят идиш ники тех объектов такой вылезали за пределы если все же орги пришлют нам объектом 100 миллионов чем-нибудь мы пойдем павел что он больше подвижнику чем максимальный размер слайсы и пойдем против кошма по домам получим замедление на поэтому с мужем хотим корректно то будет запрос не слышно это такой хак который позволил солдат . стороны максимально быстро отрабатывать корректные запросы и с другой стороны не умереть на специально сформированных некорректных которые должны быть быть учтены но финальной тестировать из вопросов не было это было сделано просто not argue сдержали обещание с другой стороны вот когда боролись с пиками пике продолжали появляться и у многих была высшими да это все ваши языки со сборкой мусора до ваш борщ и там да вот явка что эксперименты выключил сборщик вообще во первых это особенно при запуске выключение плюс устоять и пирсинг минус 1 типа не запускайся и ради интереса запушил это решение организатором она выжила оказалось что после всех этих темизации вообще не выделяет память в собственное тестирование учился вообще сил практически и собственно явно христа нет ребят эти пики это не моя сборка мусора пышнее и нет я память не выделяю еще более грязные трюки иногда на но там же 330 обстрела есть стадия чтения стадии обновления статьи чтения между ними пауза там несколько минут там ну там собрать мусор там или просто отдохнуть не знаю орги сделали и поэтому часто у многих решений то мы на разных языках не только там на год а малина на session их решение до возникало сильный всплеск на 1 2 там миллисекунды секунде за новой фазы никто не мог понять почему а просто казалось бы ну решение отдыхала ничего не делала пришел запрос мы отработали connect уже активен сетевой до от тестируем решения а и было предположение что возможно так как у нас это решение которое индекс танка работает в том же все сервере то возможно банально потому что наш сервер простаивает и ничего не делает его тупо слой под собой вот снова когда его снова дергает он поднимая своей странице свопов по оперативку или мы получаем пик это решение позволяет сказать системе слушай давай-ка ты не будешь фунт коленкор an't всю память который я уже выделил опыт на диск в решении свеча давай-ка ты не будешь это что я в будущем выделив опыт на диск но corinth работает без прав рута а фьючер убивает приложение если она запущенный без рута и что не поделиться я решил не рисковать тем более это было предположение по было свопы используя просто корунд это действительно уменьшает пить и я не знаю совпадения не совпадение но это а который остался в коде и совсем уж черной магии который я не знал бы уже того это собственного простить фискалы пол мы ждем на этом соке те ждем на события и последний параметр это тайм-аут ожидании -1 говорит жди пока событий не придет казалось бы это логичное решение да если ничего не зачем нам просыпаться но оказалось что гораздо эффективнее почитать 0 если нет сразу выходе в чем смысл в том что если мы делаем -1 и событий нету какой-либо причине то профилировщика питона систем может наш поток забрать управление нашего потока над этим другом в системе под запрос нулем снова в защиту пролей нашему потоку мы смогли уму событий не тут типа вернулась 0 давайте фриком еще раз опять вызываем ноль опять еще равно постоянно долгим процессор получается чтобы вы же ранее на сто процентов циpкa ну по этому парню планировщик операционной системы видит что мы реально работаем что там полезные делаем и не забирает у нас планировку мы всегда работаем это позволяет ускорить положение почти два раза топ-6 решений используя это решение по 5 как мы узнали потом да вот собственно он все сделал это грязная магии но это и шенги продакшна мне кажется если ваш сервер ничего не делать но при этом выживает все доступные ядра всегда постоянно это не очень хорошо если вы платите за это личество там и прочее итак в чем итог это цифры получены на локальном тестируем индекс танкан штангу до то есть один запрос это 20 50 микросекунд 20 микросекунд это легкий запрос печатника секунду это сложная фильтрация стану запросами с удачно большого ответа но как это для код для к это было неплохо тест который совершенно бесполезен и бпс не мерил то вот это решение 4 ядрах выдает вот 200 405 . рпс of на 4 кадрах мы и вот он домашнего компа собственно не получился . 90 место это лучшее решение в носах то есть периодически место тратишь на решение 1 через с вот этим вот бузи полингом и с ним бы я получил это место и вам запустилась после тестов поменял два байта и поднялся бы нашей с мест ну ладно не столь важно это было весело а а вот я там редиска не буду в этом рассказывает они прагу скорее всего думаю уже орги никогда больше не использовать яндекс танк для задач связанных frequency это ну все вопросы там довольно символически там это жесткие диски там и прочее ну и как я что первые 10 место и спасибо во-первых я этим занимался джаст фо фан потому что по сути я как бы являюсь сотрудником и мне не полагалось в принципе никакого приза кроме футболки я получил не тоже не было желание что выбиться в топ 6 машин но я ну выпить что-нибудь не получу вот но то что получил skype 11 место это ложь на решение оказалось лучше решение мистично почему она была выше многих других хищных решений там java узких и прочих вот это вот он это было приятно для этого языка возможно благодаря тому что я не выделяю память вообще привет подброшу немножко холивара а раз был где раз можно посмотреть там есть на сайте где-то до 20 30 поможет вам есть но от печалька слова и смотрел поддержали решение на расцветом восстанови проблемы с его были то есть как раз таки с моим a dimension проблем не было стать я помню что там есть с нашими который был на джайв то 50 оно было какое-то место зато чем-то и там был успешный и пул то есть doblo сетевая либо логика power seti была на джаве ну такое грязное но java решение единственно есть 50 мест все твое решение но в итоге все таки нога получилось ну чистый гол был такой знаешь он такое да низкоуровневые особенно постепенно с этими итерациями профилировка есть опускался пускался пускал вашего даси сколов и пулы при локации все что только можно еще вопрос можно отвернуть где ты портишь запросы тут или чур а вот это нет раньше где http-запрос какой роутер то использовал а никакого какой ровно напрямую прям лишь а как же масса локацией какие нет никаких локаций вообще роутер слишком медленная сейчас где нет это адрес в начале был вот это была уже вторая трасса хаттаб и выкинул кокосовыми как медленное решение о каком вообще роутере потоковый парсер запроса конечно автоматом получая вычитываю и соки то с ростом сколько не прилетела и от сервера килобайт незанятым и просто бегут по особенно конечным автоматом попасть слайс у спасибо то есть только так начинал акации привет ты его полностью руками написал там писать там . 300 может несколько часов и все тем более имея или локальное решение которое может под нагрузка подвесить я пройду фона работает корректно все запускал врк кучи потоков наставлял его тон потом сравнил ответы с эталонными а этот подход когда просто нет конные без всего все очень чисто и где еще можно пользовать ну да то есть мы вот вас хотя бы не используем а вот именно что будет прямо напрямую на этом максимально близко к сети что еще вот где еще подобный подход может быть полезным для гор на имя контексте во мне кажется в на решение это решение там дегу не применяют наверно используют обычные системы хардкор вот реально но у нас на работе есть похожие вещи но такого своей гору then it и выкинул и 4 давал ключи серию сброшены которые что было 205 запрос пришел она выдерживала и больше количество в параллель так всю нашу операционной системы есть особ как-то называется буферной в количестве страждущих к обработке это все под линуксом было его его не tune ли мы заливали docker и мы туда то есть у них были свои системы нас там была какая-то до black box такой но они могли схитрить учета что невозможно даже позволяли сводится то там не удивится что когда полный прыжок по моему позапрошлом митапе кошкам mail.ru человек какой то говорил что они выписок из сервисами тоже писали на партия сетевые протоколы чтобы не создавать грудь и на каждый запрос так что толкаться избавлялись на буферы чтению запись с таких местах нами можно если вы пока сервер с огромное количество подключений полном позапрошлый был метод в mail.ru по моему них на хопре даже есть босс по этому поводу да так что чего то вода для почты по моему да у них товар или спасибо очень интересно круто а вот изго выкинули все что году получили такой село и соответственно если вы сохранить тот же самый подход и написать все над твоим нет явно мир стал переписывать думаешь это была бы такая же производительности могло бы выше и за счет чего если там за счет компиляции хищных то есть апреля тары и гораздо лучше оптимизирует код понятное дело но в плане этот код не понятно что он такой низкоуровневым по-прежнему понятию то есть это писалось попыхах это писалось собственно по странным переписаны на может быть хочешь посмотреть служил на исходнике сколько строчек кода там училась и станут еще полторы может я не помню отсылка на гитхабе там все есть спасибо тогда первое решение написал которого была на phase of the псж это с букером парсером но может дня за три но ведь три вечера там после работы еще три недели оптимизировал это все 100 но я сказал что то что первое решение которые появились которые проходили тесты были гошей основном assist неделе появились первые они дописали видимых место свой кода не писали бы я не стал это то есть собственно вот пятое место позволил бы я знал про бузи pulling помогут очень хорошо для год это помощи прекрасно продакшен код но время это ушло много кто год бузи pulling ну возможный конь кафе котят и трейдинг это хорошо но для обычного репрессировали которые живет все я так и даже не простаивает но это она сможет прийти там на 100 микросекунд забрать управление без себя то мгновение ну дальше почти а там были в а давайте мы влезем в ядро напишем своих сетевой стоек но докер нельзя алексей спасибо за доклад осмотрите такой вопрос вы по сути реализовали какой-то варианта обратного индекса если оба не понял ну можно так сказать ну да там фоне нормализации чтоб индексов после нормализованы дома второй вопрос а вот обвале сжимать данные но обязана говоря ни один указатель на нагая пробное на массивы да я пробовал там было самолетом будешь там типа таки названию стран хранятся но мест честно иду вот уже скоро понаписал то что здесь есть много строковых полей название места страна то есть собственно это не повторяющийся данные я пробовал делать отдельные индексы но с того что мы при формировании ответ должны сходить в другую чеку памяти услугам ухудшаем вокальных данных это замедлял как уже от меньше памяти на поэтому он тратит топлив нее цикла процессора на походку дату в наружу наружу я пробовал то был эксперимент но он не успешно а если это смотреть там например вот пользователи поедешь ником если 5 пользователей посадить на там по 10 объединять как бы в ячейку это могло бы улучшить потому разумную запросу а то есть никакой группировки там все независимом работу спасибо пожалуйста тот сказал что компилятор секта раз хорошо оптимизировала а ты про волга цикл я пробовал его времена гол 15 и с тех пор его не трогаешь на был все плохо с ним если смысла но для тушить до возможного сам робот и не используйте рутины канал блокировки возможно до окажется мало кто его праву узнаешь написать на головы пилить из него всего потому что телесным компиляторов так это свиной ориентацию вообще эту тему можно развить до есть же там спали раз gonna see не нашел а то мне не был очень времени на это"
}