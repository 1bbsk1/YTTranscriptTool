{
  "video_id": "JBIm4sglyQU",
  "channel": "HighLoadChannel",
  "title": "Успехи и провалы с Redis / Иван Летенко (Infobip)",
  "views": 25155,
  "duration": 2782,
  "published": "2020-04-14T11:16:13-07:00",
  "text": "я очень рад видеть здесь столько людей это большая часть говорит с этой сцены на самом деле сегодня доклад будет про редис и он будет как про operational часть так и про разработку я конечно не очень хорошо вижу зал но кто больше пишет код и разрабатывает что-то поднимите руки окей о много а кто больше operational management и devops ведь тоже есть но отлично я уверен что и вам и вам будет полезен этот доклад на самом деле этот доклад он объединяет наш опыт опыт не только не только моя не только моей команды но еще и других команд и в первую очередь я хочу сказать спасибо андрею маркелова за помощь подготовке этого доклада на самом деле это как бы это наш общий труд и общая работа и так мы уже начали немножко говорить про инфо бит то чем мы занимаемся мы помогаем бизнесу общаться с клиентами то есть когда вы получаете эсэмэску от банка когда вы получаете сообщение о том что ваш заказ прибыл за поделить его на почту от интернет-магазина когда вас ждет такси в любой точке мира скорее всего это сообщение прошел через нашу платформу мы работаем по всему миру и процессе 350 миллионов сообщений в день и это не просто сообщение это каждое сообщение нужно принять обработать отправить и возможно изменить а про обработать отчет о доставке предоставить статистику аналитику еще очень много чего что все это работало у нас есть лед 6 дата-центров тысячи виртуальных машин больше 350 инженеров и 700 различных сервисов которые мы каждый день диплом и многие из них используют radice ну теперь когда понятен контекст и размер проблемы давайте перейдем к радиусу мы его в инфо биты очень любим это практически самый она часто используется база данных да давайте называть его базы данных и за что мы его любим потому что это очень быстро это очень легковесный инструмент с которым легко начать и как как всегда когда вы что-то пишете когда что-то разрабатываете скорее всего это уже нужно было вчера и в любой новый сервис а мы ж в микро сервисах очень легко начинать когда у вас есть ли хороший инструмент кроме того он чертовски быстро я честно я не знаю кто работает быстро в памяти несколько цифр чтобы так сказать подкрепить эти заявления been away образ самого родиться меньше десяти мегабайт пустой лист из памяти занимает всего 3 мегабайта и 1 миллион простых ключ значений это не больше 100 мегабайт при этом все это работает на скоростях до миллиону больше миллиона сообщений в секунду когда мы играем про редис первый кейс который возникает естественно у всех это кэш его использование как кэша но я думаю что такое кэш перед базы данных всем знакомо если мы не находим в каше идем базу данных берем значения отправляемого дальше уже в кэш все хорошо с кэшем пока естественно данные там не могут жить вечно как известно есть 2 проблемы вообще войти это именование в разработке то именования переменных и инвалида цпш данные в кошение живут лично поэтому мы хотим чтобы каким-то образом они очищались что-то происходило при этом чтобы все это работало автоматически и из коробки все это называется вот этими словами из трех букв ттн время жизни наиболее часто используемая и наиболее последние используемые значения то есть например на в кашах в каше хотим чтобы у нас лежали только те данные которые мы наиболее часто использовались и а все остальное автоматически оттуда удалялась окей все это есть в одессе но естественно за все приходится немножко платить отель он влияет на производить он занимает дополнительную память поэтому если у вас много маленьких ключей то скорее всего вы заметите прирост памяти кроме того удаление ключей происходит не происходит как пассивно такой активно пассивно при обращении активно каждую несколько раз в секунду родис проходятся случайным образом по ключам и проверяет не нужно ли их убрать и до 25 процентов от максимальной скорости от максимального балка который вас был может оставаться в памяти иногда это заметно и чтобы все это работало чтобы автоматически и векшин работал нужно обязательно задавать макс мы мыли и макс мои полисе и это конечно огромный огромная огромная сфера для подводных камней макс memory наверно это самое интересное что может быть что что что есть настройках редиса ну например у нас есть мастер реплика про репликацию мы еще поговорим и хотим установить какой-то маг сменами как вы думаете сколько лучше задать допустим у нас есть виртуальная машина 20 гигабайт ну и 15 хорошее но 11 от нынче чересчур пессимистично но я уверен что это будет работать пятнадцать хороший вариант ну 10 тоже очень экономный давайте посмотрим ну первый вариант был 15 ну я в презентации выбрал 16 мы тоже когда первый раз задались поэтому проблемой ну выбрали 16 окей как это дальше будет работать ухты ну ладно здесь должен был быть края веселый смайлик смайлик нужно все знаете смайлик взрывающейся головой я вот тогда буду пояснять никакие смайлики итак у нас есть мастер у нас реплика мы хотим с репликой что-то сделать например ну это же безопасно это же просто реплика у нас чтение и запись идет мастер мы решили обновить реплику пропатчить машину или еще что то но перед ее перезагрузили что происходит дальше мастер обнаруживает что он раз синхронизован с репликой полностью раз синхронизован и нам нужно сделать полную рипли к цию отлично начинается полная репликация в этот момент на же highload идет мощная на груза нагрузка на запись зачастую она достигает десятков десятков тысяч операций в секунду окей мощный обновлен систему бах приходит one киллер и убивает на shreddies ну ладно у нас включен persistent то есть принципе ничего особо страшного мы сейчас все восстановим restart мастера мастер понимает что он рассинхронизированы плиткой ну и дальше вы понимаете что происходит идем идем идем идем снова по кругу что к как нам выйти из этого замкнутого круга ну в способ только один добавить памяти на машину и так как устроена я аппликация в одессе вообще есть три варианта кстати я не сказал в целом я буду говорить в основном про редис бесплатный open source ный иногда только упоминая редис enterprise мы в продакшене enterprise не используем и все наши решения построены на open source нам версии редиса и так персистенции репликация вариант по умолчанию это когда мастер фыркает в для репликации мазь на мастере for каяться весь процесс дальше скидывается в виде дампа и передается уже на слове на реплики загружается память есть в реальной диск лес репликации когда мастер непосредственно пишет сразу в также харкает процесс но данные пишутся непосредственно по сети на реплику и дальше реплика загружает их память и есть еще в enterprise версии это in an application когда мастер срыв напрямую происходит репликация но для всех этих трех вариантов необходимого for кнут основной процесс так что это значит это значит значит что у нас виртуально появится мы виртуально займем еще столько же памяти сколько было в основном процессе если у нас активная нагрузка на запись то происходит копи он в right оптимизация и если у нас обновляется значительная часть памяти то соответственно мы получаем это всю эту же память нам необходимо занять за занять в оперативной памяти то есть соответственно если у нас серьезная нагрузка на запись и чтобы нам спать спокойно нам необходимо как минимум в два раза резервировать память от max- моими то есть если у нас 20 макс мемами то лучше выбрать 10 но лучше даже поменьше но это только если у вас очень большая часть ключей постоянно обновляется но еще пара и рекомендации которые есть официальный в советах это нужно отключить транспорт бриджес что что это такое нет я думаю многие знают что если операционная система если процесс запрашивает память то она выделяет не столько раз сколько нужно а выделяет побольше чтобы потом уже когда придет в дальнейшем запросы выделить из того что уже была зарезервирована но это снижает производительность особенно когда особенно при репликации и при персистенции при когда необходимо делать дам памяти и в.м. а верка и а верка мид мы мы тоже нужно выставить в единицу то есть позволять операционной системе выделять процессу radice ну процессом 100 столько памяти сколько они запрашивают тут можно поспорить но это официальные рекомендации я бы не стал его сейчас вдаваться в эти подробности ok давайте следующий кейс здесь опять взрывается голова мы уже знаем что если у нас нагруженный сервис и в редис редис текущие foot print name и занимает больше 50 процентов науки и допустим на мой один раз уже наступили на эти грабли смотрим на другой кластер там похожая ситуация ну окей то что делаем дальше тогда давайте мы руками что-нибудь оттуда удалью чтобы было меньше 50 процентов потом добавим памяти на машину перезагрузим ее и все решил нокий мы удаляем руками ключи но ничего не происходит память не освобождается конце концов ну здесь не обязательно но скорее всего 2 произойдет придет в м киллеры все заберет от нас почему это происходит потому что фрагментация то память которая уже была выделена процессу ее невозможно она скорее всего фрагментированное ее уже невозможно забрать обратно в версиях редиса до 4 это дефрагментацию можно было сделать только только путем перезагрузки сервера то есть в данном случае из той ситуации мы уже никак не могли выйти начиная с версии 4 есть команды memory pudge который если используется g мало кто позволяет как раз как бы дефрагментировать и еще скоро появится активная дефрагментация который это будет делать бы громадину пока это вариант экспериментальный то есть таким образом promax мемы у нас есть вот эти три винта которые нам необходимо помнить и еще есть дополнительные буферы которые также могут приводить к превышению макс мы мыли это реплика это лог репликации append он ли файл pops up очереди но по сравнению с персистенция это уже не так это уже не так смертельно теперь давайте проговорим про структуры данных которые есть в которые наиболее популярны которые мы используемый любим ну во первых это хэш если у вас вы храните объекты которые представляют собой имеют поля представляют собой как бы объекты то тогда лучше использовать хэш они хранить их по отдельности это знает приводит к значительному экономии памяти все операции также о вполне если за константное время внутренняя оптимизация происходит ради сына самом деле он небольшие хэши хранить видели young листов нова амортизированная время все равно получается констант на и наш любимый наша любимая структуру данных это зацеп это упорядоченный лист у каждого поля у каждого члена листа есть с вес есть скоро и они отсортированы относительно этих весов ну здесь кстати друзья здесь должен быть уже смайлик не взрывающейся головой с ну с звездами в глазах to set как бы успех как мы использовать кейсы ктк как мы используем зацеп давайте поговорим первую очередь про ограничитель скорости кроме того мы их ещё их используем для распределенной планировщика задач и для очередей повторов когда нам нужно с задержкой повторить какую-то операцию случае провала в случае неуспеха это creed лимитер но основная идея что у нас есть окно скользящее окно и у нас есть мы можем допустим за определенный период времени вы выполнить не больше n операции что это может быть например у вас есть какой-то api и вы у вас есть ограничение вы вы не можете вызывать этапе чаще чем там 10 раз в секунду или ближе к нашему бизнесу мы это используем для защиты абонентов от fly флуда допустим что-то пошло не так какая то ошибка и вы стали получать сообщение там подряд множество множество сообщений подряд то есть например мы ограничиваем там не больше 10 сообщений в минуту так точной цифры это как бы всегда так то есть идея понятна как это можно реализовать у нас есть сорта цвет зацеп мы вызываем команду из мрм range buy score то есть мы удаляем записи которые уже удаляем записи которые уже вышли из нашего окна добавляем новую запись и считаем сколько у нас осталось в окне очень просто все это можно выполнить а там арно виде одной транзакции до в родись и есть транзакции и также лола скрипты они оба вдовы по выполняются примерно 1 гарантий примерно одинаковые так это будет выглядеть уже видела скрипта для редиса пара слов буквально про транзакции как и говорил все операции внутри транзакции выполняются последовательно никакая другу вообще редис ядро редиса на 1 поточная никакое другую транзакцию или операция не может их примеры не может вклиниться по середине операции атомарные то есть они либо выполняются целиком либо не выполняется ни одна если в процессе что-то пошло не так то мне откатываемся но пойти что-то не так может только по причине например синтаксическую синтаксических проблем но окей мы используем мы используем плоский пт им давайте попробуем здесь тоже на самом деле есть небольшие грабли давайте попробуем итак мы загрузим и создали скрипт загрузили его на мастер их чтобы впоследствии выполнить ну это как бы аналог хранимой процедуры после чего у нас произошел failover но окей у нас х или available system мастер реплика или plaster даже произошел failover теперь у нас другой мастер в принципе для нас то ничего страшного в плен даже на это не обратили внимание вызываем скрипт бабах получаем ошибку нет такого скрипта как такое возможно на самом деле скрипты кэшируются от на той ноги на которые они были вызваны и либо специально предварительно загружены команды лаут а если мы их вызываем пух и шута соответственно такого скрипта уже нету как это можно решить мы реализовали динамическую загрузку скриптов то есть что здесь важно здесь в буквально две строчки первой команды мы всегда пытаемся вызвать скрипт эпоха и шум надеемся что он уже загружен если что-то пошло не так и мы ловим эксепшен там он соответственно передаем скрип целиком и его он в последствии уже будет там зафиксирован важно сказать что скрипт и нельзя генерировать на ли тут уж вернее можно наделать так не нужно то что они в любом случае кэшируются если вы вместо того чтобы использовать параметры будете каждый раз скрипт генерировать их от ходит туда в или какие-то данные то все эти скрипты за кэшируются и в конце конце концов у вас также утечет памяти теперь давайте плохая плохая в ability ну естественно начнем с очередных грабли с очередной файла у нас допустим у нас опять же нагруженный кластер мы отключили persistent ну потому что нам зачем нам persistent у нас есть две реплики они находятся в разных зонах доступности вариант как бы совсем катастрофические он здесь не должен случиться всегда не бывает глобальных катастроф окей мастер у нас пока этой причине падает совершенно независимо от нас на ничего страшного редис же он очень быстрый шустрый мастер тут же стартует failover не происходит поскольку буквально несколько секунд это заняло restart мастера докер-контейнер все автоматически настроена отлично реплика понимает что она раз синхронизируем с мастером он уже пустой он штука теперь загрузился бабах мы потеряли все данные потому что после перезагрузки мастер пустой это ограбленная на который наступает очень многие и поэтому что здесь важно отметить надо чтобы задержкой рестарта ноды было больше чем время за которое происходит failover о настройках либо кластера либо с энтони love сейчас мы об этом поговорим обязательно есть параметр за которые они понимают приходит приходит к вору му что у нас пропал мастер и соответственно ну как мы это решили мы просто в докер-контейнер где вместе с редис и мы просто добавили задержку ну кроме того информация о текущем пластыри для санты нилов для мыслей для кластера она хранится в отдельном файле то есть central они динамические обновляют информацию о текущем состоянии кластера и в эти настройки нельзя нельзя лезть нужно обязательно зам аппетита на какой-то на хост этот файл где они хранят и если естесно в контейнер и мы запускаемся и не надо туда лезть руками а нужно если что-то конфигу лица то нужно это делать командами еще конечно веселое занятие это убрать реплику то допустим у нас есть машина она была репликой как какого-то мастер и мы хотим чтобы дать теперь был новый мастер для нового кластера и вот это блин не знает а жонглирование командами это очень веселая задача советую как бы всем попрактиковаться тем кто хочет получить опыт настройки hail ability с редисом мы уже немножко затронули тему персис танцам давайте ее туда продолжим в одессе есть снапшоты есть лог операции и их можно использовать совместно и как обещает официальная документация гарантия будут примерно какого позы риска или я подробности не лез я доверяю и извиняюсь и конечно нужен свой backup skip нет никаких инструментов для автоматического бэкапа и тем более тестирование backup а ну тут каждый решает сам мы написали небольшой скрипт который в том числе и в том потом проверяет и бэкапы как скрину всем знают чтобы копы нужно тоже проверять об этом всегда лучше ещё раз напомнить и еще такую кейс как сделать легче жизнь мастеру ну можно вообще конечно отключить пирсинг на мастере но мы уже знаем что это может быть не всегда не всегда хорошо немножко опасно вот ну либо хотя бы можно на мастере оставить up and only на репликах снапшоты дело для для бэкапов уже только на репликах нет тоже довольно часто кейс по поводу теперь продолжим праха я в ability где нам располагать sentinel и как вообще мониторить кластер как как стану собачки это watch dog есть механизм сантана love и есть механизм кластера в радиусе допустимо centennial где их лучше расположить как лучше следить за кластером снаружи или изнутри давайте попробуем как бы провести небольшой и кто кто-то то чтобы мониторить его снаружи стояние кластеры окей а изнутри я не вижу ну примерно одинаково может быть изнутри даже меньше на самом деле тогда у нас возможна такая ситуация когда мы кластер мониторим снаружи всегда возможно по что sentinel и какие то в итоге они остались вне вне кластера у нас наш сервис остался вместе с репликами на одной стороне и реки в снт ныл и на другой когда же мониторинг является частью кластера там это тогда с интернет у нас 10 осталось два есть возможность проведения кворума выбора нового мастера и все работает это очень хорошее правило и теперь просто давайте по дну для того чтобы хай label хорошо работал нужно иметь три зоны доступности и чтобы pink между ними round trip был не больше 10 миллисекунд ну и если мы говорим про режим кластера то соответственно мастер реплики на тоже разбросать между этими между этими зонами так чтобы мастер ли rpg они остались на одной зоне но я думаю это достаточно очевидно но что давайте перейдем к еще одному кейс нашему кейсу у нас есть два дата-центра два больших дата-центра они оба расположены во франкфурте не далеко друг от друга и наша задача что если допустим 1 дата-центр может быть подвержен ddos-атаки либо какой-то глобальный на нем сбой происходит мы хотим балансировать клиентов между дата центрами так чтобы для клиентов это было не совершенно не незаметно и хотя нам сетевики обещают что там выделенный кабель позированием сеть сто процентов надежно но естественно мы знаем что это не так поэтому мы не доверяем допустим у нас мы не можем доверять сети что она будет меньше 10 миллисекунд или сто процентов всегда доступна для этого мы реализовали такую схему приложение в каждом кластере в каждом дата центре работает с локальным кластерам и мы параллельно пишем еще в соседней кластер таким образом обода до центра имеют абсолютно одинаковый набор данных и клиенты мы можем балансировать клиентов между ними на самом деле эта схема очень похожи на георгиу распределенную режим more active актив у редис enterprise есть это реализация на основе сердите в данном случае мы реализовали самостоятельно и на самом деле что я хочу здесь сказать какой здесь вывод и морали что для определенного кейса реализовать это достаточно просто на самом деле мы там не так уж много времени на это потратили до сердите в чистом виде для различных и сложных структур данных это конечно отдельная отдельная тема вот но для конкретного кейса скорее всего можно это реализовать своими руками к тому же мы туда прекрасно понимаем как это работает шарди рование редис может работать в режиме plaster и предоставляет автоматическое шарди рование кстати еще кроме того возможны варианты с прокси и с родированием на стороне клиента и так режим родиться кластера у нас есть три мастера каждый у них есть если вы то есть реплики как теперь надо говорить и что давайте посмотрим интересный кейс как это работает кстати это я сразу сделаю ссылку это не мои слайды это слайд из среди сконс 18 года кому будет еще подробно интересен этот кейс можете посмотреть в оригинальной презентации потому что мне показался очень достойный кейс где можно тоже словить грабили и так у нас есть приложение anora есть седло да то есть но до которых знает приложение когда приложению необходимо обратиться к какому-то ключу он спрашивает кластер слот это знать чтобы понять вообще где искать конкретный ключ на это отвечаем с ней sense с латами которые у нас есть и дальше уже идем за ключом окей так работает кластер представим что у нас есть приложение которое и процесс очень короткоживущие т.е. допустим запрос пользователя обрабатывается приложением или процессом которые буквально оборван запускается для каждого для каждого запроса запросов таких много таким образом мы что получаем что кластер снос происходит на каждую операцию чтобы это лишить можно использовать можно реализовать дополнительный кэш либо как-то объединить эти операции уже в дополнительно но такая проблемка бывает теперь передем к попса здесь тоже взрывающаяся голова потому что это довольно интересный грабли где у нас на которой мы наступили у нас есть редис в нем мы храним кэш кроме того есть связанная структура дома есть очередь где есть некоторое них есть некоторая связь pops up с чем-то механизм есть publish субскрайб и мы подписываем например подписались на системные события о том что какой-то ключ zx появился либо добавился ли вы еще что-то и решили что на основе этих событий мы разбудим поддерживать нашу очередь как это должно работать окей у нас документ секс появился был удален из кластерам произошло событие приложение пошло в очередь и оттуда тоже удалила связанную структуру данных отлично но этот механизм на самом деле не предоставляя стопроцентных гарантий а особенно при высоких нагрузках когда кластер работает под на пределе поэтому у нас не произошло событие и мы не получили ни удалили связаны структуру данных и в что мы имеем в результате утечку памяти как это можно обойти что мы реализовали мы реализовали expiration кью то есть мы мы ценим тот же самый зацеп делаем z range берём от туда сообщения которые необходимо ну записи которые необходимо нам который уже за x появились вручную выбираем их оттуда и соответственно удаляем то что нам не нужна и соответствие уже по этим ключам по этим мембером мы идем и непосредственно подчищаем какие-то струг связаны структуры чтобы у нас не чтобы мы не утекали поэтому если вы используете pops up надо иметь ввиду что он предоставляет гарантию это мост vans таится в лучшем случае пультом и и послали но дело попадания это вопрос мишени сообщение получить получат только активные клиенты и если работает рэп plaster на пределе то вообще не гарантирована когда произойдет событие произойдет ли оно вообще можно использовать стримы для таких кейсов они появились версии 5 этапа продюсер концу мир паттерна знакомой по кафке и но с ними мы до продакшен и все их не довели то есть они опять же ему когда смотрели очень понравилось или быстро модно молодежно легко легко запустить но есть такой интересный момент про удаления по очищение памяти есть параметр макс лен который при кома при добавлении в кэш в stream можно его указать и тогда операция затраты по поддержке этого каша то есть этого стрима определенной длины будут линейными если же использовать этот же параметр вместе с команды trim то это уже будет константами если же командный maxfilm то уже будет линейными и это надо иметь в виду так radisson внутри себя оптимизирует и он гарантирует что макс лент будет доступен а еще плюс сколько-то и он автоматически оптимизирует чтобы удалять данные за константное время ну и соответственно тэмин по времени очень нетривиальная задача например нам хотелось реализовать по дням то есть допустим ведь 3 дня данных и наиболее подходящим решением было и заводить стрим на каждый день и дропать его соответствие удалять целиком в одессе очень много клиентов под все возможные языки протокол также очень простой и например это тоже хотелось бы похвастаться если вот так прям например выглядит сет команда set как видите она у в непосредственно уже в бинарном видео очень простая например у нас была задача ну мы хотели мониторить мы хотели получать какие-то метрики и использовать команду инфы и все это делать на внутрь игру и скрипта для groovy для грузия библиотеки нету однако это было легко реализовать ну раз уж заговорили про мониторинг мы живем в мире grafana и prometheus а вернем мы используем в нашем стеке графа ну и prometheus редис экспортер но опять же с ним есть подводные камни все-таки сбор меток это дополнительная нагрузка на кластер нельзя этим увлекаться имеется виду что нельзя слишком часто запрашивать кроме того ну как я уже говорил большинство полезной информации можно получить из команды info однако вроде секс портале в этом есть отличный параметр чик чик кис который предоставляет еще больше информации по всем листам их длина а стримы и все все что угодно но проблема фишка в том что он проходит по по всем ключам соответственно это может очень значительно сказаться на грудке кластера ну и в последних версиях можно создать свой lua скрипт и соответственно проверять только то что вам нужно ну давайте потихонечку закругляться да еще раз какие наши кейсы мы используем редис в основном в тех вариантах когда нам нужен шарит стоит между приложениями между эссенциями одного сервиса это различные варианты к шее это как уже ограничитель скорости про которой мы разобрали это планировщик задач и различные очереди у нас достаточно много реализации очередей и также ретро ну и в заключении радист это очень быстро и надежно и простой функциональный инструмент который позволяет реализовывать как прототип так и сложное решение очень быстро и с низким порогом входа но ничего не всегда легко конфигурировать это довольно бывает не тривиальна и самое главное очень внимательно относитесь к настройкам памяти и хай в ability чтобы не выстрелить себе в ногу спасибо друзья вопросы утверждения сборы может быть хакатон сразу отлично там снять колбаски пока не дают может не бежать ну спасибо за супер доклад по на радиусу эти суммы или radisson однопоточный дали это его боль но есть такое решение которое вообще мало кем опробована в прайде наверное от али-бабы по многопоточности где разделяется среды на main aur киры о ее worker пробовали ли вы это вроде нет мы это неправильно самом деле редис уже последних версиях не такой уж однопоточный то есть ядро как ядро одну все также 1 поточная но все параллельные команды связанные с вводом-выводом они стараются распараллелить это решение не использовали но у нас по моему у нас тут используя что запускает несколько хадисов на одной машине и уже за средства потом сортируют данные да мне но и если david нам надо много ядер не хватает та та та да именно именно шарниру но если честно я вживую не видел чтобы родиться не хватало производительности вот честного он очень быстро работает только если какие-то сложные хитрые и ловкие пт и запускать отлично у нас есть вопросы у петербурга и он новосибирская вот первый вопрос чуть-чуть быстрее пассива а здравствуйте у меня такой может быть плохой вопрос но у меня например есть две ноты в проекте gear резервирование ближе микрофонами две ноты в проекте gear резервированный я хочу общей редис я могу об общей что ну общей как бредис на для всех вышить общей радист но и вас две ноты гиа распределенные на газету и если между ними бы возможность сеть больше 10 миллисекунд то тогда вам нужно иметь артефактов каким-то образом со или поставим реализовывать либо использовать родис enterprise спасибо отлично давайте переместимся в санкт петербург город развода мостов это мой родной базе денежки всегда рады будем да не я буду женщина будет жечь люди которые хотят задать вопросы прекрасному спикеру и первый вопрос первый вопрос где микрофон там первый вопрос 7 билета пожалуйста 1 снова все пожалуйста задавайте я потерялся и вам спасибо за доклад меня зовут сенцов роман от иска вот там была картинка попов дата-центров это возникает вопрос если вы используете технологию что пишите вокальный кластеры собственно удаленный кластера в дата-центре вопрос как достигаете consistent этики данных такой ситуации но вот я как и говорил что мы это разгуливаем самостоятельном на уровне приложения дам эти разрывом самостоятельно на уровне приложения потому что как вообще актив актив у радиста есть реализация на основе сердите мы ее не используем для но здесь нужно смотреть каждый кейс для как я уже повторюсь для многих кейсов разрулить эту не консистентной проще в коде чем использовать какие-то более сложные решения на стороне база данных а вот как раз по поводу кода хотелось бы какой-то вариант например как вы это делаете у себя я здесь повторить пожара запросов да как раз хотелось бы понять на уровне коды как поэтому себя реализуете на то есть это какой-то попытка повторной отправки да там запись куда ты еще чтобы понять что у вас не прошу обновление в другом центре ну то есть как на уровне к коду вы это решаете там кейс такой что мы если если не находим данные то есть там там что там на самом деле мы храним информацию то есть ну посмотрите какой кейс у нас есть и не дай сколько займет времени объяснить в общем у нас есть кажется есть сообщение которые ждут своих отчетов о доставке если мы если мы не нашли этот сообщи если к нам пришел отчет о доставке для которого мы не для как для котором мы не нашли отправку либо какие-то еще другие возможные варианты то мы все это решаем за счет retrieve как раз вот почему я о них несколько раз упоминал то что на самом деле с операторами связи возможно такой такой вариант мы отправили сообщение нам сначала пришел отчет о том что сообщение просмотрено потом а то что сообщение доставлено и только через некоторое время о том что они вообще в принципе получили это сообщение и нам все это нужно как-то смягчить ставит чтобы предоставить видеоотчет нашим клиентам и вот как раз у для этого кейсы используется гиа распределенной то есть на самом деле там все это решается через r3 если что-то пошло не так же искать информация не найдена то мы просто некоторое время попробуем пробуем ждем супер петербурге есть еще вопрос да да есть еще один вопрос прямо сейчас мы его озвучим добрый день меня зовут юрий вопрос следующий достаточно ситуация редко происходит падение 2 виртуальных машин которые находятся в одном кластере вот и какие дальнейшие действия по восстановлению ну это зависит от того сколько у вас в принципе виртуальных машин сколько у вас всего ответ сколько всего 2 всего 2 то есть рукава аренды две машины две машины упала ну наш нам значит нам нужно чтоб хотя бы одна из них поднялось тогда если у вас был настроен persistent мастер ли реплика не прочтут данные с диска и все продолжит работу получается одна из них должна быть не лада я полагаю что если две машины одна должна быть не лада . они лада то не зашла шутка самарец утка заходит лада седан баклажан спасибо спасибо спасибо петербург давайте переместимся на вы себя сибирских давно и потом возьмём ещё ? пожалуйста окно я сразу критуется о внимание на экран здравствуйте добрый день добрый вечер вопрос немного похож на предыдущий вот за прошлый такой конкретный кейс допустим у нас вредить есть какой-то счетчик инкрементальный мы хотим чтобы он был уникальный по всей системе но даже если мы используем b&n данный файл но при падении у нас все равно есть какой-то короткий промежуток времени где и теряются данные и можно ли для вот этих случаев уникального счетчика использовать общий persistent ный редис и если да то какие рекомендации если нет то почему но тут надо конечно внимательно смотреть какие гарантии редис представляет да действительно при случае падения даже если он включён а.п. у нас здесь нет в рай то hotlog в right ahead файла поэтому теоретически потери может произойти ей я бы использовал его просто обуви лента спирте станциям для до для данного кейса когда есть up and only файлы и если есть rtb но в то есть все зависит от того насколько какие именно какие именно гарантий вам нужны поэтому счетчику насколько он насколько принципиально то есть там насколько сколько девяток надежности вы хотите предоставить то что в любом случае не бывает стопроцентной тут как всегда тут опять мы возвращаемся к этой силе как cup теореме что нам до доступность перси consist и насти если честно нам надо внимательно мне подумать и не могу прям так дать сейчас красивый ответ на этот вопрос спасибо новосибирск москва руки в небо смотрите вот кому-то кого ты выберешь на конечно того кто покрепче выхода в общем это же очень любим родиться даже надо слишком многим отлично да доколе упоминалось что градец не гарантирует доставку своих ивентов колени ключа в pops up да ладно насколько я помню это так себе кучу метрика если мы создаем свой pops up и свои же ивенту туда по большим то он в общем то говорит что не упустит ни одного и все подключены клиенты должны будут это получить но упоминают что вот про внутренние месседжи внутренние ленты нет гарантия но внутренние мы точно теряли про внешние тут мы не стали использовать внешние для наших кейсов почему потому что именно как раз подключены и клиенты если у нас так получилось что нет нет ни одного клиента то мы пропустили сообщение а мы их очень пропускать не хотим на самом деле для как раз для ретро и мы думали использовать pops up но остановились на blocking листе el-bi поп как-то так команда называется то есть соответственно если лист пустой то клиент будет заблокирован и соответственно если нет клиентов то данные в листе ввести останцы то есть мы реализовали вот такой мысли джим через лист для понял спасибо пожалуйста соседу передайте пожалуйста микроф об сюда вот мужчина в оранжевым тоже класс у нас мужики отваливаются можно сюда вот пожалуйста спасибо за доклад такой вопрос использовали бы в продакшене редис в режиме кластера и вот можете прокомментировать допустим вот что все-таки надежнее там sentinel и руками там позиционировать либо вот все-таки кластер у нас есть команда которая использует reddy's кластер в продакшене могу я сказать там опять же возникнет все все работает очень надежно вы там возникает только вопросы при обслуживании если нам нужно вывести caught одну ноту из кластера что-то с ней сделать зависти и обратно в plaster вот эти все манипуляции они очень не банальные у нас даже есть для этого утилитка написанная то есть написали утилитку которая помогает это делать я не смотрел наверняка есть и решение такие более распространенного концертные но на самом деле этот по докладам видно что многие как бы стараются решать эту проблему самостоятельно именно по менеджменту а с точки зрения надежности родис кластер надежны можете использовать у нас и не помню сколько машин немного но 100 100 100 процентов работает в продакшене друзья еще вопросы хорошо кому подарим год отлично да спасибо за доклад вы упомянули что когда мы включаем персистенции одессе мы получаем гарантии по durability аналогичные по адресу но насколько я знаю редис делает их sing только а раз там какое-то время 1 секунду или типа того это можно это можно настроить да вот и соответственно мой вопрос такой вы пробовали включать и в sing на каждую команду насколько это вообще влияет на перфоманс не якоже могу проще ответить что что нет но я просто пытаюсь пытаюсь все по-честному вспомнить стоп да да есть кейс на самом деле несколько лет назад даже ели да я его сам дел у нас есть кластер где often включен на каждой команду но там мне не очень много не очень сильная нагрузка на запись нам больше чтения мы например там храним с от нашим то есть там такой кейс что нам необходимо хранить подписке то есть и если вы отписались от какой-то рассылки sms-сообщений то для многие операторы после чтобы мы это запомнили и больше вам не слали а не на их стороне и вот мы храним это храним эту информацию соответственно отписок происходит немного чаще мы просто спрашиваем а то точно ли этот пользователь может этот клей абонент может получать ваше сообщение я поняла просто ну вот они документации пишет что вроде как первый перформанс этот очень сильно влияет я нет я думаю это будет влиять очень сильно поскольку это же на каждую операцию в памяти у нас происходит операция на диске ну вот мы упремся в диск с вы вор скорость так что да спасибо отлично спасибо большое за доклад за ответы можно громко аплодировать иван пока спасибо огромное речи пока кому подарим приза улучшает вопрос на самом деле вот мне мне мне кажется интереснее было pro-active актив вот там ребята спрашивали напросто было несколько вопросов и потому что он сказал что он любит regis поэтому да ну и не продавайте за попса любителю редиса любителей абу я буду прямо там я воду нельзя от гранд но предвзят себя конечно пока ты на сцене можешь делать все что угодно но через минуту теперь тоже есть будет репризы пасиб большое спасибо красиво закрыл первый день понятийные части"
}