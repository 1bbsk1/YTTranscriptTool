{
  "video_id": "uaer5xPwxJc",
  "channel": "HighLoadChannel",
  "title": "Capacity Planning в Ozon / Анатолий Межебицкий (Ozon)",
  "views": 394,
  "duration": 2836,
  "published": "2025-01-17T02:29:41-08:00",
  "text": "Всем привет Меня зовут Анатолий И сегодня я вам расскажу о том как мы построили процесс капасити планирования в самом крупном коме России погнали супер значит О чём будет доклад я расскажу в целом Что такое процесс капасити планирования так расскажу в целом что процес планирования расскажу про основные стратегии планирования мы используем в Озоне и расскажу про проблемы и решения с которыми столкнулись значит в целом Капа планирования - это процесс определения производственных мощностей необходимых организации для удовлетворения меняющийся потребности его продукции сложные определение Давайте презе на конкретную компанию Озон значит наша основная продукция - это заказы Да и их рост - это наше удовлетворение потребностей глючит немножко Т процесс производства мощностей это сервера и по Су планирование в азоне это процесс определения необходимого числа серверов для того чтобы мы поддерживали кратный рост наших заказов значит зачем это нужно бизнесу а первое что бизнес получает он знает что it начинает учитывать его рост в своих прогнозах а второе бизнес понимает Сколько денег нужно вложить в it чтобы оно поддерживало Этот рост далее бизнес понимает Сколько денег необходимо оставить и может оставить под остальные бюджеты да в том числе под собственно рост основного бизнеса и э у него появляется понимание текущей утилизации ресурсов и оптимальность их использования А зачем это нужно ийти а первое самое наверное важное то что это идёт процесс который синхронизирует все департаменты команды и мы собираем большие проекты и запросы под новые ресурсы А следующий момент it знает как растёт бизнес и может это учитывать в своих прогнозах а далее мы строим прозрачный процесс в рамках которого а все команды департаменты понимают Какие конфигурации будут использованы понимают прогнозируемое число серверов и собственно могут проваливать логику того как был построен прогноз А теперь давайте поговорим о какой-то гипотетической компании которая прошла путь развитие от своего становления до выхода на и рассмотрим Какие стратегии планирования они бы использовали значит наше становление - это маленькая компания мы ещ не нашли свой продук maret нас высокий темпы роста меньше чем X2 год к году небольшой размер комманды это порядка 100 человек ещё маленький Северный парк там 100 серверов и соответственно небольшие бюджеты под закупку это менее пти А если посмотреть на график роста то собственно здесь видно что темпы роста бизнеса порядка 40-45 про и рост поддержки инфраструктуры порядка 25% и в абсолютных значениях это десятки серверов соответственно наше планирование в данном случае сводится к тому что к нам пришёл it и говорит у нас закончили мощности мы идём в магазин и нам говорят то что необходимое число сроков это как правило десятки да 10-20 нам могут доставить на этой неделе в худшем случае на следующей и это отлично И на самом деле это хорошая стратегия Она работает для мелких компаний и Давайте попробуем оценить это качество стратегии на основе следующих факторов это выживаемость везение точность выживаемость - это характеристика которая показывает насколько наша стратегия помогают нивелировать риск отказа it везение Это насколько в целом мы и наша стратегия не подвержена внешним факторам И точность насколько наш прогноз попадает в реальность соответственно такое планирование по потребности имеет низкую выживаемость потому что мы абсолютно ничего не закладываем у нас очень высокое везение потому что сервера которые нам нужны Сейчас они должны быть в наличие и но при этом на самом деле у нас очень высокая точность потому что мы берём именно то Сколько нам нужно это классно у этого подхода есть свои проблемы первая проблема - Это то что мы в целом Ну не понимаем сколько как мы растём да И сколько нам нужно серверов А мы не можем гарантировать наличие оборудования в тот момент когда о понадобилось у нас нету понимания влияния бизнеса на it да как рост влияет на наши потребности мы не занимаемся Оценка эффективности нашего использованного железа и собственно у нас нет понимания затрат сколько нам стоит поддержка бизнеса А Мы перешли на следующий этап Наша компания Наш прок Market Fit Это здорово Мы выжили и начинается бурный Рост он характерен тем то что темпы роста X2 становятся размер команды растёт это порядка Уже 100 человек и больше средне серверный парк порядка 100 и выше но при этом у нас низкая база заказов там да Или какого-то другого продуктового измерения и уже средние бюджета на закупку - это там сотни серверов допустим возьмём такой пример нашей компания А мы здесь видим что за следующие 8 лет мы смогли достигнуть роста бизнеса там 27% и для такого поддержания роста нам нужно уже сотни Как видно на цифрах серверов да это рост тоже X2 условно по инфраструктуре И если нам повезёт Мы даже можем выйти на apo а соответственно Мы не успели поменять Стратегию и к нам Снова пришла инфраструктура и говорит нам нужно 200 серверов если мы также пойдём в магазин то к сожалению нам скажут то что серверов столько Нет сейчас и на следующей неделе Их не доставят и нам нужно ждать несколько месяцев И на самом деле это очень неплохая ситуация по следующим причинам Ну первое самое наверное основное Мы запустим наш какую-то фичу или проект позже на два месяца И следовательно то время да которое мы потеряли мы не до получаем прибыль это плохо для бизнеса следующий момент продукт в целом может потерять конкурентное преимущество то есть та фича которую мы хотели заа нанси не выпустил мы но выпустил наш конкурент и наши пользователи могли туда перети и последний момент в целом Да фича может перестать быть актуально например мы запускали какую-то акцию там под Новый год не смогли её запустить потому что не было инфраструктуры сейчас уже Март И к сожалению фича уже никому не интересна Ну соотвественно вопрос А что делать да В таком случае первое что вы сделаете Естественно да вы начнёте искать в ваших текущих мощностях какие-то ресурсы где-то что-то резать Да оптимизировать чтобы как-то выделить мощности под новую фичу под новый проект под ваш рост и в целом вы сразу да по текущей ситуации Пойте что вам нужно уже начинать заранее планировать закупки потому что это уже месяца а не дни и вам нужно заранее понимать о темпах роста бизнеса чтобы закладывать это в ваши прогнозы вам нужно планировать текущую утилизацию и искать те бизнес факторы которые влияют на рост it Давайте поговорим о Бизнес факторах значит как их вообще выбирать естественно вам нужно подойти к бизнесу и спросить какую ключевую метрику они используют как правило это деньги Да любой бизнес - это про деньги но с этим вопросом не нужно сразу уходить с этим ответом Да нужно дальше немножко с ним пообщаться и спросить За какой ключевой метрикой Они следят Да которые влияют на эти показатели на деньги в случае озона - это заказы тут всё очень просто чем больше у нас заказов тем больше прибыли вот у другого бизнеса могут быть другие метрики да вам нужно Здесь оперировать своими показателями Ну и Следующий вопрос вам нужно понять как масштабируется бизнес то есть какие прокси метрики влияют на рост заказов случа оз как правило Это аудитория чем больше людей портале да маркетплейсе тем больше у нас заказов А следующий момент вам нужно провести ваше первое планирование а для этого вам нужно собрать максимальное количество данных из прошлого да э и самое основное вам нужно знать сколько у вас было э бизнес показателей на метрике Ну в данном случае заказы на примере будут и сервера которые их обеспечивали вам нужно рассчитать коэффициент зависимости А сколько заказов на один сервер Вам приходится выдерживать и собственно заложить какие-то риски в ваш прогноз давайте рассмотрим пример допустим в первой точке у нас было 100 заказов которые поддерживали 80 серверов это коэффициент 08 на второй точке у нас было 500 заказов и 240 Серов их поддерживало это коэффициент 048 и собственно на третьей точке мы имеем 1000 заказов которые поддерживали 560 серверов это коэффициент 056 самый простой вариант да Значит следующий шаг нам бизнес дал прогноз что в следующем году у нас будет 3000 заказов вам нужно спрогнозировать количество самый простой способ выбора коэффициента например взять среднее Да это вот самое простое что вы можете сделать на листочке в данном случае коэффициент средней будет 061 и если прикинуть посчитать да то количество Серов которые просто на салфетке можно прикинуть это будет 1800 Ну естественно так как это совсем салфеточки буфер Да на непредвиденные ситуации это риск например возьму 30% Итого мы имеем что нам необходимо для 3000 заказов порядка серверов такая стратегия планирования называется по тренду с Линейная Да значит выживаемость у неё уже выше чем у прошлой стратегии потому что мы хоть как-то знаем про бизнес и хоть как-то учитываем его рост у нас среднее везение по тем же самым причинам что мы уже думаем заблаговременно о том сколько нам нужно и можем планировать эти закупки но при этом мы очень сильно упали по точности раньше мы закупали ровно то Сколько нам нужно А сейчас мы делаем буфер и не факт что этот риск оправдает возможно нам его и не хватит и собственно и это основная проблема Мы в этой стратегии мы не знаем сколько сложить риска и совсем не очевидно как его считать и есть два Корнер кейса да первый случае а если риск не выстрелит у нас будет оборудование которое простаивает мы потратили много денег могли вложить в рост бизнеса и обратный кейс когда риск выстрелил и выстрелил выше чем Даше то что мы заложили и далее уже такие понятийные вещи про деньги в целом 30% - это очень большие деньги на абсолюта и соответственно для компании важно инвестировать деньги в нужное место как правило в рост и пока мы с вами Вот проводили салфеточки скрыт в аналитике а далее собственно мы приходим к пониманию что нам нужно строить Уже какой-то процесс да капасити планирования в нашей компании крупной давайте рассмотрим собственно верхний уровне про бюджеты и как они распределяются Да У любой компании есть какой-то ежегодный бюджет который она готова выделить инвестировать в рост рост - это как правило рост бизнеса Да это ключевые бизнес показатели аудитория заказы и так далее и собственно it которые поддерживает Этот рост точки зрения инфраструктуры У нас есть два варианта основных распределения бюджета первое мы можем ошибиться и пере заложить деньги в бизнес в этом случае мы привлечённого аудитории это хорошо но при этом it может не выдержать нагрузку Когда будет очень много людей и у нас будет потеря заказов в моменте да то есть та аудитория которая дополнительно привлечена она не смогла заказать и мы потеряли это наши потеря в деньгах а также Тот клиент который не смог сделать заказ а в следующий раз будет неуверенна компания он будет думает то что э заказ можно не сделать и можно уйти на другую площадку Ну и собственно потеря репутации как В целом у клиентов так и у it второй вариант можно перезалог в it в этом случае мы не до привлечем аудиторию у нас будет простаивать железо будет дополнительные издержки на размещение этого железа опять же будет потеря заказов в моменте пото что мы не привлекли аудиторию которую могли привлечь и не до получили заказы и мы получаем ещё одну интересную проблему это устаревание серверного парка то есть мы купили на год раньше оборудование которое у нас простая А в следующем году и выпустил новые процы они стоят столько же более мое при это этб этоже если и первый вариант и второй оба плохие Что же нам всё-таки делать нам нужно искать точки оптиму то есть основная идея в целом Да это найти то число денег которое нужно вложить в бизнес максимальное число денег так чтобы it выдержало справил с этой нагрузкой и Для этого нам нужно собирать критические метрики серверов такие как утилизация цпу утилизация памяти утилизация диска сети и и осов а также нам нужно раскладывать бизнес показатели более детально их изучать это gmv там dao заказы асы и тому подобное нам нужно детально анализировать прошлое и строить модели и собственно При таком подходе наша стратегия сводится уже к другим абсолютно вопросам нам уже не интересно есть ли сервера в наличии в магазине нам интересно какая точность наших моделей мы делаем Крос валидации и понимаем что если 5% точность то это в целом неплохо но можно лучше значит давайте рассмотрим качество такого подхода на основе тех же самых факторов выживаемость везение И точность выживаемость очень высокая потому что мы очень хорошо детально изучаем бизнес понимаем насколько заранее нам нужно что закупить и в каком количестве везение при этом абсолютно низкое мы максимально всё анализируем и нам не нужно никакого везения И при этом точность обеспечивается хорошими ML моделями но у этого подхода тоже есть ряд проблем первое Да нужно собирать очень много технических метрик и в целом для их сбора и хранения нужно закладывать мощности Да это и само хранилище Рик и какие-то накладные расходы по использованию цпу для этого сбора также у вас есть расходы фод дополнительные Вам нужен аналитик который будет чистить данные от выбросов и мусора Вам нужен дата сайентист который будет вам строить ML модели и вы поймёте что качество данных то есть насколько они точны Да в моменте сбора очень сильно влияет на результат прогноза и собственно большое количество департаментов и людей если у вас большая компания будет заинтересован в этом процессе и будет участвовать Это будет сложно контролируемая история если не строить процесс ную часть и Давайте теперь поговорим о том какой Фло планирования сейчас в Озоне в целом Да у нас годовое планирование То есть каждый год мы строим и делаем новую защиту бюджета и стоит весь всё планирование Примерно там верхний уровень следующих этапов всё начинается с того что бизнес строит сам свои прогнозы на будущие года основным бизнес показателем gnv аудитория заказы далее на основе этих данных наши аналитики строят технические прогнозы по утилизации цпу утилизации памяти диска утилизации сети и необходимое точнее число ПС Да которое мы ожидаем в сезоне сезон - это самые пиковые дни распродаж а далее мы делаем тестирование новых конфигураций то есть мы не закупаем сервера про которые мы не знаем отдельно чуть дальше расскажу мы их тести далее мы Валиди и согласовываем прогнозы С командами собираем большие проекты от it потому что к сожалению не все прогнозы Да они могут давать хорошие результаты на будущее Да к сожалению не все прецеденты были в прошлом если у вас какой-то навы сейчас запускается её нужно дополнительно заранее изучить пообщаться с там бизнесом или с it командой чтобы понять какие туда нужны ресурсы далее мы занимаемся согласованием конфигурации серверов С командами далее делаем защиту бюджета значит немножко про защиту бюджета в азоне И на самом деле как в больших любых крупных компаниях есть много департаментов да мы с вами посчитали наш it бюджет но при этом тоже самое делают и другие ребята в целом бюджет не резиновый и поэтому есть общая встреча Да на которой ся синхронизируется и мы понимаем то что да мы уложились или где-то что-то нужно пересчитать далее начинается самый долгий этап Это ожидание поставки Да когда сер производится и доставляются к нам и собственно финал Это ввод оборудования в эксплуатацию и параллельно с этим есть регулярный процесс улучшения качества модели и покрытия плюсы такого подхода в целом Да наш цикл бюджетирования строго завязано на процессе Это хорошо мы его структурировать и за ним следим мы детально анализируем прошлое и строим прецедентные модели мы учитываем неопределённость будущего через потенциальные проекты которые мы получаем от команд мы постоянно итеративности качество наших прогнозов и анализируем утилизацию подбираем оптимальные конфигурации там в целом если немножко там про какие-то абстрактные цифры Ну то в целом переход Да от какого-то линейной модели к какому-то любому примитивно моделированию даст выигрыш в уменьшение этого риска там на 10% Если э делать хорошие ML модели то в целом там по рынку Да аналитиков хорошая модель даёт погрешность порядка 3% Давайте поговорим о проблемах с которыми мы столкнулись в рамках там да нашего решения первый такая вопрос проблема - Это зачем вообще в целом Да изобретать ML модели Когда можно рисовать линию просто закладывать не 30% а как-нибудь там 25 или 20 например давайте рассмотрим да нам даёт бизнес две точки то есть у нас есть текущее состояние точка оди Да есть какое-то целевое состояние на конец года Да сколько бизнес прогнозирует мы построили линии Да и сделали прогноз по серверам Но на самом деле как правило многие бизнесы растут в течение года нелинейно Да есть сезонность она характерна в том числе для озона у нас в ноябре намного больше аудитории приходят из заказов и тут Если обратить внимание то Зелёная Путина лини как раз вот така Более точная Да бизнес показатели по месяцам она выше чем наш тренд но при этом сумма под линиями зелёными она одинакова то есть да Тол роста бизнеса он правильно сказал но просто он немножко по-другому распределён по месяцам и это очень важный момент потому что в этот пиковый месяц нам серверов это синяя тирна линия нужно заложить даже больше чем риск то есть мы даже с 30% можем не попасть это очень рискованно если рассмотреть детальнее Да конкретно вот пиковые месяцы которые у вас там происходят нагрузки то скорее всего у вас есть и в течение дня распределение Когда у вас больше приходит аудитория Да и заказов когда-то меньше Ну и собственно если говорить там про Озон У нас есть ещё одна характерная черта это собственно хамера хамера - это появление товара с хорошей ценой с ограниченным стоком в этот момент у нас аудиторный показатель - Это синяя линия не очень сильно растут да то есть аудитория не прибавляется но кратно растёт количество заказов и ПС и Для нас это пиковый момент когда мы должны выдержать эту нагрузку Именно поэтому дамы приходим к моделировани далее Следующий вопрос ли проблема пик он действительно в году происходит там один может быть буквально несколько раз и нам нужно гарантировать за код заранее что наши модели точные как это проверить давайте рассмотрим опять же два графика обычный день да и распродажа обычный день он более сглаженный распродажа видны красные пики Да это те моменты когда приходят вбросы товаров с хорошей ценой И люди начинают Маго закупать задачу можно разложить на две подзадачи на определение базовой части это зелёный график снизу Да и собственно эти пики и по сути если говорить про моделирование то мы делаем две модели модель базовая составляющая это Зелёная линия и отдельно мы моделируем пиковое состояние про базовую модель мы используем основные бизнес показатели Да это да S орр и так далее для моделирования пиков мы используем уже товарные да то есть более глубокое знания это размер стока Цена товара цена товара со скидкой Цена товара без скидки размер скидки категория товара это всё очень сильно влияет на вот эти пики и в итоге Да мы получаем то что мы разбили задачу на подзадачи сделали разные модели у них разные обучающие выборки и очень важно что в течение года мы можем проверять как работают обе наши модели базовая модель происходит каждый день то есть мы прогнозируем что было вчера и можем посмотреть по факту насколько мы совали с пиками Какая же переменная ситуация у нас есть распродажи они очень часто регулярно проходят на зоне и в каждую распродажу можем проверить насколько наша пиковая модель совпала с реальностью следующая проблема - Это собственно а а что делать если новые сервера которые мы закупали да будут хуже чем текущие мы это решаем тестированием Да Hardware laab мы собираем тестовый кластер на новом оборудовании на маленьком числе да то есть мы не делаем сразу большую закупку А и проводим сначала на нём самые простые примитивные синтетические тесты проверяем что в целом цпу бенчмарки хорошо работают далее так как эти сервера будут использовать реальные команды Там поса кликхаус они проводят свои специфические синтетические тесты чтобы Понять насколько эти сервера и конфигурация им подходит если по каким-то причинам мы не уверены что синтетические тесты валидные то мы можем упустить часть нагрузки небольшой процент на эти тестовые стра чтобы проверить на реальных данных да как это всё обрабатывается далее мы фиксируем результаты и принимаем решение На основе данных по тестам Да результатах по цене которая собственно меняется Да в зависимости от конфигурации и по электропотребления и важно что это регулярный процесс да ежегодно компании там Intel и там C Gate выпускают новое оборудование его нужно регулярно проверять Чтобы понимать что в следующем году конкретно вам актуально закупать Следующий вопрос - Это как подготовить продукт именно Код да заранее к той нагрузке которую мы спрогнозировали Для этого у нас проводятся регулярные стресс-тест каждый день идёт тестирование чтобы минимизировать риски для бизнеса это происходит в минимальную польскую нагрузку как правило это ночью тестирование также состоит из двух частей Да это базовая и пики и они отличаются как профиле нагрузками так и патронами немножко подробнее базу мы Тестируем в целом постепенно возрастающей нагрузкой и достаточно долго продолжительно стреляем чтобы проверить что вся наша инфраструктура держит эту нагрузку с точки зрения пик как здесь видно на графике это краткосрочный всплеск разовый и мы проверяем насколько наша инфраструктура готова быстро масштабироваться под резкий рост ПС и такие тесты проводятся регулярно И за счёт этого команды в течение года планомерно понимают как шать продукт мы поднимаем планку по псом на стресс-тест и команда оптимизирует свой код следующая проблема вот мы сделали какой-то прогноз но код в течение года тоже меняется да ребята сделают новые фичи и нам нужно как-то учитывать Это в нашем прогнозе что мы делаем мы делаем анализ взаимосвязи между сервисами мы строим Граф состояний от входных точек польского трафика до самых последних микросервисов далее мы расставляем веса в этом графе и понимаем Какое количество rps приходит на входные точки Да и как эти псы дальше распределяются по всем микросервиса и собственно так как у нас есть регулярные ежедневные тесты и мы регулярно каждый день следим за то что происходит в Озоне Мы в целом понимаем как меняются эти графы то есть какие-то узы могут выйти Да если сервис перестал взаимодействовать с другим или просто умер или появился новый микросервис и также мы понимаем как меняются веса Да какое количество запросов переходит от одного сервиса к другому и собственно Мы корректируем также ежедневно патроны на основе этих данных и ну в итоге получается На текущий момент мы считаем значение целевой ПС на сезон и по сути на самом деле на каждый день для более 5000 сервисов особое внимание естественно мы уделяем входным точкам и дополнительно проводим стресс тестирование по отдельным сервисом то есть не только всё ограничивается общим тестом на всю платформу но каждая команда может провести своё стрес тестирования для определения каких-то узких мест и следующая проблема Это собственно сепик надо достаточно много Да и как бы они не нужны в обычные дни получается у нас будет простое оборудование нам нужно его где-то размещать как эту проблему мы решаем у нас планомерный ввод серверов мы делаем прогноз по месяцам сколько нам серверов нужно на основе этого прогноза мы строим план ввода железа в эксплуатацию то есть мы в этом месяце знаем Сколько нам нужно в следующем месяце быть В ДЦ чтобы мы прошли всю нагрузку далее на основе этого вставляем план а как будут повышаться планки по стресс-тест и на основе данных по стресс-тест мы корректируем план вода железа То есть это циклический процесс который тоже регулярно корректируется И за счёт этого мы собственно первое размазывая расходы на эксплуатацию Мы не водим все се сразу да а водим их постепенно А мы минимизируем простое оборудование в течение года и что очень важно мы распределяем нагрузку DC инженеров в течение года потому что поставить большое количество серо вкрутить планке памяти это тоже время и деньги и собственно Да немножко про деньги на каком-то примере которые вообще никак не связан с озоном значит В чём суть А мы поговорили про процесс и понятно что м это сложно Да нужно найти менеджера который будет этим заниматься это очень много общения это большое количество взаимодействий Вам нужен аналитик который будет чистить прогнозы вам нужны дата сайентист которые Бут строить модели нужны доб ресурс на хранение этих метрик и вопрос Стоит ли вся эта игра свеч давайте рассмотрим такой пример что допустим средний на одного сервера порядка 20.000 долларов если ваши закупки там порядка прогноза Да порядка тысячи сираков то собственно бюджет который Вам необходимо заложить это 20 млн долларов и в этот бюджет Да мы заложили риски те 30% это будет 5 мл если мы перейм к моделированию Да я говорю что это порядка 10% на такой сво закупки вы бы сэкономили э уже 2 млн Да уменьшилась закупка если добавить сложные ML модели которые нам могут сэкономить дальше то в целом наш прогноз бы упал до 15 там 16 млн да то есть это ещё 4 млн долларов экономию И за счёт оптимизация конфигурации и регулярное проверки утилизации ваших серверов Вы можете ещё от базовой части сократить там порядка 10% и того на таком тестовом примере мы имеем что наша закупка с 20 млн долларов упало до там 14 Да мы сэкономили 6 млн А дальше там на основе вашего бизнеса объёмов серверов парка и так далее Вы можете сами прикинуть Выгодно ли вам сейчас идти в историю капасити планирования или возможно вам надо подождать когда вы начнёте расти бурно А давайте рассмотрим пару примеров э которые расскажут Да как мы в том числе оптимизируем Ну наши желез Да тестовые примеры значит допустим что у вас есть какая-то Ну какая-то хранилка да которая растёт X2 год к году допустим там с одного питай до двух и у вас есть какая-то конфигурация с шестью дисками там на 768 соответственно Да ёмкость конфигурации 46 если ваш аналитик просто посчитает прогноз он не будет да менять конфигурацию вот он посчитает Сколько нужно необходимой ёмкости и скажет то что да нам нужен рост с 23 до там 46 серверов Ну соответственно бюджет который ну заложить на закупку там будет порядка полмиллиона долларов Но если копнуть чуть дальше Да и понять сколько в принципе дисков можно ставить в сервер Да вы узнаете что там чуть больше чем шесть можно ставить но при этом команда скорее всего скажет то что Ну так не работает мы же как бы шесть всё хорошо у нас там есть цпу у нас есть память вот поэтому нужно будет доставлять в эту конфигурацию помимо дисков ещё возможно увеличивать мощности по цпу либо доставлять оперативную память и это по сути вопрос к тестированию новой конфигурации мы её Тестируем смотрим если она нам подходит то мы очень сильно можем сэкономить на том что не закупаем новые оборудование да А апгрейдить его по памяти и по дискам и такие подходы Да условно не конкретные Это пример мы используем Это действительно очень хорошая история а далее Я наверное пару примеров пропущу они в целом про то же самое и Давайте сари значит в целом Да есть три основных стратегии к моделированию капасити это его отсутствие да Или собственно когда мы понимаем что у нас всё кончилось и нужно идти в магазин это какие-то линейные подходы по трендам и собственно ML моделирование рано или поздно с учётом вашего роста компании Вы придёте к тому что вам нужно будет строить какой-то процесс этого планирования и когда вы поймёте что его построили вы увидите что это действительно экономит деньги и здесь важно понимать за счёт чего Да будет весь этот процесс работать Нужно обязательно заниматься Элем это важная часть Да всего процесса Нужно обязательно анализировать и оптимизировать конфигурации серверов и собственно Hardware Да это тестирование - это регулярный процесс который является Нелей частью которую нужно будет внедрять А на этом всё спасибо за внимание ставьте лайки Подписывайтесь Анатолий Спасибо большое за доклад Мне кажется планирование Кати - это вообще очень круто прежде чем мы начнём с секцию q&a Я хочу напомнить что Ребята пожалуйста оценивайте доклад это очень важно для спикера для конференции для всех А если вы смотрите нас онлайн Пожалуйста задавайте вопрос на платформе Если вы не хотите поднимать руку вставать можно задать вопрос в чат зала и я его зачитаю так начнём наверное по традиции с первого ряда вот ближе ко мне всех сидит моло человек Спасибо правая часть Да спасибо за доклад Меня зовут Женя Авита Очень приятно Да очень интересный подход тоже похожей практикуем мне знаешь что интересно ты в начале говорил что у нас есть какие-то метрики бизнеса Ну да конечно они у каждого бизнеса есть да И мы по ним начинаем строить модели как мы утилизируем там железо чтобы его мы строим связи нам нужно понимать как твой рост бизнеса знаю там зака или что у тебя да влияет на потребление инфраструктуры Да короче мой вопрос в том что у тебя в бизнесом метрике разбиваются на какие-то вот бизнесов сценарий скорее всего по которым вы модели строите Мне вот интересно как это приземляется на какой-то уровень уже разработки То есть у вас какой-то трейсинг по всем бизнес сценариям где вы понимаете Какие сервисы там участвуют не знаю там в заказе Да конечно Я показывал там на сваде то что у нас есть Граф состояния то есть мы понимаем что например не знаю там заказ в корзину Да которы делает Поль это некоторый набор сценариев на микросервисы и мы их регулярно в рамках стресс тестов повторяем то есть мы прогнозируем условно сколько у нас будет заказов Да это какое-то количество ПС на Ну ручку Да корзины условно чекаут и мы понимаем как это всё распределяется И вот последнее уточнение А вы получается моделирование на каждой вот из такого из ваших сценариев применяете не совсем Смотри я здесь говорил больше про моделирование железа да В первую очередь то есть мы моделируем то как В целом будет утилизировать вся роль не знаю там весь кубернетес да отдельно если говорить про сервисы мы моделируем там ПС и утилизацию но там ну чуть другие подходы Ладно спасибо это тоже мы занимаемся Да пожалуйста запоминай вопрос У нас сегодня Два подарка ты помнишь да это сложно Да поэтому у нас пока только один вопрос пока Всё просто ну можно передать прямо рядом микрофон Спасибо Да всем привет Анатолий Спасибо большое за интересный доклад у меня шесть вопросов но хотя бы один задам Можно потом остальные в кулуарах зать потом бы в кулуарах на текущей модели ты рассказал о модели а точнее моделях как я понимаю их много уже на текущий момент Вопрос такой на текущем момент точность уже настолько классная что она носит уже обязательный характер или всё-таки пока что рекомендательный характер при принятии решения о закупке там оборудования изна Ну обязательно Ну потому что мы точно видим что ну как бы моделирование намного лучше чем рисование линии это правда точность довольно-таки высокая Да уже на текущий мо Ну тут очень сложно понимать да высокое Это сколько там 5% 10 Она всегда может улучшаться Да на задача нашей команды и поэтому мы продолжаем существовать это постоянно её улучшать К сожалению ли к счастью регулярно Да в рамках it у тебя появляются новые проекты не знаю там вы решили использовать новую технологию там сци да например у тебя по ней нет исторических данных ты не можешь построить хорошую модель ты ждёшь изучаешь данные и строишь модель то есть регулярный процесс у нас появляются новые в водные мы строим новые модели мы улучшаем старые текущие в дополнение сразу же за сколько эта точность у вас достигли такую точность за такой период времени и какова выборка кака За сколько вы точность такую достигли по моделин Ну наверное мы глобально мы уже занимаемся этим несколько лет Вот и у нас есть отдел аналитиков который регулярно занимаются моделированием 2 года несколько лет Вот Всё огонь нам есть куда расти вот как бы тому ванильно примеру Ну условно Да скажем что абстрактному за сколько компания которая Сейчас начнёт чтобы понимала Здесь вопрос сколько инвестирует вы можете нанять не знаю там себе 100 аналитиков и сделаете это быстрее Да как бы но это вопрос денег Ну да Всё спасибо спасибо сделаем большое исключение там есть последний ряд правой части зала вот Привет Я Денис У меня вопрос такой на самом деле бы когда промахнулись так Ну конечно всегда бывают ф но Наверно это ива Спасибо я зачитаю один вопрос из онлайна на одном из слайдов было написано что нужно проводить нагрузку в ночное время на промышленном стенде вопрос зачем вопрос зачем выглядит как выст в ногу самом деле можно Ну есть два варианта да вам нужно как-то тестировать нагрузку можно построить тестовый стенд который будет максимально повторять продакшн Но это вам нужно X2 серверов это огромные деньги и для ну чем больше у вас текущий объём Да огромное вложение это первое потом любой тестовый стн он вам не позволит создать реальную нагрузку то есть лучше моделировать нагрузку на то инфраструктуре которая продакшн вот дальше момент к счастью Да у нас есть ночь и Наверно у многих бизнесов так происходит то есть какие-то часы где нагрузка минимальна и в случае какого-то фапа да Если он вдруг произойдёт влияние на бизнес будет минимально ну и соответственно если он происходит Мы сразу экстренно останавливаем стрельбы вот я просто про это не рассказываю Мне кажется здесь будет другой доклад или уже был про стрельбы экстренно останавливается мне понравился это стата к счастью у нас есть ночь Мне кажется это девиз любого инженера когда он не попадает в дедлайны А спасибо я от себя дополню если были такие ситуации что вы ночью тестируйте потому что там продавец акцию начал или ещё что-то или вы как-то контролируете это кто как Договаривайтесь Ну мы за тоже может быть пик Конечно мы заранее знаем расписание то есть маркетинг если говорить там про вот эти пики Да которые рисовали они нам Ну как бы и пользователи знают на сайте В какой момент будет вброс вот этих мерных товаров мы под это подстраивать да и не проводим тесты в те моменты когда мы знаем что будет так пиковая нагрузка то есть маркетинг говорит вам Ну это здорово Да ребят Следующий вопрос второй ряд левая часть зала А добрый день спасибо за доклад Меня Алексей зовут А вопрос такой как вы обрабатывается обрабатывает ли вы ситуации когда там задержка в закупке там не знаю нет новых стоек нет капасити в дата центре Вот то есть когда нельзя просто взять регулярно Там поставлять по 100 серверов а нужно вот там лавировать ну по сути мы как раз и перешли Да к годовому планированию что мы себе даём такой вот большой буфер времени на то чтобы ну условно гарантировать себе поставку и производство То есть сейчас мы закладываем риски что там поставка может занимать порядка 6 месяцев для себя да и время установки наших объёмов - это тоже месяца то есть мы себе делаем вот эту солонку стелим там порядка 8 месяцев когда мы ждём что сервера появится у нас в дата центрах Ну или там на складе Ага а гибридные истории вы не рассматривали что Да допустим нужно срочно скинуть какой-то чест нагрузки и воспользоваться допустим облаком А смотрите Хороший вопрос на самом деле интересный а тут ти бы э если говорить про использование облака против серверов да то рано или поздно вы столкнётся с тем что э своё оно как бы будет дешевле Да и потому что у нас он находится Ну и плюс на самом деле для многих компаний Ну не знаю в частности для каких-то крупных А есть nda да мы не очень хотим чтобы наши данные да как-то попадали в облако Яндекса потому что это на самом деле наши конкуренты Да в какой-то степени вот поэтому про использование полностью облока Ну как бы нет гибридна история Ну наверно пока у нас таких прямо ситуаций не было что нам нужно было экстренно Да куда-то переключать нагрузку мы всё-таки держим некоторый баланс Ну буфер Да запас серверов в ДЦ Если вдруг происходит какой-то пик не совсем прогнозируемый поэтому Пока не рассматривали такой вариант Окей спасибо спасибо правая часть зала первый ряд спасибо спасибо за доклад А вы рассматривали возможности планово переливать железо между разными сервисами но условно если есть пиковый период там день или час не сдувал ли весь resch сегмент чтобы перелить железо или наоборот доедать железо в гарантированно неиспользуемые часы Ну смотри это хорошая тема вот на самом деле прямо так ну глобально мы к этой истории ещ не подошли сторону думаем Но мы здесь себе сделали хорошую историю Я неё просто не особо рассказываю а мы сервера стараемся покупать там достаточно такой типовой конфигурации куда можно легко доставить там диски память или немножко расширить цпу и условно у тебя один сервер не знаю поса легко конвертируется в кубе Ну легко там не знаю за несколько часов Работа 10c инженера То есть если вдруг мы поняли что где-то не очень хорошо почитали прогноз там по постгрес там есть лишние Да сервера но при этом в кубе плохо операционно в течение короткого времени эти се переместить но пря в чение часа такое мы не делаем У нас есть для этого там был доклад Миши про кубер есть в рамках кубе У нас есть да там нагрузка перетекает если глобально между ролями Нет меня такого не происходит спасибо спасибо Следующий вопрос вот за колоно мне не видно но коллеги подсказывают есть вопрос Вопрос такой Ну на самом деле вопросов несколько как будет много Скажите я остановлюсь Я что один Да дальше ВК давай Один потому что у нас очень много рук а потом кулуары Давай тогда спрошу Вопрос вот у вас 5.000 сервисов Как вы между ними отслеживается связи может быть у вас уже просто доклад про это был ты мне на него отправишь А я не знаю если честно был про этот доклад или нет Вот но в целом по Лога можно смотреть Да по трассировка Ну то есть это на грубо говоря там на джагере Граф джагере что ли строить и Или откуда вообще берёте Ну то так это вопрос к озону в целом как связи между сервисами демонстрируются Правильно я понимаю да Ну вот тут у ребят целая команда Я думаю что мы выйдем я про это не особо как бы в курсе есть более Да хороший специалист который расскажут как мы логи собира Да мы выйдем все вместе и да тогда по теме Вопрос вот с простамин что-то делаете или Ну они просто стоят и ждут своего час мы стараемся их минимизировать да то есть важно понимать что мы себе закладываем вуфер Да в Ну риски Да что сервера могут не сразу Прити и их большое количество но там был слайд и я рассказывал что мы его планомерно вводим то есть нет такого что мы берём и все сер запихнули в ДЦ как только нам их привезли потому что это будет А ну всё равно какое-то электропотребление они будут мешаться они будут не использоваться и оно у нас лежит на складе мы постепенно его вводим в эксплуатацию по мере необходимости То есть у нас есть прогноз на следующий месяц по каждой роли Да там не знаю по куберу клику сколько им нужно серверов чтобы выдержать следующий месяц и мы стараемся постепенно их вводить то есть по сути Вот именно Ну уже закупленный технический запас он всегда минимальны Да запасы Мы не сразу вводим но закупать не разово опасно Ну там даже Две истории есть в целом когда ты закупает тебя естественно цена снижается Это плюс Да вот соседу можешь прям микрофон отдать спасибо спасибо Атон Компани на тех Вопрос такой если мы имеем сервис какой-то где резерви хотим чтобы он был надёжный обычно говорим что запас должен быть 50% на случае если одно плечо отъедем сот там запас плюс говорим Давайте ещё сделаем запас на пики процентов 10-15 плюс процентов 10 на органический рост и в итоге получаем что как правило утилизация совсем грустная там 20-15 про Вопрос какие у вас эти цифры были до ML модели и какие риски вы смогли убрать и получили цифры после использования Ну смотри Это хороший вопрос У нас есть тоже коэффициент естественно то есть каждая команда поха нам говорит сколько нельзя более утилизировать цпу иначе начнётся гдето трот где-то будет торможение ещё что-то то есть это критично дальше у нас есть история опять же вчерашний доклад Миши про DC -1 нам нужно для части ролей закладывать коэффициент полтора да то есть 3/2 если вдруг ДЦ упадёт что мы выдержали нагрузку поэтому где-то мы закладываем коэффициент и полтора Да и дополнительно к этому кладём что в случае даже падения дата центра мы должны хорошо быстро зас тоже самое кубер это порядка не знаю 70 90% утилизация цпу должно быть Ну и тут можно посчитать Да у тебя не будет 100% утилизации если ты закладывает ми1 но мы как бизнес должны это закладывать для нас очень дорого даже минута простоя то есть намного дешевле заложить эти риски и их об нивелировать по сути таким образом Ну Итого ваша практика до модели сколько у вас нужно запас было иметь И сколько теперь бо тоста прогнозировать есть у команд было понимание того что утилизация условного по дол быть 80% они нам е сказали и мы моделируем чтобы в следующем году в пиковый момент у них утилизация была не выше 80 условно там 79 вопрос насколько она там изменилась Ну не знаю процентов на 20 на 30 вот как линия мы рисовали то есть модель сэкономила 20% запаса модели могут больше коне кка это инде не могу рассказать конкретно числа хорошо спасибо спасибо а второй ряд центр зала Спасибо Добрый день Вот мы сейчас достаточно много и обстоятельно говорили про моделирование закупок Да а вот ели история про скажем так обратный процесс Потому что есть же плановый вывод из эксплуатации систем вот какое-то моделирование про то что у нас выводится некоторое железо из эксплуатации Да нужно вот планову е заменять и как это повлияет на собственно нагрузку и на всё что у нас происходит Ну тут мы не то что моделируем Да есть стандартная история про амортизацию это иное количество лет да О У нас тоже присутствует и ну как бы её не надо моделировать мы знаем мы знаем когда мы купили сервера вот проходит нное количество лет его нужно заменить Да теоретически это ну сеча Да потому что ну и профиль нагрузки тоже меняется меняется и по который мы можем ставить или уже не можем ставить на этот сервер То есть это не только Ну как бы такая Плановая амортизация это ещё и вопрос как Да смотри если мы говорим про обновление серверного парка то опять же говорю мы Тестируем У нас есть мы проверяем как новые сервера насколько они лучше да Или хуже старых Да это потенциально может быть и очень старые сервера и э за счёт того что мы прогнозируем очень важно не количество серверов а необходимое количество цпу там да Или утилизации другого там ресурса памяти то в зависимости от того сколько ну ядер Да в новом сервере будет и то число сроков получится Вот мы это всё учитываем конечно хорошо спасибо Ребят давайте последний вопрос э вот соседу можно передать Спасибо центр зала Добрый день спасибо за доклад у меня вопросик Какой у вас горизонт планирования по процессу капасити менеджмента Вот и второй с ним связанный Как вы на этом горизонте учитываете нагрузку от Новых процессов которые ещё на текущий момент не разработаны Но будут разработан там условно через месяц через два через три Да Ну смотри Значит у нас есть два там вида прогнозов такой условно детальный он на следующий год и на текущее да то есть мы заранее не знаю там условно 1 января знаем что будет через год и детально этот год мы знаем также мы верхней уров прогнозируем нашу стратегию на там 3-5 лет то есть и бизнес понимает как он будет расти Да у него есть понимание потому что ну как бы инвестора они должны знать Да как бизнес во будет расти и на осно этих верх уровневых пронов Мы тоже свой верхний уровни аналитически строим то есть Горизонт дальний - это там 3-5 лет он не детальный это важно понимать детально это Тей Следуй готам учитываете влияние нагрузки вот да про новы фиче да прости я забыл пока отвечал значит я прошу прощения нам Мы уже закругляйся вопрос был один в дальнейшее обсуждение мы продолжим в дискуссионной зоне Я предлагаю выбрать Два подарка мне очень понравился вопрос из онлайна вот Ага из онлайна там это мне кажется вопрос был в чате зала спишемся какой ему подарок чей от конференции или от давайте от озона и вот последний вопрос хороший очень по теме да Ага и последний вопрос подарок сюда Да Анатолий Спасибо ещё раз А ребята поал я вам спикера верну через 5 минут ещё подарок конечно ты получаешь от нас от конференции э Спасибо тебе большое что выступил было очень интересно"
}