{
  "video_id": "XtF15574ij8",
  "channel": "HighLoadChannel",
  "title": "Готовим тестовое окружение, или сколько тестовых инстансов вам нужно / Александр Дубровин (Superjob)",
  "views": 3367,
  "duration": 2365,
  "published": "2018-07-19T04:58:13-07:00",
  "text": "меня зовут александр дубровин я работаю в компании superjob и если в 3 цифрах компании что это такое это один миллион уникальных пользователей в сутки это более двух 20 миллионов резюме в базе и более 2 миллионов приглашений в месяц но сегодня мы поговорим не об этих цифрах а немножко других и давайте наверно с утра разомнемся и так поиграем немножко поднимите пожалуйста руки те кому вот в вашем проекте достаточно скажем 5 тестовых стенд 0 и меньше замечательно а кому нужно скажем от 5 до 10 может быть кому то нужно больше десяти от 50 до забегая вперед я скажу что мы для себя этой цифры к счастью или к сожалению не знаем но обо всем по порядку так я щас немножко здесь порядок наведу постить обо всем по порядку да и давайте начнем с небольшой истории представим себе небольшой проект ну скажем проект с в этом не большом проекте есть команда разработчиков из команды разработчиков им надо тестировать где-то свой код ну допустим там какие то скрипт и отладить еще что то как мы организуем тестирование но мы поставим какую тестовую железку сделаем ее похожей на продакшн накатим туда код запустим и все хорошо разработчики могут там что-то раскатывать тестировать у компании все замечательный проект хорош но в какой то момент мы начинаем расти и нам необходимо на необходим штат тестировщиков нас появляются к и специалисты им тоже нужно где-то тестировать ну какой подход подход простой ну давайте мы отделим какой-то участок для тестировщиков накатим туда такую же копию и вот они уже могут тестировать все замечательно все хорошо проект продолжает расти и у нас появляется дополнительная команда разработки и им также требуется где-то что-то тестирует подход у нас уже знакомым и еще отделяем вот команда может нести это на самом деле команда большие они тоже растут и по одному тестовому стан дым как-то маловато вот ну и задач они тоже делают большие поэтому тестировщиком нужно тоже ведется что тестировать вот примерно в такой стадии можно начать замечать интересные истории в таких командах допустим есть тестировщик вася он хочет потестировать какую-то задачу он берет выбирает какой-то тестовый стенд раскатывает туда начинает тестировать кликает кликает потом понимаю здесь что-то не реализовано здесь что тут не работает здесь вообще задача не сделано в дыру начинают падать тикеты возле вас и начинают собираться разработчики со словами да как же тогда все же сделано ну и кто-то выдает там фраза такая ветка на тест у нас к смотрит не та ветка быстро исправляется тикетов geely закрываются все хорошо вася тестирует продолжает у него все работает но в это время в другом конце комнаты разработчик вала так вот странно почему у меня не работает что здесь он быстро понимает он же разработчик он понимает что ветка не то раскатывает и проблемы снова у васи за пару итерации они понимают что они просто тестируют и на одном тестовом стенде и мешают друг другу в результате время потрачено впустую вася вы недовольны что делать другая история разработчик коля он знает про васины проблемы и заранее приходит к нему и спрашивает о какой тест и вы сейчас свободен мне нужно там на часик скрипт погонять ему говорят ну вот забери вот этот он туда уходит вон там тестируется хорошо через пару дней они встречаются снова вы у разработчиков спрашивает а собственно тестовый стенд и нам вернешься там займов на часок и уже два дня прошло и снова проблема либо разработчику собираться искать другой стенд либо все будут бодро ждать этого разработчика пока он закончит ну на самом деле на этой схеме я отобразил не все как вы думаете кого здесь не хватает ну конечно же менеджеров иногда менеджеры хотят смотреть еще не протестированы еще сырой код в как как это будет выглядеть потом подход стандартный мы делать нарезаем делаем еще тестовые стенды все хорошо ну и самая последняя часть всей этой системы это конечно же я вся и тоже хочет куда-то стрелять в где-то тестировать ну и здесь еще одну лукавство на самом деле тестовый стенд выглядит вот так и планы развивая такую схему мы получаем мы получаем бесконтрольное какое-то изменение тестовых стендов чем она плоха плоха тем что мы действительно не контролируем такие стенды мы не знаем кто мы не знаем что 1 кто тестирует на этом стенде в данный момент что там раскатано и мы не знаем по вообще занят он сейчас свободен более того мы не знаем о какие тестовые стенды у нас сейчас свободны а может быть на какие-то в это время стоит очередь где-то в этот момент мы у себя вот задумались а собственно что же делать зачем нам столько тестовых стендов действительно мы не знаем мы бы мы не можем контролировать какие загружены какие нет мы ничего не знаем про них ну и как развитие эта идея почему бы нам не делать тестовый стенд ровно тогда когда у нужно вот нужен нам сейчас тестовый стенд мы его сделали не нужен мы его удалили ну и следующий шаг по всей эта идея давайте делать тестовый стенд под каждую ветку кода вроде идея хорошие все замечательно но есть еще технические нюансы нам нужны стенды во-первых независимы они должны быть сильно похожи потому что мы же хотим тестировать ближе production окружению и стенды соответственно должны быть очень похожи на продакшн нам нужна возможность быстро создавать такие стенды почему просто потому что у нас быстро появляются ветки и мы хотим чтобы вот сейчас ветка появилась и тут же у нас появился тестовой станка дни ну и в идеальном конечно хочется одну кнопку сделать тестовый стенд вроде светлые идеи все хорошо но есть еще нюансы нас есть реальность а что в реальности в реальности у нас огромный пички монолит с достаточно большой историей который просто так не повернуть более того сервис superjob это сервис в 4 доменных зонах одновременно поддерживаем российскую украинскую узбекскую и 2 русскую зоны далее у нас есть куча под доменов это гиа по домена это допустим сервисный поддомена такие так и пи ай кью dance . superjob.ru это сервис для студентов и все это в какой-то момент и сыров щеки захотят протестировать ну да мы сейчас не тестируем это на украине но завтра появляется задача он сделал для украинского для украинской части какую-то специальную страничку и что наша система не позволит это нужно тоже учитывать ну и как подходить к такому решению во-первых мы говорили то что тестовые стенды должны быть изолирован изолированные максимально похоже что у нас сейчас в наше время это позволяет ну конечно докер докер нам даст возможность запускать контейнеры ну и докер компостом очевидно что одним контейнером мы не обойдемся и более того нам надо запускать кучу похожих стек поэтому докер компоста вы замечательно дотер мы будем использовать стильно модно молодежно но при этом докер говорит что давайте сервис давайте сервисы и запускайте сервисы желательно микро сервисы и здесь мы вставим перед проблемой то что нас монолитом вы когда-нибудь пробовали оценить сколько стоит распилить монолит под микро сервисом мы к счастью не дошли до этого момента ну потому что очевидно это цифра как вы измеряется в человека годах в какой то момент мы посмотрели на компонентную систему нашей на компонентную схему нашей системы и очень замечательно увидели что вот у нас есть лот балансер здесь у нас есть приложение . здесь у нас есть но джесс приложение и почему бы нам не запускать именно это как сервис то есть давайте найдем то что мы можем запускать в докер контейнерах замечательно мы выделили сервиса мы научились их запускать при помощи докер компост что дальше дальше нам необходимо каким-то образом достучаться до нашего тестового сервера до нашего тестового стенда как мы это будем делать ну нам очевидно необходимо как-то вытащить 80 порт наружу чтобы браузер мог открыть наш тестовый стенд если такие стенды будут запускаться в рамках одной машины ну очевидно нам нужно как-то выдавать ее печники казалось бы задача самая простая берем bridge интерфейс на совы вам туда интерфейс и докер они получают айпи адреса все хорошо но вот в этот момент докер повел себя несколько странно при виде bridge интерфейса сворачивался комочком и забивался в угол ну не может он работать бриджег мы расстроились и начали немножечко гуглить багтрекер докера и в то же время полезных документаций а что же почему же может быть там как-то объяснить в документации оказался целый огромный раздел про настройку сети и докер сам умеет варить различные типы сетей нашем случае очень помогла сеть типом акваланг что такое моклан это технология которая позволяет на одном сетевом интерфейсе на физическом сетевом интерфейсе реализовывать пачку виртуальных сетевых интерфейсов при этом если мы попросим докера создавать такую сеть он сам будет управлять этими интерфейсами он их будет создавать он их будет добавлять на машину и получать уже внешние по отношению к пост машине айпи адреса таким образом мы можем запустить пачку контейнеров и дать фронт контейнеру балансиру возможность получить внешний айпи адрес ну то есть внешне опять же по отношению к host машине и открыть на нем 80 порт и мы уже можем постучаться туда при помощи браузера замечательно у нас есть несколько тестовых стендов которые имеют внешнее пи адреса открыли 80 порт а что же дальше а дальше мы вспоминаем то что у нас есть доменные зоны и кучу под доменов и обратиться к такому тестовому стан doom мы можем только по домену второго уровня и здесь есть как колоссальный плюс так и колоссальный минус ну во-первых минус нам очевидно придется каким-то образом перекрывать домен реальные домены в зоне ru в зоне у а в зоне у z но но при этом есть колоссальный плюс в качестве домена второго уровня я могу зашить прям конкретно название ветки мы же делаем тестовый стенд и под каждую ветку кода и таким образом мы получим наглядный четкий ясный адрес в котором будет содержаться уже указания на ветку кода ну минус обходится на самом деле просто нам если нам приходится закрывая перекрывать домены мы просто добавляем префикс и таким образом ограничиваем просто скупо перекрываемых доменов в нашем случае мы выбрали префикса с джейн superjob и получается мы нам приходится перекрывать домены только с префиксом а вот таких явно немного еще одна часть dns этапе нам необходимо поднимать тестовые стенды быстро поэтому нам нужен dns сервер который позволяет быстро добавлять и быстро убирать запись желательно по api в автоматическом режиме большинство dns-серверов это не позволяет но мы нашли решение power до нас если кто-то может быть узнал вот эти вот замечательные шесть точек от их логотип мы нашли вот этот dns-сервер он позволяет достаточно быстро и просто прикрутить к нему а фишечку и при помощи скриптов добавлять удалять тестовые стенды замечательно мы подняли настроили для нас мы научили прописываться наши контейнеры в него прописывать своей api все хорошо у нас есть тестовые стенды но чего то не хватает мы живем в 21 веке и ну очевидно что весь наш интернет сон и ссср он сел и тестировать социальный сайт на на незащищенных наши типе тестовых стендов но это несколько глупо ну почему там достаточно много специфичных ссср специфичных багов и именно контент это как бы вот только только часть из них только вершина айсберга вот как здесь быть нам очевидно нужно опять же какой-то способ быстро получить сертификат и быстро его применить уже на поднимающийся тестовый стенд в нашем случае опять же в нашей компании уже центр сертификации был он был основан на у панаса цели здесь мы пошли ну простым методом в лоб давайте напишем свой велосипед велосипед пишется там за один день и позволяет при помощи get запросов получать сгинь ирины и сертификаты уже на конкретный их на конкретное имя домена мы можем уже про кликать цельную версию я осталась самая малая ну конечно все это она неважно без автоматизации почему ну мы же хотим все таки сделать это одной кнопкой как это можно автоматизировать ну для себя мы на начальных этапах конечно написали некоторые консольные скрипт консоли скрипт который позволяет просто поднять тестовый стенд или его удалить очевидно тестировщиком это не очень удобно куда это можно разместить это можно разместить все например сделать специальную сборку которая вам соберет тестовый стенд и запустит его вот но на самом деле самым крутым шагом в этом плане это добавить такую кнопку прямо в жира ticket представьте ваш тестировщик открывает жиры тикет считает требования нажимает кнопку и получает там через пару минут из 300 здорово же ну и все это полетела какие плюсы всего этого изначально мы планировали это под тестированием на подручное тестирование чтобы тестировщиком запустите про кликать любую версию своего кода да это круто это заработало следующем дополнительным бонусом можно сказать что у нас появились и домах остальное это тоже самое только в jira ticket заходит на и тестировщика менеджер проекта и тоже может посмотреть покликать уже сырой код далее мы получили колоссальный boost грязь а почему когда мы обучили нашу себя и точно также поднимать тестовый стенд на какую-то конкретную версию кода и потом его удалять мы получили возможность запустить абсолютно любые тесты для любой ветки даже самые сложные интерфейсные selenium test и я могу одним кликом прогнать для любой ветки моем проекте это действительно колоссальный bus потому что это ну и это счастье для разработчиков но есть и минус минус и я уже спалил flight управление стендов почему минусы даже наверное минуса нюансы я бы сказал потому что вот здесь нужно просто научиться ими правильно управлять первую версию своей система мы выкатили на простенькую железку это было по моему 8-ядерный гигабайт 12 оперативы и сказали рук поднимает тестовый стенд под каждую новую ветку ну окей он начал поднимать и где-то через день или через полтора сказал кря ну просто потому что веток то появляется гораздо гораздо больше какой здесь выход вы просто перестали создавать автоматически когда она появляется и добавили в тот же в тот конкретный момент появилась кнопка в jiri вся и научилась запускать и останавливать эти тесты собирать с них логе и я бы не сказал что это конечно минус ноль это нюанс это этому надо научиться ну и определенно есть класс задач которые эта система не позволит решать например часто всплывающие проблема это общее время для всех контейнеров некоторые задачи было бы удобно тестировать сдвинув время на сервере ну допустим как себя форма поведет вот я сейчас не что сделала через две недели у меня там должна какой-то сплошь возник вот это систем к сожалению позволяет решать такие задачи но всегда есть обходной путь приходится ставить лычки в коде чтобы можно было посмотреть какую ты как как поведет себя эта форма там скажем через две недели мы в качестве итога на входе мы имели систему тестовых стендов которое заставляло нас искать тестовый стенд чтобы развернуть на него который не гарантировал нам-то что никто не будет мешать друг другу на этих тестовых стендов на выходе же у меня получилось одна кнопка которую можно нажать и получить там через пару минут готовы тестовый стенд под конкретную версию кода и даже если этим стендом будет пользоваться несколько человек гарантированно то что эти люди хотят смотреть именно эту все коды ну собственно об этом слайд то что не нужно искать тестовый стенд его просто нужно пойти и развернуть новый бонусом мы получили все тесты в один клик как я уже говорил любые тесты на любой ветки и прямо из себя и одной кнопкой все сделает сама подними тестовый стенд ап стреляет его соберется него логе и удалит ну и возвращаясь к своему первому вопросу с чего я начала сколько же тестовых стендов нам нужно и не знаю сколько нам нужно тестовых стендов потому что сегодня их нужно 20 завтра их нужно 15 после завтра там 25 но я точно знаю что у нас ровно столько тестовых стендов сколько нужно вот прямо здесь и сейчас и собственно общий посыл к вам не нужно бездумно копировать тестовые стенды нужно научиться ими грамотно управлять и развивать эту систему на этом у меня все спасибо может быть вопросы раз здравствуйте спасибо за доклад интересно вас тестовый стенд каждый использовать собственный база данных или они все ходят продажи я ждал этого вопросы я аккуратно ходил обходил этот вопрос сторона дело в том что опять же в силу того как развивался наш проект мы используем копией продакшен базы сейчас я не общее то есть каждый тестовый стенд который поднимается он использует они все используют одну копию базы но мы очень хотим базу в докер окопе восстанавливаться каждый день новая копия устанавливаться по расписанию есть копии который устанавливается каждый день есть купе который устанавливается там раз в неделю в зависимости от требований опасливо собственно спасибо за такой большой а не вижу я здесь предложение вопроса а если в задаче есть миграция который ломает предыдущий код как на самом деле если задачи есть миграция который ломает предыдущий код такая задача она должна и тестироваться и выкатываться особым образом почему потому что если мы ломаем совместимость с продакшен если мы задачей ломаем совместимость продакшен кодом значит у нас невозможно бесшумный релиз выполнить то есть такая задача она должна либо в два этапа релизиться либо каким-то отдельным флоп осима станислав мегагруп скажите пожалуйста когда происходит обновление софта на котором все это гоняются как вы действуете то есть я насколько понимаю то нужно обновлять образ уже докеры да да да это нужно обновить дойки ру ну на самом деле обновление софта это достаточно сложная операция в плане технологичны потому что нам нужно сначала подготовить обновление потом будет это тестировать вот в этот момент мы обновляем в том числе и докеров докер-образ для запуска дальше этот софт тестируется какое-то время на тестовых стендов и потом только на накатывается на продакшн ну то есть это этап обновление софта вот в целом александр спасибо за доклад у меня такой вопрос а если у вас задача которая затрагивает например связанные задачи как вот вы раскатываете тестовый стенд в котором ветки нужно выбрать вот в нескольких сервисов проектах на самом деле выйти вот так все выглядит это на самом деле решается очень просто ветки одинаково называются все ну допустим у нас есть ticket jet давайте 1325 и для того чтобы выполнить этот ticket нам необходимо выполнить изменить код в нескольких проектах в каждом из проект собирая создается ветка д в 1325 и мне все это выполнить то есть у вас большущие там ticket их жираф которые там несколько проектов так получается не совсем понял ну если у вас одна задача затрагивает несколько проектов у вас они уже разнесены скажем или нет проекты в jira там достаточно сложная система есть проект под продукт есть проект под технически какие-то вещи вот ну в общем в общем плане это делается какой-то epic поэтому я пеку называются все ветки и в него высыпется подзадач на разные проекты спасибо александр спасибо за доклад вопрос немного в сторону если рассматривать для развертывания и as the на что обратить внимание при выборе провайдера поставщика услуги можете немножко поподробней она инфраструктура как услуга то есть в облаке а в облаке здесь к сожалению нет экспертизу потому что у нас все железо свое и мы собственно вот этот тестовый сервер который держит все эти стенды он лежит на слове и вы вообще никогда не вы смотрели думали ну не то чтобы не ну так у нас заведено в компании мы на своем железе работы какие то мелкие проекты мы можем вынести куда-то в облака но это крайне редко я спасибо не вижу спасибо за доклад об скажите что происходит с виртуалками когда разработчик и заканчивает работу над оправдались это интересно речь а ну во-первых кнопку удалить есть но она запрятана сильно глубоко и когда ticket закрывается в jiri jira пинает тестовый стенд он удаляется спасибо здравствуйте спасибо за доклад вот такой вопрос как в автоматизировали настройку приложения внутри контейнеров вот после запуска blogger.com полз поднимаются контейнеры в нем в них крутится приложение и нужно где-то там доменные имена переопределить конфига где-то там connection базам поменять ну это все на самом деле настраивается на этапе старта контейнеров запускается контейнер к нему прилетает там какой-то набор окружении переменных окружения и от этого уже настраивается приложение то есть у вас все приложения не поддерживают работу с окружением на ну не то чтобы с окружением там где мы не можем работать с окружением у нас просто на лету генерится готовый конфиг из окружения подсовывать спасибо спасибо за доклад я здесь самое главное вопрос не ответили сколько нужно стендом собирайте ли вы какую-то статистику и на основе этой статистики выбирайте ли железа тот сервер на котором там поднимать то или иное окружении в зависимости от мощностей или там от задач сейчас я не помню точно сколько но в среднем это где-то 25-30 тестовых стендов у нас запущена вот один момент времени вот под это мой конь конечно же леска не подошла к на который мы все пытались запустить вопрос заказали сервер потолще вы собираетесь статистику и на основе ее прогнозируйте развитие оборудование станет данный момент статистика пока еще не собирается спасибо из находит общем окна статистики как такого нет спасибо за доклад насколько понимаю вас докер в деве он наверное вас в продакшене нет продакшен нас немножко по-другому тогда вопрос такой а как вы поддерживаете одинаковое окружении если докер по по сути там допустим сексе а здесь докер таким вот образом на самом деле у нас железные сервера продакшене поэтому там нет контейнеров но вообще докер в этом проекте он для нас был экспериментально давайте попробуем возьмем вот эту штуку и сделаем на основе нее тестовые стенды классно он полетел все замечательно после этого мы притащили уже докер контейнеры в разработку то есть мы можем запускать на докеров и разработчики машин там конечно есть нюансы что-то еще требует доработки но мы уже можем сделать production пока у нас работает ровно так как он работал всегда на железных машинах и до него руки что пока не дошло так все-таки вопроса как вы дадите на окружение поддерживает руками сейчас данный момент руками ну то есть мы как я уже говорил в этапы обновления софта то есть мы сначала обновляем софтов докер-контейнер гоняем на тестовых дальше мы руками уже обновляем эти пакеты и при этом в танин на сто процентов идентичны да потому что это все в своих репозиториях pm пакета который просто накатываются все спасибо спасибо за доклад маленький вопросик провод в раскаленном dns автоматом прописывайте там вообще есть этот человек от читабельны как вы генерируете в куда н.и. или у вас всё там номер тикета . superjob ну то есть как пользователь не зная отеки то могут попасть или они у вас точка входа и stick это переходит в в тесте окружении ticket завязан вымени ветки это уже договоренности идут то есть иметь и кита по имени тикета создается ими ветки а по ветке уже раскатывается там какой-то тестовый стенд и и имя ветки она участвует в доменном имени ну допустим у меня есть ticket там df 1328 и соответственно тестовый стенд под нее поднимется с джей дефис д в 1328 . александр спасибо за доклад больше интересно почему не стали брать поводу решение этой задачи например тоже самое как и бенитес сложилось исторически или есть какие-то проблемы которые не позволили это сделать но как я уже говорил докер для нас вообще принципе был экспериментальной частью и хотелось пойти пойти по принципу наименьшего количества новых технологий возможно мы чуть позже на него посмотрим и что-то снизу просто из того что вы перечислили да там лот balancing тот же самый там dns и сети все остальное она там все из коробки и возможно вам это сэкономило бы человеко-часы для я думаю мы посмотрим через какое-то время просто в эту сторону спасибо добрый день спасибо большое за доклад скажите пожалуйста если у вас какая-то отдельная схема автоматизации для нагрузочного тестирования или ну это все делается в том же вот этом вот виртуальном окружении но очевидно то что эту схему использовать для нагрузочного тестирования несколько некорректно потому что мы здесь все-таки не можем гарантировать то что другие теста на стороне к сюда дамон и по роняет все и взаимодействие с другими тестом стендами для этого есть отдельная схема отдельные железки на которых просто гоняются уже нагрузочный тест обстреливать но при этом там тоже все из в принципе по той схеме я к сожалению не могу сказать как там там по моему уже ближе к продакшен железка прям разворачивать спасибо александр спасибо за доклад не очень понятно про базу если в какой-то ветки требуется если какой-то ветки для работы требуются изменения в базе несовместимые с другими ветками как это происходит сейчас и планируете ли вы что-то в этом менять ну смотрите давайте еще раз вот у нас есть мастер ветка которая нас раскатано продакшне она работает если в какой то из веток мы делаем из изменения такие что они не совместимы с мастер веткой а соответственно и со всеми другими ветками то такую ветку мы потом позже уже не сможем бесшумно сзади площадь на продакш нам либо нужно будет останавливать стенд сервис весь целиком либо какие-то дополнительные операции придумывать и в этом случае мы просто идём по принципу то что ветка должна быть совместима если есть какие-то изменения которые предполагают что она будет несовместимо ну такие релизы просто раз кадра здесь разделяются на несколько этапов на несколько веток и мы можем всегда тестировать ту ветку которая будет совместима но эти изменения на тестовую базу как прилетают эти изменения прилетают на тестовую базу когда поднимается тестовый стенд и мы просто не будем делать так тестовый стенд для ветки которых дипломат то есть там будут какие-то скрипты для изменения связи небо то обычными механизм миграции который любая система позволяет сделать спасибо за доклад вопрос такое как вы боретесь с бесконечными айн с вечными контейнерами встречными окружениями а что вы подразумеваете под словом например разработчик сделал окружении сказал что я посмотрю как он работает логика пица памяти живется потом он его по цепочке передает quay и в результате например заканчивается место там либо память ну во первых как я уже говорил в jiri есть куб который автоматически при закрытии тоску дали такой контейнер он больше не нужен закрываем текке джерри значит удаляем контейнер все контейнеры тестовый стенд вот ну и есть некий механизм который просто следит за тем сколько контейнер висит нас запущенный и по нему уже можно будет следить такие контейнеры убить например вручную и и второй вопрос базу данных вы маскируете или вас там продавая данные там хитрые на самом деле схема она льётся с production там есть по определенным правилам заливается и уже после на нее накладывается патч который там потирает какие данные спасибо за доклад у меня тоже 2 вопроса если у вас какие-то внешние зависимости кроме базы данных внешне зависимость еще раббит мы как-то у нас позволял код не вносите вовнутрь всех этих контейнеров он у нас один он справляется и собственно проблем не доставляет но у нас общие для всегда он один общий для всех тестов стану просто наш код позволяет использовать много тестовых стендов и использую при этом от только одна города и понятно спасибо еще вот power dns упомянули а почему не консул рассматривали ли вы консул консул не могу сказать рассматривать эту крышу спасибо здрасте метод дмитрий игру у меня несколько вопросов во первых когда вы делаете тестовый стенд у вас контейнеры собираются заново либо у вас есть какой-то базовый образ куда вы просто добавляете плод нет есть базовый образ и из этого образа просто стартует новый контейнер там есть некоторые операции которые необходимо сделать ну допустим в каких случаях сгенерить конфиге в случае там фронта это нужно получить сертификат и прописаться в dns но в целом старт контейнер но он сведён к минимуму сколько по времени занимает я не могу сколько сказать сколько по времени занимает старт потому что сама система себя на предварительно собирает код она хотя бы должна бы запаковать и вот этот момент время от момента нажатия кнопки в jira до того как мы получили теста и стенд но где-то до пяти минут вопрос потому что нам нужно собрать и запаковать архив с кодом среднем где-то через 5 минут вы получили тоже работе нет это максимум пять минут в среднем на пару минут видимо возникнут какие-то продолжительные работы когда вы начнете делать базу данных и запихивать по крайней мере у нас так у нас стартует примерно 6 минут ну в принципе это тоже приемлемо второй вопрос не сможете ли вы эти тестовые среды в том числе как разработчик скую среду то есть разработчик ведет проект поднял тестовый среду понял что у него баг может ли он продолжить пофиксить код там же нет ли вы высосав нет высох мы не пускаем сейчас разработчик может взять и запустить ровно те же самые контейнеры у себя на локальной машине и в принципе это тоже одну контрольную командует все взлетает хорошо спасибо за спасибо за доклад наверное частично уже ответили на вопрос просто аппетит приходит во время еды и от по своему опыту знает что чем мощнее вас подобные системы тем все больше и больше разработчики и тестировщики требует каких-то fitch становится более немножко ленивый мечтали вот если у вас проблемы к что разработчики не хотят чтобы окружение удалялась каждый раз при закрытии тикета чтобы них сохранялись там их айпи адреса привычны чтобы не сохранялись и dns своими нас привычны чтобы каждый день мне приходилось по сути работать в новом окружении на самом деле окружении она живет в рамках одного тикета то есть когда ticket закрыт к нему уже возвращаться бессмысленно да но как бы приложение но одно разработчик работает в этом приложении разрабатывает код он переходя к новому текке крикету не начинают разрабатывать новое приложение пока таких проблем не встречали она вам повезло возможно будет второй вопрос прямо его на одном на на железке начинаете уже ощущать то что там окружении мешая друг друга и как с этим бороться на самом деле мы заказали достаточно толстую железку два кадра и считать сколько вы можете развернуть вы тоже пока не начала мы вот на маленькой железки попробовали развернуть там достигли какого-то числа но на большой уже не пытайся спасибо скажите пожалуйста а вот к теме еще контейнеров соответственно если у вас вдруг при развертывании окружении какая не будет снова то есть в каком-то из никитин из тикетов например там сделали патч потек вся потекла память в сервисе и соответственно контейнера начал загружать железку по полной программе сталкивались ли вы с такой ситуации как боритесь на самом деле не сталкивались но я очень надеюсь что zabbix нам об этом сообщит александр я вопрос по 8e системе даже не даже не совсем пусть я так понимаю что вся система умеет тоже разворачивались контейнера да а вот смотрите если нужно например выполнить никаких функциональный тест который до населением и написана для этого нужны какие-то внешние машины они тоже развертываются в рамках selenium у нас сейчас это отдельный кластер просто стоит с браузерами которые потом оттуда берутся маршруту разберутся берутся браузер и уже даже не машина браузер сколько-то машин по 10 браузеров нарезать и спасибо за доклад открыть пожалуйста-а-а даете ли вы доступ к лагам приложений если да то как на тестовых поражениях доступ к лагам он есть но пока реализован так не очень одну можно зайти по из саши просто определенно директория посмотреть продолжая тему баз данных хотел знать о миграции у вас как накатывается какой момент боюсь соврать мы по-моему при старте контейнера тоже миграция катится но и , продолжая тему если меняется базы данных так что все ломается эти задач получается как-то помечаются чтобы тестеры случайных не раскатали не помолимся да там просто префиксу имени ветки и этого достаточно а бывали случаи сломали бывали но на самом деле самосский систему баз данных тестовых устроено так что сбросить эти изменения занимает ну там 3 минут спасибо по поводу базу данных продолжу если данные испорченный то есть вы делаете 1 ночь там бэкап с основной базы и на этом этапе производится тесты было если данные в этом тесте развернутом бэкапе все испорченные заново начинает разворачивать backup или нет сама система как я уже говорил баз данных нам позволяет все изменения накопленный на тестовом стенде над на доставай базе уже откатить там в течение трех минут и чем больше часть это будет набирать команду ssh подскажите пожалуйста как эта хитрая система основана на субсчетах военных слышат александр спасибо за доклад два маленьких вопроса сколько у вас команда разработки сколько человек боюсь соврать но больше 50070 и второй вопрос кто отвечает за патч который работает с б.д. вас же наверняка часто изменения в bt происходят с персональными данными которые именно патя который накатывается да ну и то есть специальная команда специальные люди которые собственно поддерживать эту систему с базами спасибо кто-нибудь а там еще есть рука здравствуйте спасибо за доклад от такой вопрос а нагрузочного тестирования на том же сна не проводили о сути не для нагрузочного тестирования с отдельный стенд если ты все то я попрошу александра сказать какие пять вопросов прозвучавшие этом зале представители вас не больше интерес я не готов на этот вопрос ответить внезапно вопросов было очень много но очевидно вопрос про базы и вопрос проб губернатор я бы отметил друзья которые задавали эти вопросы пожалуйста подойдите к столу около спикера коллеги спасибо большое"
}