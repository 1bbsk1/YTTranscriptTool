{
  "video_id": "OQASAuuZvS8",
  "channel": "HighLoadChannel",
  "title": "Прикладная эзотерика / Андрей Аксенов (Авито, Sphinx)",
  "views": 3758,
  "duration": 2855,
  "published": "2021-10-04T02:44:45-07:00",
  "text": "или по меньшей мере попытаюсь скорее всего у меня ничего не получится скорее всего вы это все и так знаете на общем все стандартные диск венера работают дорогой зал первый раз за два года мне так бы нужен фидбэк будет небольшой но будет полезен фетт бэтмен в том числе вам самим поэтому давайте потренируемся потратим 30 секунд на тренировке значит как мы установили экспериментально просьба поднять руку мне работает во первых во вторых меня сопит и слепит я не сумею сосчитать поэтому тренируемся значит делать вот что кричать ну и кричать вал и кто громче зачем это надо когда в докладе будет совсем не искусственная интересная секция а у меня кажется таких 2 или 3 запланированы то возможно в зависимости от тайминги я попрошу проорать там луи лего у него будут принимать решение оперативно по ходу доклад дочитывать до конца пытаться ее там не укладываться в 2x в бюджет времени или нет вот на вот ну давайте там я не знаю допустим там голлинг ну наверно вау хаски ну наверно буду потому что никто не знает давайте тренируемся носу им за голы young нет но как бы если голосовым thorium вау а если в зато против то бинарное решение просто принять первые так который вау дайте воу-у огнище highload highload слова будем им и конечно же теперь бу-бу нет ни в коем случае типа андрей расскажи нам про динамические массивы они же виктора очень эзотерично я структура данных не но бабу ну что вы господин да и будем сравнивать громкость не знаю что из этого получится новость получится какая на хрен эзотерика что это такое я провел небольшой опрос что вы ожидаете от доклада под названием эзотерика тем более прикладная насчет мне ответил никто в том числе некоторые отдельно взятые члены программного комитета но видимо члены программного комитета тоже люди и предполагают что вот какой то вот такой вот будут показывать и втирать в том числе и текстом картинка не будет расходиться не с чем ладно еще как говорят у нас в мясе челябинской области прикладная mais а вот судя по всему ожидания от его нормального человека доклад с таким названием это то что будет вот такой как гипноз происходить и как значит за пару-тройку дней в рекламных материалах было написано нам будут втирать пульта дичь но возможно интересную дичь и соответственно все получится далее я попытался как вот помедитировать вот там открыть у себя еще несколько пар глаз открыть подумать чё там могло бы быть искать вот какие прикладные эзотерические советы возможность сделать ну там очевидно что там lunar скорпионе значит а никотин build сегодня вот или допустим меркурий ретроградно и это плохое время для того чтобы начинать новый микро сервис вот ну такие дадите совет не должны были быть внутри шествие недостаточно квалифицирован чтобы такие советы давать кстати рекомендую вот если кто-то этим бизнесом займется то я уверен будет довольно он успешный будете конца такие получить практически все мясо то есть там мыло индекс березу понятное дело никто не считать ничего и в том числе никто не считает например abstract и доклада с одной стороны и методички про алгоритмы и структуры данных с другой стороны в абстракции доклада были слова про структуры данных и может быть даже про алгоритм и здесь у меня есть ряд риторических вопросов под названием случались ли в вашей жизни собеседование с любой стресс странные собеседования задавали ли хоть на одном из собеседование либо вы либо вам идиотские вопросы про структуры данных и может быть даже алгоритмы что вы на них ответили если по всему тому списку по которым я попытаюсь пробежаться на 2 минут по две минуты на одну структуру и не успею вы ответили значит а идеально показали прекрасные знания то где мы все-таки и ходят тебе почему меня как бы в телеграме нету хотя бы там очереди из хотя бы 500 толковых таких вот резюме например на любые деньги ну вот непонятно совершенно о чем заявлен доклад про эзотерику это вот так как бы определенные там оккультизм но не только я считаю что в разрезе детишечки структуру данных и так далее затари это все кроме святой троицы при этом поскольку конверсии в мире много по святая троица тоже у всех разные как нетрудно убедиться значит святая троица она выглядит вот именно вот так это мы это многие могут могу тут немного непонятные символы поэтому их надо уточнить вот на мой взгляд они выглядят эти самые серые символы ну примерно вот так тут правда я спер картинку буковки неправильное пришлось их немного под фотошопить вот святая троица значит это не эзотерика вот это наша повседневная жизнь вот так мы живем но как бы в основном если задуматься на самом деле одна или две даже букв из этой повседневной жизни у нас постоянно отсутствует значит в этот момент человек прадеш орёт что за дичь мне втирает он весь плачет внутри но сейчас станет ясно это wended на мандрагора и ересь до маленькой терминологическое интернет сам святая троица это виктора какие-нибудь хэши или что-то типа типах и шей которые есть в вашем любимом языке не может быть что нибудь еще но это неточно дело в том что понятное дело когда начинаешь говорить о тех структурах данных которые ты используешь каждый божий день приходишь на работу там открываешь ноутбук там лопату стена стоишь и начинаешь писать код какими структурами данных ты пользоваться вот натурально каждый день ну виктора динамические массивы без них никуда что-нибудь типах и шеи в питоне они называются dick to me в гонщики они называются мы помимо суть от этого не меняется от какие-то вот такие беспорядочные кизельгур контейнера вот их есть три штуки который использует все и постоянные и это в принципе нормально я извините самими и сам и ими пользуюсь но 99 процентов времени всего написание кода терминология к несчастью вынуждены использовать си плюс плюс ну потому что си плюс плюс знаю по чуть-чуть о других языков не знаю в этой терминологии это и вектор b mиpe это соответственно сортированный севилью контейнеру внутри у которого дерева и хэш вот он неожиданно для всех называется в проклятом если си плюс плюс анар дарит map не спрашивайте ну вот так вышло дело в том что название хэш когда то давным давно в девяностом кто-то в 90-х годах кто-то испортил ее с тех пор как был 30 лет не могут исправить стандарт написав все это я неожиданно получил просветление что возможно с точки зрения нормального человека вот у мне вопросы было просите был вынужден поставить в питоне в бабу стб мэк внутри которого какой-то долбанной красно-черная бинарное дерево поиска с точки зрения нормально человек уже эзотерика но и страны и даже си плюс плюс программиста тоже потому что все конечно собеседника включая что внутри с tdp именно красно-черной и так далее но на самом деле никто никогда не писал все плохо представишь нам такие слава богу нового кей какой-то там бинарное дерево на душ не очень важно не интересно при этом с точки зрения си плюс плюс программиста но и ставим под какой-то такой достаточно стандартный контейнер библиотеки которые у нас вот есть он дан нам ощущение км его натуральном что не каждый не можем использовать довольно удобно а что же такое тогда эзотерик это внезапно выясняется что ну наверно как обычно эзотерика с точки зрения разного человека это какой-то разное вот слова оказывается много есть интересных синонимов я даже честно говоря половину этих слов обойти не знал пока гуглить незнание начал сегодня вы мне не помогли а вот определение из словаря немножко помогло что-то такое необычное пока почему у поругаются полторы калеки в мире вот этот мой вольный перевод статьи из соответствующего словаря и тут внезапно все с хрустом встает на свои места внезапно этого этого и важны оба компонента что тут редко это редко встречающаяся повседневной жизни и не что что понимают а уж тем более что не дай бог нравится вам нравятся устройство красно-черного бинарного дерева поиска кто кто этот извращенец я тебя потом найду за гаражами поговорим ты ответишь за свою любовь а тем не менее внезапно все с хрустом встает на месте я значит цинично утверждаю что даже про долбанное повседневные структура типа динамических массивов викторов списков хэши де кто в сланцев и так далее они по первому параметру проходят 90 процентов контингента если не 99 не знает как следует как они устроены внутри а местами копнешь на пол штука такие заблуждения всплывают а что у вас останови шевелятся везде даже в тех местах где волос сразу по проекту нет однако по второму параметру они не проходят ни фига не очень обычным и все эти структуры используем на абсолютно каждый день есть true эзотерические структура которых не использовать никто кроме олимпиадных может быть программистов и тренеров олимпиадных программистов это какая-то наркоман а еще research & rafo в области с это какие-то там условные фибоначчи вы и хип и с одной стороны кеша brevis конкор интро с другой стороны у которых все красиво на бумаге только перформанс в легком от оси по сравнению там со стандартными встроенными в условного java структурами которые делают абсолютно тоже самое ну в жалкие 5-7 раз как бы сосет по скорости я имею в виду и по памяти тоже но зато лоб free конкуренты когда-нибудь конечно это на мой взгляд полная эзотерика которой в принципе еще и не нужно есть чтоб прикладная такой длинный интро получил затянул какие-то структуры данных какие-то алгоритмы которые редкие очень редкие для кого-то нет кто-то ими пользуется каждый день для кого-то до кто-то про них не слышал ни разу в своей жизни и возможно не зря но они есть они хотя бы изредка но требуются они могут оказаться для вас эзотерика и могут оказаться чем-то абсолютно повседневным это хорошо если оказывают оказывают в чем-то по всяким доклад не нужен а вот ну и ровно по ним мы и попытаемся сейчас пробежаться галопом по европам потому что понятное дело в глубь нет никого человечестве залезать я их набрал оказывается 10 штук на свой личный вкус и свой лишний перекошенный опыт и а малыш мы every обе обычно принято писать на таких слайдах но в данном случае я уверен что ваш жизненный опыт будет вообще совсем другой то есть он обязательно будет другой погнали галопом доклады бесконечной его теоретически можно прервать в любой момент и закончить разминка самая первая и не очень-то эзотерическая структура и тут я надеюсь что сейчас за рут вау все кто эту структуру знает или наоборот зарубу здесь поскольку мне сигнал не нужен бинарный мне просто нужен сигнал что кто-то про эту структуру данных то пою как палка сиди я сам открою хоть что-то в жизни слышал она называется янаги view пятна от серьезно в зале никто не слышал про bitmap но бывал ли алё легкое движение там какой не в зале есть или слать не переключился неловкая пауза слышал кто-нибудь в зале про bitmap скажите богу о прекрасном а то им эти слайды дальше значит все знают что bitmap от когда у нас есть там не знаю малое количество элементов тип там 1000 штук который прекрасно влазят сбито мою карту на 1 кило бит и нам надо там три бить и капов ли путь или десять или 17 и быстренько доставать из этой битовой карточки на один человек значит факт есть у нас вот это вот значение в диапазоне от 0 до 1000 внутри этой битовые карты или нет да все все знают в детали не не вдаемся кто-нибудь что-нибудь я не знаю как интерпретировать мертвую тишину все согласны хорошо слава богу хоть хоть что-то знают все значит bitmap ну как бы он тупой как палка это не эзотерическая структура на мой взгляд хотя некоторые может и про него не знают но есть у него одна значит засада его невозможно за решетить достаточно быстро потому что в момент когда ты взял этот bitmap заюзал его там залил кило бить свой нулями и там это не так много байт но тем не менее поставил нипов li-pol несколько битов поработал с ними и вдруг тебе его надо заново за решетить и опять и опять и опять и заново обнулить и хорошо что если у тебя этих самых братиков типа 1 1 тысяча там и соответственно 128 бать что если их сильно больше что если у тебя эта маска еще больше чем 1000 элементов вот неожиданно человечество оказывается придумала как вот эту проблему под названием что трясет ну такое но все-таки победить вопрос ставим еще один точно вопрос как сохранить мы отличаем легко вопрос что делать если мучает начали часто эту маску рис с этим это разминка если еще эта эзотерическая структур который может вам вообще никогда в жизни потребоваться но меня она честно говоря в какой то вот такой вот которых тонический кататонический ступор бы мгновенно приводит очень прикольная структуру почему я ее сюда и включил называется sports set устроена следующим образом буквально вот так вместо того чтобы хранить bitmap мы храним значит два массива каких-то один под названием dance один под названием spore со общую длину храним и барабанная дробь эту память мы не целине инициализирует никогда она может быть полностью каким-то мусором и она будет нормальной человеческой среде каким-то мусором вот меня это структурно тонального каждый раз как я в но лишний раз про не вспоминаю и немного лазию в описании вот тут вот вот так вот как то вот в ступор прям вот ну как такое может быть то чтобы вот значит память инициализировать но успешно ей пользоваться оказывается может значит краткая идея заключается в том что при добавлении элемента мы увеличиваем счетчика сколько у нас там всего элементов в этом sports эти есть элементы соответственно здесь у нас будет не значение мы можем в этот спорт воткнуть такие же как в bitmap от 0 до 1023 но сколько их там конкретно занята вот это единственное число которое мы иные дни и ныть и все мы тратим поначалу у нас 0 бутиков в заведено условных потом один потом два потом три для того чтобы делать все зарисовать нам всего-то надо отбросить в 0 делается это вот таким вот к нам в три строчки работает он а проверяется соответственно что это все работает вот таким вот кодом не очень понятным на него надо натурально некоторое время медитировать скорик на что у нас времени нет и конечно эмоции он вызывает строго вот такие весь этот код я вот как бы надеюсь что хотя бы там три структур ки из десяти они будут вот такие вот эмоции вызывать как как как это блин работает и вот на кой хрен это надо кажется это основные вопросы которые собственные должны вызывать так называемые за to reach эзотерические но тем не менее прикладные структуры данных эзотерика мне кажется у нас уже с места в карьер есть какие-то три строчки которые делают непонятную совершенно магию я ответственно заявляю что я вчера прочитал подавил знания сейчас уже опять не плохо представляю как это работает эзотерика у нас с вами явно есть но мы бы хотели практике под доклад это называется прикладные эзотерика что такое практика наверное нас интересует почему это все в принципе работает ну хотя бы так в общих чертах детали это повторюсь на каждую структуру можно долго упарываться зачем на давящим плохо и где бы это взять что бурка меня писать потому что никто конечно же не хочет писать под руками stack overflow никто не отменял вот ну что ж разминка применим каспарс эту почему это работает работает это потому что заполнено и вот эти вот benz и spores как вы смотрят в друг друга когда мы добавили первое значение 123 2 159 в вектор dance и в векторе отставить в массиве sports 153 позиции прописали ссылку обратно на номер ноль в 179 праздник позиции прописали ссылку обратно на номер один неожиданно эта информация нам достаточно тоже чтобы сделать относительно быструю проверку есть ли у нас какой бы-то ни было значение в этом массиве мы начинаем эту проверку паспорт с массиву если она показывает за границы значит то мусор если она показывает не за границы она показывает вероятную ячейку в dance и мы по этой ячейки проверяем как бы хорошо ли у нас устроен список проверяем это значение и кажется это даже это слишком подробное объяснение для подобных структур потому что в оставшиеся 15 минут мы не уложим как бы еще 9 вот я постараюсь как бы самой простой вот на разминку в кавычках подробно описать и остальное значит все по-человечески еще более быстро скорее всего боюсь реально большом не получится ну вот и понятное дело вот в этих трех строчку кода естественно там есть баги я знаю минимум 2 или 3 но тем не менее целью вот это вот нехитрого кода этих вот трех строчек не является сделать забавную реализацию является показать вот такой вот скетч что на самом деле вот странная структура данных она настолько простая и там базово настолько простая внутри в ней логика есть дальше будет то же самое но и котик будет постить постоянно чем плохо разминаемся вопросы чек-лист чем плохо по сравнению с bitmap am жрёт память как хрен знает что в реализации которую я показал два in the там соответственно 64 бита вместо одного бита но блин надо вдумчиво бенчмарка можно ограничиться не into my а там коротенькими into my по два байта 65 536 этого хватит для того чтобы совать соответственно bitmap и в этот бит нам значение 16-битные от моря до 64 к ну и блин это все-таки помедленнее чем один бить их записать в целом структуру какая-то странная и нужно только в тех случаях когда у вас натуральная эти маски часто флип из и как ни странно это прикладная задача оригинально она вводом в оригинальной бумаги это некий life is set маски аллокации регистра в компиляторе в какой-нибудь базе данных или посетив как у меня это может быть как они там маска с моченых полей и которая меняется на каждый объект на каждый объект на каждый объект на каждый объект полей у вас может быть много фиджи сонина привет часто довольно много полей если их не дай бог за нумеровать а вот и на каждый объект и там тебе надо 2 возвести более сделать проверки зарисс этих чтобы reset не тормозил вот как ни странно редко но такая структур по бывает нужно где взять реализацию я не знаю вроде бы есть в поле но в этом конкретном случае я не успел посмотреть в других посмотрел вот как-то так я понимаю что предложение написать вызывать тоже вот такой вот эмоцию как бы у меня в первую одним из таргета вплыла продемонстрировать что искать и оказывается по чуть менее чем по всем этим эзотерическим структурам у нас есть возможность не париться сильного деталей не в рыба цао просто взять готовый библиотеку и пользоваться ей но черт вот неожиданно выяснилось что по ним достаточно многим структурам такой фигни в природе нет такие дела разминка это была структура номер один и номер 2 мы хорошо про градской бы разминка номер два все-таки в ходе куплен гаи за ты слова эзотерика я короче неожиданно вы вы установил что самая эзотерической системой на рынке является на данный момент postgres quelle потому что одна из картинок которые мне выпала выглядит вот так обратите внимание на эту картинку посмотрите на нее внимательно я посвящу вот правый угол астрономы астрономы это мы знаем болтунов и компания postgresql эль мне кажется мы где шифровали картинку которую мне подсунул google довольно легко вот вы подали в том числе нормальные картинки то есть вот такое я ожидал увидеть когда гуглил слова эзотерик и в принципе ну как бы нормально ровно то что я и ожидал но и самая шокирующая картинка сейчас будет шок-контент девушки и беременные дети до 18 лет пожалуйста закройте глаза щас будет просто такой шок-контент что вы все умрете вот это на месте практически я ожидал любую картинку увидеть в этом месте но такого чудовищного разврата я via в google одно слово эзотерика увидеть не ожидал года на картинка меня заинтересовала я значит пошел разбираться чуть такое ты внезапно выяснилось что там в доме не целый стэнфорд и не просто stent for the компьютер сайнс факультет у них тоже есть курс какой-то не удивительно но в стэнфорде тоже есть курс по структурам данных у них там оказывается одна из лекций было натуральное заглавной эзотерические структура не так правда подробно рассказывали 2 поглядев внутри этой самой структуры я тоже дополнительно удивился потому что первые же структуры там был банальный блум фильтр здесь вот как меня просили не вставать мимо выставлять мне мальски которые старше чем вся аудитория но слишком поздно я не успел слайда сметь поэтому но моя эмоция была стандартной совершенно не удивительно что блум фильтр эзотерическая структура в стэнфорде но но не мне ладно как быстро он может это был курс для первокурсников опять же я надеюсь что все знаю еще такое блум фильтр вот в самое время заорать вау если не знаю эбу что-нибудь типа того тем не менее для тех двух человек которые может быть не знают из целью разминки они там тренировки нашего чек-листа там тем не менее пробежимся прикладные вопросы напой чёртов блум фильтр этот нужен я слышал эти слова много раз что не понимаю зачем у вот за этим у нас есть какое-то множество объектов допустим то причем большое тип там или upon объектов или 10 миллионов элиста ну или хотя бы 1000 этого тоже иногда хватает мы хотим уметь быстро быстро проверять если в этом множестве какой-то объект мы хотим тратить на это очень мало памяти и не перебирать ни в коем случае естественно линейным перебором все наш удобно и множество объектов user которых всего три тысячи но каждое из которых 15 килобайт и процедура сравнения каждого с каждого занимает 17 миллисекунд и в среднем едва походов за 7 дней микро сервис и одновременно с этим эту проверку мы готовы делать немного неточно то есть проверка иногда врет как 3 черепаха вот так 98 процентах случаев она честно говорит что объекты есть и иногда ошибается на этот предмет но кстати про то что объекты нет она никогда не врет вот собственно блант виктор такая интересная маленькая черная коробочка которая вам уверенно говорит что объекта точно нет вот точно нет клянусь нет а то что объект есть в этой коробочке она может подобрать немного его что то что насильно более компактная чем собственно исходные данные неожиданно вся эта эзотерическая структур структура и черная к лору коробочка делается вот так зачем я значит начался bitmap и оказывается неожиданно для себя не зря для того чтобы добавить объект в черную коробочку мы возводим 2 бита в bitmap и для того какие то случай псевдослучайные которые выбираем в данном примере двумя хэш функциями в реальной жизни может быть битов не тысяча двадцать тысяч на условно говоря там 20 умножить х функции может быть не 2 a7 это непринципиально скетч вот такой тоже будет работать хорошо поверьте я пробую у меня будем фильтр размером в 32 бит и местами работает с двумя как раз крыш функциями работает хорошо черная коробочка крохотная черная коробочка размером в 1 кило бить 128 байт которая позволяет нам вот ну быстро уверенно сказать что объекта среди наших там скольки то тысяч объектов нет возможно интересная историческая структура если вам когда нет такой понадобится я повторюсь надеюсь что все про нее слышали закрепим немножко checklist почему работает работает она потому что как даже когда ты не втыкал достаточно большое количество бит в этот фильтр если ты на втыкал 100 объектов рандомно так сто раз выстрелил ну поскольку 2 хэш-функции 200 раз выстрелил в а тысячу 24-битный bitmap шансы попасть прям все запомнить они достаточно малы но он не точный он может ошибиться в files позитив за есть фолз позитивы есть и на кой черт ему надо ну вот надо она по большому счету для того чтобы делать супер компактно крохотная черная коробочка и супер быстро без сравнения объекта юзеры 2 micro сервисов проверку на наличие опять таким он и некоторые уже засыпают потому что все и так знают вот неожиданно неожиданным кроме бром блум фильтра есть ещё более интересные исторические структуры которую дали улучшит у результату вот это уже надеюсь будут интересны так кажется это все я уже заранее рассказал кто-то меня вырубил микрофон они нормально к сорт фильтр оказывается человечество придумало причем буквально год назад способ сделать немножко лучше чем блум фильтр и например на значит не сказать чтобы сильно сложнее что если у нас данные меняются редко прям инкрементальный обновлять их на лету не надо вот эту вот проверку на наличие объекта данные относительно статически типа есть там 10 миллионов статических объектов и на все следующие 10000 мы можем позволить себе не на каждый 1 в летающий объект фильтр строить а там раз в десять тысяч оказывается есть прикольная структурка которая там на 15 процентов меньше памяти жрет что может оказаться важным которое на 25 процентов быстрее работает но вот пло плоха тем что генерируется медленно и по одному объекту за раз мне втыкать нельзя выглядит вот так ходовые характеристики красивые графики вот там можно их внимательно изучать код выглядит вот так например для ford фильтра на сотню элементов неожиданное название данная структура в детали повторюсь смысла лезть нет как это чудо техники работает чудо техники работает следующим образом мы каждый объект finger принцем каким хорошим а далее подбираем три волшебных хэша так чтобы размазанные случайные значения в кавычках случайной на самом деле в муках подбираемые по нашей табличке 3 в каких-то слата значения провалившейся вместе далее fingerprint объекта абсолютно безумная идея но тем не менее зараза работает после этого проверка насчет того есть объект в нашем множестве или нет выглядит вот ровно вот так и что важно по сравнению фильтром оно никогда не меняется те из вас кто значит знает проблемам фильтры знают что там бывает всеми хэш-функции например они или там 10 здесь всегда 3 строится она относительно медленнее там большие просто не а кода слава богу просто не ухода есть где взять есть узнать деткам репозитории куда известный канадский профессор дэниэл оливер значит реализации чуть меньшим для всех языков на планете присунул вот можно взять использовать как некое такое почти дроп--ин замену для блум фильтров довольно интересная историческая структура последнее что осталось отметить быстрые так так меньше вычислений там всегда ровно три хэш-функции 2к ссора но как бы нам даже в самый простенький блум фильтра зачастую больше считать работает это потому чтобы дать вот хэш-функции на самом деле параметр функции ловко подбираются продолжаем по вероятностным структурам вот таким скажем так я понимаю что прошлом году доклад был но пару штук из них не было из вероятность тот структур моя любимая конечно опять таки надеюсь что все знают но рассчитываем на то что знают не все мой любимый идти дайджест на кой черт нужна структура под названием ти дайджесты чтобы это такое могло быть ни md5 зачем надо предположим что есть у нас какой-то поток событий например льем основность темпом 10000 рпс какие-то запросе и хотим считать квантили trading software давайте предположим что нам в будущем может потребоваться посчитать can квантиль номер 87 как бы это сделать понятное дело что если мы считаем 10 тысяч жильем 10000р ps а сохраняем данные за последние 900 секунд хотя бы данных у нас получается достаточно много просто сохранить сырые данные лопатить все эти данные неохотно неохота совершенно мы можем сохранить не все мы можем их считать ее уникальные light in se например сохранять типа вот у нас там из не знаю 10 миллионов отсчетов 1 миллион одна миллисекунда 2 миллиона две миллисекунды так далее какой-то длинный хвост где было четыре 1237 миллисекунд понятное дело что распределение этих не обязательно light in se это могут быть какие-то еще отсчет и распределение этих измерений это вот какая только под графиком произвольно взятых функции распределения линиями я линии можно игнорировать это просто значит какие-то приблизительно прыгают приближающие некое реальное и некое распределение из реальной жизни гипотетические модели с двумя параметрами идея смотрим на это распределение в нем друг говоря будут такие плату ровные ровные будут места со всякими со всякой дорожки и так далее там в нем будут интересные точки что если график вот этот вот мы представим такой как будто бы как бы ломаной на самом деле не совсем ломаной ну как будто как бы ломаный где будем сохранять только интересные точки скажем так какой у них x какая такая у нас была скорость что у нас вокруг конкретно light in se 1 . 2 3 тысячи 200 миллисекунд потому что именно там у вас какие-то таймауту начинает срабатывать начинается какая-то интересная движуха а до этого просто вот палата с нулем таких request of которые там от 300 миллисекунд до 1200 нету вообще вот как раз интересные точки сохраняемые что-то описывающие это интересные точки данные устроены настолько просто так вот это вот эти дайджесте то есть тот интересная точка называется центроидом такая у них мифологии терминология описывается она натурально неким весом радиусом и не той позиции и магическим образом оказывается что если написать две функции по 100 строк которые обновляют вектор центроидом то неожиданно вот этой вот структура хватает для того чтобы практически идеально точно считать квантили распределения и рассказывает что-то типа там p99 по потоку там в 10 миллионов запросов за последние 15 минут у нас был вот такой по 75 вот такой это дтп очень клёво опять-таки структура когда надо по точным образом как-то вот это распределение об кашлять понятное дело что это бача так далее нет никакой человеческой возможности здесь показать поэтому так вот концептуальной идее почему работают повторюсь мы как будто охраняем график распределения в некой супер зажатой формы форме представляя его двумястами интересными точками так называемыми центроида my и конечно же батчер батчер батчер потому что ну нет никакой человеческие возможности обновлять вот это все дело каждый раз пересчитывать эти долбанные центроида не совсем тривиальной математикой как когда нам пришел новый отсчет как обычно есть каноничный лорэйн это турель слава богу каноничный там есть реализации для java си плюс плюс основная помню для java для кошечка и так далее тоже есть слава богу они длинные поэтому слава богу я их на слайд не вонзил спим дальше еще одна вероятностная структура здесь наверное имеет смысл быстро-быстро гипер лоб в лоб сколько два года назад она была математика очень красиво и обсуждать и будем в кулуарах не будем обсуждать вообще чуть такое опять поток нам его нам влетает допустим там не не знаю не 10 миллионов олей tense запросов за последние 15 минут а миллиард чего-нибудь чего угодно миллиард строчек из базы данных миллиард доменов и защите типе запросов мини миллиард уникальных айпи адресов в каком-нибудь клиентском свече или миллиард по рф а и b порта ip и порт в какой-нибудь соответственно fair воли вот гигантский поток чего чего то там мы с той или иной целью хотим значит в этом потоке устраивать некую под оценку кардинально sti примерным образом считать approximate county steam в терминах всем понятного исходе лета был бы к вам действием а тут вот значит примеры и не сильно ошибающийся вот есть магическая структура под подробности на подробности времени тут подсказывают уже не теоретических никаких вообще нет который устроено вот настолько просто делают держим грубо говоря там сколько получается там 64 и 128 может быть тысячу ин-тов и легкой значит магия без единого умножения и деления что-то там делает значит математику повторюсь готов тем кто кому сильно интересно объяснить есть объяснение возможно даже еще лучше с парирован хайло до 2019 года так что постоянно плечах предыдущих что интересно считалка которая потом говорит одну окей вот ты влил вот в эту структуру миллиард каких тут блин объектов там импов строчек и т.д. и т.п. а что получилось сейчас будет вот такая простыня который будет магически считать сколько там было уникальных нет оказывается значит мама могучая мат модель и результат тоже считает в три строчки то что виртуозно значит структур огонь и не зря уже мертвая девушка профессор флажолет как бы примерно половину жизни этими структурами занимался где под почему работает потому что математика могу объяснить немного но там довольно зубодробительный в оригинальных статьях и был хороший доклад который кажется треть доклада на эту только штуку слил точности ей может не хватить я пытался найти скриншот который видел в пол в ходе гоблин да не нашел но важно понимать что эта шляпа супер эффективной она там в 2 килобайта может вам 10 газов обсчитать или 300 дебеза фак считать в летающих данных но может absorbica уже во втором разряде типа у вас точный ответ 6 . 600 15 миллионов уникальных доменов она вам скажет что их было шесть . 640 3 миллиона уникальных доменов вот если вам настолько большая точность важно то как бы надо с гипер логом бороться возможно там число регистров увеличивать или все-таки считать как-то не так к несчастью коробочки не нашел поэтому ответ на вопрос где взять опять с перевернутым котиком вот фигня кота это вот видимо достаточно кастомные всегда реализация и встроенные в тот или иной код микро сервис база что угодно еще моему глубокому сожалению этого мы как будет меня вот сбило с панталыку 1 структура данных которую я у стэнфорда увидел бы пробуем фильтры вероятностные структуры и тут значит мыслить заработал у них там было еще 2 и она тоже пора делая процесс мышления это плохо 2 структура была skip лист при этом подозреваю что многие слышали что он существует но никто не знает как он устроить честно говоря я тоже и он довольно контура интуитивно устроили я постоянно забываю при этом ски блист очень очень похож на обычный тот же самый в терминах си плюс плюс std map это такой как бы и не список и не массив и не дерево носа там какими-то приблизительными ходовыми характеристиками которые но там местами как вставки почти как в список поиски почти как в массив опять таки немного по мусолить или логарифмы если хочется можно будет в кулуарах основная идея такая что супер быстрые вставки и удаления у нас в сортир о ваном списке бывают но когда нам нужны быстрые вставки удаления поиска быстрого в сортир овнам списке конец потому что нету доступа нормального поэтому на полях него строить какую-то структуру вот с дополнительными слоями которые позволят быстро быстро мотаться если мы эту структуру будем подчисток устроить прореживать пополам каждый уровень прям по чесноку у нас получатся бренд банально и собственно как и раз бинарное дерево и никакого жира в этом нет где профит профит оказывается в том что если строить эту структуру рандомно нечестно а рандомно грубо говоря рандомно стреляя в каждой достаточно длинный список на низком уровне то неожиданно получается почти бинарное дерево которое немного лучше балансируется реализации довольно сложный и отдам в под я даже не полез на кой черт он нужен я почти не знаю однако местами оказывается что именно skip листы в отличие от долбанных деревьев очень очень хорошо ложатся на ситуацию когда у тебя много я der и неожиданно вот согласно значит цитате из возмущенной библиотечки фоли по сравнению с прикрытым спину лаком достаточно быстром стс этом на достаточно большом количестве объектов вот этот вот контейнер вот этот самый ски плеснуть неожиданно в десять раз быстрее сам не benchmark у потому что ленивый я думаю это хорошая тема для доклада на хайло 2022 эзотерическая структура эзотерическая нужно для какого-то странного случая когда конкурентной up in memory что это блин такое я попытался подумать что это был блин такое и меня наконец праве в этот момент меня пробило пацаны skip листы и немногочисленные дамы skip листы и бинарные деревья и все остальные сорта деревьев которые ну наверно тоже для кого-то эзотерические поэтому спойлер там дальше немножко обтачивать это блин так называемые индексы группа так называемых индексных структур чуть такое идеальным индексом с моей точки зрения конечно является хэш таблица 1 lookup и все готово теперь я стар и просто от идеализированной пошли и взяли значения или поняли что его нет хеш-таблица идеал однако от так называемого индекса может требоваться еще всякое это не только и вылью хранилище в котором надо быстро быстро по ключу что-то искать это еще и поиск по диапазону какому-то а возможно и полный перебор всего индекса и в сортир а нам порядке вот если за собственную группа индексных структур которые std map и step листы трой деревья б деревья lsm и так далее у меня как бы есть понятное дело по два слайда на каждый ног несчастье у меня также к этому есть две минуты поэтому видимо надо их либо в режиме fast forward либо сразу переходить к окончанию доклада и вот отвечать на вопросы все же знают что такое трайб деревья и lsm его там буйвол но как бы бу что был переходи к концу доклада давай ядрёна вошь ладно понятно ясно у меня есть одна минута на то чтобы описать 3 структуру данных я попытаюсь уложиться трой что такое трой кей вилью индексы но естественно с некоторым особым балансом чем хороши их реально просто написать руками любой даже и может написать их не строчек за 50 и там за часок другой может быть 100 и неожиданно они крайне хорошо по производительности на некоторых своих задачах основная идея простая значит вместо того чтобы делать бинарное дерево которое ветвится к раву мы ветвиться начинаем с мало например красивый пример че делаем частотные словари условной и делаем в нем 26 детишек по каждой букве алфавита есть еще одна идея про суффикс на и троит scopus уровне дерева но тут уже нет никакой человеческое возможностей от обсуждать выглядеть эт может в коде примерно вот так дескать один вариант номер один когда у нас на каждом уровне есть значение на этом уровне которой мы храним для префикса который мы по этому дереву прошли и 26 указателей вглубь или когда у нас есть 26 указателей в глубь для тех самых очередных символов в очередной строчки и двадцать шесть значений ассоциированных с тем префиксом по которому пришли к этому значению или вместо этих префиксов в явном виде мы можем виктора храните отдельно хранить виктора которые указывают в глубь на очередной элемент это если у нас алфавит не двадцать шесть значений а 1024 отдельно сами значение или мы можем например всегда вместо 26 написать 16 сказать наш ключ какой бы он ни был эта гигантская бинарная строка мы режем ее по четыре бита и на каждом уровне вид whimsy 16 раз или вариантов реализации краев довольно много подозревают ровно поэтому на опять-таки коробочки хороший я не нашел чем плохо память жрут просто как из пушки и правильные хэши в любом кажется что в любом случае еще быстрее но если их лишь они достаточно и нужны рыныч поиске яндекс не хэш не туники и велю яндекс не только кей volga табличка то вот трой может сработать b дерево возводим идею под названием трой в абсолют и вместо того чтобы ветвиться 16 раз вид winsett не знаю тысячу раз две тысячи раз на сколько дискового кластер охватит основная идея у нас есть некие внешние сторож куда мы ходим за страничками там некие кластера фиксированного объема ля ля ля zhu zhu zhu ну рассказывать про оба деревья вообще глупые банальная надеюсь все знают поэтому просто захотел показать пару строчек кода господа и дамы этого достаточно чтобы начать делать свое собственное бы дерево вот у вас страничке размером примерно по 8 килобайт которые хранят 3113 и больные ключи но чтобы константа было красиво не привлекала внимание на страничку с данными можно впихнуть там 481 значения в этом дереве на страничку с детишками 389 указательный в глубь ну в общем все достаточно стандартно ни в коем случае не пишите свое собственное дерево это такой геморрой что не передать словами одновременно с этим напишите свою когда-нибудь от для лулзов за выходные вот такой вот игрушечная бы дерево чисто поиграться чтобы понять что ни в коем случае не надо писать боевое бы дерева надо взять либо bdb или был mdb либо гугловскую библиотеку что угодно еще структура вроде бы простая но к несчастью там очень много тонкостей в реализации слава богу наконец-то хоть в одной из исторических структур у меня много готовых open source ных реализаций и которой можно успешно нагуглить и взять на этом наверное надо объявить войну всему сущему как b&g подарков и соответственно 2 деревьев перейти к л с сэмом которые неожиданно опять-таки рассказывают что живут на таком же уровне и совершенно не корректный но надеюсь сводят все вместе опять келью индексы опять особый баланс много вставок относительно мало чтения не перекошены в записи грубо говоря и лысым и работают хорошо когда у вас там много записей я читаете в этом не знаю один раз в этом один процент 10 процентов а так далее наверное на таком уровне опять же очень надеюсь что я уже эзотерики и вернулся обратно некоторые наркоманской и это знают все основная идея почему это работает мы накапливаем просто небольшой буферов в памяти дальше его сортируем дальше отсортированные буфер кесли вами вместе и подменяем произвольный доступ случайным местам памяти диска кыша чего угодно как со всеми предыдущими деревьями до достаточно быстрыми линейными операциями под на слайде ему полётное время минус 2 минуты играем но вот соответственно нет никакой человеческие возможности объяснять ноутбук у меня слава богу с собой сталкиваемся в коридоре неожиданно что здесь интересно на мой взгляд вот смотрите царя нажал не ту кнопку смотрите сорта дыры и появляются те самые долбанные возможно акацки плести которой конкор ring for the delay очень быстро и смотрите bitmap и появляются а может быть spore set и смотрите появляются было у фильтры хор фильтры и так далее и неожиданно productions скажем так у production левел занятная структура для хранения нам и занятная индекс неожиданно включает в себя всю самую так называемую эзотерику которую мы супер вкратце по верхам пробежали она прикладное она используется ура ура не все возможно зря все связано все эти волшебные эзотерические структуры местами чуть ли не половину из них используется ровно иногда в одном месте место это конечно же за нас реализовали facebook и google есть реализацию фейсбука есть реализация в угла можно их братик смотреть свои описать явно не надо это уже видно по скетчем и у всех остальных структур скетчи были на один слайд тут на 2 это мне кажется сигнал что писать такую структуру руками не надо и еще сильно рекомендую почитать статьи про винил таран томске они прямо прекрасно написаны очень все значит интересно поскольку я рассчитывал что меня прервут но этого не происходит это мета маркер мне надо нажать волшебную кнопку на клавиатуре ноутбука и время разворачивается теперь я начинаю жать кнопку назад это еще не совсем конец конец вот удивительно но мы пробежались верха но тем ни менее пробежались по десятку каких-то безумных структур я уверен что штук пять из них вы знаете для всех вас это разные 5 штук кто-то знает что такое bitmap ну не знал про существование гипер logo logo и наоборот круиз на праге пирло блок а вот bitmap голову не приходил эти 10 структура решают несколько разных задач диск индекс танкан from индекс георгин эти эстимейт и так далее и тому подобное это довольно странные редкие задачи тем не менее они вполне вполне прикладные они в жизни ну появляются и их 5-6 разных сортов смотря как мы засчитываем вот эти вот пять разных сортов индексов потому что с одной стороны трой lsm и и так далее но все это индекс решаем одну задачу тем не менее вот видите в баню и в жизни они эти задачи организации индексов память или на диске или решаются с местами использованием некой прикладной эзотерики нечасто и странные но очень прикладные задачи чищу прикладного у нас осталось в мире ничего но вот из матрицы уже поступает звонок нет ни частные структуры данных не часто встречающиеся в бою алгоритмы и просто turbo реализации типа sing джисона он вот есть время никто не пользуется понятное дело что человечество постоянно развивается и и путь наш бесконечен эзотерического осталось еще больше чудовищный список абсолютный эзотерических структур который слава богу нахрен никому не нужны не рекомендую туда ходить потому что там демону зашквар а как только вы как вот начнете упарываться в там в странные эзотерические текстуры структуры типа wife and tries to практическое применение у вас а отломится очень быстро а теоретические вопросы начнут волновать очень сильно у вас воспалиться и опухнет кандидатская диссертация а потом возможно докторской вы будете потерянным для жизни человеком и у вас от растет борода не надо так так не надо мы все-таки за прикладную эзотерику в чем суть непонятного хаотичного доклада вот есть жизнь за забором мы живем за забором в котором 99 процентов риме написано вектор кэш и возможно лист или у некоторых мы вот это вот третье троица в третий компонент святой троицы постоянно меняется за этот забор мы одним глазом заглянули там десяток разных структур напиток разных задач обратите внимание скетч и все были несложные в исключением его сивов грубо говоря по одной страничке и по 3 и по три строчки на ключевой метод они довольно несложные их можно написать самостоятельно если вдруг понадобится я надеюсь что у вас хотя бы небольшое понимание какие бывают наркоманские задачи как их можно оказывается решать сформировалась и случае чего вы вспомните какое-то полезное ключевое слово возможно это вам точно не потребуется никогда его не услышали для себя ни одной новой идеи и даже мелкой половинки новой клевые идеи это очень хорошо поэтому потому что в этот момент highload меня перерос и можно уходить на пенсию совершенно смело вот и я как бы ему ну чтож нес все это время какой-то совершенно непонятную дичь но честно говоря этого мы и ожидали теперь вопросы спасибо андрей настоящий эзотерика к сожалею на вопросы времени остается моих переносим дискуссионный зал и там собственно разыграем книгу по отвечая на вопросы поэтому благодарим за доклад спасибо"
}