{
  "video_id": "nVz-DZoVBms",
  "channel": "HighLoadChannel",
  "title": "Ставьте лайки, подписывайтесь на GraphQL / Айк Саргсян (Юла)",
  "views": 1248,
  "duration": 2768,
  "published": "2020-04-14T11:21:48-07:00",
  "text": "всем привет меня зовут tyc я технический директор проекта юла сегодня буду рассказывать про подписки в коробке или почему-то сообществом очень обделена вниманием именно sap скрип шины все очень часто обсуждают дата кладах там именно граф kiel и когда дело доходит до subscription на все забывают или доклад заканчивается и решили этот пробел все-таки заполнить и рассказать как подписки это круто это хорошо и как их можно использовать свои же проектах начала расскажу я зилы и расскажу что такое юла юла это сервис объявление классе fo20 что означает красивой 20 что мы решаем не только обычные вопросы и онлайн и пользователя решаем все вопросы 360 и онлайн и оффлайн тут хватит и доставка и безопасной сделки и все остальное вот сейчас юлия больше тридцати двух миллионов активных товаров объявлением у нас больше 27 миллионов активных пользователей в месяц количество уже не посчитал но точные миллиарды документов в базе кстати используем где бим и терабайт данных в минуту например в кафку выливается несколько миллионов событий вот и все это работало на протоколе rest что произошло было был создан четыре года назад на тот момент при старте ну любой стартап очень легко начинать средства ну и развиваться с ним мы сделали как и все взяли rest взяли обычный пахота и начали развиваться развивались быстро и наш вес постепенно rose rose рост api стал огромным вот и пришло время подумать что делать с ним какие проблемы у нас были рис стал большим и неповоротливым у нас были там десятки контроллеров сотни экшенов и получилась структура данных не консистентная между собой где-то нужно отдавать простой объект это нужно а без тот же самый объект с дополнительными полями и так далее для сложных приложений невозможно поддержать части арест что произошло мы наверное вы все при использовании реста доходит до момента когда нужно правил aristo нарушится not озираясь превращается немножко в рпц начинаем делать просто запросы мы говорим это у нас растопи но с исключениями мы тоже дошли до такого рейс всегда подразумевает лишь тебе под себя что это означает его не возможно именно из коробки так сказать использовать для других типов соединений например websocket и или что то еще сервер пушек нет встроенной поддержки real-time клиент-серверного взаимодействия мы все знаем что сейчас активно все идет real-time это так сказать это наше будущее и все идут вариантом сервиса а в так как рис был придуман еще 20 лет назад на тот момент никто особо не думал что протоколе предусмотреть такое взаимодействие вот посмотрим на пример да у нас есть главная страница одно приложение юлы она состоит из множества частей и чтобы его получить парочку нам нужно сделать давайте вместе посчитаем сколько запросов первое конечно же это профиль пользователя и счетчики уведомления второе у нас есть подборки товаров и и баннеры третье у нас здесь torres ну после того как экзо и стрелы stories решили что нам пора тоже делать stories четвертое это горизонтальные карусели товаров тут идут к товары по рекомендации просмотренные товары и так далее и основная лента объявление и есть рекламные объявления есть обычные объявления от пользователей то есть по сути чтобы сгенерированную главную страницу нам нужно сделать минимум 5 rest запросов это как минимум из них если один из них не пришел не ответил так ленский weeks ну и заберите будет не очень удобно им нужно загрузить слайдеры показывать а мы идем максимально быстро стартовать секса сторону максимально быстро стартовать приложения и чтобы пользователь дошел до interactive ну за считанные секунды да можно было это все соединить в один запрос но представьте вот это разношерстный данных соединить в один вопрос это можно сделать все можно сделать за разработки но мы подумали что это не та нужны тут подумать и решить посмотрели разные варианты внедрения протоколов что есть какие варианты чосон и рпц и что то еще что то еще и остановились на крафтил вот давайте еще я пример покажу почему наши rest api стал таким тяжелым вот у нас страница товара она из себя представляет данный про товар данные про доставку бы драная где находится этот товар представьте этот весь это вся страница грузится одним запросом одним рисковым запросам условно продукт слэш идентификатор 1 and point вопи отвечает за огромное количество разных сервисов которые должны отдавать данные сюда при когда у вас монолит у нас тоже был основной монолит это легко реализовать но как только приходит время разделить все на отдельные реально отдельные сервисы возникают проблемы вот например посмотрите в нашем g sony и вот целое чтобы просто маленький блог пользователя показать автора объявления нужно у него знать он вал они не было никакой у него рейтинг и все это приходится вместе с товаром вот крафтил мы решили что что делать странице большие объекты большие все нужно грузить но еще и разделить сущности от друг друга чтобы они независимы работали но и очевидное решение пришел к нкр of hell коротко кто использует графики в продакшене не так много рук наверное я немножко скажу что такое граф kill kraft ел это в каире manipulation ленгвич почему тут на этом слайде на английском написал оказывается википедии не эту на русском стать на русском языке статья про граф kiel так что у вас есть шанс быть в истории написать я думаю до конца доклад а успейте собственная городке предложен был фейсбуком вот они на разогревай тут пыли и собственно 2015 году был предложен из каких частей состоит граф hell это куэрри тут запрос данных он эквивалентен get запросу христе это мутации ну создание удаление редактирования все что примерно эквивалентен от подстилается опросам в листе и подписки с об скрип шины в листе эквивалента к сожалению нет краб хелсов крип шины для чего они именно нам были полезны очень много статей и его бреев там в иностранных ресурсах про саму граф hell поэтому мы сейчас не будем говорить про общие + игра в тело скажем почему мы выбрали кировке конечно же это строго схемы я как сказал ранее что в листе у нас появился очень много int поинтов очень много вариации одного и того же объекта и структура была совершенно не консистентная это было проблемой и для клиентских разработчиков это было проблемой для нас по kinder сама документация самого лидирования мы все знаем что в рез-те чтобы документировать api нам нужен подключить но понапе swagger что-то придумать граф пел сам по себе уже сама документирован и конечно же валидация это приходит от строгости схемы если у нас и строгой схемы мы с лёгкостью можем его провале тировать и на стороне клиента и на стороне сервера чистый код викенда и клиента так как граф kill подразумевает графа вую модель там каждый объект имеет свой тип и отдельно и резолвится отдельными функциями и поэтому любые объекты отвечает одна зона ответственности нету такого универсального endpoint а который возвращает все и конечно же это позволяет нам оптимизировать ресурсы бэг-энда если клиентская часть меняет в интерфейсе что-то условно у нас есть android ios веб и еще айфрейм внутри одноклассника в виде спа приложения собственно каждому клиенту один тот же товар нужен с разным набором полей android и одно из учусь другое в экран большой помещается еще больше информации и нужно крутить что-то еще данном случае боккен сделает всего лишь все сущности клиенты на этих сущностях уже рисуют любое к лицу комбинировать эти ресурсы в любой интерфейса ну и решают вопросы да когда интерфейс я показал вам интерфейс продукта интерфейс главной странице которые они сложны и сами по себе и в один запрос ну никак не совместить вот еще крафтил минимизирует количество запросов от клиентов боккен ту дает нам возможность несколько запросов соединить в одно на это во христе и придумывали разные решения условные на викенде делали универсальные batch методы чтобы клиент мог сразу несколько запросов в один htp добавить и так далее в графе ли это из коробки уже сделано ну возможность комбинировать разных типов объектов в одном ответит это тоже очень удобно что дальше скажу что можно сделать интерфейс и можно сделать unions и возвращать по сути разнотипные объекты если вернемся к главному экрану нашего там есть лента новостей лента товаров которые по сути не только объекты товаров там находится продвигаемые объявление там находится даже сторонние рекламные баннеры и все в общей структуре отдать в листе как-то странно в графе теле есть соответствующие интерфейс и структуры ну и оттуда же интерфейс и union и позволяют нам делать всякие полиморфных списке и еще один плюсом ну все наверное не знаю делают причина ту стандартно до плеч лимит не все но в graph келли уже из из парадигмы приходит к тому что лучше используйте курсор и я думаю в динамически в ленте где динамически добавляются товары у нас товар индексируются каждую секунду то есть добавили товар он максимально быстро появляется ленте и если сделать презентацию то пользователь если вдруг на одной пачки застряли там условные там несколько секунд хуже при прокрутке какие-то товары про пропустит поэтому мы активно за использование курсоров какие сложности мы столкнулись при использовании не всегда удобно графова я структура данных то есть есть некоторые сервисы которые они простые им нужно реально всего лишь ответить там четырьмя полями на один запрос не знаю линейная как котировки вот мы запросим сервер сказали до нее курс доллара и вернул всего лишь маленький объект тут использовать графу графа структуру граф кирилл но я думаю неэффективно будет вот представьте вот граф kill все все типы описываются в одном файле можно их разделить но сам не подразумевать такое и получился с так что этот граф кирилл файл в котором все наши тебе объявлены он стал огромным и неповоротливым файлом которым ну представьте всех разработчиков которые все классы своей в один файл пишет но пока с этим живем есть решение конечно но неудобства вот и граф келли невозможно использовать вот в месте мы все привыкли что уж теперь вклады очень подходит для возвращения ошибок до вернули там какие-то вариации 500 и ходов какие-то вариации 400 их кодов и клиента завязывается на конкретные коды делают понимает какого ошибка получили к сожалению граф келли невозможно это сделать потому что основной если сервер не упал то ответ вести ошибкам должно быть уже в самом ответе вот ну представьте также очень сложно делать мониторингу рафтель и потому что по сути все запросы разношерстные попадают в один тот же and point и они буквально могут отличаться другу хоть одним полем хочет чем-то другим но запрос от этого может быть совершенно другим и мониторить это сложнее чем листовая вот и конечно же нету встроенной в протоколу методологии функциональности загрузки файлов и и файлы приходится грузит стандартным методом мурланд старательность и теперь постом потом использовать eotech ник ну и все наверное это сказали у нас та же самые проблемы это сложности широнин кешировать граф эл респ понятен киш можно спокойно на каждый infant поставить свои заголовки кошерные промежуточное кеширования в графике или такое не получится ну почему для нас это небольшая проблема была у нас основная все restore и а ты очень много персонализации приложений и вот именно кеширование ответа почти нигде нету мотивируем на другом уровне внутри слоя которые безусловно занимается почему выбрали игра в пил subscriptions ну крафтил поняли что все хорошо а нам нужно травкой subscriptions и принять представьте травки asap слышен это единый протокол вместе с граф телом то есть нам не нужно придумывать что-то еще чтобы в real time взаимодействие использовать некий отдельный протокол вопи где обычный request response использовать что-то другое поэтому это нам дало очень большое удобство ну представьте у нас были там real-time сервисе условно самой банальной это читай и в чатах используется свой протокол африку и срез после совершенно другие объекты которые возвращают общая схема это не представляете как облегчает жизнь разработчиков когда и в реал тайме в обычном request response я есть общие схемы данных один раз против они ли есть такой объект он существует и там и там очень удобно вот перри использование револьверов коротко что такое резольвер это граф келли функция который принимает на вход если на пальцах кусочек данных кусочек запроса и идет за этим типом то есть у каждого типа которые есть свой резон вирши пишется это дает возможность масштабировать внутрь его видно любое field или сам тип объект ли золото отдельной функции и переиспользовать резольвер происходит и were и в graph kiel обычных запросах и в sap скрип шинах это тоже очень удобно и конечно же обеспечение real-time взаимодействовать клиент-сервер посредством в пакетов по дефолту граф кейл подразумевают вот все мануалы и клиентские библиотеки тогда лист посмотрите они все подразумевают websocket но я хочу тут уточнить что не обязательно используем то есть протокол сам никак ничего не обязывает можно использовать сервер тушь можно хоть lomb пулы использовать все что угодно это зависит просто внедрение от разработчиков но есть один нюанс подписки они стив по сути состояния подписки нужно где-то на сервере держать это можно держать не знаю в памяти самого сервера который принимает запросы это можно еще и перенести на какой-то и шуру ющий слой но так как мы серверы серверы будем посылать данные клиенту то обязательно нужно иметь состояние для каких компонентов мы используем ну я еще раз самые банальные точат и самое интересное которая нам очень помогло это внутреннее уведомление в приложениях передачи расскажешь про что это обновление счетчиков да кто-то посмотрел ваш товар вы на этой ленте счетчик автоматически обновился вы обрадовались ваш товар тут еще посмотрел уведомление о сделках и и покупателях вот есть товары покупатель нажал купить именно в этот момент продавец своем цвета интерфейсе видят о ваш товар хотят купить прямо сейчас даже если он не сидит и не обновляет свой дашборд чтобы посмотреть купили товар или нет стартовые попапы программы лояльности получение бонусов я выделил это от всех и на об уведомлений потому что речь дальше пойдёт именно про них вот то есть у нас во время старта приложения нужно каждый тем пользователь предлагать с некие бонусы и для этого мы использовать схему которая не очень подходило для этого ну это были ограничения реста об этом чуть дальше вот например у нас есть разные типы уведомлений ада после публикации товара мы предлагаем купить какие-то вас и ну дополнительные услуги и типа продвижения товара поднятие в ленте и так далее или есть после публикации товара мы говорим вы можете получить еще кэшбэк у нас есть еще кэшбэк с продаж можете использовать очень удобно и можете получить кэшбэк виде бонусов бонуса это такая внутренняя валюта которая программе лояльности можно получить и ими можно оплатить не внутренние услуги ты же продвижения и так далее и бонусами можно еще например от партнеров купить промокоды что в итоге мы выбрали sap скрип шины и мы поняли что это хорошо мы все наши кейсы покрывают как делается архитектуру под них начнем с экрана бонусов вот у нас есть экран получения бонусов про который я говорил сейчас более детально он должен отобразиться один раз в день при старте приложения то есть каждый день не важно если это первый сайт на в течение этого дня мы должны пользователей показать кубоп что нам нужно делать нам нужно при старте приложения как-то клиенту нужно узнать нужно ли и пользователю показывать pop-up у этого есть условно два решения либо при старте приложения когда он идет на сервер за общим конфигом некий им флагом сказать что шоу pop up равняется true и он поймет что пора показывать папа пользователю или наоборот каждый раз когда стартует приложение после получения конфига еще и запросить этот and point а нужно ли мне показывать папа пользователю получения бонусов вдруг он сегодня уже получил это классическая проблема как называется а верфи cinque андер fetching очень похоже на это когда в рез-те все время сталкиваемся с такими вариантами андер fitch ники когда когда мы не даем нужное количество объема данных клиентов и клиенту приходится делать дополнительные запросы о верфь очень когда мы слишком много данных возвращаем клиенту который по сути ему и не нужно на данный момент условно представьте приложения если ты из пуша пришел и хочет что-то купить тебе не надо было их восходить бонус сервисы что-то узнавать и мы начали с начали с простой архитектуры вот что сделали ну всем понятны если игроки начнете использовать мы используем гол для графа сервера вот голландии есть хорошие библиотеки chicken и на нем мы создали игра в твой крафтил битвы это тот как instance of летишь на который принимает графики и запросы там находится все резольвер это все функции которые каждый знает про свою часть и они потом уже идут всякие микро сервисы связь между граф перед вами микро сервисе может быть также любой можно использовать обычные степи можно использовать чей рпц но это на ваше усмотрение тут уже то чем 1 вот как происходит обычный запрос вот получение бонусов пришел клиент запрашивает граф пилки твой да не конфиг стартовый конфиг конфиг сервис понятно граф пел get ведет в конфиг сервис говорит вот пришел пользователь дальник конфиг для него конфиг сервис возвращает объект конфига потом действий еще и запрашивает бонус резольвер говорит а еще мне нужно сказать клиенту показывать pop-up или нет идет специальный сервис которая отвечает за начисления бонусов там трату и так далее и бонус сервис говорит либо дать пора ему показывать pop-up или нет нельзя показывать как мы видим тут схемы больше похоже на больше похоже на то что мы делали в листе то есть один запрос в ответе все возвращаем это по сути неудобно и считаем что это неправильно когда уже мы начали разделять на отдельные сервис и мы поняли что такой схемы можно жить но ненадолго и перешли к другой схеме более удобной внедрились подписки что это нам дало представьте запросто там кружочками указано пришел запрос на получение конфига gateway запрашивает сервис конфигурации и получает нужные данные где твой запрашивает сервис управления бонусами но уже ответ может спокойно отправиться обратно пользователь потому что в самом запросе конфига уже про бонусы ничего не надо передавать сервис управления бонусами отправляет в подписку информацию для отображения уведомлений опа опапа то есть что произошло старт приложения мы сделали обычный запрос вернулся конфиг чистый конфиг но еще и наш битвы и знает что вот нужно еще в бонус сервис хотите он и сервера отправить данные это можно такую схему использовать для любых внутренних уведомлений внутри приложения то это не обязательно наш бонус попал вы можете использовать для любого кейса что это нам дало это нам дало разделение обязательств между сервисами и нет связи между ним каждый сервер может развиваться по отдельности масштабироваться и так далее и эта схема позволяет через подписки именно нам в любой части приложения даже если вдруг так случился что пользователь запрашивает главную страницу потом ушел на что то другое но в подписке она обязательно получит что ему пора показывать папа папа бонусов и покажет не страшно если это уже будет другая экран вот это для нас было так удачно все разделили все по компоненту никто ни с кем не связан идеальная схема можем детей на конференциях палец и микро сервисной архитектурой что все разделено у нас все идеально но пришли к тому что один тот же сервисы глажки которая отвечает и на высоких connect и и на обычные request response и конфигурационной а он не очень хорошо подходит то есть у нас есть сын джеймс который по сути больше оптимизируем pad сессионной request response а когда у нас здесь websocket условно пользователь сессия там пять минут открыл приложение никуда не уходит что-то там ищет то пять минут connection высокие то остается но websocket connect и там условно там 4 килобайта наконец нужно сохранить тайм-аут и долгие и начали наш сервер а немножко затрудняться с ответом пришли к очередному задумал давайте подумаем а что делать дальше вот все разделили все рады нужным нам с подписками что-то делать они неудобны они убивают наши сервера которые могли бы не масштабировать сюда можно вот взять вот этот gateway и сделать его сотни раз повторить структур да ничего не изменится мы горизонтальном из масштабировались все рады но в горизонтальном масштабировании данном случае будут проблемы не будем использовать зря будем использовать ресурсы опять сели и подумали давайте сделаем другую схему показ уведомление через подписки уже разделяя подписки от обычного граф пела тотально немножко расскажу про эту схему что произошло мы взяли наш сервис и и тот же самый код по сути тот же самый код кит вы просто сделали их два отдельных сервиса один оптимизирован под websocket connect из обстракшены а другая часть оптимизированы максимально просвещенный request response и и каждый компонент сейчас может развиваться по отдельности то есть нам нужно обычной графики запросы масштабировать но берем обычный детский масштабирован вдруг мы понимаем что у нас все больше и больше было открытых websocket of появляется потому что хотя выпсуке multiplexer uid если один клиент делает несколько запросов в 1 socket попадут но все-таки если клиенты в онлайне очень много клиентов такое может быть при всяких массовых рассылки уведомлений да мы отправили пуше многим пользователям все одновременно зашли в онлайн и у всех открыл и socket connection request response of особо там не это один два раза сделали и все и а сейчас у нас сервера которые отвечают за именно подписки можно масштабировать по отдельности сколько угодно такое разделение ресурсов сделал по сути универсальную схему для нас которые можно масштабировать как удобно немножко детально про запрос как это у нас происходит опять таки клиент приходит с запросом get конфиг битвы запрашивать сервис конфигурации и получает данные если вы посмотрите это с правой стороны видно но после этого сервис конфигурации отправляет событий в шину данных что пришел пользователь запросил конфиг то есть став приложения по сути это для нас в шину данных пошло событие старт старт старте все пользователям бонус сервис конечно же это событие подхватывает и смотрит у себя там недрах а нужно ли показывать что-то этому пользователю ну если нужно и можно то давайте мы ответим ему так как у пользователя уже есть websocket connect то есть subscription открыть со стороны клиента еще и носовский action сервера мы точно знаем какому сервера этот пользователь подключен ну это просто сессии там можно записывать и хранить делить мы активно используем для попсовые для кеша редис кластера и еще и рекомендую всем посмотреть новые кризис выявил ряд с тремя очень интересное посмотрите вот ну и сервисы управления бонусами отправляет событий шину данных потом данные для отображения уведомления через websocket отправляется клиенту визуально тут кажется что схемы слишком большая но по сути он состоит всего лишь из там 2 micro сервисов 1 попса по очереди и еще и отдельных ветвей и серверов такая схема подходит опять-таки не только для такого тельца вы можете эту схему используют для любого кейса разделение чтобы запросы друг друга не мешали в таком случае за подписки очень хорошо оптимизируется они используют те же самые если в графике видно специально скопированы что по сути betway это один и тот же код все те же самые резольвер и все те же самые сервисы просто отправляют по разным протоколом для разработчика бэкенда это идеальная схема и клиента тоже когда они запрашивают они точно знают там брек приложения какой объект ним вернулся вот обязательное как больше заключения изучайте граф кирилл граф hell подписки тем более потому что они открывают огромные новые возможности для нас сделать унифицированный протокол но видно что они придуманы были не просто так давайте придумаем еще один протокол для взаимодействия а были именно необходимость в этом и мы сами на себе на своем приложении поняли что это необходимость есть и возникнет у многих когда они будут масштабироваться приложение станет большим много пользователей код bass станет очень большим в таком случае вот отказаться от монолита спокойно перейти микро сервисы все разделить между собой очень удобно вот используйте sap скрип шин и получайте от этого пользы и конечно же спасибо всем задавайте вопросы раз спасибо yg огромная соответственно сейчас надо будет сделать одну важную штук он будет сессию вопросов-ответов и тебе нужно будет выбрать из них тот кто больше тебе понравится здравствуйте спасибо за доклад я хотел сделать немного вас поправить потому что на самом деле в графике есть оплот файлов и он даже реализован в той библиотеке на год crafter ген по поводу мониторинга просто надо чуть менять парадигму и мониторить невыполнение http запроса уже работу ризограф и такой вопрос вы доставлять сообщение через среди спас от наверное при храни воители вы их где-нибудь если человек оффлайн ему нужно потом загрузить их или выгрузить там последние 10 штук для текущего то мы первое да я сказал что это сложности были то есть конечно же мониторингу нас есть у мониторится и файлы загружаем но в самом деле княгини это реализовано но удобства это немножко не добавляют это такой холивар на тему давайте на вопрос можно повторить вопрос извиняюсь на вы сказали что пользователи могут перри подключаться открывается новый руки соединены например нужно установить который учаток смотрите есть два варианта короткая сессия которая в одессе в виде простых списков можно хранить то есть это с этой давайте можно хранить цех в котором последние события который клиент должен получить если вдруг диска на x клиента произошел намного дольше то понятное дело это все хранить в кеше нету смысла после реконнекта клиент уже запрашивает полноценные данные по сути из базой восстанавливает усы состояния которое ему нужно а дальше уже начинает real-time работать в таком структуре я думаю честно скажу мы это даже посмотрели как библиотека центрифуга работает спасибо и еще такой короткий вопрос используете ли вы тоже граф quelle api для внутренних support system да неполноценно но планируем там есть и плюсы и минусы сейчас есть несколько сервисов которые сами по внутренним api графику отвечает то есть идея была такая сделать первый слой для клиента граф келл второй слой сервисов тоже отвечают по графику а дальше уже сервисы которые обычной герпесе сейчас у нас реализации такая что вот этого второе условие граф пелых сервисов очень мало но я думаю у нас полноценный второй слой появится вы хотите сделать на федерацию да здравствует спасибо за доклад я узнали получил частичный ответ а вопрос был в том как вы гарантируете то что только один раз увидит пользователь сообщение о бонусе если вы при каждом допросе там конфликта конфигурации подключаете подписывайтесь заново на очередь и но вы сказали что используйте сеты да если и сайта события ушло мы считаем что она ушла и плюс когда клиент получает этот папа показывает клиент на серверах 5 отправлять события что я этот пул попытка показал он у сервис это событие ловит и у себя помечаю что буллпап сегодня показан если вдруг там в течение дня но он недополучил то есть мы не получили события что папа показан то следующий коннектом и еще раз ему покажем этот купол даже есть почему то он показался один раз тоже очень rides it i do я за понял посему здравствуйте спасибо за доклад хотел бы такой вопрос немного не совсем по теме на как вы в graph келли авторизацию проводится то есть вы через хедер и таким и прокидывайте обычное у нас есть отдельный сервис авторизации там обычные love выбираешь токины то есть мы их 4 просто g&g вот и токен отправляем в хедере и сам дед вей валить ура чисто чего-то и они у нас хэшируются по ключу и еще вопрос получается что вот эти subscription которые отправляются вы их можете отправить только когда у вас на соке тогда соединяли открыто то есть за в пустоту как вернуть но вкусно туда у нас когда открывает клиент соки соединение мы знаем то есть состояние у него есть мы знаем что этот клиент сейчас подключен нам и знаете куда назад и знаем кафку в каком где твои он сейчас и когда нам нужно что-то отправить ему мы просто в этот гейт вы ему отправим спасибо за доклад вопрос такой вот у вас там уровни даже еще один вроде рассказали есть скольких местах надо ручка писать чтоб до нее вообще фронт добрался и кто занимается написанием ризограф ризограф занимаются каждая часть команды может своими резон wear my заниматься то есть и есть такое условное разделение объектов на командой эта команда отвечает за продукты эта команда отвечает за юзера и резольвер юзеры напишет эта команда резольвер и у нас довольно легковесный они по сути шаблонные рессоры которые входят стану уже в соответствующий сервис ну это понятно просто мне ребята показывали вот там продвигали графу и quelle говорили давай там использовать но когда они показали в скольких местах надо как бы ручку описать там начинаем и фронтовых там потом на релиза умер написать потом еще на бекки и написать нет окрас это наверное проблемы промежуточной миграции срез то в графе такое возможно и что нужно нескольких местах описать а в реальности нужно просто в коде главный водки твой который про который я рассказывал в детстве я один раз описывается и как раз вот еще раз про плюсы что для подписок и для обычных граф келлов это один одна и та же схема с одним и тем же резал мерами спасибо в одном месте спасибо за доклад 1 или полтора вопрос а именно вы как-нибудь ограничиваете сложность запросов глубину это первый вопрос и как вы в россии обычно вот есть and point он там например делать какой-то понятная сколь запрос и вот если он тормозит и идем как-нибудь индексы строим оптимизируем и так далее вот что вы с этим делаете как-нибудь ну его полагайтесь только на адекватность клиента что он не сделает что-то глупо нет но принципе второй вопрос от с первых на довольно связано давайте сперва начну да я специально про именно сам граф kill особо не детализировал ся чтобы не занимать особо времени но есть общие принятые практике про сложность запросы например ukit хаба очень хорошая реализация она простая очень линейная и тем более гашеная библе тяги калдину на это поддерживает то есть там для каждого типа объекта по сути fetch каждого объекта имеет свой вес условно в нашем случае фичи огромный продукт с кучей полями и у него вес условно 100 овечек например только информация о доставке это условная 10 и ставится за определенные веса разным объектам мина типом и когда этого типа там проблемы n + 1 и так далее вот когда много этих типов нужно загрузить просто на уровне парсинга граф киосками уже можно на уровне это даже не еще ничего не делая просто калькулировать сложность и если сложность больше определенного порога просто клиенту возвращать ошибку что извини ты и запросил слишком сложную структуру но и наши клиенты и понятное дело тестируется я не сложные запросы не будут делать вот про искал именно ну крафтил это graphviz запросто он клиенты могут company рует комбинировать объекты как они хотят и в данном случае опять мы возвращаемся к сложности если для нас это несложно хоть любой комбинации объектов но есть исключения про это я тоже особо не говорил что каждому клиенту условного объекта пользователя есть свои личные поля связаны свой персональный словно токи номер телефона который есть и публич другой пользователь придет мы его не отдадим то есть поля который клиент запрашивает но мы ну авторизацию проверяем вернуть это поле или нет и ошибку в этой мысли нет один добрый меня зовут ван вопрос следующие как в графский обеспечивается version ность методов то есть у нас условиях может быть огромное количество версий клиентских приложений как это реализовано и второй вопрос если у нас уже есть rest api в котором несколько сотен методов насколько болезненна переходить на графике до 1 в graph келли version нас как такого нет но есть очень полезная фишка и называется deprecated любое поле можно помечать когти при кейт и то есть грубо ну давайте так вместе мы сами поддерживаем до backward compatibility стоит совместимы со старыми версиями у нас мобильное приложение которое год назад была выпущена и него нужно тоже поддерживать основной подход это все новые данные новые поля и если тип данных меняются условно цена была энтом а сейчас нужно я почему-то флот отдавать то просто сделать еще одно поле прошло от старой памяти с как ты при кети условно в нашем случае да это украв келлы пока небольшая история но по опыту aristo мы знаем просто помечаем тип liked it поднимаем мы когда приходят затравки запросы когда перестали это поле запрашивать уже его можно снять потому что старых клиентов мы к сожалению не можем менять это не мир серверное взаимодействие чтоб что-то делать дорогие ещё два вопроса этот вопрос по поводу а попросту поводу авторизации есть такое просто как мы знаем что граф юре это единая . и мы можем в любой графа вы запрос и как вы решаете проблему именно с правами допустим у пользователя какой-то именно к ребру нету доступа вот как вы решаете ну это тоже и на каждый рисунок вы пишите какой то типа определенные но для каждого поля можно указать доступ и то есть для каждого фил да прям даже не объекта полноценного не типа а для каждого филда можно грануле арно указывать какие права у пользователя и это на уровне и resolving все проверяется спасибо я здесь все за доклад вот вы рассказали про вес но чужом будет меняться наверно временем то есть как то управлять снова бизнес требования старые клиенты остаются к ужасу портить вот вы говорит что отвечать ошибкой пути после слишком большой вес как вообще ну вот можете смотрите вес увеличивается но старые клиенты уже фиксирована запрашивает определенный объем данных вес может меняться есть и у нас в этом объеме данных что-то дополнительно появилась на новые и новые части новые и новые части одни уже весь меняют да и в основном старый объект можно определить не только про самого удар пока пока по всем фил зам по отдельности если такая необходимость например при простой пример у нас есть в пользователи есть flag is online чтобы получить флаке из онлайн сервису нужно ходить вообще сторонний сервис посмотреть у него есть там он сейчас в ул они или нет а если запросить просто имя фамилия и номер телефона этого из одной базы берется если и один клиент запросил поле из онлайн то вес этого запроса увеличился уже прописали то есть на уровне field of даже можно весами управлять дорогие я хочу напомнить о том что у нас есть дискуссионная зона want a man и можно свои многочисленные вопросы там задать с отвязала у нас есть станцию labs подходить и я там буду стоять отвечу на любой вопрос не только prograf кило вообще про очень много разные технологии которые нас используется aig спасибо огромное мы хотим вот спасибо вот в таком виде сказать да это сертификат как напоминание о том что здесь выступал вечера стив большой год и соответственно нужно теперь выбрать победители какой вопрос тебе больше всех понравился я думаю сразу вспомнился первый вопрос который про как хранимые в сайтах но кажется ушли не так где тот кто прошел может быть какой то еще поздно чем кто остался вопрос а вот отож тоже хороший вопрос был до"
}