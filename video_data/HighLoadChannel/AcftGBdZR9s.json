{
  "video_id": "AcftGBdZR9s",
  "channel": "HighLoadChannel",
  "title": "Практика применения Pinba в Badoo / Денис Карасик (Badoo)",
  "views": 685,
  "duration": 2558,
  "published": "2017-05-14T22:53:06-07:00",
  "text": "всем здравствуйте доброе утро рад что кто-то пришел на первый доклад 2 дня меня зовут denis я работаю в воду и я вам сегодня расскажу как мы в буду используем пингу для кого подует и питбайки непонятный новые слова буквально пару слов о нас bodum эта социальная сеть для знакомств и общения с людьми у нас примерно 300 миллионов зрительных пользователей и примерно 70 корп с на печке скрипты в пике то есть но у нас есть такой некий highload вот ну помимо пищи до чтобы сразу виде не расстраивались peach прямой сколь мы используем активно демона си си плюс плюс наши демоны последнее время пишем мужчина гауланд модно и стильно молодежный и работает вот активно используем тарантул то есть технологии у вас большой там дальше ещё можно перечислять но речь не об этом система сложная и даже когда на такой сложной не было то в продакшене иногда возникают проблемы изначально был всего один график этой как-то показывал поведение системы когда что-то шло не так понять где проблем был очень сложно все бегали руководство ругалась как бы программисты пытались починить это тратилось время и мы решили написать какой-то свой инструмент который нам поможет в режиме реального времени отслеживать проблемы такой инструмент был написан автор первой версии андрей нигматуллин наш сотрудник о чем до сих пор наш сотрудник несмотря на то что написал pingu вот и назвал я пил бы почему то что шифруется pitch признаку батлы к нему на но из названия понятно поразительность чего мы измеряли последние годы наверное годы 2009 автором пин бы в той которая сейчас является антон долго ль из нашего си отдела вот и пин бы сейчас она написана сен что сейчас что тогда и пин бы сам engine и печник страшно естественно данные в пинбол отправляет в протокол mtp и сама пил бы это некий москва ль engine то есть для того чтобы данное туда прочесть можно воспользоваться любым моя сколь клиентам подсоединиться и все давно будет виде табличек это очень удобно по крайней для печки программиста в котором лень писать нам свой какой-то api что в к чему-то конектится и получать данные вот моя сколько никто вперед да вот название этой печки знаку battle накинем а но уже давно есть плагины к большинству распространённых языков глубин был очень простой api то есть если вы используя какой-то язык и для него нет плагина в общем-то не представляет сложности написать свой пин бы не является хранилищем данных это система вообще москва енджэ называется система для сбора и отображение статистики в реальном времени то есть данные там хранятся в каком-то окне по умолчанию если вы pingu поставить из коробки это будет 900 секунд на 15 минут он ну как правило продакшене мы используем окна от 60 секунд до 300 секунд больше не используем вот помимо с но документации на сайте и статей в нашем abra блогиат babadu оказывается pink блоге использует и есть отличная статья на хабре вот например статья antara pinboard вот рекомендую всем кто pingu только пробует там ребята пишут как ну грубо говоря не представит свой свой дашборд с уже с графиками готовы некий продукт который можно сразу попробовать у вас будут красивые графики уж пин по графике то не рисует сама по себе она просто данные представляет как маску или интерфейсе все какие базовые задачи решаемые с помощью pingu ну понятно дело сразу мы начинаем измерять запросы да вот и наши peach пеклась это количество запросов посудка а вот эти холмики но наш самый нагружены кластер элементом примерно 20 крп с это вот ближе к пику естественным имеем время запросов ну просто количество мерить не так интересно некое распределение показано чем больше зеленого чем понятно лучше когда зеленого становится меньше значка это проблема идет меряем потребление памяти это вот февральский график но помни везде уже на многих конференциях показывали знаете что случилось примерно к всю память упала на нас потребление да да вы перешли на письме 7 как был даже половому автор пичко 7 этот график показывали вот так отвести так точно вот этого сразу видели в пил бы немножко порадовались также мы естественно верим обращение ко всем внешним серверам абсолютно всем то есть начинает моя сквозь из на наших каких то демонов и даже memcache казалось бы зачем мерить обращение кункуш он вроде как и так из коробки быстрый но зачастую бывает так что выпустили build вот вертикальные полоски на графике то как в то время когда выходит билд и резко пошел рост на memcache это было сразу видно на этих графиках вроде ничего критичного не произошло но явно был какой-то как бы косяк со стороны от разработки до зачем-то данные стали получаться кратном не должны были быстро поправили это почти никак не засек силу production engine x плагин мы используем engine x и зачастую так получается что никакого печки toyota контент отдавать надо и для это был написан младенчик для общения данных спинкой и данный посылается без всяких языков программирования и там очень удобно мерить не просто количество запросов но также и например статусы на графике видно это просто статус 4 4 х ошибок был какой-то фон он вырос это очень удобно мониторить это также сразу видно и позволяет обнаружить проблему ну помимо графиков до графики каешься красиво иногда очень хочется посмотреть на дашборд раз мы измеряем время да у нас есть дашборд самым медленным и скриптами когда мы имеем наши скрипты ну наверняка те кто пишут на pitch 5 на других языках использовать некие фромборке и всегда furmark каких какая-то общая часть пятницы лизации где там сессия подтягивайте это механизмы работают что включает kid ink лундэ вот потом часть пользу программист пишет свой код до некий action часть по 2 уху и иногда люди зачем-то наша down так надо делать что-то ну во время shutdown в печке так можно сделать такой так вот пихнуть вот естественно мы сразу измеряем вот во всех скриптах 4 этих блоков вот тут на картинке видно что тормозит action это хорошо это нормально то есть конечно плохо но если тормозил бы юзер об целиком это значит что сам from work начал тупить да и не дай бог в ухо тупит это бывает такое что люди в объеме делают ускорили запросы зачем-то ну внутри скрипта мы измеряем все запросы и может быть что самый медленный здесь это забрав запрос к базе данных дальше смотрим какой базе данных и вот дальше уже пути разветвляются потому что я чуть позже расскажу подробнее об измерении как бы производительности mais quel но в целом глядя на этот слайд видно что мы знаем какая база тормозит можно эти гады башни com ты качек смотреть в zabbix у кого он есть и что там решать примерно так вот общие для примера я рассказал тебе давайте чуть поподробнее и на наиболее интересные кейсах остановимся сразу так немножко терминологии вот если мы посмотрим на наши request в разрезе да ну что там происходит там какая-то внутренняя логика который нам хочется измерить соответственно таймером что такой таймер когда говорю таймер таймер начнут мы засекаем время начала засекаем время конца вот у нас есть начнет таймер внутри скрипта можем таймер стартануть несколько раз да вот пока обращение к монтажу мы замерили потом опять она идет если как бы это тоже команда тот же сервер это по сути тот же тайна как потом в пинге нам понять что был за таймером очень просто каждому таймеру есть набор тегов то есть меток это набор киева или до название метки значению метки в общем-то все и такие метки можно устанавливать не только на таймер и но и на сам request чтоб можно было фильтровать request и и как я расскажу дальнейшем агрегировать по и квест тегом то есть вот раньше двигаться по request бегом не было достаточно ну относительно новая фишка и даже поводу коммент ации под ней ещё не написали то есть когда я бы говорить так значит текст таймером когда я буду говорить в стек так ну самаре квеста так чтоб никому не было не понятно отлично да я вот сказал что пемба использует маску legend для предоставления данных вот вы туда данный политики отправили решили посмотреть что там происходит когда tesco мой сколь что увидите правильно выйти на борт табличек вот и вот сразу из таких отчетов и ничего не создавали да и его сказать там вот голая пил будете вот примерно такой список табличек да и вот текст который в красной рамке это вот таблица с так называемой стерильной данными куда все приходит основной табличка это request в ее структура показана куда приходят все запросы также таблички как бы с таймерами тегами и вот здесь сразу возникает соблазн да у людей у которых который знает искать хорошо не все нам больше ничего не надо мы вот возьмем сейчас напишем кучу join of таблички request ic таймера так и получим все наши данные которые ездить все таймер и уже туда сброшены вот это вот ножки рискованный шаг и знать как вступить на тёмную сторону силы можно можно попасть потому что такие запас они конечно будут работать ну это моя сквозь engine вас все заработает данные вы получите но как я уже говорил пемба держит вот данные в квесте до сих табличкой за некое окно поэтому редко кто приходит и смотрит все это руками как правило люди пишут какие-то скрипты там в любом языке на своем любимом которые идут в пердуна помирал с минуту берут какие-то данные приносит их уже в постоянное хранилище так вот если вы в таких скриптах будете активно использовать вот голая запросы к квесту особенно с джой нами есть вероятность что они начнут тормозить то есть она будет сто процентов вот когда данных не очень много либо отчетов не очень много то скорее всего даже не че не заметить вот но лучше и правильнее все-таки использовать отчеты без необходимости но без реальное понимание того что вам нужно непосредственно пойти в request делать этого я бы не рекомендовал хотя многие делают и живут достаточно долго или production отчеты что такое отчет по сути дела если пин бы это не про хранения данных то просто же pink это в общем pingu это про различные виды агрегации вот самое главное это агрегации и каждый отчет посвятил это некий некая агрегация они все отличаются только агрегации ну и немножко списком полей про все агрегация рассказывать не буду их много и они из документации более того там даже есть скрипт который вам генерирует все отчеты практически основные и при этом если отчеты будут созданы в пинге на них нагрузки никакая не пойдет сразу же отчета у нас бывает базовый когда никак по никаким пекине используется используется просто двигаться парень квестом да и их сумму можно фильтровать по request игу отчеты бывают стайлер тегами и вот новые отчеты эта облигация паренька в с тегом а теперь про чё ты чуть подробнее на чтобы сделать отчет вы должны сделать некий в пинге до тут есть нюанс нюанс 1 мая сколь engine плутон только для для интерфейс начать выполнять когда вы смотрите что-то в клубе некий cray ты был на самом деле никакой таблички не создается нигде ложки нет это некая абстракция вот вы создаете такой отчет вы думаете что там случилось да ничего не случилось просто пин бы знает о кто-то захочет собирать вот такие to do у захочет не факт что будет собирать пожалуй я пока запомни вот такой отчет но еще плакалась не буду и пока вы не сделаете первый select к этому отчету данных в пин bennett и нагрузки никакой нет поэтому можете изначально сгенерить все-все примерные отчеты которые вам дальнейшем понадобятся по типам да и пока вы к ним select не сделаете никакой нагрузки не будет дано туда отправляться не будут вот но если вы хоть один select сделали то все они потом оттуда не пропадут и двигаться будет идти постоянно я сама чуть больше не нужен сожалению нельзя просто задержи у нужно реально дров и создать заново вот и второй очень важный момент это порядок полей вот название полей как таковые не важны вообще-то можно писать что угодно и все будет хорошо потому что когда данные из самой пил бы да вот из памяти джуди array по моему хранятся как бы переходит ваш отчет там идет matching только по порядку полей по их количество синус по чуть-чуть 15 полей вот в таком порядке не спинку вам выгрузится если вы такие решили ой тут какие тут поля стран они мне вообще не нужны я их уберу вот так делать не нужно потому что берете какие-то поля из 15 делаете 10 значит у вас в эти 10 полей запишется первые 10 полей как бы правильного отчета последний не запишутся порядок поменяется и никакие никакой ошибки вы не увидите у поступить очень странные данные и будете очень удивлены и будете вот и что-то ваш open бы глючит надо делать copy-paste увидели вот как вот в документации на отчет зима вот так его и создаем если у вас есть там теги то в каком порядке они указаны в поле коммент да в поле коммент мы обычно указывают данные по структуре отчета в таком же порядке нибудь в отчете порядок важен название нет и например перцентиле то же самое они идут в конце почему его нельзя вы выкидывать поля потом уж потом мы добавили пирс интеле и если какие-то поля середины выкинуть это то данный очень криво положится ну теперь о чем-нибудь более интересным дам с отчетами примерно понятно что мы ими измеряем кроме вот таких вот явных кейсов наверняка каждый из вас использовали в том или ином виде очереди отложенная обработка событий везде это используется понятно человек пришел на сайт он что-то там делает кого-то лайкает кому-то отправляет сообщение соответственно у кого ты должен измениться рейтинг должно пройти notification все это делается ником фоне ну чтобы не тормозить скрипты у нас таких событий очень много в какой-то момент мы решили давайте мы измеряем сколько у нас проходит времени между правкой событиями ждут его генерации и вот-вот обработчиком и время обработки уже вот она самом подписчики на скребке консьюмер называемом давайте померим с помощью пин бы но тут же возникает нюанс а как то есть это же не один какой то скрипт где мы взяли вот таймер запустили таймер остановили да и до нас кинули в pingu а если мы используем в пить пить пить пить пить страшном даже специально скидывать данные в pingu не нужно разрешение скрипта печь пикс то что все сделает сам они сами автоматически это все таймер это же вот то тут уже у нас несколько скриптов и в нашем случае это вот следующий этап это сначала событий отправляется площадок у нас много кластеров у нас много и насытил транспортной системы которые данное событие как бы отправлять на некий точке сбора где дугой скрипт разбирает эти события смотрят такой консьюмер на какое событие подписан событий может быть несколько подписчиков подписаны и отправляет в очередь уже для каждого консьюмер вот например просто в моей сколь дома сколь табличка с очень у событий то есть у нас первый этап транспорт потом вот сколько событий лежит в очереди потом сколько он обрабатывается точнее ну вот уже три этапа надо как-то померить что делать это очень просто на самом деле мы знаем когда мы событие сгенерировали да но хранится время создания и на каждом этапе вот на первом этапе да когда он пришел на какой то скрипт после транспорта мы тоже знаем это время им и внутрь события просто помещаем некий джейсон массивчик пришел объект с дельтой да вот дельты по времени с имением сколько прошло до какого-то этапа также во время обработки концу миром он события получил тот же записал дельта вот это вот в этот же сон массив потом обработал записал последнюю дельта и все данные скинул в pingu всего там будет три таймер вот , своими тегами соответственно структура таблички примерно такая вот тип отчета это просто отчет по многим тегом тб-3 то тип события да какой консилер обрабатывал и ну вот какой непосредственно таймер то есть какой этап по сути дела и вот мы видим что данное событие которое в примере пока у нас суммарно обрабатывается за примерно в районе 5 секунд максимум и самый долгий этап это вот как раз транспорта куда у нас вот самый длительный большие то примерно три секунды занимает вот это событие это на самом деле этот пример это реальный пример это сброс координации мобильного телефона вы пришли в starbucks дотки войти мобильное приложение смотришь людей рядом конечно вам хочется чтобы люди рядом это были реально люди рядом а не те которые были тут нам полчаса назад час назад и вот самая длительная это пять секунд сколько бороться координатор что можно за пять секунд сделать можно улыбнуться девушки на кости все ваши координаты уже уже попадут в финальный демон и вас могут найти ну и вы соответствие можете увидеть технику ты реально рядом для чего я этот пример вообще привёл вот этот кейс когда мы измеряем координаты где то где то не в пекине в одном скрипте мы точно популярен у нас и целый проект джимбо вот java script is not a bottle никто не мог где мы верим-верим fontaine то есть на фронт энзимы что-то измеряем там кита таймеры и потом просто сбрасываем на некий описки на печке вот просто значение таймеров и отправляем их в pingu то есть нам не обязательно как бы внутри одного скита то делать можем получить данные откуда угодно и простых пинбол отправить и получить все агрегации ссылочки есть и на доклад про джин буйно саму джимбо но в общем как бы методологии то в общем-то понятна в этой peгби который лежит в основе джин бы там используется в основу отсчеты по многим тегом используются активно перцентиле гистограммы ну и фильтрация по тегам request а вот новые слова dapper сын телиги 100 грамм и что вообще происходит ну вот когда мы измеряем какое-то время да понятно вот вас было стол запросы в секунду какое время изобразить на графике то есть среднеарифметическое какое иногда сложно понять не посмотрев на распределение вот пин бы из коробки может делать распределение и вот пример создания отчета вам выглядят примерно вот так вот абсолютно точно и что тут нужно видеть до в красной рамке написано вот и этот префикс да . и вот потом как раз идет тот отчёт по которому будет стоить распределен но он должен быть обязательно создан отдельный сам по себе то есть если у вас нет отчета для которого вы хотите сделать распределение вы делаете только отчет с гистограмм этого будет пустая ну сначала стать отчет а потом по нему вот такой вот как бы табличку и вас появятся гистограмму как instagram вас появится табличка с данными по количеству чек временных весь интервал разобьется там будет сутки количество попаданий ну отлично гистограммы то мы строим смотрим на них дальше ты чё делать дальше надо бы использовать перцентиле можно сделать отдельный вообще доклад как правильно используя значение пирса и тилида как мы мониторим производительность почему какие-то перцентиле нам интересны какие-то нет скажу только одно пиво позволяет вам получать данные из коробки поля бампер сын телля вот мы в баду в основном для производительность для измерения производительности мирим старше просветили 95 99 из недавнего времени 100 ну то есть максимум вот на этом и реально смотрим то есть до красиво там отобразить среднеарифметическая но вот вот старший persantine очень важный но кого-то может важно посмотреть там вылетом 75 25 до любой persantine спокойно можно посмотреть и делается очень просто в поле коммент добавляем в цифре какие пирс на теле вам нужны соответственно в том же порядке в конце таблички создаются нужные поля и все у вас будет persantine такой пирсинг я не буду объяснять нам всем понятно потому не понятно сразу скажут 50 и пирс intimidea надо что половина запросов здесь половина здесь до 95 на 95 процентов запросов вот здесь вот были 5 все очень просто без вот сложных математических термин как это выглядит в реальности в реальность это будет примерно вот так вот это график запросов к одному из наших сильных демонов вот черненькой там внизу там на самом деле два графика слились в один практически это средний медиа надо видите что там порядка ну вот меньше 20 миллисекунд это занимает вот зелененькая линии это как раз 9 пирс intel и он уже ну почти в два раза больше не говоря уже о там максимальном до 100 5 гектара вообще лихорадит очень хорошо и когда вы смотрите на средние может вас ошибочное ощущение что как у нас замечательно летает но вот старший пирсинг или очень нужно смотреть и зачастую как бы по ним только можно при что демон где-то тупит на каких-то определенных запросах и кейсах я уже говорил да что с недавнего времени нас сегрегация парень квест тегом раньше по не было только фильтрации то есть нужно к фильтрация понятно вы делаете фильтр и вас река с таким тегами ушли в отчет но мы активно используем engine x и мы хотим получать некие данные от туда внутрь индекс проблематично сделать отчеты под номера тегами как в этом замеряете время это надо как-то вклиниться в коттон-джин и кстати этот таймер оставить под таймеров там нет а зачем же нам понадобится двигаться но есть такой тип контента которая дается непосредственно через engine.exe которые у нас очень много это фотографии их реально очень много и чтобы их отдавать они все хранятся на машинках с этими жестким диском там со шпинделями не крутится вот отдавать таких жестких дисков показалось проблематично машинки не выдерживают и мы решили сделать кластер машин с фото крышам так называемым где будем отдавать ssd-дисков отдаем все хорошо все работает но очень нужно мерить хит рейд по тому же зависимости от изображения зависимость от этих параметров например даже апликэйшен то есть откуда пришел запрос с android или ios все это можно решить если вы engine.exe мы растаем request теги но по ним не было агрегации вот для этого и сделали что получить такие красивые графики все очень просто мы расставляем внутри последнем шаге будет показано мы расставляем request иди внутрь и конфига engine x и отправляем их pingu и также как из таймера тегами просто делаем по ним агрегации дин станет значение таймера есть просто количество и вот видим такой красивый график с хитрый там то есть примерно хитрей 98 процентов а вот зачем вообще начали мирить hit rate а то что если вас 98 процентов хитрый то зачем то это значит что и 100 запросов вот два попадают на медленный сторож а если у вас 96 например пациентов хитрей дальше уже 4 запроса это в два раза больше два раза это два раза это очень плохо будет машинки если вот и реально в два раза хитрит никитой тупо два раза вот нагрузкой выносят два раза поэтому нам очень много спинку чтобы смотреть за хитом и как только что-то происходит мы тут же какие то мира принимаем вот на следующем слайде примерно вот показан формату лада у нас очень много данных вуаля уже есть 920 это выглядит размер изображения размер fit это как раз вот тот размер куда мы хотим дал им спилить и вот внутри локэйшн в engine.exe от подобной документация по плательщику есть на сайте но и проблематично найти если не искать поэтому я отсылочку привел просто вот такой конструкции relocation вставляем пин-код теги название т.к. значения и да найдут в pingu также автоматически после решения скрипта чего не в документации и что следует опять же сказать если у вас смотрела кришна есть превратно другой локэйшн я тут он дугой локэйшн и уже только туда идёт отдача контента так вот к сожалению pink бутлеги вам придется вот в каждом локридж не прописывать они вот внутри потом дальше не проваливаются как говорят сами стали джинкс и copy-paste и рулит ничего страшного в этом нет помимо хитрый то мы активно измеряем под размер ресайза в как по граму ресайза муза брожение изображением и нарезаем когда человек закачивать фотографию она нарезается низкоэффективных размеров чтобы сразу отдавать им орисой зим прим онлайн на ходу из как бы из ближайшую максимально иногда очень интересно в какой размер мариссой зим почему на графике то что самым популярным на графике в табличке что самое популярное изображение у нас 180 на 180 это значит что если бог решим его поменять скажем на 200 на 200 то мы можем очень сильно попасть похитрее это потому что все эти изображения будут уже не нужны а по потребуется 200 на 200 до и сетей по не будет очень плохой поэтому так смотрим когда у нас что-то меняется пришли продукты говорят ребята все 180 мало у всех большие к дате 200 отображать вот мы так вот резко перейти не можем нам нужно как тот процентам переводить чтобы как-то общей хитрить держать и мы смотрим вот ребята изображение очень многому мы не можем так просто взять их отключить конечно просядет так время еще есть буду рассказывать про маску или кто еще не спит и помнит первые слайды этом говорил да что мы смотрим какие блоки у нас скрипте работают медленно и вот я там показывал что вот медленно работает select и и вот так какая то база тормозит да так был до недавнего времени мы могли увидеть только какая база тормозит и какая операция да то есть db select мы относились к моей сколь как к обычному внешнему демону да и фильму пихали просто операция db select и непосредственно вот какой сервер да вот адрес силы все два тега marble отчет у нас но есть вот по таким по всем внешним сервисом с двумя такими вот тегами такой операции какой сервис но к сожалению иногда возникала проблема что что-то с базой не то а по вот этим данным понять невозможно потому что мы видим что select и возросли а какие selecta что в них что вообще случилось мы в записи смотрим что у нас все плохо и куда мы лезем мы едем слова лоб вот плох хоть раз лазил слоги особенно хорошим fps понимает что сразу определить проблему с чувствую очень проблематично особенно что если вас разбудили но чего нужно посмотреть какой то слово мог старый тот момент когда все было хорошо сверить с новым понять какие запросы появились в общем это долги и мы решили как-то что-то сделать ну и что мы сделали мы месяца сразу обратились к коммерческим решением всё работает всё шикарно мониторинг всего есть но есть нюанс на 1 них нужно платить и весьма немало и во-вторых тетта реальной версии которые предоставляются на попробовать они работают с несколькими дпс коми только и очень не понятно как это все пойдет она продакшне скажем на 500 dbsk вот и пока там решался вопрос пока в этом думали экспериментировали нашиды башни ки они ребята шустрых у нас их всего двое вот они решили но давайте мы возьмем и напишем слово свое конечно же они использовали правильно performance схема плюс питон + пластик все h плюс киба на все завелось все увидели красивый для кивки бани как было sixer все переваривает все хорошо но возник второй нюанс чтобы все это собирать на нашей боевой системе там с 500 близким на двух площадках потребовался кластер ластиков сопоставимой по мощности с этим всем вот если кто то думает что бы одну может так вот щелкнуть и сто пятьсот машинок поставить дата-центре вот это не так вот то есть да у нас прототип есть можем про него рассказывать долго но на бою не не работает потому что ластик настолько нет нам решили ну ладно давайте не будем ничего выдумывать давайте возьмем наш любимый микроскоп и будем забивать гвозди давайте возьмем пинбол и будем скидывать данные туда замечательно а как ну то есть запросов намного да и они все разные если будут просто скидывать в качестве тега каждый запрос то она тегов будет много уникальности по не будет мало естественно мы от каждого запросе к берем некий как бы fingerprint некий хэш то есть если у вас есть запрос скажем лимит офсетном 1020 понятно что часто 1020 учитывать не нужно там быть некий placeholder и как бы все вот эти вот не нужны данным и запросов выпиливаем берем от него никаких и чтобы он помещался значение тега да там не знаем до 5 например на ipad туда берем 1 50 символов к лизе будет немного потому что окно то небольшое нас там 67 секунд вот берем неких ешь и строим вот такую структуру структуру тегов донатом понятно вот quake вверх и штамм куда пошел запрос на какой кластер откуда там операция все бы ничего но возник здесь возник нюанс если мы все делаем из коробки по данным пойдут всегда в одну и ту же pinmode которая прописана в пищу пекине и крючка может разорвать то есть если мы туда будем отправлять счет по всем запросам да и счетам агрегации будем по ним строить и нам потребовалось какие-то запросы проходи другую pingu а вот по умолчанию да вот вот это вот а пик пик пик стенд позволяет так делать нам нет таких методов из просто методы добавьте таймер установите таймер а там установите квестом теги установить ее мире квеста и так далее так вот в атрибуцию pingu доводки шеек стенд и ко многим вы почти ко всем плательщикам есть аналог да вот класс open бакленд это простой контейнер который в конструкторе получает данные по connect uk open by yuni вас куча методов сеттеров гетер куда можно смыть все нужные значения единственное вот данные то бы руками нужно отправлять воспользуемся этим клиентом да мы все отправили в отдельную спинку и вот самый интересный отчет это вот представлен на слайде он такой агрегация по одному тегу по quake газ покуришь вот и как я уже говорил вас интересует старше persantine вот они и указанным вот и на выходе мы имеем вот такой вот красивый дашборд меня очень просили замечать запросы вот кому видно да вот что я говорил этот юзер айди написан вот тут реально число но мы оставляем placeholder вот там где контакта иди там очень тяжело пришлось расспросить самим дата мясники пансионата же мы вы хотите значение убираем что получить как можно более уникальный запросу people's уникальных и теперь наши дачники в режиме реального времени смотрят на проблемные запросы уже больше не дергать программистов и почти не читают слова логе хорошо нагрузка на базу есть как и обычно уменьшает используют некий кэш мы используем вам кажется банальным и в какой-то момент а мощно захотелось померить хитрей на фоток и шаг зависимую на кашах в зависимости от семейства ключей опять же зачем мы это делаем то зачем еще таким заниматься вот кто знает нам конечно нет тени маски хитро устроен да если вы поднял выделили какой-то объем памяти 64 гигабайта у вас ключи разного размера вовсе не факт что он равномерно распределит эту память и как бы вы взять получено к вы хитрый можете напороться на такой косяк как-нибудь мелкие ключевого заполнит все пространство да и по нибудь хорошее хит редких крупный ключи нет они будут выплачиваться и как бы толку будет не очень много соответственно нужно как-то подтягивать что подчинилась что надо посмотреть что очень происходит и мы решили померить хитрей для этого мы каждый ключ большая работа нужно пройтись по всему нашему печки репозиторию пару миллионов строк есть так точно вот и все все вот ключи привести в такой формат как вот family name : там какие-то данные например вот кант и там орешнике контактов соответственно вот поэтому все малины мы сделали все агрегации создали такой же массивчик кекс как в предыдущем примере вот только с местом москаль крыш мы отправляем значение семейства ключей и создали вот один из многих отчетов там агрегации то много всяких но самое интересное то такой да опять же двигаться по нескольким тегам где так этого семейства ключей был ли я был хит и хвост к там обращались в результате мы можем взять вот такие вот графики по фитнесу не самый лучший график его специально привел помощи если приведу там большой графики в где места будет очень мало скажете ну как не интересно вот мы смотрим на него и его думаю что с этим всем делать потому что хитрый ту же так примерно на грани сразу скажу что было примерно понимание примерно у нас memcache пикетов вот в секунду идет 40 fps это много и для этого почему использовать в отдельную pingu это самое то в общем-то пофиг на переваривание всех запросов но вот когда вы строите отчеты там все это как бы начинает отжаться ресурсы строится агрегации активно юзается циpкa юзается память и как бы запросов но вот лучший для надежности в отдельную пинбол врач потому что если у вас она одна рухнет ну да вы потеряете статистику какой то время по моим крышам но если вас рухнет общая пин-код у вас вся статистика тут же пропадет дано какое-то окно пока не починили вот это все что я хотел рассказать за минимальное время да вот наиболее интересные кейсы как бы некие примеры и он сейчас не остается еще минут 10 15 я готов отвечать на все ваши вопросы потом я буду находиться там и очень подробно рассказывать про все остальные кейс их очень много и формат дохода не просто не могут войти большое за доклад показывать и графики как у вас было хорошо допустим php5 потом 7 у вас есть что-то подобное как у вас было хорошо до пин бы и после то есть как бы она что-нибудь съедает что-нибудь отжирает таких графиков нет я объясню почему ну во первых у нас этим нет никаких проблем да то есть купил послать данные по протоколу идите почти моментально если используется печка extinction это год написанной на си который на фактически формирует некую структуру и кидает ее вот пойдите туда в pingu если обсе я сдохла но видите ушло и в общем то все оверхед мы даже не имеем ну после не нужно умерить как-то работать на продакшене и работайте я очень не верю что он там реально какой-то критичный и опять же вот есть такая такое мнение давайте не будем из вольпин было продакшне давайте мы на хер там тестом стенде и запустим померяем посмотрим и потом как бы мы получим кита данные все починим вот мы когда сделали pingu чтобы используйте именно продакшне они на тестовых стендов это очень важно мерить продаж иначе мы не увидим всех этих графиках всех этих красивых графика всех этих данных с продакшена тестовый стенд может работать отлично а вот продакш может palace отвалится и вы биспинг этого сразу не поймаете что там происходит вот overhead мы почти нулевой доброе утро спасибо за доклад интересует первый вопрос это присутствует ли у вас какой-нибудь функция сэмплирование то есть чтобы не отправлялись постоянно данные одинаковы если их много остановите пемба я говорю это не хранилище данных и когда мы копим данные да и переносим их в постоянное хранилище вот там мы используем титул там все это присутствовать да то есть мы собираем и как и делом down сэмплинг там помимо дату можно использовать их а дypoтaнa flex db там мы в этом направлении думаем но самой пинге все очень просто и топорно вот мы отправили данные они как бы туда ушли tomonidan агрегируются это скорее всего вопрос как бы просто вот этот хищный пасечный код нет это прачечный клиент который все это управляет не отправлял просто много одинаковых данных при высокой нагрузке отправлял просто я понял вас по моим я потом отправляется всего в лоб если не ошибаюсь но можем сейчас посмотреть своими отдельно и сразу скажу такой маленький нюанс если запросов реально приходит но бы как у нас случае с mais quel обязательно поли все запросом о на 50 процентов запросов меряем как быстро статистике этого достаточно вопрос второй кит если вы все это отправляюсь по записям мы у себя в проекте используем просто 100 т.д. отправляем это в телеграф и он всегда отправляет в в influx диме вот не рассматривали вы подобное ну мы и усы да насколько честный телеграф мы не рассматривали мы рассматривали решение когда после пин бы они падут фукс д.б. вот вот так вот то есть телеграф не смотрели но можем посмотреть понимаете на спинку устраивает еще тем что вот разработчик pingu сеть напротив меня я могу потыкать палочкой до и он сделать что я хочу вот да ну вот эта вся схема то есть как бы в маске или таблицы немного сложно ну то есть там ну то есть вы меченым от сам предоставление сессию хода то есть тяжело работать с masculin тыр фейсу в каком-то смысле просто сказка как сконфигурировать там телеграф это мне кажется проще возможно я честно не смотрел телеграф вот могу посмотреть и потом вам сказать ну как-то когда уже приловчился то создание запросов она реально буду отчетов она очень быстро проблем пока не было добрый день меня зовут кирилл вопрос такой не правильно понимаю что спинка стоит на одном посте сервер пошлют все клиенты вас кучу-кучу-кучу ну да то есть ну как стоите у нас литве кластер куда шлют запросы мобильные клиенты да вот самый нагружены скажем так условно говоря 100 машинок и вот они все эти спа машинок шлют в одну пинбол но при этом есть еще engine xd как бот класть кластер машина фоток и шейда не шут в свою бинду насадил нас набор pink для каждой задачи тоже слегка же задачи мы как ты их разделяем вот все запросы на придавало выдано plain которые сайт они все тут в одну pingu но вот запросов по фотографии мужчин x они как бы глубин бума сколько я уже объяснял дуб встречи pingu после чтоб как-то балансировать нагрузку потому что вы смотрите как бы вот ну пин-кода она расходует память вот самый нагруженный пин-код mais quel надо и тонкое шева и они расходуют примерно по 40 гигабайт памяти если мы их объединим например поможем ну она просто ляжет будет тормозить и ничего хорошему не увидим поэтому как бы вот смотрим что ой памяти что перестало хватать давайте как палата разделим а тогда у нас много машинок шлют ну его в одну pingu гигов памяти это в каком контексте когда вы смотрите да сколько процесс занимает пинбол вести демона вот от количества агрегат тысяч вас трафик много но грига отчетов малат open будут переварит 2 чуть и копаться если у вас данных настолько же навык наплодили много отчетов каждый читать некой агрегатирования понял вот и получается что если у нас например отчетов не туда через и квеста про гоняется за окном прогоняется и все там можно бесконечность ну относительно докрутить но когда вы начинаете отсчет у вас начинается расходуется циpкa и память и вот вы смотрите что давайте-ка паша ради мы даже один класс темы page or julie то есть вот перестал воде живут 25 глпс вот где был вот слайде вот о том класть его за сам большом тому же работать 4 пин бы на печке запроса потому что одна перестала выдерживать но раз уж а где подавать сразу 4 человека вот если интересно я расскажу как мы и пожар деле это очень просто логически ничего тебе не меняли да конечно это будут очень долго спасибо за доклад не могли прокомментировать группировку конечно у нас есть отдельные таблички лиза не в пинге где говоришь это тимплей ну смысл что в текст значение тега пихнуть на какой-то знаем значение выявить можно пойти поставить как какой там 5 до например можно и 5 поставить но было сделано так как бы некий хэш по нему просто вопросов много и сиделками автоинкремент ней ключ переполнится такое случается при 150 с секунду может случиться тампон даже как бы of thinking включение просто хэш как бы расшифровкой все и пойму реки отказ от хорошо идет и она чистится потому что то ну нам-то как но важно там также очень хранится покупаете здорово днепра php немножко расскажи как пит басни по хп и проводили какие-то исследованию пони по хп пони php смотрите во первых сразу скажу некий такой с азиатской информация я убил мы активно используем тарантул и мы пытались как бы тарантул кто знает да там использовать и лода ему пытались таки давайте мы прям и зло будем отправлять данные в плену потому что ну что такое открываем соки до пошлем данный найдите порт и все заработает но что-то стал работать медленно и все-таки мы написали хищный плагин чик поэтому кто использует тарантул может давно отправить туда скоро его выложен дальше про не дженкс плагин я как бы рассказал мы активно его используем и поскольку демона сцена гол и носи оттуда тоже посылается данные и вот я про них специально не рассказал потому что это тоже большая тема вот там мы очень активно смотрим р юзать в пиццерию зачем смотреть не так интересно он создан чтобы умирать скрипт запустился становился все нам время важнее а вот когда у вас демон висит то вы очень смотрим на розы чей данные там отправляются pingu плагин щеки все есть на сайте как бы и вот как раз если смотреть на измерение demon of the очень видно сколько идет логана сеть да то есть мы верим обращение к демону на печке стороне имеем тот же запрос на session демоне обязательно для каждого запроса мы делаем именно так и посмотрим что session и дела у нас встречает нам грубо говоря там за 5 миллисекунд она php запрос получается 200 миллисекунд и вот мы знаем что это не сильный демон уже начал тормозить на мы идем к нашим сетевика мы говорим вот вот вам где цифра из двух pink давайте-ка что-то решать ну вот так вот в двух словах доброе утро мне вопрос еще вы как-то в ретроспективе но дело делаете копию snapshot of ну вот все всех логов эспен бы мы перекладываем я жилкин бы это некое окно даты за 60 секунд вот мы собираем все эти данные в dota это вот как раз эти все графики строятся если нам нужны и на табличке дата перекладных какие-то постоянные хранилище в основном маску или используем хотя это не обязательно можно власти к храните там тоже все делать но в основном используем ради tool и все и спинку у нас попадает туда вот на этих линиях мы сразу визуально все видим вот именно такая рабиатул ну и на слушании слышали это уже там своя система сдала сэм кингом вот там как-то там что то делать но туда именно агрегаты попадают и нам на сыр и нет агрегаты мы используем агрегаты то есть да можно подправлять сыр и ну как я уже говорил забросы данных он не очень хорошая идея в ряде случаев мы только агрегат отсылаем пирсинг или средние вот это все слоем в работу спасибо мне продолжение предыдущего вопроса то есть данные сыр и они вообще не то есть до любые дан даже вот так но если захотим другой агрегацию она всегда будет строиться на новых только данных на старых уже не смотри не захотим другой отчеты спит по старым ну как пастор данных их пин bennett то есть они лежат вот все все отчеты вот все это давно и за одно окно которое настраивается и все данные не только за него если вы строите отчет новый построили то вот в момент когда вы делали select запрос например за 30 секунд окно и отчет только сейчас создали tool данные за предыдущий нам 200 секунд они-то не попадут они просто начнут агрегироваться в отчет непосредственно после 1 selecta то есть сразу же спасибо понятно спасибо денису"
}