{
  "video_id": "vQ7rvuOg7NY",
  "channel": "HighLoadChannel",
  "title": "Разрабатываем свой браузер с нуля. Часть первая: HTML / Александр Борисов (NGINX inc.)",
  "views": 4829,
  "duration": 3121,
  "published": "2019-05-15T04:07:30-07:00",
  "text": "собственно вот я взгляну на html спецификацию определим определимся с идет проблемами ну естественно по моему мнению какие я вижу проблемы ваш тему спецификации и расскажу как создать самый быстрый из всех существующих html потеряв который строит полноценный дом ну то есть который в точности соответствует спецификации зачем вообще создавать свой браузер люблю браузерный движок когда есть там известный mozilla вский google то есть веб кит blink microsoft пилит на он закрытый я определил для себя несколько направлений во-первых я это делаю на чистом си исключительно без вниз без внешних зависимостей каких-либо хардкорный си 99 которые для чего это делается для того что для обеспечения скорости работы с памятью то есть я уперся именно в скорость создать максимально быстрое решение чтобы ну как бы минимум затрат затрачивать ресурсов и максимально быстро все это пошить html-страницы также встраиваемость именно си чтобы можно было легко код перенести и встроить это бен денги речь а бензин гах именно перлы питон неважно любой язык программирования куда можно строить хищный код а это практически везде библиотеку можно подключить сделать биндинг на нее и естественно получить всю мощь именно браузерного движка а там очень много всего узлы сам html down да куча браузер это целая операционная система практически бэушный движок вот я из любви к программистам хочу передать это как бы в любой язык программирования обеспечить для этого именно сич чистый также легкость переноса благодаря сие обеспечивается легкость переноса на любые платформы то есть именно задача в том чтобы взять движок и запихать его в микроволновку ну грубо говоря чтобы он там отрабатывал рассчитывал все чтобы все работало и все было отлично то есть минимальный понятно дело что нельзя просто взять и запихать в микроволновку надо минимум усилий все равно вложить но получить результат также независимость но независимость на с натяжкой то есть независимость от чего от стороннего кода то есть от гугла от mozilla от прочих но на самом деле еще как зависимость спецификации пишут известно кто google mozilla ну то есть microsoft и такая независимость ну по коду можно сказать ну и престиж просто по кайфом движок мало у кого есть браузерной я хочу чтобы у меня был свой собственный начнём мы с html я хочу рассказать вначале прежде чем понять проблемы html и надо взглянуть на спецификацию то есть приблизимся быстрая по спецификации и что она говорит делать то есть как писать код чтобы получить в итоге дом то есть полноценное дерево и прежде чем естественно начать надо определиться какую спецификацию выбрать их ровно 2 2 организации так скажем в а твой гей вытряси разрабатывают пищу спецификацию в 1 участвует apple google microsoft firefox ну то есть mozilla участвует во второй куча всяких организациях там где-то 250 штук я увидел много знакомых компаний но честно сказать я не знаю зачем они это делают то есть ли генри линка ну не рынка и отрасли так сказать они от пачка вались и создают свою спецификацию ну то есть пишет ее в этой оси зачем держит как бы там буквально копипаст одного и того же получается ну я так и не понял в противовес что ли соответственно мой выбор выбор пал на лидеров отрасли те кто создает 1 черные движки и браузере они и пишут спецификацию естественная и исследовал этой спецификации при этом это живой стандарт то есть она пишется real-time то есть можно зайти f5 нажать и будет дата изменится что кто-то что-то в ней внес что-то уже изменились то есть пилится постоянно это конечно круто но бывает возникают проблемы когда ты пишешь пишешь пищи что там хоб чуть поменяли у меня такое было собственно как выглядит парсинг html страницы как от байта vopak тока прийти до дом дерево давайте просто любой польше практически так устроен это битовый поток декаде преобразованием предварительная обработка к это полученных данных таки не затари там построение парсинг в данном случае построения дерева парсинг да то есть в принципе любая там джейсон поселка выглядит именно схема общее будет такая же примерно рассмотрим начальной стадии to buy the мой поток иди кадир что происходит у нас ожидается что на вход мы получим байковый поток причем неизвестно какой нам надо определить нам надо сконвертировать изба этого потока в код поинты это unicode ные символы даю негодные символы при этом нам доступно 21 кодировка минимально спецификаций оговаривать двадцать одну кодировку написано так что минимум 21 кодировка а делать вы можете хоть сколько угодно но как бы понятное дело что все останавливаются на этом списке поддержки 21 кодировки и все если мы не знаем кодировку может случиться так что ваши типе к нам пришел почти без заголовки на мне указали кодировку у нас байковый поток а нам надо из него сделать код point и мы этого не знаем кто спецификация описывает алгоритм который приобрел преобразую который алгоритм поиска кодировки в тысячах байтах encoding sniffing алгоритм он называется и он очень простой простой в том что мы ожидаем одного из двух либо когда пройдет 1 1024 байт либо 500 миллисекунд от первых поступления первых данных как только что-то из этого сработает мы запускаем алгоритму давайте легкий и простой который быстро пытается найти те км от метра в которой мы указан в котором указано кодировка если все вообще весь расчет на то что у нас обычная метод кодировка указывается в самом начале всегда в голове где то что имела мы имеем эту кодировку если там будут что-то более сложное какие-то элементы теги которые там текст арея какая-нибудь таволга римской что сломается потому что он там такой очень простой быстро получить быстро найти кодировку после того как мы кодировку находим мы перепили включаемся предварительной обработки данных то есть мы преобразовали изба этого потока в код поинты в unicode символ и и теперь нам надо из них выкинуть ненужное как это делается что делается именно мы удаляемся переводы каретки с ней лайнам вместе мы преобразуем их в период каретки а перевод каретки уже в нью лайн так ими написано в спецификации но никто так не делает все просто смотрит примут каретки потом смотрим что дальше идет newline и заменяют на newline и все ну и встречающийся переводы каретки без следующего не лайна заменяют на нее лань и все это вся предварительная обработка в принципе html спецификация у нас общается нам о том что могут быть у нас ошибки парсинга это означает следующее это ничего страшного не обозначает ошибка парсинга это личного общения что-то пошло не так программист там разработчик html сделал какую-то такой что мы его понять можем но он кривой и мы сообщим обычно что слушайте какой-то косяк ошибка парсинга но продолжим дальше html обрабатывать это происходит на каждом третьем сайте просто вы этого не видеть когда было уже открываете он что-то обрабатывает вы этого просто не замечаете это все происходит внутри все суррогатные парень управляющие символы и null и вызывают ошибку пальцы парсинга суррогатных парковочным или нет и они не поддерживаются когда происходит дальнейшая обработка все это выкидывается соответственно это мы рассмотрели таки не затар следующий очень важная часть самая такая важно это такие не зато на нее ложится очень много это определить в потоке символов определите у нас теги где текст то есть создать токены на все это дело что такое таки не за то что им или таки не зато имеет 80 они это очень много в каждом состоянии описываются правило для каждого символа куда таки не забуду перейти дальше так и не затар формирует 6 токенов это док type doctype имеет свою уникальную структуру не похожее на остальные элементы открывающие тех закрывающие те комментарии символьный talkin' и and file то есть когда данные закончен и собственно взглянем на каждой токи что именно спецификация описывается как каждый токен должен выглядеть выглядит он просто doctype его имя html паблике систем индификатор и в html5 приняты исключительно только такой доктор доктор по штейн все остальное это ошибка парсинга либо перевод его флажка смог некий который потом будет влиять на работу с дом из css вот это единственный валидный сейчас на данный момент doctype который надо использовать открывающий тег довольно таки простой я думаю кто работал с html все знают как он выглядит у него есть тип естественно открывающий что он имя лифте к примеру атрибуты и флаги ссылку локинг коучинг в html и нет такого понятия есть такое понятие совков чем но он никак не отрабатывается если вы поставите к диву soft closing the будет во время постинга вызвано ошибка парсинга но если его поставить примеру квайт элементу а вот элемент это мета то ничего не будет внутри неких ошибок не вызовется спецификация позволяет для войта элементов указывать ну то есть это бессмысленно абсолютно к любому тега указывать soft closing параметр бессмысленно абсолютно только проблем можно перевестись закрывающий тег точно такой же как открывающий за исключением того что у него атрибут у него могут присутствовать атрибуты но это также ошибка парсинга когда мы на вход последнее дерево примем закрывающий тег с атрибутами мы поругаемся скажем вот понаписали выкинем все атрибуты и будем использовать его как закрывать как обычно закрывающийся тег то есть ничего сверхестественного это ошибка более того он даже флаг может содержать слов clothing закрываешь тех еще может содержать сил clothing флаг с вообще бессмысленно кучу ошибок по линии в скорости и так далее talkin' комментарий простой мы берем просто все данные которые есть и копируем их их в токен полностью вот как что пришло запихали в токио и отдали дальше ничего особенного и самый от это символьный talkin' дело в том что любой текст любые символы между тегами которые у вас html есть это перевода строки и пробелы все же любят делать а что имел красивенький чтобы он шёл таким упорядоченным ну т.е. деревом древовидным это все об для браузера ну в плане для обработки дело в том что на каждый вот такой newline на каждый про бельчик будет создан talkin' символьный токен и отправлен в построении дерева ровно на каждый символ будет создаваться это дикая работы собственно зачем это сделано потом построение дерева у нас будет смотреть ага что ко мне пришло ко мне пришел там ну символ ну то есть не 0 именно он уж пришел и скорее всего мне ему надо выкинуть у меня не может быть мало либо прибыль преобразовать этот символ в такой вопрос некие символы реплей символы по просекам либо преобразовать это символ так в такой вопросик и and a file данные закончились все отлично значит пользователь уже практически увидел страницу самый простой токен собственно данные в токенах всегда преобразованный в такими затар всегда данные имеет уже конечные дальше они никак не будут преобразоваться спецификация всегда дальше рассуждать уже будет steam смыслом что у вас в токены данные все лежат готовы мы по нему в токен мы можем пойти посмотреть при анализировать что лежит сравните так далее собственно вот на примере копий reference то есть чего ли reference у нас превращается в копий именно unicode ный символ данные всегда подготовлены в токенах и состоянии такими зато со свои состояния знает процентов на 40 это очень плохо дело в том что таки не за тариф вовсю управляет настроение дерево процентов 40 своих состояний знает таки не завтра сам все остальное все остальные состояния знает построение дерева получается такая зависимость то есть если кто знает а что имела его на инту все уже знают простой до безумия если взять ток тайтл все такой тайтл знают так то он чтобы его закрыть он ожидает исключительно закрытие тайтл там могут быть любые те теги но они будут воспринимать как текст вот такие не зато рисом на эту стадию переключиться не может он отдает так этот тайтл отдают построению дерево построения дерева вокруг этого ко мне пришел тайтл это очень важный как он должен работать не как все отработать внутри текста и соответственно говорит что таки не затар мне не важно куда там переключился переключайся сейчас на стадию если да то так называемой статуи богини зато переключается послушная отрабатывает переходит там default ну то есть по умолчанию в свою там стадию поиска дальше элементов собственно процентов 60 состояний знает именно последнее дерево это я рассказываю на самом деле уже проблемах то что вот это все закручивается как в html ну и последние статьи это построение дерева построения дом то есть это также конечно автомат принимает токены поодиночке по одному имеет 23 состояния с кучей условий 120 по моему 8 или 123 тега присутствует во что имел описанных там почти на каждой есть свои условия они все по-разному должны вставляться дерево в дом то есть там очень много условий если спецификацию открыть можно обогреть сколько надо программировать реально содержит строит настоящий дом многие считают что дом строится отдельно я часто разговаривал с разработчиками гает что ну погоди html же дерево строится а потом мы должны сформировать дом даже в всех в по моему браузер делали чуваки они по моему html именно формирует отдельно а потом из него дом формирует самом деле нет спецификации написано все как то так очень странно но все элементы дом svg математический html формируется в настоящий дом сразу же то и се на построение дерева этим и занимается на этом в принципе общей рассказ о том как строится дерево закончен и мы можем именно взглянуть я могу озвучить проблемы которые вы и так уже услышали это токи на каждый символ то есть на каждый у вас примеру новостная статья обычно 1000 символов содержит в себе новости вот на каждую чем волос будет создаваться таким и отдаваться построение дерева и монолитной системой так так как сейчас хайпить персону skype мика сервисы вот монолит слово присутствует пытаемся от него избавиться монолитно система именно в том что состояние таки не зато меняют все кому не лень то есть это очень плохо на самом деле мы не можем первое отвлекусь мы первая моя разработка была моей html где ipad рядом разбил таки не затар построения дерева и обработку данных разделил но там получился контекст вич контекст фич очень дорогой на процессоре должна была часто останавливаться и пространство имен проблема я ее специально оставил на потом потому что многие разработчики не знают вообще в html и про пространство имен у меня есть куча всяких программистов знакомых верстальщиков которые дают но стопка стенд возьмем на in space ты же они были в xhtml вас прямо у 5 на не отсутствует на самом деле нет с ними конечный от дом спецификации не html а именно дом спецификация описывать 6 на экспрессов это html математически из в игре слинг смл xmlns участвовать в построении дом когда к нам приходит приходят байты когда мы строим именно дерево участвующего 3 namespace а это html математические слуги это реально зубная боль сейчас объясню почему к примеру в пространстве имен html если у нас придет textile то внутри его все должно быть текстом пока он не встретил свое закрытие то есть все должно быть текстом пока не встретит своем закрытии а вот уже в svg namespace textile считается обычным тегом то есть для него нет нам особых правил это обычный элемент он может содержать себе элементы вот если написать то есть что у нас получается на самом деле вот именно зубная боль у нас таки не затар не может менять все свои состояния только построение дерева меняет процентов 60 настроения дерево меняет состояние в такие не затари при этом еще построения дерева должно учитывать namespace и в каком мы на экспрессе находимся что нам дальше создавать это конечно и от и все это надо в таки не за то ли лишь для того чтобы обработать провинность и дата лишь для этого то есть такие не затар должен всегда знать как строится сейчас дерево только лишь для этого что это такое в svg в си дату завертывают всякие данные которые надо экране жевать вроде как эти данные вы слуга вот этот конкретный пример сиди вам выдвигает работается хорошо построиться элемент div а в нем будет слово апельсинчик все будет замечательно но в html это будет по моему комментарий div с комментарием сида то там вот это все будет комментарий завернут а вот именно вот эта проблема с седа то и мне не позволило в свои во имя нормально разбанить это всю на процессы то есть разделить все на каждый должен при себя все узнать вот этот отвод эта каша это лапша такая полная которая просто всегда убивала в итоге итоговый процесс html и парсинга как выглядит на самом деле у нас берется один символ всего лишь один отдается в таки не затар мы его суём в таки не завтрак таки не за то ли у крутит его этого я с этим одним символом могу сделать talkin' делает talkin' и отправляет его построение дерева построение дерева добавляет его он естественно в дерево символьными элементами здесь кромешный ад что происходит символьными токенами мы получаем символьный токен смотрим что построение дерева смотрят ага ко мне пришел символьный talkin' я иду в дерево и смотрю на текущей позиции у меня есть символы если символов нет то я создаю элемент текста и добавляю туда символ и так вот 1000 к примеру символов будут каждый раз проверку приходить каждый раз будет смотреться если там текста вы добавить и чем это плохо мы не знаем размер памяти сколько нам выделить никогда у нас эти символы приходят постоянно кучей рио локи и прочие проблемы именно за суд отсюда то есть вот это именно большая проблема как все это победить самое важное самое ожидаемое наверное лет сбор лекс бог это моя новая разработка для усиленного движка ли не у меня было их целых 2 до этого 1 просто так ли ухнуло 2 инвестор не сошлись и третье я просто ночь делать 1 и все назвал это все лишь сбор я поступил просто я выкинул предварительную обработку для начала иди котик на самом деле декаде присутствует просто он самом начале присутствует мы конвертируем из нужную нам кодировку но я оставляю байковый поток дальше и они создают символов hotpoint фсю не кодом я работаю исключительно с байтами utf-8 в байтов в байтах не создаю hotpoint и потому что не тяжелый с ними потом заманить еще работать а если придут суррогатный парень дальше они могут там прийти в одном месте вообще кромешный ад оставляю байковый поток убирая предварительную обработку мне надо перенести и и определиться с переводами каретки собственно таки не за так ничего не знает про перевод каретки так как он считает что мы его выкинули предварительно нигде этого ничего не описано мне надо в куча стадии таки не завтра добавить что перевод каретки это у нас правильный символ чтобы он считал чтобы он создавал токен добавляя этот символ иначе он там будет каша и я не создаю никакие into this то есть не обрабатывают то генераторы на самом деле получается очень тупой настолько тупой что он вообще не занимается ничем кроме доставления меток и определение куда как сформировать talking я никакие данные не преобразуют не преобразую на стадии таки не завтра вообще никаких почему так сделано на самом деле потому что все данные по моему замыслу будут конвертированы в нужный формат в момент построения дерева ровно в тот момент когда talkin' пойдет построение дерева он покрутит построение дерева скажут ага понятно я знаю куда это вставить и я знаю в каком виде это должно быть собственно это все уходит туда я больше не работаю ни с какими именами тегов все сто там чем-то тегов я создал перечисление они все имеют индификатор даже и символы имеет свой индификатор вымышленный тех текст там-то двумя нижнем подчеркивании текст все имеет индификатор и с этого момента мы оперируем исключительно числами мы пытаемся предпо таимся привести все к числам собственно как это выглядит это статическая таблица хэш моя собственная именно для быстрой работы с этими данными статическая таблица если пришел тех неизвестный потому что так вы любой можете создать там василий гордый рыцарь и так далее такой тег может присутствовать соответственно я смотрю сначала в статической хэш-таблицы если у меня такого тебя нет то я иду смотрю в динамической хэш-таблицы которая была выделена если там его нет то я добавляю назначу индификатор то есть у меня появился новый так такой де и пуля you дальше это на самом деле выиграть большой от этого гигантский процентов 40 наверное всей скорости преодоление проблем со скоростью именно в этом кроется в этом ключе это гайде что дальше ни с какими именами мы не работаем но это потом еще в доме нам выстрелит причем выстрелит так хорошо что надо будет немного под колбасить но об этом я рассказывать не буду сегодня не слишком хитрых собственно я унифицирован все токены теперь нету отдельный кто кино в таким есть только один и он всегда по кругу ходит будет один ходить он вообще статический практике буквально он выделяется 1с и по всем стадиям приходит всегда он когда дошел до дерева дерево с ним что-то сделала он за чистился и заново то есть мы не тратим память у нас он всегда только один и для единственное что для doctype а у нас атрибуты для него получились doctype им имеет свою структуру и для него для doctype а мне пришлось сразу выделить и атрибута нонейм паблик и систем индификатор и они даже если их не будет присутствовать на пользователь не указал память под них будет выделено под эти атрибуты чтобы мне дальше понять что указали указали на ему cavalli системы public вот окну и флаги открывающий тег закрывающийся тег текст дата исида the sea doo toeic works флаг строители нет то есть такой общий один так на все получился такими за тариф с этого момента естественно никаких данных не содержит ничего в нем нет он имеет только метки а дальше головная боль начнется с челками так как html у нас могут отдавать или ванной он может быть порвана у нас из буфера с интернетом и качаем у нас везде все польза на а мы метки только ставим хитро хитро как потом данные будем читать это большая проблема была собственная данные не приобрел не преобразуется ну и быстро пробежимся как от на выглядит doctype то есть то гайде у него будет lsb так я им doctype начинается с д там заканчивается на пробел имеет атрибут html открывающийся тег цэлт clothing ну то есть просто мы унифицировали все и ничего сверхестественного все-все привели к единому виду комментарии все также содержит только метки и вот символьные токина у нас больше нет у нас теперь токен отныне текстовый появился я выкинул сильным only talkin' теперь у нас текстовый он содержит метку на весь текст я не передаю теперь по одному токи ну символьном у дальше только весь текст только хардкор дальше это выстреле потрясающий в том плане что построение дерева у нас ожидает исключительно символы он ждет каждый символ при проверять повторение дереве все условия связаны символьными символьными токены были изменены то есть они вообще переделана переработанный в каждом из двадцати трех состояний построения дерева присутствует по две-три а по два три условия по для символьного токен а теперь их нет теперь только один у нас пришел текст а дальше смотря где он пришел смотря что он себе содержит запускается функция с кучей параметров примеру выкинуть null и все и сообщить нам обратно были ли там null и потому что логика зависит построение дерева даже от того если был ну в среди символов то логика поменяется построение дерева это все надо учитывать собственно перри колбасило это место полностью и благодаря этому теперь когда мне приходит текстовый talkin' я его сразу просто вставляю в дерево не глядя что там есть мне не надо проверять мне не надо добавлять заново ну то есть добавлять в конец всегда символы как пришел вставил и пошел дальше то есть моментально делается без каких-либо преобразований далее чтобы повысить производительность а также запустить всевозможные оптимизации компилятора я добавил изолятор в каждый в каждую стадию такими zatarra спецификации говорится следующим образом что мы должны взять символ и внутри каждой стадии посмотреть ага что это за символ и поменять поменять состоянии такими затар и теперь это происходит практически также но не так дело в том что текста может быть ваш то имел многое из мое изображение были текста может быть много даже атрибут имя атрибута ну минимум содержит 4 5 символов зачем нам каждый раз прогонять это через таки не затар по символу мы быстро найдём начало конец и пойдем дальше в этом большая проблема дело в том что если html будет рваный вот эта проблема когда то есть в спецификации по умолчанию получается поддержка и чанков и да получается по умолчанию поддержка чанков присутствует и там не надо задумываться о том что у нас html польется но по одному символу всегда курил с этого момента таки не зато у меня не соответствует никаким спецификациям вообще никаким он мой особенный он и не должен не соответствовать чему-либо потому что никто не использует таки не затар всем нужно конечно и дерево итоговая дом что мана чтобы она была настоящим проблемой как я и говорил чанки из коробки у меня не поддерживались изначально я реально плакал и думал как поддержать и данные в токе не стоит а за проблемы собственном пришло от пришло два куска тех пор данным из интернета что то качаем буфер сначала у нас пришел один мы получили дивка закончилась с и мой муж у нас пришло в следующем буфере из всего моего таки не зато естественно не получается просто так взять и этот буфер потом посмотреть так как данные я в токе не накапливают я беру только метки и соответственно в построении дерева я не могу ничего посмотреть я не знаю где у меня что порвалась как как порвалась для этого проблему решил я просто на самом деле я добавил young incoming некий буфер который что делает когда данный кусок ко мне пришел так и не затар его обработал и построение дерева пинает чувак мы не закончили этот буфер был не полный мне надо еще там вот как как минимум заклейте на это я говорю ok хорошо значит что получит а как пользователь бушер скорее всего в сети мы все буферы затеряемся нам buzzer пришел мы данные отдали ее тоже буфер перемололи затем ли мы данные сохраняем свой бушер копируем их нещадно и как только нужные данные к нам придут полностью так и не завтра скажет блин помнишь я вот тот так не заклеил у меня не были да не было данных они сейчас пришли а ты сохранил буфер уничтожаем это больше не надо соответственно у меня бушере не копятся они на самом деле быстро грохается уничтожаются все это отлетает ну довольно таки быстро и проблемы с данными в такими затари есть такая классная штука как посмотреть какие данные у нас сейчас в токио я данных не храню атаки не завтра хочет их посмотреть with a drug глянем а если у меня сейчас там скрипт текст ну естественно я не как посмотреть не могу я решил эту проблему исключительно добавлением еще 15 по моему или 20 состояние в таки не затар было 80 стала 95 листа когда данные определенные я знаю что дальше будет пробежка если данное определенные пришли я просто ветвление делаю такое что если данные по если оттуда значит ok скрип был если оттуда значит не было ну то есть легкое легкое решение проблем ну и самые последние стадия это построение дерева как я уже и говорил что построение дерева спецификации проверяет именно символы и условий там достаточно на эти символы и меняется как бы само построение дерева зависимости от того какие символы пришли также меняется то есть логика меняется отныне у меня есть тут функция на самом деле не правильная функция есть одна глобальная функция который понимает один большой параметр такой в котором перечислены множество выкидывать null и не выкидывать что делать стенд эти источники символьными референц сами что делать обрабатывать или не обрабатывать потому что рав скрипте когда пришел текст их не надо обрабатывать они там могут быть а если пришло где-то там в обычном тексте то надо собственно именно в этот момент данные стоки на конвертируется в дереве и если они только нужны то есть часто бывает ну как часто бывает так что данные не надо конвертировать лишнюю работу мы не делаем у нас данные прилетели мы посмотрели что ok этот токен реально blink классный talking будет участвовать у нас в построении деле вы мы его обработали тысяч конвертировали данные в нем и вставили в дерево все довольно таки просто в итоге для сбора html соответствует спецификации то есть вот с помощью вот этих сложных преобразований разрушая полностью таки не зато абсолютно в щепки который перестал соответствовать спецификации далее при деловые манипуляции в построении дерева мы вернулись к тому что требует спецификация мы поддерживаем полностью спецификацию то есть все соответствует тому что от нас требует спецификация на выходе я прихожу все абсолютно тесты которые только можно на правильность построение дерева все прям сад и обычно спрашивать как в браузере я куда как в браузере парни все будет ровно также главный вопрос обычно спешит в браузере также и куда точно так же не беспокойтесь и поддерживающий интерфейс интерфейс of много около ста наверно интерфейс это html элемент там хаит элемент вот эти все его скриптами которые они у меня реализованы все я их все поддерживаю они все присутствуют то есть это вы полноценный дом в итоге чтобы где gboard произошло я убрал предварительную обработку перенес ее в таки не затар полностью принял нет как не принес таки не зато я предварительную обработку перенес в таки не зато именно проверку что перевод каретки теперь у нас символе корабельный символ и дальше отдаю его в построении дерева именно построение дерева должно понимать и знать у меня выкидывать этот период каретки и или нет всегда выкидывается на самом деле абсолютно нет там никаких исключений всегда выкидывается атаки не за тару унифицированные токены символьные talkin' отсутствует только текста вы всегда любой текст идет полностью отдается более никаких символов поодиночке ничего такого свой эпилятор в каждом состоянии такими zatarra присутствует обработка ну как уже сказал токенов после построения дерева ну и также один таким на все я не выделяю на самом деле честно говоря никто не выделяет кучу токенов везде все выделяют только один таки на его там по кругу при пропускают но просто у меня он унифицированный есть конечно лишь и которые выделяют по тысяче токи настроить плохие люди у меня выделяется 1 ну и в принципе все стараются сделать также по спецификации полностью пишут смотрит что токен можно выделить один всего лишь них там гонять его и все и соответственно дерево в последнее дерево стадии мы модифицировали немногое только лишнего бутуз текстов на самом деле все звучит это просто из слов и даже банально но проблем там много я затронул только основное проблем куда нам это стреляет вот такая обработка очень много именно в построении дерева и в такими затари таки не за то ли мы вообще всегда должны знать что мы делаем мы теперь отошли от спецификации и нам надо самим соображать что когда нам надо отправить текстовый talking не дальше по сеулу пуляли а теперь на надо знать где закончился текст и когда его отправить сакс конями на самом деле ну естественно все эти байки мои рассказы про то какое классное как я все сделал не не что если не сравнить взять спеху все что сделано по спецификации и мою реализацию ну разница примерно такая сорок один мегабайт поспеть и обрабатывается что и мыло амазонов ского у меня где-то 235 на 250 когда как более того если в любую любую любой пары построение дерева который поспеть и сделано отправить какие какой-нибудь бинарник сказать на кушает а что имел он у вас выживет столько памяти будет очень долго обрабатывать все у меня это делается за доли секунд благодаря тому что у меня все эти текстовые токина передаются сразу и конвертируется после выигрыш вообще во всем в памяти в скорости то есть вообще эльдорадо аллилуйя просто серьезно на самом деле потом после так как после того как я вот это сделал и ко мне пришел человек и говорить на те 400 долларов и делами обвязку для php для моего каблуки давай деньги сейчас все сделаем час все будет и он горит самую быстро и что я нашел это была реализация на гол и куда ладно kaigu там чуть смесь фигня давай сейчас приобрести ли он берет башмачки запускаем и реально гол это я просто в + поставлю гол делает 60 мегабайт of the еще он по спецификации то же самое буквально что у самых быстрых написано ну код один практически в галатам и всех плюсы я взял смотрел и он просто рвет и плюсы и реализацию подход один и тот же но вполне у всех и гул порвал я был удивлен меня конечно не порвал я выдохнула фух слава богу куда этот гол там в отличие от моего си в общем такие дела на этом все но на самом деле я хотел очень многое рассказать потому что там очень много всего но информации до конференции но и не слишком сложно потом я подумал что это слишком много технических деталей о них рассказывать сложно это скорее всего в следующий раз будет выливаться в статье на хабре или там что-то такое потому что слишком сложно и я затронул только верхушку это самый верх это не то есть там еще всего хватает более того улучшить результат я могу где-то еще в два раза свой и знаю как здесь не расскажу просто это уже оптимизация такая не нужная мне пока ну знаю как в полтора-два раза улучшить ищу все эти показать или но сейчас я занят с а сам я знаю как делать css так же самый быстрый более того я удел вообще пофиг и все в этого вопросы если есть я не задержу как отлично слушайте спасибо прикольной доклад и вот последним проблем с этим как раз у меня на протяжении всего доклад в гладио был вопрос как вы решаете проблему рендером то есть мы хорошо вы создали дерево html построили но потом мы можем поменять разрешению браузера сжатие при помощи css и можем изменить наш дом дерево и если вы просто будете также перестраивать то вызовите рендера всей страниц что плохо я не был вопрос я не понял саму суть проблем которые писали проблема поймите что из javascript а кто-то что-то поменял не только из-за javascript а еще есть css а ну мы должны будем формировать страницу элементы при помощи него вы должны пересчитать стиля и пересчитать все дерево которое должно получиться заново и там может получить 1002 нефти прибиваю я не хотел бы номер диссонанс это больше уже о слоях layout то есть сам аж тайну то есть само построение дерева здесь как играет хорошо у меня css может изменить в чем проблема поменять ну то есть у меня конечный итоговый дом это уже все таки css мы говорим сейчас о css именно о расчетах лаут то что будет происходить дальше это дерево отрисовки она строится отдельно вы про это том числе дерево отрисовки строится отдельно все расчеты дерево отрисовки это не дом дом это дом а дерево отрисовки она рядом layout то есть он рассчитывается это уже другой дом мы не можем его поменять дело в том что в дерево отрисовки мы же будем выкидывать не нужно то что в цехе если указано к примеру там дисплей я не помню ну что не надо показывать просто в из дома он не будет перекинут в дерево отрисовки вообще не не будет участвовать вот именно дерево отрисовки мы можем менять как хотим по своему усмотрению а дом мы не имеем права это пользователь сделал мы не можем взять что-то из лице захотелось там выдернуть нет то есть это разная вот вы именно у меня и именно диссонанс из-за этого произошёл что это дерево отрисовки об этом на самом деле я хотел бы рассказать в следующем году и как там там очень много всего там просто все вкусное великолепная ну для доклада это сложно будет мне кажется болт кроме послушная если бунин пустит меня еще раз обалдуи такого ту я приду расскажу обязательно а он парень раз все спасибо за доклад скажите какие есть стратегии для ира recovery допустим то там deep забыл поставить лишним таком духе и вообще но можно ли как то такие вещи отлавливать нас получался таки дом более меня используя отечественные разработки вы слушали эти ошибки без того чтобы я очень вам никогда не покажет пальцем кирове так называемые паршин кирове это то что но пользователь накал basil такого что нам приходится запускать алгоритмы спецификация описывать несколько алгоритмов обработки неправильно что и мало когда мы неверно заклеили ты где-то у нас ожидал все закрытие о пришлось что-то безумное и нам надо запускать некоторые алгоритмы они очень большие я ненавижу 2 алгоритмы этих писать они занимают в коде где-то тысячу строк это одна функция восстановление если вы попортили html как то что нам надо его восстанавливать вы плохие люди вы запускаете монстра катуху которая будет выносить ресурсы будет обходить дерево будет заниматься копированием будет клоны делать нот это все очень сложно вот браузере не сообщают об этом у себя я реализовал то есть если я стою мамку отдать неправильную она вам наплюет скажут точки где случай чувак тут чуть ты напортачил посматривайте места нoября утилиту su скрывают а не видим у нас не реализуют ошибки парсинга я ответил на вопрос а вот молодой человек уже мин петь сидит с рукой можно я тогда задам вопрос раз мне досталась микрофон да конечно у нас ставить союз практически последние самые ли вам два мини вопроса первый насколько дом который генерируется это библиотекой совместим с домом который генерируется там например chrome или firefox потому что как вы сами сказали алгоритмы обработки различных камер ксо не большие сложные соответственно здесь мы возможно как одеваться это первый вопрос во второй мини вопрос ну это же вещь насколько я услышал представлены в виде как библиотеки да если это так то билдинги для каких распространенных языков есть к этой библиотекой и меня по не может быть какие-то средства программирования и и которые чтобы просто взять и потрогать ну смотрите начну с конца сейчас я плюс доклады слушал там все так делают и я буду не исключением билдинги обычно ну если взять модель с мою предыдущую разработку там существует множество биндинг оф люди пришли сообщества там у меня куча звездочек на гитхабе 1000 там чем-то и люди пришли и сделают бензин gain a modest олег сбор движок мой еще практически никто не знает собственно вы 1 публика где я заявила его существование я еще до статьи не писал насчет его ну то есть но чаще всего происходит так что приходят люди к примеру индусы простите меня приходит и говорит слушай мы работаем на американцев а у вас так дешево разрабатывать нам link building делать на твою штуку вот те 400 долларов и дело и пожалуйста юг блин 400 баксов сервер же можно оплатить и быстрее там делаю bending на пользуйся и они там допиливают уже так как я им основу дал так как я как бы платформу дал они там допиливают для модеста предыдущие разработки где есть и css селекторы где уже там много было чего написано там книгой хватает разных бетонный пепел php всякие есть для этого ничего нет потому что я еще не и не объявлял но я думаю будет потому что там парни которые делают предыдущий билдинги они за мной наблюдают и все на старте ну то есть такие дай нам команду мы сделаем но в основном за деньги первый вопрос уже 1 в 1 соответствует этим дерьмом который в браузерах будет но в плане этот дом он я делаю по той спецификации который пишет google microsoft мазилы могилы кто что мы счета был apple наверное да вот один в один будет соответствовать дом будет такой же html не правильно обрабатывать также будет вот вообще один в один никак вот нет как близнецы просто младенцы реально не отличите я думаю ответил вот парень прям пять минут уже реально juke отводится такой вопрос вы рассказали про спецификации и про ваши отличия а известно насколько сами разработчики того же допустим chromium следовать этим спецификации или может быть они внутри используют подобные слушайте я этом темизация я перебиваю всегда такая особенность тысяча извинений я смотрел bobcat я не смотрел blink но помой blink это копия вы какие то просто namespace поправили ну так не я посмотрел как реализовано построение дерева в хроме в хаме уме получает кроме уме и blink значит я смотрел в храме вами запутался кроме смотрел построение дерева там реализованную них своим вообще способом текстовые данные на самом деле не помню шлют они или нет не могу сказать помню что глаз не зацепился честно сказать не знаю надо глянуть но знаю что я их ум на ура вот именно выкорчевывая их исключительно парсинг а там дом просто как вот стоять и на и нет ну честно без мне еще рассказывал про то как у нас страница постепенно приезжает да и соответственно там накапливается в гуфи символы это относится к скажем прогрессивным приложением когда у нас страница может отрисоваться постепенно а вообще по моему в браузере если я вопрос правильно понял вообще браузер по моему штыки не за то ли отдает сану по 496 да помоему байт отдается туда вот такими кусками чтобы она строилась но в нужный момент мы поймали что окей мы тут уже шапка типа нарисовали я можно показать пользователю таким образом у меня ничем не отличается все чанки я поддерживаю я хоть по одному байту могу отдавать туда также ну то есть если вопрос именно в этом хоть по одному байту без проблем но это конечно безумие по одному байту отдавать ну вообще не вопрос то есть хоть как именно как сказать на вход не простить мне на выход мы будем все иметь как по спецификации то что внутри это уже упакованный черный ящик но в плане о которым я рассказал а так все как у людей спасибо за доклад такой вопрос вот тоже про этот буфер и про чанки что будет если так и не придет остаток не будет конца те года то есть этот буфер будет держаться жить здание не будет мы пошлем and a file токин в построении дерева поощрение какого то времени нет на но стоп поганить это уже сетевая реализация то есть если у вас тайм-аут выставлены это одно если отвечать на вопрос если мы по середине т.к. где-то оборвали ну там полями тоже на и по имени параметра посередине оборвали и данных больше нет мы шлём in the file токен тогда вообще в html нельзя сразу скажу нельзя восстановить html таким как он был если мы на вход байты подали вы никогда не получите то же самое что было у вас в этом виде ко мне часто люди приходят и говорят мы тут смотрим трафик государством с германии мне приходили деньги предлагали какие-то чуваки поможет германии но представляете вид мы тут смотрим трафика куча ты нам векторе шов ставь показали мне места чтобы поддерживать процентный вектор еще более быстро и нам надо чтобы на вход вот поступившая что им i'll make the манипуляции сделали и собрали его выход на так не будет так нельзя почему потому что это вот ответ на ваш вопрос если к нам пришел незавершенный так он где-то оборван либо пользователи как-то его там криво сформировал это даже не конец по спецификации мы должны выкинуть полностью никак не использовать будет считаться что все на вершину то есть мне тут по часам бьют ногами по голове но я думаю на вопрос ответил я могу выйти там еще если кто хочет по домогаться отвечу"
}