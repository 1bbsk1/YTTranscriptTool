{
  "video_id": "V-cwPLtDtSY",
  "channel": "HighLoadChannel",
  "title": "Continuous Database Administration / Николай Самохвалов (PostgreSQL.support)",
  "views": 2106,
  "duration": 2627,
  "published": "2018-11-20T12:30:17-08:00",
  "text": "1 да спасибо вам николай и мы сегодня будем говорить о будущем ну и на самом деле настоящим значит во первых применительно к контексту этой конференции я вот уже там 10 или 11 лет являюсь членом программным комитетом богат как бы коньков и также holod который очень мне будет и скоро будет все берез все знаете так же у меня есть опыт больше 12 лет работы с подвесом и больше 17 вообще с обода различными про соцсети говорить не будем я так же рад что я что мне посчастливилось быть основателем rupes газ присоединяйтесь у нас уже больше тысячи шестьсот человек на митап много на youtube мы сейчас много проводим онлайн встреч ну немного но хотелось бы больше конечно но смысл в том что где бы вы ни находились вы можете повышать свой уровень образования в плане баз данных и по фгос в частности участвуя в общем призываю всех участвовать если вы интересуетесь плоскости он также подписывайтесь на мой twitter там много всего постоянно публикуются ну и сейчас я живу в калифорнии и консультирую различные компании стартапы и не только стартапы как делать под газ и наша фишка в том что мы делаем так чтобы нас больше дальше не нужно было то есть если у вас есть проблемы мы не только их решаем а также на лад налаживаем механизмы решения этих проблем будущем автоматизируем это эти механизмы после сколь . сапог пару слов о том что такое тебе сегодня надеюсь уложусь в действительно в пару минут есть такая штука hacker news многие 2 за знают а дай забыл кто из вас под gas использует слева меньше чем справа окей ну почти все на самом деле хорошо аудитории контекстная значит есть такая штука hacker news и там каждый месяц публикуются вакансии стартапов хуй с harling месяц в месяц год и довольно много там вот больше 1000 сообщений в апреле и это очень хороший способ узнавать какие технологии в стартапах в долине не только удалению сейчас в тренде и есть вот такая штука hacker news транс dot com который автоматически анализирует они на днях сделали поджи нацию то есть там теперь ну мол и постраничный вывод может быть от штука уже сломалась но я успел сделать скриншот графиков общем-то под газ растет очень уверенно больше 12 процентов компанией упоминают слова под газ в своих вакансиях компании подчеркивают стартапов майской падает манга падает оракал стабилен если вы туда засунуть любую су б.д. она будет ниже я разные пробовал просто максимум 4 на одном графике носим пост растет если да вот подтверждение 12 125 упоминание под газ а здорово чтобы это если мы поищем слова дибил ну тут честный поиска там фидбэк тебе тоже содержит но его откидываем значит пробел одно упоминание в апреле 0 в мае то есть стартапам детей уже не нужны это реальность почему так ну во-первых облака конечно же и надо сказать что наблюдение в долине такие что совершенно никак здесь повально стартапы и базы данных готовят в облаках все чаще менеджер ds до этого heroku теперь еще и мы красавцы гуглом подсуетились и сделали тоже - под газ если кто не слышал и google и microsoft доставляют по фгос достаточно нажать пару раз мышкой и у вас развернуто развёрнут instance на влажной репликация бэкапы и так далее devops инструмент развиваются может быть есть ещё какие-то причины почему стартапа мне нужен детей ну в целом это про автоматизацию и если вот думать может быть какое-то новое понятие возникает на месте тебе пока совершенно непонятно то есть лучшее что смог родить это перфомансы хакер то есть человек который отвечает за performance и баз данных ясно что после шторма зид хотя чаще всего не пожгли стр мази то те кто его использует это в общем то в общем самый близко что я смог придумать performance хакер похожая история на devops на самом деле сисадмин против devops вот сисадмин четыре раза стартапам понадобился в апреле а devops 148 но в случае devops получилось целую-целую нишу новую родить и а в базах данных пока непонятно ну хватит этими исследованиями заниматься давайте посмотрим что же уже автоматизировано менеджер облаками мышц базами данных в частности ардис puzzles google cloud platform сквер фапа згрлс езжу и так и heroku кампус и так далее во первых развертывания пара кликов у вас уже есть instance пара кликов у вас есть во вторых реплики и на них можно переключаться вручную автоматически на них нельзя переключаться также одна галочка и ваша цена за ваш мастер увеличивается в 2 раза за то вы как бы на вере она зону или гуглу вы понимаете что вы где-то там они создали вроде как реплику которую вам недостижимо но зато если что of the flower случится цена выслала два раза компания этому верят этой галочки и готовы платить дорого за свой продакшн естественно бэкапы автоматически из них восстановления легко по и пео или или кликами point and am recovery восстановление вы можете откатиться там можете два дня назад это очень удобно если у вас ручные ошибки возникли и какой-то базовый мониторинг чего еще нет тонкий тюнинг то есть и в rds и в гугле очень много вещей еще ну оставлены по дефолту типичный пример это настройки авто вакуума они дефолта вы и это нужно это в на ваших плечах конечно же тонкий тюнинг имеется ввиду под вашу нагрузку под ваши данные это все на ваших плечах вручную анализ оптимизация запросов ключевая вещь поиска и устранения тормозов б.д. вручную то есть в частности добавления индексов удаления ненужных индексов и так далее так далее и интересный момент проведения экспериментов это все вручную планирование ресурсами понимания когда у нас нужно будет добавлять место когда у нас данные перестанут умещаться в память это все опять же вручную ну детальную мониторинга пока нет хотя какие то с подвижки вот amazon в частности предпринимает интересные графики представляет пока правда для своей продвинутой версии под газ а аврора который супер дорогая в общем-то от крок справа красная часть она про что про то что у нас есть три уровня первое это обнаружение проблем то что сейчас решается мониторинга me второе это про предсказание проблема это уже посложнее но можно решить хотя бы дело и мониторинг на более ранних этапах чем пруд и третье это предотвращение проблем и это абсолютно мечта и вот на ней сегодня поговорим сразу скажу что я все не успею но после этого доклада будет митап он будет в зоне где вот нашими tab и для б катков в красной зоне не в синий не фронте но в комнате для докладчиков приглашаю всех комнату докладчиков даже кто не докладчик это мы поговорим про кишки вот этой темы теперь я который я сейчас увлекся и занимаюсь вот на самом деле про мечту эту мы поговорим но немного нами тапе на этом побольше но не нужно думать что это не как что-то совершенно недостижимое нерешаемые у коммерческих б д это все есть у microsoft есть и драйверы которые помогают нам создавать индексы и так далее у оракла сейчас прошлого года вообще весь маркетинг строится что они теперь не только в облаках а еще и сама настраиваемые в общем авто автономные клауд database с oracle а то есть и на самом деле тема вообще-то старая то есть первая статья появилась на эту тему от появилась в семьдесят шестом году то есть когда большинство из нас еще вообще природе не было вот но об этом еще раз говорю мы больше панаме топи поговорим о сейчас спустимся на землю и посмотрим что сейчас как происходит вообще у нас за министре ранее баз данных сейчас у нас если нам нужно ручная когда диагностика мониторинге окей метр хорош но мониторе все еще далеки от идеала в плане понимания что происходит внутри базы данных то конечно же с вами большинство из нас возьмет писк гель потому что пока админ полный шлак по-другому не скажешь подробно могу объяснить кулуарах песке или возьмем и попробуем что-то с этим сделать быстрое напоминание backstage ? показывает как их доступные команды backstage подскажет синтаксиса сквер если кто забыл а я все время забываю настроенные тоске и дальше и вот мы пришли в базу который мы ещё ни разу не были допустим нас попросили помочь 1 у нас вопрос а какие размеры баз данных в этом кластере пожгли словом а какие размеры таблиц и индексов внутри конкретной базы для этого есть backstage alt + backstage de plus который делится на backstage дите плюс это для таблиц для там для вьюшек вечера с тушек секунд of bags hd а и плюс покажут индексы плюсы он покажет с размерами то есть вы увидите конкретный размер да еще их ему на readable то есть прям 4 гигабайта отлично можно писать имя таблицы индекса вы увидите конкретный конкретного подопечного но нас интересует поиска самых больших вот мы сделали backsplash alt + посмотрите базы у нас есть в кластере наверное за видно отлично видно ну вот отлично у нас тут есть 16 баз и мы должны быстренько понять какие ждут самые большие а да еще вы же видите да тут все поехала верстка по halo чтобы она не поехала мы добавляем к песку lps пиджи очень полезная штука рекомендую классная добавка добавка к песку или она на ubuntu там и на других линуксах ставятся из пакета и развивается постоянно и общем то она делает он горизонтальный скроллинг вас таблиц становится нормальной таблицу они поехавшим непонятно что и значит вот мы должны понять а где здесь самая большая таблица оки наверно вот это которая по совпадению попала на первое место но это мой ноутбук 36 гигабайт а какая вторая но наверное вот это то есть вы файл в голове 16 этих строчек of paris сортировали да что там нашли а если таблицы вот в этой базе 38 таблиц 38 я уже вообще не могу то есть от все для меня не решаемая задача точно понятно тут нужно сортировку сортировки перский по умолчанию нет и тут как раз ада как обычно от решается мы идем в google еще ну дайте нам сниппет общем вот за 12 лет работы с полисом я вот на этой страничке был максим тасс как раз на это страничке вам как найти самые большие там таблицы лечили такое о максим в голове за бежит пиджи says прийти и так далее да понятно вслепую набирает максим но кто нибудь посложнее запросы ну такого этих идешь в свою подборку или клиенте счет ну вот я обычно это гуглил попадал над на твои же например скрипты или еще че-нибудь и и в общем-то это было вот 12 11 лет а теперь появился в прошлом году 10 позже стал ps qu'elle возможно возможность делать интерактив появилась потому что появилось backsplash iv я обрадовался и сделал такую штучку взяла скрипты максима еще нескольких ребят и компании которые имеют классные подборки в гитхабе написал несколько своих и сделал такую штучку и кота называется плоскость ebay это интерактивное менюшка со скриптами расширяемая и общем такой швейцарский нож для того чтоб под газ прощупать рекомендую использовать и а сейчас немножко пробежимся по что там есть внутри во первых вот менюшка то есть вы набираете : тебе прям в пешку и алиса сбить менюшку и теперь чтобы быстро посмотреть размеры этого общем я успел слепой максим набираешь 100 символов а я : бей 2 ну там 12 для таблицы и все и сразу видны размеры они видны вот так еще и тут вывел проценты часть табличную часть индексную часть толст примерное количество строк в общем-то и этот он вывел то есть мы сразу видим что происходит какой расклад по таблицам это вот отчет номер два : гибель enter 2 enter то есть вот мы попали туда кстати в hackers ведется обсуждение а не сделать ли нам и чтобы без enter а там биндить кнопки это на f что-нибудь повесить прямо в песке ли было бы интересно такое тоже еще быстрее бы работа происходило эти отчеты становятся прямо на кончики пальцев и поэтому когда вы уже привыкли к окну знаком в игрушки компьютерные играете знаете что вот эти вот три там четыре кнопки они все стираются быстро да вот это же самое очень быстро и просто вы будете давайте же те же самые уже привычные последовательности и это помогает лучше чувствовать базу даже может быть лучше чем какой-то мониторинг в которой еще надо мышками ходить ну кликать установка вот такая простая то есть всего нужно спланировать репозиторий и добавить вот эту строчку к себе в все файл для песка или и все важно чтобы сколь должен быть 10 версии сервер может быть другой версии можно отдельно установить клиент десятой версии на машину оставив сервер старый пакет а если удаленная базу можно sh туннель в ридми в ритме и в документации кстати пояса есть пример простой поехали дальше вот тебе все значит до нулевой отчет вам покажется информацию об этом иисусе под газ а аптайм количество чек-поинтов эффективность кэш конфликты до блоки вот это все там файлы какие установлены расширения то есть такая минимальная полезная информация чтоб понять вообще что у нас бы как конечно все это в моменте то есть никакой исторических данных которые есть конечно же мониторинге здесь вы не увидите дальше конкретная тема блоод которые здесь уже сегодня должна была освещаться пока допиливать доклады делал красные слайда места оранжевых у нас есть разные подходы самый популярный облачный мониторинг да это долг и давно реализовал первый подход и он совершенно неправильный то есть это очень примерный способ взять из текущих чисел перестать юзер тибблз и и просто посмотреть оценку количества строк оценку количества мертвых кортежей в общем-то это самый такой прямой прямолинейный слабый способ есть вот упоминал я уже скрипты максима и также 5 же эксперт и вот до либо у этих компаний есть разные вариации на самом деле примерно одно и то же идеи это тоже оценочный подход многие используют для оценки болото но он во первых легкий во вторых ошибается сильно реже и меньше но ошибается я сейчас покажу конкретный пример и если вы хотите точно вам нужно решение перестать упал и в общем с помощью него но оно доступно не везде с помощью него можете это сделать можете посмотреть реальные реальный размер болото таблиц и понять что у вас там автор баку мне дать у него и так далее но это большой стресс на могла мастере запускать не не стоит надо запускать на реплики которые еще не под нагрузкой то есть такие ограничения поэтому оценочные способы нам все еще нужны и полезны вот они b1 b2 b1 это блог для таблицы бы давать или блог для индексов и мы здесь видим что у нас вот там и второй таблице bloat примерно 15 процентов то есть 38 мегабайт это мертвый мертвые кортежи вопрос пока нет нет окей вот пример который ломает разница между этими двумя таблицами только порядке 2 3 столбца в первом мы первой таблице мы один байт восемь байт один байт во втором 118 и какая как вы думаете какая таблица будет больше какая меньше какая таблица будет больше первое правильный ответ то есть эта тема знакома уже то есть это ну вот первой таблицы на 15 процента больше выше мегабайт и почему вот питер иган сделал классную надстройку там на в общем пиджак сойдет вам позволяет цветную право только на линуксе заглянуть прямо в странице данных таблиц и практически всех видов индексов и посмотреть что там происходит и вот тут видно как раз что в первом случае за поединка у нас два раза по 7 байт расходуется а во втором только 96 иначе 14 минус 6 12 байт разница вот что такое line and feeding я за рамками я понимаю что ну подкованы и из неподкованные то подключитесь здесь ссылка на обсуждение 1 разъяснения именно вот этой штуки в подписи конечно после смог бы такое сам домысливать и в момент создания таблицы оптимизировать но он этого щас не делает может быть будет делать будущем не знаю вот и пока он это не делает я сделал такой отчет он в экспериментальный потому что река где-то еще может ломаться прошу пробовать и давать фидбэк этот отчет анализирует таблицу прикидывает какой бы был оптимальный вариант и высчитывает разницу между таблица и оптимальным вариантом вот максим из точек по ч вчера говорил вот и он еще предлагает конкретный порядок столбцов которые он считает что это оптимальный порядок таким образом если вы создаете таблицу и понимаете что она вы там будет содержать много гигабайт терабайт не знаю в будущем то классно конечно же подумать об этом самом начале потому что потом придется перестраивать всю таблицу вот если вы подумали об этом этой проблеме в начале она не так часто встречается но иногда встречается и бывает даже очень больно встречается там 30 процентов я видел расходуется вот в эти ноликами заполняется можно об этом подумать с помощью этого отчета в данных может еще не быть данные не обязательно и уже будет оценка то есть мы можем немножко вставить она уже ну она просто по по определению таблицы анализирует b3 b4 отказ перестать упал варианты точного анализа blood не запускать под нагрузкой запускайте на реплики которую можно грузить если у вас нет перестать упал вот я понимаю что вы все не в облаках но вы будете облаках через несколько лет поверьте я имею виду базы данных вы будете готовить в облаках меня на хабре вчера сильно обругали за этим разговоры вот но на самом деле просто просто еще как бы увидеть и вот я думаю что значит больше чем те кто ругает вот и конечно же там может не быть прежде чем он есть на ртс и но его нет на гугле нет на ажур нет нахер акулу и так далее или по какой причине вы не можете его использовать не можете реплику сделать иногда бывает если вы подозреваете что оценочный способ ошибочные то вы можете просто склонировать одну таблицу клеит select звездочка в 11 она еще и будет быстро и дальше просто ну в несколько на несколько ядер про рельсы и дальше просто сравнить размеры оригинала и клона и будет понятно если там правда блог или нет то есть такой на коленке способ иногда приходится принять работает еще одна штучка которая полезна одна из немногих ну нескольких полезных штучек в этом поезде бей это проанализировать какие индексы можно выкинуть здесь конечно же замечание что если вы анализируете только мастер реплики у вас нагружены select a mi то будьте аккуратнее реплики должны проанализировать потому что какой-то индекс может вообще не использоваться на мастере может быть полезен для реплики а вы его грохнуть не стоит так то есть эта штука она едва озера на это старая идея on оценивая находит во-первых неиспользуемые или мало используемые индексы и во-вторых redundant а есть избыточные индексы которые можно тоже убить потому что есть другие они могут делать ту же работу на голове нога колоночный как правило и вот а едва это мой скриптик который плавно еще из генерит тепло и revert скрипты для вашей миграции здесь они пока тут в ту дух сделать конкорд ли это общем старая версия да это пояснение оценки то есть вот все подробности есть и наконец самое такое важное это анализ запросов вот есть с 1 есть сейчас есть с 1 до это отчет который показывает ну такой более приятный вид перед 16 mins у нас видно уже запросы точнее группы этих запросов со знаками вопросика там он видите да и тут вопрос если мы хотим что-то более умное я был бы сделать более умная но пока плоскость это вообще нет то есть более умное чтобы делать что-то болью мы им не нужны конкретные примеры конкретных запросов я бы мог написать я люблю писать переписки я бы написал хорошую хранил очку которая вам подсказывала что он делает с этим запросам но я не могу пока дело в том что в париже состоит нас есть только абстрактный запрос со знаками вопроса до места конкретных параметров а если вы хотите конкретные параметры то обычно как вы либо вы выдумываете это из головы в лучшем случае подсматривая в распределение данных таблицы или вы идете чаще всего в лоб и влоги видите конкретные примеры запросов и как-то руками это мечете да вот но если вы используете режим бриджа это у вас делается автоматически но у него есть свои недостатки тоже в общем вот здесь мы приходим к тому что оптимизация запросов это сплошной ручной труд то есть это у нас есть мотыгой мы ей в общем работаем и конечно же в этом плане нужно что то делать другой отчет это вот до этой игре это 5 отчеты с 2 которые в другом виде показывает там как у нас как у нас расход ресурсов происходит идут тут конечно здорово выделяется secu и о в процентах по каждому по каждой группе запросов очень прикольно да штука расширяем и плоскость ebay просто вот возьмете вот как слайдах или как в ридми написано делаете файлик засовываете переведите менюшку и все готово вот то есть мы вот здесь очень быстро добавили отчет который показывает текущее время в каких там зонах до в сан-франциско и и в текущей зоне ну допустим москве мы сидим например вот и здорово у нас появился новый отчет то есть вы можете просто эту менюшку для себя взять да использовать я про развитие сейчас проскочу что время сэкономить ну есть планы уже в некоторых ипостасях эта штука работает как и пьянь то есть и и потребляют уже и но если это некоторых хранилище полезных отчетов которые пока вот менюшкой можно руками пользоваться но у меня уже в нескольких местах это работает как машина потребляет эти же отчеты вот приглашаю пользоваться пишите идеи в общем буду благодарен любым идеям и там багрепорт а мы так далее вернемся к тому чтобы ну что будут будет в будущем и как нам все улучшить как сделать более автоматизированную работаю тебе находите узкими стопам помогает мониторинг вот предсказывать и предотвращать вопрос хотелось бы предотвращать потому что это главная задача это третий уровень это главная задача все автоматизации заданных ну что они в области оптимизации как это сделать вот допустим такой пример разработчики добавляет столбец один int 8 дефолт 0 и дальше начинает его использовать а яндекс создать забыл типичный пример такое бывает он очень такой самый банальный пример дальше про гоняются какие-то тесты хорошо если есть нагрузочные не всегда перед диплом да и все попадать на пруд таблицы маленькая даже не заметили что проблема время прошло таблицы подросла проблема начала появляться она появляется в мониторинге впереди состоит man's of the xp начинает влогах у нас если он включен показывать джинджер тоже пока вы в этот запрос начинает вылезать ну там всех скан конечно как покажу может не вылезать на больших данных и общем тут как бы что это о чем речь о том что это все реактивная до что у нас проблема уже нас накрывает и только тогда мы начинаем что-то делать и я видел люди говорили про активная модель подразумевают тоже ту же самую реактивную модель просто сокращает цикл то есть более пристальное наблюдение более раньше мы смотрим на наш мониторинг и быстрее реагируем на то опять же реактивная модель то есть она архитектурно реактивная вот так лучшем случае просто быстрая реакция в то же время у нас есть уже такие кирпичи в поисках системе которые позволяют отстроить более интересно интересно картину и иметь более более классную реакцию на проблемы на ранних этапах вот конечно же вот эти женщины хороши аки метр или вид cortex хороши но в нагруженном проекте нужно много ручных действий нужна глубокая экспертиза и в общем у нас все это реактивном становится в общем - мы сядем на первом уровне в лучшем случае в то же время вот вернемся к этой прям к этому примеру за бочек добавил это эту колоночку начал использовать в условиях и столбец 1 забыл создать индекс если у нас есть у менди бей и он делает кудри view например максим в лучшем случае то он тут же скажет а у нас это таблица будет большая давайте сразу индекс создавать зачем учета тянуть-то да зачем нам тянуть потом мониторинге отапливать или же у нас есть стенд нагрузочного тестирования и мы перед диплом заметили что чего-то там короче на больших то данных у нас и недель общине пройдет на большой таблицы потому что там дефолт у нас еще версия не 11 под газ а до этого и главное вот о чем здесь речь sick sick сканы вылезают ну и просто это видно что нагруженный совсем не показывать что что-то там тормозит вот второй вариант и случае и 1 2 варианта природе случаются первые дорогие и мало специалистов вторые как правило только в крупных компаниях когда реально есть нагрузочное тестирование всего проекта и там еще нужно будет докопаться до базы данных понять что именно затормозила но тем не менее это уже второй и почти 3 уровень почти 3 почему почти потому что если данных мало то только human зыбей максим сможет предсказать что что будет проблема ну или разработчик опытные тоже может предсказать стенд нагрузочное тестирование не поможет потому что у него мало данных вот наблюдение за работа тебе показывают что проводится много экспериментов особенно в сложных случаях прежде чем выкатывать предлагать разработчикам какую-то оптимизацию проводятся эксперименты и облака меняют кардинально подход то есть они делают как качественный скачок потому что создавать копии делается это очень-очень легко и просто вы можете проводить 10 экспериментов параллельно вы можете их делать там запустить этот эксперимент на четыре дня и все это в общем то с помощью 5 уже автоматизировать в общем здесь в этом плане облака просто нам сделали какой-то сдвиг сознание вот и это все эксперименты и вот в таком в таком виде когда вы можете получить либо стенд с данными близкими или идентичными production ну либо просто склонировать продакшн это сильно лучше чем вручную пытаться на малом количестве данных там что-то придумать потому что запросы могут они совершенно другие планы на продакшн вот общем наблюдения то что опытный human тебе много экспериментирует и в общем мы приходим тому что что-то должно новое появляться должен до что-то должно новые появляться что нам даст более детальный мониторинг базы данных потрохов вот этих автоматизированные не бегать по этим бесконечным перестать числам руками видеть это более вменяемым картинками там виде и так и таблицами и так далее и предотвращения проблем на ранней стадии возможно даже нулевой стадии когда данных еще очень мало или вообще нет и предотвращать в идеале подсказывать какие-то идеи как можно исправить а также дополнительный бонус то есть если у нас вся эта система есть то почему бы просто нам не прогонять кучу экспериментов не проверять не например мы можем шайба first подобрать для нашей платформы для нашего нагрузки просто сказав проведи пожалуйста 10 экспериментов с разными значениями шайба фиппс и в общем автоматизации экспериментов и встраивания это в процесс разработки может быть нас это ждет может быть нет это открытый вопрос но вот здесь я привел эти самые кирпичи которые уже есть в open source спонсорством после слегка к системе которые позволяют отстраивать уже более более автоматизированные и эффективные инфраструктуры для готовки мозга сада об этом как раз мы будем говорить нам этапе вот здесь хотелось бы кстати отметить есть уже вот штуки которые ваш применяют машин лёнинг для подбора оптимальной конфигурации под газ этот аттракцион есть вещи которые позволяют спросить полюса что было бы если бы индекс был бы такой какой был план при этом индекса самого не существует это хайпа пиджи и более такой вариант когда идёт перебор индексов этот декстер который уже говорит давай вот этот индекс создадим то есть я уже перебрал кучу вариантов давайте создадим вот есть уже какие-то зачатки индекса 2-ой zynga уже есть в полюса к системе чем мы делаем то есть под газ и эта платформа в которой есть 33 гибель каждого своя специализация у 1 baby специализация планирования ресурсов и настройка подвеса плане ресурсов плане того что предсказание какие таблицы как будут растить у нас ждет через полгода как будет база расти когда оно готовиться к апгрейду и так далее ну и оптимизация после сказали . cove и на уровне таблиц тоже 2 это специалист по запросам по индексам по тюнингу именно запросов и третье это бот который позволяет использовать компонент который называется какого рокла дтп стряпней который позволяет проводить эксперименты и мы на естественно всю эту систему начали строить с последнего ботов с последнего с последней части это вот это ps3 плэй то есть в сумме 10 экспериментов больше экспериментов и так далее дтп с реплей это в несколько там есть несколько вариантов проигрывания нагрузки один из вариантов мы берем лук и с помощью тузы который называется пиджи реплей проигрываем наклоне чтобы сделать клон мы используем разные подходят разные виды дампов или можно с помощью пиджи ps backup сделать их клон но ключевой момент что мы это делаем в облаках то есть в амазоне в данный момент и используем и ситу инстансы это инстанции которые позволяют экономить 70-90 процентов от обычных из титул нам но они ненадежны их могут отнять но есть механизмы предсказания чтобы их отнимали отнимали и пользу с наименьшим вероятностью то есть нашей практике они очень хорошо живут а нам нужно как правило на там от получаса до нескольких часов и вот мы можем в параллели взять и попросить прогнать на разных клонов эту нагрузку проверяя разные идеи индекс такой вариант и нас другой вариант и так далее и получить вот примерно такой отчет здесь он схематично отображен могу показать как он на самом деле выглядит не так красиво сейчас умрет здесь мы видим что до было вот допустим все запросы погнались в сумме за 45 минут а после за 43 здорово мы 55 процентов выиграли но наше select и ускорились на 20 процентов это конкретный пример мы сделали частичные индексы поэтому select и ускорились там сильно уменьшились размеры индекса сильно меньше индекс can занимает здорово апдейты замедлились потому что до 11 версии после со у нас есть зависимость оставим за скобками ну мы потеряли had апдейты соответственно если бы мы были ручным куманды бей даже со знаниями нам было бы очень сложно вспомнить про эта зависимость и оценить что происходит с другими запросами есть другие варианты проигрывание нагрузки не обязательно боевую нагрузку проигрывать в этом дтп с реплей компоненте можно базис нагрузки проигрывать но мы вели понятия базис это такая тема которое позволяет быстро понять общую картину нет нет там ожидая там полчаса час и так далее вот то есть приглашаю на митап в комнату для докладчиков рядом с нет apn и ммs комнатами в углу там и резюме прямо сейчас о чем нужно говорить о том что облака и база данных облаках будут это ну они уже в целом уже есть в ближайшее время будут в россии и все тенденции предпосылки для этого это станет нормой крупные компании кстати яндекс уже например привет перевели практически свои поиски своего блока мы об этом делали онлайн этап вот в руках газ можете послушать владимир брагин и общем мы это будет это будет подхватывается и другими на стойте stagemix реальными данными желательно регулярно пополняемый мисс пратт пока вас не облака нет возможности быстро делать клоны да хотя бы сделаете вот так и используйте нагрузочное тестирование как как сможете да ну это панельные банальные советы но они как раз вам помогут предотвращать проблемы а не реагировать на них то есть это уже будет не react не реактивный подход и важный момент на стержень кино стройте мониторинг не жалейте сил на на то чтобы на стоянке появился мониторинг вот на таком нагрузочным стенде был полноценный мониторинг вы все видели что происходит то что часто этого нет и общем то делайте больше экспериментов пробуйте плоскости бия и подписывайтесь на после стая будете ранним ранними пользователями спасибо вопросы спасибо за доклад вопрос такой вот есть бот который предсказывает но может предсказывать там проблемы select the hub диетах с предикатами но там поддержки там пауком виду колонки вопрос такой как это интегрированы с приложением то есть к это приложение она делает там апдейт по колонке такой-то а по другой но он не делать например то есть нам не важно что там есть индексу нету вот есть ли какая-то вот интеграция приложение и бота чтобы он знал о том какие запросы будут выполняться или не степан вопрос сейчас самое главное то что мы используем мы используем логи в этом плане от google клауд их под газ ужас потому что там нет запросов логов то есть мы видим все все медленные ваши запросы из логов и анализируемых и поэтому мы знаем все по сути с продакшна а на основе этого мы можем уже плясать и говорить каких то изменениях допустим появляется что-то новое там что-то меняется мы уже знаем что было вчера например да и на основе этого мы уже можем склеивать ваши новые фичи который вы хотите за диплом и текущее положение на продакшен вот они встречаются на стринги и там вся информации то есть вот такое вы не провали вот здесь посмотреть еще с другой стороны то есть вот сейчас вы показали со стороны глазами д.б. но у нас есть еще например самом подгрести планировщик да он там работает сейчас на каких-то стандартных алгоритмов без использования машин learning я так понимаю вот может быть в эту сторону тоже стоит посмотреть изучить вопрос смотрите то что мы делаем она рассчитана на использование прямо сейчас вот это естественное развитие опыт и которые есть под демонстрирование у меня и завязать мозга и поэтому не очень хотелось хотя конечно придется то что вы говорите под гаспра уже был доклад на холод 2016 насколько помню как раз адаптивная оптимизация запросов мы анализируем чукча было и в следующий раз постараемся немножко лучше это как раз уже есть посмотрите доклад он точно есть но это работает не дал т.п. потому что такая штука она будет ну долгое время планирования становится долгим вот для ltp это уже не пропал взгляд вот красным этапе приходите я расскажу вам какие штуки бывают но это это вообще кабы лезть планировщик другая задача совсем наша задача это вот наблюдая за действиями сюмин тебе избавиться от ручного труда то есть мы вне плоскости в этом плане я поняла все равно еще один вопрос про планировщик вот это будет именно как бы патч сам под газ или это какое-то стороне это это у них явно сильно пропатченный paul gross у них это выложенного pants насколько помню посмотрите доклад нам все рассказала еще какой проц а не было идеи такую идею применить для других баз для чего для других свобода конечно же есть такая день примере других баз мы сейчас построен для по фгос а потом может быть и для других ну коммерческих все это есть есть оракла есть дтп с 3 плэй например с хорошей довольно диагностика хоть в ужасном виде его любящим но он стоит отдельных денег это дополнительная цензе а только для интерфейса оракла в общем это целая история такая спасибо за доклад собственно из того самого пира оракла да исхитит сурового кровавого энтерпрайза и вот хотелось как раз обсудить ваш инструмент sony 40 вот и рано прямо так сравнилась просто я хочу дать совет доход сразу же вот work ли он сам пытается предлагать оптимизировать запросы и когда у нас в топ 10 запросов 80 процентов это запрос а то твой zero мы очень напрягаемся и там это нельзя отключить то можно отключить либо два озера целиком на уровне конкретного запроса нельзя вот сразу подумаете об этом да это очень важно иметь привод по конкретному плану запросы и бить его вот может отключать да это поле ну да нет ну я очень хочу вижу это больше как помощник и которые не я это и не вижу как что что это будет там как-то мешать кому-то то есть ну спасибо за комментарии еще вопросы ok тогда пасибо в час встречаемся в ком закончу николай а можете тогда выделить пожалуйста один вопрос который вам возможно понравился больше всего который раньше предупреждать честно глянет у меня очень короткая память поэтому я все автоматизирую но извините спасибо"
}