{
  "video_id": "EltqTpYpwto",
  "channel": "HighLoadChannel",
  "title": "MySQL: чек-лист для новичка в highload / Анастасия Распопина, Света Смирнова (Percona)",
  "views": 6934,
  "duration": 3614,
  "published": "2018-01-16T13:37:43-08:00",
  "text": "сейчас немножечко расскажем что-то помимо фамилий на самом деле в принципе огромное спасибо свете за то что она согласилась подготовить этот доклад помимо огру огромного списка докладов в ее арсенале то что доклад этот новый дел делается специально для лета цвета ведущий инженер службы технической поддержки майский то есть у меня есть десять лет практического опыта разбор клиентских кейсов автор книги майский trouble shooting который вышла в издательстве райли все знают эту чудную серию книжек с со зверями на обложках собственно такая книжку света тоже есть вот что еще интересно а можно сделать микрофон погромче или нравится говорила так вот совсем-совсем туда хорошо теперь лучше слышно вот отлично у нас фестиваль тут надо погромче говорить вот соответственно света еще у нас помимо всего прочего автор прототипов людей функции для москаль то есть это был где дизайн прототип для встроенных функций то есть в принципе человек наконец-то собрал консолидировал учили внутри команды разработчика и постарался как-то ускорить этот процесс реализации поддержки jenson она активно пропагандирует есть такие доклады спасибо настя ну и чтобы внести немножко шоу я специально отдела майку которая как бы символизирует с чего я начинала свою карьеру и у насти майка которая символизировать собственно мои текущую карьеру все начиналось москве закончилась прикольный собственно немножко применял здесь буквально пару слов tasty работой войти где-то примерно лет 5 уже и за это время я успела по организовывать хай-лоу тырит когда hello перед были помечены их их я когда то делал а вот сейчас я занимаюсь ивентами персоны и всем что около ивентов свою включая темы докладов и так далее вот собственно про пин кодом немножечко уже поговорили боль в основном сообщества и и ассоциируется бесплатным софтом для мая сквере но на самом деле у нас не дал с недавних пор 2015 года появился появились и решение для mongo db и в частности инструмент мониторинга которые все это будет упоминать имя он поддерживает не только масик аль-нуман к тебе вот ну собственно что интересно конкретного весь софт пинк он бесплатный и икону зарабатывать на консалтинге поддержки удаленное администрирование и open source цвета мы собственно заявили этот доклад как доклад чек-лист для новичка в хайло тхай лот это понятие очень абстрактны здесь у нас brace люди очень логичные и интересующиеся конкретикой а именно цифрами вот что такое современный хай лот в цифрах а я вот не скажу на самом деле настя меня как бы сказать она меня так поймала говорит о говори про цифры но я цифры не люблю почему потому что очень часто когда мы сравниваем цифры мы смотрим на пример цифра опубликованная инженерами фейсбука но инженер фейсбука у них и другое оборудование у них другие требования чем могут быть у вас имеет смысл говорить а именно о том что относительно что касается именно вашего приложения например сколько записей в секунду выдержать диск запросов на чтение я пользоваться и сочинение так далее а вот я привела с здесь на слайде ссылку на доклад машин и баз данных который будет завтра или взять амазона даже не титу микроба какой-нибудь large и instance это две совершенно разные вещи это два совершенно разных ой лода два совершенно разных а требования а тем не менее что можно сказать про железо вот как во что вкладываться что имеет значение во что вкладываться если много чтений имеет смысл вкладываться в память чтобы кэшировать данные прочитанные с диска и обращаться непосредственно к памяти а если вам нужно много писать имеет смысл вкладываться в диск чтобы запись происходила как можно быстрее много активных соединений это процессор в этом случае моей сможет обрабатывать обрабатывать эти соединения одновременно несколько и быстро также неоптимизированные запросы но не оптимизированный запросу я считаю нужно делать оптимизировать но если вы по каким-то причинам не можете опять таки это препроцессор и диск цвет ну давай все-таки к цифрам поближе понятно что все относительно что вот-вот с 1000 запросов о такой лот или 40 тысяч at a high лагуна на самом деле я конечно спросил своих коллег ребят ну вот что с цифрами то они мне говорят вот print уж там же там сказала света не говори о цифрах имеет значения именно нагрузка именно контекст я говорил хорошо ребят ну вот пришел человек говорит у меня 10 запрос хорошо работали а стул стал работать медленно это такой его личный holod ну все посмеялись коли нет ну конечно в 2017 году речь идет о больших цифрах где-то там 30-40 тысяч я специально не помещал эти цифры в sqlite и потому что там через год это может быть совершенно другие другие другая ситуация вот здесь пить марки бич марки надо прощать внимание что несмотря на то что это сербия чуял теперь редондо-бич марки это несколько разных вида запросов на чтение которые покрывают достаточно много много пользовательских сценариев но не все польские сценарии они намного разнообразнее но тем не менее хорошо видно него средства как росла производительность 57 это в шесть раз быстрее версии 5 5 5 раз быстрее версии 56 нато на тех же самых на этом же самом тесте и этот рост на самом деле все ровно так как света и сказал что через два года цифр неизбежно устареет потому что наблюдается последовательный рост интернета то сейчас на свою цифру 84 миллиона пользователей то есть если в россии в россии рунета это это рунет и если кто-то следит за результатами переписи населения это не все население россии соответственно все будет продолжать расти и люди будут продолжать регистрируется в чем-то новом приложениях под капот для которых используется москве то есть и нагрузки будут расти соответствующие вот соответственно приходим к выводу поэтому маленькую вопросы то есть что хай лот это та нагрузка с которой свобода не справляется но мы помним о том что это все таки не 10 или 100 запросов для со для современ для современных реалий ну и еще очень интересный момент по которым стоит помните про которую света будет отдельная практической байка история взаимодействие с клиентом что под highload нельзя один оптимизироваться раз и навсегда и на этом успокоиться потому что выходит новой версии нового fitch появляются и развивается приложений появляются новые требования соответственно потом мы об этом отдельно вспомним так ну собственно это как раз один один из пунктов которые мы нашли в списках олега бунина на топ почему нам никто не расскажет никогда про форки моя сиквеле вот давайте выпер кону вы расскажите что вообще из форков выжила то есть все что вы все что выжил мы собственный перечислит был такой four призму например он не поддерживается уже давным-давно вот что же выжила выжил нас собственно оригинальный ванильный морс катя москве от oracle от которых над которым работает инженеры oracle что с этим была самая интересная история то есть мы подумал ну доклад для новичков наверное свет сама все вспомнит из головы но нет пришлось привлекать сообществом и долго и упорно пытались общество сколько сейчас в руки работают инженеров над масик велим то есть свет не может вспомнить из головы это потому что я когда-то работала в oracle норку очень активно развивает команду mais que al там буквально за момент за первые пять лет работы кого-то тестировщиков на ведь например увеличилось в три раза то есть с того момента как я покинула oracle там наверно работает много больше людей вот ну на самом деле цифру в сотне человек официальную упомянутую сами марком стоит заполнить но это конечно разные сотни для разного для разных лет вот еще существует такой for как перк он и сервер для мастики то есть раньше называлось просто перка на сервер но поскольку сейчас у нас еще есть пир консервы для mongo db поэтому корректно говорить перк он и сервер для москве вот это полностью совместимой расширенная версия почему акцентируем на это внимание потому чтобы им потом рассказывать про мари тебе и команда которая делает занимается нас авто это примерно 30 человек то здесь простая математика то есть есть сотни человек в oracle есть 30 человек цирконий который занимается разработкой пир консервы то есть когда нам говорят почему вы ничего не поправить мы говорим о может быть вы сначала напишите о руку все-таки там сотни человек но свет вот знает например интересно и интересные случаи когда именно именно перк она провела то что очень что очень долго висела вор apple такое случается тоже в общем корректней написать сначала workle но и прикольно тоже стоит вот и что еще сейчас будет рассказывать света более подробно это один из форков который наверное уже не очень корректно называть форму потому что они стараются максимально дистанцироваться от оригинального master то есть и позиционирует мари тебе как отдельный продукт абсолютно сколько это у нас частично совместимая расширенная версия вот он не столько дистанцируется но на самом деле это мари тебе так компания которая основана монти монтеверди ньюсом что они начинались они заботятся о том чтобы можно было а мигрировать 40 алмой school на них но у них свои свой оптимизатор у них свои глобальные 10 фиксаторы для детей диета глобальная transaction адити фа катер и у них у них есть собственная печи такие как колумб top а что они еще делают они портируют фичи из origen то есть если допустим перк он а когда выходит новая версия арк алмаз койла она берет эту версию адаптирует свои собственные фичи под эту новую версию tamarya тебе адаптируют фичи из оригинального рапла в свою версию некоторые вещи они имитируют по-разному а например версии 57 появились пылилось instrumentation performance кима для переменных обварить бы они это сделали в informations кима то есть в плане миграции например у них собственные gt1 о если вы возьмете бинарный версии перк он или oracle а вы сможете его мама ри тебе будет просто игнорировать жить ради которых таком бинарном локи но вы не сможете ни перка на сервер не оракул май скул сервис опустить налогов которые изначально сделанная в мария дебита есть такая вот разница вот ну собственно очень быстренько стоит упомянуть еще на форки компании то есть если вы придете в большую компанию работать скорее всего у нее будет свой вариант москаль неизвестно брендированный или нет адаптированные к конкретным задачам этой компании то есть вот собственно самые такие известные форки мы перечисли то есть это люди которые нас рассказывает об этих орков на конференциях как он life то есть это facebook это алибаба amazon у которых есть собственно свой форк но он правда закрытый единственное что можно тут заметить что май рокс будет и в пир кони сервер и в марии тебе и бинарники теста вы бинарники которые вы можете уже попробовать они есть для перка на сервер можно скачать и загрузить уже by на рынке ничего не компилировать и попробовать мороз домой roxette движок который разработан компанией фейсбуку на котором они активно расскажу по моему историка рассказ dandi вот так ну соответственно что здесь можно загрузить здесь вот на этом слайде ки остановимся отдельно здесь есть полный список фитиля москве 57 которой у нас достаточно часто просят и вот здесь это очень полезная ссылочка то есть что умеет москве 57 можно посмотреть в одном месте вот то есть есть есть документация есть собственно перка навский блок прокат в котором есть про разные информации про разные базы данных и смежные инструменты то есть не это не только про мой секрет то есть мы расширили до совсем не тематику здесь промо ли тебе хочу отметить что опять-таки мария тебе и они как бы она состоит из двух частей это мария baby corporation который занимается разработкой поддержка мари тебе собственно зарабатыванием на этом денег и мария baby fondation куда входит это некоммерческая организация куда входят представители сообщества и которые занимаются тем что мария бибула развивалась именно в том направлении которое интересное сообществу документации она принадлежит марии деби corporation почему тут 2 ссылки весь open source это фаундейшн ну собственно вот здесь еще мы упомянули открытой разработке фейсбук и еще стоит сказать о том что буквально прошлой неделе новости они сделали версии 80 на 80 нету мороз ну вот здесь еще олечка или tested как раз компании alibaba или alibaba и искали правильно ударение пока не нашли с этом рассказывали нам очень быстро the system у нас очень много что стоит хранить память о что на диске всем от хранить в памяти но на самом деле чё зачем искал кажется очень хорошо работает быстрее работает с памятью чем с диском что надо помнить про а память майская поддержки три вида баферов буфера в памяти глобальные глобальные то которые выделяются не всего сервера соси он на это которая выделяется для каждого соединения открытого и под операции то которые создаются под конкретной операции вот здесь собраны опции которые на которые стоит обращать внимание именно при высокой нагрузке это прежде всего я тебе баффер пол куда о который идеально должен вмещать активный набор данных то есть набор данных которого постоянно обращаетесь к вере кэш это я в скорее будет отдельный слайд про нее есть uni рекомендуется использовать я расскажу почему и версии 80 в следующей версии маску или а ее не будет сиси он их такие как бы горячий общее опции что нужно сорт баффер says его для некоторых запросов и хорошо иметь большим но лучше его делать именно для этих соединений которые будут обрабатывать запросы по умолчанию оставлять маленьким особенно если вы не на самых последних версиях потому что происходит выделение памяти под него она занимает время а и вот что еще обратить внимание вот формула выделенная жирным шрифтом в чем дело очень многие любят выставить большое значение максим макс connections больше чем реальное протестирована больше чем реально выдерживает приложение иногда это случается что эти коллекции от соединения открывается и вот всем все буферы которые которые вы указали в конфигурации как сессионные они выделяются они выделяются и умножается на это значение и может просто прийти и пристик нехватки ресурсов под операцию на что стоит обращать внимание на временной таблицы причем там интересно то есть должен быть так ходить такой баланс временные таблицы плохо совсем вот так вот я не видела больших приложений которые все запросто оптимизирована что временных таблиц и не используется вообще она временные таблицы хорошо когда они помещаются в память и когда они не не конвертируется в таблице на диске но с другой стороны если сделаете слишком эту опцию слишком большой у вас возможно будет опять таки нехватка ресурсов что мы храним на диске мы храним на диске данные и логе которые пишут разные логе бинарные логе логе движков что нужно нужно просто заботиться а лучше скорости то есть тут есть вариант во-первых покупать лучше диски это с sdf ужина и ан-2 мы все современные хорошие диски что часто неправильно выставляет это не be a capacity и ставить либо слишком маленькой как по умолчанию это значение для крутящихся дисков либо слишком большой прочитав опять-таки руководство написаны какой-то большой компанией и получается что диск просто не справляется с нагрузкой которая и на тебе ему передает а поэтому ее нужно уставить как мануале написано или может быть чуть чуть меньше и на тебе ваш метод его стоит потестировать и начинать с у директ то есть он работает ну где-то директ для 90 процентов случаев в этом есть исключение например сан сторож где не очень хорошо но вам лучше как бы его тоже контролировать цвета скажи про компромисс между скоростью и надежности вот как раз та на примере фсин хотела рассказать значит стенкам там такая проблема для того чтоб от того как маска сказал что мы пишем вот данной на диске он от синхронизировать чтобы он не остался file system cache и в случае нештатной ситуации вы не потеряли бы данные в эта операция в sing она очень она дорогая достаточно и на email у нее есть ряд опций для бинарного logo и для и на тебе которые позволяют делать sing реже но это значит что у вас на компромисс вы делаете реже в sing у вас производительность быстрее но вы рискуете потерять данные собственно на этом на этом слайде есть два интересных моментов здесь у нас ссылки на 2 статьи 2007 и 2008 года вот они собственно до сих пор актуальны и ничего ничего лучше и новее для этого для иллюстрации мы не нашли ты просила напомнить ходовой 20 минут спасибо как правильно каши ровать кэширование маску mapper говорим прежде всего про кэширование кэширование именно средствами оскола не пиши рования приложения и жировать на стороне приложений от хорошо и правильно но давайте про то что можно и как не нужно кэшировать mais quel и нужно полезного это вот здесь представлены опции это белок к яше то для того чтобы что у нас происходит при записи в бинарный у нас есть данный который пишет движок есть данные которые пишет сервера в бинарный и они должны желательно быть записаны не так чтобы вас данных движки есть а данных в бинарном логе нету и либо да еще с бинарным логом есть такой момент что в него пишется только данные которую уже уже есть движке то есть нужно где то их кэшировать буфере zero вать перед тем как писать транзакцию в бинарный вот этим занимается белок кэш как правило по умолчанию вверх его размер достаточен но если у вас большие транзакции мой имеет смысл увеличивать ты был дефиниция кэш это было pink ешь это просто хранить открытые дескрипторы таблицы их определений тоже полезно иметь большую вот с чем эта практика 5 перка на инженеров то что на некоторых ситуациях значения а по умолчанию ты был open cascade инстансе с которой там 16 вам сейчас она слишком велико и иногда бывает иметь смысл его уменьшить фретка шоссе то просто открытое соединение которое то что дескрипторы соединение чтобы не создавать каждый раз заново при открытии нового а вы на тебе две важные вещи это и buffer pool где лучше хранить активный набор данных и лукбуке что такое лог буфер и на теперь использует redo лог файла для оптимизации записи но опять-таки туда пишутся и данные которые уже закончены и и данные которые еще не закончены но для того чтобы для лучшей производительности данный не закрытых стран сайты сначала пишут в такой в буфер памяти который контролируется вот этой опции на тебе лог баффер says соответственно если у вас большие транзакции то тоже имеет ее смысл увеличивать чем плоха к вере кыш я обещала рассказать говорю конечно у неё она была написана давным давно у нее есть один micex то есть ли вас запросы у вас одно только чтение quake ешь она прекрасна но как только вы изменили одну запись в таблице как которые обращаются какой-то запросов к в камере кэш ставится этот единственный текст и все остальные запросу ждут а был знаменитый бах 20 21074 о том что там вообще происходило сервер ждал чуть ли не минутами его исправили но исправили не до конца и вот эти вот три бага с нижней они до сих пор актуальна это урок май скул бак database ну собственно лучше вообще вот ресурс для того чтобы прочитать продюсирование это вот это дома смиту за с майскую клирика штейнер вот здесь нас отдельно просил как раз куратор в хайло junior роман ивлиев рассказать как можно подробнее о чем мы очень надеемся что уж мы успеем опоздал минут на пять значит репликация морской аппликация искал в отличие от других тут использовать или других баз данных но щука когда они есть сзади она моя репликация скулил где она очень она во-первых встроены она существует очень давно и она простая в использовании тем не менее она требует настройки но настройка опять таки не сложно это не сравнимо с другими базами и гибкая она позволяет сделать очень интересное решение ну для того чтобы говорить про репликацию нужно начать с простого то есть мастер сервер на которые я приложение пишет данные из леев который читает данные с мастера записывает их в отдельный relay и потом читает этот relay выполняет запрос и которые в нем есть с точки зрения хайло до высокой нагрузке значит тут есть два момента во первых мастер мастер и с одной стороны там больше записей записи идет в бинарный и в движок файлы движка и еще вопрос хронизации то есть мы должны удостовериться что что нет такого что а запись есть файлах движка но нет в бинарном логе помимо синхронизации которые встречаются на уровне мазь маску ела есть еще синхронизация на диск то есть момент когда май скоро уже сказала что она записывает данные в бинарный нужно его синхронизироваться дисков за это отвечает опция sing белок до версии 5-7 и до сих пор мария де беф вас новейших версиях она была 0 что обеспечило хорошую производительность но после крыша у вас могло получиться так что вас данный в движке есть две ноги потеряно несколько транзакций и восстанавливать аппликацию как потеря несколько транзакций может быть это не очень здоровой особенно если вы используете бинарный логин для backup а сейчас версии 57 значения по умолчанию то один это значит синхронизировать белок на диска ждут после каждой транзакции это дает проседание производилась тут как раз инженер мария тебе говорили ну как вы что какой так вот это сделали компромисс здесь компромисс делать значение больше единицы то есть например если вам вы можете себе позволить потерять десять трансакции сделать это значение 11 если вы можете потерять 1000 транзакты действовать и значения 1001 и так далее то есть это будет лучше все равно чем 0 но и не настолько медленно к чем и единицы счастливым там другая проблема со словом него всегда меньше потоков чем на мастере то версии 56 вообще получилось так что на мастер мы пишем в несколько потоков наследием и у нас только один поток который выполняет все эти обновления версии 56 появилась параллельной репликации 57 она стала лучше в мария дебиана немножко другая и более настраиваемая в том числе мари тебе можно сделать так что это будет более агрессивно где будет будет более в чем проблема с несколькими потоками майкл все равно должно отслеживать на мастере они хоть идут раза акции одновременно но все равно одна свеча завершается раньше другая позже и порядок может иметь значение вот этот порядок вот тут он должен сохраняться все равно а наследие не всегда это возможно сделать с тем же количеством потоков что и на мастере то есть любом случае шлейф немножко все равно будет не менее параллельный чем мастер еще популярный способ настройки это круговая репликация это когда у нас есть сервер к один сервер который одновременно является и мастером если вам в принципе с точки зрения холода с ней те же самые проблемы кроме стой на рекомендуем и что только с точки зрения только разницей что умножать надо на два для каждого сервера то есть это так оконный мастер sleep одновременно плюс нужно обеспечить был совершенно не заботится о том что вообще скопировались ли данные я не скопировались они одинаковы ли они на мастере не на сливе тем не менее маску позволяет сделать и вот так это креатив креативные репликация в духе малевича лучше не надо то есть она может files михайлов на бушприте зовут таким последствиям то есть будет очень больно проблема тут в том что несмотря на то что производительность это просто сколько там входящих исходящих потоков данных но с точки зрения обеспечения синхронизация то есть очень намного проще сделать так чтобы что данные будут не совпадать на серверах очень странным образом люди вообще в mais quel а мой склоне они хотят писать на нескольких серверов одновременно и хотят читать с этих же с низких сырьем одновременно читать одни и те же данные вот эту лишь задачи решает кластеризация на этом слайде я указала про старейшие решение тынде by кластер но дело в том что с энди by кластером в пару хождения для него очень высокий из-за отсутствия нормальной нормальных туториалов для новичков и и с этой стороны нормальных туториал для новичков и для такой достаточно детально и подробно документации для людей типа меня support инженеров то есть она там в общем то один только обычное пользовательским мануал и поэтому мы и на нем просто вот я бы поместила сюда но мы не будем останавливаться более распространенное на решение этого перка на эстраде by кластер или галера кластер на самом деле здесь в тринадцатом году как раз на реке другой инженер службы поддержки перк он и делал доклад перка на x 39 мастер он галера под капотом мы иска мы честно искали видео но видео видимо тогда на реке не записывали но я думаю что реально найти сладится этого доклада там поподробнее про устройство как раз при конского решения на основе галера есть значит я вот пойду сейчас вперед картинка примерно такая же как я показывал круговая replicate стоп стрелочки теперь две разные строен и стороны то что происходит после такого происходит запись на одной ноте она в обычной репликация то есть мастер вообще не интересуется что там происходит на его сливе случае перк он x-tribe кластера надо будет ждать ответ от двух других not соответственно таким образом если чтение в этом случае масштабирование потому что чтение никакого ответа не ждёт та запись она будет сильно очень проседать например если not try to каждая запись будет ждать ответ с трёх нот если not 5 топ5 и больше семи вообще не рекомендуется ставить потому что тут есть ещё одна такая момент что некоторые люди ухитряются все это расположить ноды в разных дата-центрах но это вообще делать не надо потому что даже если сегодня между ними скорость хорошие то есть может поломаться какой ты узел и завтра она будет хуже что еще из особенности для перк он а именно эстраде кластер данные о них изменения это опять-таки решение подобной бинарному логу но это свой собственный формат лога изменений и благодаря этому благодаря тому же данный у вас и так на всех анодов присутствует вы можете сделать меня менее безопасные опции таких как и на де беф ваш локоть из teorex commit чтобы делать вот sing на диск реже в прошлом году oracle выпустила еще одно решение no debe кластер это архитектурно то же самое что перк он x-tribe кластере галера с той только разницей что изменение пишется в бинарный это с одной стороны очень выглядит обещающе потому что иногда требуется сделать асимметричный slave одной из нот и можно делать все равно будет два logo а нитриловые как случае перкунас 3d кластера но с другой стороны это новое решение в нем меньше фича и в нем больше багов пока света вот у нас спросили про sharding рассказывать существует ли он встроенный потому что для новичков этот вопрос актуален для тех кто давно пользуется конечно нет не существует конечно встроенном шарден га то есть тут что есть есть собрали решили не все решение одно из решений это шар двери это инструмент написан на печке и как это на правильно назвать german герман написанный и внешней инструмент есть маску фабрик правда он похоже не уже не поддерживается потому что он саду страны и молодой и вот с текущей версии утилиты то 16 это последним мы нашли мануал это 15 есть прокси sql это было вообще superstar на последней personal life в санта-кларе это на самом деле больше чем сортинг это прокси решение которое там есть и к вере в райт есть вот balancing и много всего но может делать и sharding а вот здесь ссылка на бок про то как делать sharding при его помощи я тут не поместила на слайды есть еще в марии деби табличный движок spider который на уровне движка тоже обеспечивает sharding ну на самом деле здесь как раз есть две полезные ссылки к этому разделу есть такой доклад у нашего генеральный директор а петра зайцева этот шар донату short вот здесь мы нашли его запись правда на английском языке вот и ещё у нас в разделе technical презентаций на сайте перк он и есть слайды от этого доклада здесь более подробно про шарден будет что еще касается прокси queen мы нашли слайды о сценариях использование прокси крелл то есть более подробно об этой разработки ты там есть причем не только для целей sharding для чего еще там как раз на это объясняется собственно для вот основные сценарии использования так ну собственно свет мы сейчас попытаемся объять необъятное какие индексы нужны для masi qu'elle приходя значит я буду говорить только одни уникальных ключах потому что уникальные ключи а не нужно еще для другого для того что обеспечивает целостность данных уникальные ключи на что влияет случае select на select они ускоряют запросы если не составленный так что ваши условия вера могут их использовать единственно только момент что если у вас слишком много подходящих ключей оптимизаторы могут долго думать какой же именно выбрать и сердце insert они замедляют запись причина очень простая нужно записывать и файл да вы данные и ключ обновлять а в deered они лучшим с ними интереснее они с одной стороны тоже замедляют запись по тем же причинам что insert но в то же время я не облегчает поиск строк а если условия вера по если ключ подходит под условия и вот тут баланс между тем сколько строк в обновляется и сколько строк вы можете найти какой процент строк можете найти при помощи ключа внешние ключи внешние ключи там есть такой момент что две таблицы слинг кованы и вы например если вы читаете с таблица которые дочерняя и вы не можете в одновременно в этот момент удалить что-то из родительской таблицы если что секундочку 3 6 минут у нас да хорошо спасибо из дочерней соответственно если вы в этот обновляете опять-таки эротическую родительскую таблицу вы не можете одновременно обновляйте родительскую таблице вы дочерние возможно будет ждать при вставке записи например или при чтении полнотекстовый индекс полноте тесты индексы поддерживается мая sql самых ранних версиях и движком maysa и на тебе они поддерживаться свежесть и 5-6 но вот постели тут мы когда готовили так вот у нас по совету ли прокомментировать с вот с этим с тем как postgresql сейчас активно рекламирует подсыпал на текст в яндексе вот пусть и не мая села они используют не только устроены по на тех стенды с они спокойно что использует еще внешние инструменты специализированной программное обеспечение у которого просто больше возможностей и вот вторая ссылка это билл кармен версии 56 сравнивал как раз полнотекстовым так сэма и сам и на тебе и сорон и инструменты такие как сфинкс и два других у него в этом посте есть цифры и вот эти цифры с ними наверное случилось то же самое что случилось бы с цифрами если мы поместили наш доклад а скорее всего они и сейчас немножко другие но общие представления с тем не менее а можно получить вот но здесь еще есть одна ссылка это в мастер класс как раз тоже петра зайцева генеральный директор апперкота работа с индексами лучшей практики матч на самом деле он есть на русском языке и это как раз доклад для начинающих то есть у нас традиционно которая читает для студентов вузов ну сейчас света как раз вернется к этой байке почему нельзя оптимизировать медленные запросы раз и навсегда и отдыхать дальше это реальный случай было получаю текет у вас где клиент обновился говорит у меня огарцы запрос работает медленно что дело ты купишь let's look verilog присылаю а у него там везде индекс handy for syntax стоят и говоря по против урс яндекс уберите но убрал пишет о в новой версии работать значительно быстрее старой медленные запросы где их найти вслух verilog впервой с изучать на утилита 5 к вере дайджест которая читает этот огромный лог строит самаре и позволяет с ним работать но намного комфортней в performance кима есть таблицы event statement и там есть вот такие поля вот если они не нулевые то у вас запросы скорее всего кандидата на оптимизацию все скими это такой компонент performance схема который прочь облегчается ней работу есть представление вот с такими же названиями слайды будут на сайте конференция вот все можете скачать с такими названиями которые тут должны быть подчеркивание почему-то они пропали вот здесь подчеркивание а почему то они пропали слайда представление тоже есть кандидаты на оптимизацию графических инструментах тоже можете найти а не очень-то работает по есть у многих есть похож функциональность но перка на мониторинг отменишь метан open source и у него есть дима и вот можно посмотреть скриншот с этого дима список запросов со временем выполнение то есть так как чинить как чинить есть инструменты explain который рассказывает какой план какой план оптимизатор выполняет сын формат джейсон у него есть даже больше информации чем в обычном explain optimizer trace это собственно runtime информация о том как оптимизатор непосредственно работал во время выполнения запроса можно анализировать использование индексов какие индексы используются какие нет можно смотреть также статистику движка что и где почитать я пропускаю этот слайд вы скачаете найдете прочитаю эти ссылки давай свет расскажи про что всегда забывает когда настраивать носили под нагрузку спасибо тут написано байка но я не буду рассказывать об отдельной байк это то что весь вот все слайды это собственно и есть байка я уже говорила про каа 5 балла pink html div и нищенкой что есть это дескрипторы открытых таблица не даст должны быть больше достаточно большие чтобы смотреть надо вот посмотреть внизу это статусные переменные которые то есть когда они увеличиваются это это плохо это значит ты был лишь маленькая если они не увеличиваются это перестали увеличится это хорошо значит на наше неправильное значение ты была пинка she insists как я уже говорила не всегда большое это хорошо сорт буфером и то же самое говорит что важно smax connections макс connections никогда не ставьте его просто так от балды если у вас нормально приложение работает там с 300 соединениями не ставьте его в значении например 5000 потому что в случае какой-то атаки случай какую-то проблема у вас может получиться что у вас будет эти пять тысяч соединений вот эти пять тысяч соединений будут выделены буферы и точным вас будут проблемы с ресурсами на сервере макс alloid пакет опять-таки его желательно это максимальный размер переданном пакеты его желательно ставить вот в самом деле под под размер пакетов которые вы передаете реально опять-таки приложения не ставьте один гигабайт от балды и на тебе баффер пол says мы говорили рабочий набор данных и на тебе log files лучше всего чтобы он вмещал изменения минимум за час как посчитать это написано в 1 ссылок что мы показывали раньше и на тебя и на тебе thread кан colin's это количество ядер количество ядер просто если сделать его выше чем количество ядер там они будут будет use this content on и вас получится в результате производительность меньше чем она была бы с менее агрессивные опции и на тебе флаш метод мы опять-таки обсуждали значит что прочитать по настройку я поместила специального о опции из трех компаний то есть все майскую перка на сервер и ссылка на марии де без чтобы смотрели вот чем они отличаются блог дмитрия кравчука вообще он здесь не должен быть этот человек который тестирует морской под высокой нагрузкой он работает вора клея и занимается тестируем производительности перед перед выпуском новых релизов его имеет смысл опять-таки обращать внимание что он использует очень хорошая очень дорогое железо то есть нельзя просить и просто просто и копировать его упц и но можно почитать как что как одна или другая опция влияет на производительность на самом деле мы тут с тобой как раз обсуждали что у у дмитрия есть задача показать максимально возможный результат прямо sequel то есть и создать идеальные условия но в реальных условиях очень часто есть какие то другие вещи которые влияют на производительность и как собственно можно понять что тупить не маски бойкот опять-таки это взять настроить дмитрии и поместить их на моем лаптопе значит что еще может предлагать тормозить а другое приложение то есть поэтому лучше всего май скул работает конечно надеть их на выделенном сервере чисто под басу диска значит что тут с диском вообще интересно когда сергей over the минутка если что хорошо клиенты клиенты говорят каких-то проблемах что у них данные либо на network storage часто . нет мы исправлять не будем но если это network storage с такой нормальный типа сан то удается их убедить что ребята все-таки должно работать а вот нфс это не надо использовать никогда в том числе для бэкапов в чем там проблема проблема в том что network storage она не дает гарантии гарантированно атлета моя скула что данные именно записались на диск и моя сила не может быть стопроцентно уверена что они произошло повреждение данных то есть из за этого проблема то есть ну что еще если диск медленный переносите работу в память жертвуйте надежно надежностью и мигрируя на более быстрые диски сепию мы опять говорили об агрессивных опциях то есть не надо ставить опции выше чем ваша система может поддерживать лимиты и операционной системы имеет смысл проверить не ограничивать ли операционная система mais que al каким-то образом и всегда проверяйте дает ли нагрузку приложения то что бывает так что приложение просто не дают никакой нагрузки маска прекрасно справляется почитать по теме здесь это brendan грех это лучше ресурс по инструментам производительность операционной системы наверное на вопросы мы сейчас уже уйдем в culoare чтобы не занимать чужое время и просто хотелось еще сказать что на этих слайдах помимо всего проще но поскольку нас хайло junior собраны все доклады пир кону на русском языке которые есть в открытом доступе поэтому чем то ждите welcome мы все выложим в перка на технику презентация у нас есть там такой раздел спасибо еще объявление у нас есть вот такие наклейки на кто самолета кто хочет вопросы кто хочет наклеек всегда по месте работа мы не могли этого не сказать у нас также будут выдавать наклеечки за самые лучшие вопросы по мнению докладчиков потом можно будет обменять на призы здравствуй благодарю за доклад вот вы когда рассказывали о бен логов привели две опции если если сим белок равен нулю это быстрый и 7 белок равен единице надежный а вот какая разница вы сказали что ура есть разница а вот какая конкретно разница при надежной записи то есть во сколько раз медленнее он будет писать узнать о на но как бы напитки это зависит от конкретной машины то есть у меня сейчас нету готова к вич мару который я сама производила или которого опубликованная но то есть то что он говорили тоже там бывает порядку больше десяти процентов благодарю еще один вопрос сразу скажите вот если примеру у нас есть сервер 2 я вдруг процессор 4 ядра как лучше запускать мисс кролик на каждый и на каждое ядро вешать по процессу или мой сколько там внутри разбирается мой спросом у жителей разговорился москосо внутри разбираться благодарю здравствуйте меня зовут виктор linkin я хотел бы уточнить вот рассказывать про настройки сама работа а вот допустим когда мы с дамбами работаем больших пожалуйста говорить вот вот так вот когда мы работаем с дамбами больших объемов как какие вы можете порекомендовать настройки чтобы эти дампы отрабатывали максимально быстро потому что часто бывают проблемы с большими дамбы то есть настройки которые и ускоряют запись то есть все настройки которые имеют отношение то есть из того что я говорила о дамп а вы что делаете в эту вас backup или вас вы просто периодически вам нужно как-то данный пустим даже если человек поднимает просто для тестирования резко для тестирования вообще лучше всего из вас там огромные да ну если тестирование вы можете сделать вот эти вот все которые я говорила что отключить надежность временно восстановить это да ну надеюсь вас сервер него не упадет короче заново еще развернете там его выключить и сделать более надежное например настройки можете еще для бэкапов опять-таки смотрите сторону бинарных выкопав спасибо за доклад я здесь здесь здесь спасибо спасибо за доклад спам не вопрос такое знаете немножко провокационный как мы я хорошо наблюдаю историю да там в девяносто восьмом было модно на одной машине держать там mais quel и applications да там условно говоря там пять лет назад под моей сколь выделенные машины там и так далее да сейчас мы там бежим виртуализацию все здорово вы скажите пожалуйста когда кто кто первый перка но все-таки ли урок выпустит наконец свою операционку смазку или им им успокоимся вы же понимаете да что ты to the direct вот это вот все работа с кэшем и так вы знаете я я вам скажу вы вообще опоздали лет я даже не знаю ну на 5 наверное потому что аркл давным-давно выпускает операционку называется or call dynax там уже маска стоит она бесплатная бесплатная там поддержка платная там будет если там только security патч и вы получаете бесплатно но это полностью совместимы с радха то вы можете просто брать этот котовске и там пакеты поставите пожалуйста здравствуйте спасибо за доклад подскажите пожалуйста как моя школе работает с ума умеет ли он хорошо моя память как этого процессора и направляет запрос на это значит снова он работает нормально работает с numa есть опция такая найди бинома интернет равно 1 и она нормально работает то есть он не ходит в памяти процессора закажем например за и надо башня что он ходит или их то есть он не ходит в и надо башней каждый чужого процессора до или ходят ну по-моему не ходит нормально нормально работает поддерживает спасибо светлана светлан спасибо большое за доклад меня практический вопрос я давно наблюдаю за том числе из за вашими докладами и за вашей работой в частности еще раз большое спасибо вопрос следующим у нас довольно сложное скажем так довольно сложная схема по репликации это несколько серверов пожалуй столь гораздо и гораздо больше чем три и они в не рекомендуемые схеме они как раз по кольцо у нас и мы никак не можем решится внедрить репликацию которая основана гид айди я бы хотел узнать о чем это грозит при различного рода транзакции подводные камни и насколько стабильно будет работать вопрос о том что стоит ли переходить на джетте айди да и что нужно значит жить ради у вас проблем такая будет у вас будет вам нужно делать очень аккуратно и обновление на на gt1 то есть ну как вот написано там мануале там установить там есть возможность устанавливать возможно сервера придется жить и один как у него еще все равно все достаточно молодой молодой продукт но у него периодически встречаются баги так достаточно часто их становится все меньше и меньше то есть они справляются то есть у вас основная проблема будет при миграции на джетте ati потому что нужно будет очень аккуратно перевести сервера вот порядке как как это сделать программистам именно осмыслить эту которые приложение делать или который с базой который пишет запрос и ничего вопрос стоит учитывать программистам для детей ади которые пишут запроса ничего это все на уровне базы это будет головная боль ваши бей который будет вот это все перенастраивать это надо посидеть проблем еще какая там когда если это если если там что-то поломается и там например с обычной репликации можно что сделать допустим skip slave пропустить пропустить сколько-то позицию стартовать потому что они zerowatt допустим 5 ты был sing или чем-то еще среди вам поможет две вещи и поищите на перка на блок как сделать это восстановить жить этим вручную и второе это утилита из май скул utilities пакета майское ласло iv trx который позволяет пропустить жить ради а потом синхронизировать тоже данная то есть здравствуйте спасибо за доклад такой вопрос несколько специфический если какие-то рекомендации у вас для настройки непосредственно деби который отличается не отличается будет лучше работать например на майские локатор запущенные рту альных машинах нежели на железе на каких на виртуальных машинах там amazon например то есть какие-то специфические вещи которые можно потяните они будут работать лучше на виртуальных или наоборот не будут лучше работать ну в принципе все то же самое потому что вам надо ну то есть вот эти все я вас помню в у меня на мастер классе были не были я раньше был я обычно рассказываю просто вот есть четыре оборудование которое важно для майского это процессор на память индийской сеть то есть у вас что на виртуальной что на физической машине у вас есть эти все параметры в соответствии с ними до как бы должны настраивать mysql что-то такое конкретно на виртуальный ну нет наверное спасибо здравствуйте спасибо за так вот себя тестируем как пожалуйста тоже в микрофон как то вот так надо жать кластер как раз собираем перка на класс тут мы попробовали 7 собственно not отдельных и похоже упираемся в сеть и для нас проблемами на критично отказоустойчивости вот вы говорите что не рекомендуется использовать схему там из двух разных дата-центров как-то можно это обойти или как ну какие-то советы от вас и значит еще по поводу кластера так как не было опыта до этого работы с ним есть какие-то подводные камни проблемами очевидное может быть может быть по вашему опыту может быть топ там 510 каких-то проблемах которые чаще всего встречаются значит по пол первого вопроса кластера знак дотация если вы хотите именно кластер там есть настройки который отвечает за тайм-аут и сколько когда считать что но даже полностью отсоединился от кластеры считать что она не часть кластер вот их от всех надо увеличивать это но у вас сразу все это будет работать еще сильно медленнее чем и само по себе то что в разных дата-центрах тут имеет смысл сделать если опять core i7 дата-центров аист опустим 22-30 имеет смысл сделать клай кластер в одном да это центр кластер другом да эти центры между ними а синхронную репликацию то есть да это в минус и произойдет того что вам придется вручную настраивать если вы пишите допустим мы там и там вам придем в придется делать так чтобы не было конфликтов записей но в связи тем не менее это будет работать хотя по скорости нормально чем это вы будете делать вот этот один большой кластер 2 дата центрах можно по типичным проблемам так давайте наверное в кулуары сейчас будем да спасибо на самом деле хотел тоже самым про класс рассказать и про то как можно вот в разных центрах вы ответили просто уточняющий вопрос допустим если приложение то в разных странах работает разных там языках и имеет ли смысл для каждой страны или там не для каждого кого-то региона большого выделить отдельную базу то есть какая-то общая база и там америка россии вот так ну наверно не для языков имеет смысл имеет смысл если то есть распределение нагрузки то есть на условно говоря такой sharding по регионам ну да такое делается если у вас например люди которые в сша у вас трафик в основном идет зависит от задач приложения то есть если у вас у вас получится что если например это социальная сеть и где например люди которые сша они общаются с людьми сша и люди которые в россии они общаются с людьми из россии имеет смысл таким образом сделать если это какое-то приложение где например группа разработчиков социальные сети группа разработчиков и как в моей команде есть люди в рукава и филиппинах сша в европе в россии где только их нет то наверное это смысла нет у нас на самом деле есть парочка примерно докладе к в про то как устроена сама перк он а вот с менеджерской точки зрения вот буквально они все от марта апреля месяца вот примут новейшие где мы конечно ни разу не говорил что у нас вот там 56 человек сидит там 43 там но мы в принципе рассказываем про то как синхронизируется работа команды и про такая внутренняя культура собственно существует спасибо спасибо за доклад вопрос по балансе мгу вы сказали что вот одной из самых таких нормальных стабильных решений это использовать функции скелета и вопрос в шорте рование то есть проще и дешевле выгоднее сортировать на уровне приложения или прокси из sql будет справляться вот с шокирования но опять-таки практическую тоже молодой сейчас многообещающе очень на самом деле так как это все очень майского это не мозга и с sharding вот такими разные советы в принципе на тестировать и еще один маленький вопрос как убедить скажем так заказчиков клиентов что держать на отдельном сервере москве лучше чем взять текущей в два раза быстрее потому как типе connect он все-таки медленнее в unix акита работают ну как взять поставить там аську ведь посмотреть как у вас занимать другие какие процессы и посмотреть как она к она конфликтует то есть в каких то моментах может быть выгоднее и держателю майлз келли приложения на одном сервере для работы через высоких она честно говоря то есть это может быть выгодно только в таком случае если у вас допустим какой-то там совершенно мощный сервер который и просто приз что приложение что mais quel а у нее работают не на полную нагрузку то есть вы можете грубо говоря сделать поставить на но есть перед систем которым позволяет там допустим 50 центов память приложение используя там 50 процентов цепилов можете так вот сделать таким образом приметы ничего хуже вам вас не в не приложение медленнее стоит доработать и москва но проблема в том что еще все время может получиться так что какой-то там бах либо в приложении deep маску или я один процесс будет использовать все ресурсы и тогда второй процесс будет работать медленнее то есть нужно ли вам то сможет ли вы все это позволит нет можете ли вы это на уровне операционной системы как-то распределить спасибо"
}