{
  "video_id": "MyMl3NN13HQ",
  "channel": "HighLoadChannel",
  "title": "\"Прокрустово ложе\" или \"испанский сапог\" — мифы и реальность СУБД в Облака / Александр Зайцев",
  "views": 1071,
  "duration": 3335,
  "published": "2021-10-04T02:42:11-07:00",
  "text": "добрый вечер ну давайте знакомиться меня зовут александр зайцев как мне уже представили я 24 года уже занимаюсь войти хотя свой первый программа написал наверное в семь лет на листочке бумаги у меня еще не было компьютера и в настоящий момент я работаю в компании альпенсиа который я сосна соосновал по совместительству у меня черный пояс по айкидо и покликал со так любит говорить наш и sails когда меня зовут на какой-нибудь звонок с клиентами и я не брат петь и зайцева которые многие все знают и все задаются вопросами почему мы носим одна фамилия ну так получилось мы друг друга хорошо знаем и любим вот все такой компании alte нити и почему я рассказываю сегодня про базах данных в облаках оттенить вообще занимается кликал сам и мы предоставляем полный список энтерпрайз услуг поддержка тренинг все что вам нужно и в последнее время мы строили свой собственный сын текла от который предоставляет клик house is еще раз публичных облаках и собственно на основании вот этого опыта я сегодня вам буду рассказывать как строить базы данных и как их готовить база данных в облаках то есть наша цель и как по наша с вами цель это строить приложение а все остальное для за вас должны делать как бы другие облачные провайдеры счас провайдеры и так далее так что когда он говорят о базах данных в облаках то это получается скрестить ужа с ежом я вот тут столько разных метафор подобрал что это и прокрустово ложе испанский сапог это все потому что это немножечко больно и не удобно и вот эту боль и неудобства я постараюсь вам рассказать и как с ней справляться когда заходит речь об облаках то есть некоторая такая мифа мифологема до что облака нам обещают несколько базовых вещей во-первых это масштабируемость то есть если мы в облаке мы можем очень легко система отмасштабировать она у нас не справляется мы там добавляем либо реплик либо добавляем ресурсов виртуального виртуалке и начинает все работать вторая вещь которая часто обещают в облаке это простота использования вот эта вот кнопочка красивая это то что нам легко все делать то есть мы нажали на низкую кнопку на все заработало кроме того облака обещает высокую надежность и доступность то есть если мы живем в облаке мы предполагаем что нас ничего никогда не падает а если падает то сама поднимается и продолжает работать так же хорошо как и раньше и последняя безопасность то есть в облаке облака обещают безопасность на на самом деле они обещают очень агрессивно именно потому что с безопасностью там не все так хорошо и об этом мы тоже поговорим одна из расхожих метафор когда говорят об облаках это стадо дам lick it all то есть облака это как бы 100 до чего-нибудь и по цитатами здесь понимаются вещи которые commodity взаимозаменяемые то есть если железные сервер они все одинаковые мы вставим стойку одинаковые соответственно один выходит устрой его можно заменить виртуалке они тоже одинаковые там один и матч они могут различаться только размером и той же леска на которые их развернули если говорить о губернатор сетап оды они тоже одинаковые у них один и тот же и 5 они работают примерно одинаково то есть вот это с базовые такие вещи и облака говорят что это у нас стадо имеем хорошо умеем управлять но база данных это не стадо да это котики и котики они не потому что мы их очень любим и лелеем а потому что все базы данных разные и разные они в первую очередь из-за данных которые этот котик несет за собой то и за каждым таким вот котиком из базы данных тянется чемодан с данными и именно это то что отличает база данных от многих других облачных сервисов то есть вот это вот состояния эти очень ваши ценные данные которые могут быть маленькими могут быть большими то могу быть терабайт и данных они делают жизнь в облаках очень сложный порой и порой даже невыносимый так как же нам выполнить облачное обещания то есть как для базах данных которые работает в облаке выполнить требования но не требования обещания надежности удобства использования доступности и безопасности собственном и этой задачи занялись года два назад и чему-то научились начнем с масштабированием масштабировать можно по-разному понятно что самый простой и простой способ масштабирования он был традиционен для баз данных в не облачное время это вертикальная у нас работает база данных медленно мы добавляем больше железа мы добавляем либо берем сервер побольше либо каким-то еще образом наращиваем память наращиваем secu что происходит в облаке это то что если у нас есть старридж то мы не можем просто так нарастить размер виртуальной машины мы это можем сделать только в том случае если у нас хранилища сетевое если у нас локальный диск то масштабировать вертикально у нас не получится потому что мы поставили более мощной виртуалку а данные то они где то в другом месте остались поэтому вертикальное масштабирование работает только сетевым хранилищам и это существенное как бы свойства облака но с другой стороны поскольку мы в облаке и если мы используем сетевое хранилище то его тоже можно увеличивать когда вы работаете в не облако то добавление новых дисков существующей как бы сервер это всегда сопряжено с неудобством и риском особенно если у вас нет доступа дата центра а в облаке можно просто увеличить размер тома ну либо добавить новые тома если база данных поддерживает такую конфигурацию то есть с точки зрения как бы облака и база данных чтобы они друг с другом хорошо сосуществовали в плане вертикального масштабирования облака должна уметь поддерживать масштабирование домов или добавлять несколько томов и кроме того если мы говорим о сетевых дисках они должны быть быстро и понятно что если у нас есть что-то медленно это баз данных будет работать медленно и никто не захочет пойти в облака на какую-то медленную систему но а со стороны базы данных она должна просто уметь эффективно масштабироваться немногие базы данных кстати не все базы данных если им увеличивать в два раза количество ядер они будут работать два раза быстрее но хорошей базы данных так умеет клик рос в их числе работы с несколькими домами и сносно работать с медленным диском опять же почему мы можем говорить что с медленным диском можно работать сносно и это будет работать для ряда базах данных потому что говоря об аналитических например базах данных они всегда читают большой кусок данных сразу у них нет участках чтение нет участок записей то есть такой сценарий когда им надо бы много написать много прочитать и вот это сценарии на сетевых дисках работает хорошо потому что один раз вам соединиться и дальше вы читаете или пишите данные горизонтальное масштабирование она как бы более известны и популярны в облаках и в базах данных здесь опять есть нюансы то есть горизонтально можно вас масштабировать в двух разных измерениях первое измерение это добавлять репликацию это такое традиционное для mais quel а например и для манги для чего мы это делаем у нас не справляется с нагрузкой по конкурентности то есть по количеству одновременных запросов добавление реплик нам увеличивает возможность конкурентно обслуживать наших клиентов а второе измерение здесь это добавление шар дав и шарда что они нам делают они нам увеличивают возможность система в целом обрабатывать данные то есть чем больше у нас шар дав тем больший массив данных одновременно мы сможем обработать потому что у каждого шарда есть свой какой-то предел пропускной способности обрабатывающий способности и когда мы упираемся может быть в пределы одного одной коробке 1 виртуалке on добавление нескольких нам позволяет этот это перейти ну и здесь требования очень простые опять же и базы данных и облака должны уметь работать в таком режиме то есть облака просто отдавать нам в только виртуалов скука мы попросили а база данных поддерживать родирование репликацию и уметь контролировать состояние если мы что то вы здесь меняем последним пунктом здесь идет такая немаловажная штука как решать днк и сейчас мы посмотрим что это такое мы начнем с репликации опять же как бы облака обещает что все просто мы добавили реплику и сразу во все получилось на самом деле конечно это не так то есть мы добавили реплику и она пустая то есть мне еще данных нету и только через некоторое время с двух других реплику нас заливаются данные а что происходит в то время пока данные еще не залились но у нас какая-то частично частично правильная система и ей пользоваться полноценный нельзя поэтому типичные сценарии добавление реплики это мы сначала я добавляем потом ждем пока она до реплицируется и только после этого включаем ее в запросы казалось бы очевидно но этим надо заниматься иногда эти может заниматься база данных сама ecли каллас это умеет делать то есть клик хаусе если вы все запросы делаете через распределенная таблицу так называемую то тогда распределенная таблица сама понимает что какая-то реплика не готова что она отстает и на нее запросы не пошлет но как правило этим все-таки занимаются извне на уровне то молот балансира на уровне чего-то контролируя состояние реплики и только тогда когда она готова мы ее включаем в в обсуждении запросов с родированием ситуация примерно такая же но другая мы добавили новый sharp он пустой что нам делать можно не делать нечего а можно делать то что называется ришар ding когда мы данные с двух существующих шар дав часть данных переливаем на наш новый 3 шард соответствовать соответствие то есть у нас получается что каждом шаге стала данных меньше у нас скоро система от этого вырастает вот но сама эта операция очень непростая то есть когда мы добавляем sharp создаем схему то вот это вот перенос фоне он далеко не тривиален то есть во время переноса нам нужно гарантировать то что у нас данные целостные мы взяли кусочек скопировали его на другой шар с этого надо удалить а в это время у нас идут запросы постоянно в какой момент и как их переключить что делать с тем запросам которые уже выполняется это все не такие простые вещи как кажется и база данных по идее должна с этим справляться ну например если там говорить о маску или мой сколь от делать не умеет поэтому есть компании вид с которая построила совершенно другой mais quel который поддерживает sharding решал thing но это уже от моей сколько там осталось только протокол вот включался традиционно подход был ты правда простой вы добавляете шорты ничего не делаете потому что мы считаем что флика устно все время данные добавляются и добавляются и добавляются да и вообще мы используем его для какой-то там real-time аналитики это последний день 23 неделя соответственно через несколько дней у нас данные уже спас изменений за последние дни выравняются а что там в исторических данных неважно тем кому это не подходит они могут передвигать вручную или ждать пока откликалась это поддержит и на самом деле поддержка ришар линька включалась и не за горами в этом году она уже мы надеемся будет может быть вы заметили что все время я говорю на самом деле просторы что есть несмотря на то что вот сейчас вот сегмент про масштабирование я говорю про сторож потому что база данных это все вокруг сторону и где же мы в облаке хотим хранить данные почему локальные до локальные диски они как я уже сказал не масштабируется с одной стороны то есть мы если мы взяли какой-то instance на амазоне с локальном ssd и мы хотим увеличить то нам придется взять другой а этот выбросить и кроме того ненадежная то есть нет никакой гарантии что у нас всегда это все будет жить если она упадет диск потеряем поэтому раз мы идем в облака то надо пользоваться облачными средствами а это различные сетевые хранилища начиная с отжиг сторож или моего по традиции называем асти хотя в разных провайдеров разной имплементация штука хорошая достаточно быстрая но основная проблема что в ней очень дорогие индивидуальную операции то и записать файл это очень дорогая операция причем даже маленький файл записать большой файл уже накладные расходы небольшие записать маленький файл или много файлов это очень дорого поэтому с ним надо немножко по-другому работать не так как с традиционными блочными девайсами традиционными блочными сторожами есть несколько обычно выборов в облаке какие-то стандартные если говорить про amazon это же питу и gt3 вот или какие-то сетевые стороны с гарантированными aiop сами с гарантированной скоростью они очень быстрые на очень дорогие и на большие данные это быстро станет неэффективном чуть-чуть с другой стороны взгляд опять же когда мы говорим про база данных в облаках то часто приводит такую аналогию разделение сторож и компьютер то есть классическом бермята у нас всегда сервер и своя стойка с дисками или диск сервер диски сервер диски в облачных базах данных они продвигают концепцию что у нас есть общие сторож и к нему мы запускаем столько сколько надо рабочих нодов эти рабочие ноды выполняют запросы получает данные с этого общего обжиг старриджа понятно что такой подход имеет много преимуществ и должен лучше масштабироваться то есть мы просто добавляем добавляем еще хасты если нам не хватает скорости и или чего то еще на самом деле все работает чуть чуть не так во всех обычных базах данных у них между хостами и сторожем сетевым всегда есть прослойка локального стороны как такой кэш этот размер этого каша может быть самым разным он может быть как и небольшим так и фактически равны размеру данных например если говорить про redshift да он хранит данные на s3 но при этом на каждом из нас и redshift а полная может дать копия данных которой хранится на ис-3 но только локально это как бы хорошо с точки зрения производительности но плохо с точки зрения если вы поднимаете новый сервер сколько времени потребуется пока он закачает с сети себе на локальный диск данные такая же проблема существует и в snowflake и там и вертикали он то есть это как бы общей паттерн клик кралась тоже может работать с облачными средствами более таким нативным способом и в нем есть концепция которая зывается dice костре дискос 3 это диск в которым опираются на обжиг сторож или уже к 40 compatible что-нибудь вот и кликала с при этом использовать совершенно другой способ работы с этими данными для чего другой потому что традиционный работает очень плохо и вот с этим другим способом получается не так плохо здесь результаты некоторых тестов которые мы делали осенью и разница между обычным сетевым сторожем ис-3 она от было 2 1 до 10 по скорости выполнения запросов на достаточно большой таблицы это таблица примерно миллиард 300 миллионов записей такая стандартная тестовой таблицы достигается такая скорость за счет по реализации всего чего можно то есть максимально параллельно читается с 3 максимально параллельно пишется используется каши для засечек это специальные структуры который помогает crack house of быстро находить данные то есть никогда целиком файлики не читаются не читаются кусочками вот при этом решении такой экспериментальная и до сих пор неким толком не используется в продакшене потому что есть две большие проблемы первая проблема это то что когда у вас данные нас три они уже с реплицировали но клика у нас об этом не знает и другая базы данных до если она признать изначально не было сделано для клауда она не знает о том что у него клаус torture репрессирован и когда добавляется реплика не надо это делать второй раз и вторая проблема это скорость вставок из проблемы с файлами которые я упомянул окликал из он на каждой колонку в таблице создает иногда два иногда 4 файла если вас становится стока лунок кто один insert это примерно 200 210 220 файлов что дорого даже из 3 но есть некоторые способы вообще говоря говоря об архитектуре хранение до которая сделана вплеталась и и в некоторых других базах данных что то есть похоже то есть ли смотреть снизу вверх то на самом нижнем уровне у нас физические устройства на который может быть диск может быть дискос 3 сейчас делается диск hd fs то есть то где реально хранятся хранятся данные то есть некоторое такое описание абстракция дальше эти диски могут объединяться в том а зачем это сделано например мы хотим определить что у нас данные хранятся на каком-то туми и мы можем в этот том добавлять диски потом не меняя больше ничего то есть для в стальной системы это будет незаметно поверх домов есть политика который определяет как этот там использовать но и уже самого сверху лежит таблица что это позволяет это позволяет например делать то что говоря наживается называется тераватт конфигурации то есть когда у нас например данные сначала идут на быстрый диск а потом автоматически в фоновом режиме переписываются на медленный диск например наверное диск могут переписываться те данные которые старше семи дней таким образом у нас есть баланс от производительности для свежих данных исторические данные мы не выбрасываем а просто передвигаем в более медленное место они там продолжают работать естественно этой функции нетривиальная немногие базы данных это умеют это надо было специально делать большое спасибо ребятам из яндекс облака который это отвлекалась добавили следующая большая тема и обещание облака это отказоустойчивости надежность и здесь надо в первую очередь запомнить и как бы понять что база данных это не веб-сервер это не веб-сервер и это значит что нельзя просто выключить и включить почему потому что в базе данных выполняется длинные запросы то есть если за полне выполняется select если это не какой-то тривиальная штука а какой-нибудь аналитический запрос он может выполняться там сотни миллисекунд или секунды до если это insert в зависимости от того как заливается данные в базу данных один сорт может занимать и секунды и даже десятки секунд и минуты если мы сразу много много данных заливаем поэтому даже если делается плановый downtime его надо делать максимально аккуратно а в случае внепланового downtime а прежде чем бросаться и поднимать новую реплику всегда надо разобраться что происходит как мы делаем плановые downtime то есть сначала надо убрать этот сервер из балансира то есть чтобы на него не шли новые запросы никакие потом надо его убрать из внутренней конфигурации чтобы внутренний крика усадки запросы на него тоже не попадали то есть ли каас изнутри он между серверами гоняет данные когда мы делаем распылённый запрос ну и любая распределенная база данных так делает вот и надо это выключить сначала после этого подождать пока закончится запросы подождать пока добежит репликация потому что может так случиться что у нас в этот сервер который мы хотим выключить только что пришел insert и он еще не с реплицироваться и только потом выключать то есть это такая нетривиально последовательность шагов которую надо сделать случае с внепланово downtime а то мы не можем как бы делать таких шагов мы можем только подождать убрать из балансира причем многие балансиры это делают автоматически то есть они посылают запрос и видит что сервис нет ли не отвечает то они выбрасывают его из ротации и только через некоторое время может быть проверит и подождать разбираться в чем дело часто это восстанавливается сама и я объясню почему очень редко случае 18 вплетался требуется убирать полностью ноду и начинать с чистого листа димас талеров из фланта вот он и сегодня там настойки был он достойный год назад сделал из чарующий до крал доклад про база данных губернии в частности рассматривал эту проблему с отказавшей реп отказавшей репликой то есть то делать там со сплит brain им и прочими делами на примере mais quel и увлекалась и немножко проще из того что репликация асинхронная и если у нас что-то мы выключаем то это не страшно потом когда мы включим а надо гонятся следующая важная штука для надежности это география то есть мы привыкли считать что облако это что-то как бы одно монолитная на самом деле облако состоит из нескольких под облаков то есть в каждом регионе если это большой облачный провайдер там своя собственная абсолютно независимо инфраструктура если не дай бог бомба упадет на нью-йорк то европейские дата центр будет работать и и наоборот и внутри каждого региона есть то что называется зоны да наверное многие знают но как бы зоны а владельцы зоны отличаются тем что они на независимом питание и на независимой сети часто сидят то есть если там кто-то обрубить кабель вот та вылетит одна зона они они все поэтому что мы делаем мы хотим база данных разложить по разным по разным зонам это в первую очередь чтобы реплики лежали в разных зонах а что насчет разных регионов это тоже можно сделать но при этом нас появляется лет и носи на репликацию то есть если мы добавляем какие-то данные то они могут не сразу с какой-то задержкой добежать до другого региона и это не всегда не всегда допустимым поскольку наша основная ценность данные то как бы еще раз мы данные раскладываем по зонам плюс это еще недостаточно помимо зон еще имеет смысл делать бэкап это тоже эта функция которая в облаках как бы предполагается что есть но если вы свои собственные базы данных облака вкладываете то надо этим заниматься и некоторые облака еще дают возможность сделать снапшоты сетевой диск его можно за вас на пошутить и наверное при желании восстановить опять же это не всегда работает но можно попробовать вообще по нашему опыту самая частая проблема которая может привести к потере данных это кривые руки поэтому руки надо держать прямыми например случай буквально на днях был когда один из клиентов они запустили crack house запустили в cabernet если в каком-то облаке вот а потом пришли и ручками стали исправлять там размер волен клейма то есть коккола сколько диска у него диска они исправили а потом пришла другая утилита про который я еще расскажу увидела что размер отличается удивилась снесла все что там неправильно и создала новое и а не потерять данные то есть руки надо держать прямыми чистками если хочется все таки держать как бы dear сайт в другом дата-центре в другом регионе это тоже можно сделать и часто такой сценарий используется если у вас есть еще и поток данных который заливается в база данных он тоже распределен по разным регионам например часть инфраструктуры в одном регионе часть инфраструктуры в другом и эта часть льет в клика os или в базу данных в своем регионе эта часть в другой в другом регионе при этом мы хотим чтобы с точки зрения наших репортов или аналитики это выглядело как единое целое это тоже можно сделать вот примерно по такой схеме здесь есть такое ещё квадратик или кружочек звуки perdo эта штука которая включалась и необходимо для репликации и для координации репликации поэтому она должна быть blue к концертам поэтому где моим сердцем в один регион у нас там за keeper для этого под кластера и всем этим другой регион регион закипит для другого под кластера а потом мы их объединяем средствами откликался это выглядит как единый кластер удобства следующая тема как вы может быть заметили я все время говорил о том что это надо автоматизировать это нужно делать нужно делать раз два три 4 5 и на самом деле это потому что облака это всего лишь набор инструментов то есть вам дали набор инструментов но не объяснили как им пользоваться а делать придется все самим или же привлечь какого-нибудь помощником рулевого мы решили привлечь губернатор да и построили вот такую матрешку зачем то есть штуку берн это сдает в облаке казалось бы губернатор это как бы сама по себе публичного уголка само по себе но на самом деле губернатор он делает несколько важных вещей во-первых он абстрагируется само действие с облаком если вы научитесь жить в купе red если вы можете как бы жить в амазоне в гугле в ажуре в huawei callout где угодно то есть где угодно где есть cabernet с или же на бирме там тоже во вторых он имеет некоторые средств встроенные средства high availability который вам пришлось бы делать самим ну например самое одна из самых полезных и the life нас чак то есть если у вас что-то случилось с базой данных у него лай наш чек зафейлился куда нас автоматически выкидывает этот сервер из балансиров из всего и на него не идут запросы а потом автоматически пытается ри стартовать его и при рестарте как правило все приходит в норму ну и еще можно так сказать что облако она развивалась со стороны железо и вот эти все облачные объекты они как бы начинали at low level все время как high-level с той страны со страны железо двигались губернатора развивался со стороны разработчиков и такие объекты более высокоуровневые и юзер френдли с ним удобнее работать они естественно встречаются где-то посередке но вы работать удобнее вк обернитесь и при этом чтобы в cabernet если нам что-то сделать и например поставить базы данных то практически невозможно обойтись без того что называется оператор про оператора здесь на конференции рассказывает много и часто просто не потому что это модно а потому что это необходимо что делает оператор самую первую важную вещь вы когда вы описываете что вы хотите сделать и на основании этого описания оператор создает много разной инфраструктуры внутри кубер на ps а соответственно внутри внешнего облачного провайдера но это еще не все то есть оператор продолжает смотреть за тем что происходит он мониторит он поддерживает состояние то есть на самом деле достаточно большую часть операционных забот оператор берёт за вас и это очень ценно и важно практически для всех базах данных если open source операторы и откликалась не не исключение для многих их несколько для майского липовом три оператора есть вот как вообще выглядит например небольшая база данных cabernet а то есть это много-много разных объектов мы описали что мы хотим кластеров 2 шарда с две реплики я не буду приводить описание нужно достаточно большой но может быть на две странички ямал текста вот в результате оператор создает стоит в лс это создает внутренних контейнеры делает пирс тесто на твоем клеем и создает сервисы и все это как достаточно быстро и вам не нужно об этом думать то есть за вас уже подумали как бы разработчики они упростили сильно жизнь она помимо кубер нету съесть мы живем в облаке конечно остаются все облачные сервисы остаются в тоске лин группы авто остаются какие-то сабли и ты остаются load balancer и не уровне губернатор уровня облака и с ними тоже нужно взаимодействовать то есть находясь губернатор сеном тем не менее нужно взаимодействовать с внешней инфраструктуры и cabernet нас это умеет делать то есть есть какие-то там штатные вещь например кластеров тоске лир да это компонент губернатор который если у него не хватает not где запустить ваш новый сервер он идет в облако и говорит дайте мне ещё один инстанса там еще и сету instance он добавляется в губернатор и встает на него на него note то есть вам не нужно держать большой кудрина цис кластер вы держите его максима минимального размера и он динамически масштабируется через авто скейлер аналогично со сторожем вы попросили диск и storage controller пошел в клуб провайдер попросил а дай-ка мне пожалуйста диск с такими-то характеристиками он отдался под монтировался подмонтировать а к поду вы начали им пользоваться dns сервисе как бы аннотации то есть общение с облаком с точки зрения сервисами сервисов происходит через аннотации или же можно написать свои операторы например нам пришлось написать свой собственный лад бабло от балансир который работает лучше чем оба амазонский и вот его например конфигурировать можно через аннотации то есть он понимает это стандартный сервис объект но при этом как бы оператор понимает что если есть какие-то аннотации то нужно сделать что-то дополнительно например сходить и создадим с имя выписать сертификаты если мы хотим тела и соединение иметь сделать проброс куб портов до снаружи где у нас вход внутрь на наш на наш кликал или наши базы данных есть средства внутри к вернется которые делают похоже но можно сделать и свои то есть это система открыто что делать делаете что вам нужна последняя безопасность вот прямо перед этим докладом как раз показывали видео где говорили что безопасность в банке это как прежде прежде всего и все эти облачные штуки они просто не работают и на самом деле да когда мы говорим о бирме тогда мы привыкли что мы огорожен такой стеной нам нас периметр у нас там какой-то security сидит и никого никого не впускают снаружи не выпускают никто не входит никто не выходит и все у нас работает безопасно в принципе можно особо не заморачиваться о том как это каких-то реальных вещей в облаке все не так то есть облака она открыта всем ветрам то есть с любого там публичного адреса могут попытаться атаковать ваша ваш сервис и за этим это надо иметь в виду то есть что мы можем сделать чтобы себя обезопасить во-первых две писи это такая базовая штука в облаках которые делает вам как-то виртуально облака со своими собственными внутренними api адресами и нет никакого способа извне туда попасть теоретически но мы же не можем жить как бы вакууме обычно мы все-таки открываем некоторые сервисы наружу например мы хотим чтобы она наши базы данных могли приходить какие то извне наши другие сервисы которые не живут например в облаке это приводит к тому что x пользоваться много портов много интерфейсов наружу и это лишнее это лишнее риски поэтому правило номер два не открывать никакие лишние порты нужен порт 123 открывается part 1 2 3 никакие другие этой маски нужен порт 123 открыли но только для тех айпи адресов которые мы разрешили и для лица тех под сетей то есть как бы подход должен быть не запретительный разрешительный то есть мы сначала запрещаем все он потом начинаем потихонечку разрешать потому что обычно мы сначала все разрешаем потом начинаем запрещать и можно что-то забыть шифрование всего трафика наше выживание всего травка это нужно сертификаты и за ними надо тоже следить шифрование данных хотя мы предполагаем что инженеры google и amazon а никогда не придут и не попытаются прочитать данные которые вы там храните объяснять это каким-то там начальником не всегда получается поэтому шифрование данных и трест это практически требования для всегда если вы в публичном облаке живете достигли на проникновение логирование мониторинг это хорошо иметь логирование мониторинг обязательно иметь то есть если в что-то случилось вы всегда можете все-таки найти какие-то следы может быть если у вас есть какие-то тулы можно проактивно это увидеть в амазонии есть горди уйти которые пытаются смотреть ни странно activity то есть поскольку это все открыто чем больше как бы мониторинг и логирование тем больше шанс что когда что-то случится вы отреагируете и тем больше шанс что какие-то другие средства могут предотвратить это это что-то плохое при может лично я такой резидент перед тем как мы перейдем к вопросам база данных в облаках не работает из коробки и доклад назывался прокрустово ложе или испанский сапог так вот испанский собака это для тех кто пытается использовать до база данных в облаках не не не знаю когда потому что им приходится мучиться им это все жмет им неудобно они представь постоянно натыкаются на на что-то странное неприятное облачное обещание которые мы все слышим не только для клауд на этих сервисов то есть вся инфраструктура которые есть в амазоне вся инфраструктура который в гугле она их выдерживает но как только вы приводите что-то свое и пытаетесь там развернуться то сразу приходится все делать заново то есть все приходится делать самим но почти с нуля и заворачивать в кучу дополнительного softa губерн это здесь жизнь существенно облегчает и поэтому я советую сначала научиться в кабинет себя потом идти в публичное облако это легче и удобнее вот примерно так таким я крупными мазками это нарисовал можно в любую тему углубиться если есть какие-то интересные вопросы супер александр спасибо тебе огромное за это доклад и у нас для тебя есть персональная благодарность в рамочке а также а также худи и там значок холода у вас просто будет согревать и напоминать об этом поставим что ребята поднимайте руки задавайте вопросы если вы в онлайне вот я вижу руку если вы онлайне нажмите кнопочку выйти в эфир сможете задать вопрос оттуда прошу вас представьте себе задавать вопрос здравствуйте меня зовут александр компания skillbox с вашей стороны много было сказано про подали что использование баз данных губерний очень хорошо да как бы купюрница облегчает жизнь одна из последних фраз а не кажется вам что использование баз данных в класс терек вернетесь это только нет несет больше боли до чем это будет плюс потому что если у нас есть какая-то более менее производительна база данных которая требует ресурсов которые требуют памяти это выльется в то что она будет занимать там одну целиком там ноду worker классе руку бернетт с тогда зачем нам это лишняя обертка если мы не хотим чтобы она много занимала нам нужно поставить на ее какие-то лимита да ну мы не очень будем рады если кто-то томом келли придет и убьет нашу базу данных ну вопрос хороший и он полностью имеет смысл но я сказал что губернатор облегчает жизнь именно в облаках то есть если вы живете в бирме то то наверное поверни таз вам может быть и не нужен и это все правда а в облаках cabernet берет на себя вот куча всякой вот этой дополнительной машинерии который в обычном случае придется делать самим вы можете развернуться на virtual koch и сету инстансах но если но тогда придётся заниматься вот всякими этими вещами например что делать если это из титул сломалась как взаимодействовать там солод балансиром как выпускать сертификаты и прочее то есть придется куча всего дополнительного делать и в облаках есть конечно средства как какие-то автоматизации да какие там клауд фар машин и прочие вещи но губер нет все не сделано просто лучше тот overhead она дополнительные ноты которые который будет вот он не очень большой во первых во вторых вы всегда можете сделать так что у вас на одну ноту сядет только кликал из и больше нечего и мы обычно так делаем то есть мы берем виртуалку на нее прописываем там цель и решены до определенные вот и кликал встает только сюда и больше ничего сюда не встает соответственно мы используем целиком и полностью насколько это возможно может быть логичный подход если мы живем в селе в google плауде просто взять database а сервис и лишних лишних проблем избежать конечно конечно поэтому в тальке не текла вот это и есть та дтп ссср с которым вы построили ты кликал ся нету сервиса в публичных облаках для москвича пожалуйста берете аврору rds и прочее это все уже есть и это как раз встроена в облака сами провайдерами облаков если вы приходите со своей базе данных то вам приходится делать все с нуля спасибо александр вопрос слева от тебя из следующего после я вижу вот здесь рука добрый вечер меня зовут василий спасибо за доклад у меня вопрос такое сказали по операции что операторы это благо операторы это здорово и в то же время то что надо держать там прямые чистые руки да вот нет ли здесь ловушке в том что оператор позволяет буквально по щелчку пальцев развернуть тот же самый пик house в кубе но при этом это можно очень легко сделать теми самыми немытыми руками как вот как как здесь быть как найти границу когда ты готов использовать оператор для того чтобы разворачивать базы в кубе и при этом не сделать себе жутко больно оператор всегда лучше чем не оператор потому что оператор пытается за тепло ить некоторым стандартным способом то есть вероятность ошибки меньше но может быть конечно бага в операторе вот но если оператор работает корректно мы предполагаем что софт в принципе хороший надо уже опробованный то то что вы в нем напишите он сделает при этом вот эти вот ручки да они будут меньше гораздо лезть купер нетто с того чтобы 20 команд выполнить или написать какой-то сложный филм чарт который разворачивает куча всякого разного вы пишете маленький коротенький манифест и оператор делает все остальное хорошо у меня есть два примера первый пример как-то google первый вывод архитектура до гуглим с 3 в кубе получаем цех что он для цеха нужен pvc я гуглим pvc в кубе получаем меню и таким образом это случай которая видел буквально своими глазами когда у нас есть куб в котором развел меню для pvc поверх которого развернуться в ds3 это вот как раз руки те самые немытые и операторы которые со сильно очень сильно облегчают ты все-таки вопрос так как нету для операторов киста не знаю без факт из описанных готовых для всего то как как быть людям которые хотят вписаться во все с кубом с операторами если оператора такой блага и при этом говорю не сделать себе больно все таки и второй вариант 2 сразу пример приведу это как раз таки с клик хаусом опять же оператор деки хаоса клево для него нужен pvc что мы знаем мы знаем что проще всего сделать процесс с помощью анфиса развернулись и подключили соответственно его как псф куб и на этом развернули блэк хаус опять же жутко больно ну еще раз мы говорим про публичные облака обычных облаках в перечисленные вашими вами проблемы они как бы отсутствуют да то есть там уже есть стандартный набор сторож классов которые работают для многих из них родные storage controller и от клауд провайдеров вот там не нужно городить вот это вот всякую дополнительную машинерию который вам придется делать если вы разворачиваете куб на бормотал и пытаетесь там вот сделать всякий нфс там меня тащите и так далее поэтому мне кажется что губернатор сна борменталя да это для баз данных больно и неправильно а вот если вы хотите публичных облаках то вы 10 cabernet из очень хорошо помогает базам данных случае если ваш точки зрения отличаются . докладчик вы можете подготовить свой доклад на следующую конференцию завить мы с удовольствием вас послушаем сейчас на это спасибо у нас следующий вопрос и поднимайте руки заранее чтобы я могу вперед эти вот мы мы просто просто когда сначала когда рассказывает кейс на клик house и соответственно и уже коллега тут задавал на предмет того что там cliff house менеджер ничего-ничего публичных облаках так и есть же яндекс клал treehouse яндекс яндекс яндекс карт и яндекс лауда есть мой взгляд house где я так понимаю что ребята все это уже сделали то есть это как бы первый а второй может быть если не cliff house для реляционных субд этом вот вы говорили что он для москве или есть варианты переписанных встречали вы что-то похожее mine gets the bass то есть вот в cabernet же развернул развернута в публичных облаках как mindjet сервис для mais quel а или для подвеса может быть ну то есть первый понятно но первый вопрос понятием то есть есть наши друзья из индекса которые сделали индекс клава ты там сделали много разных сервисов в том числе манишкой house но наши облака не ограничивается я нокаутом если мы уходим в европу в америка куда то еще то там индекс планету и там приходится и про салатница там появляется и там нет и они в принципе не могут использовать русский русский сервиса все понял принципе вот не залит инси вот поэтому там приходится идти искать другие решения и здесь как бы нам пришлось это строить вот для москве лет после со здесь ситуация другая эти сервисы настолько мегапопулярной уже что практически все облачные провайдеры имеют свое решение нос армированного такого классного маску ну пост длится я не нашел то есть при судьбу большое достаточно для москвы или вот виды на бал но для москвы и для подпись вам тоже что-то они делали такого хорошего 0 для mais quel а нету шарнирного решения хорошего потому что моя сколь сам плохо поддерживает sharding вот именно как буду кого позвать сюда как и postgres клика вас изначально строился для определенной системы с радиком репликации так же как например vertica как еще некоторые другие базы данных то есть это как бы разный класс баз данных на рисунке заветный публикует не туда я напоминаю что представит выбрать александр лучший вопрос и для этого должно быть больше если у а у нас три руки уже есть немножко микрофон спасибо большое за доклад вот смотрите опять про баланс как вот коллега говорил классно совершенно оператор уже вижу там что он замечательно шар диков создал пиве сижки все прекрасно развернул теперь смотрите такая ситуация низкий порог вхождения оператор подразумевая что чек мало знает но доверяет оператору это классно это классно продавать замечательно те смотрите ситуация клиент с низким порогом вхождения взял сделать кластер а потом выйти на что ему нужно этот кластер отстрелить скажем так а прохождение низкий знает он мало он умеет писать короткий манифест на основе этого оператора что позволяет этот оператор ему сделать например серьезно то в 10 раз увеличить дисковое пространство или добавить щупе ток шандор причем хитрых что он будет делать и как вы при этом стимулируйте его увеличить некоторое количество знаний чтобы не отсечь себе базу одним неловким движением но оператор позволяет сделать то что вы попросили вот если человек не понимает что он делает здесь мы им помочь не можем то есть запретить человеку сделать себе больно и плохо нельзя что можно сделать а только образованием и поэтому если вы начинаете пользоваться оператором то лучше посмотреть примеры там просить какие-то вопросы и так далее в принципе то есть то что вы сказали добавить сторож добавить реплики это все сделать можно и может быть это сработает вообще сразу до нюансы начинаются в сложных ситуациях это простая ситуация супер те три руки что были мы всех вас успеем значит на первом ряду и поднимите еще раз ребят кто хотел александр здравствуйте меня зовут максим спасибо большое за доклад мне кажется человек если услышит вас доклад он скажет вам классно я хочу базу данных в облаке и первый вопрос который он себе задастся сколько это будет для меня стоить и вот если опустить экспертизу по кубу по конкретному облаку и оставить только старридж у вас был классный сайт где вы сравнивали скорость работы и ценник это человека была база данных на n в моей он захотел то же самое чтобы работал с той же скоростью в облаке во сколько раз именно повтор уже для него вырастет ценника на ты посмотреть на цены в облаке то есть еще раз вопрос про то что он был в бирме curl и ушел в облака или он из облака пришел в облака но по другому но раз в разных облаках по-разному еще считается 100 раджи то есть я не хочу услышать конкретную цифру вот по вашему опыту во сколько раз увеличивается ценник ну сторож в облаках дорогой сетевой сторож дорогой то есть мы платим за удобство вообще облака всегда дороже чем pure metal всегда то есть победит смерть невозможно это мы все знаем по цене вот платят за удобство за то что не нужно держать команду которая там дополнение где ваксов или что-нибудь за масштабирование за возможность масштабировать то есть это вот так скажем плата за удобство сколько это в деньгах я я не могу сказать но то есть это по-разному зависит зависит от объема данных скажем там и без стоит 10 центов за гигабайт в месяц соответственно терабайт данных стоит 100 долларов только за сто раз в месяц понятно что за 100 долларов можно взять серверах с нами в котором будет 20 терабайт может быть или 15 диска но это совершенно другое то есть это как бы сложно сравнивать вы получаете за эти деньги не только сторож но и возможность то масштабировать всякие еще полные другие плюшки и так далее про просто разные вещи так я вижу что у нас есть микрофон еще одного участника и кто поднимал руку напомните себе спасибо за доклад меня зовут виктор и такой вопрос про горизонтальное масштабирование мы у нас пошло большое количество запросов мы захотели от масштабироваться и instance должен ну реплицироваться мы в этот момент не можем выстрелить себе в ногу за счет того что мы создадим нагрузку на уже существующие инстансы вот как раз это репликацией 1 2 еще каких-нибудь все новых инстансов вопрос хорошая прямо в корень и то есть действительно когда мы добавляем реплику мы создаем нагрузку на другие реплики и здесь если вы заметили у меня было две реплики добавил третью то есть в таком сценарии мы на каждую реплику за нагрузка меньше то есть у нас была одна мы добавили вторую у нас бы очень сильно просела по первая реплика потому что стало бы реплицировать s2 на третью проседает гораздо меньше кроме того в большинстве баз данных и кликал с не исключение есть возможность контролировать вот скорость восстановления реплики если действительно такая ситуация что у вас очень сильно нагружена и вы боитесь что реплика еще сильнее про садит waste речь то надо подкрутить настройки чтобы восстанавливалась медленнее но медленней нагружала и эти реплики тоже да очень хорошо вопрос я напоминаю что если вы не до конца получили ответ на свой вопрос что-то непонятно вы еще сможете в цифровых кулуарах которые и в реальной жизни существует до задать ваши вопросы сейчас у нас последние вопросы из зала просто александр меня зовут игор компания swiss минск хотел спросить и водку бернетт с оператор имеет для него значения версия крика уса тайски house он развивается развивается очень быстро и вот он оператор он вершин агностик или могут быть какие-то там ключевые вещи которые там все вот на допустим оператор придется как-то кастомизировать доделывать и делать его как-то вершин специфик оператор может использовать некоторые некоторые фичи базы данных но не очень скажем так на очень старых версиях ли коласа может не все работать вот и возможно потребуется какая-то кастомизация или использовать старой версии оператора мы стараемся по минимуму делать вещей которые несовместимы но какие то обязательно появятся ну например сейчас увлекался появилась возможность хранить пользователей и описывать пользователей через сидел до create user так тогда там подобное при этом они хранятся в некотором локальном хранилище на диске вот это новая функциональность если мы добавляем новые реплики то нам нужно этих пользователей переносить это сейчас не делать если мы это сделаем это будет завязка на новую версию клифф хаоса и в старых версиях что-то может не работать но по большей части во-первых кликала с такая штука когда лучше все-таки не сильно отставать от мэйнстрима лишь миловидов считает вообще всегда использовать и самую последнюю версию крюка уса но у него как бы есть свой интерес потому что чем больше людей используют последнюю версию тем больше они тестируют то что не до тестировано командой вот мы считаем что нужно как бы использовать не самое последнее где-то вот состава нее может быть в полгода есть lts версии есть там версия который мы называем эти нити stale и вот для этих версия мы тестируем оператор очень аккуратно вот мы как раз all тенистой было использую которую сейчас 28 но в должно работать там все с оператором значит будем пробовать спасибо скажи пожалуйста какой вопрос тебя самым интересным был мне понравился первый и вот предпоследний так что делать что у нас выбрать один а если первый говорить из-под дорогу на тогда предпоследнее право добавление реплики под нагрузкой супер поздравим убедить или этого нашего розыгрыша спасибо за интересный опрос друзья александр какое-то время еще будет сразу налево и золотом цифровую на школа может быть из онлайна кто-то решится все-таки задать тебе вопрос спасибо да а я андрей шарин буду с вами и завтра с утра приходите в 10 у нас будет доклад про клик house только про то как и так ли house изнутри изменяется будет интересно сейчас в третьем зале будет небольшой ликбез для и хищников про астрономию а в восьмом зале дискуссия оба собственной разработки то что будет файлы сами знаете"
}