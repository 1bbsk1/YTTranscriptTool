{
  "video_id": "BlUHd2yZ-iw",
  "channel": "HighLoadChannel",
  "title": "DeepQuarantine for Suspicious Mail / Никита Бенькович (Лаборатория Касперского)",
  "views": 297,
  "duration": 1983,
  "published": "2021-10-04T02:45:36-07:00",
  "text": "всем привет меня зовут никита белькович я синий разбери сантис в компании касперский и большую часть своей карьеры в компании я занимаюсь разработкой эмаль решением и внедрения их в продукты компании связанная с почтовой защиты и сегодня как раз я расскажу про одну из них давайте сначала обсудим план о чем сегодня будет доклад мы пробежимся о посмотри на статистику спамером трафике дальше мы поговорим о типах антиспам решений и в основном в разрезе используемых данных далее мы перейдем к нашей технологии deep карантин который позволяет нам детектировать подозрительные письма с для того чтобы отложить их карантин для повторной проверки и после этого мы перейдем части с экспериментами от окна deep карантин в этой части мы хотели отразить потенциальные угрозы атак на индустриальные имеют эмаль решение и например из deep care and sin мы покажем действительную опасность которая есть на рынке в конце я буду рад ответить на все ваши вопросы спам мировом трафике 4 миллиарда активных e-mail пользователей 2020 году было зафиксировано источником статиста неправда огромная цифра сейчас сложно представить жизнь без электронной почты особенно в бизнес-сфере рост популярности электронная почта заключается в том то что это эффективный и дешевый способ передачи информации ровно же эти же причины ведут к огромному количеству спама в мировом трафике по факту каждое второе письмо в мировом трафике является спамом это ведет трем проблемам первое снижение производительности как и железа так и сотрудников которые этот спам будут разгребать второе потеря свободного места на почтовых серверах и 3 может быть даже наиболее опасное то что спам письма могут включать себя вредоносный контент который приведет к может быть привести к очень тяжелым последствиям я как раз указал на слайде сколько статистику количество вредоносных файлов и фишинг-атак который адаптировал только компания касперский 2020 году тоже огромные цифры все это говорит нам о том то что спам до сих пор актуальная проблема и ее нужно решать какие типы антиспам решение существуют я буду о них рассказывать в разрезе используемых данных и я выделил три основные области это контент репутация отправителя и технические заголовки если говорить о контенте это явный признак да с помощью контента спамеры взаимодействуют с получателями и кажется что нам еще надо это явный признак явно лучше чем неявное вот три давайте используя только его но есть определенная проблема с обработкой контента во первых это большое разнообразие как внутри одной рассылки так и между спам компаниями я уже не говорю о огромном количестве языков редких языков опускаться и прочего то что и прочих техник которые используют спаммеры для того чтобы обойти спам фильтры вторая проблема это ограниченная коллекция не спам писем поскольку у нас нет проблемы до с получением спамом мы ловим их в наши ближе на ловушки обрабатываем эти потоки и задаем сигнатуры но что делать с не спам и мы не можем получать его от клиента да то есть мы не можем получать эти письма поскольку не содержит какую-то персональную могут снижать персональную информацию и в открытом доступе по этим же причинам их нету второй тип данных которые часто используются для того чтобы отлавливать спам это репутация отправитель действительно очень супер классный признак вот он интерпретируемый всегда можно понять причина да почему письмо была заблокирована заблокирована это легко проверить есть если мы уже имеем списке репутации по ip-адресам либо по доменам нам нужно только проверить наличие и пили домена в этом списке но к сожалению спам и fishing может рассылаться из легитимных адресов например злоумышленники могут взломать ваш почтовый ящик либо просто зарегистрироваться в каких-то облачных сервисах для того чтобы рассылать спам и последнее это технически из головки а не содержит большой большой объем информации и необходимо для того чтобы передавать письмо эту информацию не так просто подделать в отличие даку какие трюки можно сделать контентом и чтобы как-то это подделать нужно иметь определенную техническую спирте за но опять же есть минус что спам и fishing может рассылаться абсолютно легитимно и можно сказать что нет какого-то универсального решения для того чтобы нет кого-то типа данных который покрывает полностью все семейство спам и сегодня мы более подробно поговорим о технологии которые основываются на технических заголовка письма но прежде чем перейти к самой технологии я бы хотел поговорить отрядов до всегда есть следов между точностью реклам и мы в наших решение всегда опираемся на точность потому что даже одно лиги тип заблокирована легитимное письмо например из бизнес переписки может привести к существенным репутационным рискам в этом случае бы естественный путь развития технологий есть писать детерминированные правило создавать сигнатуры которые имеют высокую точность они интерпретируемые вот но они обладают небольшим покрытием чтобы увеличить покрытие нужно увеличивать количество таких сигнатур окей но если лет 10 назад можно было по одной им до пятки до по тексту положить сигнатуру и она бы поймала всю компанию сейчас это просто не работает поскольку есть большое разнообразие внутри рассылки и много тех некоторые используют спамерами того чтобы пойти такие простые фильтры поэтому сейчас у нас есть много автоматизации в том числе мы используем методы машинного обучения для того чтобы фильтровать с помощью де обрабатывать на листики для того чтобы дальше создавать сигнатуры есть методы которого следует автоматически сигнатуру как раз о таком способе на предыдущем докладе рассказывал коллега алексей марченко да и поэтому большое количество спама сейчас обрабатывается в автоматическом режиме вот но если говорить о применении методов машинного обучения онлайн то есть много проблем как и по железу потому что ну стран надо использовать какие-то серьезные модели на почтовых серверах которые просто не позволят по своим техническим характеристикам их применять но и также есть большой большая проблема с тем то что мы можем задокументировать какое-то легитимное письмо даже одно как я сказал может привести к существенным репутационным рискам окей какие есть еще трюки для того чтобы увеличить прикол то есть да мы должны постоянно создавать новые сигнатуры их публиковать но бывает такая ситуация когда к нам в очередь попадает какой-то спам рассылка и это же спам рассылка попадает в этот момент на клиента вот ну нам же нужно сначала спам компанию сначала нужно определить ее нужно описать эти сигнатуры нужно доставить и в этот момент мы используем некоторые трюк вот он называется назвать карантин на карантин попадает письма чтобы пройти повторно проверку через какое-то время для чего это нужно для того чтобы выиграть время давайте разберемся чуть детальнее себе схемой и наверно будет понятно в чем преимущество карантина как я сказал что спам фильтры имеют способность протух а через какое то время чтобы избежать это мы создаем и постоянно отправляем новые сигнатуры клиентам что мы видим что большинство пропущенного спама в текущий момент могло быть зафиксирована обновленными фильтрами чтобы работать с этой ситуации мы откладываем подозрительные письма на карантин они не блокируются они остаются на почтовом сервере клиента и по истечении срока карантин и они выходят и проходит повторную проверку в это время у нас уже есть обновленные фильтры которые мы отправили клиенту и при проверке таких писем они не пройдут через этих красота обновленными фильтры в этой части я расскажу про deep карантин это наша технология которая как раз таки позволяет определять какие письма нужно откладывать на карантин а какие нет сразу оговорюсь в этой части я не буду рассказывать про гипер параметры модели про то как мы это как модель часто перри обучаем какой объем dtc то но я покажу как мы ее внедрили верхние уровни архитектуру и показатели которые она имеет в продакшене ok deep карантин это облачные технологии для обнаружения подозрительных спам писем мы задумались нам нужно какое-то про активное решение для того чтобы уметь работать на шаг вперед чем спамеры да то есть обычно мы получаем рассылки их как-то группируем и из-за того то что они поступают к нам на в ловушке быстрее чем на клиентов мы успеваем их обработать и отправить на клиенты в этом случае мы хотим действует на опережение и находить некоторые рассылки которые еще мы не видели в ловушках и их останавливать для этого мы решили использовать методы машина обучение потому что они позволяют достичь наибольшего покрытие чем обычные правила в этом случае мы поняли ok нам нужно кита проактивные решения их очень будет сложно как я сказал поместить в почтовый сервер клиент и тогда мы решили использовать облачную архитектуру как это выглядит сообщение сначала проходит через все фильтры анти-спам движка после этого они spunk ожог отправляет запрос в dip карантин и уточняет вердикт да стоит ли открывать письмо на карантин или нет если стоят письмо помещается на карантин если нет то она на прямиком отправляется на клиент какие плюс такую архитектура первых это достаточно простая интеграция с продуктом второе высокий вычислительный ресурс стримеров нам позволяет использовать ресурсоемкие модели третье это простая схема обновление модели если нам надо поддержит ее постоянно в актуальном режиме обновлять представьте если мы будем если бы модель была на почтовых серверах сколько нам приходилось бы прокачивать трафика чтобы передавать веса и последнее это такой провести аспект что все письма остается у клиента на почтовом сервере сервис поступает только технические заголовке письма абсолютно пуст и равны если не содержащие персональную информацию ok давайте поговорим о признаках который обрабатывает сервис важно упомянуть что зачастую спаммеры используют собственный агент для распространения спама и в этом есть как свои плюсы для их удобства так и свои минусы для успешно успешной отправке письма они должны корректно заполнять заголовки маем что просто письмо дошло до получателя ну давайте это проверим примерно таким образом выглядит сэмпл технических заголовков который содержит письмо и какие признаки мы оттуда будем извлекать первое это место 1 это некоторые уникальные секатор письма он содержит 2 часть это домена и некоторые иди важно упомянуть что этот айди имеет определенную структуру для разных агентов то есть разные агента его формируют особым образом второе это последовательность заголовков вот тоже стоит сказать что в принципе для отправки письма не важно какую последовать последовательности пойдут заголовки но тем не менее каждый агент формируют их своим образом и последнее это имя почтового отправителя как удалить архитектуру для последовательных признаков для мисс иде и для последние заголовков мы используем свёрточная сеть однонаправленные и вот если говорить в случае для мест среди мы представляем последовательность нас люди к последовательность символов на первым слоем на используем обучающие бединге потом от своих канва люцию стрелу макс pulling потом идет ряд слоев инволюцией без макс полинка и в конце мы используем макс pulling ровно такая же схема используется для последовательности заголовков но в этом случае вместо символов мы используем в качестве входных данных этой последовательности и с вами имен заголовков и выходы из этих канва люция мы объединяем с закодированным агентом дальше проходит несколько слоев полна связанных слоев мы используем drupal для регуляризации и в конце мы активируем наш выход с помощью сегодня что получите вероятность спама стоит отметить что такая архитектура позволяет достаточно быстро и обрабатывать эти последовательные типа данных и это очень важно для нас потому что мы имеем строгие ограничения по времени ответу сервиса если говорить о других каких-то технологиях да там по обработке после данных первое что может прийти в голову индифферентные сеть так вот если он пробил stm то такие решения мы не смогли на предоставить поскольку они зовут ли намного дольше чем свёрточная сети тем не менее в качестве мы не потеряли какие результаты у нас есть на обучение тесте стоит отметить что эти данные которые указаны они выборочные то есть мы и подготовили только для презентации для этого теста во многих из следующих работах показано что для успешной работы с карточных сетей нужно большие datasette и для тренинга мы взяли 120 миллионов объектов дать их вот заголовков где примерно 40 процентов спама для теста мы взяли 40 миллионов объектах с тем же процентам спам обучали такую сесть 9 пах использовали в качестве опции лиза тары стохастические градиенты спуск момент им равным 0 9 и уменьшали шаг эпохи каждый и уменьшали шаг обучения каждой три эпохи слева представлена pr кривая видно что классификатор достигает высоких результатов и хорошо может разделяется помог не спам а если представить антиспам движок то он устроен как графическая система фильтров эдип карантин находится на самом последнем уровне а действительность фильтры сейчас обеспечивает более 99 процентов спама но тем ни менее deep карантина помогает обеспечить помогает сократить пропуске примерно до 30 процентов таки вроде бы все классно технологии внедрили она уже достаточно долго используется в наших продуктах и помогает нам фиксировать спам но сожаление в современном мире любая технология может быть подвержены атаки эдип карантин не исключение как я сказал в этой части мы хотим показать опасность от окна и натуральные решения и показать примеры связаны с deep карантин младше задумывался как можно атаковать zip карантин вообще в этом году мы все глубже глубже погружаемся вопросы так на эмаль решение используемые в компания с целью устранить уязвимости согласно гартнера есть два основных за 20 нах методы атаки нейронных сетей в любом случае методы машинного обучения ожидают что данные которые были на обучение до распределение данных и в этом который будет использоваться в сеть будет на in fierce данных будет которых по так шине они имеют одинаковые распределения вот но и цель злоумышленника этому помешать есть два способа взаимодействия 1 генерировать входы с целью уклонения вердиктов тогда мы как бы меняем да некоторые данные в продакшене так чтобы модель сказала что окей там спама письмо стало не спам и второй способ это отравляет обучающий уборку для чего-то для того чтобы сместить модель и при выпуске ее в protection она началась ввести некорректно если рассматривать эти атаки и думать какая из них больше подходит чтобы такого дик карантин мы поняли что первый вариант достаточно сложно потому что часто нужно в этом случае взаимодействие с моделью напрямую получить от нее вердикты чтобы с хорошо сгенерировать вход а поскольку клетках сказал антиспам движок представлен как иерархическая система фильтров напрямую повзаимодействовать с технологии deep карантину злоумышленника не получится более релевантно вещи это dt poisoning тем более детали от которой мы формируем для обучения формируются автоматически вот с помощью нашего дисп antoshka и этот процесс нужно контролировать и в этот процесс может вклиниться атакующий если не секрет кто из присутствующих обучает внедряют методы машина обучения своей компании класс а кто используют открытые данные либо данные которые формируются автоматически нем ручным путем круто значит для вас это может быть интересно ok перед тем как перейти к атаке на deep карантин я бы хотел рассказать про атаку на google спам классе fire они рассказали коллеги из google а вот и первый способ атаки этому доски wink да когда загрязняется сет данными определённо классов стали смещение dessin boundary вот здесь указан gmail трафик спама не спам писем и выделено как минимум четыре масштабные попытки скрыть классификатор то есть если классификатор все больше и больше будет видеть не спама да у нас происходит дисбаланс сильный классов то он просто будет больше отдавать более склонен отдавать решение что письмо я не спала вами тегирование риска существует первое это как говорят коллеги с было необходимо контролировать чтобы небольшая группа пользоваться либо перестав составляла вашу обучающую выборку второе это необходимо сравнивать старую и новую модель с помощью dark launch это когда мы параллельно запускаем модель с текущей боевое сравниваем их предсказания об и тестирование и бэк testing и последний вариант это построение некоторых золотов dtc то которые он включает себя различные классы на который классификатор должен быть предельно точным ok давайте перейдем к атаке deep карантин дате начала разберемся с целью целью в этом случае злоумышленника будет чтобы классификаторов при лиззи отнес карантину письма какой-то таргетированной компании что это может значить что в какой-то момент в компании просто прекратится передача почты какие шаги нужно для этого злоумышленнику предпринять 1 это выбрать компанию понять какие агент он использую там можно написать вам письмо получить ответ и понять какие заголовки используются сгенерировать спам письма с отравленным заголовками то есть мы как-то меняем заголовки в текст письма добавляем явный спам паттерна и в этом случае при отправке такого венера на письма нашему клиенту мы получим это письмо движок определить его как спам и в конечном счете такие вот эти сметаны информации метаданные об этом письме по пути поступят статистику после этого модель заберет эти данные обучиться протестирует поймешь что все окей выпустить релиз и в этот момент произойдет то что письма выбранной компания попадут на карантин давайте рассмотрим первый вариант атаки модуль viking мы тоже решили повторить эксперимент которая была google а вот но не чуть-чуть его усложнили да мы добавили вот эту таргетированную компанию в мадриде сгенерированных писем последниц заголовков и их smaller мы оставили константные никак не меняли регенерации левую часть а лишь ника мы использовали это как это мы генерировали таким образом чтобы на строка была фиксированной длины вот такая длина которая используется в оригинале у клиента пойти посмотрите качество при разных за шум ления данных вот внизу как раз ось это процент защемления данных и видим то что наблюдаться не при хижин не рекорд это наши основные метрики они никак не не ухудшаются набор даже увеличивается это логично поскольку мы еще и загрязняем валидацию модель начинается хорошо определяется всего загрязненные данные веков растет давайте посмотрим как меняется если мы выпустили модель да как поменяется вердикты алгоритма при добавлении разного процента за шум ления видим что распределение начинают сдвигаться вправо и при 10 процентов за шум мнения от исходной выборки видно что большая часть писем это таргетированной компании попадет на карантин sunset мы решили посмотреть на что обращает внимание сеть извините такой вопрос мне просто времени показывается сколько у меня осталось тут не фиксирует когда к сколько время с и минута осталась окей спасибо извиняюсь за небольшой перерыв мысли решили поставить на что сеть обращает внимание и вот мы за 0 ли им беден генофонд позитив объектов чтобы посмотреть на что здесь конструирует давайте определимся как читаете эти графики чем ярче свет до чем более темные начиная эта часть мне jedi например агент или хыгр sequence сеть обращает больше внимания мы смотрим на разным процент загрязнений видим что при ему дал скиллинг как бы сеть при если мы начинаем увеличивать процент загрязнения видим что она больше обращает внимание на агента да он находится справа и находясь и констанц становится более ярким если вначале он был совершенно пустой это понятно потому что сеть увидела константы вот эти вот признаки начала на них концентрироваться мы видим до справа то что количество таргетированных количество объектов таргетированная компания писем увеличивается окей мы подумали что 10 процентов слишком много представлять если мы там используем как минимум 100000000 данных тот нужно злоумышленнику отправить 10 миллионов писем нашим клиентам чтобы это попало к нам на обучение ну наверное мы будет моментально заметили вот и мы решили усложнить задачу в некоторых мест среди используется в явном виде таймс темпы и что мы можем сделать давать им добавим лик из будущего давайте мы будем добавлять в обучающую выборку такие места трагедии у которых будет таймс темп из будущего представим что сегодня день релиза то есть на протяжении какого-то времени до злоумышленник должен был отправлять письма с такими способностями с такими заголовками в этом случае на обучение инвалидов мы предлагаем что сети легко отличить объекты окей да ты из будущего для нормальных писем и такую дату не встречаем и еще и домен компании ok все это спам давайте проверим что получилось видим такую же картину престижен recall нам никак не показывает факты атаки что происходит с вердиктом модели в условно в продакшне если мы бы это запустили мы видим что уже при 0 одном проценте распределение достаточно сильно смещается и в этом случае мы бы уже десятерых большую часть клиентских писем при одном проценте практически водители все припяти 10 уже картина не меняется что касается соли нсмэп видно как сеть начинает обращать внимание на этот мыс 6 да давайте посмотрим на это поздний один процент как я говорил мы этот темп темп мы указывали в начале мы с шади и вот ярким красным цветом выделена что сеть больше всего внимания обращать на него но поскольку на другие признаки но не обращала внимания мы видим то что и фоллз и на других компаний синий бар он тоже вырос то есть она увидела эти танец темпы и для других компания начала тоже их блокировать относить карантину точнее когда процент увеличивается 5 10 процентов мы видим то что сеть обращает внимание только на части мозги да и на зону разделение домена то есть она уже смотрит на понимает какая длина последова ность до домена и некоторую информацию о домене тоже начинает считывать ok мы посмотрели еще один вариант когда мы не знаем дату релиза модели давайте мы далеко в будущее будем добавлять лик в этом случае интересный момент то что при вот dark launch дали я бы тестирование если мы выпустили бы этому в модель для того чтобы померить качество день релиза мы бы просто не обнаружили никаких изменений то есть эти методы бесполезны какие результаты экспериментов во-первых модель фильм требует достаточно большого количества сэмплов он работает но надо много стараться престижен recall никак не отражает факт атаки добавление лика в данные позволяют атаку делать более эффективно действительно мы сократили количество отравленных элементов на порядок dark launch a и b тестирование могут быть совершенно неэффективны при отложенные атаки давайте поговорим еще пробежимся по способам защиты который предложил google отличный вариант использовать дата сэмплинг усложняет процесс проведения таки если в каком случае там с помощью нику надо отправить 10 миллионов писем теперь ему надо как-то думать о таких api идрисов отправляется таких ящиков отправляет свет и значительно сложнее этому задачу какие минус ну опять же не гарантируют полную защиту второй вариант построить золотую the site да может избежать существенных fall слов но это быстро теряет эффективность поскольку в спам рассылки часто меняется 3 сравнить предыдущая модель и текущая обученную теоретически да позволяет отследить изменение моделях но минуса что сравнивать престижен recall по него ничего не поймем наоборот наша модель будет лучше чем предыдущие во вторых сложно разделить эффект обновление влияния атаки как раз о том чем ей говорил при валидации мы не будем понимать да вот сейчас модель улучшилась либо час какая-то произошла атака и если мы будем проводить тесты на отложено при отложено таки the dark launch я б они в этом случае бесполезны что мы начали замечать как бы давать исходить из того что есть в момент салин тестер winter claw я б мы можем не поймать атаку если тестироваться на 1 выборки на валидация то мы не сможем отличить эффект обновления от эффекта атаки но поскольку модель достаточно точная мы начали строить распределение модели на валидации и смотреть как не спам объекта распределены и мы видим такую клюшку то есть что логично да модель стараются не спам объектам присвоить нулевую вероятность это продолжается как бы регулярно при обновлении модели но когда появляется за пользование данные до которой атакуют какую-то компанию то для легитимных писем компании появляется 2 мода на в этом моменте классификатор начинает быть не уверен куда относить объекты этой компании письма эти компании да если мы говорим про там на стандартные метрики могут там их обрубили при например пороге 08 да мы решение принимали бы опять же это не заметили наша область интересно чтобы это поймать мы начали используя собственную статистику чине собственно решили использовать статистика у вас . метрика да я не буду говорить как она устроена но приведу просто аналогию если у нас есть распределение во распределения грунта да то как бы дистанция 100 штейн она отвечает за цену до преобразования одной куче в другую и в базовом случае это прямо пропорционально сколько нам нужно перенести и расстояние куда нам нужно перенести это то что нам надо в области 0 на мне как бы такая метрика будет небольшая потому что мне надо далеко переносить не надо много 15 но вот вторую моду перенести к нулю будет достаточно затратно мы проверили эту гипотезу и для всех ок так которые есть у не рассказал она сработала и что более важно на нормальный кейсах это проверка не сработало что значит что мы будем успешного пускаться если а так не будет какие выводы во-первых методы машина обучения могут существенно улучшить качество датированные спама второе да это пользование к атаке могут нанести существенный вред и особенно если ваша выборка на вашу выбор куда может влиять какой-то отдельный там человек либо если вашего выборка формируются на основе открытых данных признаки производное от времени могут быть легко используем злоумышленниками в качестве лига это может быть не только само время и когда вы использовать такие признаки возможно стоит подумать о может быть заменить это на отдельный talking либо как-то это время модифицировать разницу брать во времени какую-нибудь не считать дембель стандартные метрики качества не отражают признаков атаки и поэтому нам необходимо больше контролировать процесс обучения и формирования выборки и последнее необходимо предельно аккуратно раскрывать детали обучение модели и архитектуру поскольку зная момент релиза нового модели злоумышленники могут провести более эффективную и таргетированный атаку большое спасибо за внимание на слайде представлена почты почты коллег если будут какие то вопросы дополнительно вы можете обратиться ко мне по почте да я напомню на всех случае что за лучший вопрос у нас предусмотрен подарок поэтому давайте начнем соси вопросов здравствуй дмитрий мой бог какие характерные времена нахождение писем в карантине насколько может задержаться доставка даже если потом после перепроверки кажется что это хорошие письма смотрите именно время которой находится письмо в карантине артрит не могу но она фиксированная то есть для каждого письма мы складываем письмо письмо на карантин фиксированное время так еще вопрос есть так хорошо некит спасибо большое за твой доклад"
}