{
  "video_id": "HRD872AtU58",
  "channel": "HighLoadChannel",
  "title": "Реконструкция YouTube.com - переписывая второй по популярности сайт в мире / Михаил Сычёв",
  "views": 7948,
  "duration": 3740,
  "published": "2017-12-11T03:25:28-08:00",
  "text": "давайте во-первых наверно представлюсь расскажу кто я такой значит работаю я в компании google занимаюсь последние 5 лет тем что помогаю разрабатывать сайт youtube.com и приезжаю сюда уже в третий раз второй раз как докладчик поэтому большое спасибо олегу и компании за то что приглашают меня и почему то каждый раз когда сюда лечу случается какой-то полное апокалипсис самолетами поэтому если я вдруг засну на сцене пожалуйста киньте с меня чем-нибудь чтобы я продолжил расскажу контента у меня очень много даже после того как я его порезал поэтому если пострадаю чуть-чуть кино и пожалуйста найдите меня после этого я буду очень рад рассказать вам подробностях значит youtube наивно и спрашивать знаете ли вы что такое youtube но есть несколько интересных вещей и тюбе начнём мы с банальной потому что youtube это очень популярный сайт настолько популярны что если верить алекс интернет единственный сайт которая более популярный чем youtube это google совпадение не думаю но о чем мы говорим достаточно редкая это то что а и естественно центром нашего того что такое youtube.com это video streaming и мы очень гордимся этим фактором что в целом в среднем по всему миру мы можем предоставить доступ к видео быстрее чем за две секунды если интересно как мы это делали два года назад то собственно хай-лоу 2015 есть мой доклад о том как я рассказывал как мы добились от и цифры о чем мы говорим значительно реже это о том что банально из-за того что youtube это очень популярный сервис мы делаем много другого что не является нашей центральной задачей и при этом все равно являемся одним из крупнейших сервисов практически всего в интернете и youtube.com давно уже не единственный клиента все у нас огромное количество клиентов начиная тостеров и заканчивая приставками консолями игровыми но все началось на youtube.com поэтому для этого сайта у нас особое место в нашем сердце и когда мы думаем о ютюбе очень часто ассоциирую ассоциируемся в первую очередь youtube.com и расскажу я вам сегодня в истории которая продлилась наверное года два и а для пользователей а снаружи youtube началась вот это вот страницы несколько месяцев назад мы открыли доступ возможность попробовать новый веб-сайт и мы до этого уже его несколько месяцев тестировали в закрытом режиме случайном режиме когда некоторые пользователи уже увидели но это был первый раз когда мы позволили людям по желанию воспользоваться этим вверх этой версии сайта и официально закончилась эта история 29 августа этого года когда мы полностью запустили новый сайт и если вы вдруг заметили о том что во всем ютюбе поменялся логотип или то что красный цвет стал очень красным это случилось толчет день но мы не имеем к этому никакого отношения и вот как выглядит youtube сегодня и если вы внезапно удивились почему он такой темный то наверное единственное очень заметное изменение функционале которая в первую очередь заметили наши пользователи это добавление тёмной темы не очень большое изменение ну и тот факт что мы теперь используем material design это стандартный ей язык который используется во всем во всем гугле и неудивительно что он теперь есть а но что люди как бы ни у нее не увидели это то что происходит внутри но при этом все равно логичный вопрос а что вы сделали и чем мы вообще сделали или перефразировав его чуть-чуть по-другому какой величины был дуб с которого вы упали когда вы решили переписать youtube.com и я постараюсь ответить на все эти вопросы очень надеюсь но для начала я хотел бы сделать чуть чуть шаг назад и сказать все таки что мы переписали потому что опять же без со стороны обыкновенных пользователем и чуть-чуть обновили наш визуальный вид и по факту мы выкинули весной frontend мы переписали большую часть нашего бэг-энда и мы начали с нуля и разработали совершенно новые инструменты для тестирования и разработки опять же вопрос зачем есть сайт он работает чем его трогать тем более зачем вместо того чтобы потихоньку что-то изменять зачем было выкинуть и построить все с нуля и есть несколько причин я считаю что они достаточно веские счастью люди которые приняли решение запустить новую версию сайта согласились или дать нам возможность разработать согласились но есть вот этот прекрасный комментарий который несколько отражается общую канву о том чем я буду разговаривать не знаю насколько хорошо видно но это комментарий на реддите от двух пользователей которые насколько мне известно были разработчиками ютюба в разные года и общий смысл этого комментария в том что один из разработчиков говорит с момента того как я ушел я не думаю что youtube остался как был когда это было просто куча питон скриптов и собственно 2 комментариями комментарии очень бурно на это реагирует естественно youtube это давно уже не куча питон скриптов которые как-то работают но сейчас youtube 12 лет и это значит что огромное количество тех решений которые были принят архитектурных решений решений плане дизайна были приняты многие годы назад и с учётом того что над ютюбом работают сотни и возможно работали тысячи программистов многие из этих решений были приняты людьми которые возможно уже давным давно покинули компанию но обычно я разделяю этих причин и на три группы и собственно первая группа заключается в том что когда вы работаете над сайтом которому на момент того как мы начали переписывать было больше десяти лет особенно сайт который вырос с маленького портала знакомств youtube был порталом знакомств первый день когда его открыли и превратился в один из крупнейших сайтов интернете то за это время внутри сайтом написано пишут очень много кода и проблема в том что опять же решения которые приняты в этом коде очень часто не позволяют разработать новые вещи которые очень хочется но к сожалению не может а более того мы заметили что новые программисты которых мы приводим в команду очень сильно унывают особенно первых несколько месяцев потому что самое эффективное средство найти что-то и починить это идти искать по коду вместо того чтобы просто знать где это происходит это не очень хороший сигнал и логично что к нам приходили люди с большого гугла и говорили когда мы уже наконец перепишем все на material design а у нас уже был опыт переписывание предыдущей версии сайта и мы знали что дело это будет не очень простое а более того youtube.com всегда был центральным веб-сайтом это было замечательно но в определенный момент в компании было принято решение что нам нужны новые сайты новые вертикали и есть наверное два наиболее известных новых сайта это youtube gaming я не знаю гейминг больше или меньше чем twitch но это очень большой сайт и youtube тиви сколько мне известно в россии он не доступен но в америке достаточно популярная вещь и мы столкнулись с проблемой что если youtube там и и кое-как пиши мы знаем что в нем происходит он для новых проектов у нас просто нету базой на которые мы могли бы писать и вопрос том возьмем ли мы то что мы уже сделали для youtube и попытаемся это как-то адаптировать или придется ли нам все равно писать что-то с нуля для этих проектов и 3 3 третья группа это то что в плане производительности мы достигли определенного плата и когда я здесь был два года назад в 2015 году и рассказывал о том какие мы молодцы как на замечательно все сделали и как мы достигли 2 секундной скорости а потом возвращался в свою команду брался за голову и думала о а дальше что делать потому что да мы сделали очень много работы 2 секунды это замечательно а идей больше нету и как двигаться дальше особо не понятно поэтому до получилось так что несмотря на то что двигаться вперед мы можем все это происходит настолько медленно что назвать это продуктом или состоянием которые соответствуют стандартам google и было очень тяжело и естественно нам хотелось поменять эту ситуацию потому что естественно хочется чтобы когда люди говорили и youtube или когда люди говорили google воспринимался это как наивысшие стандарты во всем в том как делать сайты в том как разрабатывать в том какие сервисы мы предоставляем и перед тем как поменять что-то мы решили все сесть и подумать ну хорошо нас то что есть не устраивает как мы можем двигаться дальше как можем сделать сервис лучше и естественно в най нашей целью во всем этом было как мы можем делать новые сервисы чтобы они соответствовали уровню гугла и чтобы это было быстро капитан очевидность понятно все это хотят сделать более того что такое соответствовать уровню google и это значит что делать продукты которые будут пользоваться использоваться во всем мире при этом делать поддержку для сотни слышим стран делать поддержку для всевозможных сложных ситуаций которые в этих сторонах могут возникать и глядя на то что у нас есть и глядя на ту базу которая у нас есть было понятно что мы бы хотели все несколько сделать проще потому что объем информации который нужно было держать в голове разработчика был совершенно запределен и мы хотели создать такие абстракции которые позволили бы держать на каждом уровне разработки только определенное количество ограниченных данных более того наученные горьким опытом того насколько медленно у нас все двигалось мы понимали что нам нужно просто переписать нашу среду разработки и сделать что-то лучше и тут я хочу сделать маленький шаг назад и рассказать о том о чем мы достаточно редко рассказываем на это очень интересная вещь абсолютно не являющиеся частью того проекта по переделывание youtube но важное для его понимания и мы внутри youtube когда говорим о back and и говорим о frontend очень редко разделяем их полностью и очень редко говорим о них отдельно потому что для нас это две стороны одной медали и нам очень важно чтобы обе эти стороны работали вместе и inner tube это так называемый backend который мы используем внутри я не знаю как хорошо перевести это на русский чтобы сохранить картинку со вселенной но это и 5 который поддерживает абсолютно все наши клиенты когда я говорю в те наши клиенты это очень много клиентов опять же youtube есть практически на всех типов девайсов мире а снова учишь ты что значит что до этой 5 до 3 5 бывают разные возможно это какие-то низкоуровневых данные возможно это уже какие-то структуры которые мы передаём мы приняли решение что для большинства наших клиентов мы будем делать так называемый presentation айпи это значит что мы создаем так называемые рендеры которые описывают структуру компонентов и данные для этих компонентов но не описывают конкретно как эти компоненты должны быть отображены потому что естественно android отображает не так как раз от с так делается совсем по-другому и у меня есть пример такого рендерер а в данном случае это данные текстовые джейсоне мы очень часто используем бинарные данные например для нативных клиентов но в данном случае эта запись определяет одну маленькую структуру на экране описывает какой не находится текст что очень здорово помогает для локализации нам не нужно ждать apple какое-то количество дней если мы внезапно перевели что то не так мы можем просто отослать новую строку и также некую дополнительную информацию связанную с тем что данный элемент делаешь данном случае это просто link поэтому куда этот линк делает навигация но если мы посмотрим на сам сайт и если у часто мне надоело рисовать эти квадратики здесь потому что каждая вот маленький элемент на этой странице будет иконка или некий текстовые элементы или список видео может быть рендер и на самом деле является потому что если посмотрим на код то увидим как как кэти рендеры написано front-end и собственно когда мы посмотрели на наш backend и мы посмотрели на эту структуру рендеров мы поняли мы хотим сделать что-то что очень легко на замыкаться на стороне и фронтэнда и у нас безусловно был выбор хотим ли мы использовать какой-то существующей фреймворк или хотим мы взять и написать все с нуля мы уже пробовали написать все с нуля нам не понравилось поэтому мы решили чуть-чуть поменять ситуацию все-таки воспользоваться чем-то что было разработано другими людьми потому что это конечно трейдов но всегда приятно когда фреймворком или библиотекой занимаются люди которые сконцентрированы на конкретно этом и что такое полимер полимер это библиотека в компонентов она разрабатывается компанией google и я думаю щас многие подумали ну естественно youtube выбрал что ты что сделал google не будут же они писать на reactie а вот нет мы на самом деле посмотрели на все включая в том числе react и не скажу что полимер выиграл с каким-то огромным преимуществом но нам важно было несколько критериев нам нужны нужен нужна была библиотека которая бы не вставала у нас на пути потому что мы знали как как мы хотим строить наш сайт не знали как мы хотим его накладывать на backend и было понятно что что-то очень тяжеловесное что говорит нам как рендерить будет не очень хорошим выбором мы хотели иметь в идеале существующую библиотеку элементов которые поддерживает material design и полимер предоставлял это мы хотели иметь что-то очень легковесное полимер достаточно близко местная библиотека и самое главное мы хотели иметь компонентами потому что в нашем понимании компоненты рендеры это очень близкие понятия и мы конечно живем не в во время джейк вере компонентами никого абсолютно в мире не удивишь а с одной маленькой-маленькой разницы то что полимер используют веб-компоненты и разница между что такое компоненты это имплементация компонентов на уровне браузера поэтому такие вещи как цикл жизни стандартизация и банальное название методов все это уже придумано за нас нам не нужно это изобретать и это очень здорово ложится на html потому что веб-компоненты в конечном счете оказываются обыкновенными тегами с уникальными именами и собственно мы посмотрели на то что в компоненты делают и нам очень понравилось мы решили давайте моих попробуем использовать и большой плюс в том что в тех браузеров которых веб-компоненты поддерживаются они работают очень быстро а в тех браузерах которые они поддерживаются хуже они необходимая функциональность которой нет поддерживается путем java скрипта что моем понимании это здорово потому что если другие библиотеки всегда делают все в javascript and the polymer делает сколько может в браузере и расчет этого должен быть быстрее и у нас на тесте пи мы очень любим поддерживать старые версии поэтому у нас очень большой длинный хвост браузеров полимер покрыл где-то 90 процентов что для нас вполне хорошее число если вдруг вы решите посмотреть на мир мобильных браузеров там все несколько более печально но мы сегодня говорим о доставь версия сайта youtube поэтому для нас это цифра была 90 процентов и что было замечательно опять же не то что web component и нам как-то сильно помогли на сама идея компонентов и написание всего на компонентов замечательно ложилась на то архитектуру которую мы имели в бэг-энде и очень сложный слайд на каждый рендерер который мы написали на бока индии мы написали web component на фронте нди удивителен и как я говорил если посмотреть на структуру сайта youtube.com если просто открыть его в инспекторе дерево дом то вы увидите что огромное количество элементов него мы наверное даже больше чем в стандартных дивов span of и чего то еще в нем есть куча элементов которые называются либо войти либо войти де вначале что значит либо youtube либо youtube теста и практически весь layout собственно сделан из этих вот компонентов и при этом и каждый из этих веб-компонентов браузер знает что он из себя представляет он знает как его оптимизировать в отдельности и на это сверху очень замечательно ложится ридак мы не использовали какие-то стандартные библиотеки но мы написали ридак пишет очень легко это очень простой концепт но это редакции то центральное хранилище propagation изменений и все изменения стоит а при помощи мутацией при этом мутации сколько мы нативные мы работаем в браузере мутации эти это обыкновенные браузерные ивенты которые просто потом дереву поднимаются поэтому вместо того чтобы реализовывать велосипед мы просто позволили браузеру делать за нас всю ту работу которую по факту он должен делать итак мы этим увлекли что написали только для одного ютюба 400 компонентов дальше очень длинный хвост всякого функционала который далеко не всегда виден вокруг всех наших проектов внутри всех наших проектов наверное уже за тысячу при этом это наверное данные где-то 6 месяцев назад не удивлюсь если мы существенно написали больше но и понятно это все же замечательное все здорово и полимер принес нам один очень приятный бонус о котором мы не знали на который очень помог а именно то что полимер по умолчанию несет себе имплементацию flex бокса и если вы вдруг разрабатываете если вы разрабатываете какие-то юань вещи для браузера мобильного тестов не важно и не знаете что такое flexx бокса никогда не пробовали вот единственная вещь которую нужно запомнить всего моего рассказа сегодня это посмотреть на то что такое flexx бокс потому что вы перестанете ненавидеть css но по крайней мере не так будете сильно его ненавидеть когда этого flexmax эта шикарная вещь а полимер безусловно не идеальная библиотека и об этом нужно помнить поэтому наверное центральная проблема связанная с тем что мы начали пользоваться полимером очень давно тогда это было еще даже не версия 1 и а во время версии создание версии 1 никто кроме браузера chrome не хотел поддерживать его компоненты вообще будущее их было не особо понятно и команда chrome приняла решение имплементировать спецификации для того чтобы показать что у этой технологии есть будущее для того чтобы помочь другим браузером сделать решение в результате и полимер один основывается на так называемой спецификации версии 0 хорошие новости в том что браузеры посмотрев на это все вендоры посмотрев на это сказали действительно веб-компоненты это здорово и в результате все стали их поддерживать но поскольку это бендеры и они никогда не могут договориться о чем-то в первого раза версию но ли мне понравилось они сделали версию 1 и для этого нужно быть напали мере 2 у нас есть огромный проект напали мере один поэтому у нас сейчас очень много радости обновляя его напали мертва хотя миграция не очень сложные стандартный библиотека компонентов шикарно для того чтобы сделать что-то очень быстро к сожалению не очень подходит когда нужно выжить каждую каплю производительности или нужны какие-то особенные вещи а и плюс полимер один был написан во времена когда команда его не хотела поддерживать какие-то официальные вещи за исключением очень самого простого начала скрипта поэтому в нем не было ни поддержке google clover которую используется внутри google для добавки типов не так скрипта поэтому с этим связано много проблем используйте полимер 2 в нем этих проблем больше нет значит теперь поговорим о собственно том как починили мы нашу среду разработки что у нас был когда среда разработки была создана а это было много лет назад youtube был наверное одна десятая может быть одна из 100 в размере от того чем он является сейчас и на тот момент это все было замечательно на к сожалению теперь после того как youtube несколько вырос ждать 15 минут для того чтобы запустить наш так называемый playground стало несколько неудобно потому что по факту это полная копия настоящего ютюба только запущенная на одном компьютере который стоит под столом и это не всегда очень хорошо работает потому что даже с нашими очень крутыми компьютерами под столом не всегда playground может опуститься более того когда мы работаем в этой среде мы естественно не работаем живыми данными потому что будет совершенно неверно и данные которые находятся в этой среде разработки очень часто устаревают или просто не отражают реальное состояние поэтому мы приняли решение опять же youtube вырос а у разработчиков появились совершенно разные задачи поэтому логично разбить эту среду разработки на несколько других более мелких задач которые мы внутри компании могли бы использовать это что мы делаем очень часто это мы просто изменяем ей захотели мы поменять красный цвет например как мы сделали это очень маленькое изменение и для этого мы создали очень простую систему которая запускает один маленький web component может быть большого компонент возможно это целая страница но это все равно происходит на уровне web component а очень быстро стартует и в результате этого запуска у разработчика просто открывается окно браузера и в этом окне браузера будет например вот один компонент который готов для того чтобы на нем что-то делать и что супер полезно у нас все компоненты могут находиться в трех состояниях это может быть и мгновенное состояние может быть темная тема это может быть текст справа налево поэтому эта система просто запускает все три версии компоненты и после этого можно что-то редактировать у себя в любом редакторе видеть как это обновляется в браузер для нас это окажется такая маленькая вещь на для нас это полностью перевернула то как мы подходим к тестированию то как мы о нем думаем потому что вы пленный момент посмотрев на только все это здорово работает мы приняли решение каждый раз когда мы реализуем новый web component мы заставим наших разработчиков писать тест естественно заставит разработчиков питать писать тесты получилось поэтому мы сделали это частью процесса создания скелета как что у компонента что значит что по умолчанию а каждый раз когда создается новый web component мы имеем минимальный тест который проверяет то что этот компонент может быть создан то что мы можем присвоить ему какие-то данные и ничего не взорвётся приятным бонусом сверху над этим оказалось то что определённый момент мы включили снятие скриншотов с каждого компонента и эти скриншоты это часть тех данных которые находятся в каждом изменении поэтому реальный пример компонент до изменения компонент после изменения абсолютно не связанное с этим компонентом изменения из реально очень и христа на первый взгляд очень похожи и собственно все замечательно в реальности достаточно сильное изменение между двумя компонентами и в данном случае ничего страшного бы конечно не случилось но когда мы говорим о сайте на котором работают несколько сотен разработчиков очень часто изменения в одном месте внезапно вылазят с другом месте о котором разработчик абсолютно не думал поэтому мы снижаем объем когнитивных проблем связанных с тем что человеку нужно всегда знать что может внезапно вылезти а это все проприетарные вещи они приторные не потому что они какие-то супер сложные или не потому что мы не хотим с ними с ними делиться они просто очень специфичные и очень хорошо ложатся на нашу систему но если вы вдруг захотите попытаться сделать что-то подобное есть такой замечательный open source проект который тоже основан на полимере он позволит сделать практически 90 процентов то о чём я уже рассказал очень часто при этом не хватает этого подхода и нужно сделать что-то более сложное например мы знаем что определенных пользователю определенном состоянии с какими-то данными что-то ломается и без сложных изменений данных на сайте это очень трудно отследить поэтому мы создали так называемый прокси статических ресурсов что это значит это значит что у каждого разработчика есть специальный extension кроме которые на самом деле делает очень простую вещь просто меняет адрес прокси никакого на прокси на локальном компьютере и мы перехватываем все статические данные и вращаем копию из локального клиента поэтому разработчик может писать все что угодно в клиенте при этом видеть в браузере исходный код они скомпилированный код ставить брэйк поинты открывать файлы вместо того чтобы иметь огромный файл в который обычно доступен на нашем ухо production версии и собственно работает на сайте с такими же правами с таким же доступом который был бы у него как у обыкновенного пользователю поэтому единственное что меняется это то что все эти ресурсы идут с локального клиента супер полезная вещь при делении тоже не всегда хватает ее но тут хорошо мы выкинули столько всего из нашего изначального начальной системы разработки что она внезапно стало запускаться быстрее проще поэтому для изменений на оба кэнди мы все еще используем и она работает вполне неплохо значит все мы это сделали переписали мы youtube посмотрели на то как это все работает и поговорите перед производительности хорошо 25 минут говорю рассказывая производительность первый раз ему слово производительность наверное прозвучало и когда мы переключились на полностью клайн сайт рендеринг и переписали все с нуля и вычистили все что у нас была внезапно оказалось что мы быстрее на 15 процентов и быстрее это такая очень сложная тема выше что значит быть быстрее как мы меряем что значит быть быстрее мы не можем просто сказать ну сайте при работают лучше и для нас несколько основных критериев которые мы рассматриваем во первых это скорость загрузки при первом запуске сайта естественно скорость навигации или мутации состоянии сайта и а когда мы перешли на клан citron ринг мы отдали себе очень четкие четкое понимание того что мы чуть-чуть потеряем на холодной загрузки но при этом получим много при навигации внутри сайта и это сработало хорошо потому что мы очень хорошо знали что внутри нашего сайта люди чаще делают переход с одной страницы на другую чем приходит на него в первый раз во-вторых что что мерите как мерить изначально когда мы разрабатывали старый сайт метрикой которая наверное определяло для нас все был так называемые ft или время загрузки контента сверху до разрыва страницы и мы чуть-чуть его модифицировали например на странице видео мы говорили главный контент это видео поэтому мы ждем пока видео не начнёт проигрываться это была неплохая метрика но со временем и во время работы над новым сервисом и с учётом того что мы стали настолько стильно уделять внимание рендерингу внутри клиента мы поняли что не очень хорошо это работает и перешли в первую очередь ко времени до интерактивности и разница между этой этими двумя метриками она не очень большая но можно иметь контент на странице но при этом пользователь не сможет ничего сделать ничего нажатие или даже не построили поэтому это более честная метрика она включает себя например загрузку всех ресурсов которые нужны для того чтобы что то сделать и опять же переход к рендерингу на клиенте привел нас к интересному наблюдение что даже когда мы знаем что мы быстрее брать среднее это все равно что средняя температура по больнице возможно новые браузеры нам очень мощных новых компьютерах буторин дарить нашу страницу супер быстро а старые браузеры на старых машинах будут гриндере эти три минуты и лучшие значительно чтобы это было в определенном не большом разбросе чем доставлять в пользователи которых которые просто старые компьютеры страдать поэтому собственно вот этот вопрос 50 процентов 95 процентов это столько это это вопрос сколько от общей массы пользователи мы берем для того чтобы посчитать вот это вот средняя скорость сайта и клайн side рендеринг значительно более зависит от производительности компьютера потому что естественно большое это это большой переменная для любого рендеринга даже просто ищете молчу про в партии требует времени зак лавин сайт значительно больше на это влияет и проблема с которой мы столкнулись в самом конце которая была абсолютно нелогично а потом мы не узнали когда мы сделали сайт быстрее не всегда пользователи это оценили потому что сравнивая старый новый веб-сайт мы например научились делать первую отрисовку странице значительно раньше мы рисуем вы головок мы рисуем логотип мы рисуем поле ввода и что оказалось то что раньше пользователи смотрели на свой белый экран браузера и думали о кей наверное интернет что это делает или что то еще а потом появлялся сайт а когда мы начали значительно раньше показывай части youtube и то внезапно вина в том что стоит еще не загрузился стало проблемой ютюба потому что ну логично что развитию позже показался то что то в нем работает плохо раз мне нужно еще ждать пол секунды не сразу мы это поняли но собственно когда поняли попытались визуально это чуть-чуть подправить что в результате опять же отошли еще раз к моему предыдущему доклада 2015 года мы постарались сохранить максимум того что мы научились делать на старом сайте не все к сожалению удалось поэтому несколько вещей пришлось выкинуть в основном связанных с рендерингом на фронте но если вы знакомы с такими проверками как ряд например или любым популярным фармером вы знаете что они делают очень много для того чтобы оптимизировать на стороне браузер и тут мы написали свой велосипед я думаю этот хороший велосипед основана на том что мы знаем как наш сайт работает и если вы знаете например помните визуально как выглядит наша страница с видео то у неё справа есть ряд видео на которые пользователь тоже может перейти когда пользователь делает делает переход с одной страницы на другую страницу то что происходит в этом блоке это очень часто просто смена мест разных элементов разного типа и это можно безусловно решить на уровне дом но мы обладаем знанием на уровне браузеры о том что у нас там есть компоненты поэтому он просто можем инструктировать браузеру и сказать обновить данные в компоненте или переставить 2 дом элементами с нами и это работает не хуже а во многих случаях даже лучше чем виртуальный дом просто потому что это ближе браузера это проще назначит суд мы это сделали все это было замечательно показали мы главным людям ютюбе они все покивали головой сказали на хорошо прототип прекрасной все сделали молодцы как сама техническое решение по себе очень здорово и вот эта вот картинка она супер глупая но я ее уже ненавижу потому что она была первым слайдом в каждой нашей презентация с которым мы шли к начальству каждый раз приходя мы говорили мы сделаем плохо а потом будет очень хорошо и начальство кивала и говорила но попытайтесь потому что когда мы начали показывать этот прототип когда стало понятно что прототип это скоро станет настоящим сайтом мы внезапно поняли что мы не можем просто взять и переключиться на новый сайт потому что у нас будет два сайта и мы будем разрабатывать эти два сайта очень долго более того мы переписали кучу вещей и это в приносит новые риски и более того мы очень компания которая смотрят на данные что если новый этот сайт каким бы он не был хорошим просто окажется не соответствующие нашим метрикам и нас было две части у нас была простая часть миграция нас была сложная часть миграции поскольку у нас уже был прекрасный backend мы сказали о кей с этого момента мы не позволим людям разрабатывать функционал на сайте не используя наш новый бэкон потому что он слишком упрощает миграция с одного сайта на другой если у нас уже есть что-то на базе этого бэг-энда мы перенесем это в наш новый сайт в первую очередь если у нас чего-то не хватает если вдруг нам очень нужно что-то староват сайта это ни в каком случае не переносит на старый backend придется импровизировать и придется пытаться обмануть и что-то сделать может причал в скрипте к сожалению у нас осталось 2 часть значительно более неприятная связано с тем что у нас было многое функционала который супер сложный в имплементации на пользуясь своим может быть единицы пользователь естественно мы не хотели и простаивания реализовывать нам пришлось принять решение что пользователи будут пользоваться новым вебсайтом если это у них не будет если потребуется какой-то функционал и старого веб-сайта мы дадим старой веб-сайт это очень плохо это влияет на наши light in se но куда деваться и в случае проектов которые буквально чуть-чуть может быть две недели попробовать что-то прогнать какое-то и эбби тестирование мы можем сделать от на старом сайте все что больше двух недель все что разговора месяцах или долгосрочном планировании то тут приходится садиться из каждой командой говорить по поводу их функционала и от этого никуда не убежать и вы это место где мы потратили кучу времени я хотел бы сказать что у нас какое-то универсальное решение которое мы придумали но нет к сожалению просто очень много работой и очень много коллабораций между разными командами пришлось к сожалению пойти по долгой дороги и не очень люблю этот камень этот комментарий и мы действительно когда мы думали что мы уже все закончили мы еще чуть-чуть поработали поняли что нам ровно столько уже еще придется написать просто потому что объем функционала который очень часто поддерживал за другими командами был полностью вне нашего горизонта до того как мы внезапно на него не наткнулись пришли мы к запуска нового сайта и собственно метрики на мы смотрим на огромное количество разных данных ни один не одну изменения на ютюбе никогда не будет запущена если она не будет соответствовать нашим стандартам в отношении метр и какие могут быть метрики три больших категории о которых мы часто говорим это общее отношение к ютубу очень абстрактная метрика и очень часто она оказывается под влиянием таких вещей которые не имеют никакого отношения к сайту вот например сейчас вот люди не любят youtube потому что проблемы с рекламой и естественно это супер отражается и поэтому тут новый сайт запускаем а люди начинают нам комментировать как они нас не любят никакого отношения не имеют поэтому к этой метрики мы относимся очень аккуратно и только и на нее смотрим в большом потоке людей глобально 2 естественно проблема это метрики пользовательские сколько люди нажимают на кнопку лайк сколько видео смотрят ну и третье это насколько быстро у нас работает front-end и если когда-либо видели на сайте youtube вот такую вот штуку появляющуюся это собственно то что мы используем для того чтобы определить общее отношение к пользователях сайта на супер простая но она позволяет приблизительно понять во времени как изменяется отношение и что мы узнали это то что иногда можно сделать одну маленькую свечу и получить огромный просто отзыв от наших пользователей и вот когда вот все эти статьи вышли это было очень печально потому что к этому моменту мы потратили уже наверное больше года делая новый сайт а пользователи заметили на нем темную тему это было единственное о чем они говорили ну все все для пользователей и тут увы где была зарыта собака это в где мы потратили большую всего времени это делая наши метрики совместимыми со старым сайтом в многих ситуациях оказалось что мы что-то сломали или эти метрики были созданы многие годы назад в некоторых местах оказалось что очень маленькие изменения в нашем дизайне приводит совершенно катастрофическим изменениям в том как пользователи пользуются нашим сайтом это было абсолютно непонятно пока мы их не сделали поэтому мы подвинули как у нас строка поиска работает и пользователей перестали смотреть видео что было неожиданно но вы с этим пришлось бороться и моя любимая тема это браузерное расширение потому что когда мы говорим настолько популярным сайте как youtube этих расширений огромное количество и когда они встречают что то что они не ожидали увидеть на сайте очень часто они ломались и ломались настолько что сайтом пользоваться больше было нельзя и наверное последняя вещь я не знаю как хорошо перевести чем загружен на русский язык это не принятие изменений наверное банальную что-то меня и даже если это лучше очень часто пользователи увидев это говорят я не знаю как этим пользоваться это новая я не хочу разбираться увы а теперь я поводу чуть-чуть наверное капитаном очевидность и подведут некий результат того что мы узнали за два года наверное переписывание чубом и капитан очевидность но мне кажется очень важно повторять эти прописные наверное истины это было сложное решение супер сложное решение и объем подготовки который был сделан на него был совершенно колоссально но в конечном счете и особенно сейчас когда у нас уже была возможность запустить новый сайт и начать строить некий функционал на его базе стало понятно что решение это было полностью оправдана и во время работы с учетом того сколько команд было замешано во всем стало понятно что всем к сожалению не угодишь всегда будут люди которые будут расстраиваться когда мы говорим что какой-то функционал а мы не можем или перенести или имплементировать но лучше всего у нас работала с теми командами когда мы были полностью открытой относительно того что мы планируем как мы планируем и было нормально говорить что мы не знаем мы не знаем сколько времени что-то может занять ее тут уже идет разговор о рисках и до тех пор пока все участники понимают что происходит это нормально перенос нашего кода в режим веб-компонентов и в целом компонентов был огромным успехом нас есть несколько метров связанных с тем насколько быстро новые инженеры могут начать работать и было совершенно прекрасно смотреть как люди также которые никогда не трогали фронт-энд могут в течение дня начать делать какие-то крупные изменения а то что мы переписали систему разработки опять же долгий и болезненный процесс десятикратная вернулся в экономии времени связанным с тем что наши разработчики просто перестали сидеть перед терминалом в котором прогресс бар показывает сколько осталось времени до запуска системы и упростив то как работает сайт он просто сделали всем жить легче и по поводу веб-компонентов даже если вы никогда не будете пользоваться полимеров даже если вы будете продолжать пользоваться реактор или ангелы либо любым другим фреймворком и очень рекомендую вам посмотреть сторону веб-компонентов потому что несмотря на то что это все еще очень новая технология и я не хочу врать рассказывать вам что она абсолютно идеальные решить все ваши проблемы перспективы огромные и я не удивлюсь если лет через пять я все фреймворке будут базироваться на базе веб-компонентов даже те которые сейчас не используют и на текущий момент пример это наверно одна из лучших имплементации веб-компонентов по крайней мере мы написали youtube на полимере и он работает и работает хорошо поэтому во многом это наверное такая демонстрация того что этот эта библиотека полезно и это наверное все в чем я хотел рассказать поэтому у нас даже осталось время для вопросов и я с удовольствием расскажу что знаю по сейчас поговорим а спасибо сейчас наше традиционное время когда те кому ну да вы надо выйти и зал выходит молча чтобы не мешать другим и друзья у нас 10 минут на вопросы поэтому пожалуйста если задаете вопрос задавайте так что было правда всем интересно и вот на втором ряду прямо на третьем дадите микрофончик пожалуйста вот друзья поднимайте руки постараемся до всех добежать как отреагировали от брокеры на смену фонтан да кто простите gear очередь реклама расширения как вообще вы с ним взаимодействуете не слышу извините мы жиров щеки рекламы смотрите walkure микрофон должен быть перпендикулярна лицу тогда вас будет хорошо слышно как отреагировали расширение которое блокирует рекламу на youtube и как вообще вы с ним взаимодействуете ну и пару слов абакане если можно ну я люблю работать в компании google я хочу продолжать работать компании google дожди на этой конференции hairy только сысоев окей хорошо они расстроились но расстроились не сильно по поводу бэг-энда что что-то конкретное или или ты наверное в основном мы просто выкинули кучу всего что писали 10 лет и что уже было карга культом потому что это было абсолютно не нужно мы все также используем бетон и мы люди любим питон замечательные поэтому мы выкинули большую часть прослойки между тем что делал энергию потому что на youtube поддерживать все клиенты это что он делает он делает хорошо вот этого последней мили между энергию вам и самим сайтом будкин или ее переписали ни каких то с вами сумасшедших инженерных изменений просто кот 2017 года пожалуйста добрый день спасибо за доклад у меня такой вопрос по поводу бэг-энда у вас на гитхабе в проекте и ютубы есть такая библиотека quit с для шарди рования mais quel азбука я знаю релиз полноценно еще не вышел планируете ли вы используете библиотеку или возможно вы уже использовать или ее такие какие есть никакой есть информация общедоступна по этому вопросу я честно говоря нисколько не знаком глубоко с тем что происходит на насколько я знаю что библиотека используется очень широко и сожалению не знаю будет ли она больше за релизе на но я знаю что это одна из серьезных технологиях которая используется не знаю к сожалению насколько это соответствует тому что есть на гитхабе сейчас понял спасибо большое спасибо спасибо большое за доклад и вот когда вы сказали про 400 компонент которые переписали то складывается ощущение что если вы не google то вам не нужен полимер потому что такое огромный объем работ для того что можно там практически нативно реализовать в реакции или view это как бы наверное вверх от добавлено то что обычно нам говорят все наоборот или дальше разработчики полимера нас осмотрели несколько странно когда мы решили использовать polymer для сервиса такого размера потому что очень часто говорят что полимер хорошо подходит для сайтов малого и среднего размера а для большого размера это собственно было испытание может может ли он быть использован для ютюба но в плане это не все эти 400 компонентов сразу активируется на в в на сайте это огромная библиотека из которых мы стараемся естественно активировать только очень маленький совет и я не скажу что тот факт что мы это написали на полимере очень сильно изменил это от того что мы написали на реакции или то что это такое количество компонентов поэтому полимер на самом деле здесь не помог как-то сильно на спасибо здрасте вы упоминали экосистему команд разработчиков народник вопрос большие много команд сколько людей задействовано насколько это стало эффективным на рынке системой зима действ я не знаю сколько у нас точно и разработчиков я знаю что одновременно над ютюбом и конкретно на дитю youtube.com не знаю но вот над всем вот ютюбом работает несколько сотен человек это тяжело сказать кто из них работает на youtube.com кто работает другими вещами то что очень часто это вещи которое касается много чего но тут наверное даже главная метрика это несколько одновременно работает а сколько программистов проходит через этот код на протяжении нескольких лет и одна из проблем в которой мы боролись то что люди которые уже ушли из компании или люди которые в несколько лет работают компаний просто написали столько много коды что без четкой структуры его просто очень много его трудно понять а в отношении новых инструментов я думаю основные метрики такие нужно было 30 минут что сделать любую вещь 15 минут стало 30 секунд для самых частых вещей нужно было потратить несколько неделя для того чтобы понять вообще как работает какая-то часть сайта теперь нужно потратить день для того чтобы понять то есть это очень большой качественный скачок но большая часть этого безусловно просто связано с ним что мы взяли и переписали что-то новый код лучше организованы естественно проще понимать но в плане к системы разбивкой к системы на много частей которые соответствуют конкретным задачам позволило просто оптимизировать процесс разработки городе вы говорили про метрики чтобы понять после переписывания стало лучше или нет и в частности там были метрики общей на просмотр видео лайне вот это все вещи как вы отделяете изменение о метриках которые вызваны именно переписыванием фронтэнда от всех остальных изменению всех основных факторов замечательные вопросы я понял что я должен был вас ведь эти абсолютно не осветил каждый раз когда мы делаем какие-то изменения мы делаем их в рамках нашего фреймворка по и по тестированию то есть мы запустили на определенное количество нашего трафика новый сайт на какой нам все остальное количество трафика старый сайт и у нас есть дашборд который позволяет посмотреть на два эксперимента одинакового размера то есть если например мы запустили 5 или 10 или даже 20 процентов на новый сайт мы можем такое же количество пользователей добавить в нашу контрольную группу и после этого сравнить и поскольку мы отправляем одни и те же сигналы чаще всего за исключением тех мест где что-то сломалось или где это неприменимо можем посмотреть в этом дашборде то насколько изменилась метрик например все мы поменяли просто передвинули куда-то кнопку подписки и для пользователя это стало менее понятным то мы увидим как по времени сначала это метры к пойдет вниз а потом когда пользователь разберутся она начнет подниматься вверх и для каждой из этих метрик которые какая-то команда ей владеет и мы начинаем с простых вещей подписки и лайки и уходим в очень сложные как количество просмотров видео при определенных условиях где-то внутри сайта есть команда которая управляет этой метрикой эта команда определяет интервал в которой изменения этой метрики разумно интервал в мнение метрики где нужно бить тревогу и после этого в этих дашбордов мы просто открываем огромную таблицы увидим моря красного и понимаю что вот это все нужно теперь починить чтобы запустить новый сайт спасибо за доклад у меня простой вопрос а вот сколько времени заняло от начала от инициации проекта по переписыванию фронтенда и до момента показы у кого слушать стоящей руководство было знал об этом с первого дня вот и крутила у головы смотря на нас но при этом поддерживала нас во всем и дала нам это время вместо того чтобы разрабатывать функционал просто где то сделать в результате дало очень много людей для того чтобы это довести до конца но между тем как мы отправили первые изменения и какие-то пользователи уже видели новый сайт прошло где-то в районе кода и наверное еще год мы занимались тем что приводили это в такое состояние как которая нас устраивало это очень долгий период мы прекрасно отдавали себе в этом отчёт и как это был оправданный временный период мы мы знали что при таком объеме изменений мы не сможем взять и быстро за три месяца что-то выкинуть но как такая как бы морковка который мы перед собой махали это было то что мы запустили гейминг это что мы запустили тиви на этой новой платформе то есть платформа уже было готово мы продемонстрировали что мы можем создать новые сервисы на ней единственная задача которая оставалась это перенести youtube на эту новую платформу просто потому что youtube был настолько большим и нам нужно было починить все метрики и далеко не всегда они были на самом деле сломанные для того чтобы сказать что да действительно теперь мы можем запустится на сто процентов спасибо спасибо за доклад такой вопрос по командам в искали что вас нет метрикой владеет команды был рад собственно интересно как вот этот большой продукт действительно проект бьется у вас на команда это кросс функциональной команды с участниками от дизайна до субботы или все-таки есть какая-то компонентная зависимость разделения и как если есть компонентное разделение вы планируете релизы как вы от потери на вот этих стыках в нивелировать и пассива ответ да за два года много всего изменилось из-за два года структура команд очень сильно поменялись на самом деле это комбинация и овладение над определенными фичами и команды которые в целом контролирует некий объем моники объем просто кода то есть например команда в которые я работаю телом отвечает за теста то есть как бы грубо говоря заказа vip-доступ но например у нас есть команды в которой отвечают конкретно за социальные вещи и они будут разрабатывать так например комментарии и они будут являться центральными владельцами комментариев мы будем вам помогать насколько это возможно и этих границ на самом деле очень много и это тоже одна из тех вещей которые вызывают у меня иногда проблемы потому что правильно понимать кто владелец и конкретно каждого части youtube и иногда требует определенного времени и опять же эти решения в моем понимании в правильные хорошо иметь команды которые на чем-то конкретно специализируется ну да у этого есть определенная цена а в плане потери вы имеете в виду потери виде данных или потери просто в виде коммуникации между команда б потери в процессе в эффективности то есть у вас допустим какая то какой то микро сервис бэг-энде живет у него свой жизненный цикл свой план релиза возможно да и вот вы сейчас переписывали фронт и у вас свое видение свой план на злые какие-то коэффициенты вы хотите сделать вот новую кнопку или старую кнопку но он с чуть чуть другим проведением она спускается до этого микро сервисы одном ребята говорят ну в бэг-энд добавьте там через семь месяцев или такого нам к счастью большинстве случаев удалось избежать этой проблемы потому что у нас есть и пиаре о reporting данных сайта и до тех пор пока данный соответствует этому стандарту то что делает клайн сайт достаточно мало релевантно проблемы начинаются тогда когда действительно эти данные приходят по другому и часто это связано просто с тем что приложение работает по другому потому что у нас например меньше холодных загрузок страниц просто потому что мы теперь настоящая сингл плеч applications большинстве случаев и отсутствие этих колдлоу влияет на метрики и тут опять же единственное решение которое мы нашли это перед каждым таким изменением находить тех кто владеет этой метрикой садится с ними и говорить мы планируем что это метрик изменится на столько-то процентов после чего иногда это занимало недель иногда месяца они говорят мы посчитали посмотрели и это все правильно и очень часто и а к сожалению у этих метрик есть не только мы консью мир и этих метрик а потому что носить огромное количество дашбордов которые видят наши creators наши пользователи и мы не можем просто в один день чтут переключить и человека которого жизнь может быть зависит жизнь заработок зависит от ютюба открыл свой дашборд у него там все упало на десять процентов мы ему говорим все хорошо мы бы столько же тебе заплатим это просто метрики поменялись такое не проходит поэтому иногда да это всякому компания сидит и думает как правильно произвести эту миграцию как правильно сделать и в некоторых случаях нам пришлось отказываться от каких-то изменений и говорить что мы не можем запустить новый сайт пока мы верим и нам придется запускаться с старым поведением и потом возможно мы как то сможем это изменить спасибо спасибо и последний вопрос с первого ряда спаси большая скажите как вы обрабатываете мишка понятные проблемы связанные например с версиями компонентов я так именно что вы теперь заставляете писать тесты конкретно под конкретный компонент изолирована я так понимаю что это именно fronted часть то есть доску если какие-то тесты которые покрывают все целиком на традиционный там не знаю как угодно назовите мешкам понятный и как в этом случае вы работаете именно с версиями потому что еще один вопрос вы планируете переписывать в будущем как то вот так вот по несколько лет или это все вы перешли к модели что вы потихоньку начинаете писать дальше без таких масштабных изменений ответ я сначала на второй вопрос я очень надеюсь что мы проживем еще десять лет не делая больше такое ни разу вот потому что нужно иметь очень строгую сидеть очень очень сильная аргументация для того чтобы сделать что-то такого объема и мы теперь лучше так потихонечку сверху на этой хорошей базе будем писать новые приятные фичи и радоваться я очень надеюсь что мы действительно сможем несколько лет теперь прожить эволюции они революции в нашей код но это будет безусловно мы узнаем через 10 лет может быть я приду сюда через пять я расскажу это был полный провал ничего не сработало по поводу пок пока все хорошо пока не так много времени прошло но нам очень нравится и нас есть несколько проектов которые очень хорошо себя зарекомендовали по поводу version насти на клиенте мы упростили себе задачу или нам полимер или даже вот компоненты упростили задачу тем что они не поддерживают апдейт в рамки в рамках одно одной загрузки то есть нельзя сказать вот новая версия wap компонента и пожалуйста используя ее теперь поэтому все приложение собирается и когда мы даже загружаем дополнительные какие-то ресурсы это статический слепок нашей базы кодов этот конкретный момент создания build версии сайта поэтому все всегда происходит в рамках одной версии когда мы обновляем например сайт при апдейте и говорим клиенту пришло время обновиться то это просто происходит за 1 шаг поэтому на клиенте проблем серьезных таких нет то есть вы обновляете все разом и не дай бог по кусочкам все съесть вы мне присылаете сообщение что пожалуйста перезапустите все может ли быть такая вероятность что я например открыл браузер от интернет отключился через две недели пришел в интернет в тоже вкладку и у меня все к чертям сломалась может быть такая не может быть когда сломалась все совсем сильная мы перезагружаем сайт на сильный то есть когда совсем все плохо когда у нас нет никакой стратегии восстановления мы отправляем сообщение обратно браузеров перезагрузить сейчас но мы делаем это редко потому что такие сообщения отправлять опасно потому что если что-то сделал не так the browser начинает делать два раза перезагрузку а мы очень не хотим удвоить наши пьес потому что у нас и так очень очень много gps поэтому в этом плане мы аккуратно ведем себя михаил сычёв google спасибо большое всем большое спасибо вы нас обманули вы не заснули на сцене но я постарался с такой-то аудитории"
}