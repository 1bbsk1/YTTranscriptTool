{
  "video_id": "7yYR1dgSfyU",
  "channel": "HighLoadChannel",
  "title": "MathOps или математика в мониторинге / Павел Труханов (okmeter.io)",
  "views": 2573,
  "duration": 2969,
  "published": "2017-06-28T07:07:50-07:00",
  "text": "привет ха-ха-ха матов не знаю насколько громко будет и сложная математика тут лупит меня зовут паша я усредняются ценители всем привет почему я хочу почему я решил что я хочу что-то разгар что то рассказать я работаю мониторинговую компании ок метр мы делаем сервис который как мы надеемся позволит тысячам инженеров не не повторять одно и то же в своих сервисов мониторинга чтобы одно и то же заряда из раза в раз вот и по профилю своей работы приходится много читать про мониторинг про метрики про про математику думать потом много читать еще и много думать не она болела и как это публичный сеанс психотерапии все значит началось 30 декабря 2010 года когда компания не для меня началось то про что я хочу рассказать компания идти и выложил на git хоп первый коммент своей системы 100 т.д. если вы не знаете такая штука написанная на java script и хипстеры ликуют потому что она супер популярно в нее отправляешься метрики за мир замер и каких-то исполнения кусков кода она их за тебя агрегирует и отправляет уже агрегированный в какую-то систему хранения который ты можешь следить значит это стал набирать популярность там новые функции в нее добавлялись и появилась такая идея как монитор и бритым то есть ты чем больше ты делаешь покрытие своего то есть чем больше вещей различных ты измеряешь своей системе тем лучше потому что когда у тебя придет какая-то неожиданная ситуация ты сможешь разобраться что там и как и вот давайте типа вообще все что можно мониторить и будет классом вот и но тут какая штука как с любой модные технологии или любой модой как только появляется какая-то штук который быстро растет и она в корне сделано с какими то там ограничениями то люди которые и начинают использовать они не очень задумаются об этих ограничениях ну там написано делай так и делаешь так на самом деле много там проблем и вот про это я хочу поговорить то есть мы говорим о системах массового обслуживания куда значит приходят какие-то запросы условно говоря независимые есть какой-то сервис которых обслуживает есть соответственно service time этого сколько обработка запроса заявки занимает и есть на самом деле еще response time это вот там то что в очереди собрались и эти системы то есть они в них то есть тайминги вот эти response time service time есть еще результат обслуживания это может быть успех или неудача если мы говорим про веб это ну access лак в котором записана response time мечты тебе статус ответа соответственно можно понять там есть ошибка или все хорошо вот и значит таких системах вот эти штуки события которые прилетают мы что-то хотим с ними делать и значит что мы хотим мы хотим чтобы пользователь который пользуется пользователь который пользуется чтобы пользователи были довольны для этого нужно чтоб все работало быстро без без глюков ничего ничего не вылилось вот для этого нужно контролировать постоянно что все так как мы ожидаем и есть какое-то вот это наша ощущая наше понятие о том как мы ожидаем что все хорошо а есть реальности мы ее с тремя сравниваем и это одна сторона вторая сторона когда она ну соответственно вываливается из наших ожиданий из того что мы задали как некую нормальную ситуацию нужно дальше разбираться для этого есть графики которые показывают нам я говорю про time series графике это значит что по горизонтальная шкала времени в верх мы что-то откладываем чем они полезны в таких ситуациях тем что они во-первых показывает impact то есть насколько все плохо можно увидеть как то кроме того они показывают значит историческую картину как это когда нормально когда вот не со ска все за филина и показывает динамику вот когда уже что-то происходит то можно видеть она ухудшается улучшается эта динамика вот что такое графики самое простое это ну вот мы вверх вот эта у нас есть у вас монитор в нем 80 800 точек или если у вас там более крутой монитор в нем больше точек вертикально но вот вот у вас для одного интервал время есть то эта вертикальная палочку которую вы можете заполнить какой-то информации и ну они бывают разные бывают такие бывают heat map и бывают разнообразные ночи мне нравятся такие графики и я их рекомендую тем что наш мозг он устроен так что он вот если вам нужно сравнить две вещи какая длиннее то он это делает очень классно но это эволюционное наше такое свойство вот и этот график он позволяет это напрямую дело да то есть вот здесь видно что там полтора раза чет меняется может быть около в два раза но то есть сразу этого это вот эта информация о том что здесь что-то меняется в полтора или два раза насчитывается моментально вот и вопрос соответственно как как сделал такой график у нас в единицу времени вот эта интервал который вертикальная палочка может быть разное количество событий там ну если у вас супер большая система там супер много событий до но неважно все равно их это не одно событие и у этих событий есть разные типы если это в веб-сайт сервис то у него есть разные углы у них опять таки есть разные тайминги потому что внутри системы устроен сложно какие-то запросы быстро обрабатываются какие-то медленно есть разные результаты как мы уже говорили для них тоже все по разному и это все каким-то образом надо вот эту вертикальную полоску умудриться уместить ну понятно мы можем ни один график сделать а много и разные аспекты смотреть на разных но все равно к для конкретного графика нам нужно из этих там многих событий с многими параметрами как-то изобразить одно вот одно число в общем ну одно число в конечном счете что такое 1000 таймингов на самом деле это там можно можно их визуализировать виде плотность распределения надеюсь многие знакомы то есть мы по горизонтали тире откладываем текущее значение этого тайминга вверх откладываем сколько таймингов с таким значением было да и видно что ну вот очень много таймингов с каким-то средним значением есть быстрые есть медленные кроме плотности распределения есть функция распределения которые просто интеграл от этой и соответственно чем она хороша тем что у нее область значений то есть вот у левой вещи и у нее плотность у неё вертикальная максимум он может быть в произвольном месте от зависит от того на сколько она там размазана а у функции распределения классно что она от нуля до единицы это позволяет их сравнивать там совершенно разные между собой вот в отличие от этих которые там непонятно как нормировать и все такое но в реальности протестим который мы говорим о не выглядит вот так они как вот это известное всем кривая нормального распределения которые колокол такой ровный почему они выглядят так ну потому что даже ну потому что и минге не бывают отрицательный ну если у вас на сервере время назад пошло они могут быть отрицательный но в большинстве случаев вы этого не увидите вот почему они выглядят так это тоже некая модель это называется logo нормальное распределение то есть просто экспонента от того чего был на предыдущем графике колокол она экспонента дает просто что у нас нет отрицательных значений потому что как мы вот этот колокол не смещаем в область положительных значений до туда она туда значит то все равно будут такие которые вы отрицательные будут появляться поэтому это никак не годится ну то есть как модель это в принципе не годится для описания вот этих наших систем и но реальность она конечно же не даже не такая потому что это к эта модель logo нормально распределения почему ваша система выглядит так они вот так ну не очевидно очень часто систем выглядит так то что вы там прикрутили моим кошка своей php блайнды запросов по полу memcache плен запросов не попала на мкэш соответственно вас by модальное распределение два пика ну там совсем по чесноку они реально конечно же выглядит как угодно чем сложнее вас система с одной стороны тем они более разнообразные будут да там разные типы их опять таки чем более но с другой стороны когда ваш систем становится просто о они очень сложные за миллиона деталей то она наоборот все скатывается обратно клуба нормальному распределению среднем вот и важно что вот эта штука которая на у нас есть за каждый там интервал времени ну пускай за минуту мы измеряем вот она есть есть есть есть и и дальше она есть вот что нам с ними надо делать надо взять от них статистику на тоже 1000 как ну вот мы можем отложить допустим одно число на графике вот это 1000 измерений и статистика это значит эффективное сжатие вот это наши плотности какое-то в одно число то есть потерей данных и нам известны и статистике распространенные то там среднее арифметическое которая не у смысл это просто центр масс вот этого вот этой фигуры есть мода это просто пик но там возникает вопрос когда у нас несколько пиков чего с ними делать есть медианы от когда ну вот по площади пола и на площади левее plain проще площади правее это медиана и соответственно другие перцентиле но эффективно это не важно что я хочу сказать это что неважно что какую статистику конкретную вы выберете важно что это все равно одно число которое которым вы пытаетесь описать плотность распределения или там измерения выборку какую-то в которой там 1000 наблюдений ну понятно что это сделать реально нельзя смысле что нельзя сделать чтобы она ее полностью описывал вот ну значит мы взяли какую-то статистику ура у нас появился график вот в данном случае от график среднего арифметического ну вот по нему тоже опять таки что то уже понятно что он там колеблется как то с одной стороны с другой стороны он более-менее ну более-менее постоянен в том смысле что здесь есть разброс но нет разбросанное порядке да то есть вот там один-полтора им что-то такое среднее вот вот эта плотность распределения которое взято с конкретного там сервиса и моя одна из целей доклада не пока мне научить вас каким там сложным математическим моделям и что такое для этого есть учебники и онлайн-курсы показать что наши интуитивное представление вещах вот связанных со статистикой она вас подводит время и что предлагают что вы в голове сейчас выберите одну из за один из вариантов которые есть и мы посмотрим ну как сеанс черной магии с разоблачением я естественно буду пытаться вас обмануть всячески иначе какой смысл во всей этой штуке да но вот если вы выбрали почему здесь средний равно да но мы же все тоньше можем там представить дело не центр масс вот такой средние у него здесь я оставляю на вашей совести представите вы правильно у году понять вы правильно угадали ли обманулись а вот но point в том что эти штуки они совершенно разные пока вот вы ее реально не измерили как то там вот эти кучу наблюдений собрали отложили такой график построили от него статистике посчитали вы на самом деле не знаете как оно там будет потому что ну вот другая система вот ну шкала там тоже самое приблизительно но уже варианты другие потому что ну и система другая понятно что чет наверное у нее по правее где-то вот опять таки ваша задача загадать число выбрать по сути ну может еще свое придумать туда вставить если вам не нравятся мои варианты вот ну тут 500 значит хотя казалось бы у нас вот две такие здоровые блям бы и они должны уравновешиваться и где-то ну мне я не знаю да вы может быть вас голове компьютер и неонка а моя голова говорит что она должна быть скорее где-то в области 300 ну и почему тут point том что если мы на самом деле зазумь им эту штуку то вот я и сразу вверх то выясняется что у него значит на вот этой дальнем хвосте тоже есть наблюдений которые просто не видны когда мы в том масштабе смотрим и это вот реальная система это то как сложные системы себя ведут у них всегда будут там есть какая-то конкуренция за ресурсы до одновременно много запросов приходят есть какая-то конкуренция за ресурсы всегда будет ситуация когда для какого-то конкретного запроса ну плохо звезды там сошлись и туда улетели тайминги и поэтому среднее но вот не там ну и тут по правилу рычага так как это физический смысл это ну матожидания это реально просто центр тяжести то поправил рычага конечно дальне этот хвост он перевешивает вот почему есть такая идея что средняя плохо очень для мониторинга использовать и фанаты перцентиле есть и они вам скажут с любого угла будут кричать что я видел тебя среднее ты плохой человек возьми 30 или на самом деле в этом есть некий смысл то есть они не на пустом месте говорят и что здесь во-первых физический смысл у него какой то есть вот кроме того что это центр масс да но это в центром от плотности распределения к нашей изначальной системе непонятно чего как это относится реально физический смысл это когда вот вам нужно как вот у вас есть какая-то какие-то системы вы хотите такое число что если вы делаете ставки по этому числу для разных систем то у вас в среднем вы не будете ну и и ставки важно важный очень момент что ставки ваши результаты того что сделали ставку или выиграли проиграли он накапливается то есть у вас сумма которую вы выиграли вы ее складываете в один мешочек с деньгами и он накапливать вот в этом смысл математического ожидания ну и среднего арифметического вот в нашей системе который там разные пользователи туда приходят у них ожидании что они очень быстро и получат там карточку товара если это интернет магазин и купит этот товар нет никакого матча того для чего прямо от ожидания придуманные для того про что или про top в прошлом мы говорим вот вторая второй аргумент фанатов перцентиле в том что средняя но вот ниро bosnia к выбросам ну и правда как мы видели да там вот на дальнем хвосте там одно наблюдение оно перевешивает много того чего близко сюда вот но на самом деле что я хочу сказать что вам в мониторинге раба снасть к выбросам она не нужно вам наоборот нужно ни раба снасть к выбросам вам нужно систем который будет показывать что если у вас вообще-то никогда не было такого что значит вот это ваш среднее но там выходила за какие-то границы а вдруг один какой-то далекий выбор из который там очень далеко он появился атака вообще раньше не был вы конечно же хотите об этом знать вы не хотите закрывать на это глазки и говорить не чет не интересует работа на к выбросам я хочу зачем вообще нужна раба снасть к выбросам это вещь нужна когда вас задача не мониторинга то есть контроля постоянного системы когда вас задача исследовательская вот вам досталось наследство или откуда-то еще какая-то давайте систем ну неважно какая то система вы хотите даже не эти эффективен природа нам всем досталось наследство от реальности мы хотим изучить ее свойства вот когда мы хотим ее изучить свойства мы хотим какую-то мы хотим пронаблюдать какие-то измерения записать и центральную какую-то вещь которая там есть ее как-то выделить вот типа а снова вот конечно понятно там всякие факторы влияют вася который делал наблюдение он там заснул и записал неправильно что угодно и тогда вам раба снасть к выбросам нужно а когда но потому что это будет влиять вот эти совершенно не связанные с там с центральным законам того что вы исследуете события они будут влиять не и вот там вам нужно работать когда вы мониторите контролируете вам наоборот нужно знать вот все эти все эти выбросы в том числе ну соответственно вот там это колокол он там порезан на куски в процентах сколько остается все значит знают многие знают про три сигмы которые вот на отступим там будет очень мало наблюдений давайте повесим на наши любые метрики такую проверку который будет говорить если она вылезла за какие то три сигмы от среднего ну вот что я хочу сказать что на самом деле вот здесь два процента и кажется ну там все же знают три секунды до 2 процента это 200 гмо 33 сигма это вот если на один край если брать то это ноль один процент кажется но это жутко редкие события на самом деле да но на самом деле нет потому что вот раз в 700 наблюдений у вас будет туда чет вываливаться ну за два края если то есть короче их что хочу сказать что у нас даже у нормального распределения вот эта идея что от 37 мы возьмем все с запасом она на самом деле приводит к тому что у вас происходят события которые выхода за вот эти три сигма чаще чем вы ожидаете и они вам спамят если это мониторинг они вам спаме то есть и такое вот и тут мы вот эти две задачи я хочу их объединить мы сначала хотим понять как наша система себя ведет и это очень важно потому что наша идея о том что мы знаем как она себя ведет она реальности может не соответствовать никак пока мы ее реально не проверили потом мы когда уже вот кого то распределение построили мы какие-то пороки се выбрали придумали значит завели на них alert и мониторим и все здорово вот что такое нормы вот на мой взгляд тут это значение 300 она не описывает какое то среднее поведение системы вот 50 перцентиль медиана уже по моему личное ощущение что-то ближе к тому чтобы я называл таким типичным для вот этого распределение ну вот мы опять будем с вами играть в игру я буду делать это на протяжении всего доклады вам даётся этот момент но все равно здесь я рулю ситуации вот значит предлагаю вам гадать 90 перцентиль ну 50 и вам для наводки данная не знаю сколько это вам поможет вот 25 до загадываете число только честно конечно сейчас можете себе в галатам 3 числа загадать в том из них взять какое будет ближе но это ваше дело вот она вот здесь и что что тут я хочу сказать что получается что вот чем мы берем больше перцентиле мы уже как то более подробно вот это наше распределение описываем то есть понял что его можно построить и посмотреть на него глазками решая задачу исследования как наша система себя ведет но так как у нас после задачи исследования все равно возникает или задачи контроля или задача там мычат с optimizely и по хотим посмотреть насколько повлияла все равно нужно как-то ограниченным количеством параметров характер за чтоб можно было сравнивать ну и что я хочу здесь показать что вот казалось бы такое же распределение ну почти такое же да там с точностью до шумов но у него там 90 перцентиль уже она в другом месте совсем находится и ваше ожидание от того что что с перцентиле происходит оно не такое на мой взгляд как вы думаете вот 95 процентиль ну вот я предложу предлагаю вам два варианта но моя задача вас обмануть ну и на самом деле она далеко там находится казалось бы ну уже что там 5 90 95 но на самом деле очень далеко и вот обещаю на пока это последнее такое упражнение тут другая шкала совсем давайте опять ну да там до 20 нарисованную и уходит так за грань экрана наверное я отчет хочу туда доказательно смотрим там ничего нету уже все все 0 но эффективно 0 это вот честно построена гистограмма эффективно уже 0 вот она они от подождите 90 95 вот там вот ну мои ожидания мне говорят что чувак подожди у тебя почти все вот здесь до 15 миллисекунд 95 почему так там ну хорошо 95 такая классная пирс антифанаты нас убедили что важно смотреть не на средней и уж тем более не минута мне на медиану важно смотреть на спит она сильно больше чем все вообще что мы вот реально наблюдаем давайте мониторинг на нее заведем есть там понятие силе слов силой но это-то мне важно для нашего текущего мы ставим себе вот такую штуку и начинаем за ней следить ну как бы когда не так значит что-то не так так как она далеко уходит и все все центра все все что мы реально наблюдаем она сильно меньше чем этот 95 процентиль значит нормально на самом деле мой вопрос тут много опять-таки пунктов почему это не так первый мой пункт это значит что вот ваши 90 перцентиле вы по ней всё контролируете это вот ваша система сегодня а завтра она себя ведет вот так и 90 перцентиль находится на том же самом месте но systems на самом деле конечно вы вообще-то хотели бы знать что вот это произошло а послезавтра на себя ведет вообще так это ж вы хотели бы наверное знать по это опять таки в том что давайте смотреть только на пир сантилли но не работает все всю жизнь всегда сложнее вот ну хорошо давай больше перцентиле следить за 95 мало 1 95 мл давай сейчас там вниз вот 7 пяту еще каким-то напишем вот ну то есть получается вот мы такие задаем на что наши текущие требования на поведение системы она выглядит вот так то есть это вот эти пороги она поднимемся идет то как синенькая полоска нарисована эта реальность ну тут логарифмическая шкала внизу но эта реальность том смысле что когда вы зажимаете свою систему по каким-то порогом вот такого характера и начинаете допустим она не удовлетворяет этому сразу вы начинаете ее сжимать чтобы она давай там тут с оптимайзинг тут кашу крутим она на самом деле начинает себя вести от ровно так она пытается из-под этих порогов выскочить как только может то есть вы ее задавливать и но как только вот это чуть старше чем то на что вы смотрите она там выскакивает ну и второй момент который я хотел обсудить это ну вот мы там 7 я не нарисовал 75 ну допустим мы следим вот за этими там тремя перцентиле хотела обсудить это вот очень часто я вижу системах мониторинга и нас все время так как на мониторе компания на страниц про вы рисуете 95 перцентиль и мы такие да там можно смысле она у нас есть но мы ее там прячем ее стараемся не показывать людям потому что вот она misleading то есть она вас вводят в заблуждение что здесь вот что здесь не так здесь не так то что 95 из 95 из 100 где вот еще пять значит там же еще пять есть она вот где-то там ну очень низенькая и мы такие но это уже редкие какие-то события не низенький на самом деле вот они то есть ну понятно это не так они там размазаны я все собрал и поставил столбиком их дофига потому что 5 процентов это каждые 20 и там много и вы когда смотрите на 95 перцентиль вашего сервиса и он классный и там он за 100 миллисекунд 95 перцентиль 100 миллисекунд вы думаете но все здорово самом деле вот вы просто закрыть глазки такие не вот на тот ужас который в том дальнем хвосте я смотреть не будет то что страшно и неприятно я не хочу туда смотреть это отстой ну понятно что тут напрашивается ну лан dios 5 мало да давай возьмем 919 крутые чуваки вот давай три девятки возьмем я честно говоря не видел в живую ни одной инсталляции которые три девятки отслеживает но наверное они есть сейчас я буду у вас убеждать следующем своём пункте который заключается в том что значит 099 я видел в каких-то мониторингах у людей мы помним что 900 надеть это все еще мало уже казалось бы ну окей вы там вот все аргумент который до этого вот собрать все что там за дальним краем поставить его сравнить ну это это реально там одна тысячная на которой мы не смотрим закрываем глаза казалось бы ну да ладно и простимся наверно дорого и и там типа оптимизировать все остальное вот и тут вопрос том как на самом деле это в жизни происходит есть идея математическое 999 перцентиль с жизнь жизнь заключается в том что сейчас очень много тузов начиная со 100 т и заканчивая всем многообразием современных тузов которые позволяют вам вот это легко получить ну и point какой давайте померяем как наш сервис себя ведет ну давай давай воткнем мониторинг я читал там на каком-то тематическом ресурсе как отделаться поставил там так так так все в графике есть ну это медиана ну сейчас доберемся до то есть медиана уже классная вот мне лично супер нравится она супер стабильная две две миллисекунды там нет юнитов но это миллисекунды то есть уже можно вот кажется что уже напрашивается давай повесим ну триггер провести мониторинг который бы следить что она но не выше тону запас небольшой от 12 едва там ну хорошо давай побольше запозданием там три миску ну неважно уже на прошивать смотрим на 90 она вот так себя ведет смотрим на 95 вот тут она уже вся вся как расческа казалось бы где вот эта раба снасть к выпуска выбросом которые обещали да ну а самом деле и в помине нету в том смысле что ну не в каком-то опять таки да им математический раба снасть но вот ощущение того что как вот я пытался объяснить что ощущение того что такое нормальный обычный типичный случай не похожа на среднее также то что вот мы то что называется математики раба снасть она ну вот где она это вот не то что я не говорят 90 перцентиль работа на ветку но отлично я нарисую будет классно она будет ровная на нее поставлю порог она его никогда не будет превышать кроме случаев когда плохо все ну вот нифига аналитика и шумно на самом деле ну 99 там подавно вот и значит возвращаясь тому как их находят вот поставили мониторинг он начал это рисовать все но у нас же есть пирс антен мы ее знаем хорошо она шумная фиг с ней что она шумная ну вот чему вот так вот у вас есть такой график вам приходят и спрашивают чему там шкала нушка love пускай будет миллисекунд в секунду до эта секунда это уже секунда миллисекунды там вот были где 50 и меня во первых какой разброс гигантский да опять таки это мы уже видели это я повторяюсь но все равно 50 две миллисекунды тут пол секунду же вот мой вопрос чему вот равна 99 представители этого сервиса опять-таки это вам сугубо личное вы вы с моей помощью себя переубеждайте что вы понимаете уши у вас есть ощущение интуитивная про перцентиле вы ее загадали где она реально реально она вот здесь в 10 раз вот как так произошло ну тут опять несколько пунктов первый пункт что мы измеряем ее за интервал из-за интервал ну вот она у нас вот у нас за день набегает 1440 таких измерений если мы раз в минуту мере и ну мы вот нарисовали этот график и наш мозг автоматом вычисляет для него какую-то какой-то тренд горизонтальными но если мы видим что он там не плавает да там и горизонтальные учли даже если мы такие догадались так это перцентиль наверное от нее надо брать максимум который там где-то пять секунд получается все равно на самом деле она не там вот если взять это распределение попытаться набрать статистику когда она перестает меняться когда вот эта перцентиль который мы вычисляем 99 в данном случае она перестает меняться от добавления еще измерений вот со временем вот выясняется что она вот где то приблизительно там она все равно там как-то пистец на колеблется это только выборка но вот она все равно не там где вы ее ожидайте вот значит это ваша голова это мне слайд чтобы на по объяснить вам что ваша голова вычисляет какую-то горизонтальную полоску перцентиль ведёт себя не так но это я уже сказал вот то есть за день набегают вот эти вот 4 40 измерений минутных мы смотрим за график за 8 часов допустим ну и понятно что они там не сходятся что вот как раз тогда когда вы смотрите ничего особенного не произошло все произошло там ночью все вот эти выбросы и казалось бы ночью меньше запросов обычно ну это вот сервис вот этот конкретный сервис которую цвет там так и есть там ночью прям запросов сильно меньше чем днем казалось бы ночью должно быть ну ну меньше запросов меньше конкуренция должна быстрее все работать на самом деле с точки зрения persantine все работает не быстрее как угодно потому что там мог может быть от того что действительно меньше запросов работы быстрее до того что каши и холодные да все знают каши каши холодный и из них медленно отдается вот тут вопрос там нам шашечки или ехать и инженерное мои внутренние чувства говорит что но можно вот так делать это грязный хак я не его не рекомендую сам я его использую как всегда до грязный хак заключается в том что ну вот некая реально вот это то что средние мы чувствуем она на самом деле соответствует реально персону какой-то пони пониженной перцентиле и это во-первых flavor просто на уровне разброса ну так это не только для 97 годится но и для 100 сот а это максимум за вот этот конкретный интервал здесь видно что они ну вот здорово они попадают вообще но это для конкретного сервиса для другого сервиса будет по другому там не logo нормальное распределение будет какого года там как угодно может быть но вот например для этого можно так выяснять вот что я хочу здесь еще сказать что вот мы пока обсуждали про мы обсуждали система сослужи мне на самом деле мы обсуждали некие запросы в какие-то системы вот то есть например что что же мы потеряли там в этом в ходе этого обсуждения это реальных пользователей пользователи это не запросы пользователей это люди и у них пока они у вас на сайте бродят и хотят учетом совершить или в мобильном приложении не зная в вашей системе они хотят чет там совершить у них все промежуточные шаги это вот этапы да но этих шагов может быть больше чем один и пользу про пользователь то мы их забыли у них может быть что угодно то есть вот когда вы смотрите на эти отдельные отдельные за просеки это за уже запросы в базу данных и лет запрос к вашему веб-сервис или это запросы к вашему там applications серверу это это какие-то запросы которые на самом деле вверх вверх туда уходят в сторону пользователей и как оно там не очевидно что она коктейль ну напрямую отражается в то как эти запросы себя ведут вот и тут point вот такое у меня тут все написано то что здесь написано что опять-таки мы считаем что ноги и вот мы для нашего сервиса написали 999 перцентиль мониторинге мире и мы ее знаем что это не 999 перцентиль что ну потому что на минутное мы ее значит представили что это просто 99 перцентиль то есть всего один процент пользователей на которых мы забиваем выясняется что ну и даже это не так вот не доверяйте интуиции статистике вам любой статистик скажет я вам говорю не доверяйте интуиции в мониторинга все что я хотел сказать я надеюсь у нас достаточно много вопросов по докладу чему нам все-таки доверять или нет сейчас нам поднимутся руки и мы сможем ответить на наши замечательные вопросы ей монет есть один черт и ещё спасибо за доклад да да короче вопрос такой у нас пример вот такая же проблема и вопрос как выбирать расходы для мониторинга то есть вот если мы смотрим на графике там 95 99 перцентиле мы видим там пики и вот допустим у меня там не знаю кто угодно продукт оунер спрашивает сколько мы можем обещать практически всегда время ответа он говорю ну если смотреть на 95 перцентиль там 300 миллисекунд он такой да окей прекрасно а через 99 mg 40 секунд и с этим жить вообще никак невозможно то есть если поставить трескал 40 секунд то это не мониторинг а фигня если поставить 300 миллисекунд то нас получается там построили рта в час вот вопрос том как жить очень классно во-первых ура вашему продуктов миру что он понимает что такое перцентиль там что мой продукт оунер и когда я им говорю там какой-то перцентиль такое-то время они одно число могут понять два числа и тут уже вот но возвращаясь к вопросу ответ вот такой честный очень простой прям вот ну не надо было столько временное трать не вот выбирались и яму то есть у вас есть у продуктов мира возможность зайти посмотреть графики 30 или или задать вам этот вопрос и вы вне подойти и спросить у меня как мне не не падать я такое не вырывайтесь и не надо яму не делайте себе яму не быть у нее падать не надо следить за перцентилями это неправильно то как мы рекомендуем этого к метр пошел дальше вы должны себе выбрать пороге не на поведение перцентиле я на то что вы считаете что пользователь хорошо себя чувствует что ему сайт быстро открылся или медленно это зависит от миллиона параметров начиная от того что естественно этот сервис и к сервису зависит да но в то же время у нас есть какие-то гайдлайн ее от там лидеров индустрии google там говорит что 400 миллисекунд серверную server time it on titan нормально там amazon объясняет что задержка в плюс добавочной 100 миллисекунд поверх 400 там приводит к падению conversion rate ну там разные оценки amazon там он говорил девять процентов кто-то говорил 16 процент на общем да но пойнт том что все равно вы должны на мой взгляд как человек как владелец этой системы решить что вот у нас в таких ситуациях например это не мобильное приложение это десктопы пользователь должен должен видеть страницу вот за такое время она должна отрабатывать их дальше то есть вы не рисуете перцентиле чтобы чувствовать перцентиле в мониторинге это зло потому что выхода их рисуйте вы уже такие не вместо того что в свое внутреннее какое-то соображение ли там внешне соображений гуглово использовать и сказать что он должен работать вот до такого порога вы вместо этого начинаете смотреть на график и ну вот у нас смотри у нас 50 миллисекунд отвечают вот эти страницы вот этот тип страниц очень хорошо давай мне вот такой порог посему нет ни на так делал вы определитесь что сервер должен отвечать за 400 миллисекунд дальше вы рисуете он отвечал за 400 миллисекунд или там ну за сколько стать таком количестве процентов за ну похуже но еще терпимо если чувак за компом сидит они на телефоне то там нельзя до секунды на столько-то процентов а то что выше секунды это все но уже не годится это вот вот прям не годится и тогда вы можете это отслеживать тогда нет такой проблем что вас прошла как у нас не ну вот какое гарантированное время ну не бывает такого когда вас система ну так так случилось что ваша идти с тем ведет себя похоже налога normal на самом деле вот как я то что вижу у нас там много статистики от клиентов то что я вижу что этот брелок normal да у него такой основная такая блямба и хвост уходит то что я вижу это то что это хвост еще толще обычно чем чем ну вот он толще и дальше идет туда чем лог normal это вот реальная ситуация это прям ну повсеместно не у всех но это очень много так как это типичная ситуация вот и ну когда вас когда вам задают вопрос вы давно перестали пить кофе пить коньяк по утрам не надо на него отвечать когда вас спрашивают какая у нас гарантированное время ответа сервера ну нету такого гарантированно времени он он упал у нас дата-центр сгорел метеориту не упал из время ответ сервера два дня пока и очень или ну не надо вот вот ответ такой он out of the box в рамках перцентиле на честно ответили да я заговорился спасибо за доклад очень интересно было но вопрос опять их а то есть про мониторинга то есть там всякие паспортом анализы как понятие чтоб где происходит то есть ну классическая да то есть там можно построить там 50 и 75 90 90 90 то есть очень много представителей то ли этот вопрос как бы вот какой какой инструмент визуализации там open source не open source собственному свой продукт понятно что вы рекомендуете ну вот то есть как вот собственно делает анализ временных трендов какой-нибудь инструмент потому что именно находить какими тьма тенге еще что-нибудь но смотрите если я правильно понимаю вопрос да не до конца я уверен ну допустим если мы действительно говорим про post more than the не ну в этот момент не нужны графики ну вот мониторинг это мониторинг паспортом и to post more там это разные вещи и хочется конечно как всегда silver bullet иметь из какой-то систем в которой все есть она все показывает и пост-фактум в нем он еще и она не то что показано еще сохраняет можно в ней постфактум все это посмотреть но это ну нереально это разные просто совершенно разные системы вот такой ответ если очень сильно рекомендации какие-нибудь весь по разным системам ну в смысле систем очень много разных венгерских решений которые платные которые не мониторинг а как метра вот там оля разбираться что там происходит их очень много там тонны информации так как система естественно сложности их нарастает и нарастает и нарастает системы очень сложные тулин который позволяет в эту сложность копаться он тоже уже очень сложный может быть сделан многими разными способами я просто давайте обсудим конкретную задачу одни можем я могу наверное попробовать пару названий искать вот там есть вопрос спасибо за доклад такой вопрос помимо перцентиле и среднего какие ещё интересные математические метрики и графики можете предложить то есть понятное дело что или средние награды мы продуктовой компании мы там не считаем отклики от меня тут подсказывают на ухо сигма но я наоборот я забыл про и сказать как водится когда колокол я показываю который все знают да вот эти идеи что сегментом позволяет резать так чтобы в 3 сигмой позволяет отрезать чтобы был 01 они к вашей системе никакого отношения не имеют то есть вот эти сама идея стандартного отклонения она конечно применим к любом распределению это какая-то попытка ну там оценить в каком-то смысле ширину вашего распределения таких способов оценить ширину есть много разных способов ну там интер квартирные интервалы это то что вот 25 30 лет 75 вы смотрите как далеко они друг от друга дан кроме стандартного отклонения у там википедию откройте английского естественно надо открывать там список гигантский у них у всех свои ограничения свои плюсы и минусы опять все ну нету какого-то универсального все зависит от задачи для мониторинга вот не нужны никакие они вам нужно вам нужно другое вам нужно свое вот вам нужно своего продуктов не расспросить о какой как какой тайминг будет плохо для нашего пользователя уже вы можете эксперимент провести как amazon amazon он ну если amazon у они рапортовали что им вот эту задержку 100 миллисекунд если они на год и его там умножают да то он ему каких-то нереальных денег стоил но понятно они не на год это делали вы такой же эксперимент можете сами провести да например есть такая метрика хороший но для экспериментов скорее не вот опять таки я не хочу я хочу хотел показать что вот это все не неправильный в принципе подход подход должен с другого конца не типа вот у нас система мониторинга в нее кто-то как стать sd уже напилил статистику она там 4-port uid давай как бы ее и использовать ну не она там по шинам показала она плохая давай мне чуть-чуть другую статистку нет не с того конца просто другого конца зайдите к своей задаче чё я проведу еще говорю да ну в общем идеи такой разговор был про правильные метрики то есть как нам сделать хорошо для наших пользователей и исходя из этого уже понять что мы хотим мониторить и вот как нам это что-то собирать что будет хорошо для пользовать а вот форма классная штука есть из биологии перенесенная ну наивно нужно олди 50 это летал даус ну то есть сколько вам надо чё-то как ну популяции каких-то крыс этих лабораторных мышей сколько им надо дать какого-нибудь яда чтобы play на померла в среднем вот лдпр и ну соответственно тоже самое можно применить к вашим пользоваться насколько над затормозить ваши странички чтобы пленум bounds отвалилась такая вот вы найдете себе будете знать что вот туда вы уже не хотите потому что ну там эту половину денег то вот так все в деньгах если это бизнес все в деньгах там помог тот мира привет спасибо очень интересная не видно и слышно все интересно классно но я такими разговорами про техническими tringham тем более про тайминги да тут все достаточно просто мало хорошо много ну чуть хуже что если мы хотим мониторить какую-то продуктовую метрику да там путь конверсию например там все же чуть сложнее да то есть там накид корреляции вот кто умеет лет ваш продукт и думали вообще давайте парк метр на стенде ок метра ну я не против со сцены конечно это классно больше людей услышит мне кажется это размер листа сергей тут рядом прямо выходите это как пока вопросов нет я задам от тебя я вот слушал слушал и понял что я на самом деле этот подход который повел пропагандирует он мне не очень нравится мне не очень нравится давайте спросим у пользователя что им хорошо а что плохо нет нравится когда там и одним пируем девятками то есть вот у нас есть 99 и 9 процентов пользователей и у них там за какое-то время гарантированно мы что-то покажем там или ответе мы не ответим то есть это немножко про перцентиль но это не совсем про перцентиле про качество то есть мы ни за какой то конкретное время отвечаем 99 и 9 там или или 5 9 так у нас а мы гарантируем качество нашего продукта для какой то конкретное вот это очень классно мне очень спасибо большое это прям то что я вот очень рад тут у меня два соображения первое это вот там вверху человек сказал что у него 99 перцентиль правильно я запомнил 40 секунд давайте оперировать девяткам конечно ну серьезно это хороший совет второй мой point тоже очень большое спасибо в том что привычная она привычно и не требует усилий а ну очень сложно всегда новое что-то впитать и конечно так послушал он встроен излагает наверное репетировал много там картинки классные на делу может быть кому то понравились вот но на самом деле я останусь при своем это очень-очень легкий для мозга такой выход такие рельсы по которым он такой я послушал но вот я буду 909 ну это так как бы вот проще проще не не научиться новому а твой выбор какой что все научились или не научились это ну мой мой выбор я попытку сделал хорошо спасибо вопрос еще и зал у нас есть так отлично мнением микрофончик просто на записью трансляция чтобы звук записался нам нужно микрофона хабр привет спасибо за доклад вопрос такое пришли все-таки запутался вот хорошая хорошая звучало тема по поводу робастности так вот если мы все таки возвращаемся к этим пользовательским метрикам чего им нужна что для них плохая загрузка страницы и так далее мы тогда всю историю про опасность но сразу теряем . здесь все-таки быть таким образом остаться на действительно прийти клиентским метрикам но действительно ну какой то от шум как бы случайные выбросы ну хорошо какой случайный шум этом весь вопрос ну какой случай шуршат там страшное грязная на той стороне не будет какой случайный шум то что у пользователя есть вот там объект score который говорит давайте возьмем какой-то тайминг в четыре раза больше пользователей еще потерпит а я дальше уже нет ну вот что значит что дальше нет вы готовы жертвовать этим количеством людей и на другой чаше весов сколько вам как бы как инжиниринга вам департаменту заниматься тем чтобы этого не было скорее вопрос из области допустим того когда у нас мониторинг ошибки влогах допустим да если мы хотим на основе этого причем причем прикладные логике какие-то ошибки другой ток я буду готовиться меня есть соображение 40 минутной ожидать другой только тогда когда ждать как сделаю так обед сразу прям собирайте наклейки выигрываете билет на следующий рид и приходить на другой ток напоминаю что наклейки равнозначны все красный зеленый синий за активности и от спонсоров маленькие наклеечки их можно обменивать на кружке термокружки футболки флешки и даже 3d принтер кто больше всех соберет на стенде справа от зала до рекламная пауза вопрос спасибо все таки пытаясь разобраться ну берем 300 миллисекунд там 400 до ставим порог по нему так какой же график должен этот порог срока за порогом сколько до порога ну окей быстрый вопрос спасибо давайте мы еще раз поблагодарим павла хан спасибо"
}