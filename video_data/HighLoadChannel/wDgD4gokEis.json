{
  "video_id": "wDgD4gokEis",
  "channel": "HighLoadChannel",
  "title": "Хочу все сжать / Андрей Аксенов (Sphinx)",
  "views": 5165,
  "duration": 3129,
  "published": "2018-08-16T04:57:18-07:00",
  "text": "ok меч доклад хочу все сжать продолжать ее все читали abstract потому что я уже забыл что там написано доклад обещает обзорный как бы в кавычках курс не курс небольшой обзор значит метод сжатия которые могут помочь вам жизни это мог всякой могу обещает на самом деле конечно же доклад обзорные без партнера я упомянул он далеко не все методы которые как бы нам а есть бы актуальным и интересным попытаюсь конечно дать там где то в конце список ключевых слов которые можно примерно три года после этого будет лук опять в википедии том дал долгими зимними вечерами реализовывать всем тем трем людям кому интересно и совсем чуть углубимся в детали мы буквально пять-семь простых методов совсем чуть это примерно три четыре строчки кода потому что уже пятая строчка кода обычно не заходит как бы особенно если так вот в 11 утра не в пять вечера и до репетировал нет бюджет времени уложусь и вообще я считаю что доклады преступно поменяли местами и вот этот который здесь он несколько более интересной и с моей непонятные либо резьбовой точки зрения более обще применимый что лечим доклад который жахнули вечером в конгресс-холле так что вот те из вас кто проснулся и пришел к 11 утра могут чувствовать себя прямо вылитый же бонусы и с моей точки зрения более лучшей доклад и и более полезный вы сейчас будете страдающим образом слушать про сжатием о чем вообще речь типа о чем будем 7-zip учиться запускать вместо там ра ра или я не знаю если до сих пор не будь то джим пользуется нет сжатие эта тема несколько пошире и значит архиваторов с одной стороны там умение золин коваться z либо мылил за 4 ну что ты сделал с другой стороны она очень широкая есть как бы дженерик жать и generic архиваторы с одной стороны специальные виды сжатия картиночек видео и любых других любил любых других связанных с другой стороны и невероятно но факт но в тот момент когда вы берете просто тупо вещественное число и херак хироко этом дико кастрируйте ему точности утаптывать и условный флот который у вас там диапазоне от нуля до единицы но занимает все таки в виде флота четыре байта в виде байта виде doblo 8 в 1 байт дико потеря в точность вы тем не менее тоже занимаетесь вообще говоря с сжатием хотя это такой же философский вопрос по поводу которого кафедра философии принципе на может три дня драться считать это сжатием кодирование там чем это считать непонятным это 1 2 несмотря на то что я как будто из того сонма бородатых разработчиков свитер с оленями которые до сих пор зачем-то пишут на си плюс плюс хотя в эпоху победившего но уже с ее роста совершенно непонятно зачем это делать сжатие тем не менее тем не менее эта штука такая достаточно именно общая достаточно дженерик которая применима как ни удивительно не только на вот этих вот замшелых языках типа сижки си плюс плюс и написать свой первый кода который натурально значит он полезный и это даст вам какие-то бонусы в том или ином приложение вы можете на натуральной любом языке даже если спаси господи php я собственно попытались это и продемонстрировать там код какой тупой как полкам при чем тут highload хайло тут такой условный умеренный если у вас highload проекты и любой проект это вовсе не значит что он в принципе в жизни когда не понадобится сжатие просто это вот такая вот интересная тема которая иногда подчеркиваю иногда может потребоваться и иногда опять же иногда может вам сильно помочь и я считаю что как бы стоит хотя бы знать как оно бывает как она устроена чтобы в тот момент когда можно себе чё там клево на экономить но он соответственно знать о том что можно сделать и как это сделать можно вся магия в кавычках сжатие разбивается на две большие части технологически как что это такое чё делать этап номер один который на слайде обозначен конечно же как этап номер два это ловко закодировать что-нибудь а именно вот у меня есть произвольной циферки натурально циферки by тики и байтики возможно более длинные числа которая там не одним байтом кодируется может быть это числа там не знаю от 0 до 16 может быть от числа там от нуля до десяти миллионов их можно каким-то образом сохранить многими разными образами сохранить закодировать в битовый в общем случае в байтовые в приятном частном случае поток так чтоб они там хранились эффективно можно целые числа ну как бы туризм и не суда можно целые числа закодировать в четыре байта на число можно их закодировать как-то более эффективно об этом поговорим кроме того данные которые вам прислали на вход всегда отставить всегда зачастую можно преобразовать таким образом в такой там набор чисел номер один преобразовать в такой набор чисел номер два что кодировать его будет существенно приятнее вот в этот момент в наверное предполагаю гипотеза такая у определенной части контингента уже значит это страх поджилки трясутся и так далее вот и вот это вот ваши кодирование в сиди там гады шеннона фано хоффмана и так далее прочему то тень который в университете когда-то пичкали еле-еле знали лабораторную работу и все с тех пор забыли слова господина всегда этаж уже наверно дико сложно муторно пишется и так далее вот хрен на самом деле это не так современный так сказать актуальные кадык простые как палка и реализуется еще быстрее и собственно именно эти не хитрые ходы это и есть фундамент успеха но как бы вот в отличие от реки в целом где наличии кода скорее тебе мешает в жизни чем помогает поддерживать проект а общая мета концепция когда ее сформулировал меня вот прям как в голове запульсировала что она очень похожа на ряд других общих мета концепции типа там покупая дешево таких полезные советы до сирены полезный совет не еще не скажешь покупая дешево продавай дорого конечно пацаны если бы я биткойнов прикупил по двадцатке рассказывал bayed вот это фуфло уже бы нормально все было в принципе или вот в армии тоже дают полезный совет всегда типа круглая на сей квадратное катать в этом есть определенная мудрость такой армейский цен не сразу понимаешь не менее бесполезный совет и как будто не менее божественного причем полезно и одновременно с точки зрения сжатия звучит как часто я паковать редко и раздувать регулярно говорил что если вы запомните с доклада ровно одну вещь то постарайтесь чтобы это была вот эта вот вещь на этом докладе частная паковать редко и раздувать частная паковать редкой раздувать вот как-то так все ключевая логика следующая речь в этом частному редком всегда каких-то слав битах байтах есть ряд классических всяких кодов которые умеют бит и байт и упаковывать важно понимать что зачастую этот код который вы придумаете сами себе так сказать которой вы заточите под свои конкретные данные со своим конкретным распределением этих данных возможно глобальным возможно локальным неважным то есть свой ваш личный диайвай код который вы под свои данные изготовить и зачастую зажжет очень хорошо поведет себя сильно лучше чем любой долбанный код который вы вычитали в книжечке ну а может быть не сильно лучше может быть там на лучше с точки зрения коэффициента сжатия слегка но при этом будет сильно проще в реализации поддержки быстрее работать и так далее вообще неплохой сейчас совет даю как быть часто покупать редко-редко и раздувать все расходимся очевидно надо разобрать кучку примеров и как бы жахнуть в мозг кодом давайте это сделаем что вообще значит часто я взяла для целей вивисекции тупой не хитрый пример тысячу первых попавшихся документов на синус просьбу тунберга не там в основном англоязычные хотя местами встречается всякий долбанный unicode какая интуиция вот я скачал большое большое количество на англоязычных текстов интуиция понятно что у нас буквы sadosi латиница чаще всего и вроде есть такая традиция что там пара-тройка частых букв гласных нам в данном случае вот и эйба ожидаем и вылезли вверх буква те ожидаемый выдали вылезла вверх вот это вот все скачал посчитал статистику понятное дело интуиция прям сразу начинает подводить интуиция верить нельзя надо проверять и как бы сама по себе оставить таблиц и строить всякие увлекательно частотные таблицы может естественно естественно совершенно если задуматься чуть дальше самый часто эболой это в этом файлики это пробел перевод строки соответственно тоже нехило часто встречается 8 миллионов раз на 30 миллионов раз но это не настолько терминальным давайте хоть как-нибудь его закодируем так не понимаешь для 11 утра это предложение фактически там матерная вот но антен тем не менее давайте попробуем придумаем натурально придумаем сами не заглядывай ни в какую методичку какой-нибудь очень тупой кот пользуясь принципам часто и паковать редко и раздувать часто паковать редко и раздувать часто и паковать редко раздувать пока не эту мантру произношу все уже прочитали слайды мне не надо его зачитывать вслух но я все равно считаю вот мы запаковали часто в один бит вот мы раздули в кавычках редкая то есть все остальное до 9 бит и вот мы с этого получили натурально какое-то сжатие и натуральный какой-то профит но как видно со слайда профит какое-то то есть на 336 мегабайт на из канале сраных 12 мегабайт и причем какой ценой у нас были нормальные человеческие 8-битные байты они на как этом замшелым деки которые все приводят в пример на котором болты были конечно же 9 битные случайного доступа к произвольному элементу нашего массива нашего мега текста у нас больше нет у нас элементы хрен знает какой длины некоторые по одному биту некоторые по 9 бит нормально работать с этим потоком символов больше не возможно это было бы как бы приемлемо если мы его в сто раз ужален у моего ужали блин на 3 процента чет пошло не так а чё пошло не так а известно что пошло не так принцип то правильный но применили мы его как бы не вполне хорошо сэкономили мало часто запаковали но недостаточно запаковали а потеряно всем остальном в кавычках редком на самом деле нет хвосте оказались слишком высокие делаем следующий тупорылый трюк который ну в принципе уже как бы если кто-то разогрелся то нормально уже должен заходить несмотря на 11 утра давайте построим частотную табличку байт тупо байт встречающихся у нас в тексте и натурально зумируем ее за нумеруем ее по чистоте пробел самый часто и будет иметь номер один я конечно понимаю что программисту приятнее с нуля нумеровать ножек будь для вузов будет номер один она сейчас вскроется номер два буква е номер три буква т и так далее и тому подобное это понятное дело порочные практики она обязательно приведет к авто иван багу ваших первых трех реализациях но постепенно все приложится документ у нас поскольку большой 3 ст 30 мегабайт то передать вместе со своим закодированным кодом вместе с закодированным результатом вот эту табличку мы можем как бы там не обращая внимания на ее гигантский размер 256 байт это не проблема что же выйдет блин оао ничего не выйдет муза нумеровали моих по чистоте еще дальше но перри нумеровали как-то байты переставили местами какого как какой толк то отток вот какой чем меньше число тем меньше в нем значащих бит а это значит что давайте номер один самый частый байт тот самый пробел по-прежнему кодировать одним битом но давайте и следующие наиболее частые по убыванию чистоты символы кодировать каким-то меньшим чем блин 9 количеством бит нам неплохо бы знать сколько там значит вот вы мы видим какой-то произвольно взятый код произвольно взятую цепочку бит в потоке да нам хочется знать сколько там вообще в ней бит во-первых и после этого хочется знать что это за биты мы это кодируем натурально как бы удваивая количество значащих бит пишем небольшую цепочку нулей которая там за вычетом единицы как раз и кодирует число наших этих самых значащих бит которые сейчас поедут после этой цепочке нулей видим цепочку нулей в потоке читаем читаем читаем читаем нули до первой единицы как только такой вы читали как только прочитали там условно говоря 1050 и или 70 и ну мы знаем сколько дальше значащих бит поедет получается вот такой вот странный кот который одно значение умеет кодировать в один бит два значения умеет кодировать в 3 бита 4 значения умеет кодировать в 5 бит и на этом наше счастье практически кончается потому что эффективнее чем восемь бит он кодирует всего 15 значений частая подавать редкая а все остальные значения по частоте это важно с 16-го по 205 шестое он кодирует вот довольно хреново и на них соответственно размер теряет тем не менее коэффициент сжатия довольно приличный для семьдесят пятого года потому что на самом деле у нас получился не наш код он простой да мы его как бы самостоятельно не применяя ничего кроме этом общий сообразительности реконструировали да тем не менее это вот уже нормальный книжный канонический код нехитрый бат красивым названием ногам а кот девушки питера элиаса есть с ним одна этом титаническая проблема это та самая по битва я постоянно работа тем не менее как бы ну опять заметил он тогда 2 в две третьих от исходного размера наш текст ушатали уже неплохо я постоянно жалуюсь на биты это не конструктивно давайте придумаем что-нибудь по этому поводу опять таки там помозгуем и чего-нибудь изобразим идея давайте работать хотя бы группами из четырех бит потому что группу из четырех бит внутри байта работать легче чем блин просто по битовый поток читать когда у тебя минимальное значение которое ты должность потока прочитать это четыре бита ну как дик озер будет сильно легче через там пару минут это будет наглядно ясно изобретаем вот такой вот код который работает плашками но натурально по четыре бита в первые четыре бита мы барабанная дробь можем закодировать 8 значения не 16 потому что один бить нам нужен для того чтобы отличать вот эту группу годов от всего остального значение с 9 до 135 кодируем вот так все остальные значения кодируем вот этот и много на них теряем по сравнению с предыдущим кодом самые частые варианты не очень эффективны вариант номер один вообще пространств четыре раза пробел мы раньше кодирова ли в один где-то теперь кодируем в четыре бита но зато мы на сильно большем количестве частотных символов не теряем теперь в кавычках редкая раздуваем меньше вот как бы ищем баланс где у нас часто по большому счету ищем баланс где у нас часто где у нас редко чтобы значит часто и паковать редко и раздувать работало хорошо внезапно выясняется что мы потеряли на этом нехитром ходим несмотря на то что предыдущий по битовый код имени товарища элиас и был довольно дерьмовый из точки зрения потерь большое количество символов not натурально там 15-16 их нашего алфавита мы закодировали плохо неэффективно тем не менее в целом на сжатие наш новый клёвый код немножечко проиграл один мегабайт мы проиграли зато выиграли не что существенно более важное для современных compaq computer of у нас больше нет побитого чтения и важный такой момент который обязательно надо упомянуть а что если мы значит по какой-то причине да как бы это все синтетические же примеры очевидно а что если у нас получается так что вот эти вот редкие значит не которых вроде как много с одной стороны там объекты так сказать символы что угодно еще которые встречаются во второй половине там имеют частоты там начиная со 136 что если нам почему-то их и надо кодировать в гигантское количество бит интересно но надо нам синтетическом примере если мы половину редких символов закодируем раздуем во сколько в 16 раз в тридцать два раза по сравнению с оригиналом 32 вроде раза до в 256 бит по сравнению с восемью блин оригинальными битами тем не менее как ни странно вот на этом конкретном примере мы не теряем вообще ничего вот это вот поворот раздули половину кодов в 32 раза интуиция подсказывает что все как бы смерть больше как бы у тебя зажать и не будет в жизни но нет на самом деле потери ничтожны это я к чему при привожу вот этот дурацкий пример и к чему она него так акцентирую внимание потому что не надо стесняться очень сильно раздут некоторые супер редкие токены по сравнению даже ну нет нет нет один объекты которые ты жмешь том числе числа набора чисел так далее даже если не у тебя раздувается сильно в зависимости от распределения все равно у тебя может быть хороший профит вот да так будет не всегда и тем не менее вот на этих конкретных данных вышла статистика вот такая в вашем конкретном случае надо проверять какая выйдет но зачастую эффект будет приятной я постоянно ругаюсь набитый а почему а потому что паба этого и чтение чего-то там из буфера даже как бы вот я специально написал код на си плюс плюс который тем не менее теоретически должен понять понятно любому разработчику на java скрипте берем ее читаем из буфера там очередной байту инкрементируем счетчик позиции ура ура как нехитрый да вот как бы можно портировать вот этот вот код на java script или он и так заработает что никто не палиться в зале что ли нет разработчика тот же вас крипте аллея вообще все тестовые скрипты на php написал как бы не не стыдно палитесь вот почему там int потому что с into my как бы процессора работать приятнее если что это вот такая сильная привычка но и java script у наверное я боюсь тоже будет приятнее работать с центами после того как он пройдет через adsense через браузер через jit компилятора в один хер хер приедет в регистры процессора в итоге не по битный вариант вот этот вот странный 4 битный код который работает блоками по 4 бита какая-то уже что-то блин мы чувствуем какую-то измену ну доказать не можем код несколько усложнился появились какие-то непонятные сдвиги маски и вся с одной стороны с другой стороны все еще три значащих строки и то только потому что у меня гигантский чтобы могли прочитать даже sound операторы потому что как бы ну понятное дело что монитора у всех минимум full hd и на самом деле это одна строка просто у меня сработали переносы то есть но блин чё ты уже как бы похуже чем прошлый вариант но все еще можно жить и все еще может вас портировать на java script внезапно а вот эта побитого я читал к более того это вторая версия то есть я просто я давно этого говна не писал но специально для доклада естественно подготовился и это вторая версия потому что первая у меня не влазило на три слайда но этот позорный факт если я счел диким челленджи мне как бы со второй итерации смог ее более-менее под утоптать у меня получилось вот так вот после этого я как бы провел с этим одну ночь с утра сел и это диким челленджем и переписал ее опять получилось еще более компактно но с адскими трюками адский трюк для тех из нас кто предпочитает php и java script это например я заключается в том что вместо для того чтобы прочитать каждый сраный один бит мы читаем по восемь байт мы должны ну опять же случае фишечки java script нам боюсь прочим тоже и даже php в конце буфера ради этого положить себе соломки в размере как раз этих самых 8 байт потому что иначе у нас как бы все рухнет когда мы читаем в конце и буфера что-то но ты после этого плясками и танцами мы я вот все-таки утоптал это дело во сколько в четыре строки то есть принципе можно и побитно и чтение изобразить как то вот вот чё-то как-то там почти приемлемо однако однако сравните как выглядит побитно и чтение потока с плясками танцами и там с третьей итерации и насколько просто выглядят по buy твой чтение потока морали мораль сей басни с плясками и танцами можно как бы заставить и побить на и чтение танцевать но лучше как бы жить побайтно возникает мгновенный вопрос а что ты тогда она вообще про дебильный кадре алиса там и так далее рассказывал если так все хорошо в жизни байтов и так все плохо в жизни битов а вот не всегда применимо простите если вы ждете жмете размер если вы жмете байты если у вас входные значения это байты и есть то как то не сую как не ворочая если ты байт в байт у тебя получается в байты коэффициент сжатия единица то есть нихера в данном конкретном случае не выйдет но зачастую ты жмешь не просто лишь байты зачастую то например какой нибудь строчечку гоняешь по сети строчечки имеют 2 неприятных свойств значит свойство номер один неприятная для многих кто проходит собеседование заключается в том что они бывают длиннее двух гигабайт после чего у вас как бы счетчик длины введен то падает и со беседующих потирает ручки и грустно над вами стебется вот при этом они обладают вторым свойствам что в 3 гигабайта эти сраные строчки бывают раз в десять лет и на собеседованиях а больше нигде а в жизни они конечно же ну дай бог 256 хотя бы как бы нарисовать это уже принципе большой успех потому что твит это 140 соответственно твит на русском бутырев это 280 не знать вид на арабском наверно 420 тем не менее строчки как бы обычно короткие достаточно опять придумаем какой код в кавычках придумаем но на самом деле и придумаем тоже то есть натурально самостоятельный сбросе изобрести такую штуку не сложно вот внимание возможно стоит обратить на чудо диаграмму синего цвета м в в в в в в м а значит маркер в значит в бельгию значения берем наше значение там в нем сколько угодно значащих бит и кодируем его блоками по семь бит за раз показывали на щебетание кончились закодировали 7 бит есть еще данные взводе маркер терны бит в единичку есть еще данные взводим маркерной бит в единичку кончились все прекратили взводить маркерные биты выписывать байты в выходной поток и ура ура закодировали а что мы закодировали а вот на слайде есть табличка циферки вроде без ошибок по меньшей мере порядке у них точно корректные значения все длинный срок наших условны которыми гоняем по сети зажали ваще там в хорошем случае в один два байта а терять деньги терять на этом наши механизмы зажатия драгоценные битки и байтики начали только с довольно гигантской длины в 206 8 мегабайт но она в жизни встречается довольно редко мы понятное дело опять в кавычках перри изобрели некую хорошо известную схему под названием war in the понятное дело можно отдельную лекцию чисто в аренду посвятить потому что примерно 10 разных реализаций немного отличающихся перформансом так далее мы этим можно заниматься на всем обидим вот а почему я называю всенародно любимый мы и за что его вообще любить несмотря на то что под существенно усложнился построен из просто чтение мбайт он вот такой все-таки я как бы я уже зовут слушайте люди я пришел сюда в 11 утра к несчастью трезвый потому что в 11 утра но тем ни менее сразу покаялся в использовании печки есть в зале java скрипта хоть один или нет ну кто-нибудь там не знаю вечерами на ноут же с для себя есть огонь прошу пояснить можно ли этот код портировать на java script нормально нет проблемы а что что что так звездочка это разминая не указ как объяснить а хорошо вот все эти места где я рад не там далеко не все эти места где я писал м буфа tempus это вот оно то есть можно считать что звездочкой это я беру пути в буфере текущей байт то есть как ну да да да простите виноват на java скрипте будет на две строки больше потому что в цикле нам придется инкрементировать счетчик позиции в текущем буфере звездочка им паттерна фишечки до заменится руку руку заметил слышал но боюсь выиграть это к несчастью не имеет никакого отношения за что его любить за что я педалируя этот слайд тут конечно уже много кода уже целых три строчки над для того чтобы декодировать каждое долбанное значение тем не менее этот код ценен тем что они вот эти можно портировать на java script если справиться со звездочкой и b последний раз когда я его бенчмарков на core 2 duo e8500 уже тогда давал где-то так 500 600 мегабайт в секунду в прыжке то есть соответственно современных процессорах а java скрипте я думаю вполне можно рассчитывать на 300 и мы переходим плавно шуткам за 305 код чисто для полноты картины чисто для полноты картины по-прежнему кодируем виртуальный длинный строк но немного другим фокусом кодируемых не блоками по 75 за 1 а копируем чуть побольше значений в начале в один байт экономим на значениях от 0 до 250 одет в рынком они кодирова лись бы длине в 2 байта а здесь в один но зато дико теряем на всех остальных значений начиная с длины 252 мы здесь теряем обойти и кодируемых охая и кодируем в зависи соответственно и получаем выходном потоке не оптимальное количество байт слишком много байт по сравнению с минимально необходимым вот но тем не менее если у вас распределение длин строк перекошено так что именно строки от 0 до 255 3 чаются в 99 девяти процентах случаев вы еще немного сэкономили как называется этот код в литературе я не знаю потому что я его посмотрел вас книг от mais quel а реализовал понравилось бенчмарках не стал потому что ленивый но работает тоже очень быстро в уровень с вариантом вот этот вот этот вот нехитрый код вариант не хитрый кот они а по байта вы бы декодеры для них там пишутся в три строки в случае когда звездочку надо заменить на буфер в четыре строки и как бы ура ура работает хорошо быстро в принципе в этот момент уже примерно треть зала должна заскучать и там решить уйти потому что мы там большую часть доклада ушатали на то чтобы какими-то идиотскими перекладывания минутам непонятными битков ибо итикаф туда-сюда позаниматься и сложить там какое-то число вместо того чтобы складывать его в четыре байта сложить его в один на кой хрен мы этим занимаемся это когда памяти сейчас многое там зачем мы все это делаем зачем мы все это делаем возможно станет ясно в конце возможно нет но у меня хорошие новости как бы мы потратили 70 процентов доклада и мы как бы половину контента сожрали мы научились кодируют еще есть преобразование преобразование данных от к несчастью тематике сильно более широкое чем кодированием не просто потому что данных разных много извините картинка при образуешь одним образом вида сканируешь другим образом тем не менее по основным базовым методам сжатия чего угодно пробегусь по вершка натурального упомяну ключевые слова исходников слава богу не будет вощем тем не менее ряд ключевых идей ключевая идея из семидесятых это же глупо постоянно копировать повторение давайте вот у нас есть какой-то файл там обязан наверняка будут повторяющиеся слова или куски слов или куски разметки и что угодно еще давайте первый раз когда мы их видим сохраним сами байты с пометкой что ща короче поедут сами байты пацаны расширим данные потеряем на и место но вместо просто там не а познаваемых байт сохраним некий булочек в котором указано что тип этого блока литерал значение как есть длина такая данные такие обсе здесь потеряли и сохранили один байт а в следующей позиции сохраняем ссылку обратную уже другой номер командочки команда номер один все уже наконец-то по-человечески по программе ски длина по-прежнему 9 но эти 9 байт вместо того чтобы копировать мы даем декомпрессор у инструкцию скопирую их откуда-то оттуда вот 296 бать назад я умные я помню еще пока у нас было ровно вот это вот слово давай его оттуда скопируем всё пипец назовут лимпили зив и и как бы мы живем всем седьмом году мы только что из по и изобрели как бы важный алгоритмом лимпили зива который тем не менее чуть менее чем из везде используются до сих пор немаловажная деталь поскольку команда массу ровно 2 это один бит поэтому команду длину зачастую можно утоптать всеми предыдущих барабанная дробь пошла синергия это любым из предыдущих методов маленькое значение длины команды одновременно можно утоптать в один байт они в 2 будет и по бойцовый кот и как бы два значения вы сохраните одним байтом ура ура еще одна важная идея которая спаси господи старше там большинства присутствующих наверное включая меня вот есть у нас тот же самый английский текст мы считаем какие-то чистоты перенумеруем все там таблички строим на 256 символов ноешь идиотия байта зависимые у нас вот в русском языке даже на этом слайде слог ви есть слог в ь тоже возможно есть а вот в комбинации букв е ь вашем языке не существует так давайте сделаем больше чем одну таблицу давайте сделаем 256 контекст независимых таблиц с в зависимости от того какой у вас там был предыдущий байт и в каждой по 256 счетчиков поскольку передавать эти ну собственно то же самое но 256 раз вот он когда-то помните строили там давно уже было мило 15 назад строили таблица частот по всему файлу вот тоже самое но 256 разной в зависимости от предыдущего байта передавать их не будем поскольку они экономически меняются будем их обновлять на лету и приходи вы не при декодировании кодировать вместо значит нашего исходного байта которого увидел его номер по чистоте в текущем контексте ура мы только что изобрели со winzip в какой-то мере мы знать только что изобрели метод под названием ppm простейшая контекстная модель там контекстом один байт 256 таблиц по 256 счетчиков даже это можно сегодня исполнить на java скрипте mindscape 30 конечно вешался в девяностых и двухтысячных тоже более определенное продвижения но я уже как бы вышел за бюджет времени поэтому внимание на них не заостряя мы считаем что просто святые 90 помимо перестрелок прошли затем что и вычислительной мощности начали на начало наконец-то хватать и люди просто занимались реализацией полировкой всего чтобы она придумали в шестидесятые семидесятые восьмидесятые в 2010 как бы вычислительных мощностей стало еще больше хватать на евро fci стали запихивать какие то уже совсем значит хардкорные штуки типа например новомодного брат ли одна из двух ключевых идей внутри брат или просто гениально и принял вот чувствуется что никак нельзя это продвижение было сделать раньше 2010 года ну в самом деле давайте введём словарь английского языка html тегов как можно было догадаться до этого это прям прогресс вот понятное дело что словари внутрь архиваторов пихали и раньше прогресс тут наверно заключается в том что корпорация google мягкими пинками тяжелым кованым сапогом убедила по уже примерно пол неба воткнуть поддержку этого самого брат лего браузер и постепенно загоне всех пинками в светлое будущее полностью вот но тем не менее как бы половина из использованных идея на как бы ой-ёй 50 лет примерно в обед и б ничего сложного там не на нет до сих пор как бы вот улучшение продвижения модная технологиям ура все монет теперь мы знаю ну как бы докладу не там не да и техникам преобразования техникам кодирования все теперь мы можем все после этого обзора и конечно же еще там на трех лет компания в википедии мы реализовать чуть менее чем все что как бы есть актуального на в кавычках рынке в кавычках вот такое более-менее обще целевого сжатия gzip там внутри ел . и хоффман севан zip эльзы маньяки вариации на тему lz то есть простой идее под названием вместо дубля слова строки и так далее там просто кодируем обратную ссылку и так далее и тому подобное отдельный прикольный пример этого то за 4 я считаю очень прикольным потому что в ну внутри там во как бы важно нужным дико быстром дико эффективном кодеки не какая-то высокая наука внутри сидит а натуральность идея сама открою один байт в котором в котором как раз по четыре бита кодируется длина литерала который сейчас поедет и длина вот это вот блока который надо скопировать откуда там из прошлого все формате а4 концептуально ничего сложнее нет понятно что он немного про развесить и потому что не все у вас по месяца в четыре бита но натурально концептуально самый в кавычках частый блок внутри как бы важного нужен будет имеющего важное большое значение для народного хозяйства формата к вот как будут два притопа три прихлопа а казалось бы мы имеем все как бы ну окей как бы нормально черном почувствовал себя заново на первом курсе а еще я могу сделать я пишу ну живо скрепляя у меня моя вообще-то мне текст у меня лично там например поиском бывает внутри поиска это удивительно довольно неочевидным там тексты нет ни хрена как ни странно внутри поискового движка потому что словарь в полнотекстовом яндексе занимает херда маленько основную массу занимает данных в соответственно в полнотекстовом яндексе гигантский список номеров документов и еще более гигантские знаю список номеров позиций в каждом документе это просто тупо список возрастающих чисел как бы возможно догадываемся по предыдущим слайдом чем меньше значащих бит чем меньше абсолютное значение числа тем проще кодировать а это значит что мы можем исполнить нехитрый трюк возрасту список возрастающих номеров отлично заменяемых разностями между соседями вместо 12 31 пишем для начала 12 потом разницу 31 1979 -3 за не 48 она она она на абсолютное значение очень абсолютные значения чисел сильно уменьшились и в нем внезапно сильно лучше жмутся мы только что изобрели те 10 строк кода которые есть наверное внутри в каждом поисковом движке вот просто в каждом то что нет никакой человеческие возможности хранить обобщенный список и обобщен и никак не обработанный список номеров документов дельта кодировании в том или ином виде ну наверное где то обязательно встретится мелочи приятно тупой как палка трюк работает как вышел целый google использует как ни странно можно вот этот на мой взгляд смешно в какой-то мере на показательно можно еще сильнее улучшить результат еще более тупыми трюками вот этот вот правда относительно интеллектуальный но дальше будет вообще там нормальный человеческий тупой предположим что у нас есть супер частое слово именно супер частые слова вот в этом опять таки уже не совсем синтетическом примере полнотекстового индекса жрут основное место окей мы заменили все на дельта у нас дельта очень маленький 99 процентов дельта 1 1 2 1 1 1 3 1 а мы на каждую из этих д где блин два значащих бит а в прыжке тратим 8 что-то нажористо ok давайте группировать и каждую группу кодировать минимальным числом бит на кой черт вот так они побитого дано тот черт чтобы как раз сбить и камень и работать это как бы все еще неприятно для процессора а если группировать по тридцать два значения там и всегда-всегда будем с нашим входным потоком уметь работать с там отдельными байтами или даже отдельными into my очень быстро декодировать очень хорошо ура мы изобрели значит половину современных advance что называется встретил earth методом методов сжатия вот ту часть которую фору в методе patch for дельта мы изобрели если кому вдруг интересно яд во всем тем двум человекам я в коридоре все с удовольствием расскажу что там дальше надо придумать локальный коэффициент сжатия у нас сильно как бы улучшается в оригинале там в зависимости от размера номер у нас была там допустим 4 байта на номер или восемь то что номера торчит последнее время часто пробивают 4 миллиарда фокусами спабо и твоим кодированием его винтом мы в лучшем случае у жмем четыре байта до 1 и и там 025 изобразим вот этим дубовым фокусом мы сжатие простите улучшаем еще в 3 раза вот тот уже можно начинать о чем-то задумываться наверное мы только что уменьшили наши данные в 15 раз для об гигантского слова где этих данных где где это важно где этих данных бумага в 15 блин раз ну понятное дело что с педант откажут в 14 копейками но мы решительно гневно округлим свою пользу то эти вверх понятное дело что большие значения дельта так просто не сдадутся понятное дело что нас будет мерзкие слова где этот трюк вообще не сработать тем не менее в тех местах где важна 15 блин концов чуваки это все еще хуже чем bitcoin купленный по 20 но это все таки 15 раз самое удивительное что можно изобразить 30 раз еще более тупым трюком под названием сиденья сам открою берем и строим bitmap chic понятное дело что когда у вас диапазон значение от 0 до 210 четвертой степени to bind папочек будет как бы занимать памяти что как бы весь научный след человечество причем формате png вот и bitmap чем просто так не построишь но тем не менее в тот момент когда у вас достаточно плотный что называется номера и документов достаточно достаточно много достаточно большая часть то именно мальчик нехитрый вообще методы сжатия работает и коэффициент сжатия дает лучше всех и более того проб обман после этого этой эти bitmap чеки так прекрасно пересекаются и но из с ей инструкциях что аж дым от ушей стоит примерно от скорости работы внезапно совсем хороший метод сжатия применим грубо говоря там в случае полнотекстового индекса к трем ключевым словам из 20 миллионов но там где применим дает нечеловеческий хороший результат коэффициент сжатия вообще в 30 раз групп говорят о чем у меня если вы ее не текста не поиска а вот там аналитическая база дано в которой тысячи колонн окно тысячи колонка не влезает на слайд поэтому только 2 там номера пользователя который мы амбициозную кодирование восемью байтами хотя у нас даже и 4 никогда не заполнится в жизни текущей time стенда микро секундной точности про мужика к выкупу ней мы храним все о чем мы же прочитали статью что чем больше данных тем лучше поэтому вот это все еще тысячи колонку в таком же роде и чтобы жизнь медом не казалась uid мы генерируем функции jennie reid view аиде чтобы во-первых помедленнее во вторых по рандомный и в-третьих как бы обосрать как бы докладчику в сюжете принципе все можно наверно расходиться у нас там энтропия высокая данные служит типа случайные да ну вот в двух колонках наверно уже в 4 подавляющее большинство данных будет не случайно и один из каких-нибудь тупорылых трюков они натурально тупорылые там как бы никакой высокой математики нет сработает берем наши данные ok вот представил я конечно понимаю что уже мозг и рвется мы там сначала циферки кодирования уже через 15 минут себя базой данных представляем аналитически но давайте попробуем то же время уже к полудню можно проснуться берем наши данные долгим их на блоки блоки и типичную хочется делать там достаточно большие 60 428 записей начинают работать если вы будете делать в блоке тут по 8 записи вас сжатия никакого не получится никогда и смотрим какой трюк у нас работает в каждом конкретном блоки много повторов старая добрая и роллы и кодирование вот значение количество повторов значения количество повторов все значения достаточно высокий ну давайте минимум абсолютно из них вычтем и уменьшим количество значащих бит все значения рандомные но их там всего два три уникальных вопрос строим табличку на три уникальных значений сохраняем три уникальных значения а дальше все сохраняем там двумя битами дух бит достаточно чтобы закодировать три уникальных значений еще десяток таких трюков и вы внезапно изобрели вертик у точно потому что этот список я оттуда и переписал и клик house скорее всего с господином миловидова мы значит познакомились вчера не общались ровно 15 минут возможно он все-таки решил прийти на доклад и маш сейчас мне рукой я не вижу миловидов выходе не пришел или я не вижу ну ладно пойму и мы допросим и возможно клик how снов клик home про клик house неточно потому что я исходники как бы до сих пор не почитали не прочитал миловидов комментировать отказался говорить там все тупые конечно тупо везде все тупо 3 конкретику расскажи но вот скандале я ее на слайде внизу как и конкретики не получается 5 нехитрых методов может быть в клик hause их 15 может быть 70 тем не менее как бы вот там живется вот так палка веревка и фокусы под названием а если работает вот этот фокус мы применяем его отстань от меня кабель я не пишу базы данных я не пишу на java скрипте я вообще как бы аналитика считаю нее розеточки и тут вот этот вот тот самый значит трюк под названием огрубления точности тоже сжатия его в основном на самом деле привожу как раз для того чтобы философы среди нас могли толково подраться на автопати я личное мнение пока даже не имею его вот в терминах моих под названием вот преобразование а вот кодирование itbrain что это преобразование с одной стороны вроде да мы как бы потеряли точность сильно изменили исходные данные они преобразовались и преобразовались как бы из-за потери точности с другой стороны у меня как у инженера рука не поворачивается просто значит называется ситуацию когда я вместо doblo флот храню или там int с пониженной точностью именно вот каким то там матерым преобразования формально может при преобразовании ну вот счета как-то тяжело при этом работает как бы отлично внезапно потеряв точность мы только что сняли натурально взяли наши данные в несколько раз ура ура очередной тупой мой рабочий трюк может возникнуть следующий аргумент под названием я ничего никогда не храню и тут наконец-то продакшен байка даже если ты ничего никогда не хранишь у тебя иногда случается так я не уверен что всегда не не готов спорить но вроде бы часто в программе бывают переменные иногда эти переменные организовываются в массе вы просто вот откровениями щас сыплю пацаны и такая байка жил-был сфинкс умел считать сниппеты помимо прочего ну то есть ему впитываешь текста он тебе подсветочку папа показывает где какое ключевое слово совпало в каком контексте и пытается выбирать те фразы те пассажи из текста которые по каким-то причинам более менее хорошо значит точки зрения сфинкс эмпирически подходят 1 его реализация была написана как положено то есть палка веревка вектор talkin' токен был жирный потому что это был у берту не просто talkin' а uber токен но не тот уберто дин который умер точка ком атолл тубер talking который про каждый возможный вид полиморфного токена слова и это пунктуация это какой-то спитцер еще какой-то фарш знает все всю эту доблестных хранит в отдельных полях в итоге размер этой структуры не очень большой но 80 ботинок об и вала до 80 по моему в прыжке на излете порочный тратили тенденции генерировался этот каждый долбанный токен простите там либо из слова длиной 5-6 10 байт либо из одного пробелом огс генерится один talkin' то есть данные раздувались конкретно но походу тебе заливают документы в один килобайт все хорошо вот он какой то пас послала подсветку годовая счет morgan stanley годовой отчет morgan stanley очень большой и даже текста там из этих 226 мегабайт оказалось 100 натурального честного текста но понятное дело там в основном таблицы с финансовыми результатами но сфинксу от этого легче не стало он мгновенно упал в корчах с проблемой пришлось что-то делать было сгенерировано гениальная идея давайте сделаем жатый потока он там в нескольких местах используется все равно вот этот вот вектор токенов давайте его пожмем и будем обходить медленно и печально но зато не будем падать с нехваткой памяти ожидания были довольно скромные у нас там живется в 20 раз в 20 концов от памяти давайте же жрать хотя бы в два и на мелких документах скорее всего будет тормозить поэтому но как бы ну давайте на бенчмарком найдем границу там начиная с 16 килобайт вроде и не тормозит или там с мегабайта 2 под пас и вот это вот все унылая как буду каждый день в принципе то подпишем только затычек наверное 10 разных вариантов а не два а как вышло пока какого-то hero реальность оказалась лучше ожиданий так бывает довольно редкой нипочем bitcoin сегодня а у меня же нет черт в реальности сжаты индекс оказался сильно компакте то есть натуральным меньше чем оригинальный даже документ не говоря уж о 80 x и барабанная дробь этот код работал быстрее всегда вообще всегда с сжатым потоком чем даже вот исходный вариант который казалось бы делает сильно меньше работы сильно меньше его не надо вот этим дурацким сжать или разжать им постоянно заниматься а вот все равно быстрее когда у тебя в 80 раз этом или в 40 раз меньше данных это дает свой эффект кто-нибудь если помнит в абстракции там слово магия то вот это вот считаю она тут должно возникнуть недоумение может точнее возникнуть определенные у меня все макета ну окей как будто у тебя какой-то компрессор хорошор заработал а маги это где-то по все рассказываем магия заключается вот в чем значит все видели стандартные диаграмму про треугольник выборов там был быстро бывает дешево или хорошо да вот понятное дело что это приукрашенный реальность через розовые очки для слайдов на самом деле в жизни треугольник выбора вылет вот так не в масштабе быстро и дёшево и хорошо это еще такие сильно разные по размеру кружки и скорее всего сильно меньше а мы были вообще на холоде и никак не пересекаемся ни с одним из них поэтому когда у меня два кружка пересеклись в смысле быстро и хорошо и где-то рядом по касательной прошли мы я считаю этой великой магии то есть вот 4 никогда не сходящиеся вместе стороны света кое-как сошлись вместе вместе понятное дело дешево не получилось в разработке это было существует дороже чем написать одну реализацию с вектором толкин of но когда вот как бы из четырех кружков хотя бы сошлись 3 все хорошо если в зале есть ваще не программе стремена минимум один сто пудов есть у меня для вас плохие новости доклад был в какой-то мере для вас тоже вряд ли я заставлю вас код товарища элиас описать но оля время как бы не стоит на месте движется вперед техники сжатие идут вперед иногда надо делать вот такие вот таблички и прекращает сжать свои долбаные бэкап и гриппом вместо например всегда рвущего заметьте всегда рвущего при любых коэффициентом сжатия gzip из это std как вариант я тут мягко говоря не все архиватора мира перечислил очевидно но уже как бы можно на чем-то задуматься до что если вам нужно дико быстро зажать этика быстро сжимать и пофиг коэффициент сжатия вот то за 4 подсвечен если вам просто нужно какой-то generic зажать и вот за это std если вам нужно чтобы любой браузер умело ра зажимать вот брод ли и еще десяток ключевых слов слава тебе господи я уложился в бюджет 50 минут на кой хрен я вообще делает доклад тут внезапно и философское отключение как бы от матрицы значит якобы иногда провожу собеседование сформировал позицию что значит 99 процентов людей знают что такое вектор как бы там в любом умеют пользоваться динамическим массивом счет слышали про список их ешь но если дай бог заставит реализовать то как бы не чуть-чуть и вальчика пойду в другой компании нормальную не заставляют такое дело делать но при этом как бы хотелось бы что в общие уровни образования рос и не падала и уметь надо намного больше а тут возникает следующий вопрос а что изучать средне потолочь на что каждому пригодится я блин пишу на java скрипте а я пишу на письма я пишу на си плюс плюс а я вообще warden и как бы если какая-то хоть какая-то точка соприкосновения общая кроме блин викторов списков и хешей во всех области во всех областях человеческой жизнедеятельности ее нет то есть абсолютно какой-то общий штуки которые нужно вообще всем и везде нет но вот ближайшие приближение которое я придумал это техники сжатия потому что они много где возникают вебе короче зубчиком response жмешь внутри сфинкса поискового движка данные промежуточные данные переменные в программе жмешь и она начинает работать и быстрее и жрать в разы десятки раз меньше памяти в там клик aussi простите данные жмешь и он вот люди ходят футболках не тормозит применимо много где при этом я понимаю прекрасно что можно 70 лет прожить она те вообще никогда не понадобится про уж ты занимаешься этом не знаю там может быть понадобится как раз блокчейн ты сжать вот занимаешься например чем-нибудь приятным там я не знаете программированием кофеварок возможно и как бы не понадобятся никогда а и целью хотелось продемонстрировать что нужно ну как бы тут то что много где нужно и продемонстрировать не сумел хотелось продемонстрируй что сложному там ничего все сниппеты кода блин по три строчки которые портирован из чего угодно на что угодно и можно поиметь хороший профит ключевые слова для тех кто любит фотографировать ключевые слова несмотря на то что я отправил слайд организаторам и видимо они его скоро выложат они вот их много это не все ключевые слова далеко ну вот в принципе как раз на три года вечерами хватит википедию читать я не ответил на последний вопрос который заявлял в обстановке что отвечу отвечаю так собственно как же быстро и просто написать свой конкретный код хрен его знает как в деталях это ваш конкретный код тем не менее общий подход тупарыло как палка глядишь на свои данные считают частоты смотришь что у тебя такое часто что у тебя такое редкое частая паковать редко и раздувать биты лучший жмот байты быстрее считаются иногда иногда не всегда но иногда случается чудо и как бы получается и быстрее и компактнее но конечно придется поработать и кода пописать больше такие дела вопросы почту коридор и так далее и конечно же чтобы не поставили визу и чтобы значит описать свое состояние после первого восприятия этого доклада обязательный котик вопросы на все оставшиеся у нас минус 5 минут на мне как бы может показывать вопрос сзади летит в нас 2 ну слушаю внимательно пока люди расходятся и заходится тишина покой окей вопросы в коридоре видим"
}