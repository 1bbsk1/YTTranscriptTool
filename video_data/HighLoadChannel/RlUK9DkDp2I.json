{
  "video_id": "RlUK9DkDp2I",
  "channel": "HighLoadChannel",
  "title": "Multi-tenant Kubernetes / Михаил Сидоров (SberTech)",
  "views": 3433,
  "duration": 3057,
  "published": "2023-04-28T06:21:29-07:00",
  "text": "начал немного о себе меня зовут Миша Я работаю в ренде облачной платформы с бертеха под названием платформе Вот и в ходе одного из так входя одного из треков нам нужно было сделать собственно мультиценатный Купер найти чтобы была возможность шарить один кластер между большим количеством команд Вот Но при этом Сбере есть своя специфика там очень много команд и из-за этого требования к изоляции были довольно высокие а вот ну собственно о чем будет доклад я во-первых расскажу про то какие есть подходы к реализации мультиценатности их в принципе не так много конечных реализаций довольно много разных но основных паттернов всего три вот дальше я расскажу про то какие челленджи возникают если пытаться тот или иной паттерн у себя реализовать И вообще поговорим о том с помощью каких нативных объектов cubernatis можно построить дабы больше проникнуться в проблему вот после этого я расскажу про то что такое виртуальный страх и про то почему это классное решение чтобы строить карту вот Ну сначала немного терминологии Вот это на самом деле сном был повод вставить какой-нибудь мем в презентацию вот Ну в принципе да мальсенантность это просто какой-нибудь предоставление изолированного доступа разным арендаторам То бишь тэном там каким-то общим ресурсом вот я здесь провел аналогию с домиком вот если Single timond это как бы домик который Мы сдаем в аренду и там живет всего один человек то мультисенантность это как бы домик в котором живет много кого-нибудь вот в нашем случае это соответственно либо отдельные пользователи либо отдельные команды либо какие-то клиенты вот дальше Также важно поговорить про то что такое софт и Хард мультитанс вот поскольку я буду дальше апеллировать сказать термином в общем-то да под софт мультитаносы подразумевается как бы скорее логическая изоляция ресурсов То есть она этот подход более актуален Когда у нас какие-то клиенты или команды которых не очень много и которым мы доверяем то есть Это скорее для какой-то внутренней истории некогда мы строим платформу Вот и соответственно хартензия это противоположность То есть это как бы жесткая изоляция когда мы пытаемся максимально добиться полной изоляции между тентами чтобы они как вообще не могли повлиять друг на друга Вот тут я тоже провел налоги с до время в общем-то софт мультитаносе можно представить как Open Space То есть у каждого в принципе есть свое какое-то место где он может сидеть Но ничто не мешает кому-нибудь вторгнуться ваше личное пространство вот Хард мультитайлз Это что-то вроде отеля где У каждого есть свой номер и ключ к нему Вот Но тут важно понимать что это не какие-то два принципиально разных подхода Это скорее как бы разные стороны одного Спектра То есть просто как правило софт мультитанцы проще реализовать и оно несет себе меньше ограничений для конечных пользователей вот сложнее но при этом как бы лучше и надежнее вот дальше про то какие есть ведомые сценарность Это не я Это не сам я придумал это как бы то разделение которое сделали ребята из sigmulti teense То бишь мультитанцы working группы cubernaises Вот они собственно выделяют три основных модели мытности это кластеры за сервер с ним сервисы Control players и в общем-то наверное по названию плюс-минус уже можно догадаться О чем речь Вот соответственно Я поговорю про каждый из этих подходов в большей степени акцент сделана Control plain Ну начнем с кластера за сервис в общем-то Тут есть один жирный и довольно очевидный плюс это как бы Хард мультитанцы из коробки то есть ну у нас просто отдельные кластера которые мы отдаем клиентам То есть клиент просто заказывает себя кластер и пользуется им Он у него свой собственный Вот но основная основная причина почему это подходит Не идеально Это потому что это дорого То есть у нас под каждый кластер нужно резервировать какие-то ресурсы под контролем также есть так называемая проблема кластер прол Когда у вас большое количество катастрофы они растут и их очень сложно менеджрить э-э То есть Вам нужно каждый отдельный кластер за ним как-то присматривать вот и в общем-то превращается довольно большую проблему Ну и строго говоря в в тех терминах которые которые я сказал Да что мультиснантность это разделение каких-то общих ресурсов Это не совсем мультитенантность в контексте Купер нейтса потому что здесь Мы скорее нес лежащую облачную инфраструктуру то есть какой-нибудь а с гелем между теннантами а не столько Сам Собственно сам куберетесь вот поэтому тут акцентировать внимание я сильно не буду вот Наверное стоит сказать что в принципе сейчас платформу сервисом для провижника это уже реально не сложно во-первых есть такие проекты как кластерапи Гарднер вот ну куча непонятное дело вот поэтому в принципе это не основная проблема основная проблема то что у вас реально будет куча кластеров Вот и теперь вместо того чтобы сразу перейти к ним Space The service Давайте попробуем сконструировать им спейсы за Service в общем-то из каких-то нативных объектов cubernets и попутно поймем Какие вообще есть нюансы вот Ну да нам нужно понять в каких местах нам важна изоляция в интернете чтобы сделать Но самое первое и очевидное это изоляция на уровне API то есть Нам нужно уметь определять Кому какие объекты доступны Вот и очевидно это можно сделать с помощью Roll Base Access который встроен уже в кубернете ролей ролл бензингов и прочего Вот и на импейсов которые собственно на который мы это и будем накладывать Вот то есть Итак первым Building блоком у нас будет как бы на Space которому мы даем доступ админу команды Вот и дальше он может в общем-то управлять объектами внутри этого на им спейса и раздавать на них какие-то полномочия своим сокомандником как он захочет вот при этом при этом он может оперировать только с объектами внутри вот дальше Окей мы разобрались с точки зрения фишки теперь нам нужно научиться разделять ресурсы в общем-то сам кубернатор сам по себе Он позволяет нам какое-то количество наших виртуалок или там железяк абстрагировать в один большой пул компьютер ресурсов Вот и нам нужно теперь между тендентами эти компьютеры ресурсы как-то справедливо уметь разделять вот ну тут у нас как бы есть два опять же нативных объекта кубера это ресурс квота Ну мы просто можем найм Space опять таки на ней Space накинуть какие-то ограничения по ресурсам которые можно заправить то есть мы можем выставить как бы сколько мы можем сколько в этом смейсе может быть запроедленно CPU Memory подав и там вообще еще много чего там стоишь и так далее вот также можно поговорить классы Вот Но это немного усложнит как бы картинку поэтому я не буду вот Окей вот большую кубышку мы теперь как бы умеем разделять но у нас все-таки остаются отдельные ноды на которых тянуты сосуществуют Вот и они на самом деле могут друг на друга влиять Каким образом в интернете есть так называемые квалитвы в сервис и если вдруг наш теннет не выставит какие-то определенные лимиты или request то это может все закончится тем что пот будет много выселен вот и это в принципе не критично но может быть довольно неприятно и это можно регулировать с помощью лимит ranges это на самом деле решает не только эту проблему целый класс проблем во-первых Мы избавимся от поводов которые как бы без лимитов и квестов и поэтому не учитываются в наших ресурс квотах потому что ника ресурсы не зарезервированы вот во-вторых мы можем форсить чтобы наши клиенты использовали определенный квалитва в сервис Да например например в принципе мы можем сделать так что у нас как минимум будет в сервис да то есть в любом случае мы можем выставлять либо дефолтные лимиты либо дефолтные или квесты и вместе тоже вот ну и помимо этого мы можем ограничивать В общем с максимальный размер кодов если нам тоже нужно с помощью максимальных лимитов Ну и собственно минимальных тоже вот Окей следующий Аспект который стоит поговорить но он тоже Довольно простой это сетевая изоляция нам нужно уметь определять Какие позы могут общаться друг Между другом по дефолту когда мы строим мультитанс Мы просто хотим ограничить общение поводов внутри name space'а чтобы они могли ходить в другие Да чтобы подтянуты могли общаться только между собой Возможно с фишкой Куба Возможно скоро DNS для для сервиса Discovery и соответственно со внешним миром вот ну и тут поскольку мы условились использовать нативные объекты куберы мы можем использовать Network Police Ну понятно что есть там сиена и по типу сириума которые позволяют использовать какие-то свои сердечки для этих целей но опять же это Ну да вот тут примерно нескольких натурполисе с просто чтобы освежить память вот ну и да мы они опять же накладываются на namespace это важно да то есть мы накладываем их Space вот Окей сетевой частью разобрались теперь посмотрим на изоляцию самих контейнеров нам важно уметь ограничивать что могут делать контейнера на самом деле не только это важно не только для хартманси но для софт мультитаносы вот ну про это чуть позже ну и да и Мы также должны уметь контролировать Какие плоды могут находиться на одной и той же ноде да Потому что если у нашего клиента вдруг какие-то очень чувствительные данные мы можем захотеть ему сделать какую-нибудь например выделенную ноду Или например у клиентов там зарезервированный сервер пушками и соответственно тоже мы должны гарантировать что его подушелиться шадриться только туда и чужие не будет Да ну вот собственно контролировать то что может делать плод Мы можем с помощью поле с который теперь Кейт от и там можно было контролировать Прям вообще много чего вот сейчас есть три под Security стандарта и опять же есть контроллер который навешивается с помощью лейблов на ней спейсе проверяет каждый созданный под что он соответствует тому или иному стандарту Вот почему это важно у нас может возникнуть ситуация когда два например Казалось бы таланты которые не хотят никак друг другу помешать захотят использовать какой-нибудь хост ПАЗ например на нозе Да и заманить себя какой-нибудь папочку с нода Вот и Понятное дело что они могут хотеть замануть одну и ту же папочку это это не есть хорошо И при этом у них не было никаких как бы плохих intention по отношению друг другу вот если под Секьюрити стандартов мало можно использовать контейнер антаймы вот тут есть qr-код со ссылками на там обозначенная здесь контейнером таймы вот в общем-то Да кат контейнер вчера был замечательный доклад про то что в кубернете можно Гонять не только лишь контейнера но и какие-нибудь микро-видуалки вот ну и собственно firectracker от контейнер позволяют это делать Можно даже какие-нибудь виртуалки на тему запустить вот да и следующее это как бы мы можем использовать какие-нибудь селекторы Это intelliration offinity антифинити для того чтобы управлять тем куда под неймспейсе в нашем спейсе шадриться Вот это Например позволяет делать выделенные ноды для тентов чтобы чтобы мы гарантировали что на этой ноте сидят только его поды Вот соответственно Это можно сделать каким-нибудь селектором и вот чтобы наверняка туда ничего больше не зашедлилось повесить туда какой-нибудь leration соответственно под нашего Вот но здесь возникает важный нюанс Чтобы это сделать нам нужно навешивать это на каждый пот вот есть в предыдущем примере под Security стандартами у нас был уже встроенный адмишин контроллер для Ну который поставляется короче вместе с купером Вот то для этого Например у нас ничего нету то есть Нам нужно какой-то свой Там метаинственный фокус он говорят для этого писать чтобы вся поиски которые прилетают э-э прилетают на нашу летают к нам в кубе Короче у меня таитились и к ним дописывался какой-нибудь селектор при этом нам ещё важно чтобы тент не мог никак этот селектор убрать Вот и соответственно для этого нужно будет писать что-то свое и в принципе у нас получилось довольно много компонентов но Благо есть несколько опенсорсных имплементаций сервисы которые дополнительно решают одну очень важную проблему то что мы ограничены только одним наймспейсом то есть мы никак наш стенд никак не может создать еще какую-нибудь Space и там что-нибудь погонять Вот соответственно эти две имплементации эту проблему решают первое скорее просто так включена потому что ее сделали вот она поэтому интересно на самом деле она очень плохо юзабельна Для построения мультисенантности и вот почему у нас как бы создаются на им спейсы и дальше пользователь может создать дочерние фейсы для нашего который мы ему дали и там вся как бы будут наследоваться в эти дочерние неймспейсы вот под капотом там на самом деле есть отдельная сердечко для создания как бы вот этого дочернего на inspace а контроллера подхватывает сам нарезает уже на имспейс и копирует туда все что нужно но тут есть важная проблема что это тупо репликация то есть тупо объекты из родительского копируют реплицируются в дочерней и Например если мы возьмем ресурс к Лотос с помощью которых мы хотим справедливо раздавать ресурсы Мы очень сильно огорчимся потому что они будут просто копироваться в каждой новой Space таким образом появляется очень простая уязвимость Вы можете просто себе кучу дочерних спейсов создавать у вас будут бесконечные ресурсы вот ну собственно чтобы реально сделать мельценатность есть очень классные консорсный проект под названием капсюль вот он делает немного иначе там вводится своя сердечко под названием tennon собственно и там собственно можно строить количество на им спейсов которые может нарезать тэн и мы указываем соответственно сервис аккаунт или юзеров которые которые этим тендентом могут управлять и это просто по сути некий адмишин контроллер который помимо всего прочего еще умеет вешать на созданные неймспейс или нет Рейнджерс Network policys not селекторы ресурс квоты и вот все вот это о чем я до этого поговорил то есть по сути все наши хотелки здесь учтены вот дополнительно можно какие-нибудь аннотации лейблом спейсы навешивать Вот это Например можно использовать для того чтобы стандарты навешивать потому что они как раз как я показал можно вешать через аннотации Вот Но все-таки есть куча минусов то есть с одной стороны теперь у нас только один кластер и мы можем гораздо более эффективно использовать ресурсы потому что у нас один общий полнот по которому Наши все подвиги размазываются вот плюс можно пере использовать какие-то общие контроллеры Например если у нас есть ингресс-контроллер мы можем создать конгресс внутри нашего namespace и соответственно контроллер его подхватит нам все нарежет все будет хорошо вот и с любыми операторами в общем-то будет так вот но есть ряд таких прям больших минусов во-первых это мы вводим какие-то ограничения и пытаемся как бы такое дырявое решетое закрыть и из-за этого полная изоляции очень сложно будет добиться плюс у нас в любом случае урезанные права админов команд даже в случае с капсюлем мы все равно например не можем пользоваться кластер vide ресурсами А это важно потому что например сердечки и ноды и там не знаю сторож классы это все кластер вайда ресурсы то есть мы не можем при этом к ним давать доступ Вот и соответственно если команда хочет поставить какой-то свой оператор или какой-то собственный оператор к себе в классера на этого сделать банально Не может решение тут в принципе никакого нет но нет со звездочкой потому что у капсюля в целом есть опция ставить перед сер свою про Ксю которая как раз позволяет давать доступ к Наим спейсам которые нарезаны нашим тэнам к сторож классом и еще чему-то о чем я забыл вот ну то есть как бы некоторые скоуп А да и конгресс классом Вот то есть некоторые кластер Уайт ресурсы мы таким образом можем давать каким доступ но тем не менее все равно не ко всем да то есть проблему с сердечками это вообще никак нельзя решить вот ну теперь просто небольшое резюме для изоляции описки мы используем Рыбак Вот Но тут Да нельзя никогда без полной изоляции мы должны был анонсировать либо между урезанностью либо это вот дальше у нас для разделения ресурсов кластеры в целом у нас ресурс какого-то или нет Рейнджерс для сетевой изоляции полисе и для изоляции runtime соответственно контейнером Time и PSP а вот Окей теперь перейдем к самому интересному это Control plain The service вот на самом деле здесь речь про виртуальные кластера вот суть суть подхода довольно простая как бы у каждого своя фишка но куб при этом общий вот есть две опенсорсных комплементации как обычно от сигмати тенденция которая не очень работает и вообще выглядит заброшенный Вот и второе это кластер собственно достаточно живой проект который мы у себя адаптировали Вот теперь посмотрим как вообще устроена виртуальная кластера слева так лево право лево слева у нас Control plain ванильного кубера с ними я думаю все знакомые справа Control plain как он выглядит у виртуальных кластеров вот здесь меняется следующее у нас появляется синкер который синкает все Точнее не все определенные создаваемые ресурсы они содержащие хостовый кластер вот при этом что это за ресурсы это подвесишки сервисы секреты конфиг мап и еще что-то что мы дополнительно можем настроить Но идея здесь следующая мы синками только как бы базовые какие-то ресурсы которые требуют например работы с юбилетом который требует какой-то работы с нашей нес лежащей как бы инфраструктурой Файлик на нозе нарезать нарезать какой-то пилишку до создать контейнер вот а все высокоуровневые ресурсы там например стоит Фуд сайт диплоинд они уже работают с этими низкоуровневыми абстракциями и поэтому нам их вообще синькать никак не нужно то есть наш ростовый кластер про них никак не должен знать Вот если вернуться на предыдущий слайд Мы видим что благодаря этому как бы мы используем шедоллер хостового кластера потому что мы просто синкаем вниз ноды и хостовой кластер уже решает куда их за Шедоу лить что с ними сделать как за провижнее чем Как там нарезать сетку как за прорежем вишки все вот это вот мы про это не думаем их просто Вот теперь посмотрим как это как бы происходит в реальности вот у нас сверху как это выглядит в виртуальном кластере у нас есть три какие-то подвига которые нарезал диплоинд вот и на хостом кластере они превращаются вот в такую штуку в чем тут идея как бы сначала идет название под дальше делимметр дальше название namespace и дальше делимитор название кластера Вот это позволяет нам симкать все ресурсы внутрь одного кластера внутрь одного на эмспейса то есть у нас все под виртуального класса на самом деле на Хосте находится в одном спейсе вот и это очевидно позволяет нам использовать все что все прошло рассказывал раньше и просто внутри фейс уже вводить ограничения навешивать и так далее вот да Мы видим что опять же в виртуальном кластер есть там четыре своих наймспейса в простом Есть только два на самом деле это можно делать в одном но два мы используем для того чтобы там вот которая в C менеджмент там сидит весь Control playing виртуального кластера и там свои ограничения действует поскольку контр-плайну нужно еще общаться с хостовой сервером и так далее вот во втором спейсе уже сидят все Ворк клоуиды вот причем тут интересно заметить что вот помимо трёх наших поззиков которые сиккнулись еще есть кордан с Вот чем это связано на самом деле Синг это понятно это Чуть более сложная операция чем типа взять и через дилеметры несколько стрингов слепить например то есть там возникает очень много сайтов например есть проблемы с сервисом Discovery вот собственно для этого и заводится корданс в который регают в которые синкер бегают все эти под нормальным своим именам они вот этими за симками Иначе мы должны были бы обращаться к каждому поводу как типа вот это вот длинная стринга точка кластера вот и это было бы не очень Вот Да и дальше мы смотрим на диплоинд и как ожидалось они не синкются на хвостовой кластер они существуют только внутри Потому что они менеджерат объекты которые существуют внутри таманского Control plain Да теперь немного посмотрим что у нас как бы сама эта идея дает сами по себе виртуальные кластеры они позволяют добиваться полной вообще изоляции на уровне API про которые мы говорили то есть никаких ограничений по установке сердечек в свой свою фишку вообще нету потому что у вас отдельная иди отдельная фишка отдельная все вот но нету никаких ограничений вот по разделению общих ресурсов сетевой изоляции изоляция runtime и так далее То есть это нужно дополнительно допиливать Вот Но как я и сказал поскольку все под виртуального кластера живут в одном спейсе мы можем просто вот все эти довольно простые штуки про которые рассказывал взять и накинуть на этот Space и мы получим вот как бы хартманс на самом деле вот но там довольно много чего нужно накидывать и поэтому мы сделали для этого свой оператор Но на самом деле это можно делать и условно каким-нибудь home-чартом То есть если вам там fully сайт он не нужен свой оператор Писать особо смысла нет Вот такая примерно получилась Пека там очень много нюансов опущено потому что у нас есть как бы дефолтинговый клуб который кучу всего представляет Вот но опять же спека выглядит не суперсложной учитывая что у нас там еще какие-то свои допилки типа есть мониторинг и вот такие необязательные штуки Вот теперь посмотрим что создается внутри Space of как я уже и сказал У нас создается два на Space Да один для контролей другой для варкологов соответственно видим что там в общем-то создается все что обещано было на диаграм результатам есть описервер который ве класс вторая здесь называется Есть эти сиди свое Cube Controller Manager Singer Собственно сам который сингает Ну и несколько наших там дополнительных допилок которые нужны там для бэкапов мониторинга и прочего вот ну и War клодных нами соответственно крутится только warcload вот здесь можно заметить что как-то очень уж много кодов создается менеджмент и как-то уже очень сложно это выглядит и возможно для каких-то простых кейсов это будет излишнее И тут есть классная опция запускать виртуальные страны к3s вот небольшая водная там КТС это дистрибку бак где все по сути запихнут в один бинарник и очень много всяких конвершенов выкинут например вот и соответственно это нам позволяет вообще сделать очень просто это как раз то как по дефолту распространяется в эквестр который опенсорсный вот там это выглядит Так у нас просто создается один под в котором два контейнера первый это к3s второе это синкер который просто подвешивает сайдкаром вот чем это прикольно прикольно это тем что к 3S позволяет например вместо CD используется skylight и понятно И как бы какие-то быстрые прогоны кластеров можно использовать можно сделать с помощью КТС во-первых очень быстро нарежется во-вторых будет потреблять очень мало ресурсов именно например Это используем у себя в некоторых пейнах Когда нам нужно какие-то вот интеграционные тесты самой платформой провести Вот потому что это как бы все все равно получается полноценная виртуальный кластер просто не очень отказу устойчивый вот ну и следующий Аспект про который стоит поговорить Это расширяемость тут какое дело как бы вот синкер синкейт как бы какой-то определенный набор ресурсов которые собственно он умеет симкать вот если мы хотим какие-то дополнительные сердечки научить транслировать на нис лежащий кластер можно создать плагины вот по сути эти плагины не сильно отличаются от обычных контроллеров Куба вот у них специфик следующая вместо того чтобы обрабатывать только один вид ивентов Когда у вас что-то в кластеры поменялось вы хотите и вы запускаете Control то тут он запускается Когда у вас поменялось что-то физическом кластере и вы хотите синкнуть на виртуальный и наоборот То есть это должно происходить две стороны и по сути на самом деле Ну то есть так не только плагины реализовано в принципе все вся компоненты синкера вот ну и есть возможность писать руки Это по сути то же самое что там пхуки в обычном кластеры ой в обычном кубе Ну специфика тоже соответствующая и их например можно Ну то есть если с плагин с обычными плагинами там понятно да у вас есть какой-нибудь там э оператор монги например вы хотите его использовать вы хотите его поставить в кластере в своём физическом один раз да и дальше чтобы у вас синкались сердечки на него основы кластер и как бы там это могли его переиспользовать Вот вы можете свой плагин написать а второй вариант - это как-то например не ответить уже ба ресурсы там например какие-нибудь сервисы или только позики создаются Например у нас был кейс когда Ну мы крутимся в Облаке у нас там был менедж cubernation у него по каким-то странным причинам клауд-контроллера работал следующим образом для того чтобы создать лот балансер Вы должны писать там сто пятьсот аннотаций которые в общем-то Вы можете взять только из там типа либо из админской панельки там либо еще откуда-нибудь там короче через опишку клауда вот Понятное дело что нашим интернетом это вообще всё не нужно И эти данные они неоткуда взять не могут и собственно мы сделали хук который просто автоматически эти аннотации прилеплял ко всем создающимся сервисом вот во время съемка вот ну и да там есть как бы некоторые дополнительные фичи и бенефиты которые можно получить от использования виртуальных кластеров вот во-первых их очень легко включать и выключать Можно у вас по сути просто удаляются все плодики все пиписьки все конфликт мап и прочее сохраняются в кластеры соответственно поднимается и выключается это очень быстро там Если сравнивать с какими-то историями когда кластер выключается с помощью удаления виртуалок это соответственно происходит гораздо на самом деле быстрее вот Ну да Дальше можно запускать его через к 3S это уже более подробно рассказал и можно апгрейдить виртуальной кластера независимо от хостового кластера Вот чем это связано поскольку мы только какой-то какие-то определённые э-э базовые ресурсы да такие как под и сервисы у них уже на самом деле очень стабильная опишка которая из версий в версии не меняется Поэтому если вышла какая-то новая минорная версия вы можете как бы основной кластер обновить А хостовые можно Не обновлять и потому что в любом случае будет конвершен типа создадутся более Ну да ну единственное понятно что нельзя будет использовать какие-то новые фичи которые появились Вот и теперь резюмирую про Control Plane The service мы получаем в общем-то в принципе лучше от двух миров Да С одной стороны мы получаем хорошую утилизацию ресурсов как вот у нас в отличие Кстати от name Space Service немного понижается нагрузка на хостовый контролл плейн потому что потому что у нас многие контроллеры работают теперь только у тендентов Да у нас на хостом кластере по сути создаются только плодики и вот такие базовые абстракции вот можно какие-то инфраструктурные компоненты создавать и шэрить Да и можно какие-то свои контроллеры свои операторы поставить вот часть операторов уже можно шерить да Там какие-нибудь конгрессы и так далее вот ну тут понятно что со звездочкой Потому что если это какой-то вот кастомный оператор которого нету нигде то нужно будет самостоятельно для него писать плагин что сервисе обычно решается Чуть более просто Вот Но в отличие от name Space Service вообще нет никаких проблем с кластервайдер ресурсами То есть вы всегда можете там создавать сколько хотите наймспейсов какие-то свои контроллеры пилить и никаких ограничений вообще на это все нет вот ну и теперь итоги Да вот мы поговорили про три подхода в целом если резюмировать кластеры The service это хорошие выбор есть вы в принципе не очень хотите париться со всем этим или у вас очень высокие требования настолько высокие что как бы не хочется вообще рисковать можно использовать кластеры за сервис но нужно Быть готовым к тому что когда у вас количество кластеров вырастет будет сильная боль вот в случае с нами сервис это наверное на самом деле самый оптимальный подход если у вас не очень большое количество команд они как бы вы можете на них прямо влиять да то есть в отличие от клиентов вы не можете им сказать Вот этот подик Вы зря запустили вот случай С командами это сделать можно поэтому вот такой подход наверное наиболее оправдан и капсюль на мой взгляд очень хорошо подходит для реализации этой истории вот ну и собственно Control plain The service самое прикольная Новая штучка вот можно создавать виртуальные кластера и для Хард мультитаноса если именно делать честное хат мультитенсе это единственная существующая сейчас нормальное решение которое собственно можно начинать адаптировать Вот спасибо за внимание спасибо вопросы Да Привет Спасибо большое за доклад очень интересно подскажи пожалуйста вот если мы Таким образом разделяем у нас по Теном там какие-то команды до отдельные мы все равно должны помнить что иногда команда должен Ну хотя так или иначе друг друга ходить и мы должны какое-то сетевой связность обеспечить вот допустим у нас есть какой-то вот уровень это будет какой-то Вот Нижний вот этот уровень Да вот этого кластера не виртуальный кластер до хардвард который у нас стоит который все то есть грубо говоря вот у нас есть большой где все барахло от этого лежит и другой и как нам собственно секьюрно посетить связать вот допустим одну команду с другой Ну да Это хороший вопрос на самом деле как бы я могу рассказать как это делали мы я не тут Наверное сложно придумать какой-то идеальный ответ потому что если мы если мы позволяем тенонтом как-то как бы самостоятельно добавлять на тверкполисе это может привести к уязвимостям Как там не старайся поэтому мы решили это делать тупо через лот балансеры то есть они могут создать балансер которые будут не с публичным айпишником а с приватным Вот соответственно это делать просто через lootbanzer выставляется сервис и по локальной сети кластер гоняются трафик То есть это уже более низкий уровень да да Но типа у нас контроллер у нас всё равно есть в простом кластере Поэтому вот балансеры можно создавать Вот и у нас ну как бы на самом деле это не приводит Никаким затратам потому что эти лотбанцы создаются с приватным айпишником они с публичным поэтому там как бы никакие спасибо скажи пожалуйста второй Маленький вопрос не рассматривали его как четвертое решение какой-то gregate этапе то есть возможность как-то самим разделять Да собственно без запросы то есть не вот этот там сандолон какой-то греет этапе там уже разруливать вот это самим писать все эти правила создать там кучу контроллеров Ну по всей видимости Ну мы это рассматривали Да и как бы там проблема в том что это можно сделать вот ну как бы в рамках Рэнди трека мы хотели какое-то более фундаментальное интересное решение найти вот ну капсуль по сути это есть как бы вот уже готовая реализация вот этого да то есть там по сути просто как бы некий набор от Мишин контроллеров плюс этим как бы ну короче да адмишин контроллеров рейтинговых упаков которые там дописывают какие-нибудь штучки ваши Space которые вы создали Вот Но по сути вот что-то вроде капсуле бы и получилось скорее всего понятно что в каких-то частных кейсах э-э Там скорее всего в любом случае придётся писать свой адмишин-контроллер потому что э-э ну может какая-нибудь специфика возникнуть например какие-то определённые ресурсы например ограничивать Да которых нету там в ресурс например для этого в любом случае придётся какую-нибудь свою писать Спасибо у нас еще вопрос Да приветствую Михаил Спасибо за доклад Меня зовут Илья У меня вопрос на самом деле в середине Я получил у него ответную просто хочу засели вот смотри у нас лайка такая мы используем сервис Ну как мы знаем это сиди хранит все секреты текстом пока то не займешься нормально то есть мы психанули взяли куб силу Мы всё посолили у нас это в принципе адекватно У нас есть сил общий и общий секреты которые шарятся между нужными Space и на недоступны есть локальных сил которые они сами обрабатывают и их все секреты у них лежат в репе посоленные но доступны только с кубом потому что вот выехали спейсе крутится и всё А в случае кластер я увидел что если это среди он локальный полностью для кластера Да а как здесь будет проброс работать такой то есть у меня есть сил мастер сил Мне нужно его его ключ и Как видите его секреты отдать внутрь Да это Можно наколхозить но вот насколько работоспособность секреты так понимаю там не мучить У вас есть один это сидит и как она там хранится Ну хранится и хранится и ладно то есть не было ситуации когда вот какие-то инкрипторыные секреты World э-э не знаю кубок стран Сикрет Ну Куп сил запихнуть туда так чтобы с мастера ещё передать кусок этих секретов Ну вообще У нас такой вот кейса не было но мы про это думали есть сейчас я не знаю насколько это как бы точно ответить на вопрос Вот сейчас есть такая штука как короче вот как как серая только для для секретов да то есть типа вот такую штуку короче вот Сикрет класса там можно создавать Вот и можно просто с помощью этого и плагинов для кластера синкать эти секрет класса и соответственно чтобы просто в э-э виртуальном пластыре уже можно было их использовать вот это то не Ну в принципе похоже то есть я и думал что Вариант плагина который будет симкой но также кубок игры работает есть оператор который Просто у тебя своего сторожа подтягивает игры также здесь в принципе виртуальных кластеров есть реальная проблема с тем что если какой-то базовый логикой работаете не хотите её никак между кластерами шерить всё внутри вашего пастора Вы на самом деле можете любой оператор поставить виртуального и всё будет работать если вы хотите что-то проверить сразу нужно писать плагин Да я это и такой момент есть на самом деле он довольно базовых вещах тоже возникает с теми же я не знаю вот самое простое с чем мы сталкивались это у вас какой-нибудь френд бит собирает логин и он собирает их он типа маунтит себе папочку с контейнерами и оттуда все скрепит случай с виртуальным кластерами типа это просто не будет работать потому что ну то есть либо мы ставим как сайт Car Вот либо пишем свой плагин потому что как бы хост мы не можем никак разрешить плюс у нас контейнера которые на Хосте будут они у них вообще название даже будет отличаться от того что виртуальном пластырь есть Поэтому да вот как бы во всех таких штуках нужно писать свои плагины Вот но благо тут есть хорошая новость во-первых сейчас есть как бы репозитории которые как бы эти плагины складываются вот мы у нас также была инициатива сделать как бы какое-то а-ля там плагин хаб для виртуальных авторов потому что на самом деле это реально классно бы многие проблемы Решала вот там есть такая ну типа чтобы можно было шарить было бы классно Вот но там сейчас есть некоторые проблемы Open Source он у нас вот поэтому не знаю как выйдет Спасибо а еще вопрос вот здесь сзади Добрый день Спасибо прекрасный доклад подскажите вот использование капсюлю самка контроллер его какой утилизации ресурсов вызывает и Зависит ли она от количества того что он регулирует сущности внутреннего с капсулем мы нагрузочного тестирования не проводили потому что нам сразу не подошел с точки зрения типа строили Вот Но могу предположить что Ну как бы если вы используете прокси то у вас потребление ресурсов соответственно сильно будет возрастать потому что у вас каждый реквест будет проксироваться если это request с обращением куда-то там вызов каких-нибудь спейсов да Или каких-то островая ресурсов то соответственно это еще история будет ходить по фишку что-то там запрашивать это агрегировать и так далее вот поэтому про все я думаю потребление ресурсов будет увеличиваться вот если вы просто от Мишин контроллеры использовать не знаю мне кажется сильно не должно расти короче Так у нас к сожалению Ну давайте последний но очень быстро это время нос немножко поджимать начинает постараюсь побыстрее понравился доклад объяснение терминологии через мемы прям очень сильно зашло вопрос про с Профи кластер это Open Source решения Ты обманывался что вы немножко его допиливали рассказал про операторы если вводить это в компанию где еще этого нету Будут какие-нибудь страшные звери которые нас поджидают или это продакшн ради решения поставил настроил можно эксплуатировать смотрите То есть то что мы допиливали это по сути мы сделали как бы фулл сайфу оператор для векластера никаких как бы не за Open Ну как никаких существенных ни звука несовершенных допилок до самого кластер мы не делали там все нормально То есть как бы с чем вы скорее всего столкнетесь Первое это если вы будете делать платформу вам все-таки придется наверное сделать оператор Хотя вроде бы сейчас они сделали оператор совместимые с кластерапию Вот Но проблема в том что там под капотом всё равно холмчат То есть это не какая-то Супермен Enterprise история но всё равно типа виртуальной кластера у вас будут просто их нужно будет как бы чуть больше руками и вы Вот точно столкнётесь с тем что вам какие-то плагины нужно будет писать но скорее всего просто в какой-то момент обзаведётесь там необходимым количеством плагинов которые сложные плюс на самом деле у вас Ну вам же не обязательно если вы на отдельных кластерах живете то Вас в любом случае инфраструктура уже не шерится и поэтому никаких критических вот потерь от переезда кластера у вас не будет и потенциально Потом можно будет добавлять эти плагины и соответственно какие-то операторы переиспользовать Вот Все понял Спасибо большое"
}