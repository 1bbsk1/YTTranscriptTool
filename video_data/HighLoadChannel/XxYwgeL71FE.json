{
  "video_id": "XxYwgeL71FE",
  "channel": "HighLoadChannel",
  "title": "Архитектура Warface: удержание нагрузки десятков тысяч подключений / Алексей Капустин (Allods Team)",
  "views": 607,
  "duration": 2481,
  "published": "2023-01-19T05:55:17-08:00",
  "text": "всем привет надеюсь вы не подустали под конец конференции так как известно что все самые интересные остается напоследок не такое интересное как они анекдоты про pin суеты в соседнем зале конечно но как мне кажется тоже ничего сегодня я хотел бы представить вам свой доклад архитектура варфейс как одна из новых полярных российских игр держит нагрузку десятков тысяч подключений сегодня мы поговорим в основном про серверной составляющая точнее проеме таким часть это прокачка покупка-продажа but i'll pass и винты ачивки и подобное но также немножко затронем и игровую сессию рассмотрим общую архитектуру используемой технологии как мы масштабируем различные сервисы удачные и как принято политкорректно и говорить решение которое оставляет желать лучшего так же отдельно поговорим о работе с игровыми консолями но для начала немного проекте вас есть это бесплатный онлайн фритуплей шутер выпускается на все основные игровые платформы в том числе и на nintendo switch кстати это первая игра на одесский окраин шин в мире которая вышла на свеча игра не новая в разработке более 14 лет вроде более десяти лет вот в апреле праздновали 10-летний юбилей в игре сейчас во более семидесяти девяти миллионов регистраций каждый день в игру играет сотни тысяч людей а каждый месяц миллионы аудитория игры по всему миру особенно популярна на пока она а странах снг а на консолях наоборот более популярна в сша и странах европы ну а теперь перейдем к архитектуре у нас есть клиент игры запущенные на одной из платформ после запуска клиент идет к нашему сервису выбрал римма ярилом ему отдает список наших и джей приди и кластеров после этого пользователь осуществляет свой выбор какому именно кластеру подключиться на данный момент напротив мы отключили эту возможность и так как мы все среди в один большой сервер в один большой орел а но для целей разработки очень удобно список использовать список фильмов так как после запуска клиента можем выбрать какому стенду именно подключиться микс боксе все обстоит чуть сложнее на об этом мы поговорим ближе к концу презентации мы используем jabber для общения с нашим а мета-гейм бэг-энда также мы используем же гордо статусов для чатов nuby всего от того в чем он реально хорош уже вера есть некоторые проблемы с безопасностью особенно не в самых актуальных его версиях в частности он не слишком устойчив к the common in the middle поэтому мы используем изрядно запатчены jabber в основном в аспектах безопасности ну джавер написан на таком замечательном языке как первак найти на рынке условного sharpies то сознанием эрланга этом не тривиальная задача но не все общение с нашими серверами происходит через шага иначе это было бы слишком медленно в рамках игровой сессии у нас происходит общение с нашим игровым серверам он же 3d кредит сервер и он же в просторечье дедик напрямую дедики у нас запускается по всему миру в сша азии и европе расти и так далее чтобы расстояние между дети com и игрокам было наименьшим в целях уменьшения пинга для создания наиболее приятно опыта игры рассмотрим же чуть подробнее игровой сессии что такое дети к дезик это специальные версии игры собранные с определенными define a mi например в нем отключен render так как он на сервере нам очевидно не нужен при помощи дети к игроки узнают актуальную информацию о состоянии игрового мира о передвижении других игроков и разрушения объектов и и так далее а так как клиент игры могут вноситься модификациями в частности читерами так этих является истиной в последней инстанции в плане обсчета игровой логики он позволяет ощутить обмен информацией между игроками предположим у игрока в процессе игры pink около 100 это в принципе стандартный более-менее pink для игрока отправляется запрос на наш дедик запрос приходит обратно туда сюда прошло 200 миллисекунд время на обсчет опустим и только спустя 200 миллисекунд можем отобразить информацию о совершенным игроком действия это долго и у игрока игра будет выглядеть лагающий и игроки будут ругаться и не играть в нашу игру поэтому мы используем различные механизмы компенсации задержки но не все так просто играю во многие популярные современные онлайн игрушки такие как call of duty и battlefield и подобные вы рано или поздно столкнётесь с тем то что игроки телепортируются выстрела и регистрируется предмет игрового мира могут вести себя странно это как раз происходит вследствие рассинхронизации состояния клиента и дерека и тогда дико и это и происходит из-за несовершенства механизмов компенсации задержки но на самом деле эта тема для отдельного большого доклада мы используем один денег на одну игровую сессию мы пробовали переиспользовать дети кино много игровых сессий но огребли достаточно большое количество проблем с тем что у нас предметы игрового мира после завершения сессии не до конца чистит свой state а шарит его между игровыми сессиями чего конечно не хотелось бы поэтому мы приняли волевое решение несмотря на некоторые вверх от на запуск и завершение работы сервера и запускать 1 т тег на одну игру но вернемся к нашей архитектуре к нашему метагейма после того как сообщение прислала jabber она уходит на наш rifle где происходит некое бизнес логика логика обсчета рассмотрим подробнее архитектуру этого дома у нас имеются наши сервера метагейм логике нашей основной бизнес логики а у нас имеется сервера матчмейкинга некоторый набор веб-сервисов набор специфических консольных сервисов сервисы между собой общаются через rabbit в качестве базы данных мы используем москаль смешном виде memcache интересная особенность агент его является тот факт что количество запросов на чтение и на запись зачастую сравнимо использование каша в таких условиях вызывает определенные вопросы поэтому мы стараемся использовать кэш только на запросы с очевидным преобладанием чтений например для чтения игровых ресурсов игровых параметров из нашей базы данных для управления сервисами мы используем сам описанную систему которого умеет запускать поднимать деплоить мониторить сервисы и так далее по поводу технологий наши сервера бизнес-логики написаны на шарпе 5 dotnet серра матчмейкинга аналогично а для других мой мелких сервисов мы используем питон иголка для разработки номер новых сервисов мы используем следующие идеологию если мы знаем что сервис получится достаточно большим с большим количеством логике там условно больше тысячи получат тысяч строчек кода мы используем шерпы если мы знаем что сервис получится маленький на несколько сотен строчек кода мы используем гонг как вы вероятно заметили некоторые квадратики у меня выделены зеленым это не просто так квадратики которая выделена зеленым мы умеем масштабировать этой стерве скрыты затем квадратики масштабируется рассказывать про масштабирование джаггера не слишком интересно так как он умеет масштабироваться из коробки расскажу про масштабирование серверов нашей метагейм логики и матчмейкинга мы распределяем наших игроков между серверами на основании режима игры уровня а также загруженности серверов то есть игрок приходит на нас жавер jabber смотрит на список серверов которые подходят этому игроку и на определяет среди них наименее загруженный и отправляет игрока на этот сервер игрок может находиться в стане попечение только к одному такому сервер сейчас существует три основные уровневые группы игроков на основании их уровня прокачки эта группа новичков группа средних игроков и группа профессионалов игроки с различных уровней вы групп не могут играть между собой это решение на уровне геймдизайна иногда это создает нет некоторые не очень приятные казусы например игроки 25 и 26 уровня не могут играть вместе а игроки 26 и 27 уровня могут вместе играть без проблем то есть мы запускаем много инстансов таких серверов мы делаем один из такого сервера примерно по 1000 человек онлайн а для игрока характерно регулярная смена сервера то есть предположим игрок играл играл играл в пол и я и захотел пойти играть в в и у него сменился сервер игрок прокачался с новичка до среднего у него сменился сервер по каким-то причинам упал сервер он автоматически переключился на другой сервер перри разработки важно учитывать этот аспект чтобы избегать неприятных багов и неприятных гонок например игру выполняется какая-то тяжелая операция на сервере которая не транзакционные состоящая из нескольких этапов и в середине на япе этой операции игрок берет и переключается на другой сервер операция до выполняется на старом сервере но игрок уже находится на другом сервере из этого состоит сделать два вывода первое по возможности не делайте не транзакционные операции но если все-таки такая необходимость возникла та не жалейте некоторого вверх это на дополнительной валидации это позволит вам избежать очень неприятных редких и трудно отлавливают багов а теперь рассмотрим матчмейкинг мы используем один сервер под каждый уровневого группу аналогично мастер сервером однако в отличии от мастер серверов мы не умеем горизонтально масштабировать матчмейкинге то есть у нас реально по одному сервису на каждый уровневую группу матчмейкинг у нас ранее была написана на питоне что создавало нам некоторые проблемы производительности особенно в часы пик эту проблему нужно было как-то решать поэтому мы во-первых переписали наши матчмейкинг питона наш р.п. это его ускорило а также позволило уменьшить кодовую базу путем образования шарят кода мастер серверами но это еще не все также мы научились определять так называемых твинках в игроков некоторые игроки которые уже играли в нашу игру создает новые аккаунты и играю с новичками играет они зачастую намного лучше чем новички и это создается неприятный опыт игры новичка мы детектив таких игроков и если нам позволяет онлайн с лаем их в отдельную очередь однако если она могла не позволяет например ночью-то такие игроки все равно играют вместе с новичками потому что мы стараемся соблюдать баланс между временем сбором мочи и качеством опыта игры ну никто не будет ожидать по десять-пятнадцать минут пока у него матч соберутся пока мы найдем нужное количество твинков и все такое так же мы масштабируем матчмейкинг путем геймдизайна как я уже говорил недавно варфейс праздновала 10 лет и все с этого мы запустили внутриигровые mind новый режим новые карты раздавали подарки и все такое вот этот ивент мы сделали отдельный матчмейкинг отдельные очередь куда идут игроки это снижает нагрузку с наших основных сервисов мы также используем от различные режимы игры которая сезонные например подранка отдельный incense и матчмейкинга это дешевле чем переписывать архитектуру и игрокам совершенно незаметно и не доставляет дискомфорта подведем некоторые общие и только трасик туры крем обладает достаточно высокой отказоустойчивостью если у нас начнут падать наши сервера бизнес-логики то игроков просто будет переключать на другие сервисы если там откажет некоторые другие сервисы то игрок скорее всего этого не заметит также он обладает достаточно высокой на груза устойчивостью то есть мы можем запускать много серверов наши метагейм логике не испытывая каких-либо трудностей однако есть несколько точек отказа если там падает то у нас ничего не работает очевидно это jagwire и очевидно эта база если у нас вдруг то по каким-то причинам падать жабер то все плохо ничего не работает проект обладает достаточно большой кодовая база и только серверная часть занимает более 400 тысяч строчек кода мы проекты для всех платформ собираем из одного большого мода репозитория как мы этого достигли в рамках разработки сервисов наши метагейм логике мы а точнее их интерфейсов мы руководствуемся подходом то что метод должен отвечать на вопрос не то как именно он это делает а что именно он делает например метод получения баланса на различных платформах очевидно будет иметь различную имплементацию на пока одну на playstation dragon иксбокс отвечу но сама идея и возвращаем результат будет одинаков и поэтому мы на старте сервис сервера определяем набору запускаемых сервисов и дело подставляем конкретная имплементацию в этом нам и помогает такая замечательная библиотека как inject очень удобно и deep in dc jack таро так было до 2021 года но в 2021 году мы решили объединить все наши консоли сервера в один большой сервер чтобы игроки могли играть между собой в рамках кросс player то есть даже игроки с nintendo могут играть вместе с игроками с playstation при разработке консольного сервиса мы руководствовались аналогичной в принципе так же у нас есть некоторое количество консольных сервисов которые не слишком вписывается в логику общего метагейм и поэтому они сделаны отдельно рассмотрим парочку из них microsoft в требник сертификации игр указывает то что для общения с нашим сервером должна использоваться исключительно их имплементация websocket off для других же платформа используйте себе это не было нам неудобно мы не хотели переписывать наш сервер и делать какие-то к ставим и поэтому мы разработали отдельный сервис как который которому подключается игроки секс бокса и этот сервис перекладывает обойти киса websocket connection а в обычной эти хиппи connection и байтики по тисе пи кан экшену уже текут дальше на я джон бардин и дачная логика происходит аналогично другим платформам для клиентской библиотеке мы используем looks gux из коробки не умеет работать с microsoft узким сокетами да и вообще по он написан на чистом си поэтому нам пришлось его запасе чтобы он умел такое делать однако вот такой случай платформенные спич отличный сервис достаточно редок обычно мы стараемся делать универсальный сервис под себя платформы даже несмотря на некоторые различные ос их специфичные аспекты пример такого серые сервиса кошелек кошелек отвечает за взаимодействие с консольными стороны то есть он получает список паков он умеет продавать эти паки он отвечает за ари фонды и фонды есть на всех платформах несмотря на то что платформа держатели и документация иногда заявляет обратное так как ри панды например могут начисляться в при службе поддержки несмотря на то что опять таких споров содержат такие крупные компании как microsoft sony nintendo и казалось бы там все должно быть круто классно ведь их сервисами пользоваться к куче игроков по всему миру но на самом деле не все так просто было не так давно история в том что опять одной из платформ сломалась игроков после осуществления определенной последовательности действий грубо говоря возникали бесплатные и безлимитные деньги игроки это нарушили и накупили намного миллиардов внутриигровой валюты всего чего такое можно дело естественно проистекало глубоко ночи по москве и мы не сразу это не заметьте нам доставила некоторый боль потом мы искать таких игроков и отнимать у них на куплены на будущее мы учли этот момент и теперь не так слепо верим таком моя пей если подобная ситуация повторится то мы будем к такому готовы также интересной особенностью одной из платформ является и тот факт что в 2022 году там отсутствует лимита на запросы копий как на уровне к документации так и на уровне реализации это звучит забавно но некоторые из игр насколько мне известно скажем так пробовали проверять эти лимиты что привело к частичной потере работоспособности онлайн сервисов по юридическим причинам я не могу упоминать какие именно платформы хорошие какие плохие ты как говорится в некоторых американских фильмах все совпадения и склеить опять исключительно случайно подведем вывода отметим интересные моменты которые вы могли извлечь из моей презентации масштабировать можно не только путем горизонтального или вертикального лечения мощностей а также путем геймдизайна это зачастую за значительно дешевле чем переписывать архитектура стоит стремиться к универсальным консольным сервисом так как городить каждый сервис под каждую платформу это достаточно тяжело ну и по возможности не переизобретать и кубер мы намучились достаточно много с нашей системы управления сервисами мы тратим достаточно много ресурсов на ее поддержку и в дальнейшем хотим на ее отказаться и перейти на что-то более современное ну что ж на этом мой доклад подошел концом спасибо за внимание буду рад ответить на ваши вопросы ну ты зажег я прям вот за такие подробности смочены так подожди пока все разогревается есть право таксует 2 вопроса расскажет страшную тайну почему вы все так любите плюс явные почему я его люблю а почему вы так а сельхоз это основной язык разработкой клиентской части игр в частности о на нем написано край энджин на нем записано анриал джон и многие сервера особенно раньше тоже были написаны на си плюс плюс это делалось например чтобы образовать большую базу шарят кода это действительно удобно в некоторых ситуациях 1 до в современных играх уже сервера не так часто пишете на си плюс плюс потому что это больно тяжело и не не настолько удобно да и по производительности например шарфа уже во многих случаях не настолько уступать писан да и попробуем тогда дальше спросить а это понимаю что шарфы на серверах будут развиваться и дальше я понял опять и sharp и на серверах будут продолжаться дальше развиваться также активно и например компания microsoft использовать такой фреймворка как arlans и и мы на новых своих игровых проект тоже его используем это вот вообще последнее ну практически последнее слово геймдева использования orleans для разработки игровых серверов ни один вопрос я пролью слышал orleans а я тебе помочь поводу это круто спасибо за доклад мне вот вообще как незнаком с генералом было интересно подробность что происходит по ту сторону спасибо что поделился и вопрос получается на самом деле пару вопросов я так понял что у вас игроки на одном сервере получается они в рамках игровой сессии лера барокко к вам как мочало руках игровой сессии они всегда будут на одном сервере для вас не может быть такого прост на сервер на взаимодействие нет и это не требуется так как у нас игровая сессия не предусматривает больше чем несколько десятков игроков например в той же call of duty или в той же battlefield очень редко бывает сыра больше чем на ну сотню-другую игроков и ну такой перформанса один сервер вполне можно вывести таможни вклинюсь а battlefield вроде там 150 человек в одну катку можно ну да они заморочились оптимизации но в целом теоретически можно увеличивать это количество игроков но overhead она межсервисный взаимодействия мне кажется будет достаточно высоким так как нам игроку нужно сообщать что происходит сейчас в игровом мире если мы еще будем туда-сюда ходить между серверами а только потом игроку сообщать что сейчас происходит игра будет работать мягко говоря неспешно это интересненько ну может быть конечно в дальнейшем будет разработан на какие-то очень крутые механизмы компенсации задержки с учетом мир серрано и взаимодействию но это мне кажется дело не завтрашнего дня все перепишем и т.п. подождите стоп безусловно крутой вопрос хочу зачищал кого нить есть вопросы да этим мы попробуем ходить и задавать вопросы в мы все вернемся никакие один вопрос не только маленькие ты вклинился можно хорошо чуть чуть поближе к микрофона . да конечно что послужило вообще для вот такого решения что разделяет по платформам то есть власть бокс playstation письмишко отдельно в общем и каждый для каждого реализации два основных в этом момента во первых на пока я думаю не секрет что присутствует некоторое количество читеров мы с ними активно боремся но к сожалению искоренить их совсем 0 не удается на консоли же количества читеров стремится к абсолютному нулю и поэтому мы пока что не хотим объединять игроков она пока я на консоли в один большой сервер и скорее по этим причинам однако в дальнейшем мы такого не исключаем почему мы изначально разделяли игроков и на xbox на предстоящей на switch то тут скорее по историческим причинам когда мы выпустили первую консольную версию еще никакого свеча толком не было он еще не был настолько популярен и по моему был только анонсирован и только потом мы все это решили обвинить то есть разделение на консоли была обустроена историческими причинами осенние на сервов на пока я консоли скорее день дизайнерскими руки кто следующий пусть кто не зачитает вопрос из чата е.а. онлайн куда смотреть вот так то ноги да да тебя хорошо слышно из за попку и соответственно в разрезе не очень понял последнее часть вопроса маркировку это взять все обновляться где то вы можете там условно говоря например смотрите вопрос такой в какие моменты вы можете в разрезе вашей архитектуры обновлять сервисы именно не требуя задержки у пользователя таймаут на обновления их клиентов где вам приходится все таки это делать в разрезе платформ и в разрезе ваших слоев расти туры доджа братом или после некоторые наши сервисы как правильно заметил можем обновлять bios downtime а нягань актара сервисов к сожалению требуется данте сервера нашей бизнес логики мы можем обновить без downtime так как мы выключаем сервер старая версия сервера запускаем новую версию сервера и игрока автоматически между ними переключает мы кстати так иногда делаем но некоторые сервисы например который существует в единственном инстансе такие как например прокси мы к сожалению без downtime обновлять не можем но в целом мамы как правило не заморачиваемся на такие моментами если в игре не существует каких-то прям критичных баллов например если мы после релиза спускаемся обнаружили что у нас все плохо всё разнесено игроки начисляется бесплатные деньги если такое и поэтому мы обычно просто проводим мы регулярно 1 недели две-три профилактику где обновляем все наши версии сервисов до актуальных в разрезе xbox здешнего и так далее а затем действуем на пока и на платформах аналогично спасибо за вопрос следующий вот тут много он смотрит он добрый вечер у меня вопрос по поводу задержки вы сказали что стандартная задержка в играх сейчас около 100 миллисекунд до в один конец вот вопрос во первых о каких платформах вы говорили кажется что это очень большая задержка нормально там если это локальный сервер а у типа в россии то в районе 10 во вторых это только сетевая или общая вам мы рассматриваем именно только сетевой задержка там некоторые вверх от на обработку мы не опускаем понятно и как бы тогда вопрос почему она у вас такая большая и вы больше вкладывайтесь в снижении латинские или в prediction действий игроков чтобы компенсировать эту от нас а еще мария вкладываемся в более хитрый механизм синхронизации между клиентом и сервером например моих производим мне прям регулярно на каждое действие с некоторые более редкой периодичностью но на самом деле я понимаю отчего до возник такой вопрос для игроков из москвы казалось штампинг больше десяти уже ужас но у нас игроки играют по всей стране в сибири во владивостоке и в другом регионе и но я абсолютно в каждом городе мы не можем поставить по серверу на котором запускаться и как показывает наша статистика многие игроки играют с пингом 100 и выше и на самом деле если они не прям киберспортсмены то для них это вполне комфортный уровень задержки ночь очевидно чем ближе игрок сервера чем задержка мерча и например для игроков в москве если ошибаюсь в сортами такая задержка будет минимальна например на наших киберспортивных турниров которым мы проводим достаточно регулярно мы используем локальные сервера и то есть на таких локальных серверов задержка вообще очень небольшая но для большинства игроков как показывает наша практика такой pink более чем приемлем вдовой колено рядом давай в эту картину паскаль звезда близости от микрофона подскажите почему jabber такая не самая распространенная технология и это из исключительно из-за большой истории проекты или она чем-то дает кит преимущество но сейчас вы как расценивайте это как какой-то технический долг скорее или все хорошо с main танцем с новыми linux вами вот как это в целом на самом деле я считаю то что джабир он незаслуженно забыт jabber он проверен годами он выдерживает очень очень прям большие нагрузки без особых проблем он имеет круто скейлится в нем пофикшены и большинство богов большинство но в актуальных версиях большинство проблем с безопасностью и если вам не нужно переслать например какие-то бинарные данные видео тексты подобного а нужно переслать только текстовые сообщения то это на мой взгляд отличное решение сейчас конечно присутствует более современные аналоги например мы могли бы использовать кафку но мотивации переезда на кафку я не вижу джопер работает круто джаггера выдерживают в большой производительности без проблем сказаться как бы зачем трогать то что прекрасно работает но в свое время проект начинался ну в конце нулевых годов это была очень популярная технология его использовали facebook он до недавнего времени используя воцап и другие крупные корпорации я не рассматриваю это как этих долг я рассматриваю как это интересную особенность и ничего плохого в ней не вижу переписывать просто исторических причин но в том числе но я считаю что переписывать ради переписывания чтобы у нас было технологий там не более старого больного ну а зачем поэтому так и ответим хотим еще один вопрос спасибо вот вопрос по поводу cross-platform и получается как я понял информации от клиентов стекается нади тикеты сервер на котором запущено своя версия клиента там она по приоритетам но рассчитывается или клиентам отправляются обновленные данные и так вот в ситуации когда там один человек играет с клиента спк другой играет там с playstation получается информация от них стекается надеть кеты сервер на котором запущено допустим но покрашенная версия клиента вот не может быть расти и расти наклона между покажешь на версии клиента на этикет и сервере и версии клиента на x а вот тут есть конечно нюансы физики этот сервер не обладает платформе ностью она собрана со специфичными deploy нами которые вырезают платформенные особенности например какие-то особенности рендера которая характерная для некоторые платформ и некоторые осознанно и понижение графики которая характерна для свеча вследствие слабого железа там не присутствует и логика дидрике эти сервера она не платформенная она абсолютно независимо от всего и то есть игроки с различных платформ не испытывают никаких проблем и мы не пишем специальной версии д дико под каждой из платформ но также важно заметить что игроки спока с консоли у нас на данный момент не играть вместе а нет физика абсолютно одинаково на всех графика может отличаться например а физика нет вот давай вот он ближе географически чуть-чуть спасибо большое спасибо за интересный доклад вопрос у меня вот такое какая максимальная задержка у вас при обработке пользовательских данных и про водителей в стресс тестирования перед выходкой нового релиза максимальная задержка пользовательских данных у нас есть тайм-аут ну после которых соответственно запросы не проходят я не помню точные значения но это что-то в духе 1 2 секунды если запрос выполняется больше чем одну две секунды он отваливается по таймауту по поводу стресс тестирования у нас присутствовать некоторые тестирование при помощи нагрузочных ботов что такое нагрузочные боты нагрузочным вот это некоторых адрес клиента в котором вырезана очень много из клиента и которых мы можем запускать все локально очень много на нашем компьютере и таким образом проверять нагрузку и они дергает опять они дергают сервис и они дергают методы нашего римма и таким образом мы выявляем проблемы чтобы они не пока те весь вес кроме этого у нас очень большая команда тестировщик в которой а также все дополнительно проверяется ну и конечно куда ж без автоматических тестов под прошлом гора клади говорилось про 2 700 тестов у нас к сожалению только на сервере бизнес-логики более 5 тысяч тестов и покрытие недалеко от 100 процентного мы постоянно пишем нога тест спасибо это тоже интересный момент не так задал вопрос сколько времени вам надо для того чтобы обработать запрос пользователя отдать ему обратно при этом получить точки расположения всех других игроков просчитать рассчитать вы говорите именно оба игра вася да именно об игровой сессии об игровом процессе приз а вот этот вот тег который проходят вступая запрос проходит тихо вы отвечаете кто где находится кто что сделал для получил сервера усердно у игрового движка точнее есть такое понятие как текке раз в какое-то количество времени она достаточно небольшое состояние игрового мира актуализируется у него присутствует некоторый state сколько один тип на память не помню но это мало значительно меньше секунды и когда клиент приходит к нам с запросом а что же у вас происходит в игре мы отдаем ему текущей стоит мы не обсчитывает его на ходу мы просто отдаем текущей сохраненный state которая у нас есть на сервере используете нет я предложил использовать для этого и деяния не дискуссионная зона это реально уже начинается разговор и не вопрос я просто могу рассказать потому ногам мадам дискуссионную зонам пожалуйста следующий вопрос здравствуйте и спасибо большое за очень интересный рассказ а вот скажите пожалуйста в бэг-энд на шарфах там ведь управляемая память garbage collector который может привести к ступице world как эти чары самому можно чуть-чуть поближе микрофон да у вас backend на шар потому управляемой памяти garbage collection которым может однажды до стоп зе ворлд стоит как вы с этим боретесь страдаете ли от этого мы практически от этого не страдаем у нас одно время возникала я такие проблемы но мы их синим настройками корабли же коллектора но особенность метагейм бэг-энда является то что если у нас например данные будет обрабатываться чуть дольше чем обычно там место 7 десятых секунды в секунду будет обрабатывать за цифрам ничего страшного просто пользователи дочь будет происходить покупка дольше происходить прокачка ничего там страшного нет ok спасибо большое за доклад у меня такой вопрос использовать и львы в алгоритмах матчмейкинга какие-нибудь умны эвристики механизмы на основе выбор на основе пинков клиентов которые хотят подключиться к серверу выбор геопозиции сервера то есть его локации моей но у нас прям чего-то такого глубокого на слово машины и ринга и каких-то сложных графов нету мы грубо говоря считаем локации наших игроков считая и пытаемся собрать группу игроков которые наиболее близко к данному клиенту если это сделать не получается спустя какое-то время мы начинаем расширять расширять расширять доступный регион для матчмейкинга и также расширять параллельно другие параметры такие как например скилл игрока его уровень и так далее пока не соберем матч отвечающие заданному условию изначально мы стараемся собрать наиболее лучший матч для него и приятного опыт игрокам но если у нас сделать не получается то мы сделаем опыту все хуже и хуже и хуже а пока матч рано и поздно не соберется то есть играть на самом деле приятнее всего когда много народу матчмейкинг работает лучше всего когда в игру играть много народа вашим потом еще один вопрос вижу чувак он подумает руку добрый день и спасибо за доклад вы упомянули вот интересное решение с restart om-d дико как я понимаю под игровую комнату интересно два момента 1 как быстро запускается и второй момент он стартует уже под конкретную комнату которая собралась ли вы генерируете некий пул этих самых дедиков и потом по мере надобности отдаете их игрокам мы на самом деле да я не упомянул это докладе мы заранее запускаем дедики и из предложенного пул дедиков мы предлагаем игроку какое-то конкретное вариацию если же в этом пути внезапно закончились этики доступны то мы расширяем этот пол таких случаях да действительно игрок может загрузиться в матче дольше но загрузка игрока в игру происходит достаточно долго это может занимать пару десятков секунд например за это время все что много успеть запустится вот она сама заднем ряду я вижу человеком он хочет задать вопрос такой вопрос а как вы осуществляете роутинг типы подключений то есть у вас что-то но написанное то есть на мышцы подключение происходит как вы потом на игровую серию владимира мне эту мощность побежим микрофона не очень понял вопрос у нас вообще какой pipeline подключения игрок игрок получает опере джаггера идет на jabber а заберу у нас идет куда там внутри далее информация либо же игрок получает но адресат этикета сервера и к нему подключается то есть какой-то сложной и разветвленной сети подключение нас нет проблем хоккей то есть через джампер все одно подключение дальше внутри уже уходите по своим сервисом да эти сервисы могут быть допущены например различные дата-центрах они могут быть географические распределены но мы уже там логика достаточно"
}