{
  "video_id": "_1GvvL2qLBo",
  "channel": "HighLoadChannel",
  "title": "Запуск заданий по расписанию на бэкенде / Андрей Зарубин (Райффайзен банк)",
  "views": 786,
  "duration": 2507,
  "published": "2025-01-17T02:18:48-08:00",
  "text": "Всем привет да давайте начинать Как меня зовут Вы знаете где работаете тоже давайте я расскажу немножко детали наверное о себе почему я рассказываю про эту тему и что собственно за тема А я в it через месяц Наверно буду отмечать юбилей 20 лет профессиональной карьеры с тех пор когда я когда-то между курсами в университете Устроился на свою первую работу я занимался разработкой всю жизнь сейчас руковожу командами когда-то стал первый раз тимлидом но в принципе всю карьеру я вокруг джавы когда-то начинал с десктопных приложений потом ушёл на энд разрабатывал mle и многое другое А да я люблю внедрять разные процессы перетасовывать команды но всё это ради достижения результата построения каких-то крутых IT систем я в том числе Да чтобы не быть совсем самозванцем я когда-то сертифицировать несколько раз по Джаве У меня есть сертификации по клауду по менеджменту То есть я стараюсь закреплять свои знания Ну и делиться Поэтому я здесь перед вами Вот ну и в целом как бы Несмотря на то что я являюсь руководителем направления сейчас в баке Ну и в принципе это уже не первая моя работа в роли руководителя направления когда ты руководишь некими конда Я люблю налаживать инженерные процессы делать работу эффективнее при этом участвую в хакатона В общем Развлекаюсь как могу что за тему Я сегодня рассказываю да возможно вы смотрели краткое описание доклада может быть Вам отзывается просто заголовок постараюсь чуть больше деталей набросить чтобы вы понимали контекст значит я дам непосредственно определение что Поу планировщиком Яре наверное важно поделиться своим опытом Хоть это и теоретическая секция к которой я отношусь но я постараюсь широту темы покрыть именно на основе своих примеров и своего опыта Да я работал в трёх банках как бы и Ну с планированием заданий в разных сферах сталкивался не раз а обсудим естественно решения Какие они бывают и значит какие в целом проблемы у использования этого паттерна на практике Да мы говорим в сфере именно на разработки каких-то коммерческих приложений с большой нагрузкой и будем обсуждать именно проблемы с каким мы сталкиваемся когда мы пытаемся сделать такое приложение надёжным используя паттерн из сегодняшнего доклада что сегодня не будет мы понимаем что любой доклад он в каких-то рамках находится в том числе временных я не буду хвастаться что я разработал свой планировщик заданий да типа ВС существующее не работает поэтому я свой написал жизненный цикл задания такая лу те есть воз отдельный планировщик про него можно большой про любой делать полуторачасовой доклад рассказывая Как там задания внутри живут меняют там фазы Луны и так далее сегодня не успеем бывает специфика хранения данных на самом деле в индустрии уже много планировщиков построенных там на монго на кассандре и от этого Они получают сво щества недостатки опять Тая с дела Наверное если вас заинтересует в целом то что я сегодня расскажу вы просто пойдёте и почитаете более специфическую информацию которая релевантно для вашей работы ну и производительность очень да субъективная тема сравнивать по производительности планировщики тоже на мой взгляд тема отдельного доклада возможно когда-то его тоже сделаю потому что практики для этого было достаточно но не сегодня а давайте начнём уже к теме значит что я называю планировщиком заданий планировщик заданий вообще для меня это такой как бы архитектурный паттерн Ну это такой самый древний поэтому А многие сейчас игнорируют А ну как бы вы Не найдёте страничку в интернете которая описывает паттерн запуск заданий по расписанию вот Хотя архитектурно этот элемент с нами наверное с середины прошлого века потому что всякие мейнфрейм системы и другие там компьютеры которые занимали целую комнату они по-другому и работать Не умели они обрабатывали какие-то вычисления пачками обычно и эти пачки запускались по расписанию Поэтому планировщики с нами давно Ну и ещё Понятно планировщики понятие растяжимое да В каждой операционной системе Как вы знаете есть планировщик мы сегодня не про это мы сегодня про именно старую добрую разработку энтерпрайз приложения на бэнде И как мы там нашу бизнес логику оборачиваем в задание и запускаем по расписани поэтому любой планировщик на мой взг есть в принципе англоязычная страничка в Википедии которой я вдохновлялся но я сформулировал по-своему планировщик заданий На мой взгляд состоит из нескольких компонентов главный компонент - это фоновый процесс То есть вы задание запускаете не в главном потоке То есть если вы написали программу которая постоянно ждёт что-то срабатывает ждёт срабатывает но это не совсем планировщик планировщик - это вспомогательный компонент в котором есть фоновый процесс для запуска естественно есть для запуска Ну в широком смысле Да не обязательно сервис или значит Библиотечный IP Да может быть cli о котором мы тоже поговорим тоже может быть вполне I А мы говорим про Enterprise мы на конференции H поэтому мы держи разрабатываем поддерживаемые решение нам нужно для мониторинга Да мы не просто типа написала в прокш да потом за этим надо следить поэтому а для мониторинга в сегодняшнем докладе будет важным компонентом и не обязательный компонент но который часто присутствует если у вас специфическое решение для запуска заданий по расписанию чаще всего у вас есть какой-то там кокпит такой operational UI в котором вы можете смотреть как выполняются ваши задания Какие закончились с ошибками перезапускать задания и многое другое это не обязательный компонент Да мы будем говорить в том числе что бывают очень хорошие программные библиотеки без пользовательского интерфейса но приятный бонус где мы применяем планировщики заданий нуте ру применяют планировщики заданий вообще в своём коде Отлично я и ожидал Ну я на всякий случай сумарин значит э пакетная обработка Да не не пакеты В смысле пакеты а пакеты В смысле Когда вы задание объединяется в пачки а сейчас чуть буквально через пару минут приведу пример э ну обычно если у вас взаимодействие нескольких систем часто бывают какие-то нефункциональные требования что вы не можете там в риал тайме все сообщения передавать дальше вам надо их накапливать Когда вы их накапливает вам Поня когда же передать дальше когда же передать дальше самое простое периодически периодически у вас возникает планировщик заданий вот поэтому мы там используем в такой же ситуации У нас может возникать потребность в тях То есть вы накапливается отправляете следующую систему она вам возвращает ошибку Ну что нужно делать наверно повторить повторить Через сколько Наверно через фиксированное время опять приходит на пой добры планиро заданий э знакомы с термином Event driven architecture да о том что типа у вас события должны максимально летать по системе Но на самом деле под капотом там тоже есть планировщики задания которые всё-таки накапливают делают какие-то откладывания вот эти Ну по сути дела две предыдущие вещи делает А и Ну во многих системах вы в какой-то момент там соприкасается с Legacy которые вот не готовы и опять же возвращаемся к старым добрым паттернам которые я рассказал и использованию планировщика наверно самое интересное да А в чём проблема Ну как бы планировщики они прикольные как бы берёшь внедряет вот проблема такая экзотическая с которой я сталкивался на нескольких местах работы это часовые пояса а возможно сейчас менее актуальная тема да мы все у нас тут всё вообще да есть разные часовые пояса мало того что они у вас на узлах должны быть примерно одинаковые а в некоторых часовых поясах есть всё ещё такой термин как летнее время да в России мы от него отказались А в Европе и США например до сих пор есть и как могут летнее время сломать вам логику построенную на планировщике А легко значит Представьте если у вас задание выполняется Раз в час вам надо Быть готовым что один раз в год оно выполнится 23 раза а один раз в год оно выполнится 25 раз Да если например вы Раз в час начисляется проценты по счёту то наверное это приведёт к проблемам Да и вам надо об этом заранее задуматься А самое главное что у вас скорее всего и ваши тестировщики Это не выявят потому что это реально два раза в год происходит а другой момент что например в той же ситуации если у вас задание выполняется раз в сутки например и именно в те в те часы Когда время переводит то Будьте готовы что у вас оно какой-то день в году не запустится или запустится два раза если вам совсем не повезло вот поэтому такой интересный нюанс Я у ставлю себя на первое место потому что ну за карьеру много граблей собрал на этом Вот И хотел с вами поделиться во-вторых длительные задания надо понимать очень часто возникает мы опять же на конференции H у многих планировщики под большой нагрузкой выполняют задание очень часто и классическая проблема - Это что Если ваше задание начинает превышать интервал между запуска задания вам об этом надо задуматься на этапе проектирования системы потому что ну выхода два да либо Ну может быть даже больше чем два Да самые простые - это типа игнорировать Да и просто запускать следующее задание если вот вас вам надо жёстко по времени запускать значит ну как-то закончится предыдущее новое начнётся будет нахлёст либо у вас планировщик теряет перманентный интервал между запуском и просто предыдущее заканчивается следующее начинается это тоже планировщик моей интерпретации просто вам надо понимать что А в задании вам уже нельзя завязывать на на то что время старта будет фиксировано распределено по времени Ну наверное есть другие варианты там целить задания ещё что-то делать но тем не менее А когда я эту тему В принципе обсуждаю там в рамках нетворкинга всплывают иногда очень экзотические темы когда люди там какой-нибудь вакуум в постгрес делают по расписанию и А даже если у вас был какой-то конкретный кейс и Казалось бы ну в чём проблема Ну имейте в виду что э в жизни для чего только люди Не используют планировщики значит синхронизация времени в принципе я упомянул когда говорил про часовые пояса в принципе у вас на серверах наверное уже время синхронизируется Одним или другим способом есть когда я работал в международном банке я сталкивался с тем что регуляторы в некоторых странах например от банковской инфраструктуры требует что там время на буквально миллисекунды отличается между серверами но имейте в виду Да если у вас там на 5 минут отличаются времена на серверах а задания запускаются там с мину у вас проблема Ну и тестирование да про тестирование сейчас отдельно поговорю имейте в виду что если вы как разработчик Да во время проектирования системы решили затащить планировщик то вы своему тестировщику создаёте лишние проблемы Какие конкретно Да значит Ну сначала до того как вы отдали всё в Наверное вы это покрывается тестами тестами какой юан наве поете зада пото быть как бы маленький скоп вот или вообще кусочки задания И это всё хорошо Да вы при этом значит ещё не знаете как будет себя вести ваш код задания Когда вы его начнёте запускать по расписанию Когда Вы начинаете запускать по расписанию у вас Появляется такой тест начинаются все приключения с тем что Вы наверное хотите тестировать в продакшн конфигурации но в продакшн конфигурации Например у вас задание запускается раз в сутки да Вы наверно не хотите автотест запускать только раз в сутки потому что в остальное время они не работают даже задержка тайм-аут 5 минут Да уже как бы создаёт большие неудобства вот Особенно с точки зрения автотестирование наверное ручной тестировщик ещё подождёт 5 минут а на каждый реквест Вы наверное 5 минут ждать не хотите вот и что как обычно из-за того выкручиваются ну в идеале надо делать так чтобы у вас э интервал запуска мог быть снижен до нуля не влияя на поведение понятно это можно сделать не всегда Вот и второй выход к которому могут прибегать это если у вас такое полное уже ту тестирование как бы там всякими симуляция и прочими Ну вы можете использовать инструменты для фейкового времени да То есть вы можете на машине Точнее для вашему коду сделать вид что у вас там часы быстрее бегут да то есть 5 минут превратить в 5 секунд вот в принципе тестировщики там с большим арсеналом инструментов знакомы с этими шаблонами вот важно тестировать негативные сценарии имеете в виду что даже если вы используете готовый какой-то планировщик заданий проверенный значит который ваши соседи пользуют вот если вы не проверили что он будет делать когда ваши джоба упадёт с ошибкой значит вы его ну как бы вы ему не можете доверять в продакшене А тут надо понимать что ну негативные сценарии они всегда бывают да то есть у вас я не знаю вы написали код в котором не может вылететь не знаю исключение но он упал там потому что память на машине закончилась да и у вас допустим загнулся весь планировщик и вы такие в продакшене А у вас там типа ши Да каждые 5 минут что-то выполняется и дальше это на слоится на какие-нибудь неэффективные алёрты понятно что лучше это всё тестировать заранее то есть ну негативный сценарий Понятно самого кода который вы запускаете естественно надо тестировать и Как ведёт планировщик который вы прикручивается к вашему коду а важно тоже проверить как он себя будет вести вот ну и нагрузка Я сказал что мы сравнивать не будем но это не значит что о нагрузке думать нельзя нагрузке думать нужно Ну значит если у вас не раз в сутки какая-то легковес задача Ну кстати нагрузка тоже в двух может быть смыслах да у вас может быть Тяжеловес ная задача которая может положить ваши машину вместе с планировщиком А может быть нагрузка что просто из-за частого запуска значит ваш сценарий пойдёт коту под хвост вот а мониторинг Я сказал что Ну в реальной жизни Мониторинг - это одна из важнейших вещей Вот и мониторить я считаю планирование задание его можно с двух ракурсов во-первых У нас есть классические сре в классическом сре мы мониторим золотые сигналы Кто в продакшене мониторит золотые сигналы так два человека три отлично Ну хоть кто-то Давайте напомню Что такое золотые сигналы значит быстро да это четыре понятия значит задержка трафик ошибки и насыщенность насыщенность если кто не знает я вполне допускаю что люди просто термин золотые сигналы могли не слышать Вот насыщенность - это в смысле насколько значит полно ваши ресурсы используются Да что у вас там цпу зашкаливает не зашкаливает моё предложение интерпретировать просто эти золотые сигналы не как для какого-нибудь веб-сайта абстрактного А как для планировщика то есть какая у вас задержка между тем когда должна была запуститься задача и она реально запустилась сколько у вас реально заданий проходит через ваш планировщик Да если допустим у вас гибко в зависимости от логики может быть заданий больше заданий меньше вам надо мониторить потому что у вашего планировщика есть предел Он после какого-то количества заданий перестанет работать ошибки - Это примерно то же что я рассказал в тестировании негативных сценариев вам надо мониторить сколько у вас задач падает с ошибками Ну ну естественно сам планировщик не должен вам ошибки кидать Ну и насыщенность опять же если у вас планировщик близок к значит ээ краю ресурсов которые вы ему выделили наверное у вас будут а проблемы с запуском следующих заданий теперь когда я рассказал может быть ещё раз кто мониторит вот эти четыре вещи отлично больше рук Спасибо Да значит проблема с терминологии вот и это значит такая общая тема а не общая кастомная больше это из чего обычно состоит планировщик планировщик обычно состоит из узлов Да мы как бы сейчас вкратце рассмотрим что бывают планировщики на нескольких узлах и естественно их надо каждой отдельности мониторить на каждом узле у нас могут быть запущены несколько инстан сов Ну даже в одном ран тайме планировщика в зависимости от архитектуры бывает внутри несколько сущностей планировщика которые вывешивают свои какие-то значит параметры для мониторинга и за ними тоже нужно следить а у вас естественно в планировщика есть задания которые мы запускаем и ход выполнения заданий мы тоже хотим мониторить и у вас есть триггеры да вот это срабатывание задания - это тоже сущность обычно в архитектуре планировщика А в идеале их тоже мониторить вот теперь давайте перейдём к примерам Да из практики пример номер один - это я е назвал йт Это самый простой пример значит Представьте У вас есть трейдинговая система значит которой пользуются физические лица там есть виджет с новостями да вам на бэнде надо новости получать но вы не новостная компания вы новости берёте из другого сервиса Вот вы их скачиваете при этом у вас как бы почему так называется пример потому что AP как бы очень Дубовая В смысле вы в любой момент можете запросить любые новости и Вам их отдадут То есть Вам не надо там подписываться что-то ждать вы просто их там пере показы надо последние новости вот поскольку Дубова это суть этого примера поэтому Ну я предлагаю такую архитектуру значит сейчас объясню что имеется в виду ну у нас есть Клиенты это как бы наша система у нас есть кэш поскольку мы не хотим когда клиенту надо показать новости каждый раз ходить значит и переспрашивать новости у всех одинаковы поэтому Сва Дан можно планировщик На этой картинке Ну планировщик он на самом деле внутри бэнда этот пример самый легковесный из всех которые мы рассмотрим имеется в виду что ну в сервис мы ходим с какой-то периодичностью Да и тот планировщик который внутри бэнда будет триггерить эти вызовы загрузки новостей из сервиса он будет максимально легковесный и у вас будет код загрузки новостей тоже такой деревянный То есть если вы потеряли кэш Ну окей начали снова вот пример будет самый простой который будем апеллировать дальше два примера которы назвал естественно кор как бы противоположность предыдущему примеру это когда мы не можем забывать о текущем состоянии запуска вот типичный пример - это обработка платежей пример с позапрошлой работы Да вы вот должны послать платежи в следующую систему по пакетами их налива от это платежи реальные поэтому его нельзя забыть его нельзя отправить два раза Потому что если вы отправили два раза в следующей системе нет от этого защиты то Ну будет плохо как бы я думаю не стоит объяснять почему вот похожий пример из тоже недавней работы это когда у вас зарплатные клиенты да вам ваш корпоративный клиент регулярно присылает список своих сотрудников обновлени котом вы все получаете скорее всего зарплату на карто банка Да это везде одинаково устроено м значит ваш работодатель Когда вы первый раз например устраиваетесь да заказывает вам карту значит эти карты на стороне банка по спискам надо выпускать менее критично чем значит платежи потому что это нереальные деньги Ну они реальные В каком-то смысле потому что если вы Выпустите лишние пластиковые карты вам надо их будет утилизировать это деньги Если вы забудете выпустить пластиковую карту у вас клиент обидится тоже Вот и значит в этом случае планировщик он вылезает отдельно потому что Ну значит я здесь выделяю компонент что сервис мы получаем какие-то входные данные да те же списки сотрудников откуда-то У нас есть диспа который ходит в другую систему которая занимается выпуском карт мы накапливая списки сотрудников Уже в своей базе данных мы не хотим об этом забыть но при этом ус есть планировщик который бы сигнал диче Дат давай короче ходи Отправь очередную пачку на заказ Вот и по сути тут основная Разница в том что ну планировщик есть невидимая стрелочка между планировщиком и базой данных потому что вся эта логика она подразумевает что планировщик полагается на то что предыдущее как бы состояние отправки оно где-то зафиксировала если планировщик сдохнет то после перезапуска мы будем знать откуда продолжить вот дальше два таких нефункциональных я бы сказал примера что вы внедрили какой-то из предыдущих вариантов и у вас возросла нагрузка Да поэтому у вас как бы есть один цветочек да вам надо сделать много вот и для этого тоже есть подходящие решения о которых я сейчас расскажу Ну и четвёртый способ это такой чистый энтерпрайз да у вас есть код вы выкачивали откуда-то бизнес логику значит которая делает то что вам нужно Но так сложилось что теперь нужно запускать эту логику по расписанию вотт что чаще всего на помощь приходит готовая инфраструктура вы не хотите тратить время на дополнительную разработку и сейчас тоже посмотрим на варианты вот варианты значит начнём с самого простого у вас один сервер Значит вам нужно на нём запускать планировщик как вы будете это делать ну самое простое что приходит на ум - это крон Да как бы почти все сервера на юниксе на юниксе всегда есть крон Вот почему на примере крона разберу Почему я считаю это планировщиком значит значит в том определении которое я дал у него есть фоновый процесс Demon у него есть IP в виде C и Ну вот это опциональный UI значит Ну мониторить тоже естественно можно да кто кто не знает как мониторить крон Вот и есть в принципе сторонние UI То есть получается даже вот прям полное совпадение то есть опционально есть UI При желании можно его прикрутить Как тестировать крон нормального способа нет Обычно люди редактируют крон чтобы задание выполнялось сразу а потом возвращают обратно то есть чисто в прокш конфигурации тестировать неудобно Ну и мониторить ээ Вы можете мониторить поскольку Это стандартный сервис юкса вот или вы можете мониторить следы исполнения заданий часто паттерн к которому прибегает вы в коде заданий в конце ставите что-то типа А типа я сделяль да как бы а потом это где-то глядите что Ну всё сделано вот если вы на виндоусе Ну у вас тоже самое вот ну я даже детали вдаваться не буду Да там понятно что I по мелочи отличается но концептуально тоже самое если вы пишете на своём любимом языке программирования то у вас Что есть у вас есть в принципе цикл задержка и Ну почти в любом языке отдельный тред всё готов планировщик в три строчки но я если честно я не знаю кто-нибудь писал планировщик в три строчки когда-нибудь вот такое типа хорошо отлично Ну я тоже думал меня к сожалению не довелось потому что я на Джаве на Джаве как бы есть готовые классы вот я Мой первый планировщик был на основе класса таймер потому что п сервисом ещ не было Если у вас кот У Вас есть корутина на которых тоже можно построить планировщик вкратце Значит я не буду все языки программирования осматривать потому что опция наверху она есть везде вте тоже есть удобные классы значит в жава скрипте есть старый добрый се интервал есть который ещё в разработке например меня очень заинтересовало в процессе подготовки доклада как бы я думаю за ним будущее в принципе с точки зрения разработки планировщиков ноде и если у вас гос ру Вот с другой Роны есть Ласкер такой немножко специфический подход к построению планировщика но тоже можно да То есть вы можете своём коде написать свой планировщик Если вы допустим не любите или не хотите писать свой планировщик в вашем языке программирования любимом скорее всего есть библиотека почти в любом языке программирования есть обёртка над роном или над Windows см вот значит покуда ходить недо дава ритори на пайтоне есть либо на c+ Plus значит поскольку он как бы более низкоуровневый то я упоминал что наверно на c+ плюсе планировщик писать неудобно если у вас буймер Вы наверное скорее возвращаетесь к уровню простых планировщиков в других языках программирования вот на Джаве Если вы пользуетесь СН фрейр Вы любите sched Если кто в Джаве как и я 20 лет то вы знаете про Кварц и даже не 20 лет Но всё равно знаете про Кварц Я не знаю если кто-то кто вве не знает про квар люди знат про это было бы Неудивительно пото что есть он изначально появился в двух экосистемах есть вот есть в фреймворке есть врево есть в фреймворке вот pH немножко особняком стоит потому что подразумевается что в PHP вы Адепт одного из фреймворков на котором всё разрабатываете И там есть что Вам неудобно горизонтально масштабировать обычно из коробки эти решения не работают в чём проблема Точнее не проблема а как тестируется обычно решение на одном узле вы мока чаще всего как бы и добиваетесь вот этого эффекта что можно запускать задание мгновенно по сути вы как бы обратную связь Если вы доверяете библиотеке линга которую вы используете Вы можете её заменить на то что вам удобнее тестировать всю остальную вашу логику вот поэтому промежуточный итог значит решение на одном узле удобно использовать на простом примере решение на одном узле на более сложном примере можно использовать не всегда зависит от того есть ли у вас у готового решение о хранилище или нет потому что как я объяснял на архитектурной диаграмме хранилище - это важный элемент того примера горизонтально масштабировать сходу нельзя Ну и про готовую инфраструктуру можно говорить только в случае крона или Windows распределённые планировщики Да тоже самое ноже на многих узлах Мы хотим большую значит эффективность добиться от решения вот что можно значит делать можно предыдущее решение пытаться запускать на нескольких серверах к чему это чаще всего приведёт к тому что у вас начнут дублировать одинаковые задания как с этим обычно борются делают блокировку через какое-то хранилище самое простое через базу данных но возникает другая мера неэффективности что у вас Один узел работает остальные ждут поэтому есть как бы ещ один вариант это прибегает КК распределенным хранилищам или к планировщика там следующего поколения Вот какие в принципе решения есть в разных языках значит поскольку опять же я есть jav я постараюсь рассказать что ещё есть вот Windows сервере из коробки есть кластеризованный версия тасков Поэтому в принципе если у Вас кластер Windows серверов у вас всё есть из коробки если у вас ВС е КРЦ значит в или вте там есть ци в го есть такой планировщик крон вот я в детали не вда Но судя по документации он всё выше описано умеет вот ну и вве есть ещ это такой типа аналог кварца просто более современный но менее популярный вот когда распределённые планировщики применяют вот ну всё ещё работает на простом примере на сложном примере работат только если во-первых вторых она не приводит к конфликтам к дублирования и к прочему а горизонтально масштабировать естественно удобнее если у вас распределённый планировщик Ну про готовый код пока речи не идёт вот ну и Собственно как готовый код то запускать вот во-первых есть готовые инструменты вот два их на самом деле много если вы загуглите workload automation Tools там обычно такой десяток энтерпрайз таких дорогущий с этими двумя Вот про Ctrl M в двух словах это такой типа крон на стероидах которые ставятся в компании в одном месте и всем обеспечивает запуск задач по расписанию насколько вам это удобно Ну решать вам вот если у вас инфраструктура в кубернетес то на помощь вам приходит стандартный кастомный ресурс крон J всё что угодно деплоить в кубернетес прописывается крон выражения работает по расписанию плюс масштабирование плюс и так далее да вам только останется подумать что ваша логика написана адекватно Ну ино это типа что делать в клауде вот во-первых в кладах бывает Облачный крон пример из моего опыта Это я больше всего с Google кладом работал в своей карьере но в Google клауде есть Cloud sked тоже такой типа крон на стероидах который у вам из коробки есть в клауде есть ба сервисы aws wer есть соответствующие бач сервисы которые тоже могут вам обеспечить запуск задач по расписанию есть более экзотические сервисы типа Cloud Run в Гугле которые позволяет вам запускать контейнер и там тоже можно навесить будильник на него чтобы запускать по расписанию это наверное Ближе всего к жоб из предыдущего примера с кубернетес Ну и напоследок serverless в любом облаке Где у вас есть лямбды лямбду можно обвесить опять же будильником и запускать по расписанию соответственно готовая инфраструктура решает простые примеры со сложными у вас возникнут проблемы скорее всего Потому что это не персистентное решение чаще всего вам нужно делать свой обвес то есть о готовом запуске речи не идёт а значит вы естественно там сможете горизонтально масштабироваться в случае простых решений в случае сложных у вас возникнут тоже сложности Ну запускать что-то так можно вот поэтому это решит ваши вопросы поэтому А поскольку мы значит да по времени уже закругляйся о том что планировщики задания бывают Ну вот таких трёх типов я для себя выделил А у них разные немножко проблемы у одно Ну у любого планировщика есть проблемы со временем когда вы запускаете обычный планировщик на нескольких узлах у вас возникает дублирование Или простой А на готовой инфраструктуре Вы скорее всего во что-то упрётся Ну как классическая история с клау дом А когда вы тестируется много нюансов на одном узле про который я надеюсь вы запомнили Когда у вас несколько узлов надо во-первых тестировать а добиваетесь ли вы эффекта от того что у вас несколько узлов и вообще как себя ведёт система под нагрузкой Когда у вас там потенциально могут быть какие-то дата рейсы прочее Ну и негативный сценарий в случай нескольких узлов тоже рекомендую проверить и значит в случае готовой инфраструктуры у вас скорее всего Будут ещё инструменты тестирования многие облака их тоже предоставляют для мониторинга помните что я разбил мониторинг на две части типа классический S и специфический Хотя S тоже стоит интерпретировать в контексте планирования мониторинг на многих узлах у вас умножается вот в Облаке он скорее всего будет из коробки Ну и значит приме которы разб в случае простейших заданий без состояния их можно запускать Где угодно В случае запуска задания с состояниями у вас везде будут сложности поэтому Убедитесь что персистентность работает так как надо масштабироваться Можно только если у вас специфический планировщик который это поддерживает Ну а запускать по расписанию Можно либо на кроне либо в Облаке или в других способах которые я Перечисли на этом ВС СБО Спасибо А ну что ж у нас теперь есть матрёшки поэтому сейчас будет сложно вы задаёте вопросы я даю вам микрофон по одному вопросу на человека если у вас 10 вопросов то вот буду к вам возвращаться у тебя будет самая сложная задача именно тебе среди вот этого огромного количества вопросов нужно выбрать тот лучший задав который мы подарим матрёшку начинаем Андрей Спасибо большое Владимир сервис пап кибербезопасность очень интересный доклад ты пошёл от одной ноды там крон к распределённого планировщик мне хочется спросить про вот этот трешхолд когда идёт переход от одной ноды к распределённой системе то есть условно есть админ который может крон администрировать в каких масштабах команды или возможно Какое количество сервисов трафика или ещё какой-то метрики происходит переход к такому более сложному решению и кто за это будет отвечать за поддержку сложный вопрос Спасибо Владимир на самом деле я бы обобщил мне кажется тут нету специфических принципов Это как в случае классических принятий архитектурных решений вы типа на одной виртуалке разворачивали сразу лезете в кубернетес Вот и поэтому единственное что я советую это сделать заранее вот этот шаг он очень большой да вам скорее всего придётся менять решение для планирования вам придётся решать все проблемы которые возникают при параллельном запуске заданий Вы наверное не хотите начать их решать Когда вам срочно нужно масштабировать продакшн запоминай лучший вопрос по формулировке То есть сейчас лучший вопрос - Это вопрос про шл он единственный и сейчас будет конкуренция Добрый день Спасибо большое за доклад бы меня зовут Евгений Я из Туту у нас соотвественно нжб и одно время мы испытывали некоторые затруднения с обилием задач в связи с этим я бы хотел спросить считаете ли вы ежеминутные слишком часты кроны антипаттерны или это вполне валидный случай когда архитектура построена на них их сотни и тут нет такого что минута - это зло а час - Это хорошо А если у вас раз в минуту запускается задание которое выполняется несколько миллисекунд или там 100 миллисекунд то это норма Ну как бы я в этом ничего ужасного не вижу Единственное только а в кубернетес наверное не знаю как из вашего опыта крон джобы На мой взгляд начинают При таком масштабе как бы растворяться да в остальным в остальном Ворк Уде который м заполняете я бы на всякий случай сел и ещё раз подумал не стоит ли их отдельно контролировать да типа доверяете ли вы кубер ВС это или нет Следующий вопрос центр зала прошу Здравствуйте спасибо за доклад Меня зовут Владимир Зарена дата У меня вопрос немножко вбок по поводу случая Когда у нас джобы друг от друга зависят и строятся некоторые с требованием надежности что про думаете Мос для запуска заданий по расписанию но я про них не рассказывал Туда входит туда в принципе можно отнести Да потому что как бы запуск графов заданий с помощью можно делать и тоже делать это всё по расписанию к я отношусь хорошо Если у вас есть цепочка Ну если у вас есть цепочка вы одним планировщиком не отдела да вам придётся городить какой-то сло этого подо ти а Нормально ли мы что запускаем например через комун Делаем из одного блока bpm диаграмму и запускаем Ну типа это ненормально тоже самое как в те просто воспользоваться типа запуском задач по расписанию больше ничего из тела не использовать На мой взгляд это ол Следующий вопрос центр зала слева Привет Я Дима адре Спасибо большое за доклад ты поднял тему Есть информация в кубе жоба Она какую гарантию даёт или ан там лям Ну прям не в бровь А в глаз Дима на самом деле гарантия же зависят от персистентность поэтому я если честно Ну проку проще всего исследовать но я не владею этой информацией если честно да тут зависит от того ну надо реально документацию читать в квар например в томже примет стары например поддерживает там транзакции из Enterprise Java которой Сейчас никто не пользуется там проще откон Да вот эти гарантии в кубернетес честно скажу не знаю ты трека ешь лучший вопрос Да все остальные не забывайте голосовать это очень важно Для нас как спикеров Вы не представляете себе как круто получить лучший доклад на конференции вот я несколько раз получал это прям Вау Следующий вопрос слева Здравствуйте анре спасибо за доклад было очень интересно и вот в продолжении как раз ещё одного вопроса хотел бы спросить у нас есть практика То есть у нас крон Джаба либо это скеле да но скер имеют свои нюансы там на уровне базы данных там ресурсы отбирают у пог там эти флаги могут когда-то сброситься когда-то не сбросится в общем если у вас какой-то там на ваш взгляд вот опять же он то есть не в Облаке какое-то решение с ум Вот например как варин сервис который через каку работает и закидывает раскидывает задания то есть на уровне базы данных мы не не грузим её этими таска да но при этом чтение топиков позволяет нам в общем-то выдерживать то то то время которое нам нужно то есть И при этом ещё навешивать например какую-то логику о неудачной обработке того или иного задания Что что довольно сложно сделать например через крон вот есть какой-то у вас есть не знаю в тему или нет отвечу есть класс решения вот когда я про библиотеки в разных языках рассказывал например в го и в Руби популярные планировщики построены на очередях то есть типа есть тент ная очередь и планировщик на ней построен я вот рекомендую в вашей ситуации конечно зависит от вашего языка программирования стека которого вы придерживаетесь Но если вы гибкие то посмотреть в ту сторону потому что в том же го есть планировщики на очередях и они возможно м лучше чем вы мучаетесь пом если это создат пробле завершающий вопрос этого зала слева Добрый день или утро Андрей Спасибо за доклад подняли тему статических расписаний но на самом деле беспокоит тема именно динамических расписаний когда какая-то бизнесов вот и опять-таки ну потребность в каком-то отложенном запуске задач тоже статическое расписание не закрывает какие вы знаете Ну может решения какие-то Может сталкивались с этим Спасибо я может быть не совсем ну проблему понял потому что вот даже шаблон трая о котором я говорил он же возникает динамически да То есть вы не попали Вы же не сразу ставите будильник типа долбиться да Раз в 5 минут а вы там попробовали у вас не получилось Вы отложили создали расписание динамически с расписанием динамически Единственная проблема с которой я например сталкиваюсь Это то что под нагрузкой у вас может быть создание расписания типа откладываться да и у Вас могут быть возникать конфликты в бизнес логике Но это единственное с чем я сталкивался может быть мы в курах сможем обсудить Ну конкретнее ваш кейс Да потому что я так сходу не готов прокомментировать остальные вопросы мы обсудим в кулуарах А сейчас будет самое интересное так во-первых несите мне пожалуйста сюда все подарки сейчас мы их будем во-вторых Кому мы вручим супрематический Спасибо тебе и нашему спикеру супрематическая матрёшка аплодисменты"
}