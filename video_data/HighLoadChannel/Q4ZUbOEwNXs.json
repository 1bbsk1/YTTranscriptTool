{
  "video_id": "Q4ZUbOEwNXs",
  "channel": "HighLoadChannel",
  "title": "Бойлерплейт как инструмент стандартизации Go-проектов / Александр Калошин, Константин Пастор Гертье",
  "views": 211,
  "duration": 2657,
  "published": "2024-10-29T03:05:02-07:00",
  "text": "всё раз 2Т а поломали Всем привет У нас есть презентация мы подготовились вот э но её нет здесь на экране вот а теперь нет на телевизоре будет хо сейчас я не переживаю сейчас а давайте я просто да начну рассказывать потому что первые пару слайдов у нас э о нас о нашей компании а меня зовут Александр Саша это Костя Мы из компании Last backend и э наш доклад состоит из двух частей Первое - это я расскажу про то с какими трудностями мы сталкиваемся в процессе разработки програмного обеспечения Да почему нам приходилось Пришлось написать пй и вот вроде бы Когда кажется уже что уже всё на свете типа есть а и Костя как реализатор всех моих задумок и который помогает всё это писать и пишет хардкорные штуки расскажет как это всё имплементировать вот пару слов о компании откуда у нас есть опыт почему нас уважает Даниил вот мы сделали компанию Last backend сделали в 2014 году когда в мире появилась такая технология как доке а никто про неё ещё в мире не знал то есть Представьте мир где нет докер контейнеров где нет кубернетес где нет трушно на сегодняшний день девопса и мы такие находим В тринадцатом году там 01 версии Докера такие Боже за этим будущее Давайте писать кубернетес и в конечном итоге мы написали Open Source аналог кубернетес Но как Видно у санкт-петербургского стартапа немножко меньше связей почему-то и почему-то меньше денег чем у Гугла поэтому весь мир пользуется кубернетес а не нашей реализа Однако нам всё равно есть что предложить и что рассказать вот так как мы были стартапом и у стартапа как известно заканчиваются время от времени деньги нам пришлось ещё заняться девопсом и мы помогаем компаниям А создавать инфраструктуры им налаживаем C пайплайн но я бы много что мог рассказать в другом треке но мы про голан потому что мы очень много тоже пишем Наго и к этому времени мы подняли уже не одну сотню инфраструктур Для различных компаний проектов от Малых до Больших И помимо того что мы их поднимаем мы пишем дополнительный софт там обязательно ну в основном конечно на Гоше и дальше с этими фризура мы их мониторим а и получается На текущий момент что мы мониторим уже не одну сотню серверов ни один десяток курне кластеров и мы пользовались всеми известными продуктами например как Pure Duty в Жени но в прошлом году внезапно по странному сечению обстоятельств мы не смогли ими польз и нам пришлось просто мы встали перед выборо нам пришлось резко очень очень резко очень быстро ВС бросить и писать его аналог потому что никакая электронная женщина в 2 ночи больше не позвонит и не расскажет о том что сервера упали а нам такое было нужно вот и компания у нас небольшая ребята Мы тоже нас немного но классные и мы такие давайте-ка мы сделаем большую систему которая будет мониторить тысячи серверов мы потом е Залим все смогут общем входные требования нали Как можно быстро маленькими усилиями написать систему которая будет в себя впитывать там тысячи алертов в минуту в наносекунд как раз таки что нам как маленькой команде помогает быстро писать большие проекты и спойлер Да это Боп когенерация и всякое такое вот сейчас будет пару банальных слайдов потому что мы руководствуемся очень простыми правилами принцип парта то что 20% усилий дают 80% результата и мы его интерпретируем в разработке по-своему просто пиши мало И пиши то что нужно не надо придумывать всякие кейсы которые никогда не случатся вот где где возможно Используй кодо генерацию не пиши одно и тоже 50 раз и самый главный пункт Используй код других я его отдельно как его выделю потому что мы глим и перед тем как мы что-то пишем мы используем других людей мы изучили весь кубернетес как Он написан мы изучили весь там докер прометеус мы знаем как Он написан изнутри и если бы в мире был бы нормальный леплей и кодоева вот поэтому это вот использовать мозг других Это очень полезно Это тебя и учит и в общем вот такие дела вот и сам Последний пункт это Используй правильные технологии Потому что если вам на сервере надо держать там миллиард соединений не надо использовать для этого ПХП конечно и и в год но тоже самое не надо Ну как бы правильные вещи нужны быть в правильных местах вот второй закон такой же банальный как и первый это бритва окама не усложняй не надо делать инкапсуляции поверх инкапсуляции ещё поверх инкапсуляции чтобы потом человек Пришёл вот так вот посмотрел и такой я не буду в этом разбираться и и в общем 2 часа он тратит только на то чтобы понять что здесь написано Чем проще написано тем лучше мы этим руководствуемся и пока мы не кто-нибудь Да там из нашей команды может открыть файл посмотреть увидеть что он всё понял Мы считаем Ну это значит Это хорошо вот и так как у нас стояла такая амбициозная задача Мы конечно тоже думаем про архитектуру А естественно Мы тоже модные ребята смотрим на других модных ребят мы такие нам надо использовать микросервисы как вы знаете микросервисы стоят на наверное не знаю 6070 80% Придумайте сами в зависимости от уровня толщины микросервиса одно и тоже это запуск приложения это парсинг конфигов это подключение к базам данных подключение к всяким транспортом коннектором как это всё в общем э используется и логичной возникает вопрос Если это везде одинаково надо из этого вот это просто взять как за основу и куда-то вынести и вот оттуда как бы и вообще пошла эта задумка но надо было написать очень много микросервисов а технологии то одни и те же вот и э почему мы выбрали микросервисы тут тоже гадать не надо это все знают Это масштабируемость отказоустойчивость ээ там одно упало второе работает это всё быстро пишется и легко деплоить однако а при этом есть определённые проблемы про которые разработчики Вообще редко Кто думает А как мы с девопсом э сталкиваемся то мы очень думаем Например давичи я поднимал сентри и когда количество контейнеров Не влезло в экран моего монитора что он там поднимает я ужаснулся потому что ну мы не можем себе такое позволить должно деплоить легко а микросервисы заставляют всё-таки делать дистрибьюции немножко сложно вот тоже самое там зависимость один тут подправил потом там в другом в годах надо ВС это за импорт кучу сложностей появляются кастомные реплейс в ГУ модах проблемы там в гурка И как я говорил оно легко деплоить Но при этом тяжело деплоя поэтому мы такие подумали что сервисы не будут особо микро и будут просто сервисами Вот и да соответственно приступаю к раскрытию этих пунктов ичм писать по делу как я уже говорил Э мы изучаем то что есть вообще в мире программного обеспечения написанного на ГО и всяких таких о сорных интересных инструментах Мы подумали не Мы же одни такие уникальные в 2022 году кому понадобилось резко Написать много микросервисов наверняка в мире есть ещё ребята которые про это подумали и наверняка они уже что-то да предложили и выпустили в Open Source Ну логично же да Вот и мы такие хоба в Google убиваем и сразу попадаем на Go Kit Классная штука Ребята молодцы огромное количество там 25.000 звёзд 2.500 форка Все смотрят и в общем и как они пишут что это прямо вообще набор готовых уже инструментов которые ты прямо прямо берёшь и начинаешь сразу использовать и у тебя всё всё в шоколаде и ты просто можешь как они тут пишут Да вот сфокусироваться на типа разработки бизнес вещей Однако не всё так просто Однако чтобы разобраться Как правильно имплементировать Go Kit проще быстрее и проще написать его с нуля возможно уже что-то поменялось Вот Но вот это всё разобраться как там по ин поинтам подменять транспорты чтобы получить то что тебе нужно добавляет огромное количество Ну вот проблем плюс ещё они ребята любят много чего поменять как и все другие опенсорс В общем вот мы такие ладно gokit нам не поможет и мы такие что есть дальше мы такие у нас есть горо тоже отличный инструмен тоже вроде бы решает проблемы которые нам нужны как они пишут тоже 21.000 звёзд 2.500 форка вот тоже как они пишут Ну вот возьмёте и сейчас быстренько запилить микросервисы на самом деле Вот ребята из го Micro Они они это правда сделали Они сделали очень простое как входную точку и типа вот если хотите записать микросервис просто типа подключаете и пишете вот там Micro New сервис название description ИТ Иран и на этом как бы и всё И это действительно работает это правда и если там дальше Копаешь типа то Например если нужно какое-нибудь плагины они даже об этом подумали и такие за импортом они предоставляют каких-то количествах и просто можешь их дальше Вот используют там транспорты регистри брокеры Но вот когда ты указываешь регистри и транспорт Ну транспор Понятно Вот когда я увидел что есть плагин регистре меня немножко насторожило и оказалось что го Micro нельзя Вот так вот взять и использовать если ты не используешь микро сервер а ребята которые разрабатывают Этот проект они видать не Как сказать ещё не определились о своей будущей судьбе что они хотят они хотят пилить Open Source Либо они хотят развивать свой условный го micr Cloud и ты там вообще ну в общем ты прям настолько вендер лочи что если внезапно они в следующем году почему-то сделают всё платным и не будут короче закроют код что-то ещё то ты просто не сможешь дальше это использовать поддерживать и тебе придётся всё это переписывать И что же у нас остаётся на самом деле это в мире больше ничего нет кодо генераторы используют обр вот есть там некоторый набор кода генераторов но они под капотом используют Go Kit который мы тоже рассматривали и ничего нет Я кстати вот вчера сегодня сегодня Да сегодня походил по конференции Пообщался с ребятами спрашивал у кто что использует и оказывается все пишут бойлер плей И все пишут их в своих компаниях все копируют старый скелет апликейшн и добавляют его вот это в новый и как раз-таки для того чтобы избежать таких проблем когда ты э пишешь своё распределённое микросервисной что ведётся придётся Наверное нам взять и написать ещё один boer plate а который ээ решит все эти проблемы и всё и мы начали это писать И вот про это как раз таки как мы это начали расскажет Костя напомню огромное количество больш большая система нам надо написать тысячи микросервисов которые Бут обрабатывать 1 млрд алертов в секунду а с а ал туду меня слышно Да рано или поздно Мы тоже за бомбили потому что нам надоело просто копировать постоянно вот эти куски кода и решили написать ту так как мы изучаем какие-то уже готовые технологии Мы решили взять просто лучше скро и попробовать написать своё Что может быть проще чем взять создать алике и его просто запустить если все микросервисы будут работать в таком режиме это будет просто супер также мы сразу подумали оттуда чтобы туда чтобы добавить сразу систему логирования потому что не надо думать логе там е ло подключать всякую ерунду Почему сразу это не использу также эти логе можно настроить чтобы они в центре уходили Ну как бы из коробки ВС работает ВС Здорово всё классно Каждый микросервис как правило он не живёт в вакууме и надо позаботиться о том чтобы мы могли в него снаружи постучать и соответственно изза того что в голову приходит это транспорт и вы видите на экране соответственно Хорош тем что он делав в профайлера и генерис некую обр которая как бы из коробки должна взять и запуститься заработать но на самом деле это не так придётся немножко ещё поработать ручками надо будет туда листи прокинуть и короче чтобы это заработало надо развлекаться мы вот подумали об этом и решили Почему бы не взять синтаксис grpc в описание декларативного языка и просто подключить jpc в виде опций Kit rpc название чуть-чуть попозже вем к этому соответственно манифест превращается немножко в большую декларативное ндо или что-нибудь такое нам соответственно нужны какие-то шные методы подр не подключить таким же способом мы добавляем опцию тп вешаем и декларацию idle чтобы можно было обработки сделать предварительные вызовы хендлеров и на этом в принципе всё закончено всё работает просто хорошо не надо думать о том как подключить штп сервера потому что я понимаю что каждый может налить и потратить на это время Ну зачем писать Одно и тоже потом это всё копировать разводить Когда это можно просто опциями подключать Всё прекрасно всё работает транспорт у нас на это в принципе готов для того чтобы Запусти нам соотвественно к транспорту нужно по-хорошему написать логику уже польску обработчиков и мы к этому делу как раз и подходим Все мы умеем писать хендлера но покажем на нашем примере мы описываем просто структур хендлера имплементировать Почему более простую тоже элегантную ве где мы просто берм и устанавливаем наши хенд одной командой одной строчкой наш и получаем готовый рабочий сервер всё работает всё прекрасно надо пользоваться На текущий момент у нас получается мы умеем запускать сервис У нас есть готовые транспорты имеем обра то наверно что каждый микросервис умеет работать с какой-то базой данный например для этого мы ввели понятие плагинов потому что мы можем взять обернуть некоторые вещи там подключение там базе данных там подключение к кшу или каким-то вещи в виде плагина просто подключить это простыми опциями где мы указываем префикс нашего плагина указываем Что за ПВО того хотят например в приложени подключить взять д два пост и это будет два плагина соответственно именование у них должно как-то различаться задача у него там не знаю перегнать данные с одного поса в другой ну бывают такие люди Поехали дальше как мы используем плагины в коде мы берём например тот же самый хендлер возвращаемся к тому конструктору о котором я говорил ранее и просто подключив импорт плагина мы получаем его напрямую в конструкторе из нашего ранта to Китая и можно его соответственно в обработчика хендлеров сразу обрабатывать простой пример там получить там какое-то значение и вернуть наружу выглядит довольно вроде неплохо Аа соответственно как мы получаем это в конструкторе мы узнаем чуть попозже я думаю кто сталкивался там с такими терминология где контейнеры они догадываются уже к чему идёт речь вот что мы делаем дальше простые драйверы как правило никто не использует никто не работает напрямую из баз данных через коннекторов хендлера потому что это плохие практики много об этом написано в интернете есть различные паттерны проектирования Где используют люди сервисы домены репозитории там чистые архитектура галанга Мы взрослые люди Давайте будем исправляться и писать нормально потому что пример примером но делаем мы всё по красоте описываем некоторый пакет репозитория где мы по аналогии объявляем декларацию методов как мы будем работать с баз данных и тоже объявляем конструктор где мы получаем на вход плагин наш и в принципе на этом сервис закончен Это в нашем системе мы подобные вещи которые имеют конструктивные объявления мы называем пакетами пакеты мы регистрируем следующим образом просто вызываем наше приложение берём от него се Reg package и туда кидаем наш репозиторий всё наш это подхватывает и мы можем использовать в любом месте в любом конструкторе получаете данные так соответственно а обновив хендлер как мы будем этим пользоваться мы выкидываем эту порнографию условно говоря связанные с драйверами и подключаем сюда наш репозиторий указываем пакет и в конструкторе получаем уже доступный из ран тайма репозиторий также хендлер обновляем получаем метод там получения данных из репозитория там получения информации и отправляем всё это наружу всё работает всё здорово на этом в принципе здесь закончено На текущий момент у нас помимо того что у нас есть подключение возможности серверов и доступный транспорты и запуск сервиса мы умеем теперь работать с плагинами умеем работать с пакетами и в принципе наверное был бы на этом всё но на самом деле не так все я думаю уже задумались как бы можно было какие-то прокинуть данные там не знаю там секреты там токены там информацию о Поль ну как бы о самом сервисе здесь сразу речь возникает о том что нам нуж какие-то конфиги конфиги и также так как мы пишем не один сервис У нас их может быть там несколько Ну как бы вряд там где-то расположены и нам надо научиться как-то между ними общаться соответственно нам надо добавить работу с клиентами Зачем Сейчас узнаем чего не хватает совсем правильно конфиги клиенты как мы подключаем конфиги всё так же просто банально мы берём объявляем описываем структуру конфига указываем энвайронмент как мы его будем заполнять Когда будем запускать приложение из ливы ментов объявляем конструктор и в M файле мы просто также регистрируем конфиг И это всё подхватывает и доступно будет также в любом месте можно использовать А да финальное того что мы описываем декларативного вата конфигах прикольно тем что мы можем взять ину как бы просто вывести на экран монитора и прочитать все полуторы доступны в нашем микросервис и спокойно можем этим пользоваться также обратить внимание что у нас есть это тех плагинов которые мы подключали ранее они работает по той же механике как мы только что подключали пользовательский конфиг на соответственно их перед запуском ини плагины клиенты а то что мы описывали прото файл плюс в том меня слышно Да а плюс в том что мы изначально знаем как у нас будет построен сервер какие у него будут ростовые методы ну которые мы описывали и почему бы на на этом знании нам не сгенерировать клиента не надо писать Вот мы сторонники того что не надо ничего приду и так далее Когда можно сгенерировать и использовать это в будущем потому что это как бы локализуется проблемы которые могут возникнуть и соответственно будет легче поддерживать Как подключаются у нас клиенты так как у нас у каждого микросервиса который мы сгенерированный клиент мы его также банально опции подключаем указываем название сервиса и указываем пакет сне Клин у нас ну как бы декоративный файл превращается в Ну как бы в элегантный прекрасный пример который покрывает в принципе там 80-90 про потребностей создания наших микросервисов это у нас есть Клиенты конфиги плагины и подобные вещи в принципе больше бы наверное ничего не понадобилось для этой истории самое интересное как эта вся штука работает я не зря Ну точнее сейчас дойдём до этого тогда вот мы собрали профайлскул генерить Файлик по Bet Kit где происходит такая небольшая магия которую мы делаем за вас это вот подключение Давайте перейдём сразу к этому А мы в нём под капотом инициализирует китовый а туда подключаем те самые плагины которые мы указывали опциями провайн эти штуки это как раз вот та часть магии которая отвечает за понимание что у нас в любом конструкторе будет доступно всё что мы туда подкинули ему и подключение серверов да и в принципе на этом всё Мы на выходе мы получаем простой элегантный этот интерфейс интерфейс набор методов где мы как раз вот регистрировали плагины подключали конфиги и подобные вещи для того чтобы ограничить от лишних там не знаю действий руками а теперь о самом ран тайме мы любим рассматривать те вещи которые были реализованы и наткнулись на интересный пакет который а проект является Ну Называется ufx он в принципе занимается как раз тем dependency инжек когда добавляет всю пользовательскую логику в наш ранта И тем самым у нас происходит некоторая обработка это данных и мы можем полу обращаться спокойно из любого места в этом пакете у фикса есть несколько методов это провайн это как раз вот та самая штука где мы декларируя все конструкторы через его там внутреннюю всякую штуку и invoke там где мы запускаем как раз предварительную конфигурацию это мы при инициализирует потому что Сами понимаете перед тем как запустить приложение чтобы там воспользоваться каким-то плагином гво данных надо по-хорошему получить к нему доступ проинициализировать его чтобы это всё работало если там что-то настроено неправильно чтобы это всё ну как бы выдавало ошибку и приложение завершаю работу с пакетами такая же история потому что большинство вещей которые вы описываете у вас должны быть предварительно сконфигурированы там не знаю там какие-то там миграции наката или ещё что-нибудь там не знаю файлы подготовлены и так далее Урса есть ещ так называемые хуки это они немножко банально расскажу подробнее попозже в них мы как раз занимаемся запуском самих серверов инициализации клиентов после того как у нас будет все плагины пакеты подготовлены и в принципе на этом наверное всё прин соответственно все кто умеют точнее даже не то что умеют а правильно завершать приложение надо тоже уметь зарывать как раз они обрабатывают все вещи в стопе А как раз хуки у фикса у него банально ограничены хуки и он не предоставил ту возможность чтобы мы могли запускать и инициализировать плагины до запуска приложения нам Пришлось сделать свою обвязку на примере у нас вот мы описываем простой контроллер у которого есть стат который при запуске должен сделать там какой-то запрос и отправить это У нас под капотом немножко мы пореформений быть описаны могут не описаны там уже в зависимости от потребностей ваших пакетов и соответственно мы рефлектором это понимаем и запускаем вызываем эти методы а если у хуков нужно обработать ошибки там вернуть наш код это тоже поймёт если он обнаружит ошибки соответственно это всё отработает и выйдет для и приложение аварийно завершится отработает как раз к Опа в принципе на этом всё тот профайлскул ранее что сде точнее ваа скрипк небольшой и мы прикрутили лично мы прикрутили его к лангу и мы просто коротенько командой делаем Go generate и мы получаем на выходе готовое приложение достаточно его только запустить в принципе на этом всё слово передаю Александру три а Да да спасибо большое Костя Надеюсь стало понятно Если будут вопросы Мы ещё к этому вернёмся Но самое главное о чём я рассказывал так как все пишут боле все используют по капотам U FX все вот занимаются всеми этими делами но никто не выкладывает это ВС дело в Open Source и знаете что мы сделаем мы вот эту штуку просто возьмём сейчас и то что мы сделаем мы просто возьмём и выложим её в Open Source для того чтобы все могли ей пользоваться и перестали писать свои болер потому что хватит до ко Это будет наш второй оный проект это будет здорово всё да Ну по-моему Красная большая буква всё не так часто Ладно мы за безопасность но вы что думаете я не помню своих всех штучек готово я не знаю какие там политики у гитхаба а поэтому в общем А по хорошей традиции каждый доклад надо закончить э фразой которая прямо вот Великой истиной и наша истина на сегодня будет долой кастомный булер плейт Используйте наш тулкит А на этом всем спасибо С радостью ответим на ваши вопросы выслушаем также пожелание что мы возможно упустили а к сожалению у нас не так много времени мы не успели рассказать всё там есть и чеки и ещ свар генераторы и генераторы Моко и всё это в прото спека Короче всё круто но теперь это Open Source и вы можете сами всё посмотреть ссылочки будут где-то там вот теперь мы ждм докладов Об использовании лта от ваших пользователей с раю принимаемых с радостью в программу следующего Так вопросы понимай пожалуйста Да а у меня уже микрофон очень хорошо привет ребят Спасибо за доклад очень интересно у меня было два вопроса но на один вы уже ответили опубликовав в паблик спасибо Вот самый главный вопрос часто Вы у себя создаёте микросервисы что вот так вот сильно компанию приходят сотрудники Ну да там есть какие-то Бест практики которые у нас описаны но всё равно каждый хохочет принести что-то всё и с каждым разом у нас когда разрастаются инфраструктуры каждый пишет где-то что-то по-разному где-то Надо что-то обновить всё это поддерживать поэтому надо просто вот эти штуки минимизировать и Используйте по стандартам мы любим стандартизацию У меня ещё один вопрос вот этот файл прото который вы храните у вас для него есть отдельный репозиторий где вы его храните или как вы его шарите между микросервисами в команде на самом деле тут немножко всё просто э просто стандартная структура Мы ещё сделали Я просто не проверял мы не проверяли вот недавно мы сделали консольный клиент который Просто когда ты напишешь toolkit New знаете как вот любят эти node GS модный типа react New там Application мы сделали такую же штуку он просто стандартную структуру сгенерить сгенерирует базовый прото файл и можно будет использовать он просто лежит в приложении это же это Это просто банальный как бы это это обычный профайлскул ский файл просто пишет тот же Кай генно и всё ра у каждого просто свой ток такой как бы описательная вещь составляется и всё и на базе него ты строишь тот самый микросервис Да каж индивидуально Каждому своё Да каждый микросервис получается имеет свой вот этот Файлик Спасибо ещё вопрос следующ наверно да пожалуйста слышно Да да спасибо огромное очень крутой крутая лекция хотелось бы узнать под какой лицензией распространяется а но Вот потому что А всё окей Потому что я файлика не видел Ну мы его только добавили час назад Окей И кстати да не ругайтесь пожалуйста на качество документации мы стали писать её полтора часа назад как обычно как это бывает но Весь вот то что мы описывали в докладе мы постарались там по полочкам всё аккуратненько выложить решили выложить когда вот сейчас Ну а почему нет Да ну Т Просто пообщались такое условие принятия в программу а Open Source выложите а выложим А выкладываете так и было всё так да ещё вопросы здесь в правой части зала Второй третий и четвёртый зал Привет Спасибо за доклад у меня несколько вопросов Может вы за за один ответ на вопрос даже несколько убьёте А почему вы решили использовать в качестве декларативного описания своего приложения то есть микросервиса профайлскул мы разворачиваем большое количество инфраструктуры мы разворачиваем огромное количество микросервисов Да там наших клиентов всё прочее мы видим Какие технологии они используют и видим Какие Ну что они делают как они используют и стандартная История - это у тебя IP gway И огромное количество jpc микросервисов под капотом поэтому мы такие подумали что уже есть способ а принятый во всём миру понятный Как можно описать сервис и сгенерировать его вот и это да там вот grpc генерация из из прото файла Мы подумали что мы возьмём уже что-то известное всем и добавим туда вот такие вот маленькие кусочки которые поможет не просто получить Да вот описание самого сервиса А сам сервис вот и всё Поэтому мы так и решили ну и ещё если соответственно как мы это всё открыли в Open Source если будет ну как бы большое количество вопросов по поводу этой истории мы может быть подумаем как альтернативно ещё можно было бы декларировать структуры Я тоже Как показывает практика везде должна быть своя какая-то фишка Но вот а если у сервиса допустим есть несколько протос которы имплементировать сервис который имплементировать несколько прото схем и я как разработчик который хочу посмотреть на каком там Какой плагин у него используется постгрес или или дис он подключает мне в какой из пяти прото схем проваливаться как мне если просто у меня была бы единая какая-то схема для описания сервиса верхов уровне Я бы зашёл только туда А так у меня прото отвечает за задачу описать протокол по которому у меня взаимодействует сервис Как клиент и сервер И ещё я в нём одновременно напишу декларативный способ описания приложен Угу А ну мы думали про это мы думали про то как пользо ну пользователь Да там разработчики пишут не один Да вот сервис я правильно же Поня когда не один несколько А мы думали про это и по-моему Да по-моему у нас генерируется как раз таки количество сервисов столько сколько их описано вот здесь вот и тогда в Мейн файле ты пишешь там сервис оди как бы сервис 2 а плагины они по-моему доступны и там и там возможность у нас то что мы на пример показывали это глобальное объявление плагина ну здесь ну да вот она ниже строчкам но а также можно их если мы объявляем несколько сервисов можно локально как раз определить для конкретного также опциями внутри в рамках сервиса Ну Угу то есть по фак вот у нас блок сервиса Да мы просто здесь опции плагин описываем конкретно у него и подключаются плагины для него то есть они подключаются именно к РПЦ этому серверу который мы имплементировать не совсем gpc сервер э здесь сам сервис Он описывает приложени здесь можно же запускать его таким образом что у тебя не будет вообще никаких серверов просто подключены плагины будет Смотрите тут как раз-таки Просто мы времени мало Мы вот этот слайд Не раскрывали но он достаточно важный вот то что мы описали рпшный сервис Он в обр в ушный код генерируется как New вот этот сервис и те плагины которые мы подключаем они как раз-таки туда и вот каждый этот сервис это получается ufx под капотом приложения и в этот ufx плагины которые мы описали как раз для конкретного сервиса вот скажу сразу разница плагины иджи плагин это то что уже написано всеми Да там комьюнити используется там поци и прочее а это наши там всякие контроллеры там сервисы там что-то ещё когда для каждого сервиса Они разные вот ответили Да спасибо большое Круто Спасибо так сдуй вопро у кого-то мион отняли отняли так вот Спасибо большое за доклад было интересно ребят но не рассказали про метрики позволяет ли ваш леп писать метрики в каком-то Ну общем для всех так скажем режи популярный сегодня вопрос тече популярный вопрос на самом деле мы хотели это очень быстро написать потому что было алерты собирать вот мы это написали и как раз таки я не знаю навер из прох у нас будет плагины вынести в отдельный репозиторий чтобы гомо не тащить а второй как раз мы туда хотим нативно проте совские метрики дать возможность экспортировать и по дефолту открыть там дено какой-то там порт чтобы можно было прометеус их забирать мы про это подумали Мы подумали про то что туда надо ещё впихнуть подключать другие именно тузы просто тузы мы ещ не написали Поэтому туда не добавили но Мы тоже подумали мы это обязательно сделаем нам самим это очень нужно там рейсинг метрики Вот это в запу историю советую вам создать вишлист и опубликовать его ждм ваших надо будет это оформлять Спасибо за ответ Так есть ли ещё вопросы Да даже больше одного вот во написать сервис который будет коню к ролику то можно вот вашу библиотеку использовать л Kit ваш А у нас есть плагин Robin MQ мы сами им пользовались просто сейчас им не перестаём пользоваться Это наверное расскажем в следующей презентации Почему и по какой причине но в принципе да плагин rq есть можно подключить и использовать его он там же настроенный А это будет как выглядить То есть ты также прото файл будешь в прото файле опции указываем подклю этот сервис и другой Лагин и тут будет и потом получается тебя на выходе в конструкторе будет доступный клиент который стандартный их А вот структура сообщения это тоже можно будет описывать это нативно библиотечно ну вот ка например мы делаем коню наш сервис является конро и он с кролика берёт какие-то зада пому дела плагины плагины это в общем небольшая навы описва то есть на само можно написать свой плагин это очень просто это просто готовая обр и Например по-моему я не помню точно мы делали сабс чтобы ты мог просто он делает комер подключается саббит и ты в общем когда ты описываешь грубо говоря сейчас долистать до какого-нибудь условного вот неважно H World вот здесь представим что здесь не какой-нибудь условный это то здесь мы просто вот зделаем то начинаем обрывать логику Ну не из хендлера конечно из какого-нибудь там контроллера который подключается ПДМ вот а вот само сообщение из кролика получится маршали придётся написать Да марша свой будет мы же не можем предугадать Какой формат данных вы гоняется там Спасибо так у кого есть ещё микрофон так сначала Спасибо Вам что не заставляете добавлять п ямк или дженк в проект А всё стандарти фай который так есть везде и парочка вопросов первый думаю по многим ударило то что бабил нас забанил Вы не у вас есть штуки для автоматического ре зависимости есть спойлер завтра в 10 утра мы читаем на эту тему доклад мы решим эту проблему Ну так-то мы её решили все но тмка в 10 утра окей ладно И второй вопрос У вас уже сотни сервисов написано вы продува как будете их обновлять если какая-то структура проекта изменится зависимости обновятся поменяются А если у нас типа написано есть у вас и вам надо на это обновиться но в общем нет так просто история в том что у зале плагинов они очень простые то есть там прям вот типа у нас постс горм как бы да то там прям те клиент постс гор возвращается и мы мы за стандартизацию очень общих вещей то есть вряд Ну плагины будут обновляться только наверно из 100 серий чтобы там если мы используем rit чтобы сам переподключается который можно безболезненно внутри обновлять А если там какая-то другая логика написана у микросервиса то мы как может не Не ну ва же всё равно какая-то структура генерируется где нет там как-то всё очень они все маленькие получаются и поэтому там такого Мы не сталкивались с этой проблемой Наверное нет Ну вот например если мы используем какой-нибудь там по Например у нас возвращается стандартный Ну как бы пакет этого интерфейса как у них в репозитория предложено Да мы сделали небольшую отбр потому что мы там заложили туда переподключение всякие паблиш сабскрайб но в принципе можно использовать также нативный плагин Ну мы на своей практике учли некоторые моменты которые вот часто используются вот смотря на то как ну как бы пользуются этим клиенты и подготовили уже готовый такой паттерн и выложили и пользуемся всё коллеги У нас заканчивается потихоньку время на вопросы поднимите пожалуйста руки те кто хотел бы ещё что-нибудь спросить а раз отлично на ещё один вопрос время у нас есть ещё раз А спасибо за доклад у меня такой вопрос Если допустим изменился корпоративный стандарт и сказали то что ну архитектор пришёл и говорит А сегодня мы переходим с рабита на кафку как вот э Какие действия Мне необходимо сделать чтобы произвести скажем вот эту замену понятно Ну просто подключается плагин Кафки Да и в том месте где вы используете в контроллере используется подключение Кафки там где вы обрабатывается сообщения да В этом сабскрайб Вы просто если плагины мы напишем условно совместимыми друг с другом что там будет сабскрайб и туда хендлера пропи что в другом будет тогда больше ничего не надо будет делать Просто изменится вот сюда в Конструктор придёт не сервис psql плагин а там сервис PB точ кавка ПН Да И вот этот вот кавка уже кавка сабскрайб будет и пакет подключить будет Ну и пакет да естественно то есть нужно придерживаться каких-то интерфейсов контрактов и а перег нери сервис правильно Ну да да Ну когда поменяется прото файл естественно надо там Гоген за сделать и всё спасибо Да так спасибо настало время выбрать лучший вопрос и вручить подарки Выбирай ят что выбирай Кто у нас это так лучший вопрос Блин все вопросы хороши да Все хороши Да ну в подарок у нас все все все причём вопросы затрагивали те же вопросы которы гранулярный подарок Так кто там больше всего вопросов задавал Так я уже забыл ладно давайте самый самый простой банальный вопрос на который уже ответили почему выбрали профайлы брали прото файл они написали 10000 и Ямал и почему нам не надо этого делать Вот он и получит наверное наш подарок автор вопроса прото почему же прото файл выйдите пожалуйста на сцену Это случайно не я который спрашивал да да да пускай так бы так и мы вручаем подарки Ага спасибо тада Вам спасибо что вы уложили в Open Source так и подарки докладчиком Спасибо коллеги дискуссию можно продолжить"
}