{
  "video_id": "KHvoLyLdTJ0",
  "channel": "HighLoadChannel",
  "title": "MariaDB и MySQL — какую статистику использует оптимизатор / Сергей Голубчик (MariaDB)",
  "views": 2377,
  "duration": 2536,
  "published": "2019-05-15T04:50:06-07:00",
  "text": "так как отпра мария де пейн я сказал возьмем праге статистика сейчас не про не говорите и эта штука что не работает работает прекрасно так обо мне я работаю в море деби как чифа как мы видели до этого работал мои стоил он много лет так что эту куда выбор должна довольно-таки хорошо так теперь про оптимально что значит оптимизатор когда он оптимизировать запросы что ему нужно знать чтобы им москва и в мо рейде by оптимизатор в основном cost bass то есть он пытается оценить сколько стоит вы план данный запрос каких-то условных попугаев и выбрать запрос с минимальной стоимостью этом есть некоторые правила но мэтт никто раньше вдоль от 7 из картона для того чтобы оценить сколько времени у творца запрос ему нужно кое-что знать про данные про таблицы это то что он может прожить он может попросить у движка сколько примерно строку в такой-то таблицы точно знать неважно можно кушать это быстро приблизительно вернуть не знаю размер файла разделить на количество для размер s tocki что угодно том сколько стоит просканировать всю таблицу если он хочет сделать full-time скан или если мы нужно прочитать какие-то строки из индекса сколько стоит прочитать эти строки или например вы можете спросить сколько разных значения в этом яндексе и тогда если там запросе скажем в что-то там равно 5 в яндексе не на 100 тысяч строк на 20 разных значений значит 5 это будет не знаю 20 цепь таблицы приблизительно так вот optimizer будет рассуждать и но он еще может просить более точная сколько значения лежит в каком-то яндексе в диапазоне не знаю от 1 до 7 например это точнее чем приблизительно считать количество разных значений он примерно такие вещи могут интересовать оптимизатор он потому что это будет использовать чтобы оптимизировать запросы так и чего к проблема с тем как это было реализовано до появления index in a debit для оценки и многих этих значений делает рандом days это в яндекс то есть она выбирает случайное значение смотрит где там она в яндексе еще несколько раз придя в том что ты за того что значение случайной а там конечно и сбегается ошибок так что и двигаются 6 на тебе можешь почитать какой-то там часть дерева и культа часть индекса назначение получается нестабильный если несколько раз повторить этот запрос alldata быть одинаковый но оценки optimizer получит разные поэтому он будет получать разные планы например в бенчмарках 9 3 это бенчмарки там сложные запросы эмулируются работы анны аналитика которую может сходим на ход выдавать запрос номер восемь кто называется ночном макать shake weight там joannites a8 на тебе таблиц именно тебе получается четыре разных плана на этом запросе на самый быстрый плавится 7 минут самый долги выполняется за больше часа и заранее неизвестно какой надеваю берти случайно как кости любят ку всем запросе там еще хуже там все мы разных планов самым бы сорваться 12 минут самый длинный план снёс качество вы потом он выпал по таймауту то есть как повезет частично чтобы эту проблему решить и на тебе добавили и на тебе персидский статистик которая проблему не решает то есть она решает проблему в том что статистика запоминается каждый раз будет одна и та же но какая одна и та же из этих семи разных планов выпадет вы не знаете если повезет это будет одна и та же 7 минут двенадцать минут из не повезет это будет одна и та же тайм аут все время стабильно тайм-аут или стали нестабильности для нас винт как как повезет другая проблема с прошиванием движка дело в том что движки они имеют тенденцию врач это вот такой вот абсолютно синтетический пример мы берем таблицу с тремя столбцами в мае сами в каждый столбец флакон случайное число от 0 до 100 тысяч и так повторяем через тысячу раз и деле мы считаем количество разных значений в конце что он еще 100 должно получиться кто-нибудь может сказать только разное значение будет там от примерно 100000 вот от нуля до ста тысяч числа 100 числа целых 0 до 100 тысяч больше быть не может ну примерно 100000 и получилось да теперь это точное значение посчитаны я высказал точно честно собрался загнал временно таблицей посчитал терме спрашивать просим engine оценить сколько штамм с точки зрения engine на разных значений моей сам выдал что-то примерно 100000 теперь мы переводим дином лттб и на тебе страшно то же самое что он сейчас здесь получится кто-нибудь знает сейчас получает 200 тысяч что в принципе невозможно потому что мы брали плотными одынец и нажали вы на сто тысяч исторически сложилось так что когда-то давно лет пятнадцать назад автор надели заметил что хоть этот запрос работает медленно а если он там в два раза прокрутить статистику запрос выдается быстро он у нас вот он такой а то сделал из тех пор прошло много лет все остальные запросы уже подстраивались под эту статистику так что теперь то наверно будет сложно изменить обратно но это на самом деле особого значения не имеет потому что опять же цена меряется условных попугаях если всего словно попугай в два раза больше это не страшно другое дело если в одном запросе смешивается и no debe и кто-нибудь другой движок например тот самый rox baby который тоже врёт но по-другому вот тогда их уже сравнивать нельзя в этом проблема что статистика получается просто несравнимые третья проблема что да все хорошо нагреть его нужен яндекс яндекс он занимает места на диске наган займет много места на диске ему нужно с ними обновлять все концерты апдейт уделит и обновляют индекс опять же там транзакции всякие там еще запоминается какие-то данные и индекс ртс стоит время и место если вам нужно просто статистика то яндекс может быть слишком дорого еще одна проблема неравномерное распределение это условный ну довольно практический узкой когда вот есть что-то можно скачивать какого-то сайта например скачать мои сказал с mail.com и там есть форма котором нужно зарегистрировать перед скачиванием можно задать не надо зарегистрироваться и вот я конечно не знаю но я думаю не очень неразумно будет предположить что может не знаем один процент польше регистрируется меньше одного процента очень если взять примерно такую табличку и посмотреть сколько людей зарегистрировать сколько нет зарегистрируйтесь будет очень мало и потом и допустим делаем запрос в речи страной с оптимизатор что делать он смотрит два разных значения миллион строк наш примерно по 500 тысяч строк на каждое значение это совершенно неправильно и если искать наезд раз имело бы смысл использовать яндекс потому что он очень хорошо ограничит если искать панова той яндекс имеет не имеет смысла использовать нужно делать полный той был скан венатор этого не знает потому что все что знает это два разных значения на миллион строк и наше решение было в море тебе вести статистику тура независимо от движков и оно сохраняется в системных таблицах отдельно от таблица есть она стабильна на 7 1 этажа она точно это потому что точно считается количество значений и все честно запоминается никто не удваивает никто ничего не подкручивать она подробная она запоминает больше чем просто количество независимых значений нам буду гистограммы на следующих слайдах я на одинаковой для всех движков то есть можно сравнивать самой цену получены от разных движков по таким улицам выбирать разумный план за вопросов которые используют больше он движок как это работает это очень вкратце потому что я не планирую этом докладе повторять дэниэл то есть я упомяну чтобы маленькие ключевые слова потом искать а это потом можно будет посмотреть - the temples переменная настраивать когда таблицы используется никогда complementary используют их если нету родной статистики и preferably использовать всегда и а прямо я велю с конечности activity тоже буду объяснять на следующих слайдов это как что именно из этой статистики оптимизатор будет использовать запросов чтобы собрать статистику использована lifecycle можно использовать дополнительные слова отвертитесь info если хочет собрать ей для некоторых столбцов только можно не запирать тогда она соберет автоматически для всего и хранится на новых таблиц этого создаются в базе mysql daiwa про вопрос был когда она устаревает дело в том что до некоторая статистика зависит о том как даны используется она может устаревать быстро может устаревать медленно но когда настаивайте даю нужно пересобрать пока что сейчас нет нету никаких способов чтобы она автоматически при собиралась карданные меняется это мы об этом думаем и почему это не сделано этот он в конце в конце слайд в конце доклада кожух красит пока что очень долго собирать что запоминается что хотят и независимость колеса строк для таблицы количество разных значений для каждого индекса для каждого столбца собирается минимальное и максимальное значение количества ну там бегали количество или количество времени ними видишь напрямую число запоминается что-то другое чего это можно для 0 и запоминается процент 0 и но это принципе то же самое средняя длина для строк и столбцов опять же количество разных значений и при желании запоминается гистограмм на распределение значений для каждого столбца и в ес и дальше пойдет примеры для примера я использовал and play дайте bass так что это такое у меня на экране написано питание быть выключена через три минуты на я дома я надеюсь что кого этого телевизора так что смогу продолжить не глядя на экран неважно вот использовал and лоис дай the bass это не ссылкам с кормы нидерланды записи ссылка на это самым плейдо это без ноги dhabi она им эмулирует это выключилась это там данные по сотрудникам какой-то условной фирмы заданные сгенерированные не настоящие 330 записей сотрудников 328 миллион записей записей на зарплаты и вас точно все мегабайт данных то есть это не очень большая таблица набор данных но все таки не совсем маленький то есть на чем показать вот и так вот она грустно то есть мы грузим файл им playskool там куча разных других source и лода это команд который все это грузят потом и включаем статистику флеша рамбла чтобы использовалась даже демон делаем она лайс то что наладь собирался он всего меньше 20 секунд показывать сюда не очень большой набор данных все-таки дальше примеру вот пример как saber как считается использовать статистика под столбцам начали здесь я делаю optima zeus конденсировать иван иван означает что не будет использовать . пытаться то есть точно только обычно электродинамики как если бы не было никакой статистики потом мы делаем запрос и в этом запросе мы ищем всех менеджеров всех типах ним последний затей был department джонс таблицей in place и выбрать только те комплекса которых тайтл равно менеджер в этой базе данных и а не менял и загрузил как было столбец тайтл он не индексированный то есть в итоге рано или поздно нужно будет тупо проверять условие смотреть где находится менеджеры ну работает не очень долго 15 секунд все посчитали прекрасно потом мы включаем статистику по столбцам делаем тоже самое она работает но 53 секунды то есть 1 в 16 быстрее вот так вот и теперь посмотрим почему если сравнить 2 x play на до и после это это результат explain extended ну там где выкинулся не нужные столбцы чтобы она влезла на слайд важно смотреть на столбец и фильтр и фильтр это то что апв сколько оптимизатор думает строк пройдет через вы apple ios и данном случае у него нет статистики по столбцам да толку я включил и он не знает сколько строк пройдет то есть он считает что все сто процентов пройдет что в данных для экране цен означает просто не данных и в таком случае считает что выгоднее все джонни таблицы вот в таком вот порядке там он использует индекс к низшему ждал мы помогать не сильно потом и включаем статистику по столбцам и оптимизатор видит минимальное и максимальное значение для полем для поля тайтл из сравнивая он определены кардинале ти сравниваем определяет что менеджер может менеджер то может быть ну процентов 15 может быть так он здесь думает без гистограмме если и в таком случае уже гораздо выгоднее джонни таблицы другом порядке и что и дает шестикратное ускорение и это не индекс который нужно все время поддерживает один из посчитал места на диске она больше не занимает всего два числа дальше гистограммы перед примерами объясню что такое гистограмма равные высоты этот гистограммы которые сходятся мы видели это вот это не гистограмма равные высоты сразу говорю это обычная гистограмма которая все привыкли тут нет несколько столбиков они все разные высоты но не одинаковой ширины самая обычная гистограмма наверху красной линии нарисованное распределение значений в каком-то столбце на которые мы считали эту эту гистограмму а вот это вот гистограмма равный ширин разной высоты здесь и столбики одинаковой высоты красной линии то же самое и здесь значит слева высота столбика пропорционально ну скажем площади под капот красной кривой то есть чем выше красная кривая тем выше столбика ширина всех столбика одинаковая вправо правой гистограмме высота у столбиков будет одинаковая а площадь под красный кривой будет тоже везде одинаковая что взять одинаковый площадь под кривой мы должны делать разной ширины столбики почему это лучше у нас большинство столбиков сосредоточено там где красная кривая идет наверх на ее горбе это самое интересное место потому что если там оптимизатор ошибется немножко он может получить в два в три раза другое значение для распределения для гистограмм для столбика и тогда он может почитать план совершенно другой то есть там ошибка на горбе красной линии можно и очень дорогой хвост для гистограмма равны покрывается одним широким столбиком то из хвост прописаны очень аккуратно но это не важно потому что мы так маленькие значения немножко ошибиться ни на что не влияют если ты объяснить по-другому представьте что мы взяли эту красную кривую всем все данные в столбике посчитали гистограмму авто а потом мы забыли бы забыли про данный мы мы не хотим второго сканировать столбик нас и только гистограмма 5 значений но каким приблизительно восстановить какой там было распределение чтобы выбрать правильный план если мы пытаемся восстановить распределение этой красной кривой по левой гистограмме получиться примерно вот так вот видно что хвост прописан очень хорошо но горб прописан совершенно неправильно то есть там большая ошибка если мы же пытаемся восстановить этот эту кривую по правой гистограмме у нас получится гораздо более точная прописанная кривая но потери точности хвосте но опять же хвост он маленький там роли не играет если мы немножко ошибемся то есть преимущество в том что для таких неправильных распределений можно равным количеством столбиков пакетов для нас точнее описать распределения тот тип гистограмм которые используем мы людьми и теперь пример мы берем ту же самую employ the bass там есть столбец товары возьмем возьмем почитаемый new среднюю точку среднюю сегодня . от которых это посредине между максимальной и минимальной зарплатой это будет ну примерно 100000 и теперь мы посмотрим сколько сотрудников получают зарплату больше этой самой средней точке больше средней зарплаты и там будет 166 тысяч сотрудников не так уж плохо 19 секунд это считалось теперь мы включаем гистограмм мы повторяем то же самый запрос и он считается в 3 раза быстрее почему это происходит смотрим опять на explain если у нас гистограмм нет то оптимизатор знает нор театр знаете о на минимальное и максимальное значение точном смотрит минимальное значение зарплату максимально сионе зарплата 100 тысяч от построения предполагаем равномерное распределение начат примерно половину строк будет ведь выше выше средней точке лежать на самом же деле как мы знаем в реальном мире и в этой им place дитя без доплат они избраны со всеми тоже неравномерный большой зарплат лежит ниже средней точке если выключен гистограммы венатор посмотрит на распределение зарплаты и он увидит что вышли они . лежит меньше пяти процентов зарплат то есть гораздо меньшее количество строк пройдут через от самое условие через вопрос и будет гораздо выгоднее начать с таблицей solaris потом уже оставшаяся маленькое количество строк желание с другими таблицами он джонни таблица другом порядке и получается трехкратное ускорение шестикратное ускорение следующий следующая штука которую умеет делать и тогда научился делать eliminator скажем так это сэм блюм или то что я здесь как-то криво перевел как apple экстраполяция по выборке то есть когда из такого условия когда издавна хочет работать только с лайкой когда которая нельзя проверить не по гистограмме не по индексу ника другая статистика не помогает вообще последнее что может придумать сделать оптимизатор он начинает просто читать с таблицей променять это условия на небольшой порции таблица это настраивается по умолчанию 100 строк и смотрит сока строк прошло через это условие зачем считает что дальше для всей таблице будет пример такой же процент строп проходить через это условие вот как это работает здесь такой довольно марочный запрос который мы берем все сотрудников чья фамилия заканчивается на off и считаем среднюю зарплату для каждого подразделения фирмы для каждого депонента ну предположительно это может иметь смысл что кто-то пожалуйста какой то перед американской фирме русских дискриминируют по зарплате и они решили проверить среднюю зарплату для русских для каждого подразделения или ещё что-нибудь не важно это и мы горим происходило не про политику вот считаем зачитаем среднюю зарплату для этих сотрудников 5 секунд потому что набор данных не очень большое все-таки потом и включаем этот этот сэмплинг и она работает в 12 раз быстрее допрос тот же самый опять же причин причина опять же то же самое пока мы не делали это центре оптимизатор не знает сколько строк пройдут через лайк потому что лайк на хвост строки это не помогает ни какой индекс это не помогает некие гистограммы вообще ничем помочь не может тогда он считает что все строки подстроки пройдут и делает join в таком порядке если мы включаем пробить он видит что совсем маленькая количество строк пройдут через это условия то есть имеет смысл начально отсканировать таблицу им place выкинуть все неподходящие строки этом останется меньше процента и тогда уже делать join и в этом случае получи мы получаем 12 кратное ускорение и так подводя итоги то что я уже успел сказать это еще не конец доклада это лишь подведение итогов того что успел сказать тост запоминает что включает в себя это независимая движков статистика в мари тебе десять ноль для таблиц коллить со строгой таблиц кардинале этим или количество значений для индексов количество значений миксер минимум и максимум количество нулей и среднюю длину для столбцов и гистограммы чем используя гистограмма равные высоты еще оптимизаторами делать экстраполяции по выборке но работает только для лайк это не новая штука это было море тебе 90 который был 2014 году и почему об этом расскажем здесь по двум причинам во первых когда это появилось я считал что это очень крутая фича которая радикально меняет некоторые понятия которые всегда всегда были как бы это было как ком она лично всегда справедливо для моей скал и моей baby что нужны индекса без индексов ничего не вообще ничего не известно проданы и что известно только кардинале ти неравномерное распределение всех все ломает и это чинит обе эти проблемы что было по моему туда очень круто и но с тем тех пор хотя это хорошо работает помогает у меня склад в такое впечатление что вам этом знает об этой фиче знают по-прежнему почти никто это одна из причин по которой отдела этот доклад и вторая цель это потому что были некоторые изменения в этой области частности в мае сказал 80 тоже появились гистограммы и для каждый для каждого столбца запоминается тоже хранится независимо от движка отдельно для каждого столбца запоминается опять же процент нулей и гистограммы и 100 грамм и могут быть разной высоты но также майское могут делать distar инстаграм и для дискретных значений это что такое когда в столбцы с мало значение то есть например я снова или там не знаю пол который ну не знаю как не придумает больше чем сколько там 40 у фейсбука 30 вообщем намного больше не будет таких случаях лучше делать гистограммы для дискретных значений по одному столбцу на каждое значение они делать гистограммы и радости который будет объединять редкие значения один столбик и мая стоил 80 с горки 100 грамм работает быстрее чем на рейде by за счет того что значение много они начинает пропускать значение что не каждая первая каждая не зна 5 10 сколько нужно чтобы получилось быстро а основном все работает принципиально также собирается гистограмма и оптимизатор можете использовать для запросов и в мария де 54 которая сейчас разработки и следующем году бой джей во-первых мы включаем это все красоту мы включаем по умолчанию той до сих пор он про неё нужно было знать чтобы и пользоваться и начинать здесь а4 она будет работать для вас даже если вы про нее не знаете лучше если затягивание знали это была вторая причина по которой делать доклад что казалось запрос внезапно начнут работать гораздо быстрее вот поэтому наверное да от анала сделать он надо будет но не надо будет ставить переменные которые включают во вторых да одна из одно из основных нововведений в которых одна из них which can которой мы работаем сейчас это как раз сделать чтобы онлайн работал на столько быстро чтобы это можно было включить по умолчанию вот почему она до сих пор не собиралась автоматически почему она не была включена по умолчанию потому что то все таки было медленно и здесь 4 это исправиться и тогда будет эта штука будет включена по умолчанию и опять же добавляем гистограммы для дискретных значений которые хорошо работают работает лучше чем гистограмма разной высоты для столбика в которых очень мало родных значений большая часть от этой работы которая будет найди в виде 4 было сделано в рамках ул сама вход project этого года есть вопрос да пожалуйста спасибо за доклад был затронули тему того что они долго обновляются эти анализы и ну как так хотелось бы больше наверное раскрыть эту тематику то есть каких случаях их стоит применять ее каких нет ну то есть это понимаю в 10 4 они будут включены по умолчанию на на лайк если не запускать то ничего не будет да ну соответственно было бы неплохо услышать какие-то советы от вас когда это стоит их раз вечным есть такой statement meдиb такая команда онлайн select то есть она работает похоже как на из плена explain но explain заранее говорит что думает optimizer в момент создания плана этим сайт не explain sent me explain анала select the он выполнить запрос об этом в конце покажет то что мы реально получилось например сколько строк реально прошло вопросы так далее если вот видно что то значение не сильно отличается от того что opti-men сколько думал должно быть тогда не нужно будет может иметь имеет смысла собрать статистику чтобы рада встрече раздумал правильно и с помощью она лайс помощью онлайн persistent в плов да здесь можно указать on last level 5 стэндфорд потом имена столбцов и собрать статистику только для некоторых столбцов но поскольку мы здесь 4 будем делать статистику все равно выборочно размер выборки там есть научные работы на эту тему у нас нет логарифмические от размера данных то есть чем больше данных тем быстрее будут собираться статистика спасибо за доклад как всегда очень интересно вопрос этот анализ он блокирует базу или нет он оральные запроса на момент они так вопрос этот онлайн брак или блокирует ли он доступ к таблицам он не должен блокировать доступ к таблицам совсем но о друге саппорт и если он может блокировать самом конце когда он закончен и тогда это будет бак его нужно нам надо зарепортить мы его исправил потому что фар потому что фактически это просто делается select из таблицы который смотрит значение вычисляет статистику он не должен блокировать абсолютно ни в какой момент можно на вопросов случае больших таблиц можно будет анализировать здесь в случае больших таблиц можно ли будет a sample анализировать то есть не всю табличку а там 10 процентов 50 предыдущий да да это то что будет в 10 4 можно будет анализировать сэмпл да да там есть перемены кто это настраивает ног я сказал это это еще будет меняться потому что процент процент размер таблицы это неправильный размер сэмпла потому что достаточный размер 7 планшет логарифмически поэтому просто до 5 процентов это может быть слишком мало или слишком много поэтому это еще будем подкручивать да спасибо за доклад вы сказали что она вас 8 версии будут работать быстрее за счет чего за счет за дюринга женщин для того чтобы это выборка от только за счет на ромашке спасибо которой вопрос а вот когда вы делаете сэмплинг для лайк вы это делаете в порядке вставки в таблицу по ключу или нет это делается в порядке естественном порядке строк для таблицы который то есть там просто годится движку дальний первую строку для второй каков порядок он фактически не определен для и на дебита будет наверно порядок поймали key для моей сам это будет порядок вставки строк но потом если строка удалите вставить новой она влезет сюда то есть там некий гарантий спасибо за так скажите пожалуйста вот там переменная которую мы переставляем циферку не помню на это системная переменная или им изобретать глобально можно выставить существенно таблицы нужно от нас начни такое другое мне для дни для одной таблице она запросов да ну да можно сергей еще вопрос а будет где-нибудь metadata по гистограмму они именно данный pages- так то есть посмотреть распределение до места где гистограммы не хранятся в таблицы в базе mysql называется по моему колонн стад и там гистограммы они некоем бинарном виде но есть функция которую можно вызвать чтобы ее развернуть и посмотреть это все сделать можно может даже ручками подкрутить если интересно но это как строить стрелять все в ногу то есть можно конечно можно еще вопросе но если будет слишком часто происходить операция вставки то есть на сколько это критично вот для продувания этого этих метаданных вот к к к к к к к к и порог там хотя бы приблизительно ну это зависит от данных и зависит от того опять же какой конкретно статистике то есть например то что хранится для индексов здесь хранится не количество разных значений на самом деле хранится живешь кардинале если искать сколько примерно строк соответствует к одному значению и там если вставлять имя новой строки например то для большого количества разнообразных нагрузок и разных паттерна вставки строк это число меняется очень мало а вот например минимум и максимум опять же если вставлять если составлять ну не знаю йоги какие-нибудь то меню максим будет слабо меняться если вставлять timestamp он бы все время расти за из того что оставлять хорошо почему не вопрос спасибо за доклад я хотел спросить по поводу оптимизатора когда как он определяет по лайку для конкретной для конкретной строки количество строк данном данном случае он это был пример такой вот экстраполяции то есть он просто открывает таблицу last name to employ из читает 1 100 строк для каждой строки вычесть вычисляет like внутрь прошел не прошел и думаю что для и давно экстраполировать дальше по всей таблице сколько там 300 тысяч строк будет также когда первых 100 что работает конечно только тогда когда там когда это репрезентативная выборка получив на первых со строков нет именно по конкретно строке как он определяет он для каждой строки вычисляет лайк и смотрит проходит или не проходит нет вот именно в запросе если строка меняется а если запросе то строка менять замен запросе строка константное там лайк там константа like процентов а если бы она менялась там конечно такой оптимизатор сделать бы не смог ну как раз таки обычно поиск по строкам и производится с разными строками стройке постоянно меняются запросах ну если она меняется между разными запросами тот туда и zara меняется в пределах одного запроса тогда эта оптимизация работают естественно не будет не понял да там есть сейчас вопрос только что был на конфигурируем или тот 100 строк дамми-переменная которая покажет сколько строк читать в данном запросе нужно найти те строки только которые заканчиваются на of поэтому оптимизатор читать первые 100 строк из таблицы проверяет сколько из них строк заканчивается на of допустим там было не знал 10 строк из то потом он знает что таблицы 300 тысяч строк значит не знают 30000 это получается анализатор запускается перед запросто до вопрос был что будет если выполнить поставить optima tirus conditions in activity 5 и будут предыдущие запросы каждый новый уровень включает себя все предыдущие то есть на пятом все будет выполняться то есть скоростью которая ну можно конечно можно сразу стать пятерка подходил 5 секунд эффекта каждой новой оптимизация поэтому я на каждом следующем примере увеличивал на единичку и показывал и выбирал пример по это employee сайта быть который показывает именно конкретной оптимизацию ну и если плата какая то ли дело в том что ну не знаю может быть это баг может быть устаревшая статистика то есть теоретически конечно данным статьям за пятёрку но не такие гарантии может она на ком-то забросе хуже будет может из-за того что там и на до статистика протухла например пожалуйста так 1 час 1 мая сказал бертона основанная на 80 они уже он ему не столько альфа выпустили в общем они скоро будет если вы же нету перкунас но верховный сервер основанный на миска 80 и там туда будут гистограмма как мне сказала такие вот эти на пожалуйста ну вопрос в том можно ли раз в сутки проверять запрос до 1 к это время проверять запрос с используем этой статистики без нее смотреть и таки можно пытаться определить протухла ли статистика ну наверно можно я бы на самом деле сравнивал не знаю как что-нибудь из статистики чтобы быстро посчитать например минимум максимум или хотя тоже tables кан иль аккаунт то есть на самом деле все кроме гистограмм должна собираться довольно быстро и количество разным значением ему тоже то есть можно некоторых браку и totality который собирать быстро ее периодически проверять с тем что сохранена и смотреть таким образом не сильно ли изменилась статистика но и надеюсь что здесь 4 это будет не нужно потому что она будет собираться сам по себе быстро хотите к даже с ним блокирующий населенных диск нагружает там его и все такое то есть если за когда банан сильно нагружена конечно можно собирать да пожалуйста подскажите а будет ли какие-нибудь плюсы на сложенные выборки из 1 это таблички пользование еще каких-нибудь подобных вопрос был будут ли кино плюсы от сложных выборках из одной таблички но на самом деле не очень понимаю что такое сложная выбор к нам никто не если буду там в условия на разные столбцы да именно об это конечно для каждого столбца независимо сможет использовать эту статистику и соответственно уменьшать точнее оценивать сколько строк войдут через в класс но проблема может быть том же если значение в разных столбцах коррелированы я примет это знать не будет потому что здесь выполняется независимо для каждого столбца корреляции не учитывать и пока что за трудовой стороны не надо индексировать каждый столбец потому что чтобы собрать чтобы сделать то же самое без этой статистики нужно буквально строить по индексу на каждый столбец а это может быть очень дорого то есть смысла мало имеется обычно да пожалуйста здесь он здесь она лась будет делать full скан вопросов тонн если есть яндекс можно ли аналог просто твой индекс и менять full screen в данном случае это разницы большой не будет потому что даже если взять обычный просто select the method on a life i sl экзамен заметит что ему нужно все равно почти всю таблицу просканировать он предпочтет делать стать таблицу они yandex потому что что-то читать таблицу он считает это линии линейное чтение по диску индекса прыгать с время туда-сюда так что будет быстрее не не использовать яндекс извините пожалуйста дорогие гости пожалуйста не задавайте вопросы если у вас нет микрофона в руках поднимите руку над одним микрофон чтоб все слышали вас вопрос и то что вы сейчас говорите что ты тот данный момент спасибо большое у меня вопрос а вот если вот такая относительно идеальная система где все индексы созданные все запросы работают по индексам там составные мы догоним соответственно то есть уже все отлажено и вот эта опция выключена вот она снова и вот мы включаем от этого будет прирос производить если уже все работать по индексам как бы зависит от запросов то есть например и будут ли ситуации когда там индекс вообще не будет использоваться точен лишний станет и если дак могут быть конец случай когда индекс станет лишним и тогда его можно будет просто не строить или отключить если но если индекс и везде есть то здесь фактически я думаю достаточно будет индексов так я смотрю что здесь используется все это можно извлечь из индекса кроме гистограммы ноги 100 грамм но он может получить только если сравнить констант ными значениями а для этого он может делать то что здесь вначале показывал сколько значений в яндексе лежит в диапазоне то есть опять же можно получить из индекса так что есть вашим вообще выключить тогда можно наверно использовать индекса другое дело что если индекс становятся большими или поддержка индексация замедляет это можно опять посмотреть эту сторону а чего здесь я использовал примеры особенно на столбцах который которые не проиндексированы потому что это лучше показывает работу как в такой бич more как гибель 3 то есть когда есть аналитик у него их база данных и он строит такие отход запрос из того что он приходит в голову а теперь мы ограничен здесь а теперь мы здесь делаем грубой а теперь и ты счет подставим и этот не для какие запросы которые заранее заскриптованы которые заранее известными по которым можно построить яндексе это то что эмулирует убить эзры и это примерно такие запросы которые здесь старался использовать примеров нету даже примеров а можно еще вопрос если у нас большой объем база да большая загружено и есть слоев мы же по идее можем статистику на славе обновлять а потом искали что и можно загружать да конечно и не нужно было можно собрать ее на слове просто скопировать все спасибо очень хорошая идея есть еще вопросы на пожалуйста относительно отказа от индексов есть такая вещь как слог в который мы любим смотреть когда там все плохо становится и там есть позиция вот что у нас не используют индексы случае когда сработал этот оптимизатор а индекса у нас нет там же будет над лишь этот запрос не используем да наверняка бы"
}