{
  "video_id": "xrMD8xLe2D4",
  "channel": "HighLoadChannel",
  "title": "Прогрессивный рендеринг и Catberry.js / Михаил Реенко (2GIS / Flamp)",
  "views": 739,
  "duration": 1727,
  "published": "2018-01-16T13:43:48-08:00",
  "text": "лично всем привет меня зовут мишарин к я работаю в компании 2гис в департаменте проектов ламп а также я являюсь участником сообщества как берджесс сегодня я хочу рассказать про прогрессивный рендеринг что это такое зачем это стоит использовать и каким образом прогрессивный рендеринг сделает пользователей счастливее и сначала я хочу спросить а кто-нибудь здесь знает что такое фламп поднимите руки всего три человека да если бы мы были в сибирской части то я думаю было бы рук намного больше фламп и это площадка для взаимодействия между компаниями и их клиентами посредством написания отзыва или обращение в личные сообщения в это сервис отзывов в цифрах фланг это шесть лет развития 25 миллионов просмотров ежемесячно а также более четверти миллиарда запросов к api и основным клиентом от минус из является нашей основной сайт причем эти запросы они сердца не учитывают различные каширования наша польза наша сайт ориентирован на простых пользователей которые хотят выбрать в какой рынков и сходить или хотят поделиться своим мнением это совершенно разные слои населения без какого-либо технического там бэкграунда или интереса разбираться в сложных сайтах поэтому мы считаем что сайт должен быть во первых удобным а во-вторых быстром но я думаю это справедливо для любого сайта на то чтобы сайт был удобным отвечает отдел дизайна а за его быстроту техническую техническая команда ну естественно это совокупность различных задач ну сегодня мы поговорим про ту часть который отвечает отдел разработки что такое быстрый сайта и что такое скорость загрузки страницы какие варианты отличный вариант но и исходя из какого-то там школьного представлении что такое скорость исходя из определения в которое дает pagespeed что скорость странице это показатель того насколько быстро загружается страница ну мы можем сделать вы что скорость и такая математическая величина которую мы можем взять и измерить но именно сейчас я хочу с этим не согласиться реальным пользователям неважно загрузилась страница за 100 за 200 миллисекунд на самом деле даже не важно за 3 секунды она или за 100 миллисекунд загрузилась я что-то нето нажал скорость страниц это восприятие людям важно восприятие как они это чувствуют что вот этот сайт работает хорошо и быстро а вот этот ну как то не очень мне нравится пример из реального мира связаны с аэропортом хьюстон это большой аэропорт с большим пассажиропотоком и у них была такая проблема что было огромное количество жалоб на выдачу багажа ну точнее на скорость выдачи багажа администрация их услышала увеличила количество сотрудников на линии и сократило время до 8 минут 8 минут это классное время ну например там одетого выдают за 15-20 минут багаж и игра количество жалоб все равно не сократилось люди все равно были недовольны начали разбираться и выяснили что среднестатистический человек он за 1 минуту выходил из самолета попадал к линии выдачи и 7 минут стоял ждал и тогда приняли необычное решение начали сажать самолетах более удаленным гейтом и картина поменялась теперь люди порядка 7 минут шли и минуту стояли и количество жалоб сократилось до нуля этот пример про то что этот пример про то что наш мозг так устроен что у него есть активная и пассивная фаза ожидания когда он находится в активной фазе то он сокращает время когда в пассивные на от растягивает и там и там порядка тридцати процентов но я думаю на своем примере все могут убедиться то что 90 минут футбольного матча или 90 минут лекции ну кажется что проходит за разные промежутки времени к чему я это в в вебе точно также есть пассивная стадии ожидания и для пользователя она выглядит следующим образом это пустая белая страница за которой ну абсолютно неизвестно что будет сколько будет грузиться сайт загрузится ну может вообще 500 выглядит ну полная неизвестность давайте разберем классическую загрузку страницы как оно происходит ну естественно загрузка страницы начинается того что пользователь в браузер и вбиваем адрес сайта и уходит запрос на сервер сервер получает этот запрос разбирают какие-то входные параметры и начинает генерировать страницу обращаясь к различным источникам данных и тут хочется отметить что эти источники данных могут быть очень медленны и они могут быть это можно сказать у нас хороший то но это всё это даёт за 50 миллисекунд это история не про нас но нужно использовать чужой api которая естественно мы никак не можем ускорить а пользователь наша хочется чтобы они были счастливы постов как мы получили все данные мы генерируем хтмл отдаем его в браузер появляется возможность подгрузить сторонние зависимые ресурсы и пользователь видит сайт таким какой мы хотели ему отдать но проблема в том что все это время была белая страница но еще вариант проблема это когда увеличилось количество пользователей на холоде часто такие доклады и у них там время увеличилось до 10 секунд люди видят белую страницу нажимают f5 сайты еще грустнее становится но белый танец это грустно всегда в реализацию это могло бы выглядеть примерно следующим образом и где getdata это та самая медленная функция к тому же хтмл муж данном случае должны хранить в памяти usb если значение переменной а и если у нас много медленных запросов ну это приведет к еще более плачевным результатам но быть может не смотря на то что мы вынуждены использовать какие-то медленные источники данных мы можем сделать что но впечатление ну да естественно можем в девяносто седьмом году в рпц был представлен на чанг encoding кодирование по частям которое говорит что можно давать страницу отдельными танками каждый из которых содержит ну всю необходимую информацию в одной этой лежит в основе прогрессивной загрузки страницы давайте разберем тот же самый пример когда у нас пользователь отправил запрос и мы начали получать данные из медленных источников вот здесь мы можем уже отдать какую-то часть страницы обратно пользователю но это может быть какие-то компоненты которые вообще не зависит от данных этом федор или которая зависит от более быстрых данных там пространство пользователя личная это приводит к тому что уже после того как мы отдали 1 порт скорее всего нас ушел так это в котором описаны сторонние ресурсы которые мы хотим подгрузить и браузер их начинает загружать параллельно с тем как у нас генерируется страница сервер дальше ходит на различные источники данных и отдает остальные компоненты ну примерно картина для пользователя выглядит таким образом если заглянуть в код то мы можем прошлый фрагмент модифицировать следующим образом но естественно это приведет к тому что у нас появится несколько логичных логических чанков которые уйдут но этот код не выглядит как-то удобно ну и тогда мы вспоминаем что можно открыть документацию вспоминаем что входящие исходящие это потоки и можем использовать стрим open в таком случае мы подписываемся на поток и реализуем свой класс который будет отсылать компоненты push нал завершит это все а уж с данными это будут какие-то компоненты если посмотреть в интерактиве то это для пользователя выглядит следующим образом финальное время слева и справа примерно одинаковая но я думаю все намного раньше начали знакомиться с контентом на правой странице чем на левый до time the first байт это как раз про прогрессивный рендеринг потому что в используя его он стремится к нулю ну в зависимости от того как естественно все в коде будет организована конкретно день я хотел продемонстрировать что действительно ресурсы у нас начали загружаться по мере ну все параллельно с тем как у нас грузилась основная страница такой подход накладывает ряд ограничений и самое главное из которых это необходимо следить за тем когда вы вставите статус когда redirect и cookies потому что если их сделать после того как отдаться 1 байт то ну с точки зрения пользователя все будет хорошо но с точки зрения seo ну как то не очень потому что места например 301 302 redirect а мы просто локейшн поменяется и для поисковых систем это будет очень негативно ну и необходимо тоже thats и инициализации для того чтобы все было хорошо у пользователей на делать максимально необходимо максимально дробить страницы на компоненты ну во первых это удобно во вторых rt позволяет оптимизировать загрузку страницы и следить за зависимостями чтобы не получилось так что вы используете какие-то технологии такие а сами ставите на самый верхний компонент зависимость от какой-то внутренний внутри него запроса который можно было бы повесить более глубоко и это все блокирует компоненты которые находятся на одном уровне вложенности они погружаются асинхронно и это может привести к такой проблеме что первым закроется компонент который визуально должен находиться ниже и будет скакать контент ну чтобы такого не было надо в таких местах просто добавить placeholder а например facebook в лентах делает серые полосочки такие ну их видно только на медленном интернете ну и как я говорил ранее контролировать redirect и ну всё клёво прогрессивный рендеринг нужен потому что пользователи будут благодарны какие есть варианты сегодня если вы хотите использовать его в своих ну допустим новых или существующих проектах ну мне известны некоторые решения например это модуль для react а это шаблонизатор достать linkedin а или фреймворке такие как кэдбери джесс и марка джесс у нас сайт который содержит много контента который генерирует пользователя и большая часть трафика к нам приходится с поисковых систем поэтому для того решения которое мы хотим видеть у себя нам очень критичностью ну и чтобы было удобно разрабатывать и быстро работал сайт критичность и а из этого вытекает такой пункт как мы хотим видеть серверный рендеринг чтобы это был не какой-то пре-рендер с использованием там фантома например можно было рендерить любые страницы здесь и сейчас за разумное время а скорость разработки явно улучшит а если будет у за мощности компонентный подход собственно у себя на проекте мы используем как берджесс как bergens как раз полностью удовлетворяет нашим потребностям в то что он позволяет писать приложение именно такими как мы и хотели flags архитектурой и серверным рендерингом люди которые используют этот фреймворк получают ну не только framework а а также экосистему вокруг него это различные плагины облегчающие работу для редакторов кода возможность дебаггинга в хроме с помощью специальные утилиты которая показывает содержимое сторож как компоненты на странице их зависимости набор проверенных на продакшене а также покрыты кодом утилит ой плагинов таких как n 10 in a vous авторизация ну консольные утилиты поддержку коллег в guitar чайки в я говорил про компоненты в framework используются модифицированные веб-компоненты они отличают ай да модифицированную веб-компоненты итак эта компонента которые отличаются от обычных тем что серверный рендеринг возможность использовать любого шаблонизатора для которого есть адаптер есть сейчас адаптер для пак handlebar задаст но адаптер это не какая-то магия это буквально сотен строк кода ну если вы хотите использовать какой то другой то я думаю это можно написать на какое-то разумное время и это не должно быть блокирующим фактором и нет в них нет shadow дом ну выделена красным потому что предположим что это недостаток а также они распространяются через интим пакет и у нас есть несколько внутренних проектов мы хотим чтобы они все были в едином фер стиле чтобы перри использовался код ну здорово создать in pm пакет с кнопками там положите и использовать просто устанавливая его небольшое сравнение кэдбери или акта в первую очередь они отличаются подходом к работе с домом в реакции у нас идет работа с виртуальным домом а в к двери это реальный дом который париться с помощью библиотеки мор в дом именно почти джейс икс против любого шаблонизатора и отсюда вытекает следующий пункт это смешивание и разделение логике лично мне очень нравится что можно делить логику и это позволяет распараллелить работа ну например некоторые фичи мы усилим комментируем так что один человек полностью занимается со версткой другой пишет устную часть которая должна отдать данные потом это мер лица без каких-либо конфликтов и не доставляет более а за фича сделать намного быстрее и из коробки у нас разделяет банду на 2 это само приложение и который лжец зависимой модуля это месяц назад буквально за религию фреймворке ну мы это сделали потому что наша личная потребность конечно сначала мы релизимся каждый день архитектура мы устроены так что не делаем ского приз некоторых нескольких фича сделали фичу зарелизили ю ю на закат 485 было релизов ну соответственно пользователи даже активны они не могут попадать на за кашированные версия ну каждый день новый сайт по сути ну с точки зрения всей инфраструктуры и бандл который весит 300 килобайт и невозможно за кэшировать но то как-то грустно поэтому мы начали смотреть выйти что он 70 процентов было сторонние модули ну естественно теперь типа момент же с написав свой аналог но все равно половину его была из сторонних модулей тогда добавили такую возможность что из коробки можно фреймворке разделить их и пререлизе обновлять только то что действительно изменилось если посмотреть например классический пример ту долю вести на 1000 peace нужду на 1000 to react потребляет большую памяти а теперь и чуть менее производителен если сравнить все тот же bangers то мы видим что как берем меньше и кажется ну 2017 год там 350 килобайт 35 ну средний размер страницы вообще он там 3 мегабайта сейчас у нас ну смысле не у нас за борьбе ну что это все не принципиально но давайте помнить что тенденция такая что все больше трафик приходится мобильных девайсов и они всех пользователи которые попадают на сайт мобильных девайсов хороший интернет они могут ехать в метро находиться где-то тут где только 2g или вообще gps и для них это становится критичным а учитывая что проекта бывают сложнее чем тут он висит а эта разница становится более заметный ну как я говорил у нас вандал ведь это 300 килобайт ну наряд не мы считаем что это было бы более мегабайта уже разница более заметная среди примеров есть как небольшие подпроекты лэндинги ну так и большой сервис и это говорит о том что не стоит бояться начать какой-то стартап делать на новой технологии и с тем что когда проект вырастет придется все переписать потому что невозможно имплементировать новые фичи за разумное время здесь такой проблемы нету я чуть позже подробнее скажу себя в команде мы на продакшене используем кэдбери 2014 года а вообще начали всю эту тему 2013 у нас реализовано 4 проекта и все вот это обслуживает 3 фронтенд разработчика ну казалось бы что это все небольшая история но год назад мы полностью переписали весь за это мы создали новую папочку у нас новый дизайн новая история и в новой версии у нас более 300 компонентов и 90100 raw и как я говорил это всего 3 разработчика ну по сути это один компонент в день да мы спокойно можем сейчас инкрементировать новые фичи не боятся что у нас там какая-то сложность архитектурная и не сошли с ума несмотря на все это да я хочется отметить что очень низкий у framework а он boarding то что люди у нас ну происходило тесно небольшая замена людей в команде который приходят несмотря на то что для них это какая-то ну новое вещи новый фреймворк они буквально на первой неделе спокойно могли брать задачи из доски и делать их ну это тоже здорово завершающей чанг прогрессивный рендеринг это проверенное временем технология и и не стоит бояться использовать она поддерживается всеми браузерами а те которые но если у вас пользователь откроют каких-то экзотических девайсов то не знают часов например или станции скорджа с и еще откуда то самое страшное что случится сайт загрузится как будто ну нет прогрессивного рендеринга если у вас очень много долгих запросов которые вы никак не можете оптимизировать ну например это не ваш айпи то это то что определенно поможет сгладить ощущение пользователей на вашем сайте существуют отличные реализации а также можно несмотря на то что там у вас записан пять лет legacy коду вы можете выделить какие-то равные блоки чтобы они отдавались максимально быстро пользователям остальное сайт грузился как раньше это хотя бы уже избавит от лишних непонятных ситуаций у пользователя спасибо за внимание если у кого-то есть вопросы вы можете задать смысле не спас по нет а вопрос такой вы можете забрать бандам допустимо to react и материал сми не фиксированный и сжатый весит 60 кило бать ответственно там плюс ваше приложение там допустим праздник а если будет там либо средних и там 20 40 50 килобайт вы можете целиком отдать приложение клиенту и целиком югу забить дефолтные значениями тем самым буквально через 100 200 300 миллисекунд пользователь увидит полностью готовую страницу почему вы так не делаете но минутках вот я сразу возник вопрос при таком решении как поведут себя поисковой системы как они будут вкладывать этот контент потому как будет происходить его обновление при таком решении это очень просто на web-сервере поисковикам скармливается другая страницу но уже не хотели мы жители жила бы был серверный рендеринг был точно такой же кстати линии но нет он точно такой же только если клиент получает свой ответ мгновенно то поисковики там соответственно либо им удастся кое-что уже кэш уже готовый то есть чисто текстовые или деле чтобы была отдельная версия для поисковиков на сервере чтобы сервер рендерил по-другому на клиенте это было иначе ну то есть мы за стопроцентную и за можешь здесь такую что и там и там все одинаково происходит понятно спасибо и небольшое отступление на залезает был на php ну совсем раньше и просто как мы начали всю эту историю с к двери и у нас существовало две версии еще мы попробовали в консоли подключить поддержку java-скрипта загрузить поспешную версию и на кадре и так получилось что пока пышная оно поломалось на такая стала не огонь какая-то она кэдбери у нас отдалась такая как как будто исключенным java script он естественно там перестали работать некоторые леснер и но с точки зрения картины паркету там но мы получаем страницу абсолютно функциональную ну нет но и просто про серым рендеринг хотел сказать привет скажи пожалуйста у тебя в итоге насколько действительно это по-честному помогает но в том смысле что понятно ты можешь всегда там по при рендере шапку а дальше в любом случае придется дождаться пока ответит backend он тебе этом кинет пачку данных ты все равно должен дождаться пока отработает шаблонизация только ты сможешь от рендерить следующий чанг и подвал который бы казалось бы можно было бы прислать сразу ты все равно должен от рендерить после всего то есть так ли это правда помогает отвечу да по магазину сезон зависит от конкретных страниц ну это говорить про наш пример у нас принципиально есть ленты и карты карточки филиалов и карточки отзывов на карточке отзывов это почти незаметно потому что ну там 1 отзыв ну и комментарии к нему в лентах за счёт того что там только список показатели него непонятно как их отменить и она филиальных страницах которые с точки зрения входящего трафика у нас большей части принимают это очень заметно потому что сейчас я хочу страница филиала но она состоит из очень большого количества компонентов захотим на начало отлетать статус 1917 секунда и отверстие например видно и почти каждый элемент это отдельные запросы и вот эта часть страницы она отдается очень быстро они же которая связана с там тоже идёт лента отзывов для этого филиала какие-то комментарии дискуссии это все погружается позже потому что но это более тяжелые запросы там они могут содержать какую-то информацию что ты лайкаешь кем-то за френ джон еще что это а вот это она и , отдается 100 миллисекунд ленты могут удаваться по моим 250 верно ли я понимаю что при этом запрос в теперь вы отправляете параллельно и в принципе не исключена ситуация что ответ на что то что вообще находится за viewport он прилетит раньше чем ответ на то что сверху ну то есть все равно оно кажется таким как повезет они гарантированно более полезным ну отвечай а именно на вопрос да такое возможно спасибо у меня вопрос почему все-таки отказались от отдачи какого-то более богатого контента поисковикам ну что если вы хотите действительно быстро страница загружалась пал на много лучше таких какой-то легкий layout отдать потом то загрузить какие-то данные но это делается приложения во первых то надо поддерживать два кода это может быть не очень удобно шоу если портной октет может быть просто от рендерить та же самый код сделали голодал и ну вот там флажочки проставил что типа это рендерим для seo поэтому грузим сразу но не могу так быстро ответить на этот вопрос но хочу немножко откатиться по истории что в принципе все это начиналось 2013 году как тогда react еще не был особо популярен он был первых версий но у него не было такого особо набор различных дополнений и ну в наоборот он помощью люди говорили fuji из x равно и как бы не особо хотели его использовать ну как бы тогда мы не могли это использовать потому что не было год назад мы до рассматривали различные варианты но исходя из своих приоритетов каких-то таких внутренних мы приняли решение что это решение решение что это решение что framework до сих пор для нас более приоритетен чем использование реактор но тут даже вопрос не впряг открыт буря отдать легкий layout потом остальное да загрузить по ну так сильно быстрее будет ну мне кажется что то данта экспериментировать и но абстрактно может можно сказать да быстрее а по факту не известно о смысле быстрее по ощущением для пользователя ну как это делает google yandex спасибо"
}