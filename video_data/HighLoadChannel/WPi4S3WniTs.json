{
  "video_id": "WPi4S3WniTs",
  "channel": "HighLoadChannel",
  "title": "Rspamd — высокопроизводительная система фильтрации спама / Всеволод Стахов (University of Cambridge)",
  "views": 1787,
  "duration": 2583,
  "published": "2017-04-22T14:47:47-07:00",
  "text": "здравствуйте я все lots to have разработчик и автор систему фильтрации спама md о которой в рамках данного доклада я бы хотел вам рассказать прежде чем начать знакомство я бы хотел начать с того почему несколько лет назад работая в rambler почте мы решили писать новую антиспам систему дело в том что у нас стоял spamassassin и он перестал справляться с нагрузками перестал справляться с растущим потоком почты и мы сделали следующее мы взяли те правила которые у нас чаще всего срабатывает исследовали каким образом они срабатывают и написал я первый прототип на языке си который реализовывал ту же самую функциональность соответственно примерно вот так он работал то есть до того как мы перешли на рсмд загрузка процессора у нас была под завязку что называется и после того как мы перешли на экспандер загрузка у нас стало позволять в общем-то на 4 серверах фильтровать тот поток который мы раньше фильтровали на 22 серверах если мне не изменяет память и конечно сейчас с пандой оброс различными фичами он начал уметь больше соответственно на начал работать несколько медленнее но все равно пользователем не сообщает о том что после перехода со spamassassin она рпмд нагрузка на процессор падает от 4 до 10 раз но естественно как бы скорость это не все и в фильтрации спама нам необходимо ещё и качество фильтрации спама но прежде чем об этом говорить о бы хотел рассказать общие слова о том каким бывает спам настоящее время я бы сказал что с помощь сейчас можно разделить на две большие группы 1 это мошеннические письма например нигерийские письма ну знаете когда вам предлагают там умершая тетя там перевести наследство несколько миллионов долларов дальше вас ожидают увлекательное общение после которого ваш банковский счет может опустошить ну разумеется есть пара обратные случаи когда некие люди умудрились сами развести этих мошенников и получить не какие-то деньги но для большинства пользователей конечно же нигерийские письма это характерный пример спама который никто никогда не хочет видеть своему почтовом ящике следующие категории мошеннических писем это fishing соответственно это письма которые подделываются под сообщения банков в социальных сетей почтовых сетей и так далее и тому подобное ну и спам как таковой это нежелательная реклама соответственно реклама спамеры могут засовывать либо в традиционный текст то есть просто текста и письмо либо они могут of assets и ровать эти письма например вставляя разные картинки прячет сложные html и применяя другие способы например печатая белым на белом и так далее ну и так же в последнее время стала достаточно часто встречаться спам который подделывается под сообщение социальных сетей то есть вам приходит сообщение которое выглядит абсолютно идентично например сообщение от вконтакте за исключением того что это сообщение от спамеров например на этом слайде вы видите типичный мошенническое письмо вам приходит сообщение о том что например ваш почтовый ящик переполнен в нем есть некоторая ссылка она подделывается под какого-то mail администратора и при нажатии на эту ссылку ваш ждёт много увлекательного это пример письма в картинках соответственно в последнее время такого спама стало достаточно много первое что приходит в голову давайте попробуем эту картинку распознать у нас же есть прекрасный у север и мы можем это сделать но на самом деле если мы посмотрим внимательно на это письмо это письмо состоит из 32 независимо картинка не разбиты различным образом и соответственно составленная потом мы используя html и css соответственно в тупую их попытаться распознать это сложно кроме того это сложно тем что само по себе распознавание она работает но работает невероятно медленно то есть чтобы распознать случайный текст в картинке нужно порядка двух-трех секунд на среднюю такую картинку что соответственно неприемлемо при современном потоки спама какие существуют методики борьбы со спамом я бы выделил также 3 категория первая категория это различные политики то есть этот дайна из списке сплав таким-то марк а также репутация отправителя то есть то насколько хороший или плохой данная пи адрес следующая большая категория мер борьбы со спамом это фильтрация контента статическая фильтрация контента в данной категории мы просто ищем различные паттерна и регулярные выражения или конкретные слова а ну и последнее это статистический анализ то есть в отличие от контент фильтрации в данном методе у нас нет скажем так набора правил набора выражений набора паттернов а мы выполняем классификацию путем одного долга ритмов машинного обучения какие существуют трудности с каждой поль с каждой из методики борьбы со спамом к сожалению не невозможно применить одной из методик и фильтровать весь спам например политик необходимо достаточно много ари сетевых запросов существуют ложные срабатывания ну и это полностью не работает если у нас есть какие-то либо методы пересылки писем например намерен глисты рассылки и так далее и тому подобное контент фильтрация занимает очень много процессор на во времени и необходимо очень серьезно оптимизировать а самая большая проблема с кант инфильтрации в том что она быстро устаревает то есть другой раз по мере берут вашей набор правил проверяет свои письма смотрят что они не проходят решить их изменяют они начинают проходить и в общем-то это борьба может быть бесконечны в это время спам-фильтр вынужден проверять те правила которые уже абсолютно устарели статистический анализ в общем-то перспективная направление развития но к сожалению у него есть свои проблемы самый эффективный алгоритм машинного обучения они пытаются повторить человеческий мозг но когда я пытался например анализировать чужой спам свои нейросетью я понял что она неэффективно работает на данных паттернах то есть я не могу распознать что для вас является spam а что не спал для себя могу но это совсем не обязательно будет являться то тем самым для вас соответственно в многопользовательской системе применять статистику очень затруднительно и такие системы как например без помады srm 114 они основаны исключительно на статистике и они хорошо подходят для персональных почты так же как например ваш спам-фильтр в каком-то почтовом клиенте например thunder birdy но это совершенно не подходит для так называемой смей линга когда вам необходимо обслуживать многих клиентов на данном слайде вы видите как работает мой персональный раз панды который я ставлю принципиальной из коробки ничего не настраивая ничего не делая и это просто моя частная почты она достаточно широко известна на нее приходит достаточно много спама и как вы видите из этого объема почек я не получаю примерно 40 процентов писем а еще где-то процентов 20 я не вижу вообще ну то есть это попадает папку спам по моим наблюдением как бы я не видел ни одного ложного срабатывания из вот этой красной зоны то есть там откровенной очень характерность по картинке ссылки и так далее и тому подобное с помадой предоставляет следующие я бы сказал уникальной особенности отличающие его от spamassassin ади спама и некоторых других спам фильтр off в первую очередь он выполняет нормализацию всего текста то есть он выполняет ли мотивирование далее он работает с текстом только в детей 8 хотя в будущем я планирую это переделать на мид f32 по некоторым причинам он поддерживает настройки пользователи то есть для каждого пользователя можно настроить индивидуальные правило индивидуальные пороги срабатывания индивидуальные веса он может фильтровать спам по нескольким метрикам что это значит это значит что правила можно группировать и результат по разным метрикам будет ра и на основании этих метрик можно выносить более точные и более правильные решения роль спам дэйв есть веб-интерфейс написанное на java скрипте он в общем то сел в контейнер он не требует ничего потому как он шлет ajax запросы на контроллер спд и получает от него ответ и более того в последнее время в 1 помада появилась полная совместимость с большим объемом spamassassin адских правил то есть грубо говоря можно спама сенатские правило взять и полностью загрузить в 1 помады ну и для многих наверное будет плюсом то что spider является упал source программ и и распространять под поезда лицензии соответственно что поддерживает раз панда я попытаюсь быстро про сбежать по всем по всему тому что он поддерживает ну и соответственно он поддерживает с pf таким да марк поддержит dns был поддерживает всю rbl то есть блокировку и рейли поддерживать репутацию и умеет делать репутацию по автономным сетям по сетям ну на основании данных роутинга по ip-адресам а также пост страну но есть плагин для работы с различными списками белыми space кими черными списками серыми и так далее и тому подобное в анализы в контент анализах и соответственно регулярное выражение существует также специальный алгоритм называемый суффикс на и дерево или троя которая позволяет очень быстро искать фиксированные паттерны в тексте то есть грубо говоря этот алгоритм работает линейно от размера сообщения и не зависит практически не зависит от количества паттернах ну и также существуют специализированные плагины для работы отдельные с рассылками с обработка ресивер федоров и с обработкой текстов которые сильно искажены то есть друг говоря заменяется русские символы в латинские символы этот пин или наоборот статистика wars помада это тоже достаточно я попытался и продумать и собрать все лучшее из того что доступно в мире open source и соответственно есть боясь фильтр есть поддержка нечетких и шей для поиска похожих простить для поиска похожих писем и я об этом буду говорить чуть дальше более подробно потому что я считаю что это заслуживает внимание спам на интегрируется в общем-то со всеми известными мне почтовыми серверами но отдельно я бы хотел остановиться на интеграцию с под фиксом потому что для этого я писал специальную программу называемый армий тр которая в общем-то дополняет раз помады и добавляет в него не достаточно много фич которые полезны для работы почты в первую очередь оно естественно написана для раз помадой и работает со всем что предоставляет раз панда например можно делать выборочный грелись think по решению с пандой более того она умеет разделять входящие и исходящие потоки писем это полезно тогда когда у вас есть на одном сервере гориллы в тренированные пользователи для которых не нужно делать проверку но для которых нужно делать или же проверку нужно делать по другим правилам а также он может например не проверять или давать заведомо более низкий балл письмам которые являются ответами на наши письма то есть он сохраняет место чай день смотрит на то что эти письма является ответами на письма наших пользователей прошедших через данный реал и но это соответственно может сканировать а потому как все хранится memcache или и соответственно может можно иметь несколько relative для отправки почты это все нормально работает ну и плюс armelle поддерживают другие методы проверки песнями например антивирус и 10 но здесь ему практически уже нигде не используемые я бы не сказал что его использование как-то поддерживаем а также он умеет поставить подпись на исходящие письма но это в общем то к разделению входящих и исходящих писем соответственно выглядим с версии 486 есть встроенная поддержка спам да то есть это работает из коробки вы настраиваете его как обычно указывая просто вариант равно респауны в сервере пытаясь будто а написано начала скрипты но джесс под названием х-рака также встроенная поддержка с последней версии ну и все остальные mt могут работать через aldo режим то есть грубо говоря они могут с панда может работать как aldo то есть он может запуститься принять письмо в студию проверить его и соответственно выдать в pipe реальному delivery агенту это письмо для доставки следующее о чем бы я хотел рассказать это только устроен эспандер в двух словах можно сказать следующая особенность первую очередь он написан на си язык этот я выбрал ну потому что тогда ему в общем-то не было альтернатив по той причине что патси есть все абсолютно то есть любые библиотеки любой софт все что угодно во вторых язык си является достаточно низкоуровневым и позволяет делать многие вещи достаточно быстро ну и в третьих для языка си существует огромное количество инструментов отладчике ядре анализаторы памяти анализаторы трейдов анализаторы статистик статические и так далее и тому подобное эспандер основан на не блокирующий модели ввода-вывода данных в основном для работы с сетью ну и он может расширяться плагинами написанными на языке lua в основном используется лоджике и разумеется в приоритетах разработки конечно же было то чтобы он работал быстро это было в общем-то принципиальным отличием от spamassassin и естественно качестве расширяемость это тоже были важными задачами портабельная интеграция см3 в общем-то позволяет более просто работать с помадой для пользователей следующее что я хотел получить от 1 помада это безопасность эксплуатации то есть безопасность эксплуатации в дата-центре ну и конечно в последнее время я пытаюсь сделать с пандой более простым потому что я получаю достаточно много жалоб и отзывов пользователей на то что некоторые вещи делаются достаточно сложно по сравнению с там spamassassin буквально потому что для spamassassin написано огромное количество гайдов статей best practice on hold у и так далее и тому подобное и спам д пока есть только официальная документация которая достаточно полная но я бы не сказал что она идеальна и хорошо написано это соответственно будет будущем улучшаться для обработки сетевых потоков распада используя так называемому со бутина или не блокирующую модель соответственно основные плюсы в том что мы можем отправлять все сетевые запросы одновременно а потом и все ждать он достаточно хорошо сканируется но имеет свои недостатки например в языке си ее достаточно сложно реализовывать из-за взаимодействия call back off и в других языках это сделано проще потому что там есть замыкания там есть лямбда функции но к сожалению сейчас уже это поздно переписывать соответственно в традиционной модели обработки данных как например реализован в спам ассасине все правила выполняйте последовательно если какое-то правило захотел сходить в dns у то следующее правило мне не обрабатывается пока мы не дождемся ответа от дайна это плохо тем что в общем-то мы постоянно переключаемся между ожиданием и обработкой и это сказывается очень негативно на производительности хотя я бы не сказал что это ключевая фича с пандой ключевой момент производительности у спама синай на самом деле несколько другие проблемы а именно связано с тем что при его разработке авторы вообще не думали производительности ну как мне кажется в 1 помады соответственно событийная модель использовать следующим образом то есть если правила захотела получить запрос получить ответ от dns это она его посылает и отдает управление до следующему правилу и так далее а в конце обработки мы соответственно можем подождать все вот эти вот запросы которые пришли из сети и сделать какие-то правила на самом деле в реальном мире правил очень много и очень много правил который является асинхронными то есть тех правил которые требуют какой-то работы с сетью и на самом деле дает достаточно большой выгоды потому что мы эти запросы в общем то по своим все скопом а потом получаем всем от всех ответ и в принципе это работает достаточно хорошо с пандой может генерирует очень много dns запросов и очень много запросов в сети например вот в этом письме это письмо общей была создана спамерами насколько я понимаю для того чтобы обрушивать система с системой фильтрации спама например spamassassin это письмо обрабатывал две минуты пожираю при этом полностью целое ядра процессора что в нем не так как вы видите в нем есть тэг hat закрытый а потом прямо в боге есть текст тайтл который в общем то не обрабатывается почтовыми клиентами если вы откроете это письмо вы увидите просто небольшой текстом что-то типа оля привет а дальше в этом tightly находится 20000 гиперссылок реле и соответственно каждая гиперссылка а нам проверяется на много там различных серверов это сербии люди были так далее и тому подобное и каждая такая проверка генерирует свой запрос dns у и соответственно вы видите что пришлось выполнить 120000 dns запросов только чтобы проверить это письмо спам да это сделал в общем-то за пять секунд учит его время ожидания dns но сейчас на самом деле он так делать не будет потому что количество данных запросов и ограничил потому как и как вы понимаете это быстро приведет к тому что на всяких uri белях и прочих сервисов вас забанят за такой трафик ну и соответственно для коротких писем которые составляют достаточно значимая часть потока ожидания составляет очень большой процент от все-все-все времени обработки отведите данное письмо почти секунду ждала ответов от dns а но на процессоре она заняла всего 22 миллисекунды соответственно если у нас таких писем много мы их можем обрабатывать в то время когда она сделает свое дело в общем обработка письма выглядит следующим образом то есть она приходит нам мы обработаем при фильтрами при фильтрах мы можем выполнить например грей листинг при установить какой-то заранее заданный результат то есть те правила которые выполняются до всех и они могут повлиять полностью на все политики например мы применяем в этом месте правило пользователей а дальше мы выполняем все правил между правилам может существовать зависимости причем эти зависимости работают как с синхронными так из асинхронными правилами и в конце мы выполняем постфильтр например мета правил то есть комбинацию других правил в одном правильно раз помадой работает в виде нескольких процессов каждый из которых предназначен для выполнения своих функций но в первую очередь это процесс и для скан скана писем так называемые сканеры процесс есть для обучения это контроллер он также обеспечивает взаимодействие с веб-интерфейсом но есть разные сервисные процессы например хранилище нечетких и шеи сейчас я бы хотел прийти к тому о чем я бы хотел рассказать более подробно в деталях это статистика вырос помады почему это важно потому что мне кажется что статические методы анализа они достаточно перспективно и в общем то есть достаточно большое количество научных му литературы по этой теме и и в принципе я считаю что нужно в этом деле пытаться применять то что ученые считают то что ученые выяснили помогает лучше в первую очередь с пандой используют не отдельные слова и словосочетания так называемой цепи маркова но вы можете их представить как просто слова сочетания двух слов в предложении не а дальше ним несколько разъясню это кроме того с пандой учитывать метаданные то есть определенные заголовки маем boundaries использует название файлов использует мета информации из изображений то есть он пытается по максимуму извлечь информацию которая характерна и специфично для спама или хама статистические данные хранятся сейчас вы skylight в будущем я планирую поддержку редиса в этом месте но пока что есть делает меня устраивает полностью синхронизация соответственно и и скалирование статистике выполняется достаточно простым методом то есть мы обучаем все сервера если какой-то из них не обучился мы обучаем все еще раз потому как он вор спам то есть защита от переобучения темы одним и тем же письмом для генерации токенов мы используем так называемая биграмм а то есть мы разбиваем слова разбиваем предложение на словам нормализирует словам то есть выделяемых основу а затем мы делаем некоторые окно в данном случае с 5 слов и выделяем из этого слова все педро мы по порядку дальше мы это атма сдвигаем и делаем тот же самый процесс еще раз но на самом деле там на типы драма дальше используются формуле байеса с полной вероятности и они используются там во взвешенном виде то есть грубо говоря вес каждой биграмм и зависит от позиции в предложений то есть в позиции вот это по которой написаны справа соответственно в таком методе в отличие от того что например реализовано spamassassin некоторые используют отдельные слова мы можем использовать не только слова но и сочетание слов и достаточно характерные признаки и это уменьшает вероятность ложных срабатываний что очень важно на данном слайде я показал то как мы попробовали обучить новую статистику в одной из новых версий 10 эспандер используя достаточно сложный корпус то есть это в основном письма с картинками где практически никакой информации нет они достаточно маленькие то есть сложный вариант для байеса мы взяли 400 писем из которых 200 было спама 200 хама соответственно мы разбили каждый корпус еще на 2 и получили по 100 писем спама 100 писем хама а потом взяли оставшиеся 200 писем и проверили как хорошо он работает на тех письмах на которых мы не обучались соответственно мы поймали где-то 95 процентов спама пять процентов мы соответственно не пометили как спам но не пометили как хам в том в том числе и распознали 92 процента хаму фолз позитивов в этих тестах мы не видели и это является достаточно хорошим показателем который в общем то нам очень понравилась потому как polls позитива это общем-то то с чем мы очень хотели бороться и очень нам не нравилось когда были монограмму а второй способ статистического анализа это не щетки и хэши не щетки хэши это алгоритм для поиска похожих писем то есть мы смотрим на письмо и смотрим не встречалась ли нам похожего на это письмо в спаме или хами для вложений соответственно которые мы не можем разобрать мы применяем просто криптографический хэш чтобы посмотреть не было ли такого же точно изображения храним и этих и 6 кило эти тоже в специальном сервисном бургере такая же точная синхронизация с обучением всех алгоритм используется так называемый алгоритм шин глав горит мы тот достаточно прост и он является на самом деле вероятностным но детерминистские то есть для каждого письма он будет всегда выдавать один и тот же набор этих шагов для вычисления шилов мы делаем следующий мы берем некоторые окно опять же в данном случае это три слова потом от этих трех слов мы берем хэш одного типа потом берем хэш другого типа потом уберем n 1 разных вещей то есть это н разных вещей и и дальше мы получаем вот такую таблицу то есть для каждого слова у нас существует для каждого окна существует м хэшей после чего мы выбираем из каждого из этих engage и минимальные то есть на самом деле мы выбираем случайные слова в тексте которую мы встретили то есть этот алгоритм работает просто по методу как бы случайных чисел по случайному распределение и в итоге мы получаем на выходе яншин глав и дальше мы просто мы просто сравниваем то количество шин love которые совпали у нас базе соответственно используем в качестве хэш-функции хип-хоп с различными ключами так как мы выбираем ключ каждый раз генерировать мастер-ключа то мы можем сказать о том что если мы держим эти данные в некотором секрете то злоумышленник не может подобрать такое письмо чтобы обмануть это алгоритм ну соответственно написано дальше размер окна мы используем три слова хэш-функции мы используем 32 штуки если мы пытаемся использовать больше это не дает улучшение производил учение матч инга но за при этом достаточно существенно замедляет работу для обеспечения производительности раз помадой применяется достаточно много разных приемов о которых я бы хотел вкратце рассказать общий принцип это то что мы должны думать о производительности всегда то есть при написании любого кода при написании любых алгоритмов при выборе любых алгоритмов первое что нам чем надо думать это как это может работать быстро если что-то можно не делать каким-то образом пропускать оптимизировать этого не делать если есть какое-то частное решение которое работает быстрее чем общее например 1 м лерны и вставки то лучше применять их если это возможно и наконец следующее правило за которой меня на многие могут критиковать это то что если можем сделать что-то примерно но достаточно точной или абсолютно точно но очень долго это выполняется то что мы будем делать примеру характерный пример это например когда spamassassin для поиска ресивер хидиров выполняет около старик экспорта есть он находит все возможные риски вид заголовки от всех возможных путей от всех возможных систем пересылки но на самом деле нет но тем не менее он выполняет очень большую работу для того чтобы попытаться извлечь всю возможную информацию эспандер ищет что-то похожее на заголовке от агрессивных заголовки и в большинстве случаев я бы заказал 99 9,99 процентов он их находит верно но в некоторых случаях например gmail он их находит не совсем верно но к сожалению кем вообще выдает выселить заголовках информации который абсолютно не нужна для спам-фильтру для оптимизации правил применяется общем-то два подхода первое это глобальная оптимизация то есть оптимизация всех правил вместе то есть мы не проверяем правило если письмо набрала больше баллов чем нужно на а максимальная оценка то есть на отклонение но для того чтобы избегать фолз позитивов мы в начале обрабатываем правило с негативным весом ну используется жадный алгоритм который пытается выполнять правила которые выполняются быстрее или же чаще срабатывает в первую очередь потому как вероятность того что они нам дадут значимую оценку гораздо выше чем у всех остальных ну и периодически мы это дело пересортировать и постоянно планируем планируем правило так чтобы они выполнялись оптимальные каждое правило соответственно еще оптимизируется некоторыми локальными оптимизация my то есть каждое правило в раз по мне пытается сделать что-то лучше чем можно в первую очередь это касается конечно правило регулярных выражений все регулярное выражение в спам д строится в абстрактной синтаксическое дерево элементы в этом дереве также упорядочиваются исходя из того как часто срабатывает правила и 100 исходя из глубины дерева и исходя из того насколько большой насколько долго выполняется правил кроме того мы используем pc ridgid для того чтобы использовать fast pace в по царе ну и все ло правилам и компилируем в lua джейд опять же которые очень большую производительность для достаточно большого набора правил для оптимизации а с т мы применяем следующее то есть если у нас есть некоторые ветви то мы можем попытаться их пропустить то есть вот допустим в данном примере мы видим правило c и не а или б мы в данном месте мы видим что c уже ноль соответственно все что у нас находится справа нам вычислять не нужно и на самом деле это на практике дает очень большой прирост правило производительность особенно когда используется правило spamassassin а потому как они внутри себя не очень-то оптимизированы то вот такая вот их оптимизация внутри одного правила достаточно серьезно помогает кроме того правила могут некоторые некоторые операции могут объединять не два правила а несколько так называемые анар на и правила то есть мы хотим чтобы сработала например с большого набор регулярных выражений хотя бы два из них и вот в данном примере видно что допустим тут сработала три правила и все что дальше мы опять же не проверяем потому что мы знаем что это правило и так уже сработало так же мы образ пандой применяется различные оптимизации библиотеки си потому как библиотека сие не очень-то подходит для файлового решения бы сказал и постоянно приходится придумывать разные велосипеды чтобы не использовать костыли например зиру и цены на эти strings соответственно применяется собственно реализация printf изначально заимствован из яндекс и переработанная под собственной структуру данных потому как стандартная реализация printf к сожалению опять же не подходит для большинства задач связанных с производительностью в первую очередь из-за того что она всегда пытается вычислить необходимый объем даже если мы пытаемся передать маленький буфер и очень большие входные данные и это в общем то большинстве случаев оказывается очень плохо и неприемлемо для работы также оптимизирован оптимизировал я и строковые функции например кодирования б с 32 b64 хотя казалось бы это очень традиционная операция на к сожалению найти алгоритм который бы работал быстро и удовлетворял например кодированием в 64 определенному стандарте маем то есть разбивал на строки разбивал по определенной длине мне в природе найти не удалось также большой задачи помнят когда я смотрел на графике производительности увидел что большую часть времени с помадой проводят приводят тексты к нижнему регистру пришлось опять же это место переписать оптимизировать использовать достаточно примерно и преобразование в youtube в случае это f8 потому что точно и преобразование это дорого сложная и связано с выделением дополнительной памяти ну и как я уже говорил везде сейчас пытается использоваться сроки фиксированной длины также используются эти алгоритмы которые сейчас является state of art в плане производительности в случае хэш-функции это и xix fresh & black 2 x exage это не криптографическая функция b2 это к личным стилистом павшим а также используется быстрые алгоритмы шифрования написана на ассемблере все данные выравниваются для того чтобы можно было сделать определенной оптимизация то есть на современных процессорах выполнение операций с не выровненными данными и выровненными данный может отличаться на порядок или даже 2 ну а также постоянно производится оценка а узких мест и производительности responder наверно это не так важно кроме того раз помады некоторые акцент уделено и безопасности то есть с пандой шифрует мог или может шифровать и лежишь уже шифрует все данные которые передаются по сети то есть запросы к хранилищу нечетких и шеи запрос между клиентом и сервером сейчас планируется внедрение шифрование в веб-интерфейс а также в dns это тоже уже есть нужен только сервер который поддерживает шифрованный отдельный запрос и то есть некоторые проблемы основные принципы работы с безопасности вас помадой в общем то следующий то есть писать на сие безопасный код достаточно сложно и для того чтобы это делать нужно постоянно производить анализ статический анализ смотреть как работает различные функции и так далее основные угрозы которые я рассматривал в рамках спам это взаимодействие соответственно с dns а также прослушивание трафика в дата-центре которая в общем-то это больше реальность чем воображаемые угрозы но также работа с специально созданными вредоносными сообщениями например письме может содержаться очень много гиперссылок spv записи и другие технологии применяются имейлах могут иметь бесконечную рекурсию соответственно мы применяем лимиты на все операции которые потенциально могут занимать очень много ресурсов в dns мы применяем криптографические средства для шифрации dns айди протираем исходящий пор трактиру импалу сокетов рандомизированы порт фильтруем входные данные например преобразуемых вдм для доменов и tf 8 которые в последнее время получили распространение ну и соответственно мы шифру им весь трафик между сканером и клиентам соответственно мне используем tls потому что tls это слишком серьезно и колдунство для данных задач особенно это сложно в плане того что необходимо переделывать все все модели ввода-вывода в случае не блокирующих соединений чтобы она работала вменяемость л.с. соответственно я разработал некоторый протокол который использует так называемый крипто бокс дэниэла бернштейном и является достаточно легковесной заменой tls а и в общем-то выполнять шифрование степи запросы достаточно тривиальным образом то есть теперь запрос капсуле руется во внешних теперь запрос в него добавляется данные необходимой для шифрации например публичный ключ клиента публичный ключ сервера получается через dns проверяется также через dns то есть либо там цифровой подписью либо через дон acer а дальше с первого же запроса на сервер мы все данные шифру то есть у клиента есть собственная ключевая пара у сервера и собственная ключевая пара ключевая публичный ключ сервера известен клиенту он соответственно публичный ключ клиента находится во внешнем уж теперь запросе в хадере cookies соответственно в посрамим стелсом которые требует как минимум четыре round trip тайма для установления соединения в случае про такого которое назвал степи crypt нам нужен всего лишь один мы начинаем передачу данных с первого же пакета и передачи данных ничем не отличается протокол http то есть мы никак не меняем взаимодействуешь эти пиццы клиентам но я произвел некоторые измерения сравнение htp crypt и dls а то есть я использовал последнюю версию по нас цели где были очень хорошо оптимизированы эллиптические кривые в частности не ест по 256 и сравним в общем-то кэшированные соединение то есть это те соединения которые мы уже раньше видели те клиенты и соответственно не кашированные соединение как вы видите в общем-то протокол работает достаточно быстро если мы посмотрим как сканируется протокол от количества рабочих процессов то видно что сканируется он в общем то тоже неплохо шифрования была написана при помощи эти инструкции то есть это чаще 20 поле 1305 и 55 19 для обмена публичными ключами а соответственно точно так же на задержку соединений лилей tense целость вносят достаточно серьезные коррективы в случае rush типе crypt задержка установления соединения практически не отличается от низа не зашифровано средний для новых соединений это еще больше заметно ну соответственно работает он быстро потому что используется более быстрый криптографические примитивы хотя есть и сравнение с теми же самыми примитивными то есть окон из целей там и там нет подписи данных и соответственно не шифру не используется промежуточные буферы для копирования укроется у нас все in place соответственно применяется он для всех шифрации и а также аналогичный принцип используется для шифрации египет трафика для шифрации запросов к не четкому нечетким хишам а также в библиотеке dns а там используется более стандартный dns киров соответственно am в конце свое доклада я хочу сделать следующее обобщение того что я рассказал во-первых раз панде спроектирован так чтобы обеспечить максимальную производительность в 1 по мной достаточно много правил и и он в общем то соотносится достаточно хорошо по качеству фильтрации с там ассасинами другими state of art системы ну и кроме того спам d может обеспечить достаточно высокую безопасность вашего почтового трафика в дата-центрах путем шифрования и принципов безопасного проектирования самого проекта спасибо за внимание это все сегодня здравствуйте спасибо за доклад у меня вот не понять вопрос по поводу обучения байеса сказали что боясь есть о том самом начале сказали что как бы боясь для каждого свой но вот и здесь как бывают не раскрыть это вопрос за счет сейчас есть боясь об общем так не боясь по пользователям то есть для каждого пользователя для каждого домена или по более тонким правило можно строить свой боясь это 1 2 есть разные байт для разного языка то есть с пандой пытается определить язык сообщения для русского для английского для китайского и это все является различными классами различными статистическими данными и боец используется как один из факторов то есть он не является принимающим решение например д спам это только боясь crm 114 это только боясь а тут мы остановимся на многих факторах в том числе и на боясь нет вопрос про то а кто обучает на тоже готовить обучающей выборке разумеется но и готовит либо администраторы если мы обучаем какой томас mail то есть мы постоянно мониторим трафик и смотрим чем его нужно обучать что у нас какой актуальный спам то есть вот рамиль терна прям может зеркалирование фиг и можно сделать систему где можно мониторить что у нас отсеивается что у нас фильтруется что у нас проходит какой спам приходит какой храм приходит и на основании этого постоянно производить до обучения ну и соответственно в случае если вы построите свое собственное почтовую систему то есть веб-интерфейс через который можно обучить для себя боясь ну а производительность производительность чего ну обучать же это как бы долго много особенно если использовать персональный боец то производительность системы как это будет влиять ну вы понимаете если вы хотите качество то вы обучаете если вы не хотите этого вы не обучаете тут сложно что-то при помощи спасибо спасибо за спасибо за доклад хотелось бы поинтересоваться как происходит интеграция с их зимам через отсылали через local сканы по-моему это называется нет это неловко лавка то есть сейчас spamassassin и ac помада используют один и тот же год то есть они находятся у них файле спам . си и там пишется спам сканер адрес и вариант спасибо за доклад у меня вопрос насчет и себе крипто для чего вы используете для связи между серверами через интернет для связи между клиентом на примером да и ли эрми литром и сканером а понял хорошо так тащишь рот страхи дата-центре понял еще вопрос и все четыре у вас какая реализация вас быстро какая-то особенная да я специально написал там используется две ключевые технологии первое это мы короче берем символы и засовываем их в 6 четырех битные интерьера дома 64-битными интернет работает все быстро в общем по сути она аналогична оптимизация мем спай например функции в некоторых lipsy то есть бизнес с ей инструкции да но она направлялись реализации из google chrome у них известно как самое быстрое реализация сhrome не сравнивал другими сравним но понимаете там еще вопрос некоторые лицензии и если лицензия позволяет я заимствую это что хорошо работает но большинство это лицензия нам gpl 2 как водители gpl 3 который spensers на bsd коде использовать нельзя спасибо всего спасибо"
}