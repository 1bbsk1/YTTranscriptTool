{
  "video_id": "YpMF28LxVo8",
  "channel": "HighLoadChannel",
  "title": "Мониторинг сложных систем в 2019 году / Евгений Потапов (ITSumma)",
  "views": 3002,
  "duration": 3223,
  "published": "2020-04-27T12:08:37-07:00",
  "text": "всем привет меня зовут я генеральный директор им понять и сумма то чего чаще всего нет хотя может быть мы думаем что то есть мир сильно изменился и я хочу посмотреть на то как сейчас 2019 году выглядит мониторинг сложных обнаруженных проектов и как нам с этим жить ну что вообще происходит вообще почему я говорю про мониторинг наша компания работает с 2008 года мы занимаемся преимущественно управление инфраструктурами и круглосуточной технической поддержкой в проектов по всему миру нас сейчас 100 человек у нас головной офис городе иркутске и обществе в москве и питере и небольшое сша и на поддержке на сейчас порядка более 400 клиентов если говорить в процентах это порядка 15 процентов электронной коммерции в россии много известных магазинов много известных стартапов и у нас на поддержке очень разнородной архитектура и для того чтобы все поддерживать мы должны смысл в том что если что-то падает должны прийти и через 15 минут начать это чинить желательно конечно в самом начале сделать так чтоб это вообще было работала надежно что потому что билась под трафиком чтобы если пришло куча людей мы могли это выдержать если что-то сломалось могли куда-то переключиться ну а если уже произошла какая-то большая аварии мы пришли из стали товаре исправлять для того чтобы понять чтобы что авария произошла нужно соответственно мониторить проект и реагировать на какие-то инциденты а чтоб мониторит проект нужно примерно понять как его мониторить и вот я бы сказал что термин мониторинг 2008 года и термин мониторинг 2018 года различается капитально и главная проблема заключается в том что мы почему-то продолжаем верить что мониторинг это что то такое что было в 2008 году ну с точки зрения программных компонент и если как бы упростить название водопада то мой доклад называется организация правильный система мониторинга и честно говоря я считаю что в плане организации правильной систему мониторинга происходит беда потому что если большой беды в организации правильной систем мониторинга не было то мы бы доклад сегодня стоял вот это в одного слайда я бы сказал установите пожалуйста про металл спрос grafana и плагины раз-два-три сказал все будет хорошо и сказал спасибо за внимание задавайте пожалуйста вопросы к сожалению так нет я боюсь говорить резко но вот в отношении организации систем мониторинга как мы их видим как это происходит других проектах и как и даже происходит у нас я могу почти от всей души сказать что проекта с грамота мониторингом не существует и ситуация настолько плохая что мы либо понимаем что мониторинга у нас грамотного на проекте нет либо мы почему-то думаем что мониторинг есть и мы защищены но я все равно нет ничего не работают если что-то упадёт все равно мы вполне возможным и это не заметим и проблема заключается как раз в том что я говорил про 2008 и 2019 год вопрос заключается в том ну фундаментальный такой менеджерский вопрос когда запускается проект по мониторингу сколько людей слышало слушайте мы тут зарелизили теперь за монитор пожалуйста и кто этот мониторинг его выполняет ну то есть вот есть некий devops лесники админ к нему приходит команда разработчиков говорит мы зарелизили за мониторе что за мониторю ну как бы а как это работает а что с этим делать и как она взаимодействует и пока то мониторе шана уже берет изменяется выяснится ширмой завел сервиса который остался улицам б который взаимодействует сервисом c команда который приходит к эту поставь софт он же должен сразу мониторе 2007 год все прекрасно существует там пара разработчиков один сервер 1 1 сервер баз данных и вот здесь лежит карп корень проблема оттуда все это идет то есть у нас есть некая info куда поставим zabbix на гилас когти на 2008 год когти и дальше выставляем какие-то более-менее понятной alert энн циpкa на работу дисков на места на дисках и так далее и делаем пару ручных проверок что сайт отвечает и что заказы в базу приходят но в принципе все мы более менее защищены если сравнивать количество работы которую админ devops из тогда было слово devops было наверное немножко делал обеспечение мониторинга у нас было девяносто восемь процентов автоматической работы человек который занимается мониторингом должен понять как поставить zabbix как его правильно настроить и как сделать так чтоб летали alert и и человек который занимается мониторингом там два процента времени занимается тем что создает какие-то внешние проверки то есть делает проверку что отвечает делает запросе куба за что новые заказы появляется все этого хватает в голове у человека по проекту когда он ведет проект по мониторингу есть понимание штуки я за мониторе работу инфраструктуры я за монитор время твиты сайта я за мониторе обновление заказов все это то что должен контролировать там три вещи посты довольно 2010 год у нас растет нагрузка мы начинаем спилить вы бы мы добавляем какой-нибудь поисковый движок мы хотим понять что каталог товаров содержится товары что поиск работает что база по-прежнему работает что заказы делаются что сайт отвечает внешне и у теперь уже отвечает с двух серверов и там пользователь не выкидывает сайта пока перри балансируется на другой сервер и так далее понимаете да стучите становится больше причем сущность вот так которая связана со структурой она фактически и меняется по-прежнему остаются в голове что человек который занимается мониторингом то человек который поставит zabbix который ground он имеет того конфигурировать но при этом у нас появляется работы по пьяни внешних проверок при этом у нас появляются работы по созданию скрип для поиска запросов к индексатор поиска у нас появляется набор скриптов которые проверяют что поиск меняется в процессе индексации ну то есть по новой товары на предавались поиск у нас появляется набор скриптов которые проверяют что службе доставки передаются товар у нас появляется набор скриптов которые вы так далее так далее так далее знаете самая крутая то что я посредине это минут три потом разговоры про этот слайд говорил набор скриптов набор скриптов набор скриптов набор скриптов это больше не человек который останавливает запись это человек который начинает ходить по сути но в головах у людей по-прежнему остается за мониторим проект окей там мир потихонечку усложняется все больше и больше все больше и больше все больше и больше мы берем добавляем слой виртуализации мы добавляем несколько новых систем система начинает заменить между собой это начинает уже попахивать микро сервисами но каждый сервис в отдельности все равно еще выглядит как сайт то есть да мы можем к этому сервису обратиться и понять что он там выплевывает свою свою информации сам по себе работает но окей ну там был все хорошо дальше мы мы мы мы мы мы рой из винить с прислали мы с этим жили и пока админ пусть это админ проекта когда развивается 2008 по 2018 год у тебя эти знания накапливаются постепенно то есть ты сначала жил постом проекте потом появился новый уровень ты его осознал потом появился новый уровень ты его осознал но как бы редко кто сопровождает так 10 лет предположим вы пришли в новый стартап этот новый стартап сразу набрал 20 разработчиков написал 15 микро сервисов а вы админ которому говорят построить и пожалуйста сиди вы построили соседи он сказал им вам сказали что вы знаете нам сложно работать с продакшном в кубике не понимаю как в этом кубики будет жить наше предложение приложения сделайте нам пожалуйста песочнице в этом же кубики вы делаете песочнице в этом же кубики вам говорят о мы хотим себе стыке базу данных который обновляется каждый день с продакшен чтобы мы могли понять что это работает на базе данных но при этом не испортить продакшен бардан вы в этом всем живете остается две недели для релизов вам приходит и говорит а теперь за монитор все пожалуйста ну то есть не только у острова инфраструктуру на мониторе микро сервисный архитектура заработали за монитор работы с лишними сервисами и так далее так далее так далее вот вам приносит такой схемы игры здесь все понятно за моей той пожалуйста поставь программу которая это все за мониторит по сути все у нас при этом голова остается все то же самое вот где-то там у нас сидит devops который поставит про митрофана и z z z поймет что что вот вот здесь нарисована и сможет все правильно за мониторе тебя недельки две сделай так что все было надежно ну нет теперь смотрите в куче проектов которые мы видим по-прежнему мониторингом например выделяют одного человека и вот представьте себе что мы хотим на две недели нанять человека который займется у нас этим мониторингом там составляемом у резюме чем должен какими навыками если посмотреть уже на все предыдущие проанализировать какими навыками должен обладать этот человек он должен понимать мониторинг железной инфраструктуры ну и специфику работы железо инфраструктуры окей мы-то понимаем появился кубик все хотят все программисты хотят в кубик потому что это удобно потому что можно абстрагироваться от всего остального искать со всем остальным разберется админ надо понимать специфику мониторит как оберните со как само по себе какого мастера его самой инфраструктуры и понимать как мониторить приложение внутри не приложение там но по сути жестяной остаются ну как сказать некими виртуальными машинами у которых есть потребление циpкa памяти дисков и так далее теперь еще чувак который занимался мониторингом devops должен понимать что сервисы между собой общаются как какими-то особыми способами и например вполне реально видит проектную вполне абсолютно понятная вещь где часть сервисов общается синхронно потому что но иначе никак нельзя например не знаю backend идет по расту или там почему тупо джерси к сервису каталога получает список товаров возвращает обратно нельзя ждать тут несинхронная работа а с другими сервисами он работает асинхронно например потому что поставили кафку и в кафку там не сильно важно ну срочная работа так раз нужно работать асинхронно поэтому сообщение летят в кафку и возвращается обратно вы наверное начинаете уже плоть от того что рассказываю о админ которому отказали за мониторить плывет еще больше при этом поскольку работа становится все больше и больше это фактически надо планировать а чтобы планировать надо понять как ты это будешь планировать создать некую стратегии с того сервиса который мы сделали чтоб понять как это конкретно за мониторить то есть у нас получается знание железной инфраструктуры здания кубер нити со-знание мониторинга железо инфраструктурой кабинете со умение планирование навыки планирования и навыки правильного планирования потому что у тебя две недели ты как ты должен там распланировать то все время чтобы ну уместиться хоть как-то в этом времени понимание всей архитектуры проекта как она работает чтобы и за мониторить и понимание технологии использующих разработки абсолютно нормальный кейс часть сервисов для php часть сервисов нога часть сервис станок г.с. они как-то между собой ну работают вот я сейчас надеюсь что цель до знаете откуда взялось слово микро сервис и потому что отдельных систем стало так много что разработчики не могут понять проект в целом так вот они там часть команды разработки пишет сервиса роджерс которые работают сами по себе и не знает как работает остальная система другая команда разработки пишет сервисы на не знаю но питоне и не лезет в то как работают другие сервисы они изолированы в своей области третья команда пишет сервисы на там пышечки или чем-то еще вот они все разделены эти 15 человек разделены 20 человек пятнадцать сервисов есть один админ который должен все это понять но мы только что разбили систему нами курсировать за потому что 15 человек понять систему не могут а это надо как-то все за мониторить то есть фактически у нас получается что когда мы выделяем одного или двух человек у нас получается один человек которому в голову входит все что не может понять вся команда разработки и при этом он еще должен обладать дополнительными навыками познание так работы инфра прозвание того как работает кубик про знание того как работает как мониторить все что написали программистом и так далее там ребята вы в беде фишка в том что ну главное что нужно сейчас понять что мониторинг современного программного проекта сам по себе программный проект поднимите руки пожалуйста кто закладывает приличное время на обеспечение мониторинга при разработке большого проекта а в каком этапе это делается очень правильно звучит а где бизнес при этом говорит вы хотите нам пожалуйста 10 новых фич как можно быстрее и как бизнес относятся к тому что вы скажете что типа ребята сейчас мы еще 30 процентов времени кроме разработки и тестирования и бизнес понимает что разработки достанет нормальный срок потратим на то чтобы пытаться в 20 лет за мониторить то есть главное что пытаюсь донести что мониторинг это вообще больше не софт нельзя поставить zabbix и все заработает нельзя поставить графа но и думать что все заработает большая часть времени уйдет на организацию проверок работы сервисов проверок взаимодействие сервисов проверок того как работает или нет внешней системы проверок того как у вас и знаю работает api шичко фактически вот эти 90 процентов девяносто восемь процентов времени даже больше не скриптик авто писания но ты тоже большая ошибка это разработка программного обеспечения и этой разработки должна заниматься команда которая понимает работу проект из одного человека скинуть за мониторе себя пожалуйста случится беда оно случается везде ну как бы а из болезни что мониторинга the soft у нас возникает веры в какие-то чудеса вот у нас есть например несколько сервисов несколько сервисов общаются между собой через кафку они вот там сообщения не знаю там дальше не будет пример пришел заказ мы сообщение с информацией о заказе от проливе лев кафку а дальше мы не знаем какие сервисы слушать-то если тренер сервис который слушает информация заказе и проводит отгрузка товара сервис которые слушают информацию о заказе и проводит прислали письмо юзеру сервис который слушает информацию по топлива там они еще появляются дальше вы уже тут снова путайте тоже путаюсь и потому что это сложно но люди верят что можно поставить плагин для про метаться который за мониторит кафку и который все это схему поймет нет не поймёт а молотова если вы это еще передадите ну урагана за работу админом или к разработчикам или кому еще на этапе когда тандыр лиза осталось круга отверткой время человеку нужно понять будет весь этот протокол то есть проект подобного масштаба занимает значительное время разработки системе это должен быть заложена очень часто ну в особенно в горении в стартапах которых мы видим мониторинга складывают а потом час мы сделаем круг в концепт с этим против концепций за пуд за пустимся пусть он падает мы готовы жертвовать а потом мы свет за мониторе мне потому что когда если вам вдруг неожиданно станет работать так что вам нужно то за мониторить потому что начнет приносить деньги бизнес захочет полить еще больше фич потому что ну типа она начала работать зачитаны накручивать дальше значит надо еще больше fitch накручивать а вы находитесь . где надо за мониторить все предыдущие что занимает уже далеко не один процент времени она значительно больше и кстати для мониторинга нужны будут разработчики разработчиков проще пучить пустить на новые фичи и вы пишите новые фичи они еще больше нарастают и надо это за мониторить и вы за этого заходите два месяца спустя а там еще новые фичи мы в до блоки просто ну как в бесконечном цикле фактически ну как бы я заранее хочу извиниться перед некоторые все-таки верили что хоть и пришли на доклад с точки зрения того что вот я приду расскажу что есть графа на с помощью нее можно сравнивать метрики пожалуйста сравните данные за последнюю неделю или мы рекомендуем сравнить данные с медианой за последние 4 недели у меня немножко не про это я немножко про более высокий уровень по сути я хочу поговорить о том как как правильно за мониторить проект начиная с начала или что делать если вам уже достался проект кто и нужно за мониторить а вы ну с чего начинать блин реально очень много раз вижу когда происходит ситуация когда разбудив devops испускают задачу за мониторе проект и он такой хорошо пойду поставлю prometheus кто-нибудь начинает код с того чтобы ok супер запущу шторм или там окей круто я поставлю значит вот эту база данных или запишу вот этот кусок кода дальше потому что делать нет нужно планировать то есть мыть в чем проблема если вы не знаете ну идея в чем если мы давайте давайте начнем планировать планировать мы предлагаем но я я считаю что нужно сверху очень много проектов по мониторингу который я вижу стадии когда мониторинг пришел когда проект уже работает начинается того что вы не то ритм фру но киевом и не таите инфра например не знают очень разные кейсы окей круто короче вот у нас каберне this начнем с того что поставим prometheus с графом и поставим графа ну плагины под мониторинг кубика наверное умные люди знают как мониторить графа ну там сотня плагинов в каждой по 1000 человек и нет не знают потому что большинство людей просто у нас вообще сложилось вера от раньше это была только у программистов что возьму либо и либо где вам может совсем современный стиль км у нас появляется и в обсе такая практика что я возьму вот этот вот этот плагин плагин то наверное знает как сделать блин вы вначале решите что хотите за мониторить и как ходить за мониторить а потом уже пузырьки инструмент потому что люди за вас подумать не могут другие потому что они думали про себя или про какую-то универсальные системы или вообще не думали когда этот плагин писали это что у этого плагина есть пять тысяч пользователей не совсем означает что этот плагин вообще ими несет какую-то пользу возможно просто у него пять тысяч пользователей поэтому вы станете 5000 первым потому что выделишь там 5 тыс человек если вы не понимаете что приложение работает то есть вот вы начали мониторить инфу а работать или нет приложения вы не знаете у вас есть не знаю пусть это мобильное приложение и у него есть backend который вы собственно мониторить и если вы стали мониторить инфу я с бэк-энд какой-то причине перестанет отвечать все пользователи потеряют связь с мобильным приложением улетит ошибочка к вам придут и скажут ребят приложение не работает чем вы занимаетесь как бы мы мониторим сейчас так что же вы мониторите если вы не видите что приложение не работает я считаю что начинать надо именно с точки зрения мониторинга входа пользователя потому что если пользователю приложения не показывает центов за из атак тож пользователь может быть это какие то and user и сам белками может быть это какая-то инфраструктура в вашей компании кто угодно если юзер не видит что система работает то это все это капитальный провал то есть это то что тот почему прибегут и скажут забей на все начинает справлять ты будешь кота как то исправлять систему мониторинга должна об этом предупредить первую очередь уже потом мы должны за мониторить инфраструктуру или сделать это параллельно потому что инфраструктуры все гораздо проще в структуру мы можем поставить плагин щекино здесь лет десять лет zabbix а и всего остального затем уже сначала мы поняли сначала за мониторим где ситуации с бизнесом приложение потом и за мониторинг ситуации чтоб понять что там во сколько самое простое что не за инфо или нас прислал работы бизнеса затем зайдем в корне приложение чтобы понять вещи происходит тезис которая пытаясь донести последние десять минут мониторинг должен идти параллельно с процессом разработки то о чем я говорил что если вы взяли команду утащили ее на devops на devops плане того чтобы строить себе песочнице разработку и так далее а потом вы доберетесь потому что я уже писал что софта нету который можно поставить за мониторить это не нужно поэтому если вы вот в этот цикл войдете вы скорее всего ну вот по нашему опыту что мы видим и не остановите разработку то вы потом цикле никогда не такой нити идеальное состояние мониторинга потому что у вас всегда будет разработкой ти вперед и мониторинг средам и все будут нервничать то есть упала почему упала непонятно даже свеча какая крутая штука если у вас за мониторе на и упала то вы примерно понимаете куда идти а если у вас не было за мониторе нато к вам пришли и очень сильно на ругались и у вас стресс вы понятия не имеете где у вас сломалось при этом у вас стресс и вы понятия не имеете что делать и у вас стресс такая хреновая ситуация непонятно вообще все и вам с этим как-то нужно жить а если мы идем по кругу так нужно постоянно в этом находиться как бы выкатили новый сервис сервис какой-то момент упал потому что новые сервисы при выкатывания ну мы понимаем да как бы как они работают он упал но мы об этом не узнали к нам прибежали сказали да ты живут уже последние два месяца пытаешься мониторить сделать нормальный ты его не сделал а вот у нас мы выкатили новый сервис да вы не сказали но он вы люблю он выключен и он упал и ты не смог разбили разбирайся прямо сейчас в три часа ночи значит субботы на воскресенье в отпуске мы за мониторе ну как бы пакете первый уровень мы мониторим уровень приложения мы планируем мы я предлагаю мониторить в начале уровень приложений приложения как бизнес-единицы то мониторим бизнес-логику приложение у мониторим хаос метрики это николас метрика кайбер нити своя подробнее раскручивает такое мы делаем интеграционный мониторинг затем мы мониторим инфра потому что информ они торе довольно просто и понятно и можно это сделать параллельно с первым этапом а затем уже мы мониторим уровень приложение как приложение как инженерного продукта мы понимаем где могут быть ошибки мы понимаем каких местах могут быть ошибки мы пытаемся понять где тормозит и после этого доходит до а лифтинга ну то есть это кстати отдельная штука не после этого мы доходим до рейтинг болезнь как заходим сразу потому что еще отдельно интересный кейс которая вижу когда запускается проект по мониторингу в начале все мониторит а потом создает систему а лифтинга ну сенсы потом выставляют alert и думают хорошо мы щас все продумаем как все будет даже продумывают продумаем как грамотно все это сделать а потом в последнем этапе мы поставим alert и поймем кому они будут приходить соответственно но по сути в чем состоит задача мониторинга понять где в системе что-то работает не так но в системе на уровне приложений на уровне in free на уровне бизнеса и дать об этом знать нужным людям если мы оставляем allure think наконец-то хотя система что ты показывает о том что что-то пошло не так и узнали об этом нужные люди не происходит только позвонков куда нам позвонил пользовательского всеми не работают ничего и allure кинг опять же чуть дальше пройдусь это не не система оповещений которые же ты сам с это более сложный уровень который надо учесть для того чтобы все таки хоть немножко более технически уйти давайте представим себе что стек у нас примерно следующее мы собираем данные с примет его своим grove on и потому что но это просто индустриальный стандарт ну то есть если посмотреть на количество использование различных систем мониторинга про металл далеко впереди и по этому в принципе хороший навык знать разбираться в этой штуке и с ней можно жить анализ логов вы предположим делаем влк стеки а для того что мы зовем pm или ну или tracing мы говорим о лагере или thomsit тени но ну там это интересно все не критично потому что по сути когда вы для себя в начале поняли как правильно систему за мониторить и расписали план дальше вы уже как раз вот дальше вы начинаете выбирать инструментарии инструментарий вы подбираете под свои требования то есть опять же там постоянная картина которую я вижу давайте давайте будем мониторить все на этом на этом на этом этапе . обсуждение как мониторить и дальше зачем-то начинает выбирать инструмента вот что лучше нам для мониторинга подойдет prometheus или что другое или вот мы вам может zabbix охватит вопрос состоит в том что вы конкретно собираетесь мониторить в начале потому что возможно инструмент который вы выбрали заранее он вообще не подходит под ваши ну требования схемка я вернусь к ней похоже просто чисто технических штук которые вижу в последнее время prometheus пихает внутрь кубика кто придумал эту штуку и сливался пойдет класс стр чего будете делать ну то есть вы как это будет и дальше расследовать вас пал poster и вы пытайтесь понять чем же конкретно упала может быть там перед этим что при жертва не понятно то есть я предлагаю что тоже работать open у лысого сложный кластер внутри у вас должен работать некая система мониторинга внутри кластеры некая система интернет снаружи кластера которая будет собирать внутри кластера потому что до внутри все это микро сервисные штуки нужно собирать данные наружу эти данные не прокидывать извините я хреново рисуй картинки винавер после презентации внутри глостер мы собираем блоки собираемся стальной внутри складкам собираем tracing но система мониторинга при не должна быть снаружи потому что если у вас все это пропадет то будет довольно плохо кстати я все таки считаю что в целом вся эта многослойной инфраструктуру последних лет очень сильно испортило в целом как сказать стандарты надежности индустрии вот поднимите руки уголку бенитес круто а у кого этот класс 3 зарезервирован уже хорошо то есть мы вот сейчас буквально недавно там для другого заклада на другой конференции спрашивали опыт резервирования кластера кубика но в пределах нескольких dc не резервирование то не обязательно штатного имею ввиду штатный вообще много сложных вопросов но смысл в том что короче куча народа начинает отвечать брина там слишком сложно я не могу в этом разобраться ну то есть пока инфра было более менее понятно было понятно как отцы резерве как батут слишком сложные большинство тоже не разбирается и это непонятная штука в которой нужно потратить еще два месяца и ну как бы нет я не хочу и и так далее само собой второй важный момент который почему в 2019 году живем внешней проверке нужно привлечь снаружи очень часто видим как вот в этом же кластере где есть прометей который вы поставили внутрь в нем же короче стоят системы которые делают внешние проверка работы сайта из у вас ну типа connection а снаружи упали и приложение не работает у вас внутри все хорошо пользователь не знают поэтапно уровень приложения приложения бизнес-единиц а внешний сервер для ионизации проверок есть некий скрипт который обращается по всему внешнему api и речь идет о по всему внешнему api то есть я считаю что этот этап он должен быть сделан на этапе разработки час или час light то есть у нас есть prometheus на условный примет это все в кавычках который лезет к серверу который занимается проверками дергает point and point идет и проверяет и 5 и очень часто мы видим когда говорят что ноут ребят надо бы быть убежденным что api что сайт работает классно давайте за мониторим главную страницу или класса давайте за программисты это офигенно этим программисты дадут ручку которую можно дергать чтобы убедиться что и 5 работает а программисты тот момент еще берут и пишут а значит типа слеш и пья из лишь тест этих hello world вот и это все что мог как можно убедиться что это работает нет создания вот этих проверок по сути эта задача разработчиков потому что блин юнит-тесты юнит-тесты ну по-хорошему должны писать программисты которые пишут код но по сути вы должны описывать как писать потому что если вы сольете всю эту хрень на админа ну как бы вот чувак вот тебе список протоколов и пиа эффектом 25 функций пожалуйста за мониторе это все это нет не получится не будет за мониторе на 25 функций потому что вы потратите время работы админы на это если вы сделаете flash pink print hello world но никто не узнает никогда том что и 5 должны работать ну что она летит на работает и 5 должен быть покрыт каждое изменение 5 должен вести за собой изменение проверок не нужно откладывать это в какой-то долгий срок и тут такая интересная тема что я большие про для бизнеса короче если у вас вот сейчас уже такая обида you to bring типа остановите фичи и дайте программистом до выдайте людей которые напишут эти проверки либо смиритесь справиться с потерями и понимаете что там все не проверяется и она будет падать и пока вы не остановите фичи ну потому что вы вытащить разработчиков с разработки пока вы не остановите фичи все будет грустно и вы просто мы бы приняли эти потери окей не ругайтесь на канал потому что но это замкнутый круг вы сами решили в нем находиться мониторинг сми так смотреть то есть мы решили что мы все внешние ручки приложения мониторинг с помощью внешних проверок которые мы двигаем во внешних систем мониторинга но это именно ручки который видит пользователь мы хотим понять что у нас работают сами сервисы и здесь отдельная тема интересная ситуация получше потому что на укольчик есть например обернитесь и и люди привыкли писать какие-то классики чтобы вы хотя бы кубик убеждаться что сервис работает но половиной хавчик в которых я видела тот же самый print hello world ну то есть вот он дергает один раз после диплом он тот ответил что типа все хорошо и все а у сервиса например если он дам раз том выдает свою пику у него есть огромное количество того же самого это и который правда тоже мониторе потому что мы хотим знать что он работает и мы его мониторим уже внутри каждый сервис выставляет некий своим пойнта проверках того что он работает мы делаем некий дашборд работы сервисов и как с этим живем опять создание проверок задача разработчиков если вы сольете на админа последний момент задачи по мониторингу сервисов а вообще-то этого не думали о том что сервиса хоть что-то должны выдавать о своем здоровье будет беда ну то есть там не знаю за 5 же две недели до релиза вы выкладываете эти сервисы они ржут проду иногда падают вы хотите чтобы вы узнавали когда эти сервисы падают вы об этом не узнаете потому что у сервисов нет возможности проверки приходит от бен говорит ребят ну напишите пожалуйста набор fit чтобы все чтобы я понимал чтобы я в свою систему мониторинга добавил информация об этом разраба говорят у нас две недели до релиза мы ленимся мы ничего описывать не будем мы фичи пишем поэтому соответственно как бы остановить и фичи и выйти ль разработчиков или смиритесь потерями понимаете что как бы это будет происходить если вы смиряетесь потерями то известить об этом всех кого надо потому что окей пусть менеджер разработки знает что будут такие потери но пусть стыдно начальство менеджера разработки знаешь такие потери ту же будут потому что рано или поздно когда всего пойдет кто-то все-таки позвонит и скажет вы задолбали она постоянно падает почему вы не за мониторили ну то есть два я опять про тоже ты сыт большой проект который занимает большое количество времени на который надо выделять людей кстати отдельная тема про установку приложений которые все за мониторит даже то же самое grafana на очень ограничено было бы очень круто если вы засыпать запускаете себя проект по мониторингу помогите пожалуйста devops am ну или там devops и переводить придайте то пожалуйста разработчикам чтобы devops выдали хотя бы каких-то людей написание плагинов для графа на потому что в принципе очень хорошая помощь будет потому что скорее всего то как вы решили что вы за мониторить систему не ну никакой конкретной плагин вам так не поможет он будет но как стать дашборд и и возможно не везде это будет функционировать вот эта тема про который я хочу рассказать побольше а потом уже будут затем поставить штуки относительно ну с которым мы живем есть такая штука которая называется интеграционный мониторинг то есть смысл в чем на 5 большая штука который мы видим постоянно есть 15 сервисов 15 сервисов коммуницирует между собой это больше не отдельные сайты то есть мы не можем дернуть сервис сам по себе получить от него print hello world и понять что сервис работает потому что сервис сервис оформление веб должен править информация заказе из shinee служба работы со складом должна получить сообщение и обработать это как-то дальше из shinee служба рассылки e-mail должна была обработать это как-то дальше но и так далее соответственно мы не можем понять в каждом отдельном случае просто тыкаясь сервис что это все работает потому что у нас есть некая шины через которую все общается и как-то она взаимодействует или не знаю там совсем простые вещи когда у нас пара серый за собой по комнате рэйки работают мы не можем просто дергать сервис уже быть этот сервис не может двигаться другого сервиса и все лежит как бы с этим что делать поэтому по сути этот этап должен обозначать собой этап тестирования сервисов по взаимодействию с другим с другими сервисами чё я говорил до этого нельзя надеяться на то что мы можем взаймы ну за мониторить взаимодействиями работы между сервисом из друг с другом за мониторов брокера через которые не общаются мне знаем ни протоколов это а брокер ничего то есть если у нас есть сервис который выдает данные и другой сервис которых принимает все мониторим просто брокер нас ты какие-то данные которые летают между собой и самый даже как-то умудрились за мониторить между собой взаимодействие этих данных внутрен то есть как бы что некий продюсер значит после данные кто-то их читает этот поток продолжает идти в кафки но мы внесли поговорим о кафке это все равно не даст информация о том что например если один серый прыгнул со одной версии сообщение о другой не ожидал то версии упал мы об этом не узнаем потому что сервиса нам скажет что все работало series b нам скажут что я сам по себе работаю и вот только в полном конце птицы происходит как мы рекомендуем делать то есть для синхронны sing коммуникации and point сервисов по сути просто выполняет стуки ко всем а пешком взаимодействующих сервисов которые он делает то есть мы берем дергаем этот and point дергаем этот скриптик внутри сервиса который взял пошел по всем точкам выговорить таки я могу там вернуть я могу там черной тем об этом дерните могут там дернуть 1 кей электронный происходит сложнее синхронное по сути должна что что что мы обычно делаем то есть у нас есть сервис который кидает данные в шину это означает что мы приходим в этот сервис говорим скажи нам пожалуйста о своем интеграционном здоровье если сервис должен запросить какое-то сообщение куда дальше и скорее всего не знает куда дальше-то он это тестовое сообщение продюсер а если мы дергаем сервис который получает ну типа вот мы взяли der 0 баба подкинул сообщение заказе в шину это вот проверка на стороне баба по а на стороне ордер процессинга мы дергаем checker и он значит сначала пусть это что он сам может запустить тож независимая а если скит зависимы штуки он читает и шины набор текстовых сообщений понимает что он может их обработать пусть эти сообщения дальше и вот про это он уже говорить что все окей я живой для коммуникации очень большая геморрой когда мы об этом говорим говорят но как между заказ мне этот заказ берет шлет сообщение в склад и за сообщение расклад и складе списываются товары я же не могу протестить на боевых данных потому что товара будет списываться ну если мы пришли состоянии get все это уже создана там и как я говорил в беде смиритесь и живите с потерями или запланируйте переработку от переработки переработки и снова я понимаю создание некого канала коммуникации то есть очень большая болячка постоянно проектах на которых мы видим мы говорим как у вас проверить там функцию списание товара со склада и нам говорят мы не можем картине ческим сделать потому что вы не можно списывать товары со склада вот на начальном на начальном этапе запланируйте весь этот тест тоже есть и не знаю не тесты которые делают какие-то как называются make вот сделать на более глубоком уровне где вас будет проходить канал коммуникации который не повредит вам работы бизнеса уровень инфраструктуры просто мы это инфраструктурой то что до сих пор считает ясный план который хотел отметить то что до сих пор считается my мониторингом ну как тебе по-прежнему от этого берется беда забанит уоррен все наверно он get там подставить свою систему за мониторит инфраструктуры все будет хорошо нет инфраструктура это два процента всего проекта чуть-чуть короче составляющих здесь есть магия утилит можно научиться понять как мониторить важно научиться собирать есть офигенные доклады по мониторингу от fanta и от метра посмотрите их это вполне весь этот набор это вполне понятный набор вещей это как раз то почему мы попадаем в беду с проекта импами трубу потому что думаю что так так со всеми направления мониторинга типа поставит утилиту себя за мониторится все круто ну как бы главное главное организуете мониторинга со структурой все будет хорошо мониторе и конторы можно и нужно запустить как отдельный проект процесс не стоит вот самая штука на что играл до этого не стоит начинать мониторинг нас мониторинге в структуре на работающем проекте эта болячка у всех devops of сначала за мониторе кластер сначала за мониторе you инфу сначала за мониторе а вот там то что лежит внизу о приложении лист потому что приложение непонятная штука для devops а потому что ему это слили он не понимает как это работает а интро он понимает как работает поэтому начинается мониторить инфра нет вначале в любом случае всегда на мониторе тяпу и десна штука потому что у вас есть тип огромный набор утилит которые понятно как у не таить они могут надеть вам пачку сообщений учитывается уже современных систем или рта летят постоянное с этим с этой кучи олегов нужно как-то жить и надо либо ну как быстрых очень много то человек который будет он колол будет и думать о пяти часов диалектов полетела не хочу с этим думать али ты должен прилететь только про critical вещи скорее всего они будут пролетать даже про скорее про а если вы грамм за мониторили вот первый уровень приложение как бизнес штуки то они будут придать про это а дальше уже будет три себя чуть-чуть все происходит дальше и уровень приложения тоже там третий этап в который можно закопаться по-хорошему потому что инфу по идее за мониторить и быстро это приложение как бизнес-единиц а просто просто несколько ключевых поинтов мелко это индустриальный стандарт ну или можете выбрать другое но есть л.к. если вдруг по какой-то причине вы не реагируете логе это странные агрегирует их пожалуйста есть вполне как бы вы можете подумать дальше группа систему tracing она про систему трейдинга приходится думать а у вас возможно уже есть рабочий проект который надо мониторить и a pm как способ быстро закрыть какие-то потребности в мониторинге он он круто работает ну то есть вы можете временно поставить штук чтобы хоть это понятие вас приложение происходит главное что короче вас микро сервисы вас у вас есть десятки микро сервисов уложенный как все три потому что запрос больше не живёт сам по себе он одет вот так вот так вот так вызвало еще 5 сервисов и случае 5 сервисов и ну типа трейси как нужен короче то есть я для от я давно не девелопер извините пожалуйста я бы мог нарисовать код как это работает но я не программирую уже довольно давно потом поэтому есть джаггер лезет кен я больше видел джаггер есть вот буквально вчера посмотрел прикольный видос про то как с джаггером и заприметил сам построить they sing по сервисной архитектуры на кубе ныть все крутых приза будет посмотрите дописать сложно позже очень сложно лучше запланировать сразу в разработке tracing опять же работа разработчиков истощению не играете типа нет времени лучше внедряйте потому что все это как следить overthink меня мало времени я прямо быстро постараюсь первая лифтинг это не организации оповещений то есть должна быть в условиях того когда мы мониторим куче разных вещей должна быть единой системы рассылке оповещений потому что из-за вас будет лететь из разных мест вы ну типа совет с ума можно например все агрегировать в итоге в игра пони на западе все поголовно агрегируются ждёте его ребра тетис количеством оповещений и оповещение должны дать понять какую систему идти чтобы вам не пришлось кидаться между системы мониторинга когда вам прилетел alert типа откуда он вообще пришёл оповещать должны быть понятны и желательно контролировать что помещение вообще доходит потому что вдруг они ко мне прилетают я больше короче я больше не про техническую сторону лифтинга я у нас на дежурстве и порядка 40 наверное человек и это были когда-то 12 часовые смены потом 8-ми часовые поэтому я долго могу может там после доклада говорить про органы системы дежурств я сколько ошибок которые можно сделать в проекте олег ты не должны приходить всем потому что это будет либо все будут дергаться и просыпаться и толпой народа пытаться разобраться что происходит и мучиться либо в какой-то момент всех это так достанет что он подумает ну вот сегодня я не буду идти на него завтра ну-ка пусть его сегодня придет а я завтра не приду и не придет никто это вполне реальные кейсы он кол обязательно должна быть разработчики обязательно должны быть определены зон ответственность чтобы меньшему количеству людей пролетали alert и и определить четкую эскалации это очень важная штука duis пусть а лет предел devops это понятно что проблема в коде но если вы написали там тогда звоните программистом люди короче большинство людей я прямо деньги но я для меня это было открытие люди не любят звонить другим людям в три часа ночи потому что короче они воспитаны так что так делать не надо потому что они переживают что не разбудит потому что они понимают человек потом не снес если вы написали звоните программистом человек будет очень сильно переживать половина не позвонит половина будет думать я сам разберусь посмотрю еще только потом позвоню а это alert как бы у вас беда надо позвонить и позвонить тому кому нужны если вы напишете в инструкции позвоните в случае аварии сегодня понедельник среда и пятница васи петрова человек это делает в сто раз легче чем ей позвонить и программистам определить четную ситуацию то есть то что я сказал если человек человеку не прописано пора звонить не знает кому звонить и ещё одна важная тема люди когда работают они короче очень много людей считает что звонить за помощью это короче показатели собственной некомпетентности то есть если я звоню и прошу помочь то это означает что я плохой работник если бы так происходило в операционной или скорой помощи мы бы были бы еще больше причин с мониторингом поэтому нужно постоянно работать с людьми объясняешь дорогой друг короче мы находимся с девственником некое подобие ну в когда мы работаем on-call в некое подобие реанимационной комнате здесь не стоит разбираться самому потому что секунду влияют и пожалуйста если ты звонишь кому-то за помощь это не значит что плохое то народ означает что получишь больше информации будешь развиваться как человек ну и теперь все готово помочь и последний этап parchment систему мониторинга это а лифтинга интернета подсознание то есть вы не просто должен жителями over to me вы должны по каждому серьезному инциденту делать посмотрим что вы понимали что произошло есть классы доклад году прям идиальная формат оформления паспортов можно посмотреть очень круто ребята рассказывают в качестве временной меры действие предполагаете что подобные ситуации повторится должны быть зафиксированы и on-call инженером распространенную то есть что подмен заново не капал второй раз что происходит и должна будет введена практика что повторяющийся alert это грех ну то есть если низко 1 пролетает один и тот же alert который фиксе страны взять этого эскалировать уже в инфраструктурные работы в структурных работах это пофиксили в коде все я почти все философские выводы 1 разработка мониторинга не установка утилит разработка программного продукта ребят ну типа это котик фактически 98 процентов мониторинга теперь это пудинга такой днк сервисах от такой ning внешних проверок это конинк проверки внешних сервисов всего-всего-всего то есть нельзя нет нет софта до того чтобы вы искали софт вот мы придумали стартап давайте посмотрим какое какой продукт можно купить за деньги чтобы стартап заработал если проект уже работает и не за мониторинг поговорите с менеджментом о том что нужно снизить доработку фич и выделить ресурсы значительная часть современного мониторинга работы разработчиков товарищи эти опции не переживайте что у вас не получается за мониторить потому что некоторые вещи вообще другой склад ума то есть ну вы же все таки devops и как бывает там возможно появились задвинув и вы не были программистом и программистам вы не были потому что вам например интересно было администрировать ну типа написание программного кода это работы программистов и возможно частичек если ты должны делать просто программисты и если короче вы этот самый чувак которому пришли и сказали настрой мониторинг заработает попробуйте объяснить что я тут говорил руководству потому что вдруг тот станет понятно просто потому что у людей с другой стороны в голове тоже bureau в магию спасибо прозвучал полуторачасовой доклад за 45 минут у нас пять минут на вопросы учитесь уже не да пожалуйста евгений пасибо большое за доклад его вот сколько мониторингом не занимаюсь все больше понимаю что то как им он только прекратить его нельзя вот любом случае вот скажите как вам удалось заставить разработчиков именно заниматься ну понятно что разработка метрика лучше всего получается у тех людей кто это положение коде то есть кто там данность бизнеса собирает заказчиков со всех вот и собственно самих разработчиков как вот удалось именно замотивировать они заставят чтобы это не было в тягость то что понятно это увлечение трудозатрат это увеличение ответственности метрики там но у нас метрики одно время называли тесты тесты надо тестировать тоже это фактически разработка процентов на 30 времени увеличивается смотрите во первых ситуации в том что весь этот доклад он сделан из более потому что большинство кто там приходит они приходят не вставляя не приходит уже с мониторингом который без всего этого и там в некоторых случаях получается убеждать людей изменить workflow разработки у нас самих есть низко программных продуктов там мы как бы тоже набили шишек поэтому мы понимаем что как делать ну как бы я у меня нет я читер я генеральный поэтому я могу по не могу идти вниз вот есть все-таки значительное количество проектов где приходится прям долбать ну то есть сделайте пожалуйста сделайте пожалуйста сделайте пожалуйста и с этим самое сложное и как бы я вот так как хотелось для того чтобы как раз до значительное количество людей где где-то сложно чтобы нам можно наши клиенты выделят ресурсы потому что есть куча людей которые понимает это тоже для бизнеса такой замкнутый круг я зарабатываю деньги обычно становиться не нужны новые фичи зарабатывают деньги и быть остановиться и жертвой например надежность вот так что это это немножко болезненно доклад я надеюсь поможет кому-то поможет вот зачастую даже с бизнеса не всегда удается выбить описание особо бизнес-процесс получить по нему кого-то метрику надо понять хотя бы как он работы зачастую сложно бывает выпить именно это описание а что уже говорить про метрики то есть путь их безу сказать дома что ты хочешь мониторить ну как бы на выходе извините я сделать себе некую этическую картину мира я стараюсь если не получается донести до того что нужно вкладывать время разработку иногда будет эффективно когда нельзя вложить я хотя бы говорит тогда вы понимаете что есть проблемы да мы понимаем тогда вы понимаете что в ну что эти проблемы существуют дома принимаем тогда я сделал принципе все что мог ну то есть по крайней мере меня не давит совесть за то что она все таки упадет потому что когда упадет в почка людей ск ну как бы дали все равно нервничает они будут говорить опять упала ноты для себя хотя бы понимаешь что в этой ситуации я сделал всё что мог как бы ну это было понять этим было пожертвовано пользу развития бизнеса например понял спасибо большое если время вообще можно еще спрашивает да еще три вопроса так на доклад огонь количество информации в секунду просто приняли все еще раз берите 2 часа на простой возможно у вас есть какие-то ну какая то статистика сколько процентов времени разработчиков нужно отдать в мониторе во блин на скидку вот я бы сказал 30 процентов но я скажу честно слово я вот сам доклад оформил то есть я думал про него месяца два но оформил я его вчера позавчера и очень интересный вопрос пронять сколько этого времени яд я потому что спасибо за вопрос это классная тема я обязательно пойду например по клиентам и спрошу как никак у них происходит это поспрашиваю друзей не реально интересно сколько объективное время потому что вот как руководитель программного продукта пишем внутри я сама интерес к на заложить хотя бы просто объективно я не могу сейчас показать цифру конкретную ну как бы не могу но 30 процентов от на скидку хорошо сразу же маленький вопросик если у вас доклад на английском языке 29 мая будет тихо сильный персоналок то есть можно будет получить этот вариант а этот гад английском языке если интересная может поговорить кулак на по себе и еще маленькие вопросе по поводу ты горишь инспектор что вы рассказывали тяжело на продаж и тестируйте все такое в какой то момент времени мы столкнулись с такой же проблемой и пытались сделать фейковых юзеров фейковый вот эти вот продать продукты которые были бы хидана продакшене но вот этот конкретный фейковый узор мог бы их ну как бы делать их орда вы какие-то подобные схемы пытались рассказать потому что это конечно спектр я мы просто прокидываем реально какие-то тесты штуки я понимаю я опять же торе есть свой доктор монгольской дебри я понимаю откуда это берется потому что это хочется иногда и очень быстро а по сути это инженерная задача это продумать но он связывает инженерной задачи подумать как мы можем прокидывать тестовые данные так чтобы это не повредило нашим продакшен данным чтобы это происходило на продакшн и чтоб это было похоже на продакшн данные вот я бы просто как бы эти две ответ на идеального мира должен быть продумано вначале либо поэтому должно быть уделено серьезное время чтобы продумать это но не за неделю последний вопрос и остальное друзья в кулуарах тогда спасибо за дат за доклад мне показалось что ваши проверки приложу уровня приложения очень похожи на функциональные тесты был два вопроса не повредят ли такие функциональные тесты на продакшне и каким-то живым данным вы ответили и второй вопрос как то они завязаны с реальным процессам тестирования и покрытием там очень много думал про это по сути виде то как бы вполне возможно что команда которая должна заниматься созданием этих традиционных эта та же самая команда которая собственно тестирует то потому что это очень связанные вещи такой сети когда continued to sing но немножко другом теле терминологии на пойди они могут быть зовет него не могу ответить из практики думал про да спасибо и видимо холивар на что-то вопрос по поводу мониторинга мы настроили в graph они красивые графики которые нам показывают обстановку что происходит с продакшеном и возникает какая-то проблема и чаще всего это проблема показывает что очень много показателей самых разнообразных начинает зашкаливать и если какой-то определенный подход чтобы отделить следствие от причины в исследованиях проблем если пытаясь объяснить как понять первопричину ошибку пришло время печь всего инфра вы или проблему чаще всего в коде может быть по разному например какая то одна из записок может затопить и из-за этого нагрузка перекидывается для такого уровня из надежда на tracing хорошие ну то есть мы пытались ингу посмотрели где-то рубиться и поняли потому что как раз где тренинга в том что там последовательно связь это самое которой мы хотим восстановить ну и также например можно использовать какой-то временной срез то есть одновременно показания счетчиков в определённый момент времени смотреть что раньше например началось но это уже сложнее то это значит собирать донаты чем собирать от рейтинг он уже готовы ваться всеми этими деревьями и мы говорим около плевала то там вот там скорее можно найти это через джаггер ну например я знаете я тяну чес-слово тыс с 5 за дело disclaimer или нет я типа 3 года больше занимаюсь манду психическим чем непосредственно исполнением и поэтому я ягер видео просто со стороны кажется то актуально именно объема но вот прям поголовно вижу что типа tracing рейтинг рейтинг рейтинг должен быть ну и как бы это может спасение хорошо спасибо какой вопрос больше понравился из всех помнишь кому подарим вот вопрос правда как собрать вместе да да не потому что последний потому что фбр одну правда классно хорошо все классные вопросы но вопрос актуальный болезненные вот это среднем ночевать вот третий ряд мужчины который вырвал микрофона вашего коллеги да но жене аплодисменты обратите внимание на его фотографию здесь он сидит на корточках и спрашивает мониторинг есть но и следующая фраза вы понимаете а если найду не вот если найду исправлю"
}