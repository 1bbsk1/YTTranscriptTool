{
  "video_id": "oxsuwxwJldE",
  "channel": "HighLoadChannel",
  "title": "Hовости о PostgreSQL 12 / Олег Бартунов (Postgres Professional)",
  "views": 8222,
  "duration": 2997,
  "published": "2020-02-26T12:02:05-08:00",
  "text": "спасибо я буду рассказывать об адресе ул которую вышел только что недавно буквально месяц назад и принципе конечно пресс-релиз и релиз но каждый из вас может прочитать и он довольно большой длинный я хочу заострить момент что в нем уже есть благодарности 35 людям с нашей национальности грубая из россии это уже большой пример раньше это была там один два человека три человека сейчас уже количество наших ребят которые там участвуют в развитии этого очень положительного экономического продукта уже стало много поэтому я решил рассказать только о некоторых вещах но более немного углубленно скажем вот я буду рассказывать происходит джейсон процесс это и кнн просторы джей но и всякие такие вещи вот тех кто очень торопится может просто так пардон вот этот ссылка на не такая да там места эти нас должен быть написано highload вот и тогда уже можно скачать но вы не думайте этот доклад на немного переработал после стала времени поэтому все будет нормально 1 сначала мы рассказываем про сквозь сон в подписи вот здесь у него логотип нашей компании не случайно потому что это мажорную фичу этого релиза делал ли я как раз ребята из нашей компании три года фактически делали и вот на этой картинке видно как с qualys как на узкую или развивался то есть начиналось самых простых маленьких кей well you bother да и потихоньку они начали все больше больше усложняться а вот я недавно несколько час назад разговаривал с мужиком из manga manga db и он мне рассказывал что мы вот внутри развиваем транзакции вот 4 версиям gps транзакция но там есть еще ограничения да я говорю новый так как нам идете к реляционным базам данных ну да ведь вы же тоже повернулись к нам то есть видите после спа вернулся к носку эль в подписи появился поддержка джейсона теперь появился поддержка сколь джейсона стандарта да но на самом деле если вы посмотрите самый низ уже 2 тысячи третьем году мы имели эту поддержку еще 2 тысячи 3 года я очень рад именно я и феди сигаев мы это сделали еще давным-давно а и если посмотреть на этот график то есть это просто данные из дбм часа это такая пузомерки для баз данных этому можно увидеть что начиная где-то с конца 2013-го года популярность пузырится начала катастрофически расти это связано с тем что как раз в это время появился джейсон b и многие люди пользователь доску или которые разочаровались который на хайпе взлетели с манго они разочаровавшись стали возвращаться в погреб и потихонечку адрес начал расти этого такой пример что погряз действительно он изменил изменил восприятие реляционных баз потому что до после со считалось вот до этого года до 2012 года считалось что реляционные базы такие монстры и динозавры а вот мы такие манга там кассандра там бредис и мы такие но хипстерские такие нормальные а тут выяснилось что пузырь из оказывается задает тон и тем и более того мы затравили сообщества базу данных так что из курить стандарт то есть комитет который вырабатывает вскоре стандарты они сказали что джейсон должен быть стандарт sql и 2016 году он появился в стандарте он описывает модель данных видите вот желтенькое то джейсон внешней а в синеньком есть скули джейсон то есть этот джейсон который немного модифицирован под скулы лин varmint он водил он говорит про модель данных о наказ описывает язык язык запросов к джейсону джейсон по сэнгвич вот и набор функций функции для создания джейсона для поисках джейсона и так далее вот этот весь стандарт из этого состоит мы сделали вот то что вместо того чтобы изобретать новый тип данных еще один да у нас и так их есть джейсон ли джейсон б мы решили остановиться на джейсон by потому что он очень хорошо вписывается в модель данных и сквозь сон а то есть это просто не кило практическая нормальная да стоит достаточно и подмножество с квари джейсона то есть это ключи там отсортированные и уникальные а следующую штуку что мы решили реализовать мы реализовали джейсон пас это наиболее интересно или более важное то что мы посчитали потому что функции у нас уже и есть фактически мы их много с ними все привыкли они достаточно абсолютно и последний челленж для нас был это сделать так чтобы существующие индексы поддерживали вот этот джейсон тасс я обращаю внимание не существующую об класса вот и индексы которые на диске уже лежат чтобы вы помощью их могли уже работать с новыми фичами пользоваться типа джейсон паса это вот такой хороший училище мы его сделали вот примеру выглядит как джейсон посвятив сереньком здесь описывается квартиры которые находятся в доме у которых площадь квартир от 40 до 90 метров в принципе для всех кто работает джейсоном молодых ребят это все понятно сенса совершая понятной и если не понятно что впереди есть такая слова лакс лакс это режим для того чтобы понимать как реагировать на то что есть ключ или нет ключа ну все значит что джейсон это такая не обязательно структура данных который может быть круче присутствовать может не присутствовать да а если вы его виску или решили запросить этот ключ то что делать выдавать ошибку или или просто проигнорировать так вот это первое слово первое слово это режим он задает вам возможность настраивать вашу запрос видите он состоит используется dot наташин то есть просто точечками разделены слова доллар означает текущей контекст ну и дальше вот вы можете ходить по массивам вы можете какого-то ключу обращаться вы можете фильтровать фильтровать результаты видел после то что после вопросительного знака в скобках выражения это просто фильтр по нашему по иску уильяму это просто вы я клаус то есть грубое вы можете написать достаточным произвольные выражения и этих фильтров может быть много плюс еще добавлено несколько захардкожены методов ответит тип размер дабл selling floor для того чтобы вы могли потом модифицировать результат вот wheels вот он весь в принципе это джейсон пас вот например как работает этот это выражение то есть на первом шагу мы берем доллар доллар означает весь джейсон на втором шагов берете floor . floor это просто вы получаете массив этажей на третьем в на третьем вы получаете два объекта грубая 2 этажа это двухэтажный дом на четвертом вы уже доходите до до объектов долл квартир а на пятом каждую квартирку рассматриваете вытаскиваете все данные на шестом вы просто фильтруете эти квартирке по моему все достаточно прозрачно и на выходе там но в конкретном данном случае получается просто 2 квартирке я не не привел сам джейсон исходной но результат будет просто 2 квартирке то есть принципе достаточно понятно а вот как работает лакс из 3 вт то есть можно говорить расслабленно относиться к структурным ошибка например да или значит очень жестко то есть например массива они в режиме лакс а то есть расслабленном режиме они обратятся то есть сливалось был массив он просто превращается в плоскую плоскую систему да и тогда ведь и запросы либо ищутся либо не ищутся а в режиме стриптиз что просто выдается ошибка ну то есть можно anon но останавливаться не буду потому что сразу после меня саша коротков мой коллега будет рассказывать об этом просто всю лекцию про джейсон пас поэтому здесь я просто как бы быстро расскажешь какие функции у нас есть теперь то сексист матч сквере твари rake worry that offers то есть эти функции которые позволяют вам уже сейчас работает значит джейсон пасом вот они имеют такую сигнатуру то есть первый аргумент у них сам джейсон второй аргумент это джейсон паз в третьем аргументе вы можете задать переменные которые используются в джейсон пасе ведь вот пример такой внизу то есть вот вы можете переменную x вот доллар x вы можете задать из некоторого джейсона причем вот этот некоторые джейсон он может быть не просто здесь захардкожены это может быть какое-то значение из какой-то таблицы то есть вот такой очень гибкие гибкий язык а и флаг silent где вы говорите ругаться или не ругаться если что то не так пошло функции конечно есть операторы операторы нам нужны потому что в подписи мы можем ускорять только операторы не функции вот например видите какие у нас имеется пера индексы стандартный джейсон пеперо оперы abs джейсон bishops то что мы говорим да то есть то что для джейсон где работала она будет работать для jacinta со есть у нас такое расширение g сквере очень рекомендую в нем есть еще три дополнительных об класса которые позволяют вам работать джейсон биггз гораздо гибче чем ванильный по адрес вот и мы надеемся что к 13-ой версии мы эти об классы эти индексы просто перетащим как бы в ядро сейчас просто руки не дошли в 12-ой версии у нас нет поддержки дать тайн есть такой метод daytime мы его не сделали не сделали по разным причинам по разным причинам он хочу успокоить мы его уже заметили в 13 версию просто для того чтобы не чтобы это не стопорить commit в 12 версию мы решили закомитить без этого потому что daytime это очень сложная тонкая вещь которой надо принципе разбираться хорошо и если суммировать то мы видим что искры джейсон а там стандарт потряси поддерживается лучше всего 14 which is 15 мы поддерживаем сравнить этот 40 klom mais quel и мы леску и сервером то есть это говорю не только я это говорят признанные специалисты поиск велю джейсон стандарт поддерживается у нас лучше всех а вот здесь ссылке то что будет sage коротков выкладывать после меня и вот большая презентация которая делал в милане недавно есть технический report или сока на же сквере а переходим к следующему пункту , но тогда картинка на самом деле не просто так для того же привлечь внимание это вот как я нарисовал как бы слона который там пытается проломить этот войти в этот автобус значит вот это я наверное многие пользовались до 20 а в пузырьке я знаю многие люди используют для двух вещей для того чтобы запрос выглядел красиво то есть вы вначале что-то вычисляете да потом этим пользуетесь и 2 вещи для того чтобы optimizer не оптимизировал это выражение не чтобы вот это выражение в цитата что находится в т.е. она не принимала участие в оптимизацией потому что мы знаем что optimizer иногда врет и поэтому мы считаем что давайте ка я лучше материализую выражение в двадцатые на диске вот как них как мне кажется правильно а дальше я буду просто использовать это называется барьер для optimizer и так вот оказалось что нет ни казалось мы знали что реализация цветы и в пузырьке она не совсем похоже на то что люди другие используют других базах данных то есть в подписи с это я всегда материализуется то есть выражение в в этом цветоеда она вычисляется и записывается на диск грубая материализуются в других базах значит соответственно это не так в других базах вы можете говорить материализовать или не материализовать а в плоскости так было не очень хорошо причем вот существуют целые такие надо обращать внимание на work ним на work men вот на то что это это материализация она мешает optimizer у то есть планировщику запросов где выбрать наиболее оптимальный план то есть этот c т.е. она не онлайн запрос и optimizer просто не может еще сделать хорошего поэтому скажи например логически эквивалентные запросы от ее можно превратить просто под запрос вот и он просто пойми разные планы но тот кто красивая картинка что можно сделать с помощью 100 витёк нарисовать просто в песку или вот эту вот такую картинку интернетом или вот этот фрактал мандельброта просто-напросто нарисовать прямо в песку или можешь перед скопировать и без квелли паук нарисовать так вот посмотрите на этот план вы видите что особенности стая что тесто и которые записываются они всегда исполняются всегда даже если на них не ссылаются вот посмотрите на от плана планы можете считать да наверное можете то есть вот специально сделан такой запросик простенький а другой стороны вот я продемонстрирую вам что это черный ящик для бти майлера то есть вот для такой простой таблички вот обычная табличка x y два целых числа и сделал яндекс по икс игрек по индексу так вот в запрос об selecta выглядит вот так вот а запрос сытые выглядеть вот так они логические эквивалентные то есть они ей приводят к одному и тому же результату только вот разница разница запросов селектор выполняется вот да а вернее таксует сад и и а сам селектору заполняется вот так то есть целая 150 тысяч раз слабее чем запросов селектор это вот тот пример когда используется то я бездумно яда может привести к каким-то таким не очень хорошим вещам вот и люди давно жаловались в том что хотелось бы сделать так как и в других базах ты мог у правлять этим и теперь у нас сделано в 12-ой версии мы теперь пишем уже вот is not matter alive то есть мы вы по умолчанию причем но ты то есть по молчанию это очень важно по умолчанию в выражении цветы я ст и expression не вычисляется не пишется диска на виртуальная и это очень важно потому что некоторые прилагаю то есть изменилось поведение по умолчанию это очень важно вы должны посмотреть свои приложения рассчитывали вы да это не рассчитывали и сделать как говорится как и вот уже по стандарту вот и теперь можно посмотреть видите как вот по-новому выглядят все хорошо а то по старому бурлил вот так как раз мы приводили он получался очень плохой и не хороший план вот по умолчанию так что здесь можно долго размышлять простая разговаривать я закончу просто обратите внимание что вот так она есть есть некоторые тонкости на этих слайдах вы можете все это увидеть третье это вот такая тема кто знает что кокаин вообще есть да очень мало людей знают о между тем это мега фича пол риса это я говорю не потому что я ее там в частности делал но потому что действительно мега фича немного покажу то есть она позволяет вам легко делать такие вопросы эффективно при найти ближайшие рестораны около осколкова например там около места где мы тут кушаем или что случилось в мире в проект в то время когда запустился спутник то есть как это сделать кажется что это достаточно наивный простой запрос а на самом деле нет на самом деле sql вы будете иметь проблемы с quelle им потому что вы можете написать запрос скажем вот так эти передней вот решаем задачи со спутником order buy все хорошо там удар buy вот этот вот этот оператор значит там просто берете обстоит и вы получаете некоторые там даже медленно 54 секунды выполняется такой запрос потому что на самом деле даже если будет яндекс яндекс вам здесь не поможет потому что индекс помогает только тогда когда у вас имеется условия по которому вы ищете в а в этом запросе нет такого условия есть сразу order buy то есть вам придется что сделать вам придется вам придется видите прочитать весь индекс вот потом по этому индексу получить все записи потом отсортировать и взять топ чего-нибудь поэтому в этом случае вообще яндекс не нужно использовать ip адрес выбирать просто обычный тупой seks com вы читаете все тупые читаю вычисляйте все расстояния сортируете выбираете там топ-10 очень неудобно и очень медленно вот поэтому мы изобрели алгоритм ну собственно не забрели а прочитали приспособили для подвеса сделать так чтобы поиск чтобы индекс все-таки использовался и вот здесь как раз для качестве образования вот посмотрите какие существуют стратегия обхода дерева индекс это дерево предписали что это дерево да и вот можно поэтому деле уходить вниз в бок например два разных алгоритма но эти два разных алгоритм они не не помогают нам справиться с вашей задачей чтобы не проходить по всему индексу а существует еще один алгоритм это значит очередь приоритетами то есть мы каждый раз и держит поддерживаем очередь в которой котором объекта находится в некотором сортированы порядке и парящий порядке и тогда оказывается можно сделать существенное ускорение индекс будет читаться не весь да по индексу губы мы будем не ходить последовательно будем прыгать но при этом будем прыгать только по тем узлам по тем записям которые нам нужны и выдавать записи оттуда правильном порядке вот этот алгоритм можно здесь посмотри как он ну как вот имеется вот про самый простой способ выйти 9 точек и надо найти точку ближайший вот к этой красной вот на самом деле мы разбиваем представляем виде вот этого дерева да и потом начинаем скакать вот с помощью очередь с приоритетами и довольно быстро находим что . номер 4 и есть та самая ближайшая . ну а следующий опять что вы получили мы получили что после того когда вот этот алгоритм в потряси стал заработал мы получили что это запрос стал выполняться с индексом 290 раз быстрее просто так на ровном месте а вот и это было и почему это выигрыш тем больше чем больше базы данных то есть когда я это в 2010 году рассказывал на конференции или 2011 году рассказу на конференции до 10 то я показывал выигрыши в десять тысяч раз сто тысяч раз потому что потому что сложность работает алгоритма грубая пропорционально логарифму то есть высоте дерева а естественно что чем без индекса вы должны прочитать весь то есть прописано н то есть отношения там логарифм and поделить на логарифм н чем большая база тем больше выиграть теперь ко второй части хорошо бы вы по не поняли что кнн это мега круто вы можете получить особенно для пространственных запросов на самом деле для любых и данных для которых вы можете ввести расстояние расстояние каким-то образом вы можете существенно ускорить задачу а теперь что такое спогис так вот спогис это метод доступа или по простому это просто индекс новый которую мы сделали опять же которое использует который делит пространство на не пересекающей кусочки то есть например вот это не балансирная дерево это кадр 3 quadtree суффикс ные деревья можно очень хорошо реализовывать реализовывать то например вы хотите хранить ура или индексирует ура или вот url и как раз они очень хорошо идеально клада кладутся в этот индекс потому что данные не повторяются вы все руны бывают длинные да там по сайту но но при префиксы всегда будет храниться только один раз и самое замечательно что этот метод доступа он дейта гривен то есть он определяется его структура определяется вашими данными никак вот скажем бы три да там это и лигист это просто какая-то какое-то дерево в которую балансирования до которое не задается данными выданные туда вписываете а здесь наоборот здесь дерево которое облекает эти данные вот при этом create index быть быстрее запросы быстрее индекс меньше потому что вот для таких задач и при этом очень важно чтобы ключ может используется произвольной длины никак в бы три где вы можете вы не можете использовать ключ больше чем другие 227 килобайта ну такое примерно вы не можете вот есть отдельная презентация на эту поэт молот кому интересно важно что теперь мы в 12-ой версии ценили кнс pages- вот и мы показали пример что действительно вот с помощью этого дела то есть можно использовать кнн для помощи с этими индексом вот здесь скажем например сделали известной таблица 7 миллионов 7 миллионов записей это координаты и делаем вот такой запрос видите ищем точку произвольную точку вокруг конкрет заданной точке какой-то и выбираем 2 ближайших мы видим что например посмотрите синенькая это всех скан зелененькая это соответственно значит песцовый yandex вот и вот есть фиолетовый оранжевый спогис к d3 и фиолетовая это спогис сквад три разные ну то есть мы видим что спогис достаточно хорошо ну выигрывают у disto но это не самое главное самое главное что когда мы берем построим speedup то есть насколько быстрее там увидим видите какие цифры относительно всех стран а мы видим цифры вот тысяч раз сто тысяч раз там да тысячу сто раз это когда мы берём вот здесь по оси икс это количество количество ближайших точек но когда мы говорим о ближайших 10 тысяч точек выйти дать ближайших тогда естественно значит здесь минимальный а минимальный выигрыш но если например мы берём 10 что нормально бывает это вот видите десятки тысяч раз выигрыш помощь ко ынэ на это очень важно очень-то приятно мы замахнулись опять же сделать теперь такой же поиск ближайших соседей и для b3 но не успели просто вот этот слайд он вам показывает что действительно здесь что в следующем релизе в 13-м будет еще и кнн для b3 индекса covering индекс кто знает что covering индекс все значит к yandex lonely scan но когда я говорю что к индексу always can все горят круто так вот на самом деле индекс он искал без covering индекс перед без этой фиче он просто не эффективен такой индекс он искал вы знаете что когда вы что-то ищете у вас приходит и вы ищете по индексу индусы что-то находит а дальше вы обязательно должны пойти должны пойти в табличку и проверить видимость и так далее это бывает достаточно медленно потому что табличка может быть большая там неудобно короче и тогда люди придумали индекс он не скан давайте запихнем теперь все необходимые данные для вашего запроса в яндекс и будем просто из индекса сразу выдавать людям при определенных условиях это работает работает быстро люди радуются но вы при этом вынуждены в этот индекс запихивать данные которые вообще не хотели индексировать они просто как бы прилагательное приложение так вот для этого существует теперь фича такая как including то есть вы можете построить индекс там по какому-то ключу и к ним прицепить какие-то данные эти данные будут просто лежать они не будут влиять на дерево на сам яндекс зато когда вы бы вы что-то достаете эти данные можно вытащить ее обращаться в табличке вот пример с например опять же взяли 778 7 миллионов баксов вот эта картинка то реальные данные это буксы которые друг на друга наложено и так далее там это реально кусок москвы центр москвы вот не буду говорить что не означает вот важно что мы пытаемся найти буксы которые которые облегают в которую какая конкретно я . входит вот такая задачка представьте себе что это говоря блюдо макароны вот в этом блюде макарон вам нужно что-то найти вы не можете вытащить ее не задел другое вот здесь вот тоже самое задача омега сложная для для любых алгоритмов вот с помощью и здесь мы сделали с помощью covering индекса мы сделали вот эксперименты и показали что существую показали что gist сын clutton dice цинк ludam он лучше всего работает видите мы можем сделать какие версии мы можем просто сделать яндекс баги стул это вот эта линия вот мы можем сделать здесь я могу показывать тоже тоже работает да то есть мы можем сделать и дешевый индекс и туда засунуть айпи вот и мы можем сделать gist и для сравнения запись засуну туда все из таблицы ну понятно что вот здесь показана время миллисекундах вот что быстрее вот здесь по оси икс это количество вытащенных записей вот и мы видим что самое медленное это индекс куда засунут а вся таблица ну понятно что она будет очень большая самое быстрое это просто самая быстрая и the gist без новый индекс куда просто засунуть засунут вот это ip-адрес вот черты проговорился да вот она не важно просто и здесь посмотреть то мы здесь распределение времен показано мы видим что вот эта сенека или как там назвать ее светло синенькая тяготеет ближе к малым временам то есть грубо говоря выгоднее построить листовые индекс к нему к нему приложить айпи адрес но неважно api адреса чем сделать тестовый яндекс по кудо включен этапе адрес то есть вот этот коммент и covering фича вот особенно ли это же была задача сделано для таблица была создана в некотором порядке и запросы были как бы так сделаны что довольно удачно все шло но если мы сделаем рандомизированы мизер у им то разница получается еще более колоссальные то есть мы видим что выигрыш очень большой происходит просто поверьте мне на слово да мы видим что слив синьки светло сенеки они тяготеют к малым временам то есть понимаете когда такие запросы вы делаете peach марки ой вы никогда не не доверяйте от одному запросу когда вы в песку или сделали запрос о быстро вот здесь сделано много много много запросов да с разными условиями и потом их делать со статистики на них то есть мы смотрим что вот эти светло-синие да они тяготеют все клево то есть большинство запросов это быстрые запросы а зелененький а вот они вот размазаны более-менее равномерно таскать тоже есть быстрый но и есть очень долгие запросы вот и это как раз говорит о том что им и сделать gist с including гораздо удобнее вот очень важная фича это то что вал мы уменьшили была такая тема что когда вы делаете индексы у вас генерится большое количество вала трафик валовый и это грузии диск это грузит машину и так далее вот в 12-ой версии мы сделали просто колоссальную вещь это то что вала теперь генерится посмотрите да было три и два гигабайта а в 12-ой версии это будет 400 мегабайт родиться существенной и она сразу сказалось на то что яндекс создавался в два раза быстрее практически то есть это вот такая хорошие плюшки для наса версии она как бы бесплатно выдам ничего тоже делать не надо вот очень важно что иногда хочется сделать рен dex всем индексом и теперь это делать с конкурентно да это было это будет медленней потому что делается в 2 прохода но зато это будет бэкграунде работать и облегчит ваши административные страдания а можно теперь не просто сидеть тупо смотреть и ждать когда же этот индекс создастся примерно или яндекс пройдет вы теперь можете просто смотреть за тем как это происходит reporting а если прикрутить какую-нибудь мордочку то вы можете просто положить красиво это видеть и понимать что еще пять минут на куриное что индекс асдас а вот сейчас это уже уже можно теперь очень переходим к какой глобальные вещи как насчет как так я вот не понял здесь время идет 15 минут что и всего прошло они 30 минут пардон о том что в полисе а то что подписи изначально он создавался с такой идеи что он расширяем и tast'em брейки вообще написал в своем докладе вот о том что есть было сделано заслуга пузыри со видите вот и мы долгое время вообще говоря в агрисе нас нам всегда uhh uhh uhh укоряли вы знаете вот в mais quel и есть разные стороны а вот здесь и только одно действительно в адресе до 12 версия был один хит вот таблица дахид которая была просто захардкожены прямо в исходниках и народ говорил ну да уж у них зато у них есть проблемы с влогами там маску или вот но теперь мы сделали такую вещь видите вот в архитектуру патриса вставили слой называемый api для движков для сара джей то есть ничего практически не поменяли просто стал оставили api и вот развязали грубая сторож от развязали сторож от ядра и теперь оказалось можно делать например create access method и указывать типы какой например вот можно сказать использует какой сторож грабаря если у вас есть какие-то стороны например вы хотите ваши данные opengl ли данные можете написать в принципе если у вас есть сила сила и скиллы можете писать обтянул vista речь и использовать его это будет другое чем вот как скажем хип или еще какое другое вот самое интересное что сейчас делается так называемый z hip hotel и двенадцатью версии не успели вот есть на держишь в 13 успеет что теперь версии будут храниться не в таблице как сейчас проблема умудриться с ботинком все понимаю да что если много апдейтов пор риса человек плоть это связанно с тем чтобы что все версии таблиц все вверх и в версии записи хранятся там же где и the same таблицы скажем например ворог ли москвы или иска и сервере да все старые версии они хранятся в другом месте из за этого у них было утенка не происходит и теперь вот как раз наши разработчики пошли на то чтобы сделать похожее чтобы у нас действительно были актуальная версия лежала где таблица а старой версии лежали где-то там ванду логе вот я с одной из версии этого студия уже игрался миллиона blade of делал и размер не изменился я был очень рад то есть никакого вакуума и так далее не нужно было так что считаем что мы мы ждем что от этого он большой большой плюс вот захид что уже конкретно вы можете поиграться вы можете поиграться с колом с торой чем очень многие люди ждут от прогресса чтобы было как в верте ки каллуму старичкам плешин и так далее пожалуйста вот как раз несколько недель назад на в милане я слушал доклад хейкки из pivotal а не анонсировалась но дал на мою как разработчики знали что идет идет работа но вот он показал никто результаты что это называется z-top это каллум и сторож это расширение которое это расширение то есть это не штука в ядре расширение может быть которая выпускается доступна по подрисовывать цензе вот все работает так a column аренды с хорошей перфомансом их компрессий вот такие были у неё задачи и вот он показал какие то результаты видно что то что синий зелененькая плохо видно но то что зелененькая там где вот этот сторож выигрывает причем достаточно серьезным бывает выигрывает от а то что конор красненькая там где он ещё пока проигрывает вот так как это work in progress то есть мы надеемся что к 13-му релиза здесь все до лижут но уже вот приятно смотреть на компрессию которая уже реально просто но работает так что надеемся уиичи ждем а можете уже прямо вот витя с гитхаба скачать и попробовать с вашими запросами да то есть я знаю что есть работы над append он листочек вот у нас тоже руки чешутся тоже какой несторович написать но пока еще не знаем возьмемся и не возьмемся вот а еще одна вещь которая хотела ставится the park shin hye пруденс то есть вы знаете да чтоб адресе мы народ очень гордится что мы сначала реализуем функциональность а потом потихонечку начинаем улучшать вот сейчас 12-ой версии партиции районов секционирование достигло уже очень очень хороших вещей то есть например уже можно partition создавать с помощью каких-то выражений вот уже можно хранить партиции во время в исполнении запроса то есть когда выполняется запрос но вы не знаете но вот рисует конкретный результат вычисляется там сам selective ты здесь примерно приведите вот категория неизвестно она вычисляется если в 11-ой версии портишь и них не работал то сейчас вы видите что все прекрасно работает то есть во время runtime а мы можем вычислить этот эту категорию и все сделать от оценить те партии которые не нужны а вот очень сильно нас мучила такая штука что когда вы делаете insert и такую таблицу секционирования то в одиннадцатом релизе видите было всего 96 сопрет транзакций в секунду да там в 12 его релизе я уже стал 17 тысяч то есть уже теперь можно не бояться делать балки ever ты в эту партию секционирование таблиц и вот здесь как раз и максимально естественно как просто одна таблица несанкционированные 19а секционирования ну лан откинешься чуть меньше но существенно лучше чем было по существенно вот появились вареньки есть любители которые любят по френки и вот теперь они есть вот но думаю все на холоде поэтому никто наверное не пользуется валенки потому что highload это все-таки френки немного неправильно вот появилась команда вписку или вы можете теперь уже без геморроя просто backsplash dp большое показать посмотреть на все ваши profits и они рованные таблички и какие там индексы и так далее очень удобно раньше надо было писать запрос теперь уже стало так тост кто знает что тоста это та штука да тот кто хранилище где лежат длинные большие данные отдельно и это источник большого геморроя для нас потому что когда у вас данный начинает доставаться оттуда обычно это начинается идти тормоза так вот сейчас сейчас сделали его такую штуку что если вы а и там они лежат к прессованного виде например сейчас сделать такую штуку что вы не сразу все берете а только а только то что нужно по префиксу и вот пример например разница какая вот обычный пример вы берете просто некую под строку длиной 20 из вот такого длинного длины строки да и в 11 версии это было бы на 1 400 миллисекунд а в 12 re 7 секунд то есть существенно ускорили ткани революционные изменения то есть тост по прежним как был геморройным так и остался то есть он сначала все сжимает а потом com делит на кусочки это кажется не правильно по-хорошему идеально нам нужно кусочки бы разбить а потом пожать каждое из них тогда мы могли бы доставать конкретные кусочки они вот весь большой но уже для припять снова поиска во для таких вещей уже и мы имеем большой выигрыш вот мы естественно поигрались нашим любимым джейсон б как можно использовать литол studio то что знаете то что если джейсон by очень большой то какая то часть у него ползет в тост и доставать оттуда и будет медленно и вот пример показывает что мы здесь смоделировали некоторые вариант когда у вас имеется ключ и расположенные в сортированы порядке то есть мы берёте ключ и которое находится впереди грубая джейсона да и ключи которые находятся там все дальше и дальше и время доступа меряем вот скажем в 11 версии время доступа конкретно длинная большое для всех ключей то в 12-ой версии принципе можно было бы сделать вот так вот так то есть начинают только стала вот когда уже там становится на девятом ключе то есть когда уже время начинают врастать первые просто его первые ключи достаются мгновенно но это вот то что в принципе в 13 мы видим можем получить будущем очень быструю работу с ключами и тогда может быть тогда 13 релизе будет такой лайфхак что те данные которые вы хотите из джейсона заставать быстро надо располагать вначале вот пока сейчас это нельзя но некоторые люди уже могут статистика улучшили статистика вы знаете да что статистика в агрисе она используется для планера планеров optimizer выбирает оптимальный план вот но существует проблема когда у вас колоночки коррелированы когда у вас 2 колоночки пудры здесь считает что статистика по ним независимо а на самом деле конечно она зависима и на то надо учитывать и теперь можно сделать вот такую статистику клея статистике указать m7 и тогда у вас какие колоночки тогда у вас все станет лучше вот посмотрите как было в 11 версии у вас получается вот такой план и вы посмотрите что у вас планер говорить что нужно вернуть всего одну запись а на самом деле это 10 тысяч записей то есть вот пример простой пример как обычная статистика проверяются все вы понимаете с quelle понимать что там написано грубая вот на этом простом примере позлить просто проверяется в десять тысяч раз если теперь создать статистику эмси видно и по этим трем колонкам то мы получаем оценку 10100 то есть это оценка вполне похоже на арена действительность ip-адрес даст потом нормальный план выдаст хорошие то есть иногда это статистика бывает очень даже полезно и вы получили дополнительный инструмент но это не буду говорить у нас документация до сих пор не не содержал ни одной картинки теперь 12 версии у нас то есть такие картинки это паша прогресс это в стало возможным что благодаря того что наши к 51 компания перевела по адресу документацию зрение и джем или на xml после этого на вич как раз стало возможно уже туда всунуть картинки джэрэт'лиг columbus кто знает такое мега такая очень я сам думал нафига она нужна у нас есть другие варианты делать материализованный view там и еще триггеры там так далее но потом я подумал что вот такой пример например меня убедил вы знаете пола тел свою поезда вам нужно для того чтобы получим все работало нужно материализовать то с вектор делать дополнительный колоночку вы чтобы она обновлялась вам приходилось вешать триггер триггер который при изменении в табличке она делала тест вектор вот а теперь можно и место этого сделать просто вот такую табличку создать и вот здесь написать выражение то есть в данном случае мы видим что ты с вектор делается из ну из джейсона из 2-х двух значений ключей до объединены конкатенировать и потом вот показывается что мы вставляем туда верьте про оракулы пропал grease и результат вот мы видим что он действительно есть с вектор то есть вот до все хорошо работает этот эту галочка вы не сможете обновить если вы сделаете обретя втс заперта с ручками а нам скажет фигу это автоматически генерировать поле то есть вы не сможете еще сделать вот более другой пример который говорит показывает применение джейсон паса вы уже поняли что джейсон по сайтам ебучая штука которая позволяет валом из джейсона вытащить необходимую штучку в данном случае я вытаскиваю все все поля которые имеет тип строка и делаю я это с вектор видите как красиво тут с вектор v джейсон вот и такой массив и вот здесь джейсон пас указываю я показывал здесь получаю ошибку о дело то что вот этот выражение должен быть ему ему то блин и мутабельные то есть она не должна менять в базу не должно зависеть от базой вот здесь я сделала ошибку потому что в тут с векторе всегда нужно у указывать конфигурацию как только указать конфигурация будет работать и яндекс и все будет гораздо проще и вот жили радикалам колоночки сработали вот мы вставляем туда два джейсона например джейсон чик и получаем ответ прекрасно видите все вы получаете с вектор то есть это очень хороший такой способ который позволяет вам не спугни использовать материализованный view не использовать триггер и так далее а вот декларативно группы описать то что вы хотите очень удобно очень часто когда вы что-то делаете запросам вы пишете всякие сетинге все тащат все так далее потом делайте explain и вы уже забыли что же извините меня вы поменяли чтобы привело к тому что ваш запрос стал работать по-другому вот теперь вы когда пишете explain вы можете написать explain settings он и тогда у вас те как раз переменные которые повлияли на выполнение вашего запроса не все а вот именно те они будут здесь показываю то есть вы за задокументировали вашу работу посылайте вашему товарищу он должен вот эти сеты поставить дай все будет хорошо я считаю тоже очень очень приятная вещь вот была проблема с дубликатами в бы три вот мы видим что существенно в пять раз мы ускорились когда мы вставляем в bo3 дубликаты это очень хорошая то что делал саша коротком появилась функция позже про mode но не вы не не это самое то конечно не кластер но и сыску или но уже первый шаг ты типа вы можете уже теперь просто сделать не пыжик это или для промо to select позже prom.ua удаление таблиц кто-нибудь наступал на эти грабли а когда вы удаляете много таблиц и вдруг сидите и ждете когда же все это диск перестанет работать дело то что удаление большого количества близ связано с тем что вам нужно жареный пахра все там пройти последовательно если у вас ширина буфера например 2 терабайта как это бывает да то можете представить вам нужно их и так бы просмотреть посмотреть так далее так далее и особенно это очень плохо для санбой а потому что это ну как бы одна процессной один процесс работает и вот сейчас можно сделать вместо того чтобы отделить таблички можно в транзакции это сделать в транзакции бегин дилетанта трагика мид и тогда просто за один проход места что делать н проходов делается один проход и все учащается то есть это очень благ между репликацией становитесь существенно меньше это прям хорошая практическая новость так что делаете транзакции 12-ой версии логан теперь можно уже сэмплировать то есть не все писать а вот кусочек ну какую-то часть выборку вы можете указать вот чик суммы чиксу маме все перешли на чьих сумма или и все еще есть орлы которые верят что их диски такие хорошие и да мне уже горят что окончательно поэтому я потихонечку завершаю checksum и надо использовать вот теперь появился инструмент который позволяет вам просто ну как бы сделать это более удобно чиксу мы вот здесь когда вы будете upgrade на 12 у версию уделите внимание вот этим пунктам видите у нас убрались выдавай собрались там типы данных так далее кучу всяких вещей таких не очень но они могут иногда ну как бы вашему приложению повредить в марийскую красиво то что не compatibility но как я говорил самого же этот стыд это и проверьте чтобы не было каких-то проблем ну вот выводы из этого доклада считаю что это очень хороший релиз который открывает новые возможности и в 13-ой версии эти возможности должны реализовать и мы их очень ждем все доклад можете скачать"
}