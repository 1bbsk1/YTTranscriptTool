{
  "video_id": "0_CwH_lrPp0",
  "channel": "HighLoadChannel",
  "title": "Postgres Highload Checklist / Иван Панченко (Postgres Professional)",
  "views": 5938,
  "duration": 3155,
  "published": "2020-04-27T12:09:31-07:00",
  "text": "всем привет поговорим об адресе значит по традиции 1 нас программе хай-лоу чек-лист это вот а это структурированный но не полный как всегда перечень грабили вот они которых я буду рассказывать более конкретно более подробно некоторых просто упомяну по разным причинам практически каждая из эти грабили они очень глубокие и там хватит на целый доклад вот но надо иногда и перечислять тоже их но посмотрим за каждым с граблями о которых я сейчас буду говорить за каждым и там стоит чья-то боль значит кровь пот слезы и в общем все остальные выделения вот но в некоторых случаях даже расскажу какие хорошо поехали значит и так вот тут говорят highload олегу бой на спасибо за пропаганду этого термина но все-таки что в реальности хотят люди это не чтобы получить высокую нагрузку от этого радоваться а чтобы получить высокую производительность и не иметь проблем вот поэтому hallowed конечно хай-лоу дам но это нет не то чего мы хотим это нежелательная ситуация который надо избавляться значит вот что такое хай-лоу если кто еще не видел вот а люди обычно хотят получить друга и хотят получить high performance вот обратите внимание на эту схему на экране здесь значит кластер с двойным резервированием значит 3 ур тройным тройным двухуровневым резервированием значит люди которые эксплуатируются в кластер счастливы и довольны у них хватает время на развлечения вот при этом значит система свою функцию выполняет вот наше должно быть так значит вот сразу пример такой вот значит когда на меня хай-лоу тапиров серьёзно наступил это был 2000 год когда я работал в рамблере олег бунин по монтажу же тогда работал в рамблере вот это был такой август август традиционно тяжелый месяц для нашей страны и как у нас там говорили в новостной редакции подводная лодка столкнулась останкинской башне значит все помнят что трагедия значит на подводные лодки курс когда больше ста человек погибло и она была огромным на вашем поводом и люди интересовались очень сильно этим вот интересовались они так сам идешь спасательная операция спасут ни с парашютом выживет это не выживет кто то и люди сидели в интернете и значит или laudel эту самую главную страницу rambler или страницу рамбер меди где ожидали что выйдет какая-то следующая новость и в тот же момент произошло еще одна большая водя но в тот же месяц и скажем через пару недель после того как началось все это с подводной лодкой произошел пожар на останкинской башне вот это тоже относится категорий трагедий стан стан тоже были погибшие но три человека там погибло вот но 16 миллионов страдальцев осталась без телевизора а телевизор тогда был не только зомбо ящиком но еще и значит информационно источником информации и вот эти все люди они тоже пошли в интернет первый канал не работал они rifle laudel и первую страницу рамблер рамблер медиа и ждали пока же расскажут что-нибудь про во-первых останкинскую башню но и во вторых всё-таки чем кончится история с подводной лодки удастся спасти кого-нибудь или нет но мы знаем что кончилось это для подводной лодки плохо к сожалению все там погибли вот а команды rambler она получилась интересный хай-лоу доски опыт на всем этом значит вот на самом деле вот из топ-100 этот график и не настоящий потому что настоящая данная потеряно этот восстановлено по памяти и по картинкам вот на было примерно так что когда об обе эти нехорошие ситуации они случились выходные и ранжируется несколько сгладило трафик потому что когда что-то происходит в субботу-воскресенье да еще в августе люди в основном заняты уборкой помидоров там засолка огурцов и не сразу знают про новости вот поэтому график был не очень диски на в принципе мы наблюдали там в течение дня рост на порядок или на полтора порядка иногда и вот надо было при этом чтобы все функционировало вот начало железо тогда было вот какой написано значит 2 перенесем и третьих это слабее чем вас телефоне сейчас это тема меня обслужи лут весь рунет новостями вот-вот начнем это все было сделано допускались уже тогда был ну с помощью всяких аккуратных приемов удалось это дело разрулить и rambler не падал хотя очень многие новостные агенства другие тогда лежали ладно значит ближе к теме доклада значит конечно есть дисклеймер конечно доклад мы не претендует ни на полноту ник на глубину не универсальность в том что слишком широко тема ну вот что-то интересное по стараюсь затронуть вот не надо думать что всем поможет если вы выполните ровно все эти действия это даже не совсем рецепты вот это важная вещь о которых нельзя забывать вот и еще одна очень важная оговорка будет сделано в конце доклада на предпоследнем слайде такой вот вывод ну поехали значит чтобы д всегда проблема она занимает естественное узкое место потому что там данная там все сходится все потоки там сходятся там возникают локи это сложнее всего масштабировать вы не можете так просто взять поставить 10 баз данных и они не будут решать ту же задачу 10 раз быстрее да мы к этому стремимся но те меня базу данных всегда будет узким местом где информационные потоки пересекаются это надо понимать это надо объяснять заказчиком которые говорят поставьте 10 инстансов что вам мешает вот но и поэтому раз узкое место его надо либо сделать не таким узким то есть базу разгрузись либо все-таки постараться разделить его превратить несколько узких мест большая часть доклада посвящена такой более простой теме с разгрузкой базы вот это краткое оглавление сейчас мы по этим пунктам пройдемся конечно раз базы исполняет sql-запросы значит надо происходил запрос прежде всего писать подумать конечно начинает люди с того что оптимизирует sql и вот любит использовать в последнее время сети как они в подписи появились вот на не все знаю что сети это барьер для оптимизатора делают так что значит пишут сети и уэстом трали-вали отбирают туда всю базу и потом я из этого select а то что им реально нужно думая что они сделали что-то вроде в ухе такой большой удобной красивой а вот нет значит это не вьеха это реальная выборка всего она материализуется вас в памяти и только после этого делается основная часть запроса вот в 12 версии подвес это изменится вот там по умолчанию поведение будет в ряде случаев другое то есть это будет вести себя реально как в юха но в некоторых случаях будете вести себя по-прежнему как временная таблица который материализуется из каких именно сейчас нет у нас времени это обсуждать обратите внимание в релизе нотах там будет написано вот я об этом же завтра будет докладе олега борту но у подробнее подробнее рассказана вот значит временные таблицы люди которые переходят на фон из других субд и они очень любят использовать временные таблицы кроме того времени таблицы используются во всяких системах типа 1с и прочих вот но временные таблицы в подписи реализован довольно тяжелым способом с этим связан ряд проблем значит я к ним ещё вернусь на следующих слайдах вот дальше rm тоже всегда бывает проблемой опять же прикладные разработчики любят а р м потому что так проще потому что можно не писать всегда искал запроса работать на более высоком уровне вот тебе и наоборот мы терпеть не могут потому что они производят тяжелые запросы вот значит ли это что надо отказаться от веры ну тебе скажет конечно выкиньте их всех зачем они вот но прикладной разработчик скажи тогда мне придется в трое больше времени на это тратить вот и не останется на зарплату тебе дорогой ребей вот и поэтому тебе и смиряются то есть ну просто надо смотреть за этими аромами надо во первых использовать такие которые имеют возможность лучше чего подсунул все-таки сказал написанное вручную вот надо смотреть какие запросы они генерят вот буквально в эту субботу значит пришел нам от заказчика запрос где умны время просто несколько раз впишется там одно и то же несколько раз подряд а бывает вот на все это увеличивает нагрузку на собой две то есть просто одни и те же действия там выкупе теряется уж из теряется так получилось вот поэтому все что генерит варим обязательно надо проверять иногда пытаться надо брать такой рэм который на которой вас есть возможность повлиять или заставить его тот же самый запрос может быть сформулировать по-другому более оптимально вот очень многие разрабатывают свои горем и я тоже делал это два раза и по-видимому третьи тоже может быть еще предстоит вот значит хранимой процедуры примерно такая же холивар на я штука не которые их любят некоторые нет тебе и обычно не то программисты особенно кто переехал 40 лари иногда строит на них огромная совершенно системы то есть нам приходилось переводить оракла на подвес система в которых там пару сотен тысяч строк вот а вообще видеть приходилось система на которых несколько миллионов строк на pl sql oracle о и люди пытаются перевести это в позу из вот хранимой процедуры хорошая штука их использовать нужно даже с точки зрения хай-лоу да есть применение для них разумное это практических изначальный смысл приблизить обработку к данным то есть то что можно сделать максимально близко к данным когда данных много их не надо тащить на клиента вот это как раз естественная область применения хранимых процедур с точки зрения хай-лоу да вот но с точки зрения бизнес логики тут уже надо смотреть то есть есть какие-то аргументы за то чтобы действительно бизнес многих выдержать хранимых процедурах одна из них это безопасность вы хотите там делать ограничены api контролировать безопасность бережок дано с тем чтобы уменьшить количество мест для кто-то нехороший может к ним пролезть например даже так что поведем хранимой процедуры будут никогда никуда них не денешься но надо понимать что они тоже могут вызывать проблемы вот и о чем хочется сказать здесь вот какой язык быстрее для храним ок все уже знает кто считает что сей самый быстрый язык охранник да но на самом деле самый быстрый языках ради маг еще sql то есть не поил пожертвую а просто sql в том случае когда про димку на sql может задница ваш запрос может то есть процедура начисто маску или выглядит как девушка с параметром она может жизнь за избранница ваш основной запрос и тогда это будет как бы самый быстрый язык вот но на самом деле другие языки кроме плыл по же escuela тоже надо рассматривать часто иногда не быстрее если речь идет о работе с данными там все равно все все языки примерно одинаково вот но такие языки как павел первый по питон например позволяет организовать свое каширование результатов запросов или кэширование планов или что-нить еще свое потому что в них есть в отличии от пылкой же скрыла глобальный контекст в который вы можете что хотите кэшировать только смотрите что памяти хватило вот пыл v8 тоже очень хороший язык его используются даже в очень крупных системах скажу вам он интересен тем что он был быстро вычисление просто как как зверь почти как си pl в восемь ну скорости работы с данными они все примерно одинаково ну вот другие есть пилотом по php но я не знаю зачем их использовать если только в целях удовлетворения собственного фанатизма вот но всегда когда вы работ сохраним процедурами даже на флешку или смотрите внимательно память там не дай бог вам вернуть таблицу в миллион строк оттуда вот временно в таблицах да хотелось бы подробнее рассказать здесь у меня три по моему есть история со ссылками можете потом почитать там целые романы в письмах развертываются о том как люди страдают вот например здесь описан случай один он кончился хорошо кончился коми там это было с нашим клиентам как раз когда люди создавали создавали временная таблицы в одной сессии много создавали но их не ударяли вот когда временно таблице не удаляют руками они удаляются автоматически в конце сессии вопрос всегда или нет оказалось не всегда может не хватить ресурсов на то чтобы удалить их в конце сессии вот так собственно и случилось ну из этого значит пошли всякие проблемы вот который здесь описаны но это уже поправили вот вообще в 1с и приходилось встречаться со случаями когда до 1000 временных таблиц секунда создавались удалялись вот это конечно экстремально большие нагрузки вот лучше так не делать вот здесь есть ссылки на еще две интересные истории последний я даже вот здесь такую длинную выдержку из текста привел том что уж больно красиво написано поэтично вот человек страдал вам тоже на создавал много этих самых много временных таблиц суть была в том что у него использовался какой-то connection puller вот и если в приложении сесть и были короткие прикладной программе же думал ну нормально создаю временную таблицу в конце сессии она автоматически удалиться никаких проблем не будет вот а у пули раз есть и были гораздо длиннее то есть много коротких сессий клиентских отображалась длинная сесть и кулера который в общем-то и не закрывались никогда и временная таблица там копили скопились копились копились копились вот пока всё не кончилось европы раундом она бывает ладно значит то есть с временем таблицами будем осторожно и будем их удалять лучше явным образом руками вот настройки собой да это конечно тоже целая тема вот но если кто не знает про shared буфера в руками мгту значит срочно читайте документацию когда мы сделали под windows дистрибутив пожгли со который автоматически проставляет вот эти вот параметры нам сразу начал приходить положительный feedback который выглядел примерно так значит качайте с дистрибутив пользуюсь про он там быстрее почему он там быстрее потому что он ставит shared буфер с автоматически они по дефолту вот такой вот простой hand на тем не очень полезно вот про мы на носу work мем особенно про возможность устанавливать его перед тем как вы создаете какой-то индекс и там чуть чуть побольше памяти под это получить обычный народ забывает но такая возможность тоже есть вот of the vacuum я только упомянул эту тему целого доклада в общем его тоже надо настраивать есть еще ряд параметров важных связанных со стоимостью тех или иных действий например рэндом поисков такой интересный параметр ты здесь ссылочка вот можно прочитать хорошая статья и доклад с пдд и который был здесь 4 года три наверное назад про то как люди правильно подбирали оценки этих параметров но на самом деле будущем после сна учиться автоматически самых подбирать и уже тогда не придется об этом думать это будет достаточно скоро вот параллельность значит возрасте последнее время начала появляться параллельно 96 это были sea queen show сканы потом это стало развиваться и развиваться я рассказывал чуть подробнее об этом на московском hail audi осенью значит про то что дает параллельность вот надо понимать все слова лтп нагрузка то есть большое количество параллельных сессий с транзакциями вам параллельность не поможет потому что у вас и так все ядра заняты ничего пролезет и летят и так все какие-то запросы исполняет если вас аналитическая нагрузка огромное запроса там другое дело до параллельность поможет несколько раз вы можете повысить скорость работы вот в 11 версии пожгли со появилась компиляция маленьких кусочков запросов но она уже дает полезный эффект ее надо включать явно и в пакетах которые обычно распространяются на не в компе или на ее надо значит надо тогда вам позже самим компилить вот значит логированием очень часто люди включают полное логирование например для того чтобы по джеба джером исследовать свои запросы надо понимать что запись лога тоже очень много чего отнимает ресурсов потому что блоги писать тоже нужны ресурсы вот было несколько случаев когда люди забивали свой сервер записи логов и он не мог работать от этого вот но в 12 версии появляется интересная штука сэмплинг когда вы можете сказать я хочу уже не все запросы логировать этом пять процентов семь процентов 50 процента и поэтому вы можете и badger удовлетворить вот и тем самым диск и не перегрузить лагами да через syslog лучше не лагер уйти это просто более нагрузочным вот значит следующее направление это у нас операция из базы уносить операции с базой крайне полезно себе чувство на загружена попробуйте что-нибудь из нее убрать ну условно я так называют applications сервера но куда-то наружу вот во первых конечно бизнес логика который связан с вычислениями у вас в храним как вытаскивайте ее этого же разгрузит вот особенно ну есть такие крупные серьезные системы которые пишут настоящие профи да и они тем не менее держит бизнес-логику базе и даже в триггерах вот это чем-то правда например тем что war водка дело что ближе к 1 просто так там ее держать под большой нагрузкой не стоит просто потому что это создает большую нагрузку вот во вторых конечно сокращение транзакций то есть вот то что можно сделать вне базы и вне транзакции надо из базы с транзакций надо уносить но пред обработка данных остыл парсить html например то это не обязательно делать внутри су б.д. вот но хотя можно и там вот значит накопление данных то есть пред агрегация данных прежде чем укладывать их божью тоже может делаться вне этой базы вот значит количество коннектор те кто переходит на игра софт escuela они часто удивляются почему возрасте нельзя сделать 30000 коннекторов но к сожалению пока не взяли надо использовать либо пул либо на стороне приложения что-то менять вот есть такие ребята которые программируют по старинке и каждую пользовательскую сесть используете русским интерфейсом отображает в одну сессию с базы данных и такой вот старый подход все смотрели новых времен когда пользователь своим логином логинится в приложении и то есть его logging базу данных и когда он открывает форму там редактирование чего то там при этом базе открывается транзакция когда он нажимает на кнопку сохранить то тогда эта транзакция к месяц и вот но под высокой нагрузкой это не работает службе на транзакции плохо делать их не нужно в quark могу объяснить почему вот чем меньше длинных транзакций тем меньше коннектор чем меньше пользовательского контекста на сервере тем лучше вот значит если вы нашли вас есть длинные транзакции связано с тем что она чего-то ждёт не обязательно пользователям в ответ и какого-то внешнего сервиса это потенциальная возможность повысить свою производительность вот например типичная схема работы с внешним сервисом ну например это может быть сервис бронирования авиабилетов если в 1 своей транзакции пошли куда-нибудь за билетиком по http и долго ждете пока там вам ответят или не ответит вот так делать не надо это длинная транзакция то есть не то что совсем не надо под большой нагрузке так делать не надо под большой нагрузкой на сделать по другому но сделать коротенькие транзакция внешней коннектор взять из внешнего демона вот это это вам поможет дальше значит реплики про реплики будет целый следующий доклад поэтому я про них по-быстрому скажу значит ну вот если рассматривать репликацию здесь вот три способа перечислены потоковые логическое триггер на самом деле еще четвертый способ когда репликация делается проксей или приложением которое просто пишут сразу несколько мест вот но поскольку это в небо живот про 1 именно поговорим значит потоковой репликация дает вам действительно хорошие масштабирование почтения вы можете по цеплять несколько реплик но вот на моей практике до восьми это удавалось сделать эффективно к одной машине вот но надо понимать что ли доводы реплики пригодными для всего насчет до длинных запросов они начинают работать хуже логическая репликация лучше в том плане что реплика является полноценной базой и на ней можно делать что хочешь в том числе не редон ее запросы вот но надо понимать что же то она во-первых дороже стоит если она синхронна на сильно дороже стоить значит особенно сильно дороже на стоит если на нее реплицируется длинная транзакции длинная транзакция на логическую реплику идут фон лишь итак начали транзакция записывается куда-то целиком на мастере причем это куда-то целиком а нам ну в начале в память а потом естественно диск на диск на диск во-первых может просто не хватить места если это очень длинное транзакция вот во вторых когда она закончилась тогда все вот это начинает передаваться на реплику и тогда потом начинает там исполняться если это ещё и синхронная репликация это всего этого мастер ждешь дожидается это очень долго вот поэтому если у вас есть логическая репликация это значит большие транзакции вам скорее всего противопоказаны вот на что такое большое вы поверите сами когда вот увидите что на диск начинает писаться и медленно передаваться вот триггерная репликация принципе это очень мощная вещь это может она больше степени находится в ваших руках вот к этому относятся слоны landis там другие такие продукты вот ну и вы можете напишите сами на самом деле достаточно просто устроена главное не забывайте если вы будете делать очередь репликации внутри своя система не забывайте как слонах сделать ее со страничками то есть вы пишете то чтобы надлежит реплицировать в одну таблицу потом она кончается создаете новую кончается вы просто решаете хватит туда писать вот она кончается пишите в другую табличку в третью вот так страница не создаете для чего это нужно чтобы потом их целиком зачищать не делитесь и зашили де запись я целиком охранки тить вот так устроены слоны например внутри и вы так таким же можете сделать свою очередь репликации она можно сколь угодно умной вы можете делать аппликации не на уровне уже каких-то записей и других объектов базы на уровне бизнес-объектов более выше высокого уровня можете зашивать на сколь угодно сложную логику но если вы это делаете вот вы делаете это именно ради того что переживать бога чуть более сложная логику приятно в perform нас вы конечно будете терять по сравнению с потоков с логической обычной репликации значит длинными запросами вот эта тема важна поэтому и отдельно коснусь значит вот если по ссылки на документацию почитать в этом увидеть есть куча параметров которые рулит репликации как если вы исполняете длинный sql запрос там селесте что-нибудь на реплики вы можете получить ошибку потому что пока этот запрос крутится данное которая в нем использованна уже зачищен и вакуумом на мастере и это приехала по репликации вот уже нету чего то что вам сейчас надо прочитать в этом случае ваш запрос будет убит вот его на самом деле просто надо научиться в приложении такие запросы исполнять еще раз не получилось срубили один раз выполним еще раз вот если ваш запрос достаточно часто сваливается таким образом тогда можно сказать что этот запрос длинный он проблемный и тогда люди начинают подстраивать параметрам от которых здесь описаны чтобы да можно что то сделать но к сожалению не всегда вот вот тут уже макс тонго стриминговый позволяет вам сделать так например чтобы реплика могла отстать вот на это время ради того чтобы не удалять записи нужно каком блоке нужно какому-то запросу вот но соответственно волка по умолчанию 30 секунд вот то есть 30 секунд не будут накатываться новые змей если они мешают вашему запросу но вот если какого-то одного запроса например она ждала там 29 секунд накопилось отставание ну запрос проскочил все отлично а тут вы сразу разгонится еще один такой же она его уже не осталось его срубит все равно вот значит дальше вот там на мастере там вот можно указывать такой параметр для вакуума который будет откладывать вакуум на некоторое время что интересно этот параметр не секундах а в штуках в количество транзакций вот который тоже будет отложить немножко зачистку вокалу но понятно что при этом был отзываются вас подрастать вот и она будет медленно работать и между мастер вот есть такой интересный параметр хост r2 и фидбэк хитрый параметр останавливается на реплики вот в доке почитайте там целая история вот он сделан для того чтобы явно сообщать мастер мастер подожди я мне вот это вот нужно защищай вот это конкретно то есть не как случае с зефиром когда вы просто говорить ему столько секунд ничего не счищать да и время реплики он говорит я вот это это это я использую не стирается пока вакуум от к сожалению он работает не всегда и вот есть сам вот такими цвести целая история проекта но вот александр коротков может быть все таки доведет ее до конца и host on 21 век начнет работать правильно вот пока что резюме от всего этого что очень длинные запросы на реплики но они в любом случае чреваты конечно увеличением blows a на мастере потому что надо же данности где-то хранить или запаздыванием реплики чем-то из этого не чревато вот ну с тестом пытаются сделать так чтобы вариант с ход штангой фит в этом который достаточно велись достаточно аккуратным подходом решение этой проблемы чтобы он всё-таки заработал всегда вот поехали дальше секционирование таблиц новая тема которая по защите развивается вот уже несколько лет значит сейчас пока еще позже пас на в большинстве случаев быстрее хотя встроенный декларативный так называем парте shining уже почти загоняется в 12-ой версии мы ожидаем что догонят и перегонят вот соответственно если у вас старый позже вам надо использовать позже пасман расширения если новый то есть 11 больше можете смело уже использовать встроенное проецирование вот же чем таблицы вообще надо партиции ровать или секционирования вильно не знаю на это одно и то же во первых как ни странно если вы просто делать обычные запросы по парте церовани и таблицы это будет медленнее чем если вы будете делать таких запросов по одной таблице но в ряде случаев все таки польза есть например если у вас вы знаете что все запросу ваш попадают в одну партицию какой-нибудь и эта секвенция узко но тогда он будет быстрее вам если все запросов падает в одну партицию вот у мурки эту одну партицию положить на кого не быстрый диск например дорогой а все остальное свалить на дешевый медленный нам vacuum vacuum ведь огромную таблицу тяжело вакуум не идет в один поток одной таблице поэтому вы замочите все вакуумировать а вот отдельные секции гораздо лучше то же самое вы сможете танк едет по частям например если у вас есть вот как я рассказал про очередь если у вас есть какая-то временная начать штука которая нарастает все время вот вы можете старая данные про целыми портится метран крестить зачищать их по одной оного и все время дописывать вот значит параллельно исполнение запросов может попортится им иногда вам там помочь некоторых случаях вот а также хорошо что вы можете иногда секциями работать напрямую а иногда вот через таблицу который на них поделено вот но всегда думаете как позиционировать а также что если вам придется менять схему секционирования ну добавлять секции например дробить их думаете заранее о том как это делать на следующий важный кусок от асинхронная обработка вот это очереди проучу немножко поговорили на счет очереди позволяют сбалансировать нагрузку на запись очереди позволяет вам разгрузить базу в том смысле о котором я говорил вот в общем очередь это крайне полезная вещь очередь если вас все гонится в базу через входной чуть можете приостановить свою базу даже там накопить в очереди что-то в общем это это весь весь очень хорошие если у вас есть высокая нагрузка пропускать входной поток через какую-то очередь это здорово на только судить и при этом чтобы очередь была персистенция то есть могла не терял и данные при рестарте например вот а также чтобы она сохраняла порядок доставки и наш у вас что-нибудь может удалиться раньше чем она создана это тоже нехорошо вот очереди могут использовать для пост-обработки например отложены где нормализации отложено синхронизацию с какими-то другими систему генерации отчетов и прочее прочее значит следующий кусок moon многие думают что давайте разделим базу значит на части сделаем sharding это поможет в целом да то есть если вы хотите масштабировать нагрузку по чтению вы можете доставлять реплики readonly но масштабировать нагрузку по записи кроме шаринга другого способа нет поэтому все большие системы не рано ли поздно приходит к шарли нгу вот ну это может быть самкой географический sharding там sharding пойди а идем пользователей что нет еще вот и serving выполняется чаще всего наше время на уровня приложения хотя ей на уровне самой собой да тоже пытаются люди создать какие-то средства для шарден га вот ну и помимо хардинга могут быть какие-то архитектурные решения когда вместо одной системы есть несколько там сложно образом взаимодействующие между собой ну вот шарик уровня чтобы господь если начался с таких вещей как после с excel и позже жертв это было где-то 45 лет назад но вот позже sharp потом перестал развиваться компания сайта с которая сделала сделала свою базу полу коммерческую сайту сгибе который потом стал упал сосны потом на сайт искупил microsoft в общем из направлении судя по всему завел или завянет значит green план весьма удачный ford подвеса который годится только для аналитической правда нагрузки но зато он очень хорош в том плане что это единственное решение которое позволяет работать сотнями и даже говорят тысячами шар дав вот ну рано или поздно я эта функциональность появится и вне green палама в пастбища в частности и мы над этим работаем . xl хорошая штука она правда невезучая потому что несколько раз у нее менялась название хозяева разработчики она переезжала в китае возвращалась с китаем вот она в частности сейчас стоит внутри биллинга кажется в печати китайский такой есть самый большой в мире чат вот но она не позволяет так сильно масштабироваться как green план зато она как-то пригодна более-менее и для олафа и для лтп но у нее есть единая точка отказа отказоустойчивость она не совсем вам обеспечивается вот значит нашей компании идет работа над расширением позже шар 2 но она пока экспериментально для про да еще не годится но скоро сгодится отличие в том что оно делается максимально на встроенных в корпус вещах то есть на ftp на парализации сканов значит поэтому шарды например могут лежать и не в позже себя в каких-то других сторонах вот но тем не менее там еще много всяких проблем нужно решить она уже сейчас умеет хорошо масштабируется по записи на чтение пока еще хромает но этот вопрос решим вот значит ну шага к уровня приложения пока что предпочтительнее потому что приложение умнее она больше знает о данных чем сумма д вот вы там можете просто быть более гибким хотя мечта о том что база данных сделает за нас всю она есть она очень совершенно оправданно вот но целостно резервное копирование кстати ни в одном из имеющихся шар рингах решений для поиска по конец вот надо понимать что значит вы можете бы копить каждый шар по отдельности от транзак сон а значит сделать snapshot такой со всего кластер а пока никто не умеет вот над этим тоже кстати работа идет на прыжок он все федор сигаев об этом рассказывал ну и другой вариант который более более глубокого архитектурно продумали требует это вот построение ни одной системой целого комплекса который асинхронно как-то между собой бы договаривался вот так тоже делают но соответственно это сложное редко вот и подходя к концу доклада я вот о чем хотел сказать что обратите внимание есть такая закономерность что у нас есть реляционной субд и которые дают нам носит транзакционных если значит дает на временной таблицы что там они нам еще дает хранимой процедуры на всяких языках вот они все дают но чем дальше мы идем производительность тем меньше вот этим всем богатством это все роскошью мы можем пользоваться и в конце концов мы доходим до того что мы просто пишем мы читаем пишем и читаем вот спрашивается зачем тогда почему мы берем вот этот полноценно субд и со всем этим стандартам sql этом с этой и многоуровневые так далее вот почему же мы тогда не используем вместо собой д что-нибудь другое вот ответ такой что в любом реальном приложении высоконагруженные часть 1 как правило небольшая то здесь какая-то функциональная часть большая с точки зрения функциональности и высокая нагруженная часть узкое место большой с точки зрения нагрузки и причём заранее вы не всегда знаете где это разделение пройдет поэтому вы начинаете проект с большой полноценной субботы потом какие-то части начинайте оптимизировать и до достаточно высокого или глубокого уровня вам возможности чтобы захватить вот но дабы не используйте высоконагруженные части временных таблиц но в низком огромной части сколько угодно никто этого не запрещает вот поэтому надо не боясь высокой нагрузке спокойно начинается нормальных субд и возможно вам ее хватит вот хорошо значит clicker у меня перестает работать наверное меня уже а вот нет все таки работать немножко вот такая конференция будет москве значит я позже случаем всех туда приглашаешь там шлешь докладывали о мой доклад на этом завершён спасибо вопросики поднимаем поднимите ручки задайте вопросики да вставайте спасибо иван большое спасибо за доклад меня зовут максим компании яндекс деньги я хотел бы спросить вы рассказывали по поводу того чтобы быстро работала приложение то есть сортирование проецирования но прочь вот эти вот детали именно настройки подгорцы там для какого-то конкретного приложения что вы можете сказать по поводу того что сейчас скажем так ну там и эпоха контейнеров и тому подобного вот что лучше с точки зрения утилизации железо это один instance полюса и в нем допустим но не знаю там 6000 баз данных для разных приложений каких-то или это несколько этом контейнер с полюсом хорошее дело меньше вас до тема супер на самом деле как как что делать там хранить 6000 бат в одном из носа или нет дело в том что внутри одного из тасс у вас позже сумеет перераспределять ресурсы кое-как между инстансами ресурса не переходит то есть если по избегал какой-то shared память например ким сон су она к нему так и останется привет сейчас не на лету не может ее отдать это некоторое неудобство для всех облачных ноги вообще много искусных вещей такой есть вот фёдор сигаев сейчас пишут патч который позволит по адресу брать и отдавать shared память вот тогда станет тогда станет он более адаптирована к самому контейнеру контейнеров как вы говорите вот но и вообще к блокам вот на самом деле конечно голое железо всегда лучше издержки на виртуализацию на контейнеризации они есть никто их не отменял нас есть сложности такого уровня что вы с какой скоростью например работает ваша операционная система с контроллерами железо оно может сильно отличаться виртуальной в реальной среде и когда у вас там приложения много много пишут у вас это должны знать вот тогда важно чтобы очень возможностей контроллер железо очень хорошо были известны ядро иногда виртуальность прячет это вот вы можете упереться там в кратное какие-то различия в производительности лучше все-таки 1 инстанции в нем побольше то есть принципе с точки зрения производительности общей там это так да хотя наверное в каких-то отдельных случаях можно дать и другой ответ а всего добрый день и спасибо вы упомянули какую-то будущую магию про подборка став можно чуть по подробно крашером просто пардон подбор параметров cost да может быть еще каких-то автоматов смотрите на самом деле сейчас вообще я очень много идет работать по поводу того чтобы он смог сам настраиваться там в каких-то смыслах вот на oracle как известно объявил что они теперь автономная базу данных настраивать их не надо но вот этот эту в головах у всех есть вот в частности подбор параметров там какие-то элементы машинного обучения вот над этим разные люди в мире работают у нас там под гаспра тоже работают вот то есть какие то оценки такого рода они будут корректироваться по ходу работает при этом и соображает что надо чуть-чуть изменить оценки то есть это не на уровне инсталляторы даже в процессе работы кассиров конечно новые осцилляторы самое простое конечно но это неинтересно этого нет это все равно понять это все равно от куется должно определиться как сам не знает инсталлятор должен быть очень умным или он делает должен быть очень медленным а должен померить ну вот таких осцилляторов которые имели бы производительность так всерьез ну что-то я таких не видел а вот по ходу дела я торчу скорректировать это нормально спасибо за кончик микрофон по первому ряду отлично здравствуйте спасибо за доклад можете гнался по поводу секционирования вот выборг отличие вы говорили вот грамотный выбор для чего-то нужен можете поделиться пожалуйста вашему best practice то есть секвенировать по ключам кода там или еще какие то варианты но поймете это в приложении зависит то есть если у вас действительно есть четко выделяемый какой-то кусок данных которые называются новые оперативные данные в этом случае вы селекционер уйти подан по датам если особенно если вам надо зачищать старые если у вас какая-то существенно части работа идет с последними данными тогда да но на самом деле часто бывает что нет потому что когда системы развиваются скажем так что архивных данных столько же сколько новых и потом то есть это важный неровные такие сегменты поэтому может быть интереснее будет делить как раз но папа клиентам например да по клиентам как-то вот если вы делаете они просто за цианирования sharding можете по географическим зонам все разносить вот но это не то что здесь можно дать рецепт или без прокси бесплатно занимается сделайте модели померейте вот это вот best practice где-то очевидно да ну вот не очевидно то что не всегда подойдёт вам именно проецирование по времени особенно в развивающейся системе если это хороший бизнес растет экспоненциально и там вам это не поможет вот и еще насчет шарден может быть здесь ключ может быть многоуровневый то есть даже например деление по времени вам может не хватить и тогда вам надо будет ибо времени еще почему-то спасибо и вам спасибо большое за доклад как всегда очень интересно появляются новые мысли вопрос прошла родирование вот у меня есть рабочий кейс и возник интерес приз родирование могу ли распараллелить снятие бэкапа и какой тип выкопай вы предпочитаете сортированных базах но смотрите как я уже говорил вы не сможете сделать сейчас на шарди раваны конфигурацию целостный backup вот это главная проблема год но опять же работа над этим идет вот если значит посмотреть доклад фёдора stiga его на позже конфи этого года вот он там рассказывал проводник стоишь на пруд и которые можно будет снимать отдельных сортов и их можно будет снимать очень дешево практически мгновенно и потом уже можно будет их бы капица но вот это вот этот а через пару версий по адресу такой выйдет на самом деле сейчас мы ожидаем что в этом году фонд про это станет доступным как экспериментальная фича вот когда это доберется до общего доступа это соответственно еще парочка лет после этого вы сможете сделать шар дав уже должны и бэкапы то что если вы жаждете по времени например вот наш орбит во времени так интересно как секционирование не внутри одного из нас она если ваш ардити по времени тогда такой проблемы не будет потому что старая шарды там а на них уже мало апдейтов например и вы можете наплевать там на целостность на целостность масштабах можете их бы копить редкое по отдельности вот в этом случае вам действительно sharding облегчит backup старые вещи лежат отдельного бы копить отдельный редко вот но это то что приходит голос него спасибо за доклад у меня зовут кирилл вопрос по поводу временных таблиц в контексте сиквел серверов stop by kirill а вот вижу его господа повторить тут просто нам светит в глаза не сказывается увидел обычно же в г слышно вопрос про временные таблицы но в контексте стекла сервера мог вы поминаете что их нужно как бы снижать их использование если все таки есть факторы и таблицы там скажем три или четыре и не связанные данные но в отчетах они через временные таблицы как бы joy ница правильно я понимаю что надо переносить надо на пакете джонни какие еще альтернативы но смотрите я же не говорю что вообще не надо использовать временные таблицы может быть для чего-то и надо использовать просто в после seo не реализовано более тяжелым способом более ресурсоемкими чем в microsoft sql а вот поэтому в них можно упереться раньше и быстрее вот что то вот вот здесь есть такая вещь как джейсон то всякие сложные агрегаты c т.е. благодаря этому вы можете то что раньше вы делали с помощью временных таблиц сделал с помощью вот этого всего это будет работать быстрее и эффективнее вот надо провод с помощью курсивных статье может делать вообще что угодно + g и солнышке агрегаты и пожалуйста вы получите многоуровнего чё ты там с разного разных тип нами какими-то данными может быть вот это поможет здравствуйте спасибо большое за доклад у меня вопрос такой насколько я слышал есть возможность подселить одну таблицу с какой-то базы данных кнута пусть у с другой базы данных на как на отдельные база данных мтс есть такой есть предложение точнее одно несколько и есть одно приложение которое работает на запись для допустим таблицы пользователей и мы хотим эту таблицу осилить на остальные база данных которые привязаны другим предложением как и дом ли как только для чтения вот есть приложение которое пишет базу данных пользователей мы хотим эту таблицу не синхронизировать данные каким-то там на уровне прикончила а мы хотим и уровне база данных на уровне пост киса просто дать другим базам данных доступ к этой таблице рядом ли только для чтения каким образом это лучше делать но чтобы не дублировать данные и это какая-то life реплика должна быть смотрите нет но вы можете там из других баз данных подцепить через ftp это таблицы она будет видно весь битов арендатора перт на нормально хорошо работающая вещь даже если это будет один из танцы на разных физических машинах да конечно когда мы можем уткнуться в над connection правильно можете до можете но туда же эти данные редон для нужны да да но опять же хорошо как бы мы будем работать выборкой как там с ключами с индексами все это обстоят дела но нормально через вдв вы имеете скальная интерфейсу все то же самое можете сделать а если он не хватает коннектов нам куда-нибудь отложите на реплики readonly будете иметь доступ к этим росси должна быть с этой минуты мы можем ответить на платные вопросы вот пожалуйста 500 рублей быстрый без на лан лан за счет хайло да еще один пока передают микрофон друзья в 19:00 интеллектуально развлекательная игра мозговой не традиционная для хайло вода записаться на нее можно слева при выходе из этого зала спасибо за доклад сергею реки общем каверзный вопрос на говорите есть ускоряет но почему по дефолту выключим что-то не пошло не так я точно не знаю почему по дефолту его исключает может бояться но просто для jetta нужен не каждый компилятор подойдет и потом джитни на всех платформах там есть вот если вы хотите жить вам надо собирать эту шлангом они рецепции вот возьмите соберите ничего сложно он работает а ok если мы его соберем дает я попусту можете привести примеры где то вообще поможет то где то не поможет ну смотрите сейчас он помогает если у вас есть арифметические выражения внутри selecta то есть если вы например ешьте select там x плюс y умножить на z такое выражение это назад жениться вот ну или где-нибудь еще там вы тоже такое выражение становитесь а вот сам по себе план исполнении запроса нет на него это пока не распространяется ведь были всякие исследования на эту тему несколько групп по этим занималась в том числе в институте системного программирования ран были ребята которые это делали они докладывали об этом году три наверно назад на европейской конференции по полису вот их решения было в принципе очень хорошим но грант на следующий год они не получили кто-то им там не дал не знаю и по-моему они забросили это дело но я рад буду ошибаться но от них что-то больше ничего не слышно или они все получат гранты продолжим но не знаю тема jetta она в принципе очень глубокая то есть хорошо бы чтобы весь sql запрос можно было что-то скомпилировать там на лету или как вот но пока это только на очень небольшую часть устранять соответственно не всем поможет и понятно спасибо и последнее на сегодня ваша продолжение уточнение можете перечислить какие части компилируются ну вот высказались дорога из логические операции наверное еще битовые маски туда же входит что то что вообще умеет начнете насчет битвы вот масок не знает их физически операции знаю вот те вычисления которую ваш там идут эти выражения фианит жителя но поскольку коротко то вот на последнем ряду давайте еще возьмем да и но мозга бойни записывайтесь друзья не не просто так день должен закон спасибо за доклад спасибо что увидели вот у меня вопрос у меня одно уточнение по поводу оверхедов докера и ну и контейнеризации виртуализации то есть для больших наверное объемов это имеет значение но для стандартных кейсах там overhead буквально два три процента и я не думаю что это имеет какое-то значение это имеет значения действительно при больших нагрузках чтобы не пугать просто людей у которых таяния виртуализацию хорошую штуку конечно я же как можно быть против виртуализацией наши этом говорилось контейнерный век допрос нет но на больших нагрузках до упираются люди в тех пор и по поводу портирования я может быть упустил вы про темп скилл тебе ничего не говорили правильно да вот это такое расширение которое работает ну как extension на 9 10 11 12 будет работать она умеет его внешние ключи она интегрируется в планировщик запросов и она значительно лучше встроенного и при этом она ориентирована само собой на время то есть они первичным ключом должно быть время но это необязательно можно любой монотонно возрастающая отомстил тебе интересная штука на сделаны на базе позже пасман а о которой я говорил вот полезная вещь для garmin давал бы посмотреть а у нее куча всего автоматизированного и руками не нужно там не сентенцию удаление устаревшим чанков автоматическая и там есть возможность менять объему и чанков т.е. следующий чанг будет например там две недели а че когда вы экспоненциально растете вы можете чанки просто однако bandai говорит что теперь ты один день теперь там три часа и все это параллели цена разной чанг если мы режем и в разные временные отрезки например да все таки есть хорошая вещь всем спасибо за рекламную паузу отлично иван кому мы сделаем подарок за хороший вопрос фух их штуку было много этих вопросов всего один каких хороший хороший дата нет хороших было много вопросов я думаю что про за вопрос про jit компиляция мы дадим приз а вы здесь еще вот прекрасно сейчас к вам но это так что видите 500 рублей обнулились к им все нормально иван спасибо благодарность от оргкомитета и аплодисменты от слушателей спасибо"
}