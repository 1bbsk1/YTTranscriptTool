{
  "video_id": "ou8D_gr-U6k",
  "channel": "HighLoadChannel",
  "title": "Реализация системы отслеживания заказов / Равиль Гарафутдинов (VoltMobi)",
  "views": 457,
  "duration": 2482,
  "published": "2018-08-16T04:43:32-07:00",
  "text": "сегодня расскажу вам о процессе тема от свежей заказов на примере сети ресторанов якитория то есть я вам расскажу как мы делали машинки для гитаре и вольт обе компания создана в 1 ст вам году москве мы создаем и программные решения и имеем собственно продукты у нас в клиентах достаточно много таких крупных компаний такое гитаре и кето рияд сеть ресторанов восточной пищи работать 99 года у них есть от 8 марта в москве и области у них также есть ресторан и там за пределами в московской области и в пиковое время скажем вечером в пятницу доставку вселяют более 300 курьером в анус пен и достаточно много и так она в начале шестого года заказчик пришел к нам с предложением рисовать для него системы доставки заказов отслеживая доставки заказа парень темп примерно забрал что хоть заказчик дизайнеры примерно нарисовали экраны и разработчики в том числе я мы сели обсуждать как это можно сделать первый вариант был довольно простым у курьеров есть курьерская приложение кота развивается delivery boy в нем они получают заказы они получают там состав время когда его надо доставить там откуда надо забрать все такое прочее мы на это приложение вершим сервис который просто собирают у них координаты то есть и раз получает координат от боли этого на сервер сервер без обработки потому что то обработки не думали слайд просто ее на клиентское устройство и клиентское устройство там в точке а на примере совет машинку потом сервер посылает 2 координату точку б и клиентское приложение просто и стоит там перемещение машинки с точки а в точку б вроде бы все там ничего сложного достаточно просто мы как вы понимаете сильно ошибались то есть вот как это выглядело как она едет данная it в общем с таким решением мог заказчик они пошли чтобы на завернул сразу требуя заказчика ну поехали на конечно поехал то что она сейчас изображал это был совершенно неправильно заказчик хотел чтобы машинки двигались плавно и естественно это не совсем так скажем так машинки должны двигаться по дорогам опять же он очень сильно сместился дороги и отображение должна двигаться с минимального интере аль на курьера то есть тут у нас тоже все было плохо отображение у нас оставался на 2 в первом подходе почему так было то есть вот тот кусок трека который тут машинка только что проехал так давайте вспомнишь такой gps gps tracker в во всех мобильных устройств и сейчас исключения там совсем уже плохих есть gps tracker встроенный то есть например если взять орел что там есть локейшн менеджер мы грубо говоря настраиваем каким-то образом там говорим каким корзина хотим получать с какой там мощностью мы хотим его использовать подписывайся на и обновление и получаем координаты у-координат есть один небольшой минус все данные которые они дают это моментальные данные во первых а и второй минус у всех этих данных есть погрешности но раз вы версии достаточно прилично то есть что нам дает gps-координат а это во-первых штата долгота у них ну могут быть очень большие погрешности этой скажем получить погрешность 5000 метров это ну вполне возможно скажем тот же google maps в этих случаях рисует большой здоровенный синий круг то есть вы примерно здесь но вообще не очень точно gps там радио дает нам высоту опять же с погрешностью мои отбрасываем потому что у нас курьер как бы верхних не поднимается мы считаем что карта плоская дает моментальный угол моментальную скорость и time стемп стемп стемп для нас тут достаточно сильно важен пытаемся темпу мы считаем уникальный с точки то есть если нам на клиента пришло две точки с одинаковым темпом во вторую точку мы отбрасываем то есть другая не другой нас интересует угол и скорость здесь моментально то есть gps очень мало что знает о предыдущем измерении и совершенно ничего не знает о том измерении который будет в будущем потому что его на самом деле кто не гарантирует то есть она может вообще не случится в течение там 30 минут следующих доплести поэтому углы скорость моментально как-то их использовать мы для отображения не смогли потому что они совершенно не точное скажем курьерской устройство это напомнив его и там что-то y6 достаточно древний штука там 12 и 13 годов он скорость например отдавал с округлением до целую т.е. скорость была или два метра в секунду или 3 метра в секунду или 4 метров секунду это очень неточно угол в принципе можно было использовать но опять же если дпс не знает о том куда поэт курьер в следующий раз чаще . то угол показывает на самом деле молоко мы смогли использовать скорость в качестве первичного фильтра то есть обратите внимание вот узел вот этот который здесь находится здесь на самом деле курьер стоял на месте то есть и зачет он там остановился в какой-то причине может там пробка была перед переездом или что-то такое он там стоял вот все вот эти танцы вокруг от этой точке мы обозвали общей слова паутинка то есть он похож на путинку они происходят из-за того что все координаты несмотря то что курил стоит на месте или там медленный медленный один период дается с небольшой погрешностью если курьер в это время двигается как например вот на улице сверху видите эти погрешности а не особо роли не оказывают то есть там метр на метр право не очень важно а вот канал стоит эти погрешности является основной сигнал их надо фильтровать отфильтровали мы довольно просто двумя способами на предобработки сервер отбрасывает все точки скорость моментально скорость которых меньшую 2 метра в секунду то есть это достаточно грубый простой подход при этом мы также обросли точки между которыми было меньше а моим одного метра тоже достаточно другой подход у этого подхода есть один минус машинка никогда не останавливаться то есть даже на светофорах видно что она чуть-чуть ползет вперед прямо очень незаметно но видно что наползет но тем ни менее паутинку мы отбросили так далее 2 нашей задачей было привет как улицам тут это была очень большая сервер на задачу без гиа кадры решитесь ну практически невозможно только там писать самописная что в итоге снова станет я кадром выбирали мы из яндекс папа пий айс р-н поп но стоит нам и чего-то самописцем то есть там у нас разработчик был который что-то там самописный предлагал самописная от села сразу качестве не было очень хорошее улучшать его был достаточно дорого yandex map api и мы рассматривали ну во-первых он платный этого минус плюс его в том что на веб версии сайта тоже с пользуется яндекс карты и получается использую яндекс карты и яндекс карта гиа кадр мы получаем достаточно хорошая точность при смещении но заказчик выбрал айс rm потому что во первых он бесплатный во вторых там есть возможность написать если нам что-то нужно то есть там подкрутить его о сером показался оказался достаточно хорошим вариантом я всячески могу рекомендовать он ну работает хорошо привязывать тоже хорошо и его используем достаточно простое вы берете те точки которые надо привязать к лесам задаюсь какие-то там параметры по силе привязки нужно отдать немножко буквально пять точек да и последние пять точек тоже не обработается потому что фактически на последней точкой со времени знает куда плыть машинка он может на для там нескольких последних сказать куда напаять для последнего ничего сказать не сможет поэтому последний . фактически обрабатывать нашем случае мы их сохраняем и просто создающим пакетом а не будь первым то есть тут небольшой минус но тут таким никуда не деться он вносит небольшую задержку то есть там районе к этой секунды машинки у из рима оказалось два всего минус а то есть так во первых по не очень понятным причинам привязанные точки иногда там такой артефакт получался что машинка вроде бы ей прямо прямо прямо потом почему-то она делает разворот на 180 делает там 20 метров назад снова разворачивается и снова едь прямо то есть такой глюк отсеивается тоже достаточно просто матем все точки где был поворот насквозь играл снова раза подряд то есть мы предположили что курьер на так делать нибудь если там исключать крайний случай гололеда и простых отрезать 2 глюк у srm он иногда не очень точно привязывать к улицам где есть такая двойственность то есть например если есть две параллельные улицы которая достаточно близко друг от друга и курил ей по одной из них некоторые точки которые из-за опять же глюков gps оказывается ближе к 2 параллельные улицы не мог признаться к ней то есть как с этим бороться наш сервер на заботилась пор не очень понял ну достаточно сложная проблема мы пока здесь ничего не можем предложить так задержка я сказал далее для плавного движения машин то есть если мы посмотрим вот здесь так требований не требует здесь нет хорошо для плавное движение машин нам пришлось почти сразу отойти и вот при начальной схема то есть не получалось уже передавать всего одну координату от курьера сразу по этой одной координате там рисовать машинку потому что ну связь на самом деле очень такая штука ненадежная и пришлось перейти на пакетный способ придать координат то есть клиентское приложение сейчас запрашивает у сервера последние 30 секунд движение машинки что сразу добавил очень серьезный промежуток времени задержки но снял почти все вопрос по плавности движения то есть последние 30 секунд у сервера хотя бы что и , есть причем если у сервера этих 30 секунд последних нет он дает последний известную точку которая там может там полторы год назад то есть всегда можно показать клиенту при этом даже в том случае если курьер сидит день там не знаю в туннеле например или там отключил gps вообще и от него нет . совсем у нас всегда есть . от cooling заказ забирал то есть . ресторана машинку указать вам урок так что у нас дальше обработка координат мы рассматриваем три варианта первый вариант самый хороший был сам интересный для меня к мобильному разработчику все делать сервер то есть сама интересный вариант для серого за бочек а был другой вариант более интересен все делать на мобильных приложениях в итоге по иронии судьбы и закону подлости нам пришлось word третий вариант самый плохой часть обработки делалось на сервере часть обработки делается на клиенте почему большая часть делать сервер на самом деле скажем привязку к улицам приладить инфильтрация делать сервер то есть почти все делать но сервер давай координаты пакетом он не знает состоянии дел на клиенте то есть он не может сказать в каком состоянии например машинка передавать все эти параметры в запросе серверу это ну там вот такая строка получается мы решили этого не делать в итоге конкретным отображением рулит собственно клиент и клиент до фильтра вывод все те точки которые мне нужны например как я уже говорил но таймс темпл то есть поскольку все рыдает последние 30 секунд а за пашу мы естественного чащин при раз 15 секунд сервер очень часто дает дублирующие точки мы их отрезаем кроме того если был разрыв например ехал-ехал курьер потом у нас когда-то кончились машинка остановилась она стоит через скажем полторы минуты сервер подал нам следующую пачку координат между точкой а и точка b то есть . от последней . димка так машинку . бы это первая точка пришедших координат очень большой разрыв если мы будем отрисовывать нормально то машинка будет ехать напрямик через там через все квартала через там пруды и озера полторы минуты если по-честному делать мы травы просто склеиваем и она там за доли секунды просто перепрыгивает то есть это делает клиент все это делать не может далее простой вариант отображения очень много проблем было с отображением машинки мы ну собственно путинг вот такие вот вещи тоже тут на самом деле курьер заехал просто этот переулок понял что он едет не туда и поехал обратно то есть вы весь этот проезд фактически здесь что там 20 секунд всего то есть он там даже не останавливался или может остановился там понял что он едет не туда позже пьесу там пол навигатор и поехал обратно но если все это отрисовывать честно то получается такие вот развесить игрой я так по три совке машинки у нас не пытаясь от читать это бесполезно совершенно не нужна информация у нас было очень много вещей которые пытались усовершенствовать то есть мы пытались отобразить машинку тремя разными способами то есть первые два провалились третий вариант простой оказался то есть были например такие вот супер экзотичные варианты там начать отрисовывать поворот машинки за пять метров до там точки поворота и закончить его отрисовывать через пять метров после точки поворота того чтобы машинка плавно поворачивал мы все это дело честно реализовывали и все это дело мы как бы вырезали потому что все это дело выглядело крайне клюнул так рано у нас получился очень простой вариант то есть у нас две независимые анимации машинка просто с лениным ускорением едет из точки а в точку б и 2 независимо анимация . машинка просто поворачивает на нужную волну за 0 2 секунды и все очень просто таким образом мы немножко не естественно поворачиваем при резких поворотах например там 90 градусов больше но вот самый частый вариант это проезд какой-нибудь плавные дуги например там когда машинка едет по какому-то плавному шасси с плану поворотом от все отрабатывать замечательная машинка парочка как анти перекрестке например тоже с поворотом там по радиусу хотя бы метров пять это тоже всего идеально то есть единство вариант когда машинка резко впрочем где-то он не очень хороший так хороший трек а поскольку у нас фактически мы показываем динамическую систему очень большую роль здесь играет даже не столько качество данных сколько получить это данного время то есть если нас курьер реально учил все точки все эти точки успешно переданы на серы что тоже далеко не всегда происходит потому что у курьеров но у нее очень хорошие устройство они могут там быть где-нибудь очень далеко от сети и точки там могут не передаваться и капица достаточно долго даже если сервер хорошо приняла хорошо обработал если мы их передали клиенту эти точки могут за все это время вторить и фактически сервер придаст клиенту одну последнюю точку и все показать нам ничего то есть хороший трек это тот трек который от каждого 30 секунд запросов клиента имеет какую-то там порция данных чтобы показать это все достаточно сложно будет отлаживать об отладке расскажу попозже и мы это все отрабатывали но тут каких-то интересных решений на самом деле нет все это пришлось отлаживать подбором фактически всяких коэффициентов вот здесь эта схема задержек так стоять это было схему задержек как это у нас все работает курес к положение дилеру бой получает очередную координату и кладет его в очередь на пересылку хочеть отправляется каждые 15 секунд это число настраивается и очень flash если не удалось передать по любой причине мы как бы во-первых показываем курьеру там большой здоровье ! чувак у тя что-то неправильно давай разбирайся и из это очень сохраняем она попытается отправиться в следующий раз и следующий раз наступит через 5-ку то есть он будет пытаться каждые пять секунд отправить все это учить она будет копиться копится-копится мы получали например там по тысяче координат если его курьер была плохая связь то в конце концов он там тысяч картина собрала передал или все то есть сложно достаточно при этом если очередь понимаешь что придавать собственно ничего про что-то передать ничего передать у курьера тоже загорается другой большой ! что чувак у тебя что то не так же пьеса пожалуйста проверь корня должны собираться в общем-то собирается эта проблема далее q резко перенаправить когда-то на сервер пакет может быть довольно большим мегабайта сервер его принимает и сохраняет у себя во временном хранилище далее синий интервал сервер обрабатывать точки привязать к улицам и проводит пост обработку при этом работает исключений точек там путин и всяких там нехороших вещей привязка к улицам это привязка культом через р.м. пост-обработка это удаление нехороших вещей которые уже принесены привязкой к улице ну и добавление некоторых искусственных точек например там 1 . это у нас точка ресторана вторая точка это точка у ресторана когда мы знаем направление на курьера потому что сначала мы не знаем машинка всегда смотрит на север 0 ну и последняя точку там это . доставки далее в какой-то момент клиент запрашивает очередную пачку координат и до 2 секунд она получает и обрабатывает то есть поскольку клиенту приходится обрабатывать тут тоже кого двух секунд ну и в конце концов черный интервал это от 0 до 30 секунд мы начинаем покажу машинку самом плохом варианте 30 секунд в самом хорошем варианте одна секунда пример то есть самый хороший вариант а когда кури клиент смотрит в реальном времени за доставка его там суши или пиццы и машинку и сразу появляется сразу начинает ездить одна секунда так привязка курица тра-та-та замечательно при этом что здесь можно сэкономить сама большая наша проблема была именно достичь вот такого результата при начале у нас было около 2 минут здесь задержка что заказчик есть не нравилось очень сильно здесь на самом деле можно сократить красный интервал немножко можно сказать синий интервал и как-то можно поработать в черном оторвал сокращение краз интервал ведет к тому что у курьера будет достаточно быстро садится батарейка то есть принципе он может передавать там 1 2 секунды например свои координаты и может там например поставить локейшн менеджер себя от чтобы он там самый там лучше всего долбил но как бы имейте ввиду что курьер едет весь день и ему принес какие-то на право дать или даже батарею на хватить на час в этом случае 15 кунту подобрали достаточно приличным получается 1 до 5 секунд обработка сервера ее тоже можно в принципе уменьшить потому что часу на свой срам развернут на одной ноте то есть если у вас будет например там их 10 то вы сможете бралась больше координат ну нам пока хватает одной и черный ты рвал можно тоже уменьшать но опять же мы выбрали 30 секунд на 30 секунд нашу сервера как правило есть что то что показать можно если вы сделаете он припяти секундам у вас будет как бы задержка меньше но очень часто пользуюсь будет смотреть на одиноко стоящей машинку и в среднем вас получается отпустил 40 секунд примерно задержка то есть курьер когда звонит в дверь пользе любить как машина подъехала и там появляется галочка так и стоять 5 и собственно вот вариант номеру сена с которым нас получился как вы видите он очень сильно усложнилась просто чем не факт что ли появится 19 вариантом 20 вариант 21 вариант там все такое прочее и собственно вот как у нас получилось то есть тот же самый ну как вы видите машина едет немножко не по улице потому что сны google maps немножко спадает но тем не менее сейчас - нет мы рассматривали яндекс карты api как я кодом если бы мы выбрали яндекс карты на мобиле и используя бы яндекс карта гиа кадр тогда они были вы совместимы полностью но к сожалению у нас показана и яндекс карт и яндекс маркет нативные он сейчас недоступен то есть у нас был бы вариант только использовать там в плюс привязка j-хэт одну врагу не пожелаешь багов привязки мы проверяем и сейчас то есть у заказчика есть планы перейти на гиа кадра яндекса по некоторым другим причинам но посмотрим как получится не факт так что дальше ну собственно как вы видите все видит хорошо при этом предыдущий предыдущие видео которое вы видели машинка на сам ли проехала вот от белой линии до желтой дороге всего лишь то есть сейчас она проехала фактически всю улицу повернула нормально то есть ну все работать хорошо далее как вы все это отлаживали поскольку тут все фактически это прием клиентам каких-то данных то первый подход это дать там тестировщика руки прокси и пусть себе закидает руками поскольку фактически клиент у нас каждые десять-пятнадцать секунд что за прочту сервера причем каждый раз информация разное меняется она по разному и надо именно вот в этот момент что-то посылать то наше замечательное служение ну на второй день начала ругаться и хорошими словами и там показывать там руками всяких жеста что у нас нами сделает поэтому пришлось нам напрячься и сделайте несколько отладочных инструментов первый из них был для отладки статике то есть вот например вы сейчас и увидите отрисовка трека просто отрисовка статического трека который приходит сервер тут мы смогли отладить качество обработки сером всего на свете и если вы тыкаете например какой нибудь из точек то он пока с параметр цветочки то есть там стоим там координаты у нас ведь этим отработали статику далее вот то что вы сейчас видите экран player то есть нам пришлось везти гибочный режим и фактически в него загружаешь номер трека который нас интересует нажимаешь to make и начинает играть там плюс 10 точек + 1 . там установить играть здесь можно уже посмотреть как машинку реально едет то есть статика и player они закрыли примерно 95 процентов отладочных задач которые мы придаем стали оставшиеся 5 процентов пришлось закрывать опять же с помощью нашей замечательной там достижение которые вручили уже тоже прокси и послан она с помощью посмотрим кидал киви запросам ну и там часть вещей пришло отлаживать выдав ей уже там реальная q резко устройства и она с этим на турецком устройством наперевес изображал там курьера хотел округ зданием ну и два последних разом отложили вас реальным player то есть реально просто сказали еду и смотри как он едет оказался хорошо так что тут можно фактически улучшить до хотел сказать еще вот когда курьер посмотрели такую интересную штуку забыл про и рассказать у коллег из яндекс такси когда клиентское приложение видят что курьер едет но отрисовывать осталось буквально несколько шагов всего а серж тут никак не торопится там новые точки отдавать мы последней точке начинает замедлять два раза то есть у нас есть какие-то точки на счет которых мы уверены мы начинаем простых играть два раза медленнее если сервер за это время успевает подтащить новые координаты мы оставшийся точки ускоряем ну и там добиваем на времени если не успевает то . останавливается и следующих команд кадр придут они будут очень сильно ускоренными то есть опять же чтобы курьер смог догнать такая штука потом мы попытались реализовать предсказание скажем так курьера то есть фактически в ряде случаев понятно куда едет курьер то есть если например как он трассе откуда нельзя свернуть то понятно что дальше он поедет только прямо он там сможет знает стукнул случае все будет например поговори о пробках и авариях там в принципе узнать можно но это у нас не прокатило по низким причинам потому что во первых бизнес-логика курьер не всегда едет именно к нашему клиенту потому что фактически куриному отвести несколько заказов то есть 1 1 tanto 3 то есть не факт что мы едем нас тут . торы мы думаем он может вам ссылку на лево там доставить первый заказ проехать доставить второй заказ только тогда ект к нам мы этого не знаем данный момент далее так буду рано ладно потом нет вся информация карте опять же то есть тот острым он не всегда дает все данные о карте то есть там он может быть устаревшим проекты дороге например не говорит что они односторонние то есть можно опять же завести машинка туда куда на самой лайк не может это неправильно ну и третье это большая нагрузка то есть при попытке предсказания у нас там устроился здоровенный граф куда собственно может ехать машинка и все это дело достаточно сильно сыром вешал то есть мы от этого отказались но возможно в некоторых случаях там если кто из вас будет писать на какой там что-нибудь транспорт то возможно это получится тоже трава нее муж некрас вернуть вы сможете сделать выводы реально построить система отслеживает заказов на бесплатных сервисах то есть фактически начнет заказчик платит только за трафик за хостинг больше за что все остальное бесплатно реально сделать о точной красивой ну машинка ездит все замечательно клиенту на самом деле больше нужна красивая система не точно клиент ну можете догадаться что на самом деле машинку напрягать не там ему нужно чтобы она ехала плавно и чтобы он был спокоен что машинка это не стоит где-нибудь и описывать систему можно улучшать дальше но в некоторых случаях вариант 1 вполне бы хватило потому что я участвовал пример 2 проекта где от реально мы рисовали про система один закачка полностью устроило и а они часто чпу работает кто-то сможет нажим пользуются собстна все вопросам задержка 1 раз спасибо это по-моему самый лучший доклад был на холодный ну вы мне льстите по моему этот люди согласны можно три вопроса давайте вот это уже подходит не только для истории это подходит для любых вариантов где требуется отслеживать что-нибудь что движется по карте я была мысль сделать какой то продукт из этого вольт mcbee может быть сейчас какую-то тайну конечно открою идет а хотя нет не открою все уже представили есть разработка ну вольт moby знаете же имеет множество там своих собственных продуктов например там сервис гуру например как обслуживание там задачи обучения каких-нибудь барменов или там прочь у нас есть ставлю опять же продукт который обеспечивает доставку то есть какая-то маленькая пиццерия день в саратове например вполне может выкупить и сделать отслеживаю то есть до была мысль не знаю под насколько продвинулся на ну а вот на основе этого на основе этого нужно сделать продукт она просто вы сказали что было еще два проекта похожих то есть и это было когда я работал другом месте понял я ими пользуюсь сейчас билайн и мегафон понял второй вопрос а насколько было бы проще септа мне машинка была . это было бы проще ровно столько что сервер не передавал бы направлении нам не пришлось бы считать углы и кстати я забыл здоровый кусок рассказать круглый ну а сейчас расскажу о так спасибо что напомнили да когда нам пришлось считать углы на клиенте обнаружилось очень интересную вещь в зале надеюсь нет адептов плоской земле нет это хорошо потому что земля на самом деле оно круглое и а карта плоская и оказалось что если взять например вот нам надо почитать . мне угол из точки а в точку б условно и если взять просто координаты этих точек там сделать разность разных широт и разности там но год и просто сделать там квадратный or тангенс угла конечно по считается но попытка 30 у него машинку окажется угол почему-то имеет погрешности там просто 15 счете москвы например вот почему он появляется потому что плоская карта на самом деле она имеет искажение то есть один градус по долготе сейчас не на фото ничего широте наверно все таки на экваторе и медленно что там 112 лишним километров при этом 1 градус по долготе имеет через сама 112 лишним . метров после нас километрах от ней увидеть тоже только на экваторе чем ближе к северу или югу тем этот градус будет уменьшаться в абсолютно значениях соответственно карта которую вы видите она на самом деле больше у ширяются чем как бы как сказать удлиняется совершенно верно то можно учесть и проще всего это учесть вот если это учитывать именно в географических координатах то надо там пристегивать задраены библиотеки типа geass и это на самом деле ну вариант но не тот вариант который хочу мы сделали проще мы это все переводим просто в реальной точки и считаем расстояние между 7 реальными точками это гораздо проще подход и на самом деле когда мы считаем вот разницу мы считаем разницу между расстояниями между этими точками это заказчик хотел машинку до заказчик хотел машинку на такой вопрос ничуть не по делу я так вы вылезли из первоначальных оценок проекта есть какая-то забавная история связанная с этим оно не забавно и можно рассказы ошиблись раз в пять примерно и как как это было воспринято заказчикам экс радости с моей заказчиком не общался но pm ходил грозный спасибо пожалуйста так слышно насущным вопросам собственно 2 вы рассказали как вы отбрасываете точки когда погрешности псы есть когда нет уж мы погорим позже песни учитываем вообще потому что нам важны как я уже говорил любые данные вообще любые данные мы показываем красиво но не всегда точно да вот вы рассказывали что когда машинка стоит на самом деле дпс прыгай да да прыгает вот этот момент вы рассказали чтобы с данным но как быть с данными которые появляются допустим когда курьер едет мимо глушилок то есть конкретная словил такой баг в той системе которую я разрабатывал что все уже знают эту историю когда едешь и ты раз там где-нибудь в шереметьево оказываешь но мы этот вариант вот этот момент я у себя не победил никак но то более менее у вас того как вы это промо к это тяжело как-то обработать только там введением каких-то эвристик что ли что там если если едешь шереметьево но там 2 минут назад не ехал шереметьево рисуя машинку на кремле так что один снаряд у нас тоже нет но потом и второй момент с точками задним числом вот я как столкнулся в своей практике с тем что устройство которое в не шлют координаты допустим они могут задним числом вы дать мне координаты ну то есть задним числом и для построения трека это важно как объяснить вот сидим мы все с вами показано что то есть показывает когда то что вы тут стоите а потом приходит . что вы бегали тупаком по корпусу вот следом за чуть задержка в передаче вы мне потом лучше не точек но задержку случай . я не столкнуться с такой вещью потому что опять же якобы ios разработчик в айфоне вас не и фон же нет я поставлю бэкон да ну вот я с такой вещь не столкнулся тут я думаю можно тереть по таймс темпу потому что фактически . не должна прийти раньше чем последний трек как тогда строить если оценивать но смотрите просто те точки которые уже пришли и которые фактически и учились позже чем то что пришло сейчас и было раньше они могли уже уйти на сервер и серу же мог их как-то уже встроить там в трек он мог уже обработал привязать ее эти точки могли уже показать клиенту так что то что там что то потом еще пришло это уже совершенно неважно спасибо большое пожалуйста так у меня еще тоже вопрос спасибо за доклад а вот там у вас была картинка где вы сравнивали там видимо сырые данные и уже отфильтрованные до мобильном приложении вот этот получается одни тех один тот же набор навязали смотрел один и тот же набор потому что вы там трек оси номер трека посмотрите да есть он перцы это процесс данных должно то они процесса не просто я обратил внимание что там где у вас отфильтрованы выровнен трек там вот нужно будет большая большая потеря вот именно вот катя вкусно ленинский проспект хотя в сырых данных например эти данные присутствуют то есть как так получилось почему одержим какой-то причине телись какой то ну я вот хотел уточнить но я могу конечно загрузите посмотреть но могу предположить что вот эти скажем точки были отсеяны по близости здесь вот видите тоже двойная . видны а о смысле не место них одно оставлять его просто если они близко тоже выкидываете полностью вместо 1 . который проходит она остается но вот просто но остальные тоже может быть у них было к нибудь скоро странно или может быть вы по точности все-таки там есть ли over 500 метров твоих вы тоже выкидывать любую сырым их просто как-то по точности мы ничего нефрит у него вообще то есть даже 600 метров gps на самом деле своей 500 метров он очень сильно перестраховывается я не видел такого что реально была ошибка на 500 метров то есть когда он показывает 500 но 50 может быть он ошибается кроме того смотрите вот в красном треки у него очень большой масштаб тут фактически вот ну ширина вот этой улице на метров десять может быть нет это мне понятно я просто не могу понять почему они набросились на счет может быть вы просто анализировали может для вас это было там принципиально ну вы как я понимаю просто плавно машинку передвигали dance пинаем это незаметно всем спасибо пожалуйста спасибо за доклад у меня вопрос по взаимодействие клиентского приложения курьерского с сервером какой протокол выбрали для передачи данных на штаб с https тимплей нет и второй вопрос если произойдет так что вас там миллион допустим ваших машинах заехала в тоннель и отправили вам через пять минут очень много данных ну у нас такая штука происходило не миллион конечно но мы когда отлаживали иногда бывало такое что вот реально вот машинка молчит молчит молчит молчит и отправлять мегабайт данных вот мы с этим боролись именно на стране клиентского приложения то есть у нас это дилеры был написан андроиде и одно это за бочки этим как-то боролся то есть там проблема была передачи данных насколько помню скажите может быть прослушал начале доклада прошу прощения а вот думали там экспериментировали чтобы использовать не свой сервер в я правильно же слою как прокладка этот сервер наш такое решение другое но павлов например для передача координат от приложения 1 курьерского приложению клиентскую а зачем ну вот файтов вопрос мы как бы ну как то значит такой не был которым он можно было быть не то есть мы даже не думали да то есть было понятно что мы пилим свой ситом свое приложение свой сервер своем этот комплект ну во-первых свой серый у нас и так уже был до этого и свое приложение тоже до этого была он же должен как тот не знаком заказа обрабатывать все прочее казалось бы ну вот просто на этот серым по если дополнительные задачи соки пожалуйста у вас планируется какая-то поддержка этого приложения от заказчика или вы его целиком отдаете уже мы его поддержим целиком с этим соответственно вот путь этих 18 решений соответственно вы как то возможно в диси влоги отражали чтобы если вы потом через год это будете дорабатывать менять вам вы не совершили бы те ошибки мы точно свыше сам ошибки мы найдем новый найдем каких-то интеграционных таких тестов бдд ничего такого не было тут очень сложно тестировать потому что фактически единственный критерий это естественность поведения машинки которую но тяжело как-то описать фактически там часть багов которые наши замечательно же не там на меня он приписал когда все это отложил там загружать такой-то трек там на такой-то секунде в такой-то точки машинка делает неожиданное действие вот как-то так звучала то есть дальнейшем его описательно языке тяжело ну имя не огне когда была спасибо у меня возник вопрос снежная плод сейчас пишем какой объем данных вы примерно передавались доставку в месяц какая-то статистика есть в месяц статистику я не смотрел в прошлом скажем в одном треке вполне может быть там несколько штучек это сколько у вас после пока но вы же покое тихо отправляете потом распаковываете правильно ну покоем их очень так это в кавычках джейсон пакуем которые скорее увеличиваем количество получается что трафик это много приложения тушенка до специальным с оператором давай договаривались мы пока как бы в этом проблемы не видим но здесь можно что-то отрабатывать дамы это просто как бы ничего но это тем не делали я со старостью большой нужно да кстати хочу добавить была проблема по моему у наших казахских коллег да они пытались ну тоже с помощью там наши что-то такое сделать и поскольку насколько помню у них не очень хороший мобильный интернет им приходилось все вот эти данные просто очень серьезно паковать то есть они там чуть не какой-то даже бинарный код передает место джейсона потому что там очень очень сильно надо было спасибо за доклад"
}