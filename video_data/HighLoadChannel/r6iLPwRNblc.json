{
  "video_id": "r6iLPwRNblc",
  "channel": "HighLoadChannel",
  "title": "Как мы управляем инфраструктурой на более чем 1000 серверах при помощи ansible/А.Кузнецов,Б.Мурашин",
  "views": 604,
  "duration": 2892,
  "published": "2024-04-17T01:10:23-07:00",
  "text": "приглашаю Лёша Боря парный доклад на главной сцене питерского хайлуда Готовьте вопросы Всем привет Меня зовут Кузнецов Алексей Я работаю системным инженером в компании Эксперт Всем привет Спасибо что пришли Спасибо всем кто смотрит нас онлайн Меня зовут Мурад мурашин Борис я также работаю в компании Эксперт тех системным инженером и сегодня мы расскажем о том как мы выбирали систему управления конфигурациями какие у нас были критерии что мы в итоге выбрали С какими проблемами столкнулись и как мы их решали да Именно так мы не будем рассматривать вопрос зачем вообще нужна система управления конфигурации потому что мы считаем что если вас больше чем один сервер она вам уже необходимо и мы перейдем сразу к вопросам Почему именно мы выбрали главным критерием который нам понравился на тот момент мы не занимались установкой пнр серверов и у нас по сути был только СОШ доступ на наш сервера и этот критерий был главным для выбора также у меня есть большое сообщество хорошая документация легкость хода уже написано просто гигантском на мой взгляд количество модулей также есть возможность написать свои Ну и также минусы относимся что у него нет агента из этого следует что нам нужно выделить какие-то ресурсы настроить какое-то Ну и для того чтобы более-менее быстро работало также нужна какая-то оптимизация Ну и по причине что у него нет агента мы считаем что в целом из коробки он не подходит для большой инфраструктуры что мы хотели о танцевал Мы хотели чтобы весь наш проект лежал в гите чтобы это была как единая точка Правда Ну и также своего рода документация мы хотели периодически запуск чтобы исключить вообще возможность какого-то ручного изменения что все все наши изменения проходили только через commit-гид простая понятная структура чтобы даже новичок мог скачать наш проект и разобраться как что и понять как вообще выглядит вся наша структура Ну и автоматическое применение примет же да что мы не ждали там когда он по тайм-ауту какому-то запустится чтобы мы знали закомителей и в целом она поехала Ну первый наш реализация первое наша реализация Это был реализация на getlab CD здесь можно Вот пример как раз таки яма мы просто взяли анса по paybook Вот все наши инвенторы все наши роли и просто запустили это очень просто если у Вас уже есть компания getlab Вот и у нее есть уже своя визуализация вот встроенный дуллер Ну и это довольно-таки быстро работает Если у вас небольшое количество хостов но у нас количество кастов постоянно увеличивалось и нас в целом это немножко не устраивало Мы решили как-то попробовать это автоматизировать да Мы представляем что он типа в целом есть свои крутилки такие Как можно увеличить количество орков можно изменить стратегию прогона стратегию сбора фактов и мы часто это всё пробовали но какого-то должного результата нам не дало Мы решили при помощи тегов распространить Наша задача Мы выдавали для каждого какого-то отдельного сервиса так и запускали его соответственно параллельно Ну и также вот у нас идет сборка фактов Это запускали в самом начале и эти факты у нас хранились Ну скорость у нас за счет того что мы это расправили увеличилось но сами по себе теги сильно усложнили наш проект он стал менее читабельным и также приходилось помимо того что просто задеплоид добавить какой-то новый сервис также придумать тег добавить лапся яму Ну это сложно также большие группы чтобы как-то их расправлять Мы решили делить на более маленькие Это тоже не очень стабильно в целом когда это работает не совсем прогнозируемая нагрузка на нашу губернатис потому что ну у нас могло выстроиться сразу несколько комментов и соответственно как большое количество ресурсов мы на это губернато съедали и от этого могли даже поехать пользовательские коды что не очень хорошо есть хоть Небольшая но определённая задержка На старт самих контейнеров Мы решили попробовать какое-то больно нативное средство а именно бесплатный аналог конституцию Из плюсов можно сказать что тут нет задержек контейнеров Потому что когда мы его восстановили Да мы уже подняли какое-то количество контейнеров оркеров где это будет крутиться и всё нагрузка теперь знаете у нас прогнозируемая да потому что количество контейнеров на статично мы сколько съели ресурсов с ними едем Ну и за такой вещи как например возможность мы уже перестали дробить наши большие группы на более маленькие мы довольно-таки быстро это все внедрили и буквально за вечер и решили все протестировать мы взяли как вот самом начале без всяких тегов вот большом количестве слайсов все это быстро запустили мы получили наш первый факап с внедрением потому что у нас был шаблон конфига для закипера где использовалась Вот такая переменная и когда мы запустили в большом количестве слайсов получил сразу несколько лидеров и это было очень грустно печально Особенно это было грустно печально для наших вот к сожалению два дня не могли понять что случилось с патроне который прилег а мы два дня думали что у нас всё хорошо но мы в целом починили и все хорошо закончилось Ну тут можно такие вещи лучше вот так вот сразу не тестировать так вот Браво А как-нибудь по частям переезжать у нас получился мы когда переехали мы сделали Наш первый workflow она выглядела вот так вот оно видите довольно таки большое она даже в целом ну Не влезло полностью на слайд Вот и как мы видим Мы тут решили оставить такса к теги Вот потому что ну Мы считали что это будет удобно Вот что из хорошего как я уже говорил слайса слайсы замечательная и она решила проблему с нашими большими группами мы считаем что вы их в целом гораздо более лучшие визуализация и также более удобный поиск Ну и также у меня есть встроенная доля правду очень большой сложно если раньше нам приходилось э в getlab Si добавлять Да какой-то так здесь нам приходилось Ну прям заходить и для каждого Нового сервиса создавать свой отдельный Темп Вот это это сложно также проблемы с одновременными комитами Да мы параллельно не запускали они у нас выпускались последовательно выстраивались в очереди Если вы там за 5 минут 30 человек закомились то можно долго довольно-таки ждать своего Ну кому-то чтобы он развёлся на сервера Ну или все остальные просто выключить вот Ну в целом программа ускорился не сильно потому что количество хвостов у нас увеличилось Ну один тормозящий хост как я уже сказал Да он мог заставить долго ждать ваши изменения чтобы приехали на сервер тогда какие-то такие у нас успехи были ускорение работы ansible мы раз 10 уже переписали проект использовали все очевидные способы ускорения работы ansible и в итоге в GTA у нас просто работал до тайм-аута зачастую и мы потеряли наш растеряли наше преимущество легче читаемости проекта который был у нас на Первом слайде VX было получше за счет свойств Но для того чтобы заставить его работать хотя бы за 25 минут нам пришлось взять больше чем полторабайт памяти в губернатисе вопрос почему же так получалось может написано просто плохо но как я сказал мы уже 10 раз все переписывали и если запустить локальный прогон на любом Хосте он прибегал там за две за три минуты а вот именно централизованный запуск Он бежал долго 20-30 Минут потому что любой таз который на отдельно взятом за секунду условно Когда у вас большая инфраструктура как у нас Это скорее Хосты в которых дымятся 24 на 7 от нагрузки и на каждый таз можно поймать хотя бы один хост на котором он задержится секунд на 10 и вместо секунды каждый ТАСС будет работать секунд 10 и в итоге 2-3 минуты превращается в 20-30 минут вот что с этим можно поделать Давайте потребуем Пусть все Хосты работают быстро это как бы абсурдно вам приносят что-то на поддержку Вы говорите Вы знаете Хосты медленно у меня в X Я не хочу брать еще можно взять еще в 10 раз больше памяти выксом для того чтобы в каждом своё было Ну там по одному хосту это было бы практически как локальный прогон но только с издержками оставляют здесь в качестве шутки потому что мы как админы должны все-таки бороться не присоединяться к нему не заваливать проблемы баблом и железом а из более реалистичного можно было бы попробовать поднять приоритет процессу антибул но так как он не имеет Агента нет одного процесса которому мы один бы раз подняли приоритет и забыли Но на самом деле когда мы вот первый раз показывали наш наработки нашим коллегам из программного комитета собственно конференции нам задали такой вопрос Вообще взяли антибал если бы знали с чем столкнетесь Ответ Конечно нет мы не взяли бы мы взяли сразу но тот же папит какую-то систему с Агентом потому что ну понятно система без агента рано или поздно столкнется с проблемами производительности Трудно решаемыми или совсем не решаемыми но на тот момент у нас большая команда у нас 10 человек комит у нас уже было 4 мегабайта кода в ролях чтобы вы понимали все там войны мира занимают меньше трех мегабайт и переписывать такой проект об этом страшно даже думать Ну если переходить на другую систему невозможно в имеющейся Агента нет значит вот что мы и сделали Тем более что это было максимально экономичное решение простое приложение на Python буквально 200 строк два бесконечных цикла которые позволяют Нам его запускать как систем de Unit один цикл пациент проверяет наличие новых коммитов в Гид и обнаружив новый коммент запускает локальный прогон То есть это ультимативное решение быстрее локального прогона у вас ничего уже не будет И это работа очень быстро после многочасовых очередей в GTA потом VX мы получали скорость буквально за Камил там пока зашел по ssh сделал суда минус с провалился в нужную папку А там уже изменения на Хосте Но это даже не только про производительность нашего труда нашей команды Да потому что мы выбрали инфраструк через код и Любая наша активность должна заканчиваться комитом в проект танцы был но это просто новая степень Свободы потому что ну бывает что-то не дотестировал Да с каждым случается и Комет пошел что-то ломать на хостах и вот на больших костерах таких как ходу у вас расчеты не падают сразу же пройдет 10-15 минут прежде чем надо начнут помещаться как нерабочие и скорость доставки 2-3 минуты на Хосты это реально возможность просто откатить или если быстро понял что слова поправить и просто избежать аварии Когда у нас был прогон 30 минут можно было сразу смело идти просто составлять рассылку об аварии вот еще цикл который каждые 25 минут делает безусловный прогон Это Наша защита от ручного изменения конфигурации серверов новенькими там джинами в команде например и также очень полезная утилитка антибактел при не расскажем чуть позже и для того чтобы не перегружать наше основной gituapp мы сделали три реплики встроенными в гету об средствами репозиторий Mirroring и Казалось бы ge2p это зрелый продукт Что может пойти не так И однажды бы обновились и у нас одно зеркало начал постоянно отставать если кто-то спрашивает что это за зверьки такие милые это Москва бы называется Тануки зверек и вот один наш пушистик начал постоянно отставать от других а Вот и агенты через балансировщик попадали то на актуальное зеркало то на отставшее перезаписывали конфиги то актуальные перезапускали соответствующий сервис вне регламентных окон без объявления работы так далее В тот день мы вынесли урок что репликации иногда тоже надо мониторить хотя Казалось бы интуитивная репликация воспринимается Так что если она отстала в какой-то момент она должна догнать но не всегда Ну еще буквально пара слов про Агент мы его собираем с помощью паярмор в бинарный файл совсем независимостями это проще для диплоя один файл разложить и это усиливает безопасность потому что в Агенте естественно зашит валд паспорт для расшифрования секретов в проекте и по ярмар не дает возможность его оттуда просто нагревать паярмар приносит некоторую особенность то что он привязывается к версии операционной системы мажорный не минорный и над собирать 4-5 бинаре зависимости от того сколько у вас используется операционных систем это как бы удлиняет но особо сложности не создает Ну и как мы видим наш агент работает и особенно радостно что он работает быстро но нам нужно было как-то этот Агент затащить на все сервера и мы решили использовать для этого нашего X которые уже был Мы создали соответственно новый установки Агента но также Полностью мы от него не отказывались и он так работал на некоторых местах где у пользователей например Хосты на которые у нас не полностью поддержки Например если просто нужно добавить туда ходу клиент какой-нибудь мы туда решили не ставить сама установка выглядит примерно следующим образом у нас появился отдельный инвенторы Для агентов и отдельные темплейт мой камень или вот этот инвентарь запускался template и ставил нам агентом сама роль работает следующим образом мы просто устанавливаем нужный нам пакеты это пакет самого ансабеллагена также его коллекция кладем config Ну и создаём систем даём это запускаем его Ну и после внедрения нюанса был Агента наш warflow сильно уменьшился он стал более читабельным и понятным по сути у нас осталось template для установки агента template на тех остальных которые Агент мы не тащим и также мы это решили оставить э создание виртуальных машин на гипервизоре Также вы их Ну потому что это больше более удобно читать из одного места вот ну и скорость выполнения у нас сильно увеличилась потому что в целом нам уже было всё равно Насколько долго вот это вот слово будет работать агенты работают независимо от того как работать с самого X Ну и немного про утили тон собой ктл по сути это утилит просто повторного запуска если у вас что-то с первого раза не получилось да то при помощи не Можно еще раз запустить все ваши Facebook на Костя он имеет всего 4 ключика Один ключик катаран Понятно для запуска также ключик минус brunch чтобы выбрать например с какой вы ветки хотите получить свои роли Ну и чек div Я думаю Понятно из названия помимо того что это инструмент повторного прогона также это инструмент тестирования изменений То есть если вы ведете какую-то разработку новой роли вы ведете наверное своей какой-то отдельной ветки и с этого не нужно ни устанавливать заморачиваться с какими-то версиями вы просто используете инструмент со своим ключиком вот минус ключик и просто проверяете что у вас там получается Так ну как вы видели на предыдущих слайдах в нашем быстром Агенте не хватает некоторых важных деталей и я думаю на предыдущих слайдах кого-то могло смутить упоминанием в одном предложении одновременно по ярмар и Безопасность и Да у нас на каждом Хосте полная копия проекта изгиб описывающегося инфраструктуру и вот Password в памяти Агента откуда его вытащить любой моторчиком две минуты поэтому надо было что-то ставить между агентами И гитом мы этот компонент назвали антибоу сервер который бы подтягивал режим работы нашего агента к другим системам с Агентом К тому же папе то есть выдавал бы на для каждого Хоста минимально достаточно кусочек проекта для его работы тогда бы скомпрометированный хост выдал бы атакующему только какие-то конфигурации и секреты которые Так скорее всего есть где-то в etc и никак ему не помогут немножечко Мы переживали за производительность этой истории потому что для начала также взяли поэтому как и для Агента и надо было готовить статический контент для тысячи хостов но в итоге на шансе был сервер отрабатывает формирует контент буквально за 5 секунд Вот это на обычном механическом жестком диске 7200 оборотов то есть мы даже не брали SSD если мы будем расти Я не знаю там до 10000 остов просто поставим SSD которые на операциях с мелкими файлами как мы знаем как раз жесткие диски очень сильно обходят Вот и как Неудивительно мы получили даже прирост производительности потому что антибаусервер наш мы заставили почаще опрашивать агенты чаще ходить в Engine X в котором собственно статический контент мы создавали потому что статический контент может держать очень много РПС Ну и также мы делали деппликацию на основе хешей для хостов которых совпадает копирование только один раз для остальных проставлялись сим-линки и в нашей инфраструктуре антибаусервер за меню реплики getlab мы научили Агент работать в зависимости от своей конфигурации или с гитом напрямую или сансе был сервером Вот Но еще буквально два слова про антибоу Сервер это так также как я сказал приложение на Python а чуть побольше 400 строк Но идея стоящая за ним очень простая Мы берем инвентаре парсим его Составляем словарь всех хостов и всех их групп имея и этот словарь мы можем использовать яма вытащить создать словарь всех хостов и всех назначенных ролей и всего этих двух словарей нам достаточно чтобы для каждого Агента создать индивидуальную индивидуальный кусочек проекта скопировать нужную группу сделать минимально достаточно инвентарь ход и минимальный достаточно кусочек сайт яму Ну и также создает конфигурацию для собственной директивы locational для того чтобы только соответствующий ход забрать свой контент Я хочу добавить что он ктл тоже теперь работает сам заглу сервером и он тоже Безопасен Но вот мы рассказали вам про сервер но давайте рассмотрим С какой структуры проекта именно он работает ну и у нас структура очень стандартная Да мы здесь видим что вот структура нашего проекта У нас есть каталоги для переменных групповых для переменных листа и каталог самими мы используем несколько инвенторе один инвентарь - Это для установки самого Агента Ну и основной инверторы а также у нас выглядит следующим образом Да мы здесь группы каких-то кастов назначаем все ролики которые должны на этой группе пройти и обязательно так тегов у нас теперь всего несколько это будет работать либо через avx либо через Ну и у нас сформировались скажем так определенные требования Да как лучше что-то добавлять первое что группы должны называться всегда по типу сервиса сервиса мы считаем что это довольно таки удобно и понятно также хост по возможность должен быть только в одной группе Мы хотим так что мы хотим это Потому что инвенторы так будет более читабельным мы нашли единожды свои хвосты понимаем какой группе также мы используем всего лишь несколько тегах о которых я говорил до этого ну естественно что все наши ковидные изменения приходят через мерч и обязательно ревью коллег также есть определенные требования именно со сторонам всего сервера Это не то что требование можно сказать определенные ограничения он просто не поймет даже если у вас используется где-то инклюд роль в самих ролях он просто это не распасть это вы эти изменения не получите на Хосте сделан это специально для того чтобы опять же для читабельность для читаемости Да вы смотрите сайт Ямал и видите сразу что эта группа хостов или нет такие вот ролики Ну и по этой же причине мы не используем методы Мы хотим чтобы новый сотрудник или стали сотрудниками которые статьямом и сразу понял какие роли для какого хвоста Угу Ну еще пара сценариев как мы используем avx Мы очень любим этот инструмент на самом деле особенно например за возможность прогнать команду на все инфраструктуру или кусочек то есть мы написав Агента ни в коем случае не собирались от него отказываться Вот один сценариев это для того чтобы у нас поменьше будили ночью для этого мы рутинные задачи выносим отдельные блоки в отдельном Проекте в гите даем нашим нашей дежурной смене доступ только на запуск этих плейблоков и вольерте они сразу видят какой тимплей вы их си запустить и без нашего участия они могут спокойно почистить кэш и остановить какой-то агрессивное приложение и так далее А если все-таки надо нас будить то они нам заранее собирают какую-то статистику второй сценарий похож на первый но здесь он уже для команд разработки и мы даем доступ в Get не только мы уже даем доступ в Гид и мы даем доступ комментить но не мешать Мастер и когда им надо внести изменения в инфраструктуру которую требует прав Рута они просто скидывают там меньше квест мы на него смотрим если у нас не смущает мы его мерзжем Они получают свои изменения на инфраструктуре очень быстро без бюрократии без переписок там буквально за 10 минут как собственно лучших традициях где Ну и у нас есть естественно мониторинг наш мониторинг в основном состоит просто изолентов мы получаем olerta от самого антибал Агента в случае падения каких-то букв и также в случае долгого выполнения на хостах также мы собираем к определенной статистику именно За какое время он пробежал на каждом из хосту Но это из костов Но это отправляемся в прометеос и можем ставить какие-то создавать какие-то интересные графики а также у нас есть это Например в случае падения каких-то темплейтов Ну например у нас не ставят на какой-нибудь новый хвост Ну и также Алетта самого сервера Да мы уже научили потом с гидлагом Да также мониторим как он у нас насколько хорошо и ходят лапы и обновляют свои ролики Ну и также если сервер не смог что-то распасть Нам тоже придёт лёд Ну и в итоге завершение хотелось бы чего мы собственно добились в первую очередь самая большая боль была это долгое выполнение этого всего на данный момент мы это все решили и прогон у нас составляет 2-3 минуты с учетом того что одна у нас есть общая роль Комон насчитывает по моему боль 200-300 тасок наверное 300 также мы делегировали всю нагрузку на Хосты и смогли соответственно освободить довольно большое количество ресурсов из губернатики Ну у нас теперь есть возможность это рассказывать не на одну тысячу хостов я думаю спокойно накатим И на две на три на 10 на 10 вот АТТ - это отличная утилита для того чтобы могли тестировать и вести разработку и сразу это быстро все проверять Ну и Безопасность мы считаем она не хуже чем у каких-то аналогов включая папе или шеф также все свои наработки мы выложили в gituap сделали все максимально дружелюбно там два плейболка один устанавливает Агент на Хосты один устанавливает сервер и также башка скрипт который делает сборку бинаря А если был Агента в докере и пример проекта с которым работает на шансе был сервер также мы сделали группу в телеграме Если возникнут любые вопросы захотите просто пообщаться обсудить заходите пообщаемся обсудим поможем Спасибо за внимание и мы готовы к вопросу 1 1 Спасибо за доклад очень интересно было у меня такой вопрос простой Что сделать с плейбуками когда там ну вот несколько хостов которые задействуют то есть вас же все равно таки плейбуки на были вы их переписывали или что делали Не совсем понятно вопрос Что значит несколько кастов за действия То есть когда делается что-то на одном а потом на другом или развертывается ну у нас есть вспомогательные например по подготовке скажем каких-нибудь кисторов которые нужны там длина которая таскает и у нас есть хранилище таких бинарных файлов и тогда уже сами ролик который едут на хосту они просто эти данные забирают себе то есть Они отдельно иногда то есть для каких-то больших сервисов они также находятся Для каких-то более сложных сценариев можно использовать avx его возможности Спасибо за доклад Меня зовут Михаил витех и собственно вопрос Следующий использовать или вы какой-то автоматизированное тестирование Анти была ролей или PlayBook Ну то есть например при межре квест у вас прогоняется тест у нас да у нас прогоняется тест на данный момент мы просто проверяем синтаксис И всё И больше команда какая-то точно не помню и она у нас прогоняется в целом так как команда у нас состоит всего из 10 человек да мы считаем и другие команды не пользуются нашим проектом мы считаем что главная защита - это у нас ревью от каких-то не смотрели в сторону молекулы например тесты на данный момент честно нет мы проверяем синтаксис ревью Всё мы считаем Спасибо Спасибо за доклад Осторожно Это чувак с чёрным бейком Да ладно не кусаясь у меня тоже черные У меня два вопросика мелких вопрос первый Вот вы проделали Такой путь и на мой скромный взгляд перезагружали Шафт Ну или паппер собственно вопрос для тех кто в самом начале Да вот те кто прочитал посмотрел за доклад и вот на ваш взгляд Вот если бы вы поняли что вам предстоит сделать Да вот тот момент вы бы куда пошли в папит или всё равно на земле вот делали то что вы сделали Я считаю что если бы мы когда у нас не было ролей и мы знали мы пошли наверное в Пап опять Шеф или там Солнце стоит а когда у нас уже накопилось большое реальное количество ролей то мы считаем Это отличное решение и также На мой взгляд есть плюс по сравнению с папе там да например или шефом очень простой здесь согласен А вы управляете вот только железными хостами или виртуалками тоже И вас это все один То есть букв Да там один набор переменных Ну королей каких-то Вот назад прямо можно и вот с первого ряда прошу Спасибо за доклад такой вопрос Вы говорили что используете для тестирования только линтер обычный у вас достаточно немного человек в команде вы получается полагаетесь на компетентность и безошибочно снесения конфигураций Но кажется что у вас получился инструмент для достаточно быстрого и практически не контролируемого уничтожения инфраструктуры в случае если кто-то все-таки ошибется думали ли над тем Как защищаться вообще от ситуации которые могут возникнуть при раскатке ошибочной конфигурации Когда нужно чтобы кто-нибудь всё делаем поэтому у нас команда обязательно смотрят кто что делает Вот но в целом мне кажется это должно решаться уже не на уровне Агента Да он это же просто исполнительный механизм который прогоняет это надо где-то уже на уровне перехваты вать именно коммиты это чуть-чуть в стороне от нашего доклада но да мы не защищаемся и мы считаем что у нас команда на самом деле такая большая это 10 человек которых мы уверены в компетенции А в случае если мы будем дальше так расти Я думаю мы сделаем какие-то тесты И это не проблема появилась Да это тот как раз момент когда из зала приходит обратная связь А кто-то из коллег сидит и записывает Так потестировать Галю ага Да Пожалуйста Спасибо большое за доклад у меня парочка вопросов первый вопрос как-то ли появляло Ну повлияло появление агента на использование было Ну другими как это сказать отделами вашей системы То есть я имею в виду Вот например да Они использовали антиполы стали ли они ну добавлять свои плейбуки антиген-то и Ну как-то это помогло им или нет вообще и мне куда было деваться потому что наша платформа аналитическая она включает ходу по гримплам и мы просто один надел поэтому дабы Как вы видели Там они у нас один раз схватились за голову вот если говорить в целом про X5 и другие отделы пока мы не внедрили вот ну я думаю мы будем всячески рекламировать это внутри на своих этапах и если сообщество подхватит то будем использовать А у меня ещё один вопросик я вот книжки по аньте буду читал то что очень удобно Можно конфигурировать различные сетевые устройства и видел что у вас очень большой спрос на сетевых инженеров и хотелось бы вот узнать именно про их наверное отдел а используют ли они антибу для конфигурирования Ну каких-то устройств там через сил нет тот же Ну да я понимаю я сейчас не знаю вот просто используют они или нет сильных точно есть но так вот глубоко мы не лезли в работу наших коллег поэтому не будем Спасибо большое спасибо за доклад Вот вы говорили то что у вас там тысячи серваков есть А есть же еще вот касса самообслуживания вы их как-то обновляете или нет и живот реально много Пятерочки Вот вот прям много большой Мы отличаем за один Наш департамент в котором это крутится Эксперт это не антибал агент это не решение всего X5 это 6 решение сервис там всё очень-очень-очень жёстко тестируется поэтому Интересно как бы как это вообще там очень много я знаю c++, там вплоть они спускаются для того чтобы всё это ускорить тут Другой мир просто да всем интересно кто придумал этот звук когда подносишь конь напиток и женщина должна тебя проверить пожалуйста Галя агентом тут скорее комментарии вы изобрели утилиту энси был пул мы ожидали такой вопрос но не совсем так конце был не следит за изменениями в гите Можно конечно настроить его как-то патроны и так далее но во-первых он это надо прописать сразу всё ссылку на гид наш да потом указать ему обязательно А валпасы и так далее В целом это больше похоже на наше утилита Он всего ктл но антибакте наша очень удобно воспользовании мы просто три ключ 4 ключика Иса поэтому мы не совсем не считаем что мы перезагрузили его но диаграмма где был Агент изображён она в чистом виде повторяет она повторяет запуск ансипла с коннектом Local и туда мы не изобреталиан был ну и просится конечно канареечный диплоид какой-то то есть сначала стейч на части серверов а потом уже на всех потому что это действительно да первого дробной рассказали бы да Вот про наш факап Когда мы это вот бахнули просто мы когда мы устанавливаем Агента мы делали это уже аккуратно перевод у нас Агент занял где-то не знаю месяц Наверное на той больше мы перевозили стоишь и потихоньку особенно мы уделяли внимание нашим Дева они были они опасались спасибо Мы конечно рассказали про наш факап но не надо пожалуйста нам про него напоминать все время Будьте добры кому микрофон вопрос антибалка Тейл Можно ли запустить не локально А по сети и что будет если все-таки запустить антибал ктл с оператором чек указать имя бренча Ну который ты вот сам сделал свой бранч там сделал ролик ошибочную Где попытался удалить файлы и забыл точку В общем было один слэш ты сделал кирпич э Можно ли такой кейс реально и как бы эти восстанавливать Ну в целом я думаю да он реально но Мы производим при для всех наших сервисов Да уже написано какие-то роли при разработке новых ролей для новых сервисов Да мы это делаем всегда на тесте То есть тестовая среда где мы обкатываем все наши роли после чего уже тащим их наоборот по поводу первого вопроса он работает именно только локально в целом если мы захотим например ну в какой-то ситуации взять и сказать всем нашим агентам А ну-ка давайте повторили задачу мы можем просто рестартануть наш сервис сервер там изменится таймс темп и он сам поймет о надо еще раз пройтись Ну или мы использовать можем например тот же avx для того чтобы сказать ран и на всем нашим тестере Ну инвентарь Прошу прощения или агенты стартовать Тот же эффект будет да спасибо за доклад такой вопрос такой когда прогоняется Агент делается либо капы все конфигурации которые изменяет и есть возможность скатиться допустим в случае поняли что всё плохо Можно ли как-то вернуться назад в некоторых ролях мы используем тему когда если мы меняем какие-то конфиги Да мы делаем рядом например там если мы меняем без того что быстро вспомню но не везде мы это используем честно но мы если у нас есть все-таки template Да тоже Который прям если мы используем вот модуль template не in-in и flyne А templay да Но почему Нам просто не откатить тогда его на предыдущий Комет и пусть он там поменяется обратно какой был То есть фактически покапа нету для некоторых файлов есть но скорее наш в подходе с растра через код мы все-таки должны на Гид смотреть Да мы можем ревертнуть Комет сам Агент он на самом деле очень внимательно следит чтобы не оставить за собой проект чтобы не оставить секреты нигде и так далее если у вас остановить он удалит сразу все свои временные файлы поэтому именно бэкапы Ну просто большинство агентов по управлению если это описать в ролях мы это делаем но во всех ролях Окей по поводу отката То есть я так понимаю указывается конкретно Хеш нету снова по тегам грубовикционирование конкретно агенты сервера они срабатывают на Комет в Мастер то есть мы должны реверснуть кометы или просто создать новый Тогда вся система автоматически обнаруживает этот кометы запускает прогон то есть вручную Вот подталкивать не надо достаточно закомить всё автоматически Спасибо за доклад такой вопрос как долго делали продукт В итоге с антибиосервер и антибагент буквально за 2 дня Вот потому что в целом мы просто взяли с официальной документацией было посмотрели как он запускать его ну и придумали просто обвязку для того чтобы следить за изменения это было 2 дня ну на сервер мы с тобой потратили где-то уже где-то месяц и понятно и такое ещё более глубокий вопрос точнее два Наша компания тоже пользуется avx и когда мы вводили новую функциональность после консольного режима выполнения была непоня где тот край когда мы переходим от написания логики описания логики в плейбуках то workflow у вас есть понимание когда надо что-то тянуть workflow а что-то тянуть в оставлять плыву как потому что workflow очень мощный ушло очень мощный и смотрите у нас получилось что мы уже поделили свое время тегами по сути примерно на разные темплейты и в целом мы вот когда переезжали на VX мы это примерно и сохранили у этого решения помимо то что мы рассказывали да Оно большое и неудобное но у него всё-таки есть плюсы Я например закомментировал какой-то сервис Я точно знаю что вот мне нужен вот этот темплей Да я вот на этот жопу смотрю и быстро увижу поэтому у нас вот не было такого вопроса мы сразу поехали большой супер и самая последняя вопрос э-э так как другие так как вы делаете продукт который могут пользоваться другие отделы условно не департамент э-э возникает очень большая проблема когда люди не знают об антибли и им нужно им пользоваться уже вчера и если я помогаю допустим делать инвентарии изменять перемены и объяснять Как это работает Как потом вы передаёте эту ответственность на их плечи потому что на мне до сих пор висят три отдела которые говорят Ну мы недостаточно можем выделить столько времени чтобы Хмм покорить его шансе был и нажимать кнопочку а у нас нет такого мы пользовались дальше в воде здесь рассказать раньше чем принесли это коллегам но я думаю этот момент настанет там будем смотреть если мы придумали что-то слишком сложное Значит будем упрощать Окей спасибо Так у нас три минуты Давайте попробуем два вопроса задать Да добрый день спасибо вам за доклад Скажите пожалуйста можно ли ваш антибал ктл использовать для раскатки сложных кластерных ролей Например у нас есть там кластер Кафки Мы хотим когда мы его катим там шаблонится естественно Конфи который используют переменные всей группы кластера но у вас там катится на околохосте как он за шаблоне такой конфиг и не будет ли гонки между нодами кластеры которые одновременно это всё катят на себе я отвечу вот и говорю покажет слайд что мы отказались от такой структуры потому что это боль мы считаем что если есть какие-то уникальные мы их привязываем непосредственно в переменных постах то есть мы просто говорим Да для Хоста Вот это будет равно такой template один и так ну это железобетонная защита от таких как ну то есть получается никакой динамической шаблонизации нельзя использовать надо руками задать все например переменные для кластера и чтобы он и она причём будет отличаться для каждого Хоста факты с соседнего Хоста Ну грубо говоря и ластик так не раскатишь Ну если у вас требуется факторы новости Но именно кластер кластер и нода добавляются Да в него нот добавляются У нас есть амплейты для того чтобы создавать вот интересно был в это посмотреть Вот Но мы добавляем так просто надо именно через X Ну и через Агента Вот кластер Но мы прописываем всё для каждого Хоста все данные для каждого поста хранятся и мы считаем что такое подход более правильный Понятно спасибо большое аргумент когда тебя пытаются задавать неудобные вопросы ты говоришь да Мы приняли такое решение если мы поймём что это не так но Обсудим в ноябре на следующем холоде финишируем Спасибо за доклад А вопрос по поводу взаимоотношения саппортом у вас как я понял какое-то там внедрён или они просто запускают playboki на какие-то ошибки Я не раз сошел у вас было написано что вы саппорту предоставили какой-то интерфейс Вот это Клаус клуб или они вручную запускают булки Например если система мониторин сказала там знаете место например ну или в каких-то инструкциях у них указан например там например всех да там довольно собери нам статистику чтобы когда админы будут будить он уже примерно понимал какие там образы говоря выезды сдохли Вот спасибо Спасибо друзья это было прекрасно Давайте раздадим слонов не то чтобы вы тут верили но тем не менее Значит у нас есть Авоська есть фишки есть книжка А махните рукой все кто вопросы задавал пожалуйста это просто это уровня 80 книжку вот я сейчас вопросы примерно отлично это месте решаем про лентер хорошего Кто первый завод тестируемся ли мы первый вопрос что мы не Тестируем А как определить Файт там яблок много можно поделить можно поделить Я отдаю тебе яблоки А ты делишься держи с кем вот мужчин махнул рукой сейчас он подойдет тебе это не переживай вот насилу на здоровье в принципе в ней можно ходить тоже ребята вам тоже сувениры от конференции Спасибо большое спасибо спасибо было прекрасно"
}