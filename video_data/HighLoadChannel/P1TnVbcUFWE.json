{
  "video_id": "P1TnVbcUFWE",
  "channel": "HighLoadChannel",
  "title": "База данных не нужна, родной. Tarantool как сервер приложений для IoT/Владислав Зайцев",
  "views": 5084,
  "duration": 3072,
  "published": "2021-04-07T14:02:46-07:00",
  "text": "раз раз раз я слой я расскажу немножко про какую-то прикладную область прикладная даже для каких-то общих применений потому что базы данных на одном из прошлого докладов было такое удивление а почему в базе данных есть работа с сокетами сети и вообще то есть много кто воспринимает tran phu как именно базу данных мы это используем немножко совсем наоборот то есть для нас база данных это дополнительная фишка в целом мы используем тарантул больше как сервер прилагаем а это и собственно пойдет речь так как тут собрались люди которые возможно про интернет вещей дает не очень много я кратко расскажу собственно что такое эти все такое интернет вещей если послушать разных людей то каждый из них говорит собственное определение что такое интернет устроить кто то говорит что это просто когда устройством добавляют какого-то мо мозгов больше памяти больше процессора мощнее кто то говорит что это когда с устройств собирается куча информации из эта информация что-то делается кто то говорит что интернет устройство это когда вы можете управлять устройством удаленно кто то говорит что это просто всякие носимые устройства умные и то говорит что это когда устройство общаются между собой и просто внешнее управление когда грубо говоря стиралка отдает команду кому-то другому устройств кондиционер но у меня есть немножко другое более глобальное определение интернет-устройств это подключение тех устройств тех частей системы которая раньше подключили было нельзя с развитием технологий у нас появляются новые способы это сделать если раньше интернет это была такая коробочка которая подключала к телефонной линии к ней подключался компьютер и вот с помощью этих устройств можно было как-то выйти в интернет то сейчас это по-другому тогда никому в голову не приходило подключить стиральную машину к интернету потому что ну вот стиральная машина а вот модем вот компьютеры зачем их совмещать сейчас интернет от вайфая у каждого дома чипы для вай фая стоят очень дешево подключить стиральную машину стоят 10 долларов а функционал по повышается его кратно то же самое с любыми датчиком датчики почвы ну это огромное поле что там надо каждому через тянуть провод телефон мне сейчас это можно сделать с помощью радио среды в внутри которой датчики будут работать несколько лет от батареек и это будет по-настоящему подключенные устройства но на данном этапе развития все-таки существует очень большое разнообразие этих систем потому что у нас есть разные физический уровень это проводные системы это беспроводные системы это беспроводные системы разных видов кто-то оптимизирован для большого потока данных кто-то для медленного но с экономией энергии и так далее то есть у нас различается физический уровень очень сильно эти изменения переносится на транспортный уровень если у нас устройство разные физически то с них и данные надо передавать по разному абсолютно естественно это дальше проходит различие и на уровне приложений если у нас устройств приходят разные данные мы должны обрабатывать показывайте передавать совершенно по-разному нас есть разные типы данных нас есть просто мониторинг в котором потеря кого-то куска данных в принципе не критично у нас есть управление которое должно быть достаточно быстрым и там потери критически у нас есть просто передача данных больших достаточно объемов картинок видео итак отели видно телеметрии к это быстрый и у нас есть просто уведомление которые должны приходить быстро естественно возникает вопрос а почему вот нам собственно не избавиться от этого зоопарка sander стандартов и создать такой единый потому что как я уже говорил у нас есть разные бизнес-задачи где-то это управление лампочкой где-то этом мониторинг параметров каких-то двигатель где-то это мониторинг влажности почвы и они требуют разную физического уровня мы не можем поставить какой-то датчик который работает от батареи и подключить его к и фары потому что вай фай выживает эту батарею радостно за максимум неделю и нам придется у нас либо датчика ключ счастливы мы будем вынуждены менять батарейку очень часто а для системы умного дома нам не подходит лора которая очень долго работает от батарей потому что там задержки там за счет того что большая дальность и низкая энергоёмкость мы теряем скорость у нас передача одного пакета туда-обратно занимает около секунды за свет включается задержка в секунду это плохой пользовательский опыт так нельзя у нас в зависимости от того что мы выбрали в качестве такого низкого стандартная рта низкого уровня отличаются и более высокие уровни если нам данные с датчиков которые приходят 1 секунду постоянно надо хранить по одному и передавать по одному и мы можем потерять несколько отчетов в общем то ничего страшного в этом нет то какие-то другие данные мы должны беречь и охранять что их потеря это плохо их дублирование это тоже плохо любой универсальный стандарт он как правило блада обладает большой избыточностью вот у нас есть допустим веб-разработки так более-менее единый стандарт джейсон которым может разбираться и и и там и там и там он и и вот на сервере можно что-то делать с ним и на клиенте между сервером и клиентом передавать и все как бы замечательно но он это достигается за счет большой его избыточности мы бы взяли какой-то бинарный протоколы он бы был гораздо меньше по объему ис-3 передавалась но у нас есть некоторые ресурсы которые мы можем потратить бездарность для себя памяти для хранения этого формата процессор для обработки поэтому мы можем использовать достаточно избыточный стандарт который покрывал большинство потребностей в эти сейчас такого нет у нас все еще мы все еще в рамках каких-то железок им ближайшие там пять десять лет все еще будет у них поэтому там нам приходится выбирать формат и под конкретное применение потому что есть такие штуки которые обойти никак нельзя если у нас 10000 10000 устройство одно устройство не может стоить больше там 5 долларов но хоть иначе это будет рентабельно устройство стоит дешево у него слабый процессор мы не мог мы использовать форматах с большой избыточность мы вынуждены создавать формат или использовать готовые именно вот под это устройство которое нас может обработать все тлен для управления устройствами нам нужны системы управления почему она не может работать ну собственно сама наши устройства умные у нас в но как я уже говорил огромная куча стандартов огромная куча систему который просто невозможно соединить с друг другом прозрачно у нас тут одни датчики у нас там другие датчики форматы разные устройства разный время передачи разные данные разные но все и должна работать вместе потому что один решает одну бизнес задачу другой другую и они должны работать вместе для решения какой-то общей задачи и нам нужно не только их объединить но нам еще надо писать какую-то общую для них логику и видеть управлять это в общем интерфейсе потому что как у нас допустим сейчас система в пользовательском умном доме каждый винт делают собственное решение делают для него красивое приложение и совершенно не думает о том что человек который хочет собрать все умный дом с кучей систем вынужден пользоваться списком приложений на телефоне вот это для лампочки 1 для лампочки другой это для кондиционера это для стиральной машинки в одну систему это блинки получается клиенты это еще как-то терпят а вот если вы скажете бизнесу что а знаете вот мы вам сделали систему но у нее пять разных интерфейсов научитесь как-нибудь вы справитесь у вас скорее всего таким образом мы приходим к необходимости все-таки сделать какую-то систему управления и начинаем задумываться о какой собственного сна должна быть естественно легко расширяемая и гибкая для того чтобы в процессе эксплуатации у нас тут рынок достаточно горячей у нас тут какие-то изменения происходят появляются новые системы надо дописать новый драйвер для устройств надо писать новую логику тут надо все переделать тут надо новый компонент системы дописать тут надо систему расширить потому что у нас еще 10 тысяч устройств добавилось она не справляется и тогда это уже больше к следующему пункту было про 10 тыщ устройство она должна быть масштабируемой и не просто вертикально и горизонтально тоже мы должны иметь возможность когда оно закончится ресурс у самого жирного сервера добавить еще один такой же рядом и они должны работать вместе она должна быть достаточно экономична потому что если у нас в в обычной работе с серверами мы сталкиваемся с миллионами там клиентов это уже достаточно высоко нору высоко нагружены проекты все это понимаю что есть у нас куча народу если у нас миллионы клиентов то это уже что-то серьезное в интернете устройств ситуация немножко другая потому что там клиенты маленькие устройства маленький их может быть раскидано много и достичь миллиона оконечных устройств нам гораздо проще и это не считается чем-то с к нагруженным это просто миллион устройств поэтому система должна очень экономично расходовать ресурсы мы ожидаем что у нас будет много соединений с этой системы по одному от каждого устройства почему собственно для этого необходим тарантул почему это нельзя сделать на чем угодно потому что система как раз построенная нами система на таран доля она как раз объединяет обладает вот этими всеми характеристиками у нас есть в который с одной стороны высокоуровневый с другой стороны он достаточно прост и он учится любым понимающим человеком занизить через неделю на нем можно писать через две недели его можно узнать достаточно хорошо это может осилить любой интегратор не надо рассказывать как писать вот на этом сложном языке вот он книжка полого вам пример кода разбирать все нормально интеграторы сами могут писать для этого для своей системы какие-то драйвера и мне нужно привлекать разработчиков по каждому чиху драйвера все достаточно простые они могут их изменять они могут писать свою логику есть куча готовых для тех которые они могут использовать им не надо спускаться вот на самый уровень и не надо разбираться как работает запись файлы на уровне системы они вызывают скорую метод записать и другой метод прочитать системы получается масштабируемое экземпляры тарантула могут общаться между собой их можно винить в реплике людей динамично управляя на в русской у нас не хватает одного сервера для обработки всех запросов мы ставим рядом 2 и перенаправляем на него часть или запускаем на первом сервере сбора на втором логику или ставим 3 сервер который будет динамически распределять потоки и сетям получается достаточно экономичны я пришел просто из-за методы поэтому для меня кооперативная многозадачность это практически единственный тип многозадачности но по сравнению с выделением ресурсов на каждый процесс то есть к нам приходят connect от устройства на хочет передать какие-то данные в во множество систем на это выделяется отдельный процесс в tarantul и и прием и обработка каких-то данных мы можем сделать в фейдерах который достаточно и корректно которая к оперативных задач на которое не требует в делении себе на каждой чихнула огромной огромной кучи памяти не требует вот этого переключения контекста полного красиво удобно быстро теперь расскажу немножко подробнее о том как собственно это система все сделано у нас есть центральная шина то есть проблема в том что у разных устройств разные протокол и у нас с одной стороны устройства приходят с разными протоколами и с другой стороны у нас кита коннекторы к базам данных к средствам визуализации к внешней логики и так далее нам надо как-то их привести к единому формату приводим мы их к единому формату нашей собственной шины это просто базу данных ключ-значение ключ от собственно название топика она обычно состоит из там устройство датчик номер датчика что-то типа такого и в значении собственно значение этого датчика мы все данные с устройства всех приводим к единому формату и записываем центральную жилу к центральной шины связаны так называемые скрипты скрипты это пользовательская логика которая может обращаться к это решение брать оттуда данные записывают данные обратно дальше я про них расскажу подробнее и собственно это драйвера устройств которые получают данные от устройств и драйвера систем хранения данных которые хранят данные в каких-то внешних хранилищах хранилища такая достаточно частая задач мы просто собираем данные с датчиков допустим температура и нам надо показать график температуры за месяц это делается с помощью драйвера устройства датчик температуры который кидает сначала конвертирует во внутренний формат данных а из центра лишены они попадают в таимся результа боюсь и уже с помощью то есть там считаемся результат есть мы можем сделать выборку за этот месяц показать их красивенько собственно получить какое-то пользовательский интерфейс и конечно достаточно важная часть системы это интерфейс управления и система логирования так как это система подразумевает разработку программ не профессиональными программистами ну то есть это не то в интеграторе обычно не сидят суровые такие дядечки которые разбираются в коде и сидят в консоль не там сидят люди которые не очень хотят это сделать могут но не очень хотят но которые понимают логику как это должно работать соответственно достаточно важная часть это сделает для них достаточно удобный для них интерфейс в котором они смогли бы работать тут собственно картинками показано то что я говорил перед этим у нас есть какие-то устройства у нас есть драйвера для этих устройств центральная шина скрипты драйвер баз данных и визуализации интерфейс управление а что-то сегодня плохо по-моему я про это уже все рассказал поэтому можете просто посмотреть на этот слайд единственное что тут новое это вот как раз могу рассказать про скрипты когда у нас скрипты у нас есть нескольких видов это во-первых веб event скрипт то есть когда он может сказать системе хочу получить такой the end and в на веб-сервере и когда к нему приходят на этот intent какие-то данные он запускается их обрабатывает может заглянуть в какую-то базу данных выдать оттуда данные обратно пользователю то есть этот такой интерфейс для того чтобы выдать данные пользователю по запросу или получить команду от пользователи тоже высокоуровневая api которым пользуются кита система управления и зале визуализации таймер скрипт это скрипты которые запускаются через некоторое время по цикле то есть допустим если у нас надо проверять не вышло ли температура за пределы мы делаем таймер скрипт который крутится в цикле запускаются каждый там пять минут и проверяет текущее значение температуры если она простая проверка если она вышла за пределы мы генерируем какой-то ивент мы изменяем какое-то значение или отправляем это сообщение и р-н скрип это то что запускается по изменению значения в системной шине у нас какое-то значение изменилось датчик температуры прислал нам новые новые данные хоп у нас запустился even скрипт ну то есть мы можем не делать это раз в пять минут а мы можем просто повесить callback на изменение этого датчика но там свои тонкость потому что по таймеру мы можем мониторить допустим 5 датчиков и сравнивать их между собой в определенные промежутки времени этот у нас запускается к каждый раз запускается только при изменении то есть допустим 1 5 минут мы можем делать логику уровня если пять минут температура не менялась что-нибудь сделать скрипт и собственно выглядят вот так это реальный живой скрипт который я просто вытащил у себя откуда-то это отдельный файл который подгружается динамически тут вот мы это как раз веб event скрипт тут мы видим что он хочет себе npm дата потом он лезет в базу данных тарантула делает оттуда выборку по приходящему ему ключ у то есть у него в параметры вот он request парам лимит это он получает параметр из url запроса он делает выборку по ключу который содержится в этом параметре переделывает дату в человека читаемый формат и возвращает эту пользователю в виде джейсона то есть все достаточно просто нам не надо конвертировать это вручную нам не надо вручную делать про заголовки мы просто в одной строчке отдаем пользователю хороший красивый формат который легко разобрать на клиенте легко куда-то засунуть дальше драйвера это в принципе те самые скрипты но с некоторыми хитростями вот у нас этот драйвер который выглядит примерно то же самое он загружает себе драйвер он соединяется с сервером читать нижняя стрелочка соединяется с локальным сервером creed это и подписывается на топик после чего как только ему приходит какое-то сообщение в этот инквизитор топик он его записывает системную шину это как раз то то что я приводил в пример какой-то датчик температуры которые публикуются изменений топик а они автоматически через этот проходя через этот драйвер превращаются во внутренний формат этих драйверов может быть много от скриптов они отличаются во-первых тем что мы передаем настройки этого драйвер тут этого нет но но мы можем передать настройки этого драйвера в систему в веб-интерфейс управления чтобы не вынуждать пользователю копаться в коде каждый раз то есть он просто говорит я хочу запустить драйвер его спрашивает какой адрес сервера какой порт сервера какую роль он это вводит культур нинка и не трогает код вообще и во-вторых если скрипт и у нас один экземпляр скрипта он запускается один раз работы то у драйвера это развязана откуда у нас есть отдельный экземпляр кода драйвера и отдельные экземпляры этого драйвера запущены мы можем используя один кот запустить 5 экземпляров одного и того же драйвера которые будут работать с разными устройствами с разным адресам сервера и так далее запускаются эти драйвера просто через тыкал с обработка ошибок красивый интерфейс который допустим тут это показывает как раз центрально на вершину тут можно посмотреть на адрес этой шины можно посмотреть на значение можно посмотреть насколько когда она когда это значение последний раз обновлялась можно настроить сохранение или не сохранения в таимся результаты система логирования которое позволяет просматривать ошибки которые возникают в ходе запуска скриптов то есть для для отладки для запуска каких-то скрипнув нам у нас обычно возникают ошибки мы вряд ли пишем скрипты с первого раза и идеально классический способ для отладки это какой-то дебаггер но чаще всего просто используется отладочный вузов консоль ну и собственно вот эта самая консоль мы пытаемся запустить скрипт мы смотрим что он выдал в консоль мы исправляем ошибки так как у нас сервер такой боевой в продакшене то как правило лезть в его консоль немножко затруднительно если там несколько человек на нем работают то это еще более неудобно потому что консоль 1 ошибки сыпятся все разом и получается что они друг другу мешают поэтому для всех ошибок которые отлавливаются в пользовательских скриптах в драйверах на винтах они все культурно показываются в системе логирования где доступна фильтрация по каждому скрипту то есть по источнику этой ошибки по уровню этой ошибки что это ошибка предупреждения или просто информация немножко наступили на грабли в процессе разработки с психики сервером пытались сначала сделать на тимплей тах которые предоставляют таран турский http server но выяснилось что у них очень ограничено применимость потому что допустим вот у нас тут пример того как генерируется менюшка просто вот такая вот менюшка простая достаточно которая перечисляет и странички из системы сгенерировать то мы ее можем оказалось что ее дублировать на всех страничках автоматически нельзя то есть нам приходится вот этот код размещать на каждой страничке там 10 и и изменять это нормально не получается перешли на бюджет и просто отдаем тарантул как http server но в классическом смысле с выдачей хтмл страничке используем теперь вообще никак если вы собираетесь делать нечто подобное то хочу вас сразу предупредить достаточно ограниченную штука что это в итоге все дает вот система прикольная все по развлекались собственно разрабатывая это все классно но стоит отдает для конечных потребителей для интеграторов данном случае это единая среда разработки потому что когда интегратор пишет свою систему он как правило за счет того что хочет сэкономить время он комбинирует из готовых кусков вот тут у нас вася написал какую-то логику на питоне вот тут у нас ира нашла проект на гитхабе которая делает то что надо но он на баше тут у нас носи немножко сделано и так далее это позволяет сделать какое-то решение достаточно быстро там куча специалистов которые пишут на чем могут но это сложно в поддержке и через несколько лет это оборачиваются довольно большой головной болью потому что а вот вот это вот каша все уволились и совершенно непонятно ладно бы в коде сложно разобраться так она не понятно как как работает и какие взаимосвязи вот на том сервере она запущена через кром а тут этот цикл в питоне который крутится и щелкает таймер фигня какая-то у нас есть теперь единая среда разработки все внутренние системы в которой выполнены в едином стиле если это драйвера то они лежат культурно в папочке драйвера и работают ну то есть человек который понимает как понял как устроен один драйвер понимают как устроены и другие человек который понимает логику системы сразу знает что логику которая отвечает за преобразование надо искать в драйверах а логику которая отвечает за обработку данных в скриптах event и так дай рыбы приемы задачи вы решаете даже я всяко бывает преступность функционал закладываем один канал до момента все будет хорошо все услуги все вам понятна воронцов повесть хороший вопрос да обидеть и я понимаю про что вы говорите логика тут существуют следующие если у нас какая-то задача по обработке данных не требовательны к то есть нам не на не надо перемалывать массивы данных считать сложные вычисления и нам в принципе без разницы на чем это реализует мы реализуем это налог потому что это проще потому что это вписывается в существующую к систему там скажем если у нас какая-то задача которая требует серьезных вычислений мы это делаем на любом удобном нам скрипте хочется очень быстро делаем носи хочется работать с нейронными сетями делаем это на питоне и так далее вносим этого отдельный сервис а тут делаем просто коннектор к этому сервису который занимается тем что просто туда передает данные забирает их обратно это совершенно но это совершенно нормально вписывается в карту в мы проигрываем накладных расходов на эту передачу но зато у нас все равно но то что система у нас в едином месте вся работает она сохраняется потому что мы хотим через два года переписать этот модуль мы лезем в папку модулей мы находим этот модуль и видим что этот модуль представляет собой коннектор к сервису нам сразу понятно где этот сервис искать потому что написан адрес этого сервера нам сразу понятно в каком формате он получает в каком он передает данные об это все равно получается проще и лучше чем если у нас система состоит вот из кучи этих сервисов без единой центральной точке и тут я понял очень печально что отлично полезно как ну тут все зависит от задач трандл масштабируются для него пишутся какие-то отдельные обработчики не других языках если уж мы совсем проблем не вижу тут не про скорость обработки тут просто про удобство разработки и поддержку нас все в едином месте это удобно и красиво если продолжать про то что это дает то добавляется еще один плюс раньше если интеграторы хотели сделать что-то какую-то систему они вынуждены были изучать то как это сделать ну то есть они нам нужна система которая раз под сочи то делали ага а как у нас можно сделать расход исход так так итак давайте выучим тут вот возникли проблемы надо переделать то давайте все переделаем занимает время это время это деньги лишние затраты и так далее теперь у них есть инструмент в котором они могут просто писать логику не заморачиваясь на то как это реализовано там где-то внизу и это масштабирование из коробки если писать код следуя довольно таки не очень сложно то он достаточно хорошо масштабируется до весьма серьезных величин потому что скрипт на каком-нибудь питоне если он написан как попало с расчетом на то что он будет всегда запускаться на одном сервере иной раз бывает с масштабировать на пару порядков очень и очень трудно особенно если нужно консистентной если он не просто работает в отдельном потоке а если он пишет в какую-нибудь базу и эта база должна находиться всегда в актуальном состоянии как только мы делаем несколько скриптов у нас это нарушаются нам приходится добавлять key специальные хаки для этого или перед переписывать все с нуля тут у нас все культурно и красиво если вам интересный если вы хотите поиграться с этим живут а вот я их гид have a на все что доступно без лицензированные без лицензирования но выложены на гитхабе текущая версия первое это собственно сама система она требует только таранто и там двух библиотек 2 это интерфейс для этой системы которая написана view которые собираются с помощью они прям классический все конец мои контакты если кому-то надо время для вопросов ну ну в смысле один он запускается как один но к нему можно дописать коннектор который будет передавать данные в другой мне будет реализовано логика ну собственном этот коннектор видеть раз я решением вставляется мы его поставляем и и так и так но мы ориентируемся к мы мы интеграторы мы делаем клиенту коробочное решение зависимости от того что именно надо мы можем это захочет у себя можем просто настроить это на мощностях клиента мы можем передать ему собственные исходники под и лицензии допускающие создание своих проектов и он дальше будет работать с ними мы можем дописать систему под него в на текущий момент а то так проще ра ну так проще разграничивать спасибо расскажите пожалуйста по каким протоколом сейчас устройства подключаются и примерно объем можно дать и вот с каким еще сработаете собственно вот протокол и у меня были перечислены тут вот они именно все ему dbase в том числе просто в таком случае у меня возникает вопрос как вы в тарантул делаете агрегацию вот например sur ce am a woman база данных то есть вы marmot бо сервер пойдет подняли под тарантулом нет смотрите мы не закладываем ся на физический уровень есть такая компания как embedded systems у который я почерпнул достаточно много и идея касающихся внутреннего устройства и они продают продукт у них это встраиваемый компьютер в котором есть все эти интерфейсы и на нем же запускаются запускается софт то есть они сами делают железку и продают ее вместе со своим софтом вот собственно сама железка на достаточно стандартная а вот тем что у них хороший софт определяется ее достаточно высокая цена мы не хотим делать так мы не разработчики железа мы делаем софт поэтому у нас у нас нет готового нашего решения для использования всех этих протоколов если это modbus то мы используем черта решения какой-то 1 платник 485m с rs 485 который превращает в morbus какой-то протокол который бегает по сети допустим вот этот сам вот сейчас у нас уже железка контакт лес в оренбурге в которой это как расселись ну и то же самое с другими протоколом если это беспроводный какие-то устройства зови флора то ставится gg3 у которой с одной стороны торчит антенка лауры в другой стороны разъем ethernet или warfare ясно вас понял спасибо газ долгострой долгосрочное хранение это реализовано через адаптеры к time series дтп с то есть мы можем выбрать какие значения из системной шины мы хотим сохранять в тайм сервис и дальше с но мы их просто туда пушем а дальше работа с долговременным хранением идет с помощью средств для работы ставим series дтп из средств визуализации еще чем-то но и мы с помощью этого адаптера для м-серии дтп сможем оттуда вытащить какие-то значения если они над нам нужны для текущих расчетов скриптах то есть проект прямо и что как-то вытесняете данный да есть тарантула то есть там серьезно ну там старше например годы дней я говорил про то что мы не используем базу данных практически вообще у нас база данных тарантулов ская используется по сути только вот в центральной шине еще там хранятся настройки но собственно централя центральная шина системная она представляет собой ключ значения в которой нет в времени поступления этих данных там всегда свежие данные вот тут на каком-то вот он на слайде у нас собственно ключ-значение и когда она обновлялась если она обновлялась сейчас значит все данные за предыдущий их уже нет они перекрыли с новыми для того чтобы их хранить мы при каждом обновлении этих данных пушем их в какую-то базу данных которая занимается хранением так как у нас отчетов может быть очень много мы сразу решили не заниматься построением своей базы данных временных рядов использовать готовы жить и пример привести то есть то есть мы делились сейчас написали драйвер для influx дпк к ней в два клика подключается визуализатор как он называется к графам до grafana которая занимается построением графиков то есть если вам нужно просто графика показать как она изменяла за будто тут тут вот эта вся система ну она работает отдельно графики строятся отдельно и это можно вынести на отдельный сервер и ресурсы основного сервера центрального сервер на это тратиться не буду ну и люди умеют делать там service data без лучше чем мы все по пусть они видел спасибо района или еще последнего значения да да запустим я получил сообщение нажали кнопку до меня ножа до меня значение 1 есть какую-то обработчиком лампочка которая продолжалась я отвечаю а дальше система даже видят на средние значения вот но на самом деле зависит от но сейчас этот слайд на идут что такое допустим вот это у нас кнопки а это у нас лампочки мы нажимаем кнопку она по-своему протоколу передает события о том что на жалость в driver это может быть данные разных штук то есть если эта кнопка которая нажимается долго она может прислать два сообщения сначала меня нажали потом меня отпустили если это кнопка которая просто click on a пришлет одно сообщение меня нажали драйвер это переделывает из контингент формат системной шины систем наше не обновляется значение топика кнопка если она если это переключателя но обновляется два раза если это клик она обновляется один раз дальше при обновлении запускается event скрипт который видит что кнопка нажата он делает какую-то логику вычисляет там время ее нажатия смотрит на текущее время решает зажигательные зажигать свет и изменяет данные в системной шине у топика лампочка эти изменения визит драйвер лампочки и отправляет команду по своему протоколу может быть кому то другому лампочки она зажигается в системной шине остается в одном случае значение что кнопку да да у-у-у кнопки единичка послал там один пожар отпустили сработал 1 не успел находится под там есть еще прослойка видео фифа очереди которая гарантирует что события будут в скриптах обработаны именно в том порядке в каком они пришли но соответственно если он сначала пришел один потом пришел 0 то они будут обработаны в таком порядке вот а тот кто сбрасывает значение кнопки это может сбросить драйвер запустив отдельный поток на это допустим через секунду это может сбросить иван скрип ну то есть это зависит от текущей реализации мы это не регламентирует потому что разные задачи разные железки требуют разных подходов отложить инструкция . раскрыв говорит чего сегодняшний где же наши этом выступлении входящей информации за которая 2 шина процессами но мы придерживаемся модели что все есть данные если он то есть события нажатия кнопки это изменение ее статуса с нуля на единицу зажигания лампочки это то это тоже данные но они могут меняться на них можно вешать какие-то события ну а сатана нудный и я просто не понял а а вот и и если придерживаться модели все есть данные а что вынести останутся за занималась управлением как а в этом смысле но но для для метра просто как но ну-ка кнопка это тоже датчик ну мы мы много оптимизировали именно скорость мы это тестировали на больших объемах ну тов к этому моменту мы 20 тысяч устройств от чего-то загрузка слишком большая но я просто не не вижу как разделение на две шины в одном процессе тарантула смогло бы решить эту проблему то есть ну и так и так идут данные ну просто они они идут в 2 разных база данных brokers а брокер сообщений где в внутри мы использовали внешние брокеры но у них накладных расходов на передачу сообщений больше чем просто запись базу но тут то есть в ситуации когда у нас много-много маленьких сообщений выгоднее использовать такую бурю возможно у нас просто задачей ножку специфичны нудистов большинства себя за рассказ если будет ещё вопросик можно будет задать чуть позже в кулуарах у меня сейчас пятиминутная пауза смена докладчика дальше первых похлопаем"
}