{
  "video_id": "Qf2W8Buy7Ug",
  "channel": "HighLoadChannel",
  "title": "Как превратить Openstack Swift в хранилище для высоких нагрузок / Николай Двас (Webzilla)",
  "views": 287,
  "duration": 2736,
  "published": "2017-04-22T13:05:55-07:00",
  "text": "тема которую видите на слайде немножко отличается от той темы которая заявлена в программе по одной единственной причине когда я подавал заявку в программу я не думал о том что надо уместить заголовок наслать у меня не получилось мне пришлось немножко перезапустит то же самое тему openstack свифт высоко нагруженного провайдера openstack свифт это объектно и хранилище все слова здесь имеют какое-то свое значение высокой нагрузке про них мы поговорим что такое какие нагрузки обслуживаются слова провайдер тут тоже имеет значения потому что в отличие от александра который рассказывал про инсталляция фактически абсолю роз может принести и публичная лучше работа и вовремя останавливаться последствия не шел зачем мы сделаны из автобуса цветов чтобы получить работающий сервер из объект объединенных ранений он в меньшей степени затрагивает ответ на вопрос как именно сделать покажем как будто ясностью наша команда ответ вам лицензия перевести в миссис уверены чтение трудом info with возможен при страниц доклад 3 часа первое рассказывает о том зачем им проводились к министру зачем его делали такие задачи а вторая часть рассказывать про устройство света который как признаться а еще мы добивались его расскажу немножко себе а я менеджер о наших продуктах таким образом как раз именно вопросы для чего и что сделать занимают меня больше чем вопросы реализации заключается в том чтобы а клиентские запросы и требования удовлетворялись теми ресурсами которыми их размывает продуктом я в корзину европейская простенького компании на данный момент сумма 700 800 секунду расположена наша еда пастернак силу и наши клиенты это самый крупный зачем первое это источник данных и день то место откуда на большой море не змин дальность будет брать данным того чтобы граждан второй немаловажный вопрос это резервное копирование тут следует различать использование первое это резервное копирование резервного копирования осуществляем сильным клиента и его хотя и второй это сервис поскольку мы имели некоторое количество клиентов которых управляется настоятельно и хорошо или как администратор и не для которых нужно им не интересно интересно нести затраты связаны с контрабаса просто 1 пункта зачем мой разговор о судно ручки и задачи которые на наших лет в начале ли шанс как только они получили это текущая русское оружие нашим наших стараться сердцах включая себя по индийски добавить более 50 гигабит трафика себя это метра продаваемым стену за трафик раздаваемые либо в на эти сервера сидена либо прошло уже клиент рисует конечным потребителем при этом три находится привлекаться пройду я говорю позже подробнее и осуществляется резервными кабелями тысяч ребят итак первая роль это источник контента для себя вообще говоря в работе сидя на работе сети доставки контента а нельзя преуменьшать роли . потому что если источник плохой то длинный хвост у вас adwords потому что если источник плохой то кашами были горячие дослужишься а длинный хвост вы растеряете или оформили похоже вообще сидел по своей сути сервис который продается клиентам которые но в общем готовы платить и платить деньги и вклад находить свои ресурсы то чтобы доставлять контент быстро и качественно когда люди которые с определенных уровнях понимание доросли с другой стороны хотят заплатить деньги и связи с проблемы снять пытаемся продавать быстро без проблем и продаем быстро и беспроблемно сервис а помимо помимо этого с точки зрения origin источника данных для сидена важно не только возможность заселена порах определенного кошелек но и наличие определенного хранить потому что если сидеть глобальный если к обслуживаются клиенты из европы из штатов то очень хорошо иметь возможность обслуживать американский клиентов из америка европейских из европы даже не горячим даже самым холодным контент ну и в конце концов продавая create a hidden предоставляем услуги себе мы берем на себя ответственность за то чтобы доставлялась быстро и хорошо его за то чтобы о край наставляли быстрая хороша и на мой взгляд ответственность неотделима от контроля и оказаться ситуации когда мы спорим с клиентом о том почему они так потому что его перегружен потому что там изменился запросов пошел большими данными сервер перегружен не очень качественно обслужить это неправильно для провайдера совершенно практика поэтому нам полезны правильно есть контроль над полным момент когда по интернету потребители стали как бы пока невозможно а для ольга сидена требуется наличие репликации данных между очень должны хранилищами говорит штаты европы при этом клиенты сидена не хотят за свои деньги покупать головную боль очень сильно не хотят хотят иметь удобные инструменты управления контентом они хотят еще всяких разных возможностей таких как защита от картинками что слава богу предоставляется можно предоставить при помощи вообще встроен функциональности или всегда стриминга который в swift достаточно взять и добавляется уже пару пару лет работающей в разных продакшен их medline если говорить про раздачу статике то тут в общем то имеет место большинство тех факторов которые вернее населена но только нет самого силен и нужно был было бы глупо не кэшировать горячий контент который сдается на плюнул это было бы крайне даже с точки зрения с точки зрения провайдера уменьшение нагрузки на нас как и провайдера уменьшения наших соответственно затраты конечный украинских цен оконечник низкие цены надо поддерживать хорошим потому что пред всегда есть интернате вам взять собственный сервер предел там галочку последними g лиц и надо быть не только качестве не дано и не дороже потому что если мы говорим что какие-то наши технологии эффективнее он показывает делом приобрести вот тем чтобы предоставлять не худшее услуги по не больше цене резервное копирование и это следующий месяц следующая практика для которые используются хранилище а вот требует совершенно другого она требует принимать много данных требует иметь какие-то инструменты которые поддерживают нормальной практике резервного копирования так или иначе желаемые клиентами и она ты в общем требует дополнительным образом защищает данные случайных потерь опять же 2 реплик аверсе анимирование или защита от случайного удаления сеть инструменты тоже имеются и однако частично требуют доработки в свифти все говорить про слив чему хорошему в общем довольно популярный 5 которые многое разработчиков разрабатывают много разной степени ужасности кода он довольно хорошо горизонтально масштабировать но не бесконечной против кожи расскажем о он действительно хорошо восстанавливается после сбора железо или после смерти железо умершие сторож серверами умерший диск можем просто заменить больших проблем не будет вот маленький позже и помощи вы это все как то так или иначе работать но как справедливо сказал александр там нет никакого каширования фишер я им потянут внешне там максимально настроек умолчанию и некоторые возможности производят впечатление не прогрессирует как тебе нагрузками тестированных на соответствие формальной логики на кто здесь не текстуру 3 и а где у каждого которую может имеется некоторое количество фактически 1 уровне либо technomancer думаю понимать собираться некоторое количество объект каждая сущность сад ресурса айры каждый супер можно общаться хранилище объединяются некотрое жены зоны в регионы при этом старается раскладывались контент на количество копий максимально леса он считает что зонами легиона и в общем и а здесь и партии партии мне том понимании можно это просто кусок данных с хоррором внутренних работ он будет реагировать партийную целиком а матери на территории и уже дальше в этом партии не хранятся конечный поляки которые соответствуют armelle targaryen пар тишины распределены по распределяются по 40 по узлам хранилище и есть некоторые внутренние процессы затем чтобы квартире находились в состоянии если условно которые специализировались и составляют клиент общаясь с ним счастлив том обращаясь к прокси сервера посылает свой этот берег ест лимон опиши самого считали быстрее вас прокси-сервера дальше общаются уже позволь ему со стороны получает культурно ветклинику прокси-сервера наделены богатый внутренний мир и в зависимости от тех мер на которые прикреплены существует конвейера can be really могут обрабатывается просто гривен в чистую свифт и 10 и 2 цвета у нас первым это но сохраняться объекта контейнер и запись который я расскажу чуть похоже а вторая это про псину да а где запущен в прокси и дженис их a proxy а в общем то зачем двое последних я был сложен и догадались с учетом предыдущего слайда про отсутствие афишировал немножечко эксплуатацию информирования все чтобы вот эти вот раздену портишь прохожу я их число фиксируется при создании инсталляции света и есть рекомендация которые добра которая заключается в том чтобы partition диски alcasta тысячи после этого на обработку запроса начинает процесс стойте магические числа в зависимости от по русски это может быть 200 мир 1000 или там сели за 800 но вообще говоря примерно десятикратный диапазон от количества партия здесь свифт не начинает домой осилим власти процесса соответственно так как и суппорте зафиксировано числа партий российско ограничено добавляет диски мы уменьшаем все портится надесь и это является учителем роста которые из реального мира для системы которая формального масштабируемую вширь бесконечно в общем можно вырастить по количеству 10 pir там в 5 раз если хорошо повезет в 10 раз соответственно помимо этого это очень быстро добавление сотни терабайт в работающую потому что процессоры samsung и если позволить им работать в полную силу они просто уложен старается сердца это картинка которую покажи в предыдущем докладе прослужит процесса левов сны про том как они там увеличивают влажности в 1050 раз она будет будет продолжаться не только там не 10 минут часы с точки зрения обслуживания важно также его реакция на отказ оборудования на оскар железо в общем реакция довольно предсказуемо при потере ситуацию река ции наибольшее количество раз прибавлять соответствующее количество совпадает еще сильнее одну в общем с одной потерями зоны уже не так страшно как с учинивших сезонный которая начинает по большому счету не процессор поломка процессор ботинки а мы провели замер на небольшом тестовом стенде соответственно в котором каждая зона соответствовал всего моему серверу патрин нагрузки конкретный я сейчас не ботерн загрузки компе состояла из 80 процентов 20 мегабайт файлов случайным размером 1 альбом и видно вот красненькие цифры я рвал на 100 соответствует здоровому кластером а синенькие классе потерявшему одну зону а зелененькие кластеру которой вернули одну зону в девственном состоянии и он начинает сам вся чинить и вообще видно что 95 интим например по количеству операций в секунду он падает 35 раз если начинать ученица прям полностью и целиком это конечно недопустимо поэтому с точки зрения обслуживания лучше не возвращать после выпадения оборудовали большие куски сирт сразу но ситуация когда я не знаю вас сгорела там настолько с со стороны целиком и все стороны ставит все новые диски вот не дай бог после этого начать возвращать кольцо все диски 1 временем она довольно быстро за реплицировать он при этом к сожалению чего друга обработать не будут свифт относится к себе с большим почти а помимо помимо прочего есть там еще пару все-все интересных оригинальных решений например для хранения данных котельных аккаунтах свифт использовать вскоре которых дергается буквально каждый раз когда она вошел в прокат и посмотреть получается звучать иску высокой нагрузкой который напишут читают все это приводило к тому что наши коллеги писали что не хорошо иметь в одной сущности больше миллиона по сущности значит например в контейнер и очень хорошо иметь больше миллиона объект проблема использования сковать оттуда может решиться только замены на что-нибудь более приятное не знаю что но ми тегировать проблему частично можно тем чтобы перенести серверы контейнеров и аккаунтов перейти хранимых данных катания канатной связи по большому счету после этого проблема теряет практическое значение то есть мы сейчас спокойно работаем с сотни миллионов объектов в одном контейнере на петабайт хранения за глаза при на при тех типах использование которых говорил раньше хватает терабайта данных к тренер аккаунт и это позволяет еще их реплицировать больше раз чем сами оригинальные данные объекты и в общем то получается что решение не слишком дорогое и там с практической точки зрения абсолютно работающие свет как я уже говорил имеет некоторые странности еще одна из них это тот фактор что никак нельзя разделить работу и во внутренних и несомненно очень важных процессов с полезная нагрузка создаваемым создаваемые клиентами они же будут в одной сети они конкурируют за сетевые ресурсы они там нет никакого стороны поэтому когда добавляется в миксе стесняется она пытается защитить потребителя от возникает и от к примеру в том что он пишет forum а потом может требование каждый раз вещей и прочитать из двух позиций сравнить если это как видим удваивают на нагрузку на сервер а при отдаче и увеличивает травести при этом на самом деле некоторые очень большое количество neon race слова можно наказать и ещё одна особенность это синхронизация системе есть ограничим синхронизации между внешней стороне сердца привет заключается в том что то это треть репутацию важно а один подход не старались которые еще можно день и непредсказуем загнуться это приписать сделать реализации многопоточный и мониторе посредством это может взять не так поскольку а все необходимые данные последнего обновления и количество объектов доступны через синхронизации и управления собой и поэтому большинство провайдер осталась такой же страничке в базе пользователи больше в общем доработок белье на состояние когда она отварную и решив вопрос распределения и реализации хранилищами за счет теперь про то как это все сочетается транспортными используем если нет на российском и заливка получается большая слава богу не одновременно потому что за чтение она все в основном тогда когда потребление 11 время когда с ними устремления потому что при получается что пиковая нагрузка по записи бассейн здесь она а что мы сделали чтобы адекватно обслуживать раздать стать чтобы обслуживать радар кстати и мы отдаем качестве адрес по которым мы находились и не адрес самого сердца и которая в свою очередь запроса маскирующих адена управлять напрямую на всех спрос а get запрос она отправляет на который уже случае карниз ведет на sims проса и также напрямую на сверх прокси направляются запросы от нашего сидена поскольку сидит как мы считаем уже экономический максимальный момент клиента решила ваш кошелек и не надо нам залива до есть еще один момент который связан с тем что касается так не связаны с тем что касается раздач источники кеширование 700 те пользователи которые раздают статику не сиди на харьковщине катар думают про то продукт каширования а на 2 регулируется для этого не большими глыбами этого результата который анализирующий контент запроса желает по 10 multicast во всем по всеми пальцами рокси харт и кого надо из сша вылезти им последнее что я хотел это те инструменты которые тоже потребовали от нас а мне которого анализы и и или доработки и позволяют нашим клиентам пользоваться объектом хранилищем в общем ты не слишком задумываясь о том чем это на самом деле пользуются а первый инструмент к сожалению очень любимый клиент и крупные клиенты обычно имеют того мир большое количество legacy кода который фактически готов работать из всех возможных вариантов только посредством теперь но там какой-нибудь дремучей версии по которой библиотечку для работы зацепить уже никак не получится начали пописать олимпийской дремучий версии либо писать о хороши не очень хорошее но не поэтому из пользователь теперь есть продукт который более или менее решая задачи ту старую еще хорошие замечать и горизонтально масштабируется поскольку является прошлым простой которая транслирует брп команды в орбит близ сирта и api ответ на swift ours тебе ответы и больше ничего не делать соответственно таких практик можно оставить десятками клиентов более того клиент у нас практик определение просто делитесь и т.п. в чем не кольчугу там пришлось доработать частности все теги эти ограничения на размер объекта работу с большими объектами через цепи разработчиками типе клаудов с принципе было сделано но сделана она была в общем загадочно поскольку соответственно не переименовать не удалить и еще пользователя возникали файлы частей на которые разделяются крупные объекты для того чтобы положить хранилище в листинге директории это все пришлось изменить пока что мы не сделали это работа с через контейнер с большим количеством объектов при том что он как я вас говорят самые крупные клиенты по факту ну я думаю с этим имеющий самое большое количество объектов по факту работают через ftp они в общем данных согласны с тем что у них пока не получается сделать с потому что этот продукт пытается и это не так просто изменить засосать в свою память весь листинг контейнер ничем не ограничивая себя и на достаточно больших контейнерах он совсем справляется но что можно было сделать это можно было сделать чтобы различать футбол поведение когда таки пытается забить память до конца забивает патент или роняет еще какой-нибудь нам системой процесс удалось сдались того чтобы он по крайней мере не падал вот таких запросах а мирно давал пользователь отказ и самое последнее время подходит концу это инструмент для резервного копирования тут есть для каждой из под задач выбрали три инструментов данному инструменту первая задача это копирование виртуализованных сред с этим в общем справляется замечательно veeam backup в варианте вообще без проблем для резервного копирования windows есть разработаны виндовый программный продукт поддерживающий кучу различных сценариях резервного копирования чудесной операционной системы включая возможность баре милых взятым копирования ибо сам с скверик чаще всего остального но для копирования машин а если говорит управляемых клиентов это более и сам подавили поэтому пользуйтесь доработок в которой мы все равно это скорее потому что теперь передовики стоять и второй заключается в том что который теперь будет очень то на который и в зависимости сервер пассию количество директории уровень его территория и количество твоего номера павел какого ты ищешь из конечно удается факторы этот размер кольца практически под подбирать завести числе при том riser эту пудру сильного создавать если он слишком большой резонанс и каждый раз как размер чтобы это хорошо у нас пока нет для управляемых кашель но сожалению этого продукта это очень в итоге чтобы получить свифт да можно использовать однако сервис нашим уже больше года ему доработками не собирается останавливаться и я того чтобы мы неправильно таким какую-то работу них проходит возможно этот путь приносит свои годы 1 заправляем спасибо большое спасибо мне нужно я с радостью ответим на вопрос хочу сказать что довольно интересную архитектуру вы придумали для свифта чтобы его окружить меня вопрос о инвалида ции крыша как я видел на одном из слайдов выезд да да да если вернуться можно очень здорово было бы вы используете multicast и египет для валидации что здорово выстроили синхронно и я сделал также но при этом это не гарантирует того что кэш обязательно будет инвалиде rowan на всех джон иксах соответственно может возникнуть ситуация что на одном из или на нескольких если их всех их очень уж много может отдаваться устаревший контент какой-то наверняка вы с этим столкнулись и как решали может быть какие-то дополнительные цели на уровне к шов у вас есть что то такое то есть это в любом случае кыш и довольно таки не вечны но в целом да это проблема возможно и для качественного контроля мы все-таки предлагаем клиентам работать сети доставки контента где можно в явном виде указать что этот кошмар анализировать но в целом я обнаружу что меня здесь вместо но мы практически практически не стал и а вот вы говорили что вы много пилили собственно куски свифта что-то переделывали где-то многопоточность сделали поделиться не хотите вы знаете чем то хотим чем-то хотим но тут есть ещё такой момент что это все-таки доработки там для нас как для конкретного провайдера вот то что мы доработали в эти пикает видом и без проблем и легко влили в в ops 3 наши доработки хорошо работают у нас но до уровня вливание в up stream не я боюсь не дотягивает если честно поэтому когда мы будем готовы сказать что мы готовы это все пробивать в up stream в этот момент мы это обязательно опустим отдать цель такая есть спасибо спасибо тоже вопросы догонку где то у вас может быть есть хотя бы на гитхабе свои вот эти вот доработки патчи или вы их у тебя нет они у нас внутри а и вот второй вопрос вы говорили про рыть кондишен до продаж там чтения с низких нот одно это сравнение а вы говорили что во-первых он отключается то есть и такая то данная опция известная ада это известная штатная опция которая на данный момент мне не известно но тоже хорошо и как она будет себя вести есть этого отключить то есть даже первое попавшееся и до свидания а то пошло нормально существующей репетитор дни она может 404 отдать всего нет а я она даст она не отдаст объект который наполовину там ковыль франкен объекта на не отдаст но она отдаст любой какой какой попадется на самом деле точно также себя вот здесь буквально в коридоре поймал коллег из куба и он рассказал что из-за этой проблемы они отказались от использования амазонского что этот рейс до его можно налить у провайдеров но там если если от него избавиться то очень сильно возрастет цена и большое количество клиентов которым это не надо просто потеряются в связи с который пойдут к тому провайдеру которого нежели издержки ниже цены и эта проблема есть на нее наплевать спасибо у меня вопрос по поводу заявления того что угреватой эти фичи которые тестировали девелоперами на ноутбуках и больше нигде есть ли какие-то фичу которые вам не хватает которые были заявлены в цветке и при этом действительно они не выдерживают нагрузку ну вот но то есть это синхронизация валяная все она может использоваться механик десятка например а как в это прошли и детально но по точно да это случайно не та прописать"
}