{
  "video_id": "oANIJZgeBEU",
  "channel": "HighLoadChannel",
  "title": "Centrifugo — open-source сервер real-time сообщений / Александр Емелин (Mail.Ru Group)",
  "views": 2567,
  "duration": 2573,
  "published": "2017-04-22T14:47:53-07:00",
  "text": "всем привет меня зовут александр и мерин как уже у меня представили я работаю mail.ru а и сегодня буду вам рассказывать про свой open source проект который называется центрифугу на русский манер центрифуга это open source под лицензиями эти сервер real-time сообщений написаны языке г ну давайте начнем начнем с того что вообще такое real-time сообщения контексте моего доклада real-time сообщение это сообщение событий доставленные клиенту пользователю приложения в кратчайшие сроки после того как backend приложения об этом событии узнал вообще все мое выступление будет пронизана контекстом веба но так или иначе многие вещи о которых я буду рассказывать применимые для мобильной разработки и в конце я еще про мобильники поговорю кто вообще можно спросить слышал про центрифугу до этого а кто использовал никто окей может быть при боится пользователей может быть нет но тем ни менее будет две части в докладе первые боли такая обзорная 2 непосредственно про центрифуга где вообще real-time сообщения нужны ну далеко за примерами ходить не нужно популярный мессенджер и которых повсеместно развелось telegram ватсап сообщение появляется сразу же как только отправил собеседник вам его это платформа real-time комментариев дискос я думаю все слышали это в различные статистика и счетчики на сайте счетчики лайков которые обновляются в реальном времени кооперативный мультиплеерный real-time игры где нужно сообщать клиентам состоянии игрового мира clavical оперативные редактирование документов вообще тенденция вообще мире такая что контент нужно доставлять пользователям как можно скорее и картинка который сейчас изображено здесь по сути от истины и недалеко ушла и давайте теперь посмотрим какую вообще смысловую нагрузку могут нести прилетаем сообщении на сайте ну во первых это необходимость да если бы мы обновляли окно чата в телеграме это было бы странно что посмотреть пришло ли на новое сообщение да вот например пример ковра который думаю многие из вас видели это комментарий я всегда буду обновлять страницу перед написанием комментариев которые встречаются и тут и там хабар до сих пор эту проблему не решил хотя мог бы упростить жизнь своим юзерам на том же stackoverflow если мы пишем ответ на вопрос и кто-то другой дан в эту секунду ответил раньше нас вас плавающим воспевающий подсказки об этом сообщается мы нервов нервы не тратим и никому ничего объяснять не обязаны далее вау-эффект ну когда мы говорим о real-time сообщениях и вал эффекте мне например приходит сразу приложение tripping это карта мира на который вспыхивают в реальном времени твиты которые публикуют пользователь twitter соответственно это все выглядит очень красиво внизу всякая статистика и так далее можно часами на все это смотреть иногда бывают такие ситуации когда real-time сообщения вредны данную яркий пример это интернет-магазин если мы хотим купить телефон подносим курсор кнопочку положить корзину в этот момент курс доллара скачет и цена на сайте на наших глазах тоже подскакивает вверх но это странно мы здесь ничего не купим поэтому есть такие случаи когда в реальном времени ничего не нужно обновлять информацию каким образом вообще в приложении появляется контент большинство современных приложений по большей части readonly до пользователи в основном потребляют информацию они генерируют и и но случае появления новой информации можно под бы по большому счету выделить два способа это первое создают пользователи приложения контент в том числе модераторы ресурса либо он создает создается автоматически например парсером со стороннего теперь и в том и другом случае мы знаем как новый контент в нашем приложении создать это либо просто запись в базу на если это автоматический способ либо это под запрос к бренду нашего приложения под запрос или эссе запрос зависимости от ситуации поэтому основная задача real-time сообщений на мой взгляд это проблема доставки быстрой доставки сообщения от сервера клиенту давайте посмотрим опять же в контексте больше браузера какие способы и транспорт у нас для этого есть 1 от long polling всем известная думаю это по большому счету название техники когда клиент открывает соединение на сервер сервер это соединение не закрывает до тех пор пока не появится какой-то контент либо не случится тайм-аут после этого соединения закрывается клиента есть возможность контент обработать удобном ему нужно ему способом и дальше он делает reconnect серверы все это продолжается в цикле далее хорошо было бы избавиться от reconnect of на этот случай есть такие транспорт как их свечах или с dear streaming как свеча red ex mp4 quest x диорит вариация для интернет эксплорер а тут уже клиент может reconnect не делать и у него есть возможность в кубрике специальным данные которые пришли с сервера вы работать также к постоянным соединением относится транспорт и ресурс все эти транспорт на основе even сурс это также такой простой протокол на основе степи где данные прилетают разделенные переносами строк непрерывный поток данных идет и вы можете их callback обрабатывать с постоянными транспорта мидори коннектов нет но есть другая немного задача тут нужно иногда слать пинге в соединении потому что промежуточные проксима считать к соединение неактивным его закрыть вообще то что я сейчас перечислил вот эти три транспорта да они по большому счету основные для работы из браузера но есть и масса других а например старый экзотические вроде html-файл или джейсон и полинг часто эти транспорты используются в айфрейм ах для того чтобы избежать проблем с подключениями к другому домену поэтому появление первых спецификаций websocket of было встречено с большим энтузиазмом они прошли несколько спецификации и были стандартизированы в итоге в россии 64 55 websocket а что в них хорошего конечно самое главное это то что это полнодуплексный протокол поверх тисе пи соединения полнодуплексный значит что мы можем и отправлять данные и принимать от клиента отправлять на серверы от сервера клиенту одновременно и не опасаться коллизий простой 5 до можем использовать для программиста очень прозрачно как их использовать далее они снимают ограничения браузеров на открытие постоянных соединений к одному домену если спецификации степи 11 это 5-6 соединений to reflect в такого ограничения нет мы можем сколько угодно по большому счету открыть соединение к одному домену но при на самом деле лимит в браузерах есть это 200 firefox сейчас и в хроме 255 на это очень много и поэтому никогда в него не упираемся и что немаловажно websocket и работает на тех же портах что из степи да на 80 и 443 поэтому нам не нужно дополнительно ничего открывать наружу помимо того что у нас уже в принципе должно быть но просто так взять и начать использовать было websocket и было нельзя и почему ну конечно во главе с интернет эксплорер было слабый поддержку браузера спустя много лет пока уже наверное лет семь прошло поддержка браузеров улучшилась сейчас согласно статистике к на юз 87 процентов и в зависимости от аудитории вашего сайта она может достигать 90 95 процентов а также изначально различные прокси антивирусы резали websocket от трафик а потому что не знали что это такое той же ситуация здесь немножко улучшилась годами и использование сейчас зашифрованного соединения для vip сокетов позволяет в принципе от этих проблем полностью избавиться но не все так гладко прогресс не стоит на месте и высокие то в принципе критикуют да потому что каждая открытая вкладка это одно отдельное типы соединения на сервер в принципе этого можно избежать используя шарит worker объект java script но сейчас интернет потихонечку переползает на hd2 вторую версию протокола ftp что в нем хорошо так это то что все соединения к одному домену он multiplexer уйти через одна реальность и соединения это здорово это позволяет сэкономить ресурсы и но проблема в том что транспорта который сейчас на вот прям даст из коробки возможность real-time сообщить доставлять чище через ftp 2 особенно vip-клиентом да если серверным клиентами в серверных приложениях можно придумать направленный поток на основе существующей библиотек кто с велом пока нет но возможно это будет потому что там есть специальный уж promise фрейм который позволяет получать данные с сервера клиенту данным сейчас он используется для передачи клиентов всяких ресурсов кэш браузера но уже есть спецификации которые на основе этого push фрейма обыгрывают доставку real-time модификации клиентам драфт есть но он пока не одобрен в разработке скоро возможно firefox появится поддержка такого механизма и так что нам делать с теми десятью пятью процентами пользователю которых поддержки об сокетов нет первый случай первый способ это конечно сказать им ребят обновляйтесь но вот не будет работ в некоторых случаях потому что например о троми никак не имела поддержки в посылке так у меня наверное не планируется то есть пользователь нужно будет про озерова любимый сменить поэтому второй способ это использовать библиотеки полифилы то есть библиотеки которые в отсутствие поддержки в сокетов имеют фабрики для до старых и степи транспортов о которых я упоминал ранее тут два монстра по большому счету это 100 китая о котором думаю все слышали и сок jest уже наверно тоже о нем так или иначе краем уха каждый слышал о секс то я появился раньше завоевал большую популярность но некоторые нерешенные проблемы с течение долгого времени разработчиков в сторону 40 джесс все-таки направили ее в принципе в том числе и меня в свое время у меня старджесс проблем не было никогда и те маленькие недочеты которые были библиотеки авторы достаточно быстро пикселя как еще один аргумент в сторону сок г.с. вот например недавно зарегался real time free год фреймворк horizon от на основе rising биби и это и шью язык если tracker на гитхабе с головы гласит мувы way from энджи на елке литве сфарда давайте избавимся от n джанаева но его в пекло и он же на ее это основы со китая и в принципе там автор описывает всю свою боль с которым в течение практики столкнулся со китая предлагает использовать либо чистые websocket алибасов джесс ну это просто как ремарка соки на основе создается сделано много хороших приложений в принципе ничего плохого сейчас наверное уже в нем и нет но я свое время с мигрировал нас уже с вообще истоки таинство джесс соответственно имеют не только клиентскую часть но и серверную часть чтобы абстрагировать транспорт используемой и предоставить программист простой 5 для использования на сервере в том числе реализации есть для многих языков и давайте теперь вот клиентской части посмотрим в сторону готовых решений на самом деле их тьма и вот фил ли guitar посылки которые здесь есть сделал real-time technologies гайд где собрал просто массу полезных real-time инструмент которые сейчас есть в мире и можно посмотреть там кстати есть центрифуга среди прочих но вообще если вы программируете backend свой на java script а есть такие кто вот на java script пишет backend двое-трое хорошо on the у вас вот проблем меньше всех на самом деле в 20 существует куча готовых решений проверенных временем и это например от начинает фреймворков метеор дерби и заканчивая библиотеками такими как примус и фэй то есть у вас особых у вас большой выбор ищите используется что вам нравится ну все мне все мы пишем на java script собственное выбор решения в так или иначе зависит от так и система в которой мы находимся на каком языке мы пишем какой стадии разработка нашего проекта находится и так далее готовы ли мы платить за него я в свое время ну я уже говорил что работы в mail.ru и работал над интернетом mail.ru долгое время это внутреннее мини социальная сеть для сотрудников сейчас я пишу мониторинг mail.ru нас около 20 тысяч серверов которые нужно постоянно опрашивать посмотреть что с ним не так что с сервисами не так который на них запущена и в общем то на проблему года четыре назад я посмотрела именно с позиции поэтому программиста основной стек у нас django для приложений и давайте посмотрим какие вот с этой стороны есть пути решения на самом деле они подойдут и разработчикам для других языков тыльной степени нас каким-то вариациями на первое это переписать все на синхронный фреймворк это не вариант конечно в большинстве случаев то что долго-долго так далее до для питона есть торнадо синкая если у нас приложение на них написаны то проблем нет 2 это джей энд кто не есть такая библиотека она капиталистов а вот вы знаете что джиллиан здесь такая библиотека который позволяет буквально одной строчкой коду про почти стандартный библиотеку питона и добавить возможность работать с большим количеством постоянных соединений за счет переключения грильято fda это такие зеленые потоки которые предоставляют библиотека g винт контекст между ними переключается в нужный момент когда там вот вывод происходит при чтении записи в соке то и за счет этого вот магия g лента позволяет вам писать real-time решение на питоне следующий способ тот engine souls 3 модель ну думаю многих проект находится за reverse proxy в том числе и джинкс сам популярно наверное в россии да и не только уже скорее всего engine слушатель модуль в принципе проверенное решение собираетесь engine с ним и у вас 2 and point одно чтобы подписываться на сообщение стороны клиента другой чтобы публиковать сообщения подключенным клиентом отдельно стоящей сервер да вот том числе центрифуга это отдельно стоящей сервер вы рядом со своим приложением поднимаете сервер он берет на себя вас работа с постоянным соединениями клиентов и у него есть теперь в которой вы публикуете сообщение когда вам это нужно соответственно этот сервер эти сообщения перенаправляют клиентам облачный сервис тут есть примеры например до кого-то real pleasure этого 34 программистом большей степени должно быть знакомо облачный сервис цепей самый простой способ наверное это пуш ярком по кнопкам вы платите им деньги пользуйтесь их сервисом и у них масса готовых библиотек и так далее ну единственно это дорого то есть например план кушаком это 500 долларов в месяц а вы получаете только 10000 максимальных пользователя онлайн которые могут сидеть параллельно оси дальше это у них уже за специальное предложение за больным за более крупную сумму и специфично для django вот совсем недавно это django channels проект скоро войдет в ядро джунгли в августе обещают превратить немножко сместить парадигму джангле сделает ее такими маркерами которые будут обрабатывать сообщения приходящие из промежуточного брокера и django научиться работать том числе все псаки соединениями на мой взгляд там есть небольшие концептуальные проблемы но они пока еще неизведанные на практике и может быть все будет хорошо работать такой долгий слайд теперь центрифуга вообще проект достаточно самобытный где-то четыре года назад мы захотели в интернет добавить поддержку real-time комментарию чтобы пользователи не обновляли страничку каждый раз и первое что мы сделали это написали демона на твист от который работал по протоколам с я sensors и столбиком be long polling он в принципе справлялся со своей задачей ты что в интернете нагрузка небольшая нас там три тысячи сотрудников ну из них 1000 онлайн но в определенный момент я подумал что я могу написать лучше с это султан дефекации с разными real-time фичами и так далее и так родилась центрифуга она изначально была написана питания на с используем фреймворк торнадо но буквально год назад я и приписал на языка и теперь это расти раньше называлась центре ключ то теперь это центрифуга вообще в докладе я про год не буду рассказывать если кто то думал что прага будет много то нет к сожалению но вот три основных плюса которые голодал проекта я вы все-таки назвал потому что до долга очень много на самом деле и первое это вот этот это производительность конечно же дана о чем еще говорить если ст язык активируется машины кот-то ну конечно будет быстрее там вплоть до 50 100 раз но и в зависимости от ситуации обычно но 20 точно для большинства случаев прирост будет но это мы говорим про питон непропай puy puy puy там немного другие цифры разницы будут далее go работает на нескольких кадрах из коробки до если мы знаем что python в частности торнадо это по сути асинхронный лук в одном потоке то мы можем добиться визировать 1 ядро из не подключать мульти processing или не ставить не запускать несколько инстансов на одном сервере одного процесса в город из коробки то есть он встроенные гуру тины свои раскидывает по имеющимся в системе ядрам за счет о том что берутся по ядрам и третий плюс гог который долга это то что на выходе сервер получается одним исполняемым экзешником бинарным файлом воды под все платформы доступные то есть мы можем костра скомпилировать центрифугу на любую машину с любой машины да то есть я вот под маком программирую и я собираю релиз центрифуги под винду да у меня будет получать центрифуга экзо и так далее то есть вы под все под linux под macos подарен вот три плюса да давайте дальше и теперь вообще как работает центрифуга и вот на примере этой схемы вообще вот до к окошку браузер ie mobile чик это клиенты приложения в зеленом квадратике это backend приложение а соответственно в синем это центрифуга не знаю видно что он синий но он синий был соответственно когда клиенты заходят на страничку сайта либо просто заходит в приложении backend отдает им контент изначальный вместе с контентом он отдает им специальные параметры подключения типами подключения используется клиентами в дальнейшем чтобы установить постоянное соединение с центрифугой используется либо чистой websocket и либо 40 джесс библиотека который я говорил хотелось бы еще раз подчеркнуть важность пока сок джесс потому что например он позволил нам в mail.ru написать игру когда люди приходили в зал со своими устройствами с мобильниками с планшетами и подключались к игре и получали real-time сообщения абсолютно все то есть ну ни у кого не возникло проблем и что ребята у нас сообщение не доходят благодаря 40 джинсы в принципе когда мы смотрим логи у нас еще не все на websocket ах правда статистике конкретно на нашем проекте нет сколько процентов но и все кто сидят и так твой как только клиент и подключились и backend приложения узнал о каком-то новом событии он публикует это сообщение выпей центрифуги она уже далее это сообщение перенаправляет заинтересованным клиентам слова заинтересованы очень важно и потому что ну конечно мы все события всем клиентам не шлем поэтому есть концепция каналов по сути это строка на который подписывается клиент когда заходит когда под подключается центрифуги и соответственно центрифуга знает каким клиентам какие сообщения нужно рассылать из всего этого вытекает первый плюс это простота интеграции существующим приложениям это действительно просто потому что в отличие от многих других инструментов доступных центрифуга не зависит от языка на котором написано ваш backend да нету тесной интеграции которая может стать критично и в некоторых случаях например если вы пишется очень очень сложно real-time приложение например какую-то игру мультиплеерная динамичную тогда действительно важно тесная интеграция real-time провайдера и бэг-энда но во многих случаях это не нужно а центрифугу позволяет получить real-time просто просто используете браузер я думаю здесь вот код мы с код который использует java script клиент центрифуги естественно мои java script and стандартным способом импортируем и странички в браузер и создаем объект создаем объект подключение вот здесь как раз те параметры подключения о которых я говорил застрять на них внимание не буду просто скажу что есть определенные данные и the user is ready до пользователь вашего приложения опциональный и все все они подтверждены чем а кто кеном который генерится на основе секретного ключа на вашем бренде подробнее документация можно посмотреть будет естественно как только мы инициализировали объект мы можем подписаться на канал в данном случае этот канал news и в копейки обработать сообщение которое из этого канала придет достичь про знакомы вот мы подключаемся непосредственно думаю многие из вас видели точно такой же код большинстве про пса просто решений как я уже говорил себе фугу планировалось с некоторыми real-time особенности мне вот тут перечислены как раз эти особенности у нас есть такая информация какая-то какие пользователи в данную секунду находится в канале да но самая прямая аналогия это кто в данный момент в комнате в чатике сидит собственно вот это называется presence информация далее мы можем получать событие о том что кто-то вошёл в комнату кто-то вышел из комнат оля ну то есть не в ком-то в канал это джон лив события так называемая центрифуга также в течение какого-то ограниченного времени которое вы конфигурируете настройках хранит историю сообщениях каналах и конфигу лица не только время хранения но и максимальный размер это история хранит в памяти за счет вот этой истории есть такой механизм это recovery механизм восстановления пропущенных сообщений если произошел disconnect как кратковременной то центрифуга может дослать сообщению пропущенные в канале сообщение когда он пири-пири подпишется на него так же есть разный тип каналов 1 тыс типа каналов есть но тоже про них не буду сейчас долго рассказывать тоже есть документации еще особенности которая ее отличают и являются плюсами это возможность масштабировать инстанса центрифуги на несколько машин для этого используется редис движок да то есть по умолчанию центрифугу на одной машине одну ноту можно запустить без редиса но все-таки подключение клиентов нужно как-то балансировать поэтому запускаете с редисом и релиз будет связующим звеном между инстансами центрифуги соответственно regis такой архитектуре единая точка отказа поэтому центрифугу поддерживает официальный способ как добавить был ability кризису редис сентинель здесь есть один небольшой минус соответственно пока не работает центрифуга среди с кластером естественно производительность центрифуги сейчас упирается в производительность вот этого 1 инстанции редиса на то есть на на самом деле несколько причин во-первых редис кластер не умеет масштабировать pops up пока что то у них есть и шью возможно скором времени это справиться во вторых пока ни у кого таких требований не возникало то есть по идее можно шарди рование сделать да и использовать несколько инстансов редиса либо реплики для того чтобы скрылись pops up но пока таких запросов не было от пользователей и в принципе 1 инстанса хватает большинство проектов но потому что это 100 тысяч сообщений в секунду пропускная способность попса придется так грубо до этого пока никто не дорос том же интернете у нас 300 сообщений всего лишь секунду публикуется то есть совсем не что метрики для мониторинга уже есть встроенные the phone info наладок сколько сколько было сообщение опубликовано сколько раз разослано подключение клиентов все это можно экспортировать через ebay уже есть готовый армиям deb пакеты докер то есть вы можете просто взять использует центрифугу но и опять же я упомянул что большому счету чтобы с ней поиграться достаточно скачать один файлик и это запустить его а это будет сервер есть административный веб-интерфейс вот тут есть картинка из него он позволяет посмотреть текущие настройки в сообщения времени поиграться с опять опубликовать сообщение в канале в канал выполнить другие команды там произнес посмотреть историю сообщение так далее написанный react ну и сейчас центрифуга это уже не просто один на отдельный сервер на самом деле это организация hydrowhey там есть в том числе и тебе библиотеки готовые для 5 языков сейчас нас ищет библия библиотекам достаточно просто потому что это буквально 100 строк кода на любом языке и и у вас есть api клиенты степи то есть если вас не устраивает даже то что там есть бетонную руби печь фиговина джесс клиенты можете переписать на то что все таки описал каждый из них сам кроме руби и печки и вот где нибудь нигде не идиоматика написать чуть сложнее с клиентскими библиотеками но потому что они должны уметь работать просадку с протоколом центрифуги но они уже есть для браузера стресс нас взрыва скриптовый клиент для ios и для android совсем недавно закон требовать или ребята из open source сообщество так что можно подключаться по вебке там из мобильных устройств в том числе и из листов на приложений тоже можно поискать там работать и на самом деле здесь я не написал но есть и go клиент то есть вы можете из go работать центрифугой это ссылки на проект на самом деле проще нагуглить центрифуга real-time и вы найдете сеть ссылки и в принципе все кроме использования до в mail.ru центрифуга используется в 5 проектах 32 из них внешних три внутренних это вот мониторинг интернета которых я говорил это сертификация mail.ru еще в технопарке в техносфере в проектах для часиков в основном в интернете использования чуть шире мы там и игры делаем и реальном времени таблица переговорных обновляем счетчики лайки за идеи и так далее был интерес ну соответственно используется в некоторых проектов по всему миру не вписали неоднократный был интересный опыт audi winard если кто то знает это сайт достаточно крупное входит в алекс топ-250 они в тестовом режиме запустили центрифугу на 50000 пользователей онлайн в принципе она у них нормально работала но потом это все погрязло в бюрократии так что пока до продажи туда продакшна не доехала к сожалению такая история и принципе на этом все надеюсь вы найдете применение у себя спасибо вопросы здрасте спаси большая за доклад скажите пожалуйста если возможность отсылать адресованные сообщения то есть канале на путь допустим находится 10 человек который сообщения одному из них чтобы останетесь не выберем но по большому счету вы все это может сделать на уровне каналов даты создает специальный канал для каждого пользователей только этот пользователь получит сообщение то есть каждый из этих 10 человек подписывайтесь на свой канал а если человек десятки тысяч только ждут десятки тысяч каналов до кучи до десятки тысяч каналов получается прошло realflex ра такая возможность есть насколько я помню приводили там пример ну а не так или иначе все нож должны как-то разделять кому отсылать это тоже наверняка на уровне каналов делается нет ну я думаю так везде да ну это эти сообщения соответственно хранятся в единой точке то есть не каждый клиент имеет свой буфер с пропущенным сообщениями да то есть но они до вают много сообщений но история ограничено по размеру в первую очередь размер сообщения ограничен и очередь каждого клиента ограничено по умолчанию мегабайтами то есть их начнет отрубать через какое-то время надо но во первых 10 мегабайт можно уменьшить до другой цифры во вторых adidas все-таки не застрахован мне кажется никто из маленьких проектов там может быть mail.ru яндекс застрахован от деда со все остальные упадут от а.б. то есть можно потратить на газ сайт любой и они рухнут но так защита есть вы можете ее как-то scaife говорить за счет изменения размера истории за счет изменения быстро каждый клиент но если просто настроить буфер каким-то образом чтобы он ограничивал размер мы конечно не уроним серверов таза не сожрет все ресурсы тогда легитимные пользователи пострадают для них сообщение будет теряться но все на компромиссе в принципе разработки построены не серебряные пули да скажите пожалуйста есть сказать пожалуйста если возможность разделения прав доступа к каналам или если клиент получил то окон подписанный то он может подписаться на любой канал подобрав имя вообще с правами доступ на канал дается это очень интересна тема это относится вот к разным типам каналов которых я не стал говорить во-первых есть каналы ограниченные payday озеро да то есть если в имени канала есть специальный символ решетка в данном случае существа тревоги и потом идет айдишник юзера то только этот юзер сможет подписаться на этот канал и средстве найди юзера подтвержден токи ну вот изначально поэтому мы доверяем далее есть приватные каналы это по если кто-то пользовался пушер кому них как раз такой же механизм приватные каналы когда пользователь подписывается наплевать на канал делается дополнительная к запрос на backend приложение и этот запрос должен быть подписан секретным ключом лучше в документации посмотреть как у центрифуги так и в сервисе кушаком механизм одинаковой и также принципе многие используют для приватных каналов просто какой-то секретный хаш генерируем на второй язык нас сгенерировали сгенерированный на основе зайди какое-то ледокол секретного ключа к который трудно подобрать то есть это решение конечно не самое надежное но на практике она многие его применяют том числе и советует ios разработчики сайта по кнопкам спасибо спасибо за доклад скажи просто если возможность вот из коробки со стороны сервера узнать о факте доставки сообщения это клиента нет такой возможности нет нужно дополнительно отсылается клиента на backend подтверждение добрый день подскажите если возможность как-то мониторить состояние подключения от клиента до центрифуги соответственно что значит станет подключи ну то есть как паять гарантированно что мы имеем конечно клиент уходит в офлайн уж нему куда-то где нет связи как мы можем понять но по сути центрифуга работ по принципу что мы создаем непрерывный стрим сообщений клиентом до в нужный канал то кто их получит или кто их не получит уже зависит от того кто в данную секунду подключился к приложению или и если клиент оффлайн то он соответственно это сообщение не получит а мониторить можно вы можете спросить его центрифуги кто в данную секунду vk0 но это ничего вам не даст потому что через мгновение он может уйти из канала соответственно сообщение тоже не дойдет спасибо вообще модель доставки сообщений от мост vans то есть максимум она дойдет один раз но может не дойти скажите у вас работа с центрифугой моего приложения может быть только по этой почте без или я могу например как британский модуль подключить его тонкий модуль не можете но может публиковать сообщения через за очередь в одессе то есть до на секунду только такая альтернатива есть да только релиз ну потому что regis используется как один из движков соответственно было легко добавить это кладете сообщение 8-10 центрифуга прочитает и отправит но для есть свои нюансы на самом деле потому что очередь в одессе нужно разбирать во время и если какое-то время пройдет а центрифугой сообщение не заберет по каким то причинам то могут потом достаться уже не актуально и сообщение в случае сыщики запросам такое суп проблема нет то что любом зафейлил сеточки запрос и тогда вы ретро делаете если нужно в среднем очереди по сложней спасибо александр спасибо за доклад такой вопрос фигурировал цифра 100 тысяч сообщений секунда это редис а это именно ради баб на сколько может сервер в центрифуге держать коннектов одновременно зависит от железа настроек как тюнинга сервер и так далее но 50 тысяч на один инстансе думаю вы можете посадить на современном железе одновременно коннектор до connect клиент на самом деле то есть мы проскакивали статьи что ее миллион сажают на года но это бесполезный по сути случай когда у нас висят миллион коннектов о моем сообщении с целым в течение 5 минут одно сообщение то есть но поэтому исходя из практических соображений все-таки нужно балансировать на другие надо для того чтобы создать канака высокий необходим кончик там где-то сколько 23 запроса наверняка как вы тестировали ли вы проводили нагрузочное тестирование центрифуги если да то как смесь марками не учится хорошо пока потому что руки не доходили а но нужно будет сделать но в целом вот девин арт у них 50000 онлайн соответственно программист отрубал центрифугу потом включал центрифугу и и 50000 reconnect of у него случалось за 2 секунды и это ну instance на амазоне стандартный выдерживал это вот но a bitch марки надо будет делать cs cs и websocket а также с себя включает websocket и т.п. и так далее но разные за рамки улетала что публиковать новые сообщения но на самом деле можно сделать можно сделать но реально в пользователи не было как бы для кого тогда я буду это делать если их низкой цене спасибо большое"
}