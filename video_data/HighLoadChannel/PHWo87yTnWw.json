{
  "video_id": "PHWo87yTnWw",
  "channel": "HighLoadChannel",
  "title": "Рецепт идеальной разметки в Computer Vision / Карина Кванчиани,  Александр Капитанов (SberDevices)",
  "views": 236,
  "duration": 2039,
  "published": "2024-10-29T03:08:36-07:00",
  "text": "Друзья давайте тепло встретим Карина ванни Бер девайс так всё стой стой погоди ещё представлю ты не одна к нам пришла да Тебе будут помогать Кто будет помогать Да поможет мне Саша капитанов ответить на вопросы доклад расскажу одна всё да то есть у нас вот такой вот парно непарный доклад Карин собственно поехали а так Всем привет ещё раз доклад будет посвящён фреймворк агрегации разметки которое разработала наша команда и мы сами и соседние команды в девайсах им пользуются для того чтобы получать идеальную разметку для компьютер Vision задач с краудсорсинг платформ а стоит сказать что совсем скоро фреймворк будет доступен в открытом доступе Поэтому думаю что многие из вас кто Кто занимается данными смогут найти а что-то для себя в этом полезное а кратко пробежимся по плану я сперва расскажу Для каких проектов мы создавали наборных данных и собственно Почему остановились на краудер этих данных а после перейдём к основной части расскажу про методы агрегации разметки они как раз-таки составляют основную часть фреймворка а схемы общий пайплайн и то как они собственно проектировались Ну и в конце пройдём полный путь от данных с крау к идеальной разметке расскажу как с помощью фреймворка её получить А и расскажу как сделать её максимально правильной с помощью подбора гипер параметров А давайте начнём За последние полтора года наша команда создавала наборы данных для трёх основных проектов во-первых это видеоконференции J во-вторых кандинский генерация картинок по тексту И третье - это наш собственный проект распознавание русского жестового языка небольшой офтоп завтра в 17:00 в главном зале ребята Саша капитанов Саша Нагаев расскажут про собственно распознавание русского жестового языка Приходите посмотреть очень нетипичная задача думаю многим будет интересно ну ирм к вообще фреймворк агрегации разметки начинался проектировал с набора данных Гри самый большой набор данных жестов и размещался он боксами для задачи детекции а вторым набором данных который также повлиял на фреймворк был E портрет здесь уже разметка в разы сложнее размещен он сигн масками для решения портретной сегментации и фейс парсинга А и третий набор данных состоит он уже из видео и размещен временными интервалами то есть каждое видео содержит жест человека который показывает жест на русском жестовом языке а и собственно временной интервал - это начало конец жеста А ну и перед тем как я расскажу про сами методы агрегации разметки сперва поясню Почему вообще мы остановились на краудер какие вообще Есть основные способы разметки в CV А самый такой примитивный быстрый и дешёвый метод разметки в компьютерном зрении - это нейронные сети Аа но здесь есть два но собственно во-первых это а не всегда точная разметка как минимум из-за этого то есть какие-нибудь очевидные примеры где человек никогда не допустит э ошибку нейронка может предсказать неправильно и конечно это потом повлияет на обучает что стоит помнить Если вы размещаете данные с помощью нейронной сети и она делает это хорошо то собственно встаёт вопрос Зачем тогда вообще нам нужны данные если у нас уже есть сетка которая хорошо предсказывает этим данным метки Ну и собственно на этой ноте перейдём к ручной разметке и я её делю на несколько типов во-первых это разметка с помощью экспертов обычно таких людей Очень немного И если мы размечаем какие-нибудь очень большие данные то такой процесс Может затянуться там на полгода А может быть год э вот а также это достаточно э дорого но стоит сказать про качество Разумеется из всех типов кото про которые я расскажу здесь качество самое высокое а но тоже стоит всегда помнить про человеческий фактор когда людей мало данных много спустя несколько тысяч сэмплов а люди начинают ошибаться даже в самых примитивных случаях а перейдём к Крауд здесь Разумеется процесс разметки ускоряется в разы дешевеет тоже в разы но качество тоже падает Ну и небольшой спойлер А собственно методы агрегации создавались как раз-таки для того чтобы пофиксить э качество разметки на краде и в принципе привести его к тому виду который будет близок по качеству к разметке с помощью экспертов А может быть иногда даже и лучше а и такой самый обычно очевидный вопрос зачем создавать там методы агрегации разметки если разметку с крада можно просто про модерировать но стоит помнить что вообще обычно модерация производится с помою экспертов которых Мы помним что их очень мало то есть этот процесс опять-таки увеличивается в разы по времени а становится дороже Разумеется качество выше опять же стоит помнить про человеческий фактор Ну и на этой ноте переходим к методам агрегации разметки а Но сперва небольшое введение в краудсорсинг А вообще такой Одной из главных фичей краудсорсинга а является перекрытие то есть мы свои данные можем разметить с помощью нескольких разметчик То есть каждый сэмпл данных может быть размеченный са агрегировать обычно это для задач классификации делается с помощью типичного мнения большинства и уже получить э итоговый более уверенный ответ А ну в котором мы будем уверены больше чем если бы мы этот сэмпл размечают Ну и здесь как раз-таки встаёт вопрос Окей с классификация понятна всё легко мнение большинства работает отлично А что делать когда у нас разметка боксами масками ки понтами и так далее собственно встаёт вопрос Как нам привести несколько разметок в одну итоговую разметку Даже несмотря на то что в этой разметке Ну которая пришла с крада могут быть ошибки ошибки там всегда есть имеется Вот такая главная сложность вот этих методов агрегации - это правильно обработать ошибки А собственно начинали мы проектировать методы как раз-таки с анализа ошибок и Давайте посмотрим какие были основные при создании трёх ранее описанных наборов данных а начнём с разметки хагрида размечают было выделить а Каждую из рук собственно боксом Ну и ошибки здесь на самом деле достаточно примитивные для этого типа разметки То есть это там неправильное местоположение бокса неправильная метка пропущенный бокс вообще какая-нибудь рандомная разметка А и такое на самом деле на краудер уметь правильно обрабатывать а что касается масок здесь на самом деле самый такой самая популярная ошибка разметкой маска Ну и тоже перепутанная пропущенная маска и не выделенный объект Ну или что-то опять же рандомное А ну и последний тип разметки - это разметка с помощью временных интервалов на самом деле Здесь всё плюс-минус тоже самое как и в боксах а то есть это там неправильное местоположение метка пропущенный интервал Ну и последний случай - это когда у нас на видео два каких-то действия происходит а Но человек выделяет это одним интервалом а ну и после анализа ошибок перейдём к вообще общему пайплайн и состоит он из нескольких вещей а первое разметка всегда попадает в метод который называется хар агрегации а кратко расскажу о нём а его цель проверить всю разметку с крада для какого-то одного сэмпла насколько они между собой согласованы для того чтобы впоследствии привести её в итоговый вид и для того чтобы проверить Вот эту вот согласованность мы задаём следующие вопросы во-первых мы проверяем чтобы все полученные нами разметки были имели одинаковое количество боксов далее мы делим боксы на группы потому что вот наме вот эти вот нет никакого смысла рассматривать вообще кучей и логичнее их делить сразу же на разметку для каждого отдельного объекта Ну ну и делается это с помощью методов кластеризации и дальше все остальные условия уже будут накладываться на каждую группу по отдельности а группами здесь являются вот Верхняя Нижняя там с голубы голубая и Зелёная Нижняя а Следующий вопрос проверяем уже количество боксов в каждой из групп А здесь поясню что первое условие может не сработать в этом случае просто как минимум потому что разметчик может не там нарисовать бокс и тогда у нас в группе окажется меньше боксов А чем должно было а вот а дальше идёт проверка на метке в каждой группе должна быть одна и та же метка потому что одна группа соответствует одному объекту на картинке Ну и последнее мы проверяем всю разметку между собой с помощью Inter Reunion сравниваем её с трешхолд и после если она через трешхолд проходит то мы можем просто усреднить координаты боксов и получить очень уверенный ответ пара слов про Reunion кто с ней не знаком это Метрика которая проверяет две разметки между собой насколько они идентичны то есть по сути мы просто берём пересечение там боксов масок ещё чего-либо а и делим это значение на их объединение а давайте тоже пробежимся по хар агрегации для интервалов здесь в принципе учитывая тот факт что ошибки А плюс-минус те же самые что и в боксах алгоритм будет плюс-минус тот же самый проверяем на количество делим на группы единственное здесь метод кластеризации будет вместо 2D 1d проверка в каждой из групп на количество проверка на метки и проверка на Inter of Reunion Ну и перейдём к самому сложному к сегментацию а и здесь всё чуть сложнее Но на самом деле всё немножко легче в самих методах Сейчас объясню почему вообще каждый объект на картинке с помощью синх масок может быть размещен по-разному Но это будет правильно То есть это может быть там две маски отдельные Может быть одна маска может быть вообще 10 но если мы а всё это вместе их сложим и получим какую-то уже целостную маску то она в принципе может быть верной А это всё к тому что А здесь нельзя каждую отдельно размеченный то А собственно поэтому хар агрегация для масок выглядит вот таким вот очень простым образом то есть мы просто проверяем на Inter Union А что у нас происходит если разметка через карт агрегацию не сегрегированный просто проверяем разметку на то что возможно кто-то один в разметке ошибся допустим у нас было их четыре и кто-то один из разметчик накосячил тогда мы просто проверим комбинации три из четырёх насколько они проходит через хар агрегацию и как бы если всё агрегирующие а ну и переходим вообще к самому интересному Что будет если у нас разметка не прошла че не через хар не через дроп агрегацию значит там уже точно не одна ошибка их несколько А в таком случае мы применяем Более сложный метод Называется он софта агрегацией А в чём суть суть в том что мы уже знаем что там есть ошибки и мы хотим привести эту разметку в такой согласованный вид чтобы после софта агрегации она прошла через Хард агрегацию потому что Хард агрегация она нам вообще гарантирует там стопроцентную уверенность в качестве разметки А потому что все условия жёсткие и с ошибками через неё пройти трудно а также рассмотрим для каждого типа разметки по отдельности а сперва мы вообще избавляемся от мусорной разметки То есть если это боксы то мы удаляем слишком маленькие а которые не могут содержать какой-то объект в себе а и удаляем дубликаты а далее мы уже как в хар агрегат делим разметку на группы А И здесь уже удаляем те боксы которые не попали в какую-нибудь из групп вообще а думаю что многие задаются вопросом почему мы как-то здесь вообще модифицируем разметку с чего мы взяли что так вообще можно было а Суть в том что мы вообще вводим такое понятие confidence в разметки хагрида он был равен 07 и для того чтобы считать группу полной и уверенной и чтобы мы были уверены в том что бокс находится именно там А мы должны насобирать в эту группу как минимум 70% боксов от всех то есть допустим нам пришло пять разметок и группы мы можем считать полной Если там будет четыре из из пяти бокса Т из пяти 60% нам этого мало Мы уже менее уверены в том что бокс именно там где эта группа А собственно как-то так поэтому мы в принципе можем делать вывод что те боксы которые себе группу не насобирали там один-два Бокса а мы можем просто от них избавиться потому что вероятно разметчики которые их нарисовали они просто ошиблись а идём дальше меняем метки неправильные на правильные А как понять что метка правильная мы смотрим на каждую из групп а там э напомню метка должна быть одинаковая потому что это один объект и собственно если там метки разные то мы можем просто заменить метку меньшинства на метку большинства Ну и здесь я тоже поясню что мы большинством здесь считаем не 50% как это принято а тоже 70% для того чтобы увеличить итоговую точность разметки всё уже получаем группы с едиными какими-то метками и напомню цель привести разметку в такой согласованный вид чтобы она прошла через хар агрегацию но для этого группы нам нужны полные То есть если разметок было пять то там должно оказаться пять из пяти боксов Но на этом этапе могло оказаться Так что там четы из пяти боксов Поэтому собственно мы а добавляем пропущенные боксы и делается это достаточно Просто мы просто берём все боксы которые уже в группе есть усреднять их координаты и добавляем этот бокс в группу Разумеется ответ от этого никак не поменяется А после всего этого проверяем разметку на харта агрегацию Ну и если она не проходит то а смотрим на комбинации как в дроп агрегации а давайте то же самое пробежимся быстро про кликаю про софта агрегацию для интервалов опять же всё плюс-минус то же самое то есть избавляемся от интервалов которые там слишком маленькие или дубликаты а делим на группу удаляем те интервалы которые ни в какую группу не попали заменяем метки А и добавляем пропущенные интервалы тем самым приведя её в более консистентные вид между собой а проверяем на харта агрегацию проверяем комбинации если мы не прошли с помощью всех разметок а и собственно всё а что касается сигна Сион их масок опять же здесь всё немножко проще потому что мы каждую отдельную маску не рассматриваем как отдельную сущность А и по сути софт агрегация для масок - это просто комбинация хард агрегации и дроп агрегации А что происходит если у нас разметка не прошла через софт агрегацию а вообще обычно таких разметок Очень немного а здесь их можно либо дометик Уде тем самым увеличив там уверенность в разметке и возможно она уже через эти методы пройдёт А можно выбросить её потому что разметчики там очень много ошибаются значит может быть с картинкой что-то не так А ну или посмотреть глазами потому что обычно там где ошибаются это более Такие интересные примеры и всё-таки а может быть важно чтобы модель предсказывала на них верно А ну и перейдём к э собственно фреймворк как это всё может работать а и посмотрим мы это на примере боксов А обычно разметка с крау приходит плюс-минус вот в таком формате то есть мы знаем имя картинки которая размечаем потом принять или или Отклонить разметку на краде тем самым заплатив за неё или не заплатив А и собственно в третьей колонке сама разметка То есть это координаты боксов и лейл для каждого из них а задаём параметры здесь это confidence про который я уже говорила 70% а трешхолд - это порог для intersection Over Union а далее метод кластеризации и параметры для него и два трешхолд для того чтобы там боксы маски интервалы А и собственно вот эти вот два Треш колда а загружаем данные указываем обязательно функцию процессинга потому что с разных Крауд платформ приходит разметка в разном виде обрабатывать её нужно по-разному а и собственно получаем список групп одной группой считается разметка для одного сэмплов данных то есть мы знаем для неё название этого сэмпла и в Data записан список разметок для неё полученных Ну и разметка представляет собой координаты боксов метку и собственно дишни разметка Ну и дальше всё очень просто мы инициализирует агрегации указываем там метод кластеризации его параметры и собственно получаем результаты Get по сути это просто последовательное применение э методов про которые я говорила там допустим мы взяли разметку попробовали через р агрегацию прогнать если у нас не получилось пробуем дроп агрегацию если не получилось софт и если не получилось то записываем результаты в для того чтобы потом у нас была возможность там потники сегрегированный для каждого из методов для того чтобы собственно тюнить параметры и находить самые оптимальные Ну и Давайте посмотрим как это всё может выглядеть для хар агрегации Всё достаточно примитивно никто не ошибся по сути мы просто взяли кучу боксов усредни координаты и получили итоговые что касается дро агрегации здесь уже и слева и справа на примере видно что а какой-то один из разметчики нарисовал бокс там где на самом деле кисть руки полностью не видна А и собственно мы её удалили и уже с помощью хар агрегации опять же смогли а привести разметку в хороший вид а что касается софта агрегации здесь уже например э слева на картинки уже два человека нарисовали бокс там где его не должно быть а-а Почему собственно дроп агрегация с этим не справилась Ну и справа пример где вероятно там разметки не проходили по интерс юниону тоже пришлось где-то удалить и так далее и уже а получить хорошую разметку Ну и перейдём к самому интересному проанализируем те примеры которые у нас не са агрегировать и что с ними делать возьмём вот такие вот два здесь в принципе очевидно Почему так вышло там а слева на картинке у нас там вообще есть перепутанная метка а слишком большой бокс и вправа то же самое то есть слишком большой бокс разметка вероятно просто не прошла через Inter Reunion и вот когда мы посмотрели на эти картинки И поняли В чём примерно может быть дело мы А можем как-то поменять параметры и всё-таки попробовать её привести к итоговому виду а напомню какие были параметры это 70 для конденса и 65 для трешхолд И тем самым мы можем в принципе сегрегированный пятидесяти Аа тоже видим что получилось уже сагре ировать первую разметку тоже и в принципе выглядит это всё неплохо поэтому Аа тоже может э помочь при привести эти разметки которые зафер А к чему это вообще всё было к тому что а для каждой задачи параметры они будут разные для того чтобы сделать размет Ну агрегировать как можно больше примеров вот как-то так на этом в основной части У меня всё А я немножко расскажу про стенд Приходите пробовать разные штуки в частности там есть распознавание как раз-таки русского жестового языка можно пообщаться с команда гата и поспрашивать всякие интересные вещи Вот и последний слайд здесь можно проголосовать за доклад и вверху есть ссылка на Telegram канал команды там делимся всякими своими наработками иногда вакансиями вот Подписывайтесь ставьте лайки Всё спасибо Давайте по аплодирую Карине а очень классно вопросы задавайте поднимайте руки да есть вопросы и доклад тоже оценивать Карине будет я думаю очень приятно Спасибо тем более Open sce Да пожалуйста Да спасибо большое за доклад достаточно Интересно у меня такой вопрос всё-таки пользователь э разметки - это нейросеть на которую учен Ну итоговый И вопрос такой пробовали вы взять просто обучиться на вот такой вот разметке непонятной и сравнить с тем что вы там получили на улучшенной разметке вашими способами и насколько там идёт отличие между между Каст Да я поняла очень хороший вопрос Я вообще уже не знаю несколько месяцев ищу время попробовать это сделать И обязательно сделаю Пока нет руки не дошли Вот но Согласно очень интересно так ну это претендент на лучший вопрос да сразу сразу так Ага Привет Спасибо большое за доклад было очень интересно у меня два вопроса Первый ну оба посвящены параметрам один - это конкретно про параметры для вообще достаточно нестабильная Метрика особенно чувствительная к размеру мы это на картинке видели что как бы если объекты маленькие то скорее всего шно уровень надо понижать потому что любое изменение в пикселях очень сильно на него Влияет И вообще пробовали какой-то его адаптивной делать в зависимости от того там от размера объектов которые нам сегменти ет или детектива или что-то в этом духе А вообще мы хотим в будущем ещё реализовать для каждого из объектов отдельный трешхолд то есть там для каких-то больших можно подобрать его побольше для каких-то маленьких поменьше Ну и в принципе адаптивный тоже в планах вот как-то так Да и можно второй быстрый вопрос по поводу как раз таки тюнинга параметров под задачу То есть ты сейчас показала там что мы посмотрели два примера понизили трешхолд и вроде стало лучше но кажется это надо на какой-то Большой выборке делать то есть параметры тюнить это как вообще происходит Да да конечно то есть по сути ну здесь в от времени человека который уже пользуется фреймворков Ну Чем больше тем лучше Понятно Ну и на самом деле наверное лучше тюнить параметры уже только вот на оставшихся примерах а не на всех которые уже хорошо са агрегированные высокими параметрами А и Ну да можно посмотреть на много Ой спасибо Так ладно если у кого-то есть вопросы поднимайте руки так А я хотел спросить нем Open sce это как он называется agate понят То есть он так и будет называться и вы его куда-то выложите себе на и напишите пару статей как Да думаю так и будет пни класс так пожалуйста у меня такой вопрос вот разметка кистей рук - это достаточно простая задача для разметчик то есть ну мы все можем понимаем что такое кисти рук а вот более сложных задачах вы не пробовали оценить применимость вашего фреймворка то есть вотт с ракетками и которые летят куда-то вверх вот насколько скажем применение алгоритма приближает стоимость разметки и время разметки к использованию эксперта Ага поняла Ну вообще вот такой самый сложный метод разметки это вот маски на самом деле это было очень сложно для крада и мы пробовали на самом деле и на краде и с помощью экспертов Ну если там экспертами это та Ну несколько месяцев там может быть даже четыре если все данные размещать а там 40.000 картинок А то всё-таки даже Крауд с перекрытием там 3 тире п это было быстрее вот и в принципе для такого достаточно сложного типа разметки всё неплохо сработало Ну для масок там в принципе всё Попроще а если говорить конкретно для боксов то мы здесь обязательно потестить там например для каких-нибудь задач с распознаванием машин где они там все пересекаются здесь уже сложности там в выборе там ну метода кластеризации как минимум аэ Вот Но в планах по тестим конечно это не проблема если в этом был вопрос да спасибо Угу Так давайте Пойдёмте с правой стороны теперь А так Карин ты лучший вопрос думаешь Да я думаю об этом Карина Спасибо большое за доклад такой вопрос по поводу Ну вот будущего Open Source фреймворка мы видели те параметры которые были в презентации Ну там confidence ш Hold и так далее ну и несколько методов там Hard Soft отбросить и так далее а будет возможность может быть не сразу в будущем в этом фреймворке потютьков то что можно их не внутри как-нибудь переписать а именно порядок поменять может быть и немножко внутри ну зависит от того как будет отрабатывать скажем так Ага вообще мы в принципе планируем его постоянно там улучшать и так далее ориентируюсь в том числе на пользователей То есть это не проблема по поводу порядка это в принципе ну то есть минутное дело Там просто по сути функцию Get переписать свою и всё А по поводу методов Это хороший вопрос ээ думаю что почему бы и нет то есть для каких-нибудь популярных задач если там а-а пользователь предложит какой-то более хороший вариант для там Хард или софт агрегации то почему нет можно впились другим командам дадите что ещё раз контрибьютор командам дадите Да доди понял Спасибо Да но в этом суть он сорса ты можешь контрибьютор вопрос В крайнем случае форк и всё так ещё какие-то вопросы есть вобще фича влок Мне кажется такая потенциальна Да так всё вопросов нету Карин тогда давай кто тебе больше понравился Давайте последний последний так всё Значит ты получаешь от нас приз вот Саша я так понимаю его вручает Саш анонсирует я к сожалению немножко при поэтому заня на вопросы ответила У нас есть небольшой подарок от Devices это маленькая мини колоночки есть правильно от спонсоров от онтика так да пожалуйста Да вот парень у которого два вопроса было у которого два вопроса было просто числом Подними руку ты да правильно всё забру Форса так друзья Карин тоже для тебя есть подарок у нас тут много подарков в общем ребята тоже вручат друзья Давайте ещё раз попло и ловите Сбер девайсов в кулуарах Они вот в красивых маечка зелёных наверное этот цвет называется голубой мы будем да СН Сбер девайсы девайс на карте найдёте Приходите Всё спасибо большое Y"
}