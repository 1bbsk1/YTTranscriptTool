{
  "video_id": "EHABzlUYOZk",
  "channel": "HighLoadChannel",
  "title": "Использование очередей асинхронных сообщений с PostgreSQL / Илья Космодемьянский (PostgreSQL)",
  "views": 3547,
  "duration": 2861,
  "published": "2017-04-28T04:21:05-07:00",
  "text": "илья космодемьянский расскажет о наиболее востребованных паттернах использовании асинхронного масса дженга в связке с базой данных postgresql и о существующих реализациях очередей сообщений илья бросим на сцену я работаю в компании пуск резко консалтинг мы занимаемся собственно репост гриссом очень плотно и сейчас вот расскажем о такой стороне применения которая наверно при росте какой-то там нагрузки на проекте очень актуально становится но во первых предпосылки откуда вообще идея очередей и помимо очередей еще и база данных одновременно во первых ну чем хорошо очереди что сразу вспоминается когда люди начинают говорить про очереди бывает синхронный подход бывает подход асинхронный когда мы берем и производим какое-то действие вызван какой-то там абстрактно функции акулами и дожидаемся ответа это синхронный синхронное действие это хорошо потому что очень удобно на самом деле это все обслуживает удобно разрабатывать такой код все очень просто но проблема в том что у нас мы проводим много времени в ожидании то есть у нас ждем ответа от какого-то компонента которые мы вращаемся сохранна поэтому хотелось бы сделать так отправить задание и забудь просто как мы отправили задания подождать посмотреть ну и там каким-то образом уже дальше среагировать когда мы говорим про я синхронную очередь нам нужно сразу иметь в голове несколько понятий которые обычно сопутствуют этому делу ну во первых что такое что собственно гри делает очередь очередь передает месседжи мы защитника и сообщение то есть некая такая вещь оторванная да это небольшой resort цвет который там за каким-то образом это какая тут конечно я вечно набор данных там не знаю какой нибудь найди что-нибудь там еще какой-то там текстовое поле какие-то там служебная информация какие-то даты есть сообщение есть каналы выражаясь в принятых в мире джинки терминах это собственно говоря тот тот функционал который позволяет нам отправлять вот это самый message то есть они долго друга отдельно не существуют как только у нас есть канал и у нас есть мы начинаем сразу хочется сделать что-то интересное а именно как-нибудь перекидывать сообщение из одного канала в другой канал как-то развитую делать какие-то хитрости и тогда у нас возникает роутинг а там где возникает роутинг становится актуальной задача каким образом собственные маршрутизировать как отличать сообщение которые нужно маршрутизировать так от тех которые нужны more фрезеровать иначе и у нас возникают фильтры или как еще в области месседжи говорят так называемые селекторы ну и самое главное к чему приходит все кто пытается сделать какую-то свою очередь это собственно говоря она должна быть order была она должна быть стойкой к каким-то внешним воздействиям потому что прекрасно мы засовываем какие-то там задание в эту очередь у нас выводили рубильник все упало мы должны как правило все таки потом что-то сделать с этими заданиями посмотреть какие разобрались какие не разобрались поднять посмотреть то есть уже возникает такое как бы ну практически вот с этого слайда уже начинает на горизонте маячит базу данных на основываясь на всех тех свойствах которые были на прошлом слайде чем хороша асинхронная очередь во первых это удобно то есть но как бы когда мы из какой-то канал кидаем какие-то месседжи это наглядно это удобно рисовать архитектура недаром собственно говоря среде особенно эти менеджеры в больших компаниях пользуются такой безумной популярностью такие вещи как там например грипп или диаграммы и прочее вот модели бизнес-процессов то есть очень хорошо ложатся на бизнес процесс ну если это будет как айсберг то это будет на самом деле довольно безумные страшно но в принципе нет ничего плохого в том чтобы какие-то абстракции которые мы применяем в подходе к программированию напоминали бизнес-процессы тогда собственно говоря из не техническими людьми общаться проще вообще много простых и удобных вещей очередь она должна работать быстро ну то есть опять же асинхронно значит уже мы хорошенько ускоряемся третий момент вот обычно задача интеграцией не возникает на пустом месте ну вот взяли тут запустили какую-то задачу интеграции поставились одну систему вот она будет интегрироваться вот так поставить допустим она будет интегрироваться вот так такого никогда не бывает обычно бывает что-нибудь ископаемая оставшаяся от мамонта или от его жизнедеятельности обычно например там бывает 3 эсэмэс центр от разных производителей бывает отсылка писем по разным полам с помощью разных местах сервисов бывают какие-то совершенно безумные и достаточно старые вещи которые нужно интегрировать притом зачастую повторяя бизнес-модель всей системы так или иначе любая система она повторяет как бы ну если в компании есть бизнес-процессы значит интеграция будет в какой-то степени копировать эти бизнес-процессы из-за этого например там во многих больших там советских конторах условно говоря мы видим копию безумного советского документооборота бумажного перенесенного в электронный вид ттока это конечно забавно но от этого куда не денешься другой опять же немаловажный здесь вариант что ну вот смотрите было прикольно когда там в конце 90-х делать какие-то первые интернет проекты можно было делать там так сяк еще иначе прошло уже довольно много лет и время идет и на самом деле вот этот вот подход специфичной для энтерпрайза да когда куча вот разнородного разнородных систем соединяется он становится так же актуален для больших старых интернет-проектов потому что здесь у нас была система какая-то авторизации старенькая здесь была какая-то такая штука такая штука не результате вот эти вот тоже наследование компоненты требуется интегрировать очередь эта возможность как бы сделать единый интерфейс через этот интерфейс проводить интеграцию потом соответственно заниматься тем чтобы каждую систему дружить с этой очередью ну построиться это вообще такая как бы еще ашманов писал про то что первым делом когда программистом дают волю они начинают делать системную шину как бы сервис-ориентированной архитектура это модно шина это хорошо на это начинают молиться и поэтому иногда очереди воспринимают как серебряную пулю ну как бы к этому надо относиться с опаской на мой взгляд давайте начнем с простого примера тупая очередь задание пока что еще не какой интеграции нет вы просто в базе хотим ну например там не знаю подготавливать письма на отсылку уже есть 2 проблемы которые у нас возникают всегда в такой ситуации если мы например хотим сделать не на базе просто сделать из каких файликов и или как-то там на коленке нам нужно бороться с канг ourense если мы хотим чтобы очередь было быстро книг в нее нужно конкурент написать конкурентов из него читать мы должны бороться с падениями когда все упало и нужно восстановиться та самая гера берите которая говорил в начале в принципе эти две проблемы они имеют простую тупой решение телефонная база данных там в нашем случае там под грейс q это он умеет транзакционные логе умеет транзакции с обоими этими проблему мы боремся в чем проблема сделать очередь задание на том же подгрести вот так вот в лоб при стандартных уровнях изоляции у нас возникает проблема вот мы многопоточную пишем в какую то там таблицу много процессов это делает и много их читает вот какое-то сообщение стала вычитывать что-то нет никакой гарантии что кто-то еще параллельно не занялся тем же самым то есть грубо говоря при стандартных в них изоляции транзакций я думаю что общем особенно те кто суши уксус и доклад уже должны хорошо понимать в такой уровня изоляции транзакций хоть он в общем полу такого слова напрямую не произносил просто так не реализуешь в общем-то то есть либо все блокировать каким-то образом либо мы будем иметь так называемые грязное чтения ну и если мы начинаем уже как бы заниматься интеграцией распределить эти вещи у нас так называемый обязательно конфликты возникают когда у нас помимо вот этих самых падений иконка рамси возникает проблем с сообщениями то есть грубо говоря какому-то удаленному сайту мы решили обратиться так то так то и так то а сообщения до него не дошло либо дошло два раза либо дошло до не то ковырялись система еще сильнее усложняется дальше идем по предпосылкам по тем же самым буквальным только с другой стороны реляционная модель плохо масштабируется кто слышал это утверждение вообще когда-нибудь в жизни что так мало но я думаю что почти все только в кафе или в других формулировках так гласит народная мудрость но на самом деле обычно что под этим имеет ввиду внутри базы если мы как бы делаем все по честному у нас есть эти транзакции ссылок носить внешние ключи то есть у нас все там четко и правильно если мы начинаем например шар нить или например как-то распределять куски функционально у нас это проблема в стоит полный рост ну например представьте себе у нас юзеры лежат на одной базе она другой базе соответственно у нас лежат там не знаю какие нибудь там users кие данные вот тупой внешний ключ из одной базы в другую у нас не работает нужно прибегать каким-то ухищрениям у нас уже идет какие-то там отклонения от оси до с которым нужно как-то бороться принципе при чем здесь это собственно говоря очереди если мы хотим бороться с этими конфликтами если мы хотим например использовать очередь для масштабирования база данных которые имеет соблюдать целостность на каждом из вокальных сайтов нам нужно придумать какой-то способ там не знаю распределена согласовывать данные основная характеристика этого это обеспечивает это так называемый распределенный камень и такое общее название для большого класса алгоритмов которые в основном разрабатывались в конце семидесятых начале восьмидесятых годов к ним как вы тут видите наверное приложил большое усилие известный широко в мире postgres человек эти протоколы за ним собственно говоря борьбой с вот этим самым создать самый третьей проблемой в общем то что в случае какого-то падения или какого-то отказа или каких-то там нарушений у нас нету проблем ну и когда это накладывается на проблемы коммуникации чтобы мы могли понять что у нас собственно говоря происходит эти алгоритмы как правило подразумевает что есть отдельный координатор вот этим вот управлением распределенной транзакций и имеет там кучу разных разновидностей однофазный commit двухфазный колит и прочее прочее вот тут я выписал в принципе фамилии серьезных компьютер sites of qatar этим занимались можно принципе легко с помощью гугла найти их статьи и посмотреть как там всё устроено для того чтобы у нас распределенная очередь в определенном случае хорошо работала в общем так сказать промышленном варианте нам нужно ударить двухфазного кобета ну ровно ситуация такая что мы начали писать транзакцию в разные места например очередь с одного сервера по диску или пересылать данные на другую землю под близко уиллем чтобы если в какой-то момент один из серверов ушел в дом у нас можно было восстановить данные без всяких проблем либо же соответственно понять что они у нас битые то есть грубо говоря упал в другой сервер а на втором сервере не произошел честный rollback и у нас сообщение осталось в очереди в нетронутом виде и мы об этом никак не узнали а что произошли какие-то аварийные ситуации все это сообщения нужно как-то разобрать ну смотреть этот вопрос очень простой понятной если мы сразу строим sua правильно то есть в общем это уже на самом деле смешно и утверждение но как бы со никто никогда не стоит правильно потому что построили так правильно оказалось что так неправильно вот если мы строим правильно то это наша ситуация даже не очень волнует потому что у нас есть очередь который работ очень просто из нее вы читали сообщения ok вы читали прекрасно все работает не вы читали сообщения консьюмер упала тот кто читал ну и все прекрасно произошел в б у нас сообщение осталось в очереди когда его поднимут он их вычитает то есть в этом-то прелести синхронного подхода и проблема заключается в том что это когда правильно то есть грубо говоря когда у нас любое сообщение идеологически поддерживает очереди его можно несколько раз период править допустим да пример когда у нас упал после кс который рассылает почту да мы из одной базы складываем в базу в другую очереди там лишь той же даже базе какие-то там сообщения клиент какой-то вычитывает собственно говоря то что нужно отправить и отправляет постфикс а постфикс он в общем то не привидение трансакционный да то есть какой-то момент скрипт который посылает почта он говорит комет и с точки зрения там очереди у нас сообщение вычета на вычет она успешно никаких проблем не произошло после x при этом упал до в результате там очень часто бывает что сообщение пропадает бесследно либо наоборот если мы берем такую растянутую транзакцию и после того как поступал он вызывает all back у нас в очереди накапливается две тысячи писем к одному и тому же человеку с целью вещами нужно как-то бороться я чуть позже расскажу как но грубо говоря если мы имеем неправильную а именно считаю что нормальную как у нас обычно бывает архитектуру с какими-то историческими проблемами том часто очень нам нельзя сообщения посылать второй раз провели платеж послали там какую-нибудь там эсэмэску который нужно посадить только 1 каким-нибудь кодом верификации там в интернет-банк вход мы не можем но это как бы сделать еще раз то есть нам если у нас упала там почтовые сообщения и чего не прошло нам нужно это дело посмотреть какие у нас следы остались как работает двухфазный камень ну собственно говоря моя задача сейчас только немножко рассказать о том как это действительно работает ну ситуация здесь но не вдаваясь подробности ситуация такая что группы ремастерах координатор он отправляет задания на эти самые своего то есть грубо говоря подразумевается что каждый своих сам посидел умеет делать транзакция у себя локально и этот sleep ведет свой блог и посылает когда по его мнению уже нужно там завершать концепцию он посылает такой запрос а готова или каждый из файлов за комитета то есть попали они в завершающую стадию это так называемый вот при п посылку до грубо говоря и каждый из своего голосуют в ответ может ли он что то сделать если какой-то из своего в говорит что я не готов за комитета у меня тут плохо все то поведение следующая своих может откатить эту транзакцию безболезненно а мастера соответственно сообщается координатора что со своим тогда таким-то проблемой и дальше он по своему блогу вызывает как бы процедуру уже такого аварийного восстановления и занимается тем что приводит транзакции в прежний вид av2 пену и соответственно если успешно то все своего и отвечают что все хорошо и отвечает камень уже потом на самом деле как вы видите проблема этого протокола состоит в том что очень серьезный такой обмен сообщениями происходит и куча каких-то вещей которые нужно вот так вот полу руками смотреть потому что а что будет если он упадет в какой-то момент а что будет если он упадет в какой-то момент как нам это все вернуть поэтому в общем то если так вот сумма ли заводь ничего нужен алгоритм то его нужно во-первых как бы обвешивать еще процедуры восстановления там вручную липовой ручной ему нужно прописывать все но как бы это обычно реализовано в очередях все варианты взаимодействия там в какой фазе чего что произошел как нужно откатиться на практике когда перекидывают такие сообщения по очередям про некоторые например типы сообщений известно что их ни в коем случае не нужно посылать 2 рации с ними что то не получилось их нужно посылать в какую-то очередь для отбраковки если соответственно их можно посылать второй раз их можно еще раз послать ну и skin is standing here показали свое время что большие проблемы начинаются если два компонента упала и притом разнородных то есть например координаторы slave очень тяжело восстановиться из такой системы это все говорит о том что на самом деле вот когда возникает на горизонте распределенные транзакции это значит что на тридцать три раза подумать вообще это надо или не надо потому что это может быть очень больно но если мы хотим целостности допустим мы проводим платежи мы проводим какую-то ценную заводскую информацию они какие-то шутки играют а общем на самом деле кроме вот распределенного коммента нет никаких вариантов поддержать эту целостность таких лирических отступлений как говорил почвы докладчик сразу возникает терме джеймс вот внимание сейчас я начну хвалить джаву немножко это бывает редко джеймс это такое принятый в джаве как бы набор правил и спецификация как нужно в каком формате обмениваться сообщениями в своем базовом виде эта штука достаточного лично я очень выстроившиеся поэтому в принципе очереди сообщений час не делает только ленивый но идеологически делать что-то похожее на джима достаточно правильно потому что просто ну вот например если взять какой нибудь там не будем там брать равен темпу возникают более не на слуху очередь по ней можно там условно очередь там какая-то там по ней можно пробежаться как бы глазами если ты знаешь спецификацию джеймс сразу так подумать ага вот здесь вот они нас наступит на эти грабли щас а вот здесь через три шага потому что вот грубо говоря вот это не было исследовано такими таким-то образом ну и когда я говорю про реализации обычно вот эту штуку хорошо умеет такой кровавый кровавый enterprise то есть если вы думаете что advance коул это кровавый enterprise вы ошибаетесь вот гибкая и msi эта вещь которая стоит дороже любого уркла бывают очень редко и вот там начинается настоящий кроваво enterprise это все вещи которые действительно хорошо умеет свой описанную прежде специфику соответствует джимми спецификации каком-то виде хорошо работают ну и соответствующим образом стоит а например в колпино езды на базе glassfish а она конечно тоже вроде как хорошее но иногда таким чудным образом работает что как бы сразу java уходить не хочется ну и опять же спецификация это в общем разумно в общем устоявшиеся и транзакционный и джи би позволяет в общем то например ходить в базу там в тот же позарез опять же также то инфекционно то есть у нас вот нет той проблемы когда скрипт общающийся с под сексом упал не транзакционные у нас что-то осталось в очереди да то есть у нас вот полностью покрыта транзакциями вся эта цепочка поэтому на самом деле все ведущие моды так или иначе имеют свои какие-то очереди ну вот мне честно говоря пока навскидку по идеологии реализации нравится тебе двое идут серовская очередь то есть например интерфейсам очереди является таблица есть некие методы которые позволяют там по инн серфить по силе птиц а из этой очереди можно например там java клиентам это дело забрать или даже с личным клиентам это делать забрать или народ положить здесь интеграция максимально до какой-то степени похоже урока но у них там проблемы есть интеграции например попробуйте подключить glassfish кротовой очередь это целая большая проблема в подписи на слуху так называемый панике это туза от skype ну в общем то сейчас наверное об этом расскажет пользу да еще пара слов про ту заводская по по не надо заметить следующее что принципе сейчас уже есть последняя версия skype зов но она какая-то все еще такая не очень доделанная поэтому на самом деле какие-то фишки свойственные для нормальных очередей в паку появились но я буду говорить о том что стабильно поэтому возможно слабо купол мичурина здесь нет он не будет говорить что есть какие-то патчи говоришь есть какие-то патче которые резко улучшает ситуацию но как бы несут итак для по списку и при этом очереди нужны до зарезу может быть даже больше чем для кого утер aqua потому что пузырь из нужно масштабировать и то есть в этом некоторые проблемы потому что он плохо параллели цен на процессоры в 92 эта ситуация очень сильно улучшилась но тем не менее все таки пока еще эта проблема запись упирается в их sing то есть принципе как бы там гигантские сборки как новикова мраке на подвесе делать стрёмные иногда ну и плюс тому например там против парте цианирование работать проблемами я вот перечислил несколько таких проблем которые лучше от масштабироваться чем рисковать общаться с одном с одним большим ящик до сотки как бы видим и допустим больше привычны масштабирование чем все запихнуть в один ящик и второй момент что на самом деле после можно масштабировать вот с ценой за один камень 50 тысяч баксов в год вот попробуйте отмасштабировать на 100 правила форума ну как бы проще по-моему просто пойти и повеситься потому что это совершенно неоправданно и затраты the spot близ бесплатен поэтому на нем можно строить хорошие распределенной архитектуры и соответствующим образом использовать их там для многократной перестраховки для теста бизнес-задач это как раз та ситуация когда воскрес за счет того что он open source играет гораздо успешнее на чужие поля ни на что и папа как у эту как у она представляет собой такую пито новую обвязку там есть процесс стикер и event log того что происходит в таблице и средств snapshot а ну snapshot все брюса слышу тогда что такое снабжаться все знают почему это сделано так и зачем это было сделано так потому что в те времена когда это дело появилась а надо понимать что skype эти ребята были большими пионерами да то есть они но почему мы изобрели многих революции устроили но они взяли опытах свою бомбу и построили гигантский кластер на ней поэтому они ходили по кораблям непрерывно то есть они занимались там как бы ну вот собирали самолет в воздухе что они делали они посмотрели и решили что наверное вот эти вот x то иди и и все прочие а традиционные вещи из них проще собрать snapshot руками но не руками вернее питоном и передавать эти снапшоты куда-то чем какой-то bms какая там интеграция эта вещь абсолютно такая в себе она абсолютно коленную . мы говорим не снимаем пишем лук и снимаем эти snapshot а то есть основная идея что средствами иску или очередь реализовать невозможно по описанным там ранее причинам и мы будем делать каким-то там вот таким вот пойдем своим путем а потом это как-то завязалась на репликация ландыш в общем для этого изначально это делалось как такой медиа свой ну вот кто когда-нибудь лондонец администрировать а почему остальные мне пользуются ну вообщем он на самом деле вот на этот вопрос нужно отвечать утвердительно он очень крутой но как бы но проще использовать вот стан buy например да потому что крутость это хорошо а вот как-то поддерживать его совершенно чудо-женщина вот мы опять таки смотрите у вас возникает какой то дополнительный демон на питоне у вас возникают какие-то удивительные такие штуки да ну это сильно увеличивают сложной системы да как бы если бы это была прям живут базе то было бы наверно там лучше и проще потому что во первых например у вас вам на проекте до попался гениальный хороший админ которого не хочется выгонять потому что там на нем реальную содержится но вот ненавидит человек питон до кушать не может через чесаться начинает когда видит питону ну и вот как бы начинается вечная бойня о начинается вами торговаться вот на этом сервере давайте поставим он это мне поставим а на вот этом давайте я обновлять версию не буду ну то есть как проблем на самом деле много от того что лишний компонента появляется мы поэтому решили пойти немножко другим путем и сделать очередь которая него чего требовать дополнительного и в общем зависеть только от некоторых кантрипов например модули христовых который уже хвалил предыдущий докладчик также прямо скажем стоявший над колыбелью этой самой очереди это прямо нативный подрисовок стенджер которая собирается быть предварительно нужно поставить мудрых астор и собрать его достаточно простым способом в текущей ситуации всего изменений в каталоге имеется стабильных две версии 11 и 10 для девяток старых нужно использовать 10 а для 92 нужно использовать версию 11 ну пока что я не могу так ударить себя пяткой в грудь искать что у нас есть готовый релиз потому что нужно немножко подправить документацию я думаю что через пару дней он будет отгружен так сказать уже в той но принципе в tranque вот по этим адресам лежит собственно говоря рабочий вариант которым можно использовать создавать как extensions играться с ним там есть такая функция readme.ru с которой вы эту справку на русском языке вот как появится такая английская справка так можно будет собственная сделать торжественно перерезать ленточку побуду того что это можно использовать что это такое там ну джем с это кроваво enterprise они любят xml то мы не любим xml потому что как бы зачем там есть христом там есть поймут из христу можно сделать джейсон если что если кому-то очень хочется то есть есть ходили есть собственная мысль но вот это в терминах месседжи это собственное тело информация умеет реализовать следующий паттерн и это очередь то есть грубо говоря когда мы что-то куда-то положили откуда достали возможно то и другое делаем несколько потоков так называемый public субскрайб моторная пока до грубо говоря в темной джем с от называется топик тоесть в одну очередь пихается энное количество разных сообщений а разные подписчики выковыривают оттуда то что им предназначена то есть например 1 сообщение может быть прочитано тремя подписчиками еще одним каким-то да там ну то есть это такой более продвинутый вариант и вариант request a response эта штука умеет селекторы то есть грубо говоря publish субскрайб умеет фильтроваться по неким сеттингом быстро и хорошо и что не маловажно она умеет delivery expiration delivered daily примеры сам положили сообщения которое должно уйти в качестве такого письма пользователя его не нужна она станет неактуальным через пять минут но можно поставить именно delivery копирующим пять минут если у нас почта все это время лежава это сообщение станет неактуальна и удалиться да и либо мы можем считать количество попыток сколько раз мы пытались доставить и после там двух неудачных попыток постановляю выставлять delivery и говорить в следующий раз нужно попытаться через час думаешь наш админ и за это время успеет очень по секс ну вот собственно говоря простейший набор после установки создастся схема м buns и в ней можно реализовать паттерн очередь то есть можно вызвать функцию креветку задать собственно говоря имя этой очереди и количество частей которые можно одновременно перебирать это как бы такое внутреннее устройство для производительности и для логичности этого дела это какое-то там обычно должно быть разумное число ну допустим поставить 64 редко на пастбище на современных процессоров там можно и столько-то в общем обеспечить но это уже получается эта функция создаст некие там служебные объекты в схеме embas там хранимой процедуры и служебные таблицы и можно будет пользоваться вот это именованные очередью как пользоваться можно туда что-то запустить вот с помощью такой хранимый процедура нас генерится там соответствующим образом то есть можно сделать туда пост данные виде хостера кедры и properties тут надо понимать что и дыры это не то что нужно делать это некая служебная вещь а properties это то что собственно говоря можно что-то туда записать для удобства для своего ну и deore xt это то что я сейчас объяснял эта очередь будет возвращать они добавленного сообщения настолько говоря в пределах всей базы уникальная есть вариант перегружены когда не будет возвращаться такой штуки ну и дальше собственный простейший вариант вычитываем сообщение из очереди эта штука вильнёт 3 процента вот такого вот вида примерно то же самое что мы туда квали только там еще будут люди которые там служебные поля и то есть там такая таблицы куда модель которая собственно грех будет являться возвращающих значением ну и если мы хотим чуть-чуть усложните мне сделать попускает фактическими на эту очередь навешиваем такие консьюмер это такие читать или которые по фиксированному селектору они имеют своей и по фиксированным селектору по какому-то признаку выдирают сообщение предназначены для них как это выглядит ну но это в чем на джеймса называется diablo сабскрайберов то есть сабскрайберов который мы создаем прибиваем гвоздями они там живут ну допустим в properties нашей нашего сообщения мы можем засунуть что не статическая ну в таком вот виде то есть допустим там поле с таким-то названием равно тому-то какая-то статическая информация соответственно когда мы пустим сообщением и это добавляем впредь из когда мы вычитываем мы можем соответственно просто по имени select по имени консьюмер а созданного с таким до селектором вытащить эту и то есть допустим мы вот создали стоит равно дан и консьюмер с именем которые там и создание будет вытягивать только сообщение состоит равно да это стандартный опять же ми су джин говорит московский паттерн пара слов вот я отдал по его примеру в паттернах если интересно посмотреть там целиком все примеры там есть readme.ru функция которой можно вызвать и она просто в польскую выведет всю эту справку пару слов эти курить и вообще очередь вещь такая нежная да то есть принципе ну да и программистам такую возможность они штамм 86400 очередей создадут и будто многие apache через не гонять поэтому эта штука как кан trip создается из-под супер пользователям она не верила кабельное привязана к схеме то есть это такая вещь которая она должна проходить через два то есть грубо говоря создание новой очереди на благо лучше как бы должен утверждать тут я уже загнул только что тем самым программистов я щас липнут ибо если у вас это было говорит а я что-то сомневаюсь не буду создавать эту очередь да мне вообще линии вода да идите вы нафиг у вас плохой добра где взять хороший об этом в кулуарах расскажу и в принципе когда это у вас от супер пользователю проконтролировано все и используется вы можете создать с помощью специальной функции опять же функционале очереди в юху с некоторым именем опять же там с некоторым консью миром которая позволит обращаться к очереди через вот эту you in any и дающий гранты и любым пользователем в котором вам нужно соответственно не обращаться то есть грубо говоря мы не можем крутить и соответственно как бы там усовершенствуйте портить очередь сами по себе но можем там как бы сделать такие проекции это хорошо это удобная to secure ну собственно говоря road map которая в ближайшее время ожидается пока что это очередь она как бы работает либо на локальной базе как очередь заданий либо соответственно через д пылинка работает через прокси skype узкий с удаленные базы но вот тот самый ту самую проблему духовного калита планируется в ближайшее время собственно говоря решительно и в следующей версии сейчас там есть клиент в принципе его надо немножко усовершенствуется делать более таким переносимым и ту фазный комитетом будет конференции к сожалению не успели в принципе для этой очереди довольно разумные просто сделать gms клиент час там есть на эту тему некоторые заготовка но пока что как бы тут вопрос такой что нужно на чём-то это протестировать как-то посмотреть но в общем это возможно там если кому-то надо обращайтесь можем форсировать это дело вот такая история для того чтобы собственно говоря разобраться с этими теоретическими основами я порекомендовала бы две три таких книги книги одна из них конечно фундаментальные но и и задолбаешься читать третья книга она наоборот и не сдаваясь читать читать очень легко на очень занудно такой научный коммунизм там сначала там туда-сюда там рассыпаются одну сим смотрел у амати летняя книга как раз по она очень хорошо проблематику распределенных транзакций почему без сложно обходиться она описывает вот я бы рекомендовал бы если вы хотите просто так впечатления поглубже составители досмотреть среднюю книгу вот ну у нас есть насколько я понимаю 10 минут на вопросы что в общем наверное хорошо задавайте пожалуйста сразу отлично производительность хотел спросить это замер есть у вас какая-то способна через и получается посмотрите для рабочей людей вообще считается хорошей производительностью когда там десятки тысяч сообщений в какие-то периоды времени на той стороны типа минуты десятки минут и так далее это очередь это тело покрывает сравнительный тест и например мы пока что не делали потому что в принципе зависит от очень многих вещей объяснил почему то есть в принципе можно довольно несложно сделать тест кейс на котором бы как будет проигрывать столько выигрывать и наоборот когда мы будем проигрывать и игры например там разрежьте дэвисон через пропихивать было бы довольно странно или когда идет интенсивный отдельно таблицы которая транслирует там соответственно тоже могут быть проблемы просит вас с народами поэтому как такового быть марков не пока не делали производительность этой штуки мы пока что еще никаким образом не убирались потому что например а селектор или они на самом деле это многих служебных таблицах очередные строят яндексе и работают эффективно то есть возрастные например делают безоговорочно наверное там в принципе тип к делать бутик марки с ней довольно бессмысленно потому что там с другой рынок они при этом умеют работать хорошо и важный момент еще есть такой что на обмене большим количеством сообщений у нас интенсивного приходится агрессивно настраиваете второму какая высокая таблицы кто с этим есть некая проблема и поэтому при списка вас стоит задача там добиться каких-то рекордных количество общения в секунду проходящих через очередь то наверное лучше там подумать как они очереди разделить и так далее чтобы не напороться на фриз и каким-то там и на залипания за вакуума на конкретных таблицах червей в принципе я бы рекомендовал очередь использовать как такие лук не очень не пихать а через 1 очередь с огромной скоростью стараться это как там инсталлировать поставить 10 машин использовать бога при наличии очереди товар и раз понял мне нужно чуть до конца не понятно вот все-таки по работе в классе зеркалирование чтобы требуется отказоустойчивый кластер на построить где там мы пишем найду да если там она падает то можно это волшебным образом прочитайте другой но сейчас это карта реализуем смысл заключается в том что на самом деле в этой задаче нет вы уже прообразом не надо путать задачей интеграции с задачами высокой доступности для решения задачи подписи существует хорошее встроенная штука называется константой то есть аналог работа такая для задачи там переключения там когда все стоит заднем бага балансиром другое причем потому что 2 аварийно завершилась существует вот эту вот решение применять для этого очередь не стоит для этого как нужно специальными ущерб и делать это доставка инфекционных блоков минимальная латентность и максимальная как минимизация времени простой максимально эффективным переключение на новую причем сейчас хотите сказать что не нужно писать или реализовывать эту доступность просто позарез нужно реализовывать следствием по стресса они вот результат то есть если как бы самая серьёзная ошибка к этому можно допустить это попытаться и просто это очень часто встречается со времен слонов еще были из было такое революционные решения обычно любят поставить деятельности в желании щеки графический удаленных и вот в разных направлениях гонять какие то подобие то это очень плохая практика очень плохо заканчивается это как бы это постоянные конфликты это постоянные кита проблемы у вас есть под стулья для этих задач все гораздо лучше а очередь нужно используют для не знаю логического разнесения компонентов это вещей но не для отказа модели land общей я правильно понимаю что собственно и билетах раненько можно ли прицепить как сам скальных к очереди сжал да и эволюционными аннотации мы наполнитель нам нужен ну пока что не описать напишите пожалуйста это не задача очередь на самом деле с помощью это очень я по секрету скажу такую задачу можно потому что в принципе можно потребовать конкретное сообщение достать специальной планирующей функции она там есть но делать это категорически не рекомендуется потому что принципе с точки зрения делают и очереди мы обращаемся консилер обращается не пытайте вычтет сообщения он может собственно говоря получить сообщение это один слот он может получить пустой ре зация и здоровье обозначает что-либо очередь пуста либо собственно говоря все части учили доступных для просмотра там за здоровье сейчас заняты другими компьютерами и в таком случае дальше и дальше с этим нужно сделать внутри когда они слушают на самом деле не очень это хорошая практика потому что таким образом вы опять получается же риохи эти такая такая очень интеллектуальная система на льду в каких случаях как будем считать и так далее в принципе здесь реализовано еще какой механизм более правильные точки зрения если нам нужно понимать что как только сообщения мы редко приходит в очередь туда поступило его нужно обработать и соответственно процесс должен быть на готовенькое ждать этого дела то можно создать игирма очередь какое при поступлении сообщения будет прикатывать сообщения в гулаге это очередь на примерного быть более часто то есть как бы чтоб немцы сдавать нагрузку на 1 можно провести такой триггер приложить сообщение и это как бы такой аналог закипает в доке это одних я понял вопроса принципе смотрите есть два момента во первых вот с каким количеством платных и бесплатных очередей вы работали когда на самом деле история такая что и реализации джеймса здорово формальных в общем-то у те которые выписывал названия на самом деле более менее пригодны для работы без особых прям большинству все-таки бесплатных реализации вот там я особо склонял классическую а есть еще призами и пасхальными я еще с ними на самом деле не так просто работать особенно когда строишь запутанные тупо луки но это как бы лирик это просто такое замечание в зал да у нас все таки задача была прикрутить очередь сообщение к базе данных задача формулировалась урну таким образом потому что когда в базе данных живут данные живет в по их обработке поэтому что например там предыдущий доклад и доклад там на текстовый поезда они показывают что данные и логику бальзак они хорошо и удобно хорошо работает то хотелось бы еще в базе ведь учить да то есть опять же когда реализован на чистом ускорили ставить нативным station и не нужно за собой тянуть шагов которые я может не работать хорошо при выезде на которых стоит база вот когда тебе хочется делать гораздо проще не что такой маленький хороший удобная плюс того вот опять же сейчас конечно принято считать что программисты дорогие сохранишь о вы но для нормальной работы потом серьезной нагрузкой джим азорских очередей используют java лавский сервера приложений до 128 гигабайт оперативной памяти это чувствую бывает такой процесс весит во многих говорю да потому что java потрогать не залезет на такой настрой это нехорошо неплохо это она аналогичной машине в общем-то пазле сможет работать с огромной производительность это просто экономии ресурсов экономики катан вещей ну как так liftago тому же не хочешь ну это сильно зависит от того на какой версии посредственности то будет работать и как у вас от авто вагон настроек в принципе если у вас будет исправляться of the vacuum или по каким-то соображениям будет сложно настроить его достаточно агрессивно есть явно способом борьбы первый самый простой способ борьбы это собственно говоря на разные таблицы 1 новейших разных товаров и тогда наверно все таки это проблема там последний девятках уйдет либо соответственно можно использовать пугаю место вы располагаете местом для такой задачи шагу становится сильно уж лучше использовать 4 а если вы при этом не располагаете местом на использование реворка у нас есть как раз ползарплаты компактор который это делает общем-то медленную верный без пожирание дополнительного места в принципе вот я вам назвал на скидку там четыре метод а как с этим бороться проблемам . проблема повторно в общем то есть большинстве случаев можно настроить на листе мы такое вдобавок который будет хорошо работать"
}