{
  "video_id": "HhjlsXF96_0",
  "channel": "HighLoadChannel",
  "title": "От ​MVP ​к ​реальности. Проблемы перехода и лекарства для решения / А. Дашкевич, А. Похила (X5 Tech)",
  "views": 156,
  "duration": 1735,
  "published": "2024-04-17T00:59:44-07:00",
  "text": "Всем привет Сегодня мы хотим рассказать про процесс перехода от мвп к реальности да то есть именно вот про вот этот Пограничный момент иногда он происходит быстро иногда он происходит незаметно Да мы его не замечаем и это приносит собой какие-то проблемы Вот сегодня мы хотим подсветить рассказать что может произойти что можно сделать быстро и потом Что можно сделать структурно чтобы не допустить либо уже вот либо уже перейти к этому решению Еще раз Меня зовут Андрей я руководитель команды разработки по-другому тимлид отвечаю за работоспособность системы за команду backender в частности за сроки из личного я пытаюсь делать стартапы Вот часто неудачно в основном неудачно Вот и очень мне понравилось скалолазание лазают по скалам сейчас вот передаю всем привет Меня зовут Алексей Дашкевич я архитектор решений в X5 Group занимаюсь проектированием архитектуры решения для ИП продуктов как это ни странно также работал в Телеком компаниях занимался трансформациями ландшафта Телеком компании свободно от работы время как и Андрей люблю делать какие-то стартапчики Вот с Андреем мы делаем эти симулятор начали совсем недавно и также люблю проводить время в горах и зимой кататься на сноуборде Так что Велком Кто хочет погнали теперь перейдем непосредственно к нашему продукту и кейсу которым их вам хотим рассказать продукт продукт наш автоматизирует процессы сотрудника в магазине То есть вы приходите в магазин хотите видеть что там все по полочкам там все красиво все ценники на местах за этим лежит большая работа соответственно сотрудники ходят с определенными устройствами с мобильными у них есть мобильное приложение они выполняют там определенные задачи например нужно что-то выставить на полку нужно поменять ценник наш продукт анализирует то что должен сделать сотрудник на основании данных и следить за тем что сотрудники выполняют эти задачи и расскажу то с чем мы столкнулись был mvp соответственно бизнес хотел протестировать гипотезу как сделать работу сотрудников в магазине более мобильной сделали mvp раскатали на 20 магазинов и потом решили что да прошел гипотеза протестирована Давайте теперь скатим на 1000 магазинов кратко об архитектуре это один не было реплики базы данных не было мониторинга короче много чего не было синхро интеграции все были синхронные практически аутентификация авторизация была внутри приложения статистику выгружали на живую с использованием джойнов отсутствовала напрочь работать с технологом И когда у вас продукт на 20 магазинов в принципе это решение может как-то жить но когда вы внезапно решили масштабировать его на тысячу магазинов то у вас возникают проблемы а проблемы следующие вы сталкиваетесь конкретно Мы даже столкнулись с тем что наша система просто стала недоступной пиковые часы было очень сложно расследовать инциденты вообще понять причину проблему Что где искать все бегают не понимают требуется постоянное вложение денег в инфраструктуру так как ваш код и ваша архитектура крайне не оптимальна и очень медленные доработки новых вещей бизнес не понимает почему все так движется медленно крайне сложно масштабировать разделять также работу в командах плюс низкая вообще скорость при сбоев после низкая скорость восстановления системы после сбоев и собственно для того чтобы что-то с этим сделать нам понадобилась скорая помощь то есть в этот период когда мы масштабировали от 20 до 1000 магазинов нам нужно было как-то делать новые фичи поддерживать работу системы А еще потихонечку менять архитектуру соответственно первое что нужно это поддерживать работоспособность системы какие-то быстрые действия которые мы можем применить и о них расскажет Андрей Андрей Ага я буду рассказывать о каких-то простых вещах в принципе все это делают Да ценность этого в том что мы составили такую памятку в принципе на опыте ни одного продукта многих когда вот мы приходим к этому состоянию Когда нам нужно раскатываться в Production грубо говоря на большие мощности мы проверяем определенные моменты а первое на что обращаем внимание Да это конечно мониторинг и логирование часто этому не уделено должное внимание мы да видим какие-то базовые с показателями по инфраструктуре но что касается внутри приложения это часто скрыто и поэтому мы сразу говорим о том что первое мы должны мониторить инфраструктуру потом мы должны мониторить какие-то входные вещи да типа API либо это может быть какие-то очереди Смотря как мы общаемся внутри это workflow процессы да то есть именно процессы какие-то задачи запускающиеся по расписанию что-то внутреннее внутреннее совсем что пользователю не видно да Но этим система живет то есть мы тоже отдельно это выделяем отдельно за этим смотрим и клиенты да то есть это точка где с нами взаимодействует конкретный пользователь даже он еще не идет никуда на бэкенд то есть вот эту часть она как бы отделена от основной системы Мы тоже обязательно это должны видеть это помогает расследовать инциденты Вот то есть если какие-то части вот у нас тут страдают мы обязательно заводим такие задачки и в общем решаем способов которые Может там логирование мониторинг быть построенных миллиарда количество хранилищ количество там вообще подходов протоколов заостряться на этом не будем вот каждый для себя выберет Ну или там отдельная тема для разговора дальше когда у нас есть какие-то данные которые показывают как работа наше приложение Мы даже может быть параллельно мы проверяем как скелится наше приложение понятно что в основном все фреймворки Сейчас уже рассчитаны что это будет мультиинственность Да что там будет подниматься несколько инстансов нашего приложения ничего там не будет состояния выделено отдельно мы его не храним и все хорошо но когда мы делаем все быстро дали могут возникнуть ситуации когда мы те же воркеры какие-то которые workflow как раз обрабатывать можем засунуть в один контейнер или что-то такого же рода когда мы не можем просто взять и заскелить наше приложение вот этот момент мы грубая ошибка Она встречается достаточно редко но бывает Поэтому сразу смотрим и если не так разделяем Вот как раз разделилась компонента об этом и говорит дальше мы если мы чаще всего мы поднимаем в контейнерной среде Да где-нибудь в куберницах мы делаем ревью Ливны с рейтинг из проб ну обычно мы Рейден из пробу точно ставим чтобы понять когда наше приложение готово обрабатывать коннекты А вот именно ставим мы не всегда если мы не сильно понимаем внутренности нашего приложения вот если мы понимаем тогда можем какую-нибудь ливнуть пробу поставить а если нет то неправильно настроба может привести к какому-нибудь бесконечному рестарту приложения нагрузкой под нагрузкой и может помешать вот поэтому если мы не тестировали этот момент у нас нету какого-нибудь нагрузочного тестирования качественного то мы Ливны пробу чаще не ставим и смотрим что же произойдет Вот и последняя часть это всякие разные Connect и Connect и к базам коннектом к интеграциям их может не хватить при скейлинге Да вот проверяем Когда у нас уже в принципе мы посмотрели как скейлимся в принципе у нас готов мониторинг мы хотя бы видим что у нас происходит топи там задачи внутренние все есть мы в принципе можем понять профиль нагрузки то есть что у нас более использоваться пользователям И на что тратится основное там время выполнения CPU там или куда мы упираемся память может быть Вот что у нас является основным исходя из профиля нагрузки мы делаем какие-то базовые оптимизации заходим там проводим вот я написал алгоритмы проверяем там плюс один обращение к БД кажется все это очень просто но в зависимости от того насколько долго смотрели туда в конкретный этот inpoint может сложиться разные ситуации потому что где-то из быстрая фича была Мы связанность в ходе сделали и большую Да и что-то возможно где-то поменялось косвенно влияет на этот Point И он теперь тормозит да либо там просто было сделано некачественно в общем сечением времени если не прибираться такие ошибки накапливаются и даже вот Далеко ходить не надо Там в одном из продуктов Я видел где такие оптимизации привели там в четыре раза минимум ускорение ускорение нагрузку на базу снизили вот Ну понятно что не везде так вот Но обязательно нужно это провести нужно посмотреть на самые нагруженные вещи когда мы провели базовые оптимизации мы провели там настроили мониторинг и так далее чтобы было сказано мы смотрим на данные мы смотрим как они растут потому что ну чтобы не столкнуться там с переполнением данных и мы смотрим как относительно данных деградируют наши запросы либо наши задачи да то есть тот мониторинг который Мы строили и уже строим наше предположение возможно столько данных нам не нужно и мы просто их удалим либо сделаем задачу на удаление чаще всего эти данные не нужны Вот то есть это нужно посмотреть чтобы в случае нашего масштабирования там кратного все не встало так данные мы посмотрели переходим к поддержке понятно что когда мы раскатываем в Продакшен что-то будет случаться обязательно тем более мы делаем это допустим первый раз на в этом продукте и нужно предусмотреть какие-то кнопочки где-то подстелить соломки и поддержка это люди которые напрямую общается с пользователем быстро решает какие-то проблемы нужно им в этом помочь а первое что мы делаем это мы делаем кнопку по которой можно какие-то узлы перезагрузить Конечно когда у нас система там уже достаточно сложная и скажем так требования к надежности очень большие такую кнопку Мы вряд ли дадим Вот но на этапе именно когда у нас функционал только на этапе становления установился и мы делаем relout такая кнопка бывает очень полезная чтобы резко решить какие-то проблемы То есть мы учимся перезагружать узлы учимся делать это без потери данных и сделаем где-то в интерфейсе такой рубильник чтобы можно было его дергать и ревью инцидентов безусловно система уже работает какое-то время был сделан Пилот А что-то уже происходило и часто это все теряется нужно взять нужно сходить в прошлое найти все эти инциденты написать инструкции чтобы их можно было решить быстро без привлечения разработки из анализа инфраструктурные решения здесь основной посыл в том что когда мы делаем разработку то мы часто пробуем Пробуем пробуем много всего и может быть такое что какие-то решения остались нам в наследство просто мы их развернули попробовали они нам больше не нужны Но они эффект данные в них переполнились все и они там могут нам что-то положить что мы об этом не узнаем то есть вот мы делаем ревью всех технологий Возможно не нужны а также Возможно мы используем что-то например там есть мнение что кафку сложно настроить И поддерживать Да И вот мы решили для нашего стартапчика его ее использовать и у нас мало В этом экспертизы и когда мы на маленькой нагрузке все это хорошо работает все замечательно Но как Только мы приходим большой нагрузке нужны Дополнительные настройки вот если у нас мало экспертизы в этом вопросе у нас там девопс еще плюс занят другими вещами то эта технология начнет сбоить да то есть мы должны ответить себе на вопрос твердо и четко готов Хватит ли у нас компетенции поддерживать все наши технологии под нагрузкой вот если мы что-то не можем поддерживать под нагрузкой нужно от этого отказаться Ну либо там найти способы ответственность передать кому-то другому последнее что хочется сказать это про приоритизацию то есть Вот то о чем было сказано это такой чек-лист это такая памятка это то по каким направлениям нужно прикладывать усилия но в каждом конкретном случае для достижения максимального результата Ну то есть цель Наша какая чтобы плюс минус хорошо без сбоев без каких-то серьезных проблем наше решение раскатилось на всех пользователей работала достаточно устойчиво и мы должны приложить разные усилия к разным вот этим вот пунктам просто в конце хотелось бы об этом сказать что все сделать у нас не получится вот нужно сделать то что мы можем сделать еще раз здесь уже назвали мы по-другому что это чек-лист да при каком-то Роланд продакшн это может даже быть не мвп А уже в каком-то продукте до мвп какого-то функционала выпускаем Большой функционал в принципе все это было бы неплохо проверить Это все что хотелось сказать о таких вот простых вещах которые можно сделать здесь и сразу который можно сделать минимальным количеством усилий дальше мы расскажем про структурные изменения так еще раз привет Я буду рассказывать про терапию про Чуть более наверное верхнем уровневые какие-то структурные изменения а именно модель данных тех долг масштабирование Монолита в нашем случае и в принципе Вектор развития архитектуры продуктов давайте начнем с модели данных Я думаю что модель данных это одна из самых важных вообще основ того что есть потому что модель данных она влияет не только на эффективность работы самой системы на скорость работы Да мы все понимаем что база данных это наверное самая медленная что в принципе есть инфраструктурной части и то как мы грубо говоря структурируем данные сделаем модель наша система зависимости от этого будет быстро оптимально работать или не очень и также модель данных влияет напрямую на моем опыте на взаимодействие в команде то есть насколько вы все в одном контексте это тоже влияет на ваши эффективность Если вы оперируете разными терминами Хотя вроде как эти все термины там три термина Значит один термин то очень ехать в контекст вот как эти Человеки Пауки Вроде один человек паук а непонятно как бы кто что делает Вот то соответственно будет очень сложно решать какие-то задачи договариваться внутри также хочется сказать что когда вы делаете в mvp модель данных то все-таки нужно достаточно хорошо разделять вот бизнес свой слой технологический и конечно делить и организовывать модель данных по бизнес контексту а не от какой-то прям решающей задачи здесь и сейчас и часто на этапах nvp просто все лепят в одно и потом это мешает масштабироваться думает что нет Нам нужно создать меньше табличек меньше чего-то иначе там будет что-то ужасное но нет Не бойтесь как бы развязывать модель данных по бизнес контексту потом только удивитесь как это будет легко масштабироваться что можно было бы сделать на этапе это организовывать модель данных по бизнес контексту что я и говорил а следующая часть это масштабирование нагрузки на этапе перехода от 20 магазинов до 2000 у нас естественно встал вопрос про масштабирование нагрузки и это первое что возникает про масштабирование это горизонтальное масштабирование В голове сразу возникает микросервисы у меня лично Так у многих наверное тоже возможно так с кем я общался но стоит понимать что когда вы разрабатываете микросервисы это конечно же усложняет действительно на порядок ваши решения у вас появляется распределенные транзакции вам нужно думать про Саги вам нужно много еще про что думать писать там разные сети и так далее и конкретно для нашего кейса чтобы мы смогли пилить новые фичи еще поддерживать жизнеспособную систему мы не пошли в историю с микросервисами мы пошли в грамотное распределение кода в монолите аккуратно распределить грамотное распределение функции в монолите то есть начали организовывать код в монолите и плюс отдельные части выносить в том числе в отдельный инстанции что нам помогло горизонтально масштабировать Монолит Да такое тоже можно сделать и нам это помогло и плюс мы обошлись малой кровью именно в части проектирования соответственно здесь модель здесь совет такой же то есть лучше Когда вы пишете приложение ВВП тоже не делать грубо говоря все в одном опыт А по бизнес контексту организовывать код вашим монолитном приложении чтобы потом достаточно Просто вы могли бы носить что-то в микросервис Если вы захотите и быть более гибкими иметь больше вариантов про работу всех долгом как я говорил ранее на этапе в принципе работы с тех долгом не было Ну когда у Вас одно решение в принципе его нет и тех долго нет но конечно тех долг это очень важно особенно когда принимается решение внезапно масштабироваться потому что нужно фиксировать то что вы как бы за костыли или это просто нужно фиксировать чтобы потом поднять эти записи посмотреть что мы за костылили чтобы в этом всем не разбираться Вот это просто ускорит действительно и улучшит работу оптимизации потом вашей системы аж также тех долг это прежде всего владелец тех долго Да там например Это мы с Андреем То есть это техническая часть и нам очень важно следить за качеством продукта мы для того чтобы привить и развить культуру работы с технологом говорили с продуктовонером достаточно много встреч говорили почему это важно рассказывали в принципе как это влияет на эффективность команды Как это влияет на косты подсвечивали важность их долго и делали так чтобы тех долг из строчки в Экселе Да стал уже наиболее осязаемым чтобы мы его брали спринты что выделяли под это время немножко про Вектор развития архитектуры это тоже такая знаете абстрактная материя На мой взгляд но она также связана например с технологом тут Какие хочется мысли сказать что в идеале время на разработку должно зависеть время на разработку какой-то Новой фичи до должна зависеть не от сложности разработки от ее масштаба то есть постараться сделать так чтобы ваш код Вот и строчка кода в начале продукта стоило столько же сколько и там новых версиях продукта Когда у вас команда большая Потому что часто на своей практике я замечал такие графики где например строчка кода в продукте стоимость строчки кода она сильно возрастает а эффективность команды понижается чтобы такого не случилось нужно конечно же работать нужно выполнять наши рекомендации которые мы вам дали с Андреем и тогда вы будете жить хорошо и счастливо а часто Еще спрашивает вообще что такое архитектура хочется сказать что архитектура это не какая-то прям правильная работа система А что это гибкость и это возможность иметь больше вариантов развития Ну что Андрей вот мы с тобой значит поговорили Как ты все-таки думаешь можно ли действительно на этапе еще сделать постараться сделать так чтобы продукт был более качественным и масштабирование потом было бы проще Мне кажется что Конечно можно вот Конечно можно там больше вложить внимание в качество Да которое мы там разрабатываем в смысле там тестов или еще что-то но вообще вот на этапе часто бывает такая ситуация когда новая фича не ложится в текущую архитектуру Вот и мы ее делаем в этой архитектуре текущей и потом одно на другое наслаивается и мы получаем вот проблемы спутанность связанность и все такое мне вот кажется что нужно занимать максимально жесткую позицию и делаем новую фичу то сразу и видим что архитектура меняется Но вот прям прям ее менять вот закладывать это в Касты просто это мне кажется что это вот получится Вот такая культура которая не даст вот сделать что-то плохо В итоге вот что думаешь Я думаю что я на самом деле с тобой соглашусь часто пытается натянуть какое-то новое фичу на существующей архитектуру но стоит понимать что на этапе очень мало контекста у людей то есть для того чтобы сделать действительно мне кажется классное решение принимать вот верные решения в части там архитектуры в части модели данных нужно очень глубоко быть погруженным как в бизнес контекст так и в технике технологический контекст на этапах nvp просто люди у тебя Ты тестируешь гипотезы Возможно у тебя просто немного контекста для того чтобы принять правильное решение Ты часто Можешь принимать неправильные решения которые потом нужно переделывать но такое вот смесь опыта смесь технических скилов очень конечно интересно Да вот я такое мое мнение в принципе Мы наш доклад закончили вот завершение хочется сказать спасибо на самом деле большое что вы нас послушали что вы пришли очень было приятно не знаю Андрей может и пару слов от себя добавишь поддерживаю Все вышесказанное спасибо спасибо гравитации что все мы здесь ты сегодня стоим Да в принципе это все о чем хотелось прямо сейчас вам рассказать Конечно хочется рассказать намного больше мы сейчас рады выслушать вопросы которые у вас есть и ответить на них"
}