{
  "video_id": "oWBoTsVMSOA",
  "channel": "HighLoadChannel",
  "title": "Приём платежей в Badoo   взгляд изнутри / Анатолий Панов (Badoo)",
  "views": 214,
  "duration": 2603,
  "published": "2017-04-22T14:47:35-07:00",
  "text": "меня зовут натали панов я работаю в компании буду до тех кто не знает году это такой сайт для поиска новых знакомств у нас больше 600 миллионов зарегистрированных пользователей есть мобильное приложение по себе популярные платформы мы работаем во всех странах мира и можно спросить где же хайло вот в этом вашем биллинге халат вот это скриншот наши интерактивные карты на ней отображаются платежи в реальном времени на выводится у нас на телевизоре в отделим и позволяет при иногда мониторить смотреть что у нас происходит куда платежи средств за месяц и чем больше платежей страницы с энтим ярче . на карте открыть и платежей очень много очень много в европе в латинской америке есть ножка в северной за все время пока он существует белик году мы провели порядка 120 интеграцией начале было больше потому что у нас были только эсэмэски в основном и постепенно все меньше и меньше потому что мы интегрировали плечи все что хотели плюс от каких-то поставщиков мы отказывались что-то укрепляли что-то удаляли меня очень не очень часто но иногда спрашивают даже наш собственный собственные коллеги зачем нам так много интеграции почему мы не можем сделать поучительного агрегатор который предлагает больше всего методов оплаты и пользоваться только им если бы мы были маленьким кента проект на самом деле то так бы стоило поступить потому что все платежные системы они предназначены для того чтобы упрощает жизнь маленьким проектом делать жизни легче вам вас всё будет на все один контракт они делают свой анти фронт позволяют как правило делать из коробки подобный отчет общем все хорошо но больших проектов есть свои особенности и об этом я и хочу поговорить сегодня первая особенность достаточно капитанская это то что для большого проекта важно надежно инфраструктура изначально мы были нашей в ссору не очень для 3d хотя вроде проект хай-лоу ты биллинг был часть этого большого проекта мы работали на тех же самых играх что сработал основной сайт у нас были свои базы данных для биллинга но нас это не очень устраивало потому что во первых было невозможно поддерживать различную конфигурацию если мы хотели какие-то особенно изменения в конфигурации для php джинсы для биллинга мы этого сделать не могли потому что код работал одних и тех же машинах у нас была одна единственная . отказа это сервер который принимает запросы от агрегаторов входящими фикации там что пришли деньги он был один потому что мы не умели собирать logis нескольких машин текстовые логе нельзя было легко масштабироваться поэтому то есть из 1 серго выходил из строя то мы должны были вручены как-то переключать трафик плюс у нас был один сервер на котором работали задачи по крону выполнялись обновление подписок captcha статистики и если он ломался тоже нужно было переносить скрипты кота в новое место и все ли кстати был доклад про наше облако от юрия срединного и как раз заказчики вы собственно этого облака были мы изначально и в те давние времена у нас была проблема с тем что сайты мобильные приложения не тепло или по-разному и + мобильное приложение мило более долгий бой долги итерации не пользуюсь разве не делили даже 1 месяц и если мы какие-то ошибки исправляли у себя в биллинге это быстро выкладывали это на сайт то мобильное приложение болотоход через месяц и мы все в этот месяц видели все еще ошибки которые происходили приходилось как-то руками делать почти туда раскладывать это было не очень удобно мы поняли что нам нужно отделяться мы как минимум хотели сделать дублируют себе отдельную инфраструктуру сделали себе отдельную кластер обсерверов балансировали было срочно грузки поставили они поставили а сам использует тот же самый просто настроили платили чтобы входящие запросы агрегаторов балансировать между этими машинами а стих стали даваться наши платежные визарда и текстура получилась дублирован достаточно надежной но мы все еще часть кода выполнялась на стерве самых серверах где работал основной веб-сайт и мы решили сделать делиться еще сильнее сделать такое блинкова api стать таким агрегатором сервисом внутри нашей системы сервисом биллинга оператора на http протокола виде джейсона и отвечает на различные вопросы например если у пользователя активная подписка какое поле стиле баланс если биллинг в этой стране муки таки утилитарно вещи которые необходимо сайту и в принципе теперь мы можем работать если основной сайт лежит причем это может быть нужно например если польский начал платеж но мы ещё не получили модификации мы можем успешно обработать мы можем по анкете задача в баграм обновлять подписки принимать дефекации о том что подписка обновилась ну и много всего достаточно плюс на самом деле об этом упоминалось у нас один кластер а два у нас классе в приложении мобильных приложений если один из них ложится тому и процессе платежи другого кластеру 2 капитанская особенность то что в продаж не должен быть надежный код как мы этого добивались мы несколько лет назад начали менять процесс разработки очень сильно сейчас у нас он выглядит примерно так мы все эти киты для каждого какие-то создается отдельная фича ветка ветки собираются в релиз или совпадает мастер для каждой ветке у нас происходит code review вы пишете код ваш коллега должно посмотреть мы убеждаемся в том что нет ошибок то что все сделано так как нужно что требование которое указано в кете выполнены дествительно наш delivery system производят запуск авто тестов это папа юнит-тесты это теста селение ума которое тоже можно гонять на каждой ветке отдельности и для тикетов биллингом и принципе регулярно и угарно последний наверное в этот в этом году мы начали запускать их и докажу тикеты бинга прогоняют среднем тесто в дательном порядке если тесты зеленые все хорошо у нас есть несколько этапов ручного тестирования на нескольких окружениях изначально это сосна девелопер окружения которые пор он полностью эмулирует собой продакшен этикет уход к инженерам они могут посмотреть это если агрегатор песочницу не предоставляет то мы стараемся делать свои собственные заглушки и чтобы инженеры могли про кликать все платежный фол целиком эмулировать успешной оплату не успешную оплату окей наделили все хорошо следующий этаж от вот это тоже самое та же самая фичи ветка но которая работает в продакшен окружении чтобы проверить то что наш кот готов к работе промачиваем чтобы не заболеть и конфигурации что-то еще и для биллинга здесь мы сделали external шо ты особенность том что shot это просто локальный домен доступен только внутри нашей корпоративной сети но у нас есть требование о том чтобы тестировать нашу интеграции с агрегаторами то есть очень часто в с интеграция необходимо получить одобрение от агрегатора или от регулятора в этой стране о том что платёж на окно выглядит так как нужно то что сайт а не какой-нибудь еще не странный сайт там запустим что цена показано черным шрифтом они белым на белом и все прочее и в особенности это очень удобно иметь такую суку потому что код не выпадает в продакшен он совершенно и находится в зале раны и ветки если вдруг что-то не работает мы можем ветку откатить заново прогнать все тесты на ней и эту ссылку можем отправиться на партнером они могут делать всё сами все тестировать своими собственными пользу незарегистрированными бодуна мне нужно за этим следить делать какие-то костыли в коде чтобы только определенный пользователь с таким-то индификатор а мог этот год посмотреть и эта ветка может жить сколько угодно долго после того как мы процитировать все штатах никита сливаются в релизную ветку тестируются на стоянке в продакшен окружении все вместе на предмет того что все корректно замерзла сети киты ника хитрую с друг другом в порядке и код уезжает мастер второй важный момент то что наша стабильность наше качество он хочет наших услуг зависит не только от нас самих но еще от агрегаторов которым мы пользуемся потому что фактически биллинг это 90 процентов а то интеграции 90 процентов нашего сервиса интеграции со сторонними системами поэтому у нас есть определенные требования к агрегатором с которыми мы работаем с коммерческой точки зрения понятно что это какие-то комиссии пенсионные которые мы должны им платить какие-то условия контракта этим занимаются наши коллеги лондоне хищники точки зрения мы в основном проверяем технично надежность этого агрегаторах и документацию и функционал которые они предоставляют первое это безопасность не все но сейчас уже на самом деле все но когда мы только начинали не все агрегаторы посылали на модификации пошли дпс что-то делал по http второе это то что не все агрегаторы умеют делать повтор уведомления если вдруг происходит сетевая ошибками нотификацию даже не получили я уже не говорю что у нас и за ошибки могут в коде и просто не обработали то мы повторно модификацию не получим казалось бы такой простой требование тоже не все его выполняют ну и саму документацию конечно нужно проверить на адекватность вы читаете посмотреть что все понятно что все параметры как что мы можем отправимся параметр который вас интересует прежде всего это дискатор транзакций которые мы себя используем и ну просто льются api на предмет того что содержит все необходимо например если мы делаем подписке то что мы можем инициировать запросам закрытия подписки либо проверить ее статус чтобы иметь актуальное состояние что мы можем если это кредитной карты paypal то мы можем делать возврат средств пользователю и своей админки но к сожалению показание начнем работу с агрегатором напрямую тут пока мы не запустим в продакшн сложно одной только документацию и качественный сервис у него или нет что же как же можно убедиться в этом когда кот уже выложен во-первых это логирование логирование не только самих ошибок но и и логирование всех входящих запросов которые агрегатор нам присылает лагера не всех наших ответов возможных то событий которые происходят важных во время выполнения запроса это не один раз спасал она спасала у нас когда что-то что-то было неправильно в интеграции сделано вы могли потом повторить эти нотификации мы пишем очень много лоду стараемся делать это как можно подробнее они собираются всего одно место по которым мы можем удобно искать каждая событиями и свой уникальный гифи катар и с помощью это уникальный модификатор а мы можем смотреть и события которые происходили в рамках выполнения запроса вопросы-ответы ошибки и все-все-все следующее это конечно же мониторинг если для мониторинга системных вещей таких так циpкa база данных и расчета понятно но либо работает ли не работает есть это пороге например если циpкa больше восьмидесяти процентов сервер скоро умрет его нужно как-то разгружать то для мониторинга бизнес метрик не всегда можно подобрать пороге и они могут иметь какую-то сезонную сезонный характер вот на графиках показано 2 агрегатора у первого графика это мы получаем 1 неделю пучину уведомление о том что многолик подписки у пользователя они приходят строгого определенный день на другом агрегатор не обрабатывают модификации не брата по три живых 1 то есть если вы платите выходные там и уведомление о платежах получаем в понедельник и в данном случае ошибка является то что таких пиков не происходит а не то что они есть и это тоже плохо если их нету как что мы с этим делаем изначально пока он были маленькими пока нас было мало интеграции у нас были нарисованы эти графики с метриками мы смотрели на них глазами и на все устраивало все было хорошо но мы стали расти график становилась всё больше и больше смотреть на них не представлялось возможным же глазами это занимало слишком много времени мы сделали дашборде выводили только самой важной графики проблема вам было с тем что мы перестали видеть это маленькие проблемы не очень значительные . эта страна небольшая могла не работать и мы узнавали об этом только когда пальцы начинают жаловаться служба поддержки плюс мы звали добавлять новые графики на эту страницу но было не очень удобно и решили что нам нужно автоматизировать процесс к сожалению готовых решений мы не нашли которые бы нас вытворяли написали свой велосипед который позволяет нам мониторить и взлеты и падения нашего трафика мы можем задавать культа сезонную активность каждого конкретного агрегатора и плюс в этой системе есть встроенный механизм отправки уведомлений агрегатор отсылается почта с графиками с нашими и мы пишу пожалуйста разберитесь вот мы видим падение с нашей стороны что происходит нас вроде бы все в порядке да вам говорят спасибо иногда если мы вдруг видим что жалоб много это все эти запросы агрегатором лакируется о том что у них что-то не так и можно посмотреть потом статистику по всему этому кто больше всего генерит на проблем ко лбу чаще всего случаются отказы и в этом году мы садим таким агрегатором расторгли контракт по результатам следующая важная проблема уже не столь очевидное это то что важно следить за спамерами и фродом кроме того что это плохо влияет на репутацию сервиса это еще и может нести финансово опасность для проекта спамерами на занимается отдельная команда и с этим от проблем особо нету и часто эти группы даже спаммеров reader они пересекаются но к сожалению не полностью поэтому нам приходится заниматься отдельно фродом что это такое чем он опасен фрод это когда на вашем сайте злоумышленники используют либо базу данных ворованных карт проверяют работают они или нет либо используют краденые карты для того чтобы те же самой спамеры чтобы понимать свой профиль чтобы как-то привлекать внимание к своему профилю делать такую рекламу или просто помогать пользователи деньги опасен он тем что для компании прежде всего допросили понятно списываются деньги непонятно какие с вашей карточки очень приятно надо компания опасен тем что когда полюса ведет в банк и требуют чтобы ему вернули средства банка салафитов платежная система по той же система за каждый такой запрос на возврат срез который называется чаш бег выставляет вам штраф штраф может достигать 9 евро это особенно неприятно для сайтов в которых монетизация основном на микро платежах потому что платеж может быть один или два евро а штраф 9 см и получаем и только денег за транзакцию но еще и платим штраф 2 вторая вещь это то что если уровень кэшбэка в большой то платежной системы visa mastercard могут накладывать дополнительные штрафы в несколько сотен тысяч долларов или евро на компанию и сожалению когда мы только начинали понимать кредитной карты и не заботились а вроде визы к нам приходила и этими чуть-чуть такой штраф не получили как же бороться с такой вещью неприятный как фрод но во первых для кредитных карт и d3d сикер а если вы платили в интернет и видели такие вот формы выпали слеза thrillseekers смысл этот в этой проверки в том что вы подтверждаете банку что являетесь истинным владельцем карточки которые вы пытаетесь платить и прелесть видосик юра в том что если вы пользуетесь отправляем полетели на 3d стикер мы снимаем себя всю ответственный за фрод то есть если за фронт на счет банка 2 псел карту которая проводит эту проверку если frog происходит то мы не виноваты виноват банк которых некачественно сделал все замечательно но есть один неприятный момент страдать икером то что он негативно влияет на количество успешно проведенных транзакций изначально направлении за провели несколько экспериментов например у более темно-синяя линия это россия в ней у нас был включен 3d стикер принудительно для всех транзакций потому что страна считалось высокорисковых где я очень много фродо если транзакции уходили на 3d стикер после того как мы 3d стикер выключили мы увидели повышение доля успешных платежей на 25 процентов при этом уровень фродо остался точно такой же какой был чуть позже расскажу почему точно такой же эффект мы видели в италии столько изначально у нас там не был включен 3d стикер мы его включили для всего трафика и увидели падение примерно 20 процентов единственная страна которая мы не увидели изменение было окей не уровень трафика более-менее остался при такой же какой был не знаю почему возможно в вики польский привыкли пользователя стикером знаешь нужно делать и хороший пример тоже еще америка в америке когда мы включали 3 до сих пор трафик упал практически в ноль потому что американцы тупо не понимают что это за дополнительную форму и чуть не делать надо но мне в принципе карточки чапман только начали выпускаться в этом году тоже государства наконец озаботилось проблемой фродо в америке начала банки влиять на них чтобы они начали выпускать карты с чипами поэтому через обе спермы только проводим подозрительные платежи у нас есть система которая для каждой транзакции определяет и подозрительности есть список параметров откуда транзакция происходит ее стоимость была ли карточка с которой платит пользователь замечена в какой-либо продавая активности параметров много каждой транзакции присваивается какой-либо уровень если транзакция рисковая то отправляйся на 3-d secure бы блокируются если это китай регулярные платежи без участия пользователя а это позволяет держать нам уровень charmex достаточно низком уровне при этом сейчас у нас по моему только в нигерии включен . принудительно всех транзакций кроме того что мы проверяем каждую транзакцию на подозрительность можно делать еще такую проактивную защиту на самом деле найти всем проактивной то есть мы уже получили информацию о том что произошло чаш бег во первых есть компании которые подключены к банкам которые выпускали карточки и банк сливает им информации о том что пользу я пришел к нему сейчас беком они сразу посылать в платежную систему эти компании передают данные наших транзакциях нам и мы можем сделать по этой транзакции возврат но возврат самостоятельно без какого-то принуждения это называется рефанд из-за такие возвратом не платит никаких штрафов это во первых во вторых когда происходит чашу бег если все-таки он дошел до платежной системы то мы можем посмотреть использовался эта карта где-либо еще каких-либо платежах платил ли этот пользователь какие-то еще транзакции совершал на сайте или нет если да то такие транзакций тоже можно залив они использовали можно заблокировать добавив черный список карту можно добавить чёрный список много достаточно санкций но к сожалению пока нам не удалось это автоматизировать это делать в таком в полуавтоматическом режиме следующий важный момент это то что поскольку объем трафика у нас очень большой то нам важен каждый процент успешных платежей которые проходят я буду что в самом говорит визитные карты потому что это достаточно большой кусок для нас у стоит порядка тридцати процентов общего нашем общем доходе почему кредитной карты хотя ноты и покупки внутри приложений смазки достаточно большой кусок занимают а потому что это такой метод оплаты где мы можем как-то влиять на процесс платежей покупки в 3 положения и жестко зарезаны по сторону углом то есть мы ничего сделать не можно пользователь платит у них там системе мы еще не знаем никак не влияем транзакций то же самое смазки они жестко зарегулированы практически во всех странах и мы тоже делать практически здесь ничего не можем остальные методы оплаты нее достаточно большие чтобы получить какой-то чтимый эффект плюс если вычесть комиссию то кредитной карты занимают уже больше 3 почему кредитной карты такие популярные потому что очень простое flow одна форма одна кнопка пользователь нажимает все деньги у нас но если посмотреть поглубже то в процессе а под участвуют точно много систем это из наша собственная система и платежный шлюз которому подключен банк-эквайер это банк который подключён платежной системе который занимается прием платежей через интернет гроба процессе транзакции сами платежной системы visa mastercard american express и банк-эмитент это банк который выпустил карту и каждая из этих систем имеет свою собственную систему анти фродо который мониторит трафик и может либо принять либо отклонить транзакцию на успешность транзакции влияет много параметров это и откуда транзакция совершалось сумма транзакции частота транзакции но мы к сожалению не можем влиять практически на все эти параметры но 2 все-таки нашлись накат с которыми можем поиграться это мильчин категория кот том сиси и локальный корень вершин категорий код это кот торговой площадке он есть у каждой организации которая принимает платежи в интернет но не только в интернетом есть у любого магазина за углом а любая точка которая принимает карты имеет этот ход код для банка означает категорию продавца и на этом коде кстати основаны все системы кэшбэка когда банк выплачивает вам средства затрачены то на заправках в магазинах они смотрят на мир шин категории код и определяют подходит ли это компания под акцию изначально у нас был код который означал до этих экскорт услуги и доли успешно платежи на нем составлял порядка 50 процентов и тут оранжевую часть этого круга это было не очень приятно и мы решили попробовать себе что-то сделать тем более что мы начали работать фродо у нас был стало достаточно низкий уровень мы пришли к нашим партнерам и попросили дать нам что-то более подходящее для интернет сайт ну как бы дети рейтинг можно еще понять поезд друзей там не только друзей скотт услуги это точно не про нас мы получили новый код который означал телекомы и доля платежей успешно драматический выросла порядка на 30 25 30 процентов где-то так это было очень здорово причем ни строчки кода мы для этого не написали просто поменяв код который нас в контракте практически прописан получили такой отличный прирост плюс мы стали с этим работать дальше смотреть какие еще кода мы можем получить попробовали еще один который означает оплату за различные услуги социальные гражданские услуги сообществ и доля успешных же еще немножечко подросла процентов на 10 15 отлично следующий момент это локальный coloring что в нем такого хорошего и почему он так отлично влияет на долю успешных платежей во первых это то что в некоторых странах есть свои популярные платежные системы которая процессе скрипке например во франции это платежная система карты блюд и во франции очень много пользователей которые иметь эти карты если эти карты у вас на сайте не принимаются то они просто не будут ничем право другим платить франции изначально у нас был мы проводили платежи через такого глобального клара который не умел работа с локальными картами и когда мы поменяли поставщика для франции то доля успешных плат уже подросла вам 30 процентов за счет того что было первый банк находить находится в той же самой стороне где полового эти платежи и мы начали принимать локальные карточки следующий эксперимент был в америке в америке и других особых платежных систем нету просто только за счёт того что банк находится в той же самой стороне где банк выпустивший карту до успешно повысилась на 20 процентов происходит это потому что транзакции не переходит через границу то есть это взаимодействие между банками практически можешь кое-что напрямую и доверие у банков больше то есть это меньше добавляет розовых очков для система анти фродо банковских чтобы делать таки эксперимента мы разработали систему которую назвали работе платформа это такой умный движок для обработки правил пока эти правила у нас создаются вручную но мы работаем над тем чтобы это автоматизируете направлять трафик на в более мистически основываясь на статистических данных направлять его к тому агрегатор у и я банку клару которая обработать транзакцию наиболее более лучше плюс кроме того что мы можем выбрать наилучший маршрут мы можем делать форбак tranzaxis леонова агрегатор она не прошла то есть она что про эту другого или у третьего и можно делать оба тестирование например если мы не уверены где бук где трафик будет лучше у одного или у второго может быть наш экспериментах с локальными кого рингом это всего лишь фикция и на самом деле все будет работать так же хорошо и глобальным банком у которого меньше комиссии мы делаем оба тестирование смотрим что действительно все именно так как мы думаем и в этом году мы получили награду за эту систему от организация mercenaries council за инновации при по приему платежей по кредиткам в прошлом году ее получил skype в этом году осталось нам следующая важная вещь это подписки почему это важно потому что ну покроя как минимум у нас это примерно 50 процентов подписки в onclick платежи составляет примерно 50 процентов вдоль и всех платежей которые мы получаем и но там предыдущем графике учитываются все методы оплаты даже те которые подписок не имеют если мы посмотрим например на кредитке то доля подписка на клип платежей даже больше чем 50 процентов подписки бывают двух видов это подписки которыми управляют агрегаторы и подписки которыми управляют мы управляем и подписки которые правят агрегатор на такие агрегаторы это например applestore это google play это практически все но очень многие сама с агрегаторы тоже управлять подписками самостоятельно просто получаем уведомление и продлеваем поле услугу нас ничего не остается оос подписками которые мы можем управлять все достаточно интереснее в основном это достигается за счет того что нам выдается некий taken с которым мы можем делать и только подписки но и ванклиф платежи в пользу своим первым платежом дает нам согласие на списание средств всего аккаунта без дополнительных каких-то верификации мы можем сохранить его детали которыми он платил для кредитной карты для paypal а для банковским эта плата каких там сохраняются деталей если упала например то прям отдельный talking который пользователь может даже отменить у себя в paypal аккаунте запретить нам больше списывать деньги с его счета и использует токен то есть последующие платежи нам не нужны больше никакие данные поле стиля мы используем этот токен показан пользователю одну кнопку на нажимает и мы списываем с него средств либо мы можем кнопку не показывать делать подписки используя тот же самый taken если неприятная вещь то что такие токи на не привязаны к агрегату ру и для сейчас для нас это проблемы с кредитными картами потому что проведут проведя транзакцию через кого-то агрегатором мы должны все рекурентные платежи проводить через него же смотря на то что возможно было бы более выгодно для нас проводите у через друга проводить их через другого агрегатора следующая важная особенность для международного проекта то что пользователи инертны и любят платить тем что чем удобно и тем чем они тем чему они доверяют мой любимый пример это голландия изначально у нас голландии были включены того кредитные карты и paypal эсэмэски и общий трафик но был не очень большой после того как мы начали развивать альтернативные методы оплаты и включили в этой стране ходил все кардинально поменялась страна вырвалась в топ стран по доходу для нас и трафик на кредитных картах попали сама став практически не изменился то есть просто пользователи просто начали платить за счет того что мы дали им тут метод оплаты которые они хотели в германии картина немножко другая несмотря на то что там есть свой такой же банковские метод оплаты как я делал называется ford uber вайзен но пользователи больше всего любит платить paypal во франции все совсем по-другому у них очень популярен напильника или belinka такой стороны метод оплаты особенность интернет-платежей когда счет вам приходит в выплате за услуги в интернете оплачивая свой коммунальную услугу то есть вам приходится за интернет и вы оплачиваете какие-то подарки суперсилу но году или что то еще да и у нас был даже один забавный случай французы оказались ушным народом и начали оплачивать использует api биллинг в отелях нашему агрегатор с которым мы работали тогда пришла в крупной сети отелей сказала что вот у нас тут такие гигантские счета за интернет приходит это мы платим вам за что оказалось что пользователи вот находясь в отеле покупали себе что-то на базу подписки какие то мы получали за это деньги после этого к сожалению пришлось забанить пи адреса отеля ноги а нашей стране на стороне нашего провайдера но тем ни менее польше тоже есть свои локальные методы оплаты наиболее популярна это про желе вы мы его просто вызываем 524 но в польше почему-то люблю платить большие сама skype драйвер по нашим данным но тем ни менее следующее это локальный метод оплаты все равно не кредитки не paypal интересно график по россии есть бытует такое мнение что в россии микроплатежи это только эсэмэски на наши давно и показывать что это не так и у нас кредитной карты бьют всех кого только можно заключение подведу небольшой итог что если у вас есть уже целый отдел который занимается биллингом то стоит подумать о том чтобы сделать из биллинга отдельный сервис не забывать о том что качество услуг биллинга зависит не только от качества вашего кода в продакшене но это провайдера в которых вы используете пользу не забывать бороться со спамерами анти фродо me и если поток транзакций очень большой то нужно заботиться про уже процентов успешных транзакций которые вы проводите спасибо за внимание вопросы а теперь вы сами писали вы скупали у кого-то сами писали можно построить здравствуйте почему вы используете хтс от примера же использую вы можете просто сообщать о том что пользу там баланс изменился или подписка началась закончилась прямо сервису году они чтобы он там а мы также на так и делаем но просто помимо когда открывается страница нужно проверить если у пользователя активная подписка чтобы там что у вас же есть данные пользователя почему-то мне хранить там там в том в том числе хранился но некоторые запросы посылаются в биллинг и потому что данный лежат у нас ну то есть чтобы получить более актуальной формацию мы копируем в данных пользователя но актуальная информация лежит последних беллини поэтому издателю проверять добрый день большое спасибо за доклад у меня вопрос какой объем заказов вас в среднем в день и какую суде вы используете для мы чтобы до используемая sql потому что это основная база данных у нас проекте мы с ней начинали и продолжаем использовать нас пока все устраивает объем заказов я к сожалению на цифры не помню сейчас но примерно год а каждую секунду что-то пытаются купить на сайте спасибо продолжение предыдущего вопроса какой чуть детально можете рассказать про архитектуру в цифрах так какое количество серверов у вас плетей шин серверов front я так понимаю всего два да и бог нет ни 2 фронтов больше но не очень много да там и без несколько серверов не больше 10 на каждой площадке applications do a баз данных баз данных но основных 2 это не работал мастер мастер аппликации плюс под статистику счет формирование никакого пока нет но мы хотим мы думаем этим но пока еще не сделали потому что очень много коду нужно менять в эту сторону работаем но пока еще не у нас есть армирование которое работает для пользователей для основного сайта но для данных биллинга поскольку они изначально были в отдельную базу сортирование какого не было пасибо и 2 не маленький вопрос вы упоминали про логирование насколько это важно вас полностью поддерживаю потому что сами как бы процессе cделаем хотел спросить чем блокируете чем смотрите логе блокируем и файловой системой мы пишем лаги файловую систему и собираемых мы используем для сбора логов и контекстного поиска spunk а вы как с планк то платная система стоит не очень дешево но очень клёвые про выделение все ну сервис имели ввиду для предоставления его сторон или только как только бонент только для бар для наших внутренних проект к сожалению у нас были такие мысли как отделиться в отдельного badoo грешна к сожалению тоже совершенно другие условия для всего песня дескать не пойти и находим на обязательно и вырос мы сертифицировать на последней первый уровень мы сможем прошли сертификацию в доме сертификат а вот вы осматривали варианты сейчас вы понимали страничка оплату вас на агрегата или на вас зависит от агрегатора кредитная карта mon platin процессе полностью сами он точно не полностью мы работаем с несколькими агрегаторами один агрегатор на предоставляет это длина вот там до трех четырех банков у клайров различных поэтому мы работаем с одним что просто много контрактов различных не иметь завидной card modem от себя и остальное зависит от интеграции в основном это мы либо redirect темно похож на страницу агрегатора либо и такая кнопка у нас очень по-разному спасибо большое вопрос по anti-fraud системе насколько там сильно у вас секретный алгоритм и то есть мощь целевыми поделиться или вот выложить алгоритмы и секретные но я могу сказать просто пару примеров например там какой-то прям супер умная система не отправила отстраивался вручную на снова ну у нас есть аналитики а defro давай которые сет лондоне они анализируют трафик и поэтому после этого анализа делают какие-то правил то что нам дало наибольший эффект это во-первых мы проверяем по бену карточки проверяем а где карточка выпущено и если эти данные расходятся с данных геолокации api адреса пользователя это уже подозрительно например колчака в америке а портили снегири и это первый сигнал плюс допустим дает тоже положительный эффект это банить и api адреса которые из которых чаще всего происходят хердекке ну как то так нет идеи выпустить это в open source и или как-нибудь как мы ее используем для этот движок сторонний полностью нами написан мы хотели перенести к себе но пока это не целесообразно потому что стоимость одной транзакции достаточно низкое получается и просто за разработку поддержка все это самое мы можем сделать кристи все правила но экономически нецелесообразно анатолий спасибо за доклад интересные по делу вчера был хороший доклад про только считать деньги внутри используете ли вы двойную запись счета суп счета или у вас велосипед при велосипед или вы используете вообще отдельную там из 1с и что-нибудь вроде от 1с мы не используем во первых потому что мы деньги принимаем не через россию нас компании на кипри официальная но не признак не только на кипре и в которой процессе деньги вот естественно никакого 11 с а то что у нас есть в базе у нас не нужно никакой двойной записи потому что мы просто принимаем деньги мы их регистрируем когда она приходит нотификация точно списание никаких не происходит с баланс то есть поле дети деньги не тратить мы конвертируем и их во внутреннюю валюту эти деньги то что покупает баду кредита либо какой-то супер силу у нас на сайте и вот когда он тратит свои кредиты там да там есть двойная запись моему и приход и расход вычисляем то есть приход денег вы сразу конвертируете его лет а я уже считаете а по бухгалтерским добавим все большое спасибо у меня видимо продолжение этого вопроса я хотел узнать по поводу того принимаете ли вы платежи в различных валютах и каким образом конвертируете на эта вода принимая принимаем стараемся принимать в той валюте в которой в стране которой пользователь платит и соответственно для каждой для каждой страны свой прайс мы не конвертируем точно нас как бы не стоит там один кредит 089 рублей условно говоря у нас есть мы продаем кредиты пакетами . плате за там до 100 до 150 за 200 кредитов они имеют свою фиксированную стоимость в каждой валюте в каждой валюте спасибо спасибо за доклад вот такой вопрос вы сказали вас очень много интеграция хотелось бы спросить у вас как то это все унифицирована там или каждая интеграция это как-то новый новый код там много народу серова на то есть много каждый the grass у нас есть какой то игрок который занимается процессингом платежей и агрегатор просят такой плагин который мы подключаем системе пишем код только для api для взаимодействия для обработки модификации сколько по времени при он занимается секрет я написание кода занимает несколько дней с тестами вместе вот естественно полностью довольны production районе двух недель вот и quake iii с агрегатором спасибо анатолий ещё один вопрос по поводу тестирования может быть невнимательно слушал вам агрегаторы и последних представляют тестовые сервисы или вы сами мокко этих или когда предоставляют мы их используем чтобы не делать чего-то лишнего когда они предоставляют мы стараемся мог но по сути для всех вас обязательно есть тату и но и тесту интерфейса сожалению пока не для всех но мы стараемся то есть мы начали то делать недавно для очень старых интеграцию нас пока нету но мы в эту сторону идет из седла сто процентов соответственно вопрос случае если это предоставляется сервисом то ну перед вылив кай прогон тестов идет бежит удаленно к тестам airways увели он зависит от тестов uni-t станет это станет залогом баннерами селением тесто до они ходят до в тестовую систему и либо используют наши заглушки там два дня нет занимать несколько часов спасибо еще такой вопрос вы используете печь при выпечке есть болезнь да у них внешние запросы они фактически подвешивают процесс весь и допустим чтобы сделать конечную авторизацию приходится ждать его время ответы там всей цепочке которая за ней стоит вы затем что не вы делаете или просто увеличивать количество worker of и количество мы используем php вас сиджея него есть классная такая вещь это php посещать финиш request мы можем ответить пользу что мы получили запрос и транзакция процессе уже в бэкграунде в этом маркере поле виде таймер сна транзакция обрабатывается ложку и т.д. полезли получает сразу же что у него все получилось надо подождать немножко то есть еще раз этот финиш request он отдает какой-то припаиваем он дает тоже джинсу команда эти 200 ok так без без тела получается ну то есть можно тело дать какое-то да то есть можно дать тело все возвращает что все получилось и там какой-то ответ php worker продолжает работать понятный пути как-то фоне потом уже на стороне в браузер клиента до фоне идет опрос да якобы она просто опрашиваются сайт на сайте же спасибо здравствуйте у меня есть еще один вопрос в роду конечно если вы можете ответить используете ли вы культа внешнюю базу знаний по black листам карточек айпишник of либо это все сводится как бы на каких-то внутренних опытах но и в ноль и не флагов и то и другое то есть у нас есть свои собственные blacklist и которые мы сами наполняем сами используемый плюс наш партнер с которым как раз я говорю что там используем для обработки этих правил фродом он предоставляет эту базу в том числе него кучу клиентов и база шарится между ними по это закрытая базу да они нам и не отдают спасибо спасибо за доклад меня зовут артур хотел спросить вот немного про биллинг вы говорили что когда вот у вас проходит конвертация там кредит у вас записывать этой системе банер записи а вот там же получается когда вы получается там через агрегатор вы должны там платить какой-нибудь им там процент stanza акций вот эту вас как-то учитывается это такое я понял это учитываются но учитываются потом то есть мы регистрируем количество денег которые нам просто сколько платят пользователей или бухгалтерии потом отдельно на вычитаются процент со всего этого комиссии налоги и все прочее они потом под процессе все транзакции у меня еще 2 вопроса первый касательно какой размер вашей базы данных то есть сколько у вас таблицы и сколько оно весит и честно говоря я не знаю мы не мерили ну примерно самая толстая таблица у нас весело терабайт и мы ее оптимизировали недавно стал два раза меньше и второй вопрос касательно отчетности то есть раз у вас биллинг наверняка вы у вас есть отчеты которые бухгалтерию вас там генерит и если это так то какой что вы используете для отчетов там использовать или какие то там у лапку были еще что-нибудь на у нас отчета генерит бей . но мы напрямую занимаемся только процессингом и предоставления данных сбить все отчеты уже делаются через bay"
}