{
  "video_id": "AvvLTruHyy0",
  "channel": "HighLoadChannel",
  "title": "Трансляция HighLoad++ Весна 2021, 17.05, зал 7",
  "views": 1848,
  "duration": 32725,
  "published": "2021-10-04T02:50:23-07:00",
  "text": "по пунктам и онлайн а мир прием здравствуйте так нам 1 он кто здесь так а теперь не экскурсия о том как пользоваться конференцию всем привет если что меня зовут олег бунин организаторы конференции очень много одни одни из организаторов конференции ребят нас 150 человек над конвой сейчас в залог 150 волонтеров помощников help тимов кто угодно 100 самая большая наша маленькая армия да вот и первым делом пожалуйста надевайте маски обязательно когда вы ходите в фойе когда общайтесь с людьми соблюдайте социальную дистанцию в общем мы вас бережем мы очень много сил приложили чтобы дезинфицировать все-все рисунку ли ровать но вы тоже пожалуйста следите за этим смотрите по маскам там по маскам есть одна важная вещь кто переболел ребят нам с вами ничего не угрожает но мы все равно будем носить маски ну у нас же на лбу не написано что мы переболели и человек который перед нами он может волноваться он может беспокоиться того что читаю без маски ходим и так далее поэтому и просто оденем маску из за того что бы из уважения для того чтобы создать и для него тоже безопасное пространство чтобы он как pansky у нас на территории множество масок на всех выходах на стойке регистрации у любого организм вам дадут доске на каждого оптовых rolls парнем но нам с вами точно за будем носить мо а для того чтобы для за нас было безоп побеспокоился мы никому это не здесь есть ну то есть там просто же гриб идейный раздуты есть сера inima ta чтобы никто не мы понимаем это все ясно ним хорошо так а есть те кто работает потому что понятно думаем что все что-то на то есть как бы они все те беспокоиться он ожидает вирус не понимаешь что вирус маленький он пройдет через поры маски элементарно но мы сами тоже оденем маску у нас их много меняйте их каждый час если они там не зна еще что-то выходите на улицу подышать но пожалуйста всегда и везде всегда и везде из уважения к другим людям спасибо а теперь когда мы так долго говорили про маски давайте быстренько поговорим обо всем остальном пожалуйста прямо сейчас выключите звук своих телефонов чтобы не мешать спикеру и не мешать сидящим рядом возле вас тут 3 страницы олег пожалуйста его раз ел программа комитет highload очень большая структура очень большая структура то есть мы проработали более 200 окладов по 300 что лиц во всей программе программно комитетов несколько работает на хорган несколько цифр то есть есть программный комитет по архитектуре по machine learning у и так далее ну неважно да то есть мы готовили ивану год год то есть сначала мы он был полностью готов в ноябре но его перенесли обновили но в общем короче эта программа выстрадана лучшая программа за все время которое назвали минимум за год до минимум за год идем дальше расписание у всех у вас есть чудо книжечка на шее в ней много полезной информации это но самое важное это расписание этим очень удобно пользоваться не надо вертеть обучили наш типографии переворачивать листочки они научились встретил пару раз ну один раз перепечатывали один раз мы разбирали кольца перри собирали в общем обратите внимание пожалуйста у нас есть три расписание расписание в залах зала всего 8 в них записываются доклады это будет следующий зал следующий слайд есть расписание выставки у нас огромная выставка это тоже по-моему самое большое количество партнеров которые у нас есть за последние годы есть отдельное расписание дыма выставки где партнеры будут разыгрывать призы где вечером будет хабар награждение компания пробует награждать за лучшие блоги обещают концерт обещать сюрприз сюрприз и вечерняя программа и и вы можете посмотреть в брошюре выдается в зоне раздатки вот в конце брошюры также есть оглавление вообще брошюра такая толстенькая книжечка в которой написано много чем и в том числе как выглядит спикер чтобы подойти к нему и задать ему вопрос какой нибудь мы сделали оглавление он и имени и по секциям доклады собственно мы находимся в зале 1 и по кругу пошли зал и все доклады записываться бухгалтерия у нас получается справа от входа в выставку около 5 до так же вы можете увидеть кофе-брейк кофе-брейк у нас постоянный уже работает можно пить означает что в любое время можно прийти там будет кофе и немножечко перекусить а сейчас вот наша гордость это гибридные конференции на мы попытались сделать так чтобы перемешать online so fly нам то есть у нас здесь будут перед каждыми докладами будут онлайн вставки для нас для оффлайновых ребят а оффлайновые ребята могут прийти к нам сюда в зал почти ножками а то есть они могут задать вопрос мы его увидим мы потом после каждого доклада выходим цифровые кулуары да то есть это speed куда-то же можно подключиться можно подключиться из онлайна и увидеть как мы стоим по кругу докладчика задаем ему какие-то вопрос мы это попробовали это выглядит очень прикольно попробуйте сами как-нибудь накрыть из наших конференций в онлайне зайти то есть ты стоишь в кулуарах ты видишь кулуары там камера специальная которое выйдет фокусироваться на том кто к сейчас говорю очень прикольно ты начинаешь задавать вопрос кларк слышат тебя слышат видят и отвечают а те кто нас смотрит онлайн это я в камеру обращаясь обратите внимание у каждого зала снизу есть две кнопки задать вопрос спикеру в эфире это значит вы попадете на экран сюда прежде чем пройдете фейс-контроль наших помощников и 2 подключиться в дискуссионную зону то есть после того как спикер закончит отвечать на вопросы на сцене он пойдет в цифровые кулуары старая дискуссионная зона и там зум конференции онлайн ребята не стесняйтесь а теперь наша будущая теперь так будет всегда да то есть мы это сейчас внедрили через какое-то время ты внедрят с остальные организаторы вот так теперь будет научитесь использовать возможности онлайна более полноценно нас смотрит две с половиной тысячи человек на доложи рекламки две с половиной тысячи в онлайне а здесь 1900 и 2000 онлайн дальше обеды у вас в пиджак в кармашке сзади должно было быть два талончика если вдруг нет обратитесь на стойку регистрации кормим из 12 15 до 16 талончики можно менять кормим на втором этаже просто подойти к лифту мы на четвертом спуститься на два этажа вниз прямо под нами спускаете если открывается и вы в центре импровизированную не знаю какой столовой да если что на территории крокус экспо если вы хотите вдруг множество кафешек о том что втором этаже талончики с обедами можно менять время можно менять приходите на регистрацию менять эти конференции устраивается торги обратите внимание наш хэштег наш чат где можно общаться наш канал наш канал пожалуйста на него подпишитесь мы туда будем писать если вдруг что-то отменится если что-то перенесется или какие-нибудь другие организационные новости и чат и возле плееров но это больше для онлайн участников партнеры я говорила их много большое спасибо нашим партнерам и сейчас некоторых из них мы хотим пригласить на сцену чтобы они рассказали чего нас ждет вы же видели этот мини город который построен очень быстро поднимайтесь пожалуйста спасибо на самом деле на самом деле реально большое спасибо потому что мы выжили как команда как компания как конференции вообще благодаря им то что был период когда нам но никто то есть деятельность сняты вы ничего больше не делаете ничего не умеете и но смысле ничего никому не нужны и продавать вам ничего нельзя и только благодаря партнерам вот этим вот это это представители только на мне за четверть тех кто нас поддержал за этот год поэтому им реально бесконечно благодарны каком-то смысле жизнью спасибо всем привет у настроение ребят татьяна сверкай компания select all безумно рада наконец-то видит живых людей очень соскучились пожалуйста приходите на наш стенд давайте abs было ненавидеть and площадке обязательно участвовать в нашем у кого есть и и ждем я присоединяюсь тоже к уже сказанному на всех в оффлайне потому что от от онлайна действительно очень сильно устаешь я желаю всем и каждому сегодня для себя и сегодня обязательно послу в игрушек которые дела компании партнеров но и уже там тоже и но искать что за эти два дня argo не побоюсь on a flying конференций 2 года найдите что и унесите его домой а дальше по коллегам и обязательно посещая такие моя на пресс на речь будет очень хорош но вами благодарности во-первых большое спасибо возможно pub вы такой крутой и всеми любимый вам спасибо за доверие в первый раз думали и и тут и тут вы ответственность чем испытанные сложная для что все получится безусловно большое спасибо всем нам за то что мы дождались все-таки оффлайн невского формата финансы живых выступили живые выступления если поблагодарю ой campari и запад не за ваше выступление и берега горжусь вами помашу вам там на стенде и одному из выступающих все наступающим сегодня легкой аудитории нам друзья они очень рад всех видеть и огромное спасибо программу комитету за то что то брал бу ольга докладов нить конференция общение это еще и самый крутейший доклад поэтому ходить и слушай новое знание и уходите нами самими собой ура меня зовут максим я представь и у меня сразу вопросе сегодня на конфет спасибо за оффлайн оратором вообще что интересно трудиться у многих у нас нам работы мы это и делаем по map по настоящей такой городской мобильности этому классно что все здесь приходите к нам на стенд это голосом поиграть слушать про на ас всем спасибо да всем огромное спасибо на платформа skillbox мы здесь давить ваш личный бренд чтобы помочь собрать команду если у вас есть ваша проиграть в которых требуются молодые специалисты она в нам приходите на наш стенд спасибо организаторам спасибо вам всем а еще сегодня вечером skillbox наливает всем привет меня зовут алексей я представляем тигрица solutions мы разрабатываем высоком загруженные сервис продукты на базе не к той платформы о которой мы поговорим лучше на стенде с вами мы очень ждём и мне будет приятно наверное большинством из вас пообщаться поговорить узнать кто вы и узнаете что вас там ждет тоже при при хождении к нам вот то что я уверен сегодня будет очень интересное для вас конференция то что отличного настроя успехов и вынести здесь как можно больше и контента который позволит вам стать лучше спасибо всем привет я повел я представляю mail.ru и представляет не только тарантул который меня на спине но еще и mail.ru клауд solutions стандартно у нас есть стенд у нас есть мелочь вы знаете что делать давайте просто послушаем классные доклады мы уже достаточно затянули и кстати первый доклад наши он будет здесь не уходите доброе утро всем верны штерна лице digital наш стенд находится перед этим выходом из этого зала перед входом в этот зал мы занимаемся ускорением изменений в командах в людях и культуре организации если вы встречаетесь своей трудовой деятельности с токсичностью с сопротивлением с ригидностью со всякими такими вещами ну что жизнь то все равно продолжает идти вперед добро пожаловать к нам и нон-стоп два дня решаем поднимаем эти темы и решаем ваши кейсы всем инсайтов всем обмен энергии и новых знаний без десант культуры на нашем в нашем технологической технологическом мире большое спасибо еще раз благодарю вас и спасибо спасибо большое ну что поехали мы рассказали о том как пользоваться конференцией и последнее что нам остается сделать это ещё раз выполнить традицию представить нашего бессменного ведущего лёша образца алексей так меня слышно а в онлайне тоже пишите слышно ли меня если что я не лёшей образец меня зовут андрей смирнов я буду ведущим этого зала сегодня всех очень рад видеть не будут 15 раз повторяться про то что как я всех рад видеть в оффлайне это я думаю вполне очевидно давайте лучше мы перейдем сразу к нашим докладчиком вот и сначала перед нами выступит for лаврентьев он соответственно сейчас управляют платформой данных в яндекс гол и первый доклад который он выступит встречайте его а так точно а так меня слышно не слышно да а теперь слышно тихо слышно окей говорю дальше всем привет спасибо что пришли спасибо что пришли на самый ранний сами первый доклад доклад на такую печальную безнадежную тему как рефакторинг я ожидал что будет пустой зал будет три человека и мы с не просто камер на поговорим о жизни и грустно и разойдемся но я приятно удивлен давайте тогда начинать итак это история о том как я занимался большим проектом при факторингу в одной компании в яндекс такси все началось готов вернуть 1018 когда 2018 когда я еще не работал яндекс такси и меня был культа опыт я был техническим менеджером который занимался в основном машинным обучением и работы с данными работал в кучу разных компаний построил 10 разных продуктов и занимался консалтингом в своем маленьком мультики занимался в день внедрением и мыльных при локальных приложений под ключ обычно такое зрение начало с того что нужно было понять что люди хотят а потом понять что у них вообще с данными потому что машинное обучение но данными данные посуде пит питается обычно там какой-то хаос и нужно было с челки видя придать навести это нужды в конце шестнадцатого года ко мне пришли мои знакомые из яндекс такси и предложили сделать тоже самое но у них и не как console сыра прям вот внутри и почему тебя согласился вообще если вы не в курсе как выглядит работа данными то вот пример типичные по структуры взяты из какого-то древнего моего доклада что вообще происходит у нас есть какие то источники данных в компании это сервис и какие-то бэг-энда возможных это внешнее штуки типа google analytics и так далее мы соберем из них данные и запихиваем себе потом долго их чистим нормализуем складываем восстановили их связи в конце концов мы включаем cute систему отчетности и там какие-то люди из бизнеса понимают что у них все хорошо или все плохо если хорошо они радуются им вала чивают премии на основе этих данных это все плохо то они паникуют на такие за решение и если в данных все хорошо то решение боится иногда правильные а если данных все плохо то применить не будет до толиком быть называют ту часть внизу которое находится нижний слой целом от не очень важно для нашего доклада просто что мы понимали мире factory мне только сервисы и какие ценой и у нас есть большой набор большие объемы этих самых данных которые нужно возить туда-сюда и любая процедура с рефакторинга включает требует перекладывание каких-то гигабайт терабайт или петабайт данных иного формата в другой стрелочки нарисованы здесь и так называемый отель по pipeline и е т р ы т как раз фон bloat собственно вся логика себе на слове к таким процедурам и стрелочка заключается и концепции расположение всех этих слоев это их называют архитектурой стрелочки как какие возможны делать стрелочки называют потоками данных а сами стрелочки это деталь pipeline итак я прихожу в девяностом году индекс такие и что там есть есть довольно большой проект с которым уже 25 человека нет там много всего написано в разработке он несколько лет там есть команда человек десять 12-15 этом вес примерно 500 стрелочек довольно много написано много много кода и там есть несколько разных свобода от на съемки было три разных зуба да вот тут их как бы чуточку побольше как это получилось но мать очевидно так бывает со всеми такая наверняка видели у себя вне зависимости то чем вы занимаетесь сначала вы уже тикают к этому задачу вам на этот решение вы его масштабируете и немножко забывайте обобщить и какие-то архитектурные концепции в итоге получается что сложно и непонятно как быть в таких ситуациях люди напрягаются начинают не можешь это делать все почему-то начинает начинает падать если снижение с гондонами сделано плохо то мы знаем об этом от юзеров все друг на друга руб пишут критики ты постоянно боится некоторых aac возникает из зоны соблазн отвлекал при факторинга давайте вместе то перепишем что было наконец нормально и так что мы будем делать мы будем все переписывать на самом деле нет подождите до сначала понять что вообще почему такая ситуация возникла что происходит на самом деле если копают вглубь ситуации получается следующее как бы поинты которые которые нам нужно будет чинить во первых это сломалось никто и концептуальное понимание есть то что было сделано изначально она перестала выдерживать новым требованиям немножко под протухла целевая картина больше не видно поэтому и люди не знают к чему идти есть некоторый хаос глава с ним начинается все проблемой как не знаю что делать то делаешь все подряд и хотя бы клоков этого контроля и начинает взрываться ты не знаешь на чем фокусироваться ты начинаешь делать все медленно и хаотично и дальше идут проблемы уже прикладные в первую очередь ты прекращаешь следить за ходом это просто нет на это времени так корректируем фигуру не выдерживает чего-то ты начинаешь писать код code к хаотично выходя из своих основных концепций у тебя получается большое чрезмерно большое многообразие всякого если мог бы это все сделать унифицированы единообразно и некоторые вещи подумать 11 вот нормально вот это сделать сейчас не успел поэтому ты начинаешь каждый раз плодить какие-то локальные костыли заплатки и смелые решения из этого они сетов ногу не похожи их много они разные и они все разной степени ущербности и привод тому что у тебя в конце концов ломать за контроль над runtime то есть ты не унифицирован мониторинг для того чтобы они унифицированную процессы код ты начинаешь все ломать у тебя какие-то баги которые всплывают в одном месте ты чинишь они забывают другом такие же эти приходится еще не там заново все в общем очень грустно в целом это проблема на самом деле хорошо известны многим техническим и водителем и а не примет их решить как решать в целом для нужно во-первых вас томить концептуальное понимание понять чему мы идём построить не концерт целевую целевую картину который мы будем бежать и подумайте как к ней бежать вот только подумайте и но и подумать не клиник некоторые план перехода из текущего состоянием желаемое кроме того нужно сделать некоторый фундамент то что можно было начать на него переход когда рождения поломана нужно починить его рутинную работу нужно нужно поставить которая так логом понять что там наделал тебе надо выставить это фокус и если у нас есть некоторый негатив от заказчиков из бизнеса надо выставить работу с ними все починить мы вообще говоря нужно научиться нормально публиковать код делать релизы чтобы все каталась все было хорошо и уже после всего этого мы сможем взять и убрать долг то есть а при factory всякое мы находим находимся больные вещи приводим их чему-то унифицированным у все переписываем весело потом просто в пять минут пристаем плодить новый legacy код потому что пока мы не сделали первые несколько частей мы все еще платим кайта legacy и так вот рефакторинг находится здесь и хочется сказать про него на самом деле и от делать рано потому что начала нужно понять куда мы идем нельзя начинать рефакторинг какой-то небольшой проект по переделке всего пока это не знаешь почему the huge прийти и кроме того нужно быть иметь возможности все сделать нужно сделать так чтобы хватило сил на это значит и просто не рискуешь не выполнить свой прекрасной миссию и и сего этого диффундирует первый принцип рэдклиффа картингах терновым sound кто помог это нам нужно знать куда мы хотим прийти и так покатили во-первых что мы делаем это мы мы начинаем делать с самую первую платформу мы разделяем нашу команду на команду разработки инфраструктуры и команды разработки продукции данко и продукция команды разработки инфраструктуры занимается только построение нравятся его картины мы берем это отдельный ресурс команда разработки продукта занимаются ликвидации горячих более бизнеса мы разделяем команды по довольно нативном очевидного принципу в команду слева идут разработчики с на связи широким кругозором в первую очередь то есть меня пристально тесто люди которые смогут придумать как сделать нормально для этого нужно видеть какой то нормально в жизни иметь некоторый вкус к техническим решением поэтому мы беремся на людей у которых есть некоторые жизненый опыт они видели много боли и примерно представляют как и о будущем ликвидировать ее на старте для нас это очень важно поэтому если кидаем сюда больше половины команды считаем что это будет главное больное место в команду продукта мы в этом людей по другому принципу мы людей которым которым интересно делать ошибки это прикладные задачи потому что красоты команда справа на самом деле на самом деле делать что-то полезное команда слева это просто инвестиции в инфраструктуру который для бизнеса можно считать что они не купятся у смысле они бизнесу не нужны это некоторые налог на инфраструктуру и мы его как бы говорим что мы платим мы объясняем бизнесу что нам необходимо открыть отдельный стрим работ он будет заниматься с чисто развитием инфраструктуры и по сути мы убеждаем бизнес в том что он не хочет туда смотреть на эту команду этой командой будет заниматься только технический руководитель платформы там архитектор тех лиды и другой технический менеджмент важная важная вещь нужно построить некоторых бетонную стену между командами продукцию и инфраструктуры на момент когда-то происходило у нас было довольно мало людей нас не хватало на то чтобы покрывать все задачи поэтому фокусированию задачу продукта было таким довольно смелым и отважным мы делаем только супер важны и критичные вещи которые нельзя ни сделать мы не пытаемся делать ничего большого и сложного мы пытаемся видео сорвать какой queen и и и как-то начать чинить локальной болью бизнесом чтобы они начали нас любить и так принцип второй которыми делами фактом где то мы явно разделяем инфраструктурные tits in the future разместиться накатили поехали начал делать платформу команда продукция команда в истории делает делает всякая команда продукта че не всякая и мы начинаем мы начинаем осознавать чего же нам стоило все не бросите пить все сразу а стоило того что наши процессы поставки данных те самые стрелочки слайды с картинкой они поддаются о нем выпадать по миллиону разных причин и они палят по всем этим причинам бизнес недоволен для него есть и впоследствии которые критичные из последствия которые мы просто не приятны в общем люди немного недовольны и есть некоторые процессы которые подают регулярно чаще почему вот можно выделить на к 3 причины в целом они будут в каждом в каждой индустрии немножко разные у нас они вот такие как на слайде и возникает соблазн давайте все-таки возьмем все и перепишем но нельзя просто тогда тебе писать сотни тысяч откуда это у вас слишком много чтобы это можно было сделать разумное время на тот момент порядка 25-30 человека лет разработки туда вкопан а все это переписать просто оставить команду продукта на на год может быть на 2 мне так не получится многие сани переписывает это больно команда продукта в ярости они недовольны то есть тут его бизнес и на венгрию либо бизнес не довольно либо команда по таким довольным что мы делаем мы все-таки можем сказать что проблемы с этим кодом они объективно бизнесу мешают жить они стоят денег и можно их стоимость каким-то образом оценить давайте мы попробуем это сделать как это сделать во первых мы начинаем считать стоимость инцидентов вообще прям обычно обычно процесс что-то тикетов вас уже есть нам просто формализовать именно во имя на учет инцидентов и будем пытаться считать это метрики частотности инцидентов времени которые мы тратим причем это не обязательно делать совсем комп строгое формально точно прозрачно просто иметь место к это можно посчитать если честно то мы не поставили супер-огромный даже борт который все это офигенно классно учитывал мы просто начали учитывать все важные падения и все что реально вас болела мы начали видеть и что мы делаем дальше мы выделяем некоторые вот и продуктовых командах на то чтобы заниматься ликвидацией всего этого добра мы договоримся с бизнесом на то что мы какой-то процент усилия команды уделяем ликвидации эти долго по факту суть или факторингу и вот начинаем с наиболее больные места выпиливать кроме того мы вводим процесс дежурство это выделенный человек который занимается только тем что пытается стабилизировать систему и мы говорим что он не делает никаких сдачи тот момент времени то есть вы насаждаем вот всех бизнес-задач и он просто занимается ремонтом текущей фич сам чинит мелкие баги большие маген делегируют в команды продуктовые ну заодно у нас начал заниматься релизами потому что все падения не почему случаются после релиза фоне всем нам многие которые делаем мы это делаем и они после призыв те которые делаем ним и они там все время случаются он просто поэтому все время будет этот человек в чем-то проклят поэтому держу это например ну там мать день или неделю в зависимости от ситуации после этого мы даем акита плюшки типа отгулов чтобы он мог немного отдохнуть от такой тяжелой жизни итак здесь есть несколько трюков который использует того чтобы факторинг как-то пропушить и во-первых я выделяю зубную квоту на риф актин постоянно а вторых я ввожу отдельный ритуал дежурство мы-то некоторые пружиня человека в от ходе которого проходит закалку и сам становится лучше знать система может и при этом люди не выгорают до конца и при этом нет еще объяснять бизнесу что почему просто так них разработчик ничего не делает как стать ее мнению стоимость инцидентов слайд более подробный во первых нам нужно научиться ну трекать каждый каждый запуск каждой стрелочки нужно во-первых все стрелочки как-то друг друга назвать уникальное во вторых каждый запуск насчет терпеть для этого не обязательно писать кучу сложную структуру достаточно просто на 1 уровне логов там что-то научиться выковыривать каким-то эвристик вот ее то это можно делать довольно дешево после этого мы сделаем для дежурного некоторые инструменты которым он вы видеть текущую ситуацию что вообще происходит системе и сможет ей пользоваться и и на основе чинить всякая и 2 kermi проник про проект про кинем айдишники или хотя бы название падающих процессов для там что потом их можно было искать в идеале мы сделку это отчет но если честно мы клёвые чет не сделали и притом бы предпочли возможность найти историю всех падений что само по себе важно дальше для объяснения бизнесу нам нужно учиться читать стоимость всего этого добра честно стоимость рублях мы посчитать можно но это требует некоторых упражнений которые будут большой степени формальными поэтому просто договариваемся что во-первых это отнимает у разработчиков время и бизнес то покупает во вторых есть некоторые цели которые мы хотим выдерживать и частые падения чего-то нам поэтому силой убьют и бизнес тоже покупает потому что бизнес уважает а целый вот таким образом мы объясняем объясняем бизнесу что делать и потопу того что парит него часто это лечим возникает случае принцип что нужно лечить там где болит ненужной фактами все подряд нужно повторять только то что реально падает и реально больно чтобы лечить там где болит нужно знать где болит нам очень нужны приборы даже если мы супер техническое подразделение которые делают какую-то странную штуку нам нужно знать где у нас болит и так как в процессе факторинга стерилизации пошел команда платформы перед всякая и в конце концов chase co это время через там пол годика чуть больше ребята приносят нам какой-то законченную версию законченную это работающую версию новой платформы мы определились с архитектурой мы поделись со стеком придумали какие базы нам нужны какие познание не нужны мы поняли какие стрелочки бывают эти стрелочки остается кошерными какие не очень мы поняли как вообще правильно данные раскладывать мы поняли как все доступы контроль и модульности так далее организовывать и при этом мы закончили культа фреймворк который теперь уметь делать вещи типовым образом мы упрощает работу и выглядит одинаково везде и это прямо успеха все хорошо но на самом деле нет возникает некоторый конфуз что у нас уже есть другие какие-то базы данных которые надо что то делать у нас есть потоки данных которые не вписываются в общую картину дело с ними что-то нужно у нас теперь появилась кучу работы по моделированию данных мы хотим чего там теперь наводить везде порядок у нас есть много старого кода короче того сильно больше проблем которых надо подумать и вот здесь вот прекрасно что надо было сначала сделать это план перехода целевой архитектуры текущей ситуации катер volturi поэтому у нас был к это план и план был следующим во-первых мы прибыли что скорее всего мы не сможем сразу 57 стулья слишком большой объем работы поэтому мы установим и закрепим фокусируем команду прекратить платить что-то в нецелевом картине оплатить только в целевой с другой стороны и сделать себя не удастся поэтому мы вносим некоторые регламент как когда когда нужно прям переписывать всякое когда не нужно и чтобы переписывание было не супер тяжелом не полностью и не под ноль мы вводим некоторые режимы совместимости мы пишем в приманках разные wrapper и мы пишем какие-то косметики с вещами которые может быть можно использовать и начинаем пятьдесяти поверки которые пытаются выявить нецелевое использование фреймворков получается некоторый переходный режим ну так же ним так можно делать не везде например есть вещи которые просто нас не получилось сделать по частям и ты был бы слишком дорого мир тепло и тепло и нам пришлось инициировать сразу и это наверное хорошо все таки есть кит инвестиции которые при попытке рефакторинга нужно выплачивать сразу большим куском опасных местах мы уходим большую длинное приключение и чем принцип это нам нужно жить в эпоху перемен долго смиритесь с этим сделали начали раскатываете факторинг новую платформу но что-то вот она как-то не работает команда уже команды которые продуктовые уже привыкли конечным локальную задачу когда можно быстро получить это результат мы предлагаем вам делать такие большие довольно переписывания команды привыкли жить в каком то есть у каждого пилота свой маленький уютный мирок они в целом как с этим начали смеяться то есть целом как они адаптируется даже у apple локальное когда переход предлагаешь нам 7 трясти бы большую формирование систему они немного и недовольно кроме того концепция новой она довольно молодая и в ней конечно же есть огромная куча багов не тот непродуманно к недоработок и неудачных решений и мы сейчас нанесем на все наступать наступаем плюс окажется что никто новые концепции строгая она предполагает целевое использование нашей системы что-то типа 10 вещей для которых оно подходит если кто-то не подходит раньше он был подход что надо сделать мы сделаем поэтому некоторые вещи просто в новую картину не влезают их приходится выносить выкидывать или вносить заборчиком отмечаю здесь мины не ходи сюда возникает сопротивление со стороны как разработчиков которых которым подрывают их канон и все святой уничтожают что не была классная так со стороны бизнеса потому что просто внезапно начнет задачу делаться медленнее потому что разработчики катер но и занимаются зачем это все вот и так сделать сходу сплошные волной весь контент нас не получается что будем делать мы будем по принципу разделения властей есть нашего слона по частям мы назовем наш to date like на модули по принципу похожему на разбиении монолита на микро сервисы и начнем по сути проекты по откусывания кусочков нашего монолита будем постепенно их оформлять в отдельные сервисы на которые будем на каждый сервис при полете некоторые стандарт и общие правила их стандартов не ухудшать качество этого сервиса и дальше мы наш большой фронт работ дробим на кучу проектов маленьких локальных которые можно назвать так что выделив это модуль и зари фактор его чтобы он был был нормальным и у команды платформами появляется некоторый механизм playground для своих новых внедрений когда идет культ очередной новый большой мажорный этом проект с новыми мажорными улучшениями они берут какой-то сервис сами в нем наводят новый порядок реализуют всякое проверяю что штука работает сами погребают первую порцию багов расстраиваются чинит их выкатывает наконец и потом уже будет команда продукта второй пилот делать из команд продукта а дальше просто грамм что все остальные медленные ничего не успевают им позор они такие ну ладно черт начинают все делать итак здесь есть три окна выделяем отдельный проект при фактор ннгу локальной небольшой и мы никогда не пытаемся сделать все сразу мы мы едим все по частям это классно почему-то получилось потому что у нас пришли никто изменение за это время во первых команды инфраструктуры уже закончила большую концептуально часть работы перешла к точечным улучшением их там привела специализация не понимаю что делают с другой стороны команды продукты мы все в это время активно нанимали она сильно выросла мы перестали совсем уж прям безнадежно нуждаться в ресурсах и это я бы хорошие новости плохо новость то что мы все это время делали такой queen и они кончаются и в целом команды продукты понимают что дальше носить пользу маленького к ним лучше ними уже не получается и надо делать это большое к счастью маленькие quick вины позволили нам наладить контакт с бизнес заказчиками нас уже в целом люди поверили что так что эта функция может работать и можно делать менять целеполагания команд выводить платформы новый focus мы хотим как можно быстрее релизе но с 5 тысяч в продукт и наша главная цель это команды продуктов ускорять то есть новые платформы концепция готово теперь давайте ее внедрять и и убедит обязаться том что она работает для команд продукта меняем новый focus мы теперь будем делать все проектами эпиками вот как вот есть кроме есть и пике наверно в курсе надеюсь общем проектами все приходим на проект проектную работу и когда нас есть большой проект него можно помешать немного рефакторинга чтобы бизнес это не вызвал ярость чуть-чуть там вниз три раза увеличить атом типа в полтора скоб работы вот и планирование эпиков у каждого пика этапа конечный бизнес смысл бизнес польза и можно вовлечь вовлечь много заказчиков в конкуренцию за планирование и они предстают ходить на за то что медленно работает начинает хотеть друг другом потом потому что они воюют за место в рот mapi вот здесь из них три трюк с подвешиванием рефакторинга в проект вот япония мы примем его ok работа началась и мы теперь начинаем делать код какую начнет начинает улучшаться мы построили за такую-то рутину и в общем салон все идет тут тоже возникают некоторые проблемы уже совсем системно которого характера рефакторинг как процесс становится рутиной мы пашем и прошли период приключения и это просто стали однотипные задачи которые которые мы понимаем что делать мы подходим к каждой новой задачи и она в целом примерно понятно и люди ощущают некую скуку я нигде не начинается некоторые брожение в стиле что у нас в продукте какие-то все даче простые мы хотим заниматься чем-то более интересным и веселым и даже самый такой плохой симптомами понимается некоторые намеки на кастовой что вот там то нормально люди работают здесь это чуваки который просто клепать или одинаковых процессов как это грустно вот это очень плохой симптом надо было не доводить отвели надо чинить и кроме того мы сделали уже довольно много кода на еще манго досталось то есть там как бы уже какие-то тысячи разных стрелочек и нам нужно уже начинать их учитывать помнить что мы три фактически factory вот и это становится дорого и тяжело что мы делаем для того чтобы починить первую первую проблему мы сдвигаем фокус команд потихонечку перри балансируя x за задачи мы пытаемся увеличить разнообразие задач мы не позволяем разработчикам на только я стрелять в ком-то одном рефакторинга чтобы они не выгорали чтобы не становилось скучно если правильно заводчика стоит большой проект мы стараемся 3 бы хоть то больше людей чтобы они сделали быстрее либо перемежать эти задачи с чем-то другим бойлер разнообразному чтобы не видел как некоторые унылый конвейер мы начинаем площать запросы бизнеса на разные сложные хотелки если раньше мы говорили мы идем только вы queen и честный оборот что типа вообще говоря мы потому что мы даже отдаем нашим потребителям некоторые типовые задачи потому что из качества от формы мы уже можем это делать мы начинаем отдавать смежным подразделениями и типовые вещи а сами хотим заниматься только тем что другие поведением делается совсем сложно меняем наш портфель проектов по сути у меня им и поскольку и сдача в целом тори проще мы можем не мать мы можете развить больше джунов и рефакторинг на самом деле как такой вот совсем типовой уже его можно отдать его можно упаковать большой проект и отдайте кому-то как материал для стажировки вынимаем стажера и он проходит некоторую закалку в бою или factory что то что что всем там разработчикам опытным заниматься чем чем не интересно мы можем таким образом формировать широкий фронт на кучу стажеров и на весь код перепишут мы планируем сделать летом 1020 но лето выдалось не очень и мы хотим проверить добить этот большой факторинг вот этим летом в целом мы научились жить с тем что у нас осталось куча не дописана вы не дав активного года он уже перестал относительно проблемы мы его видим и мы научились его мерить мы научились взять какую-то модуль и понятия насколько там нас видимо не до конца учились делать нам сов научились ну чуть не понимаете насколько там нам кто-то нам нужен определенный модуль мешает много там осталось работы или нет насколько он вообще говоря нужен и что важно мы также трека им использование масть всех наших данных наших объектов итоге то и так далее чтобы понимать что вообще важно на что можно забить вас есть некоторые стрелочки некоторые данные которые пользуются какой-то там один экспертный процесс которые никто уже не трогал годы и возможно он не нужен вообще никому мы ему возможно выключим однажды но просто час можно его не тратить время это прекрасное он нам не мешает он прислал нам мешали потому что мы больше не подтекает вот и вот здесь есть еще один трюк который при факторинге мы используем это широкий фронт маленьких раза мальчиков можем себе позволить взять много людей пройтись вдоль по типовым вещам и важный принцип принципиально важны который нам очень много поможет это нам нужно избегать отопление людей в рутине везде не только ли факт рейган особенной факторинге и на самом деле здесь уже можно подарить какие то итоги а итоге они примерно следующее вот эти принципы песчаные слева это то чему мы научились в процессе этого огромного 2 годового приключения и трюки конфетные которые мы применили применяем для того чтобы впихивать рефакторинг в большой рефакторинг в наш наши восемь и clock ради этого слайда все ты писал можно считать что он последний спасибо большое что послушали до пасибо большое ой я громкий можно потеешь пожалуйста спасибо смотрите значит сейчас так как мы нагоняем расписанием и вопросы прям тут задать не успеем вот поэтому смотрите у нас есть старая дискуссионная зона или сюда встать отлично или зона цифровых кулуаров она находится сразу вот у выхода справа от тут и столб туда сейчас придет федор и там можно будет ему задать все вопросы также онлайн участники кто меня видит у вас там справа в плеере есть кнопка тоже подключиться там есть пароль все что нужно тоже подключаетесь там будет все видно его вы можете спокойно тоже пообщаться со спикером вот давайте еще раз перед тем как покинуть комнату спасибо федора отличный доклад спасибо большое спасибо да и коллеги из команды давайте поблагодарим еще федора насколько знаю мы должны ему подарить подарок так что далеко не уходи дедушка всегда говорил мне как важно трудиться и заниматься чем-нибудь настоящим где до знал о чем говорит он был агроном и всю жизнь занимался сельским хозяйством и я продолжаю его дело все начинается здесь еда которую мы одежда которую мы носим лекарства в которые нам так необходимы сельское хозяйство обеспечивает нас всем даже удивительно как многого мы добились тех каждый день мы создаём что-то новых изобретая планируем здесь и мне нравится быть к этому причастна ведь когда ты занимаешься чем-нибудь настоящему это всегда гарри 1 раз 1 1 1 1 1 там никакая 1 1 1 1 1 1 вот этот очень хорошо так слышно супер 1 2 тыс да хорошо да понятно нужно держать ручку друзья вот может я чуть потише сделать снова спасибо если там вот вам прям совсем не видно уже посмотрите вот тут вот есть места в принципе кто готов можно прямо сюда сесть наверно как наверное это будет отвечать требованиям социальной дистанции какие они могут быть при царице посту снова всем привет очень рад что тут так много людей я вот вижу там всё ещё проходит стоят люди наверно можно попробовать как-нибудь если вам совсем не видно тут разместиться вот но не знаю на сколько это получится очень рад что нас так много давайте тогда продолжать хотелось бы поблагодарить золотых партнеров в сети ma bell mail.ru клаус solutions и тарантул и представить следующего спикера it архитектор решение в компании айти one максим юнусов с докладом проектирование высоконагруженных систем на основе моделирования и теории массового обслуживания встречаем дабы утром уважаемые дамы и господа уважаемые коллеги хотелось бы представить вам доклад который название вы видите достаточно до сложное длинное на экране несколько слов по первому слайду слов о себе кто я уже было сказано главное city of the company you tell an работаю собственно профессионально то есть за деньги в этой отрасли с 91 года архитектором за это из 4 некоторого под имея с удовольствием хотел бы с вами поделиться что хотя хотелось бы рассказать о докладе коротко в двух-трех словах хотелось представить некоторые практике который мы используем реальные активно используем у себя в проектах это практике person связанные с поганый инжиниринг расчет использование математических моделей то есть сразу предупреждаю я замыслил недоброе да я хочу показать много формулы на экране показать математику многим надгробную эпитафию прочитал bird on air если помните было такое неприятное событие падения нашор ракета-носитель нас к космодрому восточного запущенного да возможно слышали об этом после чего собственно и причины были объявлены не удачное сочетание факторов которые не смогли тестировщики проверить сбой программное обеспечение привел к падению этой самой ракеты до после опять же выступал бетон мир на эту тему и сказал с этих пор я считаю что программный инженер мертва инженеры больше не нужно считать не нужно смысла нет даже если в космическую отрасль этим не занимаются собственно говоря кто у нас место инженеров сейчас за у нас сейчас эффективные менеджеры у нас сейчас собственно г очень опытные тех лиды да и архитектора с продвинутой интуиции но все же собственно говоря давайте немножечко отмотаем назад может быть все таки удастся откопать эту самую j5 и использовать посмотрим я предложу наши варианта решения возможно он вам понравится начну с самого простого так первая часть у меня будет посвящена тому что я обосную зачем мы собственно опять же возвращаемся к этой самой инженерии зачем мы используем математические расчеты вторая часть некоторые практическая покажу как мы это делаем примерные какие проблемы мы здесь получаем очень простым так переключение немножко запаздывает или не идет техническая проблема никто с приключениями слайдам тут сработает тут зависла давайте собственного я пока продолжу шов время особо у нас не выходила итак предположим перед вами стоит некоторая задача да вот неожиданно завтрашнего дня вы выходите архитектором на какой-либо интересный высоко нагруженный высоконадежный с повышенным тему них безопасности проекты собственно говоря что интересует заказчика ну высокая нагрузка высокая производительность высокая правитель нас интересует заказчика очень часто очень частый показатель очень частый фактор какие еще качество сейчас у нас популярны да с годами эти качества меняется на со временем становятся популярны различные так называемый и летим так теперь здесь не врать не переключает скоро тут уже поджидала тоже не будут так сейчас 5 кг да все заботу и так что интересуется нашего заказчика ранее интересовали такие факторы как гибкость отсюда например весь год до 90 е годы интересовали такие понятия как ясность кода сейчас собственная заказчика очень часто интересует такое понятие как время выхода на рынок вот снизу обозначена time to make так называемый до соответственно время выхода на рынок заказчику хочется быстром то есть ему нужно чтобы все вот эти качества были выше указанные соблюдены та же самая производительность для нас это часто время отклика и пропускная способность но еще и собственно говоря чтобы это все было но максимум в две недели до какие ограничения ставит перед нами заказчик обычно но зажигает что все это делаете быстро но людей деньги и время выделяем по минимуму но это естественно и требованием это понятно ну и опять же да неприменно и ограничения джейл куда без него в наше время пейзажа его никто уже не ходит и плюс к этому еще дополнительное ограничение последних скажем так 5 лет все любят майк россия в микро сервисы да то есть опять же куда без микро сервис овны в нынешний момент неважно в принципе что на самом деле это будет по сути но называться это будет микро союз далее как у нас делается джейл чаще всего называется русский процесс или русский водопад или русские джайю по-разному в разных источниках выглядит а так банальный водопад но собственно к при этом соблюдены все весь когда курс да все собственно г основные митинги аджай его используются но как минимум хотя бы стендап ежедневный проходит на самом деле все это длится где-то с полгода через полгода выясняется никто неприятностью через полгода это на самом деле первый раз показывается заказчику и заказчик вид слушает не совсем того хотел есть еще с приемочным и тестами и со всякими прочими хитростями можно добиться того чтобы попасть фичи ожидаемой заказчику то с нагрузкой с производительностью с надежностью попасть в это обычно не удается простой пример вот реально соседние команды работали ребята собственно соседней дружественной нам компании гнали вот эти самые фичи до фичи киллер твои ли погода работали через полгода собственного вышли на настоящую нагрузку вышли в пруд как всегда это высшего неожиданно для них собственно и получили что сообщает закачку слушай наши ты инстанса пост гаи не справляются с нагрузкой заканчивает хорошо сколько надо надо 240 в режиме мастер мастер собственной пусть работают ну как проект пришлось переписать ну и классические случае возможно у вас тоже есть такие истории кота вы можете рассказывать в чем проблема требований к производительности определены на уровне интуиции чаще всего собственно заказчика это хочу чтобы здесь было 200 миллисекунд сквозное время отклика да то что это путь например до севера который во владивостоке обратно в москву да это уже никого не волнует хочется 200 миллисекунд далее собственно грузка здесь две большие проблемы либо и сильно недооценивают либо наоборот сильно переоценивают запасом особенно если заказчик уже обжигался на этой теме давай сразу учтем что у нас будет миллион транзакций в секунду не меньше далее соответственно по проектированию да собственно как принимается проектные решения вообще собственно как часто понимается проектное решение архитекторами собирается некоторых консилиум выстраивается некоторая дискуссия да и собственно говорит тот кто громче всего за является решение то есть они и выдвигается да собственно ну на самом деле есть возможно в этом какой-то смысл у кого голос громче во того опыта больше да ну не факт конечно есть некоторые нюансы базам до принятия проектных решений зачастую либо то что мы пробовали и у нас получилось да так называя my frend на я архитектура до попробовали хорошо получилось давайте это использовать ещё раз и ещё раз и ещё раз либо наоборот мы этого ни разу не пробовали но мы очень хотим но не было мне в проекте ни разу на пиво тарантула но сильно хочется ну просто познакомиться что за зверь такой да вот на самом деле давайте его в тянем посмотрим как это работает возможно полетит вот как-то так далее соответственно и лизации реализация часто без оглядки на произойти нас вообще-то есть разработчики ли вообще не думают о производились либо наоборот оптимизирует все то что видео для все что движется оптимизируются опытные разработчики особенно это грешат до забывая о том что нам сказал своими кнут помните да известную фразу к и всех зол программирование это преждевременной оптимизацию тестирование тестирование собственно гая и готова бы вроде заняться тестированием производительности но надо построить макеты построить стенды и так далее займутся они этим очень нескоро ну и вывод в эксплуатацию вот здесь как раз все и случается вышли в эксплуатацию дали настоящую нагрузку посмотрели не получилось два раза переписали 100 эти операции через полтора года что-то пошло ну как то так можно это исправить можно без проблем нормальный отжарю процесс до continues интеграция continuous delivery continues deployment все вот это да собственно горшок continues интеграцию нас был настоящий они как его называют то есть каждые 15 минут мы знаем точно собралось не собралось случае чего либо сразу обкатываем либо сразу исправляем если у кого-то continent играешь на проводится рассудке вечером дата это не совсем а ну вот как то так станьте не с deliver и примерно те же самые подходы и в конце концов не на и тестирования так называемая эволюционная их текстура фича функции позволяющий нам определить что нагрузка работает да у нас что под нагрузкой все работает для этого нам надо держать параллельно дорогостоящий одинаковый похожий на проц стенд на котором все это будет запускаться все это будет проверяться непрерывно собираться и мы всегда знаем в каком состоянии 1 2 недели спинка позволяет нам собственно грешить наши проблемы в чем под здесь нюансы на самом деле микро сервисная архитектура и прочие сервисных титул указывают работу нескольких команд соответственно их периодически приходится выравнивать для выравниваем подгоняем чтобы все вместе собрали свои решения а это занимает уже достаточно продолжительное время и на самом деле получается там а реально не 12 спринта пару месяцев на то чтобы в конце концов выйти на нормальный нагрузочные тесты заказчик в принципе это может терпеть может не терпеть но если он действительно завязан на время выхода на рынок это его сильно разоряет можно ли устроиться в этом случае но можно конечно такой честный совсем отжал очень грамотно построить да ну не знаю очень мало команд которые работают по честному аджай у вас очень грамотным построением сам очень грамотными командами которые умеют во джайю и на одном бранче да все ну соответственно что думает на эту тему manager менеджер думает что вообще собственно эту тему заморачиваться не надо ты ходишь менеджер слушай уважаемый продуктов ним мы сможем с тобой потерять пару миллионов долларов если собственно говоря у нас вот этот вот такой-то иск что будет продуктов neff а что уже стрельнул на проди это уже было хоть раз не было но тогда давай не poets знак знаменитый на подход знакомый вам тоже дающим эти проблемы позже будет проблема будем решать и собственно говоря когда пытаешься с этим спорить приводит пример тот же самый а джае ву основоположники да вот в данном случае тот же самый king qr которые сказали да в основной части цикла разработки игнорируйте вопросы эффективности то есть производить есть не партесь закончите цикл разработки тогда думаем за производительность возможно вам знаком этот подход статистика показывает что подход не работает от своего совсем вот некоторые циферки 15 года и думаю к нашему время ничего не изменилось большинство компаний которые решают проблемы позже тратят на оптимизацию более чем неделю до на решение проблем к той возникли иногда существенно больше недели решением решение понятно мешаем проблемы до их возникновения очевидное решение да если мы внимательно почитаем классиков они об этом и говорят только вот эти вот цитатки которыми зеленым здесь обозначенным мало кто приводит что пишет носите в проекте лишь таки изменить которые могут указать дорогу к возможностям и улучшения заранее предварительно вносить проект да какие изменения вот что бывает классики если вы думаете что это только камбек так говорит не тот фаулер тот же самый известный многим чтобы гаити про язвительность я предпочитаю видеть и работающие систему и смеете характеристики учитывая полученные результаты применить строго определенной процедуры оптимизации и тут же добавляет то что не цитируют то что не приводит часто однако некоторых тектон решения необходимо принимать заранее молодцы ребята подстраховались да во всяком случае ни на какие судебные процедуры и не попадут никого не подставили некоторые проектные решения надо принимать собственного заранее вот единственная проблема не говорят какие и вторая проблема не говорят как но как я буду решать проблемы производительности заранее до того как построена систему и так есть очень хороший добрый старый опробованный метод математическое моделирование мы можем взять промоделировать до нашу систему до того как мы и построили формулы математика тем более что на самом деле компьютеры только функция до знаем что подаем на вход знаем что снимем с выходом можно все посчитать многие не хотят идти в эту область по одной простой причине построение математических моделей это очень дорого вряд ли у вас в команде есть профессор математики который сможет это сделать быстро да собственно эффективно мне все время повезло у меня был преподаватель математики ушедший из университета ставший простым программистом его эксплуатировал как математика при построении модели ну не у всех такая удача ввиду сложности этих процессов многие сюда даже не смотрят программный инженер мертва мы об этом уже говорили что могу сказать на собственном опыте проверено на опыте зачастую построение математических моделей во имя нескольких минут сложность этих математических моделей элементарно это просто алгебра простейший алгебра собственного ну и при всем при этом польза от них достаточно большая экономит огромные силы чтобы не быть голосовому хочу привести очень абстрактный пример конвейер я работал на очень многие компании том числе их баинг почта россии вот сейчас разрабатывают смягчит и и собственная конверт попадается везде поэтому его взял так как интересный пример возможность с чем-то подобном работаете вы кстати слово конвейер да это очень древнее слово там собственно бы погоды фильтра до архитектура конвейера по-разному его называли в разные эпохи помню собственно говоря одна девочка архитекторов solution architect at его чтобы у нас было только многоуровневая архитектура и приходилось фильтр расписывать по уровням фиг ты пела уровне feat фильтры второго уровня и так далее сейчас эти фильтры называются микро сервисами но это дань эпохи да тут никуда не деться вся на конвейер остается конвейером простой пример возможно тоже знаком формирование печатных представлений на вход приходит некоторое сообщение на выход должны идти печатные формы пригодные для распечатки потоки собственно говоря на разных проектах у меня были разные да собственно тысячи сообщений в секунду до миллиона сообщений в секунду которой необходимо собственно превратить печатные формы в частности там на почте россии на период цеха гибридной печати занимались молотили все это с огромной скоростью и так то его не заказчика я думаю понятно да по нагрузке еще к этому добавим чтобы было веселее требования по времени отклика сквозное время только время обработки в данном случае будет у нас не более одной секунды на одно сообщение дома я задача простая многие решат влет да здесь редис здесь тарантул здесь рыбе темп и все полетело ну ладно и рубит in kidney в моде да даже не кафка уже пульсар собственной попытаемся все-таки посчитать перед тем как использовать технологии как это сделать 10 такой замечательный метод называется из п и софтвер performance инженеры хороший метод вот здесь как раз диаграмм когда упрощенное как его использовать по шагам у более просто здесь сразу скажу я не буду вдаваться в детали есть такой шаг здесь оцениваем время выполнения каждого шага то есть мы должны сказать сколько мы будем выполнять процедуру на каждом шаге желательно в тактов вместе когда-то в 90-е годы это было возможно то сейчас собственно это несколько затруднительно заранее угадать сколько фактов потребуется на выполнение этой процедурки у вас да это проблема то еще да и отсюда собственно гаем эта модель немножечко притормаживает не работает что делаем вот собственно и первое отступление от методологии которые хотелось бы вам предложить реально из опытом что мы делаем свою очередь вместо чтобы оценивать мы бюджете ruim есть у нас одна секунда давайте аккуратно ее про бюджете ruim одно то же самое что напел вы составляете бюджет семьи да но так условно и получаете вы на пиво 100000 рублей в месяц 8 ходит на ипотеку до 20 раскидывайте соответственно на свои удовольствие питание кварплата и стран как вы это делаете но зачастую нескольким некоторым произвольным образом до с учетом того сколько стоит альная задач здесь тоже самое передаем бюджет и разработчикам отслеживаем выполнение его ним на уровне итерационных тестов интеграционных тестов то есть если мы этот бюджет тебя кидаем разработчикам нам не нужно собрать забирать полный стенд чтобы оценить как будет работать система в целом на каждую задачу на каждый этап у нас выделен бюджет а за бочки попадаешь бюджет значит все замечательно система работает в целом исходя из моделей используя микро benchmark опять же для оценок ну и заключаем контракты с внешними команда мигаем вы тоже должны укладываться в бюджет вот эта операция у вас должна быть выполнен не доля чем за такое то время как то так над каждым этапом проставляется цифра да вот здесь видно 10 миллисекунд 100 миллисекунд так далее расставили исходя из понимание сложности операции можем эти цифры передавать разработчику сосуда для работы сожалению нет это самое первое наивное представление эти цифры нельзя передавать здесь много чего не учтено прежде всего что здесь не учтена в этих цифрах то есть а за бочек может сказать вот мне дали 500 миллисекунд я в них втиснулся на своем рабочем компе все замечательным конкурс на заказа качка будет точно мощнее значит там все вообще полетит вот пион такие соображения на самом деле неплохо бы учесть нагрузку почему да потому что собственно сообщение те же самые болтаются в очереди намного дольше чем выполняется собственно иисуса на том же процесса и на диске и так далее находясь в очереди они занимают больше времени простаивают в очереди как учитывать нагрузку тоже елена таран надо разработчики как это примерно себе представляют многие у меня тысячи операций в секунду значит собственно говоря одна тысячная секунды это и будет время выполнения моей задач если задача будет выполняться одноточечную секунду то исходя из статистики у нас получается без конечная длина очереди бесконечное время выполнения почему к сожалению потому что задача приходит неравномерно не периодически приходит случайным образом с некоторыми скачками формула несколько более сложная нанесите на сложные вот здесь их привожу не сильно сложную форму по ним можно рассчитывать что-то да в том случае когда задача у нас независимы далее соответственно обратная форму мы с вами ишаем обратную задачку несколько то есть у нас по времени отклика эрте в данном случае считается время обработки доступны время обслуживания от получается что если у нас 500 миллисекунд то время обслуживания допустимое меньше чем 1 микросекунда две тысячи операций секунд вот такая неприятность отдавать бюджет в 500 миллисекунд разработчику было абсолютно не остроумно да мы не решали задачу полностью очевидное решение как можем собственного немножечко облегчить жизнь и а за бочку масштабироваться до если ваш семейный бюджет тысячи рублей в месяц 100 тысяч рублей в месяц до как лучше от масштабироваться вдвоем вы уже получаете 200 до или как горят на западе втроём уже 300 то есть там есть вариант таким образом собственно масштабирование решает нашу задачу тысяче ядер собственно гай мы делаем нагрузку 1 одно сообщение в секунд сейчас это легко у нас купюрница у нас динамически масштабирование соседа собственного 1 по 2 раскидали все полетело были в деньги время обсуждение в этом случае при одной операции в секунду у нас видите все но не 500 333 миллисекунды в бюджет и она меньше это из-за вот этого неприятного момента из-за распределения можем передавать эту цифру разработчикам как думаете нагрузку учти это все вроде учли все бы было хорошо но все плохо на самом деле ситуация еще хуже приведенные выше формулы работают со средними величинами в 330 это саидин к среднее значение а заказчику обычно не хочется чтобы у него в среднем до все выполнялись за секунду ему хочется чтоб все выполнялись за секунду ну или вы если вы с ним договорились 99,5 процента выполнялись в секунду фомки которые позволяют papers in te дам все это раскидать соотношение среднего с перцентилями здесь приведены мы ими пользуемся достаточно условный но работают хорошо если у вас перцентиль 90 95 то делитесь соответственно 5-тый в итоге что получаем 80 две миллисекунды против 500 о которых мы говорили ранее я думаю понятно да в чем не приятно здесь и так что мы сделали уточнили у заказчика и тайване с учетом перцентиль распределили время по контентом по компонентам извините используем полученные знания вывели соответственно последнюю цифру бюджета можем отдавать ее разработчикам все ушли на иных самые хитрые догадывается что не все иначе покиньте сдавал этот хитрый вопрос на самом деле есть нюансы все хорошо но есть нюанс введенные выше формула работает когда у вас собственно распыление нормально и летом собственно полноценно там вот это господи как специальные так далее то есть вот это самое м помечаемые буковками возможно вам знакома эта форма кендо вода когда там очень у нас помещается ммм коми когда у нас м учить и нормально мы спели не все хорошо все это работает но бывает что воспевание вас не нормально немножечко такой немножко более хитрое вот такой вот здесь вам издалека не видно это хвостик нарисована вот такой длинный хвостик распыление с длинным хвостом да в этом случае все плохо например если нагрузка увеличится в 2 раза во сколько раз вы имел только увеличится и очень длинного хвосте может увеличиться в бесконечность вот такие страшные вещи поэтому распыление надо учитывать ту же форму когда счет распыления здесь приведена тоже достаточно простая но выглядит конечно страшно но как ей пользоваться на следующем слайде я покажу как задачка очень простая здесь до сообщение у нас бывают сложные и простые и сложные обрабатывается примерно за 005 секунды даст точнее простые сложные за 2 секунды процент тоже примерно здесь покинуть до вероятность того что придет сложно или простое сообщение соответственно расчет идет следующий время отклика считается исходя из этого по формуле который показывает нам что мы не укладываемся в наши цифры из кстати дак словом фактически как вы это все используем как вы можете это все использовать есть куча программ стоит бешеные деньги там в евро и так далее позволяющие сети математические модели считать я рекомендовал бы excel дешево и сердито загнали модель куда собственно я сразу получить результат можете тут же что-то менять нагрузку проценты и так далее все эти формулы достаточно легко об считываются и касаемся математическая модель здесь работа своей активностью вариативности то есть изменением частоты прихода сообщений изменения в длительности обработки сообщений влияет на до имел только намного более существенно чем даже утилизация ее надо учитывать с не надо бороться честно ко мне лень писать вот такие сложные формы вот эти все сложные расчеты проводить рисовать эти модели в excel поэтому я боюсь очень простым образом есть у меня два потока задачи сложные простых сразу развожу на разные севера и все то есть один сервер у меня молотит сложные задачи другие простые вариативность в рамках каждого сервиса у меня получается достаточно стабильно предсказуемо и расчеты простая и производительность максимально эффективно как то так в итоге что мы сделали с вами про моделировали проектируемую систему в excel определили вопросы для уточнения требований какие там перцентиле нужны к заказчику использовали павел эффективных тактик масштабирования да и разведения нашей нагрузки по вариативности получили на руки цифры для обсуждения бюджет для разработчиков сколько им там можно на выполнение операции отдать предположение и контракты для внешних команд ну и сайзинг для бизе для бизнеса да мы с вами потратили на это 40 минут но я здесь больше говорил чем работал на самом деле на практике это примерно так же выходит около часа и вас модель более менее готова варьировать в ее можете вообще в секунды используя иксу в дальнейшем соответственно модифицируем нашу модель используя стратегию адаптируемой точности отгоняем циферки выявляем узкие места в системе определяем где самые длинные очереди собственно гаи узкое место и начинаем собственно бором тактик бороться с этими узкими местами до здесь у нас тоже есть свои методология свой подход свой чеклист какие тактики самые безопасные какие наоборот лучше оставить на потом например известно что кэширование это взвода и и лучше вообще никогда не использовать эту тактику ну и собственно говоря это правда рамки данного доклада уже не влазит у меня поэтому собственно этом месте я прерываю доклад и собственно говоря предлагаю перейти к части вопросов-ответов спасибо большое важно отметить что те кто нас смотрит онлайн у вас нас паровой с кнопка и или слева ну где-то оно там сбоку есть что подключиться в эфир и вы можете прямо с вывести вас выведут на экраны вы прям зададите вопрос лично спикеру это очень интересный опыт на мой взгляд а так ваши пока начнет задавать вопросы из зала поднимайте руки к вам подойдут девушки и 1 по микрофон да за самый лучший вопрос мы выручаем книжку вот которую максим вручит вне зависимости от того вы в онлайне или в оффлайне мы вам пришлем или дадим здесь пожалуйста человек с какой ролью занимается данной работой но в данном случае вот на разных проектов по-разному бывало да собственно и гаев мне как-то в жизни произвол меня программистами в математику да собственно занимался программист этой задачей но в настоящий момент все чаще это этим занимается у меня архитектора но предыдущем проекте этого учитель добрый день спасибо за интересный доклад вот ваших моделях очень интересно все расписано конечно платоновское распределение так далее как вот учесть часы наибольшей нагрузки когда больше вообще не поступает пиковые нагрузки вот да хороший вопрос на самом деле для по учету собственно пиковой нагрузки реально делаем самое простое решение здесь и предполагаем несколько режимов работы системы в нормальном режиме в пиковом и жиме и так далее прочитай модели для каждого режима отдельно собственного и смотрим что у нас получается и возможно уточняем требование напел предполагаю что случайно пел ddos-атаки мы позволяем себе снизить немножечко наш выпуск нашего и мед и когда ухудшить вот как то так то есть разные режимы работы да спасибо за доклад а у меня такой вопрос в плане многие любят видите как изменяется модель в динамике то есть просто как бы вот мы сейчас видели голые цифры это конкретно как раз они отражают информацию конечную и у меня был такой опыт когда значит составляли имитационные модели значит ли заказчика чтобы показать как будет модель вести себя в этом плане я понимаю что некоторые формулы из этих можно инновационную модель наложить что примерно понять как который вот-вот как ваше мнение сталкивать вы сами модели студенты то есть да тут два варианта есть расчета на самом деле имитационные модели для собственно г то есть те которые используют статистику прикидывают собственного реально там моделируют ситуацию верных поступлений запросов и так далее сообщений и собственно математические расчеты более простые аналитические да вот мы как раз более активно используем аналитические расчеты основаны in an вот то что его показывал этот теории очередей до известная возможно вам собственно говоря им ценные модели мы тоже использовали но честно говоря они требуют больше затрат на своей подготовке эксплуатацию или соответственно до покупать уже готовый продукт который позволяет им подобное моделирование проводить и не всегда это возможно тем более я работаю на аутсорс и да собственно говоря мне каждый раз приходя в проектов проект надо тащить за собой все продукты до заново все этапе покупать это неудобно мне удобнее работать с простыми моделями хотя в некоторых случаях согласен это эффективно было имитационной модели дают больше точность но с другой стороны для оценки мы используем как модели чаще всего для оценки простого случае сложного случая то есть пессимистической оценки оптимистической есть мы попадаем с нашими требованиями между ними то все замечательно то есть нам точность особо большая не нужно нам достаточно границами кота ценить добрый день я тут у меня скорее вопрос такой административный ваш проджект менеджер он в курсе что вы используете вот такие подходы для на последнем проекте пока это не внедрил да поэтому начни в курсе да и связанный с этим вопрос а как вы убеждаете проджект менеджеров что это действительно стоит делать и что это прямо правильный путь ну поджиг менеджеры бывают двух видов да как был мартин фаулер не буду повторять за фрагом что в некоторых случаях технический специалист должен саботировать решение project-менеджера да и то не очень хорошо по большому расклады убеждать всегда приходится деньгами да прежде всего мы показываем риски то есть собственная в процессе анализа задача ну как это проводится до чаще всего проводится мозговой штурм силами архитекторов и сих много да собственно или если у нас нет детекторов силами технических специалистов просто рисуется диаграмм к компонента и там прикрепляются стикеры риск здесь есть здесь потом садится кто-нибудь один и переводит эти риски в деньги на язык понятный менеджером что если мы здесь вот залетим давай тому моменту то мы потеряем столько-то если здесь потеряем stockade и вот это все подается на стол поджиг менеджер соответственно прага менеджеру project-менеджера у кого кто отвечает за финансовым соответственно на этом языке разговор получается достаточно конструктивной спасибо добрый день спасибо за доклад мне один вопрос частные так скорее докопаться а второй дан более глобальный частный вопрос это то что не секрет что иногда выполнить 10 операции дешевле чем 2 по очереди и как если более того заказчика очень часто нужно ни за одну миллисекунду выполнить задачу a million выполнить за минуту соответственно какие-то куски могут вот таким образом обрабатываться пакет на как адаптировать модель для пакетной обработки более глобальный вопрос вы очень интересно сначала устроили затравку pro 130 серверов под гримом уклонились от рассказа собственно как же ваш архитектура напиться на решение ресурсных задачу потому что у нас есть как минимум сетевая пропускная способность диски память ядра и разные задачи в разные ресурсы упираются о вашу модель сейчас от не учитывают спасибо да все так и есть собственно на самом деле 1 но начну я со второго вопроса так сформулируйте еще вас да пожалуйста как как вы его начали но я так услышь модели не только к учету времени обработки но и ресурсов данного это 1 сдали это 2 а первый был как адаптировать модель капот batch обработки отдельных задач да все правильно и так собственно и по первому вопросу однозначно успела вопросы как адаптировать модель собственно к обработке матчевый до сложных задач тут все то же самое на самом деле реальность просто единственное что вы рассчитываете это исходя из нагрузки при высокой нагрузке но если вы обратите внимание ожидаемое время отклика на самом деле варьируется очень медленно в зависимости от нагрузки там меняется собственного очень незначительно процентами там не ледой долями процента да там все упирается в нагрузку при большой нагрузке действительно производились ресурсов имеет большее значение модель собственных достаточно хорошо подходит и для подобных расчетов если вы примерно представляете сколько у вас идет там собственно тельной операции потом собственно сами операции достаточно понятны и прогнозируемого их очень просто можете пометить башмаками до работа с памятью да ну как в гугле есть может быть знаете таблица до цифры которые должен знать каждый разработчик сколько времени у нас уходит на операцию ввода-вывода сколько времени у нас уходит на сетевую до операцию и так далее да знаете например в рамках сода у вас пойдет там две миллисекунды там например на обмен сообщениями в рамках суда да там или собственно при работе с диском данную сколько там есть у вас не дай бог какой-то хддд тонто еще и база данных из кельна и да там 200 миллисекунд например на транзакцию ну что то в этом роде примерно такие цифры представляя вы можете представлять как вы работаете собственно г с иисусом и понятно опять же что мы делаем когда мы работаем с усами нас этих ресурсов не хватает их всегда не хватает не хватает 5 всего чего диска до самый противный иисус время операции вы не согласны но может и памяти нас памяти сейчас проще стало когда-то давно-давно памяти жутко не хватало там все в тиски вали собственно гать постоянно помните времена для меня сейчас память не является уже таким страшным местом как они на самом деле чаще всего самой медленной операции дисковые дабы приходится их оптимизировать что делаем самое страшное что можно придумать да собственно это сплошное проецирование когда собственно данные необходимы для выполнения задач проецируется просто в то место где они будут востребованы для собственного это сплошное копирование данных да и поддержка согласованности дальнейшее да это надо очень и очень аккуратно все делать понятно очень очень аккуратно разводить но это дает эффект по производительности она является основным качеством данном случае другие качеством при этом гробим конечно прежде всего поддерживаемых систем я ответил да мысли возрасте антон devops у меня вопрос такой ваши математические модели они где-то в бизнес цикле предприятия состоят ли то как программное обеспечение имеет свойство развиваться расширить свой функционал и соответственно иметь больший охват по каким-то метрикам показателем тем же и адаптация вот этих вот моделей где-то в цикле заложена и как это делается у вас да конечно собственно есть и собственно проекция процесс ставить на бизнес-моделирования над точно математической зените моделирование то естественно конечно это должно быть включена в процесс полностью включена в процесс начиная с этапа анализа где от аналитиков требуются сбор информации в частности более детальной до чем они обычно себе позволяют с точки зрения до той же самой нагрузки до учет нагрузки учет пирс intellij учет всего собственного по времени отклика и так далее все вот эти качества нужно выяснять чек-листы дополнительный да здесь появляются соответственно дальше соответственно этапе архитектуры появляется дополнительный пунктик необходимо проработать математическую модель производительности тоже соответствует включается до соответственно на этапе тестирования ты выливается в некоторых как сейчас модно говорить с функцию которую включено уже нас там в процесса continues интеграция так далее да собственно к которой проверяет эту нагрузку все эти метрики соответственно учитывается на всех этапах работы и дальнейшем модель адаптируется подгоняется после подгонки 1 дат когда у нас появляется реальные цифры ну как модель тут же адаптируется под эти цифры и собственная уточненные опускается дальше в оборот то есть это еще и те рациона идет то есть если правильно понял при проектировании фичу уже имеет смысл копателю адаптировать какой-то моделирование если мы видим ее skype производительности до то есть опять же как сейчас это беннет архитектору не прыгает на все задачи сразу так как это был в двухтысячных до собственного решает все только там точечно объем где у нас есть риски где мы можем не попасть во всем здравствуйте спасибо за доклад у меня такой вопрос по примеру немножечко не подойдет но частенько бывают система в которых данные после вот этого временного промежутка должны быть выброшены и когда мы подходим с точки зрения очереди прорезаем по медиане мы начинаем лопатить целую кучу данных которые никому уже не нужны тут два основных напрашивающегося решения выброси к чёртовой матери то есть тратить каким-то образом и подойти с точки зрения лифа ну то есть last and first out и вот этого второго решения нигде не видел мы несколько раз с коллегами разными абсурда лет никогда не было приведено соответственно есть ли опыт внедрение вот такого подхода и возможно каких-то более-менее простых расчетов но что мы не смогли предсказать то есть по выгрузке данных до соответственно вот этот результатов которые получились но да то есть вот тот же самый конвейер что просить тоже самый конверт что у вас по сути только если мы не укладываемся нужно все выбросить ну да есть такой опыт да соответственно там все всевозможные решения тайну опять же многоуровневые хранилище и так далее да the young так называемый когда собственная холодная горячая и так далее у нас идет да если мы не успели обработать у нас что-то ушло в холода собственного заморозили на время ну честно говоря последнее время мы обленились достаточно у нас на рынке много систем которые делают это автоматом и за нас и до фактически после поставил железку да ну взяли тот же самый пульсар например да для организации очереди он умеет из коробки уже делать вам на этом ему поль не ест и поставить там снизу чтобы можем во все это выгружать и не заморачиваемся да понятное дело когда у вас на самом деле очень сложные требование по производительности не всегда готовое решение вас устраивает да здесь более сложные бывают кейсы здесь нового опять же случалось и такое да использовали всякие хитрые методы в частности например выгрузка кусками частями разделения да там собственно говоря чтобы не активировать все одним блоком разбиение на некоторые lime но это опять же классе когда собственно для все это просчитывается сбрасывается в очень какие-то быстрые системы хранения очень собственно самым стены из простым примитивным без преобразования способом до которые потом легко поднять но такие же непонятно более дорогие и я не могу сказать общего там какого-то рецепта здесь каждый раз надо заново смотреть эту ситуацию у меня только вопрос ваш пример был больше про систему которая еще не создана что делать если какая-то система уже работает не первый год есть какие метрики имеет ли смысл вообще создавать модели не если какие-то особенности дам хороший вопрос про legacy системы на самом деле с моей точки зрения да конечно имеет в какая причина для этого да понятное дело что вы в этом случае даже вам проще вы можете просто загнать уже готовые цифры которые идут там снег воздушного теста да фактически в эту модель и посмотреть что у вас получается что вы получите в бонус к этому всему вы не просто подтвердите до мнение ваших тестировщиков о том что там конечное время отклика и пропускная способность будут такие вы еще собственно сможете моделировать это все на ходу вы можете варьировать цифры в том же сам excel изменять что-то модифицировать да например встречать нагрузку новую до появляются новые сообщения добавляются в другой сложности и так далее вы и кто-то скидывайте и сразу получаете предсказание тут же сразу моментально в несколько секунд по-моему это достаточно хороший эффект который стоит за карат вот еще вот тут дополнить немножко туда получается речь не идет уже 40 минутах это как тот мимби ресурс на человека как рисуем сову сначала рисуем круг отсосала у система может быть очень много элементов то есть до сотни тысяч и функция как минимум ну опять же дан сотни тысяч функций я соглашусь то есть и система очень большая то нужно очень много народа которые обслуживает по большому раскладу если собственно кайфун функции функциями да опять же и но есть опять же функции связаны с рисками есть собственно места вот так называемые бутылочные горлышке до которые собственно трудно преодолевать где высокая нагрузка приводит собственных высоким риском в этом случае конечно же моделировать надо не всю систему целиком не все функции а те функции которые на самом деле у нас является узким местом но прежде всего если мы поговорим о функциях системы бизнес функциях дали системы функциях рассмотрим те на как который более всего нагружают систему до качество транзакций в секунду по которым более всего идет ну или satio соответственно нагружает какой не другой до элементом системе там очень требований требовательных диску да очень требовательны к сети или еще что на территории ира моделируем только их ну и ещё один момент до пытаемся построить систему так чтобы связи в ней было минимум до низко связанную если мы это выполнили на первых этапах работы до собственного это и моделирование у нас проходит намного более эффективно если у нас система лапша да то моделировать не конечно получается тоже некоторая проблема ответил да здравствуйте вопрос скорее в догонку к предыдущему есть такие системы на которых компоненты нарастает ну динамически то есть в текущей flow добавляются допустим дополнительные валидации нужно на подобное вот если возможность помощью ваших формул как-то спрогнозировать это ну элегантно не путем просто мы рассчитали там 08 секунды но 100 скинем две сотые две десятые как-то более точно да на самом деле ну в большинстве систем на самом деле там минуту она какой-нибудь регистратор болтается и все это ipad процесс у нас может идти как-нибудь очень неровно очень сейчас модно в сумочку как у никому туда в центр который будет 7 у нас имеют куча альтернатив да без проблем тоже да все это решается сразу по правде сказать это не мое формула до знаете формы мы позаимствовали из той же самой методологии спа и немножко просто перевернули немножко по-другому использовали но вот собственно и дан вот собственно и что там предлагается в частности предлагается следующая по всем альтернативам оценивать короткие пути и длинные пути таким образом говорить например что вода проходила сообщение у нас возможно длинный путь самое долгое время его прохождения и короткие соответственно и потом в соответственно эти вот пути уже а смотри как оптимистичные пессимистичные сценарии нашей работы смотрите попадаем и в них или нет а там дальше уже разные стратегии есть не попадаем пессимистический вариант меняем архитектур ведь и попадаем в пессимистически не попадаем точнее в оптимистически из не попадая да если попадаем в оптимистически не попадаем пессимистический вариант применяем то тактики всевозможные выровнять все это дело до если попадаем в оба вообще не боимся все все замечательно работаем дальше спасибо коллеги что выслушали не надо кстати данный основная задача моя была собственно заинтересовать вас в идеале заразить да не к вид имеется ввиду вот именно вот эта тема если что мой telegram здесь большим удовольствием отвечают опишите если будет с кем-то это все обсуждать и будут страшны нам еще нужно выбрать лучший вопрос максимум вот лучшие два вопроса вот товарищ давал собственно по поводу батчата поднимите руку мы вам потом вручим книжку вопрос в онлайне так как у нас ограничено время то прошу задать его в зуме и перейти туда вот сейчас соответственно да мы переходим сейчас мы проводим максима в зону дискуссионную где он продолжит с вами общаться туда же можно подключиться через зум здесь у нас сейчас будет санитарная обработка потом пожалуйста этот зал покиньте и здесь следующего доклада если вдруг кто-то на него хотел остаться его не будет там отмена доклада поэтому здесь нас окно будут как крутится тех токи видео соответственно онлайну и возвращайтесь примерно к двум часам дня раньше оптимальная система уже в твоей голове она продумана до мельчайших деталей готова просто нагрузки и защищена от боев только ты знаешь как твоя инфраструктура решить поставленные бизнес-задачи собери свой идеальный сервер онлайн selected как ну здрасте я редактор на вручении рукой я бывший редактор хабра сейчас ведущий подкаста мы обречены раз познакомиться чем занимаешься начнем работать над чем работаешь глобально маленькие предводители мама группы разработки просто беру поиск новички таковым растим с грехи мои тяжкие мы все еще гоняем замшелые самописный движок since которые я когда-то позже видимость крики будь она неладна писал и мы по движок поддерживаем разбиваем всякому дописывать ты же его сделал давно и не для лета ты просто он вообще как-то считаю что он выдержал те требования которые сейчас у него есть то есть от это же тоже меняется и там сейчас 80 миллионов объявления завтра будет 160 миллионов но при этом у нас как бы боевой поиск это 80 миллионов объявлений это что оперативно доступно каждую секунду каждом первом пользователи у вас высокие внутренние системы которые нужно список рыться в которых и побольше да миллиардами измеряется например админ ты саркел всех объявление но что интересно это принципе тоже не сильно я знаю в светлом прошлом были инстансы которых и еще больше там сотни тысяч из тренировки большим по большому счету куски или l'ве стали достаточно некомфортно оперируете и был тогда и до сих пор может когда ничего с этим наконец сделаем вот но как бы я к тому что масштаб там порядка стабильного 10 миль от но сейчас таких боевых условиях есть моменты на которые ты смотришь такой боли ну почему я тогда 8 лет назад не сделал такого через 20 что выгляжу на все 13 ментальные возраст и вообще 11 глаз авторынок эти моменты есть понимаете руки постоянно все эти последние 20 лет в любой конкретно взятый момент времени хочется взять и все переписать на хрен вот 0 нет надо держать себя в руках нельзя все ломать над на чем посидеть а некоторые моменты наверно там наоборот удивляешься блин-компот какой-то замши а ты меня не работает до сих пор и честно говоря нет желания его люто бешено полностью переписать а в основном скорее ну наверно больше половины кода который делается это все таки что то что будет меняться можешь например высказать какие-то вещи которым ты был меньше всего готов который был сложнее всего это движок поиск вот она сейчас у нас потом включает общем имели модули я не думал что 20 лет назад об этом думал что такое 20 лет назад каких гражданина добился о том что есть такая штука как имели которая по большому счету над статистиками цена стероидов и там линейная модель с сотней входов они с тремя входами пойти не как ни странно в этой части все достаточно легко как раз интегрировать есть интеграция той же самое ему или модели ранжирование достаточно штука оказалась простая потому что было к нему подобного сразу готов на грызть один прекрасный момент уже там вырос на концепция по названию просто сигнал оранжевыми форма выраженной отдали выросла некая считалка этих самых сигналов форма выражения и все что оставалось делать это просто чем обеспечить возможность подцепить ту функцию и в эту да я функцию передавать достаточно большой бинарный блок со всеми сигнал беранже нами который мы хотим туда передавать достаточно тривиальных занятия вот поэтому это был сделан еще десять лет назад опять таки 9 действует назад по моему мой первый раз как погибали меняем или обычной модели в похожем или делалось это тот момент не для vita делалось для одного тогдашнего клиент которые строил маленький региональный поисковик по 1 среднего размера европейской стране вот там был соответственно жестом выберем модели и нам первый раз над самой модель вручную он тебя вопросы лежит лежал до определенного момента в open source все после определенных увлекательных событий переживаний сэм с одной стороны с другой стороны я внезапно понял что прямо сию секунду никакого прока с этого курса не будет ни для какой заинтересованной стороны но смысле для проекта роток не жил для себя толком лишней боли вот и пока может быть как open-source вернемся может расскажу что такое случилось почему то решил он там этот длинный увлекательный или наоборот длинная и очень интересная история вкратце и как бы это давай совсем большими масками следующим образом очень не просто зарабатывать сопин снова движка который ты абсолютно за бесплатно делаешь раздаешь и и пытаешься зарабатывать хрен пойми чего нельзя все отдавать за бесплатно надо 4 продавать вот продавать у нас как бы всегда были некоторые сложности и поэтому на самом деле текущую версию которых разрабатываем и этим будет я ее прикрыл еще в годы когда попытки зарабатывать собственного движка не кончились уже там не знаю грубого летом четырнадцатом году если про янукович уже был понятно что то менять в кавычках бизнес модель бизнес в гигантских кавычках потому что особого бизнеса в этом утра низкой счастью не было а и уже тогда искать решила что маг будет делать где-то разрез версия за деньги вот версия без денег и поэтому никакие большие фундаментальные переделки которые были за тельные учетом до дома в четырнадцатом году надо их прикрыть и потом где-то провести линию разреза соответственно после всех этих перипетий названием кассовый разрыв довольно долго учиться жили до 1 нормального кассового разрыва с одной стороны но здорово из говорят там 95 процентов так называемых стартапов в это дело заезжают на дистанции в 1 1 2 3 года дергались несколько дольше в свое время но научу затвора оказался достаточно фатальным очередной разрыв читы день получили совсем самое главное что приток денег кончилось тоже совсем там было еще массу неприятных моментов как сказать как в любом разводе скажем так но это уже наверное тема для отдельного рассказа и обычно окладом рассказанным с углем и мечами за четырьмя литрами пиво и постепенно переходим от и вон она когда он был в open source его легче было не работать был какой-то вклад от сообщества значимый интересный вопрос легче или нет я бы сказал что хомячки т7 комфортнее наоборот понятным всегда удобней работать когда ты nissan там какая . пойдем что тут копеечку так копеечку вот-вот снова нихера когда сзади к тебе пролитую гигантская компания со всеми ресурсами и возможности ресурс так или иначе использовать могут будет понятно делать вот понятное дело что тут палка о двух концах и естественно если у тебя твой проект люди бешено взлетает и сам начинает генерировать сильно больше денег чем у при большой компании у него в принципе когда не забуду бюджете вы то наверно пара некий спин-офф чинить от описанной большой компании случае со сфинксом это случается сфинкс могут всю жизнь достаточно мало зарабатывал всю жизнь как бы это соответственно его независимая жизнь была не сказать чтобы как бы усеяна розовыми лепестками и корпоративными с черной икрой с соответственно поддающиеся золотых чашечках бриллиантовыми ложечками вот поэтому в рамку большую компанию честно говоря нам жить легче много чем по меньшей мере вот на этой там стартовые фазе под названием и еще пока там свои 100 миллионов долларов с share via della вот чисто теоретически чисто теоретически наверно можно построить разработку следующим образом что у тебя есть достаточно большое количество компания интерес антов каждая делает важность которых делает что-то достаточно новое хорошее и интересное и которая можно скажем так в общую помолу хорошо уложить а его проект замерз теоретически это возможно какие то вот прям супер комьюнити проекты такие есть тот же адрес например по большому счету вот такой супер танцы проект на котором пролетит далеко не одна компания и каждая кто-то подделывает чуток вообще devil , а сфинкс до такого масштаба черт его знает поле не дорос то ли в принципе невозможно чтобы бы такого масштаба дорос потому что насколько я смотрел и изредка смотрю на более другие проекты которые тоже проходят в основном и понятное дело люсин и все что поведает нам о библиотечка люсин и вот сервер который в этом сезоне модны строить поверхность а они всегда у меня конечно может неверное впечатление потому что недостаточно хорошо там умею распарсить 250 мегабайт джавс кого года 220 мегабайта с которого это в основном то мне нужны реальные комментарии там тривиальный фабрик но у меня такое ощущение что по меньшей мере в ядре скажем подвижка библиотека так далее лента процентном 90 пода делается в бартон про не ограниченным кругом лиц который возможно формально ходит по разным компаниям но их там допустим 5 до референдума это про open source что это тоже очень мало людей на самом деле то есть он такой открытый но контролю реально ну а большой 1 раз контрибьютором пару человек основных именно так большое количество контрибьютором при этом одновременно с этим может возникать в какой не части там типа а вот ядром и лезть опасаемся но зато мы прикрутили вот этот плагин вот этот плагин вот это вот такая вот штука она конечно не цветёт и пахнет сильно сказать все сели на шепча чем попытки кого привлечь к разработке ядра при каких условиях ты бы вернул его в конце рс сложный вопрос вот на данный момент я натуральной не вижу никакого там объективного плюс от насоса кроме никого и минге и пол даже уже не уверен насколько как бы это важно и не важно для конкретных пользователей для того чтобы этот меч был вот если бы сейчас ты мог вернуться в прошлое с текущими своими знаниями о том во что превратится в проект и что-то одно сделать по-другому чтобы это было не ну это ответ на этот вопрос нет несчастью готов еще до того как я придумал сфинкс и он звучит примерно как в момент ваучерной приватизации я бы украл ящик украл ящик водки много ваучеров который там находится вне словно газпром потом инвертируется в биткойны и в принципе на данный момент как бы илон маск у меня где-то уже в подметки если такие признанием ну ладно успеха теперь хорошо готовится докладов надеюсь получится круто хорошо выступить ай да надеюсь где вы спасибо он и знакомиться привет я саша ну привет я артем я бывший редактор хабре сейчас ведущий подкаста мы обречены познакомиться привет я сам я этим вид в команде могу занимались процессе данных наша задача взять всю всю всю статистику доставить ее до мест где у нас есть потребители ты говорил что-то про культуру кода в чем ваша особенность что такое используйте а культура кадр в моем случае я имел ввиду именно подход я приверженец теории что не бывает ни возможных решений не бывает ни не интересных решений во всём этом можно найти какую-то составляющую которое понравится либо конкретно тебе либо в целом команде и на этом драве можно делать безумные вещи выстраивать безумные системы которые будут потом удивляет весь мир если о них рассказывают и скучно не будет никогда важно это просто понимать если идти с этой тенденции с этой этим пониманием драйве людей-то использованием этого все можно построить прям гигантскую интересную систему расскажу что то пока горит на что-то между под этим безумен под безумными не скучного решения проблем одна из систем которые мы делали это аномалии то так то есть система поиска аномалий на графиках тема не не новая но мы и решили для в универсального видят для миллионов графиков это собственно и будет темой моего доклада я буду рассказывать именно о том как какие запросам и боль не о самой системе а ее подходе мы весь очень много веселились всякими научными статьями с поиском информации у нас не было изначально там большого опыта построения подобных систем но мы взяли клик house мы взяли и реализовали на чистом пихал софтом в истории нечистый мог их а у нас на этом с полем реализовали модели предсказаний воткнули туда сотни миллионов графиков и она считается и процессе с минимальным шагом в 10 мин и это все еще при этом не на самых больших кластерах окей правит расскажу подробнее там слушать кузов еще такую ты берешь в себе такую силу для такого подхода ну просто люди когда начинают чем дольше работать индустрии тема не давайте возьмем приняты давайте будем делать так как надо не давайте не будем лезть за пределы того что за что обычно не лают на тип откуда взять себе драй чтобы делать реально не скучные безумные постоянно придумать изобретать но здесь есть такая знаешь фраза андрич то есть когда ты находишься на самом краю индустрии это не какое-то физическое положение что вот я проработал 20 лет теперь я могу ступить первые ряды и начать дроби нет это не так происходит так как тогда когда ты начинаешь падать на индастри лавал структур киты делаешь работу ты ее сделал поставил галочку без мышки я умею делать или рассказал об этом какой-то доклад до что нового изобретена что нового продвинут как продвинулась инфраструктура фсин даст индустрия в целом если ты просто сделал то же самое что делали другие ведь намного интереснее погрузиться во внутрь какой-то новый вещь взять что-то новое как-то по-другому повернуть под новым ракурсом сделать какие-то новые выводы используя те же самые инфраструктурные вещи о которых говорят там очень многие но повернуть и под таким углом под которым никто еще не поворачивал увидит что это работает может быть немножечко где-то подкаст и не без этого но в результате добиться того что никто никогда не делал и благодаря тебе благодаря тому что ты привнес и рассказал о чем ты сподвиг у кого-то двинул двинуться дальше расширить горизонты своего восприятия мира но сейчас узнаешь как думают что особенно чем больше работать чем больше изучают вещей таки да все уже изобретено и все что изобретена довольно тривиально и придумано не лучшим способом да и особый улучшать никуда давайте просто этим пользоваться им и не суп за можно так сказать но если вызывать возьмём ситуацию десятилетней давности там начала десятых годов тогда тоже так все говорили но тогда не было cliff house а не было кафки не было куча языков которые сейчас используются повсеместно да тогда уже тоже было все изобретено но это не так мы двигаемся мы развиваемся и когда-то в древние века люди считали компьютеры что необходимо я не помню точно фраза что по-моему 2 мегабайта оперативной памяти будет достаточно все и люди в это верили вопрос ваша вера если вы не будете подвергать свою веру сомнениям не будете критически мыслить а действительно ли все изобретено а действительно ли нельзя эту конкретную тузов улучшить или как-то повернуть под неизвестным углом таким образом чтобы она начала приносить пользу еще где-то без этого да можно действительно сказать что все изобретено сложить лапки просто начать это используем а можно попытаться но что сейчас думаешь про industry вот она сейчас ты ее видишь что тебе мне кажется где надо изобретать где как слабые места чтобы ты стал менять но даже в тех подходах который вы построили той системе который мы построили где те решения где тебе приходится идти на компромиссы такой блин здесь не круто надо здесь сделать круче вот этого не хватает этого не хватает да я понял вопрос на самом деле это абсолютно нетривиальный вопрос можно выстраивать что-то новое во всех сферах и очень многие это делают тот же самый house продолжает развиваться и они решают основную нашу боль если уже не решили честно не могу точно сказать это звуки пир к примеру за кипером боль у всех наших последний бой к нам приходил оон киллер за звуки беру вот потому что он немножечко разросся в память всего лишь 16 гигабайтами каждая система невозможно сделать совершенно нету совершенство это только цель ему к ним можно стремиться да мы сделали мы процессе миллиона графиков но мы это не делаем бесплатно мы это делаем за счет конкретно известных там ресурсов которые мы на этот против есть узкие места которые для нас являются проблемой тоже зам из самых звуки пир для нас эта проблема невозможно постоянно горизонтально масштабироваться соответственно рано или поздно придется дальше развивать эту штуку чтобы оно было быстрее и эффективнее поэтому нет в абсолютно во всех сферах есть куда расти только для того чтобы это сделать необходимо обладать знанием и опытом в этой сфере конкретно в нашем случае да мы очень не хотим избавиться в за кипера у нас практически к любой сфере при так или иначе последова на привязан и он доставляет большую часть проблем вы уже пытались а пока нет малой себе вот хотя бы когда-то об этом думаешь как ты думаешь как у сторон здесь девиц как избавляться а я думаю именно менять собственное решение решение которые были сделаны у нас таким образом чтобы и покрыть задачу и меньше ушатывает закипит поскольку он нужен нам опосредованным нас нет задачи сделать его идеальным нас нет задачи на него тратить и собственно нас есть задача именно нашу проблему решить а ее можно решить в том числе к примеру уменьшив нагрузку низу теперь предыдущую идею которую мы реализовывали она это не учитывал будущее будет когда вы строили вот система про который рассказывал у вас были какие-то камни преткновения из-за чего то вы спорили что было сложно всего проблем ней да наверное вот лично для меня это было проблема ранжирование аномалий я говорю конкретно про аннабель это так что систему которую мы сделали для чем нужно объяснить проблему комбинаторного взрыва у нас есть примеру там график с параметрами нас есть страна оператор пользователь там и еще с десяток разных параметров каждый из них если примеру 10 параметров каждой из них по 100 то мы получаем 10 в 20 комбинацией параметров и каждый из них может потенциально обладать цифры это безумные объемы и с этим как бы ну никто работать не будет но как при условии то чтобы примеру определяете 90 девять и девять десятых процентов всех значений а то есть три девятки это у вас немножечко нем много масла но 10 в семнадцатой аномалий плов и вот как как найти среди них аномалию естественном есть можно положительно и естественно там есть обычная на маме естественно там есть изменения ожидаемые которые как бы попали под аномалию но это все нас ранжировать до цифра естественно взяты с потолка никто не работает с 10 в семнадцатой степени графиков потому что ну это прям очень жестко так но даже с 1000 графиков проблема ранжирования она стоит очень остро можно сделать самый простой и понятный способ это когда вы берете и говорите что чем больше цифра в графике и реальным ну привет я артем я бывший редактор хоп ну привет я артем я бывший редактор хабра сейчас ведущий подкаста мы обречены рад познакомиться привет я саша 5 мбит в команде могу боюсь processing банда наша задача взять всю всю всю статистику доставить ее но мест где у нас есть потребителя ты говорил что-то про культуру кода в чем ваша особенность что такое используйте культура кота в моем случае я имел ввиду именно подход я приверженец теории что не бывает ни возможных решений не бывает ни не интересных решений во всём этом можно найти какую-то составляющую которое понравится либо конкретно тебе либо в целом команде и на этом драйве можно делать безумные вещи выстраивать безумные системы которые будут потом удивлять весь мир если о них рассказывают и скучно не будет никогда важно это просто понимать если идти с этой тенденции с этой этим пониманием дробить людей-то использованием это все можно построить прям гигантскую интересную систему расскажу что поконкретнее что-то между под этим безумен под безумными не скучно вершине да без проблем одна из систем которые мы делали это аномалии то так то есть система поиска аномалий на график тема не не новая но мы ее решили для универсального виде для миллионов графиков это собственно и будет темой моего доклада я буду рассказывать именно о том как какие запросам и боль не о самой системе а ее подходе мы весь очень много веселились всякими научными статьями с поиском информации у нас не было изначально там большого опыта построения подобных систем но вы взяли cliff house мы взяли и реализовали на чистым пихал соснам в истории нечистый мог house на этом используем реализовали модели предсказаний воткнули туда сотни миллионов графиков и она считается и процессе с минимальным шагом в 10 минут и это все еще при этом не на самых больших кластерах окей проект расскажу подробнее там слушай откуда все такое ты берешь в себе такую силу для такого подхода ну просто люди когда начинают чем дольше работать в индустрии тема не давайте возьмем общеприняты давайте будем делать так как надо не давайте не будем лезть за пределы того что за что обычно не лают на тип откуда взять себе драй чтобы делать реально не скучные безумные постоянно придумывать и изобретать но здесь есть такая знаешь фраза андрич то есть когда ты находишься на самом краю индустрии это не какое-то физическое положение что вот я проработал 20 лет теперь я могу ступить первые ряды и начать драме нет это не так происходит так как тогда когда ты начинаешь падать на индастри лавал структур киты делаешь работу ты ее сделал поставил галочку без мы что я умею делать или рассказал об этом какой-то доклад да да что нового изобретена что нового продвину как продвинулась инфраструктура в синтез индустрия в целом если ты просто сделал то же самое что делали другие ведь намного интересней погрузиться во внутрь какой-то новой вещи взять что-то новое как-то по-другому повернуть под новым ракурсом сделать какие-то новые выводы используя те же самые инфраструктурные вещи о которых говорят там очень многие но повернуть и по каким углом под которым никто еще не поворачивал увидит что это работает может быть немножечко где-то подкасты не билетов но в результате добиться того что никто никогда не делал и благодаря тебе благодаря тому что ты привнес и рассказал о чем ты сподвиг у кого-то двину двинуться дальше расширить горизонты своего восприятия мира ночь осознаешь как думают что особенно чем больше работать чем больше изучают вещей таки да все уже изобретено и все что изобретена довольно тривиально и придумано не лучшим способом да и особый улучшать никуда давайте просто этим пользоваться им и не суп за можно так сказать но если вызывать возьмём ситуацию десятилетней давности начала десятых годов тогда тоже так все говорили но тогда не было cliff house а не было кафки не было куча языков которые сейчас используются повсеместно да тогда уже тоже было все изобретено но это не так мы двигаемся мы развиваемся и когда-то в древние века люди считали компьютеры что необходимо я не помню точно фраза что по-моему 2 мегабайта оперативной памяти будет достаточно все и люди в это верили вопрос ваша вера если вы не будете подвергать свою веру сомнения не будете критически мыслить а действительно ли все изобретено а действительно ли нельзя эту конкретную тузов улучшить или как-то повернуть под неизвестным углом таким образом чтобы она начала приносить пользу еще где-то без этого да можно действительно сказать что все изобретено сложить лапки просто начать это использую а можем попытаться но что сейчас думаешь про индустрию вот она сейчас ты ее видишь что тебе мне кажется где надо изобретать где как слабые места чтобы ты стал понять вот даже в тех подходах который вы построили той системе который мы построили где те решения где тебе приходится идти на компромиссы такой блин здесь не круто надо здесь сделать круче вот этого не хватает этого не хватает да я понял вопрос на самом деле это абсолютно нетривиальный вопрос можно выстраивать что-то новое во всех сферах и очень многие это делают тот же самый house продолжает развиваться и они решают основную нашу боль если уже не решили честно не могу точно сказать это звуки пир к примеру за кибер им боль у всех наших последний бой к нам приходил он киллер за звуки беру вот потому что он немножечко разросся в память всего лишь 16 гигабайтами каждая система невозможно сделать совершенно нету совершенство это только цель к нему к ней можно стремиться да мы сделали мы процессе миллиона графиков но мы это не делаем бесплатно мы это делаем за счет конкретно известных там ресурсов которые мы на это тратить есть узкие места которые для нас являются проблемы тоже за мысом языке про для нас эта проблема невозможно постоянно горизонтально масштабироваться соответственно рано или поздно придется дальше развивать эту штуку чтобы оно было быстрее и эффективнее поэтому нет абсолютно во всех сферах есть куда расти только для того чтобы это сделать необходимо обладать знанием и опытом в этой сфере конкретно в нашем случае да мы очень не хотим избавиться от за кибера у нас практически в любой сфере при так или иначе последова на привязан и он доставляет большую часть проблем вы уже пытались а пока нет малой себе но то хотя бы когда-то в этом думаешь как ты думаешь какую сторону здесь длится как избавляться а я думаю именно менять собственное решение решение которые были сделаны у нас таким образом чтобы и покрыть задачу и меньше ушатывает закипит поскольку он нужен нам опосредованным нас нет задачи сделать его идеальным нас нет задачи на него тратить ресурсы нас есть задача именно нашу проблему решить а ее можно решать в том числе к примеру уменьшить нагрузку на зу теперь предыдущую идею которую мы реализовывали она это не учитывал будущее будет когда вы строили вот система про который рассказывал у вас были какие-то камни преткновения из-за чего то вы спорили чтобы у сложнее всего проблем не да наверное вот лично для меня это было проблема ранжирование аномалий то есть вот я говорю конкретно про она будет а также систему которую мы сделали для чем нужно объяснить проблему комбинаторного взрыва с у нас есть примеру там график с параметрами нас есть страна оператор пользователь там и еще с десяток разных параметров каждый из них если примеру 10 параметров каждый из них по 100 то мы получаем 10 в 20 комбинацией параметров и каждый из них может потенциально обладать цифры это безумные объемы и с этим как бы никто работать не будет но как при условии то чтобы примеру определяете 90 девять и девять десятых процентов всех значений а то есть три девятки это у вас немножечко нем много мало но 10 в семнадцатой аномалий плов так и вот как как найти среди них аномалию естественно там есть ложноположительные естественно там есть обычная на маме естественно там есть изменения ожидаемые которые как бы попали туда на малина это все нас ранжировать до цифры естественно взяты с потолка никто не работает с 10 семнадцатой степени графиков потому что ну это прям очень жестко так но даже с 1000 графиков проблема ранжирования она стоит очень остро можно сделать самый простой и понятный способ это когда вы берете и говорите что чем больше цифра в графике и реальным тем важнее номоли но в этом случае какой-нибудь интегральный график пользователи по всем мире скакнет на полтора процента вверх и вы визуально даже ну да скок ну ладно но это будет самая большая аномалия за счет того что цифра само по себе больше нежели так дела у вас какой-нибудь стране количество пользователь упала в половину там это катастрофа а это нормально ладно руки будем жить дальше и вот именно эту проблему я пытался решить это было две недели когда я просто сидел с гигантским объёмом данных и просто писал запрос разными вариантами разными случай вытаскивал какие-то дополнительные параметры метрики из данных для того чтобы хоть как-то вытащить ну и вкратце примерно как что было за решение я получил коэффициент немножечко в попугаях но коэффициент который говорил о разводе графика предсказание графика реальных значений используя его из используя нормализацию на общий вес графика то есть отношения его числа к общей сумме всех графиков внутри там какого-то report и еще нескольких других коэффициентов я получил более менее функцию которая не позволит выдать цифру по которой могу сортировать и эта цифра мне уже сделала что график с большим разлет am графе с большей аномалий визуально именно визуальный будет выше чем график с меньшим визуальным разлет успехов вам в работе над этим до строить систему и изобретает пасибо большое надеюсь вы избавитесь на закипели сделать это отличное других научить и тоже будем посмотреть тогда машине да всем привет в онлайн трансляции в оффлайне и у нас следующее докладчики это у нас сегодня первый парные доклад и не последний итак представляем иван решите на игорем люка с докладом граф quelle федерейшн или как не выстрелить себе в ногу встречайте всем привет меня зовут ваня решетин я руковожу командой backend платформы в июле мы сегодня с игорем маликом расскажем вам про граф келлер федерацию сразу надо уточнить почему же нас двое дело в том что исторический я отвечал за внедрение граф келлер юлия игр занимался внедрением федерации поэтому наш доклад чего-нибудь составить из двух частей 1 расскажу я 2 расскажет игорь а давайте начнем игорь вернется потом не переживайте середине мы поменяемся и так кажется или доклада сегодня это в первую очередь поделиться своим опытом то как мы пришли граф келью как мы пришли к федерации и рассказать о своих ошибках и может быть предостеречь вас от их повторения что сегодня будет мы расскажем какие у нас были проблемы до графики или почему мы в итоге выбрали граф келли и как мы переходили на федерацию а также расскажем о том какими сложностями вы столкнулись на каждом из этих этапов чего не будет сегодня не будет копипаста документация я думаю вы сами сможете с ней познакомиться и не будет примеров кода больших листингом чтобы вас не перегружать мы пройдемся так более высокого у него по всем темам но давайте для начала познакомимся что такое дела с точки зрения цифр и lights нагруженный проект у нас 27 миллионов пользователей в месяц у нас больше тридцати миллионов активных объявлений 200 тысяч запросов в базу мы используем он где by как основное хранилище и больше 120 крп с на наши бренды мы используем современные технологии которые помогают нам активно развиваться расти радовать наших пользователей уулу и четыре основные платформы это и ос android в камине об и конечно же в и лает а используют масштабируем архитектуру мы где можно используем кластерное решение у нас более 500 серверов распределенных по трем независимым дата-центром давайте огров келли поднимите руку вообще кто использовал открыли в продакшене есть у кто как круто а есть те кто и думаю сейчас еще использовать не использовать прекрасно я очень надеюсь мы вас ни разу видим сегодня тогда для остальных прям буквально низко слова вообще главке что это такое это граф в язык запросов ваш опе он предоставляет полные понятное описание вашего пи описывает какие структуры у вас есть и позволяет клиентам получать только необходимые данные которые нужны а также производить какие-то манипуляции с этими данными буквально два слова про тип операций есть в graph килик вере это запрос на получение данных аналог get запрос в раз те есть мутации это запрос на изменение данных аналог там пост дэвид вырасти есть еще подписки название понятно позволяет клиентам подписаться на какие-то события от бэг-энда центральное центральное место в понятиях граф келлер занимает графики или схему что это это собственно и есть описание того как как выглядит ваш опе какие у него структуры какие имеют типы но вот например наша такая базовая для юли сущность как продукт может иметь вот например такой набор полей например пользователи будут другой набор полей и как видно у продукту пользователь есть такой тип как и мочишь кроме стандартных строк там бульонов ну типы мышь может выглядеть вот так там с одним полем url картинки вы говорили про операция все что такое график вере как он выглядит клиенты запрашивают на какой-то страница только те поля которые им нужны и перечисляют собственно вы должны перечислить все те поля которые они хотят использовать из данного примера видно что клиент в данном случае не запрашивает например описании потому что он здесь не нужно и его не перечисляет в своем запросе ну и соответственно не получает это позволяет экономить ресурсы если у вас например описания хранится как-то отдельно от сущности от базовой сущности продукт соответственно на бэг-энде вы не будете его собирать и экономить им сам ресурсы на построение этого поля и на пересылке но юла исторический имел арест архитектуру так ждем юла исторически имел арест архитектурой сейчас как слайд переключиться и будет здорово ура почти рестриктор что тут взять она появится же до как дела а у кого rest прекрасно и так его историческими арест архитектуру про rest конечно уже очень много всего сказано я не буду здесь останавливаться на всех там плюсах и минусах недостатках я расскажу только о тех там двух основных проблемах с которыми мы столкнулись и который для нас были наиболее критические первое это увеличение даваемых данных на ручки ручка все знаю да и the end point можно я буду говорить ручка спасибо вот такая ручка какой in point да как продукты на старте юлы на старте нашего проекта имел какой-то ограниченный набор полей но про проект развивался продукт роз увеличивался проводились эксперименты добавляю из поля не все эксперименты приживались по этому эксперименту ног откатиться и часть полей стала не нужна и в новых клиентах она не использовалась мы не можем просто так взять и выпилить эти поля из response а потому что у нас есть много старых мобильных клиентов которые не обновляются a force апдейт мы не практикуем по продуктовым соображениям и если мы начали отдавать какое-то поле для мобильных клиентов мы должны его поддерживать до конца и таким образом наш response продукту вырос до очень больших размеров бы сюда не в лес мишна мы сделали сделали в два выпили все не нужные поля переключили новых клиентов на новую версию но собственно как понятно он повторил версию 1 он вырос и добавились кучу не нужных полей версию 3 мы уже решили не делать решили на этом остановиться и искать другое решение давайте посмотрим второй проблем которые у нас было это множественные запросы с одной страницы о чем это речь здесь главной странице или она давайте посмотрим она состоит из разных сущностей этой баннеры stories и какие-то гиу заголовки карусели сами продукты в общем рекламу и так далее и какие же есть варианты запроса такой страницы с мобильных клиентов посмотрим как это было и какие есть варианты изначально мобильные клиенты делали множество раз запросов в такие целевые сервисы за этими данными делали они ростом здесь в общем то все проблемы понятно все растают и либо у вас растут данные либо необходимо versio не ровать плюс это множество запросов на наши бренды и одна из проблем еще это походу напрямую в сервис часть сервисов у нас нога часть сервисов на печке часть сервис вообще живет монолите и если нам нужно например запилить монолит а это уже становится проблемой потому что клиент входит в него и чтобы вынести оттуда функционал и перестать его поддерживается ну в общем здесь определенной проблемы и то на что мы посмотрели первое это какой-то аппетитный тоже ростовые клиент делает ростовом запросы в этот gateway а он уже под капотом начинает ходить по сервисам ну из минусов это все тоже необходимость в офисе они ровать наша наша пи плюс добавляется дополнительный слой и следующий тона что он посмотрели уже граф это перевести все наши сервисы на графике протокол чтобы клиенты запрашивал только те данные которые нужны он был бы счастлив все здорово но от этого сразу отказались даже не пытались это внедрить потому что здесь кроется очень критическое недостаток это конфликт и типов которые нужно решать на стороне клиентов если у вас придет один и тот же тип там из разных сервисов от продукты не знают stories of придет какой-нибудь юзер он может конфликтовать это приведет к крашу приложения очень усложняется поддержка особенно со стороны клиентов и в общем для большого сервиса такая архитектура не подходит поэтому мы остановились вот на такой когда у нас есть гров келье пей клиенты по граф киль протокола ходят в этот gateway а он уже под капотом находится собирают данные со всех сервисов да здесь появляется дополнительный слой и на тот момент когда мы это выбирали нам показалось других недостатков у этой схемы нет все классно давайте внедрять мы выбрали граф кель чего мы получили мы получили типизацию здесь наверно тоже нет смысла объяснять почему это хорошо так как у нас разные клиенты разные отображения есть мобильные клиенты у них маленькие экраны мало данных есть веб вылезает больше данных они могут другие данные запрашивать и все это нам помог решить в graph келли также мы получили иском к потом на статистику запрашиваемых полей по всем нашим данным мы смогли понимать где какие поля используются кате не используются чтобы перестать их поддерживать и самое главное мы скрыли реализацию вот этих самых целевых сервисов и тем самым смогли нормально perry как там распиливать наш монолит переписывать сервисы там на другой язык и возможно даже менять у них интерфейсы клиент и при этом не нужно было переплывать они все забыли завязано на графике эль из нюансов мы расширили текст iq нам пришлось проводить обучающие митап для коллег вообще как этим пользоваться и очень важно нам пришлось очень глубоко переработать на shape так как например та же ручка продуктов отдавала просто все включая юзера и какие-то данные по аналитике еще что-то нам пришлось очень внимательно подойти к разделению вот этих доменных зон на то что является продуктом и базовой этой сущностью продукт что является юзерам вот перед тем как перейти на графике нам пришлось очень хорошо переработать всю эту доменную область и так выбираем граф кель как уже библиотеку выбрать большинство сервисов у нас написано на год граф кельмы тоже гей твой мы тоже решили писать ногам смотри в библиотеке мы выбрали ту которая практикует подход схема feast о чем это мы описываем схему как в левой части крана видно мы описываем схему какие там типы как они между собой связаны генерим код валя все здорово у нас генерится огромное количество кода с резон время все здорово нам такая схема понравилось мы используем библиотеку гек вильен из плюсов это меньше ручного труда мы просто описываем схему причем делаем это с мобильными клиенту с клиентской разработкой мы прорабатываем вместе с ними что важно всю нашу структуру будущего api и на выходе получаем готовый мой ризограф с помощью которых мы можем уже backend наполнять их какой-то бизнес логикой а по существующей схеме параллельно мобильная разработка может начать продлить свои фича иногда это очень удобно и так мы получили главную страницу одним запросом это показалось удобно всем и мобильный разработка была довольно и бэкон был доволен и мы начали активно внедрять все это все радовались и на первом запуске когда мы перевели главную страницу наши графики или схема выглядела вот приблизительно так мы перевели все основные сущности какие у нас были и запустились все здорово но время шло прошло полтора года всем это нравилось количество команд которые захотели так сделать увеличивалось и эта схема за полтора года выросла в несколько раз вот приблизительно до такой более того это ещё не предел оставалась очень много rest ручек которые должны были переводиться тоже на графике ель и как я говорил вроде бы такая схема нам казалось идеальным какими достатке вообще все прекрасно мы начали сталкиваться с проблемой и основная и главная проблема в которой мы уперлись это бутылочное горлышко нашего геймплея с точки зрения разработки дело в том что граф кейт выпилил и core команда сердце ли вы и сервисы пилили продуктовой команды и когда продуктовой команде нужно было добавить какое-то поле к себе они прибегали к команде с задачей добавить это поле поддержку этого поля на графике или гетеи ну собственно добыл деплоить и сначала например юзеров потом граф цель количество сервисов увеличивалось количество команд и про и полей увеличивалось и это в общем стала серьезной проблемой и плюс усугублялось это все тем что битве начал обрастать какой-то минимальный бизнес логикой и все это пришлось поддерживать комкор команде на сайт конечно не устраивало мы хотели в общем то что то поменять что же можно было поменять ну принципе можно было поменять отношение к данной проблеме смириться в терпеть ну конечно нет но мы чуть-чуть потерпели нам это очень быстро надоело и первый предложил был открыт полный доступ для в репозитории этого gate мы и для других команд ну тоже такое себе core функционал команды большие в общем от этого тоже сразу отказались и мы пришли к практике когда другие команды делают полу request и команда корр команда их review ты собственно применяет в какой то момент мы так жалею все было почти хорошо пока этих котиков и команды не стала настолько много что комкор команда начала превращаться в команду review вера и это стало просто невозможно очень тяжело и собственно мы тогда ушли дальше думать и искать наш какое-то идеальное решение как же выходе как выходить из сложившейся ситуации но чтобы его найти нам нужно было сначала формализовать вообще все наши требования чего мы хотим теперь получить новое что же мы хотели получить первое мы хотели оставить вот эту единую точку входа для клиентов и также мы хотели оставить единую схему для клиентов не чтобы ее не разбивать и чтобы не держит эту схему на клиентах той схемы для клиентов должна остаться единой но мы также хотели разбить эту схему таким образом чтобы каждая команда отвечала сама за свою часть схемы и только она бы за не отвечал и и ни на кого не аффекта лодзь и при этом любые изменения этой схемы должны происходить на лету то есть если у нас какой-нибудь сервис продуктов добавляют поле то никакие другие компоненты системы нам не нужно переплачивать чтобы они собственно разграничить вот эти вот доменные области о том как мы искали решение о том что было дальше расскажет игорь игорь прошу а и да вот мы собственно пришли хотели вот прийти к подобной схеме всем привет меня зовут игорь и я занимаюсь backend разработках команде платформы и сейчас расскажу какое решение в итоге мы пришли какие искали какие были рт мотивы и об этом всем ну собственно изначально перед нами стояло возможность первое что мы хотели сделать это разбить схему по файл что это значит изначально у нас была вот такая схема то есть гров киль gateway в нем было один файл граф кель и один генерирующиеся файл кода реветь такую схему было не очень приятно поэтому первое что мы сделали просто разбили схему по файлам то есть мы пишем под каждую доменную область свой и граф келлер файлик под его генерируется отдельный файл с кодом и таким образом ревель проще понятно куда кто изменил вносил правки какие-то и так далее но это все еще остановился монолит от него мы хотели уйти самом деле последнее что мы рассматривали и что-то приглянулось это было граф келли федерации вообще кто-нибудь из вас слышал пробовал граф кир федерацию можете руки поднять понял сейчас будем разбираться с этим что такое grab your федерации вообще граф кира федерация вообще концепция заложено ребятами из компании опала наверное вы сталкивались ними если работали с клиентскими библиотеками или сервер библиотеками но джесс и так далее вот относительно недавно я концепции которая была разработана 1019 году что она позволяет делать вообще она позволяет вам объединять схемы с несколько сервисов предоставляющие графики или интерфейса и вообще игра в киле схема она позволяет вам расширять типы из одного сервиса другим так чтобы клиент об этом ничего не знал и также она в ран тайме умеет во лидировать схему чтобы не допустить каких-то критических вложений типов друг друга друг на друга конфликтов и так далее поэтому вы можете быть уверены что текущая ваша схема который получит графский федерация как сервис будет валидно и клиент ваши не упадут вот поэтому мы в принципе оценили все все то что может нам дать федерация и а правда ли это и решили рассматривать дальше я уже говорила попова графики или федерации так как они первые самые стали те кто реализовал саму сердце сам серой федерации и про так лидировали это дело сейчас остановимся на том как можно запускать вообще федерацию как как сервис то есть федерации это сервис который может быть поднят с помощью никого конфига вы даете на вход ему список сервисов списком сервисов является объект в котором должно быть название сервиса и л л ю л по которому федерация сможет общаться с сервисом пересылать какие-то конкретные части схемы от клиенты а также сможет первоначально забрать схему из этого сервиса чтобы знать как отвечать по ней но такая схема естественно подходит не всем потому что федерации это делает фронтами она сама запрашивает сервис говорит дай мне свою схему и по ней начинает уже работать в этот момент сервис может лежать или что-то не получится стянуть на этапе первоначального запуска и соответственно федерация не сможет корректно работать вам подойдет такая схема если вы не боитесь конфликтов самих типов схем то есть вы заранее все вы лидируете проверяете и вручную оценивайте риски если вы не распиливать и монолитную схему здесь есть несколько нюансов который не позволит вам сделать это неким некой конфигурации статичной и также если для вас кратковременно downtime не проблема это вытекает из второго пункта будут момента когда вам нужно будет остановить работающий сервис но вы можете принципе это сделать если например разрабатывайте внутренний портал и он поддерживаю гроб гель второй второй способ запуска этого сервиса называется менеджер duration здесь основной ключевой момент является то что вам необходимо чтобы у вас был некий сервис схема реджис 3 немножко об этом сервисе схему рождестве это по сути сервис который предоставляет центральное хранилище для ваших последних актуальных композиций схем много слов композиции схемы композиция это по сути на борт сервер набор схем сервисов последней версии какой-то версии так вот с помощью этого сервиса федерации сможет вы сможете добавлять схемы схемы и g-100 федерации может получать эти схемы из от того же схему реджис ты один важный нюанс в будущем я расскажу подробнее про это но схем режисер сервис мы сделали себе свой что же такое федерация федерация стоит из несколько компонентов как сервис как любой первую очередь это но джесс реализация то паула граф кель стала но jest сервис федерации включает себя сам компонент федерации который занимается тем что создает некий планировщик запросов планировщик запросов это структура который знает какую часть в какой сервис отправить это самопала сервер мы собственно занимаетесь тем что просто трансформирует из слоя htp граф кир схему и передает ее федерации и поверх этого всего у вас будет лежать какой-нибудь аж тебе фреймворк по умолчанию все используют но джесс экспресс но вы можете использовать тот который например вам больше подходит соответственно в такой схеме когда федерация получает набор схем они прилетают уже валидны my и также федерации выполняет требование обновляться без переди плохо все делается в рандами мы посмотрели такую схему поняли что в принципе все ок нам нужен был европе что для нас представлял из себя им гибель напомню что первоначально схема нашей работы выглядело так у нас есть некий граф хельги и твой написанного он поддержит граф киль интерфейс принимает запрос от пользователя и раскидывает все пони с лежащим сервисом но это был как уже сказано было монолит мы хотели протестировать примерно такое решение и вешаем сверху угров киль монолиты нашего федерацию подключаем к этому всему делу схемы реджис 3 добавляем схему у монолита в схему регистре и все должно было работать как мы запускались первую очередь для нас запуском успешным нужно было для нас было успешным запуском то что пройдут все тесты по сути мы взяли все in the end играть звонки которые были поверх граф киль монолита и натравили их на ту же федерацию все теста должны были отработать если бы они отработали это было бы знак что все работает все ок так и было в принципе так наше лицо выглядело когда мы запустили тесты но что по скорости как я уже сказал федерация опала реализация федерации написано на джесс у нас везде г мы думали как бы так чтобы все было идентичным мы начали запускаться из левой схемы в правую за базовую базовые время мы взяли 100 процентов работы и граф киль монолита для нас показателем что все ок и можно дальше работать было примерно такое 10 процентов увеличение времени ответа по сравнению с текущим монолитом но тут пошло всё не так как мы ожидали и мы увидели что прирост время ответа составил 300 процентов поэтому когда мы посмотрели на все это дело у нас было запущено около десяти инстансов накинули еще 10 увидели что цепью используется на 100 процентов на каждой ноги и время ответа сократилась сократилось вдвое но все равно она превышала наш порог поэтому покопавшись в коде мы заметили у себя вызов функции который вызывал асинхронно для каждого запроса и это собственно и стала проблемой всех бед мы добавили fix и увидели что время финальная ответа превышала наш гей твой всего лишь на 5 процентов на 100 устроила и мы решили попробовать распилить схему то есть не просто взять монолитную схему воткнуть поверх неё граф келлер федерацию но и начать вносить микро сервису и братских интерфейс как мы это делали в первую очередь мы хотели добавить всем не с лежащим сервисом в которой монолит ходил граф келли интерфейс дальше мы хотели настроить поэтапный последовательные push каждого сервиса схемы в сервис схемы регистре и по мере того как мы делали этот push кусок схемы из монолитного граф кирдий твои он уменьшался и уменьшался до тех пор пока мы не смогли полностью убрать граф кирби твой как монолитный графики или сервисы и собственно финалом всего этого стало то что федерация ходила напрямую в каждый сервис через интерфейс граф келлер как это примерно выглядела на схеме то есть представим что у нас есть гров киль монолитный gateway у него есть много много кода здесь он упрощен у нас есть базовые типы пользователей базовый тип продуктов есть квиррел для продуктов пользователей и так далее мы хотим сделать так чтобы разграничить эту схему по доменам областям соответственно у нас есть два домена продукты пользователя здесь это все превращается примерно следующую картину у нас остается в сервис vpn два сервиса у нас получается что в сервисе продуктов остается схема только продуктов сервисе пользователи только пользователи но федерация нам позволило пойти дальше мы смогли расширить сервис пользователей добавив в каждого пользователя продукт при этом нам не нужно было взаимодействовать с самим сервисом пользователя так как зачастую у вас например если есть сервис товаров то вы будете знать его авнер ay dili юзера иди выполняй сможете предоставить информацию это товаром конкретного пользователя чем собственно сервис продуктов и занялся как на релизе мы это дело вообще я уже говорил что у нас был схемы реджис 3 и это достаточно большой компонент который позволит вам позволил нам сохранять новые версии схему позволил нам создавать версии композиции и позволил нам во лидировать на этапе перед тем как федерация получит вообще новую версию что делает федерацию в принципе не нужны кпереди плоть если только вы не меняете и код поэтому когда мы получили такой сервис мы задумались о том как мы будем добавлять изменения вносить изменения в такую схему распределенную граф киль первое первый способ релиза и первый сценарий урезает а когда вы добавляете новый сервис представим что у нас есть три сервисы работающих в продакшене это например какие то продукты пользователи и баннеры как мы должны добавить схему в федерацию первым делом мы создаем новый сервис назовем его stories дальше мы сушим его схему в сам сервис схема registry на этом этапе после того как мы запушили диплом сервис сам по себе но о нем еще никто не знает ни федерация не схема реджис ты далее схемы реджис 3 схема схема этого сервиса добавляется в схеме реджис 3 прошу прощения за гола за оговорку на первом этапе мы во лидируем его схему чтобы быть уверены что дальнейшем мы сможем запушить его после добавления схемы схемы реджис 3 федерации автоматически получает новую версию этого схемы этого сервиса и может с этого момента рассылать клиентские запросы которые придут федерацию по куску схемы и stories здесь достаточно все просто то есть добавляем никаких конфликтов нет но есть еще один нюанс сценарий миграции схемы между сервисами то есть как нашем примере было это работающий монолит у которого есть много много много типов у которой есть много доменных областей и его нужно как-то распилить так вот как это делается первым образом как это делали мы как первым этапом это создание сервиса продуктов мы хотим выпилить из справки или монолита сервис продуктов на первом этапе мы создаем сам сервис копируем туда схему с продуктами далее нам нужно сделать push этой схемы в схему registry но на этом этапе как очевидно мы получаем конфликт типов потому что и монолит предоставляет идентичные типы запросы и так далее и сервис новые продуктов предоставлять те же самые типы поэтому схемы реджис 3 продавать продолжает отдавать монолитную схему для федерации но при этом он держит в голове что где-то когда-то у него произошел конфликтный push далее мы несмотря на то что мы не смогли запустить эту схему схем реджис 3 мы диплом сервис продуктов то есть о нем никто не будет знать но теоретически если к нему обратиться по протоколу граф кель то он сможет ответить после этого мы вырезаем все типы связаны с продуктами из монолита и мы пушем обновленную схему монолитов схема registry вот как раз на этом этапе схема registry будет знать что раньше у него свалилась схема на валидации продуктов и когда он попытается сопоставить или смерть эту схему с монолитной схемы и там уже не будет для типов продуктов поэтому здесь будет успешный мер схема реджистер создаст новую версию и дальше федерация продолжит использовать но уже новую версию не вне периоде плавилась а продукты тут принимать все входящие запросы от федерации с клиента при этом здесь важный нюанс что мы не тепло или монолит на этом этапе ни разу сам как сервис поэтому все запросы которые происходят от клиента федерацию по схеме продуктов и и происходит они в момент вот в эти нам микросекунды когда происходит миграция федерация все еще продолжает пририсовать монолит поэтому мы можем быть уверены что все входящие запросы по мигрирующей схеме они отработают монолите у нас не будет никаких там connect таймаутов и так далее а все новые пойдут в сервис продуктов я вот говорил про схему реджис 3 в принципе что он позволяет делать такие штуки и мы написали его сами но на самом деле по умолчанию ребята со полог которые сделали федерацию они предлагают сервиса полу студию называется это saas решение который позволяет вам по сути делать все то же самое то есть у вас есть некий некая web морда которая который вы видите валидации свои прошедшие по для схемы сервисы работающие какие версии схем используют они и на самом деле там очень много функционала дополнительного которые упростит вам вообще в целом работу с распределенными схемами мониторингом их отладкой но нам не подошел этот сервис к сожалению потому что как я уже сказал это saas-сервис и он примет решение они не предоставляют на этом в принципе хотелось бы подвести выводы первую очередь это минусы какие минусы у нас появились при разработке сервисов и поддержки граф келлер первую очередь и сложные миграции схем то есть тот процесс который мы видели он явно не пахнет с тем что нам просто вылить что-то со схемы граф келлер продакшн и все дела второе федерации нет по песок возможно пока но если для вас как для разработчиков использующих подписки это критично важно то возможно вы найдете другой альтернативы например прямые выпсуке ты но или оставить сервис один из сервисов граф киль открытым для клиента продолжать с ним общаться через подписки а все остальное перекинуть на федерацию и еще один минус усложняет артик туру сервисов теперь сервисы должны знать как взаимодействовать с федерации то есть схему добавляются некий функционал который сервисов обязывает для того чтобы например расширить тип 1 сервис и другим вам необходимо знать некий набор директив и последний это усложнился процесс релизов у нас теперь дело в том что вот такие вот миграции типов из одного сервиса в другой они вызывают необходимость к тому чтобы у вас был определенный процесс то есть как мы видели мы сначала диплом один сервис схему выкатываем по-другому и 2 сервиса мы должны приостановить его диплом и так далее какие плюсы вообще есть у этого во-первых заставил нас заставил это более вдумчиво проектировать api я говорю сейчас в конкретно про схему граф келлер потому что теперь команды более плотных взаимодействуют друг с другом а также с клиентами чтобы не создать лишних типов они более вдумчиво погружаются в домен и так далее дает каждой команде независимость при разработке самого сервиса я сейчас говорю не про схему граф кель а про конкретно код до схему мы пишем вместе зачастую но сам кот командой разрабатывать независимо то есть вы реализовываете своих ризограф получение данных по граф теле отдельно от остальных и типизация это в принципе относится ко всему граф келью нам это очень помогает потому что есть куча клиентов мне нужно гадать что будет при смене типа если потому что такое такая смена вообще принципе невозможно в наших реалиях какие есть нюансы у этой всей разработки и федерации поддержки вы если вы захотите использовать такой подход как федерации что-то другое может быть непала определите модераторов схемы это в принципе везде говорится и полу с вами ребята говорят что у вас должен быть либо человек либо группа людей которые погружены полностью ваш продукт и знают как тот или иной тип объявить где сделать какую-то к вере и и так далее потому что зачастую если у вас не будет модератора схем то все начнут городить свое и в итоге у вас получится одна огромная хоть распределенный нос схема разгаре сезон ответственности сервисов это просто вы просто на примере с пользователями и продуктами не пихайте сервис продуктов пользователей если вы знаете что это два раздельных сервиса раза два раздельных домена то просто старайтесь разграничивать их зона ответственности и последнее у apollo нету примет решения как я уже сказал если вас устраивает счас решение то в принципе окей почему бы нет но если у вас жестко завязан и по каким-то политическим причинам вы завязаны на свои сервера то наверное вам придется разработать свои схемы реджис 3 есть у конкурсной версии но вы можете сами их протестировать если заинтересуетесь этим вопросом на этом все спасибо большое за внимание будем рады ответить на ваши вопросы спасибо большой ребят так вопросы во первых могут быть из зала во вторых напоминаю тем кто нас смотрит в онлайне что вы можете либо ткнуть на кнопку и прямо выйти в эфир к нам если вы не стесняетесь и мы были бы очень рады вас увидеть либо давайте пока сюда здравствуйте федоров андрей мтс видал вот я не очень понял вашего рассказа кто отвечает в итоге за модель данных если это ваши команды не оказалось ли вы не оказались ли вы узким звеном хотел бы уточнить кто занимается модели данных в текущей схеме или раньше текущей схеме моделями данных занимать как как раз люди которые ответственны за свой за свой кусок например если это продуктовые направлении если вы команда занимающиеся продуктом то вы отвечаете за модель данных если у вас какая-то вы понимаете что ваши данные будут ваша схема будет дальше возможно использованы в других командах то вам нужна более плотно просто взаимодействие с другими командами так как на нашем примере это вертикали и несколько направлений поэтому вам просто нужно организм банально организовать встречу и обсудить все это дело наверно так здравствуйте здравствуйте и спасибо за доклад меня зовут жуткий алексей devops монтажа компания good нет вопроса первое это сколько времени у вас условно переход на мон-ре тэгов quelle и переход на федерацию и насколько вы уже перешли на федерацию процентном соотношении и второй вопрос это при распиливании монолита когда вы обновляете схему в федерации граф к вере если возможность применять часть трафика на микро сервис всего на 100 процентов уходить туда переезд в принципе на графике наверно но около месяца занял это что вы там входило это собственно описание самого граф хельги и твоя это разбить ее вот по доменам властям наших ручек продуктов так далее вот приблизительно месяц мы переезжали на графике на федерацию тут больше часть времени заняло собственно разработка самого это вот схема реджис 3 давайте до на самом деле без приза на федерацию было неоднозначно все то есть сначала пробовались решение sas как раз таки от студию но потом мы поняли что как бы не катит и схем регистре примерно полтора-два месяца заняло разработка а дальше просто плотная интеграции его с с сервисами которые у нас были в первую очередь это с графским монолитом но тут просто нужно понимать что интеграция с микро сервисом заключается не только вот взяли схему запушили и и перенаправили трафик и все пошло это еще плотно интеграция с seo сиди процессами потому что вы не будете это все ручную делать вот поэтому в целом где-то полгода от полугода закладывать на если у вас большая схема граф кель который нужно поделить причем это будет плавно отвечая на второй вопрос насколько я понял вопрос 2 бы заключалась в том что можно ли нам перераспределить трафик там половину например направить на федерацию а половину оставить граф кель старый арест до можно действительно можно вы просто на самом деле трафик можно перенаправить вообще как хотите ходить и поэтому изначально так и было бы федерацию раскатываю там 5 10 15 20 процентов она хотела в городке ель и у вас не вам никто не запрещает ходить в тот жертвам параллельно существует просто в конце концов вы должны прийти к тому что у вас в нашем понимании что у вас есть единый интерфейс для клиентов чтобы потом не было каких-то проблем здравствуйте спасибо за доклад веников артур тиньков тимлид подскажите а вот как то вот можете прокомментировать ситуацию grace ал degradation когда один из сервисов не работает ну и как бы ни хотелось бы получать вообще пустую страничку как-то вот вы это обдумываете как это собственно происходит спасибо да суперский вопрос вообще на самом деле как происходит ситуация без граф келлер федерации например у нас есть тот же самый граф киль монолит которые ходят какие-то фсб http сервисы там pajero писи не важно что будет если этот один из этих сервисов откажет то же самое как бы тут мне кажется вы должны подумывать логику сами но с федерацией случае с федерации вы можете кастомизировать сервис сам таким образом что все будет как вы хотите или если в случае если мы говорим что например сервис вообще лежит полностью и мы не получили его данные да действительно здесь нужно будет скорее большую клиенту заморачиваться с этим как не отрисовывать мы с такими пока что проблемами на самом деле не столкнемся возможно столкнемся будущем что кусок отвалился и мы ничего не показывают но пока что это решается на клиентах андрея porsche руссланд вопрос освещения если вас карманная федерации в целом под интеграцию совру для оптимизации джейсон трафика вопрос есть ли у нас карманная федерация для арман и под закладки под интеграцию с авр у из джерси нет но я moment1 мы не разрабатывали самую федерацию мы взяли библиотеку поэтому интеграции с афро или герпесе нет федерации леджер 5 тоже нет здравствуйте меня зовут василий разработчик тоже очень интересный доклад спасибо у меня несколько вопросов о них принципе коротенькие первое очень интересно на чем написали самолет жесты схемам с кимом допинг что это то просто static какая-то которая дается engine и сам лишь ждать и вы туда наверное пушки просто vogue тому все первый вопрос в том как написано схема реже стали на чем что это такое вообще да вообще на самом деле его работа примерно похоже на git версии там и так далее но это сервис на год а как вначале говорили что нога 8 красивый спишь нет это просто обычный сервис нога у него есть внутренний реализации наши там силой штуки которые позволяют нам вся и сиди и работа с ним и у него есть там документ hk то есть вы можете сделать push там сразу понятно да спасибо на головы тоже принципе планируем у нас уже тут такие реализации сейчас думаем на чем второй вопрос не думали о том что есть смысл фильтровать вот эту большую джейсон схему до разными клиентами то есть одна схема и каждый клин говорит я хочу вот это и получает то что он хочет а не пытаться вот так вот создавать какую-то универсальную такую штуку не было таких вопрос заключается в том что не думали ли мы отказаться от грязной эти была проблема что одна большая схема очень много данных о чем говорилось в начале да может быть просто каждый клиент будет говорить что он хочет забирать эта схема будет сама обрезаться под те потребности которая есть у клиента консилера что-то у вас такой есть наверное да или нет я не совсем был вопрос как клиенту фильтровать это пожалуйста get параметры мы там да нет это палимся ну да тогда на байке пришлось бы если такая то версия кен уит ну да не очень еще хотелось бы спросить вот нет проблемы большого джейсона то что вот один джейсон такой вот стороне страницы до загружает с помощью одного большого джейсона он очень тяжелый клиент сидит ждет особенно если мобильный трафик вопрос в том что есть ли большой jison трафик который передается с клиента на сервер правильно сервер на клиента ну безусловно у вас трафик любом случае идет то есть может быть отдельными кусками отправлять действительно по старинке они или я неправильно вопрос про то что у нас главная страница напрашивается одним запросом получается огромнейший дже сок объект deep нет проблем с этим нет все прекрасно работают не все спасибо спасибо трассы спасибо за доклад андрей максимов мартова вопрос следующим не было ли задачи если было так как решали и и когда нужно запросить с клиентов какие-то связанные данные например получить пользователя по пользователю вытащить рекомендации там еще чуть чуть чуть вот такого рода да это собственно тут тот одна из тех проблем которые решают федерации у нас то есть у нас есть несколько сервисов одна схема для клиента вы видите ее то есть связанные данные то есть к примеру есть пользователи есть его отзывы например отзывы обычно это представим что они лежат сервисе продуктов как нам сделать так чтобы пользовательский сервис ничего не знал вообще о том что у него есть отзывы очень просто вы берете в сервисе продуктов там где используют там где есть отзывы вы просто пишете я как сервис продуктов я хочу расширить тип пользователя который предоставил вот тип как раз таки сервис пользователей я хочу его расширить и добавить ему там что-то связанное таким образом когда клиент видит эту схему он видит что у типа пользователь есть например отзывы но сами отзывы и предоставляет и сервис пользователей сервис продуктов но для клиента от реализации скрыто полностью он видит это как единую одну схему большую федерации как раз занимается решением такой проблемы спасибо за доклад василий там можно и уточню вопрос может быть поможет нет то есть сервис продуктов которые ничего не знают о поле хорькам там а вот злых до или наборот сервис точнее продукта знает это аббатствах он делает запрос и получая данные и возвращает их в ответ для клиента или клиент потом идет еще за этими данными персонализированных клиент делает один запрос дай мне пользователя его отзывы смотря смотря на то какую информацию он хочет получить по пользователям например у нас у пользователя есть last name и есть reviews что будет отзывы федерация сначала загрузит пользователя загрузит его last name is сервиса пользователя а затем возьмет где о том что федерации чтобы расширить ип вам нужно чтобы он каждый тип имел некий прайма реки то есть правило ключи them for инки хотите чтобы она смогла передавать его после того как она загрузит этого пользователя она возьмет его айди но появляется праймари и отправит сервис продуктов ну то есть r федерация как раз туда мы этим занимаемся демонстрируют эти запросы для себя все понял спасибо руки продолжим вопрос я как понял у вас был ботаник именно в сама монолитным граф quelle схеме да вот вопрос не думали ли вы решить как раз и и другим способом то сделать несколько условно монолитов по форме клиентов ну там применить bff это чтобы клиенты сами сопровождали они вы бы их сопровождали вроде бы есть избыточная дублирую ность потому что фактически мы получаем много схем примеру если там user name нам нужно будет в три схемы вносить но с другой стороны сопровождении падает с командой платформы на команду клиента который в принципе может договориться то есть в dip бэкон добавляем поле а дальше нужны клиенты добавляем вот в этом направлении кажется что они пошли если есть какие-то причины расскажите очень интересно нет в этом направлении не пошли потому что поддерживать это тоже стало быть тяжелее еще раз вас до разные клиенты разные там версии ну это был бы просто неудобно наших реалиях не рассматривал до прошу прощения у нас уже подходит время поэтому все кто вопросы задать не успели то вот сейчас мы проводим ребят дискуссионную зону это можно будет с ним поболтать давайте сейчас во первых выберем лучший вопрос из тех которые вы были заданы и мы этом человека вручим книгу не проигрывал degradation такой дискуссионный вопрос но я к сожалению него полностью не смог ответить а может поднять руку человек который задал отлично вот запомнить его вручить ему книгу давайте еще раз благодарим ребят спасибо большое вы тоже получаете от нас памятные подарки идите сюда всем спасибо ребят еще раз вас грибы и я не смогу так это отлично передайте колледже спасибо путин привет я артем я бывший краха бы сейчас буду подкаст на обречены при этом знакомиться при этом познакомиться меня зовут ольга и я занимаюсь в компании компаний безопасности приложений в департамент безопасностью приложений это что-то особенное не как сказать что-то особенно я стоял где-то в таком важном моменте который связывает собственно мир разработки и меры безопасности потому что зачастую как представится себя себя люди делают опасности это ребята которые не знаю периодически запускают какие-то сканеры узи мастей и дальше приходит предположим к ребятам структуры со словами ребята у вас здесь я не знаю какое нибудь узел мое приложение но обычно эти сканеры связанные с безопасностью vendors кого по то есть и не знаю вы предположим на капельку им тапочки он black star овец если у вас есть компании своей разработка то разработчики пишет уникальные уязвимости который сканер уже не найдут обычный то есть предположение знает о дженесс с которыми пользуется большинство компаний грабитель и собственно вот я пытаюсь внедрять различные практики безопасные разработки поиска узи масти собственно в разработке которая ведется в компании работ и в чем заключается процесс уж какие мы пользуемся различными во-первых с камерами которые именно сделаны для аптечных гирек это статически анализаторы к 1 безопасность мимический анализаторы код безопасности различный сканер зависимостей которые проверяют какие вообще фреймворке какие библиотеки используются и все ли там хорошо западенцы также пишем какие большие инструмент не слизь какая-то специфическая пожму логика который не можно поселить динамический анализатор из коробки то есть предположим тот же бур поселит enterprises юта прокаченного любовь писать enterprise они не всегда могут качественно проскользить на безопасность то есть например динамический сканер как работают они отправляют какие-то нелады с кавычками и дальше смотри какой ответ пришел и не всегда исканием предположим по зубам какие-то специфичный приложение и специфичных запросы предположим под них мы пишем код свою логику и также проводим ручное то есть первый не потому что одно делает безопасность когда какой-нибудь кавычки ты можешь зайти под админом другое дело то что есть должен какая-то бизнес-логика и предположим она может ли наш конец черного реализована и уже предположим какого-то типа узи масти надо проиграть рука ну и также проводим какие тренинги и пытаемся всячески просвещать разработчиков помогать правильно составлять с технические задания и консультировать на каких моментах чему не могли подумать как это сделал безопаснее на моменте именно ну вот именно когда ты проводишь в кедре глюкозу так вообще существует что ты учишься бочков как писать код так что было безопасно чтобы не было уязвимостей мы проводим тренинги с точки зрения любви кода мы используем используем подход грей бокса тестирование когда мы одновременно имеем исходный код приложения положим понято дебаг режиме и дальше предположим отправляем поднимаем положение локально подключаемся к и пешки и дальше смотрим а как же себя пойдет тот или иной пилот термы отправились клиента и как он пойдет в приложении вот примерно с точки зрения такого региона безопасность mod + поиск каких-то типичных небезопасных функций которые практически во всех языках программирования есть различные магические токаге валы которые ну плохая идея использовать на разработчики периодически во всех компаниях что-то использовать бездумно хотя не знаю вы х мануале к их языку написано что ребят если вы это используете на 10 распаду но не всегда там устроит и до 10 раз подумайте и собственности такие пункты мы тоже ищем глазами несколько ложку каким-то причинам с этим не справился их статический анализатор но чаще всего статические анализаторы справляются с таким review еще мне кажется я часто встречаю такое отношение к безопасности что это ну какие то просто формальности перестраховки паранойя нет ну я в принципе наверное могу конечно согласиться что это перестраховки паранойя но если у вас есть команда ищем security который занимается именно безопасностью вашего приложения вашего кода то мне кажется разработчикам если они научиться дружить и правильно понимаете эту команду станет ли осуждать потому что куда наверное проще когда теперь принесли уязвимость которую нашли еще на стадии тестирования над столицей ja чем когда какой-то хакер вынесет знает что-нибудь через приложение перебежит бизнес а посреди ночи сослали надо срочно что-то фиксик мне кажется by запретишь верить помогать чуть спокойнее жить разработчик ну вот как на твоей практике по них это доносить как мы то объяснять приходится на самом деле в большинстве своем я сталкиваюсь с разработчиками которые сами хотят венецианки самих просыпаться потому что очень быстро до людей доходит то что если самостоятельно в этом всем разобраться если самостоятельно вникнуть и приходить ко мне по любому вопросу и консультировать то скорее всего у них получится написать безопасный фото и когда он едет до меня что там уже будет минимальное количество проблем и им не придется это исправлять здесь же есть какие то еще не только кого потребность безопасности какие-то еще требования регуляторов например да конечно конечно требование от регуляторов есть мы например и компаний писать компонент и мы собственно должны использовать вот все что связано с жизнь циклом безопасной парового это и нам с эпическими завтра динамически это можно подходить к этим требованием абсолютно по-разному и соблюдать как по разному мы стараемся дамы эти с кривыми соблюдаем мы но мы стараемся делать больше чем требует регулятор потому что даже больше очередь да потому что это надо не для того чтобы быть всем вместе с компания понятно это надолго в первую очередь как это безопасность которую влияет и на нас и на наших клиент и мы хотим предоставлять качественный безопасный продукт может быть расскажу какими надо скиллами бога что будут заниматься тем чем ты sms наверное понимает собственно как пишется код как работает приложение поднимать собственно пока будет база данных как строится запроса как наверное работает уязвимости община целом к как работает в моем случае приложение продаж надо во первых еще но не определенную фантазию и наверное желание бесконечное желание узнавать что-то новое ну вообще звучит вроде как что это надо уметь чтобы уметь разрабатывать тоже имеют может быть особенности чтобы именно вот ведь нюх на безопасность и если я не меня верное сложно про это судить и судить про себя и про друзей и коллег но я наверное у меня сложно сказать что безопасники чем заключаются но возможно это просто специфическое мышление с большим желанием что-то сломать но она но мать она опять же без с одним желанием что-то сломать мне кажется у их нельзя поскольку надо еще понимать собственно как написан код потому что одно дело отправлять кавычки облака боксом когда ты видишь незнакомец сайтик и просто кидаешь кавычки другое дело разобраться и распутать общее а что же происходит на может быть даже небольшой короткий ликбез такой вкратце пару советов как писать так чтобы у тебя было меньше вопросов разработчикам чтобы у меня была ну такие его можно безопасно верно и самый главный совет хорошо знать язык на котором ты пишешь если есть какое-то сомнение по поводу использования той или иной функции пойти еще раз прочитать на сайте посвященном какому языку про это функции например для php в большинстве большинстве функции если они предположению безопасные как же on сериала из большими красными больше большой такой текст выделены красным или были сказаны не использовать эту функцию если бы именинникам не понимаете что она делает не понимаете как сделать и безопасно 1 верное основное то самое главное просто хорошо знать язык и также читать материалы про то не же такие специфичные для того вообще насколько того чтобы хакерские скилл и прокачано безопасника такая интересная грань что и те и другие должны иметь и уметь что-то похоже ну мне кажется что хороший безопасников должна быть очень хороший хакерских строить потому что в любом случае когда ты и работы ящик rehab от компании и занимаешься зачитай если ты не понимаешь как ломать ты вряд ли поймешь как защищать туда так ну ладно спасибо тебе за рассказ шума дофига вам всего пусть расскажет пишут безопасный код и чтобы проблем было поменьше и возможно когда это это будет добрый день меня зовут александр сергиенко я ведущий разработчик направлении потоковой обработки и больших данных компаний neoflex наши компании имеет более чем 15 летнюю историю и обладает обширной экспертизой в области фильм тихо банковском секторе сфере кредитных бюро не секрет что этот сегмент айти является одним из самых технологичных и требовать иных с точки зрения объемов данных скоростью обработки тайну market масштабируемости отказоустойчивости вместе эти требование дают разработчикам широкие возможности для технического творчества и примения новых концепций подходов и технологий в этом тип толк я бы хотел осветить тему монетизации кредитных историй и выделить наиболее яркие с технической точки зрения моменты с которыми мы сталкивались в проект компания flex связанные с построением аналитической платформы крупнейшего российского кредитного бюро позволяет раскрыть тематику обработки и колоссального объёма данных на фоне высоких требований к отзывчивости стабильности и горизонтальные масштабируемости системы законодательства российской федерации обязывает финансовые организации передавать сведения о кредитных историях заемщиков в так называемые кредитные бюро каждый приобретенный кредит будь то покупка нового автомобиля или ипотека каждый платеж или просрочка даже сам факт запроса отчета по кредитной истории выполнены через интерфейс на веб-сайте все это становится частью истории и входят в обширный и непрерывно расширяющийся массив данных кредитного бюро случае рассматриваемой аналитической платформы речь идет о сотнях миллионах хранимых кредитных историй и связанные с ними информации каждый день кредитное бюро обрабатывает десятки миллионов запросов отчетов по кредитным историям сотни гигабайт новых изменений от кредитных организаций и формирует миллионы вы до мнений о полученных обновлениях для банков клиентов в основе бизнеса кредитного бюро лежат три типа продуктов обслуживание запросов отчетов по кредитным историям анализ изменений в историях и формирования уведомлений различных типов это так называемые триггеры а также оценка заемщика с точки зрения его надежности и неплатежеспособности так называемые спарринге триггер это некоторые события который является реакцией на то или иное изменение в кредитной истории чем меньше временной отрезок между изменениям и производным событиям тем выше вероятность успешной монетизации этих данных рассмотрим реальный пример михаил открыл счета в двух банках каждый из которых занимается потребительский кредит они оба банка хранят кредитной истории своих клиентов в одном и том же кредитное бюро но банк номер два назовем его west best offer дополнительно приобрёл продукт триггеры в отношении ряда своих клиентов в том числе и нашего героя михаила михаил приобретает в кредит новый смартфон и по случайности для расчета процентов и переплат обращается к менеджеру банка номер один клиентам которого самый является банк запрашивает кредитную историю михайлов бюро и после получения ответа предлагает ему кредит под восемь процентов запрос кредитной истории от банка номер один также является ее частью аналитической платформы бюро обрабатывает запрос с точки зрения триггеров и генерируют уведомление для второго банка то есть банка в с best offer который ранее приобрела солдаты соответсвующе услугу реагируя на полученную давление банк номер два присылает михаил с мсс выгодным контур предложением кредита под более низкий процент и клиент с радостью его принимает рассмотренный сценарий описывает лишь малую часть возможных вариантов монетизации данных по кредитным историям ходе анализа требований и предпроектного обследования анти ландшафта кредитного бюро мы поняли что тех логический стык вас дата в основе которого лежит симбиоз уже ставший классикой big data и потоковых подходов к работе с данными может решить существующие проблемы и дать бизнесу возможность реализовывать принципиально новые продукты при разработке аналитической платформы критически важными для нас являлись следующие требования первое это снижение той тумаркин для новых продуктов второе переход от пакетные к потоковой обработки и real-time продуктом с минимальными задержками обработки третье внедрение технологии машину обучения и жизненный цикл разработки моделей так называемый м.л. abs для задач с хилинга и 4 надежность некая горизонтальная масштабируемость и высокая отказоустойчивость платформы на достижение поставленных целей мы применять лучшие практики devops и м люкс работаем с репозиторием моделей мой flow и тепло реализуем процессы соседи используем современные фреймворке библиотеки потоковый как стоит вас такой стоит в обработке данных blood bank light flow об отчеканен капочи spark а к streams оперируем дата лайк на базе тихо дуб используем apache cassandra до оперативного ханин данных и c в качестве хранилища файлов масштабирование отказоустойчивость обеспечиваются рядом подходов и технологий в основе которых лежит платформа артист рации контейнеров open shift центральной части топологий аналитической платформы находятся высоконагруженные потоковый проложу некоторые также называется pipeline нами они разработаны с использую фреймворка апачи frank который располагается под зонтом продукта удачная регистрации разнородных потоковых сервисов который назвается live band клауд future платформы полностью соблюдает концепции реактивной архитектуры взаимодействие между отдельными сервисами и pipeline и полностью асинхронно и реализовано с помощью пачиков к аналитическая платформа разделена на технологические под модули которые обладают слабой связностью независимо масштабируются и строго изолированы можно выделить следующие основные модули аналитической платформ первый это pipeline и подвале для обработки данных которые обслуживают процессы захвата анализа и трансформации входных данных 2 этапа система master data management которые идентифицируют изменения или запрос и определяет к какому субъекта кредитной истории он относится 3 этапа клайн и триггеров и поклонись корнаков это основные и самые нагруженные потоковые приложения платформы которых служит соответсвующий бизнес продукции в том числе оперируют модели машинного обучения в школе нгаха система выявление изменений и формирование виктору в данных для a business pack line of и модели обучения это наш последний под модуль источники данных аналитической платформы можно разделить на два сегмента первый сегмент это онлайн поток который включает запросу скоринга и отчеты по кредитную историю томашу these руется в платформу при помощи rest api а и построенном на базе той книге клок этот поток обслуживается стекла с микро с сервисами и выделенными pipeline амин основе likelihood лу и а к стримить на данный момент они обрабатывает около трех с половиной 5 миллионов запросов в сутки ро сегмент источников это пакетные данные которые состоят из файлов с изменениями по кредитным историям пакетным запросов с колин гав отчетом по историям а так же с сервисным файлами которые обслуживать бизнес продукты платформы например в списке клиентов для отслеживания в отношении триггеров этот сегмент обслуживается высоко нагруженными потоковыми приложениями на основе apache web link и в данный момент обработать около 80 миллионов изменений в сутки с неравномерным распылением нагрузки с пиками до 15000 событий в секунду каждый сегментов и модуль аналитической платформы спроектирован с учетом гибкое горизонтальные масштабируемости пакетные данные 2 сегмента анализируются и разделяются на отдельные события с момента появления такого события платформы функционирует в рамках событий на ориентированной архитектуры каждое обновление или запрос проходит идентификацию в подсистеме master data management и обогащается средними о субъекте изменения эти обогащенные дискретные события в потоковом режиме передаются в подсистему выявления изменений и дали обрабатываются специфических зависимости от типа при обработке изменения кредитных историй рассчитываются дельты так называемые состояние было стола и соответствии с текущими настройками формируются новые события для дальнейшего анализа в pipeline их триггеров и формирования онлайн уведомлений для клиентов бюро давайте вспомним наш кейс с михаилом его покупкой подсистема оперативной обработки событий также занимается расчётами викторов так называемых печей для моделей спарринга при поступлении запроса на scaling вектор извлекаете из оперативного хранилища и подается на вход модели видео из запроса сама же модель при этом сзади плен и как обычный под кластера опыт shift разработка модели машинного обучения для сколько выполняется в отдельной области так называемой аналитической песочнице это отдельный класс строкам shift и инсталляция cf или hadoop оснащена инструментами для работы специалистов в области дата сайнс проект гипотез валидации моделей а также механизме вынос и модели в продакшен на базе репозиториев модели эмали flow результаты работы бизнес сегмента фанатической платформы то есть результаты запросов кредитных историй сколь инков а также события по триггером могут передаваться к ментам в режиме онлайн через и пео или с помощью сервер сын twins или пакет на с помощью файлов механизм получения результатов зависит от возможности и потребности клиента и никак не ограничиваться в страны платформы ядре тех логического стыка платформы лежит фреймворк артист рацией гетерогенных потоковых park live live band плавать flow фактически это точечный фреймворк объединяющие кубер найти с операторы apache spark apache твинк и а который позволяет строить разнородной с точки зрения бэкенд поль плане в контексте единого метаописания и процесс дипломатов среди его пошлют эрику берну эти с разными действия между компонентами pipeline of асинхронная для этого используется пачиков жизненный цикл of a чаплинка я почти спарте делегируйте соответствующим губернатор супинатором подавляющее большинство потока и приложений аналитической платформы работают с хранением состояния так называемый csl обработкой 90 процентов стрейфа обработки выполняется с помощью патчей fling остальные десять с помощью apache и spark и в основном это касается работы с даты лайк и ходу потоки встретил обработки на патчи frank зачастую шарнира ванны с высоким максимальным параллелизмом что позволяет быстро менять степень параллелизма операторов на более на нужных участках проекты выполнять горизонтальное масштабирование системы с появлением нативной поддержки губернатор привези апачи fling 113 перспективным и миру им отказаться от текущего купить из операторов frank от компании не вт и реализовать динамическое масштабирование blink рабов тоже настал момент делать выводы проект аналитической платформы для кредитного бюро позволяют полностью перевести существовавшие ранее бизнес продукты на real-time обработку радикально повысило производительность отказоустойчивость масштабируемость за счет новые реактивные событий на ориентированный архитектуры ключевой бизнес продукты триггеры теперь выполнять в режиме онлайн и задержка между получением обновление и формированием события для клиентов 90 процентов случаев не превышает 10 секунд при пиковых нагрузках аналитическая платформа обрабатывает десятки миллионов изменений ежедневно обслуживает высокие пиковые нагрузки до 15000 событий в секунду и при этом имеет возможности для гибкого горизонтального масштабирования с ростом числа клиентов средства разработки проверки и вы в продакшен для модели машину обучения также позволяют повысить качество продуктов скоринга и снизить тайм ту марки для новых моделей и продуктов технологии фас дата и потоковой обработки в целом позволяют достичь минимальный задержек и значительно повысить монетизацию ваших бизнес данных он пожалуйста да всем привет у нас снова же atashi я рад снова приветствовать седьмом зале и хочу представить вам следующий доклад перед нами выступит николай карла файлик уткин из малых групп с докладом угнать за 5 миллисекунд встречайте коллеги добрый день очень рад вас здесь слышать видеть столько лет не проводили конференции наконец-то собрались это очень здорово что ж давайте знакомиться не показывает надо clicker взять здесь задержка давайте знакомиться мы работаем в mail.ru в отделе архитектуры системы хранения данных мы займемся пилотированием проектированием и проверка гипотез реализации сложных систем с нетривиальными требований как по нагрузке так и по обработке данных олег уткин разработчик я главный архитектор сегодня мы будем половину времени в прощении сегодня будем половину времени говорить о постановке задачи в постановке задачи как принято в научно сельских работах в общем начинаем в прошлом году к нам обратились коллеги из московской бирже задачи разделения торговых ядер как правило разделения чего-то одного требуют консолидации чего-то другого и часто очень большого количества этого самого другого и здесь не исключение разделение торговых ядер означает что нужно консолидировать потоки данных из торговых систем и доставлять их клиентам мы с коллегами из московской бирже провели пилот он был успешным по пути мы собрали много кораблей много интересных выводов сделали хотели сегодня об этом поделиться свира давайте поймем что же такое разделить торговые ядра день и торговые ядра фактически это возможность проводить сделки на разных торговых рядах по различным критериям по инструментам например одни валютные пары на одном торговом ядре другие валютные пары на другом или например можно конкретную ценную бумагу все все сделки связаны с ней проводить на отдельно торговым ядре часто это требуется при листинге крупных компаний и почему это важно то есть очевидно что такие архитектуры на изменения требуют огромного количества усилий в этой должны каким-то образом окупаться вот для чего все это нужно но кроме того что это масштабирование до то есть очевидно это масштабирование на запись можно большее количество сделок секунду обрабатывать также это минимизация рисков вот представьте себе выход на биржу очень крупной компании там не знаю вот представьте себе кого-нибудь сбербанк будет выходить на биржу нужно этом есть ну представьте себе как будто бы это будет делать вот поскольку бирже так или иначе происходит много разных процессов то выход листинг ценных бумаг может там каким-то образом аффекте с другими процессами и вот соответственно для минимизации этих рисков чтобы сделка не сорвалось часто держит запускают такие успехи на отдельных торговых рядах вот я думаю что самая главная мотивация это делать вот главные требования были примерно такие клиенты не должны видеть что-то происходит то есть уже есть существующие протоколы трейдеры и брокеры каким-то образом и уже эти данные получают не должно быть существенного изменения это в очень важные условия все должно очень быстро работать не добавлять дополнительные задержки а кроме того если вы что-то реализовывать эту транспорта он должен масштабироваться и на чтение и на запись то есть не быть узким горлышком вот прежде чем мы двинемся дальше давайте обсудим как работает биржа очень буквально на пальцах стоимость определиться такая заявка или торговый ордер в общем-то это желание кого-то одного купить что то при каких-то граничных условиях эта заявка попадает в биржу биржевой стакан встречается с другой заявки который там уже находится ну если все срастается то получается сделка и в результате заявка менять свой статус вместе стоит которой она встретилась и что-то происходит либо если заявка долго находится в стакане то сделки не происходит и инициатор может ее снять вот так работает мастер торгового ядра это одна поточное приложение которое занимает всю память на сервере и горизонтально масштабируется на чтение за счет реплик которые очень интересно построена то есть фактически это такие же копии торговых ядер только на них направляются абсолютно такие же заявки в том же порядке и когда все хорошо а как правило это сюда именно так эти реплики фактически практически не отстают от мастер иногда даже опережают и они перешли сверяются почек суммам и они являются серверами доступа и к ним уже подключаются трейдеры брокера для того чтобы рассказать о сложности этой системы в частности нужно упомянуть о том какие есть важные вещи то есть поскольку мы в первую очередь работали с ордерами то есть торговыми заявками и именно их мы доставляли потребителям соответственно определим некоторые вещи с ними связаны первое этой это глобальные счетчики в бирже в торговом ядре есть счетчик который напал на увеличивается при добавлении каждой новой записи очень похожи на на первичный инкрементирование ключ это рик он же рекорд нам бы есть еще другой счетчик более интересно работает он увеличивается с каждым апдейтом который происходит на торговом ядре если какая-либо заявка обновляется что-то с ней происходит этот счётчик увеличивается на единицу и эти два поля есть во всех заявках можно себе представить как будто бы есть биржи таблица заявок и в этой таблице есть колонки рек и сект и эти колонки используются для того чтобы клиенты могли получать максимально свежие данные о терем обсудим как они получают того чтобы понять как проектировать систему доставки нужно понять как это работает сейчас а сейчас работает образом клиент имея паров рек acer то есть зная о том что в бирже был какой-то апдейт с каким-то номером это что есть запись с другим номером эти знания у него есть он просит максимально свежие либо изменившиеся либо новые данные он их получает и берет из последней заявки следующую пару лет и сек используйте как continued шин talking таким образом клиенты получают данные постоянным полингом они хотят получать самые свежие данные но без пропусков и здесь есть также запросы на чтения по вторичной плечом поскольку не все пользователи хотят видеть все данные не так и отведите их только свои или только фирмы в которой происходит торговля или толь конкретного брокера и так далее очень теперь мы готовы сформулировать требования вот к этому черному ящику . той системе которая должна доставлять торговые данные первое требование это удельная производительность то есть на один узел система должна уметь принимать и до 200 тысяч транзакций в секунду при этом время которое проходит между тем как сделка произошла на бирже до того как клиента не узнал должно в среднем быть одна миллисекунда но вместо девяти процентов случаев должно укладываться 5 миллисекунд вот кажется что это похоже на очередь мы действительно какие-то события происходят клиенты получают эти события но как выяснить это не совсем так во первых биржа дает только только изменившиеся данные клиенты хотят целиком ответы нужно отдавать состоянии а кроме того если клиент отстал на несколько микросекунд или на миллисекунду тон появились более свежие данные касательно одной заявки и клиент не хочет из старых ведь самые свежие вот таким образом у нас должна быть производительность на 1 200 тысяч рпс отставания должно быть в среднем одна миллисекунда клиент не должен знать о разделении должен гарантируется порядок данных и данные должны отдаваться без пропусков теперь давайте уже прощения почему-то не работает clicker что женитесь кажется компьютер завис вот вот и тут мы понимаем что на самом деле мы имеем дело одновременно с базой данных с очередью с индексами с каждым вторичными индексами вот и тут возникает мысль как это делать либо действительно сделай сам взять реализовать целиком систему с нуля либо взять какой-то инструмент который обладает всеми этими свойствами то есть может быть очередью может быть очереди с индексами и может гарантировать latency мы предположили что для этой задачи может подойти тарантул поскольку он такой же однопоточный in-memory как ядра бирже написан на си имеет эффективный асинхронный protocols мультиплексирование фактически является фреймворком для того чтобы строить базы данных у него есть система хранения и индексации то есть вторичный ключи таблицы в первичные ключи может хранить данные на диске их восстанавливать есть репликация шар 1 gom что в целом кажется все сходится но есть нюансы вот и дальше мы как раз поговорим о том как мы подходили к этой задаче задержка опять происходит доход в общем поход доклады мы будем ввести некий такой счетчик целесообразность использования технологий будем давать совет очко если технология подходят и глобусу если это попытки притягивания за уши или чего другого elect тогда я передаю тебе слово давайте я подробно расскажу о том одиторов из к реализации первых давайте вспомним как у нас выглядит структура данных у нас есть два ключевых поле поле рек и поле acer соответственно не означает номер заявки номер изменение зачем мне поля нужны по сути эти поля позволяют клиенту по генерации по данным это обеспечиваются следующими свойствами а прикажи нам in сердце у нас комментируется рек а прикажем апдейте у нас имитируется acer вот таким образом когда клиент приходит за данными мы можем быть уверены что данные ему пойдут нужном порядке он получит самые свежие версии данных об ордерах и у нас не будет пропусков вот и чтобы понять как это рисовать давайте разберемся как работают составные индексы на вот таком примере простом вот у нас есть составной индекс состоящий из двух полей field 1 и фил 2 и допустим мы хотим выбрать некоторую запись который будет у нас сходиться по ключу два , три что нужно для этого сделать соответственно мы идем по первым полю ищем двойку и уже отсюда дальше двигаемся ищем тройку и причем такой прыжок у нас будет заниматься логарифмическое время и найдя этот момент в яндексе мы можем дальше же продолжать тренироваться по данным как по связанному ски списку поскольку у нас используется плюс три деревья в которых все листы прошиты связанным списком то есть мы дошли некоторые места в яндексе и дальше уже спокойно можем за константам время приходить к следующему элементу и как это будет выглядеть нашем случае нашем случае как я говорил ранее у нас есть поля рисе крик на первое место мы ставим сек поскольку сег у нас означает он означает свежих данных вот arekkz tenses test на второе место и вот у нас в яндексе лежит некоторые ордер мы хотим его обновить что происходит таком случае в таком случае у нас комментируется acer то есть из этого же орды прыгать дальше в яндексе и у нас не корректируется рек и соответственно мы уверены что теперь этот ордер находится самом конце индекса аналогичная ситуация со ставкой случай со ставкой у нас происходит что данные которые приходят от торгов ведра в них будет всегда максимальный сег то есть нам будет просто достаточно выставить максимальный редкие также стоит данные и тогда в таком случае у нас появляется граница того что самые свежие данные у нас находится в конце индекса когда клиент придет вот сможешь проектируется забрать данные которых у него еще нет вот и можно сделать вывод что в данном случае тарантула очень хорошо на подходит потому что в нем несколько возможность соответственно плюс в совет вот а теперь давайте поговорим об верхний уровень stick туре поговорим о том что мы вообще должны реализовать ну главное основное само хранилище данном случае у нас хранилище был аризона трант или что она делает ну очевидно хранилища хранить данные и кроме того внутри себя она содержит логику обработки этих данных и кроме того нам ещё необходимо рисовать эмуляторы торгово ведра и мотор клиента зачем это нужно в рамках и тестирование к сожалению у нас не было доступа к реальному стенду заказчика то есть мы не могли процитировать на реальных данных на реальных нагрузки от клиента поэтому нам нужно реализовать некоторых эмуляторах которые мы сможем использовать при локальной отладки вот так же эти мулиа тары позволяют нам собирать большое количество меток и таким образом уже делать какие то выводы богом производительности о том какие можно оптимизировать вот чего мы начали мы начали с максимально простой структуры по сути нас было всего две хранимых процедур и 1 apple i went просто принимает данные кладет их сторож и 2 процедура get ордер с которой эти данные умеет давать клиентам работать следующим образом клиент приходит с некоторым ключом как мы говорили ранее то рек и сег который означает в какой момент времени клиент становился читать данные и когда он все еще раз приходит с этим ключом он может быть уверенным что данные которые запросит у него первых будет свежее тех которые допрашивал до этого и данный будет идти в правильном порядке кроме этого если данные который приходится торговая ядра по сути это событие то есть это событие о том что допустим заявка была создана события о том что заявку заявка была удалена либо там как-то обновлено вот а клиенту даны уже идут виде конечно состоянии то есть клиент получает среднем давление которое было в торговом ядре вот и мы решили начать тестировать тестировать мы начали с нагрузки папа записи вот и как казалось таком случае у нас мы легко проходим слоем то есть если нам там нужно 200 тысяч транзакций в секунду на запись то мы легко выжимаем больше двухсот пятидесяти тысяч и даже можем какой-то момент дойти до 340 вот вроде бы все супер не комментируем еще раз сову но затем мы решили протестировать чтение и вот обнаружили какую проблему в какой то момент времени при увеличении количества клиентов наступает момент которые отставания клиента торгово ведра резко возрастает такой рост происходит бесконечно и система уже не может из него вернуться производится за вот почему потому что наше хранилище пристает успевать принимать данные из торговой ведра виду чего сильнее увеличит отставание клиента от него вот и мы решили гадости руется до инкрементируем глобус появились небольшие проблемы и мы решили исследовать эту проблему вот начали мы с того что хорошо бы нам очень наглядным мерить то насколько считают клиенты как и говорил ранее при генерации ордера в нем у него кладется время создания ордера и когда клиент получает может сравнить время создание когда и время когда он прибыл клиенты уже вот и он может дать эту систему мониторинга не можем за этим следить вот и действительно обнаруживаем что в какой то момент времени нас появляется резкий рост задержки вот что мы сделали дальше мы решили посмотреть а сколько же цыпа употреблять тарантул и обнаружили что сетевой поток тарантула перегружен то есть данном случае получается что он уже не может адекватно обрабатывать не только запросы от клиентов но и данные которые будут приходить с торговые даром причем есть еще странно наблюдение в таком случае у нас резкого https тк лента то есть клинтона это очень-очень часто ходить нашу систему при этом в этом все таких запросов очень низким то есть мы можем сделать некоторый вывод о том что клиент ходит очень часто но при этом запросу не очень короткие возможно не получает данные возможно еще как проблема вот и тут у нас есть низко симптомов у нас перегружайте свой поток нас выросли резко gps и клиентов и коляски запросы стали очень короткими есть какие-то предположения что могло произойти происходит вот что кратко объясню как происходит обработка данных по сути обработка данных у нас происходит видео очередями в эту очередь приходит данные новые из торгового ядра затем клиент эти данные пытается вычитать и в таком случае все хорошо то есть клиент выбирает кит кусочки данных при этом он чуть-чуть стоит от торгово ведра и с работа хорошо но есть отдельно случай когда клиент становится быстрее чем уже чем торговая ядро то есть он гоняет уже торговые дро и начинай из-за этого данные которые выбирают они становятся очень маленькими очень мало чемал записи за этого делать всё больше и больше больше запросов тем самым сильнее нагружая систему и тем самым замедляя прием данных от торговой ведра тем еще сильней усугубляя ситуацию и нас происходит конечно роста вот почему пришли ну мы сделали вот что хорошо бы теперь начать еще мониторить какое количество пустых ответов мы отдаем клиенту мы померили и оказалось что таких ответы более 70 процентов и связь вот этого роста количества простых ответов распадается тем моментом когда у нас происходит резкий рост задержки от клетки издержки лент торговой ядра и делаем вывод нужно минимизировать количество почему мы пришли если раньше процедура обработки данных была максимально простой то теперь мы сделаем вот что когда приходят новые данные нашу систему мы смотрим насколько эти данные свяжем и сохраняем самым последняя информацию о самым последним ордер который прошел нашу систему и в таком случае когда клиент приходит с некоторым ключом можем понять что этих данных у нас может не быть в системе и в таком случае мы цепляем клиента и пока они придут новые данные либо пока не пройдет тайм-аут клиент будет ждать это очень удобно резать в tarantul и поскольку в тарантулов есть 2 тыс никогда подобия крутин с моим файбер и и есть конечно верю было который умеет выступить файбер и разбудить его уже его уже с другого то есть таком случае когда приходят новые данные мы можем просто с процедуры которая пишет данная его разбудить причем стоит заметить что когда клина просыпается ему не приходится продавать новый оператор может перед использовать его то есть данном случае у нас что продолжить итерацию нам не нужно заговорить логарифмическое время опять искать позицию оператора яндексе мы можем сразу продолжит это делать почему это привело ну во первых у нас простых ответов почти не стало ввиду чего у нас резко снизит количество пакетов секунду то есть мы уже сильно разгрузили сеть и мы разгрузились свой поток тарантулы самом деле более чем 15 процентов какой вывод мы это сделали то что число двойных данных это очень важно метрика и это нужно контролировать а чтобы контролирует нам нужно еще и мерить тогда мы решили собирать сколько данных у нас приходит клиенту это было очень удобно сделать виде тип мо по сути гистограмм по времени и вот здесь хорошо видно что пустых ответов у нас уже нет но при этом почти все еще очень маленькие то здесь видно что у нас пик находится единицы то есть большая часть пачку нас размера 1 и хорошо бы этот пик сдвинут правее то есть увеличить размер пачки которые будут клиенты получать вот что мы для этого сделали самом деле нам получилось даже упростить систему теперь функция который принимать данные у нас возвратился начали состоянии она просто падет данные хранилище а процедуры который забирает данные она делает select если она понимает что данных которые ей нужны нет или патч к которым мы должны отдать ей отдать клиенту она слишком маленькая то он засыпает и просто идет какое-то время сделать это снова и если мы укладываемся в отнести лет инси запросы может еще раз сделать противном случае модель он дан как есть вот и такой оптимизация дала вам очень хороший прирост размера пачки то есть если раньше у нас было около 1 1 записи пачки то теперь уже 20 а сколько времени ожидать приходилось ну это зависит от того насколько большую пачку мы хотим от зависит от того на сколько у нас какая-то размер пакета например то есть все эти данные мы можем подобрать экспериментально вот как раз нам в этом очень помогает метрик который мы собираем а отставание клиента торговой ведра ну и в том числе размер пачки вот и мы решили померить что же получилось таком случае и тут уже видно что на таком подходе можем накапливать даст нашему щепочки там по 40 до 70 элементов вот и очень это очень сильно разгружает свой поток и при этом позволяет нам оставить след нас очень низким вот еще одно очко в пользу совы тут надо понимать что это long polling но только в размере половины мили секунды то есть там сотня микросекунд приходилось ожидать чтобы приходили новые данные потом можно знать его short полинг в каком-то смысле да вот и давайте дальше уже поговорим о том как сделать так чтобы мы могли спокойно разделить торговый ядром на несколько кусочков несколько родов и при этом чтобы клиент не знал об это сложности сортирования и при этом сохранять порядок данных который будет ходить клиенту вот начинается счет вот вот с чего у нас по сути изначально у нас есть одно торговый ядром и чтобы клиенты получить данные ему нужен по сути один ключ чек и рек и он может спокойно поэтому кучу сбирать данные сдавала торгово ведра но когда она становится 2 торговых кедра появляется проблема то что клиенту во-первых ему нужно знать в каком торговом ядре же данные и для каждой торговой драй могут по сути попадется иметь отдельный ключ вот и что же с этим можно сделать во первых можно навести определенный суррогатный ключ да то есть чем он хорош тем что нам не нужно менять протокол то есть что бирже раньше использована можно дальше продолжить это использовать ничего менять не надо какие же есть минусы первых появляется либо единая точка отказа либо данное у нас и согласованным а если согласован это работает это очень медленным и второй вариант что то придумать что то другое и мы решили использовать векторные часы почему это хорошо это хорошо потому что во-первых это скроет сложность шарден га то есть это достаточно знать какой источник а точнее иметь ключ который даст наша система и он слизь раз может стать выключим прийти и дать этот ключ роутер и ротор уже сам определить в какой sharp нужно отправить дан какой шар дан в забрать данные может быть из нескольких когти данных мер жить вот и таким образом эту проблему можно легко решить при этом минимально изменив протокол из сохрани согласованность данных вот и как же тогда в целом у нас выглядит шарлин ну во первых как мы говорили у нас есть нет несколько источников источники напомню это кусочки разделена на торгово ведра и эти кусочки можем какой-то своей логике как мы хотим поделить на нужен нам шарды искать и мы можем по дублю на несколько шагов вот мы можем сделать реплики сколько угодно нам нужно реплик и таким образом очень гибко масштабируется почтением вот этот стоит вспомнить что на самом деле у нас 2 вида клиентов первый вид это клиенты которые хотят получать некоторые подмножества данных фильтру его и получать их данные с низкой задержкой это могут быть различные брокеры это могут быть трейдеры которым нужно допустим только какой-то определенный инструмент или там какие-то только свои заявки к примеру и есть второй вид клиентов клиент которые не хотят фильтровать данные то есть не получают весь поток данных которой у нас приходит торговой ядра но при этом им задержка минимально не нужно и что мы можем с этим сделать поскольку мы знаем что минимально задержка нашей системе находятся на мастерах мастера мы можем вынести клиентов фильтрации которые хотят минимально задержку и данных не получают только некоторые по множество а всех остальных клиентов которым фильтрации неважно и и мне нужен минимальной пенсии мы их можем вынести на реплику причем мы знаем что клиенты без фильтрации но фильтрами естественно нужны то есть индекс в нем тоже не нужны таким образом можем сделать редки в которых не будет индексов и таким образом во-первых мы экономим на репликации поскольку когда данный переход на реплику я не нужно по этим данным строить индексы и мы можем сэкономить по памяти потому что индекс этим не придется хранить вот и с таким подходом нас получается следующее данным во первых на нас получается сохранить очень низкую задержку у клиентов котором она важна и делать это место того что больше большое количество клиентов можем вынести на реплики причем реплики у нас имеет некоторые состава не я вот и как раз это нам позволяет поддерживать низкое время отставания клиент от источников при этом сохраняя среднее время состава не его на миллисекунды вот какие оптимизации мы делали еще у нас есть некоторые тела ответа это ответ который приходит от нашей системы клиенту и вот как он выглядит у нас есть некоторое трассировка трассировки хранит в себе информацию о том как сколько времени какие операции в хранимой процедуры происходили то есть это нам уже будет очень полезна во время диагностики системы будем понимать где у нас что медленно работает во вторых сюда же мы кладем самый последний курсор в пачке то есть клиент может взять этот курсор не читая данные дальше и сразу же делать следующий запрос и кроме этого мы еще читаем когда была создана самая старая запись пачки вот причем все эти данные находятся заголовки в самом начале зачем это нужно затем что чтобы делать следующий запрос клиента достаточно считает только заголовок то есть вот он считывает следующий курсор берет сразу делать запрос при этом не гадь декодирует тело ответа до конца почему это важно как мы отвечали раньше тело одного ордера занимает около 600 байт то есть это уже много у нас целая пачка там по 20 лет может нам по 7 из элементов и таким образом чтобы клиенту прочитать сообщением нужно потратить задач большое количество данных а таким образом можем оптимизировать и давайте вернемся аккумулятором поговорим чуть подробнее о них зачем они нужны ну как я говорю ранее у нас есть два типа эмуляторов это эмулятор торгово ядра эмулятор клиентам что они делают ну во первых меня эта торговая ядра он умеет генерировать ордера который дальше уже пойдут систему причем в этот ордер и он кладет время создания ордера таким образом когда этот ордер придет на клиентам можем почитать время за которое эта заявка прошла от торгового ядро бедра до клиента то есть все путешествие заявки по нашей системе а кроме этого аккумулятора торговый ядра умеет генерирует всплески то есть когда такое происходит что какие-то инструменты например начинает торговаться намного интенсивнее умеет сохранять нужную нам скорость генерации данных умеет считать с какой скоростью долина будет даваться на самом деле и все это давайте уже в prometheus что дед эмулятор клиента он также собирает большое количество метров в том числе его собирает ресы которые у нас приходит из самого хранилища тоже их и дает приготовила считает размер пачки вот и таким образом можем проследить как у нас целом работа системы кроме этого есть еще отряд метре который у нас находится самом хранилищем трантон обновляется сделать он во первых смотрит собирать данные о том насколько нагружены его потоки подсыпку собирают различные метрики о корневище в том числе там время в скорость вставки апдейтов select of замирает с какой скоростью растёт таблица и также все это дает вот и как я говорил ранее тестирует мы начали не у клиента а на своем личном стенде то есть у себя и в этом не было проблем и мы могли удобно использовать sealine и эмулятор виде семейных туров это ну нам это было удобно но затем нам уже потребовать протестировать систему на стенде заказчика при этом прямой доступ к этому стенду нас не было нас был человек которым мы говорили пазу мы могли ему давать какие-то команды то есть мы пришли к выводу что нужно это как-то оптимизировать и таким образом эмулятор такова игра обвиняется в один и нет некий демон который умеет автоматически паникую никому конфигу никому профиль нагрузки запускать научных источников на нужный аккумулятор другого ядра и нужно аккумуляторов клиентам вот и как мы то мы можем сделать в комплексе как мы это делали у нас есть некоторые полное описание как должен выглядеть выглядит тест как должна выглядеть конфигурация кластера как должен быть как должны быть настроены эмуляторы ну клиенты из и торговые ядра и можем просто с помощью от конфига полностью разделить систему и запустить тест и то есть человек на другом конце провода статочно настенную команду которая полностью все раз тепло это запустит тест но только остается отдать данные которые накопились примите оси и дальше все эти данные мы можем уже у себя дашбордов удобно анализировать то есть по сути у нас есть полная картина всего что происходит в класс 3 во время теста и давайте подведем итоги что нам удалось сделать ну во первых нам удалось добиться того что система умеет принимать 200000 транзакции секунду на один узел на запись при этом у него хорошая задержка клиент никак не зная это разделение не знать сложности жерди рования как на систему встроен внутри данные клиент удается нужном порядке причем эти данные без пропусков и клиент всегда получает самые актуальные данные и что не менее важно наша система умеет быстро давать не только холодные данные которую это горячо дано которые только пришли потоково но и холодный данные в пределах минуты или предел определен террором дня вот что в итоге ну во-первых мы успешно подкорректировали архитектуру arm систем доставки торгуй информации с помощью тарантула вот и пилот закачка был признан успешным и будущем будет дальше развиваться и это еще один плюс ставим сова ликует можем сделать вывод что наш инструмент которым выбрали для задач он подошел почти идеально кого мы тут обманываем покажи настоящий счет да вот так лучше не всё так было гладко гораздо больше было подводных камней мы не коснулись например того что любой компонент мог отказать и требовалось дать ответы и протестировать а что будет если откажет торгово ядро а что будет если откажет сервер практически камбербэтч если вы структуры вот но на это бы не хватило бы никакого времени поэтому в общем на здесь есть кое-какие выводы первое это если возникает какая-то проблема прежде чем завершает надо научиться измерять вот и выбирать находить ту метрику которая коррелирует с моментом возникновения проблемы только так можно хоть что-то решить можно несколько недель биться над тем что что-то не работает но пока нету метрики бесполезны от решать форм систему нужно строить итеративно от самого простого на самом простом как правило возникают самые банальные ошибки и в том числе самые сложные и необычные и потом уже систему можно масштабировать ответив на вопрос а как вот один экземпляр себя ведет и дальше уменьшается количество возможных путей куда систему нужно развивать важно мерить все бизнес метрики начинаю вот в этой задаче сквозное время прохождения через систему важно мерить различные технические метрики например spot ng петров для того чтобы смотреть что пакетов в секунду смотреть утилизацию различных потоков и так далее то есть это все очень важно и важно чтобы это все было в одном даже городе чтобы можно было видеть корреляцию того что происходит вы видите что у вас увеличивается количество пакетов в секунду вы видите что у вас растет потребление сетевого потока вот видите здесь растет количество запросов можно сделать гипотезу но бежать чинить не надо надо найти еще одну метку который бы эта гипотеза подтвердило бы опровергла это очень важно важно понимать алгоритм и как работают в данном случае мы описывали b плюс дерево мы смогли складывать данные так чтобы все свежие данные то есть это либо те которые были обновлены либо те которые были вставлены были в конце дерева это позволило нам сделать iterator который будет идти по этому дереву как по связанному списку это очень эффективно также когда нужно добиться высокой скорости низкой задержки иногда полезно делать замедление это кажется таким вроде бы очевидным моментом но если этого не делать то можно наступить на очень любопытные грабли как например клиенты могут получать ошибки приходить еще раз до их нужно каким-то образом замедлять и для этого либо circuit breaker используется либо можно искусственный задержки вставлять само приложение и несмотря на то что нам нужны доли миллисекунд задержки при высокой производительности высокой нагрузке мы все равно клиентов замедляем это очень эффективно работает и эффективно работать вместе с объединением контролем того как сколько мы записи клиентам отдаем вот и это очень важная вещь она позволяет минимизировать количество походов по сети и сэкономить довольно большое количество процессор на во времени вот и здесь так же важно не бояться тестировать разные инструменты в ходе этого пилота брали в тест совершенно разные инструменты разные версии не только тарантул и мы смотрели как что работает и в итоге мы выбрали именно тарантул потому что он подошел лица сдача как вот такой фреймворк да и собственно говоря спасибо за внимание будем рады ответить на вопросы да олег никого спасибо большое давайте тогда вопросы важно у нас есть вопросы как здесь такого онлайне а в онлайне тоже не стесняйтесь задавать если кто-то все-таки осмелится за сегодня выйти на экраны с дома то мы будем очень этому рады за лучший вопрос как обычно в общем книжку так что вы тоже следите и какие вопросы мы сдались это нужно запомнить так придется память тренировать здравствуйте не вот alexander ayzenband такой вопрос то есть какой-то мент вы решили разделить своих клиентов на тех которым важно получать ответы с низко лотностью на тех которым это не важно во-первых вопрос как вы планируете напротив сделать клиентов между теми которым важно задержкой не важно 1 так сразу на него то есть хорошо на самом деле клиентам которые являются трейдерами и брокерами важно задержка регулятором например администратором она менее важно потому что они обрабатывают различные ситуации уже отложено спустя секунды хорошо тогда другой вопрос а вы как-то оценили какую нагрузку вас генерируют клиенты из первых категории какие с другой категории у них очень разные профили нагрузки клиенты которые получают все и и slang полингом то есть они очень сильно нагружают когда они отстают потому что они начинают в судорожных попытках догнать данные вот клиенты которые с фильтрами они нагружают немножко по-другому они нагружают одинаково сильно и когда они находятся в моем стриме то есть для них данных чуть-чуть и когда они в конце и причем они нагружают сильно еще в том числе потому что там используются дополнительные ключи они имеют другой порядок они чуть медленнее работают ну ты сегодня проверить гипотезу что у вас 5 процентов клиент берет 50 процесс нагрузки ну я скажу так что тех те которые с фильтрами поскольку для них данных меньше они нагружают меньше в целом чем те у которых получают с той же частотой все данные спасибо большое спасибо за доклад у меня два вопроса первый вот у вас клиенты они делают геты то есть они работают через полинг это вызвал вот проблема то что их надо иногда замедлять потому что они общем не знают когда get из пара да не думали перевернуть эту систему и на пушит сделать вместо вместо пола и зная нету почему думали это это в планах ну там есть другие сложности клиенты могут переставать успевать обрабатывать и забирать данные и там можно упереться в сетевой буфер какие-то данные потерять и любая схема пушек всегда имеет rollback в виде гетто потому что клиент может что-то пропустить и до получить поэтому как бы эти любом случае необходимый функционал и потом мы помним что у бирже есть на самом деле через youtube и различные протоколы которые отправляют данные без каких-либо гарантий возможностью восстановления то есть надо понимать что этот конкретный транспорт нужен для определенных задач на себе допустим не раз просто не распространение сделок для блюмберга ли reuters и это не хайд рейтинг то есть это нечто что посередине то есть это подключение брокеров и трейдеров то есть фактически людей которые используя там эти данные какие-то дела пишет роботов или руками торгует то есть поэтому здесь ну и плюс неготовность наверное вот с самих компаний которые эти данные получают и ходить иного протокола то есть там все довольно консервативно в целом фанов такое есть что это кажется более эффективным и понял спасибо очень интересно а второй вопрос вот вы сказали что там таргет и по задержке это 5 миллисекунд и там миллисекунды на 99 person силь а как считается задержка наоборот в среднем одна миллисекунда августа 9 побед считается от момента того как в торговом ядре сделка совершилась 0 изменилось заявка до момента как клиент ее прочитал в то есть к нему пришел пакет с этими данными а на каких новых физически time stamp то берется то есть же разница между двумя таймс темпами и я просто введу по вопросу как вычислить экранизируются вот я рисовал слайд с серверами доступа то есть это сетей сервера которые практически на микросекунду в общем-то консистентными с мастером вот на них как раз громко запускается таймер то есть к этому серверу доступа пишется модуль на на плюсах который пишет в таранто вот вот в этом месте происходит замер то есть момента гока того как вот мы собираемся эти данные отправить в socket в систему доставки до момента когда клиентская библиотека уже на сервере клиента эти данные прочитала ну да но получается что вот один по местам берется вот на на этом сервере а второй все равно на сервер клиента да а как вы же не можете просто взять разницу между time с темпами на двух машинах там же на часы синхронизатор в тестах и синхронизировались до микросекунд то есть биржи есть железки на сетевой карты когда позволяют это сделать естественно если клиент находится в другом в центре мы не можем гарантировать время это ненужность для colocation должны быть такие примерно там требования если в нету они естественно не такие то буду болеть его задержка понял спасибо большое 1 раз здрасте спасибо за доклад вопрос такой вот вас там был на слайде встретились роутера который может и развили роли это были отдельные узлы предпочтений не расслышал встретились роутера которые были у вас на арте в турне диаграмме это были отдельные узлы которые вот муж these равале на разную ядра это были развернуты на том же сервере узлы таранто монет просто было интересно почему бы не запихать все в клиентскую либо на самом деле здесь есть определенные сложный в том что в таком случае мы вынуждены позволить клиентам ходить ко всем этим шар дам по сети и открывать доступ и то есть в этом случае раскрывается внутренний топология которую можно в течение дня меняться и не хорошо делать так чтобы клиенты вынуждены были перри конфигурировать довольно сложно планета в цифрах 200000 комната ps на запись то есть там еще и персистенции делался на даст пирсе стильность но вот мы например добивались того чтобы в одном узле хранилось от 50 до 100 гигабайт данных соответственно сверх этого мы шар де равале какой протокол использовался для сериализации там самом деле два один из них место чпок то есть я значимые поля по которым происходит фильтрация и правила выборки они в местах пайки для того чтобы можно было их учитывать бизнес-логики tarantul и остальные части не интересны для бизнес-логики запакованы просто фиксированном там структуры фиксируем про таком то есть какие то там красавцы какие-то были поверх этого там если например перезагрузить реплику погромче какие-то записи традиционная до редакционное торговое ядро отправляет пачку транзакций в одном типе пакете и все отправленные пальчики применяются атомарном традиционно спасибо у меня есть еще вопросик спасибо за доклад скажите пожалуйста а как ваша архитектура учитывает финансовые риски или считается что клиент может только читать данные но и писать понял я не расслышала может еще раз повторить пожалуйста интересует финансовые риски ведь клиенты могут как получать данные от биржи так и формировать поручение нам на покупку на продажу неважно вот вопрос как это учитывается схеме далее схеме тут чуть чуть не нужно потому что создание заявок это связи с помощью уже существующих механизмов есть речь идет только о раскрытии информации то есть только о получении информации о ходе торгов но не создание заявок до или каких-то других сущностей правильно понимаешь что данная система позиционируется как замена цветка не совсем замены квк это другой проект который мы обсуждаем с биржей здесь скорее фтор на mustang я понял спасибо спасибо да у нас уже кажется время на вопросы закончилось вот давайте мало попробуем их продолжить задавать вот там вот кулуарах сейчас мы тогда туда тоже проводим спикеров а сейчас из тех которые уже успели задать давайте выберем лучший вопрос какой вам больше понравился надеемся что этот человек сейчас не выйдет не выбежал в аудитории стремительно была целая серия вопросов из этой части зала так как система не видно формулировку вопроса может быть вспомнить умеешь вопросы давай кинем кубик какое число навернул по время проспал интере давай ты там от одного до пяти давайте любой какой вопрос вообще запомнился но последний всегда запоминается но последний чувак точно ушел и предпоследний тогда тоже были интересны и давайте по формулировку все-таки так будет честнее и времени будем тратить ладно у вас есть еще какое то время чтобы это сохранить интригу до а мы тогда сейчас еще раз давать благодарим ребят спасибо большое сейчас нас как обычно будет перерыв поэтому просьба всем покинуть зал затем будут тех ток а затем новый доклад red спикера меня зовут дмитрий столяров я технический директор и сооснователь флант и скорее всего вы знаете и флант и меня потому что мы много говорили и писали про губернатор последние годы мы считаем что губернатор сетанта всего лишь инструмент и раньше единственной услугой которую фонд оказывал было комплексная drops поддержка проектов то есть мы не предоставляли кластер куба мы делали только проекты под ключ и чтобы делать их хорошо нам нужен был подходящий инструмент и как вы наверное знаете снах рассказов последние четыре года мы активно использовали купер нету в качестве этого самого инструмента постепенно докатилась до более чем 150 кластеров мы считаем что у нас получилось освоить и подготовить этот инструмент настолько хорошо сделать его поддержку и сопровождение настолько эффективными что мы стали готовым осаго предоставлять кластер и куба внешним клиентам с другой стороны мы видим что многие компании начинают активно использовать куб или планирует вот-вот начать использовать куб и мы видим их проблемы long story short теперь можно получить - губернатор у фланта в вашей инфраструктуре будь то облако или он прям первый кластер от 40 тысяч рублей в месяц второй и последующие 25 и это не голый cabernet с как предоставляют многие провайдеры и так uber нету со реально готовы к production с мониторингом с of the ski лингам со всем-всем-всем необходимым из самой крутой в россии поддержка от людей которые реально участвуют разработки куба и понимают в нем вы точно сможете сделать все сами мы ничуть не сомневаемся но нужна ли вам эта экспертиза или лучше сосредоточиться на приложениях на продукте хотите ли вы тратить кучу сил времени и денег на внедрение или лучше прямо сегодня получить готовый куб с гарантиями и по супер доступной цене подумайте и обращайтесь павел привет я отринет я бывший до краха вы сейчас ведущий подкаста мы обреченным при этом знакомиться лавина чем ты занимаешься я архитектор в решении работы в московском офисе компании redhead последние года 4 наверное я делаю всякие штуки вокруг к devops а вокруг убирать с вами красивая архитектура всего 5000 до я прочитал что ты уж вы у вас компании популяризатора микро сервисов это это маркетинговый ход да смысле но это видение нашего маркетинга я более скромных прошествии консоли в принципе да ну и что микро сервис и так действительно хороши как они все говорят последнее время потому жизнь они частенько начинаю слушать критику критика была есть и будет неизбежно но в моем понимании это это неизбежно ну на ближайшие какой-то обозримую перспективу горизонт событий все равно все там будем часто бывает что действительно замечательная технология но технология подразумевает присутствие какой-то культуры каких навыков вокруг этих технологии часто не хватает ну а какие то проблемы именно выделил бы тут думает что как бы кто и такое чтобы критиковать с одной стороны других стран и неформального общения часто вижу часто понимаю то что допустим вот ситуация с опция с командой сопровождении каких-то там технологических платформ часто бывает то что с административной точки зрения руководства не готовы инвестировать в эту команду люди несколько оторваны от общего какого-то глобального цикла им через забор передают задачи и говорят справляйтесь как хотите с ними не ведутся какие-то идеологии а прекрасно получается на выходе то что у нас такая борьба за псевдо стабильность мы боремся за то чтобы просто продолжала гореть лампочка на самом деле мы сидим своем отсеке слова понимаем что вообще происходит и что делать что делать есть такая идея то что давайте попробуем переделать психологию методологию работа нашего без команды в сторону и сэргэ чуть-чуть про наверно терминологии зачем это вообще нужно сергей сырья это сайт ривай ability и женили у меня очень плохо согнуты фразы дальше-то будет аббревиатура а зарыдает стране по сути это специальная редакция на самом деле devops практик потому что делится devops абсолютно те же фундаментальные принципы концепции главная разница то что мы как параноики пытаемся выстроить более устойчивую структуру с одной стороны с другой стороны мы принимаем перспективу наших конечных потребителей и это безумно логично моем понимании то есть мы мы воспринимаем любую операцию проблему как софт новую проблему то есть с перспективы того же пользователя абсолютно в каком уровне у вас что-то сломалось нас простой доступен сервис перспективно нашего бизнеса на самом деле приблизительно то же самое поэтому все проблемы просто буравит софтовых проблем что про порождает сдвиг в сознании abs команда садиться за один стол вместе с продуктовыми и разговаривать с ним дорогу к и фактически получается то что у нас разработчики становится функциональными заказчиками мышка перешить я не очень то зачем этот отличается просто культуры devops потому что длс они вместе работы для справедливо да здесь мы можем устроить глобальный холивар на тему разночтений именно терминология предлагает вам или не делать то есть ситуация такая то что по факту да действительно devops описывает все все все на самом деле что подразумевается его сырые по сути но по факту у нас не происходит вот этого сдвига но все равно есть некая изоляция команды нету понимания кто за что отвечает если мы идем в сторону и сырья и разделяем вот фундаментальный парадигмы скажем так и сырья когда у нас все на свете одна большая софтовой проблем загнал нас не будет разночтение кто за что отвечает ok например я понял что у меня в команде если это проблема и я такое говорю давайте строить а сырья как это давайте давайте нам нужен человек с определенным административным рычагом который в принципе сможет вернуть эту историю который сможет объяснить зачем это делать и что изменится это во первых во вторых наверное нужно следовать хорошую культурным практикам в плане создания именно в описании к мельнице с рио каких-то команд хотя на самом деле практике также применимо в принципе к создание любых команд большей части да это про культура про людей да я бы первым сказал то что провал это нормально ошибаться это это почему человеческие все мы люди и делаю не ваши тени в качестве ошибки не в масштабах это ошибки в том насколько мы поняли где мы ошиблись и что нужно делать чтобы ошибка не повторялось следующий момент наверное я бы предостерег гоняться за звездами в найме в моменте на членов команды звезды я подразумеваю не просто одаренных и компетентных людей историю когда определенный набор софт скилов двигает человек в вот именно в какую-то такую звездность болезнь когда он порождает какую-то информацию борьбу за власть или как вариант и или на самом деле мы своими руками нанимая звезду или звезд загоняем себя в рамках нашего предприятия в частный случай winder но когда там один или несколько человек действительно понимает как работает та или иная систему ну вот про звезд я как предпринимаю когда слышу говорят вот проблема звезд это очень сильно технические специалисты которые низко не считаются с практиками справили объект просто очень так стараюсь деликатную эту тему как-то проговорить потому что это тоже холивар на тему то есть одной стороны до звезды позволяет очень быстро начать но звезда с с перспективы стороннего наблюдателя будет для нас аномалии потому что у нас такой глобальную всплеск компетенция как любой аномалия бы досрочно перспективы и катастроф поэтому нужно отыскать какие-то такие середину все и ну очевидно вот как как вывод из этого быть абсолютно готовы вкладываться в развитие своей команды то есть гоняться не за идеалом гоняться за потенциалом смотреть носов скиллы причем отцовские выявлению не только в моменте то что парень хорошо умеет рассказывать какие смешные истории то что он действительно понимает как как и что он делает в плане бизнеса чтобы он чувствовал бизнес на самом деле все звучит безумно прагматично но акцент живу в реальной жизни этого очень не хватает я думаю если об этом говорит и может быть что-то изменится вопросы доверия вот например частности то есть очевидно то что команда способна сделать гораздо больше чем каждый из нас в отдельности но без без выстраивания доверия внутри команды без пропагандировали вот так такого рода культурных практик но мало что получается на самом деле мало того должно быть доверие со стороны руководства потому что без доверия люди теряют способность принятие самостоятельных каких-то решений и мы его получаем как тут команда не очень сообразительных робот что тоже нехорошо вроде наняли людей мы долго беседовали мы выдворили с их навыками но с другой стороны постоянным объем их по рукам и не даем принимать ему стать 5 на решение лайки должна в моем понимании логика должна быть такая то что на тех и специалист на берешь на себя ответственность ты делаешь эксперимент понимаешь получилось не получилось но объясняешь сопутствующие риски какие-то чем мы можем поплатится за это мы так или иначе у тебя есть свобода самостоятельно принимать решения но это требует очевидно или мне кажется здесь немного по-другому эту проблему чаще слышу о том что доверие как раз очень мало при найме а уже после найма бросаю свою как буду учить плавать сам обычно впечатление складывается прямо на моменте найма на моменте первое собеседование когда все жутко строгие и спрашивают не всегда адекватные вещи и человек выходит на работу и продолжает жить в такой же парадигме то есть он боится как высунуть голову бы боится проявить инициативу возложи на самом деле повторюсь да звучит банально бумаги по имени действительно важен вот наверно еще бы хотел рассказать про момент то что это вот классика окон source коммьюнити быть не согласны мы следовать курсу это на самом деле то же вытекает вот из смелости из доверия из-за такой умеренной борьбы системы здесь как-то противоречиво звучит вот здесь мысль заключается в том то что кей для того чтоб развиваться нам нужно экспериментировать для того чтобы для того чтобы экспериментировать на нужно какой-то на правление для этих экспериментов потому что мы но очевидно не может быть комментировать во всех направлениях сразу быть несогласным это нормально и ничего ужасного нету но идей заключается в том то что раз мы приняли какое-то направление мы должны ему следовать до того момента когда мы поймем то что либо шаги в этом направлении либо направлении целиком ошибочно когда мы фактически в реальном времени меняем вот это вот на ваших направленность экспериментов в общем другими словами да и мы должны избегать аналитический паралич иначе мы будем вечно натыкаться на одни и те же грабли до бесконечности причем таким серьезные глобальные грабли которые нам не позволяют действительно развиваться не просто какие-то мелкие штучки что-то там подхватили нас не получилось а именно таких концептуальный большие вещи но и как твои успехи вот в внедрение от культуры а это неизбежно происходит потому что так или иначе как будто чего мы начали то что есть запроса и со стороны бизнеса страны разработчиков страны безопасности откуда угодно есть запросы на имплементацию вот каких-то практических вещей из культурных garnier так или иначе это нужно делать просто если это делать более и неосмысленное если понимать то что рано или поздно мы туда придем то это наверное жизни наши станет не может попроще но какие-то проблемы сейчас основные на твоём пути моем пусть они сами проблем мы лак в понимании наверное бизнеса и руководящего состава в в сознании проблематике то есть опять же вот это вот порочная практика то что пока пока у нас каптерке горицвет это буквально равно то что у нас все в порядке хотя на самом деле мы уже серьезно опоздали в нас уже есть большие какие-то комплексы проблему то есть ты чувствуешь что сопротивление идет не от с персонала обычных разработчиков о псов и прочего а именно за руководство да но это не то что сопротивление это отсутствие такого осознанного понимания что происходит того что очевидно из-за своей роли людям тяжело вникнуть во все нюансы и пока не случится что-то из их вот показатели которые им близки очередным чего не случится и вот с чего я тоже начинал по поводу того то что в реальной жизни чудес не бывает для того чтобы случились изменения нужен человек с властью чтобы двигать эти изменения вот нужно найти холодное когда кто нас услышит о нас поймёт и о том одними тогда знаю я желаю тебе успехов чтобы это красиво большим лак непонимание исчезал и почти все получалось спасибо за рассказ спасибо я готов да всем снова привет приветствую вас в этом зале у нас осталось буквально два доклада сегодня и во-первых хотелось бы сказать спасибо серебряным способом данной конференции такси черного ops и озон и представить нашего предпоследнего спикера сегодня это станислав щербаков который расскажет нам про приметаю супер рейтер встречайте всем привет ролла stanislav друзья называют меня статьям что я могу сказать 85 года выпуска все запчасти оригинальные видел души 22 dial up by bets фидонет керну обслуживала порядка 700 став порядка 2000 виртуалок кубов ский кластер видел ну вот 50 и порядка 400 подав компанией блеск блеск это хотим панель 6 процентов интернетом 20 лет на рынке сильная команда разработчиков о чем будет сегодняшний мой спич найти в порядка пройдемся значит от старых систем мониторинга до новых проблем и мониторинга как быстро легко починить сервис discovery простите как быстро легко за мониторить инфраструктуру при помощи discovery новых решений расскажу про кроме того супер атор что это за решение и как мы катим собственно мониторинга закон про брейден инциденты выводы я был вам рассказывать где мы находимся для понимания что было удобнее мониторинг состоит из трех китов это метрики alert и и даже борды самого начала я что первая видел этом nagios дальше был когти добавили графиков после этого увидели zabbix современной системы мониторинга например надо то позволяет в отличие от забег сам discovery сервис автоматически если раньше мы использовали юзер параметры и делали это в руками с каждый сервис нам приходилось добавлять руками то теперь надо тогда позволяет самим за discovery можно поставить вместо zabbix агент например а также преимущество на даты она умеет standalone то что даже если у вас ввалилась громадный примет а у сможете зайти на хвост и на нем собственно посмотреть что происходит ну графом наверняка вы все знаете что касается аль ирвингом из такой отличный инструмент называется карма он позволяет собрать вам с агрегировать данные совет менеджеров в в один простой визуальный даже борту здесь может быть несколько кластеров несколько этот менеджер вот если вот 100 если воспринимать 1 лет которую в пул спросите в жизни не показывался то это волки все кричали волки волки никаких волков не буду дать поведем плане как проблема мониторинга первый этап сборник вы неоднократно сталкивались когда разработчикам надо выкрутить метрики admit реки только через админов проехали этот момент а метрики нас больше вчера всем наверняка знакомый заперлись у нас история мы все мы хотим наверняка использовать метрики я за год но не только по что это модно а потому что если вы поправите руками например даже бороду после при инсталляции или например вы не может учитывать изменения в коде можно смотреть да кто когда что за комитет наверняка все в курсе и анализ более то когда мы переехали система мониторинга , например на примете у нас на чашу весов 2 система одна из них про металлу с которым мы уже хотим используйте 1 zabbix которую мы не хотим уже сколько что надо поддерживать систему дорого ну тут по ресурсам для меня некоторых из моих коллег оказалось что не так сложно слезть со старой системы давайте использовать просто новую как как мы до этого дошли мы взяли prometheus он собирает метрики в качестве консула бормоча использовать консул не обязательно тут использовать код сможете использовать любую систему считай discovery вместо zabbix агентов мы поменяли нам дату в какие профитом из этого получили надо the same за без columbia параметры который раньше приходилось вручную делать как это все конфигурируется очень просто при помощи ему прошу обратить ваше внимание что у нас есть отличный микс пасту из латекса я буду на картиночке этот а пиво 1л metrics переходим к принтеру оператору знаете наверняка вот никого game changer а до которых всю игру поменял весы на к этому слева справа вот эти значки замечательная и небольшой мемасик купер найти это просто если вам недостаточно всех это ресурсов то вы пришли на правильную презентацию кто нибудь знает что такое каждом ресурсы финишем поднимите руки ну примерно половину здорово как я пытался объяснить ну не технарям чего это такое вы поднялись есть такой вещи как плагины например система extension of note это расширение кабиной сугубо я сам кастер ресурс выглядит как заголовок таблицу оокей вылью который мы в этой ресурсы пинаем соответствие зелененький что такое операторы поднимите руки пожалуйста знает ну в отлично публика давайте подробности не буду вдаваться нас есть курские ресурсы у нас есть ресурсы системные и контроллер берут одну там другое туда-сюда менеджер типичная работа оператора пользователь загружает каждом ресурс оператор обрабатывая концы лишь он предоставляет этот пластик как выглядит архитектура правит и аспиратор у нас есть сервиса и написали за тепло и разработчики ясира с монитора сей раз именно через монитор осмотр примитив оператора смотрят за service monitor and bright конфигурация prometheus давайте разберем как выйдя через монитор ну у нас есть api версия у нас есть на успей селекторов он смотрит на нами спейсер и обязательно самый низ от selectest лейбла обратить внимание на релиз да это релиз про металась оператора то есть в кластере может быть несколько ресурсов типа про металла суббота оператора если нескольких команды хотя то использована конфигурация то можно использовать разные что нам дает кроме того оператора с коробки вот такое количество сервис мониторов мы получили это более чем достаточно для того чтобы покрыть базовые метрики кластер а то есть это кордон с api сервис менеджер там но даг спорта ргублей хочу хочешь как это все дибашки оранжевая часть это про metals оператор голубая часть service monitor и сердцем это расположен в серединке находит сервис который смотрит на вас сервис но все мы сложно давайтесь кому интересно в кулуарах расскажу будет весело как работает про металла супер опроверг не потолочное справа мы видим типа ресурсов которым он предоставляет а он за ними смотрит он же генерируются но синенький квадратик справа он же день дерил и park conti пирамида усов прямота велась это перечитывает и также пропитался оператора отправляет alert manager вы загружая кастом ресурс перезагружаете конфигурацию и alert менеджера и самого про метался как выглядит про металла сруб то обычный типичный quelle то есть вы создаете ресурс типа про металла с рулон и уоллер подгорске ничего сложного какие alert и мы получили из коробки ну практически все если вы раньше поставили купер найти не знали где воскрешал бэкки какие у вас и недоступные ноды на переделку блед лег там copy серые контроля менеджер то есть весь набор миссис полинг обернется он предоставляется грубо говоря scared перес коробки а также губы миксин это часть про металл супер а то ну как часть это отдельные проекты которые которая давит комьюнити он позволяет при помощи джейсон это компилятор барды но как мне сказал один коллега еще и даже барда не компилировать заняться нечем соответственно нас это все сделала как ты выложил скомпилировал а если обратить внимание вот это количество нашей то есть раньше были алерта это количество до шейка травы получились коробки красивый даже бортик по это cd очень здорово поставили открыли смотрим где у нас сен кластер а какие были этот лидер чем же кого сколько у нас это cd лежит работает опять же абсолютно бесплатно из коробки то же самое касается куплета то есть обратите внимание не видно на графике видны нет вон пиковое значение это время у только 10 секунд если бы у меня не было про метался пирата я бы даже не узнал об этом открыл графику где-то проблемки у нас есть а что примет ios операторов не предоставляет из коробки эталон тем сторож но если вы знаете как у нас слева это стоит а то простите по 12 фактом как это называется не лангер сторож одни дни lung thermo стресс в точно простить стоит ли стала же него цена числе она стоит с мы относимся к ядру к этому справа у нас слон кем стоишь в качеством тез тура чем можете использовать два варианта это либо томас либо виктория меток смута нас это сложно это монструозно а виктория меток своде классный набирает обороты если кто-нибудь про пользовался этим то пожалуйста поделитесь экспертизу я буду рад мы находимся вот тут мониторинга закон а если с солеными понятно можете положить сей раз мониторы и прометею суровые рядом с репозиторием кода то как мы диплом свои это the alert его именно платформенные мы взяли hell i helped him он стал тем все это знает каким пользу долго рассказывать не буду кто нибудь сталкивался с пускателем была такая неприятная вещь когда все уже позади при крите и где искать артиста и было больно достаточно ну вот теперь их кроме того сам не про metals оператора куплю гривен стек но так как доклад еще планировался все это сентябре так что и переименовывать не стал как мы доставляем мы взяли home взяли ансимов взяли джин геймплей ты нарисовали групп wars иван себе для разных warmed в рейдов вот так вот создали вместе запустили вы вроде работает как вылетом в ходе текущей применение мы используем модуль анти балка 8s посмотрели в все про металл из руды в которой находится в отдельный файл и в репозитарии таки мне этот не сложным образом применили типичная лет выглядит вот так вот я году про на тату и надо тоже мордаха вам осталось девять кубер нитью она заехала вот типичная для надо ты что если надо то недоступному давай орать просить у обратить внимание что достаточно удобно вещь это рам буки когда вам приходит лет вы можете посмотреть ран бук и там сразу понятно что делать если выполним джинкс что мы делаем проверяем конфигурацию edjing -30 маджик стафф таком духе под любой из кейс можно описать что касается дашбордов сожалению мы пока не используем графа на оператора и мы не можем доставлять namespace доставлять графа навский дашборде из родных мы вписав но в дальнейшем планируем группа когда вот так мы доставляем джейсон заворачиваем в яму и потом только в диплом этот скупку бернейс джейсон сильно недоволен и за это бред инцидента наверно моя любимая вещь почему потому что но мало кто делится личным опытом и рассказывает мы утром утром личку как она есть знаете самого начала пойдем за счет fine now this is not fine 1 ч не может про metals операторов это достать ваши это cdn point из коробки придется как-то их за discovery течет с ними сделать второе самое больное если у нас не дай бог произошло изменение кастом ресурс diffusion схема то будет больно есть апгрейт гайд и не всегда это работает и не дай бог вы подумайте удалит релиз если ударить или рис вас попадут в красном ресурс диффе не шины и что самое обидное все еще service monitor и грохнуться у вас плотвы перекатить и все здорово платформу мониторится разработчики приходят и герб а где наши метрики бизнеса мгу смотрите мой alert и работают все классно в виду здесь этот монитор пропали но можно из предыдущих релизов достать как бы но имейте ввиду никогда не удаляете будем любом случае картошки не надо этого делать если вы выберите не оптимальные параметры сервис мониторов например я хочу искать свои сервисы по всем ным space ом и канала станет 150 или 200 namespace of у вас будет про metals оператор обращаться к фиксирован настолько много чтобы перебирать все сервис так что обязательно делайте мощную space а чего не может про металл сепараторов это обновлять камер является самого prometheus а без перезагрузки он имейте ведутся какие-то базовые метрики про металл из меняете то приметил 700 вас роста понес это прям как как пить дать вот поэтому я рекомендую использовать два медиумы 2 pro медоуз и для того чтобы не было дырок графиках и такая больная вещь как будто отсутствие меток нет метрик нет проблем на самом деле отсутствие меток эта проблема у нас харди перестал работать так что имейте ввиду что если у вас нет ну и тут нет ни даты с ваших метрик exporter of the nude делать она это alert и такая еще не очевидная вещь вы вроде как мы катим про металл из оператор вроде все здорово но если у вас api сервер меч гигабайт памяти он будет поломки лиц а потому что происходит мутация муху киба лев большого объема ну как бы она просто не работает ну и давайте попробуем про эту про заключение скажем админ у нас больше не ботаник разработчики сами могут доставлять своей alert и метрики и данное решение вкладывается любой по план где вы используете кубер не this вам просто надо добавить в холмы чарт 22 ресурс гиппо service monitor и prometheus rus ну и это все легко решиться на трассах сразу код потому что в эти самые ресурсы могут можете комитетов гид проводит сам вопрос спасибо большое так давайте вопросы как обычно говорю что вопросы можно задавать как здесь так и в онлайне если кто-то выйдет к нам в эфир будет супер и за лучший вопрос мы вручим книжку вот поэтому давайте активней да поехали есть у нас в микрофон спасибо за доклад на самом деле пачка вопросов 1 дате по одному посланы в кулуарах но набирайте лучше тогда что вы делаете со самым слабым звеном пробиты вас оператора самим про металл зимнего сколько сколько вас там метрик границы потому знаете интересный вопрос сколько про метал sonic армии все равно памяти много поэтому мы ушли на викторию metrics потому что ну у нас 60 гигов памяти и он все равно падает на самом деле я не озвучил да есть такая вещь как pictures 3 трикстер от компании comcast это реверс прокси и рекомендован можно поставить эта штука оптимизирует вас запрос если вы большой раньше выберите у вас про митоз много памяти захочет триптих помогает оптимизировать запросы и память есть меньше вот реальный пример например мы хотели посадить сколько у наседки желтом целевым оказалось он трафика желтом 130 мегабайт мегабит в секунду для того чтобы просто взять мы бы сделали выборку за месяц и у нас про металл уступал мы еще раз обновили в гавани дашборд и 2 примет его уступал мы даже поставки трикстера например на либо используйте остается какое-то стоит спасет только от запросов но если вы хотели новой версии приложения в которой большая кардинально с метрик и метрик становится много они хранятся в памяти и они точно также могут в видео я не готов когда ты ведь на носу продавать кларк еще второй вопрос сразу вот вы говорите что у вас 2 prometheus вы говорите что у вас две реплики про медиа сада как вы решаете такую вещь как отображение данных дашборде потому что каждый раз он идет в разный prometheus знаете у нас нагрузка того чтобы раза про митоз спрашивает метрики меня не особо пролетает мгновение о том и о том что метрики разные то есть они жене и синхронно за крышу запрашивают метрики 1 прометею запросил там в 5 секунд второй всем секунд и ты в дашборд обновляет что он сначала показал одно на второй раз показывает чуть-чуть другие метрики но для вас это не проблема но дабы право понятно спасибо спасибо за доклад меня зовут роман мой погромче да спасибо за доклад очень классная мысль была что не очень многие делятся опытом fa cup of вот и вопрос такой расскажи пожалуйста свой самый и 4 впечатляющий пока и как победили мы когда за скале и этот страх института 5 потом решили миграцию дает вам 35 потом три обратно и было прикольно когда порядок мемберов их ешь их поменялся и это здешний класть развалился от слова совсем ну то есть пришлось река варится 1 инстанса было очень неожиданно именно в отношении проме 13 а ну вот я играл я разрешу долю в лифте cyrus культуру удалились я с работы еду в электричке мне ребята горят огни бизнес новой метрики я только у меня платформенные все работает проверил ну вот пришлось и три десятка так понятно то исцеление карте файл файлов типа service monitor спасибо спасибо запад есть ли более простой способ собрать нужный себе кастомный и памяти astek не вкапывайте джейсон нет про металл с оператор позволяет тебе кубу митин из коробки брать ребята уже все соседи они уже джейсон с компилировали и добавили его как уже готовую картинку изолятов то что просто так же про металл с операторы тебя кубу митин позволяет и alert и даже порт и все из коробки видимо и пошло не по тому пути непобедимый пошел не по тому пути и выбрал кубе прометею стек в этом и есть раньше-то пролетел себя то назывался якубу мильчин доставляет alert дак они предлагают же с нет вот тут у меня нет надо кастовой фивах поговорим о пяти обязательно расскажу обязательно это прям коробочное решение что процент до этого спасибо но кажется все тогда можно выбрать лучший вопрос из трех лучший вопрос это вопрос метрики которые расходятся 2 кроме к фото с наполеоном отлично тогда вот человеку книжку и давайте еще раз поблагодарим спикера спасибо большое станислав себе мы тоже выручаем благодарю штуки и сейчас соответственно все тоже могут пройти вот туда fuaro там около столба дискуссионная зона и давайте вопрос здесь сейчас станислав туда тоже пройдет и там уже в зуме тоже присоединятся люди из онлайн и на все ответят вот а сейчас у нас будет сначала небольшой перерыв на профилактику поэтому просьба всех покинуть помещение а потом снова еще один еще одно онлайн включение и последний доклад на сегодня спасибо дедушка всегда говорил мне как важно трудиться и заниматься чем-нибудь настоящим где должна о чем говорит он был агроном и всю жизнь занимался сельским хозяйством и я продолжаю его дело все начинается здесь еда которую мы одежда которую мы носим лекарства которые нам так необходимы сельское хозяйство обеспечивает нас всем даже удивительно как много вам это belstaff каждый день мы создаём что-то новых изобретая планируем здесь и мне нравится быть к этому при частом ведь когда ты занимаешься чем-нибудь настоящему это всегда на и всем снова привет мы приветствую вас на последнем докладе в этом зале сегодня заключительном докладе этого дня и хотелось бы еще раз поблагодарить наших спонсоров благодать поблагодарить бронзовых спонсоров нашей конференции это компании цфт микс ул exact про а перед нами последний докладчик на сегодня это антон потеев и самоката который расскажет нам как они строят городскую структуру мгновенно доставки встречаем всем привет меня зовут антон потеев я технический директор самокате и сегодня мы с вами встречаемся на треке технологии будущего я посмотрел по расписанию да по программе которые выдали организаторы и чуть меня очень удивило то что все и технологии будущего у нас сейчас это проблем про блокчейн даль стоит реально весь трек налоги и будущее это платье бэкхем детей мы сегодня с вами поговорим немножко о другом дамага поговорим с вами о том как мы используя те подходы до которые привычны нам как найти инженером меняем физическую среду вокруг нас ok для начала давайте как бы поговорим вот вот о чем очень часто в нашем сознании будущее связывается с таким понятием как онлайн да готовясь к этой презентации я попытался not как водится добывает найти определение что же такое онлайн наса 2 ничего хорошего не встретил да то есть кроме как как буквальный перевод нигде нет ну то есть есть состояние на линии но на самом деле для нас всех онлайн значит нечто совершенно другое давайте попробуем разобраться что именно что приходит в голову нам всем да когда мы говорим онлайн я думаю что на самом деле на ответить на вопрос более менее просто да потому что мы можем взять не знаю там наш мобильный телефон посмотреть на список приложений да и сказать вот для меня например да онлайн это мессенджеры это возможно социальные сети возможно онлайн кинотеатр и да как там netflix или ока или и конечно же википедия один из символов онлайн я думаю что любой из вас этот список может дополнить он скорее всего вырастет там до сотни пунктов на все это как бы все это то что мы называем онлайну и все это произошло как бы в рамках той цифровой революции до которая возникла с появлением интернета но все эти вещи на который мы сейчас с вами перечислено практически все да я не буду говорить как категорично но практически все эти вещи были с нами и до этого до в качестве каких-то явлений ну например да то есть как бы мы говорим о том что в рамках цифровой революции произошло переход на из концепции которые были нам знакомые в оффлайне в онлайн ну грубо говоря раньше наши бабушки дедушки брали бумагу писали письма закидали в почтовый ящик кто-то их там получал сейчас мы берем открывая телефон пишем messenger человек сразу получает наш сообщение раньше не знаю вот как бы люди сыгрались во дворе и обсуждали какие-то истории да сейчас это значительной степени заменено социальными сетями когда нам хотелось посмотреть кино мы включали телевизор и если там шелк устраивающий над фильмы его смотрели сейчас мы можем посмотреть любой фильм просто нажатием кнопки запустив соответствующее приложение ну и информация я помню как в школе готовясь к реферату kb подходил полки там брал том большой советской энциклопедии открывал его и капитал туда переписывал сейчас к был современных школьников это выглядит совсем по-другому они открывает браузер запускает открывает века википедию и уже смотрят там бумажные энциклопедиями практически никто не пользуется кроме может быть отдельных людей давайте давайте посмотрим на самом деле что что объединяет все эти вещи да вот как бы что что такого произошло что принципиально изменилось с появлением онлайн для меня на самом деле я выделил три три важных свойства до который лично для меня определяют что такое онлайн первых это доступность до многое нам стало просто просто доступна на то есть опять же беря пример с энциклопедии до иск вообще с информацией джим точно можно сказать что информация стала доступней ну то есть если раньше до какой-то книге не был у меня дома мне нужно было ехать в библиотеку а так случалось ещё иногда что если мне нужна была какая-то редкая информация какой то редкое издание или не знаю статья даже в городской библиотеке и и могло и не быть им не нужно было не знаю ехать время скоблить как в москве да я сам из питера в общем это доступность второе эта мгновенность непосредственная связь действие с результатом дак она мы что-то делаем результат происходит практически мгновенно до возвращаясь к аналогии с письмами письмо могло идти неделями сейчас сообщение доходит мгновенно и это на самом деле задумайтесь о том что это качественно изменило наше общение да то есть вот формата вот это быстро вызов взаимодействия быстрого общения раньше просто не существовало ну потому что он был невозможным поэтому письма будет писались большие долги и на самом деле об этом можно по-разному думать да то есть некоторые воспринимают это как недостаток существуем нашего времени на то что в ушло то ушла такая культура длинных писем до некоторых на оборотах достоинством факт что поменялось да и наши взаимодействием наш коммуникация стала мгновенной и третье на самом деле одно из самых важных свойств это то что онлайн принес нам такую вещь как отсутствие транзакционных издержек то есть грубо говоря за каждое конкретное действие который мы совершаем мы не платим притом под под оплата я подразумеваю не только финансовую историю не только финансовую сторону мы платим не не платим не только деньгами да мы не платим например временем что на самом деле гораздо более ценным в общем три таких свойствам которые на мой взгляд определяют вот этот радикальный переход из оффлайна в онлайн однако на самом деле еще до цифровой революции появилось нечто что уже обладал этими свойствами с чем мы с вами на самом деле все очень хорошо знакомы это городская инфраструктура я сейчас объясню почему это та вещь до которой существует с нами довольно давно и мы к ней настолько привыкли настолько защищаемые частью своего мира да что вы просто не задумывайся о том что существует а ведь еще сто лет назад да для того чтобы дома у вас было светло вам не знаю нужно было взять керосиновую лампу и заправить до зажечь если керосина у вас не было керосин и я был одет достать если вам хотелось обогреть свой дом кололи дрова топили печь вот все было довольно тяжело с водой тоже сам та же самая история брали ведро шли к колодцу там его наполняли возвращались обратно сейчас что происходит сейчас мы приходим домой не задумаюсь к щёлкаем выключателем у нас квартире светло тепло вообще появляется без наших без какого либо наружу нашего участия но надеюсь что в числе случае появляется вода мы открываем кран наполняем стакан и вода у нас уже есть это все происходит автоматически то есть эта мгновенность доступность и отсутствие трансакционных издержек вот что принесло наша жизнь городская инфраструктура однако есть вещи до которые этой инфраструктуры на самом деле еще до сих пор не покрыты что же нам в ней все еще не хватает и на самом деле тут нас нет по этим контуром наверно можно догадаться первое это еда и второе это какие-то вещи даму нельзя здесь изображена одежду на самом деле не только одежда все что все что угодно ответом существующих городской инфраструктуре для этих для для удовлетворения этих потребностей служит магазины то есть если вам нужно дома и да мы встаем и идем магазин да если вам нужны вещи одеться на мы встаем и идем в магазин проблема в том что магазины как явление да как часть городской инфраструктуры не предоставляют нам тех свойств до которой вот мы определили как онлайновый да то есть магазина действительно оффлайновой история и проблема в том что как и прочие элементы городской инфраструктуры они появились достаточно давно ну то есть как бы те форматы магазинов с которыми мы сейчас сталкиваемся ну например там супермаркеты и гипермаркеты магазины у дома если возникли в примерно там 60 70 лет назад окончательно сформировались до мы можем сказать что с появлением интернета у нас появился я коммерс очень важно как бы больших большая большой сегмент наверное да в интернете но я заявляю что и копит на самом деле полностью не решает проблему ну просто почему то что сделал я коммерции коммерс вытащил в интернет витрину мы можем выбрать мы можем там собрать корзину да но после того как мы нажимаем на кнопку оплатить да и оформляют заказ мы сталкиваемся с тем же самым оффлайн им опытом я думаю что многие из вас новый адам большинство из вас все или все из вас заказывали в интернете и stalker с тем что когда они делают оформляя заказ им приходится выбирать курьер приедет завтра или послезавтра 16 до 22 эта история про то что мне для того чтобы воспользоваться такой доставкой нужно как-то подстроить свое время на то есть я должен прикинуть и решить до 16 до 22 я буду дома да или там меня жена будет дома наверно мы курьера встретим в самокате мы как бы размышляя над тем что то что мы делаем дак и бы подумали о том что эта история на самом деле неправильно да и и более того ее можно изменить на наш взгляд новый слой городской инфраструктуры который позволяет нам мгновенно перемещать вещи в пространстве является тем недостающим звеном до которые которые сейчас у нас отсутствует в окружающей среде здесь важный момент моя сабля выделил отдельной строкой пор 15 минут 15 минут во все могут подумать но 15 минут до нас минут этот наверно там в два раза меньше чем полчаса до или там в 4 раза меньше чем час просто какое-то количественное изменение но мы на это смотрим совершенно иначе с нашей точки зрения 15 минут это то время в интервале которого люди не планируют очень редко планируют то есть если внутри получаса мы еще как то можем прикинуть например я пойду в душ а потом по разогрею себе завтрак до 15 минут и такой такой интервал в ходе которого это фактических бы такой атомарный интервал до в ходе которой мы не строим никаких планов соответственно для того чтобы решить эту проблему дамы нас андреев самокате как подошли с точки зрения эти компании то есть мы изначально были строились никак retail функция эти а как технологическая компания работающая в сфере ритейла и в этом смысле мы размышляем над и проблем подошли к ней с точки зрения привычного нас нам способа мыслить для того чтобы об этом рассказать давайте воспользуемся вот такой метафоры давайте представим себе что товаров и to content товародвижение то есть перемещение товаров от поставщика до покупателя это трафик а ритейл это собственно то инфраструктура которая обеспечивает доставку этого контента и вот с этой точки зрения используя эту метафору понятно что это очень грубая метафора но тем не менее она подойдет для наших целей рассмотрим существующие форматы нас есть гипер и супермаркеты вот с этой точки зрения гипер супермаркет представляет собой но то что раньше называли мы сейчас называет мэйнфреймы на то есть какой то очень высокопроизводительный сервер до которому много много клиентов подключаются по терминальному доступ на самом деле как бы если посмотрите действительно так и есть и более того как бы мы можем вплотную перенести те свойства на кота с которой мы сталкиваемся как бы размышляя по централизованной архитектуре я бы фреймах на гипер и и супер и мы понятно что есть пол в плюсах у них это высокая производительность гипер может обслужить огромное количество покупателей у него высокая вместимость он может хранить много контента много товара поддерживать большой товарный запас и в связи с этим он может быть универсальным то есть мы можем купить там от бытовой техники да да продуктов однако у него есть и минусы этот например очень высокой высокой или tense давайте как бы здесь маленький интерактив поднимите руку пожалуйста кто тратит на поездку в гипер и больше двух часов вот как я суммарно надежд на самом деле не так много что на сан для стран но тем ни менее я уверен что это все равно история про про боль довольно большое количество времени да и более того здесь я про это и про это не написал пункт но это еще история про доступность да потому что гипер доступен по сути тем людям у которых есть автомобиль довольно сложно пользоваться гипермаркетом и делать большие большие закупки когда у тебя нет автомобиля второе это дорогой масштабирование гипер стоит очень дорого банален более того дорогая земля до поскольку он занимает много места дают дорогая земля в связи с этим его довольно сложно как бы отмасштабировать таким образом чтобы он был широко доступен ну и последнее это плохая утилизация я думаю что все вы сталкивались с таким явлением как очереди на кассах там перед новым годом и то же самое в низкий сезон когда там половина к закрыт дай работает там две три в традиционном редели ответом на эти проблемы является формат магазинов у дома и такая как бы с точки зрения вот наши метафоры это децентрализованная система да когда есть уже маленькие сервера до которые умрут при представим это в виде сидена есть какие-то вещи сервера до есть origin и вот origin это распределительные центры вот они поставляют контент в и g и и люди ходят туда понятно что в этом вся в этом случае мы сокращаем до мы поставили сервера раздающий контент как можно ближе к потребителям и нам гораздо легче то есть мы можем зайти в магазин у дома после работы или за бежать туда там на 20-30 минут когда нам нужно купить молоко и хлеб инфраструктура тоже гораздо дешевле понятно что масштабировать это легче но есть есть и другие проблемы которые на самом деле вы заливаются в следующие в следующие свойства магазинов у дома невысокая вместимость отсутствие универсальности планета в плане в плане того чтобы понятно что если у нас мы не можем хранить большой товарный запас у нас мы можем продавать только то что наиболее востребованы наиболее частот надо все с этим ассортимент очень узкий ну и на наш взгляд kb ле пин сиси равно далека от идеала потому что мы все равно тратим время какое-то время не важно она ненулевое соответственно что что что делаем это как бы как мы думаем про то что мы строим да мы строим online retail нового типа который как и войти до появлялся появился в ходе развития тех архитектурных принципов до которые которым всем нам да хорошо знакомы и мы строим его с точки зрения такой многослойный распределенные системы чтобы не быть голословным да кабы немножко примеров почему почему это на самом деле распределенная система хотя на самом деле так может не показаться дело в том что вообще как как устроен самокат самокат это darkstar и то есть магазины без торговых залов да откуда куда приходят не покупатель откуда придут курьеры да и приносят заказов до которой размещены как можно ближе к покупателю этом грубо говоря в каждом каждом районе в каждом квартале обслуживают зону примерно 500 метров вокруг себя 500 500 метров до километра это все еще не похожи на распределенную систему но если подумать об этом с точки зрения того что мы управляем потоками трафика ну то есть мы можем сказать вот сейчас этот darkstar перегружен давайте перенаправим трафик вот на этот или здесь у нас не хватает курьеров давайте перебросим курьеров с этого darkstar а вот сюда мы смотрим на это именно как на распределенную распределенную систему что касается многослойности понятно что поскольку он инфраструктура очень тонкая ну то есть каждый drugstore это там 150 200 квадратных метров то там естественно тоже не получается поддерживать большой товарные запасы ассортимент ограничен там например двумя с половиной тысячами риска you do двумя с половиной тысячами разных товаров поэтому для того чтобы решить эту проблему мы вводим там следующий слой так называемых а бы с которых до доставка уже дольше но мы решаем эту проблему точно так же как например и решаем проблему долгих операций войти мы их делаем асинхронными то есть грубо говоря человек заказывает товар на хобби да он его доставка до dark stora занимает полтора часа но он имеет возможность получив уведомление что товар уже приехал в дартс тур до заказать его его доставят за 15 минут то есть мы опять же не нужно планировать вот это свое время соответственно мы с мы строили это исходя из идей о том что плюсами такой системы является мгновенность как я уже говорил да то есть мы предоставляем выпивали 15 минут 30 минут равно мгновенность доступность да то есть нам доступен широкий ассортимент и нулевые транзакционные издержки то есть за заказ за заказ мы не платим время своей не тратим получаем те свойства так который мы определили как важные для онлайн здесь немножко пеппа их поехал шрифт там была задумчивой рожица потому что на самом деле это не минус и да это те проблемы с которыми нам на санеле приходит приходится сталкиваться об одной из них я уже сказал да это тонкая инфраструктура 2 то что все происходит в реальном времени то есть те процессы которые выполняются на всей сети настоящие нас сейчас из там 550 dark star of все происходит очень очень быстро да говоря реальном времени я говорю здесь конечно не у машинном реальном времени да то есть не имел том что мы обычно подразумеваем до используют тоже как метафору но тем не менее с учетом того что инфраструктура она не полностью цифровая она в том числе и оффлайн его им это полный аналог в силу в силу тех задержек которые возникают в ходе этих процессов ну и как следствие так как каждой распределенные системы этим довольно сложно управлять опять же я немножко расскажу о том как никто таких самых важных для нас вещах потом как мы решаем эту проблему сложности здесь я точно не буду углубляться в детали если мы захотим их обсудить моему мы сможем это сделать после после доклада но хотел бы отметить просто несколько несколько вещей обозначить несколько вещей которые скорее будут являться иллюстрации принципа до чем конкретным решением собственно что является решением роботы здесь я немножко немножко понятное дело приукрашивают действительность да и физический робот это действительно действительно еще не наша настоящая наше будущее потому что роботы те которые реализуют физически операции сейчас просто еще слишком дорогие да то есть как бы их использовать пока слишком дорого мы конечно экспериментируем с ними но говоря о роботах я на самом деле имею ввиду сейчас автоматизированная система принятия решений и почему это для нас очень важно потому что как я уже сказал мэт мы работаем в реальном времени и поток при нем и принимаю поток информации на основе которых при нем принимаются решение он очень высокий высоко плотный а люди в таких условиях очень плохо справляются то есть когда как идет высокий поток например разнородной информации люди плохо плохо в нем ориентируются медленно принимает решения часто ошибаются и поэтому наша система она вся построена на грубо говоря алгоритмах до которой в том в том или ином участке процесса принимают соответствующее решение даже если сейчас например и более того даже если сейчас по каким-то причинам ну просто мы там что-то еще не успели сделать это делают люди некоторых частях мы все равно как бы строим это с точки зрения эволюции дата сейчас это люди а потом мы в этот процесс можем включить соответствующий алгоритм вот и вторая история про который я хотел сказать которая тоже очень важно это то что в нашей в нашей инфраструктуры очень сложно обойтись без хорошо знакомой нам потоковой обработки событий да почему во первых событие это топливо для роботов то есть без информации и без каких-то событий внутри системы роботы не могут принимать решение с одной стороны довольно очевидная мысль и кажется очень просто так и бы нам всем айтишником кажется ну чё там давайте навесим метрик здесь соберем такую информацию здесь такую вот но дело осложняется тем что наша система наш продукт и он глубоко укоренен в физике да то есть это как бы физические товары берутся с физический полок кладутся физические рюкзаки физический курьера их куда-то несут и все это тоже нужно иметь возможность оцифровать подать на вход алгоритмом ну до тех пор пока мы не сделаем физических роботов которые будут делать язык это за людей это первая история вторая история это то что в силу вот этих вот и вать 8 коротких и силы процесс должен быть интегрирован или что здесь я имею ввиду вот мы говорили о товар движения до что это там цепочка от поставщика до покупателя и невозможно его рассматривать как отдельные процессы на то есть невозможно рассматривать отдельно процесс закупки как это делает большой retail процесс логистики для перемещения до магазинов или процесс сборки процесс доставки как разные процесс это все можно рассматривать как единый процесс в качестве иллюстрации этой мысли как бог есть есть такой пример который мы обычно приводим вот например у нас алгоритм понимает что завтра 12 часов дня нас как на каком-то дартс истории закончится молоко да мы понимаем лодку там частотный пугало частотный товар мы не должны такого допустить и уже в тот момент когда у нас как бы покупает последнее молоко система которая формирует заказ на поставку от поставщика должна это подхватить да и включить заказ ну и такие события происходят по всей цепочке что еще в качестве решения но на самом деле я специально не стал выносить в какой-то отдельный слайд потому что это уже на вершину зубах у всех темах история про про микро сервисы но у нас это действительно история не только про то что что это проще масштабировать или этот ну как в техническом плане да так и в организационным что правь проще их прочь их разрабатывать разными командами так далее в нашем случае микро сервисы нам нужны в том числе для того чтобы служить этими самыми розетками для роботов до куда куда мы робота втыкаем потому что в случае если у нас есть монолит то воткнуть в него там сотни разных роботов довольно сложно ну как бы так хорошо подводя итог до поскольку на сейчас уже время за заканчивается я хочу сказать следующее что в самом начале доклада мы поговорили о том что в ходе появление интернета входит цифровой революции мы столкнулись с тем что те привычные вещи которые у нас окружали нас раньше были перенесены в цифровой мир цифровые сервисы происходил переход из оффлайна в онлайн на мой взгляд сейчас происходит обратное движение то есть мы накопив некоторый опыт как как инженеры как разработчики эти систем можем перенести тот опыт который который у нас есть те подходы которые у нас есть к тому чтобы воплотить это в физической инфраструктуре и тем самым совершить переход из онлайн и оффлайн придав ему свойства до которые который мы ценим в онлайне в этом участвуем все мы с вами будущее за переходом из онлайна в офлайн на мой взгляд спасибо спасибо антон сейчас как обычно вопросы из зала также есть вопросы если есть в онлайне то сдавать их в чат или бухаете на экран либо задам их я люб зовите их в прямом эфире вот сейчас спокойно микрофон передается как обычно у нас за лучший вопрос полагается книга так что сдавать активный спасибо добрый день виктор x5 retail ваш пред я у меня на земле пара вопросов 1 начнут уже с аналогии я очень люблю спать файз тренинговая музыка отлично но мы пришли к тому что если чего-то нет spotify и этого нет своей жизни аналогичная история собственно с вот с доставками впрочем всем да эта штука которая типа сильно формирует вкус там потребление которого он отсюда вопрос там что вы делаете с категорийный менеджер менеджментом и как угадать что пользователям нужен товар которого у вас нет и который вы не знаете что им на самом деле нужен а второй вопрос в чем собственно принципиальная разница darkstar а который в общем-то тоже не большой да фактически с магазином у дома ну кроме того что он стал ближе потому что курьер принес тебе то что ты заказывал спасибо окей спасибо большое за вопрос действительно очень интересный вопрос особенно особенно мне нравится 1 потому что на самом деле мы к этому какой-то идее да о том что мы формируем вкус у потребителя до пришел пришли довольно давно и собственно тогда начали развивать собственную торговую марку не знаю кто то из вас пользуется самокатом вы наверно сталкивали что у нас достаточно большой ассортимент продуктов под собственной торговой маркой и тогда когда мы запускали эту торговую марку мы на самом деле посмотрели на окружающие например от того как это делали другие торговые сети и увидели что большинстве случаев под собственной торговой маркой в за редким исключением сети продают дешевый товар то есть это обычно какой-то очень очень низкий сегмент мы наоборот к мы решили что поскольку у нас есть возможность как бы здесь увеличить свою маржу да мы можем это делать не за счет того что как бы мы еще больше наращиваем маржу продавая дешевый товар вот использовать ну грубо говоря сегмент папа получше и тем самка бы нашим на 6 м да он отличается по качеству тома даст ему других сетей с одной стороны другой стороны по поводу того что как мы понимаем чего чего не хватает это стоит сложный вопрос сейчас на самом деле это оффлайновый процесс я так скажу да то есть никакого к какой-то механики внутри системы на эту тему нет то есть мы можем видеть естественно смотреть по категориям то есть категории например если там оболочка хорошо идет понятно что надо как бы вводить например stm молока да или там будут хорошо сыр и надо увеличивать свой присутствие в этой категории вот каких-то специальных исследований на эту тему насколько я знаю пока еще не проводили но просто мне кажется условная азбука и вкус и он не очень согласна с тем что не особо соблазну со звука и вкуса я согласен я имею виду к катакомбам массовый сегмент азбука вкуса это папа не понятно как бы премиум истории но она и стоит соответствующим другой стороны хорошо 2 dark старый вопрос был второй trucks тура сейчас сейчас я сейчас я отвечу в чем в чем отличие во первых есть очевидные вещи магазин у дома это все равно история про проходимость да то есть мы грубо говоря можем размещать мы магазин у дома только там где проходит большой поток покупателей ну иначе вас туда просто никто не придет вот мы можем размещать darkstar и в тех местах которые не обязательно должны быть проходим а наоборот наоборот например удобность логистической точки зрения и в силу этого на самом деле наши darkstar стоит там в 7 раз дешевле и лучше расположен относительно того и района к только которой он обслуживает с другой стороны тут принципиальный момент что не люди приходят в магазин да а курьера выходят из магазина и в этом смысле и пространство можно оптимизировать по другому то есть нет не надо нам широкий торгово проходов да можно больше вместить туда ассортимент вот и с другой стороны есть возможность как я уже сказал балансировать на балансировать нагрузку на ему так так отвечу спасибо привет при дисклеймер я ваш суперфанат клиент мне очень нравится спасибо собственно вопрос вот вы говорили про про роботов микро сервисе вот это вот мне на эту тему возник один вопрос почему у вас получается соблюдать если 15 минут а лавке нет это это очень прыг очередь провокационный вопрос о смысле и не знаю как подевал как бы политично ответить и вот ну тяжело наверно ребята еще не очень отстроили своей процесс наверно так спасибо добрый день привет хочется много прокомментировать тезисов потом вопрос один из тезисов про магазин у дома его проходимость у меня как раз опыт жизни правда в петербурге без магазинчикам который явно не проходим и потому что это там в конце в и его держит человек который часто разговаривает с посетителями как раз понимает что кому нужно и буквально на кассе я могу сказать что зашла за безглютеновый хлебом и планета не это подмечают и магазин на своем ритм не живет он продает очень часто скажем гурманские какие-то вещи он очень классный и его вот аналога сейчас нету ни в каких таких сервисах внимание к не потоковая обработка да да я понимаю я понимаю что ты говоришь это нас одна это та история которую мы тоже довольно много думаем эта история про то что на самом деле у нас больше возможностей чем у этого магазина с точки с точки с точки зрения именно персонализации да то есть поскольку мы обладаем большим объемом высокочастотных транзакций да ну то есть еда это очень высокочастотной история на телевизор из мы покупаем вопрос год раза три года дата еду мы покупаем помните три раза в неделю например и естественном и на основании этого можем лучше понимать наши покупатели в этом в этом смысле мы совершенно точно будем как бы двигаться в эту сторону и будем эту историю развивать но тут надо понимать что всегда будет история про какие-то дешевые вещи как который довольно сложно заниматься и здесь бы я хотел бы привести аналогию с теми же самыми онлайн кинотеатра мида что это просто другая другая потребность да то есть если вот сейчас пользуемся они хотят а мы тоже не заменяет нам на самом деле поход в кинотеатр да то есть если мы хотим посмотреть фильм да мы можем посмотреть его как дома на диване и от кассе так и в его и пойти в кинотеатр просто потому что это другой способ проведения времени вот то же самое как бы на саблин на мой взгляд и вот с общением с такими людьми до в рамках таких вот таких магазинов вряд ли а мы должно друг друга заменить мне кажется там есть специфика того что владелец магазина позволяет себе экспериментировать и трогать какие-то позиции мы бы на самом деле очень долго экспериментировала нас ротация ассортимента происходит постоянная класс ну например мне там всякая модная хипстерская диета и она приходит ко мне в основном все-таки из каких-то научных роликов на глубине блогеров то есть я не могу просто сидеть на вашем сервисе потому что он на эту тему тоже много работы в если хочешь бы поток вот пообщаться в кулуарах я про это расскажу по поводу того как как как мы будем работать именно с медийные составляющие а насчет кивсяки хипстерский диету бы долго такого высадки бекки в целом но тут конечно вопрос вот например да собственно вы всегда будете все равно ограничены тем что например если вы хотите вести какую-то позицию вы же ее не можете дропнуть только на определенные места если хотите посмотреть почему крик ничего ничего ничего подобного на самом деле я могу рассказать историю что у нас в москве три разных банановых йогуртов просто потому что в одном в одном районе москвы до лучше потребляют одни да а в другом другие они ты просто три разных уговорил спасибо за доклад у меня такой вопрос какие и как оффлайн метрики вы собирается на своих darkstar ах или в доставке курьеров например тогда когда менеджеру darkstar или кладовщик собирают товар сколько у него затрагивает затрачивается времени на то поиск помидорки еще что-то от но в таком случае вот это все по конечно собираем список меток довольно большой но понятно что мы грубо говоря как минимум точно совершенно как бы снимаем метрики по опорным шагом процесса то есть грубо говоря у вас есть там сборка да когда началась когда закончилась до к такой и вышел сколько он прошел когда-то передал товар покупателю и так далее в этом смысле каждый шаг процесса на основе которого можно принять решение до монету что есть метрики которые на основе которым мы например сейчас решение не принимает да то есть мы не готовы принимать нам на основе него решения и мы их мы не собираем но любой любая информация которая позволяет нам оптимизировать производительность до производительность у нас на самом деле это ключевой такой круг ключевая история мы например основная наша метрика да если говорить про метрику именно да это производительность труда курьеров сколько курьер например может доставить заказов в час и все что может на это повлиять мы собираем как но смотри как во-первых у нас свои приложения и грубо говоря процесс построен таким образом что те те участки днк которые мы к которые мы хотим мы хотим контролировать они требуют каких-то действий с одной стороны другой стороны мы но это сейчас еще не не совсем продакшном история но мы экспериментируем довольно много с aiuti да то есть как бы говоря у нас есть подключаемые устройства до которые за некоторыми метриками следят да это больше не про курьеров конечно больше про склад но тем ни менее как то так у меня вот такой вопрос вот ваша уникальность проходе как это вот 15 минут насилий на доставку а есть какие-то вот там твердые данные что это вот то что нужно просто фантазия посею ситуацию импульсивно заказал поскольку цикл очень короткий там что-то забыл заказать до привезли чет не достаёт ещё раз заказал еще раз оплатил нужно вам это окей блин задолбала пойду в магазин а возьму точно все что мне нужно посмотреть в магазин и тебе тоже нужно будет побежать как бы и потратить на это время вот так история про то что ты что-то забыл как бы и еще раз заказал молоко 700 лет абсолютно нормально собственно это как бы ключевое свойство нашей модели вот по поводу того как бы насколько это действительно востребована насколько вообще это интересным людям я могу здесь привести в пример отрицательные отзывы в нашем appstore да у нас как бы есть не только положительные и отрицательные так вот если раньше к его все-таки говаривал 15 минут то теперь нередко встречается история когда люди пишут блин мне опоздали на полчаса что вообще за дела как как так можно вообще работать вот совсем офигели ребят как бы эта история про то чтобы на самом деле вот потихоньку привыкаем к такой модели потребления да и для нас это уже становится вот история про электричество мы щелкнул выключателем а свет не включился мы таки что за дела вообще как бы что происходит мир мир рушится ну вот редкое будет на мой взгляд к бы именно опции гастев об этом спасибо за доклад буквально позавчера я сделал 2 заказа самокате там небольшая был заказан о его доставили за 3 минуты вот внимание момента оплаты вы следует того момента когда мне позвонили в домофон прошло 3 минуты это не реклама от сказать что я я не работаю самокате это было всего лишь старый заказ у меня вопрос следующий из пользователю каких-то метров до предварительного там оптимизации да например когда человек начал накладывать в корзину уже что-то там чтобы кладовщики уже там наполняли корзину и второе если какая-то статистика есть ли быстрее заказа чем три минуты потому что ж я думаю что мы по статистике а сейчас не вспомню да какие именно вот такие выбивающиеся показатели я думаю что если darkstar маху находится в том же доме то может быть легко и заказ небольшой то может быть легко кабы и меньше дам то есть могут там за две минуты надо ставить с точки зрения такая первый вопрос забыл можешь повторить а предварительной оптимизация маринет но сейчас у нас предварительной оптимизацией при сборе корзины нет просто потому что пока мы еще не достаточно уверены в том что действительно превратиться в заказ а если мы начнем это собираете там сломает операционный процесс у нас должен быть очень как бы очень гладкий ну то есть надо сперва собрать потом разобрать и это вот постоянно будет происходить этот ломает операционный процесс но с точки зрения бы мы естественно оптимизируем например сборку да то есть какие-то чан частотные товар это у нас лежат начали и вообще выстроить какой-то pipeline по тому как должен идти сборщик по складу такой маршрут чтобы это происходило например более оптимальным образом минуток антон здравствуйте еще раз большое вам спасибо за доклад и и очень классные ответы на вопросы у меня вопрос есть по поводу роботов я с вами абсолютно согласен что это наше будущее раздвигались очень быстро и буквально в скором времени возможно мы увидим внедрении роботов которые заменят курьеров допрос работаете ли вы над тем чтобы внедрять на складах в данный момент мы знаем что amazon уже работает и собирает заказы с помощью робота технических устройств платформ там всевозможных и так далее то есть логистики они используются в жив доставки экспериментальные модели какие наработки у вас усилится закрытая информация не у нас как бы я по поводу совсем наработок наверно не не скажу да ничего конкретного до единственное что могу сказать что мы действительно работаем в этом отношении здесь есть и важный момент да все эти решения которые сейчас есть на рынке о на самом деле amazon то не самый яркий пример самый яркий пример это британский ритейлер акадо данная мы тоже знакомы они все работают на самом деле совершенно другой история они работают с большими складами ну то есть это роботы работающий на больших складах там сотни сотни квадратную не сотни даже тысячи квадратных метров это совсем другая история чем запихать робота в 200 квадратных метров и поэтому мы на самом деле т.б. работаем скорее вот в этом направлении ну и действительно действительно много много экспериментируем но пока еще как бы это довольно далеко от реального production да я понял спасибо антон за ответ я думаю что все равно в данный момент конечно же это рано рассуждать но я думаю что в будущем все равно внедрения должны на малых площадях технических систем конечно ускорит еще меньшим тот конец взорвал временем будет у вас доставки да да да главное чтобы это стало их и экономически целесообразно правление роем роботов этот уже хайло вот это отказа от у чего я система которая должна работать без божьими именно так я с вами посижу под спасибо здравствуйте антон макаров тот раз антониадес горд я ещё не пользовался вашим сервисом но мне очень интересно на 900 1 секунде у вас пакет совсем не отбрасывается насколько важна эта метрика в вашей системе так и я прослушал можешь повторить еще раз и так вас на 900 1 секунде пакет не отбрасывается вы его продолжаете дальше доставлять конечному потребителю если у вас эта метрика достигнуто насколько она важна в вашем процессе на 900 секунды мы естественно продолжаем доставляет ну то есть нет нельзя как бы естественно сказать клиенту чтобы теперь ничего не принесет прости 15 минут не уложились извини ответ метами метрика очень для нас важно это грубо говоря метрика она практически так же важно как производительность потому что эта вещь находящиеся в балансе то есть мы должны следить за тем чтобы у нас производительность не не падала до и при этом не росли опозданием этап как раз регулируем количеством количеством курьеров да то есть динамическое управление тем сколько у нас сейчас конкретный курьеров на каждом dark туре через через это да мы управляем этими метриками спасибо здравствуйте g2 просят 1 это наблюдение о том что ваше потрясающее время доставки на обеспечивается не только оптимизация my которые вы делаете но и ребятами курьерами которые собственно на самокатах велосипедах перемещают я сомнение да и вот вопрос номер один это следите ли вы как-то за здоровьем курьеров возможно снимаете пульс следите за скоростью с которой они едут если какая внутри какие-то рекомендации для них в этом плане чтобы они не перетруждайтесь и второй вопрос это наблюдение о том что многие люди поймаем наблюдения молодые не любят отвечает на телефонные звонки потому что мои мне нравится обсуждаете ли вы как-то возможная замену формата вот что вам звонит курьер возможно когда уведомление берегу к это еще способ спасибо я наверное начну отвечать с конца в целом звонок курьера для нас не целевая история а то и звонок курьера происходит только в случае если что-то идет не так ну то есть куль курьер не может вас найти да по какой то причине или вы там не отвечаете на домофон или на звонок дверь вот и в этом смысле для вас конечно задача здесь свести вот количество звонков к минимуму да вообще количеств необходимость сводить к минимуму в частности если говорить про про оптимизации да за затрону всю эту тему для нас очень важно например четко понимать да в каком в каком месте дома до находится ваша квартира для тоже курьер не звонила мне говорил как бы как мне попасть к вам к вам домой вот здесь мы конечно очень благодарны нашим партнерам близ туги сада который нам эту информацию предоставляет небольшая реклама в гис что касается второго вопроса на самом деле как бы здесь точно есть еще что вы что поделать дамы мы на самом деле очень внимательно относимся к безопасности и наш курьер и постоянно проходят разного рода тренинги но что касается как именно мониторинга мониторинга у нас еще нет хотя это может быть хорошая идея для того чтобы и чтобы ее реализовать спасибо но у нас есть тревожная кнопка что что что есть да и то если у курьера что-то произошло на курьер может нажать тревожную кнопку и мы ему поможем здравствуйте спасибо за доклад меня так вопрос почему у вас нет веб-версии я не могу сделать заказ компьютера так еще раз у вас нет веб-версии от версии но ответов отличились и простой просто потому что и возможно дают одновременно заниматься всем этом смысле что мы должны концентрироваться на том что как бы приносит нам не больше эффекта в моменте ну вот и до недавнего времени эта история была про про мобайл вот есть как в персии я думаю что мы прием но просто как бы через через какое-то время наверно как бы на этот вопрос можно ответить таким образом что мы мы просто связываем историю про про мгновенность да не с тем что человек там сидит за компьютером и что-то там теперь ты каида это именно история то тут выходных обл что-то собрал нажал кнопку и тебе тебя это принесли это не отменяет для того чтобы в версия может появиться но просто это либо истории не в приоритете на просто нам в меньшей степени связано с этим опытом разрастись издает один вопрос на каких технологиях на сервере все это крутится что вы использовать чтобы все это обеспечить нас есть вот саша у нас а руководитель разработки сочи по большой ручкой его потом можно вы задать подробностях этот вопрос но в целом он наш базовый стык сейчас довольно узкий мы разрабатываем ma kok ли не до backend на котле не spring мозга sscanf как у пирамид с все все как бы такой довольно довольно понятный питона нет у нас питон был бэ бэ бэ бэ вы вы с ним расстались если что в кулак splash боже боже боже можем рассказать почему почему у нас нет питона а тут еще один вопрос из чата вот тот человек по имени николай задал аж три вопроса начнем с конца часто бывают ситуации что заказ нужен срочно и нужен заказ как когда привезут тогда привезут бывает нужен срочно не думали ли вы вести галочку срочно и не срочно для оптимизации нагрузки на курьеров нет потому что это противоречит нашей наши идеи наша идея в том что когда тебе нужно тогда ты заказываешь в этом смысле если мы как бы будем проваливаться в ту модель которая которая есть как бы у всех окружающих да когда боб не привезут неизвестно когда это сразу же ломает тот опыт да который который получают люди и вопрос еще от николая есть какие-то секреты процесса сборки заказа что он у самокат именно получается таким быстро в отличие от конкурентов на секрета даты секрет что дефицитов родители рассказывают не может есть какие-то инструкции алгоритмы для нас отдали вот як частично отвечая на вопрос оттуда по моему вот я не запомнил я рассказала что мы действительно оптимизируем маршруты доминируем например ну грубо говоря там тяжело понятно тяжелые предметы стоят внизу да там редкие наверху вот это все как бы довольно стандартная история про про логистику внутри склада ok и последний вопрос лично от меня вот там человек задал вопрос про то что люди обычно звонят по телефону вот я как активно пользовались самоката но при этом человек который живет съемной квартире где нет домофона не думали ли вы вести функцию чтобы когда человек пришел к твоей двери тебе просто push приходил он пришел к твоей двери потому что курьер где-то в 70 процентов случаев только увидят надпись стучите в дверь домам он не работает мне кажется что эта проблема скорее того что действительно в 70 процентах это эту надпись видит эта история с пушками ну на самом деле об этом наверно можно подумать но что с чем мы вообще сталкиваемся пропушим а у нас вот как бы в той модели которой про который рассказывал про хобби и про доставку по запросу мы действительно использовали пуше очень часто люди их просто не видят они просто не обращают на них внимания и в этом смысле мне кажется что здесь будет та же самая ситуация она будет приводить каким-то очень плохим сбоем может быть мой может быть об этом можно как-то еще подумать и сделать это удобно ли удачным образом ну спасибо за идею окей хорошо спасибо тогда большую антона давайте его еще раз поблагодарим это тебе спасибо большое за усмотрение и как обычно сейчас можно пройти в кулуары в дискуссионную зону где как в зуме вы можете присоединиться к трансляции и там позадавать вопросы а также лучшая книга точнее лучшего лучший вопрос мы дарим книгу выбери пожалуйста пока все не разбежались то что было на самом деле очень сложно выбрать все вопросы были прямо приобрести интересные я бы надо выбрал бы историю про про маленькие магазинчики припру персонализацию спасибо большое и до спасибо всем кто смотрел в этом зале сегодня нашу конференцию приходите завтра очень ждем на сегодня мы закрываемся спасибо большое спасибо"
}