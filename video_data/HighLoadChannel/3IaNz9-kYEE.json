{
  "video_id": "3IaNz9-kYEE",
  "channel": "HighLoadChannel",
  "title": "Поиск XSS через наложение парсеров / Игорь Сак-Саковский (Positive Technologies)",
  "views": 100,
  "duration": 2450,
  "published": "2023-10-06T07:19:37-07:00",
  "text": "Всем привет ребят Меня зовут Игорь саксаковский Я уже 7 лет занимаюсь анализом защищенности приложения в компании Позитив Technologies и сегодня мы с вами поговорим о моем недавнем research а именно я решил разобраться Какие все-таки уязвимости бывают функционале обмена сообщений обнаружил много чем-то похожих чем-то различающихся багов Сегодня я вам в этом расскажу и попутно мы еще знаем что такое xss Как искать такие баги свежая идея Вот как раз продолжение парсеров и также покажу вам уязвимости у известных вендоров которых у которых Я обнаружил уязвимости и которые уже исправлены также на последних слайдов я вам расскажу как защититься как я считаю правильно защищаться и способ который используют в основном все не особо правильно на этом слайде можно увидеть вендоров также описание самой уязвимости импорта её самое главное это название вендоров остальное на данный момент не совсем важно тут уже будет поинтереснее все также название вендоров и какая-то непонятная белиберда это как раз вот текст сообщения которые приводят к уязвимости Итак пока что не будем обращать внимание на эту бельберту начнем с теории xss это атака вкратце позволяющая управлять браузером пользователей То есть злоумышленник может выполнять какие-то действия скрытно от пользователя при посещении сайта теперь нам нужно разобраться с Access терминологией Если вы Обратите внимание на картинку слева это запрос пытающийся протестировать наличие CSS в каком-то приложении в параметре URL передается html-код это называется XS Вектор место куда он отображается на странице называется контекст в данном случае наших с Вектор не приводит к выполнению скрипткода он довольно бесполезен чтобы JavaScript код выполнился нужно добавить еще в начале двойную кавычку и закрываю скобку на этом слайде я также изобразил разные контексты Где наш XS Вектор не будет выполняться перечислять Я все это не буду чтобы сэкономить время и оставить побольше на вопросы внизу можно увидеть примеры Почему XS вектор при примеры функциональности разных кликов и почему XS Вектор может в одном месте запрашивать какое-то действие пользователя в другом месте он может выполняться полностью автоматически Верхняя строка у нас статичный элемент который не подразумевает загрузки никакого контента он отвечает просто за отрисовку рлке или какой-нибудь текст можно с помощью него также вывести и JavaScript можно выполнить только с помощью пользователя то есть по клику пользователя или пользователь должен навести на элемент чтобы JavaScript запустился в то же время как кайфрейм будет выполнять все полностью автоматически у него есть события которые отличают за загрузку контента также у него есть интересный атрибут Acer seedoc который подразумевает из которого он берет код для новой открываемой страницы и все также можно открыть страницу с жалости схемой выполнить код также полностью автоматически при загрузке страницы продолжим xss термины Теперь нужно узнать что такое origin и slp или Soft более русифицировано Origin Это если вкратце сама страница на которой запустился скрипт то есть адрес страницы а slp это как раз такая политика безопасности которая запрещается одной с одного сайта обращаться на другой сайт и забирать у него контент или секретные данные на этом слайде более подробно расписано Как работает slp Она смотрит на три первых на три главных параметра схема дальше доменное имя или ip-адрес и порт после двоеточия в первом примере у нас различаются доменное имя Поэтому если скрипт обратиться по такой urlке он не сможет получить ответ во втором примере у нас относительная схема все будет работать прекрасно в третьем примере у нас относительные URL с относительным файлом все тоже будет работать теперь в четвертом примере у нас отличается схема вместо https и браузер раскрывает но там же также отличается порт если что теперь это 80 https 443 скрип будет заблокирован последнем примере у нас просто отличается порт был 8181 скрипт также не будет выполнен а теперь нужно разобраться что в обычных условиях под обычными условиями Я подразумеваю когда скрипт выполняется у нас в браузере на каком-то веб-сайте что злоумышленник может с помощью этого скрипта украсть самое первое в моем списке это скриншот страницы далее контент страницы который многие Если знаете JavaScript можно обратиться к документу через объект Документ и прямо из него собрать все его содержимое Дальше можно попробовать послать запрос на свой сервер который мы контролируем и в этом запросе мы увидим ip-адрес пользователя его браузер в заголовке и также через рефера мы можем увидеть страницу который был изначально запущен скрипт следующий пример букет для сайта который на котором была обнаружена XS или на котором выполняется этот скрипт это самые наверное классический самый бородатый способ эксплуатации xss И очень многие до сих пор думают то что если они запретили доступ cooki это все типа через невозможно взломать это ошибочно примерно похожие на куки это тоже можно хранить какие-то данные и очень часто разработчики туда охраняют туда кладут какие-то токены сессионные ключи и что-то интересное что тоже можно украсть и вот последние два примера я распишу сейчас более интересно доступ к мире микрофонов наверняка Многие знают такой сайт как чат рулетка когда на него заходишь чтобы получить доступ к чату тебе нужно для начала согласиться то что ты разрешаешь сайту использовать камеру микрофон если злоумышленник находит Вот в этом чате XS Q отправляет мне ее в чат то когда я отключаюсь уже переключаюсь на следующего собеседника он может управлять моим браузером и дальше смотреть что я делаю что я говорю и перехватывать грубо говоря поток с камерой микрофона и последний пример перехватывает следующие страницы которые пользователь посещают это делается с помощью простого трюка в момент загрузки страницы JavaScript берет и рисует таймфрейм поверх всего и пользователь обычно использует мышку для перемещения очень редко используется панель навигации или там обновить кнопочка и он скорее всего будет перемещаться кликая по каким-то кнопкам или формам в этом фрейме при этом у нас основная страница не будет перезагружаться и наш клип будет продолжать выполняться теперь более редкие но про которые тоже не стоит забывать нагрузки которые может нести с собой вредоносный JavaScript самое первое это Зира дэксплоид и не обязательно можно какие-то ван Да и недавно исправлены Если ты просто какой-то Вася у тебя хотят взломать ВК Я не думаю что будет использовать такие атаки Но если такой-то брокер биржевой или банкир то не стоит это исключать тоже если недавно ребята выпускали такую такое исследование то что кастомные менеджеры паролей которые устанавливаются как плагины очень часто уязвимы к тому То что мы можем с помощью Java скрипта заставить искусственно подставить эти данные из менеджера паролей и сразу же их Забрать следующий пример перехват паролей при вводе с помощью формы логина при входе форму логина с помощью айфрейма как раз предыдущего слайда то что я рассказывал пользователь ходит У нас по сайту мы контролируем iframe как только видим то что на странице появляется Input Type Password Мы берем вешаем на него прослушку и когда он заполняется мы перехватываем его значение и примеры с повышением привилегий представим себе движок форума самый первый пользователь который его создает запускает это естественно администратор и у него привилегии администратора также он может добавить модераторов которые могут там следить за контентом какие-то исправлять сообщения может быть банить пользователей и если ты просто зарегистрируешься то ты получишь привилегии пользователя и как раз XS так как мы управляем браузером если мы отправим администратору то мы сможем управлять браузером администратора И тем самым получим повышение привилегий про повышение привилегий можно использовать для создания Например сразу же администратора со своим паролем Это можно сказать повышение привилегий закреплением или можно в моменте просто использовать функционал админа допустим отредактировать какой-то код в админке и добавить свой бульдор теперь разберемся с парой примеров со схемой файла как я говорил уже есть схема JavaScript которая приводит к СС есть схема файла она приводит к она очень часто приводит к доступу к файлам но не когда Мы открываем через браузера когда XS у нас работает в мобильном приложении или возможно в десктопном браузеры уже настолько развиты в плане безопасности то что они любое обращение к файл схеме блокируют в то же время когда какой-то десктопное приложение может использовать встроенный браузер запущенный небезопасно и он будет спокойно позволять запускать файлы или какого-то втором примере отправлять ntline авторизацию на удаленный сервер Итак первый пример мы просто по клику можем запустить файл в данном случае калькулятор второй у нас загружается картинка и отправляет авторизацию содержащую username это операционной системы и зашифрованный пароль от операционной системы Windows текущего пользователя следующий пример это выполнение файла с удаленного smb ST также по клипу как в первом примере мы запускаем локальный файл в этом примере мы уже Обращаемся на ремонт хост и есть очень много способов обращаться к локальным файлам например xml теперь квест Windows панели фреймы и мы можем если сок не блокирует спокойно получать обратно содержимое сейчас отвлечемся немножко с терминологии и продолжим Вот как раз что может еще такого страшного сделать XS года три назад я решил поисследовать голод Арион кошелек и как типичный номер просто вбил Google как запустить голову териум мне там вывелся мануал Шаг 1 Шаг два шаг 3 я все запустил потыкал Джесса на фишку ничего интересного не нашел но обнаружил То что по мануалу я свой кошелек запустил так то что любой сайт Может просто который я захожу обратиться к фишке и попытаться что-то там сделать говорят дальше Я обнаружил То что не только мой мануал который Я использовал рекомендуют запускать вот так вот помимо этого там есть не только Джейсон API А вебсоке такие и иначе говоря к чему это все может привести если у меня есть какой-то блок форум может быть криптовалютной тематики я могу туда засунуть свой скрипт и пытаться украсть деньги у всех моих посетителей у которых запущен кошелек эфира так как у меня такого сайта не было мне пришлось побегать по сайтам самого этериум где Я обнаружил под домен форума терио морг на очень знакомом мне движке Vanilla и так получилось что я уже два раза до этого взламывал находил там xss любом сообщении и где-то за вечер просто повторил Находку уже на актуальной версии теперь пример как раз сообщения вся у зимой заключалась в небезопасной обработке тегаси дата он подразумевал то что закрытие будет с помощью квадратной скобки двух квадратных скобок и треугольные скобки закрывающий но в HTML так не работает его можно закрыть просто одной треугольной скобкой и это приводило к СССР второй бак который Я обнаружил Я установил себе локальный форум зашел от админа и обнаружил То что админа доступен редактор баннера это такая вот картиночка сейчас покажу вам на следующем слайде в углу форума там ну там написано название форм допустим форум итариум и туда можно по дефолту засовывать свой html-код этот баннер будет отображаться любому посетителю авторизованному не авторизованном Вот видите в моем локальном форуме это называлось Vanilla 2 на форуме Этери он там было их название и так что здесь на скриншоте здесь я зашел этот мина читаю сообщения которые мне написал пользователь с именем атакир и проверяю код баннера в данном случае Ничего нового нету после того как я обновляю страницу или перехожу на какую-то следующую у меня уже появляется скрипт теперь я небезопасно запускаю кошелек как я вам говорил я использую rpcords domain параметр параметром звездочка который разрешает всем всем сайтам обращаться на моего кошелька и сразу после него можно обратить внимание на еще один небезопасный параметр Unlock он подразумевает то что для вот этого адреса моего кошелька пароль будет запрошен только один раз когда выполнил эту команду все остальные разы он будет уже разблокирован и я могу спокойно использовать через пароля Окей запустили кошелек теперь заходим на взломанный форум я сделал небольшой дебаг и внизу видно то что первым делом кошелек первым делом скрипт берет список кошельков проверяет если разблокированы находят наш кошелек из вот этого параметра Unlock выводит деньги они там не настоящие Это был тест Нет я просто себе накрутил сколько смог и все для теста и дальше Он для всех остальных у которых не смог найти пароли он пытается их подобрать по словарю так как пользователи очень сильно надеются на то что их криптовалютные Ключи находятся только у них и никто их не может украсть они могут себе спокойно ставить пароль 1 2 3 1 2 3 4 5 или там Один потому что Параллельная политика у них позволяет это делать возвращаемся к классификации XS также XS можно разграничить классифицировать на хранимую отраженную в данном случае если она хранимая она будет храниться где-то на сервере и передаваться наших Вектор будет только единожды то есть один раз Передаем она где-то хранится если это отраженный CSS то каждый раз при обращении на странице нам нужно где-то передать в изюм параметре наших Вектор И как я говорил раньше бывает разные HTML элементы если мы не можем создавать на странице свой новый H7 элемента можем только добавлять атрибуты старому это может привести к тому что XS Вектор будет требовать взаимодействия с пользователем Клик навести мышкой что-то такое здесь как раз вот примеры XX векторов требующие взаимодействия я их проговаривать не буду но я думаю выполню поняли уже смысл вот этот я проговорю он потому что довольно интересный у нас статический тег div заголовок о незаголовок атрибутом мало словар отвечающий за запуск скрипта по наведению мышки но мы берем и просто растягиваем этот элемент поверхности поверх всего окна так как пользователь держит мышку где-то на окне когда все это загрузилось скрипт выполнился и сразу же себя удалил чтобы не блокировать следующие нажатия последняя классификация это дом базит XS про нее тоже стоило упомянуть домбазид XS это не когда мы Передаем в параметрах наших вектор А когда JavaScript берет из каких-то из каких-то свойств которые мы можем контролировать строки и вставляет их небезопасными методами в страницу мы можем попробовать в эту строку засунуть свой JavaScript и если там есть дом Базис то он выполнится вот простой пример в квери string у нас попадает строка из Location Search внизу Если вы Обратите внимание locations это все что после знака вопроса далее через это строка декодируется из процентной кодировки Что приводит как раз уязвимости и дальше наша декодированный так декодированные строка без какой-либо обработки без какой-либо фильтрации сразу же вставляется на страницу и вот я попробовал выполнить этот код с скрипт с нашим экс-вектором после знака вопроса и это привело у меня к СССР Давайте закончим с теорией и перейдем к практике Теперь попробуем поискать где-нибудь xcss И так как я уже говорил таких вендоров У меня получилось взломать мы пойдем по моим шагам и поищем xss если мы попробуем обычный самый тест скрипт один скрипт отправим сообщение Вот я пометил Input внизу открыл де багер и там написано output то мы видим то что наши все скобки закодировались HTML сущности и в таком виде это не будет работать нет ли тут уязвимости самая обычная нету попробуем разобраться копнуть поглубже Возможно что-то у нас получится прежде чем разбираться нужно понять что мы будем искать еще в этих сообщениях в применении сообщений очень часто встречаются такие штуки как парсеры они могут находить какой-то под строку например ссылку email картинку или смайлик и делать ее кликабельной я вам уже рассказывал про Ванила который был на форума терио морг у него был самый плохой пример Они использовали HTML как разметку это приводит таким проблемам то что разработчику нужно знать максимально много больше чем или максимально много способов как можно выполнить JavaScript с помощью разных тегов и все Это умеет фильтровать естественно это приводит тому что что-то забывается что-то не фильтруется следующий пример который наверняка видели все Кто использовал форумы это бы коды Они чем-то похожи на HTML только квадратные скобки вместо треугольных следующий пример можно встретить в телеграме в гетхабе он называется Марк Он Более сложный синтаксис но в принципе тоже человека читаемый человекопонентный Вики текст который можно встретить Если вы зайдете в Википедию и Попробуйте отредактировать какую-нибудь статью и другие часто встречаемые например смайл можно заменить на эмоджи или на двойную скобку с круглой скобкой с круглой скобкой и это может превратиться в итоге ожидаем результат то что это превратится в картинку то есть откроется так инк и куда-то будет ссылаться хэштег username наверняка все кто пользуется ВК Инстаграмом видели то что можно в комментарии вставить вот такую строку Это станет кликабельным будешь переходить либо в поиск по хештегу либо там поездим на ему на страницу пользователя и самые простые Вот как раз ссылку вставить она становится голубенькой по ней можно нажимать пример грубо говоря сообщение универсального которое я использую очень часто я написал разных форматов URL email и urlis параметры и всякие языки разметки Теперь попробуем засунуть это в наш вы будете на сообщение мы видим то что у нас стали голубыми ссылки некоторые бабы код стал черным и также два смайлика превратились в какие-то свои смайлики это подгрузили картинки сервера сами по себе кликабельные ссылки или картинки это неуязвимости Но это наши входные параметры Теперь мы можем проверять эти места на xss Если вы попробуете загуглить макдаун xss либо быкотекс наверное первые два таких самых распространенных примера которые вы найдете это как раз проверка фильтрации HTML символов угловых скобок или кавычек одинарных двойных и второй пример это использование как раз javascripturial схемы здесь пара примеров для проверок на фильтрацию разных синтаксисов на этом уже как раз пример скриптурел на следующем слайде будет Как раз разобран пример здесь будет подробно разобран пример смотрите это воображаемое приложение чата Я пробую в него отправить тест с разными URL с разными схемами первая реально существующая схема http вторая кв произвольная схема которая не должна вообще по идее парситься и следующая небезопасная схема JavaScript и что я вижу разработчик этого воображаемого чата был ленивый он просто сделал регулярку которая берет слово если оно там слово двоеточие он такой это кажется ссылка и делает ее кликабельным это небезопасно следующее про что я вам уже упоминал вскользь это как раз файл схема И то что она очень часто бывает небезопасно на доном приложениях следующий слайд вам как раз покажет такой пример обычный блокнот который умеет подсвечивать ссылки произвольную схему он не умеет но он умеет все реально существующие http FTP файл если я кликну два раза по последней ссылке у меня запускается калькулятор Если же у меня был здесь не просто я мог вставлять ссылки А здесь была XS я мог бы сделать двойной Клик С помощью Java скрипта и это все запускалось бы независимо от пользователя теперь четвертая более-менее известная техника это когда мы засовываем какую-то закодированную строку Передаем Она сначала пытается пройти там обработку в ней ищется и обрабатываются все HTML символы а потом она декодируется в таком случае это тоже может привести к СССР и я привожу примеры самых часто встречаемых кодировок в вебе Первое это или процентная кодировка потом кодировка DJ sana через обратный слэш CSS похоже на джейсонскую только без ю-00 и HTML сущности а пропустил JavaScript тоже похоже на СССР переходим к самому интересному что мне больше всего нравится вот этот мемасик максимально близко передает только то как мои вот эти уязвимости выглядели для вендоров и что такое наложение парсеров как раз все кто наверно читали заголовок ничего не поняли в заголовке просто какая-то чушь написано наложение парсеров это такое состояние когда вот наша строка в сообщении Допустим urlка или e-mail обрабатывается сразу двумя парсерами и урелкой и mail сейчас покажу на примере как это выглядит просто блок схема логика Вот приложение которое у нас делает красивые сообщения мы отправляем куда-то на БК сообщение оно находит все HTML символы удаляют их или заменяет на безопасные дальше находит с помощью кластеров делает их кликабельные находит имейлы делает их кликабельными и возвращает простой PHP код не буду сейчас его разбирать чтобы сэкономить время Вот как это все работает все тот же чат отправляем URL Q она становится кликабельной открываю отправляем email но не обычная с параметром если мы кликаем на такой у нас а вдруг открывается уже заранее поставленным заголовком для нового сообщения Теперь попробуем сделать наложение сделать такую рыбалку чтобы она была и выглядела и как mail вот что у нас получается вывалились какие-то куски html-кода если мы откроем дибагер то мы видим то что наш e-mail уже стал незначением атрибута отвечающим за ссылку куда будет все переходить а новым атрибутом а теперь посмотрим как это можно использовать если мы вставим вот такую вот ссылку которая под параметром Input написано то мы получим следующий html-код в данном случае красным я отметил начало и конец тега желтым я отметил название открываемых атрибутов а зеленым их значение и получается то что у нас внутри первого атрибута открывается новый тег и первые свои двойной кавычка и закрывает этот атрибут дальше мы уже можем писать свои новые атрибуты Тут не совсем понятно теперь посмотрим на тубе либерду которую видели самом начале я его выделила текстом это стало намного понятнее в первом примере уязвимый код видео позволял внедрить произвольные атрибуты с использованием bb-кода фонд далее майба 2 вставленных друг друга бб-кода e-mail приводили к эксцесс ПМ Вики мне сложно если честно это как-то передать по-человечески нормальными словами какая-то каша такая пример сроки чатом Это шорткод для лки и макдаун котлеварелки вставленные друг друга пример с дискурсом это декодинг после после фильтрации в данном случае происходил декоринг из процентной кодировки и за HTML сущности тоже последние пример Возможно там тоже был какой-то диконинг сначала его кодировала потом декодировала или возможно Там просто отсутствовала фильтрация какая-либо Теперь мы хотим разобраться полностью и найти свою экстрасенскую в этом форуме соберем свой фаст-лист и Для начала нужно понять как это все-таки делается Какая логика это список все вот эти строки которые нас подсветились голубым емейлы смайлики мы засовываем список б собираем список просто из всего что у нас превращается в HTML из обычных строк список мы вставляем только те строки которые мы можем модернизировать и они все равно приводят например в урелке можно там параметры какие-то вставлять и в e-mail мы можем там домен поменять вот в случае со смайликом если мы между двойной двоеточием и круглые скобкой что-то ставим это уже поломается и смайлик не будет водиться поэтому мы его оставляем только без списки список C я оставляю на удачу можно напихать туда Просто всю аске таблицу например попробовать кодировки разные или попробовать HTML символы и тут небольшой пример как это все выглядит то есть мы берем сначала строку в нее вставляем вот в это место строку из листа C из листа б и дальше также с каждой по очереди это не весь фас лист это именно рабочий фрагмент который начал работать и как я вам говорил ранее уязимый код был видео и код который нам помогал был фонд теперь нам нужно понять Вот мы сейчас отправим это сообщение Как понять что мы нашли что-то какую-то аномалию самый простой способ это визуальный он может работать в тех случаях когда мы не можем контролировать трафик или открывать Исходный код страницы допустим если это в телефоне или может надо 100 приложение где все за СССР и второй способ Где мы можем полностью все автоматизировать мы можем просто использовать регулярки которые видят в атрибуте html-тега открытие еще одного HTML то есть наличие открывающие скобки всем известно хакерская программа берб и пример файзинга с помощью этого фаз-листа Если обратить внимание все отсортировано по седьмому столбцу который содержит truefoll состояния как раз используемой регулярки смотрим Что у нас получилось где выстрел регулярка и вот как раз это этой же самой регуляркой у нас выделено место где она сработало если посмотрите повнимательно как раз открывается один тег внутри другого внутри атрибута другого теперь пример визуально как я говорил начинает вылазить какие-то куски HTML куски атрибутов HTML это все очень выглядит и бросается в глаза Теперь мы нашли советскую форуме что мы можем сделать если мы зайдем на свой локальный форум от администратора то мы можем обнаружить в нем такой функционал как редактор шаблонов PHP если посмотреть самый низ то туда я воткнул самый простой двухстрочный PHP который просто берет из параметра на главной странице засовывать И тем самым дает нам не авторизованный доступ к серверу Вот так это все работает когда наша xss уже сработала наш воображаемый админ прочитал вредоносное сообщение у него загружается богдзор который работает прямо на главной странице в данном случае я запустил вызвал программу запустил функцию PHP version которая вывела мне просто версию PHP Так теперь нужно попробовать видео запустить сможете ребят видео начинается с того то что я все тот же админ и я у себя в админке я показываю то что в данный момент никаких бордоров У меня нету ничего не работает И теперь я пытаюсь Прочитать сообщение сообщение я сделал максимально беспалевно И для этого чтобы хоть что-то понять и открываю сразу дебагер чтобы было видно абсолютно обычное сообщение теперь переходим во вкладку Network в дебагере и находим место где наша страница обращалась к админке и загружала phpack dore в фоновом режиме Вот как раз URL там была админцплей бла-бла-бла и в самом низу как раз будут эти строки которые вам до этого показывал отвечающие за неавторизованный доступ вот теперь о том поговорим о том как защищаться Мне очень нравится если честно полностью откачать javascrip потому что это как внушает какое-то Доверие чем пытаться максимально фильтровать потом фильтровать Заново заново еще раз фильтровать и есть две техники и техники технологии наверное которые позволяют браузере отключать JavaScript на страницах первое контент Security policy это политика безопасности контента подразумевающая то что вы можете вести либо черный список либо белый список источников Откуда будет загружаться контент Ну не источников Я имею ввиду сайтов в то же время с помощью этой политики Вы можете полностью отключить выполнение Java скрипта или недоверенного javascript-страницы второй пример это iframes and Boxing и если ваш контент отображается через айфрейм вы просто можете добавить атрибут Sandbox и тогда перестанут работать Директ и перестанут работать JavaScript и для того чтобы вам что-то из этого включить обратно Вам нужно будет по очереди перечислять я разрешаю JavaScript я разрешаю редиректы посмотрим как это работает на примерах пример контентеполисе я забыл вам сказать эту политику можно добавить двумя способами Первое вернуть в ответе сервера в заголовках контент Типа если он так и будет называться или с помощью HTML тэгата который грубо говоря эмулирует заголовки ответа и все точно также указывается данном случае Я запрещаю вообще обращаться куда угодно кроме самого себя и в то же время это запрещает выполнение онлайн скриптов потому что они разрешаются отдельно нужно добавить и мы пробуем запустить криптовалюта один скрипт внизу видим то что скрипт заблокирован потому что данная политика безопасности контента не разрешает выполнение как я говорил до этого это политика разрешает так или иначе загружать скрипты с этого же сайта если сайт разрешает загружать файлы на него то мы можем загрузить файл и также дернуть его как JavaScript второе способ Если уязвимый сайт использует jsonp можно через колбек попробовать записать свой скрипты также к нему обратиться довольно гибкая штука она может не только блокировать она может Вас также оповещать о том что какая-то Аномалия происходит какой-то контент небезопасный вдруг начал загружаться и если вот добавить и адрес стало просто будет по запросам jsonic летать и рассказывать вам то что что-то необычное происходит теперь блокируем скрипты с помощью бокса как я вам говорил просто минимальный набор этого пустой атрибут Sandbox далее через сорт долг я пытаюсь воткнуть скрипт и мы видим то что скрипт успешно заблокирован и не может выполняться теперь разберем Как защищаться как мне не нравится защищаться санитазинг фильтрацию Кто как называет но я покажу вам крутой пример который Я обнаружил Вот как раз в рамках этого исследования на одном из форумов я тестировал форум cms она пишется как звучит как форма пишется как форум печь форум и что я обнаружил на меня обновленной версии там была Cody email когда я решил проверить воспроизводится ли она на последней я увидел то что разработчики не стали выходить вокруг да около они просто взяли и зашифровали не зашифровали за энкоделей все в HTML сущности вот Нижняя строка это грубо говоря Исходный код вот этого сообщения текст сообщения которые отправил Это email бы код открывающийся закрывающийся и вот так это выглядит то есть абсолютно обычно что почему мне это нравится потому что в данном случае строка меняется полностью и мы не можем уже делать никакие наложения и не можем контролировать никакие строки здесь Тут уже свой какой-то текст на этом все спасибо что послушали если какие-то вопросы теперь я вас слушаю Большое спасибо Игорь Я думаю вопросы обязательно будут так если сейчас нет увидимся Вот первый вопрос есть туда второй вопрос да спасибо за доклад Что делать со старыми браузерами которые не поддерживают еще просто выкинуть их и забыть Мне кажется это такая редкость в 2022 году То что нужно мне кажется принудительно описать и пользуюсь то что он должен обновить старый браузер если у вас действительно есть такие пользователи так вот еще вопрос Игорь вот справа вот справа Спасибо Здравствуйте все-таки не очень понял Как защищаться от уязвимости именно вложенных парсеров смотри Ребята вы сможете вернуть на пару слайдов назад или я могу с помощью кликера это сделать Ну типа избавляться Ну да получается Смотри я передаю свою строку Вот текст сообщения видишь там Квест собака кв.com и чтобы наложение сработало Мне нужно ставить туда еще что-то что будет другим парсером разбираться Но мой результат полностью кодируется и я уже не могу свои строки туда которые я контролирую вставлять это полностью блокирует мои действия следить за логикой В общем если вы фильтруете фильтровать все максимально вот как в этом примере либо если вы подозреваете что у вас может это привести к с или вы какой-то берете пользователей вот e-mail провайдеры Они подразумевают то что в мейлах используется JavaScript и HTML и то есть фильтровать все это невозможно проще всего взять просто с помощью Ай фрейма обрубить выполнение Вот именно в самом сообщении Java скрипта вот в этом подконтрольном html-коде который пользователь может присылать или же сделать объявить контент Security policy точно также отрубить Спасибо так вот еще молодой человек рядом Привет Игорь привет привет это все конечно классно но Расскажи Вот ты проломила админку допустим через А дальше что ты все прослушал Лёха там не в начале там было такое видосик где я просто от админа показываю как мне приходит сообщение и на моем на главной странице моего формы получается который выполняет по хэшный Да это понятно про баннер дальше уже пробиваемся в админ директоре Как там не понял Давай тогда вопрос поставлю самый большой Пак который ты получал от я рассказывал тоже наверное не вот этот Баунти на эфире которая мне ничего не заплатили сказали извини чувак форум не мы писали А это вообще не бака фича поэтому давай Молодец деньги ты пожалел об этом нет Вот чем вопрос да справа Я хотел бы просто как бы свой пробел в знаниях вижу Заполните То есть у меня раньше складывалось впечатление что xss скорее используется на каких-то фишинговых сайтах которые подконтрольные злоумышленнику это не так вообще если рассматривать рефлектор то скорее всего Да нужно будет перейти по какой-то ссылке вредоносной или посетить вредоносный сайт который среди Директ и будет эксплуатировать это рефлектор от XS в данном случае мы больше всего рассказывал я про Store таксист который ты один раз отправляешь сообщение и ждёшь Просто когда пользователь его прочитает ты используешь легитимный контент и легитимные страницы которые так или иначе будут посещаться пользователям То есть ты пишешь сообщение админу ему как минимум будет интересно что ему там написали он откроет и прочитает Спасибо так еще вопрос ребят есть подарок за лучший приз пока было 4 вопроса еще можно посоревноваться так вот еще вопрос так а вот если мне есть задача что пользователям дать возможность писать JavaScript как мне организовать свое приложение чтобы это было безопасно носить все на отдельный домен где не будет никаких авторизационных данных вообще ничего просто какая-то отдельная песочность Желательно даже не поддомен а какой-то там отдельная доменное имя его где-то показывает можно Пускай они там чего хочешь выполняют но ты ничего тут украсть не можешь это просто там грубо говоря статичная страница где нет ни форма авторизации мы ничего там не храним просто вот отдельно для баловства скриптом сайт Но это такая тоже специфичная довольно таки специфичный функционал в приложении и вот лучше его выносить отдельно куда-то Так у нас чем нормально времени на вопросы докладчиком можно помучиться Он не против я уверен Ну вопрос похоже нет так Игорь какой вопрос больше понравился да тогда вот молодому человеку непосредственно подарок Мы также те игры Благодарим за выступление за твой research вклад в информационную безопасность и у нас есть также для тебя подарок Сейчас непосредственно тебе вынесут большое спасибо Спасибо"
}