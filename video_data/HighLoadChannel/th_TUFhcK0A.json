{
  "video_id": "th_TUFhcK0A",
  "channel": "HighLoadChannel",
  "title": "TechTalk \"Как мы интегрировали нагрузочное тестирование в юнит-тесты\" / Кирилл Борисов (Газпромбанк)",
  "views": 1104,
  "duration": 618,
  "published": "2024-04-17T01:12:42-07:00",
  "text": "мы все еще в Ленинграде это Saint hilot 2023 И следующий у нас гостях Кирилл Борисов хедов profession в тестировании Газпромбанк Привет Чем ты занимаешься Я даже не дал тебе привет сказать чем ты занимаешься Что такое хедов profession Это profession это роль это Эксперт который отвечает за развитие стандартов Практик комьюнити в той или иной профессии моя профессия такие инженер Спросите Но ты же разработчик нет Как ни удивительно я не разработчик я 20 лет работаю с тестирование вот до сих пор не надоело это этим заниматься в основном это банки Газпромбанк Я уже три года и последние 15 лет больше всего наверное мой фокус сконцентрирована тестировании исследования производительности Расскажи про то как вы что тестируете Ну мы сейчас сильно поменялись на самом деле когда не про прошлое по-настоящему Да и сейчас Мы двигаемся влево Shift Left до Наша задача это собственно уйти от водопада который классический старый долгий дорогой Да и мы хотим быстро доставлять продукты на рынок нашим клиентам А для этого надо начинать как можно раньше любой этап разработки которые есть выпуски продуктов и тестирование в том числе и вот для тех кто не сталкивался Shift Left Что значит это как размещение этапов которые обычно в конце таймлайна по цепочке уже готова 30 секунд для релиза была старая классическая история с нагрузочным тестированием когда там спроектировали разработали протестировали и начинаем работающий продукт и сталкиваемся с традиционной ситуации перформанса не хватает и надо все переделывать вот нужен для того чтобы вот эта самая последнее тестирование делать как можно раньше влево по таймлайн чтобы вместо релиза не возвращаться в разработку конечно чтобы не находиться в бесконечных циклах вот этих вот возвратов возвратов возвратов раньше знаешь о проблеме в разы дешевле будет починить Итак вы взяли за основу Shift Left Как вы дальше действуйте Ну собственно Наша задача это уйти от релизов дать возможность командам самим Независимо внедряться и чтобы в командах Была Был весь набор Практик и экспертиза чтобы выпустить продукт в том числе нагрузка нагрузка раньше была всегда как сервисная команда которая в конце собственно исследовал производительность той системы это всегда дорого и долго дорогой стенд который нужно собрать продлайк много железа много интеграций дорогие редкие на рынке инженеры которые знают какие-то Не всем понятные вещи типа джеметер лоурен Гатлинг и ещё что-то такое достаточно сильными частичко их мало И нам надо вовлечь в эту историю разработчиков которых по численность намного больше Ну например на 20 нагрузочников у нас приходится там больше 500 разработчиков Это колоссальная разница в ресурсах она нужна Собственно как разработчиков научить исследовать производительность сейчас они умеют решать проблемы производительность разруливать Battle nake которые мы находим Да там входят тестирование но надо чтобы ребята умели сами их находить как можно раньше И для этого мы собственно перенесли нагрузочное тестирование влево на стадию unit-тестов просто поставили что Какие тесты умеют делать разработчики Конечно все разработчики умеют писать Unit тесты поэтому мы ребятам предложили использовать библиотеку поискали и нашли не очень новое решение Но малопопулярное на самом деле я не часто его встречал вот это gmage вот библиотека от Open gdk который позволяет исследовать перформанс приложений на уровне кода также как и Юнит тесты порог хождения очень высок Это тот же Юнит и в принципе там Лол кодинг за счет небольшого набора аннотаций можно любой юнитест превратить Бенчмарк а но это собственно процесс тестирования он реализуется за счет процессов сборки приложения и поэтому очень легко ложится на все процессы сборке конвейерах и конечно приложение можно запускать в контейнерах и очень быстро и вот то что я говорил Нужно дорогой стенд большой продлайк для нагрузки для таких видов исследования производительности этого ничего не нужно вам нужно твой рабочий ноутбук или Агент сборочного конвейера рабочий ноутбук и стенды железа разные дает разные результаты на самом деле нас не очень часто интересует сколько там раз за секунду может выполняться твой метод максимум 1000 или 2 нам гораздо интересней после изменений которые мы вносим код стало хуже или лучше это Ключе в данный момент да и собственно проведя два теста до изменений и после сравнив результат и ты понимаешь я поменял код стало лучше я поменял код стало хуже это то что мы хотим и Мы кстати эту проверку настроили в своем по плане выставили трешхолды и собственно будет сборка может быть зацелена плохой код не уйдет продакшн внедрение любых таких инструментов Она всегда инструмент классный но как нам его использовать там неудобно не автоматизировано ничего такого нет Почему мы опять же остановили выбор на это инструменте Потому что есть множество плагинов любимые всеми разработчиками идеи к Team City дженкинс есть репорты автоматизированные То есть ты встраиваешь свой отчет У тебя есть всегда в артефакты сборки ты можешь две сборки сравнить между собой узнать Как меняется твой перформанс а также там есть еще функции профилирования и инструментации то есть сразу и можешь узнать какие у тебя методы тормозят где как ведет себя память как ведут себя потоки в общем очень удобный инструмент нам сильно помогает Кирилл А как вы определяете что тестировать А что нет у вас не все покрыто но не может так не бывает да точно так не бывает и так не нужно Что самое главное тестирование долго и дорого не нужно тратить время на неполезные тесты Да поэтому мы сфокусировали сначала тестировать нужно тот код который изменяется и мы собственно в нашем конвейере написали небольшую функцию которая определяет собственно Какой код новый и запускает тесты именно на те методы и классы которые были изменены тем самым позволяет в разы с экономить длительность сборок и мы понимаем сразу что поменялось поменялось ли она в лучшую сторону это тоже то что мы используем и очень удобно отлично Но это сильно зависит от того какой сервис вы тестируете и насколько он покрыт тестами понятно что не каждый микросервис является микросервисом Да там может быть очень много методов и классов и тестирование занять может большой процесс сборка может идти может несколько часов если на нее повесить очень много до Долгих тестов на тесты А можно группировать и Б как я рассказал тестировать только то что изменилось и вот этот как раз второй подход нам помог сэкономить Мы реально можем прогнать перформанс тест за 2 минуты плюс там Е3 на прогрев Вот и узнать то что новый код работает не хуже старого шикарно Это можно на вашем офигенно мерчая кстати Покажи всем логотип на офигенном мирче написать тестирование Газпромбанка от двух часов до двух минут Помните о том что на стенде спикеры и специалисты в более расслабленном режиме отвечают на вопросы подробнее Меня зовут Алексей образец это Saint highload 2023 А сейчас что доклад кулуары Поехали дальше Спасибо Приходите на наш стенд с таким логотипом можете задать вопросы экспертам и мы вам все подробно расскажем на мою тему и на любую другую гонг"
}