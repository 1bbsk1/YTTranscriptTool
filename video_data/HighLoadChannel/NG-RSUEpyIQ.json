{
  "video_id": "NG-RSUEpyIQ",
  "channel": "HighLoadChannel",
  "title": "Stateful Deployment Platform или как Uber управляет сотнями тысяч баз данных / Егор Гришечко",
  "views": 1135,
  "duration": 2699,
  "published": "2022-03-21T12:55:00-07:00",
  "text": "всем привет меня завут егор я работаю выбери я наверное начну шутки которую вчера случилось со мной потому что я еду на такси и с 1 дня конференции и меня таксист такой спрашивает а где вы работаете я выбери он так на меня посмотри горит а где я такое в дании таксистом ну вот на самом деле работы не таксистом как я уже сказал меня зовут его я работаю датском офисе компании убер это офис который можно назвать scalability офисом потому что мы делаем пять или шесть критических проектов для всего убера это компьют который делает стекла с нагрузки мы которые отвечаем за базы данных ну и там несколько проектов непосредственно сама компания работает поверх них если мы остановимся uber остановится то есть в этом плане мы очень критичны и мы поддерживаем вот этот рост вот что такое uber если вы не знаете во первых это приложения для заказа такси во вторых есть its и в третьих есть фрейд это третье направление бизнеса это представьте uber только для газелях то есть ты бы такой водитель европейской газельки и вы хотите войти возить я не знаю там лестница комода и вот вы ставите себе выбор uber фрейд и и пользуйтесь так вот в чем всем поговорим мы поговорим о платформе который называется 1 почему один ну потому что офис находится в дании потому что тема нордической мифологии как никому близко датчанам а еще один знает все и один это в логической мифологии такой дядька которые за знание отдал свой глаз ну то есть там один им знание баз данных все рядом так вот что мы есть мы платформа который мы джим 50000 реальных больше чем 50000 реальных физических постов которые расположены в нескольких наших датацентрах и их в jade дтп и и ws у нас если очень захотеть нас на нас можно положить полторак за байта данных мы знаем любим холим и лелеем 700000 докер контейнеров и у нас примерно где-то 2 миллиона цепью ну я der обычных так вот на нас занбар je nach сейчас примерно 40 технологией там из самых попсовых и тома сиквел редис как капка моя любимая мдф с кассандрой и так далее так вот тема сегодняшнего доклада кроме того что я вам расскажу как это все работает и зачем мы это все делаем является мое желание доказать вам что эволюционное развитие лучше чем революционная почему я не знаю чем старше я становлюсь тем я больше понимаю что переписали все выкинуть и переписать это не всегда возможно и на самом деле это не всегда возможно и чаще всего проблема стоит решать только тогда когда она возникает и преждевременной оптимизации чаще всего это корень всех зол так вот давайте начнем с темной эры технологии так скажем это где-то там до двух 2015 года uber это монолит который работает москве и каждый их луи но он взрывается причем он взрывается каждый flame взрывается каждый крисмас рождество католическое потому что не выдерживает нагрузки почему это происходит на самом деле по одной простой причине 90 процентов банда 90 процентов баз данных занимает история поездок то есть кто начал куда началу координат ки как едут зачем едут куда едут и это все время растет потому что пользовательская база растет пользователи все больше больше больше больше и в определенном момента становится все не очень хорошо то есть на какие изменения на базу данных когда у тебя ну то есть одна база данных в продакшен пользователей ездят деньги капают это у тебя надо обновить колоночку айтал учит базу там ну надолго никого это никому это не нравилось поэтому подумали подумали подумали и решили сделать вот такую штуку вынести данные в отдельный трипс top ну мы же работаем стартапе поэтому давайте напишем свою базу данных в общем долго долго думали и пришли к выводу что история поездок на самом деле это но сиквел это обычно ну по сути это лаги там пользователи или еще что-то и какие-то данные которые вы там лежат допустим массив координата еще что-то вот долго выбирали носику решения не чопа бот под по под объем на тот момент не подошло облака были в очень зачаточном состоянии и поэтому решили разработать свое сортированная но сиквел решения с бэндом видимо сиквела на самом деле убера часто такое случалось что когда ему нужен был touring его еще не было это вот частая ситуация потому что я часто сейчас и там где то че то еще что то а почему вы не используете это ну потому что когда его еще не было оно уже было нужно и поэтому написали свой решение свое решение так вот это 2014 год и это скинул с я не назвал название это было изобретено скинулась это было близко не почти бесконечно шаги шокированная но сиквел база данных которое главное предназначение сначала было его складывать координаты от поездок то есть это 2014 год и сразу стала проблема так как база шарди руется хвостов становится больше как это поддерживать ну окей на первых порах все было хорошо это башни из убирая сразу скажу но он должен быть нечитаемые тоже баш вот все это делалось на ран буках на башке то есть ну девелоперами вот это в да не все разрабатывалась девелоперам коннекте лись хасту баши кого-то крючками выполняли там допустим мастер умер давайте за промывать им слайго ну окей закончился псс эйчу выполнил гашек все хорошо это все работало до определенного момента а потом случилась такая штука как экспоненциальный рост хвостов то есть количество баз данных увеличивалась ну не количество железных состав и количество пользователей количество данных росло 10x каждые полгода почему так случилось uber начал экспансию и вышел в китай на самом деле я когда google экспоненциальный рост и нашел структуру данных который называется экспоненциальное дерево я так и не понял чем она отличается от бинарного ну полного бинарного ну пусть будет так так вот и сразу стали всплывать проблемы так как количество хвостов росло то есть мы сначала их было два потом их было десять потом их стало 100 потом их стало больше больше больше сейчас как я уже сказал мы 50 больше чем 50000 костюм как мы начать хасты как проверить aravia баз данных как проверить кластера как проверить то что все за реплицировать как это все сделать надежно еще стал вопросы пишемся то есть когда много железа и ты можешь захотеть только ну масику бэг-энде голый май масик волна в металле на голом железе ты можешь захотите только одну базу на хвосте по сути а хотелось бы как то вот так ну то есть по optima не используют железо много но дорогое вот встал вопрос что нам написать больше баша и не всегда это лучший вариант нанять больше людей попробовали а потом тимлид тех лид проекта который до сих пор работает который это все написал скинул мне картинку он сказал что 2015 год скинулась когда перевезли поездки вот работы над не напоминало примерно вот так то есть одной рукой пилили свеча другой рукой и и чинили потому что она была набор металле все было плохо вот думали над этим думали лишь или это все дело автоматизировать автоматизировали это все в две операции опять же показать эволюционного подхода то есть попробовали раз не получилось не стали все выкидывать немножко поменяли и поехали дальше так вот что такое подход номер один подход номер один и такая штука который называлась абсцесс почему обстрела из потому что меньше обсе лес это меньше abs ну операции логично что это было это был юльчик юльчик который выполнял ран бук и замещал собой ranbu то есть пользователь если раньше он посещает конектится к росту выполнял какой-то борщик то сейчас это все работало ты заходил такой силой что дергал какой-нибудь крестик или кнопочку нажимал в юо iv примитивном и у тебя на хост выполнялся с и чиба штамм автоматически работал этаж код по моему нашел он такой веселый ну это было с другой инфра интегрирована а хасты растут его прямой момент это стало очень больно потому что вот connection и вот во все стороны и опсос ей был написан на питоне на торнадо и он ну как то ему стало плохо в определенный момент потому что он перестал просто вывозить рост количества хостов убера поэтому случилась вторая операция в 2016 году которая состояла из двух частей ну и как бы давайте начнем с первой части было решено уйти от процедурного подхода ну или подхода когда-то каждый свой ход знаешь в лицо там так знает что это хост g19 289 6 у него проблемы с диском и как бы ты выполняешь скрипты на этом хостеле у тебя есть какие-то ран буки написанные ты можешь и сочится в этот ost у тебя прямой доступ к нему и только вот только так ты можешь хвостом взаимодействовать это все может ломаться ну и 8 как бы состоится выполнит импаза промыть одного слова за промойте другого слева за пробуете 3 слова и так далее и тому подобное это не все не очень хорошо работала и под мало того непонятно кто и что выполняет это не очень хорошая история поэтому было решено перейти подходу которой мы называть был stay'd или такой стадо коров то есть мы знаем что корова и такое животное на четырех ногах у нее есть рога она в идеале должна быть там вот в крапинку красную вот мы описываем что корова это это и мы однозначно верим и соответственно гол state он обозначает наши намерения то есть мы описываем что мы хотим и за баз данных редис одним гигом оперативы с одним ядром и вот и все у нас не волнует и мы хотим и что если мы выполним это намерение два раза чтобы оно было одинаковым это все работает автоматически это все работает независимо и это все можно удерживать то есть ура у нас что-то автоматизированном и здесь что-то декларируем у нас автоматически все разворачивается да немножко похоже на кубер нить если понимаю на самом деле кубер нити с внутри если вы посмотрите там тоже гостей тори конца и лук и там все то же самое . обернитесь это вот прекрасный пример галс той системы ну как как как я ее понимаю вторая часть это было обернуть массе cool докер тогда в uber использовался какой-то перка на сервер чё сейчас используется и не знаю есть статья тех ли до моего проекта вот от еким а можете зайти в инжиниринг блок почитать соответственно в этот же момент это примерно 2016 год стал вопрос а не заехать ли нам кубер нить из но он просто просится и всплыла проблема что к вернитесь был заряжен примерно года два назад до этого и он вообще не был приспособлен для стоит full приложений сейчас он лучше приспособлен для степу приложений но все равно есть какие-то проблемы так вот чем отличается stateless at state hwy на самом деле стэком если так я сейчас приведу еще аргументы главное отличие что stateless ну ты его можешь перезагрузить ну попробуйте перезагрузить убить базу данных ну как бы данные потеряются или упадут или тебя запросу перестанут ходить там такси перестанут ездить и до перестанет добавляться ну как бы не очень круто а если ты убьешь stateless но у тебя какие-то заказы то мне достанется один ну что поделать мы можем это все встретилась мы можем достаточно безболезненно горизонтального масштабировать ну то есть ну как бы инстанции добавили даже не в стойку просто виртуалке подняли и за балансировали все хорошо ну кто горит горизонтально коллировал базу данных знает что проблема репликации это очень сложно нам нужно думать о количестве реплик это все долго подтягивается и в тот момент у кубер не tissot не было даже стыд full set а ночью стал вопрос в чё нам делать мы либо пишем свое либо берем amg оберните сделаем internal форк и просто ему по чем-либо мы отправляем почти в мейнстрим ну main гитхаба вскинул верните со подумали подумали и решили что сделать свой специализированные велосипед для скинулся будет выгодней и придумали следующую систему я сейчас показываю концепт который был придуман 2016 году и мы до сих пор работаем так я сейчас приду я сначала покажу высоко уровню как система работает в этом мы поговорим про детали у нас есть был stay'd мимо применяем поинтами получаем актуальный стоит по сути базу данных мы постоянного лидируем если мы видим какой-то дрифт проблемы отваливающиеся диски что угодно мы и мити мышью если мы знаем что есть ищу мы пробуем их пофиксить и когда мы их фиксе муна же есть голоса it look продолжается по кругу еще в центре ки у нас лежит глобальное view то есть мы все состояния все какие-то промежуточные степы и складываем глобальное view поэтому мы знаем общее с той системы то есть система у нас грубо говоря не в состоим мы можем всегда посчитать стоит системы в каком она находится так вот давайте начнем с гол state а что такое гол state гол стоит это ямал файл ну удивительно в котором описан наш наше намерение что мы хотим один цепью мы хотим там я не знаю байтики диска байтики памяти и куда-то его там положить это все должно где-то хранится логично у нас есть валик мы должны его где-то положить это все кладется в сам описанную домашнюю систему которая служит обертка вокруг гита почему но потому что когда стал вопрос как сделать конфиг систему на самом деле у фейсбука есть похожая система на нее есть white paper и вы почитайте вы примерно пойми есть вы поищите facebook там вы примерно поймёте о чем о чем речь вот но у нас есть конфиг система музыканта в виде гита почему потому что когда конфиге это очень чувствительное место проекта и часто у 3g происходит когда все ломается происходит именно из-за конфигов поэтому нам гид даёт преимущество конфиге то такая сущность ну которая внутри часто не пишешь ты и больше читаешь поэтому такой шаг можешь приложить все хорошо ну как как примерно этой работает по а в случае с гидом мы получаем бесплатный пол request и бесплатные с точки зрения реализации без бесплатные rebirth и мы можем посмотреть кто что поменял если все очень плохо мы идем и руками правим я много ну много раз я пару раз вот руками правил потому что все было плохо стандартным там средством ту лингаме это не снилось но я просто git репо забираю так поменял строчечки отправил все хорошо все заработало вот соответственно съесть гол стоит он где-то хранится об этом сейчас по ходу дела расскажу куда он применяется а применяется он непосредственно хасты как я уже сказал мы платформа которая хочет контейнере набор металле давайте перейдем на хвост level о на каждом посте у нас лежит binary наш binary который называется абсцесс эйджинг ну называл собственности и джин потому что мы говорим сейчас про первую итерацию лежит binary этот binary общается с api и получает не угол state вот он получил гол state и начинает искать давайте представим что я сейчас описываю процесс запуска новой базы то есть binary получил гол стоит и он видит что у него новый голос это для него ничего не знает ничего не видит он создает специальный контейнер который называется баркер и говорит ему хэй на тебе был stay'd вот такая база должно быть worker написано все написано нами ну кроме докера там debian и так далее да то bass worker написано средствами команды которая поддерживает технологию данных то есть там команда кассандры команда кафки и так далее вот worker запускается такой ой яду должен быть контейнер редиса его нет он stand стартует контейнер редиса и стартует там несколько сопутствующих контейнеров которые чаще всего логе метрики и так далее вот и это все старту ица это все подымается worker и собирает актуальны стоит и отправляет его назад вопи но эти немножко более подробно посмотрим то есть на уровне системы это работает достаточно интересным binary забирает все гол state и для хоста ну то есть нагано хотя должно храниться там пять баз данных он приходит такой да мне для этого hasta все-все гол state и забирает их сохраняет файлик оборки когда подымается он читает этот файлик раз в десять секунд если он его видит изменения он начинает их применять обновлять и так далее и тогда когда ему нужно отправить актуальны state обратно в большой абсцесс 1 и так далее он просто его сохраняет опять на диск не то есть у нас получается система что вот все вот эти наши контейнеры безумные тысячи по сути управляются двумя файлами на диске первый из них это гостей который по моему тоже я могу или джейсон ну файлам и второй тоже файл который ушел стоит и который описывает что на самом деле с базы данных происходит соответственно если нам нужно развернуть две базы данных на холсте мы делаем вот что то вот такое мы просто стартуем 2 worker а то есть это может быть worker кассандры ивар кировским волоса или work work worker кафки и worker а я не знаю редиса и они поднимут свои базы данных это все в контейнерах это все хорошо работает замечательно следующий шаг как я уже сказал у нас есть глобальные view ну то есть логично что у нас много компонентов они должны между собой как-то общаться что-то должно с ними происходить какое то они должны сохранять стоит и у нас для этого если мы описанное баз данных ну как бы нам нужна база данных чтоб храните данные о базах данных надавить давайте напишем свою в чем проблема в том что зависимость и нфр и прекрасно описывается графом и не было какой-то достаточно быстро и графа вы и базы данных ну как не объяснили я не как не объяснила команда которая написала не было базы данных которая подходила под те требования которые предъявлялись поэтому написали свою базовую свой графа вую базу данных которая держит все данные в in memory она лежит на очень жирный хвостах с большим количеством оперативки но при этом дампа это при этом нет она ничего не дам по id поэтому у нас есть такое интересное требование что если все данные будут сброшены мы должны выжить ну вот очень интересно соответственно графом можно описать в принципе все вся инф-ра хранит информацию в это графа графова и базы данных у нас есть там какой-то кусочек который мы храним информацию наших устах то есть вот допустим у нас есть хост на нем мы можем как бы пройтись по диагоналям и по связи мы и сказать что на этом холсте хранятся три базы данных есть какой-то волюм и при этом и база данных и ход знает о вольем volume ну то есть месте на жестком диске которые при притянуто внутрь контейнера базы данных у нас объединяются в кластер а но это на самом деле нормальный таким кластер а баз данных с репликами с фолловерами мастерами так далее а это все объединяется в инстанции инстанции это такое более абстрактно явление это вот чтобы группировать кластер и круг грубо говоря один из нас может состоять из нескольких кластеров и там вот зависит все очень сильно технологии и на верхнем уровне это все собирается в технологию то есть грубо говоря если нам очень хочется мы можем сказать нам нужны все базы данных редиса и там какие угодно запросы можно строить поэтому я вот привожу пример это запрос который проходит по всем хастам in free вот папа всех пап вообще по всем не только нашим и выбирает техас ты на которых есть базы данных сторож not енот это наше внутреннее аббревиатура для базы данных то что я вам показал для варки ра контейнера базы данных непосредственно и вот сопутствующих контейнеров и пожалуйста там выберем не все хосты на которых лежит ну выбери вот этот пресловутый гол state выбери все хосты на которых есть базы данных типа рейде с какой версии докера иди и дополнительно он еще выберет поле not go les той поэтому по сути когда нам нужны какие-то данные мы идем в редис редис наполняется из многих freddy's grail grail наполняется из кучи разных источников яга оговорился и то есть если нам нужны данные мы идем grail забираем и то есть все лежит там то есть это такая можно сказать путь bass шина данных я не знаю как бы обязать то есть и такая место в которой все складывают данные если тебе очень хочется ты идешь оттуда их и берешь на самом деле с этим есть две проблемы первая если в грели есть данные кто-то начнёт использовать второе такое знаете глуп когда ты выложил данные прочитал данные преобразовал данные опять отправил в гриву получается достаточно весело вот прекрасно а как мы поняли что ну вот этот гостей должен попасть на какой-то хост нас написано как бы кастомный nokia d-link процесс то есть у нас приходит гол стоит систему он приходит либо через touring либо как я уже сказал создается по файлик в репе либо несколько способов выбирай любой он сохраняется вот не посредством эту гид репу и в grail дублируется а потом у нас написано свою костанайский dollar в которой читает это из крыла чтобы ну гид не очень быстро я вам так скажу он считает это из крыла строит картину мира и такой окей вот вот этот редис кладется там на хост вот в зоне 6 и он создает такую штуку которая называется placement placement это тоже яму файл который хранит себе информацию о том где то но до должна ну где это база данных должна расположена в какой зоне на каком хостесс какими данными и то есть это наша информация которая для нас служит последним источником правды почему потому что гол state публикуется не нами гостей публикуют наши кастамере наши стык холдеры и когда что то идет не так но нам нам нужен life and нам то есть бывает такое что угол стоит пропадает гол стоит удаляют что-то случается и нам вообще нужно понимать что происходит где там база какая-то лежит она вообще живая что откатывать что не откатывать то есть это вот этот placement мало того что он как бы реально обозначает что где лежит это наш последний defence вот от не именно неминуемого краха называется он не мир почему он называется мимир ну потому что те монархической мифологии очень близко датскому офису компании убер вот давайте перейдем к и шью соответственно давайте представим что у нас память умерла диск умер что-то не так стоит про дрифтовал что-то вот база не так у нас начинают своими и месяца и шью шойгу ищу опять же это просто еще одна вершина в графе в крыле которая имеет ассоциацию на что угодно то есть мы просто создаем еще один объект и говорим так это тип и шью и это ищу для базы данных то есть но ты-то база данных ищу для хоста ищу для кластера ищу для чего угодно я просто вот примеры хост нездоров у нас есть в компании так а штука которая постоянно проверяет хасты на то что они здорово или нет если он нездоров а нам просто присылает такая ищу сама отправляет и говорит эвакуирую базу и возвращая его нам типа все плохо допустим память что-то не так с памятью то есть планка умерла или у нас бага ну то есть что-то пошло не так проблемы с диском мои любимые вообще диски как нет личного опыта диски умирают диски умирают постоянное ничего высоты с этим не сделаете и дети умирают точно так же как и изделие все умирают всегда вот какая-то часть флота поэтому немножко повреждена и там придумаете ищу соответственно у нас есть еще нам нужно это как-то поправить есть проблема ну вспомним что мы все еще работаем стартапе поэтому написали свой такой внутренний workflow engine попробовали это все починить не очень попробую не очень получилась он кое-где ещё используется но разговор не об этом второй со второго захода начали использовать кейдэнс кейнс это такая штука которая разработана выбери резет на гитхабе что это это workflow engine что говард engine это когда ты пишешь ну по крайне мере с точки зрения кейдэнс а это когда ты пишешь какой-то код и этот код у тебя есть гарантия что он выполнится хотя бы один раз и его сам методы ну то есть workflow это просто грубо говоря функция на языке голи java и когда она выполняется у нее есть sap функции и вот в этих фокусов функции которые называются activity мы помещаем ее колы походы все перезагрузку базы данных какие-то вот операции которые должны быть выполнены грубо говоря один раз если эта операция выполнялась без ошибки или ну как бы с ошибка и без разницы результат сохраняется него теперь допустим представьте вот код у нас вызвало sexy create activity она отработала а потом просто какой-то сервис сервер на котором выполнялся этот ход он умер кейдэнс это увидит и перезапустит его но у него уже будет и к secu такте вики вот вот это activity результат его сохранен и поэтому он до него дойдёт и такое ой а я уже выполнял вернет нам результаты все поедет дальше поэтому мы как бы накатываем апдейт только один раз перезагружаем базу данных только один раз и все у нас по этому более-менее хорошо вот вот так примерно выглядит половина нашей бизнес логики я для работы с хвостом вот допустим пример как мы возвращаем нездоровые хасты провайдеру мы такие в grail пошли да и пожалуйста нам все хасты с проблемами забрали такие окей с этого hasta мы двигаем базы данных туда с этого hasta мы двигаем базы данных туда базы данных у нас подвинулись мы вернулись вернули хасты как мы двигаем базы данных это очень интересно потому что мы сами не копируем данные то есть как это выглядит мы создаем новую базу данных где то в другом месте она полностью новое стандартными средствами технологии то есть стандартная репликации дуплет данные перетягиваю это новая база начинает функционировать мы просто гасим старую и утром убираем ее там metadata и так далее то есть мы не копируем петабайты по сети они копируются за нас потому что ну технологии очень много вы видели сколько их и написать какой-то очень супер мега универсального репликацию ну это какие-то просто гигантские трудозатраты и пока на это никто не решился поэтому мы используем как бы подходы каждой из технологий так вот пользуюсь вот этим сельским ls подвинулись beer металла обернули стало все хорошо снималась довольно о кей джи мало она растет uber счастлив все растет данные нарастают просто так хасты доставляют доставляет доставляют скинулась расставляют подключаю там другие проекты все хорошо а потом начинается второй этап жизни проекта говорю можно описать словом 1 и о чем я в принципе он все не рассказываю приходит вторая технология говорит ребят мы тоже хотим ся на бирме то ли мы видим как классно скинулась мы тоже хотим к вам появляется дока который называется один который то что я вам сейчас показывал а связывается адский маллинз потому что она была прибито гвоздями каски малыш отказывается от скинулась попутно переписывается с питона нога и начинает свой дальнейший путь то есть я как бы еще раз показываю была проблема для скинул с ее решили пришло пришел другой заказчик говорит блин ребят у меня проблема надо пофиксить мы такие ну не мы команда команда посидел посидела ну и начала решать проблему написала новую доку начала рефакторинг алёшин начала отвязываться не начала писать на новом месте что то что то новое так вот и сразу всплывает новая проблема как нам про мигрировать технологии допустим которое хочет четыре девятки то есть мы не можем ее выключить как про мигрировать технологию которую мы не можем выключить это вот на самом деле проблема то есть когда у тебя миграция там я не знаю у тебя нам из работает на чем-то и тебя нужно про мигрировать и на него смотришь ну ты не можешь его выключить а тебя как-то надо его в систему увести у некоторых технологий реально могут быть петабайт для данных ну как ну то есть вот у него стоит хост у него лежат его binary накосить этом петабайты данных ты не можешь скопировать даже репликации так не можешь скопировать это очень долго будет ну и нам как бы generic платформой надо быть это все из этого вытекает еще все технологии разные и по ветке в нем все они очень разные у всех по-разному работают репликацию у всех по разному работает все все по-разному живут в докере всем нужно разное железо кому-то нужна видеокарта кому-то не нужна видеокарта кому-то нужно иди кому-то нужно и среди кому-то нужно и npm и это такие модные языке есть такие вот и поэтому я сейчас расскажу то о чем я умолчал что grail на самом деле не только графова я база данных и очень быстрый кэш которая и при этом еще помойка которая хранит себе вообще все для быстрого доступа это такой очень умный инструмент дико полинга потому что пока не было грело взаимодействие с инфра и губера выглядело примерно так то есть каждый пишет в каждого in free становится все очень все больше больше больше больше больше больше и вот так вот это вот левая картинка боль после появления горилла все стали писать в grail и если тебе что-то нужно ты такой так окей они публикуют вот это вот этот grail я иду читаю и у меня все хорошо то есть он снял grail снял очень головную боль с миграциями потому что как выглядит допустим миграции сейчас для нас вот недавно большая очень жирная технология приезжала она приехала сказала мы не можем выключаться и постепенно постепенно они просто начали там оборачивать свои binary в докер начали под ну как бы найти на они начали публиковать мету постепенно постепенно постепенно постепенно а потом в один момент мы просто так в конфиге тру на фолс ну falls in a true поменяли и все технология на родине она менеджер вся наша of the move the mission работает и все очень хорошо так вот зоан bardelli вторую технологию пришла третья технология 2018 год я тоже занбар гели и написали столько кода стока прям очень много причем очень много каста много кода там за знаете две технологии работают нормально примерно папа дженериков скиф нормально но вот когда приходит 3 там прям iv и мне рассказывали были что и в технология номер три делайни вот не как в первых двух случай делай как в третьем поняли что это вообще не работает и сделали фреймворк generic который называется уттер выдра почему потому что в на греческой мифологии был маг перевертыш норвежской мифологии здравствуйте был маг перевертыш который превращался выдру любил играть в воде и и его съел локи в конце и вот человек который выбирал название он решил что мак перевертыш которого съела бог обманщик это прекрасное название для фреймворка для generico баз данных ну и соответственно таким макаром это все пришел 2019 год когда там массово технологии начали он гордится и как бы платформа все съела вы видели цифры казалось бы нам нужно отдохнуть что-то пошло не так что пошло не так начал взрываться guide почему начал взорваться гепнер первую очередь из из dfs допустим или из-за других технологий у которых оказались очень google и жирные placement и жирные плане того что placement мог превышать там 3 мегабайта 4 мегабайта и так далее над этим долго долго долго думали и в итоге вот хранилища для placement информации поменяли на эти сидим до здраствуй кубер нить из нас здравствуйте сиди backend вот это все я уже идти сиди уже он бродил я у меня очень много более связанного с ним но это очень хорошая база данных не верьте что она может хранить только 8 гигов я проверял их на достаточно быстро и на самом деле это еще один прекрасный показатель проблема появилась мы и решили то есть почти до дожили до жили вот там да вода каких-то вашей космических цифр и только тогда начали что-то переписывать оптимизировать но пошел на начало взрыватся вот тоже забавная история где мы хотим от это 10 instance ну мы его хотим на себя то есть смотрите у нас есть платформа мы хотим базу данных которая хранит информацию о других базах данных в том числе я себе такой прикольный прикольное кольцо вот и давайте я напоследок покажу все таки такой общий арки 3 arquitectos слепок все платформы то есть у нас есть сила и у нас есть яичек я не стал его показывать то что внутренняя админка у нас есть какие-то рез сервисы у нас есть вот этот наш ский dollar есть какие-то специализированные бизнес сервиса и так далее есть наши зависимости зависимости публикуется в grail и и сам один ходит напрямую в grail есть особенно всегда есть как бы особенный ребенок в семье который напрямую допустим ходят в 10 ну что поделать и есть флот весь флот который на котором лежат binary 1а ну переписан из питона на и которые ходят на к нашим рез сервисом который свою очередь ходят в grail огрел очень быстро дает данные это все возвращается на холсты все чудесно все работает к сожалению время была очень ограничено я убрал 60 наверно процентов доклада там было были очень прикольной штуке допустим как мысе группы оптимизируем и или там colocation делаем несколько разных технологий если кому будет интересно подходите вам после доклада покажу полную версию что мы еще делаем идем ход менеджмент допустим я уже работы в команде которая занимается менеджером менеджером хостов то есть там провайдер приносит хост с раскатанным baby а нам и докером а дальше мы развлекаемся вот я в этой команде работаю у меня сейчас тимлид юра востриков которые участвовал разработки тарантула он там столько удивительных вещей делает прямо я я поражаюсь человеку занимаемся ресурс концам шинам то есть и группам цепью с этом вот тем тем чем юра занимается все еще он борде мы последние оставшиеся технологии то есть мы не занбар ним 100 процентам баз данных убера но львиную часть мы занбар дим чем проблемы лечением проблем и чине проблемы почему потому что когда у вас есть хасты чет ломается ломается всегда диски сыпется себе умирает память отваливается и ничего с этим не сделать ну и как бы я знаю что хост типа хост один у него должно быть 2 сепию 32 оперативки и все должно быть вот примерно в этом направлении поэтому я не не знаю своих аст и по именам я конечно вру у меня есть мой любимый стейджинг хост на котором я иногда чьи-нибудь от хок выполняю когда мне вот что-то надо сделать такое для разработки но это как бы оставим за кадром так вот о чем я хотел сегодня рассказать ну я вам показал как работают платформу которую следует баз данных выбери еще я хотел вам показать что платформу то по сути разработали была проблема я решили не заработала решили не заработала решили да конечно это потратили очень много средств очень много ресурсов очень часто разрабатывали просто из необходимости потому что ничего не было потому что я один раз разговаривал разговаривать стихли дом и он говорит ну и наверное сейчас мы стартовали этот проект мы бы вот следу лир не стали свою писать мы бы кубер взяли сначала а потом уже подумали что делать но когда это все стартовали этого всего не было и с этим пришлось что-то делать и наверно напоследок все любят war stories и две веселые истории грел изначально не назывался как гриву он назывался как украсить этого датский я все еще пытаюсь его освоить да да да это не я не поперхнулся я пытался это все выговорить это вот в датском дерево там знаний которую ныне в датском нордической мифологии это дерево знаний которая пронзает девять миров и так далее но некоторые наши западные коллеги испытывали проблемы с его произношением поэтому это оказалось крылом а второе как удалить данные первый раз в истории проекта в общем в силу специфики платформы наш вот этот binary он тоже работает в контейнере выкатывалась нового я верю версия контейнера и в нее поменяли в доке риббентропа гейша но это то как папочки sh100 обидеться внутри контейнера все поменяли раскатали на зону зона умерла хасты не сочится ничего не доступна данная удалена вдыхая стаут edge все горит в наш emergency членов с лайки прибегает стал стейкхолдеры такие уииииии у нас ничего не работает пятисотке и так далее начали разбираться там команды в дата-центрах через консольку воскрешали хасты откатывали их так далее и что выяснилось когда расскать или вот этот новую версию агента что произошло в докере 112 был баг что когда был выстроен bing пропадешь insert он на остановке выключение или на shadow не контейнеров удалял все волю мы которые к нему были как бы ну при бензин и о чем была проблема то что был еще другой баг что когда вызвался докером для агента другой баг вел к тому что все контейнеры на х на холсте останавливались и второй баг удалялся данные то есть ну как бы мы раскатываем новый агент вот как ты там складывается что у нас гасятся все контейнеры данные ушли причем там было достаточно веселая история что данный топ удалялись не со всех постов просто иногда внутри водяные джон там были за за бенджен и допустить эссе или еще что-то и то есть они удалялись быстрее чем волю мы других контейнеров поэтому хост умирал но данное остались более на месте это все о чем я хотел вам сегодня рассказать большое спасибо что пришли второй день конец спасибо ле-коро спасибо я надеюсь у вас он porting проходит не через то что вы новых инженеров вешаете на и грозили потому что именно так я шарю а меж тем и я вижу что у нас есть вопросы 1 доброе воров большое спасибо вам доклад и лично от меня я из компании нет крекер и у нас есть точно такая же система она решает ту же самую проблему и нам всегда все крутили у виска передовые конченые психи никому не нужна оказывается есть 2 поэтому давайте дружить нашли друг друга давайте дружить в одной псих-больнице значит у меня три вопроса сложные вопросы совсем простой совсем простой вот сейчас про говорит про базы данных очереди кафка rabbit той же самой системой да мы хотим кафку прекрасно посложнее в девелопменте вот по нашему опыту количество железа в девелопменте разве десять больше чем на продакшене это вот тема с крылом она девелоперские сервера тоже точно также обрабатывает а grail уже меч технология она уже сейчас не и викинги там внизу рессоре я имел ввиду вот вас же есть бил перски облака внутри и для них тоже нужно нарезать базы данных тоже через него слушайте я боюсь я не могу об этом разговаривать и зените очень следующий вопрос security когда нарезается база данных у нее есть креды как гарантируется что эти кведы будут доступны только тем кто владеет этими базами у нас сайт корр лежит сторонняя система который занимается каретами мы не владеем каретами этим занимается отдельная инжиниринга организацию они лежат зашифровано как ключа у меня нет у расшифровать их не могу как они подтягиваются в контейнер и я до конца ну то есть я примерно представляю через библиотеку но суть в том что у нас конфиге они с описаны вы для самих сервисов ям ли и там просто когда у тебя контейнер запускается там перед запуском runtime а этот конфиг искусственно расширяется ключами еще чем-то 8 я не могу посмотреть ключи это все расширяется фронтами это делается отдельными ребятами все я была спасибо и вопроса в другой стороны я вижу при всем этом безобразии остается возможность подключиться и зайти через тебе подключиться к майскую или это утрачен навсегда то конечно у нас смотрите у компании убер внутри свой network in layer именно с точки зрения гиннесса и да все прекрасно но если ты ну можно и находку напрямую подключиться чего сейчас все еще меньше становится но да мы публикуем там внутри внутри компании в dns адреса это обычный connectionstring и то есть вы на самом деле работа с базой с точки зрения обычного разработчика выглядит что он приходит на специальный внутренний портал же макает как наш магазин извинить великий русский могучий язык нажимает кнопочку и такой говорит я хочу мой сиквел и все он дальше даже не знает что он у нас создается ему я за два часа приходит к нам ринга и трудовой спросу если зима секу там падает регулярно и надо подключиться именно де баком туда может чисто через baby то есть во всей этой системе у инженеров которые отвечают за базу остается возможность зайти все-таки на этот холст и что-то разделать да да да то есть то есть дебаг есть да про два часа это была неправда это просто вот два часа из головы привет спасибо большое за доклад очень интересно было я подозреваю это было в расширенной версии но все же задам этот вопрос потому что мне это интересно что сетью то есть у вас там какой-то опер войны sdn и или вы как кубер пишите свои сетевые плагины у нас сетью отдельная сам организация занимается у нас между кнута есть хасты знают друг о друге у нас одном наша сетка на уровне внутрь мы оперируем сетка и на уровне h100 ну так у грубо говоря у нас там в бридже по-моему в докере все работает и сосет через бюджет до помучить бриджи а как тогда разграничивать безопасностью занимает а я вам сейчас расскажу подробно там очень большой рассказ окей спасибо подходите я вам расскажу ну ну я его и давая вам спасибо за вопрос спасибо если у нас не столь глобальные вопросы коллеги есть не вижу вот есть спасибо за доклад я может немножко пропустила можешь еще раз уточнить зачем вы используете папа женщин shirt вот да я не уверен что мы его уже используем знаешь когда это случилось ой извини то что над и знаете когда это случилось это случилось я вот вышел в марте выбор в прошлом году это случилось через 2 недели после того как я вышел и то есть меня вот оставили на моем ангар денги потому что вот это чинили я точно не помню но мы уже по моему это не используем спасибо то есть это был какой-то эксперимент"
}