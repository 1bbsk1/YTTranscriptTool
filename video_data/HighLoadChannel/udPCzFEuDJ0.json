{
  "video_id": "udPCzFEuDJ0",
  "channel": "HighLoadChannel",
  "title": "Эксплуатация cilium в кластерах VK / Михаил Петров (VK, Единое Облако)",
  "views": 1389,
  "duration": 2512,
  "published": "2024-10-29T03:07:39-07:00",
  "text": "Итак у нас плавно зал перет из тематики ML в платформенную и из платформы вообще в инфраструктуру и сейчас Михаил нам расскажет о том как крупные компании выбирают решение для опытной эксплуатации на примере Сим Михаил прошу Всем привет А меня зовут Михаил Как вы понимаете Я из VK из департамента единой Лобо технологии и Сегодня я расскажу про наш опыт эксплуатации цили ума в наших кластерах Итак А кто же я такой а путь в Linux я начал ССД отменил fre BCD в Мастер хасте и успел там по администрировать микросервис под названием qmail также я понял там джента в продакшене для интернет-магазина хостинга чем чем восхитил всех кто его администрирование в Яндексе я успел поработать над проектами N r.ru фо yandex.ru DNS yandex.ru обеспечил техническую сторону интеграции кинопоиска в продакшн Яндекса и развивал инфраструктуру для Яндекс браузера Влади это такой маркетплейс в Азии по типу амазона Я как раз таки познакомился с кубернетес и поднял там 12 кубекс в шести азиатских регионах под моим руководством вке мы запустили целый ряд кластеров куртис начав с департамента рекламы мы позднее расширились на почту и множе других отделов сегодня как я уже говорил я рассказываю о том как ше при выборе каких-то Рей какого-то софта для включения его в прокш контур но я хочу отметить что весь этот доклад не состоялся бы без помощи моих коллег поэтому большое вам спасибо мои коллеги я не буду рассказывать что такое Вики я абсолютно уверен вы все об этом знаете если вы не знаете такой крупнейший Холдинг в Рос нашей команде в ке много разных направлений одно из них - это развитие и поддержка облачных технологий У нас есть своё написанное облако One Cloud А также есть около тридцати различных кубернетес кластеров в проде на железе и сегодня речь будет о кубернетес история возникновения первого кубернетес кластера в нашей компании уходит в восемнадцатый год когда передо мной стала задача поднять кластер Для отдела рекламных технологий вот эти все баннеры вся реклама отке это всё они кубер у нас используется в основном для с нагрузки и машинного обучения как я уже упоминал раньше мы начали с отдела рекламы и Сейчас там около 500 нот в этом году образовался департамент единых облачных технологий под кратким названием енот его задача продвижение облачных технологий внутри вки сейчас давайте проведём небольшой опрос Скажите пожалуйста C провайдер У вас используется у кого используется лиу Ага а у кого Калика Ого а Роутер у кого-нибудь есть Окей я так понимаю все побеждает Калика хорошо Я думаю тогда ваш доклад будет мой доклад будет Вам полезен Итак это содержание моего доклада мы поговорим немного про историю CN VK захватим Калика перейдём к целям поговорим об его особенностях и перейдём к заключению Итак история Сина VK на момент начала эры кубес VK в восемнадцатом году из доступных широко известных Сина было пять л Калика роуте фл и viv а а кубер кластеров у нас не было и была задача выбрать cni plin чтобы стартануть стандартный сервер VK имеет менеджмент сеть который используется для управления сервером и виртуальный IP адрес который носится в Интернет с помощью протокола RIP адреса пришедшие на jer агрегирующие выше и распространяются на всю сеть в Икее Мы хотели чтобы IP адреса подов были доступны как внутри кластера так и снаружи из этого вытекало два трени C это умение работать с протоколом динамической маршрутизации и для минимизации Так мы исключили и в нашей компании К информационной безопасности относится очень серьёзно и Надо было сразу думать о применении NC для всего нашего для всех наших приложений так требо дополни поддержка nwork polic но когда не знаешь с чего выбирать Всегда можно посмотреть на Здо на гитхабе Это конечно шутка но ВС же не совсем активное развитие проекта и большое количество пользователей позволяет получать больше новых фич надеятся что баги будут исправлены быстрее и что проект не будет заброшен через год или два В итоге остановились на Калика изза более удобных сетевых политик показало что мы не ошиблись хоть поддержка bgp казалась необходимой составляющей для C в нашем кон но внезапно Выяснилось что в нашей топологии сети схема с bgp рефлектора для минимизации bgp сессии на стево оборудовани работать не будет а принимать bgp сессии из каждого сервера Севы инженеры не горели желанием пришлось выкручиваться Ире берда который там уже стоял Далее по протоколу RIP мы их анонсировали в сеть и всё адреса подов стали доступны во всей сети в ике За всё время эксплуатации Калика у нас было ноль проблем с вызванных неправильной работой самого калико проблемы возникали или на стыке или на технологии Калика из-за неправильного чтения документации и неполного соответствия деф окружению проду например одна из проблем которую мы долго разбирали - это проблема с НАТО из пода улетал пакет в сервис происходил на сервер отвечал обратного Ната на 2% трафика не происходило это третий шаг на этом слайде из-за этого пакет подом отбрасывая ошибок на проде наш системный инженер потратил очень много времени чтобы понять корень проблемы но в итоге всё решилось одним параметром си надо быстро получить сеть в кубе и особых требований к сена нету то Калика - Это хороший выбор как Вы наверняка знаете В бесплатной версии Калика нет поддержки в qdn фво поэтому наш коллега её написал мы пользуемся этим сервисом уже года два и не испытывали с ним никаких проблем но что же нас привело к лиу у нас стояла задача обединени нескольких кластеров рне в мы регулярно проводим учение по отказу Дант и хотели прийти к учениям по отказу всего кластера ку Бернеса то есть мы хотели сделать Delete All на одном из кластеров и пережить это без особого ущерба для пользователей но также стояла задача обеспечить наиболее узкий фво из возможных не с20 на с20 из одного кубера в другой А деплой в деплой в разных курах также нам нужно было более удобно способ делать т и тут на разработки сказал что есть один проект под названием который решит все наши проблемы первым позывы было сказать что лучший враг хорошего и остаться на Калика но Team Lit разработки предложил достаточно усилий чтобы мы на него стали смотреть в целом схема не изменилась заменили Сина из скалика на циу и появился кластер МШ про Лим кластер МШ Есть множество других докладов Я лишь кратко хочу сказать что это технология которая позволяет Лим узнать о запущенных подах в других кластерах ку Бернеса и роть фик другие кластера также с помощью технологии мы можем писать гранулярный nwk поси ВС во информационно безопасности Как вы думаете что тут не так Я запустил л чтобы посмотреть трафик найсе М2 и увидел что какой-то трафик есть кстати посмотрите как можно удобно смотреть за трафиком внутри кластера при использовани Лима Вы можете посмотреть весь раик найсе можете посмотреть только дрое пакеты може трафик от конкретного пода А с помощью веб морды можно увидеть всю сетевую карту сервиса на слайде видно что есть трафик NS pfm V2 Но если посмотреть ели там поды то их там нету мои первые мысли были что у меня проблемы с IP сервером или что у меня проблемы с hcd Но это всего лишь признак работы cum clh когда трафик виден во всех подключённых кластерах ку Бернеса и по сути дела эти поды были в другом кластере куром как я уже упоминал ранее мы пишем гранулярный Network полиси на каждый наш сервис и Network POL в Калика у нас на I tables что удобно но всё же вызывает задержки вносит задержки в скорость обработки трафика в почтовом кластере кубертен момент у нас около 1.000 сервисов и 21.000 сетевых политик и их количество заездом сервиса растёт Обратите внимание что график тут логарифмический ради интереса Я посчитал количество запи запис в выводе на СТ и на сте и получилось что если заменить на то у нас резко сокращается количество записи на сте 42000 до 120 Но что же не так с возможно спросите вы большое количество пра увеличи ипра для сервисов начинают дожать за заметное время у нас это около 25-30 секунд почти все операции это поскольку цепочки там организованы как связанный список в случае скалика путь пакета дода в льно упрощенном варианте выглядит так сначала пакет попадает на сетевой интерфейс потом в Далее в и провалится под систему проходя внутри множество для примера я вял один из подов нашего сервиса и посчитал сколько правил пакету приходится проходить перед тем как попасть в под и это то входящ трафик исходя трафик проходит примерно такой же путь А вот так выглядит путь трафика до пода в случае как вы видите пакет на Хосте просто не заходит под систему нефт что хорош вят на скорость на скорость доставки пакетов Так почему технологии пфт уменьшение н у наших приложений отсутствие прави И вообще отсут и отсутствие И вообще скла впечатление что через некоторое время нефт исчезнет из современного линуса кластер позволит гранулярной сетевые политики сервис позволит выкинуть и даже меньше чем инженеров хорошо понимающих куртис взаимная модификация полное шифрование трафика фво мечта нашей информационно безопасности Лим дают бесплатно то что в Калика стоит 700 долларов за ноду мы узнавали и даже встречались с ними и то после всего что сейчас случилось наверняка бы возникли сложности с оплатой Давайте поговорим о некоторых проблемах которые возникали с эксплуатацией циу проб с из самых последних это наме работа ци это фи котора они взяли у Калика поскольку это может быть удобно для разграничения трафика на сетевом оборудовании и управлением откуда может выходить трафик у определённых подов Да мы знаем про ино цили Но в ряде случаев мультипул ВС же удобнее особенно если учитывать что мы их широко применяем смх некоторые возникают из нашего лого из-за нашего сетевого стека в ДЦ но мы приобретаем опыт и питаем надежду что со временем их будет становиться меньше информации о проблемах цили ума не то чтобы много в русскоязычном интернете в зарубежном намного больше конечно но всё же есть например в статьях на хаб и в подкасте Link me up в любом случае после того как станет понятно что конкретно сломалось я вам Очень советую зайти э Wish в github лиу и поискать наверняка эта проблема уже где-то запор Сегодня я расскажу вам о двух проблемах в решении которых я принимал участие Почему я выбрал тему с ДНС ДНС кластерах курне пожалуй так же важно как и остальные коро компоненты самого ку Бернеса например в одном из наших кластеров около 140 запросов в секунду и недоступность ДНС вызывает про множест приложений нех с расскажу первая проблема - Это история СР ДНС и она начиналась очень просто коллеги принесли вывод стрейс со словами что их не устраивает скорость работы ДНС в нашем кластере и действительно Как видно на пятой шестой строчки За 2 с по секунд ДНС не ответил А потом на девятой строчке ответил получив Повторный запрос была примерно такая же проблема Как вы все знаете это оче сложно Я знаю минимум две больших компании где вместо использования ДНС им используются файл Как же можно ускорить ответ коса посмотреть что с сетью Возможно у вас наблюдаются ные потери пакетов посмотреть как дела у вышестоящих резол Веров возможно один из них перегружен посмотреть настройки кэширования возможно его вообще прочитать наниматель документаци никто не читал я вам Советую прочитать и внедрить No Local DNS а также вспомнить что мы находимся внутри C groups и возможно где-то уже горит алерты про троттлинг кора днса Выяснилось что некоторые поды с кор ДНС у нас троли и поэтому клиент получал тайм-ауты хорошо проблему нашли подняли лимит раскатились Но не все сервисы стали ловить тайм-ауты на попытку ризонс имн вопрос как увеличение лимита для Корс могло что-то сломать сейчас Глядя на Эту картинку я сразу понимаю в чём дело тогда же мы были очень удивлены нам было непонятно откуда взялись эти IP адреса Да и разработчик утверждал что использование скоро дн но проблема была не только в этом а в том что этих адресов в кубе у живых подов не было наший практике мы сталкивались с тем чтоп кубера бывает сносит голову и он перестаёт обновлять список IP адресов у эн поинтов либо ко Каширова намертво IP адреса подов Но это был не тот случай что же мы делаем когда нас проблема на продакшене откаты собираем постро диагностику пробуем воспроизвести наен тоже было известно до выгод ко с обновленными лимитами проблем не было версии ко DS на и проде были одинаковые но Выяснилось что на приложение которое испытывало проблемы попросту не было у большинства сервисов всё было хорошо на цитату проблемных сервисах наблюдались странные IP адреса ДНС откат кора ДНС проблему не решил Кох спокойно заниматься диагностикой после проведённой диагностики у нас на руках было два стреса первый - Это приложение у которого которое не испытывало проблем при перенаселение поведение другое опять создаём сот Бим на него А дальше происходит конект И в этот момент нам стало ясно что это паттен Connect Посмотрите на эти два коротких примера которые выполняют одну и ту же функцию отправляют D запрос и получают ответ на Верхнем примере программа не создаёт Connect D реверу а на Нижнем создаёт DP сокеты могут быть connected и unconnected если приложение знает что будет часто отправлять D запросы то обычный пате Это для увеличения скорости своей рабом структуре котора заполняется при создании коннекта на такое приложение Мы наткнулись в нашем контуре это оказалось не только сервис обхода интернета и индексов но вы вероятнее больше всего сталкивались с таким приложением как которо ВН проходит происходит именно через ко соке Но почему во время аварии в выводе на были странные IP адреса нам было понятно что вы что-то подменять сервисный адрес кора днса А И у нас было понимание что скорее всего творится магия pbf и мы обратились к документации как я уже упоминал ранее мы хотим отказаться от AP tables для Фае Вов и Cub Proxy и cum предоставляет такую возможность для этого надо включить опцию Cub Proxy replacement True cum будет использовать возможности pbf присоединяться к сокета и реагировать на определённые системные Вызовы Как стало ясно далее при вызове Connect и pbf программа загруженная в Express datapad будет вместо над трансляции подменять сервисный адрес адресом пода который находится под этим сервисом а При ответе будет отчисляться обратная трансляция мы выяснили что выбор к счастью уже были пользователи которые столкнулись с подобными проблемами это были пользователи и которым подобное поведение ломало интеграцию с ним убрать подобное поведение можно включив опцию Socket LB HN Only которая уберёт этот из xdp для подов в нем и перенесёт его в Traffic Control при старте ко DNS приложение с ского потно Повторный запрос уже прой а для уменьшения поте пакетов при рестар Core DNS мы поставили на каждую ноду noda Local DNS и чтобы их вообще исключить можем дрейнить ноду перед выходкой новой версии noda Local DNS Итого при включении Cop Pro replacement True включается механизм балансировки на уровне сокета некоторые приложения используют Connect to DP для ускорения своей работы лиу подменяет сервисный адрес на адрес пода при вызове Connect при передке приложения которому был DP Connect сот зависает в неопределённом состоянии чтобы отключить этот механизм без перехода на IP tables надо применить опцию Socket LB Host namespace Only True 18 октября этого года в Main cilium вмерзли функциональность решающую эту проблему принудительным удалением таких сокетов перейдём ко второй проблеме одной из приятных фич цим является в qdn Network policy Но в самом начале нашего знакомства мы собрали Некоторое количество проблем Они просто не работали в нашем Сета А у разработчика на локальной машине работали как обычно это и бывает вот политика которая работала локально и не работала на проде на девятой строчке мы разрешаем совершать запросы На пятьдесят третий порт по любому протоколу в запросе должно присутствовать слово gitlab а на шестнадцатой строчке мы разрешаем исходящий трафик на по 443 порту по протоколу tcp для подов у которых есть нужная нам метка и находящихся в определённом спейсе с подобными правилами можно во-первых не беспокоить что алаба сменится а во-вторых не будут Резо Хосты не попадающие под нужен нам паттерн что тся возможности атакующего диагностика показывала что циу не пропускает трафик по причине запрета трафика до этого IP адреса лаба на тот момент мы внедряли No Local DNS и с ним у нас были проблемы точнее сам работал А вот в приложениях внутри подов не происходил директа локального сервиса сервис который работает и локально и в кластере и в кластере используется которая наст и обычный подход с перехватом трафика через Как это сделано по умолчанию уже не подходил Local redirect policy и сервисы которые перехватывает перехваты должны быть одинаково именоваться порты но The Local D заработал но это тоже не помогло л показывал что фик до resol DNS разрешён и прерывается на этапе to Proxy то есть редирект на noal DNS происходил но далее что-то мешало тут надо немного отойти в сторону и рассказать как работать в qdn полиси в лиу при создании такой политики цим начинает перехватывать D трафик пода и складывает получившийся результат в свой кэш потом этот кэш используется при сопоставлении IP адреса и ДНС имени дальнейшие разбирательства показали что в кэше ДНС прокси Лима Нет записей Это была не первая проблема при внедрении Лима и вся ситуация вызывала фрустрацию наших инженеров кэш запи Раи в что нам ни о ЧМ особо не говорило сдам показал что не уходит с ноды Мы продолжали дебаф потому что думали что с ним что-то не так но ничего найти не могли но как часто это бывает пришло озарение что у нас не только но и и тут всё сложилось но нужен небольшой экскурс в истории развития фаерволе Коли прави и спустили на уров стов мы пожили его ноно всплывают проблема И это была одна из них наш сто блокировал локальный dsic D прок встроенный в цим добавили правила и всё заработало Итого при работе в net Poli складывает получившийся результат внутрь цили ума локальный Firewall может вмешиваться в работу лиу и это надо учитывать чтобы в qdn Network полисе заработали необходимо чтобы произошёл резолв через DNS Proxy иначе целью не сможет поставить в qdn IP адрес если внезапно в хост пода уже лежит нужный IP адрес или приложение Не резот hostname потому что он где-то захард кожен fqd Network poc работать не будут а теперь давайте Немного поговорим о сценариях отказа цели ума перед внедрением нового продукта мы проводим анализ сценариев отказа чтобы знать чего ожидать когда какой-то компонент выйдет из строя и это обязательно случится я вам гарантирую многие сценарии очевидны Я лишь расскажу о самых неочевидных с моей точки зрения сценариев я тут уже некоторое время Рассказываю что cum освобождает нас от IP tables но стоит упомянуть что cum использует IP tables у себя на произвольной ноде Я насчитал 38 вхождений со словом документация по использ почти нету но упоминается Что использу для того чтобы реализовывать недоста фна если это не реализовано в ядре и также использ при работе в бывает что при дебаг проблем Мы очищаем ние проле для тех кто прил Калика является естественным что Синай следит за своими правилами если их удалить то Калика их восстановит ам же просто забивает на эти правила и самый простой путь восстановления этих правил - это удаление с пода цим Агента основная Рабочая лошадка цели ума Агент Тут в основном всё ожидаемо Неверная конфигурация прове удаленные поды не будут убираться из балансировки на них трафика если нет каких-либо проверок на уровне ингрессо а также в некоторых релиза не работали метрики если использу fqdn L7 сетевой политики трафик перестаёт ходить из-за того что При таком паттерне использования включается в работу прое старген нам резко погасит весь трафик который проходил через него хотите от Добро пожаловать в Enterprise ума есть опция как и это поможет спокойно переживать рестар гента в большинстве случаев за исключением сервер при отка Ида из невозможности сри состояния на удаленной стороне про остальные части цима я рассказывать не буду поскольку сценарий их отказа очевидны с моей точки зрения важно не забыть что недоступность люм Агента сервера кластера ша может повлечь за собой отказ в обслуживани продуктового трафика и мы добрались за заключения ние сейчас мы собираемся перевозить один из сильных нагруженных кластеров на 900 нот скалика на циу разбивая его на три или больше кластеров и возможно через год мои коллеги или я расскажут как это происходило поскольку я уверен что у нас будет чрезвычайно много веселья в процессе этого переезда Что же выбрать вам Всё конечно зависит от задач и времени которое вы готовы потратить на изучение новых технологий и замечу их дебаг Калика хороший выбор если вам не надо каких-либо продвинутых фич и нужна просто удобная не ломающая сеть внезапно не ломающаяся сеть в разных местах при новых релиза и Если у вас есть деньги то у вас будет Почти такой же функционал как и есть вум Ну правда я опять-таки не знаю Берут ли они сейчас деньги из России Мы решили попробовать Лим по следующим причинам стеш чтобы объединить на кластера в один чтобы ускорить скорость ответа прохождения трафика до пода mtls и шифрование из коробки а также Нам нравится активное развитие и внедрение новых фич таких как gway IP Мы очень хотим попрощаться с ию hubble ди баевой политики стало намного проще fqdn и L7 Fair вола а также у нас есть умнейшие системные инженеры которые прекрасно разбираются в линуксе и сетевом стеке очарованные цель УМО разработчики которые готовы копаться в его коде и ресурс чтобы разбираться с его проблемами большое вам спасибо что вы сегодня все пришли готовы ответить на ваши вопрос Спасибо большое Миш за доклад очень интересно сразу куча рук Давайте начнём вот прямо с серединки дадада сюда раз раз раз слышно Привет Меня зовут Денис У меня вопрос по поводу сервис мыша да чем силиум вот просто те больше раскрыть эту тему Чем силиум лучше и как сеш я могу сказать чем ИО хуже тем что у нас его никто не любит потому что он слишком сложен и когда мы внедряли нашему высоко городовому инженеру понадобится примерно месяц полтора на его внедрение тогда второй вопрос исходящий видите ли вы какие-то последствия зна какие функции которые неп сист говоря про истио и цили мы не проводили такого сравнения поскольку мы вот попробовали ИО сеш он у нас заработал все коллеги сказали что это ужасно и мы решили попробовать но сасш в Мей об такими же функциями как и спасибо Следующий вопрос Вот давайте Со следующего ряда доброй вечер Спасибо за доклад короткий вопрос получили ли вы Профит по Н И если получили то насколько он оправдал ваши ожидания а вот у нас как раз вот эти сетевые политики которые я показывал там 21.000 это как раз кластер на 900 нот который мы собираемся перевозить и как раз мы сможем измерить нормально это спасибо в правой части зала есть вопросы нет тогда вот Давайте с первого со второго ряда Спасибо большое а подскажите пожалуйста вы переезжаете в кластера на цили уме через Аккуратнее кластера под Переводи туда трафик Как красиво у меня огромный план на полтора года на перевоз вот этого кубера вот большого и там мы поднимаем дополнительно кубер кластера а сначала небольшие там по 50 по 100 нот каждый кубер кластер потом включаем кластер ш а чтобы соединить потом сделались у нас сверху ещё трафик балансирует через который стоят на фронтах и там мы написали кубер DNS который позволяет резол сервис во всех курах а не только в одном но вы тоже есть в принципе но мы не очень любим и а и мы планируем потихонечку переливать трафик из старого кубера в новые кубера и план у меня на на полтора года переезда И это прямо пожалуйста ещё вопросы Вот давайте а с последнего ряда а пока можете отсканировать QR код для оценки прошу Да Благодарю я не очень в этом разбираюсь подскажите пожалуйста трудозатраты на конвертацию правил между старым и новым там понадобятся или нет Чего трудозатраты на конвертацию Network polic там каким-то образом а на самом деле мы уже об этом задумались и к счастью это Open и в интернете есть правила для конвертации итилиум политика в нативное кубернетес политики А у самого лиу есть это как бы возможность конвертировать нативное политики в целевом политики Я надеюсь наша разработка соединит этот подход и сделает нам хорошо спасибо Вот правой части появились вопросы давайте от колонны сначала а ты в начале рассказывал про то что вы записывали КДН полиси для Калика А можешь рассказать по детальнее что написывать именно Как это работает и главное Есть ли в орсе код А вот там была QR код я могу на него в принципе наверное перемотать Ну презентация на самом деле будет в общем доступе после завершения конференции и проставления оценок можно будет там его тоже посмотреть дополнительно но а вообще это демон который живёт в кластере кубера А вот он а сам Калика дописывать вообще не надо вот решение чем хорошо тем что Калик вообще трогать не надо а дописывается просто по сути дела вся магия происходит в селекторе DNS res а просто включаете В общем Ну плоте это софт пишете такую политику и всё работает Просто огонь плюс мы не только для ДНС это используем но ещ и у нас есть внутрен и там например можно делать фисты адресов несколько сетей взяли запихнули в префикс лист и мы написали ещё один Ну вот ну там можно будет почитать о чём это софт и по сути дела Мы можем сказать Вот селектор префикс лист равно имя префикс листа и у нас будет ну сетки прямо фво кали Спасибо вопрос из середины зала Здравствуйте спасибо за доклад у меня такой общий вопрос безопасность довольна После того как вы перешли на наша безопасность я бы сказал это очень довольна а потому что А например она хочет полностью ровать трафик между Ну между дата центрами между нодами а тлс везде А и она прям ну она прямо довольна во-первых во-вторых там есть тетрагон который в принципе можно внедрить и без цили ума Но всё же с тетрагон она её работат ещё лучше и Безопасность наоборот возникает огромнейший надежды на то что люм решит все их эти вопросы а по вашим оценкам о решит Я думаю он закроет множество вопросов да спасибо следующий вопрос я пока проверю Есть ли вопросы из онлайн трансляций Большое спасибо за доклад интересный опыт внедрения два вопроса Первый это по поводу как раз таки вот коллега спрашивал по поводу безопасности То есть я знаю то чтом из коробки по умолчанию не включается свани чере вот пробовали вы включать этого добра до него ещё мы не добрались Но вот доберёмся наверное буквально в ближайший месяц и и такой вопрос У Вас получается на ингресс а адреса Каким образом назначаются потому что я знаю то что а цили он поддерживает bgp Вот и также Metal LB пробовали ли вы оба решения и прямо сейчас у нас для ингрессо используется Metal LB А в цильме Да есть L2 анонсы вы их ещё не попробовали по большой по простой причине у нас трафик не заводится через ингресс на данно сейчас поскольку у нас в продакшене не знаю может стоять ферма из 500 хостов например там крутится Джинкс Ну который До которого доходит трафик после очистки после файлов и так далее а потом Джинкс идёт в ивой который стоит также локально на этом фронте А в инво прописан ДНС резольвер который смотрит в куберы мы по сути дела джинсе указываем локальный ивой в НВО прописываем хоней для а сервиса в кубе и у нас трафик так проваливается внутрь кубера у нас организован таким образом то что сам этот и Игрес он обладает этим пишним по сути пишним и всё у нас по сути вот у вас джунипер Да там стоит Ну у нас там кротик он также просто спокойно баланси о бы у нас это следующий шаг нашего развития поскольку вот у нас есть группа платформа вот единая технология наша мы как бы делаем решение но у нас же ещё полно leg полно других решений и нам надо думать и об этом поэтому сейчас мы пока делаем заводим трафик так но потом и сами как бы юниты та же почта именно хочет перейти на ингресс натив куровские и как бы да скорее все что-то такое будет Спасибо сечас вижу есть е один вопрос из зала и есть также вопрос из онлайна я зачитаю а как решаете проблему отсутствия активных хелс чеков к нпои при L3 балансировке при условии что пи может быть недоступен Есть риск падения эндпоинт в этот момент и биты и IP в балансировщик не обновятся А у нас на мастерах а cbap не доступен А никому а но он поднят локально а на мастерах У нас стоят а эн вои которые балансируют Ну балансируют запросы к мастеру А там уже есть халс чеки которые мы и проверяем Спасибо и наверное заключительный вопрос с первого ряда Спасибо за за доклад у меня такой вопрос не пробовали ли Вы включить ipf в калики вот если пробовали что получилось и возможно ли пользоваться им без ха а нет мы не пробовали включить ebpf в калики поскольку А мы подумали что фичи цили ума которые есть кроме и вбф как бы нас тянут больше в циу чем в Калика поэтому мы не стали просто пробовать Спасибо большое за вопросы А по времени наверное ещё один успеем если есть Супер Тогда Миш давай вспоминай все вопросы и реши кому нужно подарить подарок от нашего партнёра Газпромнефть мне понравился первый вопрос Спасибо коллеги из Вики хотели задать тоже вопросы но я сказал что я не буду говорить что они это Молодцы Ну мы тебя пока тоже не отпускаем вручаем подарок от всё того же партнёра Газпромнефть Спасибо тебе большое за то что поделился своим опытом с нами Приходите Рассказывайте как всё это будет ложиться на кластер из девяти стано от кажется да Будет очень интересно послушать Спасибо всем большое друзья"
}