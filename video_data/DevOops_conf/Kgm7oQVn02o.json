{
  "video_id": "Kgm7oQVn02o",
  "channel": "DevOops_conf",
  "title": "Любовь Гринкевич, Алексей Миртов — Безопасность в контейнерах",
  "views": 345,
  "duration": 3483,
  "published": "2022-07-06T04:09:43-07:00",
  "text": "добрый день меня зовут антон рынку с я представляю компанию дал технолоджис и сегодня мы представляем вам доклад а к безопасности в купер найти с окружении от спикеров из яндекс клауд любови гринкевича алексия vertu добро пожаловать на делюкс 2021 ребят привет всем привет да мы поговорим не только на самом деле к вернитесь и но еще и вообще контейнер нам стыке так что будет интересно да давай представим сама еще также меня зовут мир тов алексей я архитектор яны склад по направлению security любо тебе слово да лёша занимается больше общительный н тебя я занимаюсь больше внутри контейнером стеком я разработчик контейнера стояка занимаюсь много devops им и немножко общаясь с командой безопасности поэтому знаю что у нас происходит как где вовсе так их безопасности внутри отлично сначала вашего проекта внедрение его ваши компании не начали ли вас воспринимать как сотрудников безопасность говоришь как будто что-то страшное и ужасное ой не дай бог меня восприми как сотрудника безопасность ну это на самом деле зависит то очень сильно от компании как построен этом отношения с командой безопасности естественно у нас на самом деле есть очень классно инициатива называется security чемпионы когда в каждой команде выбираете тот человек который больше знает про безопасность больше общается с командой безопасности и стать таким промежуточным звеном связующим вот своей команде я security чемпион поэтому с одной стороны команда security знает кому обратиться что-то подсказать что у нас внутри происходит какие на в процесс и а согласно моей команды знает что она может прийти за советом не куда-то вот начать команда security а прямо вот с чеку соседним столом мы вообще у нас в принципе безопасников компании любят и уважают потому что они достаточно технически подкованные ребята не просто какие-то бумажные там генералы которые вот все запретить не знаю почему поэтому у нас с этим попроще отлично тогда давайте переходить к вашему наклон давайте начинай тогда итак мы поговорим про безопасно и развертывание контейнерных приложений и мы хотим разобрать какие есть проблемы безопасности на примере стандартного релизного процесса хочется поговорить не только какие проблемы как от них защищаться дома прям дымке посмотрим с примерами и поговорим вообще о том почему нельзя перед каким-то у тита просто раз и навсегда закрыть проблемы ну хотя бы на год до больше к ним не возвращаться почему безопасники постоянно приходят постоянно чего-то хотят постоянно требует каких-то изменений начнем и непосредственно с pipeline а и давайте посмотрим как у нас выглядит стандартный процесс релиза да у нас есть кот мы его собирают какие-то артефакты затем тестируем и надеюсь и разворачиваем production окружении если мы говорим про контент нст кто потом обычно собираем в докер образы шаг тестирование сейчас пропустим он не специфичен для контейнера стыка и дальше мы идем разворачивать это все в купер найти с кластер ну давайте посмотрим на эти шаги посмотрим какие у них могут быть проблемы безопасности наверное самое понятное что может быть когда у нас есть кот мы его написали как-то плохо скажем так и в нем есть строчки из-за которых его можно взломать уязвимости однако и дивизий месте могут быть не только в нашем коде но и в коде библиотек которые мы используем да за этим тоже нужно следить нужно знать какие библиотеки мы используем кроме того достаточно часто к сожалению проблема когда разработчик для удобства сначала рядом с кодом кладет какой-то секрет и зато затем случайно пушит его в репозитории он оказывается в открытом доступе это может быть пароль от базы какое-то токен оказаться вообще в интернете общедоступна это к сожалению часто история и обычно такое решается статическим анализом кода а теперь когда мы переходим к проблемам следующего уровня когда у нас появляется новый слой абстракции оказывается что проблемы остаются те же просто мы можем не знать какие инструменты для этого есть у нас есть докер файл который по сути собой представляет тоже какой-то код да это конфигурация но это тоже код который тоже можно тестировать потому что в нем может быть какие-то не совсем корректные строчки написаны из которых его можно взломать точно так же как и с библиотеками в кроме вашего кода непосредственно в образе есть еще какие-то утилиты или например целой операционной системы которая представляет себя огромное количество кода в котором тоже могут быть уязвимости и это нужно искать каким-то образом в вашем образе проверять и устранять если мы переходим на следующий этап и диплом повернитесь кластер то здесь у нас неизбежным образом оказывается что есть какие-то секреты которые нам нужно как-то за диплом и сделать это безопасно так чтобы у нас те кому не надо не получили к ним доступ конфигурация uber на диск кластеров тоже код который тоже может быть написано небезопасно в плане того что у него могут быть избыточные право мы можем случайных выдать как с отчислении перемещено в так с точки зрения сети и непосредственно между кодами тоже мы можем дать слишком много прав из-за чего нас будет легко взломать ну и наконец сама надо к маку вернитесь надо это можно считать су магическая коробочка с кучей кучей кода который тоже сможете держать уязвимости и мы поговорим о том что эта за магической коробочкой как с ней надо взаимодействовать чтобы у димости там не было или вы по крайне мере в не знали если мы ещё раз взглянем на эту pipeline то мы заметим такую вещь у нас уязвимости и какие-то проблемы безопасности могут быть практически в каждой строчке кода на каждом этапе на каждом слое нашего pipeline а и наши конфигурации и это отвечает на вопрос почему нельзя закрыть все проблемы один раз перед аудитом потому что каждый ваш коммент нужно проверять а если к каждой важным и нужно проверять лучше за дело все-таки не вручную а какими-то встроенными средствами то есть вся и встраивать защиту какие-то проверки в идеале еще добавлять проверки в runtime чтобы если все-таки вы прошли все слои и защиты но кто-то вас сломал вы это заметили и среагировали быстрее чем ваши пользователь например итак мы сейчас поговорим этих проблемах которые я перечислила поговорим по порядку и начнем с озимых компонент в докер образе вот они у нас на нашей схеме мы говорили про то что здесь нужно использовать сканер давайте поговорим как это сделать и мы рассмотрим а просто пример вот у нас есть разработчика оси и безопасника бася который будет взламывать потоси чтобы доказать есть что нужно встраивать проверки и так оси у нас запускает свой бит лап и начальники и дают задачу сайт сайт который показывает время гид лап естественно разворачивается в камерной this кластере где же еще и мы что можем сделать можем написать простой докер файл который будет у нас работа час буквально секундочку мы запустим замечательно и так мы создадим здесь стокер файл у нас будет какой-то образ который содержит apache server имидж мы туда положим также старту страницу яндекс html мы положим скрипт баш скрипт который будет выполнять основную работу ну и какие-то строчки запустим это все в игра узи на 80 порту все работает замечательно давайте посмотрим что у нас внутри до что у нас за страничка такая ну вот у нас есть яндекс html мы не стали разбираться как работает время в html просто все передаем ваш скрипт баш скрипт ну понятно показывает время что нормально может умеет давайте теперь это за диплом в uber найти с кластере мы можем это сделать с помощью deployment а у нас будет наш контейнер разворачиваться в х100 вай сити на 80 порту таким образом просто на адресе надым и получим уже развернутый сайт ну здесь еще небольшой хак с тем как поставить нужный образ свежесобранный вашим битла всей мы будем собирать два образа это будет как вспомогательный образ который нужен для следующего шага тепло и так и основной наш образ который будет тепло и цам ну вот на втором шаге мы подключимся к сервису метаданных как я говорила у нас нет лапа развёрнут в кабинете с кластер а значит можем подключиться к сервису метаданных у агента узнать его кредо целое с помощью них за тепло и наш новый а новой конфигурации то здесь получается удобном и никакие секреты не pdm связа подключаемся напрямую ну и здесь как раз происходит магия с тем чтобы поменять так у нашей версии можем посмотреть на наш paypal вот у нас два шага билд и диплом можно перед спустить тепло и чтобы у нас развернулась новое окружение и давайте перейдем на ноду посмотрим как у нее работает но действительно вот наша базовая страничка если мы переходим по ссылке у нас показывается время паре freshly все работает тася показывает это боси боси пытается это взломать так бася выполняет довольно за мудреную команду и мы чуть позже разберем более подробно что оно означает но сейчас важно то что мы обращаемся напрямую к серверу снаружи то есть мы никуда внутрь здесь не захотели мы просто снаружи обращаемся к серверу однако в user-agent мы передаем довольно странное какое-то широкое выражение в котором как будто бы идет изменение странице индекс html нашей основной странице ну куру у нас это все значит выполнил давайте посмотрим как оно отобразится дальше мы наша основная страница с временем оно не поменялось но мы помнишь у меня ли index.htm и для васи и от рефрешером опана а у нас здесь новая надпись что произошло как бася взломал это все давайте как раз здесь добавим сканирование и посмотрим что из этого выйдет насмешек и с которым мы добавляем еще один степ это будет сканирование у нас будет после сборки мы будем отправлять наши образы в некоторых катер для тепло и в целом здесь прошу прощения для проверки в целом здесь не принципиально какой именно сканер вы используете я для удобства используя сканеры индекс облак потому что я здесь работаю и знаю как он работает но можно использовать любой сейчас мы обратно вернемся к видео которая решила перри мотаться ничего страшного мы ничего важно не пропустим и так вот мы отправляем на сканирование сам скрипт сканирования зависит уже не обязательно того как сканер который вы используете здесь мы и будем проверять что если у нас есть уязвимости х или критику severity там этот останавливаем тепло давайте посмотрим на наш pipeline как он поменялся у нас появился еще один степ который упал мы отсканировали два образа это был наш промежуточной который тоже вообще говоря полезно сканировать не только то что мы диплом но это что помогает нам деплоить а в нашем основном есть уязвимость высокая из-за которой мы остановили диплом это uzi масть который здесь что-то написано про переменное окружение оно называется shellshock в чем оно заключается оно в этой весь башен когда у нас баш не только читает переменное окружение но и исполняет их таким образом мы в curry передали на исполнение команда vape сервер apache server принял все что ему сказал карл том числе user-agent естественно я передал это делегировал исполнении bашу баш вместо того чтобы только прочитать user-agent а зачем ты ещё и выполнил его тем самым мы оказались внутри контейнера и смогли делать практически все что нам угодно здесь ошибка в том что мы использовали баш очень старой версии в современном нового маша конечно эту землю же исправлено и и поэтому наверное первое что мы можем сделать это обновить наш барж и таким образом защититься от уязвимости давайте посмотрим как это будет происходить мы можем создать еще один горшок west в котором в на штекер файл добавить простую команду апдейт однако надо подумать в этот момент а собственно почему у нас в образе был старый баш а что в этом образе еще такого старого что там ещё есть и поэтому команда апдейт она не идеальна в том плане что не всегда спасает от вас это всего но давайте посмотрим как она отработала у нас сканирование прошло и мы видим что use вместе стало существенно меньше поэтому тепло и пошел дальше но все-таки надо помнить что мы взяли наш образ apache раз просто вот ниоткуда мы посмотрели в наш реестр образов он красивый образ то называется apache там есть а почти работает отлично и в общем случае это может работать плохо потому что вам нужно знать что находится в базами в образе вы должны доверять ему и конечно зачастую мы доверяем образом истоки хаба ну потому что мы надеемся на то что вот есть мы напишем chrome ubuntu то вон то такая большая компания которая постоянно регулярно обновляет свои образы которых наверное уж нет уязвимости компания прямо себя в 2020 году провела исследование и выяснилось что в 4 миллионах образов которые публично суп на таких как есть половина образом который содержит крики и сюзи масти и это прямо пугающая статистика потому что ну а кому мне тогда доверять здесь наверное ответ такой доверять никому нельзя печально но везде есть видимости потому что операционная система особенно содержит много кода много компонент и к счастью у нас постоянно в мире работать люди которые исследуют эти утилиты на висимости может быть даже некоторые находит раньше чем хакер что же тогда делать ну для того чтобы избавиться от уязвимостей недостаточно постоянно обновлять образы нам надо просто знать о том какие узи масти есть и если мы знаем то тогда мы можем уже соответственно с этим работать до того чтобы знать нам нужно сканировать докер-образ а на самом деле для этого просто масса инструментов который вы можете как скачать себе как например aqua security который вы скачиваете запускаете локаль разумеется источники узи масти у него внешне он их подкачивает но в целом вся работа происходит у вас локально так и - решения когда например прямо в докер клика как дела с ней когда он поделился с докер плева может запустить до кирмаш скан и он вам покажет уязвимости которая есть в многих облачных провайдеров есть сканер уязвимости которые вам показывают что у вас развернута в продакшене вы можете по сканировать свои образы таким образом мы поняли прообразы то что надо все-таки аккуратно выбирать базовые надо своевременно обновлять пакет и потому что все-таки это чинит большей частью зима sti для того чтобы знать какие они есть нужно сканировать образы как вспомогательные так и основные мы говорили также про то что наш daggerfall это само по себе конфигурация и мы хотим ее как-то тестировать в зависимости от каких-то политика нашей компании здесь могут быть связаны и политики вопрос а какой инструмент использовать самом деле инструментов может быть много мы сейчас рассмотрим на примере up in полисе джента как это может выглядеть опыт policy gent это такой почти универсальный инструмент который позволяет создавать политики с помощью языка олега и он работает не только над докер файлами например еще на таро форумом и мы чуть позже увидим что можно его и fuck убирать из кластер применять конечно язык как в любой универсальный язык может быть иногда спорной иногда не очень удобно на далекой случаев он действительно удобно и вы можете посмотреть как написать политик который по имени майк вашей компании у него также есть клей чтобы запускать этот проверки ну и давайте запустим дымку посмотрим как мы можем в нашем случае по тестировать наши докер файлы наши два докер файла мы создаем еще один ваш цикл с которым добавляем шаг сканирование прошу прощения шаг тестирования докер файлов у нас здесь будет 2 политики 1 будет называться политикой latest когда мы хотим посмотреть что в какой у нас базы в образ используются и здесь мы смотрим на команду frome и проверяем что после : есть ток и этот ток келий тест зачем нам это нужно делать почему мы так не любим именно ли тест на самом деле мы не любим все мутабельные теги потому что в этом случае сборка становится не повторяемый вы запуская снова и снова будете получать разные результаты потому что подло и даст и кому же может храниться новый образ lithos это наиболее частый пример использования такого типа которые используются по дефолту если вы просто забыли поставить его в идеале использовать какие-то осмысленные имена какие-то номера версии хэш якобитов например или другие конечно идеальное всего использовать хэш прямо значит образа доки предоставляет такую возможность но признаем что это просто нечитаемое в итоге этим мало кто пользуется потому что сложно отличить одну версию другой понять какая раньше какая позже алый даст ну совсем не удобен со всего использовать неправильно кроме того мы можем добавить другую политику которая будет проверять команды upgrade это может быть немножко странно мы только что сказали что нас команда грей такая полезна она избавила нас от кучу easy мастеру сказать что надо обновлять пакеты но встает вопрос а на каком уровне надо обновлять пакеты может быть надо обновлять пакеты в базовом образе в основных образах уже использовать результаты базового и в этом случае нам нужно проверить что мы это используем последний базы в образ а для этого нам нужно очень немного запретить команду апгрейт на нижнем уровне я согласна с тем что это спорный мы можем обсудить потом насколько это удобно и не удобно использовать но это пример такого такой политики мы здесь отправляем команду ран проявляем что в ней нет команды стал crate of the great и так далее замечательно давайте теперь посмотрим как это вписывается в наш чай мы это можем добавить в шаг уже перед сборкой нам не нужно для этого собирать образа здесь у нас будет запуск код в теста при этом мы можем на нашем основном докер файле использовать обе политики потом мы хотим проверять прямо-таки все на нашем вспомогательного брали запускает например только по риску ли ты считаешь что ну обгореть пускай там будет это все таки помогать и льный у него критерий проверки ниже ну действительно спадает на первом шаге мы уже знаем почему мы там использовали команду upgrade и нам об этом сообщает приписывая всю полную команду апгрейт для того чтобы понять в каком месте мы ошиблись таким образом мы посмотрели на то как можем проверки безопасности вне треть всей мы посмотрели на скане разве масти вы посмотрели на конфигурацию докер файла но это было все сделано внутри кого этих кластеров которого мы совершили несколько ошибок в первую очередь мы запустили наш из но контейнер как я сказал в х 108 непосредственно на воде мы разрешили доступ к сервису метаданных кластера для того чтобы кредит шила использовать прямо изнутри агента и мы право у сервисного каунта очевидно вам рынок сделали расширен и потому что мы не просто разрешили скачивать образы но мы разрешили ему деплоить новую конфигурацию да он запускает покупателя плай что очевидно означает что него достаточно широкие права и с точки зрения именно конфигурации каберне tissot это плохо и дальше я передаю слово лёша чтобы он рассказал собственно а какие проблемы безопасности у нас на этом этапе есть да спасибо люба рассказала больше про контейнеры про pipeline я же расскажу больше про каберне this это как вы знаете отдельный мир который требует отдельной дискуссии и начну я с самого сердца такой берете секреты я думаю большинство знает что комбинате секреты призваны для того чтобы хранить от объекта к вы вернетесь и которые признаны для того чтобы хранить какие-либо приватные данные там ключи и пароли и так далее но с ним есть ряд проблем в частности это не безопасная доставка их в рамках pipeline а потому что в яму манифестах объекты секрет хранят секреты в боишься 4 кодировки что по сути plain text кто-то решает эту проблема тем что дает полный доступ к собственно к секретам namespace разработчикам в таком случае разработчик получает доступ ко всем секретам этого на экспрессе и плюс он оставляет какие-то дополнительной ручной операции со стороны разработчиков что тоже не есть хорошо и так же тяжело следить за событиями вокруг секретов потому что будем честны стандартной аудит логику убирается это боль для тех кто не подготовлен только начиная с ними работать собственно для того чтобы решать эти проблемы секретов существует класс продуктов секрет менеджер продукта безопасности и он решает проблемы безопасной доставки выступает единым хранилищем секретов и также там можно защиту от удаления включать versio не рование как правило и централизованный аудит с легким просмотром событий какие вообще бывают секрет менеджеры есть как бы так называем отдельные секрет менеджеры это наиболее популярная хэш корпус и собирал кандур по моему опыту есть встроенные хит менеджеры в облака которые представлены на слайде в прошлом интеграция вот секрет менеджеров с губернатором была вот такая на самом деле сейчас многие используют такую интеграцию здесь на слайде представлена вот схема крышкой пункт продукта там с интеграции с кабинете сам с помощью сайт core контейнера собственно дополнительный контейнер который цепляется к вашему и он доставляя таким образом секреты здесь есть ряд трудностей достаточно такая непростая конфигурация и поэтому вот есть новые два подхода относительно новые с ними можно ознакомиться вот например в официальном блоге кабинет из там есть статья которая является реакцией на документ хардин гайд который вы всего на секс с и собственно убирать из сообщества там отреагировала этот харди лингой там рассказал что хорошо что плохо в нем и вот именно в части секретов тут как бы рекомендуется два подхода либо external секрет провайдер либо сие сайт секрет стар и для тех для кого это неизвестная вещь и давайте немножко обсудим эти два подхода первый подход секрет starseries adriver здесь по сути монтируются секреты как валиум с помощью контейнер сторож интерфейса это разработка убираетесь x для тех кто не знает это как команда внутри куда эти сообщества которые занимаются безопасностью из минусов этого подхода некоторые важные фичи находятся в альфа режиме пока что и это может являться некоторые проблемы для тех кто любит стабильность и надежность ну так вкратце выглядит эта схема там можно по детальной отдельно сейчас не будем детально останавливаться на ней и второй подход и the external секрет в этом случае у нас используется кабинете с оператор который монтирует как бы секреты секрет менеджера в нативный объекты секрет кубер найди со это разработали изначально голди контейнер solutions и поддерживается тоже множество секрет менеджеров там я выясню джесси пьяных склад в том числе и вот так примерно выглядит эта схема то собственно берутся секреты сик из менеджера и доставляются в namespace и я подготовил дыму короткая на тему external секрет как это выглядит вот на примере доставки секретов два разных namespace а если вкратце мы создаем сначала один namespace потом второй назовем их там асей бася в честь персонажей и их которыми может познакомились в первой части доклада соответственно выйти довольно space а нам нужно доставить секреты секреты мы уже при созда ли у нас есть секрет вот бася про спорт который должен отправиться на с просьбой си и секрет осипа сорт который должен настроиться соответствием space после того как мы убедились это создали мы должны поместить создать сервисные аккаунта и на уровне облака под каждым space и поместить вот эти вот исходные коды учился в соответствующей namespaces после чего поздно установить с помощью hell ноты кастрировал секрет оператор и собственно далее создаются вот эти абстрактный объект это секрет 100 роберт который по сути говорит сходи в этот секрет менеджер под вот этими видами и смонтируй к тому соответствующие секреты а секреты прописываются уже в другом абстрактном объекте который одевается их строил секрет и там указывается оддиш них секрета соответствующего если есть право в этого этого как бы не смей сюда в этого аккаунта он получит от секрет как в частности вот секретом ася password но если мы попробуем например namespace ася вот под этими под его каретами сходить в секрет базе и смонтировать его то мы увидим что у нас ничего не получится он пишет что секрет not found смотрим описание объекта видим что у нас sing error делаем descried и видим что у нас перемешивает то есть это в этот мир sprees секрет другого на 1 прессы поместить не удалось продолжая тему секретов есть сиди база данных кубер на эти сюда я думаю все это прекрасно знают в ней хранятся секреты и по умолчанию они хранятся в незашифрованном виде то есть если злоумышленник попал на мастерхост или сам получил решенный backup то он увидит секреты первозданном виде грубо говоря из может и хочет если же включить шифрование ведь иди секретов то он увидит и соответственно иероглифы что поможет вам защититься от этой угрозы к счастью для тех кто вот в облаках шифрования включается там буквально на галочку это мой сын из claude неважно где если же вы не и в облаке поверните фирмы apple там то это делается чуть посложнее там создается пароль секрет там шифруется все на нем есть некоторые трудности с и ещё одна особенность с использованием секрет метров в принципе например вот уходишь и careful есть я думаю тех кто использовал его в курсе есть такая особенность то есть на 5 перезагрузить сервер шкур пол то потребуется провести некоторые ручные манипуляции для того чтобы снова заработал по сути провести процесс он сил это некоторое получение мастер-ключа и вот в облаках эту проблему решают тем что делают образ хочу карт болта интегрированного скм с кем менеджмент сервисов до криптографическим облачным и таким образом работает автон сил и вот эта вот ручную операцию никакую проводить не требуется облака делает за вас переходим к следующей теме это избыточные права и сетевые доступ и какие с этим есть проблемы у нас могут быть избыточные права во первых на уровне сервисного аккаунта облака потому что часто требуется облачный сервис аккаунт назначить на группу узлов например чтобы они могли сходить в контейнеры с 3 облачный и есть также проблема избыточности возможны с назначением избыточных прав для кудри найти сервисного аккаунта уже непосредственно который внутри кубера мы это сейчас подробно рассмотрим и есть еще проблема избыточных сетевых доступов например к сервисам метаданных как раз тот сервис который в облаке хранить там саша ключи например какие-то токио на сервисного аккаунта и там на пирсе вы доступа другие поданные в space интернет и я сейчас покажу вам пример как злоумышленник может с помощью димости в контейнере попасть кудрин отец и за счет некоторые избыточности провести зловредные операции у нас есть развернутый класс term and service pack обретешь в облаке есть наша зло ночник бася который в первой части доклада тоже вредил всем и мы диплом тоже то же самое приложение которую обсуждали в первой части та же самая зримость тоже shell shock достаточно древние но наглядно и вот мы за тепло или это приложение получили айпи адрес внешний и в левом окне мы открываем на компьютере злоумышленника мидхат порт откатом порт 1337 и в правом окне мы пошлём команду которая как раз таки вот так называемая магическая команда на самом деле взаимности щелчок которая говорит по сути подключись на мой зловредный хост я тебя там ждут групп говорили о совершил и мы оказываемся внутри контейнера и мы можем обратиться к сервису метаданных потому что нам ничто не запрещает это делать и получить как раз вот этот токен сервисного аккаунта облачного которой привязана группа узлов и далее с помощью этого токена мы а вернее наш злоумышленник создает виртуальную машину крипто майнер да например для целей там крипто задач популярных да он может вот с помощью эту токио создать в нём лук виртуальную машину а который возможно вы даже не узнаете если там у вас не настроена светящими это ринге там появление новых положительных машин и вот мы видим что в облаке там эта виртуалка появилась и все у него получилось еще раз что произошло сейчас то есть у нас злоумышленник извне попал внутрь контейнера из-за того что внутри контейнера было уязвимость узел мой образ судимостью и собственно он попал в этот контейнер и так как на уровне ноды губернатор был назначен сервис на аккаунт с избыточными правами он смог создать еще виртуальному как от этого вообще можно было бы защититься например можно было бы как минимум создать натур полисе на уровне каберне tissot которая запретила дефолт иной запретит весь трафик собственно говоря исходящий и таким образом вы попробуйте еще раз espada обратиться к сервисам это данных и парвати что у вас ничего не получается ну естественно при этом нужно написать как конкретные правила разрешающие для правильного трафик и так же посмотрим на право сервисного аккаунты который был назначен на группу узлов действительно видим что админ хотя достаточно вполне достаточно было бы назначить контейнер индустрии мышь spooler и тогда бы этой проблемы было меньше на самом деле вы можете подумать что какой-то абстрактный пример но к сожалению я сталкивался с тем что это не к сожалению не абстрактный пример вот и следующий следующий даем и которая покажу это будет побегать контейнера почему потому что всегда на слуху вот этого фраза побег из контейнера контейнер escape многие не знают что это такое и почему это страшно вообще ну давайте просто посмотрим на это и после этого я расскажу как от этого вообще можно защититься мы находимся вот внутри этого же самого контейнера нас пока оттуда как никто не выгнал можем посмотреть api адрес можем смотреть host name контейнера и далее мы провернем такой трюк мы установим клуб сидел внутри этого контейнера так тоже можно сделать и сделаем это для того чтобы проверить права именно кабинете сервисного аккаунты который назначен на под например дефолта и в данном случае мы видим что этому сервисному аккаунта назначена довольно широкие права которые как минимум позволяют нам создавать коды новые и мы этим воспользуемся и прямо изнутри этого разу зеленого контейнера создадим привилегированный под которые привели ровный потому что у него хост петру контекст security котекс привлечь true и это означает что контейнер будет иметь доступ к процессам к убираетесь но до того worker ноды и потом мы в него провалимся и мы видим что мы оказываемся уже на самом деле внутри контейнера но и внутри ноды то есть мы по факту вышли за пределы контейнера и оказались как бы накоплен здесь ноги мы можем выполнить на пир команду докер ps минуса увидеть служебные под и можем в них провалиться с помощью докера можем поставить трафик там например попробовать какие-то горизонтальные перемещения по сети можем посмотреть секреты которые на плодах там назначены ну и различные вот там деструктивные действия совершать а переходим к стадии вот защиты как вообще от этого всего можно защититься есть такой такое решение силу селим синай сетевой плагин тиллю которые там на базе и бпф работает технологии и собственно он позволяет нам писать расширенные сетевые политики там на уровне а-7 там с именами и так далее и так же он имеет еще строить карту сети текущих взаимодействий и на основе этой карты можно потом строить во-первых сетевое политики а во-вторых можно например смотреть аномальное поведение и мы видим что там текущей контейнер там по кому-то подарить на у порту 1337 подключался куда-то вовне что должно нас как-то насторожить может быть и вообще это дает нам как бы вот то самое популярное слово обсе рабби лети которые сейчас используют да то есть понимание того что происходит вообще у вас в кластере потому что без понимания очень тяжело выставить защиту серебряной пилюли как бы не существует серебряной пули точнее следующая тема это вот избыточные права именно самого кода на то что мы как раз и эксплуатировали в предыдущем дымом когда мы говорим там про избыточные право потом и не можем искать про аудит логику берна tissot и вот и можно разделить а в итоге появляется на две составляющие то админ activity аудит logs и дата аудит logs вот админ activity аудит логе это theologie которые именно работы с api облака например там через ей или через трав он там например создан кластер там заменён кластер какие-то действия с нодами дата аудит логе это именно логе которые встроены в убираете эти вот когда-то мы создаем плод он пишет об этом откуда кто создал под с какого ip адрес там когда и так далее и но это речь идет именно об облачной оставлять явно пытался нарисовать схему вот как как вообще это устроено в облаке для понимания людям которые хотят начать анализируйте водить логику блин эти со и вот вы видите что снизу здесь админ activity on get лагеря с api облачного сверху дата аудит logis ужас кубрина эти sape и как правило вот в популярных облаках многих эти события отгружаются в клауд аудит систему какой у какого-то облака вклад logging систему это не важно в любом случае из вот этих вот систем дальше вы можете экспортировать эти лаги уже в с3 например отдых сторож или в какой-либо стрим data stream и дальше уже из одного из этих источников экспортировать дальше их вот в систему анализа логов например там дата dogs планк elastic org site не важно что вы используете что вам привычнее и дании вот дата в диалоге этот именно вот эти в диалоге которых в каменотес пишет в своем в своей документации да там хорошо известны и они себя присылают просто джейсон по сути файлик в котором есть полезна информация и есть также еще такой продукт фольку который уже более интеллектуальный он по сути сидит между но дай и контейнером и смотрят все взаимодействия между ними имеет определенные правила которые можно кастомизировать на самом деле которые вот могут дать там различных шел там в контейнер этом си скалу и так далее и вот этими али его как бы срабатыванию и тоже нужно работать и они даже сделали отдельный продукт фольку сайдкик который позволяет отгружать эти события во внешней системы облик сторож так далее и есть еще движки политик policy engine который для того чтобы чтобы вы могли как бы писать политики чтобы на 1 пишите политику я вот хочу чтобы все коды имели лейбл и тогда или все плоды могли там только вот таких контекстах создаваться вот и движок политик за вас как бы это отслеживает есть там и встроенный движки политика там который уже deep реке этот порт security policy на замену им там портят мишин контроллер который более там удобный и гибкий есть еще внешней там популярны это убедит кипер и кивер ну и вот эти вот срабатывание их тоже нужно анализировать и там тоже есть отдельное решение там пались reporter например руки верного который позволяет их анализировать и а к чему я всё это вел что из команды разработали вот решение которое поможет принципе людям вот анализирует все эти события изначально она в принципе для time and service for ластик search для нашего менеджера кубер на тельство облаке на самом деле можно использовать эти наработки и для просто бесплатного elastic сердца и там даже берем этом кабинете со вот но по дефолту это решение она устанавливает и фольку и танки верную и отгружает все удет логе в пластик и власть и разгружает даже там преднастроенные правило реагирования даже горды там вы можете пойти посмотреть на гитхабе решение погружали к чему я все это рассказывал к тому что по результатам атаки которые я провел там до этого плов вот этого решения буду такой чтоб фольку нашел бы обнаружил бы запуск завершила во-первых так мы попали в наш под обнаружил бы запуск зеленого контейнера все это отобразил бы в событиях на первый ластик надо же бардак там на pipe чартах там не важно вообще вы бы об этом узнали открывали бы себе alert и также и полисе джину поругался что какой-то там привилегированный контейнер создается тоже бы это все увидели если валютами смотреть что это выглядело бы примерно так там у вас есть там дашборд в котором вы можете там отфильтровать там по кластера иди и клауд айди и там выбрать из танка можно даже крикнуть на кластеры перейти в консоль и сразу там посмотреть проанализировать там не происходит и там тоже можно посмотреть по карте откуда там шло подключение чтобы это под создать например кто-то назначал админские права на namespace какие имидже были из не доверенного источника там какие действия положительные 40 политиками и там какие-то экзо контейнер все это можно смотреть анализировать из стандартных аудит логов каберне odessa также можно вот отдельно выводить seven дашборд volkova срабатывания там и срабатывания каверна самом деле по вот этой части у меня все и я хочу передать дальше слова любо тебе обратно чтобы уже завершить наш доклад до поговорив действительно таких сложных вещах повернитесь и хочется напомнить что вообще говоря кубер нить из надо это не как я сказала в самом начале магическая коробочка с кучей года эта конкретная виртуальная машина если говорить точнее то эта машина с докер контейнерами и каким-то еще дополнительным кодом в которых тоже могут быть уязвимости и это все та же нужно обновлять если вы используете собственное решение то обновлять он нужно не только ноды но и мастера если вы используете провайдера здесь конечно попроще потому что вы можете использовать его во первых инструменты для обновления во вторых ответственности за обновление мастер остается на нем однако надо помнить что такие удобные бы инструменты для обновления он не предоставлял они не всегда будут включены у вас например на продакшен кластере потому что обновление вашего самого большого самого главного повернитесь кластер это такое опасное действие вы можете бояться что новая que dar нить из версия не будет совместима с каким-то причинам с вашим кодом хотите это сначала проверить на каких-то стейджинг надо и запускать будете вручную и в этом случае необходимо про это помнить необходимо у себя поставить напоминание качестве кого она не может работать внезапно опять же сканер который вы можете натравить не только на docker образы но и на виртуальные машины некоторые из камеры такое умеют например тот же кладет который мы упоминали ранее для докер образов умеет склонить и виртуальные машины тоже важно в любом случае про это помнить относиться не как к магической коробочке а как конкретным сервером и обновлять их ну впрочем обновлять нужны не только кубер на тесноты но и все остальное например если мы в начале рассматривать girl up with лап тоже нужно обновлять мы таким образом рассмотрели разные способы защиты как встроенный вся и так встроенные в альтинг к сожалению это не защищает вас на 100 процентов до мы здесь на самом деле не рассмотрели множество аспектов и никогда не смотрим полностью мы можем только подсветить какие-то моменты лучше всего то что мы говорили сам начали говорить с вашей командой безопасности да не бояться ее они зачастую люди которые технически подкованные и знают не только что у вас находится в вашем кластере но и какая модель угроз на ваш сервер знает какие наиболее чувствительные для вас могут быть атаки и сейчас мы рассмотрели модель угроз основанную на релизом pipeline и мы здесь совершенно не касались например авторизации ddos-атак сертификатов ничего такого это один из взгляд на вещей и на вещи которые мы рассмотрели встраивайте статические проверки вся и это действительно очень удобно потому что проверяет буквально каждую строчку кода и выявляет некоторые ошибки уже на этапе мир сиквеста вы строили эти проверки замечательно вы все равно не защищены до конца добавьте alert и на какие-то подозрительные действия поверьте это защиты вас не только от злоумышленника ну например от стажёра который случайно перепутал продакшен кластер со стайлингом и собирается его удалить такие ошибки совершают не только стажера к сожалению alert иностранные действие топ очень полезная вещь и есть люди которые вам могут помочь это ваш провайдер который зачастую по доставлять какие-то встроенные средства защиты например если вы готовитесь каким-то аудитом то зачастую провайдер может знать какие-то подробности по эти аудит и и может давать рекомендации какие он советуют использовать свои средства защиты и и внешние помогают вам и как его клиенту проходите эти аудита спасибо за внимание мы будем рады ответить на ваши вопросы да пасибо ну пока у нас вопросов чат еще ни одного не попала просто забаню это значит что да да да либо это значит что мы просто всех отлично запугали либо вопросы все копили я надеюсь на второй вариант и давайте перемещаться в дискуссионную зону хотя я могу для затравки завода заданного его нибудь свое а давайте люба как ты ты отнеслась к пересборки докер ими жизни 0 стоянку ты имеешь ввиду под 0 from scratch и правильно слушай chrome цели отличная идея вообще безопасность увеличивается во много раз например как если полностью отрезать свой сервис от сети это значит улучшит его показатели во много раз тут мы сталкиваемся с проблемой когда у нас либо безопасника либо удобненько не все приложения удобно можно перенести в scratch например насколько я знаю с java это сложно может быть в новых версиях чуть проще но в старых версиях она вообще такое запрещала я точно не скажу но по-крайней мере это какие-то такие мощные усилия на это требуется не все образы которые мы используем наши образы например они могут быть как мы только что сказали да у нас в купер нити с надя есть образы которые принес нам кубер нить из мы не будем их переделывать некоторые из них from scratch некоторые может быть нет нам нужно от ориентироваться мы всегда используем какие-то образы которые собраны не нами это тоже нужно сканировать достанется все равно нужно то есть можно использовать еще и всякие slim образы и вот но их тоже надо будет сканировать здорово у нас тоже есть а нашему опыту много чего билде открыть и java и g руби их пас некие меняется живот другим заставили всех так делать или это вот такое революционное решение самостоятельно нет просто я покажу какой костюм я всегда старался быть команде мне так хорошо конечно да тут к сожалению получается так что это может быть например неудобно разработчикам потому что они привыкли работать в будьте они знают инструменты и знают что с этим делать поэтому например у нас java начинает тормозить у нее что-то не так по сети что может делаться на простой одну зайти в контейнеры и выполнить наши вот стандартные какие-то вещи если мы начинаем там from scratch а как нам подключиться а у нее сеть другая ну это им сложнее это нужно всех переучивать помимо того что мы так чтобы нули до время на переход на такой scratch образ ну это дорого это всегда нужно оценивать риски того или другого решения на самом деле еще добавлю что вот когда принципе вот security практике внедряются очень многое так сопротивление идет от некоторых там разработчиков дэвов сразу да то есть и вот и так есть чем бокам вам бороться до вот такие вещи можно поначалу на самом деле уступить как бы вот ну я бы не называл это уступить здесь всегда идет вопрос оценки риска ты всегда можешь показать как безопаснее q так и разработчику что у нас есть такие проблемы такие риски такие неудобства и давайте оценивать сколько это будет стоить компании можно даже в рублях да к сожалению специалистов которые имеют права у вас вращению трески прям еще чтобы в рублях это вообще там супер редкость используй эти единицы измерения розовый по качественные винить или арвен высокий низкий и удержался ok алексей тогда наверно ну я незнаю разумеется люба то тоже можешь ответить любой момент на этот вопрос но мне он кажется больше подходит алексей есть ли вот инструменты чтобы сразу прямо вот сделать захар диете тот кубер найдешь будь он неладен который с одной стороны хорош другой стороны с дефолт или настройками не очень-то не закрашено решит хорош на самом деле вот и жену инструмента к сожалению практически можно сказать что нет потому что есть комплекс как бы есть множество разных инструментов например есть всякие bench инструмент который вот на предмет цис бенчмарков анализирует ваши там настройку кластера автоматически вот он позволяет отправлять на проанализировать нарцисс benchmark есть отдельные некоторые утилиты которые проанализируют за вас там рыбак ваши роли их тоже полезно используют там на хате и особо не полагаться на них потому что все таки arbok того и от нашей скрывая модели так что это все-таки должна быть прямо в табличке и четко вот но тем не менее есть там платные продукты там и aqua security который комплексный продукт и усе здесь есть который вот сочетает в себе вот набор таких инструментов как бы маленьких которые позволяют вроде как захар перед целиком но все равно как бы к этому надо относиться скептически и использовать их на тронах ordering все таки вот как бы на вашей стороне в первую очередь то есть инструменты за вас полностью подключить ничего к сожалению не сделать самое главное это понимание ваш инфраструктуры то есть именно вот понимание скажите сами когда идет либо я вообще считаю что без понимания у тебя ничего не будет не обзывали лети ничего ну то есть если мы в начале говорили да там security чемпиона почему но так нужен the toughest говорю от нас есть команда security она очень хорошо разбирается в модели угроз вот прям замечательно если вы ей не расскажите что вы у себя используете повернитесь кластер она вас будет защищать от каких-то совершенно других выдуманных угроз которые не выдумано к реальных но на железе поэтому да здесь важен диалог важно подумать хорошо а инструмент единый да конечно сложно помогают ты уже и так как бы харди решая инструмент тебе просто там сэкономит время или там подруги могу вам что-то подсветит но основное как бы видение должна быть именно самого человека больше команд окей и наверное последний вопрос здесь и сделаем быстрым хотя это предмет для вообще большого хлора кажется но что вы ребята думаете про и наса иной губернатор даннинг гай но я вот в частности его затронул в докладе много уже статей вышла которые о нем там говорят но я соглашусь тут больше статьей от кабинете со он как бы в этой статьи и подсвеченный плюсы этого гайда и какие то недостатки там те же самые там которые уже deep реки этот под security policy но очевидно не стоило как бы они их в принципе писать наверное без упоминания что они депре кейдан да вот ну то есть там есть как бы плюсы есть хорошие базовые подходы но там прямо много чего не хватает по мелочи прям есть чего добавить я здесь по сану и даже не буду притворяться эксперта где сейчас гораздо лучше знает есть еще не стровский документ на самом деле который тоже не так давно вышел и он тоже в родосе капс вот он там мало 40 страниц но тоже так верхнем уровне неплохо затрагивает все эти аспекты причем это несколько прям полезно технически сколько приятно то что вот на уровне как бы уже там государственном появляются именно стандарты которые начинают регламентировать именно dixie cups прямо кубер на эти слова появляются раньше здесь как бы там такого вообще ничего кому-то не не существует этого вот может быть ее в нашем фазе скоро там появится слова cabernet избе да то есть как сказали бы наша мире точнее наши американские друзья из того же на сайт их авторитет we have a grain of sand на этом я предлагаю переместиться в дискуссионную зону мы ждем там все кто у кого остались какие то вопросы возможно мы ответили сейчас прямо на некоторые из них но тем не менее господа давно добро пожаловать дискуссионная зону очень у вас там ждем"
}