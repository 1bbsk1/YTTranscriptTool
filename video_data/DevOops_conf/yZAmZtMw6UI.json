{
  "video_id": "yZAmZtMw6UI",
  "channel": "DevOops_conf",
  "title": "Сергей Пронин — Database-as-a-Service в Kubernetes с GitOps",
  "views": 303,
  "duration": 3738,
  "published": "2022-07-06T04:09:48-07:00",
  "text": "привет привет это devops андрей кавун я разработчик и я очень люблю всякие штуки за сервис и всякое как кот вот и я очень люблю когда база данных например как кот и мы сегодня таких вещах я думаю поговорим о поговорим с человеком с которым имеет смысл об этом поговорить это сергей пронин сергей привет для андрей привет привет спасибо и сергей работая дня я про них расскажу немножко сер я продакт-менеджер в циркония руль и в нашем продукт менеджментом здесь и основной у меня фокус это базе данных поверните в облаках и прочие разработка связаны с к границе с оператором ну можно прочитать собственно на сайте усердие достаточно богатая уже богатый жизненный опыт да и вот там придя в перка но он видимо осознанно выбрал вот эти вот штуки которые мы сейчас занимается есть вопрос по по теме доклада вот кажется она достаточно прокол провокационная да и нас вообще заинтересовала как это база данных повернитесь и часто ли люди тебе говорят что но это вообще не понятно о чем сейчас пойдет речь как это так базы данных и ecu бернес как это вообще ну да да бывает что люди пальцем у виска там погрузят скажут какие базы данных повернитесь и на самом деле до этого я работал в компании в которой мы строили какие-то там платформы и чтобы ну там кубер на сервере за сервис был базы тоже строили и как раз оберните сервис у нас был только ориентирован на stay close приложение то есть никаких баз ничего там не дай бог вот и потом как-то склонился в сторону перк он и петя зайцев всего перк он и огня рассказал о планы большие его теперь я евангелие рую базы данных поверните но достаточно интересно и я долго тоже как то думал что губернатор для stateless но сейчас вижу что многое особенно крупных кампаний enterprise и они мигрируют в обернитесь и в том числе базы данных и я про это расскажу даже про каких-то на наших клиентов или юзеров из комьюнити которые этими продуктами пользовать очень интересный есть кейс и это это же все не на пустом месте там ну изначально и вообще вся контейнеризации вроде как не для да там стоит сервисов и для баз и многие как какое-то время назад поделили да вот вот это у нас там на железе или на виртуалка х это у нас там может быть соответственно в контейнерах там или в - какой-то среде ну так еще и живут вот и интересно может ли это все жить вместе кстати пользуясь случаем петр будет у нас завтра на комьюнити дни также также участвует программе поэтому если вам понравится доклад сегодня присоединяйтесь и завтра вот но сейчас я предлагаю переходить непосредственно к теме мы договорились но если даже не понравится предписаниям петров петр плохого не расскажет да пока мы не начали два слова у нас есть чатик и вы пожалуйста задавайте вопросы и мы их озвучим либо в эфире либо мы их сохраним до дискуссионной зоны и после доклада у нас обязательно будет дискуссия подключайтесь зум и там мы обсудим все что осталось и даже если вы не увидели сейчас онлайн доклад осмотрите его в записи тоже приходите в чатике задавайте вопросы сергей обязательно там ответит я буду стараться будет стараться руки начинаем презентацию тогда баз данных купер нити дтп сервис убирается с гипсом что будет в этом докладе я немного расскажу про водную пройди бас вообще какие проблемы он решает для кого потом мы посмотрим как вообще базы данных желудку вернитесь и что там надо сделать чтобы завести базу данных почему вообще люди запускают базы данных cabernet все возможно расскажу про какие-то реальные истории каких-то клиентов потом немного расскажу про оператора ну это концепт верните которую позволяет расширить немного кубер насыпи а и запускать приложение в том числе базу данных легче гораздо потом начнем говорить про get up какие проблемы он решает так называемый до его на переезд то есть диплом до изначально просто тепло эти запустить идентичен сайта менеджмент или какой-то там каждодневный maintained баз данных возможна там апгрейт скиллинг и прочее и чтобы не быть голословным будет короткая дыма покажу вообще как оно на самом деле спускается как она выглядит в живую и так de base дтп если за сервис он изначально как бы создался как и все наверное прекрасная в нашей жизни и соления разработчиков на то есть разработчики не хотят тратить время или там администратор не хотят от времени развертывание баз данных на их администрирование и прочее и минимальном видеть дайте бы если за сервис выглядит как какой-то и bio которому пользователи или приложение может обратиться и как результат после обращения к этому видео пользуйтесь получать какой-то and point базы данных то есть если там москве он там базы как-то развернулась человек включается с рубцовым логином и паролем или каким-то другим логин пароль в базе данных и что там происходит в за кулисами бэкстейджи человеку или приложение совершенно неважно картам базы данных это существует то есть там про вся какая-то развернулся как-то бэкапы настроены это вообще человек не волнует ему главное получить and point котором подключиться и начать использовать базу данных ну и ко всему этому плюсом идет не только развертывание базы данных но еще какая-то автоматизация других задач например появляется мониторинг то есть репей кол каком ну там развернуть базу данных плюс есть тебя и холл там получить какие-то метрики или же уже готовые графики например если омар диез какой-нибудь уже есть там в клуб фронте а графики базы данных плюс ко всему могут быть там дополнительные плюшки виде бэкапов скиллинга апгрейдов баз данных тоже все это обычно делается через ebay и дтп через эти задачи прекрасно решает ну и основное наверное что еще хочется раз проговорите то что как пользователь в конечном итоге получает сервис то есть пользователь не получает базу данных и но ты там и ноты прокси и так далее пользователь получает сервис какой-то and point если мы рассматриваем базы данных в обернитесь это обычно я на них смотрю как три таких больших пласта первые так убирать примитивы то есть это все что надо создать нашим любимым верность если кто то не знает что такое повернитесь я особо вдаваться в детали не буду но больниц эта штука которая позволяет оркестре давать контейнеры docker контейнеры люблю там какие-то другие и выбираются надо давать какие-то определенные примитивы чтобы запустить там вообще хоть что-то под и это сторож класс и всякий стоит full set и и прочее прочее так вот чтобы создать базу данных или какое-то другое приложение в купюрница надо эти примитивы создать обычно это какой-то ямал манифест который мы скармливаем кубер на цепи и он создает эти примитивы плюс ко всему естественно когда мы разворачиваем базы данных обычно это не одна нота в кубер на вся как минимум 3 да это кластеров и это все надо как-то конфигурировать то есть у нас вторым пластом идет конфигурация базы данных даже если это одна единственная но до базы данных и все равно нужно как-то настроить передать и какие-то конфигурационные параметры там в этот контейнер и лигу январе натворю был с либо еще как-то а если это класс только надо понимать что они должны эти ноты друг с другом как-то общаться да и естественно это все надо хорошо настроить далее третий такой пласт инфраструктура я его особо рассматривать его не буду потому что кубер лес он работает над как настройка на донышке структурой то есть там какие-нибудь и ситу инстанции и прочее маньяки виртуальные машины она все на нижнем уровне но никогда не надо забывать про этот пласт потому что он поддерживает самку вернитесь и q вернемся на него опирались помните годар про сложность тепло и баз данных кубер нет света сама база данных это какие-то компоненты например какие не проси если случай мои спела это какой-нибудь прокси escuela и речи прокси если это манга то это там есть mangos который выручит запросы в конкурсе тиковой пиджи балансом но и прочее да то есть например как элит компоненты для бэкапов то есть надо ещё порт или контейнер для бака что даже диплом и конечно все вот это вот руками достаточно сложно и болезненно настраивать и для этого придумали оператор или оператор и да есть такое вектор с фреймворк который был придуман компании где-то в 2018 году и он позволяет расширить кубер эти цепи то есть вместо того чтобы повернуть су говорить о создай камни под вы можете сказать повернуть все а создай камни кластер базы данных или создай ко мне какой-нибудь wordpress приложение и как видно на картинке операторы позволяют абстрагировать вот эти 2 2 таких подушки два пласта uber нас примитивы и конфигурацию то есть вместо того чтобы пользователи администраторы приложения думали как как же мне создать этих границ примитивы и сконфигурировать мою базу данных достаточно просто это все скормить оператору как это делается это как я сказал убирается ebay можно расширить это есть такая вещь как костюм ресурс де финишем вы его создаете с помощью оператора или рядом с оператором и потом создаете ко сну ресурс купер найтись и это тоже такой огромный я вал манифест я его чуть дальше покажу в дома тоже покажу его где вы описываете конфигурацию вашей базы данных то есть вы говорите я хочу создать вот здесь кусок это из нашего оператора с парком пикси оператор для москве то есть можешь создать класс там из трёх нот не нужны бэкапы мне нужен праксис кирилл там всякие губерн эти штуки например там affinity можно настроить и прочее я это покажу чуть попозже но опять же тут важно понимать что как только пользователь это сделал то есть он скормил этот костюм ресурс купер нить из то он получает опять же сервис как нашим любимым небось и то есть что там за кулисами происходит совершенно неважно каких убраны из примитива создаются как она настраивается пользователь получает какой-то in point которому он может сразу подключиться и начать базу использовать что крутого в убирает операторы для баз данных это именно упрощение тепло и тогда то есть вместо того чтобы так все конфигурировать мы можем там 100 баз данных просто разными именами назвать ее за deploy одной команды и оно все будет прекрасно работать ну и плюс ко всему мы тоже об этом чуть подальше поговорим большинство операторов не все но большинство позволяют выполнять какие-то каждодневные задачи с базами данных например сделать бака соски или базу данных не знаю какие то даже юзеров создайте таблички отправите это все тоже можно делать через оператор не обращаясь там каким-то другим тарзан или базе данных напрямую то есть такое упрощение сейчас поговорим немного про то почему я вообще базы данных на запускаются кто не знает тут есть главный typhoon дальше да у них каждый год выходят опросники и вот в этом году по моему еще не вышел а вот прошлогодний опрос показал что девяносто один процент компании в которой они опросили уже использую оперный 8 ст риф в продакшене но это так себе данные потому что даже если 83 в продакшене возможно там один какой-то контейнер крутиться или это только стоит лишь поэтому есть еще такая британки берлинском unity она наверно создалось год назад примерно и даже больше вот два назад это как раз комьюнити которая занимается продвижением стоит приложений в q вернитесь и вот в прошлом году или а в этом году они прогнали тоже какой-то сервере такой и не собрали данные там помогут тысячи с лишним компаний и борт из тысячи этих с лишним компаний 70 процентов уже запускают стоит full приложение флаг оберните это базы данных это какие-то танки велю стоит штуки и так далее что достаточно много да я когда-то перк он где-то полтора года назад я не думал что так много людей спускает базы данных куган если честно вот и третий пункт это перк о нем и в видим что к нам приходят юзеры из комьюнити к нам приходят клиенты которые говорят а как бы мне запустить вот базы данных в кубер найтись и и вручную запускать базу данных мы могли бы отдать клиенту докер контейнеры сказали вот он докер-контейнер там с перком сервером запускайте его как хотите все будет работать и она действительно запустится но потом скорее всего через недельку оно где-нибудь там сломается или пользователь будет грустить и придет нам сказать что там бэкапы как-то сложно делать ничего не работает помогите на и поэтому мы как раз и начали вот это путешествие в операторы и запуск оберните сафари запуск баз данных убирать с помощью оператор чтобы как-то развеселить наши пользователи он дедуля из игры в кальмара очень рад и какие-то your space и такие которые мы видим в апперкоте достаточно часто сейчас может про клиентов еще каких-то расскажу что то как сервис да это вот в первый хороший такой случай когда к нам приходит либо клиент либо кто-то из комьюнити и говорит что вот я хочу запустить de base или мы запускаем собственную платформу или у нас там не знаю wordpress платформа которая база данных под каждого клиента разворачивает это такой достаточно распространенный случай наверное процентов 30 40 в enterprise таких крупных клиентов или юзеров они точно с такой проблемой приходит и здесь базы данных купюрницы конечно очень помогает нам что это просто и быстро если мы общаемся с клиентом говорим почему бы там ни какой-нибудь ради е100 как правило это упирается либо в деньги либо ах мы не хотим wenn der логин или а у нас про его клаус нам это вообще не интересны мы хотим все в нашем собственном вернись и запускать 2 хороший союз кейс от когда взгляды walk но это девелопмента хостинга используйте как убираясь операторы для баз данных или базы запускаются удар найти ну это понятно да ты создал вас данных удалил быстро безболезнен особенно если это можно локальной машине там mini cube культ поднять развернуть базу развернуть приложение в кубер неси какая-то сейчас модно все про протестировать и это все убить ну тут как правило еще надо понимать что обычно стоит там какой-нибудь и продакшен на ней идентичны должны быть то есть это именно для давал в найти testing а скорее всего подойдет если у вас продакшене в повернитесь это наверное не стоит там так делать ну все равно этот случай достаточно такой частой и кубер ность shop это наверное такой мой один из любимых случаев и лидерский сеткам часто достаточно пользователи приходят и говорят вот у нас политика партии в компании поменялось мы все мигрирует губерн и вообще все вот у нас там стратегия такая хотим и база данных и тогда пользователь начинает запускать и базы данных куба найти с помощью операторов я честно скажу не думал что это частый случай оказывается очень часто особенно в последнее время в последние полгода это очень наблюдается эта тенденция что отдавайте счетом архитектуру поменяем еще увернуться ну почему бы и нет наверно рабочие истории и плохие случае мэйнфрейм да есть у вас огромные базы данных на петабайт и вы думаете с мигрировать и их обернитесь она работать скорее всего будет скорее всего запустится но зачем да это делать наверное не надо сначала надо привести все какой-то микро сервисной архитектуре а потом уже за тепло это дело потихонечку губернатор fob миграцию делать но это бессмысленно и много занятия скорее всего будет много более и страданий тоже один из моих любимых случаев это я слышал cubensis это круто и я слышала что базы данных у бернадетт и круто сейчас буду все мигрировать помогите но как правило делать это не надо естественно надо сначала понимать какие проблемы вы хотите решить базы данных убираетесь решают про летом повторение да если надо много много баз запустить быстрое и убить их решая проблему менеджмента баз данных а если вы просто хотите запустить там базу данных из 10 ваших там баз данных убирается только потому что кто-то вам сказал что это круто ну скорее всего не надо это делать подумайте натуры и решите уже как как она у вас будет выглядеть возможно не надо ну и такой некрасивый успеть тоже достаточно часто сталкиваемся с ним это когда к нам приходят пользователи гарри он горит у нас вот стартом у нас там amazon elastic бен сток какой нить используется rds один-единственный запущен и мы хотим мигрировать вот базу данных оберните потому что тоже думаем что это классно ну как правило если у вас есть а там одна какая либо . ну пусть она в ардити в этом живет денег вы на этом не сэкономите если у вас там интерлок in пугает но с одной базой и скорее всего какой-то wenn der лук айна наверное не будет поэтому тоже опять же стоит несколько раз подумать прежде чем так вот мигрировать ну и чтобы так не быть голословным потому что многие мне говорят что как мы с андреем осуждали пальцем у виска там могут покрутить да какие то губерн с операторы или какие базы данных в поверните вон сколько всяких разных операторов я вспомнил это я писал из головы то есть это не не гуглила быстренько написал если посмотрите там вот три таких топовых да им нервным базы мой скальп others и манга опции достаточно много там у майская лиора корбетта недавно выпустили и была такой компании пресс лепс она и сейчас есть но они разделились на две и бит полк компании они пишут тебе это вообще швейцарский нож для операторов вас данных они там изгрыз и мангу и ластик search но они не совсем того консорциум них там болт encore модель где там бэкапов нету в версии надо там дополнительным денег заплатить чтоб enterprise получить ну из таких вот интересных здесь ребят это объем ай-би-эм есть облака и бен клауд она конечно не такое как бы используемый как amazon или google cloud но если вы его используете если вы там запускаете базы данных то знаете что они запускают это все дело вку вернитесь и и запускает это собственно через собственные операторы которые у них там есть на их масштабах это достаточно интересное решение и есть еще один пример дарит у них есть танцу если вы запускаете базу данных там через if you are we weer танцу то вы стали всего запускаете тоже используя их операторы которые не станут сами как там написали о никлаус source и тоже винь интересное на их масштабах почему бы и нет ну и такие компании как вот например мария тебе у них есть свой the sky спел то есть это менеджер мария baby в облаке они тоже спускают все обернитесь остальные ребята тут по моему а ну да до 100 кгц до дата старта не спускать кассандру через кей которая пишется тоже в ск убери суперкласс монетизирована мужчин то есть production все это у многих работает а и как это зрелость операторов да это сайта редко то я дам ссылку где-то внизу приложил это важно понимать потому что сейчас я перейду к теме гипса и здесь важно понимать что если мы используем github с операторами то нет abs он управляет он смотрит каких а какие там манифесты создались я маски и создает их уже в кубер нити и вот это зрелое ты зря модель зрелости операторов она позволяет понять а что мне вообще не tops даст потому что не все операторы они например умеют там скейлится диске или базы данных то есть вы можете вот level 1 это basic installation и то есть только за заде плоть базу данных и все или приложение и detox это сможет сделать а вот если там уже какой-нибудь level 3 это там бэкапы какие-нибудь сделать не все операторы поддерживают то есть как правило вы можете заде плоть базы данных через оператор а баков например сделать каким-то сторонним приложением тогда github здесь уже но не очень подойдёт надо будет что-то там придумать это уже не прямо напрямую с оператором будет но большинство пиратов нами backup restore все-таки поддерживать на такие штуки например как там abnormal ted экшн мониторинг встроенная это как правило не все операторы точно пакет вот это надо понимать прежде чем вы скажете что вы где-то псы базу данных сейчас я вам быстренько там запущу и если вот сейчас мы приближаемся к теме github со можно посмотреть вот такую эволюцию баз данных кубер нить если слева у нас это первая такая попытка вручную запустить базу данных это то что я говорил надо вручную этом создать кубы на из примитивы конфигурировать базу данных но я надеюсь все таки все не вручную делается какие-нибудь тулс этом дата манси был таро форум то не дай бог баши все это все-таки в каком убит хамит хранится то потом если мы перейдем к следующей ступени эволюции наши тоже вместо глубина из примитивных на фигура ции появляется оператор то есть у нас тот же таро форм например управляет уже оператором даник учиху бернис примитивов которые надым как сконфигурировать еще ну и третья ступень эволюции это ги дон это когда у нас остается все таки оператор в поверните но гипс уже замещает собой и guitar замечается обои все эти тузы которые делают то есть упрощение и возможность что-то в будущем еще проще и еще круче вы когда-нибудь придумаете смотрим если говорить про гид abs и базы данных то вот так вот она в росте к простеньком виде наверное как-то должно выглядеть слева у нас слева направо если читать эту картинку то начинается у нас с пользователя который в гитхабе сохраняет какие-то yellow манифесты если мы говорим про оператором и про них и говорим то там сохраняются у невесты именно баз данных то есть здесь db-1 кастом ресурсы to manifest который описывает там базу данных также как я говорил многие операторы поддерживают backup или какие-то другие операции и вот здесь тебе один пока все то есть пользователь хочет сделать бэкап db-1 до которым до этого создал у многих операторов есть другие кастом кастомные ресурсы например есть оператор такой для плоскости gres у них есть отдельный ciare который пользователь может создать чтобы там выполнить какую-то штуку для самого возраст например создать пользователя или соски лилит по сбросу и там примут у них целый список команд который можно сделать используя от кубер не тиски объект чтобы рулить под весом достаточно интересный подход и получается что можно через битов с таким образом управлять этим оператором ибо с пирсом что конечно расширяется скоб намного пор после того как пользователь создал или изменил вот этот ямал манифест но все попадает в github оператор ну их несколько так сходу скажу flags тэги ток с операторы и the cord который вы запускаете в кубер нити который либо периодически ходит в git хоп и спрашивают а чё там поменялось а новый ли манифест появился или новый файлик либо это погиб хоку идет обращение detox оператору которых губерн и но это редко обычно это модель то есть detox оператор ходит в хип-хоп и после того как detox увидел что что-то либо изменилось либо что-то новое появилось он создает кастом ресурс в uber нести в самом для базы данных уже и здесь уже в дело вступает оператор базы данных которые видят что нога поменялся ли создался новый ресурс который я менеджер и создается база данных создается про вся возможность сдается bucket fs3 пикапов еще какая-то магия происходит которые связаны с базы данных и после этого пользователь он получает уже у нас готовый сервис то есть опять же вся коммуникация пользователя идет с через гид х нет такого что пользователь тетку вернитесь напрямую и что это делает все эти изменения проходят через гид х и сразу появляется сейчас такой вопрос а вообще к кому это нужно зачем это нужно несколько таких случаев когда у вас уже используется гипс до или вы используете какой-то enter страх языков и вы хотите его упростить то вот этот подход он подходит у нас есть пользователь поманили не наш клиент пользователь так наш наш продукт и upon сосны и у нас много из комьюнити людей приходят они построили свой продукт который там сайты делать на что-то типа викса wix.com ну что знает вот и они разворачивают базы данных для по под каждого клиента и у них это все хранится в гите то есть они вообще все менеджер через гид х напрямую возможны споры подход но для них это прекрасно вот это не полные то прозрачности действующих вся история хранится version насти и они также рулят и внутренними какими-то делами то есть там пользователю или не пользователя давал тару надо создать базу данных он тоже делать это все через тихо ну прямо то не адепты детокса и наши операторы используют очень интересно не у них там сотни если не тысячи баз данных там каждый день разворачиваться удаляются классная смотрел эту структуру очень интересно о когда говорим про до его на пересчет я говорил это тепло и да просто создать базу данных или приложения то как я уже сказал надо понимать что это всё сводится к основному ресурсов то есть в гитхабе у нас просто создается ciara манифест большой ямал файл в дыму я покажу который описывает базу данных и все больше пользователя ничего делать не на просто создать этот манифест посланником полу request который наверное пройдет какой-то review если это продакшн и базы данных создастся ну и конечно же это очень просто все повторяется то есть скопировать один файлик и послать полу и квест с новым файликом в котором у баз данных например другой имя и другая конфигурация этого очень просто и никаких новых технологий учить не надо то есть вы знаете я мог бы не fest как он построен вы знаете getjar и не надо учить там та ра форму не надо разбираться в полумиле ливан себе просто все эти скидывайте в декабре detox оператор и оператор баз данных от все разруливает уже автоматически вк убираетесь очень удобно и классно ну и основной конечно такой плюс для если это enterprise или вообще любой продакшен это что все изменения они должны проходить через гид и через какое-то review да если это опять же продакшен вы посылаете полу request например хочу создать новую продакшн и базы данных или хочу сделать backup или не знаю хочу там добавить еще одну ноту вместо того чтобы идти томску бернейса руками то чего то делать или вместо того чтобы править квартира форума потом двое плыть вы просто отсылаете полу request гидра он трудится там проходит какое-то review как только он смертен то сразу ход раскатывается и не надо там каких-то дополнительных дженкинс pipeline of которые считывают там кит хоук репозитории на изменения не в пуде какие-то и так далее все сделано достаточно прозрачно и супер супер просто и да и цифр операции то есть каждодневные какие-то действия с баз данных с базами данных как я уже говорил на той картинке с зрелостью операторов это все очень зависит от того что оператор умеет то есть если ваш оператор умеет там делать бэкапы умеет денег базу данных умеет не знаю там удалять backup создавайте стрельба киты какие-то модификации в базе данных делать то естественно это все можно сделать через detox если же это не работает в операторе то наверное какие-то сторонние тузы тоже можно прикрутить это все detox у но это будет что-то сторонника и приложения или какой-то дополнительный не знаю ой не знаю какого как это будет устроена но в данном случае вот пример если мы хотим сделать там backup в каком-то одном супер конских операторов то достаточно создать кастомный ресурс который там опять же ты какой-то маленький яму манифест который описывает куда надо сделать бэкап какой backup там full point in time recovery ли еще что то и detox опять же его считает создать какой-то кастом ресурс в кубер нет сеем оператору баз данных его считает и что-то сделать там с базой данных если это backup он там его зальет если это restore the он что-то там восстановит в базу данных но тут надо понимать что вот эти кастомные ресурсы они как бы достаточно жестко задан да то есть это как я уже говорил все таки в операторе поддержка их должна быть но был нас пользователь который во мне через гипс руль от пользователей базами базы данных самих то есть они лезут в ванной создают там пользователи создают базы данных таблицы у нас оператор этому поддержку нас оператор занимается созданием инфраструктуры вот им надо им на создание пользователи они через detox создаю там отдельно как-то пользователей к напиться в базе данных сторонним контейнером ну достаточно такая маленькая наверное вещь и теперь чтобы голословным совсем не быть покажу дома она у меня записано чтобы никаких проблем не было надеюсь картинку видно ребята там и и увеличили вот здесь я покажу в этом тем что вот у меня есть git репо какая-то в этой гидрики у меня вот есть этот костюм ресурс манифест он такой достаточно большой в данном случае отказа ресурс для бонги да то есть у меня здесь написано какую версию я хочу морге 446 здесь наверху какой-то моему полететь на примерку вернетесь какие-то то есть параметр тоже можно задавать там affinity еще что то это все через оператор тоже можно делать здесь у меня апгрейт absence как я там хочу обновлять здесь вот реплика сет я быстренько его пролистал здесь написано вот например что я хочу включить sharding хочу чтобы у меня конфиг сервера реплика сайт создался кто не знает он мог геккон фиксер используются в шар и знаки чтобы хранить мета-данные от данных чтобы мангас знал куда отправлять запросы пользователя на какую из на какой из реплик ассетов ну это же я создаю мангас это прокси и раундов в манге которая принимает пользовательские запросы отправляет уже базу нам это все через этот костыль рессор здесь описывается достаточно понять как он устроен достаточно нативная и все понятно теперь я приступлю на к установке самого detox оператора здесь я использую flags можно использовать любой другой как я говорил они обычно одинаковые создадим какой-то namespace за тепло скачаем а да у меня ubuntu значит качаем снапом флаг скота или та штука для установки flags оператора удобно достаточно и здесь я просто выполняя команды которые постановит мне оператор в губернатор разворачивает два кода создает секреты всякий класс тролли в вернуться опять же всякая магия как я говорил можно это все не знать если вы используете оператор то есть для таких как я специально это все сделано вот у нас flags под создался он живой и запущен теперь надо сделать так чтобы мы могли в геноме авторизоваться с этим флаг с оператора сейчас я здесь получил ключи один-единственный вот он ключ его надо скопировать и гитхабе вставить где вас там секреты хранят стану конфигурациях фигура ция ключи и ключ должен иметь право на чтение естественно регина запись тоже лучше дать потому что иногда там какие-то мета-данные в детей тоже сохраняются но это зависит все от оператора вот я уже добавил тот ключ там бэкграунде в git хоп и теперь смотри у а появились ли какие-то порт и пока что и подав ни каких не появилась мангуста хотя должны мне шар там есть вот не логе flags оператора и здесь видно вот здесь вот что он здесь чего ночь они двор читал да то есть без мдп вот он он значит считал уже давайте посмотрим до воды уже начали появляться друг за другом появились вот конфиг сервер и кафе г 0 of имя некрасивый майкл остальным это дефолтное имя в нашем операторе я не стал его менять вот он создал записываем dime que вернуть объект то есть сердика сном resource он там инициализируется и будет анализировать пока все коды не развернуться на самом деле интересная вещь потому что здесь как раз видно видно всю сложность базы данных в uber нить и потому что здесь будет создана h10 кодов будет создан порт для оператора самого будет создано три поля для мангас то есть этот практик или роутер в морге будет создано три поля для replicas это с данными и три года для реплика сета который конфиг сервер который мне то данный хранятся то есть 10 кодов и все они там друг с другом как ты взаимодействуют как ты настроен и вручную это конечно все дело достаточно сложно я в прошлом месяце писал блокпост по манге там по миграции в uber нить и мне надо было руками развернуть эту бомбу и я надеть что-то уж не там создал instance и начал разворачивать там мангу и убил на это там несколько часов с непривычки пока разобрался куда там порт какой вспомнить когда и хищник поставить как там настроить шарден куда ключи засунуть конечно оператор меня расслабили в этом плане ничего думать не надо оператор там ключи создает в сервис и создает все сам делает делать ничего не надо ну вот у нас дома идет пар и почти все поднялись вот один порт он но третий нод родион потому что холостяк видимо не прошел он поднялся самый последний а все вот он прошёл человек все теперь он запущен отличный посмотрим вот наш писал тебе объекта он говорит что он рэнди и вот есть and point я опять же для дыма я сделал чтобы on point был публичный это у меня джека и кластер то есть создался какой-то паблик лол балансер и публичная беатрис конечно так делать не надо вовне базу данных поставлять не стоит теперь моя цель парка найтись к этой базе данных просто показать что это не просто какие-то поле баз данных я сейчас выкусил вот секрет создался секрет спорол с паролями к базе данных и я нити этот логин пароль сейчас использую их базе данных подключусь у нас оператор создаются какие-то по умолчанию логин и пароль и для менеджмента класс стр но естественно можно там своих на генерить сколько угодно ну вот и отлично то есть база работает все вроде жива и здорова ну теперь он показать что github еще сам по себе работает что не только вот еще sharding да здесь еще shard у нас есть показываем что есть sharp он один единственный то есть можно добавить побольше это еще там больше поводов будет word теперь beatles покажем беру мангас вот у меня здесь мангас эти блоки которые наши запросы рулят вместо того чтобы трипода я хочу сделать 2 ну для кого видеть это наверное достаточно особенно мангус он стоит last мне ничего интересного нет за комитет и потом запушен у меня там никакого review нет в идеале конечно должен быть если это опять же продакшен или даже 100 jing то стоит dm делать ревью на меня gepur он прошел даже без пароль потому что роль за кашира вался мы посмотрим логе нашего и dolls оператора флаг салон каждый по моему по умолчанию flags каждые пять минут лезет в guitar прошить его на изменение можно это конечно строить чтобы был все намного быстрее но я ничего не настроил поэтому я у час форсирую sing скажу flags а давай-ка иди к гид хоп и дерна все изменения и вот он нашел что там что-то изменилось применил какой-то branch применил последний к вид и до влогах это уже видно что он там теплой сделал и вот у нас уже man господа как вы видите не 3 осталось всего 2 то есть магия работает но опять же магию можно делать и с другими вещами не только там скейлится можно и пока вы делаете апгрейдить и какой-то момент манги конфигурацию какую-то манги специфического накатить но опять же это надо смотреть случае случаю что какой оператор поддерживает чем больше фишек вы можете сделать через оператор с баз данных с базой данных тем конечно у вас больше выбор и больше свобода в самом гипсе ну вот наверно с дома все сейчас я президент опять нажмем секунду все уложился все рассказал все что хотел базы данных в кубер нити рассказал показал пример и показал как github сработает все если есть вопросы с удовольствием послушаю если хотите найдите меня в твиттере и на письмо письмо на почту мне напишите с удовольствием пообщаюсь отвечу если что надо где-то помогу сергей спасибо во многом все прояснилось многое прояснилось скажем так да вот и здорово есть днк все круто но вопросы как водится есть вот начнем с вопросов с чита прямо горячие вот александр спрашивает что возможно не уловил как мы задаем рутовый пароль к базе данных то вот сейчас поднимал ты где тот указывал отличный вопрос рутовый пароль к базе данных хранится в губернаторском секрете и оператор его обрабатывает если вы не создали секрет заранее то оператор у нас его сам автоматически сгенерирует каким-то рандомным паролем то есть вы его всегда секреты сможете выкусить естественно хранить секреты которые там больше 64 encoding используют гитхабе не очень по случаю гипс это конечно не вариант поэтому для таких случаев используются какие-то либо сил секрет либо еще какие-то например хашиг орг какой-нибудь world используются чтобы они могли чтобы вы могли взять из хорошо careful to секреты создать его кубер на все меня даже есть где-то блокпост который я писал чтобы показать как это сделать вместе с гипсом если надо потом ссылку найду в чат скин но и вот сразу для понимания у меня лично когда я вижу вот этот просто нияма она меня ну конечно завораживает я очень это все люблю но а где в принципе брать вот изначально какой-то шаблон этого манифеста то есть откуда я должен знать от чего нужно заполнить там чего нужно написать какой вину формат и так далее вот опять же от оператора к оператору на на разнице но но может быть для вашего хобби для для для наших операторов у нас в репозитории в гитхабе всегда лежит полный сериал со всеми параметрами их там какие-то не закончены которые не особо важны какие-то 1 камень чины и плюс у нас есть естественно долго которая описывает все эти параметры что они делают ну и для так поиграться поковыряться у нас есть специальный минимум до которым там он вообще несколько строк штук 5 наверное который про создать базу данных чтоб нее можно было зайти и все то есть там никакого offense никаких бэкапов и настроены ничего ну а тогда вы огромное это простыня у нас есть по умолчанию в гитхабе хорошо тогда еще один вопрос для понимания а вот эта штука ее можно как то ну там локально сначала отладить понять что я все правильно заполнил а потом уже ну там соответственно кушать и оператор вызывать что она каталась то есть прогнать через какой-то валидатор сначала и ну да но но просто как обычно происходит там я не знаю в том же в git лобби где угодно там вот все что настраивается я малыми да ты такой так я буду делать здесь значит но там сборку тепло и так далее и у тебя типа там штук 30 коммитов каждый из которых тестирует как у тебя будет этот но там все и работы да потому что ты меняешь кушаешь смотришь он обработала или нет то есть здесь примерно такая же методика или ну можно такой же методик но это как бы я ни у нас в операторе есть функция на который вы лидируете то есть если там какой-то мусор совсем уж пришел и какие параметры неправильные то он это от ловит и просто не применит изменения фото в любом случае уже их залил но то есть ну да то есть если даже не в гитхабе есть и уже они залились то конечно они там прилетят на оператор баз данных но он просто их не применит он начнет полотен писать что что то не так но так это уже дело наверное разработчика каждого там всей сети как-то встраивать какой-то тест наверное как а ну можно развернуть лаками крышку бернетт быстренько накатить операторы потестить то есть там две строчки гибаят и докупать всей сети собственный должен быть у нас такой валидации до до этого нет то есть это уже гипс это именно как отлажен процессов компании которые его применяет если есть к этой валидации конечно она должна быть и это круто ну то есть ну там я свою разработчика там докер desktop установлен у него там и купер макс есть и он соответственно может конечно то есть там мини-клубе какой вид развернуть или в докер десктопе для пожалуйста такие идеи понятно а вот тут как раз про про проблемы и prologue интересуется алекс спрашивает как разбирать ошибки если что-то пошло не так мониторинг сбор налогов и т.п. и вопрос был например конкретно там про бэкап ну то есть вот какая-то операция которая там сложно и долго и может быть многоэтапная да вот куда куда нам ходить за за пониманием что пошло не так как вообще это делается обычно но в том числе перк омске операторы но и обычные операторы они предоставляют какой-то функционал чтобы логику дата отправлять то есть такой коварный свой то есть вы стояла там пишется лоб и куда-то отправляется либо там какой то фомин belt sheath логе наши операторы еще но и мало того что мы пишем в блоге все воспитала то есть какое действие централи за централизованное хранилище логов есть она туда будет писаться еще у нас есть поддержка сайт корр контейнеров то есть любой наш оператор любые базы данных наше их можно с помощью санька паттерна расширить на сайт корыто убирается есть порт в пони контейнер из арв дополнительный контейнер добавляется в пакет и потом можешь стать то многие или ловить какую-то сообщение из логов и что-то дополнительно делать то есть как расширить если проговорить именно про trouble shooting сам оператора и backup а то у нас есть вот этот красным resource kit да ему показывал даже тот создал всех сортом псдп и если его посмотреть там за диск рай бить то он прямо на пишет что не так она пишет что не могу развернуть там под потому что или даже сам из бака скажешь не могу сделать backup или быках и залился включи неверные что то такое то есть там будет четко написана с точки зрения юзабилити на многих намного удобнее чем там логе парсить тут как раз вопрос у нас есть про оператор давай разберемся оператор это для развертывания но то есть а потом когда уже у тебя есть соответствующие коды там в вернется с базой допустим то что развернулась дата там у тебя и есть там обслуживание в части того чтобы копыто то есть уже надо там у пользоваться средствами купер мэтт со для того чтобы выяснять а что пошло не так вовремя бэкапы или оператор тоже это позволяет как-то автоматизировать опять яко я говорил зависимость зависит от год оператор но основная конечно прелесть оператор это не диплом да то есть за deploy до оператор это кусок кода который мониторинг убираем sephia ii на создание определенных кастомных ресурсов как uber нити и например то есть оператор да он видит создался новый кастомный ресурс разверну kayaba зуда развернул потом если этот кастомный resource поменялся например как я в дымке показывал поменять там размер says мангуста то есть 3 на 2 это оператор опять же смотрят ага мне надо бы убить 10 господ потому что сэр поменялся или там мне надо поменять конфигурацию в манге потому что он опять же сильно поменялся и так далее и блюз оператор он также позволяет именно делать какой-то made in с баз данных то есть если надо сделать открыть какое-то сделать backup restore это тоже все делает обычный оператор или оператор это не умеет ну это вот я показывал эту мочу ready модель операторов естественно это не очень такой зрелый оператор что он даже на ко панюи делать странно но цель именно сделать так чтобы диплом и менеджмент баз данных губер нити происходил только через оператор чтобы пользователь не надо было ами нечего делать идея понятна а вот тогда наверно такой вопрос вот как понять оператор вот там кто-то их сертифицирует по вот это по этим уровнем зрелости или они там сами себе это сообщают что мы умеем вот только деплоить а там возьмите тот который вот хороший он все у меня нет есть я вынес не сказал что надо сразу бежать и смотреть туда но есть оператор hop или marketplace для больших то и как раз чтобы туда попасть надо пройти определенные чеки и они в том числе вы лидируют что там оператор вообще умеет какие у него есть возможности и если оператор достаточно просто попасть туда просто можно залить свой код там оператора home чарте какой то подправить еще что то и она будет там то сертификации кайшева большие в тот намного сложнее они там мы безопасность прогоняю тест и что там каких пока джею осн их нету и проверяют действительно функционал то есть м т м тесты гоняют вот это такое берилла достаточно интересная но не все операторы и видеооператоров туда идут сразу потому что больше все-таки такая enterprise история и возможно какой-то оператор какого-то оператора да мне на наши есть и крупные все игроки тоже там можно там смотреть что вампирами тут просто интересная такая ситуация но там с одной стороны допустим но я не знаю там дата stax там для кассандра делает это этакий ну то есть и ты пойдешь искать собственно основного не рендера как-то при длительном source и того того кто поддерживает короче родный городок да там confluence для кафки делает оператор там ну и так далее вот а вы же делаете операторы видимо для баз данных для которых бог говоря для пользоваться там их много с одной стороны да ну нет какого-то официального наверное да там для москве для погреться и так далее ну вот для моих тверь у нас наверное такой единственный оператор который есть у которой есть официальная поддержка для нас есть клиенты которые его запускают и к нам приходят и если какие-то проблемы для по сброса есть crunchy есть клаус source у и т.п. оператор то есть у них тоже есть официальная поддержка все достаточно серьезно для манги у них есть атлас до который имеется у сына джо которого имеют диплому бернайс но там все клаус source но у них есть поддержка и миллионов долларов это все стоит как это основная такая проблема ну в принципе то есть ноги на самом деле выбора нет то есть это либо мы либо моем конкурсе выбор есть маска или тоже особо выбора нету именно чтобы поддержка была у оракла вот они начали там пилить бета-версию пока она зачаточном состоянии их старая уже попытка возможно что-то хорошее получится будет кругу ну то есть если мы хотим на такую штуку то мы должны уточнить насчет поддержки давал танцор сам такой то есть как это или кто самом деле это больше конечность или или сможешь эту поддержку соответственно получить для своего бизнеса вот здесь как раз вопрос с интересным знаешь ты можешь рассказать или нет наверное есть особенности достаточно серьезные ну то есть вот ты сам говоришь там для урока допустим нету ну не так наверное легко это все сделать да потому что там тот же mais quel там после уроков вообще говоря не задумывались как база которые будут таким образом когда-либо разворачиваться эдип ловится там если говорим про мангу кассандру с ними наверное там все попроще но сортирование грубо говоря там распределенной работа и все вот это вот это все сразу в архитектуре этой базы вот там того же позориться наверное там гораздо больше всяких проблем приходится решать чтобы иметь возможность таким образом запустить ему у меня совершенно верным прям куча проблем и вы все решаете соответственно вы их решите самостоятельно или с вендором как-то вообще происходит не не самостоятельно то есть мой спрей рон пол появился там в каком восемьдесят шестом году 100 лет назад он вернется до всяких и контейнерной истории и естественно он не готов к этому диплом фку верните особенно самая большая проблема это не самое скрыт наверно a tool set вокруг него то есть например запилить бэкапы чтобы они заканчивались там в с3 баки особенно point in time recovery там берлоге что там сохранять но вот это там целые истории у меня тоже доклад был бы я рассказывал как мы это пилили для возраста та же самая история про мангу ты правильно сказал намного проще сортирование это мы поехали она уже готовы к этому там по падению но нет это не с вендорами это сами все делаем запиливаем или функционал сам оператор а ждем любовь связи с тем что мы вот в такой новый чудный мир пришли каких-то новых вендоров каких-то новых реляционных баз которые но там с одной стороны дают нам там весит транзакции там я не знаю но и все вот эти вот гарантии да там с тобой страны они пригодны сразу к разворачиванию во всей нашей этой инфраструктуре замечательный если посмотреть уже она как то так и происходит то есть какой-нибудь юга байт на это там for конкурса который должен уметь все и танцевать любую дудку тигель и который там сортированный там mais quel уже такие базы данных появляются естественно они появляются потому что у кого-то была какая-то проблема которого не смог решить существующими средствами и надо что-то новенькое создать это и я думаю не и дальше будут появляться потому что равно каких-то проблем очень много но я все-таки верю что например майской какой там 90 выйдет и он уже будет шарден да скорее всего то есть это вот тебе интересно что ты нас их бизнес-модель а потому что они сейчас выигрывает за счет этого вот какие-то такие вещи ну и все умеет уже практически базы данных для всех случаев жизни но да круто ну надеюсь да всё будет круто и все пойдут навстречу друг другу и нас ждет замечательное будущее в этом смысле на сегодня я предлагаю закругляться с докладом и идти в discussion q это обсуждать у нас еще есть вопросики спасибо спасибо всем спасибо за ваше время хорошего дня"
}