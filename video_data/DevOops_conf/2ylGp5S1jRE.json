{
  "video_id": "2ylGp5S1jRE",
  "channel": "DevOops_conf",
  "title": "Даниэль Халиулин — Мониторинг зеленый, но у юзеров ничего не работает. Мониторим клиентскую часть",
  "views": 506,
  "duration": 2761,
  "published": "2024-12-27T06:01:11-08:00",
  "text": "всем привет сегодня мы поговорим про то что же делать когда мониторинг зелёный а у юзеров ничего не работает и собственно Эксперт в том что же делать это Даниэль люн Приветствуем Итак сегодня поговорим про мониторинг сначала пару слов о себе почему вообще об этом я могу говорить Меня зовут Даниэль я технический менеджер продуктов Т банке где развиваю главную систему наблюдаемого банка Sage и мой Фокус по большей части сейчас на внешних пользователях то есть на тех компаниях которые мы продам эту самую систему вообще в больше 10 лет успел поработать в российском телекоме и сре инженером и в телекоме внезапно кувейтского аналитика и разработчика А какое-то время назад в своё время успел поработать отвечать за направление производительности надёжности мобильного банка теньков тогда ещё теньков и за это время было ноль серьёзных сбоев по вине мобильного приложения поэтому мне есть что рассказать про Надёжность клиентов и мобильных приложений в частности и перед тем как мы с вами перейдём к основной части Позвольте вам показать одну классную новую фичу в нашем мобильном приложении А мне кажется что эта фича должна будет просто произвести какой-то фурор или Ну что-то новое в технологиях управления личными финансами сейчас Зацените сейчас загрузится Надеюсь не будет эффекта демо Хотя видите немножко тормозит ничего страшного сейчас перейдём в профиль и увидим А всё что нам нужно блин блин блин блин погодите сек не расходитесь сейчас кое-что глянем сейчас мониторинг посмотрим секундочку не вижу а не вижу никаких всплесков блин за 12 часов тяжело посмотреть Давайте глянем за часок секундочку ну вы знаете как бывает на демо пря мгновение так вижу блин блин 5 минут Давайте глянем Может я в эти вот 38 попал Блин не знаю не знаю непонятно давайте быстро глянем логи так логи вообще есть логи есть Да вроде бы логи Да всё окей Я знаю где лежат логи глянем на них они есть да логи есть Сейчас секундочку я сейчас быстро решу и всё Мы увидим там нас Т ошибки поэтому глянем Давайте на ошибки ошибки ошибки мои ошибки они есть и я знаю свой User ID благо помню поэтому Сейчас мы глянем на эти логи Вот блин это были логи бэнда Давайте глянем логи были логи Давайте глянем логи бэнда Там должно быть что-то сейчас сек Блин а я не знаю я не знаю вы поняли что сейчас произошло прямо сейчас мой классный мониторинг графана моя графана Со всеми нашими дашборда прекрасные логи они не помогли найти мне проблему потому что проблема внезапно оказалась не на серверной стороне А где-то где-то в этой коробочке Именно поэтому я считаю важным поговорить о мониторинге клиентском о чём вот вас приглашаю послушать рад что вы пришли о чём мы сегодня поговорим сегодня мы поговорим о четырёх вещах во-первых мы сделаем постановку проблемы вообще что это мониторинг клиентов наблюдаемой о чём И главное зачем и дальше я хотел сказать вам о некоторых ключевых метках с клиентов которые Лично я по моим личному мнения надо снимать и за которыми важно следить далее я поделюсь некоторыми вредными советами за которыми на самом деле будет скрываться опыт и шишки которые мы добили в деле наблюдаемой клиентов и последнее мы пробежимся по доступным инструментам Я думаю все мы понимаем что не все классные инструменты нам доступны В общем об этом поговорим Итак погнали для начала Давайте определимся вообще с предметом разговора что такое наблюдаемой клиентов что А главное зачем Позвольте немного покатать наблюдаемое такое свойство системы рассказывать о своём состоянии о том как она вообще работает вот случилось что-то с вашей системой быст вы поняли что с ней Произошло это и есть такая мера наблюдаемое хорошая поняли долго неоднозначно и не поняли наблюдаемом и в теме наблюдаемой серве есть уже такие как бы хорошие Ну не хорошие А такие золотые вещи о которых надо сказать обязательно это логи меки трейс типы данных на основе которых мы понимаем что случилось с нашей серверной частью и вот в клиентах всё почти тоже самое клиентские приложения веб или мобилка Особенно в больших проектах могут быть реально очень сложными многомодульная чувствуют О'кей собирать можно всякое Но зачем И во-первых по моему мнению только с наличием клиентской телеметрии можно сказать что у вас есть полный взгляд на то как работает ваша система в целом Если Вы мониторить только сервер то вы можете заметить что какая-нибудь ваша AP отвечает за 200 миллисекунд это просто прекрасно я очень рад за вас но Какая в этом ценность Если ваши клиенты ждут ответов по 5-10 секунд из-за например Привой защиты системы защиты от DDoS которая режет какой-то трафик или есть какое-то расширение в браузере которое а ломает форму оплаты и ваши клиенты не могут принести деньги в вашу компанию как такое отловить без клиентской телеметрии Я хз и если вы читали книгу про сре помните там такую идею там нам убеждали что чем ближе снимать метрики к месту их зарождения тем лучше И тем более они показательны Они зарождаются вот здесь и вот здесь тоже в клиентах дальше Вторая польза рого говоря которая является следствием первой это более высокое качество сервиса Когда у вас есть данные из клиентов Вы можете лучше поь клиентам более обв подсказать например когда к вам приходит клиент и сейчас например ваш объективный пик того как вы можете помочь - это подсказать Ну Перезагрузи телефон ну там устали приложение Установи снова я не знаю но когда у вас есть клиентская телеметрия вы уже знаете что телефон не просто глючит а просто по вашим данным какой-то AP нарушает контракт и поэтому какие-то элементы интерфейса могут не работать как бы вы узнали об этом без клиентской телеметрии Я тоже не очень знаю и тут уместно сказать ещё и повышение про повышение надёжности Когда вы понимаете как какой-то сбой влияет на по-настоящему на конечных клиентов то это намного лучше Например одно дело когда вы знаете что где-то там кластер elastic сча развалился и знаете какие системы с ним интегрированы и понимаете влияние это одно совсем другое дело когда вы знаете как это влияет на конечных клиентов что у них теперь какой-то раздел в приложении не открывается с таким знанием по моему опыту сбои устраняют быстрее на постмортем посложнее забить И когда я пару минут назад сравнивал серверную клиентскую телеметрию Я сказал что там примерно всё похоже почти одинаково такую фразу сказал так вот почему почти В чём отличие работы телеметрии на клиентах первое если в серверной наблюдаемом имеем дело с конечным числом узлов в которых мы там шлём телеметрию то в случае с клиентской конца и края может быть не видно тому кто в вас хочет запихнуть данные если у вас массовый продукт то смело готовьтесь к большому количеству ПС со всеми вытекающими отсюда вещами для Хайда также надо учесть что наверняка ваши клиенты будут слать в вас телеметрию из интернета а это значит что это значит что нужно Быть готовым ко всей нечисти которая там живёт дедос скрипт киди боты если подготовиться хотя бы не инфраструктурной небольшой нюанс тел сказать г ление в сторону вот эти вот куча псов интернеты это один только подход к мониторингу к сбору этих данных с клиентов так называемый Real User Monitoring или он Хорош тем что вы получаете реальные данных с полей и по ним можете строить какие-то свои выводы но есть другой подход это синтетический Мониторинг это когда автоматика сама запускает ваше приложение заходит на ваши сайты ходит кликает что-то там делает и из этого складывается какая-то картинка такие данные не показательны как данные с реальных пользователей но тем не менее они уже что-то могут сказать А если их встроить ещё в пайплайн ваши разработки то о каких-то проблемах вы можете узнать на более ранних этапах Короче я просто хотел сказать что здесь больше одного подхода сказал Давайте прыгнем обратно к особенностям когда мы говорим о клиентской телеметрии то тут появляются некоторые новые типы данных доселе возможно о которых вы не слышали технологии были ещё не открыты а именно например вот такие крыши а крыши - это когда приложение упало когда кто-то не обработал исключение и вот приложение упало там как правило есть Трей Что произошло в том потоке или во всех потоках которые смогли в этот момент затра Кать ещё один тип данных - это inr очень похожий тип данных это Application not responding это когда операционная система например Android Она считает что что-то вы долго не отвечаете на ввод пользователя и она предложит пользователю убить ваше приложение или услужливо сделает это сама Возможно даже с удовольствием такая же штука есть на айосе подобное и на Ну и в вебе ещё один тип данных такой интересный необычный - это плей это реплей Я думаю что понятно по названию Это буквально запись того что делал пользователь в экране только с скрытыми всякими секрети ками которые не надо всем показывать далее одна из особенностей - это более длиный релизный цикл Мы привыкли что на сервере можно быстро что-то зафи и сразу задеплоить посмотреть что будет а вот с мобилка и с клиентами Ну в частности с мобилка всё далеко не так там есть сторы куда С недавних е и нужно пробраться и пробиться в случае наме с асом через огромную огромны там Редут защиты от Apple или в Андроиде Вам нужно будет стимулировать пользователя Ну Обновите на наше приложение Ну Обновите и всё это ну что-то непривычное для тех кто работает девопсом или S и ещё один такой интересный момен ситуации это может быть не так страшно Но в случае когда мы работаем с телеметрией надо понимать что у пользователей могут быть очень старые версии приложения вашего если вы в какой-то версии накосячили со сбором телеметрии например ошиблись с кардинальность или начали писать слишком часто какие-то логи или не написали какие-то важные то это всё оно осталось останется у пользователей на может быть годы и это заставляет по-другому смотреть на тему подбора на тему работы с телеметрией и и последняя здесь особенность о которой хотел сказать Она про то что у всех фронтов всё по-разному на Андроиде данные собирать надо одним образом и там есть свои нюансы на айосе по-другому в вебе по Третьему а там ещё разные фреймворки и короче у всех всё надо учесть а а вам нужно это учесть нам это нужно учесть если мы хотим чтобы картина осталась показательной чтобы вы чётко понимали что там происходит а в общем мы поговорили с вами про а вот эти вот особенности и говоря обо всём этом нельзя не сказать собственно о Метрика о которых Ну я считаю которые стоит собирать в этой всей истории наблюдаемое одна из первых ловушек в этой всей истории как я сказал у всех фронтов всё по-разному и у Вас могут просто разбегаться глаза потому что метрик у фронтов просто дофи largest Full PA DNS если не мобиль и не фронтендер то будет очень непросто но вы сильно не переживайте Всё самое главное я вам сейчас скажу если мы поговорим о мобилках то то с чего стоит начать это шаг номер ноль и то что нужно это как фундамент использовать это сбор Роше или inr никому из клиентов не нравится когда приложения падают или намертво зависают Поэтому вот этот тип данных которые нужно собирать в первую очередь так вот если вы будете собирать роши и а исправлять и вообще на них смотреть это уже для мобилок будет реально очень большой шаг вот просто одним этим шагом Вы можете значительно улучшить и наблюдаемой и Надёжность вашего приложения ещё одна штука которую хочется сказать это то что очень полезно считать тайминги не считать а знать тайминги самых важных сценариев вашего приложения Как быстро запускается приложение как быстро происходит авторизация А может быть у вас какие-то есть ещё внутри специфичные сценарии и тут Важно сказать что знать тайминги важно в первую очередь с точки зрения клиента потому что клиенту собственно не так уж важно как быстро вы записали данные или считали данные из локальной базы данных там в браузере или в телефоне а вот за сколько открылась какая-то важная форма вот это то что важно знать и то что важно отслеживать например Мы в мобильном банке а какое-то время Серьёзно Очень вложились в тему быстроты запуска И время от того когда клиент нажимает на иконку до момента когда у него открылся главный экран со всеми загруженными данными мы пили на порядка 10 этапов и каждый этап мы начали трекать и наблюдать релиз к релизу какой стал больше какой стал меньше почему И это не один раз открывало для нас глаза на некоторые вещи которые стали ну которые могли негативно повлиять на перформанс со стороны клиентов А что дальше ещё одна информация которая была много раз нам полезна - это метрики но метрики не со стороны сервера а со стороны клиента прямо из приложения благодаря тому что эти данные они снимаются прямо с клиентов очень интересно иногда покопать А почему тайминги так отличаются Почему AP отвечает там 200 миллисекунд а у клиентов там десятки может быть секунд что тут вообще происходит И вот однажды была такая история что мы обнаружили что один из операторов связи резал определённый сегмент по сети он точнее замедлялся и у них медленнее работало приложение и вот как бы мы об этом по-другому узнали я не знаю но хорошо Что узнали и помогли разобрались с этим операторам связи ещё одной прикольной особенностью этих меток является логирование тайм-аутов вот из-за особенности того что из себя представляет ошибка тайм-аут А я думаю что мы все понимаем что сервер о многих тайм-аутов просто не знает Потому что до него не Достучатся быть проблемы Вот если с клиентов снимать эти тайм-ауты то очень классно видеть что же там тайм-аут сразу определённый Пласт проблем становится открытым и понятным и В общем эту штуку Я рекомендую собирать а не ещё дальше чуть расскажу потому что с ней мы наступили в одну очень мощную подводную кораблю а весьма полезная информация ещё оказалось логирование ошибок Вот это да да невероятно логировать ошибки но не просто ошибки все а ошибки которые мы показали клиенту на экране причём с логирование прямо текста ошибки Особенно это оказалось полезно в процессах поддержки Потому что когда Клиенты приходят они почему-то очень редко говорят с каким IP методом возникла проблема они обычно приходят вот с таким скриншотом и благодаря тому что мы стали это логировать поддержка стала быстрее понимать что же случилось и сами инженеры которые с этим работают стали тоже лучше и быстрее понимать потому что вот когда вы смотрите на это Это что Это Timeout Exception или config not found Exception или ер какой-нибудь ещё Exception А по тексту сразу видно что привело к этому продолжая тему взаимодействия с AP хочу сказать что полезно ещё сохранять на клиенте В общем информацию о взаимодействии сервера Какие ошибки были когда какой-нибудь трейс ID одно дело когда к опиш неком приходить и говорить типа ребята у вас там счита медленно работает и другое дело когда вы приходите и говорите что вот Trace ID вот тайминги по моему опыту кто с такой информацией приходит тому намного охотнее помогают а во-вторых такая информация может быть быстро выявить нарушение контракта А между клиентом и сервером естественно в реальном мире ну в идеальном мире никто не нарушает контракты но я думаю мы все с вами всё прекрасно понимаем поэтому ошибки парсинга вот этих вот респонс это один из полезных видов ошибок вот как здесь на скрине видите Field unfinished FL is required Но дальше But it was missing и вот Очень полезная информация и Однажды мы положили очень серьёзно мобильный банк Вот такой проблемой Если бы у нас были вот такие вот ошибки было такое логирование то исправляли бы мы не 2 часа а минут пять но Что есть то есть ещё одной полезной метрикой оказалось трекать название экрана на котором клиенты закрыли ваши приложение то есть не просто Они свернули а именно убили приложение и мы находили интересную корреляцию что если на каком-то экране пользователи начинают чаще обычного убивать приложение то жди вот где-то там вот ещё может быть нигде не началось Но вот тут Сейчас начнёт стрелять Вот и вот у нас такие вот есть замечательные графики где можно сразу увидеть по зае сразу видны пики Если вдруг что-то случилось кроме графиков на эту тему Есть алерты деле есть другие типы данных просто это вот я захотел про один тип данных показать где сразу видно Какой экран какой был Рей и ссылочка чтобы дежурный сразу пог разбираться что же там случилось и Давайте ещё пару Мек изба для какого-то равновесия мы поговорим изм она конечно не говорит о времени загрузке всей страницы а о том как быстро загружается самый большой значимый элемент на странице и это больше говорить на самом деле о ощущаемой производительности чем о реальной и в общем если у вас самый большой элемент загружается быстрее 2 С5 секунд то по Бенч маркам это считается быстро а ещё одна полезная Метрика это inp interaction Next Paint Она говорит о том как быстро ваш сайт ваша страница реагирует на микро взаимодействие пользователя вот он нажал на выпадающий список Как быстро он выпал вот он нажал на какой-нибудь попп как он попап нул быстро и если это всё происходит в рамках 200 миллисекунд то по бенчмарка это считается Круто Вот такие бенчмарки и ещё одна довольно важная Метрика - это ACC layout Shift это мера того насколько интерфейс дёрганый насколько он Shift он смещается Ну я думаю вы такой сталкивались открываешь сайт и там какое-то время всё туда-сюда скачет и вот это мера того как это может происходить например вы выбрали какую и ш сат пото ре спросить А Вы точно хотите это ВС заказать и вы такие Блин нет не хочу вот вы хотите нажать нет но дурацкий баннер сверху появился вы нажали Да и какого-то бизнесмена обрадовали классным заказом вот об этом эта Метрика что ж мы поговорили Теперь вот о Метрика Давайте поговорим про вредные Илю большого удовольствия честно говоря хочу признаться что мы мобильное банке это сделали с успехом и не раз поэтому хочу как раз поделиться некоторыми такими граблями чтобы вы ноги сохранили для каких-то других фич более может быть полезных и первое С чего бы хотел начать это посоветовать помните это Вредные советы Я ещё не раз об этом скажу потому что есть такая инверсия Первое что я хочу сказать это то что не переживайте В общем за размер клиентской телеметрии рано мго много тревоги чтобы об этом переживать во-первых не следите за трендов за трендами на объём данных которые вы льё не делайте алерты на это Пусть пишут как пишут это мобилки сайты что там они могут написать не вздумайте говорить ещё тем более разработчиком фронтов о том что надо следить за тем что они будут писать они от такого абьюза могут уволиться во-вторых Не надо пожалуйста ограничивать входной поток ведь нам важна вся информация леком 100% или ничего не думайте никаких Рей лимите Никаких квотах никаких ограничениях всё или ничего а что же на самом деле и как-то раз я обещал сказать про меки мы запустили те самые меки в мобильном нашем приложении и вот мы запустили Мы работали Мы ждём идёт раскатка на клиентов Мы ждём Вот они обновляются 100.000 обновилось смотрим на эти метки 500.000 Милн 200 Однако Вот это предвкушение очень быстро сменилось напряжением после вот сообщения господин Андрей который отвечал за ту систему которую мы сли эти меки был несколько удивлён трафику 30к событий в секунду - Это примерно 2 С5 млр событий в сутки положа руку на сердце мы тоже были удивлены что же мы там такое шлём И представляете мы нашли баг оказалось что помимо этих Сарик мы е одну метрику туда шм которая про ВС что можно это была Метрика времени обращения к конфигуратора и мы записывали в метрику Зачем нам эта Метрика вообще нужна была точнее мы знали она была нужна только на этапе дебага Она не должна была уйти впт но в общем случилась Вот такая вот ошибка коллеги включили сапли на своей стороне Мы побежали выпускать фикс где перестаём писать эту метрику и хоть коллеги были Нам очень благодарны за такую помощь с тестированием их системы Я хорошо усвоил урок что следить за объёмом телеметрии из клиентов очень важно далее не вводите пустых ограничений на использование инструментов наблюдаемой не создавайте каких-то барьеров на пустом месте Пусть каждая команда которая делает клиент Сама решает Что ей делать сама выбирает инструменты во-первых дайте свободу инженерам выбрать систему мониторинга пусть у вас будет много систем мониторинга мобилки пишут в centry и в firebase Web Пусть там не знаю в Яндекс метрику и тоже какой-нибудь свой сентри Пусть поднимет главное никакой обя залов пусть у вас будет зоопарк инструментов Зато они все подходят под конкретные нужды это свобода выбора во-вторых дайте свободу в выборе sdk которые собственно собирают эти данные из клиентов Пусть каждая команда сама выбирает какой sdk использовать и какую версию этого sdk использовать Ну и что что у вас будет Теперь несколько из диев собирать одни и те же данные Ну и что что теперь Приходится их инициализировать ничего страшного Лучше пусть вообще ребята напишут собственные инструменты Если вдруг на это есть время Фух В общем что же на самом деле а на самом деле зоопарк систе мониторинга будет совершенно очевидным способом приводить к тому что инциденты будут решаться дольше потому что дежурному который будет разбираться с проблемами нужно будет мало того что быть Гуру центри Яндекс метрики елк Что ещё там появится ему ещё нужно будет продираться с доступа не знаю как вот у вас но когда я с Тим сталкивался одной из вещей которы меня раздражал - это доступы нужно зайти туда зайти туда и в а у нас сбой надо решать что случилось И в общем Понятно к чему это приводит и второе разнообразие таких систем мониторинга приводит к стоимости эксплуатации этих самых систем компания вынуждена больше тратить времени денег на то чтобы это всё по вложился в новые проек в новые инструмен в рение каких-то проблем департамент будет вкладываться Вот в поддержку всего этого добра и какое-то время назад на самом деле банк рисковал попасть в такую же ситуацию когда сплан которым мы все пользовались в т банке ул из России встал вопрос а командам свобо вы или сделать централизованную систему какую-то купить или разработать свою и тогда решили пойти по пути собственной разработки и разработали Sage Sage - это платформа наблюдаемой собственной разработки внутри Т банка логи метрики трейс система всё это обрабатывает переживает имеет мощный язык запросов кстати в начале Когда вы видели этот перфома это как раз я в этой системе смотрел логи Ну и самое важное наверно Одно из самых важных В этой системе то что она оптимизирована под большие нагрузки шутка ли весь Т банк с кучей своих систем пишет каждую секунду и данные в эту систему и она прекрасно себя чувствует на самом деле Всё зашло настолько далеко что решено было даже разработать собственную базу данных для хранения логов с hdb который сейчас уже работает в продакшн режиме внутри Т банка если вам вдруг стало интересно зачем вдруг понадобилось писать свою базу данных типа ребят вам совсем там делать нечего Вы ещё базу данных решили записать то рекомендую всем доклад Лида команды логов которая пишет как раз эту базу данных Саша Беркова ссылка на QR ведёт на доклад на Озоне где он выступал с этим докладом что ж продолжим про клиентскую телеметрию В то время как разнообразие этих систем мониторинга приводит к тому что сбои решаются дольше и стоит дороже поддерживать разнообразие клиентских Изе приводит к тому что у нас раст to maret то есть время оно раст естественным образом потому что разработчик вместо того чтобы делать фичу разбирается а этому из как обращаться А к этому как обращаться и как с ними работать и это всё естественно увеличивает время когда находит своего пользователя и второй неменее важный недостаток она про негативное влияние на перфоманс большинство таких изв для наблюдаемое себя инициализировать на самом старте Естественно они трез ловили раннем этапе Но это приводит к тому что когда вы запускаете там приложение или открываете сайт это происходит так что вместо того чтобы сайт и всё что там есть работало на то чтобы быстрее показать контент там инициализируется куча всяких ске Ну спасибо и отсюда кстати возникают шуточки про то сколько рама нужно современному вебу и Сколько памяти нужно современным мобильным приложениям для работы Вот например вот отсюда в реальности же Я призываю вас использовать единую систему мониторинга конечно это возможно или хотя бы единую для клиентской телеметрии Ну и договориться с разработчиками ваших фронтов о том какие zdk мы используем А какие мы не используем в идеале ещё написать доку о том как правильно это использовать чтобы было может быть безобразно но единообразно и следующий вредный совет я напомню Это Вредные советы переложите Бремя сбора диагностики на клиента если клиент обращается с проблемами в техподдержку то я вот так предлагаю собирать информацию во-первых не принимайте репорты без видео Мы все знаем что клиенты умеют снимать видео с телефонов с Веба у них всегда есть время это делать и они только ждут на самом деле этого момента Поэтому если нет видео сразу мимо кассы второе обязательно просите клиентов выгружать текстовые файлики ваших логов просите из консоли копировать просите р вот этот вот из Network в ме вам копировать клиенты все это умеют делать и с удовольствием Вам помогут И последнее здесь а забейте на то чтобы заранее думать на тему сбора телеметрии просто Подумайте лучше на тему выбора из DK Это вообще лишняя вообще совершенная информация Ну а на самом деле я советую уделить время с фронтами время тому чтобы заранее подумать о том как мы будем помогать нашим клиентам когда они к нам обратятся Вот у него не будет работать сайт Или что-то пойдёт не так или мобилка как мы будем помогать И это хорошая отправная точка начать думать Какие данные нам нужны естественно сразу всё очень тяжело найти и собрать все данные но хотя бы с чего-то начать и вот такими итерация Может быть вы придёте к тому что у вас будут все необходимые данные второе сделайте сбор диагностической информации простым для вашего клиента помните что на самом деле это вам и вашим компаниям надо чтобы у вас была вся телеметрия для помощи клиенту это нужно этим самим нашим компаниям А если чего нехватает чтобы пользователь и без проблем эти данные собрать ему не нужно было смотреть А что там у конкурентов А как у них работает может быть у их нет проблем таких и например вот на скрине можете увидеть как Например одно приложение из подкастов это сделало там есть специальная галочка если её нажать то приложение со всей силы будет отправлять телеметрию для разработчиков чтобы они там разобрались что случилось в мобильные банки мы столкнулись с такой Темой Что для того чтобы нормально помочь клиентам нам нужны ну понятно подробные логи писать подробные логи мы не можем потому что у нас очень много клиентов и это будет очень дорого хранить но помочь непонятно как помоч когда Нет подходящих логов но писать подробно мы не можем и вот такую дилемму попали и вот как мы её решили решение было в так называемых о логах суть этих логов в том что эти логи хранятся на девайсе клиента и просто так никуда Нея не обрадуется скажет Спасибо за логи за то что Вы ходите их на моём телефоне вот благодаря тому что мы не платим за хранение этих логов вот в нашей инфраструктуре мы можем описать с нужной подробность опять-таки оговорюсь там настроена ротация логами мы не забиваем а получается что у нас на телефонах клиентах хранятся подробные логи того что происходит в мобильном приложении И самое главное происходит тогда когда клиент обращается к нам в поддержку или мы расследуем какой-то инцидент мы можем навесить на клиента специальный флаг и При следующем запуске мобильное приложение увидит что на клиенте есть специальный флаг высылаем логи и мы выкачиваем с телефонов клиента все логи Ну логи нашего приложения которые только в этот момент были и затаскивать себе инфраструктуру поэтому с одной стороны мы получается остались с подробными логами тогда когда они нужны с другой стороны мы не завалили ифру вот такое вот решение получилось что ж и последняя грабля о которой я хочу сказать она про не осознанную работу с данными телеметрии Прежде всего я Рекомендую вам не вести это Вредные советы напомню Не рекомендую вести никакой документации не записывайте что вы где собираете Какие типы данных логи никакой реестр всё это не нужно это бумажная волокита А мы ал да это же ал Правда же и поэтому вот это ещё не нужно нам писать второе не парите насчёт того как внедрить эти собираемые данные в реальную работу а как говорится война план покажет просто собирайте эти данные если они кому-то понадобятся кроме вас то как вы знаете кто ищет Кто хочет тот ищет возможности найти данные А кто не хочет тот ищет причины почему он не может их достать поэтому Ну это всё Оставьте а на самом деле что на самом деле на самом деле Я призываю вас документировать документировать того телета которую вы пишете Заведите себе доку репу где будет описано и поддерживаться то что вы будете слать хотя бы в каком-то виде во-первых Вы можете таким образом защититься от сбора дублирующих данных Потому что много раз бывает Особенно в больших компаниях что одной команде нужны одни данные другой команде нужны тоже эти данные но они друг о друге не знают поэтому реализуем два сбора данных будем отправлять эти данные дважды и вот Дока хотя бы теоретически может помочь себя Ну защитить от этой всей истории и с другой хорошо с другой стороны хорошо описанные логи могут помочь в том чтобы проводить экономить время на диагностике потому что рано или поздно старички которые эти логи писали которые ещё помнят как даже без документов помнят как это всё работает Они из компании уйдут и вот те кто останутся будут очень благодарны господам предыдущим если они это за документи и будет понятно что и зачем пишется у нас в мобильном банке Мы в своё время немножко упоролись и стали документировать то какие мы логи пишем и что они означают Ну не пря вот все все логи но довольно много логов благодаря тому благодаря вот таким наличию такой документации Да примеру документации есть поддержка это прикольно поддержка стала у них появилась такая опция без помощи разработки расшифровывать логи и смотреть А что же там у клиента было хотя бы в каком-то виде А ещё прикольное что они навер свои скрипты которые стали по логам им какие-то давать подсказки что вот эти логи скорее всего об этой проблеме говорят и мы какое-то время здесь стали это классно и второй здесь на тему этого совета интегрируйте данные в повседневную работу не знаю как вы А я работаю в больших компаниях много раз видел что данные начинают собирать данные тестируют А после того выпустили впт Ну они не то чтобы сильно кому-то нужны посмотрели разок Ну и пусть пишутся что там уж но ком за обрат А это на никому не нужно поэтому Думайте о том как это сразу интегрировать работу в виде дашбордов в виде алертов может быть какие-то проверки которые будет делать дежурный И на самом деле если работать с какими-то данными создавая какие-то такие данные телеметрии вам лень подумать о том как их интегрировать то это на самом деле хороший Сигнал хороший сигнал о том что может быть нафиг не нужны эти данные никому и может быть не нужно их собирать вовсе В общем Think about что ж мы поговорили про Вредные советы Давайте теперь пробежимся буквально голом по доступным инструментам которые есть сейчас на рынке вообще ну я не претендую на исчерпывающее какое-то объяснение но о нескольких инструментах хотелось бы сказать во-первых нельзя не сказать о сентре это просто ну как бы обязательно об этом нужно сказать это классный инструмент для работы с клиентской телеметрией у не есть бесплатная версия версия там много классных фичей прямо на уровне самой системы и на уровне sdc Однако есть проблемы с перформанс и довольно быстро centry может себя Ну перестать ввозить нагрузку которая вам нужна к сожалению у меня здесь нет каких-то бенчмарком но в общем я это сам видел и другие коллеги тоже подтверждают Классно что СН подходят и для Веба и для мобилок и классно что Данные есть у вас просто какая-то сказка Может вам показаться а firebase Crash letic следующий инструмент это тоже бесплатный инструмент от Гугла это стандарт Ну можно сказать стандарт индустрии для мобилок для Шей но он подходит только для мобилок ещё одна важная штука то что там данные хранятся по сути не у вас они принадлежат Гуглу а это в общем я думаю вы всё прекрасно Сами понимаете но штука очень классная очень много чего имеет следующий инструмент который вам хочется сказать - это трейсер это бесплатный инструмент для сбора крышей анров и всякой диагностики с мобильных приложений хочется также отметить что это а он сейчас пока работает только только для мобилок не для Веба и важный здесь момент это то что это Отечественная разработка это разработка компании Одноклассников и даже скажу больше господин Кирилл который меня представлял в самом начале он являлся и является одним из главных разработчиков этой системы Вот и эта штука реально очень классная Поэтому если у вас мобилки очень рекомендую туда посмотреть и попробовать но есть минус данные хранятся не у вас в общем Каждый решает сам насколько это большой минус и ещ од одна такая выходящая звезда можно сказать это глич тип это подобный сентр инструмент в котором можно собирать данные из Веба и из мобилок он менее требователен к железу и более за счёт этого производительный чем сентре у него есть бесплатная версия и плюс данные тоже все у вас лежат под рукой что не может не радовать в общем мы сейчас очень быстро пробежались по инструментам Давайте резюмируем о чём мы поговорили мы поговорили о том что мониторинг клиентской части это я накиды мысли почему это важно Надеюсь вы мне поверили второе клиентской телеметрии есть некоторые особенности мы их назвали четы штуки вот там про релизы высокие нагрузки вот это вот всё было далее я рассказал здесь написано что лучшие практики лучшей практики по моей версии о том какие какие метрики стоит собирать клиентов в первую очередь о них Мы тоже поговорили дальше ВНО рассказал вам о некоторых историях которыми мы себе по ногам постреляли и что есть набор инструментов набор доступных инструментов признанных которые можно удобно использовать И последнее что я хочу сказать Здесь тема оберти наблюдаемой в целом она очень Широкая и большая и по ней объективно нельзя знать всего поэтому особенно актуально оказаться в комьюнити в котором можно задать вопросы по этой теме и получить ответы от каких-то опытных людей кто в этой теме реально шарит Так что если тема наблюдаемом интересна то приглашаю вас в наш чатик с Community в телеграме там мы обсуждаем наболевшее новинки и всё актуальное в теме мониторинга и оберти не только клиентских приложений А вообще что ж на этом У меня всё спасибо вам за внимание Спасибо большое особенно спа упомянул трейсер э кстати решение для Веба тоже скоро будет ребят обязательно э ну Спасибо ещё раз Даниэль за доклад обязательно сканируйте QR код оставляйте фидбэк это очень важно для Даниэля как для докладчика также и для всей организации кру чтобы делать конференции ещё лучше А ну соответственно Есть ли в зале вопросы молчок первый Спасибо за доклад у меня такой вопрос вот накосячили выпустили какую-то метрику которая пошла мягко говоря так спамить что дальше делать это мобильное приложение вот не выглядит самое простое просто всё забил давай делаем новую что в новых Иначе она будет если это какие-то ошибки да то есть мы их просто потеряем на фоне вот общего спама вот что в таких случаях с ВМ что зделать изп потому вот а тут есть несколько вариантов во-первых спустя пару разов мы начали делать приложения закладки которые от этого защищают то есть есть например мы стали делать некий набор белый список метрик которые согласованы которые надо Ну можно отправлять и этот список ведётся динамически приложение в какой-то момент своего там жизненного цикла получает этот белый список если этой метрики нет в этом списке то даже если она там где-то собирается она не будет отправляться Вот и за счёт этого мы если где-то косяк нули мы можем ту меку просто из этого конфига выбросить и тогда ну это не будет с мето собираться или там какой-то Лок Вот Но это вот такой вот Костыль У нас появился вот часть ещё вещей мы костыли просто на сервисе сбор логов вот там где приходят логи мы хотели очень этого сбежать когда-нибудь мы до этого доберёмся но по сути мы там просто сделали логику набор иков которые вот вот ве Тото Тото и Тото там есть Тото в строке то пожалуйста не надо вот Но это вот это второй вариант это то с чего Мы начинали ивки потом в какой-то момент мы пришли к динамическому Конфигураторы Наста зать кардинально интересно пап послушать Давайте лучше мы в дискуссионной зоне его обсудим Вот Но в общем мы реально целый пайплайн на вернули который теперь практически Ну ну в природе почти невозможно теперь взорвать кардинальность через мобильное приложение нашей метрики вот а подробности Я готов Дино зоне там поделиться а Поднимите руки Кто знает что такое кардинальность мерик Ага А конференция это то Наско мера уникально знаний вот высокая кардинальность - это когда много-много уникальных значений какого-то лейбла в метрике какого-то параметра В метрике если А их уникальных значений много то это не очень хорошо для системы которые хранят эти метрики Потому что они не готовятся Если вы там User ID положите то Ну системы типа там Victoria metx promus они не очень обрадуются тому что это будет работать Это просто вот дизайн этих систем которые собирают метрики такие Да там как правило алаб кубы внутри им короче очень плохо там этот размерности Куба просто зашкаливают А спасибо А вот ещё у молодого человека был вопрос да спасибо за доклад У меня три вопроса но один такой э первый вопрос Как вы можете доверять а задержкам от приложения до ваших сервисов учитывая что сейчас шестилетние Дети знают что такое VPN то есть Есть у вас какое-то там исследование по geoip или что-нибудь в таком духе второй момент не боитесь ли что в момент выгрузки логов из девайса к вам какой-нибудь злостный хакер загит какой-нибудь пало в Ваше логи и третий вопрос Почему ваша система находится в рубрике Вредные советы Спасибо за вопрос единстве я вот первый не до конца понял и третий первый вопрос Как вы насколько сильно Вы доверяете задержки запроса от клиентского приложения до ваших серверов учитывая что там могут быть включён VPN или ещё какой-нибудь системы понял и А по что последний Почему ваша система мониторинга Sage находится в рубрике Вредные советы А извини у нас времени совсем мало тебе из трёх придётся один выбрать самый важный первый первый первый а так первый первый первый первый про первый вопрос а Напомни про что Давай я лучше отвечу на второй и лучше Заходи в ционные зону я сразу всё скажу почему мы не боимся что там данные кто-то перехватит на самом деле не то чтобы ну не боимся переживаем конечно за это Но мобильное приложение Т банка - это как бы такая очень излюбленная цель хакеров выкладывая приложение в Store Мы точно знаем что будут пытаться перехватить точно будут реверси гарантированно вот мы точно знаем что перехватит и будут верть и поэтому там есть от этого защиты вот помимо защит сами такие логи не должно быть там есть для этого внутренней защиты в пайплайн попасть никаких секретных данных То есть если кто-то эти логи возьмёт Ну в общем-то ничего такого страшного уж и не случится вот он наверное Ну сможет что-то понять что внутри происходит приложение но клиенту это не грозит мы как бы не сильно за это переживаем вот поэтому у нас вот такая вот история А на остальные два вопроса заходи и вопрос больше в том что сам клиент э необязательно заходя в приложение а модифицирует логи сам файл с логами и отправит их э ну подождёт пока вы их сами к себе загрузите угу ну а мы здесь клиенты не требуется Никаких действий это полностью происходит автоматически з доклад посмотри там они сами себе под 2 млрд логов свали вот если у тебя злоумышленник туда что-то даже найдёт Ну напишет найти вот эти вот модифицированные логи среди 2 млрд понимаешь Ладно спасибо большое э за ещё раз за вопросы докладчику за доклад"
}