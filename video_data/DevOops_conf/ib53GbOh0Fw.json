{
  "video_id": "ib53GbOh0Fw",
  "channel": "DevOops_conf",
  "title": "Анатолий Солдатов, Виктор Гамов — Kafka и инфраструктурные сателлиты",
  "views": 671,
  "duration": 4297,
  "published": "2021-04-30T01:29:20-07:00",
  "text": "всем привет сильно телеологии до силы технологий собрались все виртуально в питере не успел посмотреть делать там на самом деле кто где сидит но давайте что ль по очереди так у нас доклад как я понимаю с двумя спикерами первый спикер это виктор гамов виктор помахай нам ручкой вот он отлично анатолий солдатов отлично привет анатолий и в роли приглашенного эксперта александр миронов напоминаю если вдруг кто-то забыл эксперты до такой человек который будет задавать свои коварные вопросы докладчикам возможно даже ретранслировать их из chateau общем активно помогать делать доклад максимально интересно и что ж давайте чтобы не красить ваше время я думаю ребята представьтесь лучшая картинка о себе расскажете о доклад и давайте уже его послушаем ли я начать с александра баранова как с экспертом ну давайте да конечно всем привет когда меня зовут саша я работаю в компании stripe как инфраструктура инженер сейчас занимаюсь в основном системами и континенты гришин deployment а не всего что с ним связано до этого почти пять лет работал в booking.com где занимался разработкой внутренней системы стриминга данных и по той самой части мое собственное знакомы с ребятами сегодня вот да как сказали буду 8 экспертом сдавать свои коварные вопросы но пожалуйста пишите ваши в telegram черт потому что это будет намного интереснее живее и передаю слово то ли давай к следующей да давайте начнем я надеюсь все таки меня слышно кивните если все ок да реакции саши всем привет мы сегодня поговорим про путь который мы прошли во vita используя внедряя патч кафка то есть изначально мы посмотрим что же вообще это за зверь и как и вот эти довести до полноценного продакшена дальше посмотрим на технологии которые позволяют сделать капка еще мощнее и в самом конце мы затронем такую тему как устранение вот это вот рутинный админист тивной работы когда вас костров капка уже становится на самом деле много и вы делаете очень много таких повторяющихся ненужных действий как заставить машина работать за вас как сказали на предыдущих доклада по 2 псу надо уволить всех всех админов но теперь devops поэтому мы будем об этом тоже рассказывать как да как граните машинами были людей и немножко про ожидания доклада этот доклад в первую очередь нацелены на ребят которые уже знают что такое кафка понимают как она работает знают куда ее можно применять но вот только только в начале пути и занимаются внедрением как раз кафка в компании мы постараемся вот весь этот путь вместе с вами сегодня пройти и вторые ребята которые тоже мог которым тоже может быть это полезно это уже опытные администраторы даты инженеры которые могут посмотреть а как мы сделали нашу инфраструктуру и может быть возьмут себе на заметку пару технологий а может они также знают да еще должности до давайте еще раз тогда представимся меня зовут оля и работает от инженером барита и самого начала как я попал на это я занимаюсь кафкой первую очередь и как саша уже и сказал пытаюсь сделать ее более мощный иногда более странный например создавая очереди поверх кафкой там разрабатывая белку или что то такое что в принципе в кафки изначально из коробки не планировалось до меня зовут витя я работаю в компании контент мы делаем свою платформу мы делаем этот шкаф q для людей мы немножечко кантри beauty но как немножечко мы сильны кантри улетим в кафку меня можно найти везде в интернете если меня тяжело найти в интернете только coyote маркетолог и develop a black неправильно поэтому приходите в наш канал в телеграме который называется про кафка там чат и есть канал в канал иногда бывают новости он не был высокого трафика вот чак хороший там спрашивают издают много интересных правильных вопросов поэтому давайте поедем дальше хватит уже о нас давайте поедем дальше и перед началом вот этого всего мяса хотел бы немножко добавить контекста чтобы было понятнее на слушать и для начала давайте расскажем откуда вообще вали то появилась кафка нас как и у многих компаний года три назад даже наверно больше начался распил монолита и это было связано с тем что появилось большое количество сервисов которые взаимодействовали между собой синхронно и вот эти синхронные связи они часто ломались а если это были цепочки последовательных вызовов сервисов то ломалась вся цепочка что было еще хуже и соответственно сайт работал не так надежны как мы бы хотели мы решили посмотреть сторону синхронного взаимодействия и чтобы это обеспечить стали применять думать о том как применить паттон массаж брокер и следующая задача которая перед нами встала соответственно выбор вот этой технологии которые станет носить брокером во всей компании мы рассматривали несколько решений можно подробнее почитать про то как мы вообще проводили выбор в блоге ссылка здесь есть на слайде внизу ну и в итоге мы конечно пришли к пачиков к я думаю ни для кого это не секрет и очень счастливы этому решению до сих пор он ни капли не жалеем на данный момент у нас около сотни сироп даже больше обслуживают закипит и кафки мы принимаем порядка 25 гигабит в секунду входящего трафика и там у нас около 800 к авента в секунду но что в принципе не не особо показатель просто совет красивая циферка до конференции говоря уже красивеньких цифрах я тоже немножко добавлю себя что мы не просто добавляем какие-то дел делаем делаем упакованную кафку и стрижем купоны мы еще запуска и маковку на клаудии у нас уже за последние три года когда вот у нас запустился уже такой продуктов у нас уже видно рост собственные интересы что люди переключаются как раз на мене что решение решения которые решают проблемы за них и сейчас на данный момент вот на где-то середина 2020 года у нас порядка четырех с половиной тысяч кластеров различного размера которые бегут в канкун клал эти кластеры и включают в себя не только кафку они включают себе другие компоненты которые мы сеем тоже поговорим он включает себя и управление схемами включают в себя коннектор и так далее вот поэтому ну как бы немножечко разбираемся мы в вопросе и вот здесь вот мы нарисовали точнее у кого-то украли забыли к сожалению ссылку ставить мы исправимся картинку во время этого доклада мы будем взбираться на вершину этой горы где самом самом верху нас ждет дзэн и просветления ну и начнем мы путь самых верхов самых азов сначала поставим кафку потому что без этого никуда далее рассмотрим основные части которые должны быть готовы уже перед тем как вы в кафку запускаете в продакшен это мониторинг и бэкапы и туда же мы относим схемы менеджмент хотя на самом деле многие компании в продакшн запускаются без этого но тем ни менее лучше все-таки делать всё правильно дальше посмотрим на такие технологии которые в принципе не всем нужны но довольно-таки сильно облегчают жизнь и иногда прям очень сильно спасает это коннекторы прокси и потом уже на подходе к вершины этой горы мы посмотрим на немножко более advanced штуки это в первую очередь жизнь нескольких дата-центров и вот это вот устранения рутинные работы про которые мы тоже говорили пусть срабатывает наши ли мы время от времени будем чокаться и понимать где мы находимся поэтому такая для вас будет карта вашего путешествия вот мы посчитали что таком раскладе всегда вы всегда интересно показывать вы находитесь здесь и давай начнем с такого традиционного наверно вопрос а ведь тебе что же такое кафка то есть многие говорят что это стриминга vaio платформа многие говорят что это же вообще просто лог кто то говорит что это база данных и я знаю что ты думаешь что это что-то еще что ж это такое это хороший вопрос и этот вопрос часто звучит в во всех в чатах во всех конференциях и так далее нельзя доклад парковку рассказать без рассказы про что же такое кафка на самом деле есть интересная такая байка которая говорит о том что когда например несколько экспертов на фонтане так сказать встретили не эксперт мудреца и 345 мудрецов были с с плохим зрением они встретили слона и начале этого слона трогать потому что никто до этого этого слона не трогалась отрубали слона за разные места кто-то трогал за хвост кто-то трогал его заноза хобот кто-то трогал там за еще что-то и в итоге все сошлись на на разных мнений кто-то потому что это изменяет dota подумал что это опросам туда подумал то что то такая же столь с кафкой потому что кафка она всегда немножечко вот это ее такой сильная сторона и и и такая интересная слабая сторона которой позвали создает вот этот непонимание до конца что же такое карта самом деле это большая система которая в зависимости от того с какого бы grown да вы пришли она позволяет вам взглянуть на мир с тем всем взглядом который вы имели до этого поэтому вот здесь стали сказал что на самом деле есть пойти на описание кафки в на сайт апачи дот орг кафка по что то увидите что такое event streaming платформ это платформа для потокового обработки или хранения каких-то ивентов каких-то событий что же такое на самом деле вот в каком то степени если вы трогали различные базы данных носику база данных и вы понимаете как работает там какой-нибудь кости fishing и как и данные будто ст уделяться и как клиенты будут координироваться с брокерами эта информация вам напомнить то как работают системы баз данных если вы начнете копаться в кафку поймете что там есть топике от опеки соответственно помнят вам и какой-то magic системе и поэтому вы начнете думать о том что как же кафка поможет вам решать какие-то задачи обмена сообщениями если вы вот опять же как бы пример здесь приведён если вы начнете на это смотреть и увидите что кафка хранить данные на диске хранит их в файле который существует только над на добавление это тоже похоже на какую-то долгосрочное хранилище вот на этой картинке в принципе она показывает как и кафка может быть интегрирована с различными частями что могут быть приложений с ней взаимодействовать могут быть какие-то системы которые позволяют строить дашборде взаимодействуя с кафкой кавказ то стал стало таким вот многофункциональным инструментом который стал использоваться в различных областях если вы опять же не смотрели и не знаете что такое вот кафкой хотите вообще углубиться в начало есть такой веб-сайт называется давала пир тот конфликт дата ее еще раз давал этот конфликт дадаев и там есть видео там есть картинки которая полностью объясняют детали что такое топике что таки пар тишины поэтому на этом сейчас сильно акцентироваться ним не будем мы уже я пойдем давайте дальше до более интересные темы и ты здорово говоришь поэтому я оставлю наверно тебе микрофон расскажи про установку вы находитесь наверное начальном этапе самый простой способ как вы можете взять кафку это вы можете пойти на сайт то кафка dota почти до торг скачать и распаковать его запустить звуки пир запустить кафку все в шоколаде вот она собственно вся установка на самом деле как как известно во всем во всех областях у нас есть определенные нюансы которые есть если например просто пойти и погугли счета может выспаться различные ссылки если мы там бубном пачиков к скачайте бесплатно без sms можно попадать на разные сайты опять же первый сайт это там где все лежит всегда это камень тип сайт когда-то почти до торг мы в свою очередь так как апачей в лицензия версии 2 разрешает коммерческое использование разрешают внедрение или встраивание продуктов из-за почесав the foundation в другие вещи зачастую можно встретить различные дистрибутивы очень похоже на то как это сделано там в том линуксе например лицензии немножко другие но вот мы у себя начали так сказать наше наше путешествие в мир как бы в построении кафки создание так называемым комфорт платформ то что это такое мы мы берем apple собственную кафку мы ее отвешиваем различными пулами которые мы разработали у себя мы о них тоже поговорим про коннекторы про прокси простым ridgid re и так далее и запаковываем это прогоняем какие-то свои интеграционные тесты и выкладываем это тоже в в отдельном виде также так как почиталось не запрещает коммерческое использование мы построили на этом на этой же основе мы построили коммерческую платформу там есть определенные инструменты которые связаны именно с enterprise и мы не одни такие умные да то есть и другие вендоры которые делают практически тоже самое есть колдера например у них если да это платформ у которой кафка встроена как один из элементов потому что мы есть и ходу там есть и spark там есть чего только нет есть другие поставщики данных там тот же там можно пойти посмотреть и кафка практически если вы делаете какие-то дата и манипуляции сегодняшний день она включена в другие другие другие поставка есть практически повсюда ну то есть если подытожить в двух словах мы это говорим наверное больше не в таких общих познавательных целях когда вы так и начинаете вам нужно определиться с пакетом если вы точно знаете что будете использовать голую кафку и больше ничего то больше ничего сказать не нужно идите скачивайте apache кафку и складировать если вы знаете что вы пойдете дальше то скорее всего легче взять либо камни летели enterprise версий у какого-то крупного вендора потому что он подсыпал туда уже сахар всякие удобные скрипты всякие удобные технологии и пользоваться этим будет значительно проще я начал когда еще я не работал когда vkontakte grabber начал разработку я взял контент платформ потому что у них были удобные тулы для разработчиков как запускать как пандарии мы даже теперь значит куда мы это ставим да но самый простой мы поставили сюда ноутбук ноутбук вы не отнесет продакшен поэтому мы для нас есть определен и места куда мы обычно есть есть свои сервера мы естественно ставим свой дата-центров мы берем обмена за грудки он нам выписывает определённое железо и мы запускаем там кафку по поводу определенного железо мы еще поговорим сейчас через несколько минут чтобы выбрать это железо нужно немножечко разбираться что вы делаете нужно разбираться что вам нужно и так далее есть такая байка что linkedin но не просто пайка эта история которую свои если антигена рассказали что в linked и никогда откуда кафка собственно пошла существует такая вот для всех там предложений для всех сервисов для систем они де плотно так и называемую то них назад пиццы бокс но по сути дела это как это типовая конфигурация железная для кафки же у них есть существует специальный механизм для заказа более мощного железа более мощный дисков и так далее то есть люди разбираются они понимают зачем это нужно также кафку можно в принципе запускать где угодно потому что она опять же разрабатывалась стартапер забрался линки дыни когда у них не было может быть столько денег сколько у них есть сейчас чтобы покупать какие-то мощные машины разрабатывались все современные носик валдис трибетить системы с таким учетом что они могут бежать на обычном войска моде тихого то что доступно практически везде вы можете зайти в как сейчас популярный магазин деталь магазин радиодетали собрать компьютеров там и на них запускать кафку можно запускать на виртуалку можно запускаете в кубе я кстати вот об этом мы разговаривали на митапе вами то над был тот ссылочку здесь добавить действие к кому интересно спасенные звони в 3 раз а что же с точки зрения тех людей которые просто хотят использовать кафку хотя ты и может быть даже потрогать в начале да то есть перед тем как куда-то инсталлировать есть опять же облака облака что интересно в для кафки тоже разнятся есть определенные уровень такого пользовательского экспириенса например если пойдете вам escape the вам такой добавляется кафка экспириенс поверки си туда вам все равно нужно понимать какие железки вы запуск на каких железках бы это запускаете они просто дают вам возможность нам этот этот пакет разливать по и счету сервером если вы например там разработчик и там используете heroku например к примеру потому что heroku очень хорошие примеры того как вот построена облака для разработчиков там тоже кафка у них присутствует вы можете ее просто добавить себе как как сервис свое приложение и можете начать мыслить сталь пошли другим путем и сделать такую полностью сервер лес платформу да то есть у вас с одной стороны вы можете ее использовать как как сервис потому что оно вам даст вам кафку для нее будут один your username and password также поверх этого можете запускать коннектор который будут приносить данные выносить данный также поверх этого можно запускать какой-то processing виде хихикал db и так далее и тому подобное то есть это вас вам не нужно долго на каком же бейся бежит как и тоске лить мы это все дело делаем за вас достичь до главная приводится с вашим подходом соли я буду тебя иногда перебивать чтобы правильно ли потому что потому что мы-то налила и можешь говорить мы можем очень много нового знать в общем на самом деле во многом зависит еще и от вашей компании если вы везде используете свое железо вряд ли вы при инсталляции катки пойдете в облака и наоборот если у вас есть возможность выбрать конечно надо смотреть искать ну давай тогда расскажи нам про что выбирать и что что мы должны делать вот эти установки в свой dato sand of chi обе . с уже была своя платформа мы само начало жизни сначала швеции в дата-центре потом переехали в москву и всегда находились на своем собственном железе и тут у нас в принципе не было даже особо выбора ох теперь и шел куда то не туда я давай я приду обратно вот вернулись на слайды и у нас не было выбора выбирать между облаком и ленине облаком мы решили сразу на жилья составить все это и обмене самостоятельно ну просто потому что у нас была уже команда у нас была уже железо у нас был опыт и мы так умеет делать она главное работает здесь одна из мыслей если у вас какой-то подход работает вам принципе достаточно просто его продолжать использовать и ничего там не искать еще лучше этого добра добра не вот соответственно когда вы все-таки ставить это все на желез вам придется немножко побольше подумать чем про кладут в чем в том случае когда вы идете в клауд и вот это вот основные point и во-первых какие требования к железу здесь есть такой сайт называется кафка new это по сути калькулятор какое карту я вам нужно заказать исходя из ваших требований посмотреть на файловую систему кафка хорошо работает на x4 на xfs мне говорили что на за этот раз тоже хорошо работает на не провал подумать про версию кафку если вы только начинаете тут принципе все легко просто берете последнюю стабильную версию и можно даже не думать дальше если вы используете кафку какое-то время и вас там например на 11 или еще старше то лучше подумать о том чтобы обновиться потому что у нас постоянно выходит новое правление там 2 и 3 появились различные фишкой для джильберт оптимизация компактно 2 и 4 большая поддержка мульти диси 2 и 5 завезли 133 л.с. и так далее так далее кафка все время улучшается нет смысла сидеть на старых версиях дальше надо посмотреть на конфигурацию кластера из коробки club кафка идет настроенную где-то посерединке между фрукты latency вам нужно понять свой кейс хотите ли вы терять данные не хотите важно ли вам пропускная способность или вам нужно как можно быстрее доставить данные до клиента и покрутить пара ручек на скорее всего если вы только начинаете вам на 1 год с головой хватит не надо залезать крутить все подряд более есть довести тулы которые подавляют вам замеры производить есть есть встроенные тулы но и для первых тестов и есть опять же контент сайт здесь ссылочка внизу который рекомендует параметр из которых можно начинать какие-то такие осмысленные в том числе струнин г-н клиентов брокеров закиров ибо в летнем чем стоит подумать и двойной боярами кластера мы сначала поговорим на эту патологию ну соответственно с кафкой все понятно вы ставите ее на отдельные машины и желательно чтобы эти машины были в разных дата-центрах если такого нельзя сделать хорошо бы чтобы они были в разных стойках но если вам приходится ставить это там на одну физическую машину виртуалка h1 физическая наша отказывает вас как ты больше нет поэтому это самый плохой случай вот закипит повеселее потому что закипели часто могут использоваться в рамках компании коммунальная такая база данных который ходит все и обычное ней еще ответственно нет вот это плохой путь лучше так не делать если у вас такая возможность есть потому что падает этот за кипер падают вас там весь сайт проекта так далее и восстанавливать кафку без экипировку очень большая головная боль есть такое мнение что если вот есть в компании hadoop и у него есть звуки пир то к нему можно прям вот присобачил что можно то что сказал толи не делать обломков к используют закипит немножечко по-разному и разный profile нагрузки идет на закипит а если вы еще используете какого-нибудь и не знаю как то назывался этот грейтер который набор паттернов для этого самого меж процессного взаимодействия и и прочего то это еще третий вариант нагрузки по это потом можно туда еще crack house и добавите получится бедный-бедный кластер за киперов который будет долго наверно работ на когда-нибудь он вас подведет поэтому лучше всего деплоить маленький класс стараются киперов под каждый класс парковки каждую как биологическое объединение нескольких классов да например в рамках одного департамента можно держать там за кипер только под карте отдельный один вот его тоже надо разносить на несколько центров в общем те же самые требование к железу как и у карте вот и надо подумать насчет количества мы его вид везде тепло и 5 за киперов потому что они дешевые потому что у них там совсем чуть-чуть лежит на диске но зато во время инфраструктурных работ мы можем один выключить второе потерять все равно продолжать работать над ровд мы соответственно уже не сможем так сказать окей с остановкой закончены и дальше нам надо убедиться абсолюно сок и и чтобы понять где мы есть вы находитесь на следующем этапе что мы делаем мы не ставим слайд натуризм что мы делаем чтобы чтобы понять у нас хорошо работает это мы продолжаем наши возгордились и следующий этап без которого но вообще никуда продакшна это мониторинг мониторинг вклад кафки эта задача не такая простая с одной стороны да он уже там во многих случаях написан можно в графа не скачать тимплей тип соус будет хорошо тем не менее кафка состоит кафка распределенная система состоит не только из брокеров noiz'a киперов клиентов и так далее кроме этого чем дольше вы используете чем больше вероятность что она вас обрастает различной инфраструктуры и кроме которую тоже надо мониторить и пока коннектор и из коробки у кафки идет очень большое количество метрик которые вы можете есть соблазн самого начала смотреть на них повесить их еще хуже на пейджер и вас тогда вот этот видос метрик приключиться из-за которого вы либо будете просто постоянно выспаться либо пропустить нужны метрику не среагируете и поэтому есть несколько метрика экшена был который стоит смотреть первую очередь витя может рассказать про это потому что у него довольно таки большой опыт поддержки клиентов и того когда их можно будете смотреть что все плохо существует несколько таких подходов к мониторингу и что именно мониторе что именно смотреть есть разные школы например если пойти презентацию посмотреть linker и но у них есть определенный взгляд на то что надо мониторить посмотреть презентации например наши какие-то комфортными шапиро например очень много рассказывала о мониторинге свое время когда она была продукт менеджер нашего мониторинг тула но мы пойдем от как бы так сказать всенародного знания потому что большинство людей большинство людей соглашается о том что можно мне пожалуйста о том что мина из минусов андрей пакетик партий шин это одна из таких очень важных метрик которые нужно смотреть но ее нужно смотреть тоже с осторожностью потому что она зачастую является такой метрики который показывает что-то плохо но оно не показывает что конкретно плохо эта метрика она является индикатором того что где-то что-то идет не так это означает что где-то на какой-то из ноги есть пар тишины у которых например отстают от мастера принцип работы у кафки заключается в том что запись происходит всегда на лидера партии шины чтение происходит лидер партии на реплики используются для того чтобы там делать какой-то пуловер и в некоторых случаях можно настроить клиентов чтобы они читали с репликами которые что это подходит например для molded с and дипломе но всегда идет запись на на мастера то есть это никак не влияет на производительность вашего приложения например это влияет на производительность вашего класса например если вы видим андре политики практически нас можно проверить как ведет себя сеть не нет ли какой то старейшин нам тех нотах где на пробег не доходят можно проверить состояние живьем а потому что например может быть там где-то получился джесси и поэтому сетевой сетевое взаимодействие была поставлена на паузу поэтому эти реплики будут они догонят и в какой-то момент поэтому здесь это это реплика на которую метрик который нужно смотреть но не обязательно сразу звонить админу звонить девелопером и всем и так далее там подобное поэтому метрики сетей мистер решили здесь является дополнительно вещи которые вам нужно видеть и смотреть а is our это такая in sink реплика это специальный параметр который задает позволяет вам настраивать your ability как вы говорите по-русски герой или договорим дерби надежность надежность и то что данные там будут записаны в внутрь внутрь файл системы если происходит не не сопоставлению чтобы если одна топике прописан определенный мина is our и этих реплик меньше чем мины и сортов скорее всего где то есть шанс что можно потерять данные и с точки зрения предложений смотреть как ведет себя консьюмер то есть тот кто читает собственно в каске большинство задачи связано с тем что многое будет читатель ну а муж название кафки там литература в литературе много читатели так далее поэтому консилер лайк это очень важная метрика которая покажет вам насколько хорошо ваше приложение которые читают данные работают и читают и поспевают за тем как данные производится но опять же она не является такой вот то чтобы прям вот звонить админу как были во времена messaging system да то есть вы видите что в вашем вашим къюба смыслю набивается большое количество сообщений скорее всего приложения в дауне и надо звонить потому что если переполнится может быть мисочки у рухнет в кафки это не так зачастую может быть например поменялось какая-то логика в приложении он там не поспевает за объем из общей может быть надо добавить несколько новых консьюмер чтобы этот консьюмер like пошел вниз тут я тебе тут я ещё добавлю то что в концу мерлок если он увеличивается это возможно и не страшно или если он постоянно и на какой-то единиц главное осмотрительно отношения если он растет вот тогда наверное что то идет не так прогрессию как раз до мониторе канада изменения тем не менее все равно мониторинг строить нужно вот те метрики которые мы показали они именно наших для требующий реакции вы можете добавить свои или убрать какие-то это то что вас там потенциально по будет посмотреть что же там происходит в целом вам нужно иметь обычно несколько уровней мониторинга чтобы было легче ориентироваться и в первом случае начинаете без того выполнять и львы гарантии которые даете сервисом это слово мониторинг и дальше начинаете спускаться сначала смотрим все club все катки в компании 0 там департаменте потом смотрим конкретный класс стр потом брокера давайте посмотрим поподробнее на каждый из этих уровней соответственно выслала мониторинге мы просто смотрим за теми гарантиями которые мы сами же и дали сервисом мы наверняка дали гарантию о том что кафка у нас доступна на чтение на запись или кафка там имеет плотность ниже какого-то парада плюс удобно изменять еще и роль budget то есть мы сказали то что у нас слова сколько-то там девяток в течение там допустим месяца и вот в течение этого месяца чтобы понять можем ли мы инфраструктурные работы проводить или только гнать хотфиксы там супер критичными изменениями мы как раз смотрим на error budget если мы допустим нам имеем 30 минут времени в которой мы можем там даже сделать downtime если о все равно выполнится значит мы можем проводить инфраструктурные изменения не значит на 30 минут к в кране а если нет этого то все тогда мы это все фрезер и только хотфиксы катин настоящем уровне мы с ото сна смотрим вот как раз на эти экшена был метрики смотрим то что у всех костров там отношении брокеров и там же киперов нормально этом ну выйдя к единице да то есть все брокеры активные разделить на все брокеры всего равняется единице смотрим вот эти отметки и сао ран дыры такие штат андер прикид можем сюда добавить оффлайн парте шанс потому что значит то что в этой партиции нету лидера тоже довольно важная метрика и ну например если смотреть графа не это выглядит вот так то есть кучу кучку строф мы видим то что database production 89 брокеров это небольшая видимо там была баня метриках но общего там девять должно быть понятно и видим что там на одном из костров нас например андрэ крикет артюшин однозначно дальше проводиться и посмотреть что там на следующем уровне мы смотрим такие общие показатели именно для костра включая различные сетевые штуки смотрим сколько вообще байта входит и выходит в этот костер отношению к тому же времени допустим неделю назад потому что возможно у вас там обычно намного больше трафика а сейчас вот каким то причинам его там практически нет и на посмотреть что происходит смотрим сколько контроллеров их должен быть ровно 1 если их 0 или больше одного это значит что-то сильно не так смотрим на концу мерлок общей то есть если он вдруг у всех концу миров например идет вверх то тоже скорее всего это какое-то проблемы и ну вот например можно сделать графику примерно такого вида дашборд и здесь вот мы видим стрелочку справа подробнее это по каждому брокеры можем провалиться уже соответственно бью брокера и здесь мы смотрим метрики которые прямо внутри уже конкретные машины говорят нам о том что же там происходит если мы хотим копнуть ещё глубже и или если мы проводим первый тест и например кафки мы хотим посмотреть где происходит задержки то есть посмотреть сколько времени сообщение проводит в кью сколько она проводит до того как типа до того как ремонт брокер отправил подтверждения что он данные тоже получил записал хотим посмотреть размер прага тория вот это вот очереди как раз на отправку как быстро происходит лидер election и довольно таки важный параметр который мы смотрим это network про source он говорит о том насколько у нас сетевые труды и загружены если они сильно загружены обычно они должны быть войду большую часть времени если это не так там и соответственно идем в конфиге и тянем это увеличивая количество этих трудов времен так это может выглядеть но перед тем как даже не всегда нужно иметь все и какой-то бой zloy чтобы понимать чтобы не насильно должен был один да да да да я согласен него можно например с помощью первых продюсеров концу миров себя посмотреть и дальше исходя из этого уже дальше менять параметры можно даже автоматизировано просто перебирать разные смотреть идешь будет лучше вот здесь на слайде видно как мы это построили то есть у нас есть различные экспортеры prometheus графит консул для discovery буру или его аналог от тесла и концу вверх rush нас tracker он отличается от bruce тем что он показывает лак во времени то есть там минуток секундах условно и под капотом сауна бурю использует на самом деле центра монитор используется для cosmo интернет тоже разработка link ты ну как и бурову и grafana для визуализации на схеме это прощенный выглядит примерно так то есть мы диплом сервер там есть консул агентом есть вот этот http gemix экспортер регистрируемся в консоли пролетаю счас концов выполнить понимает где у нас там новые брокера появились идет забирает скрипит метрики джебом и как один из data source of доиграв она выступает либо второй путь это у нас в убираетесь развернуты вот эти вот отложению сервис буру ericsson про монитор который был раньше кафка монитор недавно переименовались через стандарт правда эта церковь в графит и опять же графом вот но это конечно не единственный способ построить мониторинг есть альтернативные инструменты в альтернативных инструментов здесь подразумеваются что на самом деле у меня есть такая шутка я себе вот сейчас на камеру не видно у меня есть даже гордо такая типа дней без нового мониторинг тула для кафки вот 2 недель назад ехали эту штучку обновил потому что вышел еще один мониторе и поэтому сейчас написан типа пока две недели без нового мониторить пула мы в confluence одним из инструментов которые мы предоставляем как это прайс это наша control центов соответственно там есть определенные то что мы зовем апеннин эти просто мы считаем важно смотреть в первую очередь метрики которые позволяют подключаться и смотреть вот это тоже похожие вещи как говорил то леса с точки зрения кластера с точки зрения брокера может сделать был давно так далее есть если вы используете do the dog у них есть прям готовый дашборд который позволяет избежать данной сказки между как бы нами девочками мы очень много используем дата долго у себя внутри клауда мы тоже используем этот пул внутри который позволяет нам агрегировать многие вещи которые например не те которые связаны с склада сложить инфраструктуры так далее есть а провайдеры аналогичные есть например у краудер и тоже есть monitoring tool ace stream им чего-то там есть lynsis тоже то очень хороший свои очень интересным его им который позволяет наливали метрики есть это раньше он назывался по моим кафка менеджером анализировать как а в к manager точно его многие использовали от яху долговым как все всей армении если подставлять что такое bootstrap css фреймворков можно вспоминать всегда тыковка менеджер который это было тихо он такой весь вот такой стандартный его инженерный дизайн есть много других инструментов опять же если пойти погуглите очень много control center кстати если вы разрабатываете если только начинаете хочется вот вы поиграться посмотреться он доступен для привело к цска лицензии бесплатно то есть вы можете его отдам локально у себя запустить платформу со всеми фичами и вот control center будет доступен бесплатно без каких-то лицензию он вечен какие-то идеи можно себя потом перетащить свой мониторинг уже на листе знаю потому что все эти места подбирались когда к стоякам умные ребята это все вещи доступны и как джеймс dmx метрики которым можно вытащить чего угодно хотите через ходить через dmx агент чужого на вот поэтому да побежали дальше с монитором мы закончили но всегда есть вероятность что то это что-то пойдет не по плану и когда что-то идет не по плану конечно же мы говорим про бэкап и мы практически уже нужно нам то ли бы капец а вот это интересный вопрос на самом деле здесь двояко можно ответить во-первых нам надо сразу уточнить что мы говорим и про бэкап и буковки про бэкап и пера отдельно с точки зрения кафки мы решили для себя что мы все таки не бы капельки потому что это из коробки отказоустойчивая система если мы ее настраиваем правильно да и эксплуатируем правильно то есть у нас есть несколько дата-центров мы используем раковин с то есть мы говорим то что разные реплик за реплицировали и копии данных они будут всегда в разных дата-центрах они все в одном если мы там за неимением дата-центр образные стойки с разными лучами питания все это диплом то принципе и у нас есть команда он кол которая быстро умеет обрабатывать это шутить что происходит там пройдя нам не нужны и бэкап и потому что во первых кафка это все-таки не всегда базы данных периодически да конечно и в ней очень часто ладана и меняется там есть red engine они приходят уходят и там что за бы как у вас будет не так непонятно и во-вторых в кафки могут храниться очень легко то байты данных там да за неделю за две или больше или петабайты и такие бэкап и они могут быть очень дорогими о ценностях будет не небольшая потому что уроните класс app карте так чтобы нельзя было его восстановить но сложно довольно но можно вот но все-таки если хотите бы копить конечно есть с 3 коннекторы например про коннекторами чуть попозже поговорим и это возможно вполне вы можете все это знать быстрее и там хранить сколько хотите скоро появится тир стоишь в принципе в этом даже необходимость не будет вы можете так про несколько дитя разгибаем немножко подруга недель на у отдельно взятых людей уже есть уставать и контент он уже есть но он реализуется потихоньку open source и правда там какие-то проблемы кажется что он не совсем следует кипу тебя так of control and proposals и собственно про типы это мы сейчас обсудим тип 500 который говорит что скоро кафка останется без гипера соответственно эскизы теперь не будет то и выкатит ничего не надо но к сожалению пока это не так бэкапы за киперов здесь я как раз читаю обязательный во первых это потому что они дешевые то есть вы можете там музыки прах частыми десяток гигабайт данных там куда-нибудь скулить но очень просто в общем backup а за киберов каши не прошу не просят в отличие от кафки они очень полезны и потому что если ваши данные то скаламбурил прям вот набрал покажу ну как же без когда мы браков и если вы закипели все-таки потеряли то бинарные данные как-то раскиданные по брокером бы через кафка дам можете заскрипеть но это будет вообще не про real-time у вас будет downtime довольно-таки серьезный и скорее всего вы раньше сдал боитесь чему все данные обратно вы говорите вот при этом имея backup периодически которые снимаются вождения дравствуйте деле у вас такой проблем не будет но когда вы их снимаете нужно их обязательного лидировать это можно делать очень просто разворачивает день в докере и просто проверяя по конкретным путям за над зануда это то где хранятся сами данные в гипере все вот эти метаданные карте если там то что вы ожидаете увидеть например класс 3 из 3 брокеров у вас по пути брокер садист должны быть 123 если они там есть окей следующие там такая же лёгенькая проверочка и считаем что бы как у нас есть и они развернуться обратно не они просто снимаются bacopa мы закончили в принципе мы можем считать что мы уже как бы в роде то на самом деле осталась еще одна тема которую витя сейчас вам расскажет здесь вот такой интересный момент который важно понимать что особенно это важно вот системах и например как работает во вид и когда есть отдельная команда когда предоставляет инфраструктуру для разработчиков и зачастую если мы говорим про какой-то обмен данными между различными сервисами хорошо было бы если бы у нас был бы какой-то контракт между этими сервисами а то бывают случаи что там договорились про один jison а потом появились и новые требования кто то поменял кому-то не позвонил кому-то не до рассказал и в итоге получилось что у нас одни ребята поменяли джейсон на своей стороне и у нас там три сервиса попадали потому что они могут распасться джейсон или они попадают какая-то ошибка сир лизации так далее значит это бывает за из-за того что кафка в принципе ей вообще все равно чтобы не и кладете есть люди которые тут файлы в нее не только вко это поддерживать я это не поддерживаю поэтому есть некоторые моменты которые нужно рассмотреть и и и перед тем как эти вот на пол и это важно для как раз систем в которых вы не 1 то есть вы ни один пользователь система вы паства построили определенное взаимодействие между этими системами значит мы сейчас находимся в районе схема менеджмента и давайте немножечко поговорим что это такое и зачем это нужно это такой раздел управление данными и больше даже управления качество данными схема определяет контракт схема если у вас есть например какой то и пьянь какого-то сервиса да то есть у вас написано что есть ожидается входной параметр в выходной и это вот вы должны поиметь схема паху обладает похожим свойствам схема определяет контракт этих объектов схемы могут изменяться как я уже при привел пример что кто-то решил поменять как какое-то поле добавить поле или изменить поле и из-за этого это не должно приводить тому чтобы все компоненты системы падали или там не могли распознать и так далее поэтому контроль этих изменений тоже очень важный поэтому одним из способов контроля это versio нирования и поддержка так называемой эволюции схем а то есть когда у нас есть версия 1 версия по это нормально что все изменяется но это нужно контролировать если вы занимаетесь кафкой не фоллауте гвен шапира как говорится shame on you вам нужно пойти в твиттере зафолловить greenhopper она ну совершенно потрясающий человек просто по жизни плюс еще она знает очень много интересного и с этим очень часто делится в твиттере и она сейчас работать над вторым изданием книжки каркаде finiti в гайд так что подписывайтесь на ее twitter и она говорит что вот если вы выходите за пределы вашего диет означает выезде вонтон уходите и у вас нету каких-то проверок или нету возможности контролировать совместимость вот этих данных значит где-то в продакшене ожидайте проблем как работает схема реле принципе с кем регистре пришла из такой из дыры которую создали в avro в овраг обратно тоже про проект в apache of the foundation и этот жир и говоря о том что нужен сервис который позволяет писать и читать схемы пары став продюсер ваше приложение должно иметь возможность чтобы взять а ваш объект зачастую на суше могут говорим про мульти языковую среду вот например я программирую на джо витале программирует на год нам нам нужно писать сервисе который умеет обмениваться друг другом этими сообщениями я не могу подложить сюда туда java рискую стерилизацию потому что нога они не буду знать что с ней делать да она и не очень хорошая награда тоже есть какая-то своя цивилизация которая на джаве прочитать не смогу поэтому есть средний формат которые вот понимают все до такой интернете то что называется intermediate line лишь который описывает формат схем есть про табов мы знаем это его ребята тоже любит потапов схемы раньше позволяет из prada bag схемы хранить есть avro которые любят big data ребята hadoop и прочее хранится там для больших таких современных или кипрских решений все либо джейсон якобы хе мун redbull но люди тоже его не мечтают просто он постится как легко и можно выводить в виде текста информации схема для чего им туда засунуть схему и вообще прекрасно это сокращением объема данных вот это тоже важный момент который схема решает в определенный момент о нем тоже иногда забывают потому что схема позволяет вам отделить вот эту схему от вашей от вашего пилота и сделать те данные которые хранятся в карте достаточно маленьким потому что ему было состояться местах пойти все да все так то есть у когда проводила данные биржи долины конфи мира да это немножко мешает как раз чтению обратно потому что без этого без этого кусочка вытягивания схемы ты не поймешь что же ты вычитал то есть это разные компромисс ли значит у нас в компом платформ есть схемы jetstream и она тоже доступно бесплатно полностью колдовала было всё такое это идея хорошая почему потому что мы видим альтернативной племена ции то есть выход для стремимся сделать свою схему в azure недавно за тепло или из eskimo s3 который который там работает осуждает и стремимся как он называется один сайт я слышал я слышал то ли что вы тоже используете какую-то схему ridgid re да мы тоже используем соответственно свой собственный скин реджис ты на самом деле это обоснованно просто революционность указ нашего подхода здесь стоит еще раз вспомнить если у вас компании что-то работает пойдет опять переключаюсь мне все ребра саре вернулся как терминатор в общем если у вас что-то в компании работает то не надо это изменять и в нашем случае у нас уже был свой собственный формат данных бриф про него можно посмотреть на докладе ссылка ниже и мы под этот прям сделали отдельный сервис схем как видите сказал раньше по сути это просто базу до рест ebay и и все и готово вот и это бриф нам как раз дает возможность абстрагироваться адресовано про то авра или чего угодно он похож очень на брата на самом деле но это еще один уровень абстракции то есть мы не говорим какую какой формат данных сервис обязаны использовать мы говорим что вот они абстрагируются использует гриф а что там внутри их уже особенно не касается это дело платформы вот такой подход тоже имеет место быть главное чтобы у вас был хоть какой-то схема mandium вот с точки зрения того что ским реджис ты вся копирует это я тут ставлю 5 копеек что в принципе подходы кафки все копируют то есть тот же самый пульсар да он же делает себя совместимым с кафкой это самое там различные схемы менеджмент решение делать себя совместимыми с саске морис такое первопроходцы я можно сказать точнее пока иметь самые узнаваемые вот эти вот протоколы которые придадут как бы дурное дело не хитрое на самом деле это не так сложно сделать как как может показаться ну что значит что мы пришли production но вы же не осталось нас нам не чего на 120 минут потом 22 живем отлично да ночью у нас по таймеру все хорошо я проверяю это на моем кухонному таймер и который верен своему балаганом это использую для готовки кафки и вот этот мой мой таймер показывает что есть время значит такой варим теперь про ту штуку что кафка не существует отдельно да то есть в самом начале мы показали слайд что все дороги ведут в кафку давайте чуть чуть чуть чуть поговорим как они нас ведут сюда как бы продолжаем продолжаем юморить и каламбурить значит сейчас мы поговорим про технологию кафка connect значит только вот нам сам приключается у меня наверное за забанила я переключаю мы позвали мира корректоры которые которые позволяют нам делать очень прикольные вещи давайте значит как вы их обычное приложение у нас в обычном приложении кафки есть java и 5 стандартно неважно если мы пишем на джаве если мы пишем ногой есть какой-то вот теперь который определяет продюсеры костюме продюсера тот кто пишет костюмы тот кто читает то есть когда нам нужно взаимодействовать с какой-то внешней системой мы что делаем мы пишем какой ты какой-то кусочек кода который читает из внешней системы и каким-то образом это всё обрабатывает и перекладывает нам в кафку то есть это так мы делали до 2000 какого 2015 наверное 2015 году появился маковка connect появился кафка connect позволил вот эти вещи немножечко абстрагировать он позволил нам создавать именно только ту часть которая будет заниматься вот этой переработка непосредственно например взять данные откуда-то чтобы кафка connect смогут дальше их положить в коробку потому что стандартная часть это везде всегда одинаковая то есть нужно все реализовать если по возможности можно дёрнуть схему если можно быть сделать какую-то трансформацию немножечку то что называет массаж да то есть немножечко подработать вот эти данные чуть-чуть их под это под массажировать поэтому архитектуры получается вот такая кафка connect по сути дела это такой runtime и такой плетей шин сервер который не бежит внутри кафки бежит отдельно отдельно и в ее можно за деплоить как мы уже знаем лучше тепло из все на отдельные машины чтобы управлялась это дело лучше он позволяет как раз вот этот часть которая занимается source коннектор sim коннектор этот вам как разработчику имплементировать а все остальное может быть стандартно вы можете взять какие-то стандартные вот эти самки то что называется сингл messages фармишь который позволит и делать какие-то изменения данных например бы учитывать и системой в которой там будет ннн этот ннн нельзя класть в кафку потому что нельзя хранить эти данные или кафка не является объектом который позволяет хранить эти ннн я просто не совсем знаю как устроена система как бы защиты информации там например в россии но вот у нас есть например данные который медицинские на помехи и чтобы эти данные хранить в системе карты там должно быть определенные требования соблюдены зачастую люди хотят просто получить какую-то информацию про я не делает аналитику просто по количеству людей там прошедших через как утомительность учреждения и мне нужна информация тип поэтому они могут ее отстегивать перед тем как она падает в кафку это очень важно 0 какие-нибудь карты банковский здесь сами можно распрямилась они же можно сказать про то что это все-таки в отличие например от кисик это действие над конкретно одной записью там никаких агрегатов нет чего-то такого более сложного есть определенные умельцы которые могут запихивать какие то стоит full трансформации внутри сумки но в принципе я считается это неправильно потому что если если насчет получится пусть видео там будет видно почему это неправильно с точки зрения как это все работает как это все параллельно как это выполняется он скейл есть два типа коннекторов это source коннектор который читает данные откуда-то например у вас есть оракал базы данных или из прогресс из нее нужно вычитывать есть возможность вычитывать из-за традиционного logo или возможность учитывать через таблицы путем вы вызовы золотом какого-то до сих пор стоит на то есть sim коннектор который выгружать данные сказки то есть после того как вы сделали какой-то processing вы что-то сделали на нее ваше приложение там записала в кафку вам нужно это выгрузить направо куда дашборд например на ластик есть син коннектор который постоянно читает данные сказки постоянных пушат в власти обновление например и холод этого search индекса простые преобразования реализуются с помощью самки простые здесь очень важно не они должны быть достаточно конечно не должны иметь в себе никакого хранения состояния потому что это может привести к определенным проблем некоторые фреймворке кафка идет с определенным набором там is in this например там есть возможность конвертировать до время мы вычитаем из базы данных в базе данных она хранится в формате в формате не знаю там unix timestamp а нам нужно положить это в какой-нибудь и не знаем из а форма мы сможем применить is empty которые это дело трансформирует таким образом нам не нужно делать это дополнительным каким приложением это все дело пересчитать можно сделать на сайте конверторы это еще один компонент не путать с опять же с как это называется если черненко понят который люди бывают converter позволяет например работать со схемой направить из конвертов который позволяет трансформировать схему которая пришла из контакта потому что в контакте есть определенные правила по каким нужно оформлять эти данные и и схемы и например произведет а враз him all который по положит в тот же самый steam реджис тогда все кто будет читать этот топик который с этими данными будут иметь доступ к этой схеме это такой очень неявные и многими почему-то не используемый способ как раз обработка когда схема динамически создается из схемы баз данных и тогда эта схема автоматически становится доступно всем как работает коннектор seo логика impul имитируется как раз на части вот этого коллектора который работа с data source of как только все вычитывается из без этой и там база данных или какой другой системы происходит ее трансформация и потом передает передается это все конвертору которая уже в бинарном формате в стандартном записывать все это дело внутрь кафки где же найти эти коннектор где же найти эти коннектор есть множество способов найти коннекторы первое это за гулять и можно попасть на гитхабе каких-то коннекторов но зачем гуглите съесть и как бы какаха бы мы сделали свой коннектор папку в которой мы свои коннектор выгружаем мы написали инструкцию как приносить свои коннекторы много коннекторов которые сделаны людьми на гитхабе уже зарегистрировались на коне как есть вы делаете свой коннектор и вы например считаете что это коннектор может кому то поможет хотите к традициям да это этот это очень легко собственно суда ван боли там есть и плагины для мэй вина есть плагины для гребла которые позволяют создать эту metadata чтобы все это дело выкладывать на коннектор хобби или нас есть отличный набор коннекторов они немножечко следуют таким своим своим путем в какой-то момент они они пошли по по пути создания свою фреймворка но это не запрещает им запускаться в стандартном connect потому что они все их коннекторы дождей они консультируются по их какой-то свои технологии они запускаются внутри кафка connect и любые коннекторы будут совместимы ли можно выстраивать красот pipeline с помощью вот этих коннекторов сейчас мы попробуем со смош и проучила актива если мы если нам удастся его сейчас показать десерты просто расскажу про жизни цикл вот это все коннекторов коннектор представляет и пиаре для того чтобы взаимодействовать с коннектор сервером то есть есть 305 через который мы можем отправлять различную информацию например мы можем отправлять конфигурацию и сказать что вот мы подключаем этот коннектор корок в базе данных как только это запускается запускается метод полуконнекторы который постоянно сидит и читает данные в таком стримом формате из data source а и записывают этой данные в кафку мы можем запускать несколько маркеров несколько task-ов на разных маркерах баркер это как раз инстансы connect серверов оборки от тоски это как раз инстанса вашего коннектора внутри одного уокера может быть несколько task-ов и может быть несколько различных коннекторов бежать это такая вот поэтому я не говорю что это такой вещь которая похожа на на плите частью как вот вы тепло или вашего рынке вот похожая система работает в кафе connect если что-то падает если одна из нот падает то эти тоски будут пири-пири русские джолт как у вас по-русски сказать перезапущен на другой ноги и автоматически то есть вам не нужно как как разработчику думать об этом коннект это все сделает за вас есть определенные правила по которым сидел работать здесь описана работа распределенного режима коннектора есть работа в режиме не распределенным но его не используют практически никто потому что этот режим нужен только для разработки другого века на весь слайд сайкл всех этих коннекторов может происходить через этот rest api контролирует мост через обь некоторые системы вот эти монитор идут мониторинга и управления позволяют работать через триста кино про control center позволяет стартовать коннекторы фрэнсис тоже умеет работать с коннекторами через юань и вот вот вот так это все дело обстоит это зеленый сервис который позволяет вам работать с вашими внешними данными кто вы используете у себя кафка коннектор кафка connect да мы используем а себя и настоящие как of как она коннектор и это в первую очередь с 3 но мы из мы еще используем мир maker 2 который тоже на кафка connect коннектора на кафка коннекторы марки работает вот но тем не менее в некоторых случаях мы пошли по пути разработки своего здесь основной нюансы она вытекает из того что видите раньше сказал коннекторы может написать любой и когда вы выбираете тот или иной коннектор вам важно сначала прочитать во вторых документацию и понять как же он работает и подходит ли он в вашем случае 99 процентах случаев он подойдет и бывает все таки вот этот вот один неприятный процент случаев как у нас например произошел с добби изюмом когда мы строили сидиси поверх подвеску и нам нужно было соответственно захватывает все изменения данных из под колеса и передавать в кафку чтобы оттуда читать их подавить меркурьев crack house но мы в первую очередь посмотрели на связь и коннекторы надо bizim и выяснилось то что конкретно в позу сон то есть и говорю про все остальные базы до до безумных поддерживает большое количество есть различные нюансы связанные в первую очередь сами мозга сам с тем как у него логический decoding происходит и например добежим должен сначала создать слот логической репликации потом начать читать журнал журнал приезжающей записи и после этого данные вас будут попадать в кафку соответственно vol 1 тяготился попал в кафку и это все прекрасно до того момента пока у вас не происходит падение мастера у вас наверняка есть какой-нибудь станций на который вы начинаете приключаться здесь появляется особенность работы под колеса в том что slade и репликации в под гости не реплицируется я не по моему даже самой новой версии не реплицируются до сих пор и это значит для вас то что вот новый мастер уже начал проигрывать вот эти баллы он начал восстанавливаться он уже завелся слот репликацию там не появился допустим в какой-то момент вы все-таки пришли или автоматизация пришла и создала его руками но вот этот вот кусочек с момента когда старый мастер упал новый мастер начал подниматься где то в какой то момент времени неизвестный создался новый слот репликации дивизион ничего не видел он просто стоял и ничего не видел и он отключится уже в какой-то другой момент времени кусок данных просто потеряется это в принципе наверно можно обойти придется строить свои велосипеды придется делать дополнительную автоматизацию которая вычислит вот этот кусочек перезапишет его вне до бизе ума все равно дакини тв кафку но это уже такие особенности которые не очень приятные вот про которые надо бы узнать заранее и второй момент у нас много подвесов в рамках одного кластера работают 5 10 20 баз данных и довезем опять же в силу работы под колеса все время дублирует по сути варлок валок в пользу напомню он пишется общий для всех баз данных from входного кластера если вам надо в кластере из 30 баз данных читать все 30 баз данных таблицы в 30 баз данных кафку это будет значит что вот 30 раз прочтете один и тот же валок и в каждом из этих волохов выкинете все вообще данные кроме тех которые касаются конкретные базы то есть это на самом деле не так уж и экономно получается по ресурсам и мы в итоге пришли к тому что написали свой собственный можно сказать connector по сути это просто dimon который запущу запущены в купер найтись и он реализует транзакций бокс паттерн он точно также дает стопроцентную гарантию доставки ну отдела сей день здесь гарантии доставки и как он работает вы можете посмотреть по ссылке мы тоже на одном из этапов это рассказывали принципе там реализация не сложно но еще раз подчеркну то чтобы большинстве случаев коннекторов достаточно и мы их тоже используем главное знать что именно на них там под капотом и разобрались разобрались и пришли к нам люди и говорят нокии вы гаишники вы красивы и да вы джавис ты вывод тоже красиво что нам делать если у нас есть на самом деле есть клиент уйдет для кафки на перлина php но есть нюанс ашане а собрать букинге они помогли писали свои собственные клиент тоже как обвязку на 1 для барда кафкой скорее все тут и тут саша дон сказать да если бы не давали копеечку за каждый разливаем сколько pure love букинге про уже все вы выходили бы мы хотели бы очень да очень богатый вообще задача это непростая да значит для того чтобы решать вопросы интеграции с нашими системами существует такой подход который зайца прокси опять же мы разработали раз прокси как и одной из имплементации есть другие решения которые позволяют одел что она вам дает у вас есть система с которой нужно взаимодействий который ничего не понимает парковку не знает никаких нативных клиентов и джори писать или на чем угодно писать никто не хочет например вас есть какой-то контрагент какой-то партнер который должен данный вам присылать вы не можете выставить ему на наружу голую кафку ли там засекреченную кафку но вы можете выставить ему раз прокси он знает например как туда делать обычные курнул запросы чтобы писать его к вам или что-то читать тоже можно написать запрос и через раз прокси и чего учитывать через через степи нужно практически не требует никакого знания программирования если вы знаете какую работать с углом будет работать примеров к его полно опять же это позволяет уменьшить охват если вдруг что-то пойдет не так например можно просто прокси пробить если в случае там произошла как это компрометации так далее некоторые люди тепло это кафку через там определенные слои например чтобы ее не выставлять наружу используется подход своей абстракции это очень полезно бывает есть раз прокси который не только позволяет писать позволяют еще делать всякие админские в печи например создавать то какие там просматриваю топки смотреть и так далее очень очень удобно денег не просит многие люди кстати используют расспросе как инструмент для какие тесты наконец специально тепло этого вместе и те инженеры пишут скрипты подрост которые позволяют там проверяй там записалась данные лев кафку или там почиталось данных как так далее тому подобное есть там apple собственное решение но есть ещё интересный подход который называется где твой да то есть который позволяет немножечко вообще абстрагироваться от понять и кафки под понят понятие с теми платформы вот например если вы вот каким то образом следить за моим творчеством его с моим коллегой сережки варлам делали лайв-стримы про вот этот небольшой ток который называется ли вкус это такая платформа которая позволяет создать такой унифицированный интерфейс для взаимодействий сервисов которые вообще ничего не должна знать ни парковку не прочего потому что она позволяет иметь такой плага был сторож который может участников q и пульсары kinesis позволяет аутсорсить такое управление в сетами и сохранить их например гнев кафки как этого все топиков ок хранить где-то в другом месте таким образом мы можем перемещаться между различными streaming системами без изменения кода приложений потому что общение происходит через потакал как вот герпесе это работает это все через герпесе и чистка кой то стандартную схему опять же заметьте схема схема присутствовать схема используют стандартный кладу вентс для клауд ныть в приложений да здесь бы я хотел добавить то что если конечно это не нужны самодельный должно сбыться database но на самом деле если бы я посмотрел похожий доклад для такой таттва там сплайны назад то может быть бы нашего database и не появилось и мы бы сейчас использовали вот этот инструмент с предыдущего слайда так что очень полезно следить за уже готовыми инфраструктурными решениями и вот здесь вот наш database по сути делает очень похоже он тоже является гей твоим он тоже поддерживает но сейчас в стадии поддержки пульсара уже давно поддерживает кафку ну и отличительные у него особенности в том что за счет того что он все-таки инхаус решение он нам позволяет делать странные то есть как раз все вот эти вот отложены события и diddley кирку про который я говорил самом начале они проходят через вот этот вот слой да это баз и там вся эта логика происходит от для клиентов кажется как будто вот у нас так там поверх топика поверх поверх катки все так и работает точнее даже поверх database а потому что парковку они как раз ничего не знаю но этого днем в одном стис конечно назовут люди которые выбрались до разобрали мы идем домой прокси мы уже близко к нашему две минуты две минуты у вас и нас выгнуты надо прямо сказать загоняйте на тему давай погнали да rus успеем ли мы успеем ли мы но не вернуть и слишком годом проводить давай монте ди си зачем и почему то есть нужно жить и в одном дата-центре об этом говорил уже толикой не нужно жить по дата цена возможно жить чтобы не делать бэкапы живите во многих gtc в идеальном вы живете 3 если у вас не идеальный мир вы вам нужно 2 но опять же там нужно определенное умение как и тварей но есть еще такое понятие как правильные реальный мир где нужно два с половиной d пацан что такое 2 сплайн дата центра я об этом уже немножечко рассказывал прошлый раз на на московском друг си видео доступно вы можете вот этот на этом слайде посмотреть дальше я наверное пропущу пару слов если вы хотите несколько c то используйте кафку 24 и не болеть не бойтесь стычка с травками так она страшно как все рассказывает мы используем встречу нас все хорошо я взял эту нить между ценишь 200 миллисекунд митяй минус 1 очередь туда вот и последняя завершающая про автоматизацию соответственно чем больше вас оптимизации тем меньше вы работаете если все хороша в конфликт в enterprise версии используется автоматизации из коробки которая внутри себя ссоре то что я рассказываю упомянутые назад день минуте для позвали использует круиз-контроль на самом деле круиз control the fans source технологии которые вы можете применять сами главное вам следить за версиями потому что круиз-контроль из мастера например с кафкой версии 24 + работает не очень хорошо вот ну там уже есть новые вы можете это все построить поставить настроить и на выходе вот этот инструмент с машинным обучением на борту будет метрики из кафки забирать делать так чтобы у вас кластера всегда был в том состоянии которое вы хотите сам себя лечить финальное это прекрасные ночи страна с врагами переговорка уже просто ломятся как перефразируя классика одной минуты хватит на всех вопросы от наших уважаемых слушателей беседу вот здесь вот здесь кнопка в зум наши спикеры наш эксперт сейчас придут туда я вижу что в чате в телеграме было много народа я думаю у вас случится очень классно и обсуждение а мы тем временем тем временем будем уже переключаться на следующую сессию спасибо вам ребята аплодируем осиба шокирующих"
}