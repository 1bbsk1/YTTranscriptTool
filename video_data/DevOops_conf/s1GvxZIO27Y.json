{
  "video_id": "s1GvxZIO27Y",
  "channel": "DevOops_conf",
  "title": "Олег Ненашев — Under the hood of serverless Jenkins: Jenkinsfile Runner",
  "views": 648,
  "duration": 3640,
  "published": "2020-02-07T07:51:51-08:00",
  "text": "у а спасибо за представление сегодня мы поговорим о sevilla с дженкинса дженкинс файл рано рей и тому подобных вещах у меня вопрос к аудитории кто когда-либо использовал дженкинс в общем-то я правильно поскольку иначе бы вы на мой доклад наверное не пришли но фактически дженкинс используют практически все хочу вас расстроить мой доклад сегодня не совсем а дженкинс мой доклад специфическом компоненте для новая архитектура дженкинс который позволяет запускать дженкинс pipeline и в любом окружении это может быть как сторонний saas докер false типо и ws лямда и так далее и мой доклад о том как использовать джинкс файл runner и как его запускать это не то что вы можете применить своем дженкинс и скажем сегодня но это то что я очень надеюсь вы сможете применить своим женитесь и через год кто такой до меня зовут олег ненашев я живу в швейцарии я работаю в компании кладбищ клуб без это один из вендоров который является один из основных контрибьютором дженкинс из где-то с 2014 года я являюсь моим тренером самого ведра дженкинс и и я занимаюсь другими компонентами это джейн gc это многие плагины если вы когда-нибудь использовали толстой тот же или если вы когда-нибудь заходили на гитхабе леджер иногда вы видели мое имя я также являюсь мой тренер на маджентис configuration аскот флаги на новый плагин для управления infrastructure скотт дженкинс я являюсь монтень этом же них стал рано о котором я говорю сегодня я также организую в комьюнити google summer of code и внезапно я являюсь организатором питерского дженкинс митапа если кому интересно приходить и у нас 5 ноября будет встреча в клубе я прежде всего работаю опять же на дженкинс у нас есть кладбище верблюжью это freemium пепе джинс который включает плагины с интеграционным тестированием компонентов мы занимаемся саппортом и также я работаю над комменте проектами в том числе java 11 которая рассказывала джокер шyngys файл runner и тот же джейк ask давайте поговорим о вас кто является администратором дженкинс у кого есть проблемы с масштабированием дженкинс как система не так много кому нравится убивает дженкинс но мне нужно было проверить спит ли аудитория поскольку все знаешь такой jenkins я не буду останавливаться на том что это такое давайте поговорим о том как это было то есть если вы использовали jet дженкинс или хадсон 2011 году вы наверное столкнулись с тем что дженкинс нужно настраивать джинкс этот уличный фреймворк то есть вы его берёте скачиваете ставите плагины конфигурируете только после этого он начинает вам выполнять вашу сборки это конфигурация занимает много времени особенно если у вас много плагинов опять же дженкинс это архитектурного он включает большой мастер не микро сервис не макро сервиса скорее giga сервис и масштабируемость этого сервиса сильно ограничено при этом обновлять его сложно поскольку до на одном сервисе у вас может бежать много пользователей сложно обновлять если у вас конечно один мастер и maintenance с этого сервиса тоже занимает много времени это то как был организован jazz 2011 году а кто и дженкинс использует также в 2019 дженкинс сильно изменился в последнее время ответ на вопрос который был дан докладе про get up action games продолжает развиваться он пытал мы пытаемся соответствует требованиям наших пользователей мы постоянно включаем новые фичи например у нас есть pipelines скотт тот самый джеймс pipeline который сейчас уже используют практически все из configuration нас код который появился чуть больше года назад вы можете сконфигурировать всю систему как ямал включите в configuration management и тому подобное если новые плагины интеграция практически для всех современных сервисов то есть вы так же можете использовать дженкинс всеми технологиями которые я сейчас есть современная упаковка то есть вам не нужно и скажем запускать инсталлятор или war-файлы если вы бежите в cabernet если официальные хелм чарты есть официальные докеры мы же более того есть джейкс на всех market place of то есть вы можете пойти на google cloud даже man to see есть и дженкинс то же самое и же то же самое опыт shift дженкинс доступен везде как пользователи в том числе и версии саппортом также появился дженкинс секс о котором вчера уже рассказывал себастьян и который тоже продолжает развиваться и давайте вернемся к дженкинса у нас есть живет с мастер у нас есть в объем который так который доступен для пользователям у нас есть агенты эти агенты могут быть статическими который вы поставили подсоединили они могут также приходите склада то есть вы можете проверить агентов кубер на это си докеры да практически где угодно автоматически то есть агенты автоматически масштабируются проблема остается самим мастером поскольку да мастер архитектурном женщине масштабируется там архитектура нет х его ли билете там архитектурно невозможно его хоть как-то разбить на контейнеры архитектура нет hot hot свободу скажи раскрытого обновляйтесь его на dore стартовать и архитектурно многие задачи выполняются на мастер и так что достаточно требователен к памяти это то каким является дженкинс его можно настроить но это требует много времени то что я показываю это дефолт avaya ситуация если вы знаете advance 2 опции если вы читайте блокпосты и документация так не всегда поможет вы можете настроить дженкинса даже сейчас скажем для х его или билете если интересно подходите в экспертную зона я расскажу как тем не менее проблема архитектуры стояла достаточно ос остро и в 2018 году был блок-пост a g6 энгельс который был опубликован автором дженкинса фактически одесса стала в том что до дженкинс застрял на какой-то точке оптимума где все хорошо но при этом нам нужно было двигаться дальше при этом нам нужно было двигаться дальше так чтобы обеспечить некоторые совместимость для наших пользователей дженкинс существует уже более 15 лет у него обратная совместимость поддерживается то есть вы до сих пор можете использовать какие-то старые плагины которые писались под hudson но нужно было двигаться дальше и появилась идея клубный тип женщин я просто процитирую казаки это универсальный сиси де engines который бежит в кубе r на эту сеть и который имеет другую архитектуру и средство расширения то есть не только плагины но скажем приложения которые сейчас доступны дженкинс x когда вы можете подставлять уже сервиса внутри вашей системы то есть дженкинс вместо отдельного облачка автомашин сервера должен был встать и именно себя сиди системой которая подошла бы различные риски со что при этом требовалось что он по-прежнему оставался в универсальном тот швейцарский нож который можно применить для любых кейсов то за что мы любим женщин при этом он бы был либо к ресурсам то есть не было бы вот этого мастера который постоянно его можно было бы масштабировать как требуется и при этом его можно было бы легко использовать кроме того хотелось бы чтобы его было легко мы интернете и легко разрабатывать если вы видите здесь конфликтующие параграфы туда не здесь есть тем не менее этой идее это была цель которая хотелось бы достигнуть опять же 2018 году было осознано главное спешил групп которая занималась различными аспектами архитектуры например плавал старридж тоже джейн из файла ножа интеграция cabernet а сам эта группа до сих пор существует и если вам интересно посмотреть куда развивается джинкс вы можете просто к ней присоединиться там бывают митинги был есть свой мир лист можно поговорить вопрос к вам считаете ли вы что дженкинс секс удовлетворять сам требуем которые я представил . туда окей тут вопрос достаточно спорный кто был на докладе себастина а кто вообще значит такой джинки секс и кому не нужно еще рассказывать грубо говоря 50 процентов аудитории есть то есть если вам интересно можете посмотреть этот доклад но фактически gently секс от они даже соленое средства для континенте либо риф кубер нет с и он рассчитан именно приложений в купер над при этом до jade yan's это крут а если вы посмотрите любые докладывал от модели вы услышите жизнь this is a сам они обязательно сделают что-то типа вот так вот да вот так именно и это да джейк из x реально крут в своей области применения он главный тех он рассчитан на масштабирование он изначально рассчитано на кубер на этот и бежит только в купер на это при этом он в основном создан для кончались delivery то есть если вы хотите permanent запускать contain из старейшин как в дженкинсон с reporting гам с кучей всяких обработок и так далее то там в основном это будет консоль в тех самых репортов везде для всего вы не получите и дженкинс x очень быстро развивается то есть постоянно появляются новые фичи при этом конечно его есть ограничения да он кубер на это сон ли сейчас губернатор о нем говорят практически на каждом докладе но тем не менее далеко не все используют cabernet из и планирует при онаси туда свою инфраструктуру он рассчитан на github соответственно если у вас используется другая методологии джейд и секс будет тяжело применять у него есть ограниченная система поддержка систем контроля версий если его докладе месяц назад я бы сказал что он поддерживает только гид hop но поскольку он быстрее развивается сейчас там заменили engine для получения waplog афон теперь поддерживает еще вид байкит он поддерживает гид лапы гид хоп интерфейсы и скоро-скоро поддержат другие сервиса да опять же ограничения по сей и при этом нет возможности автоматической миграции джинсов женщин секс соответственно если вы поднимаете новый сидели систему которая будет работать в cabernet с я рекомендую использовать женщин секс и он отлично вам подойдет если же у вас более классический this если вам нужно подержать большую к систему и у вас уже есть жизнь писав который включает тысячи джонов вы по-прежнему можете использовать женскую никуда не уходят он будет продолжать развиваться у нас сейчас например происходит гавана нас или election governance аборт и мы планируем дальнейшие изменения архитектуры давайте вернёмся чуть назад то есть если дженкинс секс не полностью подходят к нам чтобы мы могли сделать тогда вот опять же есть эта картинка давайте подумаем чтобы тут можно было изменить если мы поставим все с ног на голову и скажем что если бы наш мастер приходил по запросу то есть вместо того чтобы у нас вот этот мега мастер давайте мы мастер будем пробежимся по необходимости вот это и есть концепция джинкс файл grammar кто о нем уже слышал кто его уже попробовал два человека обычно надеюсь вам это будет интересно же in this file рнр как проект появился опять 2018 году то есть полтора года назад сейчас у него уже больше тридцати контрибьютором там 400 star of на гитхабе и так далее при этом новые релизы сейчас уже выходят каждую каждые две недели примета при этом вы можете видеть что он еще в статусе бета то есть возможно несовместимы изменения мы их опять же именем архитектуру дженкинса чтобы дженкс файла мир лучше работал поэтому это занимает довольно много времени что же такое дженкинс файл runner фактически это instance который выполняет pipeline и выключается то есть фактически это single shot и исполнение определенная задача джейк стал леонард поставляется как пиджак или если вы хотите его диплом в докере так далее можно использовать джордж который позволяет уменьшать slayer и доступен на docker image то есть если вы хотите просто запускать вдоль кирито это возможность коробки и он действительно бежит везде то есть везде где у вас есть java 8 или java 11 или даже java 13 если хотите где у вас есть докер вы можете просто запустить джинкс файл runner и он вам выполнит ваши пай пламя что это значит если вы скажем запускаетесь в том же гид лобби вы можете нам запустить jenkees файл runner вы используете git хоп actions вы можете запустить жизнь this file runner вы бежите в diablo 1 вы опять же можете это сделать то есть вы можете запускать pipeline и где угодно при этом он стартует практически мгновенно там есть изменения то есть если у вас сейчас есть классический жанр ты сколько он стартует 20 30 минут иногда дженкс файл рынок можно создавать меньше чем за секунду выполнить ваш pipeline и потом остановиться фактически это так как построен современный фас архитектурно дженкинс файл render принимает понятное дело джейк из файлов из фактически вы передаете что вы хотите исполнять вы передаете workspace в которой он будет использовать или не будет в зависимости от ваших нужд и выберите конфигурацию то всегда ему нужно ядро и ему нужен список плагинов плагины дженкс они когда они уходят но вы можете использовать все плагины внутри режиме камеры и конечно настройки что же мы получаем на выходе практически все логе идут в консоль с идиот стр соответственно если вы используете какой-то кладу окружении вы можете просто стримить налог старик опять же вот экспресс workspace может быть зафиксирован jin jiang своего рано там при необходимости и так же он может не плоть сданы его внешне сторож если вы скажем используйте артефакт ари плагин для того чтобы загрузить и артефакты и или если вы используете то строил плагин для загрузки тестов джинкс файл рано то можете просто загрузить это в процессе исполнения прежде всего для нас это силой tool я тут покажу немножко документик of на самом деле их больше основной аргумент это файл который же on this file это ваш это плагин это о чем мы поговорили также есть дополнительные опции вы можете передавать рангом то есть фактически дженкс файл рано то можно записать результаты сборки в классическую структура дженкинса плюс например ли вы подкладывается reports to build history вы можете опубликовать их в стандартной структуре вы можете передавать workspace вы можете передавать аргументы то есть если у вас примет рисованный pipeline вы это можете login to feel runner а также есть дополнительный параметр побил комбата джоплин и так далее которые позволяют размахе дженкс файл render на вашингтон дженкинса чтобы потом при port где так далее вы могли увидеть как буду вас обижал это на основном записи и одна из основных фичах джейк из фанеры это возможность отключить sandboxie кто страдает от sandbox а время-то спай плане вот это было сделано чтобы обеспечить безопасность инстансов мастером и поскольку здесь у нас мастер все жанну single shot там и соответствие можем легко сказать а нам оно не надо соответственно у вас нет скрип security у вас возможность писать более свободно в группе руках и она продолжает работать как обычный pipeline много опций на самом деле их еще больше но всегда и можно взять докер соответственно в докере у нас есть стандартный пикеринг где фактически вы можете передать путь дженкинс файлов или путь quartz прессу и вы можете использовать и мы я использую же ты свой вал дженкс forerunner это то что называю vanilla и мы о нём я позже поговорю но фактически вы можете собрать и свой имидж который включает ваши плагины ваших конфигурации все запускается из коробки давайте сделаем дымку вот а мне тут есть pipeline соответственно pipeline достаточно простенькие у нас есть просто три шага мы загружаем что-то из интернета потом мы читаем этот ямал и и пишем never sings a virgin это был эксперимент по консилер вы ws дженкинса и давайте посмотрим вот у нас этот эксперимент вы видите что бегуна windows что может пойти не так я использую vs el и после этого я буду показывать дымку и стандартному репозитория да я использую майкл внутри майк просто запускать докер вот мы немножко ждем и вот у нас побежал наш pipeline несколько секунд и он исполнился в чем специфика этот вот даже этот pipeline включает около 40 различных плагинов дженкинс вам включать configurations скотт чтобы их настроить и вот это реально запись моей консоли если хотите посмотреть примеры другие приходить и опять же в экспертную зону я попробую показать джинкс файл ранок это действительно штука который может сделать много при этом она конечно не может сделать все как вы думаете что она не может сделать секреты она сделать может поскольку вы можете использовать configuration аскот плагины скажем из докер секрет с губернаторском доме шел с просто подключать секреты прямо вашем окружении опять же я могу показать поскольку у нас уже дженкс фангами рубежи секретами первое что нужно знать этот файл рано не является сей сиди сервисом или solution самостоятельно это действительно достаточно простая пускал к экзекьютора которая может исполнять ваши pipeline и соответственно чтобы вам построить сервис вам нужно как-то получать в пхукет скажем с вашей темы вам нужно запускать эти самые jenkees файл runners вы можете вам нужно куда-то хранить логия куда ты их стримить вам нужно опять же хранить результаты и главное вам нужен сверху в объеме поскольку дженкинс файл рано объем нет архитектурная то есть до технически его можно было выставить и можно было поставить спай плане input степ туда зайти посмотреть но это не то что мы поддерживаем из коробки хотя если хотите пожалуйста что еще джинкс файл runner не является на сто процентов и дженкинсом да он сильно оптимизирована он может вполне стандартный pipeline он может исполнить все плагины но многие из кейса джеймса фиксики физически не побегут например если вы хотите запускать 10 job of parallel и как-то между ними обменяться артефактами жизнь файл render на это не рассчитывал он исполняет один pipeline опять же нет в объеме у него нет всякого троттлинга нет коммуникации между мастером то есть один мастер не может на другой сходите что-то вызвать и он изначально создан на поддержку одного контейнера то есть сам джинкс файл runner бежит в одном контейнере вы можете подключать агенты если требуется но это достаточно долго то есть вы можете взять иску бернетт ossaise докеры вы можете парализовать сборку внутри одного джинкс файл render это занимается долго хотелось бы чтобы там были сайт каркам тренер это чтобы внутри одного плода мы могли бы еще заправить наших плов и чтобы это было мгновенно эта фича пока не реализовано то есть до джейкс файл ран от конечно не делает все при этом джейд из файл рано имеет одно существенное преимущество что вы можете использовать много джинсов вы можете сравнить эти женщины в параллель настолько насколько вы позволяет вам and инфраструктуры вот они вот тут мне раскрашены по-разному имеется ввиду что мастер и могут быть совершенно разными они могут включать разные наборы плагинов разной конфигурации они могут включать разные корриды нашелся то есть фактически вы можете раздавать отдельные мастер и каждой командой и сделать их легкими простым и созданными для определенных задач при этом встает вопрос а как же их упаковать и тут мы предоставляем тулы первое что у нас есть это та самый vanilla образы которым я говорил это фактически образ которые находятся в репозитории джинкс фонтана он включает базовой конфигурации например pipeline джинсы configuration на скот и так далее то есть это плагина которая включается в него по умолчанию и он по умолчанию может вам что-то исполнить при этом до его можно взять просто с docker hub для него построен content delivery и если у вас простой pipeline который не завязан на джон this plug-in и вы это можете использовать при этом он не подходит для практически всех кейсов ты наверное у вас во всех установлены дополнительные плагины тоже артефакты реджи расскажем или может даже этот плагин поскольку gift агент сейчас не включен и в этом случае вам нужно собрать как-то свой образ это практически все реальные кейсы применения дженкс файл рано да и что мы хотим делать это фактически собирается образа которые можно запускать напрямую это можем докер-образ и ws образ зависит от ваших нужд как это можно сделать во первых можно расширить vanilla образ докера есть просто фромма jad файл рано г-н дженкс файл рано запихать туда плагинов запихать туда своих конфигурации все заработает все стандартный механизм и джейн писака которые вы использовать скажем докере там будут работать и все стандартные риски связаны с этим опять же включены но есть и другое решение есть кастом vortex специальный tool который был создан для упаковки различных версий дженкинса вы можете видеть что он кастом лорд пейджер на самом деле он пакует также докеры и так далее как это выглядит сначала у нас конечно есть я могу это вы свой ямал который вы напишете который будет достаточно большими как и все ямы но которые позволяют вам описать всю систему jenkees файл раннера в одном файле что он может включать он может ссылаться на базовый образ он может включать список ведра ядра версии ядра список плагинов он может включать configuration и скот это не обязательно вот тот самый модный configuration аскот плагин это могут быть грове хуки это могут быть xml и если вам хочется также можно передавать системные про перси и так далее то есть фактически вы можете сконфигурировать весь дженкинс через одним ямах вы передаете это к сварке пейджера и дальше зависимости от настроек он вам может из одного info создать word-файл который включает все эти конфигурации докер ремейке классического дженкинса и дженкс файл runner для дженкс файл раннера вам нужно передать дополнительно настройки поскольку фактически карты пейджер будет пересобирать себе на рынке чтобы как раз обеспечить быстрый стартап то есть нам нужно проиндексировать . и расширения нужно распаковать плагины и так далее вот этот ул все это делает за вас и таким образом он стартует гораздо быстрее на выходе вы получаете вот тот самый ready to fly докеры ночь фактически и мышь который может включить все ваши конфигурации хотите запускать обернитесь и вы знаете что вас скажи мне те же губернаторе завершилась вы используете сердито глядя на данными вы все плагины запаковывается конфигурируете и на старте джейд из у вас уже стартует с этой конфигурации то есть ничего больше делать не надо и никакого было понятно дело тоже не надо джинкс фан-арт да он находится в бете но тем не менее уже где-то используется более того он даже где-то западе причем например дженкинс секс версия 1 джейк стал runner использовался для сервера с режима есть все джинки саурона это фактически наша реализация джеймс собирается на g intense для этого мы используем огромное количество плагинов огромное количество конфигураций и мы запаковали его как раз в этой джинкс айранов чтобы просто протестировать включая библиотеки и также есть фас по джунгли различных платформ то есть например get up action sport шипы и w100 лямда project fn это то что уже можно взять из коробки и вы можете собрать и мышь для ваших платформы и не обязательно ли мы что с понятная и ws лямда использовать другой механизм упаковки там не докер но все равно вы можете это сделать если хотите вы можете собрать в корпусе у меня уже была работающий прототип жизнь как файлы она может быть применен для любого окружения давайте посмотрим пример все давалось в данном случае возьмем женька секс 1.0 еще раз повторяют этот engine который уже затем реки чем тем не менее да если вам интересно вот есть блокпост джеймса роллинса который говорит как она работает и вы можете его посчитать почему он сзади при kitchen потому что те кто то есть вчера опять же уже были доклады против том вот дженкинс секс сейчас бежит в на те кто не в качестве основного движка соответственно у нас есть режим классических инженера который сейчас вы можете использовать если хотите но до по умолчанию он не рекомендован как они он вообще собирается фактически токах я писал в то есть у нас есть конфигурационный ямал файл соответственно он передается к самовар т.к. джампера джинкс файл раннера джинсы дура он берет различные плагины часть плагинов которые входят в организацию дженкинса часть плагинов джейк и секс у него тоже есть свои плагина и фактически пакуется один базовый образ после этого эти образы дополнительно расширяется поскольку в женька сексе ездил в паке соответственно если вы хотите собрать мы и венгры дал и так далее вам нужно в образ включит у и и они это делают путем расширения базового и мы же таким образом число лидеров внутри одной системы можно хотя бы снизить как это работает то есть если вы когда-либо слышали о про вот вся эта схема это фактически про то есть это веб хук ресивер который кладите в которой является частью сеянцев и которые фактически получать vip хуки и выполняет задачи вот тот самый триггеры который был у нее на схеме далее этот сервис запускать сборку он использует промежуточный шаг кинете fuels то есть это то что стало те кто нам в этой версии все равно он называется еще keenetic bells и после чего вот там совсем совсем внизу как раз используется же x фавро на то есть фактически почти весь стек реализован вне дженкс фонтана джейкс файлы она остается легким и он исполняет только нашу задачу и тоже нет сексе есть различные 2 вп океане просто подменять этот файл рано различия задач и быстро исполняет все общение используется для мы идет как раз через про если вы пробовали дженкинс секс вы наверное видели вот этот в объем в комментах by the pool request а вот это про это он с вами говорит это не женьке с вами говорит и да это работает давайте посмотрим что-нибудь другое гид хопкинс кто уже их попробовал совсем немного человек соответственно да вы уже увидели сегодня возможно это слайд поскольку да я его скопипастил с той же самой страничке да и как раз никита рассказывал о том что такое гид haпactь нас как они устроены как они доступны я не буду все это повторять вы можете посмотреть его доклад в записи и все там есть давайте посмотрим как это используется в живописи в женихи есть проект который называется джек-фонарь get up action он создан йоханнесом николаем а одним из я думаю девелопер адвокатов гитхаба и фактически джинкс файл рано же это как раз контейнер который может вызываться интриги т'хаб actions выглядит это примерно вот так то есть это я мол схема которая передает какой образ запускать вот здесь образ джинкс файл рано кипятишь передает ему убит хоп talking поскольку нам нужна возвращается результат и сборок чтобы красиво это показывать и все версии детка большинства синтаксис немножко изменился но фактически view в любом ямал стуле то есть будь это те кто он будь это тот же травис сборка будет выглядеть примерно вот так как же она исполняется да вот у нас есть все шишки фактически гид хопкинсон до запускает жопу он собирает наш образ если он еще не собран он исполняет наши экшен и потом запускать сборку никакой магии тут нет прямо внутри интерфейса гитхаба actions вы получаете вот тот же самый python что я показал он консольки то есть да все заработало вы также можете запускать конфигурации в параллель и так далее поскольку без haпactь назад поддерживать единственно проблемы с гитхаба actions это то что он все еще в бета мы уже знаем что он еще в бета будет две недели поэтому как только он выйдет из об этом вы можете это попробовать и рассказать что у вас получилось давайте попробуем тот пример который вы можете взять прямо сейчас если у вас нет бед программа кто когда-либо использовал ход шип причем в основном используется для веб-разработки поэтому людей не много но тем не менее это универсальный сервис для билдов сейчас это на самом деле не просто кот шепард biscuit шип поскольку он был куплен около 2см полтора года назад соответственно почему он нам может быть интересен если вы хотите запускать дженкинс джейк из а сейчас на рынке нет us as a да вы можете его запустить маркетплейсе но тем ни менее возможность его ограничено код шип позволяет это сделать то есть вот например у нас есть хадж и про это как раз я и сиди счас который рассчитан на докер контейнеры являются часть его архитектуры и дадли open source проектов он опять же бесплатен и то есть можно его использовать давайте попробуем запустить дженкинс там ну конечно не женька см он там попробуем запустить файл она у меня есть просит когда мы давайте запустим вот этот pipeline наш pipeline ничего не делает то есть это дик верите в pipeline который имеет 11 эти белки который писал о волк и пишет то что у нас на диске это просто для примера больше все вес это фактически определение того что мы будем запускать вот у нас четыре строчки мы говорим дженкс файл ранах что он у нас будет запускаться дженкинса файл джинкс . это вот как раз тот самый vanilla образ и которым я говорил ему будем передавать workspace и потом сама сборка это еще три команды мы говорим что мы хотим на сервисе jad файл runner запустить команду минусов workspace поскольку данном тут пришлось передать дополнительный параметр джинкс файл рано в новой версии это уже пофикшен а то есть в новой версии вам нужно не 7 строчек а шесть строчек и по итогам мы получим вот ту же самую сборку но уже на cut шипи если кому интересно я опять же покажу это в экспертной зоне как она работает ну давайте подумаем о том то есть да я вот вам показал халу волк гид хоп actions я вам показал хеллоу ворлд в ковшике можем ли мы сделать что-то серьезное оказывается можем это что я попробовал сделать это собрать джеймса плагин в код шипи чтобы собрать жизнь this plug-in в код шипи в принципе если у вас там мы вина вы можете его собрать но мы можем собрать используя стандартные genki совские тулы давайте возьмемся джинсы она как раз тот пейджинг о котором я говорил мы возьмем стандартную pipeline библиотеку опять же мы можем положить портленд библиотеку прямо в наш образ то есть мы можем выпить образ который уже полностью не модифицируем и которые включают все компоненты перси они рации и мы можем поднять кандинский вещь для него вот мы включим стандартную библиотеку которая используется в проекте дженкинс чтобы собирать свои планы и мы будем использовать стандартные дженкинс файл который фактически выглядит одна строчка белки плагин да он выглядит именно вот так идея в женьке себя в том у нас больше 1700 плагинов и мы хотим чтобы контейнер использовать в стандартный flow который включает интеграционное тестирование статический анализ continue с дипломом security scanner и так далее все это спрятано в бип в портленд библиотеки вот за этим шагам и соответственно нашим плагинами интерьера мне нужно заботиться о том как это вызывать вот наш код ship service фактически то что изменилось мы поменяли образ то есть вместо vanilla образа я взял образ который как раз был собран из репозитория он включает плагины которые используют вся жизнь тельца и он включает конфигурации и все заработает и вот да тут уже кому как раз под шип степс на три строчки которые его запустил опять же ничего страшного и не случается то есть вот у нас pipeline который запускается что мы можем здесь видеть что у нас стартует он можно видеть что есть один набор днк вот джинкс configurations кого-то плагина он обнаружил что я и передаю зачем-то гол пас мы видим а старый образ и выдал мне wording потом идет идут groovy хуки если вы используете группе фуке для инициализации . они также работают и после этого начинается исполнении соответственно исполнении закончится успешно может даже сейчас время каждого останется я покажу это в живую вот собственно же build history что ему что мы можем здесь видеть что сборка занимает где-то 6 5 минут на джеймс фонари более того эта сборка включает две платформы она собирается на java 8 нажала 11 и в общем-то хороший результат то есть самым джек забирает примерно за то же время то есть вот все те самые абстракции которые мы построили ничего не изменили это то как можно его использовать в реальность это полная сборка плагина который включает стандартный джеймс pipeline со всеми конфигурациями и там практически не потребоваться модификаций чтобы это запустить итак мы с вами поговорили про дженкинса из эдхов actions club by scott шип о чем я еще не поговорил я не поговорил о джеймсе поскольку конечно вас может встать вопрос а как же использовать сам джеймс фанг runner внутри дженкинса сейчас плагинов для этого нет но фактически плагин вам не нужны поскольку дженет иса уже есть интеграции с докером то есть вы можете использовать докер pipeline плагин вы можете просто напрямую запустить его силой и получите исполнении дженкс фрагонара как я показал на куче пятна дженкинса при этом конечно не разберутся логе но можно сделать автоматически это сборка репортов фактически дженкс файл рано то может положить вам report a word space и потом вы опубликуете хуже джинкс плагинами то есть это использовать можно но пока конечно в интеграции нет то для чего это может быть интересна всем это тестирование скажите у кого когда-нибудь возникало проблем с тестированием pipeline of или попинать библиотек да все обходят все спрашивают и вот как раз за жизнь this file runner это одно из решений которые вы можете использовать прямо сейчас более того уже есть фреймворк называется hex файл runner тест фреймворк да нам нужно будет потом подумать над короткими именами в гитхабе соответственно что он включает он над как раз рассчитано к smart пейджер он рассчитан на docker он рассчитан он используется если еще юниту то есть тест выглядят примерно вот так потом наверное нам нужно будет интегрировать же юнитам или чем-то еще чтобы выглядело красиво но тем ни менее фреймворк может собрать ваших кастомный образ который будет скажем эмулировать вашу систему дженкинс и запустить там ваш pipeline а потом он может сделать со сердце на те же build лаги до workspace он может траве и ведь результаты и сказать вам что не так вы это можете запустить то есть вы можете взять под где вы можете развернуть всю вашу систему для интеграционного тестирования и таким образом вы можете реально протестировать вашу систему не запускает же нет из как таковой это очень удобно это то что мы уже используем у себя это является дополнением к pipeline юнит pipeline или dataframe арт который сейчас используется массово pipeline фактически рассчитана making с помощью дженкс фарамира вы можете сделать интеграционное тестирование то есть вы можете не только тестировать сами пакета джек стал раннера если вы хотите попробовать их продакшне но также тестировать jacques файлы pipeline ноябре и набора плагинов как таковых то есть даже если у вас есть configuration а скотта для вашей системы вы можете запаковать его еще в женских файл рано и быстро протестировать не ожидая долго как дженкинс запустится джейкс файл runner это новый проект он все еще в бете и нам нужно фидбэк если кто то хочет попробовать мы будем очень благодарны уже есть много компаний которые жизнь this file runner используют например для той же автоматизации тестов или использует внутри сервисов то есть у нас есть крупные компании contributors которые его уже используют в продакшн и при этом вопрос 1.0 все еще стоит открытом я думаю что ближайшие полгода его не будет поскольку нам нужно менять саму гидру дженкинс чтобы джеймс верон разработал еще более эффективно нужно также разобраться с вопросом упаковки то есть если jad файл runner используются из коробки встает вопрос почему бы нам из коробки не предоставить мэйвен гарет дал и или что-нибудь подобное или может например ту же сборку для python а как отделы дженкинс секс внутри своего проекта это то чтобы очень хотелось делать если кто был на митапе в понедельник вы видели как я собирал образ для мэйвен каких трудов это стоило так что да нам еще есть над чем поработать хочется lightweight сайт карт контейнеры возможно тоже с расширением синтаксиса что фактически вы могли сказать что бы те же самые тулы чтобы они шли не внутри жизнь this file раннера внутри стороннего контейнера его могли бы запустить мэйвен и что угодно из нативного имиджа ни пера собирая образом писал рано да ну и конечно же джеймс плагин для этого тоже бы не помешал из rocket science а то есть если вы были на джокер это мы много говорили о грааль вий аммиак ворвусь а это то чем мы уже начали экспериментировать чтобы можно было создать нативные образы которые опять же работы бы более эффективно сейчас у нас просто есть в jar который использует стандартные джедики но фактически джинкс файл мере мы знаем какие плагины будут загружены какие классы будут загружены а соответственно мы можем оптимизировать сборку и предоставится уже образа дженкинс и который будет стартовать не за секунды а за микросекунды или замена миллисекунда на этом случае корпуса но это то что можно реально сделать этот общему мы будем стремиться что я всегда хотел сказать да дженкинс развивается джейд из развивается на новые платформы есть куча экспериментов то есть джейк и секс был экспериментом и сейчас это отдельный проект внутри can сильно с деревьев андрич на этот эксперимент очень удачным jade is over green тоже был экспериментом он был менее удачным но тем не менее а джеймс файла на это еще один прототип который сейчас активно развивается который можно использовать все эти решения они фактически являются главный тиф и дженкинс хочет двигаться в направлении клубные тиф и на самом деле это реально реально запускать дженкинс как фас реально запускать дженкинс в claude реально масштабировать дженкинс и потенциально реально сделать хай вали билете backup камеры и диву deployment и так далее для самого jackets и есть дизайн и главный тяф-тяф говорила о них и если вам интересно поучаствовать в эту область присоединяйтесь в направлении можно двигаться с помощью джейкс fall раннера вы можете запускать вашей pipeline и где угодно да это не silver болит много чего не будет работать с коробки но тем не менее вы можете это сделать и для многих случаев она реально заработает и есть стул и которая позволяет это запаковать соответственно вы можете мая рекомендуется использовать женьке секс где это возможно поскольку женьке секс это уже production более того есть кабинки секса дистрибьюшен который является фактически стабилизацию время для дженкинс секса и вы можете это взять но если вам этого не хватает используйте женька свою рану соответственно кто когда-либо кантри видел во концов этой аудитории донецк человек так вот сейчас отличное время кантри beauty поскольку случае дженкс файл раннера мы приглашаем контрибьютором если вы попробуете что-то хотите что похитить приходите поскольку это бета то изменения мы можем выкатывать очень быстро и если вы участвуете в октоберфесте или не участвуете в октоберфесте вот остался один день и можно как раз попробовать не обязательно даже в случае дженкинса много других open source проектов тоже ждут ваши contribution на этому не все я рассказал чуть быстрее чем я хотел поэтому я могу или показать какой-то дыма вживую или могу ответить на ваши вопросы что вы хотите оки эдема давайте соответственно я использую windows я использую docker for windows я использую windows обсе steam for linux и что может пойти не так full disclaimer она может вообще свалится так давайте возьмём что-нибудь что у меня тут есть вот у нас есть консоль видно да соответственно вот у меня есть дымка которая пишет как разделить эти в pipeline давайте посмотрим что там внутри вот тут наш pipeline который мы будем исполнять фактически опять же противники pipelines параметризации то есть давайте его соберем давайте что мы сделаем мы можем собрать его с докером мы можем собрать его из fijaros как вы хотите давайте докер соответственно предположим я ничего не знаю джинкс фаринелли давайте пойдем на хип-хоп а вот у нас тут документация документации есть у нас как раз носила и как его запускать и у нас есть документация на докере мы фактически что нам нужно взять для дымке это взять контроль с и control в или правая кнопка и вот мы запускаем и мы получаем что не могу подключиться к докер давайте посмотрим окей я держал компьютер 2 часа перед докладом и соответственно доктору мне лежит она пока у нас запускается давайте тогда выполним из консоли вот тут нас при видно нижнюю строчку я могу в принципе попробовать ее чуть подвинусь вот так соответственно вот у нас джин this file ранах который запускается и задам вот жара это фактически вот тот самый пейджер где все изменения запакованы при этом нам все равно нужно передать плагины поскольку набор плагинов которые мы используем vanilla джори они больше например мы включаем configuration аскот мы включаем бит плагин чтобы можно было что-то за чикаго сеть и после этого нам нужно передать тот план который мы хотим исполнять ну поскольку мы работаем в нашей директории то это будет вот так давайте попробуем соответственно она и был to access jar поскольку да да вот тут у меня этот шарф лежит и давайте тогда запустим у так декольте в pipeline соответственно что мы тут видим мы тут видим exception поскольку fijaros появился две недели назад и у него есть еще баг который нужно пофиксить в ядре то есть мы просто воспроизвели один из богов ядра в докере они воспроизводятся но вот да вот исполнится наш pipeline опять же около 40 плагинов стартанули загрузились проиндексировали все все сработало я надеюсь что джинкс лнр работать медленнее докера до докер у нас тоже загрузился давайте попробуем теперь все то же самое сделать в docker и то есть я перейду в то же самое declare в pipeline давайте вот где он где у нас тут вот джинкс файл рано да стандартные ключики фактически мы используем стандартный образ передаем дженгиз файл и по идее если все будет хорошо то есть сейчас две виртуальные машины активно работать между собой чтобы все это запустить на виндоусе но вот у нас как бы айдана выполнился в общем то и все это действительно примитивный pipeline но она работает давайте чтобы не запускать это я начну я покажу тот же самый код шип именно для sygic своего раннера или покажу как он упакован хотите ok давайте гитхабе джин 10 джинсы и runner то есть вот у нас репозиторий вы видите что тут точно также живет где пинда бот о которой мы уже сегодня говорили и на джокере говорили и вот у нас то же самое живет релиз драфтер для управления очень желал гамме the semantic релизов у нас другой бот опять же у нас тут везде бота давайте вернемся к конфигурации соответственно эта конфигурация специально немножко архаично что она включает она включает во-первых прикажи конфиг ямал вот это тот самый конфигурационный файл который мы скармливаем cosworth и пейджера что он включает nuance включает бандл то есть мы фактически описываем что собирать у нас есть бил settings она определяет откуда брать данные тут вы видите что вместо список плагинов я передаюсь pom.xml поскольку я хочу использовать и пенда бот то есть поэтому поскольку мне лень было писать и пенза бот для моего кастомного формата технически это можно не просто держал pom.xml как дополнительный параметр также у нас работает один dependency баланс то есть вы не можете установить список плагинов которые будут не совместимы между собой паспорт вам ум even об этом ругнется при сборке после этого у нас есть вот джейн к своим runner тут вы видите что я в дымке использую beta 7 я этот артефакт передаю как исходник поскольку нам нужна пересобрать а джейк из файл runner чтобы он работал быстро мы передаем системной property тут из интересного лук статистик склок и the property которая позволяет jint лесу быстро пробежались контейнеры не ожидая что какой-нибудь другой агентах подберет и вот у меня есть groovy хуки и configuration и скот соответственно их я могу передавать в самом файле но мне было удобно их использовать из внешнего файла которые лежат в этом же самом репозитории кто уже использовали дженкс configuration носков совсем немного людей то есть вот у нас же нет екимов которые тут передается фактически что он делает он на самом деле очень маленький тут мы используем global над properties мы говорим какие property передать фактически это конфигурация джейд из портленда ибры через переменное окружение поскольку джинкс файл render понятное дело не включает windows но сейчас есть уже контейнер для windows в качестве прототипа но он еще не реализмом вот мы передали property мы также передаем гид который мы просто будем использовать сила и то есть мы не будем ничего загружать и дженкинс и возьмет это в качестве конфигурации после этого у нас что еще есть у нас есть и нет скрипты то есть они написаны на группе руках поскольку когда я начинал эту дэмку джинкс configuration is cut еще не поддерживал все плагины но тут у нас например конфигурация pipeline libre то есть мы фактически в зависимости от окружения мы проверяем если у нас библиотека внутри самого образа если она есть мы ее ставим из образа то есть вот тут используется система 7 плагин для этого если нет мы ее берем с гитхаба то есть вот такой режим более того если вы хотите разрабатывать эту пилу pipeline библиотеку в ее можете подключить как валим и без комментов просто разрабатывать с этим же самому имиджа то есть да и много других кода но фактически нам об этом знать не нужно поскольку вся упаковка идет к смурфики джером то есть вот у нас тут идет майк файл который фактически это все собирает то есть можно видеть что он фактически он использует 2 из 1000 сборку он из началась собирать базовый и мяч поскольку здесь как раз архитектурный я сначала собирая базовое матч с моими нам который мне нужен для тестов и только на его основе потом собирают жентос файлы она сейчас уже можно сделать и наоборот особенно если вы используете build кайт чтобы просто мир g7 g но да здесь достаточно простая реализация сейчас и это нам собирает как раз тот имидж который мы будем использовать и давайте я открою то есть что мы будем собирать у нас есть pipeline libre на центроплане бри то есть вот эта библиотека она используется всем дженкинсом для сборки плагинов тут у нас например есть шаги для г-на для моей вины у нас есть инфраструктурные шаги и так далее и дам пример леска smart поскольку опять же мы используем только сам варп менеджер для интеграционных тестов наши библиотеки ну вот нам интересный белки plugin то есть это вот та самая тот самый 1 строк который я передаю женька с файле тут он совсем не одна строк как вы можете видеть но преимущество что он как бы написан опытными разработчиками дженкинса соответственно они отвечают за его качество они наши пользователям и инженеры плагинов тут много всякой магии например управление chicks таиланд баксом и так далее чтобы нам уже давно пора выпилить нам нужно использовать это автоматически плюс у нас особенности интеграции с инфраструктурой мы например используем язык контейнер instances внутри дженкинса чтобы праве женить на ежа а если у нас нет мы на самом деле используем стандартные лейблы тут много всяких фактов которые используются но нам не нужно это знать когда мы бежим на нашем топе вот у меня дима это миллер flogging дженкинс и я даже не буду спрашивать кто его использует поскольку у него инсталляции на 98 процентов чистой инсталляции дженкинс практически все его хотя бы устанавливает и в общем то что я собираюсь сделать у нас стандартная сборка это джен this file да вот самый джеймс файл который мы будем собирать тут мы ничего больше не делаем мы подоткнуть и вот эти два файла подшиб services и у нас есть еще подшиб степс то есть те самые файлы которые показывал в дымке никакого обмана и вот у нас есть кот шип давайте посмотрим что там есть то есть вот у нас тут какие-то сборочки бегут давайте попробуем сделать что-то полезное все таких октоберфест соответственно давайте посмотрим что у нас тут есть ничего интересного не давайте вернем вот тут давайте переименуем к смурфика же поскольку он официально теперь называется к сноуборда докер пейджер соответственно nokia к мечу в принципе я бы мастер обычно не к мечу но в качестве исключения сделаем так на то же самое можно было сделать и споре квестом соответствие мы идем на вход шипы доход шипи вот у нас наш коммент уже пошел он тут пишет starting соответственно тут в зависимости от нашей удачи это может занять от пары секунд для минуты поскольку во первых я использую бесплатный аккаунт соответственно я тут не first class citizen и во-вторых тут действительно если вышел к естественности для логов фактически нам придется подождать до минуты прежде чем эти логе начнут появляться его вполне возможно нам нужно будет это при флешки пару раз давайте подождем вчера у меня это гонка стартовала мгновенно поэтому действительно все зависит от многих факторов мало хотя бы в очереди уже вот если что я могу написать в саппорт наверное но я думаю что в режиме читал мне быстро не поможет давайте выведешь на самом деле он начал у нас собираться уже давно то есть вот 1351 он просто логе пока проверил пока стримил и так далее но вот у нас пошли логе вот те самые логе что я показывал вот она стартует groovy хукс вот у нас уже запускается сборка тут он у нас использует склонен чтобы добыть дополнительное библиотеку поскольку он здесь и использует внешне для целей разработки то есть фактически используя мастер бренд сейчас чтобы потестировать и вот здесь у нас уже пошел pipeline этом это честный pipeline который у нас проверять что ж у нас используется вы можете видеть что на всякий увезен в подключении тулов и так далее и дженкинса и потом у нас пошел бы even фактически мы дошли до шага где наша сборка запускает мэйвен что же после этого происходят мы опять же надеемся нам под шип чтобы интегрировать чтобы использовать их прокси для того чтобы подключить мы even артефакта поскольку да мы можем передавать ворьем и локальному себя ямы винта репозиторий используя свалим а но здесь мы действительно в локальный прокси рассчитываем зимними и вот у нас уже пошла какая-то сборочка вы можете видеть что у нас используется мы им достаточно старой версии но он должен потихоньку собираться то что мы не видим дал логов сейчас это потому что у нас а pipeline библиотека передает флажки чтобы минимизировать логе соответственно нам как мы интерьером об этом беспокоиться не надо и в какой-то момент у нас должен начать писать что-то полезное мы в принципе можем пока поговорить о чем-то другом поскольку до сборка занимает до пяти минут соответственно кого есть какие-нибудь вопросы 1 спасибо . пусть тогда бежит но да вы можете сами потом пойти и посмотреть что оно должно закончиться успешно да давайте давайте поговорим и мне вопрос такой олег а скажи пожалуйста про губерний this оператор это как-то затрагивает или нет нет губернатор upper я про дженкинс к brands оператор да я понимаю это отдельный проект сейчас джинкс губернатор супер атор он рассчитан на классический дженкинс опять же вкладные кексика мы говорили о том что может сделаем купер оператор для джинкс файл рано чтобы можно было как я с pipeline и пулять просто как же in this file но сейчас этого нет может мы сделаем это побольше когда engine стабилизируется и так далее но вот губернатор оператор который можно использовать для для самого дженкинса и он сейчас активно развивается и вы можете продвижение женятся через него управлять конфигурации достаточно быстро потому да это она и вопрос такой что же выбрать то есть ты за рассказал про дженкинс x рассказал про старый дженкинс который умирает или нет и про вот эту штуку ты не рассказал до соответственно губернатора пират or я еще не говорил поскольку опять же он быть и насколько я знаю давайте посмотрим неё на самом деле версия 022 фактически джек на джинки с оператор еще открыт то есть как комьюнити это считаете сейчас просто инкубатор проект который можно опять же использовать фактически он для классического дженкинса то есть если вы работаете в cabernet если вы запускаете вашу инфраструктуру в кубер нет если но вам нужно делать нам пример катились integrations если вам нужен классический дженкинс вот это то что вы можете попробовать использовать соответственно он сейчас довольно активным а интереса я его не запускал месяца три но уже тогда он неплохо работал и логотип есть вообще огонь спасибо а ты упоминал про то что в дженкинс файл раннере не всем pipeline работается граница ними это не какие-то там не работают ну допустим допустим у вас есть input степ вам нужно что-то получить допустим какой-то марстон в классическом джен здесь вы заходите web-интерфейса говорите да я согласен что вот pipeline побежит дальше я это правлю как редис менеджер скажем или вы используете st50 вниз по умолчанию не выставлять невеста это еще не в интерфейс так что вы это сделать не сможете опять же я говорю по умолчанию поскольку если очень хочется то можно есть вот такие мелкие ограничения с которыми вы можете столкнуться здорово она сама сборку то есть если у меня сборка работало в обычном дженкинс этой файл раннере скорее все заработает dos самосборка самое ядро pipeline и заработает по артефактам и кэшированию там есть какие-то ограничения или нет port фактом по зависимостям по сути есть все как обычно если у нас не было настроен каша на сборке в обычном дженкинс эту тоже не будет есть расстраивали это будет именно то широнин вы можете все настроить в самом образе то сидевшим что и создается ньюта был образ в принципе для самого джинкс я тоже использую ему это был образа где вся настройка есть и вы его просто запускаете то есть тут отличие джинкс файл рано что он просто быстрее все это под сосет и начнет работать это да я говорил скорее про зависимости нет самого дженкинса проекта которые жинкин сам собираю до туда или спеша можно мы win cash легко передать или чего-то другой кэш если не передали том все скачает как всегда но здесь есть еще вопрос которая думаю стоит дискуссионной зоне обсуждать про разные совершенно разные сервера не только дженкинс да все подряд и я думаю здесь не стоит еще последний шанс вопрос задайте зала или или я задам смотрите у меня такой вопрос мы когда вот эти самые дженкинс файлы пишем можем ли мы поставить хоть breakpoint внутри файла и сказать о ватт мы до этого шага дошли хочу там посмотреть файлы с тем такая ли не такая как таковых break пунктов интеграции с дебаггер им сейчас нет то есть если вы когда-нибудь отлаживали ваши скрипты через их и команды и так далее это то что вы можете сделать на продаж нее не очень удобно я понимаю но если вы используете тестирование если вас скажем есть legend & spa phuket вы по сути можете замок от шаги и вы можете тестировать отдельные компоненты при разработке да я понимаю что это не очень удобно хотелось бы иметь классический дебаггер но специфика в том что до мы говорим pipeline группе dsl на самом деле от groovy ds или там только с т а весь движок под капотом уже свой чтобы обеспечить какая security который уже наверное всем захочется отключить в этой персистенции которая в женька с файл runners не нужно и так далее мы можем уже сейчас наверное сделать новый движок который будет интегрироваться с классическом groovy ему его можно будет либо жить но пока этого нет"
}