{
  "video_id": "LabNwsfnz9k",
  "channel": "DevOops_conf",
  "title": "Решит ли eBPF все проблемы?",
  "views": 279,
  "duration": 2813,
  "published": "2024-11-01T06:16:43-07:00",
  "text": "Всем привет И мы рады всех приветствовать на круглом столе с таким названием Как решить ли Биби все ваши проблемы и на нем Будем участвовать мы вдвоем Меня зовут Дмитрий Евдокимов и непосредственно Олег Леонид талалаев я непосредственно основатель технический директор компании lantry и мы в нашем продукте активно используем е ppf и в рамках этого крупного стола я вас на буду делиться своими болями задачами проблемами вообще видением использование vpf и в основном аспекте это связано Security Леонид Представьте расскажи о своем опыте Я уже более 12 лет занимаюсь высоко нагруженными системами и системами для управления инфраструктурой высоко нагруженных систем семь лет в компании ВК сначала Одноклассники потом пока я занимался разработкой внутреннего облака названием и в этом облаке мы решали различные проблемы связанные с производительностью сетевого стека Linux с непрерывно профилированием контейнеров с использованием ebpf Да я расскажу сегодня про этот опыт Вот и также мы посмотрим Куда движется вообще эта технология вот я ответим на различные вопросы такие как решить ли все проблемы которые у вас есть и bpf И вообще какая будет в итоге технология в будущем постараемся ответить на этот вопрос тоже Да так что у нас есть еще чатик Не забывайте Можете писать туда свои вопросы Мы будем периодически туда заглядывать но я думаю стоит начать круглый стол вообще с некоторой такой базы потому что может не все знакомы что такое ebpf до А если что и bpf является таким логическим развитием bpf berted Packet Filter а е BF - это и если прям базовая база рассказать то такая Эван дриван система Когда происходит какое-то событие в ядре и мы можем на него тему или образом отреагировать при этом для этого используется отдельная виртуальная машина и компилированная шкод непосредственно переводится в байт-код и он уже в рамках ядра выполняется самым таким ближайшим как бы аналогом чем можно сформировать и bpf программы это модули ядра Вы можете одну логику реализовать либо на с помощью модуля либо с помощью у каждого из этих есть подходов свои плюсы минусы которые я думаю в процессе нашего обсуждения так или иначе затронем Леонид Расскажи Какие задачи вообще приходилось решать что тебе понравилось не понравилось в процессе работы а ну давай как бы я начну издалека А что такое собственно облако то есть Откуда эти все задачи задачи возникли а облако Ван Клауд это аналог Яндекс или подобных систем которые используются компаниями которых достаточно высоконагруженный сервис и То есть это не не как не пока а класс это именно внутреннее облако и у нас возникла одна из проблем была связана с тем что при при росте производительности серверов которые мы использовали да то есть у нас были допустим ядерные сервера 128 ГБ памяти вот мы их меняли на все более более производительность производительные там до 128 ядер памяти стали замечать такую проблему что у нас при росте нагрузки если количество пакетов превышает 200 тысяч то начинается деградация сервисов Вот это проблема она нас 100 пила не могли агрессии дальше железо Вот и пытались эту проблему решить средствами встроенными средствами используя трафик Control и другие решения но в итоге ничего не получалось Вот и мы решили использовать evpf поскольку вышло как раз там статья от Google что они им удалось применить vph для похожей задачи да вот а у нас не было на тот момент разработчика который бы мог Вот взять и сделать такое решение Да поскольку это что-то такое Посередине между вот обычным обычные разработки разработки Да и системным администрирования такой у нас во многих компаниях есть специальные разработчики которые занимаются разработкой кернула Ну да и в этом случае они бы наверное смогли эту задачу решить Я вызвался и там буквально несколько месяцев разобрался с проблемой адаптировал то решение которое было в Google Наша задача и через три месяца уже это работало на продакшене на всех контейнерах после чего деградация сервисов не наблюдалось при росте количества пакетов до 2 миллионов рост задержка там был в пределах 15 процентов и на некоторых сервисах даже улучшилась Вот первая из проблем я ее достаточно подробно разбирал в статье нахабре которая называется как оптимизировали сетевой шейпер Linux помощью ppf вот также были и другие проблемы связанные не проблема а задача связанные с оптимизацией сбора перформанс-метрик Вот они связаны были с тем как Linux работает да есть такая система счетчиков в линуксе Вот и эти счетчики нам нужно собирать по контейнерам поскольку у нас облако которым работает контейнеры вот а у этих счетчиков есть определенная проблема с тем что они довольно если их много на создавать то они начинают поджирать и CPU и память и с этой проблемой не получилось справиться опять же стандартными способами получилось применить и bpf для решения этой задачи да то есть получилось создать один счетчик агрегировать внутри bpf уже так как мы хотим вот опять же про Ну это это же похожее решение но немножко доработаны мы применили Для того чтобы сделать непрерывное профилирование Java процессов на всем продакште который у нас сейчас включено И в Облаке держал процессы постоянно собирает профиль который можно посмотреть вот про него мы рассказывали на джипоньте в прошлом году с Андреем подгибными Артём вот собственно вот такие задачи мы решали с помощью epf получать задачи связанные с сетью и непосредственно сервобилити я могу попытаться отгадать что вы использовали в еби Пепе же есть много разных типов программ Вы наверное для сети работали xdp трафик контролом типом программ с профайлингом Я не знаю там Trade Point либо Окей пробы использовали ты в принципе почти угадал с этим работать с трафик Контрол программой Да с профайликами Это программа то есть программа которая привязывается счетчик Она имеет тип Перфект А там есть отдельная Просто мы с этой не работали нас в основном используется в lantry Ну как Security решение нам нужно смотреть за событиями связанные с процессами сетью и непосредственно файловой системы конечно не входит скажем так для тех кто может быть что не совсем знаком с технологией мы сделаем какое-то вводную да там уже тут начали про перфеенты может быть нужно как-то вести в курс дела до или Напомнить тем кто уже знает Ну да в принципе можно непосредственно объяснить что в рамках и bpf есть различные типы программы порядка последний раз когда я смотрел нужно Давайте еще от в том что и bpf постоянно развивается он появился с версии Да если я ничего не путаю там 2013 году это 315 Примерно вот и там все появляется больше и структур данных и типов программ Последний раз я смотрел было порядка 50 и каждая заточено под какую-то определенную Там задачу отслеживание какой там типа событий связана сетью с манипулирования сетью снятие событий там системных вызовов непосредственно там ядерных вызовов и так далее смотря какую вы задачу решаете Вам нужно будет правильно еще подобрать соответствующий тип программы без этого у вас не получится решить свою задачу поэтому очень важно еще ориентироваться в этих программах А если не ошибаюсь они все находятся в заголовочном файле БПФ точка можно быстро посмотреть где они находятся вот ну можно поискать Да bpf прок тайп подчеркивает не дальше там Да ну Да и можно про историю немножко рассказать Собственно как появился bpf многие наверное уже слышали что Это изначально появился из утилиты Типи Дамп которая занимается фильтрацией сетевых пакетов и для того чтобы поскольку пакетов много и для каждого пакета нужно делать какую-то простую достаточно проверку решили делать напрямую в кернаре Да чтобы не не передавать пакет Space вот надо сейчас сказать что переключение из кернана Space это занимает довольно много времени но если мы говорим про маленькую программу То есть это где-то 100 несколько сотен тактов процессора если программа это сложить там несколько чисел то есть десятки операций то тратить там сотни счет тактов на то что переключить контекст слишком дорого Вот и сделали такой оптимизацию что фильтр который передается в параметрах Он компилируется и дальше засылается выполняется максимальной эффективной скоростью Вот и дальше собственно постепенно стал развитием этой темы то есть стало появляться больше возможностей а потом кто-то не помню кто это был Вот но решили что давайте-ка мы этот систему то есть виртуальную машину которая компилирует нам некоторые байт-код нативный код будем применять не только для этого да а будем применять также для подключения к различным точкам в кернеле и выполнением быстром выполнением какого-то кода без приключения в User Space Вот и при этом Давайте еще сделаем так чтобы эта программа могла сохранять состояние которое мы можем прочитать из визерспейса с помощью bpf Map Вот и дальше стали там появляться самые различные фичи Вот и сейчас уже идет к тому что можно делать Например можно оказывается я даже не знал что можно контроль написать на ppf и Да это оказывается уже 5 16 4 года как есть я не видел Никого кто бы сделал доклад поэтому Как это работает пока затрудняюсь ответить это и BP фичи появляется очень гигантской скоростью Вот и целое уже ну комьюнити сообщество есть и BP Foundation в которой входят но ведущие вендеры там Microsoft там ходит Google Amazon и так далее которые активно контрибьютит в развитии BP в рамках ядра вокруг и bpf А даже есть отдельная конференция если называется bpf саммит которая кстати пройдет буквально через недельку кажется 13 сентября уже есть опубликованное расписание если вам интересно посмотреть что люди скажем так на передовой творец и bpf сейчас Да вот можно посмотреть докладывать конференции а ты вот говорил Леонид кто это сделал если не ошибаться Это был как раз Алексей старовой это тот человек который скажем вторую жизнь и грех начал так активно активно развиваться Да ну как минимум стоял точно У истоков Да кстати слушал его доклад на предыдущем саммите про будущее технологии вот и честно говоря так я удивился насколько он смело анонсирует то есть уже скоро нужно к тебе которые уже эксцентридер добавлять еще одну букву и сколько это будет какая-то очередная реинкарнация то есть Ну чтобы понимать vpf он по программе они как бы пишется на си но на самом деле это некоторый такой restricted CSS типизацией да то есть по сути в языке нет указателей просто вот звездочка да то есть компилятор он знает мент капилляции какой тип реально каждый переменной каждой ссылке и то есть это уже типизированная программа при этом продолжает дорабатываться разные физический пример там появились динамические поинтер да то есть которых Тип и размер Он неизвестен на этапе компиляции но у них есть какие-то данные которые описываются их длину и соответственно верификатор когда проверяет программу убеждается что там все проверки корректно делаются это что тоже похоже на Java да то есть когда уже есть массив например То есть он какой-то длины должны поставить проверку отставляется проверка чтобы Не входите за пределы также Любую функцию в кернале можно сейчас объявить Как использовать если раньше там нужно было описывать специальным образом и эта функция которой можно вы сейчас их очень легко добавлять новые функции которые вызываются из кернула это уже есть а планируется и так понимаю сделать так чтобы вообще любая функция при компиляции kernel компилировалась и как bpf программа и как обычно x86 год и для чего это нужно это нужно например для того чтобы можно было и онлайн делать да То есть вы вызвали такими фаншис она не как функция вызвался на заинланилась именно через компиляции вот или можно будет оплачивать на лету кирнул эта функция берете там и вход и вставляется вместо этой функции такие кажется вещи на самом деле но учитывая скорость развития вот а есть кстати вот все говорят про безопасность bpf появилась 61 функций bpf panic которая собственно делает kernel пенник то есть не такой Он же безопасный оказывается да да Вот я один хотел бы добавить что на сегодняшний день на ebp программа Можно не только носить сайт на Расте Мы уже у себя в компании это немножко пробуем потому что более читаемые понятный код становится если нарасти написать непосредственно программу А так да вклад становится все более сложным Просто помню как бы да Мы начинали писать на и befi там Практически четыре года назад мы встречались кучу ограничений которые есть как на уровне виртуальной машины как на уровне верификатора так и тех возможностей вообще которые давал и мы всегда радуемся когда приходим клиента у него очень свежее ядро на 4 Файер более свежий там виртуальная машина более свежая и там больше размер больше так больше количество в конструкции можно выполнить выполнить про симулировать Да и в общем Чем более свежее ядро вас вообще используется в компании Тем вы больше на самом деле можете ожидать прироста и улучшение от ebpf кода непосредственно а касаемо безопасности Да изначально когда он только появлялся активный как я говорил вначале противопоставляет модулем ядра и обычно если есть какая-то ошибка Бага модулера если она произносит Ну панику падает все ядро падает весь хвост то есть виртуальной машины если у него там есть какая-то проблема но он непосредственно сам изолирован в этой по сути виртуальной машине все и остальной ход не страдает Ну да с появлением Вот таких вот вещей Уже становится можно не так смело говорить что наш код не принесет ничего вашу инфраструктуру Я просто помню у нас в продукте было в начальной версии И выполнен сенсор и видим удаление программы нам тогда Года четыре назад администраторы система говорили мы не дадим мы не разрешим Ваш моделей запускать ваш в нашей инфраструктуре пожалуйста а вот ни за что не дадим поэтому версия смотрели практически сразу же Да и кстати кроме bpf pennic там есть еще bpf loop да то есть циклы запрещены как бы верификатор отвергает эти циклы если они кстати не помню Они вроде бы сделали циклы которые имеют гарантированное время завершения Если не ошибаюсь такое было Ну да но при этом есть еще bpfloop то есть там до 8 миллионов по моему можно поставить верхнюю границу Но если они могут быть еще вложенными то есть понимаешь что можно тогда накрутить так чтобы он будет выполняться практически вечно Ну да как бы раньше всех подкупала тем что они дают гарантию завершаемости за определенное конечный момент времени вот с этими вот какими-то новыми наворотами которые не вводят версиях ядра новых да получается немножко не отходит от той концепции которые закладывали самом начале скажем так его проектирования и Наверное это все делается в уходу в угоду новой функциональности которая не хотят занести что всегда есть баланс между безопасностью и функциональностью и в случае пипеэфа понятно что никто не будет давать не привилегированным пользователю возможность загружать программы все-таки это безопасность она имеется ввиду что ты случайно не можешь ошибиться в программе и там что-то поломать или открыть какую-то дырку наружу которые могут позволить есть снаружи То есть если ты уже пользователь опустил внутрь и дал ему права загружать bpf программы то ты ему каком-то виде доверяешь вот А ну да если он там написал bpf Look или написал вызов dpf pennec и свалил тебе кернул Но как сказать Значит он захотел скорее всего Да ну тут как бы от качества кода Уже становится вопрос качеству кода просто раньше можно было сказать о 10 типа ограниченное количество Ну типа Не волнуйтесь ничего не будет сейчас это уже аргумент не такой работоспособный Я бы сказал что я обычно когда говорю про безопасность и BF я разделяет на две части на сайте и на Security то есть Это насколько она системе непосредственно безопасно а Секьюрити Это непосредственно вероятность там уязвимости в этом коде поднятия привилеги через виртуальная машина его Поэтому я обычно эти два аспекта разделяя между собой но если с точки зрения Security как любая технология bpf имеет уязвимости и там его находят эксплуатируют активно и так далее но да как ты правильно отметил для этого нужны соответствующие привилегии да до версии 58 Это вроде было как сисадмин нужен был то с версии 58 они выделили отдельную привилегию называется кап и bpf кажется То есть она уже нужна пользователь для того чтобы как раз подгружать программа как сообщили они смотришь на то что за последнее время пытается очень много VPS занести чтобы там можно было же получить почти безграничные возможности не считаешь что это как бы уже скажем так технологию перенасыщают и она теряет то что вначале не складывалась и мы столкнемся с проблемами новыми какими-то я скажу Так это с одной стороны это хорошо Это хорошо для разработчиков и те кто хотят получить новые возможности в ядре не пачек кирнул и не стали какие-то непонятные модули Вот это может быть проблемы для тех кто поддерживает это ядро поскольку собственно эту проблему уже поднимали внутри разработчики Они слишком много Мы открываем да то есть не слишком много Вот И там был пост кстати вот в этом году реконсидовали stability Это applicational bander Интерфейс Да вот и как раз там речь шла про кирнал functions functions это функции которые в кернере они объявлены в Керн или как функция для кернова Но их можно также вызвать из bpf то есть отличие от helpers они как бы считается не настолько стабильными да то есть если бы пфлперс это вот документированная так такой же примерно как System calls который там на отдельные страничке вот там списочек этих которые там гарантирует что они будут существовать там наверное долго а то функция непонятно кто вообще как их там добавляет кто захотел там пометил кафан шестнадцатом вызвался dpf программе кто вообще кто будет суппортить и я так понимаю что какой-то ну решение там не пришли в итоге Вот то есть к такому решению что давайте теперь канал фанша тоже будем считать стабильным интерфейсом да наоборот написали что это не будет нас обязывать ни к чему то есть если такие добавили можем ее удалить Вот но сказали что рекомендуем прежде чем удалять провести дискуссию То есть как бы ну посмотрим что это выльется вот поскольку этот insource Я думаю все таки это комьюнити который предполагает взаимное общение все-таки каких-то вещей которые Ну повредят пользователям виде массового выпиливания которые все используют Я думаю что вряд ли будет Да кстати мне очень понравился тот момент который ты отметил есть как бы разработчики которые будут рады получить дополнительные возможности удобства функции и так далее есть те люди которые будут сопровождать системы в которых работать будет уже эти системы вот те решения которые использованы я вот последнее время заметил но таким ярким одни самых проектов на и bef является например Синай силу которые там вовсю используют и трафик контролл xdp вообще компания которого разрабатывает из levan прям является одним из крупнейших мотейнеров по части но при этом общаясь с людьми которые обслуживают эту систему они говорят вот если там Калика Да есть У нее дата Play на apitables не быстро но понятно его всегда можно отладить говорит когда мы встречаем насилиум то тут нужны специалисты очень высокого класса здесь нужно понимать вообще как все это и BF вещи Работает куда она подходит где она ставит Свои хуки как теперь изменилась логика хождения трафика и так далее То есть отладку и bpf программ И вообще там не знаю любой даже понять у верха который дает код это очень сложная задача А прокладить и особенно чужие проекты чрезвычайно сложно тебе доходилось отлаживать Чужой и bpf код вот лазить непосредственно что ты думаешь сопровождение чужого и входа уж счастью или к сожалению мне не приходилось это это делать но тут мне кажется не совсем корректное сравнение все-таки если говорить про iptables это уже устоявшийся проект с многолетней историей Да там про него куча всего известно и все проблемы его Ну они там документированы там есть настолько если в отличие от сириума Который совсем новый проект вот никто на нем шишек не набил да то есть и понятно что там Спустя какое-то время если он проживет столько же сколько iptables вот таким же как бы мои Чур Да там я думаю что переплюнет тот же плане суппорта бились Да потому что можно добавить Различные точки там трассировки которые будут динамически включаться Я не уверен Можно ли мне кажется можно типа жить даже пев программы нет к сожалению сейчас такой возможности нет мы все ждем например в компании чтобы Кто первый выпустит нормально отладчик такого понять Ну Казалось бы технология к этому готова да То есть можно же если у тебя есть исходная bpf bytecode ты можешь его инспектировать добавить туда какую-нибудь вот так и приходит дрессировку Да и в принципе это все можно делать фронтами то есть я думаю что рано или поздно к этому технология придет Ну да по сути сейчас то что есть в руках разработчиков это некоторые Source Код instrumentation Да вот так вот взять приотачиться чужому скажем так процессу коду К сожалению такого отделать нельзя чем больше проекты Нет его разрабатываешь тем это естественно тяжелее делать Мы непосредственно в своей разработки как раз код инструмент эшна используем для Да вот интересно что затронул тему усилием Действительно это сок Ну наверное самый большой из игроков и савелин до который комите ты развивает и BF Вот и тут но Интересно отметить вообще общую тенденцию Да если раньше большие игроки у которых есть куча своих кернов риэлторов они занимались тем что вносили какие-то патчи в кернул если им что-то нужно Да иногда они вносили патчину и не могли их промежут например мейнстрим потому что ну слишком уж какой-то кастомное решение и получается что нужно держать фотки с каких-то своих изменений которые не идут мейнстрим и это по сути постоянные Касты На поддержание потому что каждое обновление версии Ты должен промежут свои патча заново их протестировать То есть это риски опять же каких-то там багов Security еще каких-то там сейчас Получается они могут дать если он даже не хватает возможности vpf они могут внести там небольшое там какой-то новый хелпер добавить или новое тач-поинт и это изменение достаточно легко пройдет в мейнстрим kernel Вот и иметь себя какую-то часть уже вот именно для себя на bpf Вот и мы видим как это ну вызвала какой взрывной рост самого bpf а также вокруг него всяких других сервисов Вот например Твоя компания Да собственно яркие примеры если посмотреть на bpf зайти на сайт applications там Кажется более 50 различных перечислено проектов которые используют так или иначе такая как бы ситуация то есть выигрывает большие компании вот которые технологии в перед выигрывают маленькие компании не нужно так много изменений становится проще Да они сейчас получается как бы может быть Пойдет это слишком далеко Если такая тенденция продолжится сейчас куски кернала будут выноситься в виде bpf кода из ядра и собственно Где ты видел я пост на тему того что раньше спорили Что лучше кернул как бы Монолит или микрокернау Да там то есть микрокенал который как бы такой маленькая ядро там плюс куча модулей вокруг него и в итоге вроде как Монолит Линукс более популярен да А сейчас получается идет как-то в обратную сторону Все выглядит так что он будет распиливаться на маленькие кусочки то есть уже как можно больше стараться делать так что ты можешь подменить или переписать часть некоторые знаешь компании даже у них такой термин то есть мы можем теперь любой функцию вне дре использовать как сервис и можем переписать изменить изменить расширить логику и так далее поэтому мы можем использовать Да но здесь конечно проблема с тем что со стабильностью того этого этапе который ты используешь да то есть То есть если ты там что-то пропачивал потом пришла новая версия кернова тут и как бы кто несет ответственность за то что твое изменение сломается Да ну здесь как бы можно привести разные примеры как это решается в той же Джаве например там ну понятно что если кто-то использует какую-то функцию которая как бы не объявлено публичный Но оказалось что она настолько популярна что все ее используют но наверное имеет смысл его поддерживать дальше Да если какой-то кусок кода написано явно что вот это вот используется на свой страх и риск это может сломаться человек его использует его предупредили значит он взял на себя ответственность Вот как раз с версией ядра 5.2 если ничего не путаю ядро можно собирать Так называемая btf информации и вот как раз она по сути содержит таблицу релокации по всем функциям и так далее И если эта информация Нет по сути нужны хедеры ядра чтобы собрать соответствующий свой код соответствующую версию ядра то сейчас вот в современных версиях ядер можно использовать БТФ либо еще она называется как коре технология Я как разработчик хочу поделить свою болью что типа очень все классно вас бтфом появляется и так далее но это появляется часто В новых версиях но как мы знаем непосредственно эксплуатация как правило отстает И порой бывает активно отстает от тех версий которые там сейчас обсуждается там версия 65 там да какая сейчас последняя версия игра Вот она клиентах то реально мы встречаем ядра там 3.18 418 и так далее банки например очень любят эти версии и там вот этих огромного количества фич и классных вещей к сожалению до сих пор еще нет Поэтому приходится искать разумный баланс между того чтобы и самых последних Да вот на самом деле прокоря что хотелось бы сказать это действительно очень крутая штука можно сказать Одна из после верификации наверное вторая крутая штука которая мне нравится этот btf Type Information поскольку Он позволяет вообще не не зависит от кернан хедерс То есть например я хочу использовать какой-нибудь таскать и знаю что в этом таскать есть некоторые поля например там априорите да там я могу просто объявить эту структуру себя в ходе и там пометить специальными аннотациями и меня вот коде будет отмечено что это ссылка идет по имени да То есть в принципе это тоже похоже на языки Вот вроде джавы да где у нас скопированных классы в нем есть какая-то информация про класс который ты используешь да и момент линковки уже при программа загружается вычисляется все необходимые смещения для этого вот и сам деле очень круто этот btf он потом много Где используется для разных оптимизаций например есть такие штуки они для того чтобы отверстие программы которая тащится они не менялись да то есть структуры которые теперь дается в этот раз параметры они копируются в некоторую такую промежуточную структуру которая вот там фиксированный формат имеет грубо говоря вот а случае VP программы это можно делать можно не делать этого копирования А можно менять саму программу Да поскольку у нас есть Type Information нам не нужно делать дополнительного копирования Вот и есть такой то что называется отточтив который вот работает чуть быстрее Вот И там есть много других примеров когда вот и за счет становится более удобно а во-вторых еще и более быстро разрабатывать более быстро программа выполняется Да да мы очень круто с тобой все это обсуждаем хотелось бы вот немножко вернуться к изначальной теме нашего круглоста решит ли все проблемы Вот у меня например сейчас Есть некоторая мысль которая долго рассуждаю Потому что сейчас вот все что нас сетью происходит старается VPN засунуть Ну понятно и пипец силён сети и так далее И постепенно Мне кажется они подходят для того чтобы даже L7 уровень уже на eba Пепе обрабатывать что-то об этом думаешь L7 стоит запихивать обрабатывать на уровне bpf или все-таки этого делать не надо вот например ярким примером является сейчас Service и вот пока что L7 держится и он User Space обрабатывается и все люди и вмешностью и в других проектах но пойдут ли они на то чтобы L7 обрабатывался в ядре или нет Как ты думаешь я думаю что рано или поздно это произойдет Ну по понятным причинам что это прирост перформанса А почему бы и нет Как говорится Да почему и пропадут те гарантии Там завершение пропадут все гарантии которые вот сейчас но этих гарантий по сути они уже немножко ослаблены с учетом того что есть bpf loop есть функция там bpf и Trade То есть можно проецировать по всем ключам Например dpf мапы я думаю что почему бы не сделать исключение для sl7 нас какой-то запрос сделать новый типа touchpoint который будет там вешаться на что-то То есть я думаю что рано или поздно это все произойдет да но просто Потому что если будет спрос будет решение это все Вполне логично Что силлиум делается команды которая хорошо разбирается в кианули которые вот пойдут и сделать нужные патчи просто которые нужны как они делают до этого Да они тут твой интерес скажем так как решение как продукт скажем так пропагандирует как Это скажется вообще на инфраструктуре ядра операционных систем Мне кажется это большой вопрос мне лично хотя бы очень люблю активно используем немножко пугает когда пытается абсолютно все на уровне мы тебя пугает с точки зрения чего с точки зрения что станет слишком сложно или что станет небезопасно То есть это я бы наверное сказал он и часто не очень простая вещь Непосредственно да а с такими непосредственно усложнением еще будет сложнее и просто я знаю как отлаживать тяжело это будет чрезвычайно больно мне кажется останется просто не прям Единицы людей но маленькое количество людей которые смогут эффективно отлаживать и сопровождать такой Я думаю как с Любой технологии по мере набора популярности инструменты будут развиваться да Если нужно будет отлаживать bpf удобно Я думаю что появится инструменты для этого да том числе компания вот вроде твоей которые придут и вот разработают крутейший инструмент отладки bpf и будут продавать там за большие деньги Да спасибо Леонид напоминает что сейчас будет анонс закрывающего кино доклада и после анонса мы вернемся да надо что-то на 5 на 5 минут нам что-то придумать Давай поговорим про недостатки припев мы достаточно говорим про недостатки Мне кажется Давай то что тебе нравится и не нравится я скажу то что мне нравится и не нравится как можно давай подчеркнем и Мы возвращаемся и у нас остается Совсем немножко времени и давайте все-таки подытожим все-таки послушаем что нам все-таки нравится в этой технологии Что не нравится что нас пугает что нас не оборот наоборот некоторые уверенность в будущее Леонид начнешь плюсы технология в том что Если сравнивать например с разработкой под кернал либо с разработкой kernel Models в том что достаточно простой в нее вход Например я без опыта за три месяца разобрался сделал решение которое работает на продакшене там 7000 серверов вот конечно же я такого не сделал Мне нужно было То есть это удобство разработки это низкий порог входа относительно разработки подкинул понятно что производительность за счет отсутствия контексте вещи за счет того что программа получает прямой доступ к памяти ядра до то есть получает прямой доступ потому что это память копировать между Да и также дает преимущество для всей экосистемы поскольку компания как я говорил уже большие компании могут кормить небольшие изменения то есть они двигают и bpf соответственно развивается вся эта система вокруг этого этой технологии новые фичи появляются быстрее соответственно я могу выбрать Там не только там из тех встроенных возможностей из множества технологий которые есть на рынке да там пример если могу использовать силу могу использовать Калика могу свою систему разработать вот ну что же касается недостатков почему же все-таки все проблемы не решит Да ну из-за встроенных него ограничений понятно что он может решать только те проблемы которые его которые предусмотрели да то есть определенное количество тачпоинтов которые встроены я не могу произвольный кусок пока что это возможно будет сделать в будущем вот также есть ограничение на размер программ на то что программа может делать Вот надо сказать что эти ограничения потихонечку снимаются да то есть уже есть динамическая локация уже какой-то последней версии там 65 объявлено как эксперимента но уже есть уже можно делать свои структуры данных там Можно например сделать и там указывается уже что-то похожее на шаблон если плюс там описывается вот у меня есть лист и у него там тип такой с помощью аннотации снимается различные лимиты то есть уже там миллион можно операции проводить Вот Но при этом основная головная боль когда пишешь что-то сложное делать то верификатор начинает себя вставлять палки в колеса вот я докладе про Continuous профайлер собственно рассказывал Да как только вот я хотел простую вещь сделать Да там ирификатор просто говорит Нет ты не можешь вот и разбираться в его логах довольно сложно что он выдает что он там какой-то свое внутреннее состояние и должен понимать как он работает на самом деле внутренняя модель И как ты можешь обойти это все вот также возможно будут проблемы с эволюционированием апе да Если слишком много этот bpf начнет пихаться собственно может получиться его переносимость может оказаться не такой переносимой В итоге вот ну в итоге в конечном итоге я верю что bpf он будет только развиваться Вот и уверен в том что эта технология которая сейчас необходимо любому кто серьезно занимается линксом и перформансом у меня все пара моментов свои более Поделись в том плане что документации детей в конечно желает Это просто ужасно Если вы просто рассчитываете что сейчас более-менее серьезно не примерно коленки захотите сделать конечно не нужно быть прям кернул разработчиком но читать исходники вам придется точно Да кстати вот большую часть времени ушло начитание исходников ядра линус реально чем не то чтобы изучать bpf писать программу программы 10 строчек поэтому не является Как по мне какой-то Серебряной пулей это очень классная технология которую нужно знать изучать и в определенных случаях она может вас очень сильно спасать вот так Леонид вещей Что добавить или все закругляемся вспомнил интересную вещь про силу Они тут объявили что они сделали уже почти но они сделали патч пока еще не промерзали девайс networking Device виртуальный целиком написаны на epf то есть у него нету своего кода как бы пакетов и почему-то крутая новость потому что во-первых это перформанс получается у этого такой же как на Хосте то есть вас контейнер его сеть такая же быстро как если он работает один во-вторых вообще это некоторые вот куда Вот идет и пипец Мы в итоге заменяем вот весь сетевой секс заменяем 1 программой Да раньше нельзя было этого представить что так можно будет сделать Ну что ж я думаю мы все обсудили но я думаю можно говорить вообще бесконечно по крайней технологии очень живая на сегодня Думаю срочно тем поняли Надеюсь что вам было интересно полезно принципе есть наши контакты если появятся какие-то вопросы то пишите будем рады ответить тогда на этом все у нас Всем большое спасибо и всем пока Хорошего вечера Всем пока"
}