{
  "video_id": "577eDl_b7a0",
  "channel": "DevOops_conf",
  "title": "Битва при Helm'овой Пади",
  "views": 259,
  "duration": 1821,
  "published": "2022-11-02T15:02:00-07:00",
  "text": "и вот мы основы в эфире все давайте поприветствуем друг друга я рад вас всех видеть Уважаемые коллеги и друзья в онлайне Мы все с вами находимся на круглом столе Мы конечно же начинаем нашу битвуде нас здесь четверо биться будете вы А как это разные воинства Я бы так сказал а я буду так сказать сверху смотреть на это на все немножечко так сказать и немножко подкидывать дров но как обычно То есть как бы он Итак Я немножечко до эфира сказал что мы конечно же видим хельм прямо сейчас как один из важнейших инструментов в инфраструктурных командах но может быть я не совсем прав может быть это инструмент только-только для некоторой части команд которые занимаются различными практиками Давайте вот обсудим насколько это кому эти инструмент прямо сейчас давайте Вот с этого начнем уже можно начинать Даш Гелик Ну окей я топлю за Хем Почему я топлю за хелмохилл на самом деле решает Ну скажем так 98-99 процентов задач которые возникают процессе это достаточно простой инструмент с низким порогом входа который имеет развитые способности Это один из самых популярных шаблонизаторов На текущий момент для губернатос популярность это ведет в том числе большой комьюнити да то есть ну это как бы не просто так это новый хим черты и хим черты для хиллма есть практически для всего Да они разного качества как Open Source но когда вы собираетесь на какой-то элементик да хелчат для которого есть вы будете начинать с разбора уже чего-то готового а не с нуля Да это очень большой плюс плюс под Хилл пишутся различные плагины Да и многие плагины очень хорошо расширяют функциональность холма например тот плагинчик который позволяет держать зашифрованное ключи в логин и пароли в репозитории и расшифровывать это на лету приплея Вот это очень хорошо ну это вот моя позиция я видимо встану посредине между максимальной любовью к фильму и где-то ненавистью к нему и скажу что это прекрасный инструмент если ты понимаешь где его применить и он в принципе наверное сейчас становится Одним из основных критериев входа во всю Вот эту вот красивую культуру с губернатисами и прочим и он действительно очень простой на нем легко начать что-то делать его достаточно просто начать использовать но он в то же время не особо много чего позволяет сделать прям хорошо и красиво как раз таки в этой простоте таится его болезненность и кому достаточно вот этих всех простых абстракций тому отлично зайдет Но как Только тебе нужно что-то большее чем вот это просто написать красиво где-то вставить тебе нужные параметры и на этом закончить то хельм становится таким для того чтобы хорошим колесом полуполоманным колесом и его скорее всего надо будет менять и здесь основной момент понять когда ты понял что ты докрутил Хелен до того момента что он сломался И здесь наверное надо как-то глобально подходить к своей инфраструктуре к задачам которым ты работаешь так хорошо и Николай но все ждут Я попробую ну то есть в исторической перспективе Я уже давно как бы в этой области Хотя непосредственно с ними связано у нас просто инженеры холистик или фул стек И периодически мы что-то диплоим и делаем история началась еще очень давно когда там первый инструмент автоматическую диплои Как это странно появился Да там не Amazon вот с тех пор как бы ну и мы видели много инструментов и Какая идея какой подход мы выработали то есть как бы есть проблемы есть ее решение да И решение может быть каким-нибудь чтобы просто решить эту проблему как тогда то есть мы все видят в воздухе витает что раз есть kubernetics значит должно быть какой-то инструмент упаковывать что-то готовое можно это попробовать назвать пакетами Хотя я не совсем согласен что это должно называться пакетами Да это не у бунта Где вы там стоите какие-то и даже там с пакетными системами есть проблемы да то есть какую-то практику там не знаю погребку еще что-то взять упаковать и начать раздавать и многие решения Но это просто вот как придет в голову раз у нас есть губернатис как бы значит можно там плыть да то есть нам уже губернасе половина работы сделал нам не нужен писать просто нужно как бы ресурсики сделать с проставленными параметрами связанные друг с другом То есть их абсолютно прямолинейное как бы решение вот для администраторов которым вот в принципе из выразительных средств дают просто templay этики с Express возможность упаковывать действительно набрал популярность это прекрасно Там многие какие-то там как-то общего назначения пакеты Вполне себе работают скрывая Вот эту сложность губернатиса которая есть но на самом деле как бы это не концептуальное решение проблемы О чем я пытаюсь донести это временные инструменты проблема называя как раз как мы диплоим управляем инфраструктурой декларативную модель при полном загружаешь ресурсы оно там все запускается как бы связывается как теперь мы как программисты инженеры которые строят и поддерживают системы как бы будем эти системы собирать обновлять и так далее такое впечатление Николая что вы путаете диплой приложения его эксплуатацию А давайте вот прежде чем мы вот к этой части перейдем мы разделим хельм на три части Вот давайте немножечко как бы про Каждую из них чуть поговорим фильм как ну как как пакетный менеджер Да ну в некотором смысле хельм как шаблонизатор ну то есть и такой мастер по развертыванию в некотором смысле вот здесь кавычки везде надо поставить но тем не менее Вот он в трех этих ролях выступает давайте мы про них поговорим Где где фильм хорош А где он не применим или Ну так себе как бы вот где-то вот здесь вот здесь боится здесь не стоит здесь болит здесь не болит потому что вот я смотрю например на marketplace в различных там соответственно облаках внутри которых по сути дела хельмчард уже сделаны то есть по сути дела приложения не упакованы большому счету Ты в свой кубинете с одной кнопкой разворачиваешь приложение готовое это кайф Ну смысле как бы ты с точки зрения администрирования по кнопке получаешь там первую инсталляцию по крайней мере вот в чистом в чистом виде когда у тебя чистый кластер и вот это вот первооткрывание приложения когда у тебя низкий порог входа это очень классно Я получаю от этого безумное удовольствие там потом возникает некоторые проблемы Но как бы вот начальная история она мне очень нравится из точки с этой точки зрения как пакетный менеджер хельм Мне кажется великолеплен возможно я не прав давайте как бы вот эту часть немножечко обсудим я я могу попробовать оспорить сразу понятие пакеты Я уже как бы заикнулся ну нет как бы пакетов вы собираетесь систему это будет набор связанных компонентов так это система будет жить какую-то жизнь компоненты будут обновляться там выходить новые версии Кафки Не знаю ещё что-нибудь постгрится вы это всё будете менять друг на дружку там связывать перезавязывать делать мониторинг и аудиты как бы и это всё на одной вот этой системе Да если Ну то есть если у вас там что-то совсем простое Да и вам зашло как бы и вы там это подняли WordPress как бы и оставили его там на до конца там как дней да как бы О'кей Да оно будет работать но это можно было там не знаю в один докер контейнер всё зашить и запустить как бы если у Вас как бы более-менее серьёзная система которая как бы там будет потом эксплуатироваться вот то ну как бы нельзя сделать пакет это компонент который будет частью системы и он будет сложно связан с этой системой у него будет жизненный цикл он будет обновляться и вот как бы вот как раз под этим углом helm Это просто как бы наивное решение этой проблемы helm не решает проблему сложности ваших компонентов в сложность ваших компонентов сложности ваших компонентов должны управлять Вы если у вас большой Монолит доса долгими релизами циклами естественно его для эксплуатации его диплом обновления будет определенной болью который хел не решит Но если у вас несколько связанных микросервисов Да вы можете на каждом микросервис написать свой пакетик сделать какой-то один большой чарт при помощи Собчак подключить в него все ваши компоненты и таким образом задеплоить то есть по большому счету задача диплоя заключается в том чтобы сделать яму загрузить в интернет и убедиться в том что все выкатилось все перекатилось с этим справляется на ура далее В чем заключается обычно процесс обновления приложения мы собира новый doca remage и диплоим его в инфраструктуру обновление версии да возможно при этом нам нужно будет прогнать какие-то служебные скрипты миграции Ну я не знаю возможно изменить чуточку структуру дипломита добавить какие-то новые переменные окружения Под этой добро с этим Хем справляется замечательно Да у него есть возможность запускать миграции там создавать компонентов в рамках релизного цикла в зависимости от того стадии которая Наступила да у него есть возможность А трекать релизы понимать что стадия там завершилась нормально что релиз выкатился хорошо Вот у него даже есть возможность откатываться если что-то пошло не так да вот с этой вот задачей он справляется хорошо вот Если ваше приложение Не Клауд рейде если у вас распиленный Монолит А если у вас плохая архитектура с этим не справится я опять займу где-то промежуточную позицию и расскажу про то что менеджер из фильма такой же как из всех Pocket Manager вы не можете законтролировать в своем пакете в любые вариации которые могут произойти это собственно относится к тому что говорил Олег вначале что этого пин сорс и куча чарльтиков могут быть не совсем инвалидными не совсем хорошими вот это как раз таки рождается из того что этот менеджер он не проверит все возможные вариации развития событий у кого-то старый кластер у кого-то новый кластер у кого-то одни ресурсы впасть у кого-то другие и поэтому как обычно во всех этих пакетных менеджерах вам надо что-то собирать конкретно для себя и зачастую ну Все выглядит так что половина чартов из интернета она заработает И правда только в ванильном кластере который по всем гайдам из интернета развернут и в нем никаких нет шагов влево или вправо Вы поставили linked вместо истила как написали где-то в одном чарте и у вас все идет вообще не в ту сторону которая должна была пойти когда разрабатывали и это основная болячка пакетч-менеджера вам надо контролировать то где и как вы готовы запустить пакеты и Ругаться или как-то другими способами оповещать пользователя о том что у вас все вообще плохо и это то с чем приходится жить в фильме он в этом прекрасен И в этом ужасе но этого insource недавно у меня была задача развернуть кластер и я посмотрел химчат который идет с патч Я посмотрел внутрь и ну как бы такая рука лицо елки-палки вообще можно было наворотить а потом я пошел смотреть код Apache Air Flow Короче говоря вот Кем был отражением вообще-то безала бизнеса который зарабатывает разработчики зеркало Ну по сути дела если я правильно тебя понимаю и вообще в целом вообще как бы концепция то пакетный менеджер очень сильно зависит от тех приложений которые вот пакетный менеджер упаковываются и как бы сам механизм упаковки нормальный но зависит от того что и как мы туда складываем и если Ну предложение правильно подготовлено правильно написано правильно обновляется само по себе Вот именно как актуальном состоянии находится то в общем с этим нет никаких проблем Если я правильно Вас понимаю моя позиция такая Хорошо делай хорошо будет Да если hyunchart писал какой-то криворукий и упоротый Растаман да то он будет выглядеть так как будто его писал криворукий упоротый Растаман любую из любой сложной системы можно сделать на любой системе можно сделать как хорошее решение так и плохое решение да Это все зависит просто вот от конкретного разработчика понятие говнокот оно как бы имеет достаточно строгое определение Я в кино немножечко по-другому как бы я считаю даже Хилл достаточно вредным потому что как бы как бы ребята не поняли до конца проблему превратили ее в пакетный менеджер опять-таки повторюсь о проблема не в пакетном менеджере а в управлении компонентами сложно настраиваемыми дали куцы и набор инструментов Как можно строить абстракции как бы там виде который можно развернуть или Кафки или еще чего-нибудь или мониторинга Что заставляет людей ковыряться там в текстовых темплейтах как бы ошибаться и так далее даже нету места чтобы положить туда какую-то экстра логику как раз обработать там разные версии ещё что-то вот в этом плане он как бы вреден и вредно его популярность потому что мы получили вот как бы очередной npm с лифтпадом как бы ну и Например у меня никогда рука не поворачивалась за диплоить какой-то не взглянув в него и в большинстве случаев там 80 процентах всё ещё не ставишь его потому что страшно там сделано как бы страшно Вот гарантии нету вот ну еще раз То есть вот есть инструмент это первая чтоб ли он появился же сразу Да там Google попробовал там это с костома и сделать еще хуже это вообще манки патчинг это антипатом как бы но они решили что прикольно как бы По моим ощущениям сейчас как инструменты они вот проходит классический путь Я бы сравнил там Help там с SP и PHP ранним Да на ПХП на СП как бы писали и оно Решала проблему Ну как бы Прогресс должен двигаться дальше И мы никуда Отходы не уйдем это вот мое другое предсказание к сожалению не будет программистов которые просто шаблончики пишут будут как бы инженеры которые программируют инфраструктуру потому что это сложная сущность достаточно сложно Я считаю даже возможно сложнее чем вот там ребята просто банкинг пишут и ещё что-то потому что вы вот поверх этого сложно устойчивого Software должны это все соединить заставить работать надежно и должны появиться И сырье программисты с этой точки зрения хэлм как бы не то к чему Мы должны прийти прийти мы должны некому фреймворку там условному реакцию если мы там сравниваем или там рельсетом или Джанго вот для программирования инфраструктуры такая как бы промежуточная станция в сторону вот в ней можно постоять не можно поиграть посидеть как бы но Я рекомендую там долго не задерживаться Николай можете объяснить в чем проблема то есть я не понял Честно тут какая-то абстрактная боль Я не понимаю где она локализовывается Да что нужно что не может решить для вас Можно я попробую как бы вкинуть а Николай как бы меня поправит и вот как бы конкретизирует я правильно понимаю что вообще как бы вот это вот возможность использовать хелинг как шаблонизатор ну по сути дела в основе которого декларативное описание находится оно не подходит для программирования ну здесь мы кавычки тоже поставим инфраструктуру Я правильно понял оно не подходит для решения глобальной проблемы которые мы пытаемся решить мы пытаемся сделать надежную инфраструктуру которая там сделана как кот да там или хотя бы как там лежит под гитом до декларативно что мы можем обновлять мы можем переиспользовать Да вот пакеты да то есть если мы что-то удачно умудрились за диплоить кубик Мы хотим это переиспользовать хотим расширить поднять тысячи инсталляций хотим это потом обновить если мы там пользуется обновился научился как-то иначе работать да Там поставить не он или еще что-нибудь Ну и как бы ну вот в этом пространстве helm Это что такое маленькое наивное как бы но что по мне он даже не достоин как бы ну то есть недостоин вот отдельного обсуждения то есть да это есть пункт на нем почему тут все подзастряли как бы ну мне кажется нужно смотреть Немножко шире проблема лежат в других местах Ну то есть так та же например Джейсон Нет там с танкой чуть-чуть дальше зашли тоже ещё не совсем как бы там плуме движется в правильном направлении я объясню Ну то есть вот Олег Э нет задач есть как бы проблемы Да есть возможно их решения одно как бы это самое наивное решение И раз у нас есть декларативные ресурсы их можно тамплить это первое что приходит в голову берете за нас уже половину сложности решил Ну давайте на натянем на это темплейты проблемы не решены ты говоришь там тепло и эксплуатации Но это же связанные вещи диплоид как бы Ведут к эксплуатации у тебя идут обновления которые должны ломать эксплуатацию если ты как бы пытаешься отделить диплоид эксплуатации ничего не получится Нет смотрите У нас все получилось Да мы хотим поднять тысячу постгросов делаем Собчак встраиваем в основной чат приложение которому нужно не какая-то сферическая сущность вакууме встраиваем свой чарт Собчак получаем тысячу инсталляций нашего приложения 1000 пользователей хотим обновить обновляем Собчак который лежит на репозитории чартов обновляем там имидж после переката нашего приложения все наши подвисы обновляются Да будет простой при перекате но розыгрыш не кладут на этих приложение оно неплохо работает в контейнере да то есть в чем то есть задача диплоя конкретно в зависимости от каких-то входных параметров составить яму файл за диплоить его в губернатор и посмотреть что все случилось нормально задача эксплуатации это возможно делать какие-то сценарии первого дня Да там накат дампов накат миграции прогрев Да в этом Хилл может быть достаточно плох Да и задача второго дня там бэкап и я не знаю какие-то странные процедуры обновления которые возможно там разработчики приложения могут сделать но это уже как бы на стороне программного кода и возможно возможно придется писать что дополнительно чтобы сценарий прогонять в этом не поможет Но это специфика приложения повторюсь Олег Если я правильно понимаю То ты считаешь что хелм имеет достаточный потенциал для того чтобы покрывать многие сценарии вокруг себя Ну то есть если мы его рассматриваем в целом как бы вот это вот наш петельку да то как бы Хем и предоставляет какие-то инструментарий который позволяет нам ту ту тут какие-то местах строится Давай немножечко тему раскроем Чуть более глубоко Да смотрите Я предлагаю следовать unixway и devop свой то есть unix ведает Когда у нас одна простая один простой компонент который делает одно действие Но делает его хорошо вот дивоп свой это когда мы большую задачу декомпозируем на маленькие и решаем по частям соответственно не нужно все смешивать в кучу Не нужно смешивать диплои не нужно смешивать эксплуатацию Да из-за теплоя конечно же выливается эксплуатация но опять же это не одно и то же нужно решать эти задачи последовательно у нас нет проблем у нас есть задачи проблемы возникают в процессе решения задач и я до сих пор не услышал какие проблемы у вас есть которые Ну тут сложно Али как бы я не знаю попробую еще рассказать да вот задача Ну то есть мы на разных уровнях я буду разговаривать на уровне задачи на уровне проблем ты ну то есть мы например ты как бы декомпозировал ее но как раз девопс про культура его немножечко Про другое ты говоришь там программисты разберутся с мониторингом с миграциями означает о том что как бы вместе должны решить ты сейчас говоришь хэлм нам решить только диплом часть да Ну мы же как бы понимаем что продакшене системы это и мониторинг Да и аллертинг и аудит как бы и всё это вместе должно работать связываться там и управление секретами То есть это большой сложный смог бы смотанный клубок как бы то что можно начать с template от ямылов прекрасно но потом Эта система должна жить и как бы тебе Ну хочется спать и в этом плане как бы ну то есть ты можешь разбить на маленькие кусочки это не отменит связи между этими кусочками которые будут очень сложными а связи очень сложная и хелм и губернатос в том числе дают нам решение для того чтобы решить эту сложность дает helm как бы ну не знаю вот оверлей этот вот все могу сказать кино на самом деле скорее всего то что в тему это то что Николай как вчера рассказывали начинал с того что писать своих операторов в куберетесь это идеальное решение Все выглядит именно сейчас так что вот это вот парадигма замены всего что можно операторами которые дальше развивается вот то что Николаевич рассказывал написать какой-то глобальное решение которое закроет почти все проблемы как раз таки практически в виде оператора она сюда и приросло то есть мы должны постараться сделать какую-то систему которая все хорошо сделает за нас типа разработчики один раз Хорошо поработали чтобы потом не работали инженеры для того чтобы всё выкатывать но это собственно все ровно тоже УПИ получается то что мы говорили обновление постгарса это не такая простая задача ее нельзя решить просто одной кнопкой ни в коем случае ну смысл понятно что можно решить одной кнопкой Если вы и правда решили ну окей на два часа закрываем весь постгры потому что у нас идет обновление на новую мажорку и вот и решение этих закончили обновление прогресса У нас есть выкачанная версия я много вот почему нельзя проблему обновления постгрыз решить одной кнопкой потому что постгресс не кладут на этих приложения для чего нужны губернатос для чего нужны губернация операторы Когда у вас на вашем приложении существует какие-то неспецифичные вещи когда ваше приложение Не написано по канонам clout native Да тот же самый оператор для управления что он делает он поднимает несколько позже встает сверху и смотрит да когда один после упал он переключает трафик на другой потому что после не может это делать самостоятельно потому что возраст не кладут на а вот у нас есть простые задачи сформировать Яндекс запихнуть его в губернатоса Да у нас есть сложная задача Каким образом приложение будет крутиться там и оператор нужен там где не доработали разработчики где разработчики не сделали Клауд на этих приложения не поддержу на самом деле максимально что операторы нужны зачастую там где каких-то стандартных функций и возможность не хватает вам надо иногда запустить какую-то жопу и вам не подойдет крон потому что должна запускаться с другой стороны это как раз таки да В основном нет доработки приложений и попытка все все запихать внутрь и собственно Да здесь возникает тот самый момент который я говорил про поломанное колесо hima что оно вот здесь то есть сам хельм поломан именно в тот момент когда вы с помощью фильма пытаетесь сделать То что не должно было существовать в губернатисе изначально его не писали под губернатиз и всю Вот эту вот контейнерализацию и какую-то обработку вне зависимости от эксплуатации и здесь фото но и выплывает Слушайте а вот давайте мы сейчас все равно как бы рассматриваем ряд ситуаций и как бы как такое впечатление что мы все смотрим на разные ситуации давайте я замоделирую какую-нибудь ситуацию Чтобы вы сказали вот здесь хорошо здесь не очень смотрите вот в любом более-менее крупном продукте есть Ни один стенд Ну мысли как бы мы прекрасно понимаем что вот есть у нас например где среда у нас есть тестовая возможно какая-то отдельная среда у нас есть соответственно Продакшен я вот у нас уже например три стенда у нас принципе там очень похоже ресурсы должны быть Ну возможно не таким объемом Ну с разным объемом то есть в продакшн системе Понятно ресурсов больше потому что они там и нагрузку выдерживают и они реально как бы приносят деньги А в разработческой среде это временные ресурсы которые поднимаются вот для конкретных каких-то вещей для каких-то проверок и тестовая которая там эмулирует условно говоря наши продакшн среду для того чтобы погонять уже какие-то интент тесты посмотреть вообще как все вместе выдерживает нагрузку там еще какие-то вот моменты вот смотрите если мы полностью разрабатываем Клауд на этих решения прямо сейчас нужно ли нам что-то другое кроме helma нет вот этот кейс кастомизация приложений в зависимости от окружения куда она разворачивается это нативный вариант для хелма он был сделан для того У меня есть доклад погружение желающие могут загугли прямо по имени доклада где я описываю Каким образом это решается это за Волшебный приложения появились которые Типа так на раз два три там поставил все залетело есть в кафк который нормально развернуть это нужно там присесть полгода как бы чтобы все отстроить чтобы заработало Ну то есть имеется ввиду что там что нету Там кого-то одного мастера там выкапы автоматизированные репликации автоматизированные Это не отменяет сложности системы Вот то есть я не верю Ну то есть вот у нас какой-то есть магическое Клауд найти в которой там в докере стоит Да как бы запустилась и заработала Ну так ну во-первых мы не в таком мире живем половина как бы вот этих серьезных вещей которые нужно там пост Гриша Кафки любую там базу Возьмите любое хранение как бы вот требует определенных настроек может кончаться память может застрять запрос там ещё что-нибудь может произойти то есть нету магии Ну я не знаю WordPress может так диплоить да там если на файло из системе лежит или в какой-нибудь Клауд менеджер базе Хотя эти клауд-менеджер базы это тоже как бы куча там каких-то скотча там я не знаю резинок там ещё чего-то там и паче как Ага хорошо Николай Спасибо И ещё Александр Да я хочу на самом деле добавить эту тему Я на следующей неделе буду в оффлайне-часте рассказывать как мы живём с седьмом И как мы его все с ним работаем Мы его на самом деле очень сильно любим и мы как раз таки все стараемся кататься с помощью хельма потому что все что мы сейчас разрабатываем и вся инфраструктура которая нас построена внутри компании как раз таки позволяет максимально просто использовать чарты на чарты которые мы написали для себя Потому что часто из интернета у нас зачастую не разработают и вот эта вот Тема основная как раз таки вы пишете приложение которые должны заработать в вашей конкретной инфраструктуре вам лишь позволит их запустить в этой инфраструктуре вот все"
}