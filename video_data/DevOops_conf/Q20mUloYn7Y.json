{
  "video_id": "Q20mUloYn7Y",
  "channel": "DevOops_conf",
  "title": "Никита Михайлов — Наш путь: выбор и принятие APIM Gravitee",
  "views": 213,
  "duration": 2693,
  "published": "2024-10-11T03:49:40-07:00",
  "text": "Привет меня зовут Максим гореликов сегодня с нами Никита Михайлов у тебя должность инженер по интеграции старший инженер интеграции старший инженер по интеграции на самом деле достаточно редкая должность для России и работает Никита в передовых платежных системах платежные решения передовые платежные решения Извини мы сегодня собирались поговорить про API менеджмент Но прежде чем мы двинемся дальше чуть-чуть я напомню просто что те кто в онлайне Заходите в чатик там можно будет задавать вопросы и на самом деле самое интересная часть обычно это в вопросах и в обсуждениях поэтому не забывайте и я вот тоже начну с вопроса на самом деле из проблемы потому что я понимаю что такое более менеджмента и скажем так Старт с нуля это когда ты начинаешь разрабатывать не хочешь тратить усиленно что-то лишнее А потом понимаешь что вот сейчас она уже болит и даже уже поздно и вот как вообще понять когда она надо начинать заниматься менеджментом Когда время подошло но у нас случилось похожая ситуация у нас появилась энное количество систем и стал вопрос как их между собой интегрировать то что они должны коммуницировать между собой и вот как раз докладе я расскажу наш путь как мы выбрали epmengine платформу в частности Gravity как мы ее применили как мы используем Надеюсь доклад будет интересен тем кто сейчас задумывается вопросах на тему либо Уже принял Гравити а начну с себя Меня зовут Михайлов Никита Я старший интеграции в департаменте разработки продуктов решений компании передовые платежные решения моя основная задача создавать интеграции И в частности внедрять инструменты которые позволяют создавать эти интеграции внутри нашей компании маленькая креда хочу больше уметь поэтому пытаясь рассказывать что знаю люблю коммуникации люблю делиться мнением получать чужое снаружи также мой личный пашен еще со школы меня ведет Я очень вдохновлен идеей подключить что угодно к интернету делал так уже неоднократно идея умных домов и так далее очень мне близка но начнем немножко про нас Я посчитал что Стоит немножко аудиторию познакомить с нашей компанией Чем занимаемся Мы предоставляем различные услуги в секторе B2B предоставляем обслуживание предоставляем и обслуживаем инструменты для приема обработки платежей связанных с топливными продук так и многими другими которые востребованы в B2B но как из примеров это ремонт и штрафы командировки мойки и так далее важно частью нашего бизнеса является топливные карты это возможность предоставлять услуги на обширной сети АЗС Российской Федерации так и за ее пределами также Мы создали и поддерживаем платформу для предоставления этого широкого широкого спектра услуг для бизнеса и чем я хочу поделиться это часть наших целей которая относится к теме доклада Наш бизнес преследует цели одна из них это экосистема решения для бизнеса платформа процессы где можно управлять пользоваться услугами которыми готовы предложить как простой пример вы например владелец таксопарка или просто какого-то большого автопарка хотите контролировать сколько водителей заправляются выдавать определенное количество денег на заправку Да там разрешать дополни тельные услуги или же весь автопарк страховать мы можем предложить вам такие услуги все в рамках одного окна и одна из этих важных целей это лучше цифровой опыт для клиентов и партнеров то есть мы не только хотим предоставлять услуги Мы хотим чтобы эти услуги были удобными быстрыми понятными А главное нужными и двигаясь от этих целей у нас появились определенные задачи в частности у нас уже было достаточное количество сервисов и увеличивать опыт и добавлять услуги это всегда допиливание новых сервисов и возникает вопрос как эти сервисы между собой интегрировать рост систем в какой-то момент становится экспоненциальным потому что бизнес просит больше разработчиков меньше получается проблемы коммуникации между собой если представить интеграцию просто в лоб Да выглядит очень страшно все интегрированы со всеми вложенной интеграции непонятно как работают процессы и нам потребовалось решение которое поможет нам это все Хотя бы сделать прозрачным да то есть понятно что в некоторых решениях нельзя уйти там от тех же вложенных иммиграции такие процессы система они существуют отдельно но нужно хотя бы сделать это прозрачным в первую очередь приходит решение на основе Джинкс Да мы просто поднимаем какой-то инженер сервер который по определенным параметрам роутид из одного сервиса в другой но не очень хотели выделять отдельную команду под каждую команду этого сервиса основная же идея задач это предоставить командам разработчиков необходимый инструмент чтобы они сами могли им пользоваться поддерживать свои API нужна удобная понятная производительная система немножко изучив возможности доступной вообще в мире мы поняли что нам подходит подход ипяги твои А после дополнительного изучения про это дальше расскажу возможно целое 5 менеджмент платформы так вот Какие ключевые цели Нам необходимо было достичь да решая наши задачи на самом деле первое самое важное это безопасность очень сложно контролировать среди там десятка систем А как в эту систему у тебя безопасно происходит авторизацию А есть ли авторизация на этой системе А в этой системе у тебя просто статично токены которые засветится то есть задача была сделать Наши коммуникацию интеграционные вообще связи безопасными вторая задача это маршрутизация мы хотим выставить единую точку доступа к нашим сервисам и хотим управлять этой точкой для доступа к нашим в зависимости от требова Ну самый простой пример который могу дать это что у нас например в бэке что-то меняется Да мы не хотим как иметь какое-то даунтайм Для клиента ничего для пользователя Юрий Юра не меняется Мы в бэке всё просто меняем совершенно новый сервис который используется третья цель - это агрегация она больше такая как раз таки относится к цели компании лучшего опыта лучшего цифрового опыта то есть задача не просто предоставлять сервисы но и быть открытым Для клиента то есть если в какой-то момент случается ситуация при которой говорит Клиент говорит Мы например не хотим делать 10 разных запросов 10 разных систем чтобы получить ваш ваши данные Можете ли вы сделать какую-то один Поинт который вернет нам все Да мы хотим это чтобы у нас это было достаточно легко и быстро Ну и на самом деле такое мейнстрим на это кэширование Я думаю стандартно для большинства вообще продуктов разработки Конечно хочется скорость и стабильности на данный момент что удалось достичь Первое это безопасность у нас все интегрировано Через наш корпоративный адвенти-менеджер политики безопасности определяются на самом API они проверяются маршрутизация все наши поинты выставлены на наши корпоративные URL который являются входными они не меняются но обработка запросов от них Да может вариться агрегация так как мы используем инструмент в целом платформа Да можно очень быстро создать новый API который позволит сделать хорошо нашему клиенту что пока не сделали это кэширование потому что не было пока запросов в целом платформа сейчас невысоко нагружена пока у нас идут разговоры на тему того стоит подключать высокой нагруженным сервисом платформу либо не стоит Поэтому пока оставим Итак начну я с того как мы вообще изучали рынок что какой путь проделали и почему мы выбрали именно Гравити задача нашей команды был провести анализ выбрать подходящий инструмент поднять его для нужд наших команд и наши исследования мы разделили на два этапа на первом этапе мы взяли каждый из доступных инструментов искали мы Google Яндекс хаббр LinkedIn Да просто по сути что И что есть что есть сейчас доступно и попытались применить к себе на первом этапе мы выделили 14 требований требований такие как интеграция с кастом Access менеджером доступные инструменты для создания пи поддержка МТС стоимость поддержка Life сайта наличие политик контроля доступа пик его элементам и так далее и рассмотрели 21 инструмент в частности Это был из таких самых наверное известных можно выделить это Гравити Mile Soft Kong kraken Di и другие результаты первого этапа были сведены в таблицу Таблицы я с большим удовольствием поделюсь после презентации на Telegram канале там можно изучить наши изыскания Понять насколько они подходят насколько интересные что вообще было изучено таблица кстати выглядит вот так там получается первая строчка название инструмента со ссылками наверху все требования какие-то комментарии таблица она больше такая она не наверное числовые какие-то конкретных значений Да больше субъективно но инструмент мы все-таки выбрали для второго же этапа после первого этапа Да мы поняли что мы готовы рассмотреть три инструмента в нашем случае мы выбрали три инструмента это кракенди и высо2 и Gravity и задача второго этапа была выделить по для каждого инструмента по неделе физической недели за эту неделю было необходимо подключить инструмент поднять инструмент создать на нем API возможно познакомить команды то есть провести весь Спектр работ который бы позволил Понять насколько тот или иной инструмент нам подходит какие у него есть ограничения какие есть требования готовы на него или не готовы и результатом второго раунда выглядят таким образом показал себя наиболее быстрым легким представлении непосредственной обработки запросов но по сравнению с другими инструментами Был лишен очень интересных фич одних из примеров это отсутствие единой точки конфигурации отсутствие единой точки Правды по API нужны расширения доступны только в Enterprise версии проще говоря кракенди это самостоятельно но у его конкурентов есть Неоспоримые преимущества полноценного полноценный платформы вторым же да и третьим мы рассматривали в so2 и Гравити в целом эти два инструмента оказались похожи по опыту использования архитектуры по доступному функционалу ключевым же вопрос стал лицензирование К сожалению высо-2 ушел с рынка Гравити в интересующей нас функциональности а я говорю про комьюнити Edition полностью нас удовлетворял поэтому мы сделали выбор в сторону Гравити после того как мы сделали выбор настал вопрос как это все поднимать что нам необходимо поднять из чего вообще состоит Гравити Какие подводные камни что нам нужно и мы начали в это внедряться погружаться и изучать так как это было внедрение нового инструмента мы хотели сразу сделать правильно да то есть попытаться внедрить какие-то bestracties какие-то общие конфигурации автоматизации и так далее В общем смысле мы решили использовать кубернатиз на Яндекс облаке облако для нас является местом изучения развертывания концептов поэтому но после отладки и согласование что и согласование с безопасностью у нас что-то перед локальным инфраструктуру Но об этом не сейчас Давайте немножко рассмотрим компоненты поближе Я чуть-чуть вас познакомлю с платформой потому что это поможет понять что же мы сделали да И как это может быть применено значит первый компонент который хочу показать это даже три компонента это потребительский портал менеджмент консоль и E5 менеджмент API все они конфигурируются общим чартом и доступно публично по сути это два ЮА и один на пи для работы этих юань используется для коммуникации разработчики с разработчиками потребителями на API менеджмент консоль создаются опек API там же происходит передача конфигураций на потребительском портале доступны все для просмотра для подписки для создания запросов все наши которые мы хотим выставить наружу да для работы Мы решили что нам очень важно иметь единую точку правда наших API Это позволяет избегать путаницы в документации управлять всем в одном месте да то есть у нас повторюсь за конфигурацию отвечает консоль за доступ из интернета публичных чтения вообще что у нас есть отвечает потребительский портал следующий компонент который нам тоже пришлось разобраться это Елка позгресс и редис эти компоненты не входят в состав Гравити но они обязательно и необходимы для его работы в нашем случае они используются как менеджер Яндекс облака Гравити используют постгальскую для хранения и распространения E5 конфигураций к счастью сам Гравити предоставляет ликвид бой скрипты для создания необходимой структуры баз данных Нам же было необходимо только создать как бы саму базу Создать пользователя определить connection radis мы подключили для хранения и использования информации по подключаемым ограничениям API То есть когда вы создаете API Вам необходимо создать какое-то ограничение Ну например там 1000 запросов в час то как раз таки с помощью radisso эта информация будет храниться в быстрой базе данных получаться в нужный момент времени и не сильно влиять на обработку запроса Елка же для нас является корпоративным стандартом для хранения анализа логов безелка сам Гравити не запустится в конфигурации сделка поэтому мы используем Елка там у нас хранятся логики логи там же мы мониторим и надо они отображаются в своем Гравити и самое важное сущность непосредственно и менеджмент платформы это сам гейтвей сам Gateway Это непосредственно сущность обработки запросов они конфигурируются на с отдельным чартов в нескольких репликов Ну нескольких репликах от одной до необходимого количества команды по нагрузке нагрузка управляется через конгресс да то есть доступ и лот balancing все наши глитвы доступны публично да для гарантии развертывания нужно vpi на нужном gitway используется встроенный функционал sherdentek Он позволяет указать нужный тег на epi и нужно так на графике и после диплоя сама Гравити понимает на какой гейтвей физически необходимо за диплоид тот или иное пи Таким образом мы разделяем физически нагрузки одной команды другой Да если вдруг запросов у одной команды станет больше сервера начнут не справляется другую команду Это не заденет важное уточнение все коммуникации осуществляются через внутренний ингресс после того как мы изучили архитектуру в целом поняли что нам необходимо Какие возможности у нас будут какие сложности начали с этим работать возник другой вопрос А как же вообще происходит конфигурация API как таковых где они хранятся И самое главное как они бы копируются Да в случае когда все упало Как нам все вернуть очень быстро назад на самом деле все оказалось достаточно просто во-первых важно уточнение в Гравити реализован достаточно удобно интерфейс для создания управления Pi там можно блоками параметрами собрать и протестировать его и задеплоить важное уточнение мы ни в коем случае не хотим убирать этот функционал у разработчика и заставлять его учить же сон конфигурацию epi в Гравити Но для дальнейших дипломов Поэтому в этом случае существует и мы не используем две точки хранения конфигураций и мы используем Обе по своим причинам Ну первое самое очевидно это пост ДБ без которой Гравити сам не запустится потому что в момент когда вы создаете через я его ошибки вашей сохраняете вы диплоити он кладется в базу данных позже раз и потом из базы данных уже реплицируется на тот или иной разворачивается где вам это необходимо в частности база используется как стандартный инструментарий там у нас развертываются используются тестовые пи все стрижевые пи да то есть если вы разработчик вы хотите вообще начать что-то разрабатывать на этой платформе Вы спокойно используете UI вам не нужно разбираться технических деталях Просто накликивайте то что необходимо достаточно комфортном ювай также у нас там есть небольшая информация по мониторингу аналитику да то есть сам Гравити позволяет хранить состояние гитлеев состоянии пик кто поменял когда Поменял что поменял что сделал и так далее ну и для бэкапа используем встроенный функционал Яндекс облака По бэкапу базы данных вторая же Извините вторая же точка хранения конфигурации это так получилось что у нас в нашей программе разработчики не могут иметь прямого доступа для изменения продуктивного кода или конфигурации Так что подход хранения в китлабе и использование CD решение которое мы используем для релизов решение хранить конфигурации позволяет нам повторюсь создать себя вокруг этого да то есть разработчик готов к релизу стягивает конфигурацию делает необходимые правки это все закладывается после комита там админ или мастер просто запускают paypline который раскатывает все необходимые изменения в этом случае также остается возможность смотреть конфигурации вживую да то есть выдавать разработчикам ridonly права на конфиги Чтобы понимать в случае проблем Что говорим об одном и том же Ну и в том числе не ограничивать в релизах когда мы разобрались с платформой очень важный Запрос который поступал с самого начала от информационной безопасности это два вопроса аутентификации авторизации очень важно было для нашего инфосека чтобы контроль за доступом был у него что он чтобы не выделялся отдельно админ который производит какие-то манипуляции по созданию пользователей конфигурации этих пользователей нам было необходимо решение при котором все это контролируется в одном месте всё это контролируется в одном месте Итак аутентификация вот аутентификации мы понимаем аутентификацию пользователя человека на на корпоративные порталы E5 консоль либо потребительский портал человека разработчика тестировщика внешнего какого-то пользователя из интернета нашем опыте мы используем корпоративный киклок с интеграцией с внутренним ldap с разными реалами То есть у нас есть Реал под корпоративных пользователей под не корпоративных пользователей таким образом все корпоративные пользователи используют единая точка аутентификации по сути sso как бы сейчас громко это не звучало а не корпоративные пользователи могут регистрироваться непосредственно в нашей клыке да и все права доступа контролируются в этом месте под авторизацией же мы понимаем авторизацию потребительских систем которые делают теперь запросы в нашем случае основным корпоративным стандартом мы сделали Out 2.0 Ну наверное процесс в 20 рассказывать не нужно да то есть у нас есть какой-то традиционный сервер куда мы делаем запрос на авторизацию с Кредо me нам возвращается кстати токены уже с этим токеном мы можем делать запросы получать данные успешно Как это работает непосредственно между Гравити и киклаком значит Существует такой процесс который называется динамик Light registration через этот процесс нашем Кик локе создается клавиантадин секрет вот эти две очень важные информации которые позволяют получить авторизоваться получить дополнительно на уровне API выставляется дополнительные Требования по наличию нужных ролей в токене и получается Таким образом мы контролируем доступ уникального Clint идеи к тому или иному сервису или методу и вот собрав эту информацию по авторизации нам стало необходимо создать процесс предоставления безопасного доступа потребителям да то есть людям скорее даже системам которые хотят нашей стукнуться получить какую-то информацию Мы его описали и пока используем такой Он такой полуавтоматический мы думаем над идеей автоматизации упрощения но с чего-то начали первое С чего происходит команда создает правило на самом API по проверке роли в токене который приходит во время запроса после того как E5 был создан появился потребитель который хочет подписаться Одним из главных условий ему необходимо создать Application так вот при создании aplication это сущность самой Гравити как раз таки через процесс динамик registration создается кланяться секрет Здесь очень важно эти данные выдаются непосредственно пользователю он их контролирует он за ними следит и он за них отвечает сами разработчики только сами разработчики к этому доступа не имеют после того как лайнт один создан этот клан ID передается команде разработки они в свою очередь передают уже непосредственно в иб Где на этот конкретный coint ID выдается та роль которая была создана в начале после того как со стороны информационной безопасности все готово потребитель заходит на потребительский портал подписываться на необходимые API и начинают пользоваться так как правило сходятся нужной информации в токе не присутствует все происходит успешно на данный момент это все на тему самой платформы Да сейчас хочу немножко рассказать про подводные камни костыли с которыми столкнулись первый вопрос который у нас возникает вот Гравити он предоставляет свои компоненты в виде докер имидж вопрос Можно ли Нужно ли использовать готовые уже такие ремич или есть моменты когда необходимо создать свои немножко расскажу Лично я считаю что вопрос такого такого характера должен отличаться непосредственно от требований возможностей которые сейчас существуют в частности я выделяю два Первое это требование B с которыми сложно мириться да то есть нам приходят и говорят то есть ребята все наши сервисы которые используются внутри нашей сети обязательно должны пройти проверку если такое проверка невозможно Вы должны собрать сами или вот мы узнали что в какой-то версии такая ошибка нужно поправить Поэтому в этом случае хочет ты не хочешь придется собирать и второе это отсутствие какого-то дополнительного функционала или критических багов которые мешают платформе работать полноценно Значит сам Гравити из коробки поставляет Две версии своих компонентов они в целом одинаковые отличаются просто функционалом но в плане что одно комменте Edition другое интерфейс Edition и здесь вот они прописаны это Portal я это потребительский портал менеджмент ЮА это менеджмент консоль менеджмент epi это E5 для работы этих двух порталов непосредственно так вот наша ситуация мы столкнулись с проблемой именно с потребительским порталом все было классно с гитлеем все было классно с консолью все было классно с опихой но нам пришлось создавать свой потребительский портал по низким причинам Ну первая причина что из коробки не поддерживается русский язык там есть французский чешский английский русского нет мы хотим предоставлять сервис на русском языке Поэтому нам уже приходится создавать что-то свое допиливать второе это отсутствие нужно гибкости дизайне то есть сам Гравити позволяет портал как-то кастомизировать но не настолько хорошо как бы это этого хотелось да то есть какие-то короче нельзя изменить расположение блоков нельзя изменить и поэтому для того чтобы например включить какой-то шрифт который у нас там единый Да через все системы тоже пришлось создавать собирать имидж отдельно была пара критичных багов и самое на самом деле важно Почему вообще ну я был на это согласен чуть ли не с первого раза Да у нас есть план по единой поддержке контента То есть у нас есть СМС система в которой находится контент и мы хотим чтобы это управлялось доставлялось из одного места поэтому Да очень просто нужно в какой-то момент то что мы сейчас по сути просто собираем из исходного кода переписать под себя используя то что те наработки которые уже имеются очень важный момент который мы тоже столкнулись это подводные камни то с чем Возможно вы столкнетесь Если вы будете пытаться поднимать эту систему то с чем мы столкнулись Ну первое о чем можно сказать это баги багов платформе хватает они не влияют на стандартный функционал до на мейнстримный функционал при котором сами переработают возможность накликивать работать передавать данные но баги присутствуют я расскажу про один из них который мы сейчас испытываем например ситуация вы как потребитель хотите подписаться на шапи и вас целая команда и вы хотите шарить Кредо между собой в рамках там Кредо и документацию в рамках команды что я например делал Да будучи вот таким человеком Я бы хотел зайти на какой-то портал Зарегистрироваться создать какую-то группу при которой в рамках этой группы существует эти же пользователи и все необходимые сущности в частности Application которым Мы все имеем доступ быстро Ремарка Application необходим для того чтобы Вы могли вообще создать подписку и сделать запрос на E5 так вот к сожалению прямо сейчас если вы с вас несколько на одном корпоративном портале на одном потребительском портале вам даже будет создана группа вы даже будете входить в эту группу то через юань обычными средствами нельзя добавить несколько Application of в эту группу Почему не знаю лишь я уже написал ждем фикс пока что мы добавляем вручную через базу Ну потому что все конфигурируется напомню в базе Да можно зайти в базу нужно изменение сделать вторая проблема неожиданная для нас который мы столкнулись уже после разворачивания даже по сути уже открытие дверей для разработчиков это моментальное заполнение Пула SQL То есть я напомню Гравити используют для хранения и передачи конфигурации от Юла непосредственно и в какой-то момент у нас получилось так что при обновлении либо просто ночью с того ни сего стало плюс 200 плюс активное подключение к базе из-за этого битвы не могли подключаться к базе Хотя почему-то старый Connection не закрывались новые конфигурации не заливались тоже немножко лежал потому что он не мог ничего передать как решили решили очень Просто для каждого сервиса Gravity мы установили минимальный максимальный размеры подключения как на самой базе то есть Мы во-первых создали разных пользователей под разные компоненты А я напомню у нас там есть компоненты которые отличаются самой Гравити есть компоненты которые принадлежат команду те же битвы да они стучатся в базу под каждого такого пользователя Мы создали отдельного пользователя выделили ему непосредственно забитое число Connection Pool of сейчас все работает замечательно мое предположение мы просто неправильно поняли конфигурацию самого начала когда начинали это внедрять следующая проблема но скорее не проблема отсутствующая фича Даже скорее не отсутствующая фича а фича которая заставляет тебя использовать весь Спектр инструментов Гравити который они предоставляют проблема такая Когда вы создаете свой Application клавиатодиклан секрет вам предоставляется из киекла к вы не можете их менять Единственное что можно сделать в целом по процессу это обратиться опять клок и получить новые новые cline секрет зачем это нужно Ну например ваш клан секрет был скомпрометирован вам нужно срочно поменять Чтобы никто не злоумышленников не мог обратиться с вашими кредами в нашей API к большому то есть сам функционал регенерации клайн секрет Гравити присутствуют но он не нативен для тех клока он нативен для гравити эксцесс менеджера то есть в этом случае если мы хотели чтобы это работало сразу из коробки нам бы пришлось помимо комьюнитишин Гравити отдельно покупать Gravity XS Manager коннектить между собой они слава Богу работают и пользоваться но так как был киклок поднимать еще одну авторизационную систему Было бы странно поэтому сделали очень просто на самом же Гравити У нас существует отдельный грубо говоря набор гитлеев которые используются только там команда и Админа в Гравити Мы создали epi который принимает в себя запросы от Гравити На регенерацию клан секрета трансформирует его в запросы которые понимают клок авторизуемся через админа пи дальше получаем ответы такие клока трансформируем ответы такие клока в то что понимает и Гравити и получаем обновленный cline Secret то есть мы с помощью вопрос вопрос регенерации еще не очень самое важное на самом деле из проблем которые у нас была которая изучить возможно кто-то скажет это костыльное решение но решение идея в чем Гравити в комьюнити эдишен не предоставляет только одну среду да То есть вы можете создавать свои 5 в рамках одной среды и все то есть также То есть если вы например хотите в рамках вообще в рамках платформы иметь D в среду тест среду стоит среду про среду то в этом случае надо покупать Enterprise Edition лицензию плюс там еще идет градация Да от лицензии зависит Какое количество средств вы получаете вопрос пришлось решать потому что имеем что имеем решили вопрос решили вопрос созданием процесса работы в одной среде в частности Я уже рассказывал мы используем тег Да в этом случае для каждой команды выделяется набор там трех пяти твоих Которым определён какой-то шерген так и дальше команда которая заходит на платформу Gravity во-первых и поднимаются эти битвы потому что они только для них нужны только они будут работать им выделяется какой-то ширден так и мы уже в валидациях проверяем что такая-то команда диплоидная какой-то шортин так и сам уже сама платформа Гравити непосредственно диплоид физически конфигурации на конкретный битвой и таким образом у нас получается одна среда но несколько громкое слово кластеров которым верен какой-то шернен так можно это назвать мульти тональность но в языке Гравити это sharken теги важно и нужное отсутствующая фича в Гравити точно такая же как и по сути своей смены клан секрета это алертинг причем Я говорю не про лифтинг самой платформы имеется ввиду что там где твои упали и твои недоступны или там CPU какое-то увеличилось Я имею в виду непосредственно олеркинг по запросам То есть мне как продуктовому дали разработчику какой-то вот продукта очень важный нужно первым узнавать что мы ответил 500 и я не хочу чтобы ко мне приходили на на Саппорт Да там через полчаса только это случилось Я потом буду разбираться по ходу я хочу врываться первым изучать понимать и улучшать цифровой опыт нашего клиента а как же решили этот вопрос Ну тоже использовали стандартные инструменты Гравити так как все логи у нас записываются в елка в Елка передаются логи четырех типов Это request непосредственно сам факт запроса да то есть когда он пришел Какой ответ был получен тела запросов это ну боди Да грубо говоря то есть по сути тот же request только с телами Health Check и метрики так вот используя Елка используя инструмент по-моему елка алирт мы настраиваем alerting непосредственно по запросам Да это не так гибко как бы я бы хотел что когда ты как разработчик заходишь на Гравити накликиваешь конфигурация при которых у тебя Ну вызывается алертинг и все работает двигаемся пока в эту сторону что же у нас по дальнейшим планам да то есть мы хотим развивать эту платформу она нам нужна она уже решает достаточное количество вопросов она уже делает определенной интеграции прозрачными и хочется внедрять это все сильнее Да чтобы мы максимально переехали нашими сервисами причем Даже в вопросах коммуникации корпоративный сервис корпоративный сервис Да не просто выставление наружу первое о чем могу вам рассказать Мы хотим внедрять в целом по компании синхронный пиай Ну и в частности использовать API Gravity менеджмент платформу Гравити для синхронных API у нас пока еще идут Разговоры это пока примерно идея того чего мы хотим получить но смысл такой у нас есть какой-то сервис это вот и пимплементейшен БК бэкент и он и коммуникации с ним происходит через какой-то синхронный инструмент Кафка rabbitonq неважно И вот вопрос у нас приходит какой-то пользователь из интернета который тоже хочет получать данные либо писать данные в этот сервис Как нам предоставить к нему доступ не предоставляя доступ напрямую к синхронному инструменту опять же по политикам безопасности архитектура пока обсуждать не будем мы рассматриваем что в этом случае для всех внешних потребителей мы будем выставлять синхронное пи который имплементирует асинхронный IP в этом случае потребитель если ему нужно что-то записать в какую-то систему делает пост кладет необходимые данные сама Гравити уже берет эти данные складывает в кавку в ребит мккью в процессе дальше другими инструментами А за статусами возвращается потребитель сам по сути такой пул подход то есть для записи мы кладем для чтения статусов мы вытягиваем для корпоративных пользователей а имеется ввиду прошущение сервисов ситуация немножко проще но немножко усложняет целом картину да То есть если мы используем все синхронные дата в любом случае мы говорим о том что если система должна система б синхронно она должна идти Обязательно Через гейтвей Но если происходит ситуация что у нас коммуникация происходит через асинхронный инструмент через асинхронный транспорт мы не хотим блокировать такие возможности потому что было бы странно запрещать пользоваться кафкой когда она есть теми инструментами которые она доступна другая идея которую мы тоже очень хотим внедрить это валидация конфигурации То есть как я уже говорил про процесс у нас прод релиз у нас основан на основе gitlab CD то есть разработчик стягивает конфигурацию с через юань делает какие-то изменения это все у нас прописано в документации мы продолжаем Это автоматизировать и кладет gitlab дальше процесс должен взять эту конфигурацию и раскатить в Гравити используя по сути менеджмент API и прямо сейчас мы используем валидацию на основе json схемы То есть у нас есть большая схема которая определяет Как должен выглядеть же сон какие там параметры должны быть это все конечно хорошо но не так круто как бы например использовать какой-то Open policy Agent в чем его основная задача в него прилетает что-то сам полюсе определяет что к нему пришло проверяет на основе политик который определенно для этого что-то что там должно быть верно что неверно и в ответ возвращает Валид либо не Валид то есть мы в рамках вместо проверки json схемы отправляем всю нашу конфигурацию на какой-то черный ящик который ответ возвращает валидный инвалидно чем крут подход что у нас есть контро за конфигурациями в одном месте а в частности наши б очень заинтересована в этом чтобы контролировать это все да то есть повторюсь чардин теги условия конфигурации авторизации Да там роли надо прописывать там доступы пользователей и так далее То есть мы прописываем под каждую команду какой-то вообще сначала какой-то общий шаблон Да и хотелось бы потом под каждую команду там Если необходимо то есть какая-то команда не использует процессор 2 это согласовано да для них это отключается и так далее очень хотим внедрить надеемся что у нас это получится и что осталось вам показать это метрики цифры которые мы имеем прямо сейчас значит сначала 1023 года а внедряем и Гравити с июня 22 то есть в июне 22 я начал мы начали это все изучение анализ и где-то начале января Прошу прощения в конце января 23 года мы начали уже запускать команды ловить подводные камни грабли так вот сначала 1023 года на данный момент у нас 6 активных IP которыми пользуются причем пользуются как корпоративные системы так и внешние партнерские системы было создано больше 30 тысяч лидов в нашей CRM системе через gitway было создано 514 КАСКО полисов и было застраховано 319 грузов то есть где-то в районе марта мы зарели систему которая позволяет заниматься страховками это система была развернута тоже на Яндекс облаке чуть ли не с самого начала была подключена Гравити и таким образом Да через систему уже прошли реальные деньги и из перформанса данный момент времени обрабатывается три запроса в секунду Да немного но сервисов у нас API у нас пока 6 и средний медианная время обработки 160 миллисекунд в это время входит работа бэкенда То есть если ваш Back and медленный то обработка запроса тоже медленно если ваш Back and быстрый то обработка запрос запроса быстрее Сам же Гравити может влиять на время обработки запроса чем больше политик обработки данных вы в него запихиваете а там можно делать трансформацию джессона в xml или обратно какие-нибудь запросы в сторонние системы для авторизации для агрегации данных и так далее напоследок хочу сказать большое спасибо русскоязычному комьюнити Гравити Если вы заинтересованы в Гравити и в целом платформе очень рекомендую подключайтесь в нашей комьюнити классные Ребята помогают большой опыт из разных компаний в Российской Федерации Так что будет минутка заходите Ну на данный момент я очень я заканчиваю буду очень рад услышать ваши вопросы Спасибо большое спасибо большое за доклад в чате вопросов пока нету то онлайн например да спасибо А вопрос у меня следующий вы как-то может быть уже им комментировали либо задумывались над георезервированием платформы я его распределения я не услышал еще раз спроси пожалуйста Может быть вы уже имплементировали или как-то задумывались надо гео распределением георезервированием всей этой платформы да на самом деле нет не задумывались потому что у нас повторюсь сам getway расположенный Яндекс Облаке Да у нас нету запросов пока не откуда кроме как из Российской Федерации часть запросов обрабатывается в нашем соде но наверное ты забегая вперед да то есть если такое будет необходимо то у нас просто на гитлеях появится дополнительный шардин так по которому можем раскидывать API но на нужный сервера в нужных странах Да я согласен возникает правда проблема с например лимитингом и редисом его распределенным но это уже можно дискуссионным знанием Да с большим удовольствием но повторюсь смысле дополню что вот проблемы которые вы описываете это наше будущее да и да Круто Давайте обсудим Спасибо большое там еще был вопрос сзади по моему да большой за доклад вот там был слайдик по поводу ребил до своих докер образов и вот здесь очень такой наболевший вопрос он даже не Гравити больше относится вот у вас есть условно там ну назовем это вендерскими образами Да который комьюнити пилит вы себе в каком-то виде это портируете ну там допустим требований бэшников есть какой-нибудь базовый образ вот это вот все как вы синькаете изменения которые тут в реках вендора условно со своими наработками Ну во-первых так как мы собираем сами достаточно один из легчайших образов которые мы берем Гравити это потребительский портала потребительский портал это по-моему юань на ангуляре вот там не часто изменения поэтому отвечаем вопрос пока вручную знаю что вот в комьюнити есть люди которые все образы собирают сами то есть полностью у них там какое-то требование консоль потребительский портал i5 они собирают полностью сами Поэтому вот если прям вопрос есть залитая с большим удовольствием ответит и вот рядышком совсем вопрос там еще говорилось то что вы почти свои сделали какие-то не помню В какой компонент вот где-то дальше было И вот тоже вопрос по поводу патчей вот допустим вам нужна какая-то функциональность вы условно разбираетесь продукт где там что как и в состоянии написать этот патч самостоятельно условно как действовать сперва ишью и ждете когда это кто-то из комьюнити сделает или сразу приходите с готовым Почем типа вот Ребята посмотрите и пожалуйста в мержите Ну смотри у меня смотрите у меня своей команды нет Да здесь все происходит как бы как оно есть есть комьюнити и сам разработчик который поддерживает в целом основную систему Да и Они открыты по реквестам вопрос как они долго их закатят непонятный Но что самое важное если этот патч супер критичный при котором продукта не хотят заходить в этот инструмент не хотят им пользоваться забираем забираем код собираем травим собираем сами и работаем уже сами вот так спасибо Ну да вот вам еще вопрос скажите вот на схемах у вас указано что работа с Елка Но насколько я знаю сейчас Яндекс облака активно переводит клиентов на opensearch Вы пробовали уже Гравити сверчем То есть это нормально работает или это только в планах физически не пробовал знаю что поддержка opensearch 2 выше присутствует и люди пользуются и даже пишут ишью разработчикам что возможно что-то не так то есть я руками не пользовался на самом деле у нас глобальный план вообще уйти от елка в этом случае мы просто будем использовать логики кидаются в кафку А там уже куда надо они отображается Спасибо Большое спасибо У тебя есть вопросы Максим у меня вопросов море но у нас время уже заканчивается поэтому предлагаю всем пойти в дискуссионку Большое спасибо увидимся через минутку"
}