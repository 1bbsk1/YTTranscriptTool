{
  "video_id": "WSNJU7RYhC4",
  "channel": "DevOops_conf",
  "title": "Виталий Хабаров — Continuous Delivery в Windows среде",
  "views": 906,
  "duration": 2068,
  "published": "2018-02-16T03:59:21-08:00",
  "text": "я являюсь инженером экспресс 42 и мы уже более пяти лет поставляем диод за деньги разным компаниям среди наших клиентов есть как стартапы так и кровавый enterprise одним из наших продуктов являются в вики по окончанию с delivery и за ним к нам обратился один из наших клиентов у клиента очень хороший инженер и сильные жене ран хорошая культура они знают про devops они открыты к обучению ездят на конференции и даже пытались построить вникнем в ривере у себя внутри они начал рассказывать про свой проект в них есть сервис очередей на линуксе есть это базы на линуксе опять же но основная часть это dot net на виндоусе саима соску верим услышав это меня сразу бурю эмоций домой я думал исполнился боль без его администрирования кучу прокручивание на x то графический интерфейс и не возможность автоматизировать падение на ровном месте и ошибки которые говорят абсолютно не о чем но после пел первой волны этого тленно и отчаяния немножко проветри в голову можно было услышать что говорит сам клиент а клиент говорит следующее у нас процесс поставки очень долгий мы замечаем баги спустя недели а то и месяцы уже на продакшене нам об этом рассказывает наши клиенты тепло и мы раз в два месяца в лучшем случае если повезет процесс этот очень сложный наше тесто окружения они все как снежинки падут рассыпаются тест это проходит они проходят рода это все отличается разительно там большая пропасть между ними непонятно к кому ты все состояние мы подумали мы поняли что эти проблемы мы с ними сталкивались к нам как почти каждый клиент 2 заходит и не с такими проблемами это проблема не windows специфично а учитывая то что половина инфраструктуру все равно на линуксе который мы знаем и любим мы решили давайте сделаем им и закончились на следующий проект мы автоматизируем процесс создания тестовых окружений по кнопке то есть автоматизируем создание окружении конфигурацию тепло и приложения deploy баз данных логирование мониторинг я обычаем этому всему инженеру с клиентом вначале перед тем как вообще браться за любой проект на виндоусе можно решить а какую роль вас играет active directory если спросить рядового администратора windows можно услышать что это удобный инструмент для автоматизации и нас на управление правами доступа я этого не особо разделяю она прикольная на рабочих станциях обычных пользователей если мы говорим про продакшен про наше приложение которое приносит нам деньги нужно сильно задуматься автоматизации настройки у нас будет выполнять шеф в систему управления конфигурацией родительская авторизации на мне нужно абазова нам опять же обеспечивает шеф единственная задача под которую active directory . не может решить а что active directory может я тогда нам нужна платформа кто использует active directory там шерпа int или что-то такое слава богу у нас на проекте этого всего не было и мы закончили столько на то что мы проверяем что шеф может внести нашу машинку в доме и всё на этом наше участие в active directory и закончилась active directory помимо этого еще вносят некоторые ограничения в плане подготовки образы машинки машинки вообще просто внедрения в доме сам sysprep которая дает ограничение дает лак настройки такой ведь такие вещи и вот мы отказались от идеи active directory и 1 нам шаг это просто как-то запустить наше окружение хоть как-то в любом в состоянии важно и первая попытка и the kitchen чай и плюс локальные машинки и честно признаюсь это одно из лучших решений пока над проектом работает только один жене когда ко мне присоединились коллеги от клиента и коллеги из экспресса на сразу появилось гетерогенных средах тот работал под маком кто-то работал подвинуться миндаль и нам стало сложно просто поддерживать в виртуальной машины в том в нужном состоянии нам приходилось создавать три набора виртуальных машин и следить чтобы они были одинаковыми это сразу же зафейлилась и нам его перешли в облака облака дало нам один из среду запускать виртуалок и решила проблему локальных виртуальных машин но что нам еще квитанции дал нам lookup это доступность amazon никогда не гарантирует что первого вашего стальная машины поднимется как надо то есть не надо уметь поднять посмотри что оно запустилось и и случае чего взять и перезапустить также есть вопросы с сетевой канакина доступностью если мы коннектимся локальный amazon иногда у нас происходит просто потери пакетов и нормальная сила активность как тоже надо учитывать это нужно обрабатывать ресурсы для windows 10 и неравнозначны если мы запускаем linux-сервер нам обычно нужно сильно меньше ресурсов в нашем проекте ск разницы между windows и linux машинкой было две конфигурации типа т2 микро и т2 large для windows нужны лицензия и слава богу amazon за нас для подумал и включается стоимость лицензии в самом стоимости на солнце и не стоит забывать его различий в работе windows linux с аппаратной составляющей и в принципе это не работают там это как диск сеть там различные сетевые ресурсы аннотации самбо у нас это говорилось следующее мы подняли linux минус машинку все работало хорошо да но он был стар и когда наш тры спросил какой-то большой файл с linux и он его не получал все работало хорошо вот только кроме этого случая разобравшись мы поняли что внутри в настройках в линуксе были включены джамбо фреймы в windows этого не была включена и вот это расхождение в конфигурации породила потерю пакетов мы это решили и третий подход это все или клауд то есть нужно было сказать чем нас не устроил кичимся кисть я это локальный утилитам и ее тоже нужно было ставить на локальные машинки на windows на linux на mac и тут были своим monkey нюансов тоже надо было следить за правами доступа затем чтобы разработчики инженеры запускали своей машинке потом их опускали при необходимости нужно было решать такие мелкие янтарные задачи типа кому какая печник дать кому какую сеть выделить и опять же и следить за тем чтобы конфигурация тичино было у всех одинаковая при переходе ksyusha мы дали единую точку входа которые ходят все инженеры в том числе и и разработчики и обличились это выгодно головняка вся и нам предоставил возможность наблюдать текущее состояние нашего проекта и окружение поднята до мы потеряли немножко гибкости но в целом плюсы перевесили если мы начали говорить прощай то можно поговорить курсе агентов а именно на какой операционной системе мы ее запускаем если у нас проект на dota этим она не тот на от кори то компилировать проект скорее всего мужа статью только на виндоусе и часть наших агентов должно быть на виндоусе что это нам несет проблемам видео работы с сашей из ассаж клина ключами нам нужно в этом думать нам нужно об этом знать и нам нужно это настраивать потому что работа с api в этом происходит пояс из аж работа с линуксом происходит поясе стаж работы с битом работа идет по ssh если же мы внедряем часть клиентов на линуксе нам же нужно следить за тем чтобы конфигурация на двух типов клиентов всегда была актуальной лишняя работа вот мы запустили наш проект с помощью seo я в амазоне дачном нужно как-то его настраивать видно этом нам поможет система управления конфигурации андрей филатов перед буквально предыдущий доклад в этом же зале рассказывал о плюсах и минусах различных систем управления конфигурацией я же хочу поговорить больше о специфичные для windows вещах и что нужно учитывать именно из мы убираем систем продукцию рация ему для windows нам нужна поддержка и желательно нам нужна поддержка камню нити мы должны посмотреть зайти на инте был galaxy или на супермаркет шанс и посмотреть какие к комьюнити модули вообще существуют для наших систем управления конфигурации есть ли те которые нам подходят второе что нам нужно решить это так систему управления фигура цей будет работать с нашим окружением есть мы увидели два основных решения мне рассказывать что еще можем через р детей как-то но честно и не знаю как первый способ включения этой венеры нативный метод для windows но у него есть один одно ограничение помимо security issues я не знаю к сожалению каких венера на есть некие ограничений которые не позволяют вам скажем доставить обновление и просто захватив вы получаете повышал консоль на обновление вы поставить не можете и screensaver мы также не можем поставить опять же по тем же самым ограничение там нужно было лицензию как-то про кликать правильным образом она не дает шеф который мы использовали решал эту проблему вообще банально он заходил в в миром сессию и создавал с кирилл тоска казалось бы зачем тогда эти ограничения второй метод подключения это ssh но ssh и вне нативный метод то есть нам нужно установить вот он и саша сервер на винду начать его configure на 100 начать его поддерживать и по этой причине нам не нужен был лишний элемент в нашей системе мы его не использовали при написании конфигурации мы используем стандартный для экспресса подход без сервисы определения конфигурации на слои в зависимости от назначения и частоты изменения базовый слой отвечает за установку обновлений драйверов и конфигураций операционной системы меняется крайне редко за этим следит опера перед шанс чаще всего и написали чаще он также остается на протяжении там долгих лет сервисные уровень отвечают за установку сторонних сервисов таких как базы данных сервис очередей и за их настройку об уровень особенно примечательно он отвечает за настройку и установку самого приложения которые приносит нам деньги она меняется обычно часто и за его написание мы стараемся привлекать разработчиков как людей которые имеют обладает наибольшей экспертизой о том как работает их приложение должно работать приложения мы об уровень нарисованы через of cookies и у нас есть некоторые принципы которых мы стараемся придерживаться от клубу ки должны храниться вместе с кодом разрабатываться вместе с кодом и поставляться вместе с кодом для этого моего выхода жар в один тоже артефакт запихиваем и диплом вместе с кодом и спускаем прилипло и в этом нам помогают policy файла это новая штука для шефа она позволяет нам хранить полностью средств сей нашего всей нашей конфигурации то есть все параметры и все версии наших клубу cove чем отличается от informed of them to что мы в зависимости от окружения можем использовать абсолютно любые клубу ки а не только последней чего раньше нельзя было дальше мы приходим к написанию непосредственно конфигурации и тут мы учитывать как windows 10 работает со строками 1 перевод строки кажется проблема высосана из пальцев все современные редакторы умеют подставляется нужный вид перевод строку строк и проблему не должно быть до тех пор пока у вас на содержимое файла не зовешь что-то не завязано яко метил файле видит из мака потом этот файлик получал windows и говорила о вас валик изменился давайте мы все ваше окружение наконец сотрем ее пирс и заданием снова в поведении не очень хорошая и прошлых приходилось на всех машинках настраивать guide of the сериалов равно true что все работал везде одинаково второе регистр проблема с которой столкнулась непосредственно разработчики раньше они не хранили файлы на сам по шарахни локальных дисках и все работал хорошо потом они уехали в amazon и начали хранить файлы в amazon s3 amazon s3 в отличие от windows за регистрац лидит и каково же было их удивление когда они запустили сервис а у них половина стиле не погрузилась и проблема пути и слыша вот так выглядит мой путь написания любой новой конфигурации для windows я пишу это крайне редко и стараюсь вот прохожу по всем четырем пунктам сначала используя прямые слышали потом обратный потом дублируя потом еще и скопирую : конечно не всегда хорошо заканчивается не всегда получается получить доступ нужным файликом дальше нам нужно установить программное обеспечение и драйверы для windows не то нативного пакетного менеджера зато есть шоколатье шоколатье использует некие от пакета может использовать медед пакеты и в скорейшего вам придется их использовать написано учиться писать самостоятельно потому что шоколатини предоставляет весь спектр используемого windows среде программное обеспечение а часть пакетов просто устарело еще факт про шоколатье если вы используете бесплатную версию будьте готовы использовать локальный репозиторий мы сразу же после внедрения шоколад я в первую же неделю мы столкнулись что трижды не был доступен при публичной репозитории просто на него была слишком много запросов бесплатно шоколате и гарантирует вам никакой доступности раз мы заговорили о пакетах можно задуматься вообще какие артефакты нашем проекте могут быть нашем проекте это были шавку букет вашем проекте то могут быть там принц был роли salt модули еще что то то есть то что описывает вашу конфигурацию непосредственно само приложение различные datasette и которые мы тепло им на тесто в окружения из которой мы работаем это различные зависимости и сторонние библиотеки а также драйвера и софт это нужно хранить это нужно обеспечивать просто об этом надо помнить никаких особых различий между windows и linux людой в этом плане нет окей мы настроили окружении нам бы теперь повторять его постоянно запускать как можно больше и тут возникает проблема для установки настройки windows с нуля прогоняя по всему циклу то есть настройки операционной системы и установки драйверов и обновлений у нас ходила дофига времени разработчик мог с утра прийти заказать для окружения и уйти и проработать весь день без бесхозного кружения из-за большого количества ребутов необходимых в этом процессе и просто продолжительности процесса поэтому мы начали использовать потер раз там раз индию для базового слоя и там раз пару дней для сервисного своему прогоняем пакир и получаем готовый образ со всеми необходимым нам предназ тройками потом мы этот образ запаковываем модуль тира форма мы обвязываем его переменными и которые рассказывают нам в какой вики силу надо поместить какие правила firewall создать и в такие вещи здесь это позволяет нам переиспользовать одни и те же сервисы в разных наших проектах и разных типах окружения мы можем использовать и сквер сервер как в тесном окружении так и в окружении для теста производительности так и продуктовом окружения здесь я очень не хочу напомнить рассказать о том что у тира форум появился телефон модуль registry это комьюнити модули совсем недавно появилась очень крутая штука если у вас будет возможность кормить и туда в итоге наше окружение выглядит примерно следующим образом в самом внизу самом в базе у нас и лежат hfq будь и оборачиваете шавку запускаете шеф кабуки пакиром мы получаем образ которым мы над которым мы настраиваем тира for модуль выбираете киров ул модули как кирпичики и оберт вы их в одну большую телефон конфигурацию можем получить окружении чтобы до настроить это окружение и мы заворачиваем это все в полисе файл дополнительные сверху и мы прогоняем shuffle и таким образом у нас получается наши готова окружения дальше следующий шаг это выкатка приложение а что нужно выкатывать вопрос не платить нужно само приложение конфигурации приложения и дата сайта за конфигурации приложения назначает шеф и тёплое место с приложением за штат дотер скриншоты дачу инженера клиента попробовали в начале использовать ваш диплом и как они сказали они очень много наелись его и решили перейти на полшага из-за отсутствия гибкости и не знаю что еще в общем они очень не понравились они на вернули это все пошел а потом они обернули тов шеф и нам это способ было более чем достаточно мы могли праве женить наше приложение как на старые окружении так на новые так соответствует окна прот есть средства такой как автобус диплом я к сожалению не использовал но при подготовке доклада я опрашиваю людей разговоров с людьми и про него очень лестные отзывы единственный минус он платный диплом схема базы данных очень большая боль была для нашего клиента они нас очень часто спрашивали как же так от нас релиз там 2-ми от 2 месяцев до полугода и столько изменений накатывается в базе данных как нам с этим жить рекомендация здесь простая стараться не изменять базу данных смысле альтера еда постараться добавлять новые поля и переиспользовать их но версия кода в этом помогу это можно называть как на просто из файлов и есть история успеха например с такой flow так и делает просто небольшой сколь файл который добавляет новую полярность и лишь бы использовать инструменты по типу флавий отлично мне кажется я что-то забыл отлично мы выкатили наше приложение мы создали окружении нам теперь было за мониторить вообще понять а как ханна живет в дальнейшем какой жизнь и цикл у него есть мониторинга мы из подняли локально zabbix для мониторинга приложения отлично подошел new relic new relic зашел разработчики просто отлично он дал ему удобный инструмент интерфейс и очень простую интеграцию а для сетевых системах вещей мы использовали zabbix и отдали его в эксплуатацию части халф чеков но сетки оставили на записи но что есть важно сказать что для сбора метрика системных метрах в windows есть два метода основных это повышал и perkman первый наш попытка была очень глупая в лоб попытаться напасть повышалась снять все нужные нам метрики и мы получили очень большую нагрузку на цп сплав простое у нас тратилось до половины времени просто на снятие метрик часто мы не получали эти метрики у нас на графике были с провалами мы заметили там про заметили этот проблему и подумали и нашли что большинство метрик системы хана есть персоне мы перешли на purple он начали дергать оттуда удивительно но наша производительность поднялась сожалению метрики в purple он пишет далеко не все утилита но если мы говорим про microsoft то большая часть microsoft т.к. но туда пишет и старайтесь оттуда их забирать следующий пункт планирования для лакирования виндоусе есть два метода опять же это event viewer и обычный лог файла с инжиром опять же очень мало утилит работает и спрашивай разработчиков с узнал о том что то не очень удобный формат для хранения логов ли чаще всего логе хранятся автор напрямую в лог файла мы от кого не беда не любой любая система централизована хранение луков с этим справляется мы использовали френди потому что нам нужен был на стороне все на стороне сервера смысле сервера приложения обрабатывать и парсить этиологии но возможны любые другие инструменты типа гримлок бит и lk стакан что в итоге у нас получилось мы сократили создании окружения с четырех дней ручная работа инженера которым приходится отвлекаться от основной работы до 1 часа автоматическом режиме по запросу любого и разработчика или инженера клиента мы получили полностью тиражом окружения они создаются автоматически мы сможем переиспользовать мы можем их перес пользовать на любой стадии нашего континента wind pipe айну с помощью использования и полюсе файл мы всегда получаем понятно и состоянии окружения мы всегда знаем каком состоянии что дебилу то что происходило с нашим окружением и мы создали сервис мониторинга и логирования и научили пользоваться как команду эксплуатации так команду разработчиков на этом наш проект закончился но один из delivery для клиента нет можно ли сделать лучше конечно можно мы общее мы продолжаем общаться с развратными с нашим клиентам вид дали следующие рекомендации нужно дробить монолит зачем когда ваша сборка и тестирование занимает час за час вы успеваете сделать очень много успевать и закомитить счет реками то и уже потеряете контекста что сертиф час назад происходило поэтому этот процесс нужно ускорять для этого мы рекомендуем уделить монолитно маленькие сервисы которые можно уже раздавать по командам и проводить этот цикл самостоятельно независимо от других компонентов нужно обязательно покрывать это все тестами тесты становятся неким соглашением внутри компании о качестве кода тесто надо поддерживать и нужно избегать и так называемых тестов шрёдингера которой сегодня дает один результат а завтра когда ничего абсолютно поменялось дает другой результат очень нестабильным теста они не несут никакого целью они только отвлекают и разработчики начинают думать то чтобы онa вам 10 тестов не прошел на хрен с ними катин продавшим нужно больше общение между командами в смысле опять же создания контрактов на основе тестов и взаимопомощи в этом плане мне очень нравится google когда они говорят то что я знаю что ты сломал сегодня мой проект но я знаю также что я завтра сломаю твой так что давай мы поработаем над общей целью и за фигачим сегодня хороший продукт что еще хочу сказать этот проект не очень много мучил и той боли которое было в начале проекта но не осталось ничего я понял что windows среде возможны возможно использовать те же самые дело в практике которые мы используем на linux проектов но это еще не все я начал исследовать и то движение которое выбирает microsoft не своих продуктов она не может мне не радовать тот маткор обещает нам возможность запускать наше приложение в любой среде как windows так из windows появление докер винус контейнер дает нам возможность оборачивать наше приложение в контейнер и windows of system for linux возможно позволят нам использовать абсолютно те же сама утилита как для linux среды так и для windows используя удобный нам интерфейс мне кажется то что эти шаги позволяют нам говорить о том что такой понять как винду среда но постепенно уходит а появляется microsoft так что можно почитать посмотреть дополнение к этому доклада есть отличные книги continues delivery который представляет из себя qx торгует она бесплатна оно доступно бесплатно то издательство урале и в нем есть различные истории успеха различных компаний которые поднимают свое окружение тоже надо найти посмотреть доклады платформу на поставки счастья в команду клей от вячеслава кузнецова из команды eg и мы очень вдохновлялись мы смотрели в начале наши проекты и им просто артик архитектурно наше решение очень похожи на описание описываемые вячеславом и можно посмотреть devops для windows на базе ленте болото олег курдюкова это разбору того как он сел подходит для windows а и другая точка зрения на систем управления конфигурации на этом мой доклад он завершил большое спасибо что вы прослушали и я готов ответить на ваши вопросы как обычный оси большой поднимаем руку я подхожу с микрофоном пасибо за год вы в конце упомянули микро сервисы скажите пожалуйста и был ли у вас опыт настройки подобного решения для сервисов где нужно настроить сразу много иного армен взаимодействия между сервисы ну то есть вам под каждый сервис то надо поднять отдельную машину и так далее покажу сервис отдельную машину это фактически то что требовалось на продакшене мы для этого подготовили базу и vram сейчас здесь очень важно объяснить что такое mvp continues delivery который мы поставляем мы считаем что антивирь это процесс который должен жить внутри компании который должен поддерживаться внутри компании поэтому мы даем фундамент и не доводим его до продакшена своими силами ада ему доводку клиенту и я считаю что в рамках данного проекта когда мы создаем тира for модуля маленьки котором уже есть этот сервис мы можем с их помощью написать большую телефон конфигурацию где про продумать эти взаимодействия и создавать окружение стало с большим количество сервисов я ответил на ваш вопрос принципе для тестовых окружения вам тоже надо поднимать но изолированное окружение для всех сервисов или в дипломате все на одну машину для тестовых сред мы ограничивали мы поднимали сервис у нас был сильно меньше машин то есть когда на сервис на машинку это больше продуктов среди спасибо большое следующий спасибо за доклад вопрос пол слайду где он было применение чифа к чему-то потом трофим себя это вот да да да да я сейчас покажет стать быт нет аватары вот здесь результате in pot in women там подразумевается что-то виртуальные что потом условным deep ловится на железы и поднимаете или это какой-то января mind который можно уже развернуть вот прямо на железе в данном случае marine это в нашем случае это репозиторий в котором есть полюсе fall питера фон конфигурация мы можем из него поднять наше окружение просто меня команды тира формулой спасибо здравствуйте спасибо за доклад я хотела уточнить по поводу там был до печи слайд не надо скачать по поводу использования с даст способа исполнения с чего-то на windows и из вариантов маршал и а масса около сувениром да и занять его бондаж скажите пожалуйста какой метод вы его таки выбрали потому что патель контекста ни снега над ясно хорошо мы использовали грм потому что нам показалось сложным и не то что сложно не необходимым использовать не нативный инструмент видео по массажу для нас это был лишний компонент который нужно было настраивать и поддерживать мы не хотели этого мы попробовали мы стали делать как проще спасибо за доклад во первых чтобы уточнить насчет а кто был тепло и у него есть бесплатная версия ограничения настолько несущественной стр нескольких проектах использую и даже к не помню поэтому попробуйте обязательно если они не раньше этого не делали и вопросы использовали ли вы едите которые window design or configuration и какие есть ощущение если использовали большое спасибо за дополнение про кто пуск повышал dsc мы использовали мы его тестировали и у нас возникло ощущения что это не совсем систем управления конфигурации да она позволяет нам задать конфигурация конкретного отдельного сервера но она не живет kaigu инфраструктуре то есть это первый нюанс второй нюанс сложность настройки в том смысле что ему нужен определенный сервер с которого можно было загружать модуля присунул предпри кстати при конфигурация сейчас очень сложно было до спиц такого чтобы на чистой машинки без дополнительных каких-то инфраструктурных решений запустить этот повышал до 100 и получить нужное нам состояние нам для этого нужен был отдельный сервер на котором хранились модули которые в конечном счете подсасывается на нужный сервер это очень сложно для такая утилита с таким функционал поэтому мы его в рамках проекта серьезно не рассматривали а использовали шеф с которым у нас сильно больше экспертиза спасибо большое еще вопросы будут здрасьте спасибо за доклад скажите вы указали том что использовали пакетный менеджер шоколатье а зачем можно дополнить еще и рады ли вы этим выбором сейчас в принципе да мы создали локальный репозиторий и . хватит нам замена где-то закованным в принципе я не могу сказать что мы были мне родам и далее вы сделали один процесс установки всех пакетов минусы нам пришлось писать не дед пакета минусы мы не можем использовать публичной репозитории плюсы noise один процесс но подроста ну где-то недостаточно для этого в чем пакет ность менеджеры у нас тоже проблемы я не просто так стрессовых я не могу ответить вопрос ну давай давай подискутируем discussion название роскошь сообщение я поделюсь с вами мои ощущения простые он не нужен спасибо хорошо еще в этот комментарий вопросы у кого ли мы так давайте еще раз благодарим видать как можно подальше небольшое слово я готовил доклад и готовил он на совместное свои ощущение я рассказывал о нем различным разработчики интересовался и очень много мнений которые не совсем та же с моим я получал много мнений кто не очень скоро с моим новый опыт и это круто то есть я рассказал молнию история у вас есть свои истории я за то чтобы вы приходили на сцену рассказывали свои истории делились опытом потому что среди докладов я очень редко вижу что-то windows специфично но люди в этом живут у людей из боль они как-то и решают а оптом не делится поэтому я прошу вас про зв войти и делитесь об том спасибо"
}