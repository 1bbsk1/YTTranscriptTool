{
  "video_id": "De1BBXB4dSI",
  "channel": "DevOops_conf",
  "title": "Хамзет Шогенов — CI/CD для serverless-приложений",
  "views": 296,
  "duration": 2749,
  "published": "2022-11-02T15:01:15-07:00",
  "text": "Всем привет Я Андрей хариулин и я руковожу разработкой сервер лес значит проектов технологии в Яндекс облаке И сегодня у нас доклад от хамзата шагенова он нам будет Хамзат архитектор Яндекс облаке он помогает нашим клиентам значит находить решение их задачах проблем в Значит на технологиях Яндекс облако их сегодня будет нам Рассказывать что-то про себя сервер лес и ещё много классных слов Привет Андрей и Слушай мне вот интересно на самом деле я тебе представил архитектор Яндекс облака который чего-то А что ты вообще как бы что тебе приходится делать какие-то задачи интересно было чаще всего к нам обычно приходят люди которые например ещё не так глубоко и хорошо знакомы с облаком возможно сейчас в частности с нашим Но им необходимо решать какие-то производственные задачи которые они как-то до этого решали но как бы эти задачи надо адаптировать уже вот на сервис который предлагаем мы возможно еще какие-то сторонние решения использовать Ну соответственно Я как раз подсказываю Каким образом можно построить архитектуру для того чтобы достичь им их бизнес-задачи бизнес-целий тоже прикольно Это такой как бы дефопс на аутсорсе для наших клиентов как чисто с точки зрения консультации рассказать что и чем конкретно сделать а реализация уже обычно уже на других прекрасно на самом деле знаю что еще архитектор постоянно Вот и как бы к нам приходишь архитектор зачастую приходят продуктовые команды видимо приносит какие-то такие что ли хотелки от клиентов в общем какие-то вещи которые не хватает Яндекс в Облаке Ну да ты правильно говоришь работа С продуктовыми командами это тоже часть нашей работы соответственно Так мы общаемся очень много с клиентами А мы знаем чаще читать они хотят поэтому вам приносит и Вас радует этим Да а я-то сначала когда пришёл в Яндекс архитекторы это люди которые мне будут рассказывать как как мы наши сервисы будем строить целая группа вот Ну да для клиентов это кажется очень важно и такая история этих логического продукта по сути да Ну тут надо ещё понимать что есть это очень разные архитекторы есть абсолютно архитекторы есть там Application архитекторы есть там пресейл архитекторы разные архитекторы но тем не менее все концентрируются на High Level дизайне чаще но еще на серёжку периодически тоже уходит и приходится зависимости от того что заказчики сами нам принесут Но это круто ты хочешь что-нибудь заспойлерить про свой доклад или мы потихонечку будем сейчас двигаться сторону рассказа я в принципе могу рассказать что в целом доклад будет полезен тем кто уже занимается вся CD таких Я думаю среди наших зрители много и тем кому очень интересно хочется идти в сторону сервис но пока что не хватает там рук времени всего остального хотя бы посмотреть как это происходит и еще кроме всего прочего Есть еще одна весёлая штука то что доклада У меня сегодня в живую не перезаписанные видео поэтому Обычное дело предзаписанные видео сегодня решил показать не записаны как раз таки в рамках такого доклада у меня немножко поломался код но тем не менее Мы же потом выложим этот наших уже рабочий но тем не менее я покажу как конкретно Какие вещи там можно запускать как наши сервисы можно пинать из из самого себя CD pipeline но все ipadline на данном случае пока беседе Ну тем не менее мне кажется очень будет доклад полезен Но это отважное решение конечно сделать живую я тогда хочу напомнить всем кто сейчас нас смотрит что вы можете писать прямо вот в стриме где-то в плеере комментарии к докладу по ходу доклада и мы там по возможности с хамзетом будем а отвечать на них также не забывайте пожалуйста ставить оценочку к докладу и после окончания основной части основного доклада у вас будет опция перейти в дискуссию и там уже все вместе значит дружные там толпой продолжим в таком Реал тайме обсуждать э-э то что мы сейчас увидели вот ну и я Предлагаю перейти к основной части к докладу и передаю вам за это слово спасибо Привет Сегодня поговорим о том Каким образом можно построить CCD pipline используя нашей сервис услуги и кроме сервиса услуг мы строите этот план будем на основе Такого замечательного продукта как gitlab и его кусочка Приятного который называется Si сразу прежде чем прям нырнуть в этот рассказ Давайте немножечко поговорим чуть-чуть слегка сервис Я думаю Многие знают что это такое конкретно Но некоторым возможно будет не помешает напомнить что конкретно из себя представляет Давайте просто посмотрим из чего утрированная грубая Из чего состоят обычно классическая инфраструктура которая там лежит под каким-то бизнесдом соответственно в первую очередь это у нас здание коммуникации кондиционирование то есть тот которым в принципе сейчас уже очень мало кто занимается все уже идут за ресурсами провайдеры которые за них это всё дело делает это не приносит денег непосредственно бизнесу поэтому такая штука очень становится Стало уже до фактов стандартам и Кроме этого естественно есть еще виртуализация которая опять же тоже де-факто Донат стандарт который тоже сейчас отдана на откуп провайдером инфраструктуры и соответственно мы называем их я с провайдеры они с нас снимают вот эти два нижние блока очень-очень тяжелые сопровождение и очень скажем так не выгодный для основного бизнеса соответственно кроме Я у нас есть еще необходимость управлять патчами конфигурациями то есть сами виртуальные машины внутри них надо какие-то настройки делать обновлять и так далее Кроме этого Кроме того что мы делаем настроечки внутри виртуальных машин нам эти машины между собой как-то еще кластеризовать если мы говорим про уже надежные решения и это их кластеризации тоже необходимо управлять Ну например у нас есть довольно-таки много менеджервисов так называемых управляемых сервисов где вот эти вот Вещи тоже автоматизированы нет необходимости лезть в операционную систему есть просто концовка который всё можно настроить те параметры выбранные которые нашими разработчиками которые точно ничего не поломают но помогут немножечко даже повысить Надёжность производительности системы Вот здесь мы уже начинаем переходить немножечко более интересную штуку потому что в любом случае когда есть менедж сервер сервис управляемый Нужно ещё думать о том как под него планировать ресурсы думать о катастрофа устойчивости хотя есть там отказывая устойчивость например думать о том как это автоматически скей или там вверх-вниз и так далее Вот это до того как уже наш там или ваш там разработчик конкретно начнёт диплоить свой код и этот код начнёт приносить денежку конкретно вот эту головную боль снимает уже сервис сервисы они по сути оставляют только уже самые сливки То есть то что необходимо конкретному разработчику конкретный бизнес организации и для того чтобы зарабатывать деньги какие у нас есть сервисы например в первую очередь у меня наверху изображены вот эти два сервиса это по сути runtime сервисы это бессерверные контейнеры почти как cubernetis но там не совсем докер но тем не менее вы не управляете никакими там настройками настройками дополнительные просто запуливать туда образы он там бегает если нужно их там можно заскелить автоматически вообще про это не париться есть еще более такая томарная единица как облачные функции тут вообще можно в определенных фреймворках собирать Там очень маленькие кусочки кода которые будет исполняться на маленьких кусочках рентайма есть естественно там стоит для хранения в первую очередь это объектное хранилище давно всем известное доступное по протоколу очень высоко надёжная и очень дешёвая а есть ещё Яндекс который у нас недавно назвал пансорсился который который немножечко пожужжал так в эфире и он доступен у нас без серверном виде То есть просто обращайтесь в сторону пишите там ключ значение и с этим Работать естественно вот эти вот это как-то надо между собой координировать для этого у нас есть очередь сообщений про которые я расскажу чуть позже и беги твои с помощью которой можно там формировать единую точку входа к вот этим вот runtime например для того чтобы с ними как-то работать Кроме этого естественно есть специализированные сервисы это в первую очередь например дата стримс тот же который позволяет управлять потоками подписываться на эти потоки как-то если использовать сбоку немножечко ещё Клауд функции то можно эти потоки немножечко даже трансформировать возможно чуть позже у нас будет отдельно проект Так ладно это такой прям далёкий анонс а иотикор э решение для людей Для того чтобы собирать данные и там складывать в нужные места это все запчасти на которых можно делать сервис как бы сервис сервиса решения в нашем облаке естественно нет У нас есть Еще довольно таки много сервисов которые в принципе можно отнести к парадигме сервер лиц Да но который не относится просто к нашей классификации Да там в принципе есть такие вещи как там дата трансфер датальянс и так далее То есть можно просто зайти в нашу консоль облачную Или страничку документации вы увидите что там есть очень много разного формата разной формы кирпичиков которые можно собрать Уже нужное вам картинку Ну давайте поговорим про преимущество не просто так же использовать не просто сервис сейчас начинает набирать так популярность естественно есть у этого плюса Я здесь сейчас просто перечислю быстренько плюсы чуть дальше мы разберем из чего они складываются как они вообще появляются да то есть в целом можно уже исходя из обычной контейнеризации уже получить довольно таки много из этих плюсов в первую очередь там распределение параллелизм повышенная Надёжность то есть там в куберритической контейнеры тоже бегают катастрофы устойчивость распределённая среда между разными методами А автомасштабирование это уже больше к сервер с Это уже как бы обычные контраризация не решает этот вопрос повышенная гибкость появляется чуть позже тоже разберём из-за чего балансировка данных нагрузки опять же вот это довольно-таки уникальные черта сервер то что а чаще всего автоматы уже сам провайдер балансирует нагрузку и самое самое вкусное для бизнеса Это плата только здесь используем ресурсы то есть сейчас что-то даже продемонстрирую почему я так происходит естественно не всё так радужно есть некоторые нюансы некоторые опасности которые могут подстригать пользователей там разработчиков на пути в сторону сервиса в первую очередь это архитектура так как она здесь меняется прямо очень сильно Кстати если вы не смотрели выступление моего дорогого коллеги Андрея халиуллина на яндекс.скейл к складом который называется сервис который работает да по-моему кажется так да Вот я Настоятельно рекомендую посмотреть потому что как раз таки в вопросах архитектуры он там покрывает точно замечательно но мы сегодня тоже вот Совсем скоро коснёмся до того как перейдём к демонстрации кода она у нас будет не беспокойтесь Скоро до неё доверяемся соответственно чего еще здесь люди боятся соответственно есть авто скиллинг То есть можно где-то немножечко накосячить с кодом он начнёт расти без контрольно и соответственно чеки тоже в ту же сторону значит расти ну здесь есть инструменты с помощью которых можно найти с этим бороться есть интересно отдельно клотирование которое можно установить в размере который Вам максимальный там интересен и Кроме этого есть разные системы мониторинга и уведомления в том числе о перерасходе например бюджета есть некоторые беспокойство о том что есть холодный старт он занимает довольно таки длительное время то есть функции контейнеры они создаются мы сейчас прям Скоро это коснемся они создаются автоматически при нужде да то есть какой-то снаружи какой-то там кто-то их стартует мы поговорим об этом и они выполняют свою работу а потом просто уничтожаются А поэтому холодный старт он иногда людей беспокоит но тем не менее У нас есть механизмы во-первых это прогретый Например те же самые функции и ещё недавно У нас появился механизм резерва с помощью которых можно опять же держать там заранее запущенные Там те же самые контейнер очки а в которые там прилетит то что нужно иметь сразу как бы подхватят необходимую информацию есть некоторые опасения в плане безопасности то есть вот эти вот фронтальные функции и контейнеры в них внутрь залезть нельзя То есть просто так же как там в kubernet контейнер там консоли подцепиться здесь уже такой возможности нет поэтому многие беспокоятся что там что-то может кто-то сделать без их ведома но здесь и наверное всё-таки скажу что если у пользователя нет доступа в эту среду исполнения то есть У пользователя который является самой большой в безопасности то мы прямо очень сильно уменьшаем поверхность атаки и по сути это повышает нехило так безопасность А естественно здесь ещё есть вопросы сходимости экономики на Большом уровне но соответственно если ваша инфраструктура на сервере начнёт расти там до каких-то гигантских масштабов оно возможно в таком подходе вам уже будет невыгодно Но это должны быть такие масштабы сопоставимы с дата-центрами нашего облака наверное приблизительно Вот так и есть естественно здесь опять же риски использования нет того инструмента например пытаться использовать там функции вместо тех же контейнеров где надо побольше данных принести либо ещё какие-то вещи доложить самостоятельно в функциях этого нельзя сделать у них немножечко более ограниченные там фреймворки заранее заданные есть отдельно еще беспокойство по поводу там того что необходимо набирать штат необходимо набирать экспертизу знания но здесь по сути есть там два метода решения Да С одной стороны можно общаться с третьими конторами которые являюсь поставщиками услуг по реализации приложения на сервисе на сервере ресурсы либо же самостоятельно внутри развивать эту компетенцию вначале немножечко придётся потратить но потом за счёт того что вы экономите вот все те нижние кусочки этих блоков которые я показал до этого освобождаете руки администратором которых в принципе можно переучить на том чтобы они начали писать на сервис поэтому здесь эти опасения тоже в целом наверное имеет право на жизнь но не настолько не страшно а давайте теперь все-таки поговорим уже про особенности архитектуры а Конкретно Вот одна вещь про который очень хотел рассказать это ивент дривен архитектура она предполагает что есть некоторые события ивенты То есть это существенное состояние изменения состояния каких-то там объектов вашей инфраструктуре и есть триггеры которые настраиваются на вот это вот изменения в определенную сторону соответственно эти триггеры запускаются после того как это изменение произошло и запускают с собой код по сути для того чтобы перейти к такой архитектуре которая также называется событийная архитек- ориентированы необходимо иметь некоторые вещи которые уже должны быть реализованы в вашем приложении Да во-первых в целом мы сейчас увидите знакомые вещи из контейнеризации но тем не менее А во-первых это атомарность то есть каждая там задача каждый кусочек вашей э-э инфраструктуры там вашего приложения каждый компонент должен быть максимально на маленьким по тому объёму задач которые выполняет чего это делается для того чтобы можно было распределить как раз таки помните Да рассказывал про преимущество сервис распределить нагрузку раз параллелить ее там где можно есть еще такая штука как асинхронность есть возможность есть такой асинхронность реализовывать тоже очень желательно с этим работать потому что она предполагает что например в какой-то процесс что-то инициирует и сам умирает Да при том что он инициировал там лежит где-то в очереди где-то там не знаю через балансировщик попадает в сторону обработчиков Ну не суть Да но тем не менее обработчик уже по исполнению задачи Он снова инициирует работу дальнейшего процесса то есть вот такие вот цепочки передачи сообщений позволяет формировать э гораздо более выгодную среду потому что вам не надо держать какой-то сервис бегающим фоне и ждущем другие сервисы и так далее а такая штука как ди каплинг тоже очень полезная вещь э-э как раз таки предполагает слабую связан с приложением компонентов приложении как раз таки мы чуть позже про неё тоже поговорим покажу как это происходит Я думаю что многие из вас знают но тем не менее немножечко освежим использование стейтлис да то есть сервисы компоненты вашего сервиса не должны по максимуму сохранять свое состояние Потому что если они будут сохранять свое состояние вам будет тяжело их терять да Если они серивались у вас данные лежат в другом месте то и терять их не так страшно можно в принципе восстанавливаться даже не давая пользователю понять что произошло а-а и в целом опять же распределять нагрузку и саму среду гораздо удобнее и отдельная отдельная рекомендация работать с push-моделью то есть не периодически опрашивать своих там каких-то там клиентов в кусочке в инфраструктурой приложения Да а от этих конкретных клиентов уже получается сообщение в сторону вашего там управляющего сервиса например да а как я обещал поговорим немножечко совсем немножечко про очереди сообщений месочки и слабо связаны архитектуры полагается здесь что у вас есть продюсеры их может быть несколько это не обязательно один и он кладет какие-то задачки в эту самую очередь есть у нас воркеры которые умеют обрабатывать такого класса задачи То есть у нас может быть там несколько групп брокеров нет может быть несколько очередей там несколько подписок в очереди и так далее но тем не менее здесь Суть в том что любой worker может подхватить любую задачу от любого продюсера и выполнить её причём если какой-то worker выполняет задачу начинается что-то у него ломается он умирает то в этом случае сообщение по тайм-ауту в очереди становится снова доступным и другой воркер свободный его подхватывает и выполнять вот о том что о чём я рассказывал что можно ошибки переживать так чтобы ваш пользователь даже особо не замечали их вот такие инструменты помогают с этим справиться ну и соответственно что у нас меняется прямо кардинально К чему приводит как раз таки в интервью на архитектура это то что у нас классическая такая классический процесс у нас раньше выглядело Так что мы там запускаем какой-то нет процесс он висит в фоне какие-то вещи выполняет он какой-то он свой логику гоняет обращается в сторону инфраструктуры Возможно там авторизацию какую-то делает где-то в каши лезет а где-то данные сохраняют президентные но тем не менее это у нас постоянно бегающий процесс А в кейсе уже сервис и ивент подхода предполагается что у нас приложение А ну инициируется каким-то там событием соответственно с помощью очередей и там балансировщиков нагрузке и так далее но прокидывается это сообщение да других компонентов и соответственно компоненты таким пинг-понг между собой занимается пока не будет достигнута на нужно цель в зависимости от того как писалось приложение Желательно чтобы эта цель достигалась в итоге ну и соответственно Что делать когда идете в эту сторону на что в первую очередь стоит обратить внимание еще раз повторюсь архитектура Посмотрите доклад Андрея очень полезный то что я упоминал уже атомарность асинхронность отсутствие состояния сохранения слабо и связанные компоненты событийное ориентировать ориентироваться естественно модель и здесь Наверное отдельно тоже стоит упомянуть что есть специализированные сервисы сервис сервисы в том числе и почему стоит их использовать потому что раз появились такие специализированные сервисы был значит спрос на конкретно Такой типа на решение такого типа задач и у провайдера появилась такой инструмент который решает эту задачу и надёжнее и эффективнее и дешевле Поэтому в сторону специализированных сервисов стоит очень прям смотреть Кстати я по-моему забыл упомянуть что в целом я сегодня буду демонстрировать решение наши на нашем облаке вроде бы рассказываю про сервис-услуги в яндекс.loud Но те подходы про которые рассказываю естественно можно натянуть на практически любые сервер Из предложения поэтому здесь даже для тех пользователей которые почему-то не пользуются нашим облаком доклад должна оказаться полезным А и Давайте вот Последний пункт я чуть не пропустил его а оптимизация причём оптимизация как самого кода Потому что раньше как в классической инфраструктуре Когда у нас там ну даже я появился только э разработчикам не хватает ресурсов Что делает дают им больше ещё больше ресурсов в случае сервера с предполагается что каждая там каждый запуск нового инстанция каждая потребление ресурса чаще всего Там те же самые функции белятся по потреблению оперативной памяти и по времени исполнения Поэтому чем тяжелее код чем он не оптимальный тем больше чек То есть по сути сервис подход он принуждает разработчиков оптимизировать код Кроме этого здесь опять же стоит заниматься оптимизацией непосредственно ещё архитектуры не до ваших даже если оно построено на ивент дривен модели в этом случае стоит поработать над оптимизацией например вызов чтобы их там дополнительно не порождалось лишних чтобы опять же просто не выкушивалась лишний раз денежка впустую ну и соответственно дальше мы посмотрим с вами Как можно собрать приложение в парадигме сервис И сейчас мы сначала рассмотрим чем конкретно будем собирать у нас будет по сути такое приложение которое будет бегать в рамках сервис контейнеров это будет такой прям витринка назовем его магазина по сути будет такая вкусняшка в которой будет корзинка и товары демонстрации соответственно та часть которая лежит тайме у нас будет бегать контейнерах есть Посмотрите прямо сразу можно увидеть что оно распределено сразу автоматически по трём то есть об этом заранее заморачиваться не нужно то есть изначально не просто отказываются устойчивое решение база данных у нас опять же используется сервис опять же со всеми такими же преимуществами какие-то вещи в том числе картинки мы будем хранить в объектном хранилище потому что очень удобно хранить в том числе картинки и можно удобно создавать ссылочки отдельно мы будем использовать еще реестр контейнеров для того чтобы билдить контейнер с нашим приложением туда его сохранять чтобы можно было использовать в нашем уже Si плане сбоку у нас находится и unlockbox здесь на картиночке Ну потому что такие сервисы которые вроде бы изначально такой прям большой ценности не приносит но без них плохо потому что без них безопасность сильно ниже за что обычно коллеги из службы информационной безопасности очень сильно расстраивается И жалуется Вот и как я уже говорил когда рассказывал про наши сервисы сервис API у нас будет в виде такого такой точки входа для того чтобы уже обращаться к конкретно ресурсам расположенным в рамках нашего приложения естественно используется DNS у нас в Облаке всё на DNS строится даже если обычную виртуальную машину разворачиваете для него по-любому создаётся DNS имя Ну естественно код мы будем хранить в GTA и соответственно строить автоматизацию доставки этого самого кода что из себя будет представлять сегодняшний демонстрации в первую очередь я покажу как Я подготовил облачную инфраструктуру какие там создал Облака в рамках облаков папочки Сейчас я покажу расскажу что это такое а потом покажу Каким образом я разворачивал само приложение первичное покажу само приложение естественно после этого покажу где и как настраивается автоматическая развертывание тот самый pipline После этого я покажу кусочки которые меняют версию при изменении версии перепаковывает карты контейнер кусочки которые позволяют этот перепакованный контейнер развернуть тестовой среде и соответственно при необходимости если мы все понимаем что тестирование произошло нормально то в этом кейсе мы уже можем делать релиз этого приложения то есть уже отдельная будет автоматизация ну и соответственно если что-то ломается откат предыдущей версии Сейчас я вам соответственно покажу Где у нас находится само облако вот у меня изначально есть учетная запись в Облаке облаком не называется клауджо Гевара это мое зерно если что и под этим облаком у меня созданы так называемые папки папки это по сути такие логические структуры с помощью которых можно объединять ресурсы в рамках облака и облака такие тенты можно объединять ресурсы в рамках облака для того чтобы давать на них например права назначать какие-то собирать на них основе роли и Давайте ролик конкретным пользователям соответственно если надо разграничить конкретные команды очень полезные инструмент который позволяет довольно-таки атамарно даже в целом сделать контроль есть у нас по сути инфраструктурное Облако которое называется карта инфра в которой находится просто хранилище реестров образов если мы сейчас дойдем в хранилище реестров куда я конкретно складывал образы мы увидим что я в принципе с утра пытался починить этот код неоднократно вот возможно так Окей это у нас инфраструктурный проект инфраструктурная Папочка Кроме этого есть Папочка провод естественно здесь мы сразу видим сервис это по сути наша база данных бессерные контейнеры в которых будем разворачивать наш соответственно контейнер с нашим приложением lockbox где у нас будут храниться секреты в данном случае пароль очки для доступа к базе данных и пиаги твои как раз таки для того чтобы принимать Connect и чтобы они пролетали в сторону наших контейнеров и отдельно мы еще автоматом locking для того чтобы уже понимать что происходит в рамках данной данного окружения отдельно У нас есть тестовое окружение Я не стал здесь формировать отдельно провод стоишь хоть фикс и так далее Потому что у нас всё-таки демонстрация они попытки соответствовать стандартам каких-нибудь больших серьёзных банков например вот и в рамках тестинга вы сейчас видите что в принципе у меня здесь есть только там база данных боксы логин то есть там например того же API и того же тех же контейнеров на которых всё исполняется здесь нет Сейчас мы посмотрим Почему в рамках соответственно get love мы создаем для того чтобы сделать автоматизацию во-первых необходимо создать проект в котором мы потом загрузим код он у меня уже загружен я вам буду его демонстрировать Кроме этого здесь имеет смысл для того чтобы настроить непосредственно автоматизацию доставки кода настроить так называемый гидлабраннеры и слабораннеры можно использовать в целом и общественные Но если вы исполняете какую-то полезную задачу промышленную производственные там есть какие-то данные особенно если там есть коммерческая тайна или персональные данные то лучше наверное всё-таки даже автоматизацию снаружи не пинать потому что где-то можно что-то теоретически правда но где-то может что-то пойти не так но тем не менее для хихаба есть такая штука Как крамеры А это по сути такое очень легковесное быстрое приложение написано Go и соответственно можно его поставить и там виртуальную машину и в контейнеры кстати в нашем маркетплейсе для снетиса управляемого есть непосредственно даже очень удобная столяшка этих самых getlabranner в которой надо просто ввести парочку парочку моментов которые находятся прямо Ну по сути да вот где токены их надо подхватить и по сути лабраннер при дипломите сразу в него можно прописать нужно настроечки и он автоматически вот здесь у вас появится Да что удобно при необходимости гидробранеров можно запускать там несколько они могут выполняться параллельно если есть несколько игроков которые надо исполнять соответственно правильно а это у нас та часть которая будет являться рабочей лошадкой она будет выполнять на себе всю полезную нагрузку Давайте посмотрим теперь вход Давайте посмотрим как я разворачивал непосредственно отдельно должно быть открыто в самом коде есть такой скриптик который называется boostro Pay Sage с помощью которого готовились вот эти все самые среды которые вам сейчас показал и в них соответственно создавались в том числе сервисный учетной записи для них создавались ключики которые я отдельно сохранил они приблизительно здесь их уже нет но по сути непосредственно сами ключики лучше сохранять в секреты Если они у вас такие таковы есть вернее здесь они секреты называются А я уже там я не там вот settings сиди здесь есть такой раздельчик который называется varable Если у вас есть вещи там такие как пароли ключи токены и так далее их лучше естественно в корне класть потому что этот код будет проходить через paypeline до него будут иметь доступ в том числе и там младшие разработчики Возможно это вообще публичные репозитории тогда совсем преступление Мне кажется Тогда ключи класть если это не преднамеренное что-то конечно поэтому есть такая штука в которой по сути можно класть секреты и не только здесь можно любые переменные окружения если у вас хватает прав на проект здесь ещё есть кнопочка которая называется с помощью которой можно ещё посмотреть значение да то есть здесь у меня там а ключики традиционно лежат которые пинают сервисной учетную запись которой используется для сервисного учетной записи для того чтобы автоматизировать доставку обновленного кода в сторону уже инфраструктуры и соответственно здесь можно даже кусочки их подглядеть здесь У меня например ссылочка на реестр контейнеров чтобы можно было данное приложение там воссоздать и настроить на другой среде в другую совсем с другими там поинтами и к этим вечером очень удобно обращаться уже из такой штуки которая называется конкретном случае чтобы этим планом заняться во-первых как он создается в рамках кода можно создать вручную вот такой вот файл который называется гид лапша и я ну и в рамках вот этого уже файлика делать необходимые все настройки но в целом Если вы уже создали если он уже существует или же можно его быстро уже создать из раздела себя нажать на ссылочку Editor и вы попадете практически тоже самое окошко что здесь удобно здесь мы сейчас обсудим как Какие компоненты Конкретно реализованы что там происходит внутри но есть еще одна штука на которой я очень хотел обратить внимание это визуализация по сути этапов построения пайплайна то есть мы сейчас сразу же видим что у меня есть этап Билд по сути на этапе у меня будет собираться контейнер этот диплой соответственно здесь собранный контейнер будет диплоиться в тест у меня здесь больше даме тесты но соответственно в промышленности среде здесь лучше использовать что-то уже действительно полезная типа там селение ума тоже или Яндекс без серверного нашего сервиса чудесного для того чтобы понять как ваше приложение будет уже вести приблизительно себя в продуктивной среде и по успешному выполнению тестирования уже производится диплои непосредственно уже в здесь у меня Удаляется после успешного тестирования тестовая окружение Вот и тот момент который как раз то что не работает то что я вам рассказывал это тот кусочек короче который отвечает уже за доставку кода в продуктивную среду вот у меня здесь заканчивается мы сейчас Увидим что там появится еще Ладно я сейчас не буду прямо этим заниматься потому что Это займёт довольно-таки много времени вы будете в это время Скучать не хочу чтобы вы скучали Давайте посмотрим что у меня здесь происходит во-первых на первом этапе на этапе Билд мы просто собираем на основе того кода который лежит в репозитории на которой мы сейчас немножечко даже посмотрели но я покажу его уже немножечко с более высокого масштаба да то есть у нас есть самого приложения в рамках которого лежит Тамер файл который собирается как раз таки А есть исполняемые файлики есть шаблончики которые используются для того чтобы собрать там уже HTML часть часть нашего приложения которое будет э-э customer facing по сути и Кроме этого еще в корне не в корне в пачке конфиска который быстро называется сформированы вот такие яму файлы в которых по сути лежат айдишники конкретных сервисов и их имена То есть диплоименте у нас будут стараться мы будем стараться сохранять все точки куда необходимо обращаться Либо со стороны приложения либо уже со стороны Поэтому полезная вещь тоже рекомендую пользоваться Кстати да я по моему упомянул Да что мы будем потом выкладывать код в нашу едла github хранилище вот в данном хранилище вообще с репозиторием кода который можно переиспользовать Поэтому ждите скоро появится соответственно здесь что у меня происходит с помощью такого инструмента который называется коника который позволяет билдить контейнер внутри контейнера этот код мне ребята подкинули Очень полезная штука прям Очень клевая которая решает много задач в том числе задачи по повышению безопасности Билд этого самого контейнера которого в итоге доставите в продаже после этого эта штука она зашла не просто это контейнер но еще засылает данные регистраторы контейнеров то есть сам образ контейнера здесь если Вы посмотрите вы можете увидеть такие вот фигурных скобочках значением э это встроенный переменные окружения в самого вот этого Xiaomi механизма то есть там есть прям целый набор этих странных переменных окружения Я ближе к концу теклада если будет интересно если там например напишут в комментариях Покажите пожалуйста я обязательно их покажу мне ссылочка сохранена ну и в целом естественно мы добавим вреднее секцию которая будет сопровождать уже выкладывание кода Кроме этого есть естественно как я уже до этого рассказывал тут Наверное стоит упомянуть что в целом здесь есть такие два примитива как стоит же это по сути порядок выполнения тех или иных действий и в рамках стоит же могут существовать разные джипы да то есть вот у меня я специально назвал джабы с окончанием для того чтобы было сразу понятно что это такое в рамках задается такая штука как и вот как раз таки вот параметр Stage и определяет На каком этапе Вот это конкретный Джо будет исполняться стоит же они исполняются друг за другом по очереди в рамках одного стоит Они могут выполняться параллельно если не указано например дополнительный какой-то ключик типа Dance он который у нас в данном и по сути здесь у нас там происходит Build контейнера этот имидж В итоге появляется в реестре образов и соответственно этапе уже диплоит теста мы по сути Обращаемся к этому реестру образов берем там ключик и разворачиваем сервис контейнер во-первых А во-вторых разворачиваем для того чтобы к этому сервис контейнеру можно было попасть причем не просто их разворачиваем но мы еще прокидываем в них дополнительные переменные окружения Вот например вот это сервисная учетная запись которая заранее подготовил можем принципе пройти в облачную часть и посмотреть Да здесь вот есть такая штука эти немножечко увеличить чтобы это мне все-таки есть такая штука Как сервисный учет сервисный аккаунт и здесь можно посмотреть все сервисные канты которые можно было созданы и роли которые у них есть да то есть вот этот аптетинг Например у него есть доступ к базе данных и она еще имеет право вытаскивать ключики из из Лок бокса то есть еще на хранение ключей что у нас еще происходит в нашем Pay плане нашим пай плане еще кроме этого Кроме того что мы диплом тестирование нам естественно нужно как-то тестирование еще произвести да то есть если мы посмотрим здесь видно что стоит диплоид тесты непосредственно есть два Джаба уже по тестированию очень простенький intent даже нельзя назвать Но тем не менее для демонстрации просто дергаем соответственно второй тест это уже не стал писать какие-то там обращения в сторону Здесь просто у нас даме что здесь будет тестирование у обоих вот этих разделов Обратите внимание что есть Это означает что они будут исполняться в рамках и в целом эта штука может происходить параллельно Да я в принципе даже могу продемонстрировать это вот показав Что вот они находятся вот прям не друг за друга А друг над другом и соответственно они выполняются рядышком кроме теста у нас В итоге еще должны есть стоишь которая удаляет все тестовые данные после того как тестирование прошло нет смысла соответственно все это дело сохранять И после этого диплои происходит уже в продуктив здесь очень похоже Механизмы как и на диплои в тестовую среду но тем не менее у меня там есть парочка ошибок которые изначально почему-то все не показывали сейчас появились которые я исправлю прежде чем поделиться с вами уже конкретно рабочим ходом Давайте посмотрим что происходит при изменении уже какого-то каких-то параметров в целом мы сейчас можем в принципе даже что-то где-то раз комментировать закомментировать э добавить сообщение и мы по сути этим уже триггернём запуск э-э автоматизации по доставке кода то есть здесь мы вместо вот этого длинного предложения запишем просто Hello и отправим commit в целом то же самое будет запускаться Если вы например с Гита с силой Гита там Либо со своего ID поменяете какой-то код и закамметите его в сторону репозитория тогда начнет работать как раз таки автоматизация и в принципе можно посмотреть на то каким образом она отрабатывает немножко заглянуть внутрь да то есть вот есть у нас такая штука Как пай планы и в рамках можно посмотреть все предыдущие запуски если один из закончился ошибкой или там jababstage закончилась ошибкой если там нет признаков игнорить то есть пропускать ошибку то эти жабы валятся с ошибкой И соответственно стоишь тоже варится ошибкой и Тайный код не доезжает до промышленного уже для Промышленной среды для продуктивной среды Давайте посмотрим что конкретно здесь происходит вот у нас на текущий момент происходит самый долгий этап Это билда потому что нужно подтянуть вот самый канеки потом в него подтянуть все данные из Непосредственно нашего хранилища кода А их надо сбилдить потом положить в хранилище реестра поэтому эта штука занимает довольно-таки много времени Вот пока она отрабатывает возможно кто-то уже нас что-то спрашивал в сам самом там всякие Да в чатике было один э-э вопросе который примерно так звучит вот говорят хоть это слухи что в амазоне значит лямбы могут э-э значит использовать для тяжести типе трафика и типа там людей кустар не пугает она значит Как это работает вот но здесь Ты уже в принципе рассказал что мы делаем фактически у нас действительно сервис приложения которые обрабатывает htp трафик по сути да ну у меня кстати здесь нет предпрогрева поэтому там первый запуск он всегда занимает 2-3 секунды Но если использовать предпрогретые это прям время драматически изменится Ну надо ещё заметить что докер у меня сервер с контейнер ещё есть Джанго это кажется там один из точки зрения performance один из худших у нас в Клауд в Яндекс Клауд жгут прямо так хорошо о'кей Так у нас тут это всё дело Ага У нас всё это дело здесь отбилось Так давайте посмотрим что у нас там спайплайном происходит Да снова можно провалиться конкретно в этот текущий paypaline исполнения вот у нас пошел исполняется уже второй Stage по сути диплой в тестовое окружение и в принципе Давайте расскажу что есть еще такая штука Как раздел такой dops в котором можно посмотреть уже непосредственно уже каждый Джок который последовательно исполняется здесь они параллельно Они здесь будут отображены параллельно которые можно здесь уже смотреть не проваливаясь внутрь как раз таки уже То есть можно их надо кроме этого Давайте еще одну вещь здесь расскажу которая меня сейчас заканчиваем вот после того как текущий выполнится я раз комментирую и сознательно поломаю свой год сознательно поломаю свою среду Вот Но при этом покажу очень такой интересную полезную штуку которая по сути будет завершать уже доклад что я вам хотел показать я вам хотел показать что есть вот такая вещь в рамках моего сердца дебайплайна в рамках вот этого закомментирования закомментированного кусочка кода давайте я все-таки его потихонечку раз комментирую пока все это у нас дело происходит Андрей возможно еще увидит какие-нибудь каверзные вопросы там в чате Потому что сам придумает что я конкретно хочу здесь показать Если вы Посмотрите сами вниз вы увидите практически до него дошел строчку которая называется в гитлабе используется для того чтобы формировать по сути такие окружения которые сохраняются чего это нужно для того чтобы если вдруг что-то пошло в вашем коде не так Я на минуточку страничку чтобы убедиться что в вашем городе пошло не так здесь К сожалению немножечко из-за форматирования съехала но здесь вот мы видим что есть название среды В данном конкретном случае мне нужно сохранять состояние продуктивной среды даже если в итоге не исполняется прямо сейчас была возможность ее потом перезапустить например здесь конкретно у меня используется что раздел Production и в качестве еще подразделы используется по сути опять же такая встроенная переменная в эту штуку которая после формирует Хеш данного коммита и после того как я за тепло его все вот это уже по сути пайплайн исполним После этого у меня в разделе Давайте вот соседнем пойду в разделе дипломинс здесь появится инвентарминец я видимо не успею немножечко выбиваемся из времени продемонстрировать но тем не менее здесь появится прямо строчечка с каждым из вот этих вот коммитов и сбоку будет точечка в том числе которая выпадает под менюшка которая называется заредиплоить вот это вот окружение Это очень полезно в кейсах когда все-таки тестирование автоматически прошли успешно и даже есть нет автоматической доставки кодов прод если она требует ручного подтверждения все равно люди не идеальные склонны ошибаться какие-то ошибки бывают и вот такие вещи позволяют очень быстро откатить уже к какому-то конкретному рабочему состоянию Последний пунктик был про который рассказывал вам демонстрации Да спасибо хамзета действительно вот рискованная история с живым когда показано ничего зато это было видимо и последний раз это попробовал сделать Да и я еще совсем напоминаю мы Сейчас переходим в дискуссию мы скажем Будем там отвечать на вопросы как-то разговаривать поэтому предлагаю всем кто там хочет еще что-то узнать И вот жара какая-то пошла у нас в чатике немножечко Потихонечку вот поэтому предлагаю переместиться в дискуссионную зону и там обсудить все оставшиеся Вопросы Спасибо большое за внимание Приходите в наш чатик там строчки было и общайтесь"
}