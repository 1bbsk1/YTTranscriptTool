{
  "video_id": "ib3I2uX9wag",
  "channel": "DevOops_conf",
  "title": "Виктор Ерпылев — Авто масштабируемый Kubernetes на AWS Spot’ах",
  "views": 392,
  "duration": 4102,
  "published": "2021-04-30T01:29:20-07:00",
  "text": "и приветствуем наших первых гостей и так виктор них полив наш уважаемый спикер аж из новосибирска здравствуйте виктор и сергей киселёв приглашенный эксперт который будет помогать виктору будет ему задавать каверзные вопросы приветствовала сергей до людей до между сергей я работаю такая маленькая компании как яндекс собака но сегодня лишь не про меня про виктора и мне кажется виктор на сегодняшних докладе расскажет очень много практики профи про то как они эксплуатируют of the spelling в кубер найтись и характере и как они работают с полотенцами и самогона вы можете задать ему вопрос мы планируем что у нас будет несколько перерывов время которых вы те вопросы которые вы напишите в чат я задам виктор принципе мне кажется это отличная возможность обсудить какую-то интересную штуку и спросить про этого виктор да виктор как ты считаешь что такого интересного у нас сегодня получится рассказать всем привет привет сергей я приготовил доклад про повернитесь который может масштабироваться сам облаке все инструменты для этого уже внутри ничего снаружи делать не нужно расскажу о том как это подробно работает наша радость и само облако думаю что будет интересно да я в этом соке или не сомневаюсь кстати виктор мы последнее время все радуемся ну велись клипа страдаем из-за того что у нас работает дома у нас постоянно зум ты вот сейчас у нас из дома или ты приехал все-таки офис смотрят долго спорили откуда у тебя такая надпись на стене отлично нет я все-таки приехал в офис пользуясь тем что вы все сейчас никого нет безопасно соблюдая все меры предосторожности дома на кухне у меня надписи плеск нет я обычно работаю и как бы мне не так тяжело зумом потому что вы пользуетесь google нет хоть какой-то выход получается из зуба у нас есть я считаю это для любого сотрудника которая выступает на какой-нибудь конференция это такой плюс в карму со стороны чаров или маркетологов когда-то не просто выступаешь на конференции чаще и сзади вот большая надпись компании название компании ты можешь похвастаться смотрите какой у нас красивый кусочек есть в офисе возможно весь офис у нас тоже такой красивой кстати виктор но прежде чем мы начнем мяч такой маленький вопрос не слишком ли вас холодно там новосибирске и замерзают ли у вас телефон и руках если честно прохладно даже сейчас 17 бизнес-центры здесь довольно холодно однако некоторые таллин которые присутствуют и конференции меня греет поэтому у меня все в порядке а если на улицу выйти с телефоном обижать уроки он действительно минут через двадцать может вырубиться так что с этим есть проблемы приходится носить телефонов карманах да я понял до войны и раз сразу начнем чтобы адреналин начал действовать и чтобы не успел замерзнуть стать виктор sol обязательно дорогие наши слушатели хочу вам напомнить вот здесь вот здесь ссылка на чит в телегу ссылка на дискуссионную комнату задавайте ваши вопросы потому что ваши вопросы просто умножают интересность доклада на 2 как минимум и даем виктору слова слушаем его доход да еще раз привет всем тем кто только что присоединился заслушают полив виктор я инженер инженер уже больше десяти лет начинал согрей шанс потом познакомился с культурой начал вникать пробовать практики и заразил с этим настолько что теперь готов нести эту культура масса данный момент я влияю не только как инженер но и работаю на середине этих лиц команде я работаю работаю я в компании блеск блеск это основной продукт компании tahe стеновая панель 400 тысяч серверов по всему миру пользуются эта штука и 6 процентов сайтов сети интернет а ну довольно таки взрослую ему уже больше двадцати лет но самое главное при а стрелы где то самое главное люди я отлично сам характеризует такой фразы я комфортно выходить из зоны комфорта здесь как он такой вопрос что мы обычно себе представляете когда слышите что комната продукт больше двадцати лет скорее всего вы представляете себе legacy у нас не могу сказать что с этим все хорошо а каких-то местах с этим есть проблемы мы идем уверенно вперед есть один интересный нюанс как этого избежать любом любой компании есть разные команды очень часто выделяется платформенная команда или еще какие то может случиться так что вот в этих командах никакого ли весь инет мне же повезло еще больше я работаю в стартапе этой компании на самом деле наша legacy все еще называется технический долго ну и какой же старт отписку вернуться в нашем случае это было обосновано и с помощью него мы образу прошедший те задачи которые если бы меня попросили в одном предложении описать что делают над которым мерам я бы сказал что мы у заказчика переход к этому виду есть простое требования наличие докер файла внутри так что можно было его собрать мы этот код собираем вы мышь на своих конечностях затем мы идем к заказчику в его облака разворачиваем там у него инфраструктуру и запускаем того приложение то есть фактически мы выполняем за него по всей сети или выступать сам как сервис для того чтобы эту задачу решить было органично использовать тектон мы используем его и для того чтобы сделать из идей для того чтобы делать наш фоновой синхронных задачки с бизнес-логики докер образы мы собираем при помощи conica оба эти продукта ребята из гугла ну и сообщества вместе высокого качества очень крутые продукты для того чтобы разворачивать инфраструктуру мы пользуемся тиров он зрелый продукт надежный очень много людей пользуются компании хашиг орган все вот эти три штуки очень хорошо легли на повернуть вы взяли исходя из вышесказанного у нас власти есть разная нагрузка и глобальные можно поделить на два разных видах 1 нагрузка наша за которую мы полностью отвечаем это наша контрольная панель который обеспечивает всю бизнес-логику и какие-то наши технические штуки вроде мониторинга конечно же на прометея и салон второе вторая часть нагрузки это клиентская нагрузка она сама разбивается должна два вида это сборка докер образов и непосредственно инфраструктуры эта нагрузка немножечко разная сборку докер-образ мы можем безопасно любой момент прервать и перезапустить где то в другом месте мы всегда получим 1 . конечный результат такой задачи по сборке это либо образ который можно запускать в качестве либо ошибка с тем что этот образ и катался с ним собраться с разворачиваем супер очередь сложнее потому что тиров он не очень любит когда его прерывают неожиданно и почему это важно пойдете из дальнейшего рассказа ну с этим тоже можно жить роу нагрузку я бы сказать если это на графике увидите пример нагрузки на интернет магазин ночью когда люди спят они приходят по мере того как они просыпаются посещаемость на все выше и количество железа которые нам нужно для того чтобы та нагрузка вы работать выше и для того чтобы содержать пик нам нужна древесина количество железа получается если у нас количество я за все время одинаково там и большую часть времени она находится в простой и вот все что голубым видите на этом графике это все про стоит за которые мы платим взглядом плита не пользуемся в нашем случае все еще хуже потому что нашу нагрузку мы никак не можем запланировать да то есть мы не можем спрогнозировать потому что собиратель нас могут быть собираться клиенты могут по всему миру и разработка процесса и непредсказуемые иногда нужно несколько раз подряд сама никогда вообще не происходит на уде плоть даже не запрос на вич и если посмотреть например такой нагрузки наш сервис ту голубой области и возможности для маневра еще больше и одной из задач в нашем продукте была минимизировать расходы и постараться как можно больше области выбрать и и не платить за нее я надеюсь я вас не утомил трудностей про продукт есть есть такая проблема что для того чтобы рассказать про лишь нужна рыба это очень много контекста и часто контекст который нужно чтобы понять он сильно больше чем сама проблема но идею дальше увидите что решение она по сути своей очень простое но для того чтобы его применить в жизни нужно вообще-то очень много знать маз свой поверните и это рассел портят каберне с которой мы разворачиваем сами при помощи при и некоторые оболочки вокруг этого это решение мы принимали потому что нам можно было одинаково иметь поставить в свой кластер и свой бизнес и q и на базе метров и в облака молодой имеешь и пока точно не знаем кто будет нашими конечными клиентами возможно это будет счас и тогда мы будем решение содержать в облаке возможно мы будем ставить кому-то им place дата-центра конкретной компании тогда должны уметь взять и поставить ну естественно когда мы останемся на железо в каком-то скиллинг речь не идет компания просто запланировала максимальная пропускная способность которую готовы поддерживать и с этим железом дальше реле случай с облаком краску и вко подстраиваться в нашем случае облака это amazon и выбранного блог потому что они уже используется amazon накоплено приличное количество экспертизы и мы даже нет не сравнивали стоимость решения потому что для нас изучить другого вендора было бы дороже по крайней мере в короткой перспективе однако я за спойлеры решение это кластеров то скейлер он может быть вам интересен не только если вы разворачивать в мозоли на самом деле он поддерживает очень много разных вендоров самых крупных научных google вижу и ещё один важный момент здесь кластеров то скейлер умеет работать вместе с midget решением по крайней мере с амазонские века с точно вообще люди которые работают все креслом могли прямо в документации амазона встретить отсылку постели может amazon использовать этот инструмент как инструмент для масштабирования по умолчанию своих мэр от решения других облаках не проверял продукт вот этот кластер тоски он поддерживается команда которая пишет вернется есть спешим с крупной от тему все это google там высокое качество и написании кода и процессов а как это можно доверять ну и он довольно взрослый насколько помню и года назад там были первые кометы в его работе мере по истории сейчас архитектура нашего решения и вот здесь вы видите все кубики о которых я сегодня буду рассказывать это это все то что нужно знать чтобы понять как работает лазер of the skilled для тех кто работает с мусором возможно часть вещей будет не марик тем менее не стоит о них поговорить of those келим группы группы инстансов объединенные комната логическому признаку причем сами решают а кроме именно они дают набором свойств которые для нас полезно который мы можем использовать своих целях важная вещь это минимальный размер группы в данном примере облака не никогда не будет стараться никогда не допустить такого чтобы рука стала меньше чем один перестараться дезавид capacity это самый главный показатель который я сегодня это целевое значение машин в группе которые облака были сразу достичь попросили 2 в данном примере яблоко будет предоставить нам ведь машинки и максимум это показатель группа не может быть больше 60 нашем примере это наша гарантия того что мы точно не потрать больше средств чем стоит 6 инстансов и и получим под огромной чеку так если сознательным захотим этот показатель увеличить of those керим группы обладают двумя важными свойствами первое важно использовать то что они поддерживают текущее количество машин что может пойти не так на ноги майонез верни может зависнуть операционная система что-то в палату блок может когда заключить наш софт или что то еще произойти при этом операционная система перестает отвечать на холсте де она зон это делать а фиксирует такую могут выходит из группы и подключает вот выпнул ему таким образом после того как наш новый надо пор хранится лизе равным нас останется дверь только сколько моей просить второе свойство каскелен группы этому штабель вообще amazon имеет масштабировать по расписание по запросу или вручную и вот вариант по расписанию очень подошел бы для интернет-магазина из первого примера там где заранее известно исключая черной пятницы насколько вырос нагрузка можно попросить мне пожалуйста в этот час плюс одну машину в этот час еще плюс две машины и так далее да макс тоже свобод вариант масштабирование по запросу чуточку хитрее вообще amazon по умолчанию собирает с каждого intenso нагрузка на процессор еще ряд метрик service can watch и на самом деле можно не свои метрики тоже положить масштабирование можно настроить по одной из этих метрик в этом случае amazon посчитает среднее значение потребление например процессора если она перевалило за пороговое значение он добавляет еще одна машина если снизилась ниже другого порогового значения избавляет можно было бы использовать и этот вариант но он не супер точный поэтому в рамках амазонских of the skilled групп для нас подходящего масштабирование то вручную то есть мы будем явно указывать взят capacity мы указывать за нас его будет робот кланов нас келлер внутри изнутри у него будут все данные потому какие ресурсы нужны он будет очень точно и дозированно заказывать новое железо здесь я хотел бы сделать небольшой перерыв и ответить на вопросы в чате возможно какие-то уже появились вопросы мы еще ждем пока ребята пишут то вопросы у меня у самого есть вопрос все-таки ввс почему в с почему вы не рассматривали какие-то другие других федоров вопрос хорошие я на самом деле частично него же ответила что у нас в компании мужчин использовался поэтому для своего проекта мы его взяли за счет экспертизы и того что мы и свою сможем обратно в компанию отдать но тем не менее этот вопрос можно задать и компании в целом почему компания несколько лет назад для походов облака выбрала именно мазур а все просто потому что компания посмотрела на доли рынка и amazon и тот момент занимал больше 90 процентов он показывал самую большую скорость роста и было очевидно что он будет лидером облачных услуг и она следовать за лидером но понятным тест богатый который бы говорить богатеют и amazon продолжает расширяться суши такой образ а вот те маком боится тема безопасности того что крутится у вас поднимается то есть вы как то проходите какие-то удет и я просто напомню что на прошлом de luxe у нас был отличный такого на тему компонентов кубер нить с коллегой обсуждали то как это нам правильно и хорошо делать вот тут собственно возникает вопрос у вас свой собственный кластер и вы еще ввс крутись как то вы целиком пытались эти компании или пока это для нас не вопрос отличный самое главное что стоит по это сказать это то что когда ты работаешь стартаперы там самое главное первое это сделать минимальный продукт который приносит минимальной ценность называем mtp и понять что он кому-то подходит возможно нам вообще не придется делать никакую безопасность если мы не сможем найти аудиторию которая будет нужна целесообразен тем не менее многие вещи проектируются у нас уже изначально с учетом ставил гайды по безопасности в том числе зоновские ставил гайды кубинские ставил каеды то есть никаких проверок мы пока не делали но мы стараемся заложить архитектурной все кирпичики которые потом не оступиться на вопрос безопасности обязательно станет например сразу приведу именно поэтому мы выделяем рабочую нагрузку клиентскую в отдельные группы которые не пересекаются с нашей рабочей нагрузкой то есть такие файлы клиентские которые будут собираться они не смогут получить доступ они в нашего облака не в чужие аккаунты клиентский соответственно об этом мы думаем но нельзя сказать что галочка поставлена кей пасиб сожалению я пока вопросов не туда мне попросили говорить погромче спасибо за обратную связь собственно вот такой вопрос а почему все-таки не менеджер обернитесь почему почему все-таки своей инсталляция кубе куча облаков сейчас предлагает своим nh3 шения для кубера вы пошли путем развертывание там своей столице и дожились частичная на этот вопрос уже ответил самым главным сам глава причина это то что нам нужно ставится уметь поставить себя железо кому то один из вариантов один из вариантов продажи а потом этого продукта то компания которая захочет поставить его в себе этот центр на свое железо тем не менее это не значит что мы вот это решение высекли в камня возможных последствий а мы перейдем либо на какой-то инструмент который позволяет более легко чем куб спреи разворачивать и и возможно даже платно либо полностью перейдем на managed решение если окажется что железе-то решение никому не будет интересно ну и бонусом мы получаем общую кодовую базу вместе с коллегами из других команд у нас внутри есть своя тат фаном внутренние для micro sim их там уже больше 150 внутри компании он тоже кубер ниц и мы подключаются тратим чуть меньше ресурсов и 1-я конная база поддерживаем сразу два куба но кей просила ну я думаю имеет смысл продолжить дальше и перейти к следующей части такого не едем дальше неорганические буду возвращаться которых ты решения чтобы понимать где мы сейчас находимся на какие части уже успели садике не следующий следующая часть про которую расскажу это а вы сами amazon машин и magic это образы виртуальных машин из которых amazon поднимает нам instance образы эти это print подготовленные centos 8 мы туда уже заранее поставили серой в нашем случае контейнер dolby atmos билет и это электронная система которая готова операционная система с демонами купер дети которые готовы присоединиться в классе и начать работу так много кроме того нужно сказать про логичным плит это сущность необходимое для того чтобы рассказать of those келин группе что делать с этими новыми нотами именно там указываются type так называемый количество процессора на ноги количество памяти на ноги некоторые stella настройки еще там ряд вещей еще одной штукой которую нам здесь пришлось использовать был клауда нет это набор скриптов который стартует после того как машина запустилась мы подмешиваем в плавание join быстро talkin' эта штука которая появилась под начинается второй версии то только с помощью которого можно авторизоваться пластик и быстро затронет надо в него без жонглирования с сертификатами если вам нужно добавлять на рынке советуют и вторая вещь которую мы сделаем главной нити это ноты noble black мы добавляем лейблы наверное важность этого станет понятно дальше нужно об этом упомянуть понятно что то происходит именно пластин плети следующая часть решения это политики на кластеров тоске ли вам нужно ходить и на зону узнавать соске лин группы и управлять и для этого и нужны права и разрешения вот здесь для тех кто уже работал с амазона привычная привычного вида policy здесь есть одна маленькая ошибочка если вы знаете что не так что не так с этой политикой пишите свои догадки в чат чуть позже я расскажу что именно здесь не так если посмотреть в секцию экшн и там есть четыре права с со словом this crap и это возможность авто скейлеры пойти облака и узнать какие авто с кейлин группы есть какие у них есть тэги самое главное и кровать configuration так далее и 2 2 экшена внизу срезают capacity to основное чем пользоваться тоске ли группа то есть установить то самое значение шеламова количество нот самые последние в этой строчке термины и твинс твинс это возможность кластеров то скейлеры попросите можно выбрать конкретную группу это важно классика мастер использует айди амазонского intenso для того чтобы из групп выбрать конкретный также расскажу о том как работает вся эта схема получения прав вот вышеупомянутая policy справа внизу квадратики полисе добавляется король ян вообще в амазоне право на что-то можно выдать двум сущности это юзер и юзеры выдается людям людей у нас есть не только от не робот роль соответственно всевозможных автоматизации глобально существует два пути как вы дать право для какого-то приложения внутри вернется в amazon можно выделять эти права для каждого пода это такие проекты как бухту а.н. но там есть свои ограничения связь pacifica и этот путь довольно сложный мы по нему еще не прошли поэтому пока мы пользуемся общепринятым способом выдавать эти права целиком на instance внутри которого работает но до кубер найти этому наша роль проявляется констанцию и любое приложение на самом деле топ-класса спейдер получает возможность ходить в мазановский 5 тут сразу возникает вопрос про безопасность этого решения мы добавляем эту роль только на те ноду которых наша нагрузка и и мы не добавляем эту роль натянуть на которых мы запускаем клиентский код точки зрения базу безопасности в порядке упомянул также что висит у инстанция внутри есть метода темп эта вещь которая предоставляет amazon любое приложение внутри из нас а также может обратиться по степи туда и выяснить что она находится в амазоне на ноги с конкретным техникам конкретном регионе и еще ряд параметров и amazon предоставляют возможность авторизоваться прозрачно для пользователя если бы попросту 5 вылет авторизован с помощью кредов содержащих себе вот эту роль с этой политикой это наверное все настал момент когда можно рассказать о самой саратовских власти ростовский virussoft простой вообще всего два варианта как действовать если появляется под которым мне не хватает места он добавляет если появилась возможность а корейка лишь not он их сокращает вот все что он делает она это на самом деле так вот можно было бы заканчивать в подтверждение того что это очень простое слово следующий слайд это количество настроек которые можно покрутить мастера тоски или когда я первый раз увидел сколько их я подумал что буду разбираться этим очень долго но на практике оказалось что сообщество разработчиков которые заготовили приготовили прекрасные дефолты и по факту для того чтобы сконфигурировать пришлось поправить всего два параметра из этого огромного списка первый из этих параметров связаны с local store джим это наверное защита от не совсем правильного использования повернется как такового если мы запустим код на ноги который будет использовать волею local о справедливом то есть голем которая сохраняется на файловую систему то же самое но бина который был запущен то такой под не может переехать на другую ноду если на физически не перенесем в комедии файл это анти патон для работы с купюрница в принципе поэтому когда люди готовят какой-то софт для к границе они обычно пользуются объектами с тортами или какими-то особыми файлов с темами которые предлагают облака в нашем случае те кто пользуется vocals to action это связано с особенностями архитектуры у него есть кроме кроме тех действий которые мы попросим black него есть еще некоторые системные штуки они выполняются шагами шаги выполнять сквозных контейнер и чтобы передавать данные есть контейнер в контейнер тектон использовать полю который хранится на ладе локально на мне страшно потерять и данные потому что эти данные технические поэтому мы говорим о а скейлер не обращай внимание на то что у нас есть коды с около 100 раджим пожалуйста далее ну это второй пункт здесь про конфигурацию это непосредственно самое самое сердце нужно рассказать of those келлеру какие из амазона вских от остальных групп можно трогать и даже вернее правительство не можно а нужно а какие в этом месте нужно рассказать еще одного игрока в этом решать это кладка менеджер и и 5 глава контроллер менеджер эта штука который вообще-то часть клан провайдера клауд трава ядовита интерфейс я жду амазонок убирается позволяет повернуть ему знать что в случае с амазона что он запущен помазок позволяет вытаскивать информацию по информацию instance is no soy de регион ну и вообще на самом деле всю ту информацию которая вам предоставляет вот в чем фишка что он делает call out контроллер менеджер берет инсайде и добавляет в бернейс лейблы на этим надо то есть мы получаем в терминах купюрница понимания что это за мода и благодаря ним ориентируемся какую нагрузку разместить есть в этом ложка дегтя вас келим глупо есть теги тэги и клад контроллер менеджер не умеет проносите теги и превращать их в лейблы и именно поэтому я делал отсылку ваш тип лирах мы делаем эту работу за контроль менеджер момент когда наша но то добавляется brains классных калоуда нить и прописываем и тела и вы так чтобы выбираемся где понимал что вот эти конкретные ноты принадлежат этой конкретной группе ну и кластеров тасс келлер после старта поставляет между собой тайги навешены на ресурс амазона и лейблу внутри кубинца понимает что вот это одно и то же и этим можно начать управлять возвращаемся к кластеров тоске леру и про алгоритм его работы чуть более подробно вот у нас идет как обычно нагрузка у нас есть одно но да там запущен опять кодов есть еще какое-то действо появился 6 все в порядке но тут появляется 7 7 под и для купюрница он появляется статусе там scheduled потому что нет ни одной ноты на которую этот под мог бы быть размещен кластера тоске gear отслеживают такую ситуацию и идет в autos соответствующий постели он крупу и увеличиваете заряд попасть на плюс 1 amazon добавляет нам в эту группу instance и нас добавляется на жку вернется кластер и под размещается на эту власть и вроде бы все хорошо нагрузка запустилась в обратную самом это работает примерно так же в данном примере 7 8 под закончили работу 2 надо больше на авто скейлер действовать следующим образом он в терминах кубер на и сделает great то есть говорит кубер нету пожалуйста больше сюда нагрузку дни schedule здесь на больше ничего не надо и спустя некоторые time of an instance пойди и указывает что вот конкретно вот эту моду пожалуйста езовский группы нужно убрать параллельно с этим он уменьшает дизайн к пасте так чтобы авто следую группа не предоставил нам замену той ноги еще одно и доуский произошел мы получили эту ноту вместо двух внимательны и слушатели здесь заподозрит что что-то я не договаривают что вещь какой-то нюанс которого нет действительно вот так не бывает обычно нагрузка завершается неравномерно данном примере у нас завершился под номер 4 5 7 8 остались работать ясно скейлеры умеет обрабатывать эту ситуацию он на самом деле его рабочий цикл выглядит ребят на так постоянно близко бесконечном цикле он спрашивает а не появился ли у нас защиту ридный под если вдруг он появился то начинается вся мы сумели по добавлению а вот если не зашел грузин их кодов не появилось то он проверяет они попали иную ситуацию когда мы можем ресурса высвободить при этом отчитаюсь сколько request of на процессор на память есть у всех порах и можно ли есть переместить между модами так чтобы какая-то из ног была освобождена если это событие наступило то он делает засечку по времени и спустя 10 минут параметр по умолчанию он начинает процесс отключение тренога ну на самом деле тайм-аут крутится в настройках в нашем случае 3 и 4 5 поле выключились авто скелета jq вернуться могу сделать так чтобы 2 ну да перешла в режим drain то есть она все еще выполняются чувствуешь на и нагрузку но уже не принимает новую и получает команду на то чтобы 7 8 под были перемещены на первую 0 7 8 под перемещаются но до освобождаются и можно идти of the sky на группы и выключать оттуда это разного важно отметить здесь что все это оберните происходит с учетом политик под distortion budget и грязь international напомню вот deception budget это штука которая указывает минимальное количество от которой минимальное количество кодов которые могут быть запущены одновременно например если в позе 7 и 8 у нас вы какой-то веб-сервис и нам ни в коем случае нельзя допустить чтобы его не работал какое-то время у нас сначала переезжает 7 под и только после того как он столкнул заработал гасится 8 и переезжает 8 все это обеспечивается работой смогу купить но в нашем примере down скейл произошел и все порядке крейсер конечно раннего пару слов это поймал который нужен повод для того чтобы процесс на 3 завершился правильно то скейлер также не мешает кубер не пользуясь своей улыбкой сначала дождаться пока под будет завершён и только потом выключают эту ноту есть одна проблема проблема связана с временем дело в том что добавление модов кластер происходят течение трех минут на что уход эти три минуты amazon после того как получил увеличения не зовет capacity он где-то запускает виртуальную машину забирает из банка образ на он копируется операционная система стартуют запускаются все демоны которые нам нужны демона там конфигурируется и вот реально все это занимает 3 минуты причем этот показатель еще хорошие потому что начинали 6 минут но начинали мы с того что мы запускали всегда самый свежий centos ставили на него самые свежие версии пакетов и после этого делали join в классе наверное можно было бы это время еще улучшить если бы мы пользовались чем-то вроде федора карлос там где прослойка операционной системы еще ниже и есть только то что отвечает за запуск контейнеров но есть нагрузка которую хочется чтобы она запускалась мгновенно и у нее нет возможности ждать вот на данном примере у нас есть 7 под который пал состоянии дуэт и он будет идти люд прежде чем начнет работать и это может быть недостаточным уровнем сервис для кого-то в кластеров тасс келлер есть прием который позволяет этого избежать вы себя его назвали по пузырь он же бабу под и пользоваться этим можно поверните начиная с версии 14 организована это при помощи приоритетов то есть упада пузыря выставляется приоритет ниже и работает примерно вот так нас есть на первой ноте пять пудов с нормальной нагрузкой и запущен под пузырь который по факту не выполняет никакой полезной работы держит на вот это место как только у нас появляется 6 под на второй ноде он впадает состояние нашей улиц убирает плод планировщик убирается замечает это состояние видит что у кода пузыря приоритет ниже поэтому он мгновенно косят под номер шесть сразу же мгновенно поднимается на газ поврежденном месте а вот пузырь надует остается висеть и ждать пока остается висеть и ждать пока кластеров то скейлер то делает то что начал то есть на самом деле еще когда 6 под появился статус on schedule и ту же запустились механизмы добавлении новой ноги и все все это время мы ждем однако для куда позволяю это непринципиально он ничего не делают просто сложно для того чтобы подготовить дополнительную мощность создать такой под довольно просто это два я была вернет 1 слева это priority class минус один это значение которое которые по дефолту позволит нам сделать плот самым низким приоритетом и справа если посмотреть самый низ этого кода есть 200 миллисекунд который мы rise верным и чуть выше и мышь это к восьми спитцер поз то есть пауза процесс который не делает ничего зимой по факту не занимаем процессорное время и память но это позволяет нам зарезервировать некоторую мощность и настал момент рассказать что не так бюро с политикой чуть чуть позже я сделаю паузу и спрашивай у сергея был ли кто-то в чате кто смогут вопрос здесь было глаза чем я упомянул что мы используем лань 4 плиты в для того чтобы конфигурировать размеры инстансов и от каскелен группа могла понять какого какие параметры запускаемых нужны но данная политика не позволяет кластеров поскидывать прочитать какую бы то ни было информацию про ланч ним плиты и closed выстреливать не сможет узнать какого размера у на основе для того чтобы все работало правильно под картинкой с политикой есть еще одним action если мы разрешим и добавим эту политику опцию диск райт логичный плит вершин 100 aw тоске ли он сможет доставать замазывать данные по внешним плитам парсить их и узнавать какой instance type внутри рассказать об этом всем стоит в ключе про одну возможность авто скиллинга под названием zero not можно спилить вообще amazon не запрещает уменьшать количество нот в авторский рингу 0 это может быть полезно когда нагрузка приходит периодически и и непостоянна и она может подождать когда пакетная обработка для которой пакета причинам не подошел сервер лес что происходит внутри кластеров то скейлера когда в самом начале он стартует и пытается понять где он находится и что вообще происходит получив информацию о авторские лет группе поняв что он будет управлять он заходит и пытается везде есть верни ланч configuration ланч configuration это устаревший способ это то же самое что сейчас делать он желаешь ним клип способ описать и принцесса и кроме того если брать дальше пойдем по кейсам алгоритмы если ланч configuration не был найден кто пытается надеваешь треплет здесь есть пудрит вариант когда власть implied добавили несколько инсайтов при этом авто скейлера выберет всегда обязательно 1 по счету instance так напомню не из нас type это количество процессоров памяти на воде тип архитектурой прочее почему это может быть проблемой если использовать смешанные типы и разное количество процессоров внутри разное количество памяти то алгоритма соске лера могут сломаться в них явно написано ограничение что стоит использовать только ноды одинакового размера по процессоры по памяти для того чтобы не было разночтений в тем не менее в названии есть instance type и у которых они сами по себе разные но количество процессоров одинаковой поэтому в целом может существовать дачный плиц нескольких печетесь нужно сказать есть волной сценой в этого всего если авторского сирота скейлер не смог вытащить информацию open sans toi пах из всех этих трёх опций то он считает что следующее ну да которая появится в группе будет точно точно такими же ресурсами как те что уже есть то есть если у нас есть хотя бы одна запущенное но до в группе то он считаешься следующий плит такой же и именно этим пользуемся мы потому что по факту у нас класс развеет не знаю всего это получилось это политика по дефолту она есть документация на у нас работает и говорится работает не трогай здесь я наверное хотел бы прерваться на вопросы возможна оплата появились вопросы потому алгоритму какие-то подробности или еще что-то сергей был ли было ли в чате кто-то кто сумел ответить на вопрос про опалить слушай она вообще вот все эти настройки конфигурации сложная штука то есть я думаю не каждый заметить что там просто добавляется слово template вместо . крыши написано ложь тем поит и это такой очень внимательный человек заметит нас чатике сожалению кто не увидел но вот у меня к тебе на флета возник вопрос смотри мне кажется это уже какая-то специфика amazon vs и не кажется ли тебе что слишком много специфики при условии что вы разную рта выйти кластер на железе еще и ввс и держите как вообще вы с этим живете что вот у вас какая то специфика возможно влияет на то что не плавится на жалеть расскажу я уже упоминал что мы хотим наш к вернет с помощью курс по и у нас есть вокруг этого обвязка ансамбля которая за нас все планирует разные кластер а там есть лифчике и часть функционала у нас реализовано в облаке одним способом на жалей за другим способом от этого тоже никуда не деться например тот же план провайдер мы используем облака для того чтобы заказывать load balancer как сервис см и вообще никак не configuring the mill от лансера просто декларируем декларативной виде внутри купается просим облака над доставить это очень классно работает случае железом мы сейчас используем металлов бы поэтому такие и free неизбежно соответственно вся эта логика которую мы сделали чтобы экономить облаке она просто пропускается в советники и не применяется на железе но мне просто любопытно может быть есть какие-то стандарты в области политика этом управлению доступа или до сих пор все так же у каждого провайдера свои способы задания политик доступ я бы очень хотелось чтобы такой стандарт появился нам практика появление в этих стандартов 2 и потому что они во-первых и будет 50 а во-вторых они никому не подойдут и каждый человек понятно сделать 50 лет но было бы очень круто если бы такой на повез жалеть не покроется работать с тем что есть и это с одной стороны плохо с другой стороны благодаря этому у нас как выйти специалистов всегда будет клэп потому что мы кидаемся в эти тонкости изучаем как и и можем можем с этим хорошая мысль свыше ещё такой вопрос операторы кубе в кубе есть такая штука как операторы ты говорил о том что у вас тепло и построен на базе и еще архиву какая-то привязка то есть вы не пробовали смотри сторону там оператору чтобы переделать на них дипой суре кастеров здесь надо правильно понять этот вопрос вообще оператор это сущность повернется которая позволяет в терминах обернется декларативно запросить какую-то штуку которую вместо тебя в этом классе развернет мы пользуемся большим количеством пиратов prometheus катим с помощью оператора мы у себя внутри для стретчинга по сгрыз оператор использовать для того чтобы он поднимал на базу для разработки мы не заморачивались тем чтобы всегда начались какие-то отношения иметь базы данных мы используем дпс не пасу как сервис и я не представляю себе как можно развернуть на эти оператором это что-то вроде есть управляющий кластер и в нем есть оператор на попросили вот наша железо сделай нам пожалуйста другой 20 лет архитектуру очень похожи на ранчо плохо fetita на то что мы хотим мы хотим получить один plaster полностью управлять поэтому скажу так есть некие тенденции что разрабатываются решение где ты из управляющим выбрались кастера можешь тепло и другие куда месть кастера конце концов оператор довольно универсальная чтобы ноги то есть вы пока на эту тему не задумывались хорошо нож открыть эту страничку с параметрами ночь с неудобной листать условия я предлагаю обратиться самом конце у меня обязательно будет вопрос про этот большой набор параметров хотя может быть ты так навскидку помнишь какие параметры какие параметры полезны ты сказал то есть которую вы конкретно использовали такие параметры мою вредны которые вели в коем случае не стоит вот так просто так братья чуть с которыми надо быть крайне аккуратно основе опыта вот сходу я не помню ни одни из этих кораблей которым в которой мы бы вступили именно из за того что в теле ручки ну то есть мы выбрали дефолты и он сразу работал потому которой нас устроила добывал эффектом это бывает у нас были большие проблемы связанные с тем что нам нужно было свою нагрузку к этому немного подготовить можно было teller вишни ци правильно расставить до чтобы наша нагрузка появлялся именно тех новых там до возникали некоторые накладки был момент когда кластер тасс келлер спал из-за этого пак еду растил нашу группу до максимального значения вот деталей сожалению оперативной памяти нету постараюсь до секция просто вспомнить исполнена расскажу то есть потратили карточку до привязаны к таки от страха вались мы быстро или максимальный размер авто с гелем группы и вы точно знали что мы не потратим больше чем эта сумма здесь в порядке так ну я думаю имеет смысл идти дальше и рассказать конце концов просто ты давай прежде чем мы перейдем к потом еще одна маленькая штука пункт кластеров то скейлер если вдруг к нам нам надо попытается пройти под который не поместится туда по ресурсам например попросите немного процесс много памяти авторских достаточно умный чтобы много не разворачивать то есть он заранее знает сколько ресурсов снова приедет и просто не будет против если это не принесет ни кола секта это довольно полезная штука ну и настало время поговорить про споты споты и из всего решения примерно 50 на 50 50 процентов всех сэкономить на москве и еще 50 использования под инстансах подлинность что это они вообще могут быть до 80 процентов дешевле чем те которые мы берем диман за счет чего это достигается достигается за счет того что она звон делают на них своего рода аукцион и предлагает нам не до еды не нагруженная железо тоже лиза которую амазона никто не купил над режиме что вообще происходит когда у нас появляется такая периодическая нагрузка например какие то баштанский которые нужно большом день выполнить но необязательно срочно или нагрузка типа сессии которые то есть и не или тестирование и и другого рода такие нагрузки которые не должны постоянно мочь кому-то ответить а которые должны это вы плакали все есть большой соблазн не переплачивать амо зил на высокую стоимость а например запустится где-то в другой молоке где если они там стоит дешевле потому что нету того количество сервисов которые мусор вокруг предоставляет и может быть эко-система попроще но тем не менее из этого из того что часть уходят туда и в принципе amazon планирует такую любой другой 8 провайдер желез вперед возникает пул ресурсов не до использования и ножом предлагает их все-таки использовать дешевле он снижает цену согласно законам рынка более низкая цена повышает спрос на это железо и в какой-то момент люди понимаю что нет все таки можно пользоваться плюшками однако системой запустится здесь с учетом этой стоимости важный момент что спад и спроектирована для нагрузки толерантных остановках то есть это вот именно все то что до этого перечислял себе какие-то выигранные тоски конверт и прочее конкретные цифры я залез и посмотрел за последнюю неделю ноября в для сборки в моде мы пользуемся единственно сами типа это рио медиум таинством смд процессорами с двумя ядрами и четырьмя гигабайтами оперативной памяти и мы платили за них один цент 1 из 7 центр в час при этом обычная цена если бы мы брали 500 demand глобы веселье цента в час мы на самом деле только за счет того что внедрили все это решение получили больше чем больше 70 процентов экономии здесь еще одну интересную фишку of the skilled губ и расскажу иногда бывает вообще когда мы заказываем артас колин группу мы можем попросить amazon и наполнить ее полностью on demand in demand in some те которые подороже и это иисус и которые у нас amazon просто так не заберет можем попросить наполнить нашу group полностью spud инстансами и это подходит для типа нагрузки на которой мог бы прервать можно сделать какой-то гибридный режим например если мы точно знаем что один из нас у нас должен быть всегда мы можем попросить опциями и выставить он диман bass 1 и amazon гарантированно будет содержать если он demand and лишний вас поставить 50 из под 50 и увеличить зовет копать до трех мы соответственно прочим что 2 и 3 ноты и соотношении 50 на 50 будет 1 приманка от нас готовы этими штуками можно играться и очень точно выяснить ту грань между надежностью и стоимостью очень-очень много нюансов можно очень долго изучать все детали механики проведения спотов и я советую присмотреться к ним и если вы этого ещё не сделали следующий кубика важными нашем решении который появился как следствие использование спотов на штырь меж на хрен ты здесь важно сказать что мы я уже упоминал что amazon может эти спад и отбирать если цена если спрос повысилась от amazon повышает цену из этого масоны выгоднее продать это железо сейчас кому-то другому amazon о таком событии предупреждает за две минуты то есть он его случае заберет ему по крайней мере узнаете об этом заранее машин hanger это приложение которое позволяет на такие события реагировать и в нашем случае он выполняет грей вернется ноды и русско перераспределяется я уже говорил что новая надо у нас при этом добавляется три минуты что вообще происходит да как только а в истре месячных кэндзи cделает train и кубер ниц и и забирает у нас появляются от под и которым негде разместить с тесс менеджер кластеров тасс келлер на эту ситуацию реагирует и запрашивает у amazon и еще одну еще один винт нашу группу соответственно поднимается является пластик я уже сказал что есть несостыковка по времени новый инст вас будет подниматься три минуты amazonas вот уже за две дамы к сожалению с этим не может ничего сделать наша сборка если она активно идет в момент может быть прервана такую сборку мы просто перезапускаем у меня это подходит нашла решение для вашего может не подойти нужно этим и смотреть случае если бы это например был веб-сервис который просто отвечает по некоторым и 5 то для него это схема вполне рабочие за две минуты предупредили он поднялся на другой ноги и начал работать все счастлив можно тот момент применять еще одна интересная штука которая стоит упомянуть это горизонт кода в тоске ли это решение которое позволяет увеличивать количество кодов deploy venti если повысилась нагрузка он смотрит среднюю нагрузку на процессор входа примерно также как amazon следит за авторские лин группами только делает это на уровень абстракции глубже внутрь и купюрница как только нагрузка выхода паровое значение добавляется еще один под и там сервис может выдержать большую нагрузку зачем я вообще здесь про него упомянул дело в том что он никак не пересекается с вот и кластер от аскера они могут сосуществовать вместе и не смысл присмотреться и использование еще и его соответственно если новый под который появился благодаря тому что горизонту по доске лях увеличивать нам количество не может быть ни саше дали новую моду и все будет порядка если вы хотите подробнее узнать пропустили рта ванну школа делал доклад там масса подробности о том как он работает советую сходить и посмотреть я рассказал в самом деле все кубики которые нам были нужны для того чтобы сделать то что мы сделали и ещё немножечко упомянул техники доставляли мы в кластер все это при помощи фильма и и здесь оставлю ссылочки презентацию можно будет включать посмотреть эти штуки устроены и возможно применить себе также стоит упомянуть о том что кластеров скейлер это готовая к кубе на эту штука по and point metrics отдает свои метрики формате бромид и нашей стороне совместный с примет вирус которых метриками забирать и можно собрать для себя дашборд чтобы понимать в каком состоянии сейчас находится тоски дыр и что происходит здоровым здорово когда происходили события on schedule и кодов и события псковские знаю будет ли видно но на левом верхнем графике желтые пике это как раз мы когда у нас появлялись в зале вход и нарастающим итогом зеленая линия высше это когда увеличивал вам размер классе то есть он работает и приносит нам пользу ну и теперь то ради чего всё это затянулось до того как мы внедрили кластеров тоске ли он расходовал примерно 20 долларов день 6 произошло мы выкатили этот код наш стейджинг на это данные с нашего тренинга на которых мы тестируем наш продукт и средние расходы снизились к 12 долларам нажмут обычно очень рад когда такие штуки происходят ну и на самом деле все внедрение кластеров тоскиги он может быть календарно вместилось в две недели ну и естественно не full-time а то есть это относительно дешевого решения нужно знать много программ но если он у вас уже есть то можно довольно быстро внедрить и начинает получать с этого просит ну и что вы получите роскошном доклада теперь вы точно знаете что умеет красиво постели чего не умеет какое то делают и можете попробовать нет ветерок себя свет знания и направлению на столе то уже есть ну и во вторых вы можете попробовать повторить достигнутый нами река номером 40 процентов на спотах забравшись ними начать начать их использовать также если вы кого то вдруг возникнут вопросы по и хочется чуть подробнее узнать про архитектур приложение доктор я работаю справа . можно по ней перейти но и я готов ответить на любые вопросы которые вас возникнет да спасибо за доклад суши вопросов много на самом деле у меня хочется мне выступает один такой интересный момент это мониторинг можешь вернуться назад сойду про мониторинг костик-то скейлер вскоре сердцем что это мониторить и и если у вас китая лед и когда это не работает аль ордена крещение перекрутили на самом деле мы сейчас эти метрики и собираем для того чтобы они у нас были в истории и периодически когда мы хотим понять разобраться что с ним происходит на заходим но по факту нас не было еще ни одного кейса чтобы он не работал по истокам о его запустили то есть на этапе разработки и отладки у нас были к нему вопросы и он не работал там так когда мы всего это с configure поправили вам работать как часы и нет кейсар где-то проблемы приходится расставлять приоритеты между тем что делать это наверное часть нашего технического долго и рано или поздно вы его покроем а летом в том числе например у как вариант мы сейчас мне узнаем о том если мы выиграли максимальный размер группы максимальный размер оснастили группы вот мы узнаем в этом только если сами придём и посмотрим на этом можно было бы сделать здесь allure этот хороший point окей ну я тут просто на прошли направленную комитета хочу напомнить что у нас будет такой замечательный такой 3 дня по поводу лифтинга и того как там наблюдать за проблемами системах григорий koshelev работа над ошибками очень рекомендую посетить окей спасибо сушат наверно еще такой вопрос да прежде чем нас кончится время а почему все-таки спад и чаще вот есть такая новая модная тенденция сервера с или там ведь на кого slando кажется что ну всякие евангелисты этих штук говорят что это позволит очень сильно экономить чему вы все-таки перешили используя статы движение в эту сторону заметно да как бы но но мы пока непонятно конкретика когда я последний раз заглядывал лямды они были все-таки дороже чем то есть там все понятно зависит от количества нагрузки если нагрузка маленькой выгоднее использовать все до вас есть нагрузка большая то выгоднее использовать свое железо и ну как мне кажется в конечном итоге если мы будем утилизировать свое железо полностью долю было очень будешь его чем лямка плюс есть такая штука лямда хорошо использовать на клиентской стороне когда ты точно направляешься когда базы нам же приходится запускать клиентскую нагрузка который мы заранее ничего не знаем нам может претендовать файл и он может на лямки не собраться в к некому было гораздо больше шансов быть собранным на поэтому верному пока не рассматриваем сердилась мы наверное сделаем в панике research и заход на тему того чтобы попробовать собирать в амазонку отбил над установил есть свой сервис и это например под будет на делать сборки за счет клиента получается вы уже в его инфраструктуры поменяю схема монетизации но скорее всего к билду будет больше ограничений чему к никакого мы можем филигранно крутить на месте массива слушай да решил александр до хочет родитесь переговорки да я хочу даже не просто вас выгнать переговорки я хочу сагитировать вас и всех наших слушателей переместиться в дискуссионную зону вот здесь вот вот здесь вот кнопочка присоединиться к дискуссионной зоне и там продолжить увлекательное общение потому что доклад несмотря на то что он был скажем так вводной в технологию я думаю вот очень хороший point в нем был что а потом мы пришли к руководству и сказали а теперь все тоже самое но на 40 процентов дешевле руководство обычно любят читать деньги и технологии не для технология вот конкретная выгода и это очень здорово посему виктор огромное вам спасибо за доклад лично прослушал с большим интересом сергея огромное спасибо за вопросы за поддержку беседы очень надеюсь что встречаемся не последний раз виктор может быть вы к нам в питер приедете после вот все эти к видны истории я на самом деле все все три раза в на предыдущих двух их уже был у тачки правда есть из каждой конференции и в питер уже приезжал но с удовольствием приеду ещё раз отлично огненно что большое всем спасибо"
}