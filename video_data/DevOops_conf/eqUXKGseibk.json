{
  "video_id": "eqUXKGseibk",
  "channel": "DevOops_conf",
  "title": "Даниэль Халиулин — Mobile SRE — когда надежность нужна не только на бэкендах",
  "views": 307,
  "duration": 2787,
  "published": "2024-10-04T01:02:55-07:00",
  "text": "друзья Всем привет Спасибо что дожили до конца дня и пришли на доклад замечательного Даниэля под названием Mobile сырье когда надежность нужна не только на бэкенных и прежде чем мы начнем хочу напомнить что у нас есть чат замечательный по теме данного доклада можно задавать вопросы туда писать Давайте забыть их чтобы задавать их в конце доклада и после того как Даниэль закончит нам рассказывать про свой опыт мы всех пригласим в дискуссионную зону Так что не забывайте об этом копите вопросы можно будет пообщаться лично и такой вопрос скажи это все-таки конференция там про диопс да про все остальное все снова рассказывают про всякие сопланчейны про автоматизацию про надежность но все касается действительно бэкендов скажи Действительно ли это применимо к мобилкам это же как бы ну просто клиент на самом деле Да многие вещи применимые и особенно применим опыт сыры и дефолпс инженеров мобилках и вот Об этом я в этом докладе думаю немало расскажу тебе слово пожалуйста Спасибо еще раз Всем привет Меня зовут Даниэль и сегодня мы поговорим по надежности сыры в мобильных приложениях пару слов о себе почему вообще я могу об этом говорить в Тинькофф я отвечаю за направление производительности и надежности основного мобильного приложения то есть мобильного банка Возможно вы даже им пользовались до Тиньков успел поработать системным администратором И среднее инженером российского оператора связи и разработчикам и системным аналитиком в кувейском операторе связи даже пару разгонял в Кувейт поэтому не есть рассказать не только про Кувейт и сразу говорю что сейчас я скажу одну историю и может быть вы слышали в каком-то другом докладе если вы слышали то не переживайте потому что выводы в этот раз будет намного намного лучше в общем хватит оговорок погнали происходит жук и мы перемещаемся в пространстве в некий пятничный вечер не такой как сейчас не пятница Но короче обычно пятничный вечер одним таким вечером в чат по сбоям приходит сообщение Примерно вот такого содержания Ну небольшая цензура есть и вы знаете Автор этого сообщения не обманул потому что все кто Пошли проверять мобильное приложение увидите Примерно вот такую картину Как вы можете видеть на главном экране мобильного приложения мобильного банка почти нет ничего список счетов пустой баланса посмотреть нельзя клиент фактически практически не может управлять своими деньгами вечер перестает быть томным и пока в данном детекторе растет список обращений от клиентов импровизированная команда начинает разбирать инцидент и она прогуляется по целому пласту разных систем в инфраструктуре Тиньков она пройдет посмотрит различные фишки они это команда пойдет осмотреть различные метрики различные бэкэнды естественно последние релизы От безысходности пойдем на базы данных клише но нигде ответа Просто так найти не получится и только Спустя час где-то один человек рандомно подумает А вдруг проблема вообще не на Северной он начнет анализировать конфиги мобильного банка и вид одно странное изменение От качества на тестовой среде его чудо все заработало оказывается Проблема была в конфигах мобильного приложения но в чем именно была причина А причина была в том что один бизнес-аналитик менял на породе кое-какие данные в пятницу вечером и нарушил контракт данных тем самым мобильное приложение стало получать конфиг не в том виде в котором она ждала обязательных полей не было Вот такая вот история случилась И в этот момент мы подумали Окей Мы кажется решили проблему но нет наждала очень интересные обстоятельства а именно кэш кэш на стороне клиента на 24 часа Что это значит Это значит что все клиенты которые заходили момент сбоя мобильное приложение то есть выхода всего у них осталось два переустановить приложение или сутки не пользоваться банковским приложением к очень круто не тот уровень сервиса которым мы стремимся и возможно вы сейчас сидели и думали Какой бизнес-аналитик какая Пятница вечер где ревью изменений на прозе и если у вас были такие вопросы то я тоже присоединяюсь Вот именно к вашим вопросам Я тоже сидел на этом созвоне И мысленно задавал эти вопросы мысленно потому что это была всего вторая неделя Моя работа в Тинькофф И несмотря на то что поддержка ситуацию всю разрулила клиентам всем помогли и ситуация была решена Эта история вскрыла Целый Целый Пласт проблем с надежностью мобильного приложения и рядом с ним а именно первое очевидно что когда бизнес-аналитик что-то меняет напротив в пятницу вечером без ревью есть налет проблем с процессами второе поведение приложения было далеким от того котором мы хотим его видеть Вы видели скрин как его разнесло третье случившееся не то чтобы было какой-то большой новостью потому что проблемах говорили о каких-то знали но я думаю вы понимаете как бывает когда есть другие более приоритетные задачи и последнее но не по значению Совершенно очевидно что у нас не было достаточно картины происходящего потому что момент того сбоя вот метание отметки клогом по каким-то скриншотом просто показывали что наблюдаемости обзор обилиец нашего мобильного приложения она оставляет желать лучшего и в этом докладе вместе с рассказом о том как именно мы закрывали все вот эти вот пункты А мы все закрыли естественно я сделаю некие выйдут некие советики и предложения о том что именно вы может сделать полезного для мобильного приложения вашей компании как инженер прямо сразу после этого доклада кто-то может быть даже сегодня вечером но это не точно что погнали и Первое у нас был фильм настроен процесс управления изменениями мобильного приложения поэтому что мы сделали Окей пошли процесс улучшать а выглядел он примерно в тот момент пользователями админки были аналитики они правили там разные файлики когда писали ТЗ на новой фичи или когда просто нужно было заменить какие-то данные просто заходили носили изменения и сохраняли эти данные сама админка в которой они эти изменения делали представляла себя самописный веб-интерфейс в этом интерфейсе можно было про текстовые файлики без относительно там их специфики там же сон Play текст из-за этого было удобно отдать такой инструмент бизнес пользователям и не нужно было заморачиваться многих вещах и ровно в том виде в каком фалек бизнес-аналитик сохранил ровно в том все улетало в на корпоративной С3 откуда периодически сидели забирали эти данные и публиковали их себе Откуда уже мобильные приложения забирали эти конфиги и кэшировали себе для снижения нагрузки естественно схема на деле сложнее но детали они сейчас не принципиальные А теперь внимание вопрос вот Глядя на эту схему Скажите мне пожалуйста Где в этой схеме в лидаться изменений где момент когда кто-то проверяет вообще не фигню аналитик там пишет в этом конфиге я понимаю Почему молчите потому что этого просто не было Вот как он сохранял так все уходило Джонсон схемы опровы Нет не слышали вернее Конечно мы все слышали но руки сделать не доходили из-за других приоритетных задач можно брать уже цитату очевидно был только вопрос времени когда эта схема стрельнет и вы знаете вот история она стрельнула опасная причина в коробке сроки работают минку всю систему не представлялось возможным поэтому было решено сделать такое временное решение на базе китапс на базе гитлабас решения управления конфигами А вот собственно и это решение был созданная территорий с конфигами который предполагалось использовать как основной источник Правды о том какие должны быть конфиги и за счет лаба и гитара мы получали сразу ревью pipeline вот эту всю историю пользователи заходили свою ветку делали нужные им изменения далее делали метчик Мастер и на этом месте которые проверяли соответствие Джейсон файликов Джейсон схемам если уже на этом этапе началась происходить какая-то дичь то такие планы не проходили и пользователи получали информацию о том что же они сделали не так если все зеленые то требовала от кого-то команды опытных аналитиков ребята смотрели оценивали не дичь ли там вообще происходит и ставили свой опрос и вот эти вот два действия валидации в пайплайнах на джисон схемах и обрув от опытных аналитиков драматически снизили риск повторения этой ситуации вот в том виде в котором она была и в прошлый раз тут все S3 и так далее еще раз скажу да схема сложнее особенно когда мы работаем с кэшами на сиденах Но это сейчас просто не принципиально и как я сказал уже в начале про эту схему она задумывалась как временное решение временное решение и вы посмеиваетесь потому что вы все понимаете мы до сих пор живем так и собственно ни о чем не жалеем Все работает Окей инженер Тиньков Молодцы что-то там сделали решили свою задачу но какая польза мне как не инженером инженера не Тинькофф от всей этой информации и мы приходим к первой порции советников советник номер один Зайдите коллегам из мобильной разработки мы будем много говорить о коллегах из мобильной разработки и узнаете Есть ли какие-то критичные ресурсы вашего мобильного приложения от которых он сильно зависит и может быть эта информация ничего не сделаете но просто знать о том что такие ресурсы Есть возможно будет полезно для устранения какого-то сбоя которым вы еще не знаете советник номер два поверьте если валидация критичных ресурсов на серверной стороне например их состава что все нужные файлики или компоненты есть или их контента что там контент файлика соответствует какой-то схеме А если этого нет то может быть вы можете что-то с этим сделать возможно простой ивчик pipline или скрипт уже может закрыть эту проблему подумайте об этом третий советник видите аудит процессы изменения критичных ресурсов вашего мобильного приложения и увидеть конечно слишком громкое слово подумать о том Может ли один человек сломать ваши мобильное приложение полностью А если вообще если какой-то процесс ревью этих изменений а если нет то можете ли вы его сделать на коленке хоть как-то или хотя бы организационно может быть с этим что-то можно сделать и все это было про то что он был процесс управления изменениями Теперь мы сделали лучше Идем дальше второй печальный вывод который был сделан из того сбоя мы не умеем в нормальную коммуникацию с клиентами и когда я говорю по коммуникацию Я имею ввиду не СМСки пуши и что-то такое а User Experience только клиент взаимодействует с нашим мобильным приложением Если вы забыли то вот так выглядела ваше приложение в тот момент по этому поведению клиенту не понятно Это только у меня сбой или это что-то массовое оно как-то рассосется само или мне что-то нужно сделать с этим банк закрывается ими нужно быстрее бежать снимать деньги или все будет нормально и вот смеются А я знаю людей которые действительно в тот момент поехали быстрее снимать свои деньги потому что именно так они подумали и такие вопросы примеры клиентов показывают что в момент таких сбоев клиенты нужно прозрачность через которую они хотят безопасность компания знает проблеме компания решит ее и что это не бушит слова Как ваш звонок очень важен для вас естественно лучше чтобы сбоев не случалось Но если все-таки они происходят то нужно медь нормальных обрабатывать поэтому мы стали думать стороны того как на уровне ua более адекватно себя вести в таких сбоях требования к этой теме были довольно просты первое мы хотели наушник графического интерфейса иметь возможность объясниться с клиентом что что-то сейчас происходит Второй вы хотели научиться останавливать трафик со стороны клиента во время сбоя В некоторых случаях устранения сбоя значительно осложняется большим количеством трафика особенно как клиенты снова и снова что-то делают Надежде что хоть раз нужной операции выполнится и вот история мы хотели как-то обыграть И третье время некоторых сбоев могут отдавать Не вполне корректные данные которые мобильное приложение можно зафиксировать естественно в идеальном мире этого не происходит но вот в нашем мире такое происходит и мы хотели иметь возможность удаленно у клиентов сбрасывать крыши на телефонах чтобы и устранять эту проблему для клиентов в общем смотрите Что за из этого Получилось первое мы хотели как-то в ЮА и объясниться с клиентом и сказать что что-то происходит для этого мы разработали специальную опишу небольшую которая сообщала мобильному приложению о том что происходит какой-то сбой в котором нужно что-то показать клиенту Как видите на экране здесь есть разные варианты когда прям сбой происходит когда он уже закончился клиент его видел и все это дает некую прозрачность клиенту в общем вот так мы это сделали второе мы хотели научиться тормозить трафик клиента со стороны мобилки Хотя это очень-очень нужно вот в то же самое печки мы это предусмотрели теперь в черный день когда все очень плохо нам нужно все остановить мы можем сделать так что все мобильные приложения у всех клиентов будут запускаться с таким экраном Как видите здесь с этого экрана никуда нельзя перейти Не авторизоваться никуда Нельзя таким образом клиенты просто останавливаются и мы тормозим естественно можно было положить просто заглушечный балансировщик и весь трафик также остановиться таким же успехом но когда это обыгрывается для клиентов Это намного более приятно адекватно и все такое И третье мы хотели научиться сбрасывать некорректные кэши в когда вот что-то такое случилось поэтому мы сделали закладку которая позволяет это сделать самое интересное что такой работе клиент может даже ничего не подозревать мы оставили себя возможность сделать тихие сбои когда приложение никак не проявляет что что-то там происходит а в этот момент оно само себя чинит относительно какого-то сбоя например кто-то включил фича флаг который не нужно было еще включать но случилось так мы можем сделать такой сбой приложение при запуске получит его и будет форсировать обновление кэша фича флагов даже клиенты сейчас флаг еще был не нужен тем самым мы примитивно Решаем проблему клиента чтобы на неё не натолкнулся а что из этого всего можно взять инженер А вот что во-первых самостоятельно или вместе с мобильщиками Посмотрите на то как ведет ваше мобильное приложение в момент этого сбоя вы вас разносит как разносило нас или может быть вы сыпете бесконечными ошибками что-то пошло не так или какой-нибудь Exception пишете клиенту В общем Посмотрите на This на то как ваше мобильное приложение себя ведет при сбоях и хорошим заходом эту тему может быть такой лайтовый хаос Инжиниринг Когда вы можете замакировать ответы с которыми работает ваша мобильное приложение ошибками никакными ответами пустыми ответами и посмотреть как она себя поведет что с ним будет И с этим можно что-то сделать дальше Подумайте вот на основе той самой информации что можно с делать теперь со всем этим делом Окей вы обнаружили что приложение ведет себя неадекватно что можно теперь с этим сделать Point простой сформулируется план и действуйте и тут Важно говорится что в нашем случае мне легко об этом говорить потому что когда мы мобильном банке занимались у нас была поддержка руководства нам не нужно было никому объяснять почему это нужно делать вписывать приоритеты у вас может быть другая ситуация и вот о том как это все согласовать и договориться об этом нужно какая-то отдельная Тема и возможно не надо рассказывать И третье подумайте о закладках Вы можете заложить что вы можете заложить ваше мобильное приложение такого чтобы помогать клиентов таких типовых ситуациях вот в нашем случае это был заброс кэшей Может быть вы можете вытягивать с него логи или написать какую-то проверку которая будет проверять доступность ваших серверов в общем Наверное вам и ваши мобильщикам есть удобнее что вы можете заложить в вашем мобильное приложение чтобы клиентам помочь Идем дальше наша третье наблюдение не слишком веселое было о том что ни у кого нет фокуса на надежность мобильного положения и прежде чем углубимся в Это наблюдение принято решение хочу сказать немножко контексте в котором это все решения принималось потому что очень сильно влияет мобильный банк делает более 300 разработчиков из более чем 60 команд своими бэк-локами планами бизнесами и всем таким само приложение ежедневно заходит порядка даже сейчас точно больше 10 миллионов клиентов каждый день и самом приложении представлены почти все бизнесы Тинькофф кредиты депозиты инвестиции оператор связи я избавлю вас я не буду все перечислять но просто там очень много всего все делают все в одном мобильном приложении именно из-за такого масштаба нельзя было решить проблему надежности просто как-то одним движением нельзя было написать одно мотивирующее письмо нельзя было написать какую-то регламент или процедуру нужно было какой-то более системное решение более того нельзя было даже просто инженеров и попросить их крепкой рукой жесткой навести порядок и вот почему Первое это довольно очевидно где увидели из серии инженеров с крутыми глубокими компетенциями в мобилке Я не очень много видел А если в этой теме нет компетенции то много пользы можно понести это вопрос и следующий пункты связаны или вытекают как-то из этой проблемы второе мобильные разработки куча разных разных девайсов с разными характеристиками от разных производителей если с эплом все более-менее понятно хотя даже там есть девай специфик то случай с андроидами это просто ад обязательно какая-то проблема моделируется только на самсунгах с определенной версией View но естественно не у всех этот такой подход Это не то что привычно традиционным сыры если вообще есть такие традиционные И третье это более длинный релизный цикл когда мы работаем в сфере вы Привыкли что мы привыкли что можно что-то быстро задеплоить и писать что будет собрать мобильными мобильным приложением так не получится потому что даже если вы разработку жмете до нуля Вам нужно будет хотя бы один день или Google хотя бы один день а еще недельку на то чтобы раскатить постепенно ваше приложение Если вы не хотите сыграть Русскую рулетку и сделать его доступным сразу всем вашим клиентам такой долгий цикл обратной связи Это не то к чему привыклиниционные 4 слишком просто но доставляет массу проблем 99 процентах случаев у вас просто нет доступа к приложению девайсу на котором крутится ваше приложение А я знаю что если клиент случится проблема вы не сможете подключиться по ssh и раскрутить все кишки gvm и это заставляет по-другому смотреть на то как мы строим телеметрию и логирование в мобильных приложениях и пятое это нестабильный агрессивная среда мобильное приложение живут в более агрессивной среде чем севернее приложение вот клиент идет по улице у него меняется тип связи он опустился в метро он включил режим экономии батареи какой-то другое приложение что-то на ее делает И все это все это нужно учитывать если мы хотим дать клиенту классный пользуется опыт А я думаю мы все ждем от приложений что они будут работать хорошо стабильно классно особенно те которые мы любим OK понятно просто взять и сырые и навести порядок тут как будто бы не получится нужны ребята сильными компетенциями в мобилки и при этом с фокусом надежность этого момента Наш бизнес был готов очень хорошо инвестировать в надежность у нас накопился большой бэк-лог задач найти его надежности и что было создать новую команду которая угадаете Как назвали Вот так и назвали надежность команда надежности команду собрали из мобильных разработчиков разбавили ее компетенции менеджер кто сам когда ты был и сыры и погнали вперед начали собираться Андроиды потому что Андроиде нас больше всего клиентов и больше всего проблем кстати вот тот сбоя котором я рассказывал Это все Был на Андроиде на йосе все было Окей но это как бы не сильно облегчает ситуацию Какие ожидания были от этой команды ожидания были следующие первым делом нужно Понятно нужно было исправить самые болезненные моменты делать прикручивать всякие свистелки на ЮА и делать getabs хорошо но нужно было что-то делать критичными проблемами связанными с надежностью самого приложения в нашем случае это было были проблемы с парсингом ответов и валидации ответов от API и учитывая масштаб который уже потом я уже рассказывал это было реально очень мощной задачей 60 команд У всех свои планы и вот это вот все это было очень мощно команда с этим справилась если сейчас вместо конфига придет MP3 файл приложение сохранит полную адекватность как будто бы так и должно быть Ну конечно нет далее команда должна была прокачать наблюдаемость обжалобились и самого приложения Об этом я чуть подробнее расскажу другом пункте И третье когда самые сильные боли были устранены базовая наблюдаемость построена команда должна была начать влиять сильно на культуру разработки мобильным приложении это было реально очень важно нисколько не менее важно чем предыдущие пункты ведь Если только ваша команда занимается наведением порядка в то время как и 60 команд которые у которых свое понимание порядка и свое понимание приоритетов вы никогда не успеете сделать порядок поэтому здесь нужны какие-то более глобальные изменения должны быть на уровне культуры и эта команда начала работать система того чтобы сеять тему надежности в школу во всех участников процесса чтобы семена прорастали уже на местах завернул конечно с аналогии но в общем для этого команда начала ходить много разных метапов про лучшие практики худшие практики делать новые инструменты о них рассказывать эта команда провела огромное количество консультаций с другими командами помогая им навести вот самый надежность и я могу сказать что это реально очень сильно повлияло это мы видим и на метриках и по вопросам и просто по общению с разработчиками это реально очень сильно повлияло на хорошую сторону из теста на культуру разработки И последнее Но на самом деле это не последняя команда должна была по-другому должна была начать создавать новые понимание надежности мобильного приложения с чем команда исправляется до сих пор с успехом Окей Что делать если я не банк и не могу на каждый чих выделять команду и тут Важно признать что в теле выделения новых команд особенно команд мобильщиков обычные работяги не так уж много могут повлиять Но вот что точно они могут сделать так это носить обратную связь до мобильной разработки Если вы знаете какой-то проблеме в мобильном приложении или вы знаете как инфраструктура может быть страдает от какой-то проблемы мобильным приложении например Вы знаете призываете что ваши мобильщики не слишком экономно используют API создавая вам повышенный РПС и тут вы можете справедливо пойти и попросить их присесть эту проблему если вы сокращение РПС то это очевидно экономия инфраструктура и денег компании и второй советник который тут могу дать делитесь своими знаниями с мобильщиками там где это уместно как я уже говорил ваши вопросы мысли мнения могут существенно расширять Кругозор мобильщиков исторически так сложилось что фонтан разработчики не слишком париться на тему Наде мы не наблюдаемости всего такого то что они склонны полагаться на то что сервер будет доступен там ребята обо всем позаботиться и к слову большинство мобильных разработчиков ориентированы изменения в UI и на работу вот только с клиентскими данными многие мобильным разработчикам просто не хватает широты взгляда подумать что за вот этим вот путем от которого он получает Джон что-то есть еще такое И это часть возникает из-за того что во многих проектах просто нет особых требований надежности мобильных приложений отсюда и не растут эти компетенции поэтому ваш Кругозор и тот еще таких северных инженеров может быть очень полезен мобильным ободчиком и Последний пункт моего доклада здесь он наблюдаемость наблюдаемость это именно то чего нам не хватило в тот момент сбоя мобильное приложение У нас не было нужных логов и метрик нам вот реально очень не хватило к слову мониторинге на стороне фронта мы тут мнение что мониторится фантай это что-то избыточное если у вас все построено сервере там мониторинг всего и вся то фронт это что-то излишнее А тем временем я хочу напомнить вам что в момент того сбоя на сервер на Северный и всей нашей инфраструктуре все работало прекрасно кубы крутились база работали одна только проблема клиенты не могут ничем этим воспользоваться потому что проблема мобильным приложении и надо сказать что в больших и сложных системах при отсутствии вот мониторинга со стороны клиента Может возникать просто банально неполная картина того что происходит Вот вы можете мониторить то как быстро отвечает какой-то ваш микросервис и он отвечает 100 миллисекунд славно но Какая в этом ценность если клиенты ждут ответы по 5 секунд из-за того что некорректно настроена система защиты от Dos и как это вы могли узнать без мониторинга страны клиента непонятно Итак что у нас там subzerobility первым делом нам нужно было выбрать платформу на которой мы будем собирать наши логи метрики стоят и вот это вот все и здесь бы мог быть длинный рассказ про то как мы выбирали сравнивали табличку нарисовал Здесь тоже там у нас были определенные требования например только логов мы планировали писать не менее 400 миллионов записей в день но Нам повезло у нас компании уже была обзорубились платформа Sage которая удовлетворяет удовлетворяет Всем нашим основным требованиям можно писать логин имеет такие С недавних пор еще и трейсы система позволяет программируется ли это со сложной логикой ну можете представить нагрузку потому что весь Тинькофф пишет туда все свои данные чтобы все это анализировать с использованием Что такое схема доставки логов стала выглядеть у нас как то так первым делом логи собираются хранятся в мобильном приложении группируются в пачке И периодически которые этот сервер вот есть какая-то работа для всего это было работа мобильный sdk которые мы интегрировали в мобильный банк к слову одной из ответственности этого языка является экономное отношение к ресурсам на телефоне клиентов нашей логине весили по 500 мегабайт на телефоне клиента Просто я думаю что последнее что мы хотим ходить на телефоне у себя этологи мобильного приложения чего-то дальше данные уходят на микросервис логов который проводит валидацию угощение данными и дальше данный падает во входную кафку системы сейдж откуда вычитываются и попадает набор кластеров эластик Сочи сами инженеры работают с данными в основном через интерфейсы вот здесь центре нарисован это Мэйдж это язык запросов собственной разработки если это работает со с планком то до его ухода из России то в общем очень похож на сплавок встречи плагином и собственный веб-интерфейс в котором можно писать сыры данные агрегировать в общем такая удобная штука и схема выглядит довольно просто и кто-то может быть скажет все взяла бились платформы они выглядят Примерно вот так но просто Эта система выглядит только на моем слайде на самом деле Чтобы вывести нагрузку 7 петабайт власти коллегам пришлось очень серьезно заморочиться и вот кстати во всем этом очень хорошо сказал Мой коллега Роман Николаев на последнем хелоде qr-код ведет на статью на Хаба где расшифровка его доклада вот с последнего highload к слову Его доклад попал в топ 5 докладов поэтому можете почитать будет наверное очень интересно Окей собравшись платформу можно сказать о том что именно мы сделали для прокачки наблюдаемости первым делом мы реализовали ошибки парсинга мобильного приложения надо сказать что парсить у нас есть много чего мобильный банк интегрирован с более чем тремя десятками различных афишек сиденов В общем там полно всего как правило ошибки парсинга связаны с тем что кто-то нарушает контракты в идеальном мире этого не происходит но я думаю все прекрасно Понимаете вот как-то так выглядит ошибки парсинга у нас графания слева можно видеть что какой-то запрос на стабильно не парься к слову направо мы видим всплеск проблемы с парсингом каких-то конфигов и сразу же сошел нет потому что видимо нашли проблему и быстро разобрались когда что-то такое происходит Мы теперь получаем вот такие вот алептики в которых сразу видно в какую модель что мы пытаемся распарсить Какое поле Мы искали Какая ошибка случилось ниже какой именно запрос с Edge нам может показать детально что там было И вот знаете вот такие Балет Вот сбой нам больше пригодились как бы они нам пригодились как бы они сократили бы всю эту историю в разы наверное Но их не было тот момент и надо говорится что следующая что появление следующей методики которые вот сейчас буду говорить оно не связано напрямую с этим сбоем но было логичным продолжением улучшение наблюдаемости нашего мобильном приложении так вот мы внедрили Red метрики для запросов которые уходят из мобильного банка на всякий случай напомню Что такое red red этот метод мониторинга определяющий три базовых метрики работы сети случае там все Типи Это количество запросов количество ошибок и время выполнения запросов это такая хорошая точка Для построения мониторинга когда его еще нет В общем такая полезная штука так вот после открытия метриками вот когда так стали выглядеть наши метрики по каждому хосту и вызываем методу из мобильного приложения можем посмотреть поток запросов ошибок тайминги по разным 30 или мы в целом Я не собирался удивлять и это вполне типичная история для мониторинга северных приложений Но для мобильных я вам скажу это не что-то само собой разумеющееся потому что эти данные строятся по данным с телефонов клиентов Это очень важно и одной из особенностей этой истории для мобилки в том что вас реально много хостов много методов которым мы дергаем и этом как вы знаете если работали с прометеосами всякими Виктория метриками то знаете что Тема кардинальности это важная серьезная тема если сотнями тысячами волов мы бы как совладали даже больше бы совладали то что нам делать вот с такими запросами в которых уникальный стакан находится прямо в пути OK для таких валов можно что-то придумать естественно ее отрезать чтобы не взорвать кардинальность Но что нам делать в такой ситуации когда уже два элемента в пути и если коллеги проектировали вот такое следовало ожидать что не обращаются каким-то ресурсом Что вы делаете такой ситуации чтобы взорвать кардинальность даже такой случай можно было бы как-то обработать но пахнет тем что нас куча разных афишек только в рандомном месте может быть Вот что-то такое Если мы с этим всем пойдем в пород то мы взорвем к чертям всю кардинальность наших и Виктория меток поэтому настало время нейронных сетей Мы в качестве решения все проблемы разработали небольшую нейронку которая которым тренировали на выявление динамических параметров и у нас итоговая система работает периодически специально джоба на себя и собирает логи по этой системе Sage собирает уникальный список такой набор блоков и дальше она прогонять набор логов через эту самую нейронку через модель которая подсказывает в каком элементе пути С какой вероятностью находится динамический элемент далее этот заменяет динамические параметры на такую динамик паром статическую и делать мерч квест специальный репозиторий в котором хранятся белый список наших меток только тех которые мы хотим видеть нашим приложении благодаря замене динамики на одну строку мы драматически снижаем кардинальность этих метрик данное из этого репозитория забираются к мобильного банка таким образом когда сборка приложения имеет свой уникальный свежий белый список углов по которым мы хотим получать метрик метрики и никакого взрыва кардинальности Одним из главных методик мобильного приложения является кашрейт и айнарейт это просто я должен была у них сказать говоря о надежности положения это об этом Просто нельзя не сказать каша это то как часто ваше приложение крашится а ener Raid то как часто ваше приложение зависает а иногда Application not responding когда система мобильный говорит что ты не отвечаешь на ввод пользователя или на какие-то фоновые там проверки Продолжение по ходу твое зависло и отслеживания этого мы используем AP центр на Android и о чем я здесь больше всего хотел сказать о том что значительный буст в улучшении этих метрик мы получили тогда когда мы настроили процесс дежурств по этим метрикам и много из этого можно автоматизировать мы на пути к этому я хотел сказать сейчас мы составили график и каждый день каждый есть инженер который отвечает за то чтобы смотреть за этим метриками если какая-то проблема случилась всю задачу носить ответственным и трясти с них все что нужно трясти для того чтобы задача была исправлена потому что я помню 60 команд одна команда не должна за всеми 60 исправлять хороши у этих команд есть И вот когда процесс стал построен по процессу типичного все стало все пошло в гору в этих метриках а важном направлением в работе надо наблюдаемостью является еще и логирование и вот дальше немножко о нем не мне вам рассказывать о том когда нужны логи И зачем вообще не нужны у нас мобильный банк Есть два вида логов онлайн логи и он демонтлоги сначала расскажу про онлайн логин онлайн-логия этологи которые отправляются по ходу жизни приложения там находится Техническая информация которая не легла в метрике там никогда никаких обстоятельствах не должно оказаться каких-то физических данных или чего такого касательно схему может сильно вглядываться и просто залипать оставил Так что вот так эти логи отправляются плюс-минус сразу это событие случилось естественно не сразу они там подкапливаются но доходит плюс-минус довольно быстро сначала пишется локальный по таймеру отправляется к нам из-за того что многие пишутся сразу наши инфраструктуру К сожалению мы не можем подписаться слишком много потому что просто очень дорого хранить такое дикий объем и к слову эти логи бывают часто просто не нужны А тем не менее пишется они нужны когда клиент обратился или случилось проблема а вот если она не случилось то считается логи лежат просто зря заранее никто проблем уже не предупреждает поэтому остаются но зато их можно сразу посмотреть но Подумайте что делать в таком случае если нам нужно очень хорошо залогировать какую-то проблему вот прям глубоко и залогировать и Тут приходит на сцену он Диман логи он логи хранятся только на телефоне клиента и просто так никуда не отправляется за счет этого мы можем их писать сложный подробностью Ни в чем себе не отказывать и писать их действительно много но все равно экономно потому что опять повторюсь никому не хочется обнаружить у себя там 100 мегабайт слогов от какого-то банковского приложения и самая фишка этих логов в том что логики появляются только тогда когда клиенту приходит специальный флаг клиентом обращается в поддержку или мы знаем какой-то проблеме исследуем мы вешаем эти флаг клиента и При следующем запуске мобильное приложение соберет все Локи с мобильного приложения и вытеснит отдаст его нам Таким образом мы остались из подробными блогами и не взорвали нашу инфраструктуру от огромного количества этих данных Окей будут Молодцы А что мы делать со всей этой информацией и вот первое что можно сделать Зайдите к своим мобильщикам и узнаете Как у вас мониторится мобильное приложение если вообще как-то мониторится если вы знаете увидели как это спокойно накидываете Если вы видите что что-то важное упущено потому что опять повторюсь ваш Кругозор может быть намного более широким чем Кругозор мобильщиков этой теме и особенно если какой-то мониторинг мобильщиков есть знаете как устроен процесс реагирования инциденты и тут этим полезным будет с двух сторон во-первых ваш опыт настройки процесса дежурств и реагирования может быть очень полезен коллегам я вот рассказывал про наш процесс дежурств Но что там было такого невероятного Да ничего то что для сырые сейчас является просто нормой там второй телефон процесс эскалации там наличие запасного дежурного и все такое вот момент был чем-то таким новым и полезным ваших мобильщиков и информации тоже будет полезна и вторая использует для вас в том что вы будете знать как у них там все устроено с джустами Если вдруг у вас возникнет необходимость потом подключить этого дежурного вы уже будете с этой темой погреты и будете знать как этого человека найти и привлечь к джосту резюмируя не резюмируя 2 здесь еще важный советник такой если какой-то мониторинг мобилки уже есть то Подумайте какие из существующих могут быть полезны именно вам в работе в ваших систем например Для более раннего обнаружения сбоя или для подтверждения наличия какого-то сбоя для второго метрики очень полезны одно дело когда он развалился какой-то кластер и вы понимаете какие-то вот соседние системы как это повлияло и согласитесь совсем по-другому проблемы когда оказывается кластер еще выстреливает на клиентах в их мобильных приложениях и вот эта информация может позволить вам лучше приоритизировать ваши активности Ведь вы будете знать что Ой а это система там через несколько шагов влияет по-настоящему на клиентов и еще одна неочевидная польза а этих данных в том что зная всю эту информацию вы можете ввести более конструктивный диалог с руководством например дополнительных каких-то ресурсах Потому что когда есть запросные ресурсы когда есть реальные данные о том как это стреляет На клиентов Это уже предметный разговор Вполне себе хороший и третье если мобильщиков совсем нет ресурсов на все что там сказал или там что вы считаете нужным сосредоточите их внимание на крышах и Анны хотя бы вот это это уже будет очень хорошо потому что наверное это одно из самых худших Что может случиться с мобильным приложением когда оно падает или намертво зависает потому что это рушит весь пользовательский опыт резюмируя то о чем я говорил Я сказал о том как мы построили процесс управления конфигами и поделился советиками сухой остаток который был в том что нужно пристальнее даже просто попросить пристальное внимание на критичные ресурсы вашего мобильного приложения далее я рассказал о том как вы перепридумали поведение мобильного приложения при сбоях И насоветовал вам определить то как приложение должно вести себя вас и определить Я предлагал в двух смыслах определить понять как есть и определить решить как теперь должно быть часть этого доклада была про то как мы выделили отдельную команду надежности и тот момент я советовал вам доносить обратную связь до ваших мобильщиков и в последнем разделе рассказал о том как именно мы прокачивали наблюдаемость мобильного приложения где предложил вам вникнуть в мониторинг мобилки как там все устроено и обогатить его своим опытом последние слова обогатить своим опытом это то что я хотел бы запечатлеть как важную мысль этого докла Да потому что ваш опыт инженеров которые занимаются базами данных серверами сетями виртуалками чем-то там еще может быть реально полезен такой Казалось бы далекой области как мобильная разработка на этом У меня все спасибо за внимание Да спасибо огромнейшая за доклад Лично мне очень сильно понравилось мне много вопросов Конечно кого-то есть вопросы по докладу кто-то хочет что-то узнать уточнить человек одним ряду Спасибо Привет подробнее рассказать о том как нам Application поможет как мы его можем практически использовать именно само предложение не влияет ты имеешь ввиду как вот с точки зрения инженера который не занимается мобилкой или все-таки углубляясь мобилку которая не занимается мобилкой то есть вот ну я могу какие-то метрики там собирать Но я могу попросить например данные присылать но я не могу влиять на разработку приложения понял понял ну если совсем не влиять то можно найти воздыхать Ну и пожалуй все вот но если все-таки есть какой-то инструмент влияниями хотя бы кому не на уровне коммуникации с коллегами кто этим занимаются то можно приоритизировать если какие-то энергии происходит можно говорить ребята ну вот такой вот очень много чего там происходит и к слову если в команде есть компетенции там ну с точки зрения программирования то в постегрейсу и по ошибке можно какие-то первичные выводы сложить и если есть доступ к коду мобильного приложения то как бы обладая базовый такой способностью читать код не является специалистом можно сложить какие-то гипотезы например о том что если у нас происходит что это приложение и ты видишь мы видим что в приложении выполняется какой-то запрос и это очень странно что выполняет запрос у вас приложение зависает И это Может начать что запуск на главном потоке А за это как бы можно замечание сделать коллегам и в общем здесь я думаю помощь может быть в том чтобы генерить гипотезы Если есть возможность читать код и оказывается какого-то рода такое моральное давление что вы этим занимаетесь много там 10-20 но Представьте вас там тысячи клиентов вас 5000 nr Но это явно где-то какой-то проблеме может быть строили какую-то корреляцию увеличивается количество энергии вот такие видите проблемы честно говоря нет но это связано с большей больше степени с тем что мобильный банк Тиньков Это как Какое зрелое приложение очень зрело и все какие-то самые болючие случаи они были устранены давно давно а то что новый появляется оно там не успевает разрастить потому что устраняется поэтому поэтому нет в нашем случае Нет но я верю думаю так что в каких-то случаях приложение менее зрелые когда они 60 команд то это может быть какие-то там полезные штуки из этого Да я снова войду в кадр ребят нас время закончилось на доклад Так что давайте еще раз Скажем Огромное спасибо даниэлю и если у кого-то Еще есть вопрос или хочется что-то обсудить то просим Вас пройти в дискуссионную зону вот мы через некоторое время подойдем"
}