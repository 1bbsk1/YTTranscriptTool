{
  "video_id": "Vt4BE3-El8k",
  "channel": "DevOops_conf",
  "title": "Константин Новаковский (G-Core Labs) — Устойчивость DNS и DNS-как-код",
  "views": 298,
  "duration": 956,
  "published": "2022-02-02T01:25:22-08:00",
  "text": "следующий наш спикер константин маковский из декор labs и он выступит с докладом устойчивый с dns и донецка код константина системный инженер hidden декор labs команде dns марта 2020 года расскажу пару слов про его доклад чтобы устройство конечного пользователя смогло подключиться к серверу вашего проекта ему нужно знаете и адрес этого сервера а может быть даже ни одного это преобразование выполняется с помощью системы доменных имен и в рамках этого доклада мы посмотрим на возможные точки отказа доменных зон и вспомним один из ярких примеров массовой не доступности сервисов последних лет давайте поприветствуем константина привет сегодня я напомню как работает системы доменных имен dns можно это укажем возможные точки отказа покажу напомню что бывает если один хостинг-провайдер ломается и расскажу как индустрия ответила подобного рода проблемы меня зовут константин маковский системный инженер компании labs я занимаюсь дома из подразделений сидел-сидел можно сказать что в среднем время ответа наших серверов то 30 секунд по всему миру в отдельных регионах например оси это 16 миллисекунд на большое количество точки присутствия в топе по пеленгу среди различных провайдеров собственном ему реально быстро и приходите проверяйте в том числе и поверх tanks of инфраструктуру мы представляем dns хвостик собственно продан с я вам не собираюсь сегодня рассказать для начала как я обещал вспомним как система доменных имен работать собственно для того чтобы браузеру или как явный представитель стива приложение не обязательно браузер может какое-то другое приложение например игровое да игра чтобы установить как правило чтобы установить соединение с сервером узнать ip адрес чтобы узнать о 5 есть так называем как телефонная книга интернета система доменных имен на самом деле начали есть конечно еще системы как правило там особенно при холодном запуске приложение там ничего нет браузер выполняет запрос к dns-серверу пользователя который прописано системе пользователя как правило то домашний роутер у домашнего роутера указан он получает повторить адрес авторитетного рекурсивного кашляющий данные сервера оператора связи собственно запрос пар идет этом курсе вы наверное серверу с кэшем при холодном запросит в каше ничего нет и чтобы узнать рекурсивно сервер должен выполнить рекурсивный так собственно почему рекурсивные запросы по иерархии напомню что dns это иерархическая база данных можно рассматривать именно так если в кише ничего нет то рекурсивный каширу сели на серфе делать запрос первую очередь корням и в 13 адресов если взять эти четыре превышать протокол того 6 адресов за этими 26 адресами на самом деле для избыточности также намного больше точек присутствия то есть реально этом это больше суммарно больше 600 точек присутствия эта система очень сильный серьезно зарезервируем то есть адреса карни выделенный сервер потому что если в каше ничего нет то первый запрос идет туда все это очень мощная инфраструктуры ну и корнева еды на серверы . который обычно не указывают не знают запрашиваем имени но она знает кого можно спросить дальше да то есть по иерархии я отвечает списком авторитетный dns серверов для той зоны которые знают то есть ходи тут спросил того до рекурсивно для не серые делает запросы по полученному списку как правило люди тоже неизвестно хотя там на самом деле могут быть api адреса да так называемый гуру записи по всему можете его регистратор указать также еще api адреса авторитетных серверов для обслуживаемой зоне если адресованы совпадает с адресом авторитетного сервер тогда вы упираетесь доступность знакома относительно недавно около месяца или двух назад пример какое-то время мы полностью не доступен были недоступны авторитетные dns-серверы зону . club идут club рекурсивные прямой сервер получает записи уже непосредственно выходим провайдер который обслуживает изначально запрошены имя авторитету топтали сервер отвечает адресом и в этот момент уже а браузер ну конечно то есть наше приложение наконец-то получает адрес и может ответить установить соединение с этим веб-сервером собственное так какие нюансы каких местах может произойти проблемы и что влияет на время вот этого рекурсивного зарезал в первую очередь конечно кажд отель то есть отелем записи мы можем управлять чем меньше время тем быстрее может произойти файлов да то есть например у нас как в нашем случае большое количество точек присутствия вероятность того что где-то что-то ломается достаточно велика и для того чтобы сидим продолжал оставаться быстро мы всегда работал нам важно чтобы запись связали быстро поэтому используем в 60 секунд соответственно чтобы это приводит к тому что кошерные сервировка правил и не находится наших записей поэтому сколько мы сидим на почту . присутствия мы делаем так чтобы курсивный каширу ющие серверы могли быстро выполнить ту самые рекурсия которые только что рассмотрели чтобы сделать авторитетным ты серверы близко до применяются различные технологии том числе этих многие основное это и не каст там задействуется все эти девушки зации автономные сети об этом мы сегодня говорить не будем эту проблему можно решить немножечко другим способом какая проблема я сейчас опишу до октябре 2016 года дам детекторе не только в америке год сократился сохранился только такой скриншот по всему миру выглядело как будто dns перестал работать на dns группу the internet сломался он перестал работать интернет на дом детектор открывался потому что в качестве хостинг-провайдер использовал нидан днс dns в свое время стал популярным сервисом и набрал большую массу пользователь за счет того то чтобы предоставлял бесплатные имена для динамического бесплатные под именно для динамического прописывания пи адрес оф в домашних роутер собственно как я узнала об этом мне перестал открываться кит хоп я подумал так много узнать почему не работают хоп пойду спрошу об этом twitter по еще в твиттере мутатор у меня тоже не открывался собственно чтобы узнать почему не работает twitter я пошел на реддит но тоже не он не открывался и я не смог написать коллегам флаг об этом потому что slug тоже не открывался да если работа встала то и видео феликс тоже не работал чтобы как-то скрасить горечь собственно все это произошло из-за массивной серьезным дадутся таки авторитетные сервера и хостинг провайдеры д н д м с то есть сервер на самом деле отвечали на отвечали больше чем в среднем время это было больше четырех секунд то есть это такое прям выше всех возможных часто обычно используемых таймаутов собственно что индустрия в частности детка пришли с этими сделать они пошли очень простым путем резервирования как всегда то то есть избыточность если он сломается один кастинг провайдер добавьте добавить давайте возьмем еще одну хостинг-провайдеры и на него том числе делегируем нашу зону для того чтобы сохранить записи о нем как это выглядит в представленной выше схеме что что меняется да наш авторитет на рекурсии dns сервер будет никогда мог хостинг провайдеру как 2 собственно чтобы синхронизировать записью и как написали till i take the dns который в качестве источника записей может использоваться некоторый провайдер на то есть качестве базового провайдер используются яму файлы что позволяет применить парадигму метод поиска код то есть мы храним записи в детей что-то меняем в детей сыном запуская применение кто dns и записи расходятся для других провайдеров которые мы прописали в конфе собственно провайдеров достаточно легко добавить ну сама утилиту кто думаю с написано гитхаба поддерживается гитхаба я не управляет хоп проводить свои инфраструктуру им данные с помощью этой утилиты давайте рассмотрим как выглядит конфиг конфиг выглядит достаточно просто то есть это провайдеры ямал провайдер то есть файл то это точно также как отдельно подключаемый провайдер у конфигурация в случае какого-то хостинга какой-то секретный talking так вот выглядит писание записей да например и мы к запись а запись так выглядит несколько а записи то есть описание так называемого 1р сета да то есть это одно имя и тип и для них несколько записей если это одно значение то это массив список записи а просто запись и так да то есть с конфиге мы прописываем ямал провайдера и указываем что его в качестве источника и что хотим записать эти записи для конкретного провайдер технология может использоваться в качестве соуса может использоваться нияма файл на какой-то любой другой провайдер да то есть можно переносить записи туда мой провайдер к другому провайдеру если например не поддерживает репликацию mx стандартную думаю с репликацию excel excel запрос перенос записи зон ну и конечно фокус тот самый который применяет хоп то не только get капает из плит authority когда мы делегируем записи в качестве источника у нас яму файлики в качестве получателя указываем несколько провайдеров и загружаем сколько провайдеров дальше в регистратора прописываем авторитетные сервера который выдал нам этот провайдер есть еще другой фокус как перезапись то есть мы получаем записи из одного одного провайдера подмешиваем туда данные снимала и загружаем 3 провайдер мы применяем примерно по такой схеме кто-то нас то есть мы в качестве источника записи мы берем индекс то есть и памм сервис в котором хранится информация о сетях серверов серверов очень много станут напомним 120 больше 120 точек по всему миру на туда подмешивается данные из я мало и это загружается как в нашем в наш хостинг и в резерве и на всякий случай формируются хост файлы чтобы отдельные сервисы мы продолжать работать независимо собственно как использовать короткая памятка до установка с помощью стандартного петровского менеджера пакетов пип проверяем конфиг запускаем тест были который выдает нам план и чтобы применить изменения загрузить в сервис провайдеры добавляем флаг дай есть еще дополнительные интересные утилитки это report то есть вы можете просить данный сервер на наличие записей можете как раз так называемый bootstrap на и можно так называть это когда мы из хостинг-провайдеры получаем формируем я им файл и можно проверить записи в двух хостинг-провайдеров нас что они совпадают пример вывода есть еще альтернативы для не одни мы тогда и но сам там не один есть альтернатива на голландии тасс так и кончая причем dns telit одна из control причем она может в качестве источника применять то же самое кто дома с от как расширении есть потом утилита лексикона работ только с одним провайдером есть старые утилиты ныне мы поддерживаем вот flex написано на джаве там очень мало количество проектов который мне поддерживать не получила утилита распространение прощу ваше внимание на утилита то французского агентство функционального информационной безопасности которая может для вашего домена и не выдать точки отказа помимо непосредственно дуная samen она выдает сообщение о том то что какие то есть проблемы могут быть проблемы в адресах анонсируем провести префиксов сетей автономных системах то есть тут не если пойти глубже но основная проблема доступности хостинг-провайдер решается в tdms дальше уже проблемы решаются более сетевые то есть поддон с есть пдп собственно спасибо за внимание сдавать вопросам между вопросов"
}