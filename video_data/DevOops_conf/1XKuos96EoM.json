{
  "video_id": "1XKuos96EoM",
  "channel": "DevOops_conf",
  "title": "Анна Лучник — Back to Basics. Сертификаты, TLS и взаимная аутентификация сервисов",
  "views": 736,
  "duration": 2784,
  "published": "2025-01-24T04:20:00-08:00",
  "text": "Всем добрый день всем тем кто пришёл послушать меня Сергея Беркова и мою коллегу у Сегодня мы будем рассказывать вам о том как устроена сертификации и взаимная аутентификация сервисов этот доклад является базовым он не зря имеет название Basic с точки зрения своего личного опыта э с полезен для инженеров которые занимаются Как так и инфраструктурой потому что Тема ЛС сертификатов того как устроить безопасное соединение между сервисами это крайне сложная тема которую множество людей поднимала как и до нас так и будет поднимать после на поэтому наверно на этом Нате закончу и передаю слово своей коллеге А спасибо большое за представление Давайте пару слов обо мне Я 7 лет работала в подразделении Microsoft консалтинга и в том числе там занималась удостоверяющими центрами и развёртывания иерархии удостоверяющих центров и настройкой сертификатов для больших корпораций и даже для некоторых проектов в рамках сервисов И после этого я работала в холдинге где тоже была необходимость разворачивать различные сервисы которые использовали сертификаты Давайте не будем терять времени и перейдём к теме Несмотря на то что это Back to basics Мне было очень сложно уложиться в Там те 30-40 минут которые есть на доклад и пришлось очень серьёзно резать то что есть о чём мы сегодня поговорим поговорим о том что такое сертификат какой у него есть формат на какие атрибуты сертификата важно обращать внимание поговорим о том как проверить подлинность сертификата чуть-чуть поговорим про основы криптографии которые необходимы для понимания работы сертификатов и будем много говорить о tls и TS то есть о взаимной аутентификации с использованием т и чтобы была практическая польза поговорим про ошибки при настройке сертификатов и о том как их можно избежать начну я с небольшой провокации если мы посмотрим на графики которые показывают сколько у нас было http и https трафика то мы видим что начиная с 2014 года произошёл довольно серьёзный рост https трафика и трафик который там фиксируется например там Гуглом что там 95 про всех соединений они были на базе https соответственно вопрос почему у нас в какой-то момент произошёл такой рост защищённого трафика Мне бы конечно хотелось очень чтобы это было связано с информационной безопасностью но как показывает практика то на самом деле https повышает се то есть инициатором вообще повсеместного использования довольно Давно был Google и сайтам который использовали защищённые соединения давался более высокий рейтинг в поисковой выдаче и начиная с 2018 года сайты которые не использовали защищённое соединения они начали помечать как небезопасные в браузере Chrome поэтому по сути Google за счёт оптимизации повышения выдачи был триггером который привёл к повсеместному использованию https но это не главное зачем всё-таки мы используем https А у нас есть три вещи которые с помощью https обеспечиваются это аутентификация шифрование и контроль целостности если говорить про https то это по сути http плюс защищённое защищённый протокол Т про кото Мы в общем-то большую часть сегодняшнего доклада и будем говорить на месте здесь может стоять большое количество разных протоколов это может быть FTP аналогичная ситуация да то есть это просто протокол который будет работать поверх защищенного протокола тлс Но даже более того ТС на самом деле это не один протокол это набор из нескольких протоколов и какие-то из них более на слуху какие-то менее то есть наверно то что чаще всего вы слышали этой проко яю с многоэтапный установкой соединения И даже я сегодня их ещ покажу Если вдруг и кто-то не видел то есть с чего всё начинается что нам необходимо установить защищённое соединение для того чтобы защищенное соединение установить нам надо договориться Как именно мы его будем устанавливать какой мы алгоритм шифрования будем использовать Каким образом мы сгенерирует на эта соединения после этого уже установлено непосредственно защищённое соединение весь трафик шифруется это мы переходим к рекорд протоколу и на случай каких-то непредвиденных обстоятельств У нас есть сигнальный протокол которые может отправлять оповещение что касается установки соединения то это как раз тот этап на котором мы можем и используем сертификаты основная идея В чём что в разных версиях тлс протокола У нас есть разные этапы установки Вот А главное что нужно понимать что любое соединение начинается с хендшейка то есть с установки защищённого соединения И в зависимости от версии Оно занимает разное количество времени опять же что касается версии то наверное основные версии которые сейчас можно встретить это TS 1.2 и 1.3 которые Ну опять же встречаются до сих пор Даже те есть и устаревшая версия но они естественно не рекомендуются к использованию что касается соединение да то мы часто говорим про Т соединение но про СС сертификат Что такое с сертификат это термин который устарел 10 лет назад то есть 10 лет назад по стандарту сказали что ssl использовать не надо это Уста проко и Давайте использовать норим исковую выдачу Гугла то у нас в там три-четыре раза чаще встречается термин ssl сертификат и реже встречается тлс то есть по сути это одно и тоже ssl - это предыдущая версия но к сожалению люди привыкли к названию ssl и поэтому ще довольно часто можно услышать что мы используем SS сертификат для установки ТС соединения что же такое сертификат Есть несколько вариантов Да как на это смотреть один вариант Что такое сертификат а другой вариант Что такое сертификат основное что надо понимать что сертификат - это просто файл который может быть в разных форматах и в разных кодировках главное что он содержит это открытый ключ и информацию о том кому этот открытый ключ принадлежит соответственно здесь чуть-чуть я уйду в криптографию просто напомнить что у нас есть симметричные и асимметричные алгоритмы если мы говорим про симметричный алгоритм это тот алгоритм который используется для шифрования в большинстве случаев симметричные алгоритмы они работают быстро они бывают блочные они бывают поточные и по сути всё шифрование данных на дисках либо данных которые передаётся по интернету оно шифруется симметрично ключом А если говорить про шифрование симметричная то это можно сравнить Я не знаю там с архивом с паролем там либо с сейфом у которого есть пин-код и соответственно всё работает понятно и привычно мы взяли что-то в се положили закрыли задали пин вот если мы хотим данны расшифровать или извлечь сейф нам надо ввести пин сложности возникают тогда когда у нас отправитель и получатель зашифрованных данных находится на разных концах света и в этом случае если у нас нету защищённого канала мы не можем передать ключ шифрования мы не можем там передать пин которым мы закрыли сей и возникает проблема что у нас есть зашифрованные данные но если мы по тому же каналу по которому передали зашифрованные данные передаём и ключ шифрования то шифрование становится бессмысленным потому что злоумышленник может перехватить И то и другое сообщение расшифровать И для этого соответственно появились асимметричные алгоритмы которые позволяют использовать один ключ для шифрования другой ключ для расшифрования и здесь идея в том что если я хочу кому-то отправить сообщение то я отправляю сообщение зашифрованное открытым общеизвестным ключом и расшифровать его может только тот у кого есть закрытый ключ опять же всё хорошо работает в теории на практике возникает проблема что нам надо понять где взять ключ которым шифровать И для этого появились сертификаты то есть по сути сертификат - это дополнительная информация которая привязана к открытому ключу которая говорит кому этот ключ принадлежит и здесь вы как раз можете видеть что то есть если мы говорим в данном случае про с сертификаты то название Сата с тем сертификатом кото используется для установки защищенного соединения соответственно провокационный вопрос практически всегда Да когда мы видим H соединение защищенное У нас есть замочек мы на нём можем посмотреть на сертификат который там есть вот вопрос Нужен смотрим на стандарт то в общем-то нет У нас есть разные способы установки защищенного соединения которое сертификат не требует То есть когда мы говорим про https то в данном случае у нас сертификат используется только для аутентификации Но для того чтобы установить защищенное соединение и шифровать весь трафик нам сертификат использовать не обязательно То есть в принципе смотрим на оригинал стандарта то мы увидим что на каждом этапе установки соединения у нас предоставление сертификата является опционально штукой то есть сертификат в первую очередь нужен для того чтобы антифитнес Да что если у нас для того чтобы зашифровать соединение между клиентом и сервером не нужен сертификат то что может использоваться есть различные варианты обмена ключами то есть ранние версии протокола поддерживали даже прит то есть предварительно разделённый ключ когда у клиента и у сервера была одна и та же строка которую они используют для установки защищённого соединения но в чём проблема с таким способом установки соединения то что мы берм и абсолютно все сообщения между клиентом и серро с помощью одного и того же ключа и в этом есть определённая сложность То есть если есть злоумышленник который берёт и записывает весь трафик который идёт между клиентом и сервером если он имеет много времени на его расшифровку и ему неважно Когда именно он расшифруешь криптографии и развития мощностей вычислительных то те алгоритмы которые там были надёжны условно там лет 40 назад то теперь там за несколько десятков тысяч долларов Мы можем взять и расшифровать данные которые были зашифрованы с помощью старых алгоритмов шифрования либо ненадёжных длин ключей поэтому использование предварительно разделённого ключа котором шифруется весь трафик это не рекомендованные вариант и чаще всего используется обмен ключами с помощью алгоритма Димана я на самом деле Обожаю этот алгоритм да то есть есть его математическое описание но мне очень нравится иллюстрация с помощью красок то есть в чём основная идея У нас есть Клиенты сервер которые хотят установить зашифрованное защищённое соединение Чтобы это сделать им надо обменяться по открытому каналу ключом с помощью которого они будут это соединение шифровать то есть опять же я напомню для того чтобы зашифровать соединение Нам нужен симметричный алгоритм потому что он работает быстро и позволяет передавать трафик там видео трафик видеоконференции и так далее и успевать зашифровать и расшифровать трафик на той скорости на которую у нас передаются данные если мы будем использовать асимметричную криптографию для этого то мы про нем прик передавать Передать в зашифрованном виде зашифровать и расшифровать соответствующей скорость Поэтому нам надо согласовать ключ для симметричного шифрования по открытому каналу который у нас пока не защищен и довольно часто используемый вариант это алгоритм который позволяет У нас есть какое-то общая информация о том как мы будем устанавливать соединение То есть у нас есть в данном случае на картинке это краски потому что они на мой взгляд выглядят намного нагляднее вот в случае практическом Да это просто большие числа к которым применяются математические операции То есть у нас есть одинаковая краска либо одинаковое число и есть секретная краска либо секретное число которая никогда не передаётся с клиента сервера Оно всегда остаётся там где было получено дальше Соответственно что делается на стороне сервера смешивается общая краска и секретная либо соответственно с помощью математических операций это происходит для чисел и полученная смесь отправляется в другую сторону соответственно в данном случае происходит это на той и другой стороне и происходит обмен вот этими двумя смесями после после этого в смесь полученная от другой стороны добавляется секретный компонент который был на стороне получателя и получается единая смесь Да которая может использоваться для шифрования то есть Ну либо это соответственно единое одинаковое число которое может использоваться как ключ шифрование что касается алгоритмов да то если мы посмотрим на любое соединение То есть если вы в например перейдёте в режим разработчика то там можно увидеть какой алгоритм генерации ключа шифрования и контроля целостности у нас использовался То есть если мы посмотрим на любой сайт для которого установ соединение то мы можем увидеть дополнительную информацию о том како именно установлено и какие алгоритмы использовались для этого что важно понимать Я просто ещ раз это подчеркну что сертификат у нас был использован мог быть использован да Для того чтобы сгенерировать симметричный ключ и использовать этот симметричный ключ шифрования сертификат мог быть использован для аутентификации Но когда у нас идт шифрование трафика между клиентом и сервером в данном случае сертифика никак не используется и соответственно в зависимости от того какой алгоритм для генерация симметричного ключа был использовано мы можем увидеть Был ли это про который рассказывал на примере с красками либо это был сертификат при этом что ещё Интересно что если посмотреть на те алгоритмы генерации ключа которые используется то можно заметить что Будущее уже наступило То есть у нас некоторые сайты для генерации ключа шифрования используют пост квантовую криптографию у нас ещё нет квантовых компьютеров Да которые бы могли потенциально взламывать традиционную криптографию но у нас уже есть и используется пост квантовые алгоритмы которые используются для генерации ключей почему это важно и почему как бы я на этом делаю акцент с одной стороны просто интересно да что квантовых компьютеров нет а посткризисный скорее всего уже после того как она будет неактуальна или станет публично но если мы передаём в зашифрованном виде какую-то информацию которая актуальна в течение длительного времени то злоумышленник может просто писать все данные и потом когда появится новые алгоритмы либо новые сервера либо либо квантовый компьютеры он может взять и извлечь всю эту информацию опять же мы тут шутили с ребятами что Казалось бы Например если у нас есть интернет-магазин где есть данные кредитной карты Да и вроде информацию эту надо хранить с учётом срока действия карты да то есть нам важно чтобы номер карты там cvv код не были известно злоумышленнику пока карта действует но мы вспоминаем Да что многие банки сейчас в России отменили сроки действия карт и то есть карты которые казалось был были закончить свой срок действия они продолжают действовать сечас и действуют бесконечно То есть получается что интернет-магазину который принимает платежи и принимает данные карты важно Вот эту информацию таким образом защитить чтобы злоумышленник в течение неизвестного бесконечного срока не мог оттуда получить данные кредитные карты и самостоятельно их использовать что касается одно tls или взаимная аутентификация то про что я говорила для этого в основном относилось к веб-сайтам к которым ходят пользователи при этом будь то магазин поисковик или даже социальная сеть то по сути у нас на уровне ТЛ не происходит аутентификация пользователя то есть пользователь просто проверяет сервер к которому он подключается но в рамках установки соединения он никак себя не идентифицирует при этом аутентификация происходит Дальше уже с помощью абсолютно других алгоритмов либо там какого-нибудь аус либо что-нибудь ещё но важно что когда мы переходим в внутрь компании в корпоративную среду а то там у нас получается что у нас есть огромное количество сервисов Особенно это там в рамках микросервисной архитектуры опять же там если мы берём Как пример магазин Да у нас там есть отдельно информация по корзине личному кабинету складу остаткам чему угодно и между ними идёт взаимодействие при этом между этими сервисами могут передаваться чувствительные данные которые мы хотим зашифровать и с другой стороны мы опять же хотим быть уверены что эти данные мы отправляем именно на тот сервис для которого эта информация предназначается то есть мы случайно не отправим эту информацию ш поэтому когда мы говорим про коммуникации Особенно между сервисами особенно в рамках там микросервисной архитектуры то мы используем взаимную аутентификацию на следующей неделе Когда будет оффлайн часть конференции Да я там буду подробнее рассказывать именно про использование сертификатов в контейнерных средах здесь я просто концептуально говорю о том почему это важно И зачем это нужно опять же есть разные рекомендации А если мы посмотрим то сейчас очень модная тема - это Zero Trust либо нулевое Доверие то есть мы говорим о том что мы не ждём момента когда компанию взломают А мы исходим с предположения о том что уже во внутренней корпоративной сети может находиться злоумышленник То есть это может быть как внутренний инсайдер то есть человек работающий в компании который за деньги либо ещё благодаря какой-то мотивации Да там попытается информацию с компании там извлечь и скомпрометировать это может быть злоумышленник который проник в сеть это может быть Рабочая станция обычного пользователя либо администратора которая была заражена скомпрометирована злоумышленником которые используется уже для реализации дальнейшей атаки современная концепция безопасности говорит о том что мы используем технологию Z для того чтобы не доверять никому то есть при установке любого соединения при установке любого запроса мы говорим о том что мы не доверяем участникам соединения И мы хотим использовать взаимную аутентификацию для этого и соответственно если мы посмотрим на рекомендации вендоров будь то и Amazon Web Services кто угодно они практически все рекомендуют использовать взаимную аутентификацию между сервисами внутри организации А если посмотреть на законодательные требования то там тоже Практически везде что в наших гостах что в зарубежных стандартах встречается рекомендация использовать взаимную аутентификацию и один из самых простых способов это реализовать - это использовать mutual tls то есть что важно понимать что в случае M TS у нас сертификат есть на одной и на другой строне и при установке соединения у нас стороны предъявляют друг другу сертификат и проверяют что он валиден и здесь мы переходим уже непосредственно к обсуждению того как проверить сертификат Какие в нём атрибуты есть что важно смотреть в сертификате и Какие особенности могут быть у разных типов сертификатов особенно в применении к установ соединени по ста формат x509 который определяет Какие поля у сертификата должны быть соответственно основное что есть это как я уже говорила открытый ключ который используется другой стороной для того чтобы либо зашифровать сообщение либо провести аутентификацию по сути если совсем грубо то для аутентификации используется то же самое шифрование есть на если я хочу проверить действительно тот за кого себя выдают я беру сертификат этого сервера я беру его открытый ключ с помощью этого открытого ключа я шифруют случайное число и отправляю его на сервер соответственно если это действительно сервер который обладает закрытым ключом соответствующим вот этому открытому то он может расшифровать это сообщение потому что у него есть ключ с помощью которого можно расшифровать и вернуть мне информацию которая передавала зарова виде то есть таким образом проходит аутентификация что действительно у него есть закрытый ключ и действительно тот за кого себя выдаёт то есть в сертификате есть информация об открытом ключе и алгоритме который используется есть информация о владельца этого сертификата в зависимости от типа сертификата это могут быть абсолютно разные сущности Да но в случае СС сертификатов практически всегда это имя ДНС имя сервера либо альтернативное имя сервера и самое главное что здесь ещё есть это подпись удостоверяющего центра то есть что важно что я не могу просто взять сказать что я английская королева да взять открытый ключ какой-то Да и присоединить к нему какую-то случайную информацию то М я являюсь для того чтобы это всё работало У нас есть удостоверяющий центр который удостоверяет эту связ между открытым ключом и его владельцем и соответственно всё это подписывается ключом удостоверяющего центра но здесь возникает опять же проблема курицы и яйца если у меня есть удостоверяющий центр который подписывает сертификат то значит у этого удостоверяющего центра есть открытый и закрытый ключ открытый ключ этого удостоверяющего центра кто-то должен проваливать и соответственно связка открытого ключа удостоверяющего центра подтверждает что этот удостоверяющий центр владеет этим ключом и соответственно а подписано каким-то ещё удостоверяющим центром То есть у нас в данном случае получается такая цепочка То есть у нас есть конечный сертификат А у которого есть информация у его владельца и вся эта информация подписана промежуточным удостоверяющим центром У нас есть промежуточный удостоверяющий центр у него есть ключ который подписан сертификатом другого удостоверяющего центра и всё это заканчивается на корневом удостоверяющем центре А это такой удостоверяющий центр у которого есть са подписанный сертификат и что важно понимать с корневыми удостоверяющими центрами что мы не можем этот сертификат просто так передавать потому что это то что называется якорем доверия То есть у нас есть самоподписанный сертификат который нам заверяет всех остальных пользователей системы если мы говорим про корневые удостоверяющие центры то они делятся на две категории публичные То есть те которые сертификаты которые всем доверяют что значит сертификаты которые всем доверяют в большинстве случаев это сертификаты которые поставляются вместе с операционной системой Либо вместе с браузером и вы по умолчанию как только там Заходите в браузер либо запускаете операционку вы уже доверяете какому-то определённому набору сертификатов а либо если мы говорим про внутрикорпоративные системы то здесь мы можем самостоятельно разворачивать удостоверяющий центр и с помощью политик добавлять Невой сертификат на все рабочие станции сервера контейнеры виртуалки что угодно которые есть в компании что ещё есть очень важное в атрибутах сертификата это его срок действия а как я уже говорила то со временем У нас меняется понимание о том что такое стойкий алгоритм и что такое не стойкий и те ключи которые мы раньше считали надёжными сейчас могут довольно быстро быть взломаны поэтому обычно у сертификата есть срок действия в течение нескольких лет а опять же сейчас обычно для тлс сертификатов - это год либо меньше для удостоверяющих центров это 5 10 20 лет Но самое главное что есть ограничение по сроку действия и в каждом сертификате мы пишем До какого момента он действует но есть ещё и скажем так экстремальный вариант когда мы знаем что я не знаю там у нас украли носитель на котором был закрыты ключ либо сервер ТО Здесь мы получаем ситуацию Когда нам надо какой-то сертификат экстренно отозвать то есть по сроку действия он ещё действует но мы говорим что он уже был скомпрометирован и здесь у нас получается что есть два варианта проверки это списки отозванных сертификатов где есть список сертификатов которые были отозваны раньше срока просто Файлик в котором есть серийные номера сертификатов и ничего больше А для больших удостоверяющих центров этот Файлик может очень быстро расти э и требовать много времени на его скачивание Поэтому был придуман ещё протокол э онла секе статус протокол который позволяет более оперативно по отдельному сертификату узнать его статус обычно это делается путём того что кэшируется в список отозванных сертификатов и по нему происходит проверка что сертификат был отозван Почему это важно потому что каждый раз когда у нас идёт установка соединения если мы говорим про установку соединения там с веб-сервера то у нас идёт проверка был сертификат отозван или нет И если у нас очень большой вот этот Файлик со списком отозванных сертификатов либо он недоступен то у нас либо не устанавливается заин соединение либо оно устава очень медленно если мы говорим про контейнеры то там ситуация чуть другая там довольно большой части случаев вообще не проверяется отозвано сертификатов поэтому там сертификаты обычно делаются с очень коротким сроком жизни от там нескольких дней до нескольких недель которые позволяют минимизировать риск того что у нас сертификат был скомпрометирован но ещ не появился в списках ото сертифика что касается ошибок при настройке сертификатов то здесь есть ошибки которые связаны непосредственно с самим сертификатом то есть какие атрибуты в нём прописаны и ошибки связанные с инфраструктурой открытых ключей или удостоверяющими центрами которые были неправильно или там были использованы неправильные параметры Давайте пройдёмся по основным ошибкам которые могут быть то есть игнорирование или некорректная проверка клиентских сертификатов то есть что здесь важно что если мы настраиваем взаимную аутентификацию mutual tls то нам необходимо проверять в том числе и клиентский сертификат и очень часто в настройках что веб-сервера что контейнеров стоит что можно игнорировать корректность этого сертификата тогда по сути теряется вообще вся идея зачем мы делали взаимную аутентификацию другая проблема - это неправильная работа с ключами то есть опять же здесь идея В чём У нас есть закрытый ключ А который по сути является инструментом позволяющим нам успешно пройти аутентификацию и закрытый ключ всегда должен быть связан с тем клинтом который анфи очень часто бывает ситуация когда ключ закрытый генерируется не на той системе где он будет использоваться А генерируется на какой-то там промежуточной системе там для удобства либо в связи с там с какими-то техническими ограничениями но в чём проблема что если вдруг у нас закрытый ключ оказывается не там где он должен быть то абсолютно любове закрытый ключ и выдавать себя за соответствующий сервер или сервис поэтому что очень важно что ключи должны всегда генерироваться там где они будут использоваться а ключи опять же в идеале если мы говорим про какие-то серьёзные и сложные системы они должны храниться на аппаратных носителях То есть если мы например говорим про ключ там удостоверяющего центра то желательно его хранить на аппаратном носителе то что называется hardway Security Model Вот ещё одна важная вещь - Это просроченные сертификаты как я уже говорила у нас одна проблема с тем что надо их проверить и другая проблема с которой я уверена что каждый из слушателей сталкивался это то что сертификаты продует в самый неожиданный момент то есть вроде как срок действия у них год но мы обнаруживаем что в тот момент когда мы пытаемся подключиться к какому-то сайту он недоступен и я думаю что это видели все и с крупными сайтами технологических компании и с различными сайтами которые оказывают государственные услуги вот что периодически Мы заходим на сайт и мы видим сообщение что данный сайт не доверен И если мы лезем в дополнительную информацию Мы видим что это произошло потому что у нас истёк срок действия сертификата поэтому очень важный момент что при настройке сертификатов мы должны понимать Каким образом мы отслеживаем что сертификата закончился срок действия И как мы его обновляем ну и опять же то что касается само подписанных сертификатов то они допустимы для корневых удостоверяющих центров во всех остальных случаях они не дают нам никакой дополнительной информации об аутентификации потому что кто угодно может сгенерировать сертификат и соответственно кто угодно может себя выдать за того что указано в само подписанном сертификате вот а важный момент что очень часто само подписанные сертификаты используют в тестовых средах и с одной стороны это просто и быстро но я бы на самом деле крайне не рекомендовала использовать эту практику потому что потом когда вы переходите с тестового стенда на продакшн выясняется очень большое количество нюансов которые рушат всю систему поэтому лучше всего для тестовых сред использовать те же способы там получения генерации сертификатов которые используются и для продакшн среды В первую очередь это естественно относится Когда мы занимаемся шифрованием данных между отдельными сервисами что касается ещё ошибок которые могут возникать при настройке А когда Ну наверное Одно из самых главных ключевых моментов что если мы настраиваем корневой удостоверяющий центр то мы должны подумать о том какие атрибуты Мы указываем в сертификате корневого удостоверяющего центра с одной стороны есть базовые ограничения которые мы можем использовать на корневом удостоверяющем центре в чём Идея то есть я уже говорила что у нас обычно есть цепочка из удостоверяющих центров которые есть корневой который обычно даже не обычно да который всегда рекомендуется использовать как оффлайн удостоверяющий центр То есть вы взяли его установили выпустили сертификат дочернего удостоверяющего центра И после этого взяли его отключили от сети положили в сей там либо просто в какое-то защищённое помещение и соответственно один из атрибутов сертификата ограничени может для выпу подписания других сертификатов то есть опять же одна из ошибок настройки которая может быть когда вы не ограничили использование сертификата и вы выдали Казалось бы там SS сертификат для аутентификации веб-сервера Но в нём мне задано ограничение что этот сертификат не может использоваться для выдачи другого сертификата и соответственно администратор веб-сервера либо злоумышленник который может для сертификатов и соответственно если у нас пользователь доверяет корневому удостоверяющем центру то он доверяет абсолютно всем сертификатам которые были выданы его дочерними удостоверяющими центрами а второй момент важный тоже который есть в сертификате в сертификате есть такие атрибуты как информация удостоверяющем центре а authority Information Access там есть информация о том где взять сертификат вышестоящего удостоверяющего центра и что важно что при проверке любого сертификата клиент обращается к клиент обращается по ссылке Да которая указана в атрибуте ае и пытается оттуда получить корневой удостоверяющий центр если соответственно это не удаётся то происходит таймаут либо просто не установка соединения Аналогично информация о списке отозван р она тоже содержится в атрибуте сертификата в или CDP и здесь важно чтобы эта ссылка тоже была доступна для клиента который с этим обращается частая ошибка которая бывает когда в компании поднимается внутренний удостоверяющий центр и исходит из предположения что его будут исм ресурсы в лучшем случае это какой-нибудь там внутренний корпоративный портал где данные эти выложены в худшем случае это допустим там какой-нибудь LD Up каталог либо Active directory и проблема возникает тогда когда у нас пользователь неожиданно уходит на удалённую работу а либо начинают подключаться с каких-то других локаций и у них просто нету доступа к вот этим точкам распространения и они не могут нормально проверить список отозванных сертификатов какие есть ещё проблемы которые могут возникать Это количество сертификатов То есть если мы говорим про микросервисы про контейнеры про среды где у нас часто появляются исчезают пользователи сертификатов то есть Клиенты либо либо сервисы то у нас очень быстро начинает расти количество сертификатов и в случае когда оно достигает нескольких сотен ли неких миллионов у нас возникает проблема с тем что всё это начинает очень медленно работать вот и опять же да что если мы говорим о том что мы хотим в компании реализовать взаимную аутентификацию использовать мтлс а то нам надо думать о том как нам нормально балансировать нагрузку и здесь есть два пути Один путь что у нас есть несколько удостоверяющих центров которые генерируют сертификаты для разных потребителей а второй путь когда мы говорим про сертификаты в контейнерных средах то очень часто используется то что называется эфемерные удостоверяющими центрами когда мы такие сертификаты не записываем в базу данных удостоверяющего центра тем самым не нагружая его а мы для этих сертификатов делаем очень короткий срок действия в течение нескольких недель и соответственно просто доставляем их до конечных потребителей не нагружать тем самым удостоверяющий центр Я честно скажу хотела рассказать ещё наверное о десятке проблем которые могут возникать но мы и так уже прям совсем плохо у нас с лимитом по времени поэтому я просто коротко скажу про чек-лист о том что надо помнить проверять ну и соответственно либо погуглить и несколько ссылок Да там на дополнительные источники которые можно почитать что касается чек-листа то первое с чего всё это начинается это иерархия удостоверяющих центров здесь отдельная интересная тема о том что действительно ли должна быть там трёхуровневая иерархия как классически рекомендуют Когда у нас есть корневой удостоверяющий центр и или выдающий удостоверяющий центр во многих случаях да эту иерархию можно менять Главное что вы должны понимать зачем вы это делаете есть ситуация когда может быть достаточно вообще одного удостоверяющего центра который сразу и корневой и выдающий если вы можете спокойно заново распространить информацию о его сертификате очень важный момент - это то какие криптографические алгоритмы вы используете если мы говорим про тлс здесь есть две отдельных части то есть с одной стороны что у нас есть в сертификате которые используется для аутентификации сервисов и второй момент - это настройки нашего сервера или протокола то есть какие алгоритмы мы используем для шифрования и с точки зрения аутентификация нам важен сертификат и какая криптография там используется с точки зрения защищенного соединения и зашифрованного трафика Нам очень важно то каким образом мы генерируем ключ для симметричного шифрования и какой алгоритм симметричного шифрования мы используем то есть В течение какого срока мы сможем быть уверенными что наш алгоритм Ясь атрибутов сертификатов изних это Например а точки распространения информации об корневом удостоверяющем центре а различные Basic constraints если мы говорим про ssl сертификаты то я думаю что вы все видели сертификат Extended validation который дополнительно проверяют Э что сертификат действительно был выдан для того сервера который относится к компании э который владеет соответствующим доменным именем вот и это тоже определяется атрибутами сертификата и отдельная важная часть Да это срок жизни сертификатов что касается криптографических алгоритмов то здесь я бо очень рекомендовала книги Вильяма Столин было огромное количество переизданий Да этой книги по-моему там 12 или 13 что говорит о том что она в общем-то до сих пор актуальна и там как раз очень классно описано о том как развивались те или иные протоколы криптографические и алгоритмы которые лежат в основе этих протоколов и какие конфигурации надж или нет А кроме этого есть классическая книга Брюса шнайер Я думаю что если вы слышали про Алису и Боба когда рассказывают про пиктографию то это как раз пошло из этих книжек Это довольно базовая штука Но она очень интересно написано а и соответственно блог Брюса шнайер там часто попадается интересная информация о том что поменялось с точки зрения там надёжности тех или иных алгоритмов Единственное что последнее время да там как и везде а там стало очень много там информации там о конкретных атаках о хакерах и к какой стране они принадлежат но всё равно до сих пор там встречаются полезные вещи о том как настраивать криптографические алгоритмы и Какие из них считать надёжными Мы на этом с слушателями в фазе доклада попрощаемся Спасибо большое за внимание и до встречи на дискуссии"
}