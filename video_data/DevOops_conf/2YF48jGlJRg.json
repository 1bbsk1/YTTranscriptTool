{
  "video_id": "2YF48jGlJRg",
  "channel": "DevOops_conf",
  "title": "Андрей Важенин — Эпопея миграции ~400 проектов из Swarm в K8s: чему она нас научила",
  "views": 469,
  "duration": 2662,
  "published": "2022-11-02T15:01:53-07:00",
  "text": "Всем привет Меня зовут Виктор Попов И я рад представить вам Андрея важенина Андрей был разработчиком потом стал администратором То есть он совмещает лучшее из двух миров и буквально является девопсом сегодня Андрей расскажет как skyeng мигрировали кучу продуктов из dokersworm в cubernetics С какими сложностями столкнулись и как процесс миграции выстроили Андрей рассматривали знаешь я думал об этом но второй доклад я бы не осилил то есть просто через год пришлось бы делать доклад Как из наматов мигрировали в куберы в марафон скорее года Три года Да я понял Ну ладно сэкономил Андрей себе нервы смотрите Давайте перейдем к сути я просто сам перевозил проекты из одного куба в другой и знаю что это довольно болезненный процесс А в случае с разными регистраторами Мне кажется всё ещё веселее вот Андрей нам сейчас об этом расскажет но перед этим хочу напомнить что смотрите Вы можете оценивать доклад где-то в плеере есть кнопочка после доклада вас ждёт дискуссия можно будет перейти Поговорить с Андреем может быть со мной немножко и собственно Вы можете задавать вопросы во время доклада в чатике в Telegram чатике в чатике плеера вот больше не смею вас отвлекать своего Андрей передаю тебе слово внимательно слушаем Спасибо Виктор спасибо за представление как я немножко повторюсь немножечко Меня зовут важен Андрей Я работаю с кэнги Сейчас пойдет речь про то как мы провели последний год переводя продукты из шаурма в kubernet Ну и маленький сайт про себя как сказал уже Виктор я был разработчиком администратором И сейчас где-то вот между Ну и собственно всегда любой доклад по губернатос начинается с того чтобы объяснить А зачем и почему губернатос как уже спрашивали соответственно у нас всегда вопрос был ребром типа у нас есть давным-давно были железки и мы сейчас практически все мигрируемся в облака Почему Потому что раньше когда у нас были железки мы все делали своими руками Все было замечательно но к сожалению тренды такие что надо ускоряться надо делать как можно меньше работы то есть больше приносить и облака за собой несут немного сразу таких стандартизованных вещей соответственно плюс их еще многие начинают тестировать у себя в компаниях внутри и конечно же когда мы привозим с собой какую-то технологию например губернаторство мы приводим с собой как бы такие мировые тенденции Ну и почему свом мы отказываемся от него во-первых форма умирает то есть репозиторий официальный сайт уже заархивирован Да есть какая-то доработка Новая Мы даже не рассматривали по причине того что один раз Как говорится уже зафиксировали может быть и второй раз тоже Ну и форм работы плохо с большими кластерами насколько большими у нас был кластер из 40 соответственно там уже Мы получили некоторую просадку и мы предполагали когда мы начали эту миграцию то что мы выиграем 20 процентов просто за счет того что у нас будут Лучше утилизироваться ресурсы на деле же мы получили за счет уже выигрыш 40 процентный сейчас 25 Это всего лишь который обрабатывают тот же трафик который обрабатывал 40 нодовый кластер sworma нельзя не поговорить про тренды тренды такие что уже 10 лет назад все стремились кубы в мировом сегменте сейчас это тренд сохраняется то есть мы видим как за количество запросов вырастает в России ситуация немножко другая Мы видим что за последние пять лет примерно одинаково был из форму губернатос и за последний год У нас Явный вырос губернатор почему еще раз губернаторс мы посидели подумали что он нам принесет И вот здесь на слайде можно увидеть множество плюсов удобства разработки сопровождения очевидные вещи как и скорости стабильность но в рамках перевоза мы поняли что мы привносим еще и некоторые такие масштабные изменения внутри компании мы вносим декларативность ограничения которых сегодня пойдет речь это по сути такие неожиданные плюсы которые принесла нам миграция Как проходил миграция мы занимались вроде как год да ну типа вот написали год на самом деле путь был далек то есть мы занимались Сначала декаризацией это как раз от сервировку переходили в облаках а потом уже занимались пуберизацией почему выбрали Такой путь ответ достаточно прост У нас не было экспертизы губах четыре года назад она начала появляться как раз около двух лет назад и нам не обязательно надо перед тем как приступать к миграции надо понимать какой у нас есть дано то что у нас есть уже на старте и здесь стоит отметить что мы были подготовлены к этому процессу У нас есть тепло это единое приложение которое диплоид весь skyeng в любой регистратор который захотите есть можно увидеть что он подчеркнут Это ссылка соответственно работающая Можно перейти послушать которые собственно проект также есть Инсайт это единая база данных cmdb которая себе содержит описание всей нашей инфраструктуры также доклад доступен для просмотра Юлия марочкина подготовила на другой конференции стоит отметить также единый стек Многие знают что skyeng это равно PHP Но сегодня мы поговорим почему это не так анса было Джексон централизованный под этим словом Я понимаю что нам не надо вносить много доработок в этот в эти продукты чтобы привнести какой-то были то есть мы дорабатывали их но не так сильно могли бы ну и очереди живут отдельно от кластеров чтобы понять о чем здесь я приготовил картиночку вот у нас есть Интернет соответственно в интернет у нас балансиры есть два кластера губернатор мы соответственно Весь процесс был заменить форму губернатосом а очереди мы живут отдельно поэтому процесс наш был намного намного легче в этом плане Ну и мы переходим к подготовке к проекту о чем здесь будет идти речь Представьте что вам приходят говорят Теперь мы должны все что у нас есть с вами перевести в кубы чтобы будете делать Мы пошли ко всем и спросили А что же вы хотите и сразу же бизнес сказал что у нас нет ресурсов то есть бизнес не мог выделить Практически никакого времени на то чтобы это провести миграцию соответственно это все легло на руки инфраструктуры и мы начали ходить и спрашивать что же вы хотите мы вытащили из всех три главных качества нам это напомнило треугольник хопкинса Когда вы можете выбрать два из трех и мы начали выбирать мы получаем долг мы получаем скорость низкую и получаем решение нам надо получить идеальное наше состояние Идеальное оно конечно же в центре но по результату миграции мы понимаем что идеального ничего не бывает и мы чем-то должны пожертвовать пожертвовали скорость Да мы могли бы провести миграцию быстрее чем за год но тогда мы потеряли бы Либо в качестве либо стабильности А это были наши главные критерии еще в критерии входило 2 как вы здесь видите это 0 изменений и количество проектов я напомню что у нас порядка 4 сотен проектов skyeng что же мы будем делать Давайте попробуем решить Каждую из проблем на стадии планирования что нам надо сделать для того чтобы закрыть все вот эти вот вопросы Первое это качество давным-давно где-то в году 17 18 Когда не было еще стандартов декларативных женщин ребята сели и начали изобретать свои велосипеды это жила развивалось все было здорово но в какой-то момент нам это все надоело и мы пришли к тому к этому к единому нашему решению соответственно Что она делает это с помощью пары файлов она может заделывать собрать и как бы ввести Production Любое приложение и человеку надо всего лишь момент миграции когда мы начали двигаться мы привнесли как раз губернатор схем и начали понимать что мы идем и приносим тенденции мы начали выстраивать API наших сервисах начали писать наши DSL новые и начали вообще смотреть намного лучше на инфраструктуру и по сути мы начали использовать все стандарты практики то есть мы начали заниматься декларативным программированием и мы по факту В эту миграцию мы поняли что наша основная цель это уйти от императивности в сторону декларативности и сегодня мы как раз немножечко покажем как мы это сделали на примере своего Итак если мы хотим говорить про качество то что мы сделал мы начали больше разговаривать внутри коллектива то есть мы начали собирать архитектурные советы начали вырабатывать решения и договариваться челленджи друг перед другом соответственно всегда пишем тесты на любой код тут важно понять что на код пишем тесты Может чуть попозже поговорим Итак соответственно про качество проговорили Давайте про стабильность В чем смысл стабильности Смысл в том что мы не должны допускать ошибок на стадии миграции То есть если мы начинаем мигрировать и допускать ошибки то в подальше не появляются из иммиграции какие-то ошибки Это недопустимо что мы должны сделать на этапе планирования Как подготовиться к этому мы должны предусмотреть практически все ситуации которые могут возникнуть и как уже говорил pipeline мы не пишем с тестами Почему Потому что там нет логики и Сегодня я чуть-чуть расскажу как мы писали а моментальный откаты и покрытие тестами такие небольшие очевидные штучки дальше поговорим про количество проектов я напомню что количество 400 если мы представим что вот один микросервис а это пара инженеров которые были выделены от инфраструктуры на один год для иммиграции всего скайринга то вот это 400 проектов это большая сумма большое количество и что с этим делать непонятно мы посмотрели на прошлый опыт и вспомнили что у нас есть же замечательные инженеры которые собственно занимаются своими проектами и мы попробовали вспомнили как мы к ним заходили с декеризацией мы сейчас на слайдах видите менструальные какие-то конфигурации какие-то вопросы по сути такое слоистое дерево решений которые вам датиризирует проект Что надо сделать если у вас вот это было ужасно мы передавали Что ой Что там делать И в итоге мы делали все сами сами написали мы сами и делаем Это чек-листы чек-листы это ручная работа с этим конечно же невозможно жить поэтому мы заложили что да мы придем но мы должны убрать ручную работу и об этом мы сегодня тоже сейчас поговорим на этапе реализации но изменений что здесь имеется ввиду Представьте что у вас есть 600 разработчиков соответственно у вас если хотя бы один разработчик потратит одну минуту А если 600 вы потратите 600 минут это 10 часов Это очень много для компании соответственно мы должны проектировать свои решения в инфраструктуре чтобы как можно меньше затрагивать разработчиков времени то есть мы должны решать задачу не изменяя что если человек диплоил свои продукты в принципе наш единый сервис здесь важный еще отметить что наш DSL который мы делали он базировался на докер compose об этом сейчас чуть подробнее поговорим но смысл в том что мы базу взяли и сделали лучше и примеры сейчас мы увидим и важно отметить также Что надо искать удобное решение а не первое то есть мы должны не просто принимать какие-то решения а выбирать лучшее решение которое у нас есть Итак мы поговорили про 4 изменения Давайте перейдем главному Как нам достигнуть скорости как многие из нас из вас знают скорость достигается как раз с помощью качества и мы сегодня докажем примере что наша скорость год достигнулась была достигнута именно с помощью четырех пунктов выше Итак говорим про среды что мы подготовили в качестве технической части соответственно у нас есть продуктив продуктивно разворачиваем с помощью Почему куб спрей я уже говорил что у нас используется централизованная ансе был и 95 процентов инфраструктуры разворачивается с помощью поэтому выбор Пал на coopspray работаем и железками и виртуалками и никаких проблем замечено за последние два года не было на тестовой среде мы используем minique и мини-купе единственная История это то что в пройдена используется с тестами мы к сожалению завести не смогли там конфликты и мы решили не тратить время больше времени скорее всего решили эту проблему но мы решили что мы найдем другое решение о котором мы поговорим уже про будущее что мы будем делать в будущем для временной оценки мы потратили примерно месяц как и на тестовую так и на среду продуктивную и примерно по полгода для доработки их до продуктивного состояния промышленного использования для локальной разработки мы подготовили Dead Space потому что людям надо как-то разрабатывать локально по сути эта штучка которая синхронизирует ваш локальный код в контейнере и тренд вообще в нашем сейчас 21 веке в том что мы уходим от локальной разработки но повторюсь для разработки ничего не поменялось то есть мы максимально минимизировали действие разработчиков при иммиграции Единственное что видно это то что партейнер заменился на губернатор от этого только все выиграли потому что протейнер очень медленно работает и здесь закономерно спросить Что там делать если вы ничего не меняли разработчиков что же там изменилось по сути Мы у нас есть слева справа фосфора не меняется только контейнеры те же самые бегают но мы пошли собрали изменения Ну что реально мы меняли в при иммиграции первое что Мы заметили это изменение базовых образов база образов поднимались то есть первое что в них изменилось это мы все перевесили над этом нас была проблема с лепсей на следующем слайда будет график вы увидите какую процент мы замедленно при соответственно при работе метрики собираются по-другому с контейнеров Мы всегда собираем метрики и они собираются чуть-чуть по-другому в кубах мы опять же стандартизировали и вообще в целом кубиризацию Да вот процесс миграции в кубы Мы скорее называли стандартизацией или куперизации соответственно дальше поддержка обновления это все такие базовые понятные вещи всегда что-то выходит новое Мы всегда что-то обновляем соответственно наших базовых образов Вот она картинка у нас замедлилась в два раза при использовании Alpine соответственно sleepsi мы дальше перешли на Даби и где-то процентов на 10 нагрузку точнее снижение производительности это нас принципе достаточно спасала и мы согласились Поехали на этом изменение конфигураций опять же все что вы делаете вы стандартизируете вы приводите все проекты которые у вас есть к единому виду чтобы вам было удобнее работать в будущем если вам надо один раз изменить по шаблону 500 файликов Это удобнее чем в каждый заходить руками что-то менять а соответственно здесь указано что именно мы делали в основном мы убирали весь кастом А что именно изменялось в конфигурации взаимодействие на сети то есть когда мы меняем оркестратор У нас меняется в основном взаимодействие внутреннее взаимодействия сети то есть адресация адресация с вами была через Take name контейнерные адресация в кубах просто под ней в рамках Ну и не стоит забывать что вы джинсе который мы постоянно используем своя свой соответственно мы не можем просто взять и сказать что вот там вот иди туда в рамках одного диплоинта это работает в рамках Мы в итоге сочли нужным что мы пишем полностью адрес кластеры что еще стандартизировали процесс доступа в партенитере было свое база данных кто-то Тим Лиды продуктовом и сами добавляли всех пользователей А мы соответственно в губернатор дашборд смогли интегрировать солдатом И все опять же централизировали и стандартизировали Итак мы прошлись по всем изменениям базовых 4 штуки Давайте пойдем в сторону реализации что же мы реализовали в рамках миграции быстренько пройдем по всем пунктам DSL балансиры мониторинглайны конвертеры И автоматический проект DSL мы покажем просто примеры Как оно выглядит то есть Мы создали свой домашний на основе фильма где мы можем выставить контрактная приложений данном случае Вы видите просто тепло одного приложения с помощью шести строчек здесь мы добавляем с помощью четырех строчек здесь мы включаем горизонтальные масштабирование Это один из самых важных моментов по поводу лучшей утилизации То есть у нас при росте нагрузки мы увеличиваем количество при снижении нагрузки уменьшаем за этого собственно балансировка лучше еще есть конечно сегодня не поговорим Но мы его тоже используем инжинкс также добавляет с помощью пяти строчек И как мы уже говорили стандартизованное использование удава То есть если мы хотим какой-то другой группе дать доступ наш Space мы соответственно просто описываем его здесь же в одном фабрике можно настраивать по-разному команды переопределять и массив строки Это все как бы очевидные вещи но самое интересное такими фича завозили То есть у нас был проект который при потере 30 процентов сильно деградировал то есть при обновлении приложения 30 процентов выводится из состояния и соответственно заводе снова за счет того что этот процесс достаточно долгий приложение деградировало мы написали много кода в нашей имплементации мы выставили контракт на простую простую строчку мы даем единицу и говорим не больше одного контейнера мы можем отпускать можем выставить 10 процентов будут проценты вот примеры соответственно файликов скорее всего здесь будет сложно что-то разглядеть Но это полностью продакшн приложений которые диплоится То есть все описывается на одном слайде потом слайды будут доступны можно будет изучить по поводу окон Source мы пока не думали но скорее всего в будущем когда мы работаем до какой-то стабильной версии может быть мы и выпустим балансиры картинку картинкам вот заходим и балансированно смотрят в два кластера что мы сделали самое главное самое главное мы дали доступ сразу же покупки то есть если мы диплом приложения в кубы мы сразу включаем в браузере То мы идем в приложение в кубы если мы Выключаем обратную сторону тестировщиком кулачником и намного удобнее было тестировать приложение когда мы понимаем что идет не так и второе это мы выставили контракты начали поддерживать то что мастер всегда актуальный в нашем конечно не все так гладко но тем не менее процентов 90 проектов у нас получилось так сделать мониторинг просто базового пройдусь то что мониторинг должен быть наши базовые метрики трафик 12 идей количество консульмеров потребление памяти CPU количество ошибок Все это позволяет вам понимать состояние приложения здесь один график и второй график и здесь даже не знаю что приложение делает по тенденции можно понять все плохо или все хорошо Это было ключевой момент в миграции мы переключаем трафик и начинаем смотреть что же у нас происходит с приложением pipeline были написаны достаточно быстро но руководство было против них они говорили но мы выиграли за счет них Как писать pipeline мы не сели сразу реализацию то есть мы сначала потратили процентов 80 времени на то чтобы спроектировать наше решение и это лучшее что мы сделали потому что мы написали в один раз декабре и за последующие практически год мы ни разу не трогали Исходный код payline не должны содержать логики если вам нужна логика Напишите код и напишите к этому коду теста Ну и помните что они пишутся декоративном стиле а декларативный стиль это навык который надо тренировать и совершенствовать нам Мы выписали 8 шагов они в принципе достаточно очевидны то есть мы переключаем трафик включаем экран приложения краны и супервизоры диплом ветки мержем все в принципе понятно но вопрос здесь стал больше такой А нужен ли нам один или несколько и в итоге у нас получился не один а целых 5 мы быстренько сейчас про них поговорим основной pipline и основная цель правильно это чтобы был кликать чтобы никакой ручную работал чек-листы мы перенесли в Pay плане и он выглядит основной из 8 действий напомню порядка 30 что в этих действиях происходит Мы просто говорим Да мы продолжаем или нет мы продолжаем простые вопросы всё только простыми действиями Да нет если вам надо что-то вести никогда не не просите пользователя вводить что-то руками потому что вы задолбаетесь писать партии Дайте пользователю выбрать при подключении трафика пользователь выбирает сколько трафик опустить и соответственно при пайплайнах максимально информативность все что мы делаем мы всегда пишем куда-то у нас корпоративный менеджеры мы создаем трат на каждый запуск Лайна и в этом в этом трейде мы все описано каждое действие максимально максимально все описываем что происходит что пошло не так Почему упало на каком этапе поскольку времени и так далее Также надо всегда писать Что что-то изменяется продакшене какой-то информационный канал у нас все это дело соответственно автоматически чтобы ничего не упустить моно репозиторий это фронтовый репозиторий в чем его проблема Проблема была в том что он очень большой он очень много проектов много изменений и собирается долго и здесь мы как раз и применили практику известно я напомню Что изыск это у нас есть кластер слева класса справа контейнеры слева контейнеры справа но здесь мы применили как раз тактику что мы контейнеры прям в том же состоянии с той же версии просто перевозим на новый регистратор и все заработает в основном потому что проекты фронтовые рождаются сидим и соответственно коду непосредственно не имеет никакого доступа уже потом через один или максимум два дня приложение фронтовое пересоберется улетит в продакшн полуавтоматический pipeline Все что вы делаете автоматически вы когда-то делали руками если вас что-то пойдет не так вы всегда сможете поправить от руками всегда помните что все что вы делаете автоматически когда-то вы делали руками поэтому здесь мы просто брали два автоматических действия которые делались и позволяем делать это вручную И прекубер на чем его смысл я напомню что наши главные идеи была привлечь разработку или квай-инженеров к тому процессу миграции чтобы соответственно снизить расходы инфраструктуры на собственно эту миграцию потому что у нас нет столько ресурсов и Мы создали pipeline который проходит все проверки которые мы знаем и по итогу создает задачу в этом парлане если он прошел то 99 процентов что и первый который мы с вами смотрели пройдет успешно Все проверки соответственно полностью покрывают скорее всего продаж и задача выглядит так много текста Но самое главное здесь выделить моменты мы просим человека сделать два действия зайти по ссылке и ввести два поля все дальше человеку соответственно инженеру Ему просто будет сыпаться набор действий Что ему надо сделать с подробными инструкциями если мы что-то непонятно есть две видеозапись как вы это все производим есть конечно статьи можно всегда спросить у нас Что делается что делалось или что надо делать и дальше Мы сели создали задачи и думали сейчас работа пойдет и мы ничего делать не будем но в реальности получилось так что мы поставили задачи и тут началось никто практически за первый квартал не взял задачу ничего не самостоятельно и мы начали задумываться Почему А тут оказалось что это командная работа в которой мы приходимся в реальность что в реальности было с проектом не так вот с проектом миграции во-первых невозможно спрогнозировать настолько большой проект он слишком большой 400 проектов они все разнородные нельзя спрогнозировать никак изначально к проекту отнеслись как бы таким нахрапом набросились давайте сделаем попробуем и даже метрики не стали собирать самого начала сколько проектов сделали что На каком стадии никакие проценты практически ничего не собиралась И было все наличных договоренность ты делаешь отлично сделал чуть позже Не беда потом доделаем и тут еще важно отметить что мы до марта создавали новые проекты в форме отчасти потому что мы забыли о том что есть такой процесс отчасти потому что не совсем верили что новый проект смогут сразу же работать правильно но в апреле мы уже соответственно все точно начали создавать правильно в кубах данный вопрос от нашего руководства был А через полгода вы сможете мигрироваться сто процентов кубы или нет И каждые полгода этот вопрос повторялся по поводу метрик если бы мы начали собирать метрики как это мы сделали 1 апреля то мы бы смогли предсказать скорее всего через полтора квартала когда мы закончим но мы имеем сейчас картину только прошлого примерно состояние на первое число и точное состояние на 1 апреля если построить линию а красный как раз линия тренда то мы можем видеть что скорость примерно была одинаковая за весь период и мы могли бы реально предсказывать будущее поэтому что делать планируйте берите маленькие цели до слона надо есть по частям Ну и уделяйте больше времени проекта у нас были еще другие проекты в рамках других проектов то есть в кубизацию Она иногда останавливалась на несколько недель это все как бы учитывается И к сожалению не всегда есть полное время не забывайте переключаться потому что все-таки процесс миграции достаточно рутинная операция Да мы сделали проще и как раз Почему сделали проще потому что много чего автоматизировали в том числе автоматизировали конвертацию у нас Мы создали взяли открытую доктор схему она доступна в репозитории форма и написали свою схему это вот наш соответственно контракт и сделали конвертер то есть перевод типов там всякие преобразования автоматически в общем максимально все обложили тестами и все это работало но пришел руководство говорит А где гарантии то что у вас все работает как надо он deplorer работает так же как и в губернации мы сказали ну нет гарантий тогда давайте гарантия сделайте нам пожалуйста обратной операции то есть мы написали код в одну сторону нас попросили по сути написать второй год в другую сторону потому что код к сожалению не может просто взять начать работать другую сторону и Раз уж вы написали обратную проверку то давайте диплошу сделаем плюс еще код это заняло у нас достаточно много времени но по факту не использовалась реальности мы две недели потратили на в одну сторону порядка трех недель в другую с диплом и 8 месяцев мы все это дорабатывали до состояния когда это уже не ломается какие-то все время доработки были плюс какие-то новые фичи требовались так далее и вот эти вот ошибки могли бы мы не допускать как мы могли бы сначала посмотреть на решение без создания новых решений у нас уже есть докер compose файла и они отлично диплоит наш в своём не удаляем их и дипломишься с них обратным слоем Зачем нам вот это вот магия туда обратно и так далее ставьте понятный вам да то есть берите то что вам понятно берите задачу всегда требуйте объяснения что же вы хотите на выходе Ну а про разработку К сожалению это нормально потому что проектов очень много Сколько 400 до и мы предполагали что все проекты PHP они все там на одном базовом стоит на самом деле нет На самом деле почти 100 проектов это фронт почти 200 это какой-то бэк на плюс минус одинаковый и еще порядка 200 100 150 проектов это какой-то Java но GS какие-то кастомы какие-то вообще непонятная штука которая только обрабатывается руками для примера мы взяли вот в первом квартале 8 проектов и пропустили через наш автоматический подготовки чтобы узнать А что же там на самом деле так вот реальности 16 проектов смогли автоматически переключиться поэтому оставшиеся нет и здесь если их масштабировать то мы получим всего лишь 64 проекта 400 которые смогли автоматически переехать правда это или нет конечно На первом этапе Да в конце Конечно нет потому что в конце мы перевезли практически 80 процентов с помощью автоматики по поводу ошибок к сожалению у нас было очень много таблиц с ошибками пытались реализовать как-то обработать настолько было много Представьте что 400 проектов в каждом по 10 ошибок 4000 ошибок разного рода И вам классифицировать слишком много времени мы решили разбивать но основные ошибки на этом слайде ошибки прошлого какие-то штуки которые уже не используются оригинальность приложения ошибки сторонних сервисах на перво фотографии почему-то было так что мы Обращаемся к стороннему сервису к инсайту чтобы спросить что-то на что-то падает от этого мы тоже не застрахованы мы соответственно начали дописывать нашу логику чтобы у нас были всякие разные ретро и ну и в конце уже миграции мы нашли что у нас множество проектов просто моральное мертво и их проще Удалить чем мигрировать Что же делать с этим всем как не допускать так долго есть два супер вопроса то есть эти проекты эти вопросы надо задавать по завершению задач Если вы думаете что закончили задачу Спросите два вопроса если ответ да на первый вопрос и ответ нет второй то сети потратите один процент времени и сделать лучше и вам будет дальше намного намного проще повторюсь процесс миграции в кубы это по сути стандартизация с точки зрения инфраструктуры Ну и ограничиваете не Давайте с помощью какого-то внутреннего контракта позволительно сделать самое главная История это командная работа Не забывайте что при иммиграции всего всей компании это затрагивает всех разработчиков всех qua и так далее соответственно это работа всей команды То есть все всего skyeng и ваша цель как драйверов да то есть инфраструктуру драйвера этих изменений ваша цель завоевать Доверие вы приходите в команду говорите давайте мигрироваться они спрашивают кто уже в губах если у Вас ответа нет то это проблема но если вы хотите как бы доказать свою порядочность чтобы сделали все хорошо что идеальный процесс вы берете маленький проект и переводите вот как на картинке да какие-то такие дешевые соответственно двигайтесь потом уже более серьезным и вторая ваша цель как раз Доверие не растерять на полпути То есть вы приходите в команду и вы с ней начинаете работать вот наш 12 миграции разработчик Я посчитал себя самым слабым звеном в кавычках конечно в том плане во временном плане то есть он думал что он тормозит процесс своими проверками когда мы просим его что-то проверить с приложением в продакшене но есть и обратный кейс это когда у нас был кейс мы пришли в команду в мае но иммигрировали команду вы октябре А у команды всего лишь три проекта один из которых передали за этот период они даже ничего не знают сами его перевезли Не стесняйтесь как бы общаться с людьми и Приходите всегда раньше Если вы знаете что команда ну как бы бизнес ориентирован немножко другую сторону перейдите к ним еще раньше Попробуйте намного раньше предостеречь эти проблемы здесь хочу сказать про наши подходы как мы подходили к приложению к выбору приложений которые мигрировать если в начале мы хотели взять какие-то простые приложения потом мы брали не нагружены чтобы все проверить что наши миграция наш кластер справляется с нагрузкой Все проходит хорошо то дальше мы начали уже брать энергостоящие приложения потому что я напомню что цель иммиграции экономия и мы начали выносить самые дорогостоящие приложения губернатос и сразу экономить Ну и внутри так Как лето да то есть мы знаем что летом меньше учеников мы начали вот на стыке 3 перевозить самые самые важные проекты и здесь еще я хотел бы отметить наш подход Да вот нашу гипотезу то что скорость достигается за счет качества как минимум предыдущий слайд уже ее доказал с обратной связью разработчика но здесь я еще бы хотел отметить то что в q421 года мы хотели все протестировать все проверить а Q3 22 года мы уже сами говорили все сами сделаем все убежим переведем вас кубы А вы просто проверите все будет хорошо и мы знали что наши качества она точно выиграет она так сделано так и выиграла Мы привезли порядка 180 проектов только за нет 120 проектов какие выводы из этого всего можно сделать в чем же Профит спросите вы Ну как и предполагалось мы выиграли в экономию Мы стандартизировали очень много skyeng то есть мы познакомились со всеми проектами и знаем какие проекты Что делают Какие Тим Лиды в этих проектах Какие разработчики мы соответственно сплотили команду внутри на старте у нас была по сути новая команда которая начала заниматься этой миграцией Ну и множество опыта безусловно мы набрались если говорить общими словами то мы улучшили эксплуатацию разработку опыт все улучшилось от перехода в кубы и конечно же стоит отметить галогенные если когда-то тепло или форум и сталкивались с тем что логов нет то переходите в кубы потому что там ноги есть ускорили конечно же диплоидка губернетос скейлит намного намного лучше чем докер Пару слов про будущее первое слово это то что будущее сейчас очень сложно строить но мы постарались И хотя бы наметили первичные нашей истории это мы будем заводить канареечные тепло и сервис Когда мы это сделаем скорее всего мы об этом расскажем если мы сделаем это качественно стабильно и быстро меня на этом все буду ответить рад ответить на ваши вопросы Тогда Андрей У нас есть некоторое количество вопросов Спасибо тебе за прекрасный доклад Давай пойдем по порядку подскажи пожалуйста используете ли вы динамические окружения для ускорения разработки и тестирования И второй вопрос 400 микросервисов это количество уникальных продуктов или это количество контейнеров с учетом реплик да давайте начну с конца начала количество реплик количество контейнеров у нас недавно буквально собирали около двух тысяч по поводу проектов 400 проектов это по сути порядка 400 репозиторов различных динамическое окружение Да вот у нас есть такое понятие как тестим Да это у нас тестовое окружение или стейджик окружение и дано динамическое смысла ну быстренько может быть мы про этот день доклад сделаем Потом быстренько Смысл в том что мы поднимаем весь skyeng на одной машине и соответственно там даем разработчику за диплоид свой код если уже работает грубо говоря с репликой Продакшен это по сути да динамической какой-то окружение а для каких-то простых вещей вы используете мини-куб и Дев Stage который ты показывал правильно понимаю нет Именно для этого решения используются Следующий вопрос Андрей Подскажи как разворачивать базы данных э-э очереди и так далее и где крутится эти сервисы в кубе или на ВМ может использовать или по старинке был мы используем по старинке был вот повторюсь что у нас очень большая экспертизация и поэтому выбирали крупней с помощью было и Да это все крутится и на железках если оно требуется но мы сейчас двигаемся в сторону виртуализации будем разворачивать все это виртуальных машинах я вообще хотел до сказать что у тебя мне кажется немножко обманчивое название доклада он на самом деле про то что как Под предлогом миграции причесать всю инфраструктуру компании навести порядок и еще как хорошо когда у тебя есть собственные шаблоны чтобы собственно DSL насколько много это времени конечно экономит меня прямо лично впечатливо да И тут момент в том что это не спуск с руководством Это скорее снизу То есть ты сидишь и ты понимаешь что ты сейчас занимаешься Не просто миграция то есть не просто людей переводишь губы а ты занимаешься чем-то большим ты стандартизируешь дальнейшую работу с инфраструктуры с приложениями Подскажи насколько удалось имея зоопарк из 400 сервисов не использовать распределенные транзакции в межсервисном взаимодействии не знаю насколько это тебе вопрос Вообще я тоже не знаю насколько ко мне вопрос я могу сказать что вот это вот трейсинг у нас используется То есть у нас есть и не использовать Его невозможно то есть когда 8 микросервиса и не знаю какой отслеживаете путь этого запроса без рейтинга скорее всего никак Мне почему-то кажется распределенные транзакции это не про трейсинг Но я могу ошибаться поэтому коллега уточните вопросик в чате пожалуйста мы его мы его продолжим обсуждать Сколько человек devops инженеров работает платформенной команде skyeng А тут вопрос подвохом Я не знаю кого этот вопрос но скорее всего либо человек знает что у нас нет повторной команды Вот либо соответственно человек предполагает что это была платформенная команда я могу сказать что именно таких разработчиков skyengi вот такой типа формы команды работает порядка семи человек Ну а занимались непосредственно миграцией всего лишь два испытываете боль боль при использовании хпа и прогреве Java когда вваливается высокая нагрузка или вы используете пик Ева механизм балансировки на Джаве у нас пара проектов и у нас достаточно такие крутые программисты которые сами соответственно все готовят вот не испытываем проблемой вот Ну по крайней мере ничего критичного нет окей скажи пожалуйста стандартизированная конфигурация что имеется ввиду это некий каркас который содержится бунизированные файлы куда разработчики могут только подставить значение Нет это ну если мы говорим про Sky deploy то это по сути набор всего то есть вы можете написать все что вам необходимо для диплоя секреты которые вы используете там через онлайн переменные январь переменные которые вы используете в приложении то есть 12 факторное приложение у нас полностью стандарт нас внедрен в компании Как вы правильно собрать это приложение это тоже описывается в этом конфигурационном файлике соответственно дальше это порядок тепло Если вы хотите ограничить диплом по времени Если вы хотите ограничить тепло и по пользователям не разрешать кому-то тепло и если вы хотите дополнительно что-то навесить какие-то хуки то есть приложение затекло Надо оповестить всех клиентов это тоже можно сделать Вот а если мы говорим про DSL вот для диплоиев Кубы то там мы описываем грубо говоря контейнеры Да там сервисы которые мы используем для приложения например мкша radis engines phpm Java и так далее это все описывается уже непосредственно tsl Ну может быть в кулуарах мы покажем DSL более подробно у нас осталось чуть-чуть времени как логические команды поддерживает проекты за проектом закрепляется инженер или все поддерживают все или несколько групп инженеров распределяется нагрузка если мы говорим про инженеров dfq то там есть команды у команды есть проекты и соответственно за команды числится проекты мы приходим в команду и говорим у вас вот такие проекты Давайте их иммигрировать если мы говорим про инфраструктуру то инфраструктура следит за всем и у нас есть общие первые линии которые соответственно уже направляет в различные вторые линии в инфраструктуре запросов и последний вопрос успеваем если вкратце чем где успеть где Space и Саша лучше обычного куб сетель разработчикам выдаются персональные им спейсы а разработчикам не пока что не выдаются персональным спейсы на экспрессе The service мы будем делать позже чем отличается диспейс от купцы телеку Кстати надо изучать наверное больше Техническая такая инфраструктурная штука с которой надо уметь работать Space это еще один слой абстракции надку если можно так сказать который упрощает жизнь наверное ответ такой легче тебе говорят что за книжку губернатиз в действии на заднем плане отдельный зачет вот а у нас на самом деле подходит время Друзья вы можете задать Андрею больше вопросов в кулуарах мы сейчас туда переместимся у вас после окончания доклада будет ссылочка Андрей Спасибо тебе огромное за крутой доклад Я получил удовольствие Я думаю что коллеги которые нас слушали тоже всем пока присоединяйтесь к нам Спасибо большое что слушали видеть вас Всем пока"
}