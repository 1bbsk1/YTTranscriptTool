{
  "video_id": "msZXA4waNGQ",
  "channel": "DevOops_conf",
  "title": "Сергей Бухаров — SLO: как не надо",
  "views": 598,
  "duration": 2764,
  "published": "2024-12-13T01:45:09-08:00",
  "text": "Здравствуйте дорогие друзья представляю Вам спикера Это Сергей с Темой доклада сло Как не надо обязательно переходите по QR коду оставляйте ваши отзывы Это позволяет делать и конференцию лучше и спикером делать их доклады более качественными и интересными и пока мы не начали у нас собираются люди Серёг Расскажи как ты пришёл к тому чтобы делать Этот доклад ну для начала немного пару слов о том как я вообще пришёл к сре я начинал свою карьеру в качестве nets разработчика будучи зелёным джином но решили устроить команду структуры так как дико не хватало рук Ну и постепенно с ростом бизнеса Работая в одной компании пришли к тому что нужны некоторые подходы по управлению надёжностью подругу попалась S Book вот во общем это и есть здесь А ну S Book большой Почему ты рассказываешь про SL а не ну потому что я считаю что это Краеугольный Камень все культуры Да там много прекрасных Практик которые можно брать и использовать Но это основа которая в том числе отличает например о сырье от того же девопса в конкретной имплементации я вот периодически хожу по конференции спрашиваю что такое сре девопс не только по этой конференции Вот и ответ на это получаю очень разный Расскажи пару слов чтобы мы все понимали что что за сре скрывается что Ну опять же по моему скромному мнению сре - это в первую очередь культура сре - это не человек Как мы вот как индустрия мы к сожалению проиграли битву за то что сре Иво это не человек Но я по-прежнему считаю так что это культура управления надёжностью и культура про то что мы системно решаем админские инфраструктурные проблемы программистский Ну вот есть много тезисов что СР вот он нужен только в Гугле вот Google написал книжку вот сре в Гугле нужны А у нас в России Вот это как-то не приживётся И вообще не про нас это какое твоё мнение Ну в России Оно правда приживается очень специфично в том числе это стало причиной сегодняшнего доклада небольшой рассказ о том как оно прижилось в реальной компании на в реальной инфраструктуре в реальном мире в России такой момент действительно есть но это всё равно по-прежнему остаётся набором хороших Практик которые необязательно имплементировать целиком и полностью нужно всё натягивать на какую-то призму вашей реальности а у тебя в докладе будет про то чем занимается дода Какого размера потому что непонятно что это маленький бизнес большой контента достаточно много поэтому мы сразу с места в карьер и Пока мы в общем-то дожидаемся doda На текущий момент это два бизнеса это сеть пиццерий сеть cfe and drink суммарно заведений у нас больше тысячи более 20 стран э вся история нам генерирует по пицце где-то в Пике до 800 с лишним заказов в минуту А в Псах или там битах секу порядка в Псах вот так вот условный Пятница вечер Это что-то в районе 10-15 РПС Я думаю это соответственно это не пиковая нагрузка естественно мы держим больше у нас бывает больше это база Окей А кажется что мы можем начинать Серёг стартуй Удачи тебе всем Ещё раз привет Поговорим сегодня с вами на вечную тему а именно об управлению надёжностью и внедрению сло к сожалению в рамках этого доклада я не буду давать какие-то готовые рецепты серебряные пули но просто потому что их не существует поэтому это будет такая история про забеги по граблям на длинное дистанции и возможно какие-то из наших граблей они станут для ва новое решение или хотя бы вдохновение Ну если так действительно произойдёт значит я сегодня пришёл сюда не зря Поэтому будет немножечко сумбурно Я буду рассказывать реальную историю в которой все факты персонаже и события они реальны для того чтобы понять откуда в нашем обиходе вообще появились слова сре сло Надёжность кнм се в 2018 уже достаточно далёкий вспомним как мы в кавычках управляли надёжностью на тот момент поступали Мы очень просто мы громко падаем и героически заката в рукава всем it уходим на 2-3 недели а той месяц чинить прод заниматься тех долгом и вспоминать что не только фичами едиными ещё бы в стабильность неплохо вложиться через какое-то время этот цикл повторяется и так мы живём до 21 апреля 2018 года Понятное дело что эта стратегия изначально проигрышная Но это был стартап были другие приоритеты И вообще время было интересное 21 апреля 2018 года Мы очень громко неприятно и надолго упали прямо на старте рекламной кампании то есть что произошло по телевизору идёт реклама которая призывает заказывать дода пиццу в эту рекламу естественно в буха на огромные деньги а при этом наш сайт лежит наше мобильное приложение лежит и все сервисы за которые отвечает работа пиццерии тоже лежат соответственно мы несём огромные финансовые репутационные потери Да мы ожидали что подобная реклама она вызовет пик нагрузки Да мы готовились но не хватило туринга Практик знаний опыта и так далее в очередной раз ВС из пепла поднял Мы уже на практике на собственной шкуре осознали что Ну так дальше не пойдёт нужно что-то менять именно Эта история для нас стала точкой отсчёта примерно отсюда у нас начинают постепенно появляться такие вещи как нагрузочное тестирование и плавне начинает медленно внедряться культура сре про Этот великий день можно почитать на хабре почитать Почему мы упали что мы делали в конце ссылочки все будут Сразу говорю что я не буду в то ты миллионный раз пересказывать сейчас терминологию Что такое сло слая бюджет ошибок сре и так далее есть две прекрасные синие книги погружаемся читаем кому интересно и на последнем слайде оставляю ещё одну ссылочку на доклад Данила марданова с прошлого девопса его тоже можно посмотреть погрузиться в тематику логично что наше внедрение сре началось с постепенного внедрения сло так как я уже говорил что считаю это крое угольным камнем всей культуры и логично что нам хотелось как-то алер на наш бюджет ошибок на какие-то ивенты которые по нему бьют и желательно это делать до того как всё это закончилось для того что чтобы понять с чего мы это начали и что мы сделали не так попробуем разобраться на примере сервиса на который днём приходят 2.000 запросов в минуту тут число подобрано просто для удобства расчётов ночной трафик сильно падает при этом специфика такая его отсылает рейд пяти соток а стремимся мы к сло 4 Т девятки Простите на месячном интервале соответственно Имея это всё Мы достаточно просто можем посчитать наш бюджет ошибок переводим месяц в минуты получаем что мы за месяц можем про факапить 86400 запросов соответственно Нам нужен какой-то Арт который сработает до того как этот лимит будет исчерпан sre Workbook описывает Готовое решение для этого которое называется как slo Alert с Burn Rate который в общем-то построены поверх вашего Sli и бюджета ошибок А что это такое именно с этого мы начали с вами внедрение SL причём по принципу Ну вот sre Book - Это хорошо написано там тоже хорошие вещи Ну значит будет работать то есть мы были молоды глупые не проанализировали пошли педали код Ну потому что хотели потому что могли подобный Арт в базе состоит из двух ча в более сложном варианте из четырёх это опять же всё в кбу имеется эти две части призваны к тому чтобы снизить количество ложных срабатываний они работают на разных временных интервалах Т1 Т2 как правило это 5 минут в час то есть один короткий другой длинный это нас защищает от того что Арт будет работать лишний раз и делает логику следующей если мы натягиваем всё это на пяти сотке то первая часть алерта у нас помогает тому чтобы Арт срабатывал на высокие спайки за последние 5 минут либо по второй части на какой-то значительный фон то есть мы отбрасывая короткие спайки и какой-то незначительный фон э породи срабатывания здесь построены на Формуле бюджет ошибок помноженный на Рей бюджет ошибок понятно это единичка минус сла А birn rade - это просто по сути ручку для управления Чем выше крутим Бей тем на большее количество ошибок алер срабатывает соответственно Тем более это сработка для вашего бюджета ошибок губитель на бумаге у нас получается Всё прекрасно У нас есть готовый Арт э в нём есть ручка управления Он построен на бюджете ошибок а не об чём и он у нас защищён от ложных срабатываний на практике же получается история немного другая подобные алерты прекрасно работают на Большом трафике но дико шумные на Малом откуда наш Малый трафик появляется а в 1112 ночи на тот момент когда мы всё это внедряем большинство наших заведений находится в Моском часовом Московском часовом поясе и в 12 банально закрывается соответственно все наши заказы стремятся к нулю и утягивающее какофония из алертов не утрирую абсолютно реальном случае дежурному приходит ночью алер дежурный просыпается смотрит на картину понимает что его разбудила буквально ну одна пятисотка ругается на всё это плохими словами на Арт на того кто его внедрил не подумав ставит Санс и Вполне вероятно через час он проснётся снова но уже подругому сервису для того чтобы понять где у нас вот этот вот корень зла в виде малого трафика Давайте немножко посчитаем посчитаем на В каком породе в виде rpm пяти соток у нас сработает этот ляр конкретно каждый его сть формула получается простенькая мы считаем сам прок срабатывания как ТП умноженный на rpm на Рей и на бюджет ошибок делим всё это осново на Т чтобы перевести в rpm и получается формула простая из трёх показателей с которой мы с вами получаем что первая часть арта пятиминутная у нас сработает при берете 10 на 20 ошибках в минуту а вторая на дети ошибках в минуту это всё справедливо при условии что сервис у нас лежит полностью в лёжку отдаёт только пятисот и объёмом трафика плюс минус постоянно это оценка Казалось бы всё всё логично всё нормально но так как мы знаем что трафик ночью падает заменяем наши 2.000 на 200 а то и на 20 и получаем то что этот алер будет буквально взрываться от 1но пяти сотки здесь поэтому хочу сделать паузу и призвать вас к тому что если Вы соберётесь у себя внедрять подобные алерты померь их конкретно об ваш объём трафика здесь привёл небольшую формул в конце опять же оставлю ссылку для того чтобы всё это сейчас не превращать в скучную лекцию на несколько большее количество формул которые мы вывели пока с этими алерта страдали Но от того что мы тут сейчас всё посчитали и разобрались в причине проблема-то никуда не ушла на самом деле мы пробовали задирать рейты Ну потому что ну вот есть ручка для управления Давайте ей покрутим приведёт это у вас в итоге к тому что на Боевой нагрузке ваш алертс работает слишком поздно То есть вы продолжаете какой-то инцидент потенциально а ночью у вас на Малом трафике ничего не изменится поэтому поступаем по итогам страдания максимально просто раз этот алертность Но пусть он ночью просто не работает Давайте его ограничимся алертность уже проверенный и на постоянном ночном трафике он будет работать плюс-минус нормально Вопрос Как реализовать естественно посыпались идея давайте подсади промес крон Пусть он там что-то переключает естественно это кратчайший путь к тому чтобы ваши инстансы оказались в некон систентки на зарубежных интернетах рекорди рул для прометеус делаем следующее ограничиваем работу при помощи рекорди руло которые для первого варианта алерта возвращают в единичку когда текущее время с 8:00 до 11:00 по Москве для ночного соответственно наоборот с 11 до 8ми по Москве таким образом ограничиваем работу да компромисс но мы на самом деле живём с ним до сих пор показывает он себя хорошо А из этого вытекает следующее разным сервисам хочется выставлять разные девятки разным сервисам хочется выставлять разные рейты понятное дело есть там какие-то дефолты но всё равно хочется переопределять в зависимости от объёма трафика и особенности конкретного сервиса Ну и разные энки по ночам тоже выставлять хочется это всё рождает рядом с алерта локальный сервис рест небольшой который это в общем-то все эти настройки описывает вот то если посмотреть а на скриншот видно что у некого сервиса Example э днём SL 4 дет рейта 102 на разных временных промежутках а ночью алер работает Если А количество ошибок на определённом интервале Времени превысит 50 из этого всего у нас рождается группировка сервисов первая наша а мы выделяем сервисы критического пути это сервисы без которых нельзя создать заказ То есть это мобильное приложение сайты какие-то и бки То есть те сервисы которые приносят нам деньги напрямую А следующие сервисы это сервисы важные но не Крит путь это как правило сервисы внутри пиццерий без которых можно но очень больно придётся что-то записывать на бумажке потом вносить в систему ну не жизнь у них SL мы ставим Три девятки Ну и всё остальное условный сервис который на телевизорах в пиццерии рекламу крутит упадёт неприятно но не смертельно но опять же Нет поводов за ним и его стабильностью не следить что могу сказать прожив с такой схемой алертов несколько лет сами по себе алерты на birn rade - это штука дико автономная и надёжная Вы один раз выставили сервис он у вас как правило ежедневно не меняется подобрали рейты в зависимости от критичности срабатывания алерта соответственно тоже Про них забыли но при этом эта штука ужасно показывает себя на Малом трафике одно из потенциальных решений вот я вам подсказал а они же нам дали понимание того что одних алертов недостаточно об этом дальше поговорим и они нас подтолкнули к группировке сервисов с которой мы живём до сих пор А что значит одних алертов недостаточно алер это конечно прекрасно но э вещь сугубо реактивная То есть он пришёл какой-то сервис сломался требует внимания пошли починили хочется же иметь какой-то инструмент который будет показывать тренд надёжности сервиса то есть на этой девятке было сто на этой неделе было столько девяток на следующей стало столько а потом стало вот только мы всё это анализируем и как-то уже через это влияем на клок сервиса принимаем решение сделать простенький инструмент который в первую очередь покажет динамику Sli То есть как меняются девятки а во вторую очередь покажет динамику по latency Казалось бы Причём здесь latency Ну какая разница сколько девяток выдаёшь ваш сервис хоть шесть абстрактных условных cloudflare 100% сл как известно а но при этом Если всё тормозит пользовать эти этим всё равно невозможно поэтому хотелось контролировать на тот момент два этих показателя а начнём именно с latency так как это у нас был более нестандартный вариант мы для подсчёта и оценки latency на тот момент решили использовать apdex apdex - это некоторый индекс оценки производительности приложения он считается достаточно просто нам нужно немного статы нам нужно Какая нужна какая-то операция её название которое происходит в вашем приложении и время её работы для этого времени мы выбираем пороги т и F и стремимся к тому чтобы наша операция отрабатывал за Т либо же быстрее если это действительно так мы считаем что наша пользователь довольны если операция выбивается в диапазон между т и F F - это как правило 1,5т 2Т подбирается тоже индивидуально то мы считаем что пользователи в целом удовлетворены Ну так на четвёрочка с минусом и если пробиваем F то пользователи разочарованы Всё у нас плохо из этого всего мы считаем сам адекс мы берём количество операций в каждой зоне берём количество операций где пользователи довольны половину операций где пользователи удовлетворены делим на общее количество получаем коэффициент от нуля до единички оцениваем очень просто чем ближе к единички тем наш сервис быстрее выше сильнее А почему мы выбрали именно apdex во-первых прекрасно на мир Веба натягивается то есть берём НПО берём реквест Time для реквест подбираем какие-то пределы считаем живём с этим А почему мы не выбрали на тот момент классический центиль условно девяносто пятый девяносто девятый потому что у нас были планы в том числе привлекать бизнес к анализу надёжности работе с ней центиль оценить без контекста весьма сложно то есть допустим мы с вами взяли какой-то условный абстрактный девяносто пятый центиль попои у сервиса за неделю посчитали получили 250 мсн довольно пороговое значение для какого-то сервиса это неприемлемо медленно а для сервиса который выгружает отчёты за полгода это в целом нормально поэтому центиль так просто посмотрев на него и не разбираясь как сервис устроен оценить достаточно сложно плюс классические проблемы того что внутри ценителя запросы непонятно как распределены куда смещ к началу ценителя или к концу ценителя а что происходит за ценителя мы вообще не знаем Почему все остальные запросы не попали в 250 миллисекунд потому что они за 260 отработали или за 1250 в адекс эти проблемы отсутствуют это простой коэффициент от нуля до единички просто бросив взгляд оценить Может кто угодно он и бизнесу в том числе более понятен не надо бизнесу объяснять про какие-то там миллисекунды цен Дели и так далее ну и за счёт того что адекс - это по сути подреза ная формула среднего взвешенного он смягчает проблему с с распределением для того чтобы посчитать это всё конкретно в нашем случае мы договариваемся что наш Т - это девяносто пятый квантиль по реквест тайму за неделю А мы договариваемся о том что наш это полтора Т Но не более 2 секунд и придумываем для адек понятные нам зоны оценки зелёную жёлтую красную а т мы пересчитывается по ин понтом наших сервисов тот самый девяносто пятый квантиль сравниваем со значением которое было на прошлой неделю получено если это значение уменьшилось то есть сервис стал работать быстрее мы задаём себе новый порог значение сохраняем старые выбрасываем если ничего не поменялось Ну ничего не поменялось считаем дальше так же чтобы посчитать сам адекс мы пересчитывает до сих пор мы выгружаем наши запросы за сутки и за неделю чтобы получить значение на разных интервалах считаем из них сколько укладывается Вт Сколько от тдф и так далее и по формуле которую я выше показывал мы считаем сам КС с сло всё гораздо проще получилось Мы точно также ежедневно берём количество запросов успешных за сутки и за 7 дней считаем количество неудачных запросов Какие вернули пятисотый код из этого всего считаем сами девятки как едини минус е де на C умноже на 100 считаем бюджет ошибок формула уже мелькала и считаем остаток бюджета ошибок в двух вариантах в абсолютном числе и в процентах сколько у нас его осталось для того чтобы этой всей радостью управлять мы рождаемся девятки это четыре В данном случае задаём список эндпоинт по которым хотим считать адекс для эндпоинт мы можем конкретно указать Т какое-то значение если мы не хотим считать его автоматически и так как этот инструмент задумывался как вещь которая будет разработчиком в условный слаг отправлять отчёта о состоянии их сервисов сколько там девяток сколько там адексат отчётности канал слаке и частота мы могли отправлять либо раз судки раз в неделю преимущественно у нас смотрели ребята раз в неделю на это а в итоге первая итерация для конеч пользователей выливается в два достаточно таких кух отчёта первый отчёт показывает фактические девятки девятки к котором мы стремимся остаток бюджета ошибок и цветовую индикацию То есть если бюджет ошибок остался отчёт зелёный если не остался красный с адек сом Аналогично эндпоинты посчитано значения цветовая индикация насколько Мы в наши Т иф укладываемся и общая индикация по всему отчёту но выводы на самом деле по первой итерации достаточно грустные Несмотря на то что наш SL отчёт достаточно показатель он получился он действительно зелёный если у сервиса всё хорошо он красный если у сервиса всё плохо но тут вообще было сложно промахнуться весьма эти отчёты не стали каким-то массовым инструментом который стал драйвером управления работы с надёжностью на него как правило смотрит преимущественно команды критического пути э критических сервисов сло 4 девятки остальные вообще не понимают что это и зачем она в их жизни появилась э на бюджет ошибок как показала практика мы не смотрим А мы смотрим на разницу между SL и SL такая наша локальная адаптация Ну и сам адекс в принципе это было ожидаемо он на Малом трафике показывает температуру Луны поэтому мы адекс для части сервисов просто отключаем на тот момент э анализируем всё это понимаем что Раз уж Мы встали на скользкую дорожку внедрения СР ило и так далее то нужно додав нужно решать проблему не наматывать на кулак сопли идём думать головой и собирать обратную связь с разработчиков получаем следующее э в массах своих разработчики плохо понимают Э что делать с красным отчётом то есть вот девятки просили Как узнать причину куда раскапывать что смотреть аэ люди из бизнеса которые тоже находятся в этих каналах в слате они смотрят на эти отчёты но воспринимают их как Белый шум имне понятно что за S Что за девятки опять там что-то инженеры придумали Лучше бы уже в конце концов хороший код писали а разработчики заряженные разработчица критического пути э от них приходит Fish реквест они хотят какое-то место э для отчётов куда они Бут будут записывать причины просадок для того чтобы потом этим уже реально пользоваться для того чтобы как-то влиять на тех долг в целом на клок сервиса а также у нас возникает мысль а не привлечь ли нам продуктов к управлению надёжностью S Потому что им тоже ни разу не по кайфу от того что их сервис Может в Рандомный момент времени упасть упасть сильно их разработчики просто уйдут на неделю на две заниматься тех долгом А для этого Неплохо бы научиться считать SL на основе бизнесов метрик а не на основе абстрактных пяти соток первую проблему непонимание мы закрываем достаточно просто мы делаем два воркшопа воркшоп текстовый туториал Независимый ни от чего который можно в любое время пройти Кому угодно первый сказывает о том как в общем-то отчёты работают они объясняют что мы считаем дают мотивацию почему это важно зачем это считать и учат это всё настраивать для своего конкретного а сервиса а второй воркшоп как раз-таки рассказывает о том как нам узнать почему наши девятки просели он включает в себя два дашборда первый дашборд достаточно простенький из трёх графиков состоит на Первом графике у нас а в качестве точек отображены алерты эти алерты мача на пике пяти соток а пики пяти соток в свою очередь на исключение приложения если таковы были ожидаемый флоп следующий разработчик сюда приходит смотрит когда были алерты так как мы на тот момент договариваемся что так наши алерты построены на бюджете ошибок они у нас наиболее губительные для этого бюджета в общем-то мачит это на пти пяти соток выбирает какой-то самый критичный по его мнению из этого всего проходит кликнув по графику исключений в ки бану а там он уже на своей территории он прекрасно ориентируется в логах своего собственного сервиса он их изучает понимает что было за проблема И нужно ли что-то прямо сейчас с ней делать второй дашборд Он больше информативный он посвящён адекс он показывает его динамику чтобы просто видеть тренд опять же мы начинаем работать лучше или хуже у нас адекс растёт или падает он показывает предел автоматически посчитано ТФ и показывает на сдачу распределения внутри адекс сколько у нас запросов Какие минги укладывается то есть 150 миллисекунд 200-250 и так далее история сугубо информационная ничего никому не призывает проблему массового непонимания среди не технарей мы закрываем следующим образом мы к тому моменту уже смиряется что на бюджет ошибок мы не смотрим что мы смотрим на разницу SL S и рождаемся разгруппировать следующее если сервис КД пути соответствует четырём девятка значит он в Зелёной зоне значит можно топить газ в пол Значит мы делаем бизнесов фичи У нас всё хорошо если тот же сервис КД пути он находится в диапазоне от 4 де до 3 С поно значит он в жёлтой зоне Пока ещё всё не так плохо но есть уже Повод задуматься и возможно взять какие-нибудь задачки е их долго на стабильность А если мы пробили 3,5 детки Значит мы в красной зоне срочно нужно всё исправлять для остальных сервисов проще для них жёлтого нет для них либо соответствует зелёный либо не соответствует красной это всё вырождается вот такой вот дашборд в фане А с цветовой индикацией с ним а достаточно интересная проблема возникает хочется сделать его удобным Чтобы привлечь к нему максимальное количество людей Потому что если ещё и неудобный инструмент в управления надёжностью людям дать вы никогда никогда никакие девятки не внедрить нам хотелось объединить всё удобно в одну таблицу поступили не очевидно но просто дали нашим сервисам их названием эмоджи которые обозначали критичность и на них же завязали правила раскрашивания оверрайд в фане это тут к слову о том какие Иногда приходится до смешного принимать решения для того чтобы сделать UX лучше работает это кстати до сих пор у этого дашборда рождается брат Близнец мы считаем что на него будут смотреть продук он отличается тем что девяток на нём нет он показывает всё то же самое цветовую индикацию но в режиме в режиме ОК Не ОК к нему же мы пишем для по огромный вот такой вот воркшоп который не содержит в себе ни единого технического термина но рассказывает как всё это читать и что с прочитаном делать то есть если твой сервис красный либо жёлтый что с этим делать Куда бежать Кому звонить и так далее но к сожалению эта вся история помирает толком не родившись я честно не уверен что хотя бы один прок всё это прошёл от до конца прочитал и просмотрел и мы на тот момент решили пнуть эту историю Хотя идеи ещё оставались по привлечению бизнеса к управлению надёжностью последнюю проблему с местами куда записывать мы решаем следующим образом перед тем как прислать отчёт в слаг мы создаём по сервису пустую карточку Вот она справа на слайде с метода записываем что это за сервис был какой-то номер недели эту карточку прикладываем к отчёту в неё в течение недели можно запи если например разработчик по сервису дежурит какие-то инциденты случаются он туда всё это фиксирует а карточку созданную на прошлой неделе аналогичную мы заполняем уже посчитано данными по Sli в ней соответственно есть в идеале записи фу ожидается следующий разработчик приходит в отчёт он из него попадает на дашборд и попадает в карточку созданную либо на прошлой неделе либо на текущий при помощи дашборда если этого ещё не сделал анализирует причины причины фиксирует в карточку Либо они у него там зафиксированы уже превентивно и ему Остаётся только лишь принять решение вот эти вот проблемы сматчить на такие-то девятки что делать всё хорошо или всё плохо Для того чтобы окончательно всю эту в одно систему закольцевать Мы подвязываем наш светофорный дашборд к этим же карточкам вот на слайде видно пример заполненной карточки с просивший сло и получается история следующая Можно прийти на дашборд кликнуть по красному либо по жёлтому попасть в карточку и в карточке прочитать Э что пошло не так и что с этим сделали для того чтобы на старте культуру качнуть а команда sre текущая А подвязывают этот процесс на себя раз в неделю она открывает дашборд кликает на жёлтое на красное проваливается в карточки читает причины читает что с ними планируется делать если читать Нечего Она идёт к ответственным разработчикам и раздаёт волшебные Пинки таким образом процесс начинает постепенно помаленечку потихонечку работать пока этот процесс раскачивается наши чёрты претерпевают некоторые изменения что здесь очень важно Это то что эти изменения сделали сами разработчики То есть это на мой взгляд хороший показатель того что инструмент реально нужен и им пользуется потому что кто будет контрибьютор который никому не сдался из отчёта по SL с девятками они выбрасывают данные по бюджету ошибок Потому что никому не интересно как я уже говорил а делают это визуально более приятным Но самое интересное касается адексат как мы уже смиряется опять же с тем что у нас А на тот момент не получается привлечь бизнес к управлению надёжностью а то разработчики вносят предложение Ну нам этот адекс ну неудобен мы погружены в свои собственные сервисы мы знаем как они работают давайте уже центиль Мы хотим м конкретные тайминги видеть а не от нуля до единички что-то непонятное мы говорим О'кей ребята идут отказываются от адексат расчёт ценителя и кроме расчётов они добавляют следующий момент А им хочется фокусировать своё внимание там где надо и не фокусировать там где не надо поэтому они свои эндпоинты разбивают на три группы первые эндпоинты критические и блокирующие То есть это эндпоинты которые непосредственно на User Experience влияют они работают синхронно и без них сервис по сути бесполезен на них надо смотреть в первую очередь а вторые эндпоинты также блокирующие синхронные но уже не критичные за ним мы следим во вторую очередь и оставшиеся эндпоинты - это некоторые не блокирующие то есть которые там что-то запушил в очередь отдали 200 на них мы смотрим вообще в последнюю очередь Ну мало ли что-то с ними тоже пойдёт не так и повторюсь что всё вот это вот проделали разработчики В итоге это родилась такая вот табличка и мы этим Поль до сих пор в общем-то но проблема у нас к сожалению подкралась Ну не то чтобы откуда не ждали все всё Понимали Понимали как всё происходит я говорил что будет немного сумбурно к тому что любой процесс соответствия управлению любой процесс соответствия определённым ожиданиям надёжности и сло он Простите немножечко оговорился Давайте там вернёмся немножечко назад Выводы какие у нас по второй итерации получились А у нас получается следующее Да у нас не получилось привлечь пок управлению надёжностью это оказалось на тот момент совсем сложно и не нужно А в остальном выводы Вполне себе интересные и позитивные централизованный процесс он работает он работает хорошо Да он завязан пока на конкретных людей но тем не менее мы по нему живём мы по нему поддерживаем свой уровень определённой надёжности дашборд с девятками получился удачный он висит в офисах на телевизорах чтобы привлечь внимание общественности мы раз ВД недели рассказываем о нём на апдейта инфраструктуры чтобы опять же кого-то призвать к совести напомнить что есть такая вещь как Надёжность что мы за ней следим мы всё считаем Ну а разработчики на сдачу сами дорабатывает инструмент это значит в общем-то инструмент полезный А чего ещё хотеть но проблема к нам подходит немножко из другого места как я уже вот немного проспорил любой любое соответствие определённым уровнем надёжности оно за собой тянет Непременно процес окола и когда к нам в общем-то у нас всё это заработало у нас заработал процесс с девятками мы существовали примерно по следующей модели картинка взята из devops topologies она описывает модель фейк sre суть её в том что у нас есть команда разработки У нас есть команда sre но sre - это на самом деле настоящее сре - это вчерашние переименованные админы А мы несколько ушли от этой модели наши разработчики на тот момент сами катили на прод сами в случае чего откатывать были все инструменты часть разработчиков дежурила по части сервиса в течение рабочего дня как правило это был Крит путь но стена ещё сохранялась вот эта вот через которую перебрасывают в том плане что большинство разработчиков они всё равно не понимают Как устроен прод И большинство разработчиков опять же не понимают как их сервис может ломаться за пределами рабочего времени то есть грубо говоря в пятницу в 8:00 вечера или а в субботу ночью э если отображать это на наших реальных процессах то было следующее с продом происходит что-то плохое Ну неважно абсолютно какого масштаба это вызывает алер Арт по сервису если по нему есть дежурный разработчик прямо сейчас и сейчас рабочий день он падает Этому разработчику разработчик разбирается у того разработчика который он дежур у него для этого всё есть во всех остальных случаях этот алертс в сре сре по сути отвечает за всю систему после 6 вечера ночью в выходные в общем-то всегда когда не рабочий день до определённого момента это работало но бизнес начал раскачиваться и расти у нас стало больше стран у нас стало больше сервисов больше фич то есть банально больше изменений в коде которые вызывают больше инцидентов да эти инциденты не такие масштабные как мы грохнули в начале нашей Федеральной рекламной кампании но тем не менее когда ваш продакшн он то там то здесь и в любое время дня и ночи это всё равно тяжело и всё это валится на одну команду сре В итоге заканчивается это тем что часть команды сре у нас просто встаёт и выходит со словами Ну ребята у вас конечно Тут всё круто вы инженерную культуру развиваете сло туда-сюда но мы физически устали мы физически не вывозим вроде как улучшение не планируется мы пойдём а плюс надо понимать что на тот момент дежурство сре оно компенсировал с исключительно дополнительными выходными Нони в какой-то денежной форме а команда sre она уже частично состояла из разработчиков и разработчики задавали вопросы вида Ну а где же в общем-то справедливость почему вот мы разработчики вот там за стенкой тоже разработчики но когда прот ночью валится только нас больно тыкает палкой при том понимание что разработчиков на текущем масштабе уже нужно привлекать полноценному дежурству по всем сервисам оно было но упиралась в надуманные проблемы как только заходили разговоры начиналось во-первых то что разработчики 200 ПС человек они не будут дежурить бесплатно и в общем-то правильно сделают э из этого вытекает вопрос А как считать А сколько платить А вдруг все разработчики наши разбегутся если мы заставим их дежурить и вообще компании это будет слишком дорого как будто бы давайте Вы придёте потом а потом настал Потом пришёл в виде того что остатки команды сре они пришли к си левел и совместно договорились о следующем решении мы оставляем наших разработчиков на дневном дежурстве как есть сейчас но исключение составляет в том что мы привлекаем к дежурству вообще всех разработчиков до последнего каждый дежурит по своей зоне ответственности э так как это дежурство дневное и Это рабочий день никто никаких дополнительных денег не получает а вечернее ночное дежурство мы передаём первой линии технической поддержки крутые ребята которые по сути уже находятся на дежурстве они уже получают почасовую оплату Они прекрасно разбираются с точки зрения пользователя Как устроена система и умеют оценивать прекрасно Импакт и понимать его критичность насколько большая проблемы единственное чему их нужно научить это давить нужную кнопку чтобы привлечь разработчика если есть понимание что он реально нужен соответственно для этого начинают разработчики дежурить на второй линии 24 на 7 и за это они уже получают денежные компенсации сре по сути становится такой же сть очень уникальной специфичной командой разработки которая тоже дежурит на второй но теперь дежурит исключительно по инфраструктуре только по своей зоне ответственности после того как всё это заработало Ну что произошло А вот ничего не произошло компания не обанкротилась никто не потерял деньги оказалось так что платить компенсации в общем-то гораздо дешевле чем громко падать потом героически восстанавливаться и мы начали перетекать немножечко к другой модели она тоже описана в и она называется как команда инфраструктурной платформы грубо говоря среди разработчиков степенно с дежурством у нас выделяется часть людей которые в силу своей инициативности заинтересованности они особенно погружены в вопрос того как продакшн устроен они начинают по нему приносить обратную связь задавать правильные вопросы требовать какие-то фичи то есть мы как команд управляющей инфраструктурой получаем источник обратной связи О продакшене а сама команда бывшая сре она становится командой которая делает свой продукт в виде платформы и выдаёт разработчикам по сути в качестве сервиса для того чтобы те своим софтом могли Независимо и удобно управлять к такой модели Мы сейчас идём к крепкой поступью она Нас устраивает что будет дальше Ну посмотрим А к чему мне хочется призвать конкретно вас И какие выводы сделать А мы до сих пор следим за разницей сла и сло бюджет ошибок в чистом виде как описано это в sre Book у нас не поехал не полетел а мы делим ответственность дежурят все вообще все каждый инженер в компании дежурит по своему сервису более того в какие-то особенные пики продаж мы привлекаем к дежурству в качестве Третьей Линии C level если уже совсем что-то пошло не так Ну мало ли процесс с карточками на фоне этого Он растерял свою актуальность так как разработчикам приходит обратная связь о состоянии их продакшена непосредственно от продакшена а не через Вот какой-то вот сложный процесс Вити Ивата и в котором нужно что-то заполнять и куда-то кликать по каким-то дашборда но чисто технически он работает И если мы его снова захотим возродить мы сделаем Это буквально за день чему хочу при ва я вас хочу призвать к здоровому скептицизму и през реальности не повторяйте наших ошибок Если вы уже взялись у себя внедрять что-то из культурного пласта сре будь то алерты управление инцидентами и так далее померь это конкретно об Вас Вот как вот с артами най померь их конкретно об ваши объёмы трафика об ваши процессы об вашу инфраструктуру смотрите что из этого получится не повторяйте наших ошибок сейчас это возможно звучит очень логично и очевидно но на тот момент нам было достаточно сложно жаться от внедрения очередной крутой штуки которая кажется тебе Серебряной пулей Хотя ты знаешь что их не существует Но не хватило знаний кругозора и так далее Как видите ничего из того что я описал из S Book у нас не полетело в чистом виде всё пришлось адаптировать и эта адаптация шла через боль и набитые шишки ссылочки как обещал статья про наше падение 21 апреля восемнадцатого года формула дополнительные для оценки алертов чтобы это всё можно было посчитать кому интересно доклад про сло От Данила марданова с пса и мой Telegram Если вдруг останутся вопросы уже после окончания конференции и на этом всё всем спасибо спасибо Серёг Есть ли вопросы Из зала есть да привет Спасибо за доклад понятный на самом деле путь интересный я сам тоже выступал этим летом рассказывал как мы проходили путь внедрения сло в купе Есть вещи которые пересекаются есть которые идут ну как бы в сторону и где-то лучше где-то хуже Вот мне интересно ты упомянул голосом такую вещь что сло на бизнес-процессы то есть было как бы такое дошли ли вы к этому идёте ели процессе в процессе То есть у нас сейчас старый инструмент всё ещё работает у нас разрабатывается Новый сервис если То есть раньше это делалось командой сре по остаточному принципу между падения прода то сейчас на это нанят отдельный разработчик выделенный и скоро мы потенциально к этому придём ещё вопросы Из зала пока Вопросов нет Вот у меня тоже созрел Вот ты в начале рассказывал про сервис рест а про то что он локальный у вас какая у него судьба что с ним происходит в тех местах он по-прежнему на самом деле работает но он сейчас осно становится основой для большого центрального сервис рест потому что потребность на него уже на самом деле весьма большая в том числе с точки зрения разработчиков не только с точки зрения сре То есть вы будете разрабатывать да буквально мы уже зади зайни и в этом году приступаем Окей Ну тут тоже в начале вы вводили центили Ты прямо доказывал со сцены что надо центиль не надо использовать центиль Потому что ты теряешь данные у тебя там попадает не всё ты не можешь на это реагировать ты не знаешь что там секунда Или 200 миллисекунд в этих 5% и там в о про но в итоге вы к нему пришли Почему ВТО мык нему пришли действительно изначальная идея была в том чтобы привлечь в том числе бизнес и дать им более простой показатель потому что обучать его Что сколько миллисекунд каких где На какие ценители смотреть Не смотреть достаточно сложно разработчикам хочется бы быть ближе к реальным данным пусть даже с тем компромиссом что какой-то кусочек Мы из этого теряем это всё равно можно Всё доктир тем же графиком Вот как я показывал распределение запросов внутри на всём промежутке Поэтому вот так как бизнес веч не получилось центе разработчикам оказался банально удобнее они основные потребители этой информации Как думаешь почему бизнес не стал использовать ээ вот этот вот светофорный дашборд где было Окей фейл кажется очень удобно э кажется очень удобно Да но по факту как бы массовое понимание того что такое Надёжность растёт того что такое сло растёт и пусть даже если на старте это непонятно это всё равно изучается через боль и падение того когда разработчики твои ходит на месяц заниматься ти долгом и тут хочешь или не хочешь приходится вникать в то что такое девятки поэтому те кто из бизнеса этим всем пользовался они на самом деле на основной даже по смотрели а всё это оказалось просто неактуально просто две копии одного и того же вопрос из зала комментарии о передам привет Спасибо за хороший доклад Ну вот меня смутило достаточно такой момент что ты получается тельно индикаторов в ночное время А вот не было не было ли запроса повышения чувствительности индикатора как раз в часы пик для того чтобы уменьшить боль клиентов То есть сейчас сейчас у тебя получается что у тебя точно такая же она остаётся как была вот может быть та на самом деле были но они не как таковые запросы так как у нас конфигурация всей этой история достаточно открытая Вот например разработчики опять же тот же инструмент для подсчётов пришли изза контри там где реально разработчики приходили к нам и просили рейты вот эти вот покрутить Либо они просто приносили реквест И говорили мы хотим вот такие пороги А нет я имею в виду наверное неправильно сказал с точки зрения бизнеса что что готов ли бизнес терпеть что у вас там в часы пик Да в процентном отношении там у вас допустим там о про ошибок в количественном получается у вас там допустим Не знаю там 100000 клиентов у вас не могут заказать пиццу Ане бы тот на самом деле масштаб чтобы говорить ф мы с такой проблемой В итоге на практике не столкнулись у нас скорее было наоборот у нас всё это срабатывало слишком рано и слишком быстро Спасибо ещё один вопрос из А я передам тогда да спасибо за доклад смотри ты в начале говорил прой как их тюл и так далее потом адек который вообще классная штука вообще всё здорово А под конец такое ощущение что они оба исчезли что осталось на что вы стали смотреть мы смотрим на самом деле всё то же самое алерта с рейтами как я уже сказал это супер стабильная штука и они у нас работают до сих пор вот то что я показывал на слайдах вот эта вот схема переключения день-ночь алерты с рейтами они работают они нам приходят они приходят разработчикам в том числе мы от них никуда не отказались У нас остался отсчёт по девятко у нас в общем-то остался видоизменённый отчёт пон в котором мы от адеса отказались заменили на центе У нас сейчас в процессе новый инструмент оно всё видо изменилось но оно на самом деле в глобальном плане никуда не ушло у хорошо вот это адек Он хороший или плохой всё-таки по итогу раз отказались смотря опять же для чего кто на это будет смотреть нам на старте казалось что хороший но наши основные пользователи этого инструмента сказали ну нам не подходит то есть те кто близко к сервисам они хотят видеть Реальные цифры я наверное от себя добавлю тоже прокомментируй и больше не буду бегать с микрофоном А по поводу адеса с чем столкнулись ребята Когда смотрят на число от нуля до едини им в голове Ну большинство разработчиков обратно эту формулу развернуть потому что не 100% разработчиков помнят что такое адекс и по какой формуле он считается и что такое зелёное Что такое не зелёное если это зелёное то оно правда зелёное или неправда сомнение а а вот комментарий разработчика как раз да на самом деле адекс отличная штука когда тебе нужно сказать упало не упало Ну типа тебе надо туда лезть или нет это индикатор Да а у нас поскольку уже есть индикатор с там и ошибками Нафига нам ещё адекс типа адекс не несёт дополнительной информации тебе когда ты разбираешься С инцидентом адекс тебе не даёт дополнительной информации он тебе говорит что всё плохо но мы уже знаем что всё плохо у нас уже алерта всё ну это такое больше дополняющего всем понятный ценитель но тут Наверное стоит сказать что инцидентов ну мы не можем Всё время потратить на то чтобы а как-то улучшать систему мы тратим время на то чтобы писать фичи И вот это вот время на улучшение системы если это не совсем уж субботник тогда мы совсем уходили всё чинить а вот это время оно тратилова люди которые живут в хорошем мире вот Антон но он на адекс не смотрел смотрел всё-таки очень нравилось но инцидент уже случился а Возьми микрофон Прокомментируй пожалуйста я говорю что когда мы боролись с мы смотрели на а не нак больше ну то есть что логично вот с чем боролись на то Ну то есть мы боролись когда с Да у нас было ощущение что там больш мы смотрели Нан когда мы реагировали на инциденты мы смотрели на и в итоге типа я посматривал но особо сильно смысла он честно не имел в связи с остальными метриками которые у нас были А метрик у нас благодаря ребятам было дофига Ну в общем-то Да классная штука но в общем-то никому не нужна для записи ещё вопросы Из зала Данил автор того самого доклада по сло который есть да спасибо большое за доклад У меня как раз по Аксу догоняющий вопрос откуда взять те самые данные об ности пользователей опыт подсказывает личный опыт подсказывает что это довольно непросто понять Ну да это правда довольно-таки непросто мы на тот момент в силу отсутствия опять же какого-то большого опыта кругозора просто ткнули Пальцем в небо и решили что ну девяносто пятый центиль это нормально девяносто девятый слишком жёстко а считать условное средне или максимальное ну это вообще мрак Поэтому вот поехали задача была запустить в целом систему хоть как-то завести Весь процесс а потом уже поченить тут Наверное важный момент что а на докладе Ну Сергей рассказывал что Ну вот это вот бейслайн для адек он автоматически подсчитывается то есть мы считаем что сейчас сервис Работает Он как-то работает и вот это вот девяносто пятый О'кей мы это считаем мы сейчас будем улучшать и у нас постепенно вот этот безлайн будет улучшаться Ну с точки зрения пользователя вот если как-то самый простой способ понять что вы нарушили сло даже если у вас его нету к Вам пришёл директор и сказал что всё плохо то есть даже если у вас нет сло У вас есть У вас есть бюджет ошибок Да да у вас есть бюджет ошибок всё так на этом спасибо Сергей Да всем спасибо"
}