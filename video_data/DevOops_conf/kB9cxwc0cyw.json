{
  "video_id": "kB9cxwc0cyw",
  "channel": "DevOops_conf",
  "title": "Александр Глухов (Deutsche Telekom IT Solutions) — 5 примеров, когда YAML стреляет в ногу",
  "views": 269,
  "duration": 808,
  "published": "2022-07-06T04:09:53-07:00",
  "text": "наш следующий спикер это александр глухов из дочь и telekom эти solutions и он выступить с докладом 5 примеров когда ям он стреляет в ногу александр работает в продуктовой команде которая разрабатывает функциональности для личного кабинета в целиком дае он является ментором и преподавателем во внутренней домов школе дойче телеком эти solutions скажу пару слов о докладе несмотря на обилие документации по стандарту используемым тулон и библиотекам многие разработчики продолжают руководствуются тем что я мол это язык си реализации данных для людей и пишет структуры полагаясь в основном на интуицию опыт иногда это приводит к так называемым выстрел в ногу и попыткам понять что же вообще пошло не так александр как раз собрал некоторые примеры из реальной жизни для того чтобы показать как зачастую просто это случается давайте поприветствуем александра всем привет меня зовут саша я работаю в компании дочь и целиком эти solutions экспертом по конфигурацию по дочь целиком эти solutions это стратегическое а эти подразделения дочь и целиком а крупнейшей телекоммуникационной компании в европе и в россии у нас реализуется проект и таких крупных заказчиков как ти мобайл shell бмв деятель continental швейцарской железной дороги в общем сегодня на докладе я хотел бы вам рассказать про 5 ситуаций когда я мол стреляет в ногу все мы знаем что я мол это язык для сериализации данных и все мы привыкли руководство с первым правилом дизайном этого языка что язык должен быть человек читаемым а нам что она мы нормально мы его читаем о соответственно можем писать и пишем мы как интуитивно но при этом нередко мы допускаем ряд ошибок которые мы совершенно не ожидаем давайте сегодня разберём у нас есть ситуации когда у нас несколько документов в одном я малфой ли в принципе в этом нет ничего криминального стандарт это поддерживает соответственно большинство ту лов с этим работает нормально но если мы будем использовать стандартный метод стандарты фильтр раньше был то у нас будет ошибка соответственно с python он у нас то же самое у руби достаточно интересная ситуация он загрузит только первый документ и выведет нам его но это технически тоже является ошибкой потому что данный у нас неполное безусловно one simple есть фильтр fram я могу который позволяет загрузить все документы в python есть метод который возвращает генератор со списком документов в ruby есть примерно тоже самое но мы должны заранее об этом позаботиться чтобы наши скрипты и наши play буки могли обрабатывать список из нескольких документов и очевидно что файл с несколькими документами требуют дополнительного внимания но особенно это касается deployment манифестов убери потому что там нас могут быть описаны несколько объектов и представьте файл называется одним именем а у нас там например кроме deployment а еще и сервисы и ingresso описаны и мы об этом не как заранее не знаем пока не заглянем файл вот так вот давайте поговорим про приведение типов я так думаю что вы до конца не представляете какие могут быть результаты если мы возьмем и загрузим сериале зиру им вот этот список версии вы все думаете что все будет нормально но раз и у нас три числа типа флот не ожидали такого а теперь давайте посмотрим список зон стандартные что вы думаете будет итогом сериализации раз и у нас два значения являются булевыми круто а давайте посмотрим на такую ситуацию когда мы захотим ван себе выставить на мире край цена созданные файлы у нас есть три типа записи и давайте посмотрим какой будет результат совершенно совершенно неожиданный все потому что если мы забудем лидирующей нолик и нами рик райт будут интерпретированы никак восьмеричное число а как десятеричная и результат создание такого файла для вас будет совершенно непредсказуемым в разрезе прав давайте поговорим про другие особенности ключ внимание может быть многострочный и может содержать пробелы ok если мы используем двойные кавычки то мы можем использовать escape последовательности значениях соответственно символы табуляции символы переносы строк для нас будут валидны me это очень круто давайте посмотрим как у нас заново у нас есть список из ключ-значение как вы думаете после сериализации какой вид он обретет внезапно все эти записи являются интерпретации с пустого значения ну давайте поговорим про как раз таки конвертацию булевых значений у нас есть ряд синонимов которые позволяют нам с конвертировать текст в булево это например true force is now on off и так далее есть такой усредненный pipeline скажем взяты когда у нас есть общие черты и мы хотим чтобы эти общие черты у нас использовать для нескольких окружений соответственно нас есть какие-то общие значения и значения январе мин специфик соответственно может быть стейджинг там system test смоук тест и так далее соответственно нам нужно подобрать значение под каждое окружение и данная данный pipeline данная добавка и плане у нас rendered in women специфика значения в наш чарт и соответственно мы релизом чарт с нужными значениями для нашего инвар мента допустим в общее значение у нас есть там версия и ветка с которую мы собирались к нам приходит опция и говорят ребята а давайте на ваших стейджинг окружениях мы сделаем такое регламентное задание которое позволит нам гасить коды и сохранять деньги экономить электричество и вообще благоприятно благоприятно относиться к экологии естественно если это потребует всего одной строчки я мало почему бы нам это не сделать мы добавляем текстовый лейбл costco вентру как попросили нас abs и с нашей клауд площадке после выполнения данной джаббы в плане что мы будем иметь а вот что и как вы думаете как этот чарт будет установлен релизом в кубер а вот так потому что в apple нельзя передавать булево значение и что вы скажете дело в такой ситуации ну ответ тут только один двойное экранирование но я хотел показать данный пример как пример что использование каких-либо токен of которые похожи на токены из описания типов земли может может обернуться вам не так как вы этого хотели изначально и поэтому вам придется использовать экранирование ну или что то еще подобное для того чтобы получить ожидаемый результат давайте поговорим про нестандартный яму как ямал вообще может быть нестандартным если взять докер кампус то они своеобразно допустим подошли к реализации якорей через x property ну да ладно в принципе выглядит одинаково единственное что атрибут вы должны указывать их дефис и пользоваться этими кореями но как же насчет самого вот этого принципа don't рипит весов это очень крутой принцип и если мы посмотрим сторону про метался а я сталкивался с такой проблемой то конфигурация про метался не поддерживает advanced яму и мы не можем использовать якоря и вот такие конструкции о чем собственно и говорит вот этот и шью который был закрыт моим тренером про митоз а что сказал мой тренер про метался он сказал что по дизайну но и языка конфигурирования они не хотят поддерживать advanced яму и не собираются и повторение самого себя это один из таких принципов конфигурирования их продукта в принципе я не вижу в этом ничего плохого и разработчик имеет право на свое мнение и на то как он видит свой продукт но я остался один на один со своей проблемой и мне надо как-то ее решить я хочу следовать принципам драй я не боюсь показаться глупым и всегда стараюсь задавать вопросы поэтому в этот раз и обратился к углу и нашел такой интересный инструмент он называется corvell войдите это замечательная утилита она заряжена мощностью языка star ларк и общем у неё огромное количество плюсов это один binary star ларк прекрасная документация вместе с плейграунда и полное соответствие принципам драй давайте посмотрим как я решил похожую проблему с прометею сам вот у нас есть просто файл шаблона в котором у меня ямал подобная структура которая соответствует конфигурации про метался и вы можете увидеть коричневым цветом помечены и конструкции star ларк это своего рода комментарии но комментарий особой конструкции вот имея такой шаблон я имею стандартный values файл с со стандартным валидным я блум и я его формируют так как я его захочу что дальше а дальше все просто у нас всего две команды с помощью войдите мы рендерим шаблон используя values и получаем готовую конфигурацию prometheus а и дальше мы можем ее проверить в pipeline инвалидность и мы можем ее проверить в плане на валидность это все что вам нужно сделать чтобы получить какой-либо конфигурационный файл какой-либо ямал файл вы также можете получать джейсон ки и войдите достаточно прост в поставке и в использовании вот пользуйтесь этой замечательной тулой я очень всем ее советую всем спасибо старайтесь не попадаться на уловки я мало и пользуйтесь им правильно"
}