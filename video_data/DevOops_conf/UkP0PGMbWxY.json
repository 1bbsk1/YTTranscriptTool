{
  "video_id": "UkP0PGMbWxY",
  "channel": "DevOops_conf",
  "title": "Иван Пономарёв — Ansible playbooks — это код: проверяем, тестируем, непрерывно интегрируем",
  "views": 7214,
  "duration": 2892,
  "published": "2019-07-01T07:07:57-07:00",
  "text": "жить и тут в зале есть кто-то кто он сам еще не пользовался на практике вообще просто хочет посмотреть о есть такие а кто ни за что не стал бы кодить на питоне вот просто вот смотрите если вдруг в этот по ошибке у нас есть других залах отличные доклады ну а мы поговорим про once i ball и у нас будет немножко кодирование на питоне и в конце немного о себе я работаю в небольшой собственной компании марал делаем софт на заказ по 1 неделю я преподаю на физтехе там на той же кафедры на которая когда-то учился и компанию нас небольшая мы работаем с полом заказчиков и мы поставляем им различные системы соответственно примерно диапазон проектов чтобы вы понимали там от самых простых каких как-то 3 звездочки которые вообще 12 сервера несколько десятков пользователей но это все должно стоять и работать у заказчика да ну вот это самый сложный проект наркоту который у нас сейчас есть в пуле в принципе я думаю что многие здесь присутствующих и и поболее как бы более серьезные системы разрабатывают и мы используем вот такую связку на года два как мы стали ее использовать то есть в облаке но ты разворачиваем те при помощи кира форма инси-блок мы соответственно конфигурируем все наши виртуальные машины для того чтобы ставить там то что надо когда мы начали использовать xml всего низким порогом входа и такой прекрасный экосистемы у нас стали появляться роли в соответствии с best practices и ролей стала накапливаться много-много для фронта для бэка для мониторинга для кэшей для логов для чего угодно и как все было вот у нас есть первый проект для одного заказчика 2 5 до 2 заказчика каждый делается по best practices но некоторые роли пересекаются соответственно ребята говорят дай мне свою роль q там для установки чего-нибудь и я ее скопирую себе в репозитории кода и подпилить чуть-чуть надфилем под свои нужды соответственно все это стало расти как снежный кот и кокс кот стал расти как снежный ком и стали знакомые проблемы возникают как всегда когда много кода страх поломать код не перес пользуется копируется копипаста нет рефакторинга действительно зачем я буду улучшать то что работает уже так как то вдруг она сломается нет уверенности в каждый момент времени что это вообще сработает если ты надо будет запустить и отладка процессе диплом допустимым playbook там посмотрим чего будет к знакомым проблемам знакомы решение его подсказывает просто-таки капитан очевидность нужно автоматизированное тестирование и сияй делать но как ведь это же не просто кот там которым которому юнит-тесты запускаем как на джавитом или на питоне это же configuration аскот так это делать но прежде чем мы перейдем к тестам давайте упростим проблему и посмотрим а что мы можем проверить вообще не запуская код просто глядя на этот код прежде всего его вал form1 суда является ли он вообще синтаксически валидным и для этой задачи у нас есть три инструмента которые можно использовать совместно это будет очень хорошо я мэлвин танцы был линд и есть яндекс самом play букин сейчас для начала пробежимся по им проект ямал линд он проверяет синтаксис ямал я был не так прост как вы знаете он ну например он проверяет много чего они там десятки всяких чеков лишние пробелы переносы строк uniq style одинаковость отступ of потому что можно сделать валидные ямал но с разными отступами это будет не очень красиво выглядеть и так далее в принципе он более строк чем инси был коду но он позволяет некий три проблемы убрать например у нас разработка ведется под windows задние и если попадают переносы строк windows style в конфигурационные файлы то это когда ямал винт это решает так выглядит вывод ямал винта и обратите внимание значит мы эти правила все можем настроить то есть отключить какие-то проверки например длину строки сделать побольше дни ли еще что то ямал линд он проверяет просто все ямал файлы в вашей папке поэтому если это ниианси был play буки или роли а просто какие-то конфигурационные файлы он тоже их проверять in seoul land and sea был линк прекрасный проект который содержит десятка два good practice с проверки good practice и для примера когда использовать комнат модуль когда использовать shell модуль часто с этим поле путаются новички и once i был винт это находит иногда используется команд а в команде какой-нибудь там come and guide вызов гита или ещё каких-нибудь вещей для которых есть на самом деле стандартные модули он подсказывает и или там не знаю сет какой-нибудь а там для сада целый куча модулей которые могут менять текст ваших файлах он проверяет импотент ность ваших использования команд и шел предам потребность мы чуть-чуть поговорим позже поподробнее то есть он строже чем самим символ и в принципе он проверяет best practices вашего кода и кроме того если вы хотите на питоне чего-нибудь пописать то там есть пример который расширяет ну дает возможность расширять эти правила и добавлять новые запускается это вот так вот здесь есть одни грабли если ваш код содержит и но использует какие-то стандартные роли он будет обходить том числе и стандартный роли ну стандартных ролях есть критические вор нинги извините м поэтому он сну завалит вам вашу стиай сборку поэтому стандартные роли исключите так выглядит его вывод 3 3 инструмент это синтез чек встроенный в сам ямам самая on seba тут все просто но местный грабли которые также надо учесть если этого делаете нося это установите все свои стандартные роли потому что синтаксис чакон хоть и называется syntax chic но проверяет он не только синтаксису заходит внутрь всех ролей их тоже обходит поэтому если там какая-то роль не установлено то у вас завалится сборка соответственно все это вы можете объединить скрипт вашей любимой себя системы ну у меня это дженкинс вы можете спорить чем угодно и получить вот уже такой pipeline получите вы можете прямо сейчас не вставая с места это ничего она не стоит вы просто получаете статический довольно подробный статический анализ ваших ямал всего вашего с и был хозяйства скажем так но как известно возможность статического анализа ограничены все-таки что протестировать программу надо запускать как же тут быть история вопроса вот какая jogger link это человек известный вас было к системе автор нож дуралей автора книги для nancy был ходе вупс в четырнадцатом году написал вот этот статью предлагая в траверсе разворачивать ролик который он тестирую два года спустя он предлагал делать дин предлагает уже продолжение этой статьи делать то же самое но в разных докер контейнерах таким образом за один раз прогоняет он вот как он пишет я прогоняя 7 разных операционных систем и своей роли и в этой же статье он упоминает молекул вот молекул это штука которая где-то с пятнадцатого года существует и она сейчас очень активно развивается и это очень удобный инструмент для тестирования aswell ролей это типичный такой современный open source проект который просто интегрирует хорошо интегрирует другие проекты устанавливается он ваш по python informing нужно поставить инси был молекул и если вы будете тестировать в докере докер пайм и он тестирует роли этот инструмент тестирует роли то есть он работает внутри роли отдельный у проекта ас вал целиком а внутри роли соответственно внутри роли у вас могут быть разные сценарии внутри сценария вы настраиваете инстанции на которой вы будете накатывать эту роль допустим на разные операционные системы кроме того у каждого сценария есть свой playdough play бог это то что будет выполняться накатывались на вот эти вот инстанции есть тесты конфигурационные тесты сейчас все покажем во-первых инициализация если вы хотите создать новую роль уже с молекулой то вы пишете вот такой вот командочка не она создает вам папку со всеми даже тот ридми файл есть со всеми вещами необходимы для создания был роли поэтому даже это удобный такой стартер для быстрого написание собрали а внутри папки молекулу них единственный сценарий под названием дефолт возникает в принципе одного сценария под названием дефолт но мне лично всегда хватало более одного сценарий не писал если вы хотите добавить молекул вашу существующую роль то вам надо выполнить вот такой вот команду она тоже добавит default сценарий в принципе это там никакой магии нет она просто папки создает и файлы туда прописывает вы можете просто копировать уже из существующих ролей который под молекулы папки в новой роли и там все то переиспользовать очень легко после того как мы принесли zero вали заходите в консольку пишите молю kill тест все у вас молекула тестируют вашу роль как правило это упадет при чем тут цен заряд какой-то вообще сообщение об ошибке не понятно почему она упала если мы запишем заполним значит минус минус дебаг флажочек то она скажет вот что вы забыли установить докер пойму а я между прочим несколькими слайдами ранее говорил что докер по и надо ставить отдельно вот в принципе этот минус минус дебаг очень помогает разобраться что же не так пошло потом она покажет вам тест matrix это некий план или сценарий по которым молекула будет работать с вашей ролью как видите она уже предлагает некую такую матрицу действительно на первых этапах она проверяет статический анализ потом она проверяет синтаксис can вершит импотент ность и заканчивается все с носом с носом тестовых инстансов на которой это все ставилась самое интересное конечно это она чем же собственно на что же собственно молекулы накатывает ваши роли на какие instance откуда найти ресурсы берет эти ресурсы настраиваются вот в таком файлике молекул я мол вы можете прописать в разделе platforms столько инсов сколько вам нужно если вы пропишите там 3 или 5 их будет 3 или 5 in c был на этапе конверт же простых будет раскатывать сразу на несколько этих нот ну как если был обычно делает какой все знаете соответственно вот здесь если это докер то здесь вы прописываете базовые имидже и заметьте что здесь имиджа такие хитрые сделано это для того чтобы у нас работал систем де потому что если вы ваши роли раскатывают какие-то сервисы которые работают систем де как известно докер с этим не работает но можно воспользоваться хитрыми базовыми контейнерами комитете потом не придется вот таки вот образом можно обойтись и у вас будут тестироваться роли которые сервисы ставят систем deep кроме докера вы можете использовать другие драйвера во первых вы можете создавать тестовые инфляции в облаках используя соответствующие модули встроенные facebook во вторых вы можете сами написать драйвер но там есть заготовка такая под delegate это и есть vagrant и есть многое другое то есть заходите на документацию по молекуле там достаточно большое количество вариантов но докер не более простой наиболее такой легкий его можно прямо здесь и сейчас на вот машине разработчика и взять и запустить следующий важный момент когда вы начинаете этим пользоваться вам необходимо подключить зависимости под зависимостями я имею ввиду роли от которых зависит тестируемая роль это прописывается файле рекламе нс ямал как положено но по best practices если бы и вы можете указать эту настройку какие роли каких версий вам нужны для то что протестировать вашу роль как зависимость и на первых этапах на этапе дтп нэнси именно роли именно этих версий будут скачены там статического анализа используются вот эту троицу о которой рассказывал самом начале мы уже все знаем этап конверт просто на ваши тестовые инстанции накатывает файл playbook яму вот что вы там напишите то он и сделает вы можете даже вашу роль тестируемую туда не подключать а что-то другое то есть этап конверт он просто выполняет файл play books on здесь вы можете несколько ролей у выполнить как-то и сконфигурировать и посмотреть потом как они будут работать совместно если что-то пошло не так converse вроде как бы прошел или он не прошел на непонятно что происходит вы можете сделать следующее запустится с ключиком дестрой на его это значит никогда не удаляет тестовые инстанции если вы в докере то обычным образом через интерактив терминал подключиться к ваш залогиниться ваш контейнер и посмотреть что там какие файлы не туда легли что-то вообще происходит следующий этап после converge а значит предположим роль не сработало на все ваши тесту инстанции раз катилась все здорово молекула еще раз выполняет вашу роль и проверяет вот как бы раньше когда еще не было div в ансамбле герлен предлагал так проверяет что ничего не изменено при втором прогоне эта проверка тем патент насти то есть что ваша playback написан таким ваша роль написано таким образом что она не делает лишних операций если операции не нужно делать она их не делай но сейчас да она использует минус минус div и если так получится что роль ваши работает и делитель на делает то что нужно но при втором прогоне хотя бы одна вещь поменяется это будет файл на этом патент ность и самая интересная часть молекул это инфраструктурной тесты то есть хорошо мы прогнали роль прошла все за за как бы туда установилась но работает она вообще делает она то что нужно она там вообще не шевелится или нет вот для этого нужна можно использовать инфраструктурный тесты малики поддерживает рано инфраструктурные тесты три вида тест инфа на питоне сервер спект на руках и газ нога если так случилось что у вас команде уже есть какие-то инфраструктурные тесты например на сервер спеке то вы можете их подключить готовые тесты инфраструктурные в молекулу если инфраструктурных тестов еще нет я рекомендую тест инфра потому что она на питоне также как и молекула также к концы был так же как все о чем я здесь рассказываю и в принципе меньше overhead на и проще это все тест инфра test in protest и они вот файле вашим дефолта вам дефолтом сценарии уже улетел туда положит и вы можете прописывать туда тесты что например можно проверить но что мы обычно проверяем когда что-то сконфигурировали на сервере и хотим посмотреть шевелиться ну или нет мы лезем в вышел и выполняем какую-то команду и смотрим что нам выдал эта команда это можно сделать вот таким вот образом то есть вы пишете питонов скую процедуру получаете аргументом хост этого хвоста вызываете метод ран и дальше можете получить re-therm код можете получить с т т у т с т д р и проверить этот вывод кроме то значит если assert какой-то слетел до вашим тесте то вы получите вот здесь вот в а сердце мы просто что написали до что rc равен нулю допустим ликером код равен нулю если бы он был равен нулю и если бы учет там не нашли то вы вот-вот питонов ска марсе рти он умный то есть он показывает вам прямо контекст вашего питонов ского кода где что слетела что именно чем у не равно для того чтобы не тратить время потому что когда вы гоняете молекул вот маленький тест полностью самое длительное время это накатка особо скриптов на инстанции вы чтобы не тратить время на накатку тестовых скриптов на инстансы вы можете опять воспользоваться флагом дестрой never и вызывать молли kill verify в этом случае он будет просто вас выполнять инфраструктурные тесты на ваших уже готовых инстансов ну и вот что получить как это выглядит когда инфраструктурные тест зеленые когда 2000 году появился g unit 1 system unit тестирование у них был такой девиз хепзиба are great to keep you caught клин вот так как у нас теперь обретение скаут то мы можем инфраструктуру то же самое сказать про инфраструктуру что еще можно проверять веб-сервисы ну опять же но на самом деле мы можем проверять все что мы можем проверять через командную строку да установили куру можем подергать какие-то сервисы можем по проверять вывод курло но там есть еще в test in free есть хорошие абстракции для проверки других вещей например процессы вот host process дает вам фильтруем и фильтруем мою коллекцию процессов запущенных сейчас мы хотим вы можете по фильтровать по какому-то по каком-то фильтру по какому-то аргументу ну например по названию запущенного файла и проверить его свойства например что она от правильного пользователя запущен этот процесс чтобы меня труд а его запускаем допустим или там что он запущен с какими-то определенными аргументами сервисами все просто можете получить сервис по имени и проверить что он запущен или не запущен и также очень легко проверять файлы их содержимое то есть например если наш запуск сервиса поле порождает какие-то логе которые мы хотим зайти проведшего тех logo что-то появилось это очень легко сделать до во-первых pixies мы можем править что вообще существует по данному пути а при помощи контент очень легко можно проверить что этот файл содержит какой-то под строку который нам сигнале что все окей ну и а если кто-то любит test driven development то в принципе использовать эту быструю быструю ты рацию перезапуска тестов мы можем сначала писать тесты по демпси был а потом уже самый on seba то есть совершенно enfeeble код он становится стать таким же кодом как не зная код на ржавели код на питоне разрабатывать и можно техники между самими средствами тут может быть кто-то вспомнит как пока мы говорили про test in fresh the same man сабли есть модуля сердце действительно хорошая мысль включить вот такую проверку прямо в swans был роль то есть установили что-то но джейд он это java интерпретатор это интерпретатор питона в машине значит и выполнили команду джейд он вершин проверили что там он создает какой-то вы осмысленный вывод хорошая идея правда она не пройдёт если вы пользуетесь молекулы и потому что молекула скажешь это кот не дым патентной почему потому что джейд oh минус минус вершин выполняется всякий раз независимости от того но вся моя просто всякий раз выполняются безусловно и это не пропустит ни отсыпал линд не даже если вы вас был ленте пропусти но это тут в загасить и эту проверку то потом молекула на этапе проверки дым патент насти вас не пропустит поэтому нельзя просто так взять и вставить assert в год iansi планов принципе его вставить можно если мы вставим в хендлер проверку например мы скачиваем этот самый эту самую программу мы устанавливаем эту программу в разных местах кода и мы найти фиксируем некоторые finder который потом если мы и либо скачали новую версию либо установили либо что-то сделать он потом запустится и проверит что действительно она работает принципе идея использовать проверки в тендерах мне кажется очень хороший потому что если все-таки на продакшене что-то пошло не так то вы узнаете об этом сразу то есть сразу в процессе еще запускаем sibl playback у вас будет вывод осмысленный и файл fast это всегда очень хорошо еще в хендлеров можно проверить файлы их содержимое еще в кадрах можно проверить web-сервисы в принципе этого достаточно чтобы такой аналог инфраструктурных тестов попроще чем дает тест инфра но в принципе достаточно мощный сделать организовать то есть это хорошая идея и я призываю писать танцевал под таким образом теперь немножко проговорим про процесс разработки ролей но он стандартный значит репозиторий для ролей это galaxy и он жестко привязана гитхаба то есть если вы разрабатываете роли open source это это гид хоп только лишь и соответственно гитхаба вский процесс с проверкой на оси а и на валидность вашей роли то что попадает в мастер то мы считаем релизом в общем так если мы хотим ссылаться на какую-то версию то мы можем поставить так какой-то на мастере это будет ссылка на версию вашей роли соответственно как это можно сделать запуск молекулы легко организовать в вашей системе если это дженкинс тут есть некоторое грабли связанные с тем что если мы используем дженкинс мальте брань что он чека отец контроля версии ваш проект не в папку с названием этого проекта мая roll-on чекайте ты и в папку с большим набором цифр и букв уникальную и в результате у там wynn's и было сносит крышу потому что не понимает как король то мы ищем аэрол а там роль вот с таким вот названием но это делается небольшим костылем если вы подставить пацану simulink внутри в под папочку то это все решается вы можете заморочиться и на разделить выполнение молекул на стадии если вы так сделаете вы получите вот такую красивую матрицу дженкинс и если вас летела на каком-то этапе то можете увидеть на каком этапе она слетела у вас но честно скажу что я так не делал вот видел статью где чувак расскажешь над делать вот именно так но я ограничиваюсь просто admins 3g молекул тест другая опция которая для вас более актуально если вы разрабатываете роли в локон source и даже единственное это трэвис тут вообще все очень просто мы указываем там сервисе за докер мы указываем в инсталляцию что нам надо поставить н символики у докер кстати хорошая идея это указывает явной версии того что вы хотите поставить иначе у вас сборка сегодня может выполнить а завтра не выполнится и очень простой скрипт молекул тест но если у вас роль которую вы разрабатываете она вот-вот в этом вашем гид хоп репозитории и используя вот такой вот вот хук вы notify церу и tienes apple galaxy тем что роль ваша хорошая build a passing или build филе и в результате вы имеете в окне поиска ролей в galaxy вот такие вот бэйджики это не те боевики которые гитхабе это бейджик именно в mtb galaxy чтобы получить надо пользоваться трэвисом и вот тем вот в хуком из другого какого-нибудь это мой может быть можно сделать но я не понял пока как задокументированный вариант только через привез соответственно после того как от все внедрилась что получается у нас было вот что то есть какие-то проекты какие-то роли между ними значит копи пейс modify и не понятно что стало общее роли которые мы используем между проектами вы вынесли в galaxy они разрываются соответственно каждая роль тестируется молекулой соответственно дописать допиливают роль уже каждый под свой проект сам и это становится общим достоянием остальная часть которая уникальна для каждого проекта на нее новейшим длин thing вот эти три инструмента ямале intense был лент и синтаксис чек и это уже гораздо гораздо лучше чем было но вопрос можно ли здесь пойти дальше и улучшить что-нибудь еще потому что смотрите у нас есть часть вот которые в galaxy и которая проверяется молекулой у нас имеются роли которые мы в принципе молекулы тоже можем проверить внутри проекта ну как бы проект наши под роли но есть большая часть конфигурационного именно кода которая содержит переменные а всякие конфигурационные файлы и это достаточно большие такие куски кода которые не проверяются никак вернее мы проверили что я мол был формат и больше ничего мы не проверили здесь можем ли мы что-то проверить как быть конфигурации значит плохая новость том что молекул он вообще только для ролей вы можете комбинацию ролей правда проверить сразу оговорюсь до в молле кили но проверить развертывание на пруд можно только развернув вопрос потому что у вас там прописаны на какие машины вы устанавливаете значит как вы связываете это все и соответственно только в процессе развертывания напросто это и запустится но хорошая новость в том что вы можете проверить проект не запуская его кто-нибудь здесь знает кого-то из этих людей нет а есть такие до другая аудитория значит это докладчики конференции джага по тестированию diesen бак и они рассказывали про такую вещь как конфигурационные тестирование тесты конфигурации на самом деле идея очень очень простая если у вас имеется конфигурационный файл некоторый допустим множество пар ключ-значение ключ-значение что мы можем проверить ну мы можем проверить формат значение этих переменных что если у нас значит должен быть порт то это под они что-нибудь что если хоста и to host the мыслил то это урал мы можем проверить что у нас нет я не утекает явном виде пароли допустим гид мы можем проверить уникальность портов потому что если вы назвали две переменные в одинаковом портом с портами одинаковым портом то как правило это ошибка вас и были особенно и другие более специфические вещи например андрей татарин рассказывал своем докладе что ему необходимо было проверять что разные инстанции какого-то сервиса они ставятся в машины расположенные в разных стойках потому что иначе не будет достаточно значит файл сейф даже если их всех запихнуть в одну стойку и стойка отключится то тогда какая разница что у нас было при instance а вот и на самом деле идея то очень простая мы просто берем и пишем проверки эти используя тестовый фреймворк например по unit-тест вернее potest и простота не неожиданно потому что ты не исполняемый код атаковать статический код сейчас я покажу как это может выглядеть например как мы можем проверить валидность портов мы можем написать вот такой вот тест являющийся частью пойти 100pro мид рисованный который применяю в которые проверяют для всех пар ключ-значение где ключ эта переменная которая держит порт а значение это собственно значение этой переменной мы можем обычное сердце написать что это int-овое поле что порт находится там разрешенным вами диапазоне то есть идея очень простая вопрос как бы в чем в чем магия магия находится вот здесь вот вам надо написать процедуру на питоне генератор такой который вам будет выдавать все кей валы и значения для переменных которые содержатся порты как же мы узнаем как же мы отличие переменные которые содержат порты от других переменных мы это можем сделать вот таким вот образом мы можем договориться что наши переменные которые порты прописываются имеют постфикс порт как правило это есть всегда там не знаю mais quel порт вот и соответственно если у вас есть другая функция ворвалась которая выдает вам все переменные все пары ключ-значение всех переменных вашей массы был по ибуки то вот таким вот образом вы можете отфильтровать из этого потока ворвалась только те которые оканчиваются на порт и соответственно там ну слайдам ранее параметризовать тот тест и тогда этот тест будет выполняться на партах и проверять их а как написать ворвалась но тут уже как бы взять на питоне написать это же обход ямал рекурсивный обход ямал дерева значит примерно мы знаем как устроены и ямал и ansi было и надо просто выть вытащить оттуда все куски которые содержат переменные это не так сложно но в принципе это так как здесь мы рассчитываем уже на некоторые соглашение которое есть вашем коде то здесь не может быть универсального решения это решение уже придется самим разрабатывать так можно проверить уникальность портов да очень просто берем если у нас уже есть вот эти вот порт вал valdez которые перед возвращать на все переменные с портами то мы просто можем собрать их в один сет и на каждом шаге проверять что они просто уникальны и порт задают таким образом мы можем еще один значит слогом сделать теперь же до configuration and configuration тесты kept багрин to keep the configuration клин вот как это выглядит когда все сработало обратите внимание там внизу написано что у нас выполнилась то один тест это не значит что мы написали 101 тест это значит что эти наши параметризовано и тесты выполнились сто один раз для 101 там пары переменные значения но я вон тут все про суммировал естественно но их большие количества проверок они не означает что он для этих проверок надо много кода писать на самом деле куда писать надо довольно мало так же как и для инфраструктурных тестов и напоследок пример значит как можно поймать допустим вытекающей пароль таком случае мы во-первых выделим из целого потока ключ значение переменных выделим те которые содержат себе пароль выделить их можно так они заканчиваются там либо на слово password либо на слову пос ле бона пвд во-вторых мы просто проверяем что значением должен быть placeholder который ссылается на что то но на волк какую-то переменную который находится в волки и все этого достаточно на самом деле это достаточно чтобы это реальный случай вот это вот был такой pull request и запустился тест это тест возвращает мне кей mais quel root password в 1 2 3 4 5 это человек при к метил пол request то есть не не то плохо как бы что паспорт 12345 а то что он в гитхабе теперь и соответственно как бы понятно что билл запросы такой pull request вы мер жить нельзя но давайте к выводам переходить значит первый вывод тестируйте ваши шансы был во первых вот эта троица ямуны интенции был винта сеток человек вы можете проследить прямо сегодня если у вас есть какие-то портянки с сансе был кодом какие то есть значит репозитории где все это лежит просто возьмите подключите посмотрите какие вор ринге там возникнут потом у вас будет увлекательно и время фиксить раз и был ли на самом деле рассказывает может вам многое рассказать многому вас научить потому что в область практике никто но многие не знают проверяйте роли на молекул оставляйте проверки в finder и дата сделайте ваши play буки файл fast так чтобы вместе чтобы пошло не так мы об этом узнали как можно раньше и тестируйте конфигурацию молекул это маст хэв при разработке ролей опять же если у вас это есть роли попробуйте молекулу это просто молекулы нет pip install но liceul молекулы нет маленький тест лень разбираться с тестами мы попробуйте конверт штаммы дым потом лень разбираться с конверсий до патент ладно пусть он хотя бы синтаксис проверь назвался кодом полезай всей ну я вообще верю что все должно быть как кот инфраструктура как вот база данных какого-то документация какого то соответственно что значит быть как кот это не только лежать в репозитории не только лежать где те но это значит что должен быть pipeline должны быть quality games должен быть должна быть процедура изменения этого кода чтобы делать я сиди для ансипа в роли и штатный набор инструментов которые как бы они сами предлагают это гид хоп трэвис и galaxy если вы разрабатываете роли вампир source правда я вижу мало поводов разрабатывать руль него там source дженкинс мальте branch тоже отлично для нас работает ссылки про которые я упоминал будут на слайдах которые будут расширены а у меня на этом все спасибо коллеги из есть вопросы то поднимаете руку я подойду с микрофоном чтобы вас хорошо был слышать дел погромщики спасибо за доклад меня зовут роман я хотел точнее такой вопрос сделали бы написание тестов обязательным чтобы например выложить роль common роль какой-то вашу общую в пользования и если да то на сколько это увеличило порог вообще вхождение в эти был потому что я не был всем подается как простая система управления там конфигурациями в итоге человеку нужно сдать там бетон тест инфра разобраться с молекулой вот и количество боли увеличивается потому что каждое изменение нужно покрыть тестами на питоне который может ему там не нравится или он его не знает смотрите значит ну как бы и и кокаин форсить написание тестов точно также как она фортеця когда вы пишете на джаве во время кадре view то есть эта сделка значит пол request мы решаем там тесты нужны или не нужны касательно порогом вхождения если досмотрите роли это нечто какой-то код расширенный то есть как бы библиотечный код как правило если нужен человек который быстро подправить что-то надо вам уже работает с кодом который же существует поэтому он просто зайдет и поправят и и тесты на это не нужны там тесты на какие-то которые собственно на плей буки они не нужны плит тесты на роли которые именно расширен и между собой вот и даже если он что-то поправить надо ли менять тесты потому что это это же не тесты как кода даже в те инфраструктурные тесты они просто проверяют там они очень просты и там 223 statement а который проявляешь мы запустили что-то в щели а этот шар на что-то вывел и поэтому можем достаточно много чего поменять в роли а теста и не менять так вот такой вопрос а тестирования винус ну windows да мы тыкаем windows ансамблем и как-то тестировать это ну и может быть есть у вас опыт войны к сожалению значит нет у меня опыта разворачивание архива чего-то на windows и тестирование этого в тест инфра мы разрабатываем под windows то есть ourselfs игра не запускается и работает но для нас но все роли мы выкладываем на linux сервера тестируем там поэтому не могу ответить может быть возможно но просто меня такого опыта не было спасибо за доклад меня зовут михаил у меня такой вопрос выносить проверки fender это хорошая идея но как мне поступить если от результата проверки зависит роль то есть руль будет меняться поможет в этом очень же заныло например вы имеете ввиду что у вас что вы хотите запустить растет а получить какой-то вывод в консоль и значит захватить его в переменную зависимость от результат этого вывода в зависимости результат этого вывода выполнить одно либо другое так что ли ну допустим проверить если пользователи не могу ли я заладится вспорол с паролем которые меня есть и ну если пользователь не создать пользователя если но это не про проверки это не протертые то пройдем патент ность вообще но тут надо писать и дым потребны скрипты то есть выход тут один под у вас же есть возможность если вы пользуетесь командам или шилом у вас есть возможности указать ситуации при которых он не будет выполняться например если там какой-то файл куда-то выложился вы пишите там корее кто-то и если вы уже создали вот нужного вам пользователя вот такого как он есть у вас должен должна должен быть такое такое условие при котором эта ветка она даже отрабатываться не будет то есть эта потребность это значит мы отработали один раз создали то что нам надо мы обработаем второй раз и вот проверили что нет этого и она как бы никаким идиоты модификаций нэнси был вы бы выполнять не будет в принципе предостаточно ну подумав в этом всегда можно сделать так или иначе какие-то частности пройду наверное отсюда а потом к вам зайду здравствуйте спасибо за доклад хотел бы в продолжении вопросы заодно предыдущем спрашивающий в следующем насколько мне известно в ансамбле можно писать задача для деза link факт стадии не расслышал что можно писать не смешивать можно писать задачу для casing факт стадии когда он собирает информацию перед тем как еще катить сами ну да вот и допустим вот та же самая проверка g-unit а да там на совпадение версия что если и вынесение хендлер в газе ринг tasks чтобы сначала проверить то ли версия а потом уже наготу интересная мысль но надо посмотреть то есть как бы будь то он иисус предпринимать этот код как и дым патентный например но это понятно это проверка перед это верно вот проверка да что он когда значит да во первых чем хороша проверка в конторе что это пост проверка то есть мы попытались его установить да там этот считаем что мы его установили но еще мы дернули hinder чтобы он зашел выполнила и проверю что он дает какой-то осмысленный вывод а не какой-то стектрейсы нас повалился вот перед проверка она не будет проверять результат действия но мысль интересная надо посмотреть принципе как модули как тоски вернее выполняющийся вот на этом этапе как бы посчитаются они затем патентные или нет она просто смотреть то есть например у меня вот есть ролик который допустим там с гитхаба там с релиза кого-то проекта качают архивчик распаковывают его у меня на самом деле но тестам в роли вначале стоит проверка доктора не дам патентом которая просто проверяет вывод командочки на вершину меня это является как бы условиям по которому ставить или не ставить вот и правильно это это норман ход может дать возможности нормальный валидный подход если вы будете это на молекуле тестировать она ничего вам не скажет плохого на такую отлично спасибо за ответ прости меня зовут владимир спасибо за доклад очень интересно приходилось ли вам писать ну или тестировать такие вещи ну как бы более сложные то есть результат корректность выполнение ролей то есть ну скажем что он написал какой то роль которая стоят там как он сервис и вот проверять что она действительно сделала то что от нее ну как бы требовалось но вот в инфраструктурные тесты можно признать тест значит которым прописать что service is running сервис такой-то из ранее то есть сейчас же про сервис даже был прямо прямо пример вывод про это имеете ввиду ли не поет про сейчас мы проверим значит так так так так так так так так так так так так этот раз так в сервис и вот вот это имелось ввиду ну имеется ввиду что там ну как бы сервис это довольно просто а бывают то там более сложные случаи что ну как бы бывает так что он вроде бы как работы до на самом деле там ну настя но это уже вопрос про тестирование по моему как бы в этот инфраструктурный тест он не проверять функционализм проверяет что там нет и мне идет из щелей что что она просто нет места то вместо значит а запросы не вывалился stack trace а вывалился какой-то ответ то есть ничего сложнее чем вот в этом примере или там скажем вот вот в этом примере там что мы 200 шт нас сервер вообще 200 вернул на дэвид когда мы что-то запросили ничего сложнее на этом этапе не над проверять мы пишем там не знаю selenium test in а значит наш интерфейс и если они прогнали си если у нас уже там этот артефакт готовы к установке то мы просто в сабле говорим ставь эту версию и если она подставилась мы просто раньше он 200 возвращать но мы уже не проверяешь надел это что надо потому что мы это проверили на более ранних этапах pipeline спасем еще вроде да как бы давайте этой страны здравствуйте ещё раз спасибо за доклад не подскажете используете ли вы в продакшене role is an sibl galaxy и тестировать или вы их роли и senseable galaxy мне жемчужине используем чужие конечно же да там engine и x там не знаю по ст gres до кучу всего мы разворачиваемся при помощи тоже oracle java разворачиваем при помощи ролей занялся было и эссенции был galaxy то есть как бы в выбор какой роли обыграли там очень много выбирать и и но обычно там по количеству скачиваний и как правило они тестируются то есть как правило ролевым сибли они имеют бил pipeline если не на молекуле то хотя бы в тезисе они запускаются то есть из посмотрите как бы хорошие вот прям вот признанные роли того же ja foger линга ну вот кроме него вы кроме его ролей а мало встречалась чего-то достойного в galaxy ace тайного в galaxy note к у него жили для всего 6 нет на самом деле в galaxy обычную ну просто надо выбирать мусор какой-то не стоит конечно убирать вот не страшно смысле не страшно рад буду я честно говоря вот тех те случаи когда я использовал это нормальный роль достаточно много там конечно есть и мусор но если фильтровать просто поставить search и по количеству скачиваний там сразу же сразу же видно из тролль который скачали 150000 раз и есть руль который скачали 150 раз то в общем то если 150 тысяч раз ее скачали может там кто-то даже ею пользуется в продакшне спасибо здравствуйте спасибо за доклад у меня вопрос как ваших новых инструменты про которые рассказывали работают с джинджи затем с джей джей да ну работают к в том смысле в каком если было работает деле я не очень понимаю но вот я не знаю в моих проектах иногда бывает достаточно сложные всякие навороты джинджи допустим джинджа может генерировать список хостов которые я использую как перемены вход как будет работать список хостов которые вы используете как переменный вход если говорить о хостах которые генерируют жизнь значит если говорить о хостах то значит это не про молекулу точно потому что молекула тестирует роль на выполняя ее на тестовых кастах то есть у нее там возникает некий динамически инвентарь и как бы молекула сама знает на каких аст и нагонять эти роли и она их будет выполнять вот конкретно ваш пример если какие-то другие случаи молекулы делает что молекула всего лишь в какой-то момент выполняет файле который заяц apple ibook я мол и что у вас там в этом playbook яму ей неинтересны . там был валидный play books там какая-то сложная джинджа у прекрасно значит все она либо работает либо свалится и тогда вас молекула совали ттц"
}